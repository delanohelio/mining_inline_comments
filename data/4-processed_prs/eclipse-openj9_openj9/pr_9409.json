{"pr_number": 9409, "pr_title": "Add --with-boot-jdk and other improvements to Linux build instructions", "pr_createdAt": "2020-04-29T21:45:16Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9409", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMzA0Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r417633047", "bodyText": "@keithc-ca you removed this section from the non-docker instructions in #9371 and I'm not entirely sure why.", "author": "pshipton", "createdAt": "2020-04-29T21:49:12Z", "path": "doc/build-instructions/Build_Instructions_V8.md", "diffHunk": "@@ -104,14 +104,37 @@ apt-get update \\\n    ...\n ```\n \n-2. Download and setup **freemarker.jar** into a directory. The example commands use `/root` to be consistent with the Docker instructions. If you aren't using Docker, you probably want to store the **freemarker.jar** in your home directory.\n+2. This build uses the same gcc and g++ compiler levels as OpenJDK, which might be", "originalCommit": "2e357a7b125d66bc0745b5155b36a638e44bd249", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzOTM3Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r417639377", "bodyText": "That change went with the advice to use cmake; which apparently was only partly reverted.", "author": "keithc-ca", "createdAt": "2020-04-29T22:02:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzMzA0Nw=="}], "type": "inlineReview"}, {"oid": "692046f90d292789b5fcf693a0bd078b19eca87a", "url": "https://github.com/eclipse-openj9/openj9/commit/692046f90d292789b5fcf693a0bd078b19eca87a", "message": "Add --with-boot-jdk to Linux build instructions\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-29T21:50:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY0MTU4MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r417641580", "bodyText": "I would reword this: the option is required if JAVA_HOME isn't set or doesn't refer to a suitable boot jdk. If you're building multiple jdk versions, you probably can't satisfy them all with JAVA_HOME. I think we should advise use of --with-boot-jdk in general.", "author": "keithc-ca", "createdAt": "2020-04-29T22:07:55Z", "path": "doc/build-instructions/Build_Instructions_V11.md", "diffHunk": "@@ -171,10 +171,12 @@ bash get_source.sh\n :penguin:\n When you have all the source files that you need, run the configure script, which detects how to build in the current build environment.\n ```\n-bash configure --with-freemarker-jar=/<my_home_dir>/freemarker.jar\n+bash configure --with-freemarker-jar=/<my_home_dir>/freemarker.jar --with-boot-jdk=/usr/lib/adoptojdk-java-11\n ```\n :warning: You must give an absolute path to freemarker.jar\n \n+:warning: The path in the example --with-boot-jdk= option is appropriate for the Docker installation, this option is not required if you followed the instructions to download and setup the boot JDK.", "originalCommit": "692046f90d292789b5fcf693a0bd078b19eca87a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY0ODM3OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r417648379", "bodyText": "I've updated, but if you still want changes we can figure it out on Slack.", "author": "pshipton", "createdAt": "2020-04-29T22:24:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY0MTU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY0MTkzMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r417641932", "bodyText": "Same comment as above.", "author": "keithc-ca", "createdAt": "2020-04-29T22:08:44Z", "path": "doc/build-instructions/Build_Instructions_V14.md", "diffHunk": "@@ -169,10 +169,12 @@ bash get_source.sh\n :penguin:\n When you have all the source files that you need, run the configure script, which detects how to build in the current build environment.\n ```\n-bash configure --with-freemarker-jar=/<my_home_dir>/freemarker.jar --with-boot-jdk=<path_to_boot_JDK13>\n+bash configure --with-freemarker-jar=/<my_home_dir>/freemarker.jar --with-boot-jdk=/usr/lib/adoptojdk-java-14\n ```\n :warning: You must give an absolute path to freemarker.jar\n \n+:warning: The path in the example --with-boot-jdk= option is appropriate for the Docker installation, this option is not required if you followed the instructions to download and setup the boot JDK.", "originalCommit": "692046f90d292789b5fcf693a0bd078b19eca87a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY0MjQxNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r417642417", "bodyText": "And again.", "author": "keithc-ca", "createdAt": "2020-04-29T22:09:46Z", "path": "doc/build-instructions/Build_Instructions_V8.md", "diffHunk": "@@ -133,10 +155,12 @@ bash get_source.sh\n :penguin:\n When you have all the source files that you need, run the configure script, which detects how to build in the current build environment.\n ```\n-bash configure --with-freemarker-jar=/root/freemarker.jar\n+bash configure --with-freemarker-jar=/root/freemarker.jar --with-boot-jdk=/usr/lib/adoptojdk-java-80\n ```\n :warning: You must give an absolute path to freemarker.jar\n \n+:warning: The path in the example --with-boot-jdk= option is appropriate for the Docker installation, this option is not required if you followed the instructions to download and setup the boot JDK.", "originalCommit": "692046f90d292789b5fcf693a0bd078b19eca87a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a3d83689d09adbab7061219961d80b51ee0e8634", "url": "https://github.com/eclipse-openj9/openj9/commit/a3d83689d09adbab7061219961d80b51ee0e8634", "message": "Add --with-boot-jdk to Linux build instructions\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-29T22:23:37Z", "type": "forcePushed"}, {"oid": "e4064a1cc07afd74d3414b34f003b3dd8db7d166", "url": "https://github.com/eclipse-openj9/openj9/commit/e4064a1cc07afd74d3414b34f003b3dd8db7d166", "message": "Add --with-boot-jdk to Linux build instructions\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-30T13:53:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAzNjQ2Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418036467", "bodyText": "If we're going to discuss this, I think it should explain how to get gcc-7 and g++-7 that are the targets of those links.", "author": "keithc-ca", "createdAt": "2020-04-30T14:06:17Z", "path": "doc/build-instructions/Build_Instructions_V8.md", "diffHunk": "@@ -104,14 +104,36 @@ apt-get update \\\n    ...\n ```\n \n-2. Download and setup **freemarker.jar** into a directory. The example commands use `/root` to be consistent with the Docker instructions. If you aren't using Docker, you probably want to store the **freemarker.jar** in your home directory.\n+2. This build uses the same gcc and g++ compiler levels as OpenJDK, which might be\n+backlevel compared with the versions you use on your system. Create links for\n+the compilers with the following commands:\n+```\n+ln -s g++ /usr/bin/c++\n+ln -s g++-7 /usr/bin/g++\n+ln -s gcc /usr/bin/cc\n+ln -s gcc-7 /usr/bin/gcc\n+```", "originalCommit": "e4064a1cc07afd74d3414b34f003b3dd8db7d166", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA0NTI1NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418045254", "bodyText": "This should be covered by the following, as the apt-get list includes gcc-7 and g++-7:\n1. Install the list of dependencies that can be obtained with the `apt-get` command from the following section of the Dockerfile:", "author": "pshipton", "createdAt": "2020-04-30T14:18:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAzNjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEyOTU2Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418129562", "bodyText": "The section that was removed referred to gcc-4.8; the current requirement is for gcc-7.5. If you follow the steps listed in mkdocker.sh --print, you'll get gcc-7.5 and symbolic links are not required. I think this section should just stay removed.", "author": "keithc-ca", "createdAt": "2020-04-30T16:17:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAzNjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE0NzE4OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418147189", "bodyText": "What about this part? ENV CC=gcc-7 CXX=g++-7\nAre these exports required to use gcc 7 in the build in place of whatever else the user has installed?", "author": "pshipton", "createdAt": "2020-04-30T16:45:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAzNjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE1NDUwMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418154501", "bodyText": "As a test, on Ubuntu 20 I did apt install gcc which installed gcc 9. Followed by apt install gcc-7 but this doesn't replace the gcc 9 default you get when running gcc --version.", "author": "pshipton", "createdAt": "2020-04-30T16:58:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAzNjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE2ODQ2Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418168462", "bodyText": "If you use apt install g++-7 then those environment variables will select that version (independent of whether you have other versions installed).\nIf you use apt install g++ you get gcc-9 which worked last time I tried; those environment variables are not be needed in that case. On Ubuntu 18.04, you'll get version 7, so neither the symlinks nor the environment variables are necessary.", "author": "keithc-ca", "createdAt": "2020-04-30T17:21:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAzNjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE2ODc0NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418168745", "bodyText": "I've pushed a new commit.", "author": "pshipton", "createdAt": "2020-04-30T17:22:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAzNjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE3Njc5Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418176796", "bodyText": "I think it's better to tell the user to explicitly set the environment variables and use gcc 7. This is the compiler version we test and recommend. Otherwise we don't know what the use might have installed. Ub 16 installs gcc 5 by default which I don't think works.", "author": "pshipton", "createdAt": "2020-04-30T17:35:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAzNjQ2Nw=="}], "type": "inlineReview"}, {"oid": "e603ff168d004862ea3db674953a09527d951842", "url": "https://github.com/eclipse-openj9/openj9/commit/e603ff168d004862ea3db674953a09527d951842", "message": "Add --with-boot-jdk to Linux build instructions\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-30T14:13:36Z", "type": "forcePushed"}, {"oid": "3564ac24de37b10a97a0db023f520e9513634383", "url": "https://github.com/eclipse-openj9/openj9/commit/3564ac24de37b10a97a0db023f520e9513634383", "message": "Add --with-boot-jdk and other improvements to Linux build instructions\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-30T17:21:27Z", "type": "forcePushed"}, {"oid": "8f41d69505517119f4179aeb69f686e15564f9f2", "url": "https://github.com/eclipse-openj9/openj9/commit/8f41d69505517119f4179aeb69f686e15564f9f2", "message": "Add --with-boot-jdk and other improvements to Linux build instructions\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-30T17:23:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE5MzYxOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418193619", "bodyText": "This can be removed given we're recommending use of --with-boot-jdk.", "author": "keithc-ca", "createdAt": "2020-04-30T18:04:12Z", "path": "doc/build-instructions/Build_Instructions_V8.md", "diffHunk": "@@ -99,19 +99,36 @@ bash mkdocker.sh --tag=openj9 --dist=ubuntu --version=16.04 --print\n ```\n apt-get update \\\n  && apt-get install -qq -y --no-install-recommends \\\n-   autoconf \\\n-   ca-certificates \\\n    ...\n ```\n \n-2. Download and setup **freemarker.jar** into a directory. The example commands use `/root` to be consistent with the Docker instructions. If you aren't using Docker, you probably want to store the **freemarker.jar** in your home directory.\n+2. The previous step installed g++-7 and gcc-7 packages, which might be different\n+than the default version installed on your system. Export variables to set the \n+version used in the build.\n+```\n+export CC=gcc-7 CXX=g++-7\n+```\n+\n+3. Download and setup **freemarker.jar** into a directory. The example commands use `/root` to be consistent with the Docker instructions. If you aren't using Docker, you probably want to store the **freemarker.jar** in your home directory.\n ```\n cd /root\n wget https://sourceforge.net/projects/freemarker/files/freemarker/2.3.8/freemarker-2.3.8.tar.gz/download -O freemarker.tgz\n tar -xzf freemarker.tgz freemarker-2.3.8/lib/freemarker.jar --strip=2\n rm -f freemarker.tgz\n ```\n \n+4. Download and setup the boot JDK using the latest AdoptOpenJDK v8 build.\n+```\n+cd /<my_home_dir>\n+wget -O bootjdk8.tar.gz \"https://api.adoptopenjdk.net/v3/binary/latest/8/ga/linux/x64/jdk/openj9/normal/adoptopenjdk\"\n+tar -xzf bootjdk8.tar.gz\n+rm -f bootjdk8.tar.gz\n+mv $(ls | grep -i jdk) bootjdk8\n+\n+export JAVA_HOME=\"/<my_home_dir>/bootjdk8\"\n+export PATH=\"${JAVA_HOME}/bin:${PATH}\"", "originalCommit": "8f41d69505517119f4179aeb69f686e15564f9f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIxMTczMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418211732", "bodyText": "Pushed another update.", "author": "pshipton", "createdAt": "2020-04-30T18:37:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE5MzYxOQ=="}], "type": "inlineReview"}, {"oid": "af9bf125bc1ff0d134f1be052e1b08f7f79463f6", "url": "https://github.com/eclipse-openj9/openj9/commit/af9bf125bc1ff0d134f1be052e1b08f7f79463f6", "message": "Add --with-boot-jdk and other improvements to Linux build instructions\n\nAlso modify mkdocker.sh to stop installing jdk13 since the instructions\nno longer refer to this version.\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-30T18:35:48Z", "type": "commit"}, {"oid": "af9bf125bc1ff0d134f1be052e1b08f7f79463f6", "url": "https://github.com/eclipse-openj9/openj9/commit/af9bf125bc1ff0d134f1be052e1b08f7f79463f6", "message": "Add --with-boot-jdk and other improvements to Linux build instructions\n\nAlso modify mkdocker.sh to stop installing jdk13 since the instructions\nno longer refer to this version.\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-30T18:35:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI2ODMxNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418268316", "bodyText": "defaults.yml still says:\n  boot_jdk:\n    14: '/usr/lib/jvm/adoptojdk-java-13'\n\nSo I don't think it's yet time to remove jdk13 here.", "author": "keithc-ca", "createdAt": "2020-04-30T20:25:58Z", "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -569,7 +569,7 @@ bootjdk_url() {\n }\n \n install_bootjdks() {\n-  local versions=\"8 11 13 14\"\n+  local versions=\"8 11 14\"", "originalCommit": "af9bf125bc1ff0d134f1be052e1b08f7f79463f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI4MjYwOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418282608", "bodyText": "I'll open a PR to change it. Just because OpenJ9 builds still use 13 doesn't mean we can't tell users to use 14.", "author": "pshipton", "createdAt": "2020-04-30T20:53:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI2ODMxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI5OTQ4MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418299480", "bodyText": "As long as OpenJ9 builds (that could use the docker image) use 13, it should stay.\nI wasn't objecting to the other file that advises using 14.", "author": "keithc-ca", "createdAt": "2020-04-30T21:28:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI2ODMxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODMxMDg1Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/9409#discussion_r418310856", "bodyText": "I don't think there is any relation between defaults.yml and running in docker atm.\nCreated #9422", "author": "pshipton", "createdAt": "2020-04-30T21:54:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI2ODMxNg=="}], "type": "inlineReview"}, {"oid": "1d653c34d7aa901fd63fae359fd8827943c4b47b", "url": "https://github.com/eclipse-openj9/openj9/commit/1d653c34d7aa901fd63fae359fd8827943c4b47b", "message": "Add doc changes from #9371 to V11 and V14\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-30T22:29:04Z", "type": "forcePushed"}, {"oid": "7d037e4f8db05c3ac009da7ec01d036b69bf4919", "url": "https://github.com/eclipse-openj9/openj9/commit/7d037e4f8db05c3ac009da7ec01d036b69bf4919", "message": "Add doc changes from #9371 to V11 and V14\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-30T22:32:45Z", "type": "commit"}, {"oid": "7d037e4f8db05c3ac009da7ec01d036b69bf4919", "url": "https://github.com/eclipse-openj9/openj9/commit/7d037e4f8db05c3ac009da7ec01d036b69bf4919", "message": "Add doc changes from #9371 to V11 and V14\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-04-30T22:32:45Z", "type": "forcePushed"}]}