{"pr_number": 10364, "pr_title": "JDK15 : skip fillInStackTrace frames", "pr_createdAt": "2020-08-10T20:29:10Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10364", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwMjkwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10364#discussion_r469402909", "bodyText": "Rather than doing this, you could just preload NPE using the existing mechanism and fetch it via J9VMJAVALANGNULLPOINTEREXCEPITON_OR_NULL.", "author": "gacholio", "createdAt": "2020-08-12T16:54:05Z", "path": "runtime/jcl/common/jclcinit.c", "diffHunk": "@@ -773,6 +773,9 @@ initializeRequiredClasses(J9VMThread *vmThread, char* dllName)\n \t\treturn 1;\n \t}\n \tvmThread->outOfMemoryError = oom;\n+#if JAVA_SPEC_VERSION >= 15\n+\tvm->nullPointerExceptionClass = vmFuncs->internalFindKnownClass(vmThread, J9VMCONSTANTPOOL_JAVALANGNULLPOINTEREXCEPTION, J9_FINDKNOWNCLASS_FLAG_NON_FATAL);", "originalCommit": "045c3892c1aefc75138451fdd20e39ed512927fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQxMTYyMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10364#discussion_r469411622", "bodyText": "Sure, will switch to J9VMJAVALANGNULLPOINTEREXCEPTION_OR_NULL(vm) assuming NPE is one of the known classes initialized within initializeKnownClasses.", "author": "JasonFengJ9", "createdAt": "2020-08-12T17:08:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwMjkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQxMTc2Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10364#discussion_r469411762", "bodyText": "For java15, add NPE to the list of required classes that already exists.", "author": "gacholio", "createdAt": "2020-08-12T17:08:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwMjkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ2NDQ5NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10364#discussion_r469464495", "bodyText": "Updated the PR, it works with following simple testcases:\nnew NullPointerException().printStackTrace();\njava.lang.NullPointerException\n\tat a.se.next.TestNPEMsg.testAll(TestNPEMsg.java:8)\n\tat a.se.next.TestNPEMsg.main(TestNPEMsg.java:13)\n\nnew NullPointerException(\"JDK15 NPE\").printStackTrace();\njava.lang.NullPointerException: JDK15 NPE\n\tat a.se.next.TestNPEMsg.testAll(TestNPEMsg.java:9)\n\tat a.se.next.TestNPEMsg.main(TestNPEMsg.java:13)\n\nPlease have another look.", "author": "JasonFengJ9", "createdAt": "2020-08-12T18:40:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQwMjkwOQ=="}], "type": "inlineReview"}, {"oid": "be36da66fd39d44ac0559c9e1bef3c788f5b1eb0", "url": "https://github.com/eclipse-openj9/openj9/commit/be36da66fd39d44ac0559c9e1bef3c788f5b1eb0", "message": "JDK15 skip fillInStackTrace frames\n\nSkip the INL & NullPointerException.fillInStackTrace() frames;\nAdd J9VMCONSTANTPOOL_JAVALANGNULLPOINTEREXCEPTION to requiredClasses\nlist.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-08-12T18:36:01Z", "type": "commit"}, {"oid": "be36da66fd39d44ac0559c9e1bef3c788f5b1eb0", "url": "https://github.com/eclipse-openj9/openj9/commit/be36da66fd39d44ac0559c9e1bef3c788f5b1eb0", "message": "JDK15 skip fillInStackTrace frames\n\nSkip the INL & NullPointerException.fillInStackTrace() frames;\nAdd J9VMCONSTANTPOOL_JAVALANGNULLPOINTEREXCEPTION to requiredClasses\nlist.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-08-12T18:36:01Z", "type": "forcePushed"}]}