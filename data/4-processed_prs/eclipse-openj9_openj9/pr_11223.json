{"pr_number": 11223, "pr_title": "Resolve issues when restoring with -Xjit", "pr_createdAt": "2020-11-18T17:54:01Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11223", "timeline": [{"oid": "35cca67baf4c225c28244dd0fd82350eecbd7388", "url": "https://github.com/eclipse-openj9/openj9/commit/35cca67baf4c225c28244dd0fd82350eecbd7388", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-11-18T19:32:52Z", "type": "forcePushed"}, {"oid": "7f9adc107ee5fa941f19894b11a14c4d1b10260f", "url": "https://github.com/eclipse-openj9/openj9/commit/7f9adc107ee5fa941f19894b11a14c4d1b10260f", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-11-18T19:35:49Z", "type": "forcePushed"}, {"oid": "ac27bdd850f85c6649163eb7d7327d1e39227295", "url": "https://github.com/eclipse-openj9/openj9/commit/ac27bdd850f85c6649163eb7d7327d1e39227295", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-11-18T19:40:26Z", "type": "forcePushed"}, {"oid": "303114f83ceed754059019960c9d7e8e88778f13", "url": "https://github.com/eclipse-openj9/openj9/commit/303114f83ceed754059019960c9d7e8e88778f13", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-11-25T19:04:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTEyMzc1NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11223#discussion_r531123754", "bodyText": "Can you add a comment describing to the code describing the purpose of this field?", "author": "DanHeidinga", "createdAt": "2020-11-26T16:06:57Z", "path": "runtime/oti/j9nonbuilder.h", "diffHunk": "@@ -5034,6 +5034,9 @@ typedef struct J9VMThread {\n #endif /* OMR_GC_COMPRESSED_POINTERS */\n #endif /* OMR_GC_CONCURRENT_SCAVENGER */\n \tUDATA safePointCount;\n+#if defined(J9VM_OPT_SNAPSHOTS)\n+\tUDATA *restoreThreadBP;", "originalCommit": "303114f83ceed754059019960c9d7e8e88778f13", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e2578ad54bfd93cf15e11cf51e29bfbc2469da79", "url": "https://github.com/eclipse-openj9/openj9/commit/e2578ad54bfd93cf15e11cf51e29bfbc2469da79", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-11-27T16:05:09Z", "type": "commit"}, {"oid": "e2578ad54bfd93cf15e11cf51e29bfbc2469da79", "url": "https://github.com/eclipse-openj9/openj9/commit/e2578ad54bfd93cf15e11cf51e29bfbc2469da79", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-11-27T16:05:09Z", "type": "forcePushed"}]}