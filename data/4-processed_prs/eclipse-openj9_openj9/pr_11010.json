{"pr_number": 11010, "pr_title": "Call correct API in the snapshot mode to get gpuCode", "pr_createdAt": "2020-10-27T16:22:56Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11010", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg1NTk5Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11010#discussion_r512855997", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #if defined(J9VM_OPT_SNAPSHOTS)\n          \n          \n            \n                  return J9JIT_DATACACHE_OFFSET_TO_PTR(metaData->gpuCodeOffset, GpuMetaData);\n          \n          \n            \n            #else /* defined(J9VM_OPT_SNAPSHOT) */\n          \n          \n            \n                  return (GpuMetaData*)metaData->gpuCode;\n          \n          \n            \n            #endif\n          \n          \n            \n                  return (GpuMetaData*)J9JITEXCEPTIONTABLE_GPUCODE_GET(metaData);", "author": "ymanton", "createdAt": "2020-10-27T16:45:51Z", "path": "runtime/compiler/runtime/GPUHelpers.cpp", "diffHunk": "@@ -1097,7 +1097,11 @@ static GpuMetaData* getGPUMetaData(uint8_t* startPC)\n    {\n       J9VMThread *vmThread = jitConfig->javaVM->internalVMFunctions->currentVMThread(jitConfig->javaVM);\n       TR_MethodMetaData * metaData = jitConfig->jitGetExceptionTableFromPC(vmThread, (UDATA)startPC);\n+#if defined(J9VM_OPT_SNAPSHOTS)\n+      return J9JIT_DATACACHE_OFFSET_TO_PTR(metaData->gpuCodeOffset, GpuMetaData);\n+#else /* defined(J9VM_OPT_SNAPSHOT) */\n       return (GpuMetaData*)metaData->gpuCode;\n+#endif", "originalCommit": "9c44eed9f5b8ca00f0928f924fa08d1eca801a75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg2NTI5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11010#discussion_r512865293", "bodyText": "This is more cleaner, thanks a lot, made changes in https://github.com/eclipse/openj9/compare/9c44eed9f5b8ca00f0928f924fa08d1eca801a75..fd6b80febcdf82c159e03c19bf3a27ce611ee83b", "author": "r30shah", "createdAt": "2020-10-27T16:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg1NTk5Nw=="}], "type": "inlineReview"}, {"oid": "fd6b80febcdf82c159e03c19bf3a27ce611ee83b", "url": "https://github.com/eclipse-openj9/openj9/commit/fd6b80febcdf82c159e03c19bf3a27ce611ee83b", "message": "Call correct API in the snapshot mode to get gpuCode\n\nIn snapshot mode, we store the gpuCodeOffset in J9JITExceptionTable\ninstead of pointer to gpuCode. Use API to get the pointer from the given\noffset to get the gpuCode pointer.\n\nSigned-off-by: Rahil Shah <rahil@ca.ibm.com>", "committedDate": "2020-10-27T16:57:13Z", "type": "commit"}, {"oid": "fd6b80febcdf82c159e03c19bf3a27ce611ee83b", "url": "https://github.com/eclipse-openj9/openj9/commit/fd6b80febcdf82c159e03c19bf3a27ce611ee83b", "message": "Call correct API in the snapshot mode to get gpuCode\n\nIn snapshot mode, we store the gpuCodeOffset in J9JITExceptionTable\ninstead of pointer to gpuCode. Use API to get the pointer from the given\noffset to get the gpuCode pointer.\n\nSigned-off-by: Rahil Shah <rahil@ca.ibm.com>", "committedDate": "2020-10-27T16:57:13Z", "type": "forcePushed"}]}