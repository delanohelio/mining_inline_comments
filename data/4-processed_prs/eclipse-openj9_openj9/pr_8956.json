{"pr_number": 8956, "pr_title": "Fix opt index searches in nextGenHCR", "pr_createdAt": "2020-03-23T21:33:44Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8956", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEzNTcwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8956#discussion_r397135709", "bodyText": "should this just be the getOSRMode since getOption(TR_EnableOSR) and getOption(TR_DisableOSR are not inverses?", "author": "andrewcraik", "createdAt": "2020-03-24T13:05:07Z", "path": "runtime/compiler/optimizer/OSRGuardInsertion.cpp", "diffHunk": "@@ -202,6 +203,14 @@ static bool skipOSRGuardInsertion(TR::Compilation* comp)\n \n int32_t TR_OSRGuardInsertion::perform()\n    {\n+   if (!comp()->getOption(TR_EnableOSR) ||", "originalCommit": "f03c50c0f2e370818d2dfc185031c520ec4d04a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMzODE4OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8956#discussion_r397338188", "bodyText": "@andrewcraik getOSRMode is not enough, if we're not under FSD, it'll always return TR::voluntaryOSR. Changed it to use supportsInduceOSR\nTR::OSRMode\nOMR::Compilation::getOSRMode()\n   {\n   if (self()->getOption(TR_FullSpeedDebug))\n      return TR::involuntaryOSR;\n   return TR::voluntaryOSR;\n   }", "author": "liqunl", "createdAt": "2020-03-24T17:34:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEzNTcwOQ=="}], "type": "inlineReview"}, {"oid": "a60bc0e20e973af9eb7f944c20733f587f578f20", "url": "https://github.com/eclipse-openj9/openj9/commit/a60bc0e20e973af9eb7f944c20733f587f578f20", "message": "Fix opt index searches in nextGenHCR\n\nOpt index searches is broken in nextGenHCR because osrGuardInsertion\ndoes both optional optimizations and mandatory dummy helper clean up.\nThis commit will fix it by making osrGuardInsertion MustBeDone and move\nthe ifVoluntaryOSR check at the beginning of the optimization perform.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-03-24T17:33:16Z", "type": "commit"}, {"oid": "a60bc0e20e973af9eb7f944c20733f587f578f20", "url": "https://github.com/eclipse-openj9/openj9/commit/a60bc0e20e973af9eb7f944c20733f587f578f20", "message": "Fix opt index searches in nextGenHCR\n\nOpt index searches is broken in nextGenHCR because osrGuardInsertion\ndoes both optional optimizations and mandatory dummy helper clean up.\nThis commit will fix it by making osrGuardInsertion MustBeDone and move\nthe ifVoluntaryOSR check at the beginning of the optimization perform.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-03-24T17:33:16Z", "type": "forcePushed"}]}