{"pr_number": 8568, "pr_title": "Allow jobs to use lightweight checkout", "pr_createdAt": "2020-02-12T21:16:36Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8568", "timeline": [{"oid": "33434ff982860ee876d06a23abbd4e524bbfa02f", "url": "https://github.com/eclipse-openj9/openj9/commit/33434ff982860ee876d06a23abbd4e524bbfa02f", "message": "Allow jobs to use lightweight checkout\n\n- Extract most of the code from Pipeline-Build-Test-All.groovy\n  and Pipeline-Build-Test-Any-Platform.groovy into new files\n  PBTAll.groovy and PBTAny.groovy respectively.\n- This allows the jobs to be configured to use lightweight\n  checkout will will reduce the load on master.\n- The side effect is the remaining code in these files will\n  not be testable via PR builds.\n- The remainder of the pipeline code can still be pulled from\n  whatever repo/branch/ref is passed. Which will allow PR builds\n  to continue testing pipeline changes including defaults.yml.\n- This is a somewhat quick and dirty test. We should revisit\n  these changes and refactor as needed so we don't have so many\n  files.\n\n[skip ci]\nRelated #8252\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-12T21:18:05Z", "type": "forcePushed"}, {"oid": "671cf9d282e714deaeb091951f9be32b97582d39", "url": "https://github.com/eclipse-openj9/openj9/commit/671cf9d282e714deaeb091951f9be32b97582d39", "message": "Allow jobs to use lightweight checkout\n\n- Extract most of the code from Pipeline-Build-Test-All.groovy\n  and Pipeline-Build-Test-Any-Platform.groovy into new files\n  PBTAll.groovy and PBTAny.groovy respectively.\n- This allows the jobs to be configured to use lightweight\n  checkout will will reduce the load on master.\n- The side effect is the remaining code in these files will\n  not be testable via PR builds.\n- The remainder of the pipeline code can still be pulled from\n  whatever repo/branch/ref is passed. Which will allow PR builds\n  to continue testing pipeline changes including defaults.yml.\n- This is a somewhat quick and dirty test. We should revisit\n  these changes and refactor as needed so we don't have so many\n  files.\n\n[skip ci]\nRelated #8252\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-13T06:15:24Z", "type": "forcePushed"}, {"oid": "6ef0e8954ac83ff242e8ca953bb1b80e6ed4c7cb", "url": "https://github.com/eclipse-openj9/openj9/commit/6ef0e8954ac83ff242e8ca953bb1b80e6ed4c7cb", "message": "[skip ci] debug\n\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-13T06:25:23Z", "type": "forcePushed"}, {"oid": "a1b1ee19c9f13d1d2e2070d5d11d313421397195", "url": "https://github.com/eclipse-openj9/openj9/commit/a1b1ee19c9f13d1d2e2070d5d11d313421397195", "message": "[skip ci] debug\n\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-13T06:31:16Z", "type": "forcePushed"}, {"oid": "ac0e4924b1e9757b914c0320c35f5e52baee78c3", "url": "https://github.com/eclipse-openj9/openj9/commit/ac0e4924b1e9757b914c0320c35f5e52baee78c3", "message": "[skip ci] debug\n\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-13T06:48:34Z", "type": "forcePushed"}, {"oid": "70f7674dacdfc4a5dfe31398e2daaa04fad25dbd", "url": "https://github.com/eclipse-openj9/openj9/commit/70f7674dacdfc4a5dfe31398e2daaa04fad25dbd", "message": "Allow jobs to use lightweight checkout\n\n- Extract most of the code from Pipeline-Build-Test-Any-Platform.groovy\n  and Build-Any-Platform.groovy into new file Pipeline-Initialize.groovy.\n- Move remaining functionality into pipeline-functions.groovy,\n  variables-functions.groovy and build.groovy\n- This allows the jobs to be configured to use lightweight\n  checkout will will reduce the load on master.\n- The side effect is the remaining code in Pipeline-Initialize.groovy\n  will not be testable via PR builds.\n- The remainder of the pipeline code can still be pulled from\n  any passed repo/branch/ref. Which will allow PR builds\n  to continue testing pipeline changes including defaults.yml.\n\n[skip ci]\nRelated #8252\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-13T21:36:08Z", "type": "forcePushed"}, {"oid": "4f60c099bf28e9d25bd9a5e5a6d3dac084a5f554", "url": "https://github.com/eclipse-openj9/openj9/commit/4f60c099bf28e9d25bd9a5e5a6d3dac084a5f554", "message": "Allow jobs to use lightweight checkout\n\n- Extract most of the code from Pipeline-Build-Test-Any-Platform.groovy\n  and Build-Any-Platform.groovy into new file Pipeline-Initialize.groovy.\n- Move remaining functionality into pipeline-functions.groovy,\n  variables-functions.groovy and build.groovy\n- This allows the jobs to be configured to use lightweight\n  checkout will will reduce the load on master.\n- The side effect is the remaining code in Pipeline-Initialize.groovy\n  will not be testable via PR builds.\n- The remainder of the pipeline code can still be pulled from\n  any passed repo/branch/ref. Which will allow PR builds\n  to continue testing pipeline changes including defaults.yml.\n\n[skip ci]\nRelated #8252\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-13T21:39:52Z", "type": "forcePushed"}, {"oid": "d9ee57aa74c1fd06db30d38bc49f0d467d2f1d5f", "url": "https://github.com/eclipse-openj9/openj9/commit/d9ee57aa74c1fd06db30d38bc49f0d467d2f1d5f", "message": "Allow jobs to use lightweight checkout\n\n- Extract most of the code from Pipeline-Build-Test-Any-Platform.groovy\n  and Build-Any-Platform.groovy into new file Pipeline-Initialize.groovy.\n- Move remaining functionality into pipeline-functions.groovy,\n  variables-functions.groovy and build.groovy\n- This allows the jobs to be configured to use lightweight\n  checkout will will reduce the load on master.\n- The side effect is the remaining code in Pipeline-Initialize.groovy\n  will not be testable via PR builds.\n- The remainder of the pipeline code can still be pulled from\n  any passed repo/branch/ref. Which will allow PR builds\n  to continue testing pipeline changes including defaults.yml.\n\n[skip ci]\nRelated #8252\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-13T22:15:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQxNzU4Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8568#discussion_r381417582", "bodyText": "Hard-coded personal fork, please remove (set in Job template)", "author": "vsebe", "createdAt": "2020-02-19T17:10:12Z", "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -1261,6 +1283,8 @@ def create_job(JOB_NAME, SDK_VERSION, SPEC, downstreamJobType, id){\n     params.put('VENDOR_CREDENTIALS_ID_DEFAULT', VENDOR_CREDENTIALS_ID_DEFAULT)\n     params.put('jobType', downstreamJobType)\n     params.put('DISCARDER_NUM_BUILDS', DISCARDER_NUM_BUILDS)\n+    params.put('SCM_REPO', 'https://github.com/Adambrousseau/openj9.git')", "originalCommit": "068aeb36ac5f0233bfc413b9e2ad421c961a32b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NTg3Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8568#discussion_r381475872", "bodyText": "As per my previous comment. Will remove once testing is done.", "author": "AdamBrousseau", "createdAt": "2020-02-19T18:53:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQxNzU4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQxOTI2NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8568#discussion_r381419264", "bodyText": "pipeline-functions.groovy is loaded twice: here as buildFile and at L203: pipelineFunctions = load 'buildenv/jenkins/common/pipeline-functions.groovy'\nCould use: buildFile = pipelineFunctions", "author": "vsebe", "createdAt": "2020-02-19T17:12:48Z", "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -771,6 +771,27 @@ def add_pr_to_description() {\n     }\n }\n \n+def setup() {\n+    set_job_variables(params.JOB_TYPE)\n+\n+    switch (params.JOB_TYPE) {\n+        case \"pipeline\":\n+            buildFile = load 'buildenv/jenkins/common/pipeline-functions.groovy'", "originalCommit": "068aeb36ac5f0233bfc413b9e2ad421c961a32b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NTY3MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8568#discussion_r381475670", "bodyText": "Changed", "author": "AdamBrousseau", "createdAt": "2020-02-19T18:52:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQxOTI2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQyNzU5Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/8568#discussion_r381427596", "bodyText": "This script loads pipeline-functions.groovy multiple times:\nvariables-functions.groovy loads pipeline-functions.groovy (twice: see L203, L779)\nbuild.groovy also loads pipeline-functions.groovy.\nSome reformatting might be required in order to load the file only once. Could be done in a different PR.", "author": "vsebe", "createdAt": "2020-02-19T17:26:48Z", "path": "buildenv/jenkins/jobs/pipelines/Pipeline-Initialize.groovy", "diffHunk": "@@ -57,18 +57,12 @@ timeout(time: 10, unit: 'HOURS') {\n                         userRemoteConfigs: [remoteConfigParameters]]\n \n                 variableFile = load 'buildenv/jenkins/common/variables-functions.groovy'", "originalCommit": "068aeb36ac5f0233bfc413b9e2ad421c961a32b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ2NDgwMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8568#discussion_r381464803", "bodyText": "Opened an issue for myself to revisit this later and added a TODO comment at the other load.", "author": "AdamBrousseau", "createdAt": "2020-02-19T18:33:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQyNzU5Ng=="}], "type": "inlineReview"}, {"oid": "fa57226daf6163618a3cff4988aa33c06ee1b2a4", "url": "https://github.com/eclipse-openj9/openj9/commit/fa57226daf6163618a3cff4988aa33c06ee1b2a4", "message": "Allow jobs to use lightweight checkout\n\n- Extract most of the code from Pipeline-Build-Test-Any-Platform.groovy\n  and Build-Any-Platform.groovy into new file Pipeline-Initialize.groovy.\n- Move remaining functionality into pipeline-functions.groovy,\n  variables-functions.groovy and build.groovy\n- This allows the jobs to be configured to use lightweight\n  checkout will will reduce the load on master.\n- The side effect is the remaining code in Pipeline-Initialize.groovy\n  will not be testable via PR builds.\n- The remainder of the pipeline code can still be pulled from\n  any passed repo/branch/ref. Which will allow PR builds\n  to continue testing pipeline changes including defaults.yml.\n\n[skip ci]\nRelated #8252\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-19T18:52:16Z", "type": "commit"}, {"oid": "2d1ff343cd2631350c8a093c0464e437d9ce8b9c", "url": "https://github.com/eclipse-openj9/openj9/commit/2d1ff343cd2631350c8a093c0464e437d9ce8b9c", "message": "[skip ci] TMEP: Use my own repo/branch\n\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-19T18:52:16Z", "type": "forcePushed"}, {"oid": "fa57226daf6163618a3cff4988aa33c06ee1b2a4", "url": "https://github.com/eclipse-openj9/openj9/commit/fa57226daf6163618a3cff4988aa33c06ee1b2a4", "message": "Allow jobs to use lightweight checkout\n\n- Extract most of the code from Pipeline-Build-Test-Any-Platform.groovy\n  and Build-Any-Platform.groovy into new file Pipeline-Initialize.groovy.\n- Move remaining functionality into pipeline-functions.groovy,\n  variables-functions.groovy and build.groovy\n- This allows the jobs to be configured to use lightweight\n  checkout will will reduce the load on master.\n- The side effect is the remaining code in Pipeline-Initialize.groovy\n  will not be testable via PR builds.\n- The remainder of the pipeline code can still be pulled from\n  any passed repo/branch/ref. Which will allow PR builds\n  to continue testing pipeline changes including defaults.yml.\n\n[skip ci]\nRelated #8252\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-02-19T18:52:16Z", "type": "forcePushed"}]}