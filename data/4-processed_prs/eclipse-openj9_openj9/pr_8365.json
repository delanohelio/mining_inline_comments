{"pr_number": 8365, "pr_title": "Print JITServer client UID in client JVM", "pr_createdAt": "2020-01-21T20:34:42Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8365", "timeline": [{"oid": "59725091e8ca3d53f780396a8fe77234424729d3", "url": "https://github.com/eclipse-openj9/openj9/commit/59725091e8ca3d53f780396a8fe77234424729d3", "message": "Print client UID in JITServer client verbose log\n\nAt the beginning of each new client JVM connected to JITServer, client JVM\nprints UID in verbose log with -Xjit:verbose={JITServer} specified\n\nSigned-off-by: Chris Chong <Zichun.Chong@mail.utoronto.ca>", "committedDate": "2020-01-21T20:40:19Z", "type": "forcePushed"}, {"oid": "43cecb9ce2a477186360d6d0dc9edf4ecce41e19", "url": "https://github.com/eclipse-openj9/openj9/commit/43cecb9ce2a477186360d6d0dc9edf4ecce41e19", "message": "Minor fix for previous client UID in verbose log commit\n\nAdding a bracket to ensure only client prints client UID in verbose log\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-01-23T22:05:49Z", "type": "forcePushed"}, {"oid": "2d0c970512764c4bec0844129035058be8a99ec2", "url": "https://github.com/eclipse-openj9/openj9/commit/2d0c970512764c4bec0844129035058be8a99ec2", "message": "Minor fix for previous commits\n\nAdding a bracket to ensure only client prints client UID in verbose log\nFix javadump copyright date\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-01-24T13:14:42Z", "type": "forcePushed"}, {"oid": "10845220ec53c8569ffafa9e5fe7d00e61991722", "url": "https://github.com/eclipse-openj9/openj9/commit/10845220ec53c8569ffafa9e5fe7d00e61991722", "message": "Add client UID in JITServer compilation log\n\nif jitserver is enabled, client UID is printed in conmpilation log\nunder <compile> </compile> block\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-01-31T14:43:08Z", "type": "forcePushed"}, {"oid": "3afba0b22cdf60608751f77e2f074e607ba65ed9", "url": "https://github.com/eclipse-openj9/openj9/commit/3afba0b22cdf60608751f77e2f074e607ba65ed9", "message": "Print client UID in JITServer client verbose log\n\nAt the beginning of each new client JVM connected to JITServer, client JVM\nprints UID in verbose log with -Xjit:verbose={JITServer} specified\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-01-31T14:46:09Z", "type": "commit"}, {"oid": "2f58a336930d6380453869f81285ec6beeaa0dc2", "url": "https://github.com/eclipse-openj9/openj9/commit/2f58a336930d6380453869f81285ec6beeaa0dc2", "message": "Print JITServer client UID in javacore file\n\nIf the JITServer JVM crash, client JVM prints its UID in javacore file,\nline starting with \"1CICLIENTID\" in java core ENVINFO section.\nAdd clientUID and isClient in J9JITConfig struct that can be passed into javacore writter.\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-01-31T14:46:21Z", "type": "commit"}, {"oid": "11712899343bf6589597def6dd679669abb3f329", "url": "https://github.com/eclipse-openj9/openj9/commit/11712899343bf6589597def6dd679669abb3f329", "message": "Minor fix for previous commits\n\nAdding a bracket to ensure only client prints client UID in verbose log\nFix javadump copyright date\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-01-31T14:46:22Z", "type": "commit"}, {"oid": "ee2d0578ce980c1b35c019145aeeda5e47a63846", "url": "https://github.com/eclipse-openj9/openj9/commit/ee2d0578ce980c1b35c019145aeeda5e47a63846", "message": "Add client UID in JITServer compilation log\n\nif jitserver is enabled, client UID is printed in conmpilation log\nunder <compile> </compile> block\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-01-31T14:46:22Z", "type": "commit"}, {"oid": "ee2d0578ce980c1b35c019145aeeda5e47a63846", "url": "https://github.com/eclipse-openj9/openj9/commit/ee2d0578ce980c1b35c019145aeeda5e47a63846", "message": "Add client UID in JITServer compilation log\n\nif jitserver is enabled, client UID is printed in conmpilation log\nunder <compile> </compile> block\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-01-31T14:46:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5NDg3OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373594879", "bodyText": "Maybe add another test in front: if (_compiler->isOutOfProcessCompilation())", "author": "mpirvu", "createdAt": "2020-01-31T17:26:56Z", "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8787,13 +8787,20 @@ TR::CompilationInfoPerThreadBase::compile(\n                {\n                TR_ASSERT(_compiler.getHotnessName(_compiler.getMethodHotness()), \"expected to have a hotness string\");\n                if (_compiler.getOutFile() != NULL && _compiler.getOption(TR_TraceAll))\n-                  traceMsg(&_compiler, \"<compile\\n\"\n-                          \"\\tmethod=\\\"%s\\\"\\n\"\n-                          \"\\thotness=\\\"%s\\\"\\n\"\n-                          \"\\tisProfilingCompile=%d>\\n\",\n-                          _compiler.signature(),\n-                          _compiler.getHotnessName(_compiler.getMethodHotness()),\n-                          _compiler.isProfilingCompilation());\n+                  {\n+                  traceMsg(&_compiler, \"<compile\\n\");\n+                  traceMsg(&_compiler, \"\\tmethod=\\\"%s\\\"\\n\", _compiler.signature());\n+                  traceMsg(&_compiler, \"\\thotness=\\\"%s\\\"\\n\", _compiler.getHotnessName(_compiler.getMethodHotness()));\n+                  traceMsg(&_compiler, \"\\tisProfilingCompile=%d\", _compiler.isProfilingCompilation());\n+#if defined(JITSERVER_SUPPORT)\n+                  if (TR::compInfoPT->getClientData()) // not NULL", "originalCommit": "ee2d0578ce980c1b35c019145aeeda5e47a63846", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5NTI2MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373595261", "bodyText": "What is printed if we don't have TR_TraceAll but have another type of tracing (like traceCG)", "author": "mpirvu", "createdAt": "2020-01-31T17:27:51Z", "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8787,13 +8787,20 @@ TR::CompilationInfoPerThreadBase::compile(\n                {\n                TR_ASSERT(_compiler.getHotnessName(_compiler.getMethodHotness()), \"expected to have a hotness string\");\n                if (_compiler.getOutFile() != NULL && _compiler.getOption(TR_TraceAll))\n-                  traceMsg(&_compiler, \"<compile\\n\"\n-                          \"\\tmethod=\\\"%s\\\"\\n\"\n-                          \"\\thotness=\\\"%s\\\"\\n\"\n-                          \"\\tisProfilingCompile=%d>\\n\",\n-                          _compiler.signature(),\n-                          _compiler.getHotnessName(_compiler.getMethodHotness()),\n-                          _compiler.isProfilingCompilation());\n+                  {", "originalCommit": "ee2d0578ce980c1b35c019145aeeda5e47a63846", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxOTMzNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373619335", "bodyText": "Currently if we don't have -Xjit:'{*}(traceFull),log=log in option, client UID is still printed in compilation log.\nCompilation log from -Xjit:'{*}(traceCG),log=log option\n<compile\n        method=\"sun/reflect/Reflection.getCallerClass()Ljava/lang/Class;\"\n        hotness=\"cold\"\n        isProfilingCompile=0\n        clientID=7954624449399674535>\n</compile>\n\nIs that what we wanted? Or shall we only print client UID when traceFull is present?", "author": "chrisc66", "createdAt": "2020-01-31T18:25:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5NTI2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYyMzA3NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373623074", "bodyText": "Yes, we want the clientID even when traceFull is not specified.\nIs there an extra > after the UID?\nIt would help to give an example on how the output looks before your changes and after your changes", "author": "mpirvu", "createdAt": "2020-01-31T18:33:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5NTI2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYzNTU3Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373635577", "bodyText": "I think this > is part of the xml syntax\n<compile\n    XXX\n    XXX>\n</compile>\n\nHere is a comparison before & after change running the following command\n./java -XX:+UseJITServer -Xjit:'{*}(traceFull),log=log' -version\nBefore change\n<compile\n\tmethod=\"sun/reflect/Reflection.getCallerClass()Ljava/lang/Class;\"\n\thotness=\"cold\"\n\tisProfilingCompile=0>\n</compile>\n\nAfter change\n<compile\n        method=\"sun/reflect/Reflection.getCallerClass()Ljava/lang/Class;\"\n        hotness=\"cold\"\n        isProfilingCompile=0\n        clientID=9710225490534608421>\n</compile>", "author": "chrisc66", "createdAt": "2020-01-31T19:02:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5NTI2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY0MjEwMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373642102", "bodyText": "ok", "author": "mpirvu", "createdAt": "2020-01-31T19:17:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5NTI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5NjEwOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373596108", "bodyText": "Please eliminate isClient", "author": "mpirvu", "createdAt": "2020-01-31T17:29:56Z", "path": "runtime/oti/j9nonbuilder.h", "diffHunk": "@@ -3763,6 +3763,8 @@ typedef struct J9JITConfig {\n #if defined(JITSERVER_SUPPORT)\n \tint32_t (*startJITServer)(struct J9JITConfig *jitConfig);\n \tint32_t (*waitJITServerTermination)(struct J9JITConfig *jitConfig);\n+\tint32_t isClient;", "originalCommit": "ee2d0578ce980c1b35c019145aeeda5e47a63846", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5NzEyMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373597120", "bodyText": "We can eliminate jitConfig->isClient if we use the convention that a client can never have UID==0. Thus in here we need another check when generating the clientUID. If the random number generator returned 0, we have to call it again.\nThis also means that we need to initialize jitConfig->clientUID with 0 somewhere very early.", "author": "mpirvu", "createdAt": "2020-01-31T17:32:35Z", "path": "runtime/compiler/control/J9Options.cpp", "diffHunk": "@@ -1989,11 +1989,15 @@ J9::Options::fePreProcess(void * base)\n          std::random_device rd;\n          std::mt19937_64 rng(rd());\n          std::uniform_int_distribution<uint64_t> dist;\n-         compInfo->getPersistentInfo()->setClientUID(dist(rng));\n+         uint64_t clientUID = dist(rng);\n+         compInfo->getPersistentInfo()->setClientUID(clientUID);\n+         jitConfig->clientUID = clientUID;", "originalCommit": "ee2d0578ce980c1b35c019145aeeda5e47a63846", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5ODg0Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373598842", "bodyText": "Note that we could have JITSERVER_SUPPORT enabled and still be running as a regular JVM (when we don't specify options to run as a client or server)", "author": "mpirvu", "createdAt": "2020-01-31T17:36:44Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -1052,14 +1052,31 @@ JavaCoreDumpWriter::writeEnvironmentSection(void)\n \t/* Write the running mode data */\n \t_OutputStream.writeCharacters(\"1CIRUNNINGAS   Running as \");\n \n+\t/* If JITServer enabled, print running mode as JITServer and client UID*/\n+#ifdef JITSERVER_SUPPORT", "originalCommit": "ee2d0578ce980c1b35c019145aeeda5e47a63846", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY0MTU3Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373641573", "bodyText": "How should we use clientUID to differentiate each case? There are three conditions here:\n\nJITSERVER_SUPPORT enabled, running as server -> clientUID = 0\nJITSERVER_SUPPORT enabled, running as client -> clientUID = non-zero random number\nJITSERVER_SUPPORT enabled, running as regular JVM\n\nI propose to set clientUID to 1 as a flag of regular JVM. So 0 means jitserver, 1 means regular JVM, other means client.", "author": "chrisc66", "createdAt": "2020-01-31T19:16:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5ODg0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY0OTI2MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373649260", "bodyText": "if (vm->internalVMFunctions->isJITServerEnabled(vm))  will tell you if the JVM is a server. If it's not, then check jitConfig->clientUID. If 0, it's a regular JVM, othwerwise it's a client", "author": "mpirvu", "createdAt": "2020-01-31T19:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5ODg0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5OTM3NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373599375", "bodyText": "Here we could test if (0 != jitConfig->clientUID)", "author": "mpirvu", "createdAt": "2020-01-31T17:38:06Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -1052,14 +1052,31 @@ JavaCoreDumpWriter::writeEnvironmentSection(void)\n \t/* Write the running mode data */\n \t_OutputStream.writeCharacters(\"1CIRUNNINGAS   Running as \");\n \n+\t/* If JITServer enabled, print running mode as JITServer and client UID*/\n+#ifdef JITSERVER_SUPPORT\n+\tif (jitConfig->isClient == 1) {\n+\t\t_OutputStream.writeCharacters(\"a JITServer Client\");\n+\t} else {\n+\t\t_OutputStream.writeCharacters(\"a JITServer Server\");\n+\t}\n \t/* NB : I can't find any code for making this decision in the existing implementation */\n-#ifdef J9VM_BUILD_J2SE\n+#elif J9VM_BUILD_J2SE\n \t_OutputStream.writeCharacters(\"a standalone\");\n #else\n \t_OutputStream.writeCharacters(\"an embedded\");\n #endif\n \t_OutputStream.writeCharacters(\" JVM\\n\");\n \n+#ifdef JITSERVER_SUPPORT\n+\tif (jitConfig->isClient == 1) {", "originalCommit": "ee2d0578ce980c1b35c019145aeeda5e47a63846", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwMjg4Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373602887", "bodyText": "I looked at some other examples and this is how we write a 64-bit unsigned value:\n_OutputStream.writeInteger64(j9time_nano_time(), \"%llu\");", "author": "mpirvu", "createdAt": "2020-01-31T17:46:05Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -1052,14 +1052,31 @@ JavaCoreDumpWriter::writeEnvironmentSection(void)\n \t/* Write the running mode data */\n \t_OutputStream.writeCharacters(\"1CIRUNNINGAS   Running as \");\n \n+\t/* If JITServer enabled, print running mode as JITServer and client UID*/\n+#ifdef JITSERVER_SUPPORT\n+\tif (jitConfig->isClient == 1) {\n+\t\t_OutputStream.writeCharacters(\"a JITServer Client\");\n+\t} else {\n+\t\t_OutputStream.writeCharacters(\"a JITServer Server\");\n+\t}\n \t/* NB : I can't find any code for making this decision in the existing implementation */\n-#ifdef J9VM_BUILD_J2SE\n+#elif J9VM_BUILD_J2SE\n \t_OutputStream.writeCharacters(\"a standalone\");\n #else\n \t_OutputStream.writeCharacters(\"an embedded\");\n #endif\n \t_OutputStream.writeCharacters(\" JVM\\n\");\n \n+#ifdef JITSERVER_SUPPORT\n+\tif (jitConfig->isClient == 1) {\n+\t\tchar valueString[_MaximumGPValueLength]; \n+\t\tsprintf(valueString, \"%llu\", (unsigned long long) jitConfig->clientUID);", "originalCommit": "ee2d0578ce980c1b35c019145aeeda5e47a63846", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY4ODY2Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373688667", "bodyText": "If jitserver jvm is running in server mode, this section ensures client UID is non-zero and stores it to persistent info.\nUnder below else block, client UID is set to zero if running as server mode.", "author": "chrisc66", "createdAt": "2020-01-31T21:15:15Z", "path": "runtime/compiler/control/J9Options.cpp", "diffHunk": "@@ -1989,15 +1989,23 @@ J9::Options::fePreProcess(void * base)\n          std::random_device rd;\n          std::mt19937_64 rng(rd());\n          std::uniform_int_distribution<uint64_t> dist;\n+         // We want to generate a non-zero client UID for client mode", "originalCommit": "1aec2eaa764d8dba155932f180a6bd13a9a7c289", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5ODEzNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373698136", "bodyText": "We will need something similar for a JVM that has JITServer code compiled-in, but it's acting like a regular JVM (not server, not client)", "author": "mpirvu", "createdAt": "2020-01-31T21:41:03Z", "path": "runtime/compiler/control/J9Options.cpp", "diffHunk": "@@ -1989,11 +1989,23 @@ J9::Options::fePreProcess(void * base)\n          std::random_device rd;\n          std::mt19937_64 rng(rd());\n          std::uniform_int_distribution<uint64_t> dist;\n-         compInfo->getPersistentInfo()->setClientUID(dist(rng));\n+         // We want to generate a non-zero client UID for client mode\n+         uint64_t clientUID = dist(rng);\n+         while (0 == clientUID)\n+            clientUID = dist(rng);\n+         compInfo->getPersistentInfo()->setClientUID(clientUID);\n+         jitConfig->clientUID = clientUID;\n+\n          // _safeReservePhysicalMemoryValue is set as 0 for the JITClient because compilations\n          // are done remotely. The user can still override it with a command line option\n          J9::Options::_safeReservePhysicalMemoryValue = 0;\n          }\n+      else\n+         {\n+         // Client UID is zero in jitserver mode", "originalCommit": "1aec2eaa764d8dba155932f180a6bd13a9a7c289", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcxNzgzMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373717831", "bodyText": "Shall we set clientUID to 1 if running as a regular JVM? By doing that we will have server mode clientUID = 0, regular JVM clientUID = 1, client mode clientUID = others.", "author": "chrisc66", "createdAt": "2020-01-31T22:43:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5ODEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgwMjE2OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373802169", "bodyText": "Why not clientUIT==0 for regular JVM and for server. Some value just for client.", "author": "mpirvu", "createdAt": "2020-02-01T21:01:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5ODEzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5ODczMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373698731", "bodyText": "If you added curly brackets for the else part you need to add them for the if part as well. That's our coding convention.", "author": "mpirvu", "createdAt": "2020-01-31T21:42:59Z", "path": "runtime/compiler/control/J9Options.cpp", "diffHunk": "@@ -2075,9 +2087,13 @@ J9::Options::setupJITServerOptions()\n          TR_VerboseLog::writeLineLocked(TR_Vlog_JITServer, \"JITServer Server Mode. Port: %d. Connection Timeout %ums\",\n                persistentInfo->getJITServerPort(), persistentInfo->getSocketTimeout());\n       else if (persistentInfo->getRemoteCompilationMode() == JITServer::CLIENT)\n+         {", "originalCommit": "1aec2eaa764d8dba155932f180a6bd13a9a7c289", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5OTkwMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r373699901", "bodyText": "Note that the JVM could be built with JITSERVER_SUPPORT, but still used in regular JVM mode. Your code does not allow for that andf it will print \"Running as  JVM\"", "author": "mpirvu", "createdAt": "2020-01-31T21:46:33Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -1052,14 +1052,31 @@ JavaCoreDumpWriter::writeEnvironmentSection(void)\n \t/* Write the running mode data */\n \t_OutputStream.writeCharacters(\"1CIRUNNINGAS   Running as \");\n \n+\t/* If JITServer enabled, print running mode as JITServer and client UID*/\n+#ifdef JITSERVER_SUPPORT\n+\tif (_VirtualMachine->internalVMFunctions->isJITServerEnabled(_VirtualMachine))", "originalCommit": "1aec2eaa764d8dba155932f180a6bd13a9a7c289", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b1f25645fc6f087d2fd2dc919664a1eda82e03de", "url": "https://github.com/eclipse-openj9/openj9/commit/b1f25645fc6f087d2fd2dc919664a1eda82e03de", "message": "Add clientUID convension & remove jitConfig isClient data member\n\nJITServer client UID is generated as a non-zero random number\nJITServer JVM has a Client ID = 0\nThis convension eliminates isClient data member from jitConfig class\nA few changes for PR review\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-02-03T14:50:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE3MzkxMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374173911", "bodyText": "Does this print anything in your tests? I thought that _VirtualMachine->internalVMFunctions->isJITServerEnabled(_VirtualMachine) returns true only for the server?", "author": "mpirvu", "createdAt": "2020-02-03T15:39:15Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -1052,14 +1052,30 @@ JavaCoreDumpWriter::writeEnvironmentSection(void)\n \t/* Write the running mode data */\n \t_OutputStream.writeCharacters(\"1CIRUNNINGAS   Running as \");\n \n+\t/* If JITServer enabled, print running mode as JITServer and client UID*/\n+#ifdef JITSERVER_SUPPORT\n+\tif (_VirtualMachine->internalVMFunctions->isJITServerEnabled(_VirtualMachine)) // server\n+\t\t_OutputStream.writeCharacters(\"a JITServer Server\");\n+\telse if (0 == jitConfig->clientUID) // regular jvm\n+\t\t_OutputStream.writeCharacters(\"a standalone\");\n+\telse // client\n+\t\t_OutputStream.writeCharacters(\"a JITServer Client\");\n \t/* NB : I can't find any code for making this decision in the existing implementation */\n-#ifdef J9VM_BUILD_J2SE\n+#elif J9VM_BUILD_J2SE\n \t_OutputStream.writeCharacters(\"a standalone\");\n #else\n \t_OutputStream.writeCharacters(\"an embedded\");\n #endif\n \t_OutputStream.writeCharacters(\" JVM\\n\");\n \n+#ifdef JITSERVER_SUPPORT\n+\tif (_VirtualMachine->internalVMFunctions->isJITServerEnabled(_VirtualMachine) && 0 != jitConfig->clientUID) {", "originalCommit": "b1f25645fc6f087d2fd2dc919664a1eda82e03de", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4Mzg5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374183893", "bodyText": "The way the code is structured right now, you cannot have an embedded JVM if we ever compile JITServer code in (i.e. if JITSSERVER_SUPPORT is enabled.\nI am thinking that we don't want to run the client in the embedded mode, but only as a standalone JVM. Thus, maybe it's better to do:\n#ifdef J9VM_BUILD_J2SE\n#ifdef JITSERVER_SUPPORT\n...\n#else /* !JITSERVER_SUPPORT */\n\t_OutputStream.writeCharacters(\"a standalone\");\n#endif \n#else /* !J9VM_BUILD_J2SE */\n       _OutputStream.writeCharacters(\"an embedded\");\n#endif", "author": "mpirvu", "createdAt": "2020-02-03T15:55:23Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -1052,14 +1052,30 @@ JavaCoreDumpWriter::writeEnvironmentSection(void)\n \t/* Write the running mode data */\n \t_OutputStream.writeCharacters(\"1CIRUNNINGAS   Running as \");\n \n+\t/* If JITServer enabled, print running mode as JITServer and client UID*/\n+#ifdef JITSERVER_SUPPORT", "originalCommit": "b1f25645fc6f087d2fd2dc919664a1eda82e03de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMxMjAyNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374312025", "bodyText": "Thanks, this has been fixed. When both J9VM_BUILD_J2SE and JITSERVER_SUPPORT are defined, the program will print JITServer mode.", "author": "chrisc66", "createdAt": "2020-02-03T20:03:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4Mzg5Mw=="}], "type": "inlineReview"}, {"oid": "7c5e92da16e5c36209cdec559080273165bbcbf0", "url": "https://github.com/eclipse-openj9/openj9/commit/7c5e92da16e5c36209cdec559080273165bbcbf0", "message": "Add clientUID convension & remove jitConfig isClient data member\n\nJITServer client UID is generated as a non-zero random number\nJITServer JVM has a Client ID = 0\nThis convension eliminates isClient data member from jitConfig class\nA few changes for PR review\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-02-03T19:44:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNjU2Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374326567", "bodyText": "We really ought to be using PRIu64 from <inttypes.h> instead of llu in places like this.", "author": "keithc-ca", "createdAt": "2020-02-03T20:35:14Z", "path": "runtime/compiler/control/J9Options.cpp", "diffHunk": "@@ -2072,12 +2084,18 @@ J9::Options::setupJITServerOptions()\n       {\n       TR::PersistentInfo *persistentInfo = compInfo->getPersistentInfo();\n       if (persistentInfo->getRemoteCompilationMode() == JITServer::SERVER)\n+         {\n          TR_VerboseLog::writeLineLocked(TR_Vlog_JITServer, \"JITServer Server Mode. Port: %d. Connection Timeout %ums\",\n                persistentInfo->getJITServerPort(), persistentInfo->getSocketTimeout());\n+         }\n       else if (persistentInfo->getRemoteCompilationMode() == JITServer::CLIENT)\n+         {\n          TR_VerboseLog::writeLineLocked(TR_Vlog_JITServer, \"JITServer Client Mode. Server address: %s port: %d. Connection Timeout %ums\",\n                persistentInfo->getJITServerAddress().c_str(), persistentInfo->getJITServerPort(),\n                persistentInfo->getSocketTimeout());\n+         TR_VerboseLog::writeLineLocked(TR_Vlog_JITServer,\"Identifier for current client JVM: %llu\\n\", ", "originalCommit": "7c5e92da16e5c36209cdec559080273165bbcbf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNzMzOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374327339", "bodyText": "The type here should match how it's used (i.e. uint64_t).", "author": "keithc-ca", "createdAt": "2020-02-03T20:37:09Z", "path": "runtime/oti/j9nonbuilder.h", "diffHunk": "@@ -3763,6 +3763,7 @@ typedef struct J9JITConfig {\n #if defined(JITSERVER_SUPPORT)\n \tint32_t (*startJITServer)(struct J9JITConfig *jitConfig);\n \tint32_t (*waitJITServerTermination)(struct J9JITConfig *jitConfig);\n+\tint64_t clientUID;", "originalCommit": "7c5e92da16e5c36209cdec559080273165bbcbf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyODExNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374328117", "bodyText": "Please indent with a tab consistent with the rest of this file.", "author": "keithc-ca", "createdAt": "2020-02-03T20:38:50Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -1054,12 +1054,30 @@ JavaCoreDumpWriter::writeEnvironmentSection(void)\n \n \t/* NB : I can't find any code for making this decision in the existing implementation */\n #ifdef J9VM_BUILD_J2SE\n+\t/* If JITServer enabled, print running mode as JITServer and client UID*/\n+#ifdef JITSERVER_SUPPORT\n+\tif (_VirtualMachine->internalVMFunctions->isJITServerEnabled(_VirtualMachine))\n+\t\t_OutputStream.writeCharacters(\"a JITServer Server\");\n+\telse if (0 != jitConfig->clientUID)\n+\t\t_OutputStream.writeCharacters(\"a JITServer Client\");\n+\telse\n+\t\t_OutputStream.writeCharacters(\"a standalone\");\n+#else /* !JITSERVER_SUPPORT */\n \t_OutputStream.writeCharacters(\"a standalone\");\n-#else\n-\t_OutputStream.writeCharacters(\"an embedded\");\n+#endif \n+#else /* !J9VM_BUILD_J2SE */\n+    _OutputStream.writeCharacters(\"an embedded\");", "originalCommit": "7c5e92da16e5c36209cdec559080273165bbcbf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyODQwNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374328407", "bodyText": "Please use #if defined(JITSERVER_SUPPORT) instead of #ifdef.", "author": "keithc-ca", "createdAt": "2020-02-03T20:39:31Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -1054,12 +1054,30 @@ JavaCoreDumpWriter::writeEnvironmentSection(void)\n \n \t/* NB : I can't find any code for making this decision in the existing implementation */\n #ifdef J9VM_BUILD_J2SE\n+\t/* If JITServer enabled, print running mode as JITServer and client UID*/\n+#ifdef JITSERVER_SUPPORT\n+\tif (_VirtualMachine->internalVMFunctions->isJITServerEnabled(_VirtualMachine))\n+\t\t_OutputStream.writeCharacters(\"a JITServer Server\");\n+\telse if (0 != jitConfig->clientUID)\n+\t\t_OutputStream.writeCharacters(\"a JITServer Client\");\n+\telse\n+\t\t_OutputStream.writeCharacters(\"a standalone\");\n+#else /* !JITSERVER_SUPPORT */\n \t_OutputStream.writeCharacters(\"a standalone\");\n-#else\n-\t_OutputStream.writeCharacters(\"an embedded\");\n+#endif \n+#else /* !J9VM_BUILD_J2SE */\n+    _OutputStream.writeCharacters(\"an embedded\");\n #endif\n \t_OutputStream.writeCharacters(\" JVM\\n\");\n \n+#ifdef JITSERVER_SUPPORT", "originalCommit": "7c5e92da16e5c36209cdec559080273165bbcbf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyODY4NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374328684", "bodyText": "This should have a comment indicating the matching #if (i.e. /* JITSERVER_SUPPORT */).", "author": "keithc-ca", "createdAt": "2020-02-03T20:40:08Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -1054,12 +1054,30 @@ JavaCoreDumpWriter::writeEnvironmentSection(void)\n \n \t/* NB : I can't find any code for making this decision in the existing implementation */\n #ifdef J9VM_BUILD_J2SE\n+\t/* If JITServer enabled, print running mode as JITServer and client UID*/\n+#ifdef JITSERVER_SUPPORT\n+\tif (_VirtualMachine->internalVMFunctions->isJITServerEnabled(_VirtualMachine))\n+\t\t_OutputStream.writeCharacters(\"a JITServer Server\");\n+\telse if (0 != jitConfig->clientUID)\n+\t\t_OutputStream.writeCharacters(\"a JITServer Client\");\n+\telse\n+\t\t_OutputStream.writeCharacters(\"a standalone\");\n+#else /* !JITSERVER_SUPPORT */\n \t_OutputStream.writeCharacters(\"a standalone\");\n-#else\n-\t_OutputStream.writeCharacters(\"an embedded\");\n+#endif \n+#else /* !J9VM_BUILD_J2SE */\n+    _OutputStream.writeCharacters(\"an embedded\");\n #endif\n \t_OutputStream.writeCharacters(\" JVM\\n\");\n \n+#ifdef JITSERVER_SUPPORT\n+\tif (0 != jitConfig->clientUID) {\n+\t\t_OutputStream.writeCharacters(\"1CICLIENTID    Client UID \"); \n+\t\t_OutputStream.writeInteger64(jitConfig->clientUID, \"%llu\");\n+\t\t_OutputStream.writeCharacters(\"\\n\");\n+\t}\n+#endif", "originalCommit": "7c5e92da16e5c36209cdec559080273165bbcbf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "27873b761a5e5857ec4205cca78567088dc335ae", "url": "https://github.com/eclipse-openj9/openj9/commit/27873b761a5e5857ec4205cca78567088dc335ae", "message": "Add clientUID convension & remove jitConfig isClient data member\n\nJITServer client UID is generated as a non-zero random number\nJITServer JVM has a Client ID = 0\nThis convension eliminates isClient data member from jitConfig class\nA few changes for PR review\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-02-03T21:22:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM2Njg4OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374366889", "bodyText": "No, that's not how PRIu64 is intended to be used; the format string should be expressed as:\n  \"Identifier for current client JVM: %\" PRIu64 \"\\n\"\n\nPRIu64 might expand to \"llu\" yielding a (more portable expression) version of what you had before.\nTake note of the (required) spaces either side of PRIu64.\nThis pattern should be applied to all printf format strings you're adding or changing in this PR.", "author": "keithc-ca", "createdAt": "2020-02-03T22:03:10Z", "path": "runtime/compiler/control/J9Options.cpp", "diffHunk": "@@ -2072,12 +2084,18 @@ J9::Options::setupJITServerOptions()\n       {\n       TR::PersistentInfo *persistentInfo = compInfo->getPersistentInfo();\n       if (persistentInfo->getRemoteCompilationMode() == JITServer::SERVER)\n+         {\n          TR_VerboseLog::writeLineLocked(TR_Vlog_JITServer, \"JITServer Server Mode. Port: %d. Connection Timeout %ums\",\n                persistentInfo->getJITServerPort(), persistentInfo->getSocketTimeout());\n+         }\n       else if (persistentInfo->getRemoteCompilationMode() == JITServer::CLIENT)\n+         {\n          TR_VerboseLog::writeLineLocked(TR_Vlog_JITServer, \"JITServer Client Mode. Server address: %s port: %d. Connection Timeout %ums\",\n                persistentInfo->getJITServerAddress().c_str(), persistentInfo->getJITServerPort(),\n                persistentInfo->getSocketTimeout());\n+         TR_VerboseLog::writeLineLocked(TR_Vlog_JITServer,\"Identifier for current client JVM: %PRIu64\\n\", ", "originalCommit": "27873b761a5e5857ec4205cca78567088dc335ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM3MzYxNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374373614", "bodyText": "Ohh thanks. There are three llu in this PR, let me fix those.", "author": "chrisc66", "createdAt": "2020-02-03T22:18:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM2Njg4OQ=="}], "type": "inlineReview"}, {"oid": "3b7b8be688fe42afa0c8b444e475ab16cab6922f", "url": "https://github.com/eclipse-openj9/openj9/commit/3b7b8be688fe42afa0c8b444e475ab16cab6922f", "message": "Add clientUID convension & remove jitConfig isClient data member\n\nJITServer client UID is generated as a non-zero random number\nJITServer JVM has a Client ID = 0\nThis convension eliminates isClient data member from jitConfig class\nA few changes for PR review\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-02-03T22:43:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQxOTY0Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374419647", "bodyText": "Concatenating the empty string isn't helpful; the format string should be just \"\\tclientID=\" PRIu64 (likewise in javadump.cpp).", "author": "keithc-ca", "createdAt": "2020-02-04T00:36:45Z", "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8787,13 +8788,20 @@ TR::CompilationInfoPerThreadBase::compile(\n                {\n                TR_ASSERT(_compiler.getHotnessName(_compiler.getMethodHotness()), \"expected to have a hotness string\");\n                if (_compiler.getOutFile() != NULL && _compiler.getOption(TR_TraceAll))\n-                  traceMsg(&_compiler, \"<compile\\n\"\n-                          \"\\tmethod=\\\"%s\\\"\\n\"\n-                          \"\\thotness=\\\"%s\\\"\\n\"\n-                          \"\\tisProfilingCompile=%d>\\n\",\n-                          _compiler.signature(),\n-                          _compiler.getHotnessName(_compiler.getMethodHotness()),\n-                          _compiler.isProfilingCompilation());\n+                  {\n+                  traceMsg(&_compiler, \"<compile\\n\");\n+                  traceMsg(&_compiler, \"\\tmethod=\\\"%s\\\"\\n\", _compiler.signature());\n+                  traceMsg(&_compiler, \"\\thotness=\\\"%s\\\"\\n\", _compiler.getHotnessName(_compiler.getMethodHotness()));\n+                  traceMsg(&_compiler, \"\\tisProfilingCompile=%d\", _compiler.isProfilingCompilation());\n+#if defined(JITSERVER_SUPPORT)\n+                  if (_compiler.isOutOfProcessCompilation() && TR::compInfoPT->getClientData()) // using jitserver && client JVM\n+                     {\n+                     traceMsg(&_compiler, \"\\n\");\n+                     traceMsg(&_compiler, \"\\tclientID=\" PRIu64 \"\", TR::compInfoPT->getClientData()->getClientUID());", "originalCommit": "3b7b8be688fe42afa0c8b444e475ab16cab6922f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcyNjc4NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374726785", "bodyText": "I was confused by the usage of PRIu64 earlier. The intension of this piece of code is to print the value of clientUID instead of the string literal PRlu64 (unsigned long long).\nI tried \"\\tclientID=\" PRIu64 to write format string in CompilationThread.cpp\ntraceMsg(&_compiler, \"\\tclientID=\" PRIu64, TR::compInfoPT->getClientData()->getClientUID());\nand got below compilation trace\nclientID=lu\n\nHowever if I use \"\\tclientID=%\" PRIu64 \"\"\ntraceMsg(&_compiler, \"\\tclientID=%\" PRIu64 \"\", TR::compInfoPT->getClientData()->getClientUID());\ncompilation trace would be\nclientID=2145050389>", "author": "chrisc66", "createdAt": "2020-02-04T15:08:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQxOTY0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcyODEwMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374728103", "bodyText": "Similar in javadump.cpp, I am using the following line to generate javacore file\n_OutputStream.writeInteger64(jitConfig->clientUID, PRIu64);\nJavacore\n1CICLIENTID    Client UID lu\n\nIf I use the following\n_OutputStream.writeInteger64(jitConfig->clientUID, \"%\" PRIu64 \"\");\nJavacore\n1CICLIENTID    Client UID 3068314397", "author": "chrisc66", "createdAt": "2020-02-04T15:10:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQxOTY0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczMjM2OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374732369", "bodyText": "How about:\n_OutputStream.writeInteger64(jitConfig->clientUID, \"%\" PRIu64);", "author": "mpirvu", "createdAt": "2020-02-04T15:16:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQxOTY0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc1OTg4Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374759887", "bodyText": "Confirmed. Pushed the latest change into this PR.", "author": "chrisc66", "createdAt": "2020-02-04T15:57:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQxOTY0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgwMjMxMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374802311", "bodyText": "Sorry, I omitted the % in my suggestion: it should have been:\n\"\\tclientID=%\" PRIu64", "author": "keithc-ca", "createdAt": "2020-02-04T17:05:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQxOTY0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI5Nzk4MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r375297980", "bodyText": "@keithc-ca Thank you, this has been fixed in the latest change. Please take a look.", "author": "chrisc66", "createdAt": "2020-02-05T14:46:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQxOTY0Nw=="}], "type": "inlineReview"}, {"oid": "1bb5f94ac775707e124f1df09462de66c138f4d3", "url": "https://github.com/eclipse-openj9/openj9/commit/1bb5f94ac775707e124f1df09462de66c138f4d3", "message": "Add clientUID convension & remove jitConfig isClient data member\n\nJITServer client UID is generated as a non-zero random number\nJITServer JVM has a Client ID = 0\nThis convension eliminates isClient data member from jitConfig class\nA few changes for PR review\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-02-04T15:10:41Z", "type": "forcePushed"}, {"oid": "17c2d1996b7af3eccc92552ab44238255bd19b61", "url": "https://github.com/eclipse-openj9/openj9/commit/17c2d1996b7af3eccc92552ab44238255bd19b61", "message": "Add clientUID convension & remove jitConfig isClient data member\n\nJITServer client UID is generated as a non-zero random number\nJITServer JVM has a Client ID = 0\nThis convension eliminates isClient data member from jitConfig class\nA few changes for PR review\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-02-04T15:57:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc3MzEwNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374773106", "bodyText": "This line has the same issue: extra \"\" which can be removed", "author": "mpirvu", "createdAt": "2020-02-04T16:18:24Z", "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8787,13 +8788,20 @@ TR::CompilationInfoPerThreadBase::compile(\n                {\n                TR_ASSERT(_compiler.getHotnessName(_compiler.getMethodHotness()), \"expected to have a hotness string\");\n                if (_compiler.getOutFile() != NULL && _compiler.getOption(TR_TraceAll))\n-                  traceMsg(&_compiler, \"<compile\\n\"\n-                          \"\\tmethod=\\\"%s\\\"\\n\"\n-                          \"\\thotness=\\\"%s\\\"\\n\"\n-                          \"\\tisProfilingCompile=%d>\\n\",\n-                          _compiler.signature(),\n-                          _compiler.getHotnessName(_compiler.getMethodHotness()),\n-                          _compiler.isProfilingCompilation());\n+                  {\n+                  traceMsg(&_compiler, \"<compile\\n\");\n+                  traceMsg(&_compiler, \"\\tmethod=\\\"%s\\\"\\n\", _compiler.signature());\n+                  traceMsg(&_compiler, \"\\thotness=\\\"%s\\\"\\n\", _compiler.getHotnessName(_compiler.getMethodHotness()));\n+                  traceMsg(&_compiler, \"\\tisProfilingCompile=%d\", _compiler.isProfilingCompilation());\n+#if defined(JITSERVER_SUPPORT)\n+                  if (_compiler.isOutOfProcessCompilation() && TR::compInfoPT->getClientData()) // using jitserver && client JVM\n+                     {\n+                     traceMsg(&_compiler, \"\\n\");\n+                     traceMsg(&_compiler, \"\\tclientID=%\" PRIu64 \"\", TR::compInfoPT->getClientData()->getClientUID());", "originalCommit": "17c2d1996b7af3eccc92552ab44238255bd19b61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc4NzEzNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8365#discussion_r374787134", "bodyText": "Thanks, I also edited this.", "author": "chrisc66", "createdAt": "2020-02-04T16:40:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc3MzEwNg=="}], "type": "inlineReview"}, {"oid": "3b8e7f87ab6ffd45ee959dbd83a784c7183ecb37", "url": "https://github.com/eclipse-openj9/openj9/commit/3b8e7f87ab6ffd45ee959dbd83a784c7183ecb37", "message": "Add clientUID convension & remove jitConfig isClient data member\n\nJITServer client UID is generated as a non-zero random number\nJITServer JVM has a Client ID = 0\nThis convension eliminates isClient data member from jitConfig class\nA few changes for PR review\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-02-04T16:39:07Z", "type": "commit"}, {"oid": "3b8e7f87ab6ffd45ee959dbd83a784c7183ecb37", "url": "https://github.com/eclipse-openj9/openj9/commit/3b8e7f87ab6ffd45ee959dbd83a784c7183ecb37", "message": "Add clientUID convension & remove jitConfig isClient data member\n\nJITServer client UID is generated as a non-zero random number\nJITServer JVM has a Client ID = 0\nThis convension eliminates isClient data member from jitConfig class\nA few changes for PR review\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-02-04T16:39:07Z", "type": "forcePushed"}, {"oid": "f0a6e6d01c5c619d121a83e02aa5d957f3c62923", "url": "https://github.com/eclipse-openj9/openj9/commit/f0a6e6d01c5c619d121a83e02aa5d957f3c62923", "message": "Eliminate the use of PRIu64\n\nUse \" OMR_PRIu64\" defined in \"omrformatconsts.h\" instead of \"PRIu64\" defined in \"inttypes.h\"\nThis eliminates build failues on multiple platforms\nAdd protect \"#include omrformatconsts.h\" with ifdef statement since it is used by JITServer code only\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>", "committedDate": "2020-02-05T18:48:39Z", "type": "commit"}]}