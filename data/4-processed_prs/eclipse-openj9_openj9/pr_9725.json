{"pr_number": 9725, "pr_title": "PrintFlagsFinal output needs to be on stdout", "pr_createdAt": "2020-05-28T14:29:17Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9725", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg4NjgyMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9725#discussion_r431886821", "bodyText": "Can you add a comment here in the code explaining why this option is different and prints to stdout when everything else goes to stderr?\nI have reservations about making this change as it contradicts all of our existing options direction.", "author": "DanHeidinga", "createdAt": "2020-05-28T14:37:02Z", "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -6368,19 +6368,19 @@ protectedInitializeJavaVM(J9PortLibrary* portLibrary, void * userData)\n \t\t\t * as \"size_t\" type.\n \t\t\t */\n \n-\t\t\tj9tty_printf(PORTLIB, \"[Global flags]\\n\");\n+\t\t\tj9file_printf(PORTLIB, J9PORT_TTY_OUT, \"[Global flags]\\n\");", "originalCommit": "c0be7529151094ec69ded53c82962361329a8f9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg5MzE4MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9725#discussion_r431893181", "bodyText": "There isn't really an alternative if we want to support PrintFlagsFinal: the output has been produced by Hotspot for many years on stdout and is expected on stdout.\nelasticsearch specifically does not see it if it's produced on stderr.", "author": "mstoodle", "createdAt": "2020-05-28T14:44:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg4NjgyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg5MzkxOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9725#discussion_r431893919", "bodyText": "I've added a new line to the main comment that introduces the output that's desired.", "author": "mstoodle", "createdAt": "2020-05-28T14:45:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg4NjgyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg5Njg3Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/9725#discussion_r431896876", "bodyText": "Understood.  I dislike adding the inconsistency in our output strategy as it means understanding and explaining when it's OK to send to stdout rather than stderr.  The comment you've added helps to clarify that.", "author": "DanHeidinga", "createdAt": "2020-05-28T14:48:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg4NjgyMQ=="}], "type": "inlineReview"}, {"oid": "44255e37137977cedccec21346dc122a27ee0c5a", "url": "https://github.com/eclipse-openj9/openj9/commit/44255e37137977cedccec21346dc122a27ee0c5a", "message": "PrintFlagsFinal output needs to be on stdout\n\nCurrent support uses j9tty_printf which outputs to stderr, but\nHotspot outputs on stdout and elasticsearch (for which\nPrintFlagsFinal support was added) depends on it being there.\n\nSigned-off-by: Mark Stoodley <mstoodle@ca.ibm.com>", "committedDate": "2020-05-28T14:41:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg5NDMwOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9725#discussion_r431894308", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t * NOTE that Hotspot produces this output on STDOUT, which means this\n          \n          \n            \n            \t\t\t * NOTE that Hotspot produces this output on STDOUT, and applications expect to parse it there,\n          \n          \n            \n            \t\t\t * which means this ....", "author": "DanHeidinga", "createdAt": "2020-05-28T14:45:34Z", "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -6366,21 +6366,25 @@ protectedInitializeJavaVM(J9PortLibrary* portLibrary, void * userData)\n \t\t\t *\n \t\t\t * OpenJ9 stores both of these values as UDATA, so they will both be printed\n \t\t\t * as \"size_t\" type.\n+\t\t\t *\n+\t\t\t * NOTE that Hotspot produces this output on STDOUT, which means this", "originalCommit": "44255e37137977cedccec21346dc122a27ee0c5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg5NTUzMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9725#discussion_r431895531", "bodyText": "In my mind, the more important part is that apps expect it to be output to stdout for parsing.  Does Hotspot produce all their output to stdout?  That wouldn't be sufficient to move everything from stderr -> stdout :)", "author": "DanHeidinga", "createdAt": "2020-05-28T14:47:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg5NDMwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkwMzc5OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9725#discussion_r431903798", "bodyText": "Thanks Mark.  I agree it doesn't make sense to take the principled stand here.\nSorry to make another request, but can you reflow the comment so the lines are consistent lengths?  I was lazy in how I posted the suggested change and used .... (which should be removed) rather than reflowing the full comment.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t *\n          \n          \n            \n            \t\t\t * NOTE that Hotspot produces this output on STDOUT, and applications expect to parse it there,\n          \n          \n            \n            \t\t\t * which means this ....\n          \n          \n            \n            \t\t\t * code does not use j9tty_printf like most of the VM (which prints to\n          \n          \n            \n            \t\t\t * STDERR). Instead, j9file_printf(PORTLIB, J9PORT_TTY_OUT, ...) is used.\n          \n          \n            \n            \t\t\t *\n          \n          \n            \n            \t\t\t * NOTE that Hotspot produces this output on STDOUT, and applications\n          \n          \n            \n            \t\t\t * expect to parse it there, which means this code does not use j9tty_printf\n          \n          \n            \n            \t\t\t * like most of the VM (which prints to STDERR). Instead, \n          \n          \n            \n            \t\t\t * j9file_printf(PORTLIB, J9PORT_TTY_OUT, ...) is used.", "author": "DanHeidinga", "createdAt": "2020-05-28T14:57:32Z", "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -6366,21 +6366,26 @@ protectedInitializeJavaVM(J9PortLibrary* portLibrary, void * userData)\n \t\t\t *\n \t\t\t * OpenJ9 stores both of these values as UDATA, so they will both be printed\n \t\t\t * as \"size_t\" type.\n+\t\t\t *\n+\t\t\t * NOTE that Hotspot produces this output on STDOUT, and applications expect to parse it there,\n+\t\t\t * which means this ....\n+\t\t\t * code does not use j9tty_printf like most of the VM (which prints to\n+\t\t\t * STDERR). Instead, j9file_printf(PORTLIB, J9PORT_TTY_OUT, ...) is used.", "originalCommit": "f5a3a06d20a99c005393a318152c538b20fb916c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkxMDQxNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9725#discussion_r431910417", "bodyText": "I'll fix it and then squash. Thanks for the suggestion; sorry for not paying close enough attention to your suggested change.", "author": "mstoodle", "createdAt": "2020-05-28T15:06:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkwMzc5OA=="}], "type": "inlineReview"}, {"oid": "e72929555f0ee874c0a8edc65718fcc2da459f92", "url": "https://github.com/eclipse-openj9/openj9/commit/e72929555f0ee874c0a8edc65718fcc2da459f92", "message": "PrintFlagsFinal output needs to be on stdout\n\nCurrent support uses j9tty_printf which outputs to stderr, but\nHotspot outputs on stdout and elasticsearch (for which\nPrintFlagsFinal support was added) depends on it being there.\n\nSigned-off-by: Mark Stoodley <mstoodle@ca.ibm.com>", "committedDate": "2020-05-28T15:04:17Z", "type": "forcePushed"}, {"oid": "2ef2ec24225a74eef9a31bfb1ce1147412fc4e06", "url": "https://github.com/eclipse-openj9/openj9/commit/2ef2ec24225a74eef9a31bfb1ce1147412fc4e06", "message": "PrintFlagsFinal output needs to be on stdout\n\nCurrent support uses j9tty_printf which outputs to stderr, but\nHotspot outputs on stdout and elasticsearch (for which\nPrintFlagsFinal support was added) depends on it being there.\n\nFixes: #7764\n\nSigned-off-by: Mark Stoodley <mstoodle@ca.ibm.com>", "committedDate": "2020-05-28T15:04:45Z", "type": "forcePushed"}, {"oid": "6a33c82664bdc5c0ac8860c85ab8fdcf18bee1ec", "url": "https://github.com/eclipse-openj9/openj9/commit/6a33c82664bdc5c0ac8860c85ab8fdcf18bee1ec", "message": "PrintFlagsFinal output needs to be on stdout\n\nCurrent support uses j9tty_printf which outputs to stderr, but\nHotspot outputs on stdout and elasticsearch (for which\nPrintFlagsFinal support was added) depends on it being there.\n\nFixes: #7764\n\nSigned-off-by: Mark Stoodley <mstoodle@ca.ibm.com>", "committedDate": "2020-05-28T18:32:31Z", "type": "commit"}, {"oid": "6a33c82664bdc5c0ac8860c85ab8fdcf18bee1ec", "url": "https://github.com/eclipse-openj9/openj9/commit/6a33c82664bdc5c0ac8860c85ab8fdcf18bee1ec", "message": "PrintFlagsFinal output needs to be on stdout\n\nCurrent support uses j9tty_printf which outputs to stderr, but\nHotspot outputs on stdout and elasticsearch (for which\nPrintFlagsFinal support was added) depends on it being there.\n\nFixes: #7764\n\nSigned-off-by: Mark Stoodley <mstoodle@ca.ibm.com>", "committedDate": "2020-05-28T18:32:31Z", "type": "forcePushed"}]}