{"pr_number": 9530, "pr_title": "Implement basic support for POWER10 in the compiler", "pr_createdAt": "2020-05-12T15:42:14Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9530", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTExNTc5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9530#discussion_r431115793", "bodyText": "older version of OpenJ9 cannot recognize P10 such that it is only an Unknown processor (i.e. DefaultProcessor). This code on P10Processor never kicks in anyway such that It is unnecessary.", "author": "zl-wang", "createdAt": "2020-05-27T13:13:52Z", "path": "runtime/compiler/env/ProcessorDetection.cpp", "diffHunk": "@@ -269,6 +269,20 @@ TR_Processor mapJ9Processor(J9ProcessorArchitecture j9processor)\n       case PROCESSOR_PPC_P9:\n          tp = TR_PPCp9;\n          break;\n+      case PROCESSOR_PPC_P10:\n+         // P10 support is not yet well-tested, so it's currently gated behind an environment\n+         // variable to prevent it from being used by accident by users who use old versions of\n+         // OpenJ9 once P10 chips become available.\n+         if (jitConfig)\n+            {\n+            static bool enableP10 = feGetEnv(\"TR_EnableExperimentalPower10Support\");\n+            tp = enableP10 ? TR_PPCp10 : TR_PPCp9;", "originalCommit": "3df7c5c4ffc50de9051f6e04a6d83609cd65c816", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEyMzgzMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9530#discussion_r431123832", "bodyText": "Sorry, I should clarify: by \"older versions\", I'm referring to versions that will be released between when this PR is merged and when the P10 support is fully tested and verified. If a user were to try and use one of those builds on a newer machine with a POWER10 chip, OpenJ9 would recognize it and enable the new features, despite them having not yet undergone testing.", "author": "aviansie-ben", "createdAt": "2020-05-27T13:20:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTExNTc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEyNDg3Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9530#discussion_r431124877", "bodyText": "providing a testing knob might make more senses, before it is enabled by default.", "author": "zl-wang", "createdAt": "2020-05-27T13:21:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTExNTc5Mw=="}], "type": "inlineReview"}, {"oid": "6a8557b5dd940d3d10e630d064cd9a64ba87a4af", "url": "https://github.com/eclipse-openj9/openj9/commit/6a8557b5dd940d3d10e630d064cd9a64ba87a4af", "message": "Add code to recognize POWER10 in the port library and compiler\n\nCurrently, support for recognizing POWER10 in the compiler is gated\nbehind an environment variable, since support is still very early in\ndevelopment and untested. Gating this support prevents accidental use of\nuntested P10 code by people using older versions of OpenJ9 when such\nchips become available.\n\nCo-authored-by: Julian Wang <zlwang@ca.ibm.com>\nSigned-off-by: Ben Thomas <ben@benthomas.ca>", "committedDate": "2020-05-28T16:15:03Z", "type": "commit"}, {"oid": "5034de8f24977e32951833b9ef985b9149f0a637", "url": "https://github.com/eclipse-openj9/openj9/commit/5034de8f24977e32951833b9ef985b9149f0a637", "message": "Add code for exploiting P10 byte reverse instructions\n\nThe Power codegen support for inlining the reverseBytes methods of the\nShort and Long classes will now make use of the brh and brd instructions\navailable on POWER10 systems.\n\nCo-authored-by: Julian Wang <zlwang@ca.ibm.com>\nSigned-off-by: Ben Thomas <ben@benthomas.ca>", "committedDate": "2020-05-28T16:15:05Z", "type": "commit"}, {"oid": "5034de8f24977e32951833b9ef985b9149f0a637", "url": "https://github.com/eclipse-openj9/openj9/commit/5034de8f24977e32951833b9ef985b9149f0a637", "message": "Add code for exploiting P10 byte reverse instructions\n\nThe Power codegen support for inlining the reverseBytes methods of the\nShort and Long classes will now make use of the brh and brd instructions\navailable on POWER10 systems.\n\nCo-authored-by: Julian Wang <zlwang@ca.ibm.com>\nSigned-off-by: Ben Thomas <ben@benthomas.ca>", "committedDate": "2020-05-28T16:15:05Z", "type": "forcePushed"}]}