{"pr_number": 9131, "pr_title": "HeapSampling not available for GC policies Metronome & Balanced", "pr_createdAt": "2020-04-06T13:29:14Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9131", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI0MTk3NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9131#discussion_r405241974", "bodyText": "Should the can_generate_sampled_object_alloc_events event be removed from the potential set of capabilities when running with metronome or balanced? ie https://github.com/eclipse/openj9/blob/e363d8001fcfa8eef2641b326b194ec9503959c7/runtime/jvmti/jvmtiCapability.c#L178", "author": "DanHeidinga", "createdAt": "2020-04-08T03:47:41Z", "path": "runtime/jvmti/jvmtiCapability.c", "diffHunk": "@@ -373,7 +373,10 @@ jvmtiAddCapabilities(jvmtiEnv* env,\n \n #if JAVA_SPEC_VERSION >= 11\n \t\tif (newCapabilities.can_generate_sampled_object_alloc_events) {\n-\t\t\tif (J9_ARE_ANY_BITS_SET(jvmtiData->flags, J9JVMTI_FLAG_SAMPLED_OBJECT_ALLOC_ENABLED)) {\n+\t\t\tif (J9_ARE_ANY_BITS_SET(jvmtiData->flags, J9JVMTI_FLAG_SAMPLED_OBJECT_ALLOC_ENABLED)\n+\t\t\t\t|| (J9_GC_POLICY_METRONOME == vm->gcPolicy)\n+\t\t\t\t|| (J9_GC_POLICY_BALANCED == vm->gcPolicy)\n+\t\t\t) {", "originalCommit": "e363d8001fcfa8eef2641b326b194ec9503959c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ3MzAzMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9131#discussion_r405473030", "bodyText": "yeah, this is the right place. Thanks @DanHeidinga , PR is updated, please have another look.", "author": "JasonFengJ9", "createdAt": "2020-04-08T12:05:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI0MTk3NA=="}], "type": "inlineReview"}, {"oid": "cef02e102daab0f658d495f2fe715be11f32e478", "url": "https://github.com/eclipse-openj9/openj9/commit/cef02e102daab0f658d495f2fe715be11f32e478", "message": "HeapSampling not available for GC policies Metronome/Balanced\n\nNot enable jvmtiCapabilities can_generate_sampled_object_alloc_events\nwhen the GC policy is Metronome or Balanced.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-04-08T12:01:21Z", "type": "forcePushed"}, {"oid": "70384a3022728add8b1cf9b25ecc296911a7d1db", "url": "https://github.com/eclipse-openj9/openj9/commit/70384a3022728add8b1cf9b25ecc296911a7d1db", "message": "HeapSampling not available for GC policies Metronome/Balanced\n\nNot enable jvmtiCapabilities can_generate_sampled_object_alloc_events\nwhen the GC policy is Metronome or Balanced;\nMoved the test for\ninitialCapabilities.can_generate_sampled_object_alloc_events\nto soae001.c.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-04-08T19:34:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkxNjAwNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9131#discussion_r405916005", "bodyText": "We greatly prefer -= 1", "author": "gacholio", "createdAt": "2020-04-09T02:08:43Z", "path": "runtime/tests/jvmtitests/src/com/ibm/jvmti/tests/getPotentialCapabilities/gpc001.c", "diffHunk": "@@ -153,6 +153,11 @@ Java_com_ibm_jvmti_tests_getPotentialCapabilities_gpc001_verifyOnLoadCapabilitie\n \t\tunavailableCount--;\n \t}\n \n+\t/* GC policies Metronome & Balanced don't support this event */\n+\tif (!initialCapabilities.can_generate_sampled_object_alloc_events) {\n+\t\tunavailableCount--;", "originalCommit": "70384a3022728add8b1cf9b25ecc296911a7d1db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkyMzc0NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9131#discussion_r405923745", "bodyText": "Updated this and other occurrences in same method.", "author": "JasonFengJ9", "createdAt": "2020-04-09T02:38:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkxNjAwNQ=="}], "type": "inlineReview"}, {"oid": "48484f531f3fda614d64459650714e6836dc7cd1", "url": "https://github.com/eclipse-openj9/openj9/commit/48484f531f3fda614d64459650714e6836dc7cd1", "message": "HeapSampling not available for GC policies Metronome/Balanced\n\nNot enable jvmtiCapabilities can_generate_sampled_object_alloc_events\nwhen the GC policy is Metronome or Balanced;\nMoved the test for\ninitialCapabilities.can_generate_sampled_object_alloc_events\nto soae001.c.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-04-09T02:36:34Z", "type": "commit"}, {"oid": "48484f531f3fda614d64459650714e6836dc7cd1", "url": "https://github.com/eclipse-openj9/openj9/commit/48484f531f3fda614d64459650714e6836dc7cd1", "message": "HeapSampling not available for GC policies Metronome/Balanced\n\nNot enable jvmtiCapabilities can_generate_sampled_object_alloc_events\nwhen the GC policy is Metronome or Balanced;\nMoved the test for\ninitialCapabilities.can_generate_sampled_object_alloc_events\nto soae001.c.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-04-09T02:36:34Z", "type": "forcePushed"}]}