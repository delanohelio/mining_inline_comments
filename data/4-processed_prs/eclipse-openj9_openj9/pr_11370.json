{"pr_number": 11370, "pr_title": "Enable java.lang.Class.getConstantPool() for Java 8", "pr_createdAt": "2020-12-04T20:16:54Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11370", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1OTkwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11370#discussion_r536359909", "bodyText": "Since we are here, please use SharedSecrets.getJavaLangAccess() instead new an instance for every call.", "author": "JasonFengJ9", "createdAt": "2020-12-04T20:25:34Z", "path": "jcl/src/java.base/share/classes/java/lang/Class.java", "diffHunk": "@@ -4670,10 +4670,11 @@ Object setMethodHandleCache(Object cache) {\n \treturn result;\n }\n \n-/*[IF Sidecar19-SE]*/\n ConstantPool getConstantPool() {\n \treturn new Access().getConstantPool(this);", "originalCommit": "2c83d092e423a71709b2438ef580ba50677f84c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MTY3OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11370#discussion_r536361678", "bodyText": "Sure, I will change that. Do we want to make the same change here?\nhttps://github.com/eclipse/openj9/blob/2c83d092e423a71709b2438ef580ba50677f84c3/jcl/src/java.base/share/classes/java/lang/Class.java#L3111-L3114", "author": "sharon-wang", "createdAt": "2020-12-04T20:29:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1OTkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MzYyMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11370#discussion_r536363620", "bodyText": "Or perhaps replace new Access().getConstantPool(this) with getConstantPool()", "author": "sharon-wang", "createdAt": "2020-12-04T20:33:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1OTkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MTM4Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11370#discussion_r536371387", "bodyText": "SharedSecrets.getJavaLangAccess() saves one level method call though it is negligible after JIT.\nAnother option is to change the method Access.getConstantPool() to static, but I will let that to you.\nNever mind, sun.misc.JavaLangAccess.getConstantPool(Class<?> klass) is not static, the implementation can't be either.", "author": "JasonFengJ9", "createdAt": "2020-12-04T20:49:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1OTkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3OTk4Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11370#discussion_r536379987", "bodyText": "Pushed the changes.", "author": "sharon-wang", "createdAt": "2020-12-04T21:07:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1OTkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4ODI1MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11370#discussion_r536388251", "bodyText": "SharedSecrets is in jdk.internal.access for JDK9+, sun.misc prior to that. Will add in both imports ifdeffed on the Java version.", "author": "sharon-wang", "createdAt": "2020-12-04T21:24:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1OTkwOQ=="}], "type": "inlineReview"}, {"oid": "1d60e8e76ea4c69696954ea992863bf24ba724a1", "url": "https://github.com/eclipse-openj9/openj9/commit/1d60e8e76ea4c69696954ea992863bf24ba724a1", "message": "Enable java.lang.Class.getConstantPool() for Java 8\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-12-04T21:06:08Z", "type": "forcePushed"}, {"oid": "8642e39e68567548aef25ab8100a276bc30775ef", "url": "https://github.com/eclipse-openj9/openj9/commit/8642e39e68567548aef25ab8100a276bc30775ef", "message": "Enable java.lang.Class.getConstantPool() for Java 8\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-12-04T21:26:08Z", "type": "commit"}, {"oid": "8642e39e68567548aef25ab8100a276bc30775ef", "url": "https://github.com/eclipse-openj9/openj9/commit/8642e39e68567548aef25ab8100a276bc30775ef", "message": "Enable java.lang.Class.getConstantPool() for Java 8\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-12-04T21:26:08Z", "type": "forcePushed"}]}