{"pr_number": 10968, "pr_title": "Add new `allSegmentsInMemorySegmentListDo` api to iterate segments ", "pr_createdAt": "2020-10-22T15:06:52Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10968", "timeline": [{"oid": "f316e5c3dce268027c9901ee19cf4fe4e12e94d5", "url": "https://github.com/eclipse-openj9/openj9/commit/f316e5c3dce268027c9901ee19cf4fe4e12e94d5", "message": "Add new `allSegmentsInMemorySegmentListDo` api to iterate segments\n\nThe new api iterates through all the J9MemorySegments in a given\nJ9MemorySegmentList and passes them to a callback function.  This\nallows arbitrary operations to be performed on the segment.\n\nI've validated this with adhoc tests that print the segments and\nremove bits from them.\n\nThe API is intended to help the `snapshot` work but as it's common\nand can be put immediately into `master`, that's my preference to\navoid porting it over later.\n\nSigned-off-by: Dan Heidinga <heidinga@redhat.com>", "committedDate": "2020-10-22T14:56:26Z", "type": "commit"}, {"oid": "5137b3881115a294a4ea7f5fc0bb3344d808c669", "url": "https://github.com/eclipse-openj9/openj9/commit/5137b3881115a294a4ea7f5fc0bb3344d808c669", "message": "Debug helper callback function to print known J9MemorySegment types\n\nSigned-off-by: Dan Heidinga <heidinga@redhat.com>", "committedDate": "2020-10-22T15:05:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3MzQ1OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10968#discussion_r510273458", "bodyText": "Extra line.", "author": "gacholio", "createdAt": "2020-10-22T15:53:01Z", "path": "runtime/vm/segment.c", "diffHunk": "@@ -196,10 +196,27 @@ void freeMemorySegmentList(J9JavaVM *javaVM,J9MemorySegmentList *segmentList)\n \tj9mem_free_memory(segmentList);\n }\n \n+void\n+allSegmentsInMemorySegmentListDo(J9MemorySegmentList *segmentList, void (* segmentCallback)(J9MemorySegment*, void*), void *userData)\n+{\n+\tAssert_VM_notNull(segmentList);\n+\tAssert_VM_notNull(segmentCallback);\n+\tif (!J9_MEMORY_SEGMENT_LINEAR_LINKED_LIST_IS_EMPTY(segmentList->nextSegment)) {\n+\t\tJ9MemorySegment *segment = J9_MEMORY_SEGMENT_LINEAR_LINKED_LIST_START_DO(segmentList->nextSegment);\n+\n+\t\twhile (segment != NULL) {\n+\t\t\tsegmentCallback(segment, userData);\n+\t\t\tsegment = J9_MEMORY_SEGMENT_LINEAR_LINKED_LIST_NEXT_DO(segmentList->nextSegment, segment);\n+\t\t}\n+\n+\t}\n+", "originalCommit": "5137b3881115a294a4ea7f5fc0bb3344d808c669", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI4MDAzMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10968#discussion_r510280030", "bodyText": "Updated to remove", "author": "DanHeidinga", "createdAt": "2020-10-22T16:01:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3MzQ1OA=="}], "type": "inlineReview"}, {"oid": "8e73ee3cc16452ad0cdd79dda564a45fc3303f59", "url": "https://github.com/eclipse-openj9/openj9/commit/8e73ee3cc16452ad0cdd79dda564a45fc3303f59", "message": "Remove extra blank lines\n\nSigned-off-by: Dan Heidinga <heidinga@redhat.com>", "committedDate": "2020-10-22T16:00:45Z", "type": "commit"}]}