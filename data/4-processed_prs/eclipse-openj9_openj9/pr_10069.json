{"pr_number": 10069, "pr_title": "Add Java 11 IFA support for JVMTI_EVENT_SAMPLED_OBJECT_ALLOC", "pr_createdAt": "2020-07-02T18:01:36Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10069", "timeline": [{"oid": "6d7bd9b8cf0d2b3e28edb9b163c782875e98d849", "url": "https://github.com/eclipse-openj9/openj9/commit/6d7bd9b8cf0d2b3e28edb9b163c782875e98d849", "message": "Add Java 11 IFA support for JVMTI_EVENT_SAMPLED_OBJECT_ALLOC\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-07-02T15:47:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4NzE0NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10069#discussion_r449187145", "bodyText": "why the renumbering and why is 0x39 reserved?", "author": "DanHeidinga", "createdAt": "2020-07-02T18:05:58Z", "path": "runtime/oti/j9consts.h", "diffHunk": "@@ -732,15 +732,16 @@ extern \"C\" {\n #define J9_JNI_OFFLOAD_SWITCH_JVMTI_GC_FINISH\t\t\t\t\t\t\t0x36\n #define J9_JNI_OFFLOAD_SWITCH_JVMTI_OBJECT_FREE\t\t\t\t\t\t\t0x37\n #define J9_JNI_OFFLOAD_SWITCH_JVMTI_VM_OBJECT_ALLOC\t\t\t\t\t\t0x38\n-#define J9_JNI_OFFLOAD_SWITCH_J9JVMTI_COMPILING_START\t\t\t\t\t0x39\n-#define J9_JNI_OFFLOAD_SWITCH_J9JVMTI_COMPILING_END\t\t\t\t\t\t0x3A\n-#define J9_JNI_OFFLOAD_SWITCH_J9JVMTI_INSTRUMENTABLE_OBJECT_ALLOC\t\t0x3B\n-#define J9_JNI_OFFLOAD_SWITCH_J9JVMTI_VM_DUMP_START\t\t\t\t\t\t0x3C\n-#define J9_JNI_OFFLOAD_SWITCH_J9JVMTI_VM_DUMP_END\t\t\t\t\t\t0x3D\n-#define J9_JNI_OFFLOAD_SWITCH_J9JVMTI_GC_CYCLE_START\t\t\t\t\t0x3E\n-#define J9_JNI_OFFLOAD_SWITCH_J9JVMTI_GC_CYCLE_FINISH\t\t\t\t\t0x3F\n-#define J9_JNI_OFFLOAD_SWITCH_TRACE_SUBSCRIBER_THREAD\t\t\t\t\t0x40\n-#define J9_JNI_OFFLOAD_SWITCH_JVMTI_SAMPLED_OBJECT_ALLOC\t\t\t\t0x41\n+/* 0x39 Reserved for JVMTI event */", "originalCommit": "6d7bd9b8cf0d2b3e28edb9b163c782875e98d849", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE5ODQwNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10069#discussion_r449198406", "bodyText": "why the renumbering and why is 0x39 reserved?\n\nThere are two kind of JVMTI events, one is from the JVMTI spec and defined at https://github.com/eclipse/openj9/blob/00bc8b44faf3cd10181871f3d43f98f94b41c7e9/runtime/include/jvmti.h.m4#L738-L741\nthe other is OpenJ9 specific JVMTI event and defined at https://github.com/eclipse/openj9/blob/00bc8b44faf3cd10181871f3d43f98f94b41c7e9/runtime/oti/jvmtiInternal.h#L36-L48\nThe OpenJ9 internal ones always start from J9JVMTI_HIGHEST_EVENT and are larger than all JVMTI spec event defines.\njavaOffloadSwitchOn() & javaOffloadSwitchOff() use eventNumber - J9JVMTI_LOWEST_EVENT to determine the reason code.\nhttps://github.com/eclipse/openj9/blob/00bc8b44faf3cd10181871f3d43f98f94b41c7e9/runtime/jvmti/jvmtiHelpers.c#L631-L632\nHence this new JDK11 J9_JNI_OFFLOAD_SWITCH_JVMTI_SAMPLED_OBJECT_ALLOC has to match its event define within jvmti.h like its friends such as https://github.com/eclipse/openj9/blob/d9f3cf63cf21cae1e2cc3bf7e02e0a5281989e9a/runtime/oti/j9consts.h#L721-L730 i.e., it need to be inserted between previous JDK 8 and OpenJ9 specific defines.", "author": "JasonFengJ9", "createdAt": "2020-07-02T18:29:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4NzE0NQ=="}], "type": "inlineReview"}]}