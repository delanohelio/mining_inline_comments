{"pr_number": 10652, "pr_title": "Delay init of ramclass link params ", "pr_createdAt": "2020-09-21T00:30:07Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10652", "timeline": [{"oid": "06bf25dc046654aadbb0ae898ca031de22605d3b", "url": "https://github.com/eclipse-openj9/openj9/commit/06bf25dc046654aadbb0ae898ca031de22605d3b", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. DElaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-21T21:33:27Z", "type": "forcePushed"}, {"oid": "310f60fd7cc233cd858f732fca45188591380b16", "url": "https://github.com/eclipse-openj9/openj9/commit/310f60fd7cc233cd858f732fca45188591380b16", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-21T21:35:48Z", "type": "forcePushed"}, {"oid": "19a074e8838a19d7546b57de07855209668a99b3", "url": "https://github.com/eclipse-openj9/openj9/commit/19a074e8838a19d7546b57de07855209668a99b3", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-21T21:39:19Z", "type": "forcePushed"}, {"oid": "4620a9cb0ee640a5794d52b6ac0485722414890f", "url": "https://github.com/eclipse-openj9/openj9/commit/4620a9cb0ee640a5794d52b6ac0485722414890f", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-21T21:42:14Z", "type": "forcePushed"}, {"oid": "26e37b385188e39b8beb4c02a7d327e67842b786", "url": "https://github.com/eclipse-openj9/openj9/commit/26e37b385188e39b8beb4c02a7d327e67842b786", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-21T21:54:47Z", "type": "forcePushed"}, {"oid": "819cceb5f2fe549f57ef3b0d774c103cff1117c5", "url": "https://github.com/eclipse-openj9/openj9/commit/819cceb5f2fe549f57ef3b0d774c103cff1117c5", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T12:44:17Z", "type": "forcePushed"}, {"oid": "64ea05e2e0caa3d0e131835006c315b91dece045", "url": "https://github.com/eclipse-openj9/openj9/commit/64ea05e2e0caa3d0e131835006c315b91dece045", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T12:57:11Z", "type": "forcePushed"}, {"oid": "93f301b938a3d97d31a144afb3b3783a2c60cdeb", "url": "https://github.com/eclipse-openj9/openj9/commit/93f301b938a3d97d31a144afb3b3783a2c60cdeb", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T12:58:19Z", "type": "forcePushed"}, {"oid": "dd5cc118ac8ff218f45e90d5d4d1793340550fd5", "url": "https://github.com/eclipse-openj9/openj9/commit/dd5cc118ac8ff218f45e90d5d4d1793340550fd5", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T13:05:45Z", "type": "forcePushed"}, {"oid": "98bee8e32a5707eaf6dad387ae44de1c64295b33", "url": "https://github.com/eclipse-openj9/openj9/commit/98bee8e32a5707eaf6dad387ae44de1c64295b33", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T13:12:59Z", "type": "forcePushed"}, {"oid": "e5095a66e08b51a1a5d4904d9ee9f8a05432ed08", "url": "https://github.com/eclipse-openj9/openj9/commit/e5095a66e08b51a1a5d4904d9ee9f8a05432ed08", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T13:17:36Z", "type": "forcePushed"}, {"oid": "2432d1cadce74b46ba77c1d1e15a43e45ae2e223", "url": "https://github.com/eclipse-openj9/openj9/commit/2432d1cadce74b46ba77c1d1e15a43e45ae2e223", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T13:28:40Z", "type": "forcePushed"}, {"oid": "43be426d429c4e0ea94569a40bc01459184f98d5", "url": "https://github.com/eclipse-openj9/openj9/commit/43be426d429c4e0ea94569a40bc01459184f98d5", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T13:41:37Z", "type": "forcePushed"}, {"oid": "ba606bcdaea8b79f51b578f4d4f183fe2084565f", "url": "https://github.com/eclipse-openj9/openj9/commit/ba606bcdaea8b79f51b578f4d4f183fe2084565f", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T13:53:38Z", "type": "forcePushed"}, {"oid": "2bca7a509110735987e3318174373ef85bcd28e3", "url": "https://github.com/eclipse-openj9/openj9/commit/2bca7a509110735987e3318174373ef85bcd28e3", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T14:09:11Z", "type": "forcePushed"}, {"oid": "92e443da84547b4f4856ba5ad5f3b41c6535b7af", "url": "https://github.com/eclipse-openj9/openj9/commit/92e443da84547b4f4856ba5ad5f3b41c6535b7af", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T14:23:04Z", "type": "forcePushed"}, {"oid": "dea51c041b9d3705566550c414a66fc538f72357", "url": "https://github.com/eclipse-openj9/openj9/commit/dea51c041b9d3705566550c414a66fc538f72357", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T17:02:57Z", "type": "forcePushed"}, {"oid": "2d9dc1412e9ebdeb054e9959df53ca6fd95f8d1b", "url": "https://github.com/eclipse-openj9/openj9/commit/2d9dc1412e9ebdeb054e9959df53ca6fd95f8d1b", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T17:22:47Z", "type": "forcePushed"}, {"oid": "0bd5e2c6d4e9bb1cd5bb5cd5ec71caa4b5d5b237", "url": "https://github.com/eclipse-openj9/openj9/commit/0bd5e2c6d4e9bb1cd5bb5cd5ec71caa4b5d5b237", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T17:29:13Z", "type": "forcePushed"}, {"oid": "a8abb7f48e064871ccdf55ea551868fa8267fef2", "url": "https://github.com/eclipse-openj9/openj9/commit/a8abb7f48e064871ccdf55ea551868fa8267fef2", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T17:43:09Z", "type": "forcePushed"}, {"oid": "384c85680c1015e456521b6ab159ad00accf8684", "url": "https://github.com/eclipse-openj9/openj9/commit/384c85680c1015e456521b6ab159ad00accf8684", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-22T17:43:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk2NzE3Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/10652#discussion_r492967176", "bodyText": "I would move this comment (merge it with the one above) since this is in the not NULL path.", "author": "gacholio", "createdAt": "2020-09-22T19:01:23Z", "path": "runtime/vm/createramclass.cpp", "diffHunk": "@@ -1995,6 +1995,13 @@ internalCreateRAMClassDone(J9VMThread *vmThread, J9ClassLoader *classLoader, J9R\n \t\t\t}\n \t\t}\n \n+\t\t/* link classes in segment */\n+\t\tif (NULL != segment) {\n+\t\t\t/* segment is NULL in failure paths */", "originalCommit": "384c85680c1015e456521b6ab159ad00accf8684", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwMzAzNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10652#discussion_r493003034", "bodyText": "With this change, is the code above that handles the \"already loaded\" case still valid / required?  I think it can be removed now as there's no reason to link the abandoned class into anything as it won't be part of the list until this point\nhttps://github.com/eclipse/openj9/blob/384c85680c1015e456521b6ab159ad00accf8684/runtime/vm/createramclass.cpp#L1974-L1980", "author": "DanHeidinga", "createdAt": "2020-09-22T20:08:48Z", "path": "runtime/vm/createramclass.cpp", "diffHunk": "@@ -1995,6 +1995,13 @@ internalCreateRAMClassDone(J9VMThread *vmThread, J9ClassLoader *classLoader, J9R\n \t\t\t}\n \t\t}\n \n+\t\t/* link classes in segment */\n+\t\tif (NULL != segment) {\n+\t\t\t/* segment is NULL in failure paths */\n+\t\t\tstate->ramClass->nextClassInSegment = *(J9Class **) segment->heapBase;\n+\t\t\t*(J9Class **)segment->heapBase = state->ramClass;", "originalCommit": "384c85680c1015e456521b6ab159ad00accf8684", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "94161364cfefd890f12fdbbc3c07c0149eacfb58", "url": "https://github.com/eclipse-openj9/openj9/commit/94161364cfefd890f12fdbbc3c07c0149eacfb58", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-24T19:47:43Z", "type": "forcePushed"}, {"oid": "8ed322a83a248af3c206186505a66ebb9445d3ad", "url": "https://github.com/eclipse-openj9/openj9/commit/8ed322a83a248af3c206186505a66ebb9445d3ad", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-24T19:49:28Z", "type": "forcePushed"}, {"oid": "78d8db080b81056f44343407c7045656529b93aa", "url": "https://github.com/eclipse-openj9/openj9/commit/78d8db080b81056f44343407c7045656529b93aa", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-25T20:30:56Z", "type": "forcePushed"}, {"oid": "38063d135439fc0a35dcd6e68a2dc8e49b7f1eb0", "url": "https://github.com/eclipse-openj9/openj9/commit/38063d135439fc0a35dcd6e68a2dc8e49b7f1eb0", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-28T17:55:39Z", "type": "forcePushed"}, {"oid": "ca15a53ee794cdafa10f4f0541274d8f0ae3c0ff", "url": "https://github.com/eclipse-openj9/openj9/commit/ca15a53ee794cdafa10f4f0541274d8f0ae3c0ff", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-28T17:57:19Z", "type": "forcePushed"}, {"oid": "cf407bb44b1b2c1319b89a06d0bd3a568e24826b", "url": "https://github.com/eclipse-openj9/openj9/commit/cf407bb44b1b2c1319b89a06d0bd3a568e24826b", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-28T18:09:03Z", "type": "forcePushed"}, {"oid": "4e722cfc1f8f0f7028437bc8333dc13cc02a1c5f", "url": "https://github.com/eclipse-openj9/openj9/commit/4e722cfc1f8f0f7028437bc8333dc13cc02a1c5f", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-28T18:47:10Z", "type": "forcePushed"}, {"oid": "cdc4348c6ba1e57fdf984111fa731f1ed31ab230", "url": "https://github.com/eclipse-openj9/openj9/commit/cdc4348c6ba1e57fdf984111fa731f1ed31ab230", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-28T18:47:52Z", "type": "forcePushed"}, {"oid": "a725687c8790ddb6ef849c1551689dbd767bb7c3", "url": "https://github.com/eclipse-openj9/openj9/commit/a725687c8790ddb6ef849c1551689dbd767bb7c3", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-28T18:53:06Z", "type": "forcePushed"}, {"oid": "9734b9eb8a11e9022b09710b91ce5197e378611a", "url": "https://github.com/eclipse-openj9/openj9/commit/9734b9eb8a11e9022b09710b91ce5197e378611a", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-28T19:01:17Z", "type": "forcePushed"}, {"oid": "343ad0fe37a39549b7818e0fd34f5ae4fe069e81", "url": "https://github.com/eclipse-openj9/openj9/commit/343ad0fe37a39549b7818e0fd34f5ae4fe069e81", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T12:57:11Z", "type": "forcePushed"}, {"oid": "cbf730f700e4898882d8b94e9350ad6b9261662e", "url": "https://github.com/eclipse-openj9/openj9/commit/cbf730f700e4898882d8b94e9350ad6b9261662e", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T13:13:49Z", "type": "forcePushed"}, {"oid": "85f8994f552d405a034bb7f4c5fa88f6e02b3d98", "url": "https://github.com/eclipse-openj9/openj9/commit/85f8994f552d405a034bb7f4c5fa88f6e02b3d98", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T13:36:12Z", "type": "forcePushed"}, {"oid": "78714671c03641a0213ccddac114486ee4545005", "url": "https://github.com/eclipse-openj9/openj9/commit/78714671c03641a0213ccddac114486ee4545005", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T14:09:48Z", "type": "forcePushed"}, {"oid": "0f155787c3d59aad0360beb715298bb7c873bce6", "url": "https://github.com/eclipse-openj9/openj9/commit/0f155787c3d59aad0360beb715298bb7c873bce6", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T14:12:19Z", "type": "forcePushed"}, {"oid": "89231745fd8423ed3862d0d5f9a0bdb3803d36e3", "url": "https://github.com/eclipse-openj9/openj9/commit/89231745fd8423ed3862d0d5f9a0bdb3803d36e3", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T15:11:25Z", "type": "forcePushed"}, {"oid": "92b564e2762cad356fe33985fa2b86bd9e4b2191", "url": "https://github.com/eclipse-openj9/openj9/commit/92b564e2762cad356fe33985fa2b86bd9e4b2191", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T15:24:41Z", "type": "forcePushed"}, {"oid": "bc476a0203d7129a2d981c040eb4dfa32659b2e6", "url": "https://github.com/eclipse-openj9/openj9/commit/bc476a0203d7129a2d981c040eb4dfa32659b2e6", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T15:30:27Z", "type": "forcePushed"}, {"oid": "ea66a3f3cd567c8242a994e565c55cbdb4498f5d", "url": "https://github.com/eclipse-openj9/openj9/commit/ea66a3f3cd567c8242a994e565c55cbdb4498f5d", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T15:31:37Z", "type": "forcePushed"}, {"oid": "58fb32dabdffc945e9a4f23ffc05c0ab48c643ec", "url": "https://github.com/eclipse-openj9/openj9/commit/58fb32dabdffc945e9a4f23ffc05c0ab48c643ec", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T15:36:31Z", "type": "forcePushed"}, {"oid": "e403a31461d7a610885cc0f16275550a81a30cce", "url": "https://github.com/eclipse-openj9/openj9/commit/e403a31461d7a610885cc0f16275550a81a30cce", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T18:38:16Z", "type": "forcePushed"}, {"oid": "2ccf382aee55027419ae33317583610e13239984", "url": "https://github.com/eclipse-openj9/openj9/commit/2ccf382aee55027419ae33317583610e13239984", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T18:40:04Z", "type": "forcePushed"}, {"oid": "2f419f26b555dd1d2715f3d61cb6c9747aaf1265", "url": "https://github.com/eclipse-openj9/openj9/commit/2f419f26b555dd1d2715f3d61cb6c9747aaf1265", "message": "Assign object to ramclass in linkage error path\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list until after the class passes loading constraints\nchecks will ensure that the GC cannot iterate an invalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T18:46:37Z", "type": "forcePushed"}, {"oid": "31883a0a1870420250fd0e59ae46569236ed0a81", "url": "https://github.com/eclipse-openj9/openj9/commit/31883a0a1870420250fd0e59ae46569236ed0a81", "message": "Delay init of ramclass link params\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list and subclass traversal list until after the class\npasses loading constraints\nchecks will ensure that the GC or any other component cannot iterate an\ninvalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T18:49:42Z", "type": "forcePushed"}, {"oid": "a4850bfbc4f668674a523bb3709fd64bc0908b38", "url": "https://github.com/eclipse-openj9/openj9/commit/a4850bfbc4f668674a523bb3709fd64bc0908b38", "message": "Delay init of ramclass link params\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list and subclass traversal list until after the class\npasses loading constraints\nchecks will ensure that the GC or any other component cannot iterate an\ninvalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-29T18:53:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA0Njc0Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10652#discussion_r497046742", "bodyText": "{ on new line.", "author": "gacholio", "createdAt": "2020-09-29T20:52:57Z", "path": "runtime/vm/createramclass.cpp", "diffHunk": "@@ -2142,6 +2142,30 @@ trcModulesSettingPackage(J9VMThread *vmThread, J9Class *ramClass, J9ClassLoader\n \t\t}\n \t}\n }\n+static void\n+initializeClassLinks(J9Class *ramClass, J9Class *superclass, J9MemorySegment *segment, UDATA options) {", "originalCommit": "a4850bfbc4f668674a523bb3709fd64bc0908b38", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA0NzgzNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10652#discussion_r497047837", "bodyText": "Extra line.", "author": "gacholio", "createdAt": "2020-09-29T20:53:58Z", "path": "runtime/vm/createramclass.cpp", "diffHunk": "@@ -2142,6 +2142,30 @@ trcModulesSettingPackage(J9VMThread *vmThread, J9Class *ramClass, J9ClassLoader\n \t\t}\n \t}\n }\n+static void\n+initializeClassLinks(J9Class *ramClass, J9Class *superclass, J9MemorySegment *segment, UDATA options) {\n+\tramClass->nextClassInSegment = *(J9Class **) segment->heapBase;\n+\t*(J9Class **)segment->heapBase = ramClass;\n+\n+\tif (superclass == NULL) {\n+\t\tramClass->subclassTraversalLink = ramClass;\n+\t\tramClass->subclassTraversalReverseLink = ramClass;\n+\t} else {\n+", "originalCommit": "a4850bfbc4f668674a523bb3709fd64bc0908b38", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA0ODIyNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10652#discussion_r497048225", "bodyText": "Please use bit macro.", "author": "gacholio", "createdAt": "2020-09-29T20:54:19Z", "path": "runtime/vm/createramclass.cpp", "diffHunk": "@@ -2142,6 +2142,30 @@ trcModulesSettingPackage(J9VMThread *vmThread, J9Class *ramClass, J9ClassLoader\n \t\t}\n \t}\n }\n+static void\n+initializeClassLinks(J9Class *ramClass, J9Class *superclass, J9MemorySegment *segment, UDATA options) {\n+\tramClass->nextClassInSegment = *(J9Class **) segment->heapBase;\n+\t*(J9Class **)segment->heapBase = ramClass;\n+\n+\tif (superclass == NULL) {\n+\t\tramClass->subclassTraversalLink = ramClass;\n+\t\tramClass->subclassTraversalReverseLink = ramClass;\n+\t} else {\n+\n+\t\tif ((options & J9_FINDCLASS_FLAG_NO_SUBCLASS_LINK) == 0) {", "originalCommit": "a4850bfbc4f668674a523bb3709fd64bc0908b38", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4OTIzNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10652#discussion_r497189237", "bodyText": "Can you document the function parameters and what it does?", "author": "DanHeidinga", "createdAt": "2020-09-30T01:10:42Z", "path": "runtime/vm/createramclass.cpp", "diffHunk": "@@ -2142,6 +2142,30 @@ trcModulesSettingPackage(J9VMThread *vmThread, J9Class *ramClass, J9ClassLoader\n \t\t}\n \t}\n }\n+static void", "originalCommit": "a4850bfbc4f668674a523bb3709fd64bc0908b38", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5MzI5Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10652#discussion_r497193297", "bodyText": "Since we hold the mutex over this operation, we can assign the ramClass to subclassTraversalLink & subclassTraversalReverseLink always, and overwrite in the one case:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tif (superclass == NULL) {\n          \n          \n            \n            \t\tramClass->subclassTraversalLink = ramClass;\n          \n          \n            \n            \t\tramClass->subclassTraversalReverseLink = ramClass;\n          \n          \n            \n            \t} else {\n          \n          \n            \n            \n          \n          \n            \n            \t\tif ((options & J9_FINDCLASS_FLAG_NO_SUBCLASS_LINK) == 0) {\n          \n          \n            \n            \t\t\tJ9Class* nextLink = superclass->subclassTraversalLink;\n          \n          \n            \n            \n          \n          \n            \n            \t\t\tramClass->subclassTraversalLink = nextLink;\n          \n          \n            \n            \t\t\tnextLink->subclassTraversalReverseLink = ramClass;\n          \n          \n            \n            \t\t\tsuperclass->subclassTraversalLink = ramClass;\n          \n          \n            \n            \t\t\tramClass->subclassTraversalReverseLink = superclass;\n          \n          \n            \n            \t\t} else {\n          \n          \n            \n            \t\t\tramClass->subclassTraversalLink = ramClass;\n          \n          \n            \n            \t\t\tramClass->subclassTraversalReverseLink = ramClass;\n          \n          \n            \n            \t\t}\n          \n          \n            \n            \tramClass->subclassTraversalLink = ramClass;\n          \n          \n            \n            \tramClass->subclassTraversalReverseLink = ramClass;\n          \n          \n            \n            \tif ((options & J9_FINDCLASS_FLAG_NO_SUBCLASS_LINK) == 0) {\n          \n          \n            \n            \t\tJ9Class* nextLink = superclass->subclassTraversalLink;\n          \n          \n            \n            \n          \n          \n            \n            \t\tramClass->subclassTraversalLink = nextLink;\n          \n          \n            \n            \t\tnextLink->subclassTraversalReverseLink = ramClass;\n          \n          \n            \n            \t\tsuperclass->subclassTraversalLink = ramClass;\n          \n          \n            \n            \t\tramClass->subclassTraversalReverseLink = superclass;\n          \n          \n            \n            \t}", "author": "DanHeidinga", "createdAt": "2020-09-30T01:27:44Z", "path": "runtime/vm/createramclass.cpp", "diffHunk": "@@ -2142,6 +2142,30 @@ trcModulesSettingPackage(J9VMThread *vmThread, J9Class *ramClass, J9ClassLoader\n \t\t}\n \t}\n }\n+static void\n+initializeClassLinks(J9Class *ramClass, J9Class *superclass, J9MemorySegment *segment, UDATA options) {\n+\tramClass->nextClassInSegment = *(J9Class **) segment->heapBase;\n+\t*(J9Class **)segment->heapBase = ramClass;\n+\n+\tif (superclass == NULL) {\n+\t\tramClass->subclassTraversalLink = ramClass;\n+\t\tramClass->subclassTraversalReverseLink = ramClass;\n+\t} else {\n+\n+\t\tif ((options & J9_FINDCLASS_FLAG_NO_SUBCLASS_LINK) == 0) {\n+\t\t\tJ9Class* nextLink = superclass->subclassTraversalLink;\n+\n+\t\t\tramClass->subclassTraversalLink = nextLink;\n+\t\t\tnextLink->subclassTraversalReverseLink = ramClass;\n+\t\t\tsuperclass->subclassTraversalLink = ramClass;\n+\t\t\tramClass->subclassTraversalReverseLink = superclass;\n+\t\t} else {\n+\t\t\tramClass->subclassTraversalLink = ramClass;\n+\t\t\tramClass->subclassTraversalReverseLink = ramClass;\n+\t\t}", "originalCommit": "a4850bfbc4f668674a523bb3709fd64bc0908b38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5NjYxOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10652#discussion_r497196618", "bodyText": "This won't work if superclass is NULL. I agree about assigning the defaults first - just need to add the NULL check in the if.", "author": "gacholio", "createdAt": "2020-09-30T01:41:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5MzI5Nw=="}], "type": "inlineReview"}, {"oid": "0e9c99b3a2d69abe00c4043575187ef4a187db3f", "url": "https://github.com/eclipse-openj9/openj9/commit/0e9c99b3a2d69abe00c4043575187ef4a187db3f", "message": "Delay init of ramclass link params\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list and subclass traversal list until after the class\npasses loading constraints\nchecks will ensure that the GC or any other component cannot iterate an\ninvalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-30T12:06:08Z", "type": "forcePushed"}, {"oid": "4ccd20dd9d92a9a6c0000a4acff9664cc63f8bb8", "url": "https://github.com/eclipse-openj9/openj9/commit/4ccd20dd9d92a9a6c0000a4acff9664cc63f8bb8", "message": "Delay init of ramclass link params\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list and subclass traversal list until after the class\npasses loading constraints\nchecks will ensure that the GC or any other component cannot iterate an\ninvalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-30T12:21:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ4NDk3Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10652#discussion_r497484972", "bodyText": "Can you add a comment like:\n\nCaller must hold the classTableMutex.", "author": "DanHeidinga", "createdAt": "2020-09-30T12:53:27Z", "path": "runtime/vm/createramclass.cpp", "diffHunk": "@@ -2142,6 +2142,34 @@ trcModulesSettingPackage(J9VMThread *vmThread, J9Class *ramClass, J9ClassLoader\n \t\t}\n \t}\n }\n+\n+/**\n+ * This function initializes the subclass traversal links in the ramclass and the\n+ * next class link in the j9segment", "originalCommit": "4ccd20dd9d92a9a6c0000a4acff9664cc63f8bb8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7a08d15914432984cc31a0705c06cbff2efe71ed", "url": "https://github.com/eclipse-openj9/openj9/commit/7a08d15914432984cc31a0705c06cbff2efe71ed", "message": "Delay init of ramclass link params\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list and subclass traversal list until after the class\npasses loading constraints\nchecks will ensure that the GC or any other component cannot iterate an\ninvalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-30T13:13:12Z", "type": "commit"}, {"oid": "7a08d15914432984cc31a0705c06cbff2efe71ed", "url": "https://github.com/eclipse-openj9/openj9/commit/7a08d15914432984cc31a0705c06cbff2efe71ed", "message": "Delay init of ramclass link params\n\nWhen a class fails loading due to a classloading constraint error, the\nramclass remains in the class memory segments with an unverified state.\nThis causes a a crash in the GC because the GC expects all ramclasses to\nhave classObjects assign. Delaying the linking of the class in the\nmemory segment list and subclass traversal list until after the class\npasses loading constraints\nchecks will ensure that the GC or any other component cannot iterate an\ninvalid class.\n\nFixes: https://github.com/eclipse/openj9/issues/10541\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-09-30T13:13:12Z", "type": "forcePushed"}]}