{"pr_number": 8889, "pr_title": "Add valueType checks to monitor enter", "pr_createdAt": "2020-03-17T14:43:40Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8889", "timeline": [{"oid": "5f3b1be84e97111345d9af6698c0bf299327be68", "url": "https://github.com/eclipse-openj9/openj9/commit/5f3b1be84e97111345d9af6698c0bf299327be68", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-17T15:45:13Z", "type": "forcePushed"}, {"oid": "f718bdf978bab80e04d8592447fbccf8770eae99", "url": "https://github.com/eclipse-openj9/openj9/commit/f718bdf978bab80e04d8592447fbccf8770eae99", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-17T16:18:45Z", "type": "forcePushed"}, {"oid": "dedcc8946d5dba2dd2bd5b16a9b0eeb5ebd2ae62", "url": "https://github.com/eclipse-openj9/openj9/commit/dedcc8946d5dba2dd2bd5b16a9b0eeb5ebd2ae62", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-17T16:22:42Z", "type": "forcePushed"}, {"oid": "973beceabcb2865a1d1d977fa985df307e4be69c", "url": "https://github.com/eclipse-openj9/openj9/commit/973beceabcb2865a1d1d977fa985df307e4be69c", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-17T16:24:45Z", "type": "forcePushed"}, {"oid": "b50aad1304fcf2165a5c5f67354354e431c75ad4", "url": "https://github.com/eclipse-openj9/openj9/commit/b50aad1304fcf2165a5c5f67354354e431c75ad4", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-18T16:36:27Z", "type": "forcePushed"}, {"oid": "f91ed8874c86e9412da9a33fb226d8d22990cc6c", "url": "https://github.com/eclipse-openj9/openj9/commit/f91ed8874c86e9412da9a33fb226d8d22990cc6c", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-18T16:49:00Z", "type": "forcePushed"}, {"oid": "a38f0945a1b2067d85f55cc2185d63cc35686f9f", "url": "https://github.com/eclipse-openj9/openj9/commit/a38f0945a1b2067d85f55cc2185d63cc35686f9f", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-18T17:10:01Z", "type": "forcePushed"}, {"oid": "86d96fca68319694b73d8f605b5791664dcebc19", "url": "https://github.com/eclipse-openj9/openj9/commit/86d96fca68319694b73d8f605b5791664dcebc19", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-18T17:25:49Z", "type": "forcePushed"}, {"oid": "3f172e0b4edf6ab3259271e0ca101fcfc10dda09", "url": "https://github.com/eclipse-openj9/openj9/commit/3f172e0b4edf6ab3259271e0ca101fcfc10dda09", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-19T15:46:36Z", "type": "forcePushed"}, {"oid": "7d9330980f231c83f481e7f33cdc8f1bce14b408", "url": "https://github.com/eclipse-openj9/openj9/commit/7d9330980f231c83f481e7f33cdc8f1bce14b408", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-23T21:03:40Z", "type": "forcePushed"}, {"oid": "c940d83c2555ee0160e5db76782ad4ba927a856a", "url": "https://github.com/eclipse-openj9/openj9/commit/c940d83c2555ee0160e5db76782ad4ba927a856a", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-23T22:03:50Z", "type": "forcePushed"}, {"oid": "4821e4e3001375b3c8d55c3331b25abe15f139f8", "url": "https://github.com/eclipse-openj9/openj9/commit/4821e4e3001375b3c8d55c3331b25abe15f139f8", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-23T22:11:55Z", "type": "forcePushed"}, {"oid": "b22ee536435c73ba4e25aab89870573a451cab2e", "url": "https://github.com/eclipse-openj9/openj9/commit/b22ee536435c73ba4e25aab89870573a451cab2e", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-24T19:48:40Z", "type": "forcePushed"}, {"oid": "2b9e4bdec8b11b63c595f03b720337d2570ad340", "url": "https://github.com/eclipse-openj9/openj9/commit/2b9e4bdec8b11b63c595f03b720337d2570ad340", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-24T20:52:29Z", "type": "forcePushed"}, {"oid": "e871bdb4247369af07e0ee573f207e381c442762", "url": "https://github.com/eclipse-openj9/openj9/commit/e871bdb4247369af07e0ee573f207e381c442762", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T15:14:09Z", "type": "forcePushed"}, {"oid": "4b8b675a2ca4353798cbb62b5136228a31d6162f", "url": "https://github.com/eclipse-openj9/openj9/commit/4b8b675a2ca4353798cbb62b5136228a31d6162f", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T16:17:01Z", "type": "forcePushed"}, {"oid": "d241400b3682004ff0967f2d78c8c2cdba3d7489", "url": "https://github.com/eclipse-openj9/openj9/commit/d241400b3682004ff0967f2d78c8c2cdba3d7489", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T16:18:10Z", "type": "forcePushed"}, {"oid": "b6f6715ba57017a577b2c81655df3aa88f149660", "url": "https://github.com/eclipse-openj9/openj9/commit/b6f6715ba57017a577b2c81655df3aa88f149660", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T16:27:45Z", "type": "forcePushed"}, {"oid": "41341a71f619409fb77a84e6c3a1147c4e69d510", "url": "https://github.com/eclipse-openj9/openj9/commit/41341a71f619409fb77a84e6c3a1147c4e69d510", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T16:36:07Z", "type": "forcePushed"}, {"oid": "07862d099cbaa537813ef8f8cb582cccc3275ef5", "url": "https://github.com/eclipse-openj9/openj9/commit/07862d099cbaa537813ef8f8cb582cccc3275ef5", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T16:39:59Z", "type": "forcePushed"}, {"oid": "2c0f6dcc356e3b815702aa2391dc97392dddfd7a", "url": "https://github.com/eclipse-openj9/openj9/commit/2c0f6dcc356e3b815702aa2391dc97392dddfd7a", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T16:41:11Z", "type": "forcePushed"}, {"oid": "ef9dc5f296ebe229370156bd363e261ddda24dff", "url": "https://github.com/eclipse-openj9/openj9/commit/ef9dc5f296ebe229370156bd363e261ddda24dff", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T16:44:05Z", "type": "forcePushed"}, {"oid": "54544d4e72e2f26786de3900133d8e9d823a24d3", "url": "https://github.com/eclipse-openj9/openj9/commit/54544d4e72e2f26786de3900133d8e9d823a24d3", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T16:45:09Z", "type": "forcePushed"}, {"oid": "446d752dd7ebe03ebd85d39aa606a80336db53a3", "url": "https://github.com/eclipse-openj9/openj9/commit/446d752dd7ebe03ebd85d39aa606a80336db53a3", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-25T17:21:24Z", "type": "forcePushed"}, {"oid": "157d014ffa5ff3485aa461c20bf8ef98b2296d98", "url": "https://github.com/eclipse-openj9/openj9/commit/157d014ffa5ff3485aa461c20bf8ef98b2296d98", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-30T13:49:52Z", "type": "forcePushed"}, {"oid": "4cb0a1e0dc50a305b693edcea6b70ea731738d0a", "url": "https://github.com/eclipse-openj9/openj9/commit/4cb0a1e0dc50a305b693edcea6b70ea731738d0a", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-30T13:52:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIzNTgwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8889#discussion_r400235809", "bodyText": "Not a huge fan of this. Perhaps use goto instead of else.", "author": "gacholio", "createdAt": "2020-03-30T14:27:56Z", "path": "runtime/codert_vm/cnathelp.cpp", "diffHunk": "@@ -1223,7 +1232,14 @@ slow_jitMonitorEnterImpl(J9VMThread *currentThread, bool forMethod)\n \t\t\t\tresolveFrame->specialFrameFlags = (resolveFrame->specialFrameFlags & ~J9_STACK_FLAGS_JIT_FRAME_SUB_TYPE_MASK) | J9_STACK_FLAGS_JIT_FAILED_METHOD_MONITOR_ENTER_RESOLVE;\n \t\t\t}\n \t\t}\n-\t\taddr = setNativeOutOfMemoryErrorFromJIT(currentThread, J9NLS_VM_FAILED_TO_ALLOCATE_MONITOR);\n+#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)\n+\t\tif (J9_OBJECT_MONITOR_VALUE_TYPE_IMSE == monstatus) {\n+\t\t\taddr = setCurrentExceptionNLSWithArgsFromJIT(currentThread, J9NLS_VM_ERROR_BYTECODE_OBJECTREF_CANNOT_BE_VALUE_TYPE, J9VMCONSTANTPOOL_JAVALANGILLEGALMONITORSTATEEXCEPTION);\n+\t\t} else", "originalCommit": "4cb0a1e0dc50a305b693edcea6b70ea731738d0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIzNzAwMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8889#discussion_r400237002", "bodyText": "If you move the brace down, you can avoid the ifdef at the end whch contains only a brace.", "author": "gacholio", "createdAt": "2020-03-30T14:29:21Z", "path": "runtime/oti/ObjectMonitor.hpp", "diffHunk": "@@ -267,9 +267,15 @@ class VM_ObjectMonitor\n \tinlineFastObjectMonitorEnter(J9VMThread *currentThread, j9object_t object)\n \t{\n \t\tbool locked = false;\n-\t\tif (LN_HAS_LOCKWORD(currentThread, object)) {\n-\t\t\tlocked = inlineFastInitAndEnterMonitor(currentThread, J9OBJECT_MONITOR_EA(currentThread, object));\n+#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)\n+\t\tif (!J9_IS_J9CLASS_VALUETYPE(J9OBJECT_CLAZZ(currentThread, object))) {", "originalCommit": "4cb0a1e0dc50a305b693edcea6b70ea731738d0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIzNzYyNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8889#discussion_r400237627", "bodyText": "Not sure why this was removed.", "author": "gacholio", "createdAt": "2020-03-30T14:30:06Z", "path": "runtime/vm/BytecodeInterpreter.hpp", "diffHunk": "@@ -149,7 +149,6 @@ class INTERPRETER_CLASS\n #endif\n \tMM_ObjectAllocationAPI _objectAllocate;\n \tMM_ObjectAccessBarrierAPI _objectAccessBarrier;\n-", "originalCommit": "4cb0a1e0dc50a305b693edcea6b70ea731738d0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIzOTU4Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8889#discussion_r400239587", "bodyText": "syncObject may no longer be valid after enterObjectMonitor.", "author": "gacholio", "createdAt": "2020-03-30T14:32:39Z", "path": "runtime/vm/BytecodeInterpreter.hpp", "diffHunk": "@@ -1649,12 +1661,25 @@ obj:;\n \t\t\trc = GOTO_ASYNC_CHECK;\n \t\t\tgoto done;\n \t\t}\n-\t\tif (0 == monitorRC) {\n-\t\t\t/* Monitor was not entered - hide the frame to prevent exception throw from processing it.\n-\t\t\t * Note that BP can not have changed during a failed enter.\n-\t\t\t */\n+\n+\t\tif (monitorRC < J9_OBJECT_MONITOR_BLOCKING) {\n \t\t\t*bp |= J9SF_A0_INVISIBLE_TAG;\n-\t\t\trc = THROW_MONITOR_ALLOC_FAIL;\n+#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)\n+\t\t\tif (J9_OBJECT_MONITOR_VALUE_TYPE_IMSE == monitorRC) {\n+\t\t\t\tJ9UTF8 *badClassName = J9ROMCLASS_CLASSNAME(J9OBJECT_CLAZZ(_currentThread, syncObject)->romClass);", "originalCommit": "4cb0a1e0dc50a305b693edcea6b70ea731738d0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI0MDc0NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8889#discussion_r400240744", "bodyText": "Hmm, maybe this is OK based on the comment above about not releasing VM access in any failure case.", "author": "gacholio", "createdAt": "2020-03-30T14:34:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIzOTU4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI0MTYzOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8889#discussion_r400241639", "bodyText": "Do you need to handle other cases here (are we 100% sure Thread will never be a VT?)", "author": "gacholio", "createdAt": "2020-03-30T14:35:14Z", "path": "runtime/vm/BytecodeInterpreter.hpp", "diffHunk": "@@ -2584,10 +2633,10 @@ done:;\n \t\tj9object_t threadLock = J9VMJAVALANGTHREAD_LOCK(_currentThread, _currentThread->threadObject);\n \t\tif (!VM_ObjectMonitor::inlineFastObjectMonitorEnter(_currentThread, threadLock)) {\n \t\t\tIDATA monitorRC = objectMonitorEnterNonBlocking(_currentThread, threadLock);\n-\t\t\tif (0 == monitorRC) {\n+\t\t\tif (J9_OBJECT_MONITOR_OOM == monitorRC) {\n \t\t\t\trc = THROW_MONITOR_ALLOC_FAIL;\n \t\t\t\tgoto done;\n-\t\t\t} else if (1 == monitorRC) {\n+\t\t\t} else if (J9_OBJECT_MONITOR_BLOCKING == monitorRC) {", "originalCommit": "4cb0a1e0dc50a305b693edcea6b70ea731738d0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI4MzAwMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8889#discussion_r400283001", "bodyText": "j.l.Thread has a known subclass ForkJoinWorkerThread so it could never be a valuetype", "author": "tajila", "createdAt": "2020-03-30T15:27:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI0MTYzOQ=="}], "type": "inlineReview"}, {"oid": "4e81c0c1b6164c0642f9c5d5bd9d4afaead5d509", "url": "https://github.com/eclipse-openj9/openj9/commit/4e81c0c1b6164c0642f9c5d5bd9d4afaead5d509", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-30T15:29:50Z", "type": "forcePushed"}, {"oid": "77d46801edc1023eb35a8c4124bf143cf728984b", "url": "https://github.com/eclipse-openj9/openj9/commit/77d46801edc1023eb35a8c4124bf143cf728984b", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-30T15:31:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI4OTE3MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8889#discussion_r400289171", "bodyText": "Could goto done here as well for consistency, but I won't insist.", "author": "gacholio", "createdAt": "2020-03-30T15:35:20Z", "path": "runtime/codert_vm/cnathelp.cpp", "diffHunk": "@@ -1147,14 +1156,23 @@ slow_jitMonitorEnterImpl(J9VMThread *currentThread, bool forMethod)\n \t\t\t\tresolveFrame->specialFrameFlags = (resolveFrame->specialFrameFlags & ~J9_STACK_FLAGS_JIT_FRAME_SUB_TYPE_MASK) | J9_STACK_FLAGS_JIT_FAILED_METHOD_MONITOR_ENTER_RESOLVE;\n \t\t\t}\n \t\t}\n-\t\taddr = setNativeOutOfMemoryErrorFromJIT(currentThread, J9NLS_VM_FAILED_TO_ALLOCATE_MONITOR);\n+#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)\n+\t\tif (J9_OBJECT_MONITOR_VALUE_TYPE_IMSE == monstatus) {\n+\t\t\taddr = setCurrentExceptionNLSWithArgsFromJIT(currentThread, J9NLS_VM_ERROR_BYTECODE_OBJECTREF_CANNOT_BE_VALUE_TYPE, J9VMCONSTANTPOOL_JAVALANGILLEGALMONITORSTATEEXCEPTION);\n+\t\t\tgoto done;\n+\t\t}\n+#endif /* defined(J9VM_OPT_VALHALLA_VALUE_TYPES) */\n+\t\tif (J9_OBJECT_MONITOR_OOM == monstatus) {\n+\t\t\taddr = setNativeOutOfMemoryErrorFromJIT(currentThread, J9NLS_VM_FAILED_TO_ALLOCATE_MONITOR);", "originalCommit": "77d46801edc1023eb35a8c4124bf143cf728984b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "176dc185b6eca45d59a9a845437d6d22a568b852", "url": "https://github.com/eclipse-openj9/openj9/commit/176dc185b6eca45d59a9a845437d6d22a568b852", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-30T15:40:13Z", "type": "commit"}, {"oid": "176dc185b6eca45d59a9a845437d6d22a568b852", "url": "https://github.com/eclipse-openj9/openj9/commit/176dc185b6eca45d59a9a845437d6d22a568b852", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-03-30T15:40:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM1OTI5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8889#discussion_r400359293", "bodyText": "There are many copies of this code - should be helperized, preferrably with a new bytecode action (you'll have to store the syncObject somewhere in the vmThread or interpreter instance to pass it along).", "author": "gacholio", "createdAt": "2020-03-30T17:16:48Z", "path": "runtime/vm/BytecodeInterpreter.hpp", "diffHunk": "@@ -1649,12 +1662,25 @@ obj:;\n \t\t\trc = GOTO_ASYNC_CHECK;\n \t\t\tgoto done;\n \t\t}\n-\t\tif (0 == monitorRC) {\n-\t\t\t/* Monitor was not entered - hide the frame to prevent exception throw from processing it.\n-\t\t\t * Note that BP can not have changed during a failed enter.\n-\t\t\t */\n+\n+\t\tif (monitorRC < J9_OBJECT_MONITOR_BLOCKING) {\n \t\t\t*bp |= J9SF_A0_INVISIBLE_TAG;\n-\t\t\trc = THROW_MONITOR_ALLOC_FAIL;\n+#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)\n+\t\t\tif (J9_OBJECT_MONITOR_VALUE_TYPE_IMSE == monitorRC) {\n+\t\t\t\tJ9UTF8 *badClassName = J9ROMCLASS_CLASSNAME(J9OBJECT_CLAZZ(_currentThread, syncObject)->romClass);", "originalCommit": "176dc185b6eca45d59a9a845437d6d22a568b852", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1b0e495c813b9442b97fc227bf6ba5181d39dcc1", "url": "https://github.com/eclipse-openj9/openj9/commit/1b0e495c813b9442b97fc227bf6ba5181d39dcc1", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T19:17:00Z", "type": "forcePushed"}, {"oid": "b780aa306cc78d8df1682cd60007432487976844", "url": "https://github.com/eclipse-openj9/openj9/commit/b780aa306cc78d8df1682cd60007432487976844", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T19:19:15Z", "type": "forcePushed"}, {"oid": "23ce00a265a3ad28353822f6c10c3cf9a4ba4dfb", "url": "https://github.com/eclipse-openj9/openj9/commit/23ce00a265a3ad28353822f6c10c3cf9a4ba4dfb", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T19:22:47Z", "type": "forcePushed"}, {"oid": "762b38ada4196650a4b2141d8bd8752b2bdb3eee", "url": "https://github.com/eclipse-openj9/openj9/commit/762b38ada4196650a4b2141d8bd8752b2bdb3eee", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T19:24:42Z", "type": "forcePushed"}, {"oid": "afbec9b4b81c9537abeff514433e1f42c56e726d", "url": "https://github.com/eclipse-openj9/openj9/commit/afbec9b4b81c9537abeff514433e1f42c56e726d", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T19:25:36Z", "type": "forcePushed"}, {"oid": "18822b09a7498433b307dcfbd5935d2db40c70ed", "url": "https://github.com/eclipse-openj9/openj9/commit/18822b09a7498433b307dcfbd5935d2db40c70ed", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T19:34:58Z", "type": "forcePushed"}, {"oid": "0045e91c2baf6425e602db2ec89aa948d14cdcf2", "url": "https://github.com/eclipse-openj9/openj9/commit/0045e91c2baf6425e602db2ec89aa948d14cdcf2", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T19:37:44Z", "type": "forcePushed"}, {"oid": "6e6b87ebf64b4a7c2e51c8627911f5e95bb21a71", "url": "https://github.com/eclipse-openj9/openj9/commit/6e6b87ebf64b4a7c2e51c8627911f5e95bb21a71", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T19:38:23Z", "type": "forcePushed"}, {"oid": "10131cba03264983674e8617919b58d9008afd8f", "url": "https://github.com/eclipse-openj9/openj9/commit/10131cba03264983674e8617919b58d9008afd8f", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T20:06:26Z", "type": "commit"}, {"oid": "10131cba03264983674e8617919b58d9008afd8f", "url": "https://github.com/eclipse-openj9/openj9/commit/10131cba03264983674e8617919b58d9008afd8f", "message": "Add valueType checks to monitor enter\n\nThe change updates the non-blocking monitor enter code to detect\nvaluetype receivers and return an appropriate error code. This means\nthat the `1 == rc` check that is currently being done will not work as\nthere is now more than one error code in the non-blocking enter case.\n\nInstead the following check must be done:\n`(monstatus < J9_OBJECT_MONITOR_BLOCKING)`\n\nMore error codes may be added in the future.\n\nIt is not necessarry to modify the monitorExit code in the case of\nvaluetypes because the monitorExit code will throw IMSE if the receiver\nis not locked. So it is only necesarry to disallow valueType receiver\nfrom being locked in the first place.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>\n\n# Conflicts:\n#\truntime/oti/ObjectMonitor.hpp\n#\truntime/vm/ObjectMonitor.cpp", "committedDate": "2020-03-30T20:06:26Z", "type": "forcePushed"}]}