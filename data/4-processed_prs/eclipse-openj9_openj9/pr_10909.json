{"pr_number": 10909, "pr_title": "Cull stack depth in dumpAllThreads later on", "pr_createdAt": "2020-10-16T16:58:15Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10909", "timeline": [{"oid": "8b021133b3391ee69b3e8dfcc2b1ca551cc295ad", "url": "https://github.com/eclipse-openj9/openj9/commit/8b021133b3391ee69b3e8dfcc2b1ca551cc295ad", "message": "Cull stack depth in dumpAllThreads later on\n\nWe need the full stacktrace from getThreadInfo function since later in the\ncreateThreadInfoArray, we copy over MonitorInfo objects which may refer to\nstack frames beyond the max depth argument passed into dumpAllThreads.\n\nSigned-off-by: Mike Zhang <mike.h.zhang@ibm.com>", "committedDate": "2020-10-16T16:46:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcxMTA5Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10909#discussion_r506711092", "bodyText": "This line is over-indented.", "author": "gacholio", "createdAt": "2020-10-16T20:41:20Z", "path": "test/functional/Java10andUp/src/org/openj9/test/java/lang/management/ThreadMXBean/APITestJava10.java", "diffHunk": "@@ -207,6 +207,22 @@ public void testDumpLimitsWithLambdas() {\n \t\tcheckThreadInfo(REQUESTED_DEPTH, t);\n \t}\n \n+\t/* ThreadInfo objects contain MonitorInfo objects which carry stack depth info that can be higher than\n+\t * max depth passed to dumpAllThreads. dumpAllThreads should still produce the ThreadInfo objects.\n+\t * See https://github.com/eclipse/openj9/issues/10796\n+\t */\n+\t@Test(groups = { \"level.extended\" })\n+\tpublic void testDumpWithMonitorDepthHigherThanLimit() {\n+\t\ttry {\n+\t\t\tThreadInfo[] threads = myBean.dumpAllThreads(true, true, 1);\n+\t\t\tfor (ThreadInfo thInfo : threads) {\n+\t\t\t\t\tAssert.assertTrue(thInfo.getStackTrace().length <= 1, \"Stack depth should be truncated to 1\");", "originalCommit": "7e8952652dc7209ebcb564ed9ac484c78676dd30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcyNTE2MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10909#discussion_r506725160", "bodyText": "Updated the PR.", "author": "mikezhang1234567890", "createdAt": "2020-10-16T21:17:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcxMTA5Mg=="}], "type": "inlineReview"}, {"oid": "7ffa4f921b49b0f59fca0a18ba5e706aaea0d929", "url": "https://github.com/eclipse-openj9/openj9/commit/7ffa4f921b49b0f59fca0a18ba5e706aaea0d929", "message": "Add test for dumpAllThreads\n\nWhen a thread contains a monitor referring to a stack depth higher than\nmaxDepth passed to dumpAllThreads\n\nSigned-off-by: Mike Zhang <mike.h.zhang@ibm.com>", "committedDate": "2020-10-16T20:45:44Z", "type": "commit"}, {"oid": "7ffa4f921b49b0f59fca0a18ba5e706aaea0d929", "url": "https://github.com/eclipse-openj9/openj9/commit/7ffa4f921b49b0f59fca0a18ba5e706aaea0d929", "message": "Add test for dumpAllThreads\n\nWhen a thread contains a monitor referring to a stack depth higher than\nmaxDepth passed to dumpAllThreads\n\nSigned-off-by: Mike Zhang <mike.h.zhang@ibm.com>", "committedDate": "2020-10-16T20:45:44Z", "type": "forcePushed"}]}