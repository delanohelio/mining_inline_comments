{"pr_number": 9983, "pr_title": "Delete dead code for a no longer applicable compiler bug", "pr_createdAt": "2020-06-23T14:12:24Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9983", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5ODc3OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9983#discussion_r444298779", "bodyText": "I don't think we have information on which compiler version was affected? I'd be more comfortable with this change if the checks here are re-written to use OMR_ARE_ANY_BITS_SET(), i.e. !OMR_ARE_ANY_BITS_SET(localRuntimeFlags, J9SHR_RUNTIMEFLAG_CACHE_INITIALIZATION_COMPLETE) etc.", "author": "pshipton", "createdAt": "2020-06-23T15:08:32Z", "path": "runtime/shared_common/shrinit.cpp", "diffHunk": "@@ -1471,10 +1468,6 @@ hookFindSharedClass(J9HookInterface** hookInterface, UDATA eventNum, void* voidD\n \t\ttestForBytecodeModification(vm);\n \t}\n \n-#ifdef LINUXPPC\n-\tcompilerBugWorkaround = localRuntimeFlags & J9SHR_RUNTIMEFLAG_CACHE_INITIALIZATION_COMPLETE;\n-#endif\n-\n \tif (!(localRuntimeFlags & J9SHR_RUNTIMEFLAG_CACHE_INITIALIZATION_COMPLETE) ||", "originalCommit": "36ecabbbf9cb45a4f06baa58389bc7de9570a2fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxODM4OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9983#discussion_r444418388", "bodyText": "do you have any preference on OMR_ARE_ANY_BITS_SET vs J9_ARE_ANY_BITS_SET ? I'm inclined to use the J9 version as it is used elsewhere in the file", "author": "dnakamura", "createdAt": "2020-06-23T18:17:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5ODc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ1OTk3Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9983#discussion_r444459973", "bodyText": "Sure, J9_ARE_ANY_BITS_SET is good.", "author": "pshipton", "createdAt": "2020-06-23T19:34:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5ODc3OQ=="}], "type": "inlineReview"}, {"oid": "21f0f38b863901a6b19926ca27f3b9d192da7d97", "url": "https://github.com/eclipse-openj9/openj9/commit/21f0f38b863901a6b19926ca27f3b9d192da7d97", "message": "Delete dead code for a no longer applicable compiler bug\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-06-23T19:38:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAwMDgzOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9983#discussion_r445000839", "bodyText": "Pls add some spaces around ==.", "author": "pshipton", "createdAt": "2020-06-24T15:57:13Z", "path": "runtime/shared_common/shrinit.cpp", "diffHunk": "@@ -1471,15 +1468,11 @@ hookFindSharedClass(J9HookInterface** hookInterface, UDATA eventNum, void* voidD\n \t\ttestForBytecodeModification(vm);\n \t}\n \n-#ifdef LINUXPPC\n-\tcompilerBugWorkaround = localRuntimeFlags & J9SHR_RUNTIMEFLAG_CACHE_INITIALIZATION_COMPLETE;\n-#endif\n-\n-\tif (!(localRuntimeFlags & J9SHR_RUNTIMEFLAG_CACHE_INITIALIZATION_COMPLETE) ||\n-\t\t(localRuntimeFlags & J9SHR_RUNTIMEFLAG_DENY_CACHE_ACCESS) ||\n-\t\t((localRuntimeFlags & J9SHR_RUNTIMEFLAG_BYTECODE_AGENT_RUNNING) &&\n-\t\t(sharedClassConfig->modContext==NULL) &&\n-\t\t(0 == (localRuntimeFlags & J9SHR_RUNTIMEFLAG_ENABLE_BCI)))\n+\tif (J9_ARE_NO_BITS_SET(localRuntimeFlags, J9SHR_RUNTIMEFLAG_CACHE_INITIALIZATION_COMPLETE) ||\n+\t\tJ9_ARE_ANY_BITS_SET(localRuntimeFlags, J9SHR_RUNTIMEFLAG_DENY_CACHE_ACCESS) ||\n+\t\t(J9_ARE_ANY_BITS_SET(localRuntimeFlags, J9SHR_RUNTIMEFLAG_BYTECODE_AGENT_RUNNING) &&\n+\t\t(NULL==sharedClassConfig->modContext) &&", "originalCommit": "21f0f38b863901a6b19926ca27f3b9d192da7d97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e630cba3f68cb167d797ad4ec26220ac17423642", "url": "https://github.com/eclipse-openj9/openj9/commit/e630cba3f68cb167d797ad4ec26220ac17423642", "message": "Delete dead code for a no longer applicable compiler bug\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-06-25T14:44:06Z", "type": "commit"}, {"oid": "e630cba3f68cb167d797ad4ec26220ac17423642", "url": "https://github.com/eclipse-openj9/openj9/commit/e630cba3f68cb167d797ad4ec26220ac17423642", "message": "Delete dead code for a no longer applicable compiler bug\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-06-25T14:44:06Z", "type": "forcePushed"}]}