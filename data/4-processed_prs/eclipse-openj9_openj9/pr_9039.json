{"pr_number": 9039, "pr_title": "Clarify contract of findROMClassFromPC() method", "pr_createdAt": "2020-03-31T13:13:00Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9039", "timeline": [{"oid": "2c5b6371fb00882f12a89640e87fd29cc5288422", "url": "https://github.com/eclipse-openj9/openj9/commit/2c5b6371fb00882f12a89640e87fd29cc5288422", "message": "Clarify contract of findROMClassFromPC() method\n\nDiscovered thru a painful debug session that this API will\nalways return the vm->systemClassLoader for any ROMClass\nfound in the SharedClasses cache.  This is regardless of\nwhich classloader actually loaded the class.\n\nSigned-off-by: Dan Heidinga <daniel_heidinga@ca.ibm.com>", "committedDate": "2020-03-30T20:27:58Z", "type": "commit"}, {"oid": "feefd3cff894e0c11bb004d02a5d81beb65bb93e", "url": "https://github.com/eclipse-openj9/openj9/commit/feefd3cff894e0c11bb004d02a5d81beb65bb93e", "message": "Fetch mutex into a local to avoid repeated fetch\n\nSigned-off-by: Dan Heidinga <daniel_heidinga@ca.ibm.com>", "committedDate": "2020-03-30T20:31:41Z", "type": "commit"}, {"oid": "3004583de55fab81740d09aa54e13212daee9221", "url": "https://github.com/eclipse-openj9/openj9/commit/3004583de55fab81740d09aa54e13212daee9221", "message": "Update copyrights\n\nSigned-off-by: Dan Heidinga <daniel_heidinga@ca.ibm.com>", "committedDate": "2020-03-31T13:18:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5ODk0NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9039#discussion_r400998944", "bodyText": "May as well assign this in the declaration - if THR_PREEMPTIVE is off (which it never is), the code would fail to compile because of an unused variable. Suggest getting rid of the ifdefs while you're here.", "author": "gacholio", "createdAt": "2020-03-31T15:19:28Z", "path": "runtime/vm/classseg.c", "diffHunk": "@@ -108,10 +107,12 @@ allocateClassMemorySegment(J9JavaVM *javaVM, UDATA requiredSize, UDATA segmentTy\n {\n \tUDATA appropriateSize = 0;\n \tJ9MemorySegment *memorySegment = NULL;\n+\tomrthread_monitor_t segmentMutex = NULL;\n \t\n #if defined(J9VM_THR_PREEMPTIVE)\n-\tif (javaVM->classMemorySegments->segmentMutex) {\n-\t\tomrthread_monitor_enter(javaVM->classMemorySegments->segmentMutex);\n+\tsegmentMutex = javaVM->classMemorySegments->segmentMutex;", "originalCommit": "3004583de55fab81740d09aa54e13212daee9221", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTAyOTI2Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9039#discussion_r401029263", "bodyText": "Updated as suggested", "author": "DanHeidinga", "createdAt": "2020-03-31T15:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5ODk0NA=="}], "type": "inlineReview"}, {"oid": "e88114167824b39200931b5699d1f5876f8595e5", "url": "https://github.com/eclipse-openj9/openj9/commit/e88114167824b39200931b5699d1f5876f8595e5", "message": "Remove always true J9VM_THR_PREEMPTIVE flag\n\nSigned-off-by: Dan Heidinga <daniel_heidinga@ca.ibm.com>", "committedDate": "2020-03-31T15:58:02Z", "type": "commit"}]}