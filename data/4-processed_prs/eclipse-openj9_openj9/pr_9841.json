{"pr_number": 9841, "pr_title": "Inlined version of recognized methods", "pr_createdAt": "2020-06-10T09:01:54Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9841", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg0OTc4OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9841#discussion_r438849788", "bodyText": "If you copied this implementation from x86, can you copy the comments that were in that code as well?  It helps to explain what this code is trying to achieve.", "author": "0xdaryl", "createdAt": "2020-06-11T14:58:50Z", "path": "runtime/compiler/aarch64/codegen/J9TreeEvaluator.cpp", "diffHunk": "@@ -1693,6 +1693,19 @@ J9::ARM64::CodeGenerator::inlineDirectCall(TR::Node *node, TR::Register *&result\n       {\n       switch (methodSymbol->getRecognizedMethod())\n          {\n+         case TR::java_nio_Bits_keepAlive:\n+         case TR::java_lang_ref_Reference_reachabilityFence:\n+            {\n+            TR::Node *paramNode = node->getFirstChild();", "originalCommit": "a1b45af1bccef9a623fe6731995de034cc3c92fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzA2MTMwOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9841#discussion_r597061308", "bodyText": "I find the placement of these comments to be a bit odd.  Can you move them down below the opening brace like x86 has them?  Also, remove the specific reference to keepAlive as this applies to a couple of different recognized methods.  Maybe say \"these functions\" instead?", "author": "0xdaryl", "createdAt": "2021-03-18T16:47:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg0OTc4OA=="}], "type": "inlineReview"}, {"oid": "41f2f9c748429b6962849dc53f02c53f05197061", "url": "https://github.com/eclipse-openj9/openj9/commit/41f2f9c748429b6962849dc53f02c53f05197061", "message": "Inlined version of recognized methods\n\njava_nio_Bits_keepAlive and java_lang_ref_Reference_reachabilityFence\n have been added by consulting the semantics on other architectures.\n\nIssue: #7137\n\nSigned-off-by: Siri Sahithi Ponangi <sahithi.ponangi@unb.ca>", "committedDate": "2020-06-15T19:50:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTMwNDc4NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9841#discussion_r461304785", "bodyText": "There is a trailing space at the end of this line.", "author": "knn-k", "createdAt": "2020-07-28T04:05:44Z", "path": "runtime/compiler/aarch64/codegen/J9TreeEvaluator.cpp", "diffHunk": "@@ -1928,6 +1928,28 @@ J9::ARM64::CodeGenerator::inlineDirectCall(TR::Node *node, TR::Register *&result\n       {\n       switch (methodSymbol->getRecognizedMethod())\n          {\n+         case TR::java_nio_Bits_keepAlive:\n+         // The only purpose of keepAlive is to prevent an otherwise\n+         // unreachable object from being garbage collected, because we don't\n+         // want its finalizer to be called too early.  There's no need to\n+         // generate a full-blown call site just for this purpose.\n+         case TR::java_lang_ref_Reference_reachabilityFence: ", "originalCommit": "41f2f9c748429b6962849dc53f02c53f05197061", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "148ad1a4eecb4ac2b5b735b2072b7cd2bd0eb903", "url": "https://github.com/eclipse-openj9/openj9/commit/148ad1a4eecb4ac2b5b735b2072b7cd2bd0eb903", "message": "Inlined version of recognized methods\n\njava_nio_Bits_keepAlive and java_lang_ref_Reference_reachabilityFence\n have been added to prevent them from being collected.\n\nIssue: #7137\n\nSigned-off-by: Siri Sahithi Ponangi <sahithi.ponangi@unb.ca>", "committedDate": "2020-07-28T13:38:25Z", "type": "forcePushed"}, {"oid": "81edd3dacae21119f33cc8bbd571862cd3cd5725", "url": "https://github.com/eclipse-openj9/openj9/commit/81edd3dacae21119f33cc8bbd571862cd3cd5725", "message": "Inlined version of recognized methods\n\njava_nio_Bits_keepAlive and java_lang_ref_Reference_reachabilityFence\n have been added to prevent them from being collected.\n\nIssue: #7137\n\nSigned-off-by: Siri Sahithi Ponangi <sahithi.ponangi@unb.ca>", "committedDate": "2021-03-18T17:09:21Z", "type": "commit"}, {"oid": "81edd3dacae21119f33cc8bbd571862cd3cd5725", "url": "https://github.com/eclipse-openj9/openj9/commit/81edd3dacae21119f33cc8bbd571862cd3cd5725", "message": "Inlined version of recognized methods\n\njava_nio_Bits_keepAlive and java_lang_ref_Reference_reachabilityFence\n have been added to prevent them from being collected.\n\nIssue: #7137\n\nSigned-off-by: Siri Sahithi Ponangi <sahithi.ponangi@unb.ca>", "committedDate": "2021-03-18T17:09:21Z", "type": "forcePushed"}]}