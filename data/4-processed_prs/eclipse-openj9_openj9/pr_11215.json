{"pr_number": 11215, "pr_title": "Add cpu feature info to javacore", "pr_createdAt": "2020-11-17T23:11:12Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11215", "timeline": [{"oid": "99c99e74800af11b043a5e1233af7c5e4601e575", "url": "https://github.com/eclipse-openj9/openj9/commit/99c99e74800af11b043a5e1233af7c5e4601e575", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-11-17T23:13:30Z", "type": "forcePushed"}, {"oid": "d191f69018aef415f64586c5747469922d16a07a", "url": "https://github.com/eclipse-openj9/openj9/commit/d191f69018aef415f64586c5747469922d16a07a", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-11-17T23:32:25Z", "type": "forcePushed"}, {"oid": "e02751afd0d6d3bbd0c10dea1c1ef1024424ca53", "url": "https://github.com/eclipse-openj9/openj9/commit/e02751afd0d6d3bbd0c10dea1c1ef1024424ca53", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-11-18T19:37:45Z", "type": "forcePushed"}, {"oid": "634820c603cc157411663d2db033985c2c6b51b2", "url": "https://github.com/eclipse-openj9/openj9/commit/634820c603cc157411663d2db033985c2c6b51b2", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-11-23T21:25:36Z", "type": "forcePushed"}, {"oid": "e02ea584e7691d15ee127e802277a470fed8d612", "url": "https://github.com/eclipse-openj9/openj9/commit/e02ea584e7691d15ee127e802277a470fed8d612", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-12-02T17:37:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUzNjQ1OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11215#discussion_r534536459", "bodyText": "If the buffer isn't big enough and the string is cut off, it won't have a \\n at the end.", "author": "pshipton", "createdAt": "2020-12-02T22:53:02Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -5291,7 +5292,29 @@ JavaCoreDumpWriter::writeCPUinfo(void)\n \t_OutputStream.writeCharacters(\n \t\t\t\"2CITARGETCPU   Target CPUs: \");\n \t_OutputStream.writeInteger(target, \"%i\\n\");\n+\t\n+\tint BUFF_SIZE = 400;\n+\tchar buff[BUFF_SIZE];\n+\tif (_VirtualMachine->jitConfig) {\n+\t\t_OutputStream.writeCharacters(\n+\t\t\t\t\"2CIJITFEATURE  CPU features (JIT): \");\n+\t\tomrsysinfo_get_processor_feature_string(&_VirtualMachine->jitConfig->targetProcessor, buff, BUFF_SIZE);\n+\t\t_OutputStream.writeCharacters(buff);", "originalCommit": "e02ea584e7691d15ee127e802277a470fed8d612", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUzNzk2Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/11215#discussion_r534537966", "bodyText": "I think it would be better, more flexible, if omrsysinfo_get_processor_feature_string() didn't include the \\n and that was handled here. Not every use of omrsysinfo_get_processor_feature_string() may want \\n at the end. Ideally there would also be a return value to indicate if the buffer was big enough or not.", "author": "pshipton", "createdAt": "2020-12-02T22:56:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUzNjQ1OQ=="}], "type": "inlineReview"}, {"oid": "2c8326f4749222b29d36baa896fafa02f013cb70", "url": "https://github.com/eclipse-openj9/openj9/commit/2c8326f4749222b29d36baa896fafa02f013cb70", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-12-03T02:48:12Z", "type": "forcePushed"}, {"oid": "a457992637fdadeafcf8d3b6a5c453354af0ef81", "url": "https://github.com/eclipse-openj9/openj9/commit/a457992637fdadeafcf8d3b6a5c453354af0ef81", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-12-03T02:49:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQwOTY2OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11215#discussion_r535409669", "bodyText": "Why do we need both of these? Which one is used for what?", "author": "fjeremic", "createdAt": "2020-12-03T16:55:46Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -5263,6 +5263,7 @@ void\n JavaCoreDumpWriter::writeCPUinfo(void)\n {\n \tPORT_ACCESS_FROM_PORT(_PortLibrary);\n+\tOMRPORT_ACCESS_FROM_J9PORT(_PortLibrary);", "originalCommit": "a457992637fdadeafcf8d3b6a5c453354af0ef81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQyNDE1Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/11215#discussion_r535424152", "bodyText": "j9sysinfo_get_number_CPUs_by_type uses PORT_ACCESS_FROM_PORT(_PortLibrary);\nomrsysinfo_get_processor_feature_string uses OMRPORT_ACCESS_FROM_J9PORT(_PortLibrary);", "author": "harryyu1994", "createdAt": "2020-12-03T17:10:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQwOTY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ1Mjc0MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11215#discussion_r535452741", "bodyText": "Are we able to just use omrsysinfo_get_number_CPUs_by_type? Not sure what the J9 version provides here.", "author": "fjeremic", "createdAt": "2020-12-03T17:51:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQwOTY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxNjE0MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11215#discussion_r535516140", "bodyText": "yea i think we can.\n#define j9sysinfo_get_number_CPUs_by_type(param1) OMRPORT_FROM_J9PORT(privatePortLibrary)->sysinfo_get_number_CPUs_by_type(OMRPORT_FROM_J9PORT(privatePortLibrary),param1)\n\nthey are equivalent", "author": "harryyu1994", "createdAt": "2020-12-03T19:22:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQwOTY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUzMjkyMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11215#discussion_r535532921", "bodyText": "Everything in the OMR port library at the time OMR was created got j9 macros so the code didn't all need to be modified. No issues with using the omr variants directly.", "author": "pshipton", "createdAt": "2020-12-03T19:41:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQwOTY2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQxMTI5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11215#discussion_r535411293", "bodyText": "Are we able to fold BUFF_SIZE into buff and replace uses of BUFF_SIZE with sizeof(buff)?", "author": "fjeremic", "createdAt": "2020-12-03T16:57:22Z", "path": "runtime/rasdump/javadump.cpp", "diffHunk": "@@ -5291,7 +5292,38 @@ JavaCoreDumpWriter::writeCPUinfo(void)\n \t_OutputStream.writeCharacters(\n \t\t\t\"2CITARGETCPU   Target CPUs: \");\n \t_OutputStream.writeInteger(target, \"%i\\n\");\n+\t\n+\tint BUFF_SIZE = 400;\n+\tchar buff[BUFF_SIZE];", "originalCommit": "a457992637fdadeafcf8d3b6a5c453354af0ef81", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8b385ff7516760d36e218a456fb3901bf98f3f36", "url": "https://github.com/eclipse-openj9/openj9/commit/8b385ff7516760d36e218a456fb3901bf98f3f36", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-12-03T17:14:28Z", "type": "forcePushed"}, {"oid": "ee5c5ee46f72c35ef10c063252337b80a23f5b8c", "url": "https://github.com/eclipse-openj9/openj9/commit/ee5c5ee46f72c35ef10c063252337b80a23f5b8c", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-12-03T19:26:59Z", "type": "commit"}, {"oid": "ee5c5ee46f72c35ef10c063252337b80a23f5b8c", "url": "https://github.com/eclipse-openj9/openj9/commit/ee5c5ee46f72c35ef10c063252337b80a23f5b8c", "message": "Add cpu feature info to javacore\n\nIssue: #11184\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-12-03T19:26:59Z", "type": "forcePushed"}]}