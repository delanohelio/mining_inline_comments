{"pr_number": 8944, "pr_title": "Runtime compressed refs work", "pr_createdAt": "2020-03-22T22:19:19Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8944", "timeline": [{"oid": "d5e55dee37aa98a4e3d3eaa6904e7cf2ad2fc212", "url": "https://github.com/eclipse-openj9/openj9/commit/d5e55dee37aa98a4e3d3eaa6904e7cf2ad2fc212", "message": "Runtime compressed refs work\n\nGet the P JIT working in mixed mode. This PR does not address the crypto\ncode.\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>", "committedDate": "2020-03-23T15:56:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzNTkwNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8944#discussion_r397935906", "bodyText": "rather having a taken branch always, we can have a sequence of no taken branch for one way:\nladdr  dest, J9TR_VMThreadCompressObjectReferences(r15)\ncmpli cr0, CmpAddr, dest, 0\nladdr dest, J9TR_J9Object_class(src)\nbeq  +8\nlwz dest, J9TR_J9Object_class(src)", "author": "zl-wang", "createdAt": "2020-03-25T15:15:55Z", "path": "runtime/compiler/p/runtime/PicBuilder.spp", "diffHunk": "@@ -64,6 +64,22 @@\n #define maskVFT(reg)    rlwinm reg, reg, 0, 0, 31-J9TR_RequiredClassAlignmentInBits\n #endif\n \n+#if defined(OMR_GC_COMPRESSED_POINTERS)\n+#if defined(OMR_GC_FULL_POINTERS)\n+#define LOAD_CLASS(dest, src) \\\n+\tladdr dest,J9TR_VMThreadCompressObjectReferences(r15) ; \\\n+\tcmpli cr0, CmpAddr, dest, 0 ; \\\n+\tbeq $+12 ; \\\n+\tlwz dest, J9TR_J9Object_class(src) ; \\\n+\tb $+8 ; \\\n+\tladdr dest, J9TR_J9Object_class(src)", "originalCommit": "d5e55dee37aa98a4e3d3eaa6904e7cf2ad2fc212", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk3MTA3NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8944#discussion_r397971075", "bodyText": "Fixed.", "author": "gacholio", "createdAt": "2020-03-25T15:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzNTkwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNzU1NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8944#discussion_r398027554", "bodyText": "Verified that mixed mode still works after this change.", "author": "gacholio", "createdAt": "2020-03-25T17:13:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzNTkwNg=="}], "type": "inlineReview"}, {"oid": "c772fe0298c0852afcd3d061a9363fe10f12e0c3", "url": "https://github.com/eclipse-openj9/openj9/commit/c772fe0298c0852afcd3d061a9363fe10f12e0c3", "message": "Runtime compressed refs work\n\nGet the P JIT working in mixed mode. This PR does not address the crypto\ncode.\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>", "committedDate": "2020-03-25T15:57:39Z", "type": "commit"}, {"oid": "c772fe0298c0852afcd3d061a9363fe10f12e0c3", "url": "https://github.com/eclipse-openj9/openj9/commit/c772fe0298c0852afcd3d061a9363fe10f12e0c3", "message": "Runtime compressed refs work\n\nGet the P JIT working in mixed mode. This PR does not address the crypto\ncode.\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>", "committedDate": "2020-03-25T15:57:39Z", "type": "forcePushed"}]}