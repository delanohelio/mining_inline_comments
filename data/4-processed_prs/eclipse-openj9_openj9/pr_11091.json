{"pr_number": 11091, "pr_title": "Skip self-storing stores", "pr_createdAt": "2020-11-03T18:38:40Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11091", "timeline": [{"oid": "6cb4bad2932f14cf4d628288e7921a673c4b05cd", "url": "https://github.com/eclipse-openj9/openj9/commit/6cb4bad2932f14cf4d628288e7921a673c4b05cd", "message": "Skip self-storing stores\n\nLoading an auto, then storing it to the same auto is a self-store.\nLeaving the store in the tree will make the auto appear variant in\noptimizer.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-03T18:37:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg5NjY1OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11091#discussion_r516896658", "bodyText": "do we have to care about direct rdbars if one was generated? or if we are supposed to generate a wrbar direct?", "author": "andrewcraik", "createdAt": "2020-11-03T19:11:51Z", "path": "runtime/compiler/ilgen/Walker.cpp", "diffHunk": "@@ -7165,6 +7165,13 @@ TR_J9ByteCodeIlGenerator::storeAuto(TR::DataType type, int32_t slot, bool isAdju\n       }\n \n    symRef = symRefTab()->findOrCreateAutoSymbol(_methodSymbol, slot, type, true, false, true, isAdjunct);\n+\n+   // Self-storing, skip the store\n+   if (storeValue->getOpCode().isLoadDirect() && storeValue->getOpCode().hasSymbolReference() && storeValue->getSymbolReference() == symRef)", "originalCommit": "6cb4bad2932f14cf4d628288e7921a673c4b05cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkyNDY4MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11091#discussion_r516924681", "bodyText": "rdbar and wrbar are not used in auto load/store", "author": "liqunl", "createdAt": "2020-11-03T20:03:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg5NjY1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk3NTg2MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11091#discussion_r516975860", "bodyText": "well the opcodes exist, but I guess we can skip for now since we don't use them in OpenJ9 which is a fair point.", "author": "andrewcraik", "createdAt": "2020-11-03T21:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg5NjY1OA=="}], "type": "inlineReview"}]}