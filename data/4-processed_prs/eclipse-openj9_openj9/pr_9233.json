{"pr_number": 9233, "pr_title": "Disable all JIT Hooks at JITServer", "pr_createdAt": "2020-04-13T23:12:00Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9233", "timeline": [{"oid": "22f2e5f70c7c32e6d174fa6b894ea080ea394482", "url": "https://github.com/eclipse-openj9/openj9/commit/22f2e5f70c7c32e6d174fa6b894ea080ea394482", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-13T23:22:11Z", "type": "forcePushed"}, {"oid": "c107f77e0ba87b565431fe22a854917e22b5590f", "url": "https://github.com/eclipse-openj9/openj9/commit/c107f77e0ba87b565431fe22a854917e22b5590f", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-14T15:22:26Z", "type": "forcePushed"}, {"oid": "60b6e66eb0e7088422d8c8fd8041fcdec55c453f", "url": "https://github.com/eclipse-openj9/openj9/commit/60b6e66eb0e7088422d8c8fd8041fcdec55c453f", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-14T15:29:15Z", "type": "forcePushed"}, {"oid": "5da314c899a1d577550661889666ccddb437e058", "url": "https://github.com/eclipse-openj9/openj9/commit/5da314c899a1d577550661889666ccddb437e058", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-14T15:43:10Z", "type": "forcePushed"}, {"oid": "95a3450600a4e78de0fdf8491032b09e2b516f86", "url": "https://github.com/eclipse-openj9/openj9/commit/95a3450600a4e78de0fdf8491032b09e2b516f86", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-14T15:54:21Z", "type": "forcePushed"}, {"oid": "2f7f23abb40f97eed3073b9c7b41eb1b9e26bd73", "url": "https://github.com/eclipse-openj9/openj9/commit/2f7f23abb40f97eed3073b9c7b41eb1b9e26bd73", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-14T16:04:10Z", "type": "forcePushed"}, {"oid": "d9557515b82d0a282fba789089fff90a7414aaf1", "url": "https://github.com/eclipse-openj9/openj9/commit/d9557515b82d0a282fba789089fff90a7414aaf1", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-14T20:21:57Z", "type": "forcePushed"}, {"oid": "dee683173b34874b452654aef709cb9d6e3f3c35", "url": "https://github.com/eclipse-openj9/openj9/commit/dee683173b34874b452654aef709cb9d6e3f3c35", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-14T20:34:07Z", "type": "forcePushed"}, {"oid": "df38bdea1e22aac9d9e9a7c3c31690280aaa0754", "url": "https://github.com/eclipse-openj9/openj9/commit/df38bdea1e22aac9d9e9a7c3c31690280aaa0754", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-14T20:51:56Z", "type": "forcePushed"}, {"oid": "43b0b385d7876880aa429e90005a0cd8e8cb1a24", "url": "https://github.com/eclipse-openj9/openj9/commit/43b0b385d7876880aa429e90005a0cd8e8cb1a24", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-17T20:36:24Z", "type": "forcePushed"}, {"oid": "7c73c51c6b15bdd2b27b359c7b734a8b8b66d857", "url": "https://github.com/eclipse-openj9/openj9/commit/7c73c51c6b15bdd2b27b359c7b734a8b8b66d857", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-17T20:57:35Z", "type": "forcePushed"}, {"oid": "d6b656186f0e760455011b4ba8289d4952ff214c", "url": "https://github.com/eclipse-openj9/openj9/commit/d6b656186f0e760455011b4ba8289d4952ff214c", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-20T15:28:15Z", "type": "forcePushed"}, {"oid": "fe46faff4c71f75192a2f8d6a53e51a664497b7d", "url": "https://github.com/eclipse-openj9/openj9/commit/fe46faff4c71f75192a2f8d6a53e51a664497b7d", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-20T15:30:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc1MzMxOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9233#discussion_r411753319", "bodyText": "If these lines are not needed let's remove them", "author": "mpirvu", "createdAt": "2020-04-20T23:14:04Z", "path": "runtime/compiler/runtime/codertinit.cpp", "diffHunk": "@@ -451,52 +452,62 @@ void codert_init_helpers_and_targets(J9JITConfig * jitConfig, char isSMP)\n    }\n #endif\n \n-   jitConfig->jitGetExceptionTableFromPC = jitGetExceptionTableFromPC;\n-   jitConfig->jitGetStackMapFromPC = getStackMapFromJitPC;\n-   jitConfig->jitGetInlinerMapFromPC = jitGetInlinerMapFromPC;\n-   jitConfig->getJitInlineDepthFromCallSite = getJitInlineDepthFromCallSite;\n-   jitConfig->getJitInlinedCallInfo = getJitInlinedCallInfo;\n-   jitConfig->getStackMapFromJitPC = getStackMapFromJitPC;\n-   jitConfig->getFirstInlinedCallSite = getFirstInlinedCallSite;\n-   jitConfig->getNextInlinedCallSite = getNextInlinedCallSite;\n-   jitConfig->hasMoreInlinedMethods = hasMoreInlinedMethods;\n-   jitConfig->getInlinedMethod = getInlinedMethod;\n-   jitConfig->getByteCodeIndex = getByteCodeIndex;\n-   jitConfig->getByteCodeIndexFromStackMap = getByteCodeIndexFromStackMap;\n-   jitConfig->getCurrentByteCodeIndexAndIsSameReceiver = getCurrentByteCodeIndexAndIsSameReceiver;\n-   jitConfig->getJitRegisterMap = getJitRegisterMap;\n-   jitConfig->jitReportDynamicCodeLoadEvents = jitReportDynamicCodeLoadEvents;\n+   TR::CompilationInfo * compInfo = TR::CompilationInfo::get(jitConfig);\n+\n+#if defined(J9VM_OPT_JITSERVER)\n+   if (compInfo->getPersistentInfo()->getRemoteCompilationMode() != JITServer::SERVER)\n+#endif\n+      {\n+      jitConfig->jitGetExceptionTableFromPC = jitGetExceptionTableFromPC;\n+      jitConfig->jitGetStackMapFromPC = getStackMapFromJitPC;\n+      jitConfig->jitGetInlinerMapFromPC = jitGetInlinerMapFromPC;\n+      jitConfig->getJitInlineDepthFromCallSite = getJitInlineDepthFromCallSite;\n+      jitConfig->getJitInlinedCallInfo = getJitInlinedCallInfo;\n+      jitConfig->getStackMapFromJitPC = getStackMapFromJitPC;\n+      jitConfig->getFirstInlinedCallSite = getFirstInlinedCallSite;\n+      jitConfig->getNextInlinedCallSite = getNextInlinedCallSite;\n+      jitConfig->hasMoreInlinedMethods = hasMoreInlinedMethods;\n+      jitConfig->getInlinedMethod = getInlinedMethod;\n+      jitConfig->getByteCodeIndex = getByteCodeIndex;\n+      jitConfig->getByteCodeIndexFromStackMap = getByteCodeIndexFromStackMap;\n+      jitConfig->getCurrentByteCodeIndexAndIsSameReceiver = getCurrentByteCodeIndexAndIsSameReceiver;\n+      jitConfig->getJitRegisterMap = getJitRegisterMap;\n+      jitConfig->jitReportDynamicCodeLoadEvents = jitReportDynamicCodeLoadEvents;\n #if (defined(TR_HOST_X86) || defined(TR_HOST_POWER) || defined(TR_HOST_S390) || defined(TR_HOST_ARM) || defined(TR_HOST_ARM64))\n-   jitConfig->jitClassesRedefined = jitClassesRedefined;\n-   jitConfig->jitFlushCompilationQueue = jitFlushCompilationQueue;\n+      jitConfig->jitClassesRedefined = jitClassesRedefined;\n+      jitConfig->jitFlushCompilationQueue = jitFlushCompilationQueue;\n #endif\n-   jitConfig->jitDiscardPendingCompilationsOfNatives = jitDiscardPendingCompilationsOfNatives;\n-   jitConfig->jitMethodBreakpointed = jitMethodBreakpointed;\n+      jitConfig->jitDiscardPendingCompilationsOfNatives = jitDiscardPendingCompilationsOfNatives;\n+      jitConfig->jitMethodBreakpointed = jitMethodBreakpointed;\n+      }\n    jitConfig->jitIllegalFinalFieldModification = jitIllegalFinalFieldModification;\n \n-   initializeCodertFunctionTable(javaVM);\n+// #if defined(J9VM_OPT_JITSERVER)", "originalCommit": "fe46faff4c71f75192a2f8d6a53e51a664497b7d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc1MzQ1OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9233#discussion_r411753458", "bodyText": "Extra line is not needed", "author": "mpirvu", "createdAt": "2020-04-20T23:14:23Z", "path": "runtime/compiler/runtime/codertinit.cpp", "diffHunk": "@@ -451,52 +452,62 @@ void codert_init_helpers_and_targets(J9JITConfig * jitConfig, char isSMP)\n    }\n #endif\n \n-   jitConfig->jitGetExceptionTableFromPC = jitGetExceptionTableFromPC;\n-   jitConfig->jitGetStackMapFromPC = getStackMapFromJitPC;\n-   jitConfig->jitGetInlinerMapFromPC = jitGetInlinerMapFromPC;\n-   jitConfig->getJitInlineDepthFromCallSite = getJitInlineDepthFromCallSite;\n-   jitConfig->getJitInlinedCallInfo = getJitInlinedCallInfo;\n-   jitConfig->getStackMapFromJitPC = getStackMapFromJitPC;\n-   jitConfig->getFirstInlinedCallSite = getFirstInlinedCallSite;\n-   jitConfig->getNextInlinedCallSite = getNextInlinedCallSite;\n-   jitConfig->hasMoreInlinedMethods = hasMoreInlinedMethods;\n-   jitConfig->getInlinedMethod = getInlinedMethod;\n-   jitConfig->getByteCodeIndex = getByteCodeIndex;\n-   jitConfig->getByteCodeIndexFromStackMap = getByteCodeIndexFromStackMap;\n-   jitConfig->getCurrentByteCodeIndexAndIsSameReceiver = getCurrentByteCodeIndexAndIsSameReceiver;\n-   jitConfig->getJitRegisterMap = getJitRegisterMap;\n-   jitConfig->jitReportDynamicCodeLoadEvents = jitReportDynamicCodeLoadEvents;\n+   TR::CompilationInfo * compInfo = TR::CompilationInfo::get(jitConfig);\n+\n+#if defined(J9VM_OPT_JITSERVER)\n+   if (compInfo->getPersistentInfo()->getRemoteCompilationMode() != JITServer::SERVER)\n+#endif\n+      {\n+      jitConfig->jitGetExceptionTableFromPC = jitGetExceptionTableFromPC;\n+      jitConfig->jitGetStackMapFromPC = getStackMapFromJitPC;\n+      jitConfig->jitGetInlinerMapFromPC = jitGetInlinerMapFromPC;\n+      jitConfig->getJitInlineDepthFromCallSite = getJitInlineDepthFromCallSite;\n+      jitConfig->getJitInlinedCallInfo = getJitInlinedCallInfo;\n+      jitConfig->getStackMapFromJitPC = getStackMapFromJitPC;\n+      jitConfig->getFirstInlinedCallSite = getFirstInlinedCallSite;\n+      jitConfig->getNextInlinedCallSite = getNextInlinedCallSite;\n+      jitConfig->hasMoreInlinedMethods = hasMoreInlinedMethods;\n+      jitConfig->getInlinedMethod = getInlinedMethod;\n+      jitConfig->getByteCodeIndex = getByteCodeIndex;\n+      jitConfig->getByteCodeIndexFromStackMap = getByteCodeIndexFromStackMap;\n+      jitConfig->getCurrentByteCodeIndexAndIsSameReceiver = getCurrentByteCodeIndexAndIsSameReceiver;\n+      jitConfig->getJitRegisterMap = getJitRegisterMap;\n+      jitConfig->jitReportDynamicCodeLoadEvents = jitReportDynamicCodeLoadEvents;\n #if (defined(TR_HOST_X86) || defined(TR_HOST_POWER) || defined(TR_HOST_S390) || defined(TR_HOST_ARM) || defined(TR_HOST_ARM64))\n-   jitConfig->jitClassesRedefined = jitClassesRedefined;\n-   jitConfig->jitFlushCompilationQueue = jitFlushCompilationQueue;\n+      jitConfig->jitClassesRedefined = jitClassesRedefined;\n+      jitConfig->jitFlushCompilationQueue = jitFlushCompilationQueue;\n #endif\n-   jitConfig->jitDiscardPendingCompilationsOfNatives = jitDiscardPendingCompilationsOfNatives;\n-   jitConfig->jitMethodBreakpointed = jitMethodBreakpointed;\n+      jitConfig->jitDiscardPendingCompilationsOfNatives = jitDiscardPendingCompilationsOfNatives;\n+      jitConfig->jitMethodBreakpointed = jitMethodBreakpointed;\n+      }\n    jitConfig->jitIllegalFinalFieldModification = jitIllegalFinalFieldModification;\n \n-   initializeCodertFunctionTable(javaVM);\n+// #if defined(J9VM_OPT_JITSERVER)\n+//    if (compInfo->getPersistentInfo()->getRemoteCompilationMode() != JITServer::SERVER)\n+// #endif\n+//       {\n+      initializeCodertFunctionTable(javaVM);\n \n-   #ifndef J9SW_NEEDS_JIT_2_INTERP_THUNKS\n-      jitConfig->jitSendTargetTable = &jit2InterpreterSendTargetTable;\n-   #endif\n-\n-   #if defined(J9VM_PORT_SIGNAL_SUPPORT) && defined(J9VM_INTERP_NATIVE_SUPPORT)\n-      #if defined(TR_HOST_X86) && defined(TR_TARGET_X86) && !defined(TR_TARGET_64BIT)\n-         jitConfig->jitSignalHandler = jitX86Handler;\n-      #elif defined(TR_HOST_POWER) && defined(TR_TARGET_POWER)\n-         jitConfig->jitSignalHandler = jitPPCHandler;\n-      #elif defined(TR_HOST_S390) && defined(TR_TARGET_S390)\n-         jitConfig->jitSignalHandler = jit390Handler;\n-      #elif defined(TR_HOST_X86) && defined(TR_TARGET_X86) && defined(TR_TARGET_64BIT)\n-         jitConfig->jitSignalHandler = jitAMD64Handler;\n-      #endif\n-   #endif\n+#ifndef J9SW_NEEDS_JIT_2_INTERP_THUNKS\n+   jitConfig->jitSendTargetTable = &jit2InterpreterSendTargetTable;\n+#endif\n \n+#if defined(J9VM_PORT_SIGNAL_SUPPORT) && defined(J9VM_INTERP_NATIVE_SUPPORT)\n+#if defined(TR_HOST_X86) && defined(TR_TARGET_X86) && !defined(TR_TARGET_64BIT)\n+   jitConfig->jitSignalHandler = jitX86Handler;\n+#elif defined(TR_HOST_POWER) && defined(TR_TARGET_POWER)\n+   jitConfig->jitSignalHandler = jitPPCHandler;\n+#elif defined(TR_HOST_S390) && defined(TR_TARGET_S390)\n+   jitConfig->jitSignalHandler = jit390Handler;\n+#elif defined(TR_HOST_X86) && defined(TR_TARGET_X86) && defined(TR_TARGET_64BIT)\n+   jitConfig->jitSignalHandler = jitAMD64Handler;\n+#endif\n+#endif\n \n #if defined(J9VM_JIT_DYNAMIC_LOOP_TRANSFER)\n    jitConfig->isDLTReady = jitLookupDLT;\n #endif\n-\n+   ", "originalCommit": "fe46faff4c71f75192a2f8d6a53e51a664497b7d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc1MzY0Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9233#discussion_r411753647", "bodyText": "Extra spaces after the curly bracket that are not needed", "author": "mpirvu", "createdAt": "2020-04-20T23:14:56Z", "path": "runtime/compiler/runtime/codertinit.cpp", "diffHunk": "@@ -407,7 +408,7 @@ initJitTOCForAllThreads(J9JavaVM* javaVM, UDATA jitTOC)\n \n \n void codert_init_helpers_and_targets(J9JITConfig * jitConfig, char isSMP)\n-   {\n+   {   ", "originalCommit": "fe46faff4c71f75192a2f8d6a53e51a664497b7d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8762f5dfa78d247a037742a36110772c193c2a18", "url": "https://github.com/eclipse-openj9/openj9/commit/8762f5dfa78d247a037742a36110772c193c2a18", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-21T03:34:34Z", "type": "commit"}, {"oid": "8762f5dfa78d247a037742a36110772c193c2a18", "url": "https://github.com/eclipse-openj9/openj9/commit/8762f5dfa78d247a037742a36110772c193c2a18", "message": "Disable all JIT Hooks at JITServer\n\nJITServer does not trigger any of the JIT hooks thus disabling them\n\nIssue: #7508\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-04-21T03:34:34Z", "type": "forcePushed"}]}