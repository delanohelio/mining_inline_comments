{"pr_number": 8936, "pr_title": "Implement compressed refs override and split BytecodeInterpreter", "pr_createdAt": "2020-03-20T20:17:52Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8936", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg3Mjk1NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r395872955", "bodyText": "Should be J9JAVAVM not J9VMTHREAD", "author": "gacholio", "createdAt": "2020-03-20T20:24:40Z", "path": "runtime/oti/j9nonbuilder.h", "diffHunk": "@@ -5179,7 +5183,11 @@ typedef struct J9JavaVM {\n #if defined(OMR_GC_COMPRESSED_POINTERS)\n #if defined(OMR_GC_FULL_POINTERS)\n /* Mixed mode - necessarily 64-bit */\n+#if defined(J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n+#define J9VMTHREAD_COMPRESS_OBJECT_REFERENCES(vmThread) J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES", "originalCommit": "de9ab8f6ad3a14c62b928c704308f5223f82c652", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5NDEyNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r395894127", "bodyText": "fixed", "author": "sharon-wang", "createdAt": "2020-03-20T21:18:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg3Mjk1NQ=="}], "type": "inlineReview"}, {"oid": "aa7b565d49daa0b3ed72fef124ab54790a00ae38", "url": "https://github.com/eclipse-openj9/openj9/commit/aa7b565d49daa0b3ed72fef124ab54790a00ae38", "message": "Implement compressed refs override and split BytecodeInterpreter\n\nSplit BytecodeInterpreter.cpp into BytecodeInterpreterFull.cpp and\nBytecodeInterpreterCompressed.cpp. Set the bytecodeLoop name accordingly.\n\nAdd new override macro J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES.\n\nIn BytecodeInterpreterFull.cpp and BytecodeInterpreterCompressed.cpp,\ndefine the override macro as:\n    TRUE if OMR_GC_COMPRESSED_POINTERS is defined\n    FALSE if OMR_GC_FULL_POINTERS is defined\n\nIf the override macro is defined, set J9VMTHREAD_COMPRESS_OBJECT_REFERENCES\nand J9JAVAVM_COMPRESS_OBJECT_REFERENCES to be the same value as the override macro.\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-03-20T20:55:17Z", "type": "forcePushed"}, {"oid": "86defc7de6d3544ddbba6e4b422b34e0d8f8faa0", "url": "https://github.com/eclipse-openj9/openj9/commit/86defc7de6d3544ddbba6e4b422b34e0d8f8faa0", "message": "Remove BytecodeInterpreter.cpp and only compile Full/Compressed versions\n\nRename BytecodeInterpreter.cpp to BytecodeInterpreter.inc and only\ncompile BytecodeInterpreterFull.cpp and BytecodeInterpreterCompressed.cpp\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-03-23T16:18:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5MTEwNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r396591107", "bodyText": "Rather than doing this, I think it would be better to hoist the class/loop names out into the wrapper .cpp files.", "author": "gacholio", "createdAt": "2020-03-23T16:37:44Z", "path": "runtime/vm/BytecodeInterpreterFull.cpp", "diffHunk": "@@ -0,0 +1,29 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020, 2020 IBM Corp. and others\n+ *\n+ * This program and the accompanying materials are made available under\n+ * the terms of the Eclipse Public License 2.0 which accompanies this\n+ * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n+ * or the Apache License, Version 2.0 which accompanies this distribution and\n+ * is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * This Source Code may also be made available under the following\n+ * Secondary Licenses when the conditions for such availability set\n+ * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n+ * General Public License, version 2 with the GNU Classpath\n+ * Exception [1] and GNU General Public License, version 2 with the\n+ * OpenJDK Assembly Exception [2].\n+ *\n+ * [1] https://www.gnu.org/software/classpath/license.html\n+ * [2] http://openjdk.java.net/legal/assembly-exception.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n+ *******************************************************************************/\n+\n+#include \"j9cfg.h\"\n+\n+#if defined(OMR_GC_FULL_POINTERS)\n+#define J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES FALSE\n+#define FULL_VERSION", "originalCommit": "86defc7de6d3544ddbba6e4b422b34e0d8f8faa0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5NTQ0Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r396595447", "bodyText": "I will move #define LOOP_NAME bytecodeLoopFull, #define INTERPRETER_CLASS VM_BytecodeInterpreterFull etc to be declared per wrapper file. Each wrapper file will still include BytecodeInterpreter.inc, and the rest of the .inc will remain the same?", "author": "sharon-wang", "createdAt": "2020-03-23T16:43:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5MTEwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYwMjg5Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r396602897", "bodyText": "Sounds good - please do the same for the debug interpreter (though you will still need to define DEBUG_VERSION for that case).", "author": "gacholio", "createdAt": "2020-03-23T16:53:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5MTEwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5MTczNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r396591736", "bodyText": "There seems to be multiple entries for each interpreter in the makefiles.", "author": "gacholio", "createdAt": "2020-03-23T16:38:38Z", "path": "runtime/makelib/targets.mk.zos.inc.ftl", "diffHunk": "@@ -126,7 +126,17 @@ endif\n MRABIG = -Wc,\"TBYDBG(-qdebug=MRABIG)\"\n SPECIALCXXFLAGS = $(filter-out -Wc$(COMMA)debug -O3,$(CXXFLAGS))\n NEW_OPTIMIZATION_FLAG = -O2 -Wc,\"TBYDBG(-qdebug=lincomm:ptranl:tfbagg)\" -Wc,\"FEDBG(-qxflag=InlineDespiteVolatileInArgs)\"\n-BytecodeInterpreter.o : BytecodeInterpreter.cpp\n+\n+BytecodeInterpreterFull.o : BytecodeInterpreterFull.cpp\n+\t$(CXX) $(SPECIALCXXFLAGS) $(MRABIG) $(NEW_OPTIMIZATION_FLAG) -c $< > $*.asmlist\n+\n+BytecodeInterpreterCompressed.o : BytecodeInterpreterCompressed.cpp\n+\t$(CXX) $(SPECIALCXXFLAGS) $(MRABIG) $(NEW_OPTIMIZATION_FLAG) -c $< > $*.asmlist\n+\n+BytecodeInterpreterFull.o : BytecodeInterpreterFull.cpp\n+\t$(CXX) $(SPECIALCXXFLAGS) $(MRABIG) $(NEW_OPTIMIZATION_FLAG) -c $< > $*.asmlist\n+\n+BytecodeInterpreterCompressed.o : BytecodeInterpreterCompressed.cpp", "originalCommit": "86defc7de6d3544ddbba6e4b422b34e0d8f8faa0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYwNzIxNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r396607215", "bodyText": "fixed", "author": "sharon-wang", "createdAt": "2020-03-23T16:59:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5MTczNg=="}], "type": "inlineReview"}, {"oid": "7f50fdac1d603ff8bb062877e046cf9e5e3d80d4", "url": "https://github.com/eclipse-openj9/openj9/commit/7f50fdac1d603ff8bb062877e046cf9e5e3d80d4", "message": "Remove BytecodeInterpreter.cpp and only compile Full/Compressed versions\n\nRename BytecodeInterpreter.cpp to BytecodeInterpreter.inc and only\ncompile BytecodeInterpreterFull.cpp and BytecodeInterpreterCompressed.cpp\n\nMove bytecode LOOP_NAME definitions from BytecodeInterpreter.inc and\nINTERPRETER_CLASS definitions into individual wrapper files (Debug, Full\nand Compressed).\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-03-23T16:57:49Z", "type": "forcePushed"}, {"oid": "843405d3f725597ae4510df098de8a0fb81283c3", "url": "https://github.com/eclipse-openj9/openj9/commit/843405d3f725597ae4510df098de8a0fb81283c3", "message": "Remove BytecodeInterpreter.cpp and only compile Full/Compressed versions\n\nRename BytecodeInterpreter.cpp to BytecodeInterpreter.inc and only\ncompile BytecodeInterpreterFull.cpp and BytecodeInterpreterCompressed.cpp\n\nMove bytecode LOOP_NAME definitions from BytecodeInterpreter.inc and\nINTERPRETER_CLASS definitions into individual wrapper files (Debug, Full\nand Compressed).\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-03-23T17:01:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYxMjgyNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r396612827", "bodyText": "This code needs to be ifdeffed also - you can only refer to the full/compressed loop function if the appropriate flag is defined (since the interpreter files are compiled undef ifdef).", "author": "gacholio", "createdAt": "2020-03-23T17:08:13Z", "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -2452,9 +2452,13 @@ IDATA VMInitStages(J9JavaVM *vm, IDATA stage, void* reserved) {\n #endif /* J9VM_INTERP_ATOMIC_FREE_JNI_USES_FLUSH */\n \t\t\tTRIGGER_J9HOOK_VM_ABOUT_TO_BOOTSTRAP(vm->hookInterface, vm->mainThread);\n \t\t\t/* At this point, the decision about which interpreter to use has been made */\n-\t\t\tvm->bytecodeLoop = J9_ARE_ANY_BITS_SET(vm->extendedRuntimeFlags, J9_EXTENDED_RUNTIME_DEBUG_MODE)\n-\t\t\t\t\t? (void*)debugBytecodeLoop\n-\t\t\t\t\t: (void*)bytecodeLoop;\n+\t\t\tif (J9_ARE_ANY_BITS_SET(vm->extendedRuntimeFlags, J9_EXTENDED_RUNTIME_DEBUG_MODE)) {\n+\t\t\t\tvm->bytecodeLoop = (void*)debugBytecodeLoop;\n+\t\t\t} else {\n+\t\t\t\tvm->bytecodeLoop = (J9VMTHREAD_COMPRESS_OBJECT_REFERENCES(vmThread))", "originalCommit": "843405d3f725597ae4510df098de8a0fb81283c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyMjcxMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r396622713", "bodyText": "added the appropriate ifdefs", "author": "sharon-wang", "createdAt": "2020-03-23T17:22:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYxMjgyNw=="}], "type": "inlineReview"}, {"oid": "7dbd86a95f670600c97321e9e3d1da0d0f2a7ef9", "url": "https://github.com/eclipse-openj9/openj9/commit/7dbd86a95f670600c97321e9e3d1da0d0f2a7ef9", "message": "Remove BytecodeInterpreter.cpp and only compile Full/Compressed versions\n\nRename BytecodeInterpreter.cpp to BytecodeInterpreter.inc and only\ncompile BytecodeInterpreterFull.cpp and BytecodeInterpreterCompressed.cpp\n\nMove bytecode LOOP_NAME definitions from BytecodeInterpreter.inc and\nINTERPRETER_CLASS definitions into individual wrapper files (Debug, Full\nand Compressed).\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-03-23T17:21:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1NzYwMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r396757602", "bodyText": "This needs to be J9JAVAVM_COMPRESS_OBJECT_REFERENCES(vm)", "author": "gacholio", "createdAt": "2020-03-23T21:08:09Z", "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -2452,9 +2452,19 @@ IDATA VMInitStages(J9JavaVM *vm, IDATA stage, void* reserved) {\n #endif /* J9VM_INTERP_ATOMIC_FREE_JNI_USES_FLUSH */\n \t\t\tTRIGGER_J9HOOK_VM_ABOUT_TO_BOOTSTRAP(vm->hookInterface, vm->mainThread);\n \t\t\t/* At this point, the decision about which interpreter to use has been made */\n-\t\t\tvm->bytecodeLoop = J9_ARE_ANY_BITS_SET(vm->extendedRuntimeFlags, J9_EXTENDED_RUNTIME_DEBUG_MODE)\n-\t\t\t\t\t? (void*)debugBytecodeLoop\n-\t\t\t\t\t: (void*)bytecodeLoop;\n+\t\t\tif (J9_ARE_ANY_BITS_SET(vm->extendedRuntimeFlags, J9_EXTENDED_RUNTIME_DEBUG_MODE)) {\n+\t\t\t\tvm->bytecodeLoop = (void*)debugBytecodeLoop;\n+\t\t\t} else {\n+\t\t\t\tif (J9VMTHREAD_COMPRESS_OBJECT_REFERENCES(vmThread)) {", "originalCommit": "7dbd86a95f670600c97321e9e3d1da0d0f2a7ef9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MjMxMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r396762310", "bodyText": "fixed", "author": "sharon-wang", "createdAt": "2020-03-23T21:17:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1NzYwMg=="}], "type": "inlineReview"}, {"oid": "b07f31c347784fb12ced1f5e1cd1603c7ca6b65a", "url": "https://github.com/eclipse-openj9/openj9/commit/b07f31c347784fb12ced1f5e1cd1603c7ca6b65a", "message": "Implement compressed refs override and split BytecodeInterpreter\n\nAdd new override macro J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES.\n\nSplit BytecodeInterpreter.cpp into BytecodeInterpreterFull.cpp and\nBytecodeInterpreterCompressed.cpp.\n\nRename BytecodeInterpreter.cpp to BytecodeInterpreter.inc and only\ncompile BytecodeInterpreterFull.cpp and BytecodeInterpreterCompressed.cpp\n\nMove bytecode LOOP_NAME definitions from BytecodeInterpreter.inc and\nINTERPRETER_CLASS definitions into individual wrapper files (Debug, Full\nand Compressed).\n\nIn BytecodeInterpreterFull.cpp and BytecodeInterpreterCompressed.cpp,\ndefine the override macro as:\n    TRUE if OMR_GC_COMPRESSED_POINTERS is defined\n    FALSE if OMR_GC_FULL_POINTERS is defined\n\nIf the override macro is defined, set J9VMTHREAD_COMPRESS_OBJECT_REFERENCES\nand J9JAVAVM_COMPRESS_OBJECT_REFERENCES to be the same value as the override macro.\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-03-23T21:14:13Z", "type": "forcePushed"}, {"oid": "042630bce26ea6a2667efe2f105cf75d5d6a5dcf", "url": "https://github.com/eclipse-openj9/openj9/commit/042630bce26ea6a2667efe2f105cf75d5d6a5dcf", "message": "Split BytecodeInterpreter included class names into Full/Compressed\n\nClasses included by BytecodeInterpreter may use (directly or indirectly)\nthe COMPRESS_OBJECT_REFERENCES macros in inline functions. Class names\nfor these classes need to be split into <CLASS_NAME>Full and <CLASS_NAME>Compressed\nto differentiate between the functions, so that the one definition rule is not violated.\nViolation of the one definition rule results in undefined behaviour which is not easy\nto track down.\n\nUse undefineobjectreferencesmacros.h and objectreferencesmacros.h to check if files need to be split into Full and Compressed.\n\nSplit VMHelpers, ObjectHash, UnsafeAPI, ArrayCopyHelpers into Full/Compressed\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-04-08T20:04:27Z", "type": "forcePushed"}, {"oid": "a30cd515b6a86c843f307793973bf438c85a7695", "url": "https://github.com/eclipse-openj9/openj9/commit/a30cd515b6a86c843f307793973bf438c85a7695", "message": "Split BytecodeInterpreter included class names into Full/Compressed\n\nClasses included by BytecodeInterpreter may use (directly or indirectly)\nthe COMPRESS_OBJECT_REFERENCES macros in inline functions. Class names\nfor these classes need to be split into <CLASS_NAME>Full and <CLASS_NAME>Compressed\nto differentiate between the functions, so that the one definition rule is not violated.\nViolation of the one definition rule results in undefined behaviour which is not easy\nto track down.\n\nUse objectreferencesmacros_define.h and objectreferencesmacros_undefine.h to check if files need to be split into Full and Compressed.\n\nSplit VMHelpers, ObjectHash, UnsafeAPI, ArrayCopyHelpers into Full/Compressed\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-04-08T20:20:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc5OTE2Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405799162", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #if (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n          \n          \n            \n            #if J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES", "author": "rwy0717", "createdAt": "2020-04-08T20:37:19Z", "path": "runtime/oti/ArrayCopyHelpers.hpp", "diffHunk": "@@ -51,6 +51,14 @@\n typedef long long I_128 __attribute__ ((__vector_size__ (16)));\n #endif\n \n+#if defined(J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n+#if (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc5OTMxMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405799311", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #if (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n          \n          \n            \n            #if J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES", "author": "rwy0717", "createdAt": "2020-04-08T20:37:37Z", "path": "runtime/oti/ObjectHash.hpp", "diffHunk": "@@ -29,6 +29,14 @@\n #include \"AtomicSupport.hpp\"\n #include \"VMHelpers.hpp\"\n \n+#if defined(J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n+#if (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMDYwNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405800605", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #define J9VMTHREAD_COMPRESS_OBJECT_REFERENCES(vmThread) (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES ? TRUE : FALSE)\n          \n          \n            \n            #define J9VMTHREAD_COMPRESS_OBJECT_REFERENCES(vmThread) J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES", "author": "rwy0717", "createdAt": "2020-04-08T20:39:57Z", "path": "runtime/oti/objectreferencesmacros_define.h", "diffHunk": "@@ -0,0 +1,44 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020, 2020 IBM Corp. and others\n+ *\n+ * This program and the accompanying materials are made available under\n+ * the terms of the Eclipse Public License 2.0 which accompanies this\n+ * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n+ * or the Apache License, Version 2.0 which accompanies this distribution and\n+ * is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * This Source Code may also be made available under the following\n+ * Secondary Licenses when the conditions for such availability set\n+ * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n+ * General Public License, version 2 with the GNU Classpath\n+ * Exception [1] and GNU General Public License, version 2 with the\n+ * OpenJDK Assembly Exception [2].\n+ *\n+ * [1] https://www.gnu.org/software/classpath/license.html\n+ * [2] http://openjdk.java.net/legal/assembly-exception.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n+ *******************************************************************************/\n+\n+#include \"j9nonbuilder.h\"\n+\n+#if defined(OMR_GC_COMPRESSED_POINTERS)\n+#if defined(OMR_GC_FULL_POINTERS)\n+/* Mixed mode - necessarily 64-bit */\n+#if defined(J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n+#define J9VMTHREAD_COMPRESS_OBJECT_REFERENCES(vmThread) (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES ? TRUE : FALSE)", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMDgyNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405800824", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #define J9JAVAVM_COMPRESS_OBJECT_REFERENCES(vm) (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES ? TRUE : FALSE)\n          \n          \n            \n            #define J9JAVAVM_COMPRESS_OBJECT_REFERENCES(vm) J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES", "author": "rwy0717", "createdAt": "2020-04-08T20:40:19Z", "path": "runtime/oti/objectreferencesmacros_define.h", "diffHunk": "@@ -0,0 +1,44 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020, 2020 IBM Corp. and others\n+ *\n+ * This program and the accompanying materials are made available under\n+ * the terms of the Eclipse Public License 2.0 which accompanies this\n+ * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n+ * or the Apache License, Version 2.0 which accompanies this distribution and\n+ * is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * This Source Code may also be made available under the following\n+ * Secondary Licenses when the conditions for such availability set\n+ * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n+ * General Public License, version 2 with the GNU Classpath\n+ * Exception [1] and GNU General Public License, version 2 with the\n+ * OpenJDK Assembly Exception [2].\n+ *\n+ * [1] https://www.gnu.org/software/classpath/license.html\n+ * [2] http://openjdk.java.net/legal/assembly-exception.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n+ *******************************************************************************/\n+\n+#include \"j9nonbuilder.h\"\n+\n+#if defined(OMR_GC_COMPRESSED_POINTERS)\n+#if defined(OMR_GC_FULL_POINTERS)\n+/* Mixed mode - necessarily 64-bit */\n+#if defined(J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n+#define J9VMTHREAD_COMPRESS_OBJECT_REFERENCES(vmThread) (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES ? TRUE : FALSE)\n+#define J9JAVAVM_COMPRESS_OBJECT_REFERENCES(vm) (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES ? TRUE : FALSE)", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMzU0OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405803549", "bodyText": "Ought to be under the compressed flag.", "author": "rwy0717", "createdAt": "2020-04-08T20:45:11Z", "path": "runtime/oti/vm_api.h", "diffHunk": "@@ -4090,15 +4090,25 @@ typedef enum {\n void*\n J9_GetInterface(J9_INTERFACE_SELECTOR interfaceSelector, J9PortLibrary* portLib, void *userData);\n \n-/* -------------------- BytecodeInterpreter.cpp ------------ */\n+/* -------------------- BytecodeInterpreterFull.cpp ------------ */\n \n /**\n-* @brief Execute the bytecode loop\n+* @brief Execute the bytecode loop (full pointers)\n+* @param currentThread\n+* @return UDATA the action to take upon return to the builder interpreter\n+*/\n+UDATA\n+bytecodeLoopFull(J9VMThread *currentThread);\n+\n+/* -------------------- BytecodeInterpreterCompressed.cpp ------------ */\n+\n+/**\n+* @brief Execute the bytecode loop (compressed pointers)\n * @param currentThread\n * @return UDATA the action to take upon return to the builder interpreter\n */\n UDATA  \n-bytecodeLoop(J9VMThread *currentThread);\n+bytecodeLoopCompressed(J9VMThread *currentThread);", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQwNjc3OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r406406779", "bodyText": "No need to ifdef prototypes, though I'd be tempted to move these to the place that uses them, since they're so specific (and no one should be calling them directly, ever).", "author": "gacholio", "createdAt": "2020-04-09T18:47:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMzU0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQzNzM1Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r406437357", "bodyText": "These are only used in jvminit.c. The Full/Compressed prototypes could be moved to that file? Should the debugBytecodeLoop prototype also be moved to the same place for consistency?", "author": "sharon-wang", "createdAt": "2020-04-09T19:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMzU0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ0NDQzMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r406444430", "bodyText": "I think that would be ideal - it means no one could accidentally call them. I suppose for complete safety, the prototypes should be ifdeffed in jvminit.c.\nYes, please move the debug version(s) to jvminit.c as well.", "author": "gacholio", "createdAt": "2020-04-09T20:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMzU0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMzY5Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405803697", "bodyText": "Ought to be under the full flag.", "author": "rwy0717", "createdAt": "2020-04-08T20:45:27Z", "path": "runtime/oti/vm_api.h", "diffHunk": "@@ -4090,15 +4090,25 @@ typedef enum {\n void*\n J9_GetInterface(J9_INTERFACE_SELECTOR interfaceSelector, J9PortLibrary* portLib, void *userData);\n \n-/* -------------------- BytecodeInterpreter.cpp ------------ */\n+/* -------------------- BytecodeInterpreterFull.cpp ------------ */\n \n /**\n-* @brief Execute the bytecode loop\n+* @brief Execute the bytecode loop (full pointers)\n+* @param currentThread\n+* @return UDATA the action to take upon return to the builder interpreter\n+*/\n+UDATA\n+bytecodeLoopFull(J9VMThread *currentThread);", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQwNjgzNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r406406835", "bodyText": "See above.", "author": "gacholio", "createdAt": "2020-04-09T18:47:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMzY5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwNDEzMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405804130", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #if (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n          \n          \n            \n            #if J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES", "author": "rwy0717", "createdAt": "2020-04-08T20:46:14Z", "path": "runtime/oti/UnsafeAPI.hpp", "diffHunk": "@@ -30,6 +30,14 @@\n #include \"VMHelpers.hpp\"\n #include \"AtomicSupport.hpp\"\n \n+#if defined(J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n+#if (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwNDM0Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405804347", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #if (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n          \n          \n            \n            #if J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES", "author": "rwy0717", "createdAt": "2020-04-08T20:46:33Z", "path": "runtime/oti/ObjectMonitor.hpp", "diffHunk": "@@ -33,6 +33,14 @@\n \n #include \"AtomicSupport.hpp\"\n \n+#if defined(J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)\n+#if (J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES)", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwODExMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405808110", "bodyText": "Eventually, it would be cleaner to simply not compile these sources, when their code is disabled, since osx complains about empty object files.", "author": "rwy0717", "createdAt": "2020-04-08T20:53:22Z", "path": "runtime/makelib/targets.mk.ftl", "diffHunk": "@@ -557,7 +560,10 @@ NEW_OPTIMIZATION_FLAG+=-qmaxmem=-1 -qpic\n </#if>\n SPECIALCXXFLAGS=$(filter-out $(FLAGS_TO_REMOVE),$(CXXFLAGS))\n \n-BytecodeInterpreter$(UMA_DOT_O):BytecodeInterpreter.cpp\n+BytecodeInterpreterFull$(UMA_DOT_O):BytecodeInterpreterFull.cpp\n+\t$(CXX) $(SPECIALCXXFLAGS) $(NEW_OPTIMIZATION_FLAG) -c $<\n+\n+BytecodeInterpreterCompressed$(UMA_DOT_O):BytecodeInterpreterCompressed.cpp\n \t$(CXX) $(SPECIALCXXFLAGS) $(NEW_OPTIMIZATION_FLAG) -c $<", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQxMjI3Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r406412273", "bodyText": "Agreed - do you know offhand how to do this? I don't want to have to mess with makefiles (more than I already do) in order to mixify a build. If it can be done based on the flags in omrcfg.h, then great. Otherwise, I'd prefer to either ignore the OSX issue for now, or change the files to contain a dummy static or function when not defining the custom interpreter to work around the issue.", "author": "gacholio", "createdAt": "2020-04-09T18:57:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwODExMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQzMDA2NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r406430064", "bodyText": "I suppose we can't ignore OSX when we publish these changes, so the dummy code is the short-term answer if you can't fix the makefiles cleanly.", "author": "gacholio", "createdAt": "2020-04-09T19:32:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwODExMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY0NDkwMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r409644902", "bodyText": "Going with the temporary solution for now - dummy define in the split interpreter files. Will look into makefile changes in future PR.", "author": "sharon-wang", "createdAt": "2020-04-16T15:24:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwODExMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwODc0MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r405808741", "bodyText": "I think it would be more appropriate to make this (and it's complement) a .inc file.", "author": "rwy0717", "createdAt": "2020-04-08T20:54:29Z", "path": "runtime/oti/VMAccess.hpp", "diffHunk": "@@ -35,6 +35,8 @@\n #define J9_EXCLUSIVE_SLOW_REASON_JNICRITICAL 1\n #define J9_EXCLUSIVE_SLOW_REASON_EXCLUSIVE   2\n \n+#include \"objectreferencesmacros_undefine.h\"", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQxMjc1MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r406412750", "bodyText": "As they should never be directly included in general code, I can't disagree.", "author": "gacholio", "createdAt": "2020-04-09T18:58:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwODc0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQxMzU2Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r406413567", "bodyText": "I think you must include j9nonbuilder.h here so that future includes do not redefine the macros (the header gate will prevent it, and we can't have one here).", "author": "gacholio", "createdAt": "2020-04-09T19:00:04Z", "path": "runtime/oti/objectreferencesmacros_undefine.h", "diffHunk": "@@ -0,0 +1,24 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020, 2020 IBM Corp. and others\n+ *\n+ * This program and the accompanying materials are made available under\n+ * the terms of the Eclipse Public License 2.0 which accompanies this\n+ * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n+ * or the Apache License, Version 2.0 which accompanies this distribution and\n+ * is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * This Source Code may also be made available under the following\n+ * Secondary Licenses when the conditions for such availability set\n+ * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n+ * General Public License, version 2 with the GNU Classpath\n+ * Exception [1] and GNU General Public License, version 2 with the\n+ * OpenJDK Assembly Exception [2].\n+ *\n+ * [1] https://www.gnu.org/software/classpath/license.html\n+ * [2] http://openjdk.java.net/legal/assembly-exception.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n+ *******************************************************************************/\n+", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQxNzQ2Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8936#discussion_r406417467", "bodyText": "I believe this should be removed - it works because of the header gate in j9nonbuilder.h, but if we move the include to the _undefine file, it won't be necessary here.", "author": "gacholio", "createdAt": "2020-04-09T19:07:39Z", "path": "runtime/oti/objectreferencesmacros_define.h", "diffHunk": "@@ -0,0 +1,44 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020, 2020 IBM Corp. and others\n+ *\n+ * This program and the accompanying materials are made available under\n+ * the terms of the Eclipse Public License 2.0 which accompanies this\n+ * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n+ * or the Apache License, Version 2.0 which accompanies this distribution and\n+ * is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * This Source Code may also be made available under the following\n+ * Secondary Licenses when the conditions for such availability set\n+ * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n+ * General Public License, version 2 with the GNU Classpath\n+ * Exception [1] and GNU General Public License, version 2 with the\n+ * OpenJDK Assembly Exception [2].\n+ *\n+ * [1] https://www.gnu.org/software/classpath/license.html\n+ * [2] http://openjdk.java.net/legal/assembly-exception.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n+ *******************************************************************************/\n+\n+#include \"j9nonbuilder.h\"", "originalCommit": "a30cd515b6a86c843f307793973bf438c85a7695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c293083f363421e50b0dc48d8119d7310a81abdc", "url": "https://github.com/eclipse-openj9/openj9/commit/c293083f363421e50b0dc48d8119d7310a81abdc", "message": "Move bytecodeLoop prototypes from vm_api.h to jvminit.c\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-04-15T15:33:33Z", "type": "forcePushed"}, {"oid": "9d61aa7a3a854c16448fb69081d1ce23c74f1e10", "url": "https://github.com/eclipse-openj9/openj9/commit/9d61aa7a3a854c16448fb69081d1ce23c74f1e10", "message": "Move bytecodeLoop prototypes from vm_api.h to jvminit.c\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-04-15T15:42:59Z", "type": "forcePushed"}, {"oid": "9b365dfc43b13f7c2f45b4bdb605801c7f9121b0", "url": "https://github.com/eclipse-openj9/openj9/commit/9b365dfc43b13f7c2f45b4bdb605801c7f9121b0", "message": "Add dummy define in split files to avoid OSX compile issue\n\nOSX complains about empty object files. As a temporary solution, #define LOOP_NAME 0 so that these files will not be empty when their ifdeffed code is not included.\n\nTo actually address this problem, these files should not be compiled if their code is disabled. Work will need to be done in makefiles, i.e. runtime/makelib/targets.mk.ftl, to skip compiling the appropriate files.\n\nFlags in omrcfg.h, i.e. OMR_GC_COMPRESSED_POINTERS and OMR_GC_FULL_POINTERS would be helpful in identifying which files should be compiled. Need to look into if these can be accessed in OpenJ9 makefiles or if there is an OpenJ9 equivalent to the flags.\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-04-16T15:23:01Z", "type": "forcePushed"}, {"oid": "f5e0f15dee8bf805199b478aa826a4c16c2eae33", "url": "https://github.com/eclipse-openj9/openj9/commit/f5e0f15dee8bf805199b478aa826a4c16c2eae33", "message": "Add dummy define in split files to avoid OSX compile issue\n\nOSX complains about empty object files. As a temporary solution, #define LOOP_NAME 0 so that these files will not be empty when their ifdeffed code is not included.\n\nTo actually address this problem, these files should not be compiled if their code is disabled. Work will need to be done in makefiles, i.e. runtime/makelib/targets.mk.ftl, to skip compiling the appropriate files.\n\nFlags in omrcfg.h, i.e. OMR_GC_COMPRESSED_POINTERS and OMR_GC_FULL_POINTERS would be helpful in identifying which files should be compiled. Need to look into if these can be accessed in OpenJ9 makefiles or if there is an OpenJ9 equivalent to the flags.\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-04-16T15:33:29Z", "type": "forcePushed"}, {"oid": "78c23d89a83bf4b1892c5ea345e619df94a26899", "url": "https://github.com/eclipse-openj9/openj9/commit/78c23d89a83bf4b1892c5ea345e619df94a26899", "message": "Add dummy define in split files to avoid OSX compile issue\n\nOSX complains about empty object files. As a temporary solution, #define LOOP_NAME 0 so that these files will not be empty when their ifdeffed code is not included.\n\nTo actually address this problem, these files should not be compiled if their code is disabled. Work will need to be done in makefiles, i.e. runtime/makelib/targets.mk.ftl, to skip compiling the appropriate files.\n\nFlags in omrcfg.h, i.e. OMR_GC_COMPRESSED_POINTERS and OMR_GC_FULL_POINTERS would be helpful in identifying which files should be compiled. Need to look into if these can be accessed in OpenJ9 makefiles or if there is an OpenJ9 equivalent to the flags.\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-04-16T17:21:15Z", "type": "forcePushed"}, {"oid": "afa8db4e9a2de83542565ad37722d090d11efa3d", "url": "https://github.com/eclipse-openj9/openj9/commit/afa8db4e9a2de83542565ad37722d090d11efa3d", "message": "Implement compressed refs override and split BytecodeInterpreter\n\nAdd new override macro J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES.\n\nSplit BytecodeInterpreter.cpp into BytecodeInterpreterFull.cpp and BytecodeInterpreterCompressed.cpp.\n\nSplit DebugBytecodeInterpreter.cpp into DebugBytecodeInterpreterFull.cpp and DebugBytecodeInterpreterCompressed.cpp.\n\nIf the override macro is defined, set J9VMTHREAD_COMPRESS_OBJECT_REFERENCES and J9JAVAVM_COMPRESS_OBJECT_REFERENCES to be the same value as the override macro.\n\nSplit BytecodeInterpreter.hpp included class names: ArrayCopyHelpers, ObjectHash, ObjectMonitor, ObjectAccessBarrierAPI, ObjectAllocationAPI, UnsafeAPI, VMHelpers into Full/Compressed\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-04-16T19:09:29Z", "type": "commit"}, {"oid": "afa8db4e9a2de83542565ad37722d090d11efa3d", "url": "https://github.com/eclipse-openj9/openj9/commit/afa8db4e9a2de83542565ad37722d090d11efa3d", "message": "Implement compressed refs override and split BytecodeInterpreter\n\nAdd new override macro J9_OVERRIDE_COMPRESS_OBJECT_REFERENCES.\n\nSplit BytecodeInterpreter.cpp into BytecodeInterpreterFull.cpp and BytecodeInterpreterCompressed.cpp.\n\nSplit DebugBytecodeInterpreter.cpp into DebugBytecodeInterpreterFull.cpp and DebugBytecodeInterpreterCompressed.cpp.\n\nIf the override macro is defined, set J9VMTHREAD_COMPRESS_OBJECT_REFERENCES and J9JAVAVM_COMPRESS_OBJECT_REFERENCES to be the same value as the override macro.\n\nSplit BytecodeInterpreter.hpp included class names: ArrayCopyHelpers, ObjectHash, ObjectMonitor, ObjectAccessBarrierAPI, ObjectAllocationAPI, UnsafeAPI, VMHelpers into Full/Compressed\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>", "committedDate": "2020-04-16T19:09:29Z", "type": "forcePushed"}]}