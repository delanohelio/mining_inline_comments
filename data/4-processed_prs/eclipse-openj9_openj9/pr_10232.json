{"pr_number": 10232, "pr_title": "JEP 360 sealed classes instrumentation restrictions", "pr_createdAt": "2020-07-23T18:48:12Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10232", "timeline": [{"oid": "f48c19e8f67e04cec974e4591a7b9a4920abb236", "url": "https://github.com/eclipse-openj9/openj9/commit/f48c19e8f67e04cec974e4591a7b9a4920abb236", "message": "JEP 360 sealed classes instrumentation tests\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-23T18:45:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA3NjcyNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10232#discussion_r460076726", "bodyText": "Please declare each variable on its own line and initialize them.", "author": "gacholio", "createdAt": "2020-07-24T14:10:35Z", "path": "runtime/util/hshelp.c", "diffHunk": "@@ -3220,6 +3220,54 @@ verifyRecordAttributesAreSame(J9ROMClass *originalROMClass, J9ROMClass *replacem\n done:\n \treturn rc;\n }\n+\n+static jvmtiError\n+verifyPermittedSubclassAttributeContentsMatch(J9ROMClass *originalROMClass, J9ROMClass *replacementROMClass)\n+{\n+\tjvmtiError rc = JVMTI_ERROR_NONE;\n+\n+\tif (J9ROMCLASS_IS_SEALED(originalROMClass) && J9ROMCLASS_IS_SEALED(replacementROMClass)) {\n+\t\tU_32* originalPermittedSubclassesCountPtr = getNumberOfPermittedSubclassesPtr(originalROMClass);\n+\t\tU_32* replacementPermittedSubclassesCountPtr = getNumberOfPermittedSubclassesPtr(replacementROMClass);\n+\n+\t\tif (*originalPermittedSubclassesCountPtr == *replacementPermittedSubclassesCountPtr) {\n+\t\t\tU_32 i, j;", "originalCommit": "29ffbf52cac1b7a2362491f6da73c6dd18aa64d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4MTc3NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10232#discussion_r460081775", "bodyText": "Also, j should be declared inside the loop.", "author": "gacholio", "createdAt": "2020-07-24T14:18:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA3NjcyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4MjAzMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10232#discussion_r460082032", "bodyText": "Use ! for booleans.", "author": "gacholio", "createdAt": "2020-07-24T14:18:59Z", "path": "runtime/util/hshelp.c", "diffHunk": "@@ -3220,6 +3220,54 @@ verifyRecordAttributesAreSame(J9ROMClass *originalROMClass, J9ROMClass *replacem\n done:\n \treturn rc;\n }\n+\n+static jvmtiError\n+verifyPermittedSubclassAttributeContentsMatch(J9ROMClass *originalROMClass, J9ROMClass *replacementROMClass)\n+{\n+\tjvmtiError rc = JVMTI_ERROR_NONE;\n+\n+\tif (J9ROMCLASS_IS_SEALED(originalROMClass) && J9ROMCLASS_IS_SEALED(replacementROMClass)) {\n+\t\tU_32* originalPermittedSubclassesCountPtr = getNumberOfPermittedSubclassesPtr(originalROMClass);\n+\t\tU_32* replacementPermittedSubclassesCountPtr = getNumberOfPermittedSubclassesPtr(replacementROMClass);\n+\n+\t\tif (*originalPermittedSubclassesCountPtr == *replacementPermittedSubclassesCountPtr) {\n+\t\t\tU_32 i, j;\n+\n+\t\t\tfor (i = 0; i < *originalPermittedSubclassesCountPtr; i++) {\n+\t\t\t\tBOOLEAN foundMatchingSubclass = FALSE;\n+\t\t\t\tJ9UTF8* originalSubclassNameUTF = permittedSubclassesNameAtIndex(originalPermittedSubclassesCountPtr, i);\n+\t\t\t\t\n+\t\t\t\t/* Find matching subclass name in replacement ROM class. The permitted subclasses are not required to be in the same order\n+\t\t\t\t * as the original class. Assume the replacement subclass is in the same slot as original to try to improve speed.\n+\t\t\t\t */\n+\t\t\t\tfor (j = 0; j < *originalPermittedSubclassesCountPtr; j++){\n+\t\t\t\t\tU_32 adjustedIndex = (i + j) % *originalPermittedSubclassesCountPtr;\n+\t\t\t\t\tJ9UTF8* replacementSubclassNameUTF = permittedSubclassesNameAtIndex(replacementPermittedSubclassesCountPtr, adjustedIndex);\n+\n+\t\t\t\t\tif (J9UTF8_EQUALS(originalSubclassNameUTF, replacementSubclassNameUTF)) {\n+\t\t\t\t\t\tfoundMatchingSubclass = TRUE;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n+\t\t\t\t/* check if matching subclass was found. */\n+\t\t\t\tif (FALSE == foundMatchingSubclass) {", "originalCommit": "29ffbf52cac1b7a2362491f6da73c6dd18aa64d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI1ODA5OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10232#discussion_r460258099", "bodyText": "updated.", "author": "theresa-m", "createdAt": "2020-07-24T19:53:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4MjAzMg=="}], "type": "inlineReview"}, {"oid": "e555d31f25c9dfeb20864f50859bf5c8d5513926", "url": "https://github.com/eclipse-openj9/openj9/commit/e555d31f25c9dfeb20864f50859bf5c8d5513926", "message": "JEP 360 sealed classes redef restrictions\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-24T16:45:58Z", "type": "commit"}, {"oid": "e555d31f25c9dfeb20864f50859bf5c8d5513926", "url": "https://github.com/eclipse-openj9/openj9/commit/e555d31f25c9dfeb20864f50859bf5c8d5513926", "message": "JEP 360 sealed classes redef restrictions\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-24T16:45:58Z", "type": "forcePushed"}]}