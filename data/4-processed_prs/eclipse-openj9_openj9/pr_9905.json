{"pr_number": 9905, "pr_title": "Add JDK15 JVMTI Version", "pr_createdAt": "2020-06-16T17:20:56Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9905", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441074716", "bodyText": "Does this mean that Java 8 is incorrect?", "author": "pshipton", "createdAt": "2020-06-16T18:57:33Z", "path": "runtime/include/jvmti.h.m4", "diffHunk": "@@ -47,8 +47,9 @@ JNIEXPORT jint JNICALL Agent_OnAttach(JavaVM* vm, char *options, void *reserved)\n #define JVMTI_VERSION_1 (JVMTI_VERSION_1_0)\n #define JVMTI_VERSION_9  0x30090000\n #define JVMTI_VERSION_11 0x300b0000\n+#define JVMTI_VERSION_15 0x300f0000\n \n-#define JVMTI_VERSION JVMTI_VERSION_11\n+ifelse(eval(JAVA_SPEC_VERSION >= 15), 1, [#define JVMTI_VERSION JVMTI_VERSION_15], [#define JVMTI_VERSION JVMTI_VERSION_11])", "originalCommit": "666dc98d542e250834044667179ae2093a8fc030", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3Njg4OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441076889", "bodyText": "It doesn't match Oracle - there is no java 8 specific version, it was still 1.something at that point, I think.", "author": "gacholio", "createdAt": "2020-06-16T19:01:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3ODEwMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441078102", "bodyText": "JVMTI_VERSION does exist in Oracle JDK8.", "author": "gacholio", "createdAt": "2020-06-16T19:03:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3ODg2MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441078861", "bodyText": "JDK8 didn't need special handling and worked with #define JVMTI_VERSION JVMTI_VERSION_11. I think JDK8 JCL jdwp native doesn't use JVMTI_VERSION.", "author": "JasonFengJ9", "createdAt": "2020-06-16T19:05:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3OTk5Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441079997", "bodyText": "I think it needs to be fixed for Java 8, it should be 1.2.1.\nSeems OpenJ9 Java 8 builds use OpenJDK jvmti.h, so it's correct there, but other builds (uhm IBM) have the wrong value.", "author": "pshipton", "createdAt": "2020-06-16T19:07:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA4ODc1OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441088759", "bodyText": "I think it needs to be fixed for Java 8, it should be 1.2.1.\n\nIs it to correct the jvmti.h file only? I assume there is no functional difference for IBM JDK8 itself since current JVMTI_VERSION value has been defined since it was introduced by JDK11.", "author": "JasonFengJ9", "createdAt": "2020-06-16T19:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA5MTc4MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441091781", "bodyText": "Others may be lazy in their agents and use the constant (this is extremely foolish, since you have to know what verison of TI you need to get any use out of it - you'd have to be using the lowest possible version of TI for this  to work at all).", "author": "gacholio", "createdAt": "2020-06-16T19:29:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA5NDc2OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441094769", "bodyText": "Is it to correct the jvmti.h file only?\n\nYes, it's clearly wrong for Java 8.  Anything using that constant won't necessarily run on Java 8. Agreed it won't make any functional difference to Java 8. Not sure why the IBM testing doesn't have any issue.", "author": "pshipton", "createdAt": "2020-06-16T19:35:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEzMDQzNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441130434", "bodyText": "Currently OpenJ9 JDK8 returns JVMTI_1_2_3_SPEC_VERSION (1.2.3).\nhttps://github.com/eclipse/openj9/blob/d89764f909755360950848a474c75c3ba8bb791f/runtime/jvmti/jvmtiGeneral.c#L182\nShould it be changed to JVMTI_1_2_SPEC_VERSION (1.2.1) to match RI instead?", "author": "JasonFengJ9", "createdAt": "2020-06-16T20:43:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1MTI0NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441151244", "bodyText": "Seems a good idea to match the RI. This can't have much field impact, I note it was version 9 since 2016 before it changed to version 11.", "author": "pshipton", "createdAt": "2020-06-16T21:25:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE2NzE1Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441167156", "bodyText": "Sorry, I have to change the request.\nIt is clear that JVMTI_VERSION is 1.2.1 with value of 0x30010201. However I run this same JVM to against a simple testcase invoking jvmti->GetVersionNumber(version_ptr), and got 0x30010203 which is 1.2.3, i.e., JVMTI_1_2_3_SPEC_VERSION currently returned by OpenJ9, so this was to match RI behaviour, and should keep that way instead.\nIt appears there is an internal define within RI.", "author": "JasonFengJ9", "createdAt": "2020-06-16T22:01:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMTIxOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441231219", "bodyText": "Limited JVMTI_VERSION_15 for JDK15, JVMTI_VERSION_11 for JDK11+,\nJVMTI_VERSION_9 for JDK9+, also defined JVMTI_VERSION accordingly.\nPlease re-review.", "author": "JasonFengJ9", "createdAt": "2020-06-17T01:35:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3NDcxNg=="}], "type": "inlineReview"}, {"oid": "c088833a093e2a16d9f4354f0add3c4c2693640a", "url": "https://github.com/eclipse-openj9/openj9/commit/c088833a093e2a16d9f4354f0add3c4c2693640a", "message": "Add JDK15 JVMTI Version\n\nDefined JVMTI_VERSION_15 for JDK15, limited JVMTI_VERSION_11 for JDK11+,\nJVMTI_VERSION_9 for JDK9+, also defined JVMTI_VERSION accordingly;\nUpdated jvmtiGetVersionNumber() & jvmtiHookGetEnv();\nMinor refactoring.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-06-17T00:37:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMTgwNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441231804", "bodyText": "Pls remove the blank line", "author": "pshipton", "createdAt": "2020-06-17T01:38:02Z", "path": "runtime/include/jvmti.h.m4", "diffHunk": "@@ -45,16 +45,20 @@ JNIEXPORT jint JNICALL Agent_OnAttach(JavaVM* vm, char *options, void *reserved)\n #define JVMTI_VERSION_1_1 0x30010100\n #define JVMTI_VERSION_1_2 0x30010200\n #define JVMTI_VERSION_1 (JVMTI_VERSION_1_0)\n-#define JVMTI_VERSION_9  0x30090000\n-#define JVMTI_VERSION_11 0x300b0000\n ", "originalCommit": "c088833a093e2a16d9f4354f0add3c4c2693640a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0NTQyNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441245427", "bodyText": "Removed.", "author": "JasonFengJ9", "createdAt": "2020-06-17T02:30:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMTgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMTk0NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441231945", "bodyText": "Since 9 & 10 aren't supported, this could be 11.", "author": "pshipton", "createdAt": "2020-06-17T01:38:36Z", "path": "runtime/include/jvmti.h.m4", "diffHunk": "@@ -45,16 +45,20 @@ JNIEXPORT jint JNICALL Agent_OnAttach(JavaVM* vm, char *options, void *reserved)\n #define JVMTI_VERSION_1_1 0x30010100\n #define JVMTI_VERSION_1_2 0x30010200\n #define JVMTI_VERSION_1 (JVMTI_VERSION_1_0)\n-#define JVMTI_VERSION_9  0x30090000\n-#define JVMTI_VERSION_11 0x300b0000\n \n-#define JVMTI_VERSION JVMTI_VERSION_11\n+ifelse(eval(JAVA_SPEC_VERSION >= 9), 1, [#define JVMTI_VERSION_9  0x30090000", "originalCommit": "c088833a093e2a16d9f4354f0add3c4c2693640a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMjk5MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441232990", "bodyText": "Or > 8", "author": "pshipton", "createdAt": "2020-06-17T01:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMTk0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0NTQ5MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441245491", "bodyText": "sure, dropped the support of JDK 9/10.", "author": "JasonFengJ9", "createdAt": "2020-06-17T02:30:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMTk0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMjA2Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441232063", "bodyText": "9 is not supported, pls remove this.", "author": "pshipton", "createdAt": "2020-06-17T01:39:00Z", "path": "runtime/include/jvmti.h.m4", "diffHunk": "@@ -45,16 +45,20 @@ JNIEXPORT jint JNICALL Agent_OnAttach(JavaVM* vm, char *options, void *reserved)\n #define JVMTI_VERSION_1_1 0x30010100\n #define JVMTI_VERSION_1_2 0x30010200\n #define JVMTI_VERSION_1 (JVMTI_VERSION_1_0)\n-#define JVMTI_VERSION_9  0x30090000\n-#define JVMTI_VERSION_11 0x300b0000\n \n-#define JVMTI_VERSION JVMTI_VERSION_11\n+ifelse(eval(JAVA_SPEC_VERSION >= 9), 1, [#define JVMTI_VERSION_9  0x30090000\n+ifelse(eval(JAVA_SPEC_VERSION >= 11), 1, [#define JVMTI_VERSION_11 0x300b0000\n+ifelse(eval(JAVA_SPEC_VERSION >= 15), 1, [#define JVMTI_VERSION_15 0x300f0000], [dnl])], [dnl])], [dnl])\n \n #define JVMTI_1_0_SPEC_VERSION           (JVMTI_VERSION_1_0 + 37)\t/* Spec version is 1.0.37 */\n #define JVMTI_1_1_SPEC_VERSION           (JVMTI_VERSION_1_1 + 102)\t/* Spec version is 1.1.102 */\n #define JVMTI_1_2_SPEC_VERSION           (JVMTI_VERSION_1_2 + 1)\t/* Spec version is 1.2.1 */\n #define JVMTI_1_2_3_SPEC_VERSION         (JVMTI_VERSION_1_2 + 3)  /* Spec version is 1.2.3 */\n \n+ifelse(eval(JAVA_SPEC_VERSION >= 15), 1, [#define JVMTI_VERSION JVMTI_VERSION_15], [\n+ifelse(eval(JAVA_SPEC_VERSION >= 11), 1, [#define JVMTI_VERSION JVMTI_VERSION_11], [\n+ifelse(eval(JAVA_SPEC_VERSION >= 9), 1, [#define JVMTI_VERSION JVMTI_VERSION_9], [", "originalCommit": "c088833a093e2a16d9f4354f0add3c4c2693640a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0NTUyMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441245521", "bodyText": "Removed.", "author": "JasonFengJ9", "createdAt": "2020-06-17T02:30:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMjA2Mw=="}], "type": "inlineReview"}, {"oid": "514107c7e4d77705a92112ca5eae5796573e1f60", "url": "https://github.com/eclipse-openj9/openj9/commit/514107c7e4d77705a92112ca5eae5796573e1f60", "message": "Add JDK15 JVMTI Version\n\nDefined JVMTI_VERSION_15 for JDK15, limited JVMTI_VERSION_11 for JDK11+,\nJVMTI_VERSION_9 for JDK9+, also defined JVMTI_VERSION accordingly;\nUpdated jvmtiGetVersionNumber() & jvmtiHookGetEnv();\nMinor refactoring.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-06-17T02:26:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MjI5Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441262297", "bodyText": "9 inside the 11 ifdef seems odd.", "author": "gacholio", "createdAt": "2020-06-17T03:39:39Z", "path": "runtime/include/jvmti.h.m4", "diffHunk": "@@ -45,16 +45,18 @@ JNIEXPORT jint JNICALL Agent_OnAttach(JavaVM* vm, char *options, void *reserved)\n #define JVMTI_VERSION_1_1 0x30010100\n #define JVMTI_VERSION_1_2 0x30010200\n #define JVMTI_VERSION_1 (JVMTI_VERSION_1_0)\n-#define JVMTI_VERSION_9  0x30090000\n+ifelse(eval(JAVA_SPEC_VERSION >= 11), 1, [#define JVMTI_VERSION_9  0x30090000", "originalCommit": "514107c7e4d77705a92112ca5eae5796573e1f60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ2MDI3Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441460273", "bodyText": "JVMTI_VERSION_9 is supported by LTS JDK 11 but not JDK 8, this define should not appear within JDK 8 jvmti.h, since JDK 9/10 are out of service, its home becomes JDK11 instead. I guess this is the state of new Java version scheme.", "author": "JasonFengJ9", "createdAt": "2020-06-17T10:56:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MjI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUyNjMzMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441526331", "bodyText": "The less odd way is > 8, but either way is fine with me.", "author": "pshipton", "createdAt": "2020-06-17T13:01:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MjI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzMjEyMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441532123", "bodyText": "I do think it's better as it is now.", "author": "pshipton", "createdAt": "2020-06-17T13:10:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MjI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzNTgxNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441535816", "bodyText": "ah, just changed to eval(JAVA_SPEC_VERSION > 8), please confirm if you want previous >=11 version.", "author": "JasonFengJ9", "createdAt": "2020-06-17T13:16:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MjI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzOTAwNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441539004", "bodyText": "GAC can decide.", "author": "pshipton", "createdAt": "2020-06-17T13:20:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MjI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU0MjE3OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441542178", "bodyText": "I am taking JAVA_SPEC_VERSION > 8 for now which is consistent with the other checks in this PR for JVMTI_VERSION_9 cases.", "author": "JasonFengJ9", "createdAt": "2020-06-17T13:25:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MjI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzMDgwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441530809", "bodyText": "The switch uses value version & ~JVMTI_VERSION_MASK_MICRO so this case will never occur.", "author": "pshipton", "createdAt": "2020-06-17T13:08:39Z", "path": "runtime/tests/jvmtitests/agent/version.c", "diffHunk": "@@ -60,10 +62,20 @@ getVersionName(agentEnv * agent_env, jint version)\n \t\t\treturn versionNames[1];\n \t\tcase JVMTI_VERSION_1_2:\n \t\t\treturn versionNames[2];\n-\t\tcase JVMTI_VERSION_9:\n+\t\tcase JVMTI_1_2_SPEC_VERSION:", "originalCommit": "514107c7e4d77705a92112ca5eae5796573e1f60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU0NTY3MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441545670", "bodyText": "Agreed, this is same as the condition value within jvmtiHookGetEnv(), removed JVMTI_1_2_SPEC_VERSION.", "author": "JasonFengJ9", "createdAt": "2020-06-17T13:30:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzMDgwOQ=="}], "type": "inlineReview"}, {"oid": "3ddd8c536dad167cab97ecc1b7776276b8a5dc76", "url": "https://github.com/eclipse-openj9/openj9/commit/3ddd8c536dad167cab97ecc1b7776276b8a5dc76", "message": "Add JDK15 JVMTI Version\n\nDefined JVMTI_VERSION_15 for JDK15, limited JVMTI_VERSION_11 for JDK11+,\nJVMTI_VERSION_9 for JDK9+, also defined JVMTI_VERSION accordingly;\nUpdated jvmtiGetVersionNumber() & jvmtiHookGetEnv();\nMinor refactoring.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-06-17T13:12:25Z", "type": "forcePushed"}, {"oid": "07a12766a0db3912754d39d618c6dfff84f5e7e6", "url": "https://github.com/eclipse-openj9/openj9/commit/07a12766a0db3912754d39d618c6dfff84f5e7e6", "message": "Add JDK15 JVMTI Version\n\nDefined JVMTI_VERSION_15 for JDK15, limited JVMTI_VERSION_11 for JDK11+,\nJVMTI_VERSION_9 for JDK9+, also defined JVMTI_VERSION accordingly;\nUpdated jvmtiGetVersionNumber() & jvmtiHookGetEnv();\nMinor refactoring.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-06-17T13:27:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1NjMzNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441556335", "bodyText": "To be consistent with jvmti.h.m4, this check could be removed.", "author": "pshipton", "createdAt": "2020-06-17T13:44:48Z", "path": "runtime/jvmti/jvmtiHook.c", "diffHunk": "@@ -1582,20 +1582,24 @@ jvmtiHookGetEnv(J9HookInterface** hook, UDATA eventNum, void* eventData, void* u\n \tif (data->rc == JNI_EVERSION) {\n \t\tjint version = data->version & ~JVMTI_VERSION_MASK_MICRO;\n \n-\t\tif ((version == JVMTI_VERSION_1_0) \n-\t\t\t|| (version == JVMTI_VERSION_1_1) \n-\t\t\t|| (version == JVMTI_VERSION_1_2) \n-\t\t\t|| (version == JVMTI_VERSION_9)\n-\t\t\t|| (version == JVMTI_VERSION_11)\n+\t\tif ((JVMTI_VERSION_1_0 == version)\n+\t\t\t|| (JVMTI_VERSION_1_1 == version)\n+\t\t\t|| (JVMTI_VERSION_1_2 == version)\n+#if JAVA_SPEC_VERSION > 8\n+\t\t\t|| (JVMTI_VERSION_9 == version)\n+#if JAVA_SPEC_VERSION >= 11", "originalCommit": "07a12766a0db3912754d39d618c6dfff84f5e7e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5MDU3MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441590571", "bodyText": "Agreed, removed it.", "author": "JasonFengJ9", "createdAt": "2020-06-17T14:30:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1NjMzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1NjQ5OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441556499", "bodyText": "This one as well.", "author": "pshipton", "createdAt": "2020-06-17T13:45:02Z", "path": "runtime/tests/jvmtitests/agent/version.c", "diffHunk": "@@ -60,10 +61,18 @@ getVersionName(agentEnv * agent_env, jint version)\n \t\t\treturn versionNames[1];\n \t\tcase JVMTI_VERSION_1_2:\n \t\t\treturn versionNames[2];\n+#if JAVA_SPEC_VERSION > 8\n \t\tcase JVMTI_VERSION_9:\n \t\t\treturn versionNames[3];\n+#if JAVA_SPEC_VERSION >= 11", "originalCommit": "07a12766a0db3912754d39d618c6dfff84f5e7e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5MDc0MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9905#discussion_r441590740", "bodyText": "Same here.", "author": "JasonFengJ9", "createdAt": "2020-06-17T14:30:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1NjQ5OQ=="}], "type": "inlineReview"}, {"oid": "260b66a309c4aa0b096e6e5134ee7e9c6adcf1b6", "url": "https://github.com/eclipse-openj9/openj9/commit/260b66a309c4aa0b096e6e5134ee7e9c6adcf1b6", "message": "Add JDK15 JVMTI Version\n\nDefined JVMTI_VERSION_15 for JDK15, limited JVMTI_VERSION_11 for JDK11+,\nJVMTI_VERSION_9 for JDK9+, also defined JVMTI_VERSION accordingly;\nUpdated jvmtiGetVersionNumber() & jvmtiHookGetEnv();\nMinor refactoring.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-06-17T14:29:45Z", "type": "forcePushed"}, {"oid": "9a61a22d8720554393c224bb8bb9e24555da5c07", "url": "https://github.com/eclipse-openj9/openj9/commit/9a61a22d8720554393c224bb8bb9e24555da5c07", "message": "Add JDK15 JVMTI Version\n\nDefined JVMTI_VERSION_15 for JDK15, limited JVMTI_VERSION_11 for JDK11+,\nJVMTI_VERSION_9 for JDK9+, also defined JVMTI_VERSION accordingly;\nUpdated jvmtiGetVersionNumber() & jvmtiHookGetEnv();\nMinor refactoring.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-06-17T16:47:23Z", "type": "commit"}, {"oid": "9a61a22d8720554393c224bb8bb9e24555da5c07", "url": "https://github.com/eclipse-openj9/openj9/commit/9a61a22d8720554393c224bb8bb9e24555da5c07", "message": "Add JDK15 JVMTI Version\n\nDefined JVMTI_VERSION_15 for JDK15, limited JVMTI_VERSION_11 for JDK11+,\nJVMTI_VERSION_9 for JDK9+, also defined JVMTI_VERSION accordingly;\nUpdated jvmtiGetVersionNumber() & jvmtiHookGetEnv();\nMinor refactoring.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-06-17T16:47:23Z", "type": "forcePushed"}]}