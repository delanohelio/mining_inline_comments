{"pr_number": 11247, "pr_title": "Add ability to activate CH Table at an arbitrary point", "pr_createdAt": "2020-11-23T18:15:14Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11247", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI0NDM4NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11247#discussion_r534244384", "bodyText": "For completeness, add activationFailed ?", "author": "0xdaryl", "createdAt": "2020-12-02T15:12:55Z", "path": "runtime/compiler/env/PersistentCHTable.hpp", "diffHunk": "@@ -46,6 +46,24 @@ namespace TR { class ResolvedMethodSymbol; }\n \n class TR_PersistentCHTable\n    {\n+   private:\n+   /**\n+    * @brief Enum to denote the state of the CH Table:\n+    *\n+    *        active: Data in the CH Table can be used and updated.\n+    *        activating: CH Table is in the process of being activated;\n+    *                    this state is used when the CH Table is\n+    *                    being populated in the restore run.\n+    *        reset: CH Table is not active.", "originalCommit": "e589b6b7e84f4e33a22fa2a30b33eaa3031518fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMwOTgxNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11247#discussion_r534309814", "bodyText": "Done, see https://github.com/eclipse/openj9/compare/0efdded6403247d28fca53431cb1a2abe4487fdf..043c3c65ba6a7889d13137fccdf5885a384e3e2e", "author": "dsouzai", "createdAt": "2020-12-02T16:33:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI0NDM4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI0NDcwNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11247#discussion_r534244707", "bodyText": "Should reset be first to match the ordering in the enum?", "author": "0xdaryl", "createdAt": "2020-12-02T15:13:22Z", "path": "runtime/compiler/env/PersistentCHTable.hpp", "diffHunk": "@@ -46,6 +46,24 @@ namespace TR { class ResolvedMethodSymbol; }\n \n class TR_PersistentCHTable\n    {\n+   private:\n+   /**\n+    * @brief Enum to denote the state of the CH Table:\n+    *\n+    *        active: Data in the CH Table can be used and updated.\n+    *        activating: CH Table is in the process of being activated;\n+    *                    this state is used when the CH Table is\n+    *                    being populated in the restore run.\n+    *        reset: CH Table is not active.", "originalCommit": "e589b6b7e84f4e33a22fa2a30b33eaa3031518fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMwOTg1OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11247#discussion_r534309859", "bodyText": "Done, see https://github.com/eclipse/openj9/compare/0efdded6403247d28fca53431cb1a2abe4487fdf..043c3c65ba6a7889d13137fccdf5885a384e3e2e", "author": "dsouzai", "createdAt": "2020-12-02T16:33:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI0NDcwNw=="}], "type": "inlineReview"}, {"oid": "feffd039c2a010d5ca1b8b977a7f9149f5e29913", "url": "https://github.com/eclipse-openj9/openj9/commit/feffd039c2a010d5ca1b8b977a7f9149f5e29913", "message": "Add _status field\n\nAdd field that will be used to determine whether the CH Table is active\nor not.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:26Z", "type": "commit"}, {"oid": "52dbc2588c216981daa12d676fcd98116ac91c87", "url": "https://github.com/eclipse-openj9/openj9/commit/52dbc2588c216981daa12d676fcd98116ac91c87", "message": "Disable CH Opts if CHT is not active\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:27Z", "type": "commit"}, {"oid": "9b6d5974bf29f56f5dd81d8080d6c48d7dd26ff7", "url": "https://github.com/eclipse-openj9/openj9/commit/9b6d5974bf29f56f5dd81d8080d6c48d7dd26ff7", "message": "Refactor jitHookClassLoad\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:27Z", "type": "commit"}, {"oid": "fccb45befc4c7f5db5c3570cae50287dbde39e96", "url": "https://github.com/eclipse-openj9/openj9/commit/fccb45befc4c7f5db5c3570cae50287dbde39e96", "message": "Refactor jitHookClassPreinitialize\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:27Z", "type": "commit"}, {"oid": "a621c7c9c17e73a1206c380ca1b78f370bd7f82f", "url": "https://github.com/eclipse-openj9/openj9/commit/a621c7c9c17e73a1206c380ca1b78f370bd7f82f", "message": "Ensure CHT is active in class unload hooks\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:27Z", "type": "commit"}, {"oid": "1f8972a66141270d335d24e00183042286d2c233", "url": "https://github.com/eclipse-openj9/openj9/commit/1f8972a66141270d335d24e00183042286d2c233", "message": "Ensure CHT is active in class redef hooks\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:27Z", "type": "commit"}, {"oid": "f01a06c54b6512519edbba9fb15c4d388a2df5bf", "url": "https://github.com/eclipse-openj9/openj9/commit/f01a06c54b6512519edbba9fb15c4d388a2df5bf", "message": "Add sanity checks to CHT APIs\n\nEnsure that the CHT APIs are aware of the status of the CHT.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:27Z", "type": "commit"}, {"oid": "1e1398ea8436d4b450baf2d8789a1f19ee997f5d", "url": "https://github.com/eclipse-openj9/openj9/commit/1e1398ea8436d4b450baf2d8789a1f19ee997f5d", "message": "Add ability to activate CH Table\n\nThis commit adds an API to activate the the CH Table. This only makes\nsense in the context of Snapshot/Restore. It assumes a stop the world\nevent where the class hierarchy isn't changing. It then calls a helper\nmethod which is recursive, as follows:\n\n1. Add superclasses\n2. Add interfaces implemented\n3. Trigger class load hook\n4. Trigger class preinitialize hook\n5. Add array class\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:27Z", "type": "commit"}, {"oid": "043c3c65ba6a7889d13137fccdf5885a384e3e2e", "url": "https://github.com/eclipse-openj9/openj9/commit/043c3c65ba6a7889d13137fccdf5885a384e3e2e", "message": "Abstract away check for whether recompilation is allowed\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:37Z", "type": "commit"}, {"oid": "043c3c65ba6a7889d13137fccdf5885a384e3e2e", "url": "https://github.com/eclipse-openj9/openj9/commit/043c3c65ba6a7889d13137fccdf5885a384e3e2e", "message": "Abstract away check for whether recompilation is allowed\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>", "committedDate": "2020-12-02T16:32:37Z", "type": "forcePushed"}]}