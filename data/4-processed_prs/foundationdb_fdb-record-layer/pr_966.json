{"pr_number": 966, "pr_title": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely", "pr_createdAt": "2020-06-13T16:32:31Z", "pr_url": "https://github.com/FoundationDB/fdb-record-layer/pull/966", "timeline": [{"oid": "009c34c0acc57d27ea9f0d7718169d66ceaa9d44", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/009c34c0acc57d27ea9f0d7718169d66ceaa9d44", "message": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely\n\nThis adds a new `VersionstampSaveBehavior` setting, `IF_PRESENT`, which only saves a version with a record if the provided version is not `null`.\nThis is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\n\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm\nnot super happy with #964 as it is right now.\n\nThis resolves #958.", "committedDate": "2020-06-18T18:08:38Z", "type": "forcePushed"}, {"oid": "8b90ebed8c84a86d80e6389bec12efe07e48c9d9", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/8b90ebed8c84a86d80e6389bec12efe07e48c9d9", "message": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely\n\nThis adds a new `VersionstampSaveBehavior` setting, `IF_PRESENT`, which only saves a version with a record if the provided version is not `null`.\nThis is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\n\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm\nnot super happy with #964 as it is right now.\n\nThis resolves #958.", "committedDate": "2020-10-15T20:49:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjUwNzA0Mw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/966#discussion_r592507043", "bodyText": "Should this reference issue  #964", "author": "ScottDugas", "createdAt": "2021-03-11T16:25:06Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordStoreBase.java", "diffHunk": "@@ -299,13 +299,34 @@ public boolean errorIfTypeChanged() {\n     /**\n      * Provided during record save (via {@link #saveRecord(Message, FDBRecordVersion, VersionstampSaveBehavior)}),\n      * directs the behavior of the save w.r.t. the record's version.\n-     * In the presence of a version, either <code>DEFAULT</code> or <code>WITH_VERSION</code> can be used.\n+     * In the presence of a version, either {@code DEFAULT} or {@code WITH_VERSION} can be used.\n      * For safety, <code>NO_VERSION</code> should only be used with a null version.\n      */\n     enum VersionstampSaveBehavior {\n-        DEFAULT,        // Follow rules dictated by the metadata\n-        NO_VERSION,     // Explicitly do NOT save a version\n-        WITH_VERSION,   // Explicitly save a version even if meta-data says not to\n+        /**\n+         * Match the behavior dictated by the meta-data. If {@link com.apple.foundationdb.record.RecordMetaData#isStoreRecordVersions()}\n+         * returns {@code true}, this will always store the record with a version (like {@link #WITH_VERSION}). Otherwise,\n+         * it will store the record with the provided version if given or with no version if not.", "originalCommit": "8b90ebed8c84a86d80e6389bec12efe07e48c9d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Mjc3MDQ4NA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/966#discussion_r592770484", "bodyText": "Yeah, that sounds like a good idea. I added it to WITH_VERSION instead of DEFAULT, as I think it applies to both and DEFAULT already references WITH_VERSION", "author": "alecgrieser", "createdAt": "2021-03-11T22:34:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjUwNzA0Mw=="}], "type": "inlineReview"}, {"oid": "52f234d3a2f80164d1584ad78e2cb2c101e096e6", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/52f234d3a2f80164d1584ad78e2cb2c101e096e6", "message": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely\n\nThis adds a new `VersionstampSaveBehavior` setting, `IF_PRESENT`, which only saves a version with a record if the provided version is not `null`.\nThis is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\n\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm\nnot super happy with #964 as it is right now.\n\nThis resolves #958.", "committedDate": "2021-03-11T22:22:40Z", "type": "commit"}, {"oid": "11ba06b09e1f9c2cc56a29749461bb1df1b80746", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/11ba06b09e1f9c2cc56a29749461bb1df1b80746", "message": "add a clarifying comment referencing #964", "committedDate": "2021-03-11T22:34:03Z", "type": "commit"}, {"oid": "11ba06b09e1f9c2cc56a29749461bb1df1b80746", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/11ba06b09e1f9c2cc56a29749461bb1df1b80746", "message": "add a clarifying comment referencing #964", "committedDate": "2021-03-11T22:34:03Z", "type": "forcePushed"}]}