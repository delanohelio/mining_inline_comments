{"pr_number": 743, "pr_title": "Improvements to various quickstart scripts for execution on Mac OS X", "pr_createdAt": "2020-02-11T16:05:10Z", "pr_url": "https://github.com/NationalSecurityAgency/datawave/pull/743", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc2Njc0Mw==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377766743", "bodyText": "Won't this leave backup files around that we need to clean up?", "author": "ivakegg", "createdAt": "2020-02-11T16:57:07Z", "path": "contrib/datawave-quickstart/bin/services/accumulo/install.sh", "diffHunk": "@@ -59,9 +59,9 @@ fi\n assertCreateDir \"${DW_ACCUMULO_JVM_HEAPDUMP_DIR}\"\n \n # Update tserver and other options in accumulo-env.sh\n-sed -i \"s~\\(ACCUMULO_TSERVER_OPTS=\\).*$~\\1\\\"${DW_ACCUMULO_TSERVER_OPTS}\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh\n-sed -i \"s~\\(export JAVA_HOME=\\).*$~\\1\\\"${JAVA_HOME}\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh\n-sed -i \"s~\\(export ACCUMULO_MONITOR_OPTS=\\).*$~\\1\\\"\\${POLICY} -Xmx2g -Xms512m\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh\n+sed -i'bak' \"s~\\(ACCUMULO_TSERVER_OPTS=\\).*$~\\1\\\"${DW_ACCUMULO_TSERVER_OPTS}\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh\n+sed -i'bak' \"s~\\(export JAVA_HOME=\\).*$~\\1\\\"${JAVA_HOME}\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh\n+sed -i'bak' \"s~\\(export ACCUMULO_MONITOR_OPTS=\\).*$~\\1\\\"\\${POLICY} -Xmx2g -Xms512m\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh", "originalCommit": "8b19ded7455001d51c2eb71c095fb6b3f1fa4df6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc3MDA0Mw==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377770043", "bodyText": "I think you can do sed -i''", "author": "alerman", "createdAt": "2020-02-11T17:02:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc2Njc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc3NTY2MA==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377775660", "bodyText": "Yup, that seems to work in my local testing. (Tested in a CentOS docker container too in order to make sure that doesn't break there.)", "author": "brianloss", "createdAt": "2020-02-11T17:11:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc2Njc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc4MzA2MA==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377783060", "bodyText": "Not an issue, really. Any cruft in DW_ACCUMULO_CONF_DIR will get obliterated automatically on an uninstall/reinstall, along with any other paths created by the quickstart.", "author": "keith-ratcliffe", "createdAt": "2020-02-11T17:24:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc2Njc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NDc4NA==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377884784", "bodyText": "It would have been nice if sed -i'' would have worked, but it didn't. I've added a sed ... && rm ....bak to the end of these to clean up the backup file if the sed completes successfully.", "author": "drewfarris", "createdAt": "2020-02-11T20:38:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc2Njc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NTY4MQ==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377885681", "bodyText": "I'll re-run and capture the specific error..", "author": "drewfarris", "createdAt": "2020-02-11T20:41:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc2Njc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5MDQ3NQ==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377890475", "bodyText": "Here's the bizarre error that I get regardless of whether I'm using a bare -i or -i''\nsed: 1: \"/Users/andrewfarris/pro ...\": command a expects \\ followed by text", "author": "drewfarris", "createdAt": "2020-02-11T20:50:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc2Njc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5NTY3Nw==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377895677", "bodyText": "Ultimately, this works:\nsed -i'' -e 's|.*\\(export JAVA_HOME=\\).*|\\1'${JAVA_HOME}'|g' ${HADOOP_CONF_DIR}/hadoop-env.sh\n\nWhereas this fails:\nsed -i'' \"s|.*\\(export JAVA_HOME=\\).*|\\1${JAVA_HOME}|g\" ${HADOOP_CONF_DIR}/hadoop-env.sh`", "author": "drewfarris", "createdAt": "2020-02-11T21:01:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc2Njc0Mw=="}], "type": "inlineReview"}, {"oid": "3f4e4493e7f3588a9b572917dea4ae5751c1ead0", "url": "https://github.com/NationalSecurityAgency/datawave/commit/3f4e4493e7f3588a9b572917dea4ae5751c1ead0", "message": "Improvements to various quickstart scripts..\n\n . For Yarn, the directories MR_INTER_DIR and MR_DONE_DIR are on HDFS, so no need to have DW_CLOUD_DATA as a\n   prefix for these and we no longer need to assert that they exist on the local disk.\n . Changed argument structure for pgrep. Neither the OSX pgrep or the proctools pgrep did the right thing\n   with the current implementation.\n . OSX sed wasn't happy with the bare -i argument, so we do -i'bak' and clean up the backup files.\n . Changed process names in pgrep for hadoop to work aroung process name length limitation on OSX", "committedDate": "2020-02-11T20:09:30Z", "type": "commit"}, {"oid": "3f4e4493e7f3588a9b572917dea4ae5751c1ead0", "url": "https://github.com/NationalSecurityAgency/datawave/commit/3f4e4493e7f3588a9b572917dea4ae5751c1ead0", "message": "Improvements to various quickstart scripts..\n\n . For Yarn, the directories MR_INTER_DIR and MR_DONE_DIR are on HDFS, so no need to have DW_CLOUD_DATA as a\n   prefix for these and we no longer need to assert that they exist on the local disk.\n . Changed argument structure for pgrep. Neither the OSX pgrep or the proctools pgrep did the right thing\n   with the current implementation.\n . OSX sed wasn't happy with the bare -i argument, so we do -i'bak' and clean up the backup files.\n . Changed process names in pgrep for hadoop to work aroung process name length limitation on OSX", "committedDate": "2020-02-11T20:09:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg3OTg4NQ==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377879885", "bodyText": "Why not just sed -i '' instead of sed -i '.bak' and then you don't have to remove the .bak file separately?", "author": "brianloss", "createdAt": "2020-02-11T20:28:42Z", "path": "contrib/datawave-quickstart/bin/services/hadoop/install.sh", "diffHunk": "@@ -89,13 +89,10 @@ else\n fi\n \n # Ensure that $JAVA_HOME is observed by all hadoop scripts\n-sed -i \"s|.*\\(export JAVA_HOME=\\).*|\\1${JAVA_HOME}|g\" ${HADOOP_CONF_DIR}/hadoop-env.sh\n+sed -i'.bak' \"s|.*\\(export JAVA_HOME=\\).*|\\1${JAVA_HOME}|g\" ${HADOOP_CONF_DIR}/hadoop-env.sh && rm ${HADOOP_CONF_DIR}/hadoop-env.sh.bak", "originalCommit": "3f4e4493e7f3588a9b572917dea4ae5751c1ead0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4MDA0OQ==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377880049", "bodyText": "Why not just sed -i '' instead of sed -i '.bak' and then you don't have to remove the .bak file separately?", "author": "brianloss", "createdAt": "2020-02-11T20:28:59Z", "path": "contrib/datawave-quickstart/bin/services/accumulo/install.sh", "diffHunk": "@@ -59,9 +59,9 @@ fi\n assertCreateDir \"${DW_ACCUMULO_JVM_HEAPDUMP_DIR}\"\n \n # Update tserver and other options in accumulo-env.sh\n-sed -i \"s~\\(ACCUMULO_TSERVER_OPTS=\\).*$~\\1\\\"${DW_ACCUMULO_TSERVER_OPTS}\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh\n-sed -i \"s~\\(export JAVA_HOME=\\).*$~\\1\\\"${JAVA_HOME}\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh\n-sed -i \"s~\\(export ACCUMULO_MONITOR_OPTS=\\).*$~\\1\\\"\\${POLICY} -Xmx2g -Xms512m\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh\n+sed -i'.bak' \"s~\\(ACCUMULO_TSERVER_OPTS=\\).*$~\\1\\\"${DW_ACCUMULO_TSERVER_OPTS}\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh && rm ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh.bak\n+sed -i'.bak' \"s~\\(export JAVA_HOME=\\).*$~\\1\\\"${JAVA_HOME}\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh && rm ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh.bak\n+sed -i'.bak' \"s~\\(export ACCUMULO_MONITOR_OPTS=\\).*$~\\1\\\"\\${POLICY} -Xmx2g -Xms512m\\\"~g\" ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh && rm ${DW_ACCUMULO_CONF_DIR}/accumulo-env.sh.bak", "originalCommit": "3f4e4493e7f3588a9b572917dea4ae5751c1ead0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4Mjg2NA==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377882864", "bodyText": "What's the reason for removing these lines?", "author": "brianloss", "createdAt": "2020-02-11T20:34:56Z", "path": "contrib/datawave-quickstart/bin/services/hadoop/install.sh", "diffHunk": "@@ -89,13 +89,10 @@ else\n fi\n \n # Ensure that $JAVA_HOME is observed by all hadoop scripts\n-sed -i \"s|.*\\(export JAVA_HOME=\\).*|\\1${JAVA_HOME}|g\" ${HADOOP_CONF_DIR}/hadoop-env.sh\n+sed -i'.bak' \"s|.*\\(export JAVA_HOME=\\).*|\\1${JAVA_HOME}|g\" ${HADOOP_CONF_DIR}/hadoop-env.sh && rm ${HADOOP_CONF_DIR}/hadoop-env.sh.bak\n \n verifySSHConfig\n \n-assertCreateDir \"${DW_HADOOP_MR_INTER_DIR}\"\n-assertCreateDir \"${DW_HADOOP_MR_DONE_DIR}\"\n-", "originalCommit": "3f4e4493e7f3588a9b572917dea4ae5751c1ead0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NjIxMQ==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377886211", "bodyText": "They're not needed because the directories are on HDFS - assertCreateDir checks local filesystem directories.", "author": "drewfarris", "createdAt": "2020-02-11T20:42:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4Mjg2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NjY2OQ==", "url": "https://github.com/NationalSecurityAgency/datawave/pull/743#discussion_r377886669", "bodyText": "Ah, sounds good. Thanks.", "author": "brianloss", "createdAt": "2020-02-11T20:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4Mjg2NA=="}], "type": "inlineReview"}, {"oid": "5c9851d06d6c63eda3aaaf5289f2f4583401c744", "url": "https://github.com/NationalSecurityAgency/datawave/commit/5c9851d06d6c63eda3aaaf5289f2f4583401c744", "message": "Merge branch 'master' into quickstart-tweaks", "committedDate": "2020-02-11T21:22:33Z", "type": "commit"}, {"oid": "57db7025f0058fa384a107ac9893b148ba6da0ec", "url": "https://github.com/NationalSecurityAgency/datawave/commit/57db7025f0058fa384a107ac9893b148ba6da0ec", "message": "Improvements to various quickstart scripts for execution on Mac OS X\n\n- Fixed `sed` calls to avoid creating backups in accumulo/install.sh", "committedDate": "2020-02-11T21:24:53Z", "type": "commit"}, {"oid": "0a1993ecac6a4eb7abfe8c362de2f986b9ff6a97", "url": "https://github.com/NationalSecurityAgency/datawave/commit/0a1993ecac6a4eb7abfe8c362de2f986b9ff6a97", "message": "Improvements to various quickstart scripts for execution on Mac OS X\n\n- Fixed `sed` call to avoid creating backups", "committedDate": "2020-02-11T21:26:34Z", "type": "commit"}]}