{"pr_number": 2825, "pr_title": "Update to latest LocalStack container and support unified port mode", "pr_createdAt": "2020-05-31T12:32:37Z", "pr_url": "https://github.com/testcontainers/testcontainers-java/pull/2825", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEzMTAyNQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2825#discussion_r436131025", "bodyText": "FYI we have a utility class (ComparableVersion) for parsing and comparing version strings. It's probably going to be more reliable than a regex - please could we use that?\nAlso, there's a slight risk that people may want to use their own custom Localstack image, which could have a completely different form of tag. While I think it's unlikely that this would cause a problem, please could we at least have some logging at time of container startup to give some clues about what's going to happen?", "author": "rnorth", "createdAt": "2020-06-05T19:50:24Z", "path": "modules/localstack/src/main/java/org/testcontainers/containers/localstack/LocalStackContainer.java", "diffHunk": "@@ -141,12 +150,16 @@ public URI getEndpointOverride(Service service) {\n             return new URI(\"http://\" +\n                 ipAddress +\n                 \":\" +\n-                getMappedPort(service.getPort()));\n+                getMappedPort(getServicePort(service)));\n         } catch (UnknownHostException | URISyntaxException e) {\n             throw new IllegalStateException(\"Cannot obtain endpoint URL\", e);\n         }\n     }\n \n+    private int getServicePort(Service service) {\n+        return version.matches(BEFORE_0_11) ? service.port : PORT;", "originalCommit": "92dd5abcfa391a3911f9385f9a65e9055bdb6774", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMwNDI0NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2825#discussion_r436304244", "bodyText": "Hi, @rnorth\nThanks for your comment.\n\nUse ComparableVersion - \u2705 (although I have to add isSemanticVersion method there.\nI've added a warning message if the tag is not \"latest\" or a semantic version and the code will fall back to the \"legacy\" mode.\nI've grouped the tests regarding legacy mode into a single class and added some extra test cases.\nI've added an explicit constructor with the \"legacy mode\" flag - just in case.", "author": "artamonovkirill", "createdAt": "2020-06-06T22:05:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEzMTAyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEzMTcwMg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2825#discussion_r436131702", "bodyText": "\ud83d\ude47\u200d\u2642\ufe0f thanks for adding this test class as well.", "author": "rnorth", "createdAt": "2020-06-05T19:51:17Z", "path": "modules/localstack/src/test/java/org/testcontainers/containers/localstack/LocalstackLegacyContainerTest.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.testcontainers.containers.localstack;\n+\n+import org.junit.ClassRule;\n+import org.junit.Test;\n+\n+import static org.rnorth.visibleassertions.VisibleAssertions.assertNotEquals;\n+import static org.rnorth.visibleassertions.VisibleAssertions.assertTrue;\n+import static org.testcontainers.containers.localstack.LocalStackContainer.Service.S3;\n+import static org.testcontainers.containers.localstack.LocalStackContainer.Service.SQS;\n+\n+public class LocalstackLegacyContainerTest {", "originalCommit": "92dd5abcfa391a3911f9385f9a65e9055bdb6774", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "858ec54247a5538dbf8cc09b3b81014303db35f9", "url": "https://github.com/testcontainers/testcontainers-java/commit/858ec54247a5538dbf8cc09b3b81014303db35f9", "message": ":arrow_up: latest default LocalStack container", "committedDate": "2020-06-06T22:09:16Z", "type": "commit"}, {"oid": "b310e3e6e02fdc4e50e4401dd44f75f82a396811", "url": "https://github.com/testcontainers/testcontainers-java/commit/b310e3e6e02fdc4e50e4401dd44f75f82a396811", "message": ":recycle: rely on ComparableVersion for version comparison. added LocalStackContainer(String version, boolean legacyMode) constructor. Extended test cases.", "committedDate": "2020-06-06T22:10:10Z", "type": "commit"}, {"oid": "df1d96e79b84a3bfc029fd92eb6f636099b7c362", "url": "https://github.com/testcontainers/testcontainers-java/commit/df1d96e79b84a3bfc029fd92eb6f636099b7c362", "message": ":white_check_mark: wait for pull and tag commands to finish", "committedDate": "2020-06-07T12:31:30Z", "type": "commit"}, {"oid": "68ee3bcc5e0a5b417139159487687c8bdadd1b9e", "url": "https://github.com/testcontainers/testcontainers-java/commit/68ee3bcc5e0a5b417139159487687c8bdadd1b9e", "message": "WIP", "committedDate": "2020-06-25T13:04:35Z", "type": "commit"}, {"oid": "46c7e1b8d6f16e68800681f1dc08694139bd4cf5", "url": "https://github.com/testcontainers/testcontainers-java/commit/46c7e1b8d6f16e68800681f1dc08694139bd4cf5", "message": "WIP", "committedDate": "2020-06-25T13:18:30Z", "type": "commit"}, {"oid": "054b637698318f587a4c41f34e81149d2ae71cca", "url": "https://github.com/testcontainers/testcontainers-java/commit/054b637698318f587a4c41f34e81149d2ae71cca", "message": "WIP", "committedDate": "2020-06-25T18:32:21Z", "type": "commit"}, {"oid": "196f1a9da93bd8ae36d36550d549c90fc5a6024e", "url": "https://github.com/testcontainers/testcontainers-java/commit/196f1a9da93bd8ae36d36550d549c90fc5a6024e", "message": "WIP", "committedDate": "2020-06-29T18:16:41Z", "type": "commit"}, {"oid": "f3fe8078ac4500d09dfa706d2a1c692358bbd6d1", "url": "https://github.com/testcontainers/testcontainers-java/commit/f3fe8078ac4500d09dfa706d2a1c692358bbd6d1", "message": "Tidy up test image references", "committedDate": "2020-07-02T14:04:43Z", "type": "commit"}, {"oid": "c523b388c9fa4e3e2d6c65e9126dbb4f9c10b7b9", "url": "https://github.com/testcontainers/testcontainers-java/commit/c523b388c9fa4e3e2d6c65e9126dbb4f9c10b7b9", "message": "Merge remote-tracking branch 'origin/master' into deprecate-ambiguous-constructors\n\n# Conflicts:\n#\tcore/src/test/java/org/testcontainers/images/RemoteDockerImageTest.java\n#\tmodules/kafka/src/main/java/org/testcontainers/containers/KafkaContainer.java\n#\tmodules/kafka/src/test/java/org/testcontainers/containers/KafkaContainerTest.java\n#\tmodules/pulsar/src/main/java/org/testcontainers/containers/PulsarContainer.java\n#\tmodules/selenium/src/test/java/org/testcontainers/junit/ChromeRecordingWebDriverContainerTest.java", "committedDate": "2020-07-02T14:31:17Z", "type": "commit"}, {"oid": "296f9f7a90a03b173fa24a1b2a57cd973d80b995", "url": "https://github.com/testcontainers/testcontainers-java/commit/296f9f7a90a03b173fa24a1b2a57cd973d80b995", "message": "Update docs re contrainer creation and specifying versions", "committedDate": "2020-07-02T14:31:37Z", "type": "commit"}, {"oid": "aa94289f1b3d69548a39c818329e7cb368d1754f", "url": "https://github.com/testcontainers/testcontainers-java/commit/aa94289f1b3d69548a39c818329e7cb368d1754f", "message": "Update Javadocs with deprecation warnings.", "committedDate": "2020-07-02T14:49:33Z", "type": "commit"}, {"oid": "77aa41801afb757e7abc8a019afb4d10c332956f", "url": "https://github.com/testcontainers/testcontainers-java/commit/77aa41801afb757e7abc8a019afb4d10c332956f", "message": "Add `asCanonicalNameString()` method on `DockerImageName`", "committedDate": "2020-07-03T08:33:41Z", "type": "commit"}, {"oid": "592f08aad393adb3616e4ce94c155ad0389b4b68", "url": "https://github.com/testcontainers/testcontainers-java/commit/592f08aad393adb3616e4ce94c155ad0389b4b68", "message": "Use static factory method instead of constructor", "committedDate": "2020-07-03T21:21:54Z", "type": "commit"}, {"oid": "1edc3077bf76e15df2724adea6ff8d64e7521e9e", "url": "https://github.com/testcontainers/testcontainers-java/commit/1edc3077bf76e15df2724adea6ff8d64e7521e9e", "message": "Use constant for docker registry image name", "committedDate": "2020-07-04T08:01:01Z", "type": "commit"}, {"oid": "113f3b37ad068e636fe2a55017aa2b1e311ea878", "url": "https://github.com/testcontainers/testcontainers-java/commit/113f3b37ad068e636fe2a55017aa2b1e311ea878", "message": "Simplify image usage in ReusabilityUnitTests", "committedDate": "2020-07-04T08:03:02Z", "type": "commit"}, {"oid": "fc7f62570b4ef32fe36238f30c21f02e1614917e", "url": "https://github.com/testcontainers/testcontainers-java/commit/fc7f62570b4ef32fe36238f30c21f02e1614917e", "message": "Use `DockerImageName` instead of `String` for image name", "committedDate": "2020-07-04T08:08:24Z", "type": "commit"}, {"oid": "cd7e13b9bc1f8a1ec9d03a06ad1c1e3c21074c78", "url": "https://github.com/testcontainers/testcontainers-java/commit/cd7e13b9bc1f8a1ec9d03a06ad1c1e3c21074c78", "message": "Inline Mongo image name parsing", "committedDate": "2020-07-04T08:09:03Z", "type": "commit"}, {"oid": "a35b3c4f34d83981282ea6dc2de5f53ee4824442", "url": "https://github.com/testcontainers/testcontainers-java/commit/a35b3c4f34d83981282ea6dc2de5f53ee4824442", "message": "Fix constructor delegation", "committedDate": "2020-07-04T08:11:17Z", "type": "commit"}, {"oid": "868f962393063893870d9055bc9dadc37f48b5b3", "url": "https://github.com/testcontainers/testcontainers-java/commit/868f962393063893870d9055bc9dadc37f48b5b3", "message": "Undo deprecation of SocatContainer no-args constructor", "committedDate": "2020-07-04T08:15:09Z", "type": "commit"}, {"oid": "faf1217e3476256c3b3c4fbd3968633263be1b9f", "url": "https://github.com/testcontainers/testcontainers-java/commit/faf1217e3476256c3b3c4fbd3968633263be1b9f", "message": "Update references to DockerImageName.parse in example code", "committedDate": "2020-07-04T10:36:51Z", "type": "commit"}, {"oid": "ee450035b3a4bc2aff4ec30cec6dbdf2c07c53d9", "url": "https://github.com/testcontainers/testcontainers-java/commit/ee450035b3a4bc2aff4ec30cec6dbdf2c07c53d9", "message": "Merge remote-tracking branch 'origin/master' into deprecate-ambiguous-constructors", "committedDate": "2020-07-04T10:37:27Z", "type": "commit"}, {"oid": "8960ceb8800b95de3834a77d600547eb61b310b3", "url": "https://github.com/testcontainers/testcontainers-java/commit/8960ceb8800b95de3834a77d600547eb61b310b3", "message": "Merge remote-tracking branch 'origin/master' into deprecate-ambiguous-constructors", "committedDate": "2020-07-06T07:36:47Z", "type": "commit"}, {"oid": "f4e314dbb50bdf9eab09d049166a17f0e2ce1fb0", "url": "https://github.com/testcontainers/testcontainers-java/commit/f4e314dbb50bdf9eab09d049166a17f0e2ce1fb0", "message": "Merge remote-tracking branch 'origin/master' into deprecate-ambiguous-constructors", "committedDate": "2020-07-16T10:53:03Z", "type": "commit"}, {"oid": "f0371ec3a48cfe06d053834795d65d8c80e5a8e1", "url": "https://github.com/testcontainers/testcontainers-java/commit/f0371ec3a48cfe06d053834795d65d8c80e5a8e1", "message": "Merge branch 'deprecate-ambiguous-constructors' into chore/latest-localstack", "committedDate": "2020-07-17T14:29:12Z", "type": "commit"}, {"oid": "3cf1a17d736cf1e709e748486ee0a53d7001c47a", "url": "https://github.com/testcontainers/testcontainers-java/commit/3cf1a17d736cf1e709e748486ee0a53d7001c47a", "message": "Integrate changes\nTweak some stylistic aspects of the code", "committedDate": "2020-07-17T15:22:33Z", "type": "commit"}, {"oid": "b38d73c346bf06a0838d0ecb54d673abadc455b4", "url": "https://github.com/testcontainers/testcontainers-java/commit/b38d73c346bf06a0838d0ecb54d673abadc455b4", "message": "Merge master into chore/latest-localstack", "committedDate": "2020-07-19T16:08:35Z", "type": "commit"}, {"oid": "d3b4d43e084934f224c53b38cbae8c1fc50ef689", "url": "https://github.com/testcontainers/testcontainers-java/commit/d3b4d43e084934f224c53b38cbae8c1fc50ef689", "message": "Clarify meaning of `legacyMode` in a Javadoc comment", "committedDate": "2020-07-19T16:20:48Z", "type": "commit"}, {"oid": "71838fb6ab5d01eff63b6b5a5df3d2dec71a355d", "url": "https://github.com/testcontainers/testcontainers-java/commit/71838fb6ab5d01eff63b6b5a5df3d2dec71a355d", "message": "Inline image name references used in docs", "committedDate": "2020-07-19T16:57:46Z", "type": "commit"}]}