{"pr_number": 2677, "pr_title": "Dynamic CI jobs for examples", "pr_createdAt": "2020-05-07T09:18:53Z", "pr_url": "https://github.com/testcontainers/testcontainers-java/pull/2677", "timeline": [{"oid": "7803b30d33dcae1ef2d17ec2aa35774d61e80c31", "url": "https://github.com/testcontainers/testcontainers-java/commit/7803b30d33dcae1ef2d17ec2aa35774d61e80c31", "message": "WIP: Dynamic CI jobs for examples", "committedDate": "2020-05-07T09:17:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4Mzg2MA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2677#discussion_r421383860", "bodyText": "we're not running \"Docker-in-Docker\", but mount the socket, hence \"in-container\" :) Maybe we can use \"wormhole\" or similar...", "author": "bsideup", "createdAt": "2020-05-07T09:55:20Z", "path": ".github/workflows/ci-dind.yml", "diffHunk": "@@ -1,4 +1,4 @@\n-name: in-container\n+name: CI-DinD", "originalCommit": "7803b30d33dcae1ef2d17ec2aa35774d61e80c31", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4NDQ0NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2677#discussion_r421384444", "bodyText": "Good point", "author": "rnorth", "createdAt": "2020-05-07T09:56:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4Mzg2MA=="}], "type": "inlineReview"}, {"oid": "85f97ef9e6cfb885165927e385c67e16342593fb", "url": "https://github.com/testcontainers/testcontainers-java/commit/85f97ef9e6cfb885165927e385c67e16342593fb", "message": "Undo de-duplication of cache configuration\n(as it does not work!)", "committedDate": "2020-05-07T09:55:41Z", "type": "commit"}, {"oid": "92a9ff699d8cf14d134d835f6e0637934157aeb8", "url": "https://github.com/testcontainers/testcontainers-java/commit/92a9ff699d8cf14d134d835f6e0637934157aeb8", "message": "Rename job", "committedDate": "2020-05-07T09:56:59Z", "type": "commit"}, {"oid": "b7985c8b02a3cf6e3a2d20164289e55ec61f7245", "url": "https://github.com/testcontainers/testcontainers-java/commit/b7985c8b02a3cf6e3a2d20164289e55ec61f7245", "message": "Merge remote-tracking branch 'origin/master' into examples-dynamic-ci-jobs", "committedDate": "2020-05-07T09:57:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4NTMyNg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2677#discussion_r421385326", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      CIMATE_CI_KEY: \"CI / ${{ runner.os }} / ${{matrix.gradle_args}}\"\n          \n          \n            \n                      CIMATE_CI_KEY: \"Examples / ${{ runner.os }} / ${{matrix.gradle_args}}\"", "author": "bsideup", "createdAt": "2020-05-07T09:57:48Z", "path": ".github/workflows/ci-examples.yml", "diffHunk": "@@ -0,0 +1,73 @@\n+name: CI-Examples\n+\n+on:\n+  pull_request: {}\n+  push: { branches: [ master ] }\n+\n+env:\n+  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}\n+  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n+\n+jobs:\n+  find_gradle_jobs:\n+    runs-on: ubuntu-18.04\n+    outputs:\n+      matrix: ${{ steps.set-matrix.outputs.matrix }}\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: '1.8'\n+      - name: Cache Gradle Home files\n+        uses: actions/cache@v1\n+        with:\n+          path: ~/.gradle/caches\n+          key: ${{ runner.os }}-gradle-home-testmatrix-examples-${{ hashFiles('**/*.gradle') }}\n+          restore-keys: |\n+            ${{ runner.os }}-gradle-home-testmatrix-examples-\n+            ${{ runner.os }}-gradle-home-\n+      - id: set-matrix\n+        working-directory: ./examples/\n+        env:\n+          # Since we override the tests executor,\n+          # we should not push empty results to the cache\n+          READ_ONLY_REMOTE_GRADLE_CACHE: true\n+        run: |\n+          TASKS=$(./gradlew --no-daemon --parallel -q testMatrix)\n+          echo $TASKS\n+          echo \"::set-output name=matrix::{\\\"gradle_args\\\":$TASKS}\"\n+  check:\n+    needs: find_gradle_jobs\n+    strategy:\n+      fail-fast: false\n+      matrix: ${{ fromJson(needs.find_gradle_jobs.outputs.matrix) }}\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: '1.8'\n+      - name: Cache Gradle Home files\n+        uses: actions/cache@v1\n+        with:\n+          path: ~/.gradle/caches\n+          key: ${{ runner.os }}-gradle-home-examples-${{matrix.gradle_args}}_check-${{ hashFiles('**/*.gradle') }}\n+          restore-keys: |\n+            ${{ runner.os }}-gradle-home-examples-${{matrix.gradle_args}}_check-\n+            ${{ runner.os }}-gradle-home-examples-${{matrix.gradle_args}}_check-\n+            ${{ runner.os }}-gradle-home-examples-\n+      - name: Clear existing docker image cache\n+        run: docker image prune -af\n+      - name: Build and test Examples with Gradle (${{matrix.gradle_args}})\n+        working-directory: ./examples/\n+        run: |\n+          ./gradlew --no-daemon --continue --scan --info ${{matrix.gradle_args}}\n+      - name: Aggregate Examples test reports with ciMate\n+        if: always()\n+        env:\n+          CIMATE_PROJECT_ID: 2348n4vl\n+          CIMATE_CI_KEY: \"CI / ${{ runner.os }} / ${{matrix.gradle_args}}\"", "originalCommit": "b7985c8b02a3cf6e3a2d20164289e55ec61f7245", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4cef6099bbd9f4e124c621fe0e9ca5d00216ef08", "url": "https://github.com/testcontainers/testcontainers-java/commit/4cef6099bbd9f4e124c621fe0e9ca5d00216ef08", "message": "Update .github/workflows/ci-examples.yml\n\nCo-authored-by: Sergei Egorov <bsideup@gmail.com>", "committedDate": "2020-05-07T10:39:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY4ODI2OA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2677#discussion_r424688268", "bodyText": "Just to be sure - you just moved these lines without changing them, right? Or was it done by accident and we should probably revert it? :)", "author": "bsideup", "createdAt": "2020-05-13T19:44:35Z", "path": "settings.gradle", "diffHunk": "@@ -13,6 +13,25 @@ buildscript {\n apply plugin: 'ch.myniva.s3-build-cache'\n apply plugin: 'com.gradle.enterprise'\n \n+rootProject.name = 'testcontainers-java'", "originalCommit": "4cef6099bbd9f4e124c621fe0e9ca5d00216ef08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE5NTAxNw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2677#discussion_r425195017", "bodyText": "Moved deliberately; I'm not sure why but it feels right to have these elements near the top of the file, and leave the cache/buildscan related parts at the bottom.", "author": "rnorth", "createdAt": "2020-05-14T14:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY4ODI2OA=="}], "type": "inlineReview"}, {"oid": "b6c59ffce7157ee52460f179b51d4515e3c04abe", "url": "https://github.com/testcontainers/testcontainers-java/commit/b6c59ffce7157ee52460f179b51d4515e3c04abe", "message": "Merge branch 'master' into examples-dynamic-ci-jobs", "committedDate": "2020-05-14T14:43:50Z", "type": "commit"}]}