{"pr_number": 2597, "pr_title": "Push Gradle Cache from GHA", "pr_createdAt": "2020-04-20T11:16:35Z", "pr_url": "https://github.com/testcontainers/testcontainers-java/pull/2597", "timeline": [{"oid": "ee50e6fcfc4643be6a8d6cb89566dc48651d9dbd", "url": "https://github.com/testcontainers/testcontainers-java/commit/ee50e6fcfc4643be6a8d6cb89566dc48651d9dbd", "message": "Push Gradle Cache from GHA", "committedDate": "2020-04-20T11:16:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMDk0NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2597#discussion_r411320944", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    push = !(System.getenv(\"READ_ONLY_REMOTE_GRADLE_CACHE\") || !isMasterBuild)\n          \n          \n            \n                    push = !(System.getenv(\"READ_ONLY_GRADLE_CACHE\") || !isMasterBuild)\n          \n      \n    \n    \n  \n\n?", "author": "kiview", "createdAt": "2020-04-20T12:01:49Z", "path": "settings.gradle", "diffHunk": "@@ -31,7 +27,7 @@ buildCache {\n         region = 'fra1'\n         bucket = 'testcontainers'\n         path = 'cache'\n-        push = isMasterBuild\n+        push = !(System.getenv(\"READ_ONLY_REMOTE_GRADLE_CACHE\") || !isMasterBuild)", "originalCommit": "ee50e6fcfc4643be6a8d6cb89566dc48651d9dbd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMjIzNQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2597#discussion_r411322235", "bodyText": "Also, can we invert boolean logic? \ud83d\ude05\npush = !System.getenv(\"READ_ONLY_GRADLE_CACHE\") && isMasterBuild", "author": "kiview", "createdAt": "2020-04-20T12:04:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMDk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMzIwNg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2597#discussion_r411323206", "bodyText": "Also, are we pushing Windows builds like this and do we want to push Windows builds?", "author": "kiview", "createdAt": "2020-04-20T12:05:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMDk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMzNTE2Nw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2597#discussion_r411335167", "bodyText": "It is READ_ONLY_REMOTE_GRADLE_CACHE because local Gradle cache can still be enabled\nRe inverting the logic - I find \"push if NOT(READ_ONLY OR NOT(MASTER_BUILD))\" easier to understand since you can focus on what's inside NOT :) @rnorth WDYT?\nRe Windows builds - yes, why not?\nP.S. consider starting new comments (you can do multiple on the same line) to avoid \"RE\"s ;)", "author": "bsideup", "createdAt": "2020-04-20T12:26:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMDk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM5OTQxMw==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2597#discussion_r411399413", "bodyText": "TBH I thought READ_ONLY_REMOTE_GRADLE_CACHE is our own environment variable, and you were setting READ_ONLY_GRADLE_CACHE in CI, therefore I thought this is just a typo.", "author": "kiview", "createdAt": "2020-04-20T13:57:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMDk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MzU2Ng==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2597#discussion_r411463566", "bodyText": "it is our own variable. Did I set it to READ_ONLY_GRADLE_CACHE? :D good catch then, I should change! \ud83d\udc4d", "author": "bsideup", "createdAt": "2020-04-20T15:17:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMDk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5MjgyNg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2597#discussion_r411492826", "bodyText": "Resolve with regards to ENV name \ud83d\ude42\nAbout the boolean expression, I don't want to block just different taste, so proceed as you deem fit \ud83e\udd37\u200d\u2642\ufe0f", "author": "kiview", "createdAt": "2020-04-20T15:54:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMDk0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMTM0MA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2597#discussion_r411321340", "bodyText": "Do we have to add the false there? Wouldn't Groovy truth validate correctly otherwise as well?", "author": "kiview", "createdAt": "2020-04-20T12:02:33Z", "path": "settings.gradle", "diffHunk": "@@ -5,21 +5,17 @@ buildscript {\n         }\n     }\n     dependencies {\n-        classpath \"gradle.plugin.ch.myniva.gradle:s3-build-cache:0.9.0\"\n+        classpath \"gradle.plugin.ch.myniva.gradle:s3-build-cache:0.10.0\"\n         classpath \"com.gradle.enterprise:com.gradle.enterprise.gradle.plugin:3.2.1\"\n     }\n-\n-    configurations.classpath {\n-        resolutionStrategy {\n-            force 'com.amazonaws:aws-java-sdk-s3:1.11.582'\n-        }\n-    }\n }\n \n apply plugin: 'ch.myniva.s3-build-cache'\n apply plugin: 'com.gradle.enterprise'\n \n-ext.isMasterBuild = (System.getenv(\"CIRCLE_BRANCH\") ?: System.getenv(\"BUILD_SOURCEBRANCHNAME\")) == \"master\"\n+ext.isMasterBuild = false ||", "originalCommit": "ee50e6fcfc4643be6a8d6cb89566dc48651d9dbd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMzMzYzMg==", "url": "https://github.com/testcontainers/testcontainers-java/pull/2597#discussion_r411333632", "bodyText": "this is to align the next lines :)", "author": "bsideup", "createdAt": "2020-04-20T12:23:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMyMTM0MA=="}], "type": "inlineReview"}, {"oid": "c0fa6d5a04f4f8579a7b3230e568d0d835126133", "url": "https://github.com/testcontainers/testcontainers-java/commit/c0fa6d5a04f4f8579a7b3230e568d0d835126133", "message": "Update ci.yml", "committedDate": "2020-04-20T15:17:52Z", "type": "commit"}]}