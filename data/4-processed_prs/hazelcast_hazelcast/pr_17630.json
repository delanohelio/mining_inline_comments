{"pr_number": 17630, "pr_title": "Fix shade warnings", "pr_createdAt": "2020-09-28T09:36:49Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17630", "timeline": [{"oid": "4e3926c5278cf407193aaf21e0791c65b1cdeb27", "url": "https://github.com/hazelcast/hazelcast/commit/4e3926c5278cf407193aaf21e0791c65b1cdeb27", "message": "shade transformers and filters to overcome warnings", "committedDate": "2020-09-28T08:01:57Z", "type": "commit"}, {"oid": "2dc07a1b602f01cdfd4ff8ea8d0bcba655f3b378", "url": "https://github.com/hazelcast/hazelcast/commit/2dc07a1b602f01cdfd4ff8ea8d0bcba655f3b378", "message": "shade transformers and filters to overcome warnings", "committedDate": "2020-09-28T09:35:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgxMjA1MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17630#discussion_r495812050", "bodyText": "@devozerov can we apply this for all artifacts? When I apply it to all artifacts I cannot see MANIFEST.MF though.", "author": "lazerion", "createdAt": "2020-09-28T09:37:59Z", "path": "hazelcast-sql/pom.xml", "diffHunk": "@@ -121,13 +126,16 @@\n                                     <excludes>\n                                         <!-- Avoid automatic discovery of Calcite JDBC. -->\n                                         <exclude>META-INF/services/java.sql.Driver</exclude>\n+                                        <exclude>META-INF/MANIFEST.MF</exclude>", "originalCommit": "2dc07a1b602f01cdfd4ff8ea8d0bcba655f3b378", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI5MDU0Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17630#discussion_r497290542", "bodyText": "Currently, there are still warnings about it MANIFEST.MF overlap when building the sql module. Another thing is that packages from the sql module are not included in the resulting MANIFEST.MF. I am not sure how it should work in the end, but I would try to do the following for both fat-shaded-jar and fat-jar goals:\n\nExclude MANIFEST.MF from all packages (<artifact>*:*</artifact>)\nInclude MANIFEST.MF for the hazelcast-sql artifact\nMake sure that sql manifest is merged into the final manifest using ManifestResourceTransformer [1]. I do not know where exactly this transformer should be defined, unfortunately\n\nThis way we will not have warnings and at the same time the final MANIFEST.ML will include packages from the sql module.\nBut I would also ask someone with more experience with Maven on how it should work in the end.\n[1] https://maven.apache.org/plugins/maven-shade-plugin/examples/resource-transformers.html#ManifestResourceTransformer", "author": "devozerov", "createdAt": "2020-09-30T07:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgxMjA1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIyMDI3NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17630#discussion_r498220274", "bodyText": "@devozerov updated with targeted filters, I could not make it possible with ManifestResourceTransformer FYI. PTAL.", "author": "lazerion", "createdAt": "2020-10-01T12:53:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgxMjA1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzNTA5NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17630#discussion_r497535094", "bodyText": "@jerrinot @Holmistr We do not include hazelcast-community-license.txt in hazelcast-all.jar at all. It is regarding below warning\n[WARNING] hazelcast-aws-3.3.jar, hazelcast-wm-4.0.jar define 1 overlapping resource: \n[WARNING]   - hazelcast-community-license.txt\n\nI think we do not need to include it inside the jar. kindly advise.", "author": "lazerion", "createdAt": "2020-09-30T14:02:27Z", "path": "hazelcast-all/pom.xml", "diffHunk": "@@ -111,11 +111,19 @@\n                                 </transformer>\n                                 <transformer\n                                         implementation=\"org.apache.maven.plugins.shade.resource.ServicesResourceTransformer\"/>\n+                                <transformer\n+                                        implementation=\"org.apache.maven.plugins.shade.resource.ApacheNoticeResourceTransformer\"/>\n+                                <transformer\n+                                        implementation=\"org.apache.maven.plugins.shade.resource.DontIncludeResourceTransformer\">\n+                                    <resource>com.hazelcast.org.codehaus.commons.compiler.properties</resource>\n+                                    <resource>hazelcast-community-license.txt</resource>", "originalCommit": "2dc07a1b602f01cdfd4ff8ea8d0bcba655f3b378", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "46547210c03d07a00c02ec2c2aed6f37a35c33ad", "url": "https://github.com/hazelcast/hazelcast/commit/46547210c03d07a00c02ec2c2aed6f37a35c33ad", "message": "shade transformers and filters to overcome warnings", "committedDate": "2020-10-01T12:52:34Z", "type": "commit"}, {"oid": "4433ec958ad539fa6b66493c9868b918470aecab", "url": "https://github.com/hazelcast/hazelcast/commit/4433ec958ad539fa6b66493c9868b918470aecab", "message": "hazelcast-community-license added from single artifact", "committedDate": "2020-10-06T12:41:26Z", "type": "commit"}, {"oid": "5354bf8058c7bc05a8e9fa91bad34146501f50b4", "url": "https://github.com/hazelcast/hazelcast/commit/5354bf8058c7bc05a8e9fa91bad34146501f50b4", "message": "hazelcast-community-license added from single artifact", "committedDate": "2020-10-06T12:50:38Z", "type": "commit"}]}