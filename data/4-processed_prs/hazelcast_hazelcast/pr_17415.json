{"pr_number": 17415, "pr_title": "custom load balancer declarative configuration", "pr_createdAt": "2020-08-26T13:26:30Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17415", "timeline": [{"oid": "60e970cfcf3ee8491bd44f83f1e9edfab44c4ce2", "url": "https://github.com/hazelcast/hazelcast/commit/60e970cfcf3ee8491bd44f83f1e9edfab44c4ce2", "message": "custom load balancer declarative configuration", "committedDate": "2020-08-27T07:23:50Z", "type": "commit"}, {"oid": "60e970cfcf3ee8491bd44f83f1e9edfab44c4ce2", "url": "https://github.com/hazelcast/hazelcast/commit/60e970cfcf3ee8491bd44f83f1e9edfab44c4ce2", "message": "custom load balancer declarative configuration", "committedDate": "2020-08-27T07:23:50Z", "type": "forcePushed"}, {"oid": "281c7ad25e5316958cad86a66502632e80b5bd00", "url": "https://github.com/hazelcast/hazelcast/commit/281c7ad25e5316958cad86a66502632e80b5bd00", "message": "checkstyle problems fixed", "committedDate": "2020-08-27T11:55:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyMDQ2Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480120466", "bodyText": "Minor: Is the hz:hazelcast id=\"instance\" element necessary for the test? It seems like a leftover", "author": "mdumandag", "createdAt": "2020-08-31T13:13:10Z", "path": "hazelcast-spring-tests/src/test/resources/com/hazelcast/spring/customLoadBalancer-applicationContext.xml", "diffHunk": "@@ -0,0 +1,94 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~ http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n+\n+<beans xmlns=\"http://www.springframework.org/schema/beans\"\n+       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+       xmlns:p=\"http://www.springframework.org/schema/p\"\n+       xmlns:hz=\"http://www.hazelcast.com/schema/spring\"\n+       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n+        http://www.springframework.org/schema/beans/spring-beans.xsd\n+        http://www.hazelcast.com/schema/spring\n+        http://www.hazelcast.com/schema/spring/hazelcast-spring-4.1.xsd\">\n+\n+    <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"\n+          p:systemPropertiesModeName=\"SYSTEM_PROPERTIES_MODE_OVERRIDE\">\n+        <property name=\"locations\">\n+            <list>\n+                <value>classpath:/hazelcast-default.properties</value>\n+            </list>\n+        </property>\n+    </bean>\n+\n+    <hz:hazelcast id=\"instance\">", "originalCommit": "281c7ad25e5316958cad86a66502632e80b5bd00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE4ODkxOA==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480188918", "bodyText": "I think it is. Removing it causes the following exception being thrown:\nCaused by: org.springframework.beans.factory.parsing.BeanDefinitionParsingException: Configuration problem: Configuration problem: Id is required for element 'hazelcast' when used as a top-level tag", "author": "the-thing", "createdAt": "2020-08-31T14:59:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyMDQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIzMjA5NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480232094", "bodyText": "Oh, okay. I think that's the instance clients are connecting to. Then, it is reasonable to disregard my other comments on this file", "author": "mdumandag", "createdAt": "2020-08-31T16:06:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyMDQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyMTY1NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480121655", "bodyText": "Minor: Are the other configuration elements other than <hz:load-balancer type=\"custom\" class-name=\"com.hazelcast.client.test.CustomLoadBalancer\"/> necessary?", "author": "mdumandag", "createdAt": "2020-08-31T13:15:11Z", "path": "hazelcast-spring-tests/src/test/resources/com/hazelcast/spring/customLoadBalancer-applicationContext.xml", "diffHunk": "@@ -0,0 +1,94 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~ http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n+\n+<beans xmlns=\"http://www.springframework.org/schema/beans\"\n+       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+       xmlns:p=\"http://www.springframework.org/schema/p\"\n+       xmlns:hz=\"http://www.hazelcast.com/schema/spring\"\n+       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n+        http://www.springframework.org/schema/beans/spring-beans.xsd\n+        http://www.hazelcast.com/schema/spring\n+        http://www.hazelcast.com/schema/spring/hazelcast-spring-4.1.xsd\">\n+\n+    <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"\n+          p:systemPropertiesModeName=\"SYSTEM_PROPERTIES_MODE_OVERRIDE\">\n+        <property name=\"locations\">\n+            <list>\n+                <value>classpath:/hazelcast-default.properties</value>\n+            </list>\n+        </property>\n+    </bean>\n+\n+    <hz:hazelcast id=\"instance\">\n+        <hz:config>\n+            <hz:cluster-name>${cluster.name}</hz:cluster-name>\n+            <hz:properties>\n+                <hz:property name=\"hazelcast.merge.first.run.delay.seconds\">5</hz:property>\n+                <hz:property name=\"hazelcast.merge.next.run.delay.seconds\">5</hz:property>\n+            </hz:properties>\n+            <hz:network port=\"${cluster.port}\" port-auto-increment=\"false\">\n+                <hz:join>\n+                    <hz:multicast enabled=\"false\"\n+                                  multicast-group=\"224.2.2.3\"\n+                                  multicast-port=\"54327\"/>\n+                    <hz:tcp-ip enabled=\"true\">\n+                        <hz:members>${cluster.members}</hz:members>\n+                    </hz:tcp-ip>\n+                </hz:join>\n+                <hz:interfaces enabled=\"false\">\n+                    <hz:interface>10.10.1.*</hz:interface>\n+                </hz:interfaces>\n+            </hz:network>\n+        </hz:config>\n+    </hz:hazelcast>\n+\n+    <hz:client id=\"client1\">\n+        <hz:cluster-name>${cluster.name}</hz:cluster-name>", "originalCommit": "281c7ad25e5316958cad86a66502632e80b5bd00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIyNzUzNA==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r481227534", "bodyText": "I removed most of the xml configuration so the test still works.", "author": "the-thing", "createdAt": "2020-09-01T15:23:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyMTY1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyMjE5OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480122198", "bodyText": "Minor: Are the other configuration elements other than <hz:load-balancer type=\"custom\" implementation=\"customLoadBalancer\"/> necessary?", "author": "mdumandag", "createdAt": "2020-08-31T13:15:59Z", "path": "hazelcast-spring-tests/src/test/resources/com/hazelcast/spring/customLoadBalancer-applicationContext.xml", "diffHunk": "@@ -0,0 +1,94 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~ http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n+\n+<beans xmlns=\"http://www.springframework.org/schema/beans\"\n+       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+       xmlns:p=\"http://www.springframework.org/schema/p\"\n+       xmlns:hz=\"http://www.hazelcast.com/schema/spring\"\n+       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n+        http://www.springframework.org/schema/beans/spring-beans.xsd\n+        http://www.hazelcast.com/schema/spring\n+        http://www.hazelcast.com/schema/spring/hazelcast-spring-4.1.xsd\">\n+\n+    <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"\n+          p:systemPropertiesModeName=\"SYSTEM_PROPERTIES_MODE_OVERRIDE\">\n+        <property name=\"locations\">\n+            <list>\n+                <value>classpath:/hazelcast-default.properties</value>\n+            </list>\n+        </property>\n+    </bean>\n+\n+    <hz:hazelcast id=\"instance\">\n+        <hz:config>\n+            <hz:cluster-name>${cluster.name}</hz:cluster-name>\n+            <hz:properties>\n+                <hz:property name=\"hazelcast.merge.first.run.delay.seconds\">5</hz:property>\n+                <hz:property name=\"hazelcast.merge.next.run.delay.seconds\">5</hz:property>\n+            </hz:properties>\n+            <hz:network port=\"${cluster.port}\" port-auto-increment=\"false\">\n+                <hz:join>\n+                    <hz:multicast enabled=\"false\"\n+                                  multicast-group=\"224.2.2.3\"\n+                                  multicast-port=\"54327\"/>\n+                    <hz:tcp-ip enabled=\"true\">\n+                        <hz:members>${cluster.members}</hz:members>\n+                    </hz:tcp-ip>\n+                </hz:join>\n+                <hz:interfaces enabled=\"false\">\n+                    <hz:interface>10.10.1.*</hz:interface>\n+                </hz:interfaces>\n+            </hz:network>\n+        </hz:config>\n+    </hz:hazelcast>\n+\n+    <hz:client id=\"client1\">\n+        <hz:cluster-name>${cluster.name}</hz:cluster-name>\n+        <hz:network connection-timeout=\"1000\"\n+                    redo-operation=\"false\"\n+                    smart-routing=\"false\">\n+            <hz:member>127.0.0.1:5700</hz:member>\n+            <hz:member>127.0.0.1:5701</hz:member>\n+            <hz:socket-options buffer-size=\"32\"\n+                               keep-alive=\"false\"\n+                               linger-seconds=\"3\"\n+                               reuse-address=\"false\"\n+                               tcp-no-delay=\"false\"/>\n+        </hz:network>\n+        <hz:load-balancer type=\"custom\" class-name=\"com.hazelcast.client.test.CustomLoadBalancer\"/>\n+    </hz:client>\n+\n+    <hz:client id=\"client2\">\n+        <hz:cluster-name>${cluster.name}</hz:cluster-name>", "originalCommit": "281c7ad25e5316958cad86a66502632e80b5bd00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIyNzc2MQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r481227761", "bodyText": "I shortened the configuration for this scenario.", "author": "the-thing", "createdAt": "2020-09-01T15:23:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyMjE5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyOTgwOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480129809", "bodyText": "I am not sure about that but are we allowed to edit .xsd files of already released versions?", "author": "mdumandag", "createdAt": "2020-08-31T13:26:41Z", "path": "hazelcast-spring/src/main/resources/hazelcast-spring-4.0.xsd", "diffHunk": "@@ -3092,9 +3092,11 @@\n                 <xs:restriction base=\"non-space-string\">\n                     <xs:enumeration value=\"random\"/>\n                     <xs:enumeration value=\"round-robin\"/>\n+                    <xs:enumeration value=\"custom\"/>", "originalCommit": "281c7ad25e5316958cad86a66502632e80b5bd00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE1MzA4Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480153086", "bodyText": "@the-thing We should only change 4.1 xsd's.", "author": "sancar", "createdAt": "2020-08-31T14:04:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyOTgwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIyNzIwMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r481227200", "bodyText": "Rolled back 4.0 changes as suggested.", "author": "the-thing", "createdAt": "2020-09-01T15:22:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEyOTgwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEzMjA4MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480132080", "bodyText": "Same question as above about changing the released version's .xsd file", "author": "mdumandag", "createdAt": "2020-08-31T13:30:31Z", "path": "hazelcast/src/main/resources/hazelcast-client-config-4.0.xsd", "diffHunk": "@@ -249,14 +249,19 @@\n     </xs:complexType>\n \n     <xs:complexType name=\"load-balancer\">\n-        <xs:attribute name=\"type\" use=\"required\">\n-            <xs:simpleType>\n-                <xs:restriction base=\"non-space-string\">\n-                    <xs:enumeration value=\"random\"/>\n-                    <xs:enumeration value=\"round-robin\"/>\n-                </xs:restriction>\n-            </xs:simpleType>\n-        </xs:attribute>\n+        <xs:simpleContent>", "originalCommit": "281c7ad25e5316958cad86a66502632e80b5bd00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIyNzAzNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r481227036", "bodyText": "Rolled back the change as suggested.", "author": "the-thing", "createdAt": "2020-09-01T15:22:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEzMjA4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEzNDEzMQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480134131", "bodyText": "Can we also add a test that verifies that the exception will be thrown when both the implementation and the class-name  are provided in the spring config?", "author": "mdumandag", "createdAt": "2020-08-31T13:34:00Z", "path": "hazelcast-spring-tests/src/test/java/com/hazelcast/spring/TestCustomLoadBalancerContext.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.spring;\n+\n+import com.hazelcast.client.HazelcastClient;\n+import com.hazelcast.client.LoadBalancer;\n+import com.hazelcast.client.config.ClientConfig;\n+import com.hazelcast.client.impl.clientside.HazelcastClientProxy;\n+import com.hazelcast.client.test.CustomLoadBalancer;\n+import com.hazelcast.core.Hazelcast;\n+import com.hazelcast.test.annotation.QuickTest;\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+import org.springframework.test.context.ContextConfiguration;\n+\n+import javax.annotation.Resource;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(CustomSpringJUnit4ClassRunner.class)\n+@ContextConfiguration(locations = {\"customLoadBalancer-applicationContext.xml\"})\n+@Category(QuickTest.class)\n+public class TestCustomLoadBalancerContext {\n+\n+    @Resource(name = \"client1\")\n+    private HazelcastClientProxy client1;\n+\n+    @Resource(name = \"client2\")\n+    private HazelcastClientProxy client2;\n+\n+    @BeforeClass\n+    @AfterClass\n+    public static void start() {\n+        HazelcastClient.shutdownAll();\n+        Hazelcast.shutdownAll();\n+    }\n+\n+    @Test\n+    public void testCustomLoadBalancer() {\n+        ClientConfig config1 = client1.getClientConfig();\n+        LoadBalancer loadBalancer1 = config1.getLoadBalancer();\n+        assertTrue(loadBalancer1 instanceof CustomLoadBalancer);\n+        assertEquals(\"default-name\", ((CustomLoadBalancer) loadBalancer1).getName());\n+\n+        ClientConfig config2 = client2.getClientConfig();\n+        LoadBalancer loadBalancer2 = config2.getLoadBalancer();\n+        assertTrue(loadBalancer2 instanceof CustomLoadBalancer);\n+        assertEquals(\"custom-balancer-name\", ((CustomLoadBalancer) loadBalancer2).getName());\n+    }\n+}", "originalCommit": "281c7ad25e5316958cad86a66502632e80b5bd00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIyOTIxOA==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r481229218", "bodyText": "good catch. I actually had to change the logic as it was not working properly before.\nthere are is no common spot for testing failed application context xml files, so I created a new invalid file and test for load balancer in com.hazelcast.spring.InvalidApplicationContextTest", "author": "the-thing", "createdAt": "2020-09-01T15:25:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEzNDEzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEzOTYzNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480139635", "bodyText": "Will this (passing null as the class loader) cause problems when a different class loader is provided for the client config? I see that for other elements, we store the class name and later, use the class loader defined in the config (if any) while instantiating the objects.", "author": "mdumandag", "createdAt": "2020-08-31T13:42:58Z", "path": "hazelcast/src/main/java/com/hazelcast/client/config/impl/ClientDomConfigProcessor.java", "diffHunk": "@@ -391,9 +393,24 @@ private void handleLoadBalancer(Node node) {\n             clientConfig.setLoadBalancer(new RandomLB());\n         } else if (\"round-robin\".equals(type)) {\n             clientConfig.setLoadBalancer(new RoundRobinLB());\n+        } else if (\"custom\".equals(type)) {\n+            String loadBalancerClassName = parseCustomLoadBalancerClassName(node);\n+\n+            try {\n+                LoadBalancer loadBalancer = newInstance(null, loadBalancerClassName);", "originalCommit": "281c7ad25e5316958cad86a66502632e80b5bd00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE1MjMwMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r480152300", "bodyText": "I did not consider the class-loader problem when we are discussing here #17228 (comment)\n@the-thing Lets move the instantiation to com.hazelcast.client.impl.clientside.HazelcastClientInstanceImpl#initLoadBalancer\nTo achieve this, we can add a new field to the ClientConfig as loadBalancerClassName. ConfigProcessor sets this class name of the load balancer type is custom.\nThis way, we will not break the old behavior.", "author": "sancar", "createdAt": "2020-08-31T14:03:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEzOTYzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIzMDYzOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r481230639", "bodyText": "I followed the suggestion and moved the instantiation of load balancer to com.hazelcast.client.impl.clientside.HazelcastClientInstanceImpl#initLoadBalancer. I had to rewrite the test cases and created a few new ones in com.hazelcast.client.config.ClientConfigLoadBalancerTest. Extra work had to be done so I would advise to review the whole PR again.", "author": "the-thing", "createdAt": "2020-09-01T15:27:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEzOTYzNQ=="}], "type": "inlineReview"}, {"oid": "06589f2a1bc9b358d98a0e50ff12159c3bc21888", "url": "https://github.com/hazelcast/hazelcast/commit/06589f2a1bc9b358d98a0e50ff12159c3bc21888", "message": "code review comments fixed", "committedDate": "2020-09-01T12:07:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk1NjY1Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r481956657", "bodyText": "Can you make the implementation aligned with ListenerConfig.\nIf loadBalancer is set it will be set to null. Also the class name will be set to null when the loadBalacer is set.\nPlease do not forget to add related javadoc.\nAnd also as it is implemented in ListenerConfig add @Nonnull  tag together with checkHasText", "author": "sancar", "createdAt": "2020-09-02T10:11:10Z", "path": "hazelcast/src/main/java/com/hazelcast/client/config/ClientConfig.java", "diffHunk": "@@ -613,6 +619,29 @@ public ClientConfig setLoadBalancer(LoadBalancer loadBalancer) {\n         return this;\n     }\n \n+    /**\n+     * Gets load balancer class name\n+     *\n+     * @return load balancer class name\n+     * @see com.hazelcast.client.LoadBalancer\n+     */\n+    public String getLoadBalancerClassName() {\n+        return loadBalancerClassName;\n+    }\n+\n+    /**\n+     * Sets load balancer class name\n+     *\n+     * @param loadBalancerClassName {@link LoadBalancer}\n+     * @return configured {@link com.hazelcast.client.config.ClientConfig} for chaining\n+     * @see com.hazelcast.client.LoadBalancer\n+     */\n+    public ClientConfig setLoadBalancerClassName(String loadBalancerClassName) {\n+        this.loadBalancerClassName = loadBalancerClassName;\n+        return this;\n+    }", "originalCommit": "06589f2a1bc9b358d98a0e50ff12159c3bc21888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk3OTg4MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17415#discussion_r481979880", "bodyText": "Done. I made them mutually exclusive as suggested.", "author": "the-thing", "createdAt": "2020-09-02T10:53:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk1NjY1Nw=="}], "type": "inlineReview"}, {"oid": "dac66e2af6120694e66db5964e9df5d5484edfd2", "url": "https://github.com/hazelcast/hazelcast/commit/dac66e2af6120694e66db5964e9df5d5484edfd2", "message": "client config load balancer and load balancer class name are mutually exclusive\n\nload balancer client config xml and yaml examples updated", "committedDate": "2020-09-02T10:51:07Z", "type": "commit"}]}