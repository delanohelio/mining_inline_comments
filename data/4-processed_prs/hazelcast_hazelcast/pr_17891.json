{"pr_number": 17891, "pr_title": "Don't promote transitive dependencies in shaded hazelcast-all", "pr_createdAt": "2020-11-24T15:45:49Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17891", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE3MzUyOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17891#discussion_r530173529", "bodyText": "@kwart @jerrinot I think we need to add similar fail safe to release automation, I will work on it, please let me know if you see that redundant after this test case.\n\nUpdate:\ncreated https://github.com/hazelcast/hazelcast-pipeline-library/issues/119 on automation side. Thanks @kwart for the guidance.", "author": "lazerion", "createdAt": "2020-11-25T08:04:54Z", "path": "hazelcast-all/src/test/java/com/hazelcast/it/DependencyReducedPomIT.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.it;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import java.io.FileInputStream;\n+import java.util.Iterator;\n+\n+import javax.xml.namespace.NamespaceContext;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NodeList;\n+\n+import com.hazelcast.test.HazelcastParallelClassRunner;\n+import com.hazelcast.test.annotation.QuickTest;\n+\n+@RunWith(HazelcastParallelClassRunner.class)\n+@Category(QuickTest.class)\n+public class DependencyReducedPomIT {\n+\n+    @Test\n+    public void testZeroCompileScopedDeps() throws Exception {", "originalCommit": "6278a0e0d83994eaef8320c32ad97793e875520b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE3NDYxOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17891#discussion_r530174619", "bodyText": "@kwart I also see below when we execute mvn deploy\n also see 2 shade executions of sql  module\nINFO] --- maven-shade-plugin:3.2.4:shade (fat-jar) @ hazelcast-sql ---\n[INFO] --- maven-shade-plugin:3.2.4:shade (fat-shaded-jar) @ hazelcast-sql ---\n\ndo we need to do sth for it as well?", "author": "lazerion", "createdAt": "2020-11-25T08:06:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE3MzUyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI1NDIxNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17891#discussion_r530254217", "bodyText": "I think we need to add similar fail safe to release automation, I will work on it, please let me know if you see that redundant after this test case.\n\nWe should ask @devozerov for an explanation. I think the 2 different shaded artifacts are intentional, but I didn't dig into it to get the reasoning.", "author": "kwart", "createdAt": "2020-11-25T10:11:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE3MzUyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgzMjM3MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17891#discussion_r530832370", "bodyText": "In the SQL module we have two executions of the shade module:\n\nfat-shaded-jar - the default Jar with all dependencies merged into the hazelcast-sql.jar, this is what we publish\nslim-original-jar (previously fat-jar) produces a JAR that is convenient for the Jet team development process, it is not published (@gierlachg may provide additional details, my explanation could be inaccurate)", "author": "devozerov", "createdAt": "2020-11-26T07:56:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE3MzUyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg0MDU3NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17891#discussion_r530840574", "bodyText": "Hmm, why it is not published? We rely on it.", "author": "gierlachg", "createdAt": "2020-11-26T08:12:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE3MzUyOQ=="}], "type": "inlineReview"}, {"oid": "35d8d9084841bdab3ba13f3d7957988a97b02a88", "url": "https://github.com/hazelcast/hazelcast/commit/35d8d9084841bdab3ba13f3d7957988a97b02a88", "message": "Fix violations from zero-dependency policy and add regression tests.", "committedDate": "2020-11-26T10:44:32Z", "type": "commit"}, {"oid": "35d8d9084841bdab3ba13f3d7957988a97b02a88", "url": "https://github.com/hazelcast/hazelcast/commit/35d8d9084841bdab3ba13f3d7957988a97b02a88", "message": "Fix violations from zero-dependency policy and add regression tests.", "committedDate": "2020-11-26T10:44:32Z", "type": "forcePushed"}]}