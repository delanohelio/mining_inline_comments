{"pr_number": 17766, "pr_title": "Downgrade surefire plugin to resolve OOM issues in 3.0.0-M4", "pr_createdAt": "2020-10-26T20:37:44Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17766", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYxMDU2Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17766#discussion_r512610562", "bodyText": "This looks a bit different than the profile we have in the EE repo's module. I think we need to consolidate the two, such as we need to make sure the tests in the OS module don't \"phone home\". The EE module also allows running the QuickTests. Not sure that's needed, we have only ModulePathTests in that module.", "author": "blazember", "createdAt": "2020-10-27T11:23:57Z", "path": "modulepath-tests/pom.xml", "diffHunk": "@@ -118,4 +118,25 @@\n             <scope>test</scope>\n         </dependency>\n     </dependencies>\n+\n+    <profiles>\n+        <profile>\n+            <id>parallelTest</id>\n+            <build>\n+                <plugins>\n+                    <plugin>\n+                        <groupId>org.apache.maven.plugins</groupId>\n+                        <artifactId>maven-surefire-plugin</artifactId>\n+                        <version>${maven.surefire.plugin.version}</version>\n+                        <executions>\n+                            <execution>\n+                                <id>default-test</id>\n+                                <phase>none</phase>\n+                            </execution>\n+                        </executions>\n+                    </plugin>\n+                </plugins>\n+            </build>\n+        </profile>\n+    </profiles>", "originalCommit": "1892b828f5238a653d0ec3b2a63338d62d86135c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY1MDgyOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17766#discussion_r512650829", "bodyText": "I'll check it and if needed I'll align the EE version to be more like this OS one.", "author": "kwart", "createdAt": "2020-10-27T12:28:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYxMDU2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3MTI0MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17766#discussion_r512671240", "bodyText": "I found a simpler way how to handle the parallel test by redefining the javaModuleArgs property. I've sent the update on both OS and EE side. Please recheck.", "author": "kwart", "createdAt": "2020-10-27T13:00:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYxMDU2Mg=="}], "type": "inlineReview"}, {"oid": "d51459ffbe09c69272471794155c486649c55f93", "url": "https://github.com/hazelcast/hazelcast/commit/d51459ffbe09c69272471794155c486649c55f93", "message": "Downgrade surefire plugin to resolve OOM issues in 3.0.0-M4", "committedDate": "2020-10-27T12:58:39Z", "type": "commit"}, {"oid": "d51459ffbe09c69272471794155c486649c55f93", "url": "https://github.com/hazelcast/hazelcast/commit/d51459ffbe09c69272471794155c486649c55f93", "message": "Downgrade surefire plugin to resolve OOM issues in 3.0.0-M4", "committedDate": "2020-10-27T12:58:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3NDY0NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17766#discussion_r512674645", "bodyText": "Shouldn't we remove only the module args from here? I would also retain the comments.", "author": "blazember", "createdAt": "2020-10-27T13:06:17Z", "path": "modulepath-tests/pom.xml", "diffHunk": "@@ -50,39 +61,6 @@\n                     <release>9</release>\n                 </configuration>\n             </plugin>\n-            <plugin>\n-                <groupId>org.apache.maven.plugins</groupId>\n-                <artifactId>maven-surefire-plugin</artifactId>\n-                <configuration combine.self=\"override\">\n-                    <!--\n-                    Allow access to Operating system metrics:\n-                        open jdk.management/com.sun.management.internal\n-\n-                    Avoid warnings caused by reflection in\n-                    SelectorOptimizer:\n-                        open java.base/sun.nio.ch\n-                    FilteringClassLoader:\n-                        open java.base/java.lang\n-                    TimedMemberStateFactoryHelper:\n-                        open java.management/sun.management\n-\n-                    Powermock issue workaround (https://github.com/powermock/powermock/issues/905):\n-                        export java.xml/jdk.xml.internal\n-                     -->\n-                    <argLine>\n-                        ${vmHeapSettings}\n-                        --add-opens jdk.management/com.sun.management.internal=com.hazelcast.core\n-                        --add-opens java.base/sun.nio.ch=com.hazelcast.core\n-                        --add-opens java.base/java.lang=com.hazelcast.core\n-                        --add-opens java.management/sun.management=com.hazelcast.core\n-                        --add-exports java.xml/jdk.xml.internal=com.hazelcast.core\n-                        --illegal-access=warn\n-                        -Dhazelcast.phone.home.enabled=false\n-                        -Dlog4j.skipJansi=true\n-                        ${extraVmArgs}", "originalCommit": "d51459ffbe09c69272471794155c486649c55f93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3OTQ2OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17766#discussion_r512679469", "bodyText": "Nope, it's not necessary to keep this custom surefire plugin configuration. We reuse the config from the parent project instead (hazelcast-root). To workaround the parallelTest issue in surefire version 2.22.2 we disable default-test execution in modulepath-tests. So tests run always in the singlejvm execution.", "author": "kwart", "createdAt": "2020-10-27T13:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3NDY0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4NzQxMQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17766#discussion_r512687411", "bodyText": "Thanks it's clear now \ud83d\udc4d", "author": "blazember", "createdAt": "2020-10-27T13:24:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3NDY0NQ=="}], "type": "inlineReview"}]}