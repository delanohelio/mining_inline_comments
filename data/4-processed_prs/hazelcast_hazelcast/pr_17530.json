{"pr_number": 17530, "pr_title": "QueryUtils.createPartitionMap may throw NPE if a partition is not assigned", "pr_createdAt": "2020-09-14T09:37:26Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17530", "timeline": [{"oid": "175d36151dd940e43766fdf02642b08b67f13678", "url": "https://github.com/hazelcast/hazelcast/commit/175d36151dd940e43766fdf02642b08b67f13678", "message": "Fixed possible NPE in case of unassigned partition.", "committedDate": "2020-09-14T09:20:38Z", "type": "commit"}, {"oid": "cb314381ea283a540c482e05630fcfc4ee140662", "url": "https://github.com/hazelcast/hazelcast/commit/cb314381ea283a540c482e05630fcfc4ee140662", "message": "Tests", "committedDate": "2020-09-14T09:32:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NTAyMg==", "url": "https://github.com/hazelcast/hazelcast/pull/17530#discussion_r487855022", "bodyText": "In which situation the owner can be null?", "author": "petrpleshachkov", "createdAt": "2020-09-14T11:57:08Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/QueryUtils.java", "diffHunk": "@@ -190,6 +193,17 @@ public static SqlColumnMetadata getColumnMetadata(String columnName, QueryDataTy\n         for (Partition part : parts) {\n             Member owner = part.getOwner();\n \n+            if (owner == null) {", "originalCommit": "cb314381ea283a540c482e05630fcfc4ee140662", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4NjcwMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17530#discussion_r487886700", "bodyText": "I cannot explain the exact situations when the partition could be unassigned. Some of them - member failure, FROZEN cluster state. The main thing is that the null is in the contract of this method (see JavaDoc):\n\nIt can be that null is returned if the owner of a partition has not been established", "author": "devozerov", "createdAt": "2020-09-14T12:51:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NTAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4NzU2MQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17530#discussion_r487887561", "bodyText": "The partition table is also calculated lazily so if you create a new cluster and don't call any partition operations, the partition table is not established yet and owners are null.", "author": "mmedenjak", "createdAt": "2020-09-14T12:52:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NTAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4ODM4Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17530#discussion_r487888383", "bodyText": "Does it mean that one member failure would trigger this exception for any SQL query?", "author": "petrpleshachkov", "createdAt": "2020-09-14T12:54:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NTAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4OTg4NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17530#discussion_r487889885", "bodyText": "Member failure may trigger temporal errors until the partition table is recalculated.", "author": "devozerov", "createdAt": "2020-09-14T12:56:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NTAyMg=="}], "type": "inlineReview"}]}