{"pr_number": 17684, "pr_title": "Check duplicate fields when building class definition", "pr_createdAt": "2020-10-05T12:13:16Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17684", "timeline": [{"oid": "2ae8db4c0c06d8cfa1364893d3548bd268425369", "url": "https://github.com/hazelcast/hazelcast/commit/2ae8db4c0c06d8cfa1364893d3548bd268425369", "message": "Check duplicate fields when building class definition\n\nClassDefinitionBuider.addX methods checks if a field\nis already added with same name and\nthrows HazelcastSerializatioException if already added.\n\nfixes https://github.com/hazelcast/hazelcast/issues/17616\n\n(cherry picked from commit 344a0b0df7ca238bb43afd5e5bf516ec4371c1c7)", "committedDate": "2020-10-05T12:32:36Z", "type": "forcePushed"}, {"oid": "25db1697a9989e44c653b88eb63c57bd7ae88e09", "url": "https://github.com/hazelcast/hazelcast/commit/25db1697a9989e44c653b88eb63c57bd7ae88e09", "message": "Check duplicate fields when building class definition\n\nClassDefinitionBuider.addX methods checks if a field\nis already added with same name and\nthrows HazelcastSerializatioException if already added.\n\nfixes https://github.com/hazelcast/hazelcast/issues/17616\n\n(cherry picked from commit 344a0b0df7ca238bb43afd5e5bf516ec4371c1c7)", "committedDate": "2020-10-05T14:11:20Z", "type": "commit"}, {"oid": "25db1697a9989e44c653b88eb63c57bd7ae88e09", "url": "https://github.com/hazelcast/hazelcast/commit/25db1697a9989e44c653b88eb63c57bd7ae88e09", "message": "Check duplicate fields when building class definition\n\nClassDefinitionBuider.addX methods checks if a field\nis already added with same name and\nthrows HazelcastSerializatioException if already added.\n\nfixes https://github.com/hazelcast/hazelcast/issues/17616\n\n(cherry picked from commit 344a0b0df7ca238bb43afd5e5bf516ec4371c1c7)", "committedDate": "2020-10-05T14:11:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3MzY0Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/17684#discussion_r500073647", "bodyText": "nit: \"will be added\" (also in other methods' javadoc)", "author": "vbekiaris", "createdAt": "2020-10-06T07:50:54Z", "path": "hazelcast/src/main/java/com/hazelcast/nio/serialization/ClassDefinitionBuilder.java", "diffHunk": "@@ -66,116 +69,230 @@ public ClassDefinitionBuilder(int factoryId, int classId, int version) {\n         this.version = version;\n     }\n \n+    /**\n+     * @param fieldName name of the field that will be add to this class definition", "originalCommit": "25db1697a9989e44c653b88eb63c57bd7ae88e09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3NTk4NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17684#discussion_r500075984", "bodyText": "invocation of build() can be removed since the exception is expected from the second add* method", "author": "vbekiaris", "createdAt": "2020-10-06T07:55:08Z", "path": "hazelcast/src/test/java/com/hazelcast/internal/serialization/impl/ClassAndFieldDefinitionTest.java", "diffHunk": "@@ -195,4 +196,16 @@ public void testFieldDef_equal_hashCode() throws Exception {\n     public void testFieldDef_toString() throws Exception {\n         assertNotNull(new FieldDefinitionImpl(0, \"name\", FieldType.BOOLEAN, portableVersion).toString());\n     }\n+\n+    @Test(expected = HazelcastSerializationException.class)\n+    public void testClassDefinitionBuilder_addingSameFieldTwice() {\n+        new ClassDefinitionBuilder(1, 2, 1)\n+                .addUTFField(\"name\").addUTFField(\"name\").build();", "originalCommit": "25db1697a9989e44c653b88eb63c57bd7ae88e09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8e7d088070e87bc522d6a2d344611fc160ba5fac", "url": "https://github.com/hazelcast/hazelcast/commit/8e7d088070e87bc522d6a2d344611fc160ba5fac", "message": "address review comments. Javadoc and test update.", "committedDate": "2020-10-06T08:23:58Z", "type": "commit"}, {"oid": "539547e871931f624a7b8cccc786c8344d50350b", "url": "https://github.com/hazelcast/hazelcast/commit/539547e871931f624a7b8cccc786c8344d50350b", "message": "fix addPortable/ArrayField", "committedDate": "2020-10-06T14:12:56Z", "type": "commit"}]}