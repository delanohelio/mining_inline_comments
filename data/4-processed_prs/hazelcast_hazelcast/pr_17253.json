{"pr_number": 17253, "pr_title": "Add SES and DES stats", "pr_createdAt": "2020-07-21T15:05:55Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17253", "timeline": [{"oid": "39ad8acb323c5abf39cfbdc20ebd5f2a35715d01", "url": "https://github.com/hazelcast/hazelcast/commit/39ad8acb323c5abf39cfbdc20ebd5f2a35715d01", "message": "public api 1", "committedDate": "2020-07-23T10:36:01Z", "type": "forcePushed"}, {"oid": "bbbd14ffd737c90e5b95c84ea100e5082a15dccf", "url": "https://github.com/hazelcast/hazelcast/commit/bbbd14ffd737c90e5b95c84ea100e5082a15dccf", "message": "Offloaded stats 2", "committedDate": "2020-07-24T12:38:10Z", "type": "forcePushed"}, {"oid": "22250d8c1cb3c99e7aa79b57c5e18ab1434a2fb5", "url": "https://github.com/hazelcast/hazelcast/commit/22250d8c1cb3c99e7aa79b57c5e18ab1434a2fb5", "message": "One stats", "committedDate": "2020-08-04T07:41:07Z", "type": "forcePushed"}, {"oid": "ca37a46e927ff3ce2110199f187bcead6df9f611", "url": "https://github.com/hazelcast/hazelcast/commit/ca37a46e927ff3ce2110199f187bcead6df9f611", "message": "add des local api", "committedDate": "2020-08-04T15:23:06Z", "type": "forcePushed"}, {"oid": "88b500a0d373c7664609c20651b207c7fc03245b", "url": "https://github.com/hazelcast/hazelcast/commit/88b500a0d373c7664609c20651b207c7fc03245b", "message": "Remove local-stats from api", "committedDate": "2020-08-06T11:00:04Z", "type": "forcePushed"}, {"oid": "21a5605bf417bc2a8a720020b5f2f8ab258b3808", "url": "https://github.com/hazelcast/hazelcast/commit/21a5605bf417bc2a8a720020b5f2f8ab258b3808", "message": "wip", "committedDate": "2020-08-11T12:01:33Z", "type": "forcePushed"}, {"oid": "1ec51050878386d42693be8b7e34505a99a920ad", "url": "https://github.com/hazelcast/hazelcast/commit/1ec51050878386d42693be8b7e34505a99a920ad", "message": "Add durable, scheduler and offloded executor stats", "committedDate": "2020-08-11T14:47:58Z", "type": "forcePushed"}, {"oid": "0a3cef8230354b006ee87f0b2c7422422284a9d5", "url": "https://github.com/hazelcast/hazelcast/commit/0a3cef8230354b006ee87f0b2c7422422284a9d5", "message": "Add durable, scheduler and offloded executor stats", "committedDate": "2020-08-11T16:06:45Z", "type": "forcePushed"}, {"oid": "9e6e440613849ccb7ebaaf7e8b87128ff0a80414", "url": "https://github.com/hazelcast/hazelcast/commit/9e6e440613849ccb7ebaaf7e8b87128ff0a80414", "message": "Add durable, scheduler and offloded executor stats", "committedDate": "2020-08-16T10:05:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ2MzcwOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r471463709", "bodyText": "Leftover TODOs?", "author": "mmedenjak", "createdAt": "2020-08-17T13:04:07Z", "path": "hazelcast/src/main/java/com/hazelcast/client/impl/clientside/ClientDynamicClusterConfig.java", "diffHunk": "@@ -288,6 +288,7 @@ public Config addExecutorConfig(ExecutorConfig executorConfig) {\n         return this;\n     }\n \n+    // TODO stats", "originalCommit": "9e6e440613849ccb7ebaaf7e8b87128ff0a80414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxNDk3OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473014978", "bodyText": "Realised it's about the client protocol. Can you add it regardless?", "author": "mmedenjak", "createdAt": "2020-08-19T13:08:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ2MzcwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4MTIzOA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473081238", "bodyText": "will address in a later PR.", "author": "ahmetmircik", "createdAt": "2020-08-19T14:39:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ2MzcwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxNjU3Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473016573", "bodyText": "Better use something like Returns {@code true} if. Maybe you can omit the @return then if they will be the same.", "author": "mmedenjak", "createdAt": "2020-08-19T13:10:37Z", "path": "hazelcast/src/main/java/com/hazelcast/config/DurableExecutorConfig.java", "diffHunk": "@@ -182,13 +187,36 @@ public DurableExecutorConfig setSplitBrainProtectionName(String splitBrainProtec\n         return this;\n     }\n \n+    /**\n+     * Gets if statistics gathering is enabled", "originalCommit": "9e6e440613849ccb7ebaaf7e8b87128ff0a80414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4MTI2OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473081268", "bodyText": "fixed.", "author": "ahmetmircik", "createdAt": "2020-08-19T14:39:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxNjU3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxNzU3MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473017570", "bodyText": "Same comment as in other config", "author": "mmedenjak", "createdAt": "2020-08-19T13:12:11Z", "path": "hazelcast/src/main/java/com/hazelcast/config/ScheduledExecutorConfig.java", "diffHunk": "@@ -248,6 +261,29 @@ public ScheduledExecutorConfig setMergePolicyConfig(MergePolicyConfig mergePolic\n         return this;\n     }\n \n+    /**\n+     * Gets if statistics gathering is enabled", "originalCommit": "9e6e440613849ccb7ebaaf7e8b87128ff0a80414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4MTMxNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473081316", "bodyText": "fixed.", "author": "ahmetmircik", "createdAt": "2020-08-19T14:39:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxNzU3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyMTEyNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473021125", "bodyText": "I see we're missing this config in other places like XSD, YAML, XML and spring config (https://github.com/hazelcast/hazelcast/wiki/Checklist-for-Hazelcast-config-changes). Can you add it?", "author": "mmedenjak", "createdAt": "2020-08-19T13:17:03Z", "path": "hazelcast/src/main/java/com/hazelcast/config/DurableExecutorConfig.java", "diffHunk": "@@ -57,6 +60,8 @@\n \n     private String splitBrainProtectionName;\n \n+    private boolean statisticsEnabled = true;", "originalCommit": "9e6e440613849ccb7ebaaf7e8b87128ff0a80414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4MTM1Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473081352", "bodyText": "done.", "author": "ahmetmircik", "createdAt": "2020-08-19T14:39:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyMTEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyOTU4Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473029586", "bodyText": "Should this be under executors instead? I see other internal executors like executor.durable.internal.", "author": "mmedenjak", "createdAt": "2020-08-19T13:29:22Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/metrics/MetricDescriptorConstants.java", "diffHunk": "@@ -199,6 +207,7 @@\n     public static final String MAP_PREFIX = \"map\";\n     public static final String MAP_PREFIX_INDEX = \"map.index\";\n     public static final String MAP_PREFIX_NEARCACHE = \"map.nearcache\";\n+    public static final String MAP_PREFIX_ENTRY_PROCESSOR_OFFLOADABLE_EXECUTOR = \"map.entry.processor.offloadable.executor\";", "originalCommit": "9e6e440613849ccb7ebaaf7e8b87128ff0a80414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4MjIwMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473082200", "bodyText": "Statistics collection for that is enabled/disabled per map, this was the reason i did it like this. WDYT?", "author": "ahmetmircik", "createdAt": "2020-08-19T14:40:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyOTU4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMDc3Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475530773", "bodyText": "Ok, let's keep it here but maybe just change it to map.entryprocessor.offloadable.executor or change it even to map.offloadable.executor because:\n\u2022 we have other prefixes that don't separate words with dots (e.g. nearcache)\n\u2022 maybe we will use that executor for other tasks so we can remove mention of EP", "author": "mmedenjak", "createdAt": "2020-08-24T11:22:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyOTU4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAzMDcyMQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473030721", "bodyText": "Can you add javadoc on the class and methods for future maintenance?", "author": "mmedenjak", "createdAt": "2020-08-19T13:31:02Z", "path": "hazelcast/src/main/java/com/hazelcast/map/impl/ExecutorStats.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.map.impl;\n+\n+import com.hazelcast.internal.monitor.impl.LocalExecutorStatsImpl;\n+import com.hazelcast.internal.util.ConcurrencyUtil;\n+import com.hazelcast.internal.util.ConstructorFunction;\n+\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+public final class ExecutorStats {", "originalCommit": "9e6e440613849ccb7ebaaf7e8b87128ff0a80414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4MjI3Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r473082272", "bodyText": "done.", "author": "ahmetmircik", "createdAt": "2020-08-19T14:40:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAzMDcyMQ=="}], "type": "inlineReview"}, {"oid": "e0f8e4c47f25e9f219ebeaac82dbaad1ba9dea30", "url": "https://github.com/hazelcast/hazelcast/commit/e0f8e4c47f25e9f219ebeaac82dbaad1ba9dea30", "message": "Add TDD docs", "committedDate": "2020-08-19T13:50:12Z", "type": "forcePushed"}, {"oid": "8cba7892b98a93134cbf9afbd8faa5e1b896dfb6", "url": "https://github.com/hazelcast/hazelcast/commit/8cba7892b98a93134cbf9afbd8faa5e1b896dfb6", "message": "Add TDD docs", "committedDate": "2020-08-19T13:51:46Z", "type": "forcePushed"}, {"oid": "f66091d4b7129036ca0e3f059a6f42498bfade35", "url": "https://github.com/hazelcast/hazelcast/commit/f66091d4b7129036ca0e3f059a6f42498bfade35", "message": "Add TDD docs", "committedDate": "2020-08-19T13:55:56Z", "type": "forcePushed"}, {"oid": "1fb18807308dc719c04acd139582c5b53b1a5c61", "url": "https://github.com/hazelcast/hazelcast/commit/1fb18807308dc719c04acd139582c5b53b1a5c61", "message": "Add tests", "committedDate": "2020-08-21T09:05:04Z", "type": "forcePushed"}, {"oid": "a0bb0b822ddca6a7bf734860ee6639de2786fe33", "url": "https://github.com/hazelcast/hazelcast/commit/a0bb0b822ddca6a7bf734860ee6639de2786fe33", "message": "Add tests", "committedDate": "2020-08-21T09:05:22Z", "type": "forcePushed"}, {"oid": "83039804f974b3fa37d97f075e1107a932519813", "url": "https://github.com/hazelcast/hazelcast/commit/83039804f974b3fa37d97f075e1107a932519813", "message": "Add tests", "committedDate": "2020-08-21T09:11:54Z", "type": "forcePushed"}, {"oid": "f39139b0cde778a655473f48b3076cbf53760be3", "url": "https://github.com/hazelcast/hazelcast/commit/f39139b0cde778a655473f48b3076cbf53760be3", "message": "Add tests", "committedDate": "2020-08-21T10:09:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ5NDEwNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475494105", "bodyText": "Missing changes in ConfigXmlGenerator, ConfigXmlGeneratorTest and ConfigCompatibilityChecker, same for other config.", "author": "mmedenjak", "createdAt": "2020-08-24T10:15:51Z", "path": "hazelcast/src/main/java/com/hazelcast/config/DurableExecutorConfig.java", "diffHunk": "@@ -57,28 +60,32 @@\n \n     private String splitBrainProtectionName;\n \n+    private boolean statisticsEnabled = true;", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0Mzk3NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743975", "bodyText": "done.", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ5NDEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ5NTM3MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475495370", "bodyText": "Can you add the default for the statistics here and in the YAML file?", "author": "mmedenjak", "createdAt": "2020-08-24T10:18:27Z", "path": "hazelcast/src/main/resources/hazelcast-default.xml", "diffHunk": "@@ -116,6 +116,12 @@\n         <!--Queue capacity. 0 means Integer.MAX_VALUE.-->\n         <queue-capacity>0</queue-capacity>\n     </executor-service>\n+    <scheduled-executor-service name=\"default\">", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0MzkzOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743939", "bodyText": "done.", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ5NTM3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMDM2Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475520366", "bodyText": "Will this wrap the exception? Do we have tests for this case?", "author": "mmedenjak", "createdAt": "2020-08-24T11:00:38Z", "path": "hazelcast/src/main/java/com/hazelcast/durableexecutor/impl/DurableExecutorContainer.java", "diffHunk": "@@ -17,49 +17,81 @@\n package com.hazelcast.durableexecutor.impl;\n \n import com.hazelcast.durableexecutor.impl.operations.PutResultOperation;\n+import com.hazelcast.internal.util.Clock;\n+import com.hazelcast.internal.util.ExceptionUtil;\n import com.hazelcast.logging.ILogger;\n+import com.hazelcast.map.impl.ExecutorStats;\n import com.hazelcast.spi.impl.NodeEngineImpl;\n import com.hazelcast.spi.impl.executionservice.ExecutionService;\n import com.hazelcast.spi.impl.operationservice.Operation;\n import com.hazelcast.spi.impl.operationservice.OperationService;\n \n import java.util.concurrent.Callable;\n import java.util.concurrent.FutureTask;\n+import java.util.concurrent.RejectedExecutionException;\n \n import static com.hazelcast.durableexecutor.impl.DistributedDurableExecutorService.SERVICE_NAME;\n \n public class DurableExecutorContainer {\n \n-    private final String name;\n-\n-    private final NodeEngineImpl nodeEngine;\n-\n-    private final ExecutionService executionService;\n-\n-    private final ILogger logger;\n-\n-    private final int partitionId;\n-\n     private final int durability;\n+    private final int partitionId;\n+    private final boolean statisticsEnabled;\n \n+    private final String name;\n+    private final ILogger logger;\n     private final TaskRingBuffer ringBuffer;\n+    private final NodeEngineImpl nodeEngine;\n+    private final ExecutorStats executorStats;\n+    private final ExecutionService executionService;\n \n     public DurableExecutorContainer(NodeEngineImpl nodeEngine, String name, int partitionId,\n-                                    int durability, TaskRingBuffer ringBuffer) {\n+                                    int durability, boolean statisticsEnabled, TaskRingBuffer ringBuffer) {\n         this.name = name;\n         this.nodeEngine = nodeEngine;\n         this.executionService = nodeEngine.getExecutionService();\n         this.partitionId = partitionId;\n         this.logger = nodeEngine.getLogger(DurableExecutorContainer.class);\n         this.durability = durability;\n         this.ringBuffer = ringBuffer;\n+        this.statisticsEnabled = statisticsEnabled;\n+        this.executorStats = ((DistributedDurableExecutorService) nodeEngine.getService(SERVICE_NAME)).getExecutorStats();\n     }\n \n     public int execute(Callable callable) {\n-        int sequence = ringBuffer.add(callable);\n-        TaskProcessor processor = new TaskProcessor(sequence, callable);\n-        executionService.executeDurable(name, processor);\n-        return sequence;\n+        try {\n+            int sequence = ringBuffer.add(callable);\n+            TaskProcessor processor = new TaskProcessor(sequence, callable);\n+            executionService.executeDurable(name, processor);\n+            return sequence;\n+        } catch (RejectedExecutionException e) {\n+            if (statisticsEnabled) {\n+                executorStats.rejectExecution(name);\n+            }\n+            throw ExceptionUtil.rethrow(e);\n+        }\n+    }\n+\n+    void executeAll() {\n+        try {\n+            TaskRingBuffer.DurableIterator iterator = ringBuffer.iterator();\n+            while (iterator.hasNext()) {\n+                Object item = iterator.next();\n+                boolean isCallable = iterator.isTask();\n+                if (!isCallable) {\n+                    continue;\n+                }\n+                Callable callable = (Callable) item;\n+                int sequence = iterator.getSequence();\n+                TaskProcessor processor = new TaskProcessor(sequence, callable);\n+                executionService.executeDurable(name, processor);\n+            }\n+        } catch (RejectedExecutionException e) {\n+            if (statisticsEnabled) {\n+                executorStats.rejectExecution(name);\n+            }\n+            throw ExceptionUtil.rethrow(e);", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0MzkxNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743915", "bodyText": "removed wrapping.", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMDM2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMDY5OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475520699", "bodyText": "Does the \"execution time\" include the queueing time in all of the uses of the executor stats?", "author": "mmedenjak", "createdAt": "2020-08-24T11:01:19Z", "path": "hazelcast/src/main/java/com/hazelcast/durableexecutor/impl/DurableExecutorContainer.java", "diffHunk": "@@ -138,6 +166,9 @@ public void run() {\n             } finally {\n                 if (!isCancelled()) {\n                     setResponse(response);\n+                    if (statisticsEnabled) {", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0Mzg0OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743849", "bodyText": "No, it's meaning is aligned with executor service and it is the execution time in thread without queueing time.", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyMDY5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyNDMwNA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475524304", "bodyText": "Minor: I see none of the other names of the keys have With in them.", "author": "mmedenjak", "createdAt": "2020-08-24T11:09:11Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/monitor/impl/MemberStateImpl.java", "diffHunk": "@@ -302,6 +312,8 @@ public JsonObject toJson() {\n         serializeAsMap(root, \"reliableTopicStats\", reliableTopicsWithStats);\n         serializeAsMap(root, \"pnCounterStats\", pnCountersWithStats);\n         serializeAsMap(root, \"executorStats\", executorsWithStats);\n+        serializeAsMap(root, \"scheduledExecutorsWithStats\", scheduledExecutorsWithStats);", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0Mzc4Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743783", "bodyText": "removed with", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyNDMwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyNDgwNA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475524804", "bodyText": "Again, can this wrap the exception that was previously not wrapped?", "author": "mmedenjak", "createdAt": "2020-08-24T11:10:16Z", "path": "hazelcast/src/main/java/com/hazelcast/map/impl/operation/EntryOperation.java", "diffHunk": "@@ -407,6 +411,22 @@ private void executeMutatingEntryProcessor(final Object oldValue, String executo\n             }\n         }\n \n+        private void doExecute(String executorName, Runnable runnable) {\n+            boolean statisticsEnabled = mapContainer.getMapConfig().isStatisticsEnabled();\n+            ExecutorStats executorStats = mapServiceContext.getOffloadedEntryProcessorExecutorStats();\n+            try {\n+                Runnable command = statisticsEnabled\n+                        ? new StatsAwareRunnable(runnable, executorName, executorStats) : runnable;\n+                executionService.execute(executorName, command);\n+            } catch (RejectedExecutionException e) {\n+                if (statisticsEnabled) {\n+                    executorStats.rejectExecution(executorName);\n+                }\n+\n+                throw ExceptionUtil.rethrow(e);", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0Mzc0NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743745", "bodyText": "removed wrapping.", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyNDgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxNDgyNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475514827", "bodyText": "Minor: I know that the default values for newly added booleans are false by default, hence statisticsEnabled can be used like this but I think it would be better if we don't rely on this fact and use something like parameters.isStatisticsEnabledExists && parameters.statisticsEnabled", "author": "mdumandag", "createdAt": "2020-08-24T10:49:11Z", "path": "hazelcast/src/main/java/com/hazelcast/client/impl/protocol/task/dynamicconfig/AddDurableExecutorConfigMessageTask.java", "diffHunk": "@@ -44,7 +44,7 @@ protected ClientMessage encodeResponse(Object response) {\n     @Override\n     protected IdentifiedDataSerializable getConfig() {\n         DurableExecutorConfig config = new DurableExecutorConfig(parameters.name, parameters.poolSize,\n-                parameters.durability, parameters.capacity);\n+                parameters.durability, parameters.capacity, parameters.statisticsEnabled);", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0MzY5OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743698", "bodyText": "Default value is true. But i wonder in what scenario client doesn't send statisticsEnabled to server?", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxNDgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMyMzUxOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476323519", "bodyText": "isStatisticsEnabledExists will be false for old clients (v4.0 series)(statisticsEnabled will have the default value for its type in this case, but I think we shouldn't rely on this fact and consider statisticsEnabled as something undefined) and will be true otherwise. (>=v4.1). statisticsEnabled will only have a valid value when the isStatisticsEnabledExists is true.\nSo, if we want to also enable statistics when the v4.0 client adds an executor config, something like !parameters.isStatisticsEnabledExists || parameters.statisticsEnabled would be enough. I initially thought that we would disable statistics when the old client adds an executor config. If that is the case, the snippet in my first comment would work.", "author": "mdumandag", "createdAt": "2020-08-25T09:48:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxNDgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMzNzQ2Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476337462", "bodyText": "Thanks for the explanation. It should have been fixed now.", "author": "ahmetmircik", "createdAt": "2020-08-25T10:13:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxNDgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxNTA1MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475515050", "bodyText": "Same comment as the AddDurableExecutorConfigMessageTask", "author": "mdumandag", "createdAt": "2020-08-24T10:49:39Z", "path": "hazelcast/src/main/java/com/hazelcast/client/impl/protocol/task/dynamicconfig/AddScheduledExecutorConfigMessageTask.java", "diffHunk": "@@ -49,6 +49,7 @@ protected IdentifiedDataSerializable getConfig() {\n         config.setDurability(parameters.durability);\n         config.setCapacity(parameters.capacity);\n         config.setName(parameters.name);\n+        config.setStatisticsEnabled(parameters.statisticsEnabled);", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMzNzE3NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476337175", "bodyText": "fixed", "author": "ahmetmircik", "createdAt": "2020-08-25T10:12:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxNTA1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyNTE2Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475525162", "bodyText": "Minor: Would it be better to rename those as scheduledExecutorStats and durableExecutorStats to be consistent with others?", "author": "mdumandag", "createdAt": "2020-08-24T11:11:03Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/monitor/impl/MemberStateImpl.java", "diffHunk": "@@ -302,6 +312,8 @@ public JsonObject toJson() {\n         serializeAsMap(root, \"reliableTopicStats\", reliableTopicsWithStats);\n         serializeAsMap(root, \"pnCounterStats\", pnCountersWithStats);\n         serializeAsMap(root, \"executorStats\", executorsWithStats);\n+        serializeAsMap(root, \"scheduledExecutorsWithStats\", scheduledExecutorsWithStats);", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0MzU1Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743553", "bodyText": "done.", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyNTE2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMjkzMg==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475532932", "bodyText": "Minor: Maybe we could rename nearCacheDescriptor to something else?", "author": "mdumandag", "createdAt": "2020-08-24T11:27:45Z", "path": "hazelcast/src/main/java/com/hazelcast/map/impl/MapService.java", "diffHunk": "@@ -321,6 +323,19 @@ public void provideDynamicMetrics(MetricDescriptor descriptor, MetricsCollection\n                         .withDiscriminator(MAP_DISCRIMINATOR_NAME, mapName);\n                 context.collect(nearCacheDescriptor, nearCacheStats);\n             }\n+\n+        }\n+        // stats of offloaded-entry-processor's executor\n+        ExecutorStats executorStats = mapServiceContext.getOffloadedEntryProcessorExecutorStats();\n+        if (executorStats.hasStats()) {\n+            Iterable<? extends Map.Entry<String, LocalExecutorStatsImpl>> entries = executorStats.entrySet();\n+            for (Map.Entry<String, LocalExecutorStatsImpl> entry : entries) {\n+                MetricDescriptor nearCacheDescriptor = descriptor", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNjUzOA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475536538", "bodyText": "Missing value for the statistics-enabled for this and executor-service. Also, I couldn't find an entry for the durable-executor-service in this file. Maybe we could add those", "author": "mdumandag", "createdAt": "2020-08-24T11:34:23Z", "path": "hazelcast/src/main/resources/hazelcast-default.yaml", "diffHunk": "@@ -108,6 +108,12 @@ hazelcast:\n       # Queue capacity. 0 means Integer.MAX_VALUE.\n       queue-capacity: 0\n \n+  scheduled-executor-service:\n+    default:\n+      capacity: 100\n+      durability: 1\n+      pool-size: 16\n+", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0MzQzMQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743431", "bodyText": "done.", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNjUzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMyNTkzOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476325939", "bodyText": "statistics-enabled: true is still missing for the executor-service element", "author": "mdumandag", "createdAt": "2020-08-25T09:52:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNjUzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMzNzA3NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476337074", "bodyText": "should be fixed now.", "author": "ahmetmircik", "createdAt": "2020-08-25T10:12:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNjUzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNzc2Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475537767", "bodyText": "Similar comments for the hazelcast-default.yaml", "author": "mdumandag", "createdAt": "2020-08-24T11:37:04Z", "path": "hazelcast/src/main/resources/hazelcast-default.xml", "diffHunk": "@@ -116,6 +116,12 @@\n         <!--Queue capacity. 0 means Integer.MAX_VALUE.-->\n         <queue-capacity>0</queue-capacity>\n     </executor-service>\n+    <scheduled-executor-service name=\"default\">", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0MzM1Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743357", "bodyText": "done.", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNzc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMyNjgxNA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476326814", "bodyText": "<statistics-enabled>true</statistics-enabled> is missing fot the <executor-service name=\"default\">", "author": "mdumandag", "createdAt": "2020-08-25T09:54:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNzc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMzNjc2MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476336760", "bodyText": "i hope it is fixed now.", "author": "ahmetmircik", "createdAt": "2020-08-25T10:12:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzNzc2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU2OTM2NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475569365", "bodyText": "By the way, if I am not missing something, the canceled task count is only incremented for ExecutorService. For these two, does this metric mean anything?", "author": "mdumandag", "createdAt": "2020-08-24T12:41:00Z", "path": "docs/design/executors/01-executor-service-stats.md", "diffHunk": "@@ -0,0 +1,100 @@\n+# Scheduled and Durable Executor Service Statistics\n+\n+|\u2139\ufe0f Since: 4.1|\n+|-------------|\n+\n+## Background\n+\n+### Description\n+\n+Hazelcast has 3 different executor service implementations exposed with \n+public api. These three different types of executor services are called\n+as executor service, scheduled executor service and durable executor \n+service. Only executor type which has statistics available \n+among these is executor service. Statistics collection is not done for \n+scheduled and durable ones.\n+\n+\n+## Design\n+\n+In this design, we make same statistics with executor service available \n+for the other executor types. These statistics are only available for\n+monitoring from management center. The statistics we have currently is \n+represented with class `LocalExecutorStats`.\n+\n+```\n+public interface LocalExecutorStats extends LocalInstanceStats {\n+\n+    /**\n+     * Returns the number of pending operations on the executor service.\n+     *\n+     * @return the number of pending operations on the executor service\n+     */\n+    long getPendingTaskCount();\n+\n+    /**\n+     * Returns the number of started operations on the executor service.\n+     *\n+     * @return the number of started operations on the executor service\n+     */\n+    long getStartedTaskCount();\n+\n+    /**\n+     * Returns the number of completed operations on the executor service.\n+     *\n+     * @return the number of completed operations on the executor service\n+     */\n+    long getCompletedTaskCount();\n+\n+    /**\n+     * Returns the number of cancelled operations on the executor service.\n+     *\n+     * @return the number of cancelled operations on the executor service\n+     */\n+    long getCancelledTaskCount();", "originalCommit": "abb233f88b7773280640326186c58e889871ded5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc0MzI5OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r475743299", "bodyText": "good catch, i have added it to scheduled one, not sure about durable one leaving it as TODO for now.", "author": "ahmetmircik", "createdAt": "2020-08-24T16:34:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU2OTM2NQ=="}], "type": "inlineReview"}, {"oid": "8009720db2d968d95793fbed597e861ad5ad53c1", "url": "https://github.com/hazelcast/hazelcast/commit/8009720db2d968d95793fbed597e861ad5ad53c1", "message": "Address review comments", "committedDate": "2020-08-24T16:33:52Z", "type": "forcePushed"}, {"oid": "f20fe2ab8451ded1bfb9f13b60a50c7b685b2c48", "url": "https://github.com/hazelcast/hazelcast/commit/f20fe2ab8451ded1bfb9f13b60a50c7b685b2c48", "message": "Address review comments", "committedDate": "2020-08-24T16:43:02Z", "type": "forcePushed"}, {"oid": "8e4f513765f6c0229000febee0570c1bcdf75dd2", "url": "https://github.com/hazelcast/hazelcast/commit/8e4f513765f6c0229000febee0570c1bcdf75dd2", "message": "Address Metin's review comments", "committedDate": "2020-08-25T10:11:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwOTU4MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476409580", "bodyText": "IMHO TODO's rarely get fixed (check out how many we already have). Either add the stats, or open a GH issue, or just conclude it's not worth the hassle and remove the TODO.", "author": "mmedenjak", "createdAt": "2020-08-25T12:29:03Z", "path": "hazelcast/src/main/java/com/hazelcast/durableexecutor/impl/DurableExecutorServiceProxy.java", "diffHunk": "@@ -277,6 +271,7 @@ protected void throwNotActiveException() {\n             InternalCompletableFuture<T> completedFuture = completedExceptionally(t.getCause());\n             return new DurableExecutorServiceDelegateFuture<T>(completedFuture, serializationService, null, -1);\n         } catch (CancellationException e) {\n+            // TODO add cancellation stats?", "originalCommit": "a4a9be2d1e9453e8a1d42518b8c424f6bcd6d587", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5Mjc1Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476492756", "bodyText": "Removed TODO. I have learned cancellation is not supported for durable executor. Added this to TDD.", "author": "ahmetmircik", "createdAt": "2020-08-25T14:27:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwOTU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQyODIwNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476428207", "bodyText": "Remove With", "author": "mmedenjak", "createdAt": "2020-08-25T12:58:40Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/monitor/impl/MemberStateImpl.java", "diffHunk": "@@ -495,6 +515,8 @@ public String toString() {\n                 + \", reliableTopicsWithStats=\" + reliableTopicsWithStats\n                 + \", pnCountersWithStats=\" + pnCountersWithStats\n                 + \", executorsWithStats=\" + executorsWithStats\n+                + \", scheduledExecutorsWithStats=\" + scheduledExecutorsWithStats", "originalCommit": "fa1e6eff8768c255028a0cb2a9ef346ab0961d12", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ2OTUwNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476469507", "bodyText": "kept it aligned with others.", "author": "ahmetmircik", "createdAt": "2020-08-25T13:57:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQyODIwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzMzg0OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476433849", "bodyText": "Update these lines if you update the metric name.", "author": "mmedenjak", "createdAt": "2020-08-25T13:07:38Z", "path": "docs/design/executors/02-offloaded-entry-processor-executor-stats.md", "diffHunk": "@@ -0,0 +1,92 @@\n+# Offloaded Entry Processor Executor Statistics\n+\n+|\u2139\ufe0f Since: 4.1|\n+|-------------|\n+\n+## Background\n+\n+### Description\n+\n+Offloaded entry processors are not executed by regular operation threads.\n+As its name suggests, they offloaded to a different pool of threads and \n+executed by them. But the executor of these offloaded entry processors\n+has no statistics available.\n+\n+\n+## Design\n+\n+In this design, we collect statistics for offloaded entry processor executors. \n+We use same `LocalExecutorStats` with other executors in Hazelcast.\n+\n+```\n+public interface LocalExecutorStats extends LocalInstanceStats {\n+\n+    /**\n+     * Returns the number of pending operations on the executor service.\n+     *\n+     * @return the number of pending operations on the executor service\n+     */\n+    long getPendingTaskCount();\n+\n+    /**\n+     * Returns the number of started operations on the executor service.\n+     *\n+     * @return the number of started operations on the executor service\n+     */\n+    long getStartedTaskCount();\n+\n+    /**\n+     * Returns the number of completed operations on the executor service.\n+     *\n+     * @return the number of completed operations on the executor service\n+     */\n+    long getCompletedTaskCount();\n+\n+    /**\n+     * Returns the number of cancelled operations on the executor service.\n+     *\n+     * @return the number of cancelled operations on the executor service\n+     */\n+    long getCancelledTaskCount();\n+\n+    /**\n+     * Returns the total start latency of operations started.\n+     *\n+     * @return the total start latency of operations started\n+     */\n+    long getTotalStartLatency();\n+\n+    /**\n+     * Returns the total execution time of operations finished.\n+     *\n+     * @return the total execution time of operations finished\n+     */\n+    long getTotalExecutionLatency();\n+}\n+```\n+\n+On submit of each offloadable entry processor, we start to collect the statistics and\n+with metrics subsystem, we made these available to management center.\n+In `MapService` we have `DynamicMetricsProvider` interface implementation\n+and offloaded executor stats are added there too. Statistics are available by default,\n+they can be disabled via `MapConfig`.\n+ \n+### Metrics Prefixes\n+`map.entry.processor.offloadable.executor` prefix is used for offloaded executor.\n+\n+### Example Output\n+```\n+[name=STATS_OFFLOADED_EXECUTOR,unit=ms,metric=map.entry.processor.offloadable.executor.creationTime]=1598017099308", "originalCommit": "fa1e6eff8768c255028a0cb2a9ef346ab0961d12", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ2OTU0OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17253#discussion_r476469549", "bodyText": "Left it as is.", "author": "ahmetmircik", "createdAt": "2020-08-25T13:57:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzMzg0OQ=="}], "type": "inlineReview"}, {"oid": "77620103a8e4cd46e69e568ab3c8468e995a167c", "url": "https://github.com/hazelcast/hazelcast/commit/77620103a8e4cd46e69e568ab3c8468e995a167c", "message": "Add durable, scheduler and offloded executor stats", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "8093b4c3d6be1c9766187bb311648da3d1ba33bd", "url": "https://github.com/hazelcast/hazelcast/commit/8093b4c3d6be1c9766187bb311648da3d1ba33bd", "message": "Add TDD docs", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "6854fe2978781fa1518c0bdfce16ab876c83125b", "url": "https://github.com/hazelcast/hazelcast/commit/6854fe2978781fa1518c0bdfce16ab876c83125b", "message": "Add missing configs", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "ebd0d62330b197710861b2c51cfcacacd43db7d7", "url": "https://github.com/hazelcast/hazelcast/commit/ebd0d62330b197710861b2c51cfcacacd43db7d7", "message": "Address Matko's comments", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "51bbcf19f08def29532e4631c96246179a3294fa", "url": "https://github.com/hazelcast/hazelcast/commit/51bbcf19f08def29532e4631c96246179a3294fa", "message": "Add tests", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "319c73fa90abeb0864d5a3dbdd76d89b0b92bd0c", "url": "https://github.com/hazelcast/hazelcast/commit/319c73fa90abeb0864d5a3dbdd76d89b0b92bd0c", "message": "enhance TDD", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "6be7518f3a0ddd02fcbc4963b420f8f2a548c0da", "url": "https://github.com/hazelcast/hazelcast/commit/6be7518f3a0ddd02fcbc4963b420f8f2a548c0da", "message": "Add client protocol changes for statsEnabled parameter", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "e6f40109146f7f5a9bb45fa2231fb27d868bbddd", "url": "https://github.com/hazelcast/hazelcast/commit/e6f40109146f7f5a9bb45fa2231fb27d868bbddd", "message": "Address review comments", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "db79eaa99cee7348d8def811cd4183a827a4d2b1", "url": "https://github.com/hazelcast/hazelcast/commit/db79eaa99cee7348d8def811cd4183a827a4d2b1", "message": "Address Metin's review comments", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "6f32e882719a4bdfc2ab1a85e71dec96aa63e314", "url": "https://github.com/hazelcast/hazelcast/commit/6f32e882719a4bdfc2ab1a85e71dec96aa63e314", "message": "Checkstyle fix", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "030b12515232e7d8e8673855dec64852391ca7c1", "url": "https://github.com/hazelcast/hazelcast/commit/030b12515232e7d8e8673855dec64852391ca7c1", "message": "Removed TODO", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "0e30382ddb6285521acbbba94df6f74ba8733c40", "url": "https://github.com/hazelcast/hazelcast/commit/0e30382ddb6285521acbbba94df6f74ba8733c40", "message": "Removed TODO & polishin", "committedDate": "2020-08-25T14:26:38Z", "type": "commit"}, {"oid": "0e30382ddb6285521acbbba94df6f74ba8733c40", "url": "https://github.com/hazelcast/hazelcast/commit/0e30382ddb6285521acbbba94df6f74ba8733c40", "message": "Removed TODO & polishin", "committedDate": "2020-08-25T14:26:38Z", "type": "forcePushed"}, {"oid": "d474155bd4c497855519ee0971fe9fd8cfd5e4b0", "url": "https://github.com/hazelcast/hazelcast/commit/d474155bd4c497855519ee0971fe9fd8cfd5e4b0", "message": "fix test failure", "committedDate": "2020-08-25T17:12:17Z", "type": "commit"}, {"oid": "345c68915b74ec5124c93041657f261b9a25b95b", "url": "https://github.com/hazelcast/hazelcast/commit/345c68915b74ec5124c93041657f261b9a25b95b", "message": "fix test failure", "committedDate": "2020-08-25T19:17:47Z", "type": "commit"}]}