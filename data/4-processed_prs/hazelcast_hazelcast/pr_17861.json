{"pr_number": 17861, "pr_title": "[FORWARD PORT] Fixes for compatibility tests", "pr_createdAt": "2020-11-19T16:22:17Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17861", "timeline": [{"oid": "d130e9a75abafd094cce4825164029bb2dd1551b", "url": "https://github.com/hazelcast/hazelcast/commit/d130e9a75abafd094cce4825164029bb2dd1551b", "message": "Fixes for compatibility tests (#17760)\n\n* Do not reference CacheEntryEvents which do not matter\r\n\r\nIn SimpleEntryListener for tests, we only care about\r\ncounting the number of events. Referencing each\r\nCacheEntryEvent breaks compatibility tests due to\r\ncurrent inability to reference CacheEntryEvents\r\nacross classloaders. So instead of performing a\r\nfor-each loop, we just use the iterator interface and\r\nincrement the respective counters.\r\n\r\n* Moves agent implementation to hazelcast-build-utils\r\nWhen the FinalRemovalAgent is attached at runtime,\r\nit is possible that some classes may have already been\r\nloaded, resulting in random test failures in\r\ncompatibility tests. The hazelcast-build-utils\r\nartifact declares the agent in its manifest\r\nso it can be used with java -javaagent on the\r\ncommand line.\r\n\r\n* Adds AbstractInvocationFuture#join to final methods\r\nfor processing by FinalRemovalAgent.\r\n\r\n\r\nCo-authored-by: Sergey Sitnikov <serge.sitnikov@gmail.com>", "committedDate": "2020-11-18T16:39:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzczOTkxMg==", "url": "https://github.com/hazelcast/hazelcast/pull/17861#discussion_r527739912", "bodyText": "maybe it is better to throw exception if items contains duplicate elements?", "author": "ahmetmircik", "createdAt": "2020-11-20T14:46:15Z", "path": "hazelcast-build-utils/src/main/java/com/hazelcast/buildutils/FinalRemovalAgent.java", "diffHunk": "@@ -89,10 +93,15 @@ public static void attachFinalRemovalAgent() {\n         if (FINAL_METHODS.containsKey(typeName)) {\n             for (String methodName : FINAL_METHODS.get(typeName)) {\n                 builder = builder.visit(new ModifierAdjustment()\n-                                .withMethodModifiers(named(methodName), MethodManifestation.PLAIN)\n+                        .withMethodModifiers(named(methodName), MethodManifestation.PLAIN)\n                 );\n             }\n         }\n         return builder;\n     }\n+\n+    public static <T> Set<T> setOf(T... items) {\n+        List<T> list = Arrays.asList(items);\n+        return new HashSet<T>(list);", "originalCommit": "d130e9a75abafd094cce4825164029bb2dd1551b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4NDcyMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17861#discussion_r527784720", "bodyText": "done", "author": "vbekiaris", "createdAt": "2020-11-20T15:52:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzczOTkxMg=="}], "type": "inlineReview"}, {"oid": "7b4bab4987dc46c97b1efe0cec2a1c0f1d46ce14", "url": "https://github.com/hazelcast/hazelcast/commit/7b4bab4987dc46c97b1efe0cec2a1c0f1d46ce14", "message": "Address review comment", "committedDate": "2020-11-20T15:52:26Z", "type": "commit"}]}