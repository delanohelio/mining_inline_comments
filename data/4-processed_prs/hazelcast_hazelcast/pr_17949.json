{"pr_number": 17949, "pr_title": "Fix broken sources produced by the \"shade\" plugin", "pr_createdAt": "2020-12-09T08:30:57Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17949", "timeline": [{"oid": "641c9f9362264b14c6082d5ee4fde9d682b5606c", "url": "https://github.com/hazelcast/hazelcast/commit/641c9f9362264b14c6082d5ee4fde9d682b5606c", "message": "Fix broken sources produced by the \"shade\" plugin", "committedDate": "2020-12-09T08:22:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIxOTY5Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17949#discussion_r539219692", "bodyText": "IIUC, this relocation now solves them all for https://mvnrepository.com/artifact/com.hazelcast/hazelcast-all/4.1\n\nDefect DetectionLGPL | \u00a0 | com.google.code.findbugs\u00a0\u00bb\u00a0annotations\u00a0(optional) | 3.0.1u2 | 3.0.1\n-- | -- | -- | -- | --\nCache ClientApache 2.0 | \u00a0 | javax.cache\u00a0\u00bb\u00a0cache-api\u00a0(optional) | 1.1.1 | \u2714\nLoggingApache 2.0 | \u00a0 | log4j\u00a0\u00bb\u00a0log4j\u00a0(optional) | 1.2.17 | 2.14.0\nApache 2.0 | \u00a0 | net.openhft\u00a0\u00bb\u00a0affinity\u00a0(optional) | 3.2.3 | 3.20.0\nLoggingApache 2.0 | \u00a0 | org.apache.logging.log4j\u00a0\u00bb\u00a0log4j-api\u00a0(optional) | 2.13.3 | 2.14.0\nLoggingApache 2.0 | \u00a0 | org.apache.logging.log4j\u00a0\u00bb\u00a0log4j-core\u00a0(optional) | 2.13.3 | 2.14.0\nJVM LanguagesApache 2.0 | \u00a0 | org.codehaus.groovy\u00a0\u00bb\u00a0groovy-all\u00a0(optional) | 2.1.8 | 3.0.7\nJVM LanguagesEPL 2.0GPL 2.0LGPL 2.1 | \u00a0 | org.jruby\u00a0\u00bb\u00a0jruby-complete\u00a0(optional) | 1.7.22 | 9.2.13.0\nOSGIApache 2.0 | \u00a0 | org.osgi\u00a0\u00bb\u00a0org.osgi.core\u00a0(optional) | 4.2.0 | 6.0.0\nLoggingMIT | \u00a0 | org.slf4j\u00a0\u00bb\u00a0slf4j-api\u00a0(optional) | 1.7.30 | \u2714\n\n\n\nis it correct?", "author": "lazerion", "createdAt": "2020-12-09T11:15:18Z", "path": "hazelcast-sql/pom.xml", "diffHunk": "@@ -91,16 +91,39 @@\n                                 </excludes>\n                             </artifactSet>\n                             <relocations>\n+                                <!--\n+                                    List relocations for every product explicitly, instead of definining \"com\" and \"org\"\n+                                    wildcards. Otherwise, the \"shade\" plugin breaks the generated source code. For example,\n+                                    for the wildcard \"com.\" the package \"com.google.common\" is replaced with the shaded\n+                                    pattern twice: \"[com].google.[com]mon\".\n+                                 -->\n                                 <relocation>\n-                                    <pattern>com.</pattern>\n-                                    <shadedPattern>${relocation.root}.com.</shadedPattern>\n-                                    <excludes>\n-                                        <exclude>com.hazelcast.**</exclude>\n-                                    </excludes>\n+                                    <pattern>com.fasterxml</pattern>", "originalCommit": "641c9f9362264b14c6082d5ee4fde9d682b5606c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIyODExNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17949#discussion_r539228117", "bodyText": "Sorry, I didn't get the question, could you please elaborate?", "author": "devozerov", "createdAt": "2020-12-09T11:28:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIxOTY5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI0NjU1Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17949#discussion_r539246553", "bodyText": "Could you check Compile Dependencies (10) under this page https://mvnrepository.com/artifact/com.hazelcast/hazelcast-all/4.1?\nIt is 0 for https://mvnrepository.com/artifact/com.hazelcast/hazelcast-all/4.0.3 latest release before introducing sql. Therefore, we expect them to be 0 as well with these changes. I think it is also verified with this test https://github.com/hazelcast/hazelcast/blob/master/hazelcast-all/src/test/java/com/hazelcast/it/DependencyReducedPomAllIT.java, IIUC, this test is also passing in your branch.\nhope it clears now.", "author": "lazerion", "createdAt": "2020-12-09T11:58:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIxOTY5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMwNjg3Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17949#discussion_r539306876", "bodyText": "BTW, sorry if I miss some context here, because, I joined as ad-hoc.", "author": "lazerion", "createdAt": "2020-12-09T13:30:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIxOTY5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM0NTIxMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17949#discussion_r539345210", "bodyText": "I've just double-checked the produced pom.xml file - it has exactly the same dependencies as before the fix. So the PR should be safe to merge.", "author": "devozerov", "createdAt": "2020-12-09T14:20:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIxOTY5Mg=="}], "type": "inlineReview"}]}