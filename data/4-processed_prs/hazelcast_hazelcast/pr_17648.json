{"pr_number": 17648, "pr_title": "Refactoring client deregister listener behaviour", "pr_createdAt": "2020-09-30T11:27:48Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17648", "timeline": [{"oid": "52bc0b70fd507bb61b4e78b9bbd404ea1b31e220", "url": "https://github.com/hazelcast/hazelcast/commit/52bc0b70fd507bb61b4e78b9bbd404ea1b31e220", "message": "Refactoring client deregister listener behaviour\n\nWe were returning `false` as the return value if we were not\nsuccessuflly deregister from any member and events was able to\ncontinue to delivered for non deregistered members.\n\nWe have changed the behaviour so that we return `true` if a\nregistration is found always. And after this point, user will not\nget any event. We will cleanup all the local handlers right away\nto make sure of that.\n\nSecondly we have set invocation timeout as infinite so that the\nderegistartion from a connection is retried as long as the\nconnection is there until it is succesful.\n\nI have left logging the exception when there is an unexpected\nfailure. We do not expect any but this is to be able to diagnose\nif the unexpected happens.\n\n(cherry picked from commit 54da2f065830e235e78e206236323e19ab317e25)", "committedDate": "2020-09-30T11:40:46Z", "type": "forcePushed"}, {"oid": "a402f4bfe3635e0aefae2095c5c23a3718b8cd45", "url": "https://github.com/hazelcast/hazelcast/commit/a402f4bfe3635e0aefae2095c5c23a3718b8cd45", "message": "Refactoring client deregister listener behaviour\n\nWe were returning `false` as the return value if we were not\nsuccessuflly deregister from any member and events was able to\ncontinue to delivered for non deregistered members.\n\nWe have changed the behaviour so that we return `true` if a\nregistration is found always. And after this point, user will not\nget any event. We will cleanup all the local handlers right away\nto make sure of that.\n\nSecondly we have set invocation timeout as infinite so that the\nderegistartion from a connection is retried as long as the\nconnection is there until it is succesful.\n\nI have left logging the exception when there is an unexpected\nfailure. We do not expect any but this is to be able to diagnose\nif the unexpected happens.\n\n(cherry picked from commit 54da2f065830e235e78e206236323e19ab317e25)", "committedDate": "2020-09-30T14:35:02Z", "type": "forcePushed"}, {"oid": "03b6453a04108020e64c35d44d9f68b708da662c", "url": "https://github.com/hazelcast/hazelcast/commit/03b6453a04108020e64c35d44d9f68b708da662c", "message": "Refactoring client deregister listener behaviour\n\nWe were returning `false` as the return value if we were not\nsuccessuflly deregister from any member and events was able to\ncontinue to delivered for non deregistered members.\n\nWe have changed the behaviour so that we return `true` if a\nregistration is found always. And after this point, user will not\nget any event. We will cleanup all the local handlers right away\nto make sure of that.\n\nSecondly we have set invocation timeout as infinite so that the\nderegistartion from a connection is retried as long as the\nconnection is there until it is succesful.\n\nI have left logging the exception when there is an unexpected\nfailure. We do not expect any but this is to be able to diagnose\nif the unexpected happens.\n\n(cherry picked from commit 54da2f065830e235e78e206236323e19ab317e25)", "committedDate": "2020-09-30T14:46:17Z", "type": "commit"}, {"oid": "03b6453a04108020e64c35d44d9f68b708da662c", "url": "https://github.com/hazelcast/hazelcast/commit/03b6453a04108020e64c35d44d9f68b708da662c", "message": "Refactoring client deregister listener behaviour\n\nWe were returning `false` as the return value if we were not\nsuccessuflly deregister from any member and events was able to\ncontinue to delivered for non deregistered members.\n\nWe have changed the behaviour so that we return `true` if a\nregistration is found always. And after this point, user will not\nget any event. We will cleanup all the local handlers right away\nto make sure of that.\n\nSecondly we have set invocation timeout as infinite so that the\nderegistartion from a connection is retried as long as the\nconnection is there until it is succesful.\n\nI have left logging the exception when there is an unexpected\nfailure. We do not expect any but this is to be able to diagnose\nif the unexpected happens.\n\n(cherry picked from commit 54da2f065830e235e78e206236323e19ab317e25)", "committedDate": "2020-09-30T14:46:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE4MzczMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17648#discussion_r498183730", "bodyText": "nit: the heading comma should be moved to the previous line", "author": "puzpuzpuz", "createdAt": "2020-10-01T11:50:35Z", "path": "hazelcast-client/src/test/java/com/hazelcast/client/listeners/leak/ListenerLeakTest.java", "diffHunk": "@@ -80,12 +80,17 @@ public void cleanup() {\n         hazelcastFactory.terminateAll();\n     }\n \n-    private void assertNoLeftOver(Collection<Node> nodes, HazelcastInstance client, String id\n-            , Collection<ClientEventRegistration> registrations) {\n-        for (Node node : nodes) {\n-            assertNoLeftOverOnNode(node, registrations);\n-        }\n-        assertEquals(0, getClientEventRegistrations(client, id).size());\n+    private void assertNoLeftOver(final Collection<Node> nodes, final HazelcastInstance client, final String id\n+            , final Collection<ClientEventRegistration> registrations) {", "originalCommit": "03b6453a04108020e64c35d44d9f68b708da662c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "57d9770d93521a4772360fbab10a32f7b55e5cd5", "url": "https://github.com/hazelcast/hazelcast/commit/57d9770d93521a4772360fbab10a32f7b55e5cd5", "message": "addressing review comments\n\n(cherry picked from commit 315e001a58a22b2387a7e0185d36adad0a8130bf)", "committedDate": "2020-10-01T13:43:45Z", "type": "commit"}]}