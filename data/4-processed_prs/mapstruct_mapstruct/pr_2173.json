{"pr_number": 2173, "pr_title": "#2169 Add support for defining a custom default exception for enum mapping", "pr_createdAt": "2020-08-02T11:29:11Z", "pr_url": "https://github.com/mapstruct/mapstruct/pull/2173", "timeline": [{"oid": "3766b06f65c0d6c5e1595ef58c6686a1273da57d", "url": "https://github.com/mapstruct/mapstruct/commit/3766b06f65c0d6c5e1595ef58c6686a1273da57d", "message": "#2169 Add support for defining a custom default exception for enum mapping", "committedDate": "2020-08-02T11:30:23Z", "type": "forcePushed"}, {"oid": "3212489951e61dd17fc5962754b9ec44d6fd81a9", "url": "https://github.com/mapstruct/mapstruct/commit/3212489951e61dd17fc5962754b9ec44d6fd81a9", "message": "#2169 Add support for defining a custom default exception for enum mapping", "committedDate": "2020-08-29T07:31:46Z", "type": "commit"}, {"oid": "dbcaaf792011214f9a3f19d64dc132120721887a", "url": "https://github.com/mapstruct/mapstruct/commit/dbcaaf792011214f9a3f19d64dc132120721887a", "message": "Rename EnumNamingStrategy to EnumMappingStrategy", "committedDate": "2020-08-29T07:31:46Z", "type": "commit"}, {"oid": "55847378f80e7f1ebb20df5c8fcbc90e2b5691fe", "url": "https://github.com/mapstruct/mapstruct/commit/55847378f80e7f1ebb20df5c8fcbc90e2b5691fe", "message": "Add default enum exception to Mapper and MapperConfig", "committedDate": "2020-08-29T07:31:46Z", "type": "commit"}, {"oid": "55847378f80e7f1ebb20df5c8fcbc90e2b5691fe", "url": "https://github.com/mapstruct/mapstruct/commit/55847378f80e7f1ebb20df5c8fcbc90e2b5691fe", "message": "Add default enum exception to Mapper and MapperConfig", "committedDate": "2020-08-29T07:31:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzMzk4Ng==", "url": "https://github.com/mapstruct/mapstruct/pull/2173#discussion_r479633986", "bodyText": "I know it is not part of this solution.. but I'm not happy with those methods coming from @BeanMapping.. I think they should be provided by @EnumMapping", "author": "sjaakd", "createdAt": "2020-08-29T10:11:33Z", "path": "processor/src/main/java/org/mapstruct/ap/internal/model/ValueMappingMethod.java", "diffHunk": "@@ -485,16 +500,28 @@ String getValue(ValueMappingOptions valueMapping) {\n     }\n \n     private ValueMappingMethod(Method method, List<MappingEntry> enumMappings, String nullTarget, String defaultTarget,\n-        boolean throwIllegalArgumentException, List<LifecycleCallbackMethodReference> beforeMappingMethods,\n+        Type defaultException,\n+        List<LifecycleCallbackMethodReference> beforeMappingMethods,", "originalCommit": "55847378f80e7f1ebb20df5c8fcbc90e2b5691fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNDMxNA==", "url": "https://github.com/mapstruct/mapstruct/pull/2173#discussion_r479634314", "bodyText": "the selectors are coming from BeanMapping indeed. I think that this is a good think for the 2.0 API overhauling. perhaps the qualifiers should go in their own annotation for this.", "author": "filiphr", "createdAt": "2020-08-29T10:15:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzMzk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNDM4Mw==", "url": "https://github.com/mapstruct/mapstruct/pull/2173#discussion_r479634383", "bodyText": "when you throw a checked exception.. shouldn't we check whether the method signature has defined such exception in the throws clause or do we leave this up to the compiler?", "author": "sjaakd", "createdAt": "2020-08-29T10:16:36Z", "path": "processor/src/test/resources/fixtures/org/mapstruct/ap/test/value/exception/CustomDefaultExceptionDefinedInMapperConfigImpl.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Copyright MapStruct Authors.\n+ *\n+ * Licensed under the Apache License version 2.0, available at http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.mapstruct.ap.test.value.exception;\n+\n+import javax.annotation.Generated;\n+import org.mapstruct.ap.test.value.CustomIllegalArgumentException;\n+import org.mapstruct.ap.test.value.ExternalOrderType;\n+import org.mapstruct.ap.test.value.OrderType;\n+\n+@Generated(\n+    value = \"org.mapstruct.ap.MappingProcessor\",\n+    date = \"2020-08-29T09:36:57+0200\",\n+    comments = \"version: , compiler: javac, environment: Java 11.0.2 (AdoptOpenJDK)\"\n+)\n+public class CustomDefaultExceptionDefinedInMapperConfigImpl implements CustomDefaultExceptionDefinedInMapperConfig {\n+\n+    @Override\n+    public ExternalOrderType withAnyUnmapped(OrderType orderType) {\n+        if ( orderType == null ) {\n+            return null;\n+        }\n+\n+        ExternalOrderType externalOrderType;\n+\n+        switch ( orderType ) {\n+            default: externalOrderType = ExternalOrderType.DEFAULT;\n+        }\n+\n+        return externalOrderType;\n+    }\n+\n+    @Override\n+    public ExternalOrderType withAnyRemaining(OrderType orderType) {\n+        if ( orderType == null ) {\n+            return null;\n+        }\n+\n+        ExternalOrderType externalOrderType;\n+\n+        switch ( orderType ) {\n+            case RETAIL: externalOrderType = ExternalOrderType.RETAIL;\n+            break;\n+            case B2B: externalOrderType = ExternalOrderType.B2B;\n+            break;\n+            default: externalOrderType = ExternalOrderType.DEFAULT;\n+        }\n+\n+        return externalOrderType;\n+    }\n+\n+    @Override\n+    public ExternalOrderType onlyWithMappings(OrderType orderType) {\n+        if ( orderType == null ) {\n+            return null;\n+        }\n+\n+        ExternalOrderType externalOrderType;\n+\n+        switch ( orderType ) {\n+            case EXTRA: externalOrderType = ExternalOrderType.SPECIAL;\n+            break;\n+            case STANDARD: externalOrderType = ExternalOrderType.DEFAULT;\n+            break;\n+            case NORMAL: externalOrderType = ExternalOrderType.DEFAULT;\n+            break;\n+            case RETAIL: externalOrderType = ExternalOrderType.RETAIL;\n+            break;\n+            case B2B: externalOrderType = ExternalOrderType.B2B;\n+            break;\n+            default: throw new CustomIllegalArgumentException( \"Unexpected enum constant: \" + orderType );", "originalCommit": "55847378f80e7f1ebb20df5c8fcbc90e2b5691fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNTI4Mg==", "url": "https://github.com/mapstruct/mapstruct/pull/2173#discussion_r479635282", "bodyText": "I say we leave it to the compiler. In the end you as a user defines the exception that you want to throw, so it is entirely in your hands.", "author": "filiphr", "createdAt": "2020-08-29T10:28:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNDM4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNDU0OQ==", "url": "https://github.com/mapstruct/mapstruct/pull/2173#discussion_r479634549", "bodyText": "we probably should mention that:\n\nThe exception should have an empty constructor\nThe exception (when checked) should be added to the method signature.", "author": "sjaakd", "createdAt": "2020-08-29T10:19:14Z", "path": "core/src/main/java/org/mapstruct/EnumMapping.java", "diffHunk": "@@ -111,13 +111,22 @@\n      *\n      * @return the name transformation strategy\n      */\n-    String nameTransformationStrategy();\n+    String nameTransformationStrategy() default \"\";\n \n     /**\n      * The configuration that should be passed on the appropriate name transformation strategy.\n      * e.g. a suffix that should be applied to the source enum when doing name based mapping.\n      *\n      * @return the configuration to use\n      */\n-    String configuration();\n+    String configuration() default \"\";\n+\n+    /**\n+     * Exception that should be thrown by the generated code if no mapping matches.", "originalCommit": "55847378f80e7f1ebb20df5c8fcbc90e2b5691fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNTMwMw==", "url": "https://github.com/mapstruct/mapstruct/pull/2173#discussion_r479635303", "bodyText": "I'll add that.", "author": "filiphr", "createdAt": "2020-08-29T10:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNDU0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNTYwMg==", "url": "https://github.com/mapstruct/mapstruct/pull/2173#discussion_r479635602", "bodyText": "great.. After that, you could merge the PR..", "author": "sjaakd", "createdAt": "2020-08-29T10:32:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNDU0OQ=="}], "type": "inlineReview"}, {"oid": "7c84c1a1c3264af8b320e83feb72ff6d89348c2a", "url": "https://github.com/mapstruct/mapstruct/commit/7c84c1a1c3264af8b320e83feb72ff6d89348c2a", "message": "Add info about the enum exception in the API", "committedDate": "2020-08-29T10:32:18Z", "type": "commit"}, {"oid": "d77a40f8fca39d0b313611237186a0c9ee201cb0", "url": "https://github.com/mapstruct/mapstruct/commit/d77a40f8fca39d0b313611237186a0c9ee201cb0", "message": "Use unexpectedValueMappingException in the API", "committedDate": "2020-08-29T10:55:37Z", "type": "commit"}]}