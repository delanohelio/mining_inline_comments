{"pr_number": 2629, "pr_title": "[all] Dependencies cleanup", "pr_createdAt": "2020-07-02T19:48:22Z", "pr_url": "https://github.com/pmd/pmd/pull/2629", "timeline": [{"oid": "43dd6567e2c14006570e90f0e8544818740c2926", "url": "https://github.com/pmd/pmd/commit/43dd6567e2c14006570e90f0e8544818740c2926", "message": "[java] Update test dependency log4j\n\nThis fixes https://github.com/advisories/GHSA-vwqq-5vrc-xw9h", "committedDate": "2020-07-02T08:13:08Z", "type": "commit"}, {"oid": "c7ccb8a087309cac5fa4ba7d60ef26fa3b1554d3", "url": "https://github.com/pmd/pmd/commit/c7ccb8a087309cac5fa4ba7d60ef26fa3b1554d3", "message": "javacc is only needed during parser generation", "committedDate": "2020-07-02T08:27:26Z", "type": "commit"}, {"oid": "80d9e1801155ac7ca1c35431c5283acb6b9f96b1", "url": "https://github.com/pmd/pmd/commit/80d9e1801155ac7ca1c35431c5283acb6b9f96b1", "message": "pmd-lang-test: clarify dependencies", "committedDate": "2020-07-02T12:16:39Z", "type": "commit"}, {"oid": "370c0b0b6d30adea1d0d49e156f0828f640cee2c", "url": "https://github.com/pmd/pmd/commit/370c0b0b6d30adea1d0d49e156f0828f640cee2c", "message": "Remove unused dependency, explicitly declare used dependencies", "committedDate": "2020-07-02T13:12:31Z", "type": "commit"}, {"oid": "373c9b09449a023e76b4e7640f7228b4c99942e2", "url": "https://github.com/pmd/pmd/commit/373c9b09449a023e76b4e7640f7228b4c99942e2", "message": "Fix scala library versions", "committedDate": "2020-07-02T18:30:54Z", "type": "commit"}, {"oid": "67f33e3427b61e94e07b4571b3652a6a41c30dad", "url": "https://github.com/pmd/pmd/commit/67f33e3427b61e94e07b4571b3652a6a41c30dad", "message": "Add back hamcrest (it's actually test-runtime)", "committedDate": "2020-07-02T19:00:43Z", "type": "commit"}, {"oid": "c24efea939c202ca7b0acea8809edbaa40f0a9a6", "url": "https://github.com/pmd/pmd/commit/c24efea939c202ca7b0acea8809edbaa40f0a9a6", "message": "Revert to use stable maven-dependency-plugin", "committedDate": "2020-07-02T19:41:19Z", "type": "commit"}, {"oid": "03d03440b41d47b4e69ebdef3b1964dde1c8a5f4", "url": "https://github.com/pmd/pmd/commit/03d03440b41d47b4e69ebdef3b1964dde1c8a5f4", "message": "Declare junit dependencies before kotlintest ones\n\nThis is for the scala modules. Apparently\nin the other order, only kotlin tests are\nrun.", "committedDate": "2020-07-06T11:25:54Z", "type": "commit"}, {"oid": "96998fffc2e21c41e0fd45bb2e8f2dcc1bd2094b", "url": "https://github.com/pmd/pmd/commit/96998fffc2e21c41e0fd45bb2e8f2dcc1bd2094b", "message": "Same for modelica", "committedDate": "2020-07-06T11:35:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxNjQ0Nw==", "url": "https://github.com/pmd/pmd/pull/2629#discussion_r453916447", "bodyText": "What's the reason of using such an old guava? (or should I ask 'what's the reason of using guava at all' :))", "author": "KroArtem", "createdAt": "2020-07-13T20:35:27Z", "path": "pom.xml", "diffHunk": "@@ -695,6 +702,26 @@\n                 <scope>test</scope>\n             </dependency>\n \n+            <dependency>\n+                <groupId>com.github.oowekyala.treeutils</groupId>\n+                <artifactId>tree-matchers</artifactId>\n+                <version>2.1.0</version>\n+                <scope>test</scope>\n+            </dependency>\n+            <dependency>\n+                <groupId>com.github.oowekyala.treeutils</groupId>\n+                <artifactId>tree-printers</artifactId>\n+                <version>2.1.0</version>\n+                <scope>test</scope>\n+            </dependency>\n+\n+            <dependency>\n+                <groupId>com.google.guava</groupId>\n+                <artifactId>guava</artifactId>\n+                <version>18.0</version>", "originalCommit": "96998fffc2e21c41e0fd45bb2e8f2dcc1bd2094b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5MDQ5Nw==", "url": "https://github.com/pmd/pmd/pull/2629#discussion_r455990497", "bodyText": "It's only used by pmd-apex-jorje - on master, it's already removed from the main parent pom.", "author": "adangel", "createdAt": "2020-07-16T18:32:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxNjQ0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxNzAxNw==", "url": "https://github.com/pmd/pmd/pull/2629#discussion_r453917017", "bodyText": "Just curious, why do you have both log4j and slf4j? I saw a ticket to unify logging but it was mostly about logging frameworks vs System.out.println/err", "author": "KroArtem", "createdAt": "2020-07-13T20:36:27Z", "path": "pmd-java/pom.xml", "diffHunk": "@@ -193,6 +165,71 @@\n             <artifactId>ant-testutil</artifactId>\n             <scope>test</scope>\n         </dependency>\n+\n+        <dependency>\n+            <groupId>com.github.oowekyala.treeutils</groupId>\n+            <artifactId>tree-matchers</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.github.oowekyala.treeutils</groupId>\n+            <artifactId>tree-printers</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.kotlintest</groupId>\n+            <artifactId>kotlintest-runner-junit5</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.kotlintest</groupId>\n+            <artifactId>kotlintest-assertions</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.kotlintest</groupId>\n+            <artifactId>kotlintest-core</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.google.guava</groupId>\n+            <artifactId>guava</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.jetbrains.kotlin</groupId>\n+            <artifactId>kotlin-stdlib</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.jetbrains.kotlin</groupId>\n+            <artifactId>kotlin-test</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.jetbrains</groupId>\n+            <artifactId>annotations</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+\n+        <!-- the following dependencies are there to support typeresolution in test cases -->\n+        <dependency>\n+            <groupId>org.slf4j</groupId>\n+            <artifactId>slf4j-api</artifactId>", "originalCommit": "96998fffc2e21c41e0fd45bb2e8f2dcc1bd2094b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5NTQ2Ng==", "url": "https://github.com/pmd/pmd/pull/2629#discussion_r455995466", "bodyText": "They're used to bring those classes on the classpath of tests, that use type resolution. This is a weird solution and we could possibly improve that, to avoid registering a dependency on them", "author": "oowekyala", "createdAt": "2020-07-16T18:41:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxNzAxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3MDI3Mg==", "url": "https://github.com/pmd/pmd/pull/2629#discussion_r456270272", "bodyText": "I've created #2649 - this sounds like a useful enhancement", "author": "adangel", "createdAt": "2020-07-17T07:33:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxNzAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk4Nzc2MA==", "url": "https://github.com/pmd/pmd/pull/2629#discussion_r455987760", "bodyText": "TODO: Add comment, that the order matters.", "author": "adangel", "createdAt": "2020-07-16T18:27:37Z", "path": "pmd-modelica/pom.xml", "diffHunk": "@@ -78,6 +78,27 @@\n             <artifactId>pmd-core</artifactId>\n         </dependency>\n \n+        <dependency>", "originalCommit": "96998fffc2e21c41e0fd45bb2e8f2dcc1bd2094b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk4ODU2Ng==", "url": "https://github.com/pmd/pmd/pull/2629#discussion_r455988566", "bodyText": "TODO: test adding these dependencies as plugin dependencies for surefire", "author": "adangel", "createdAt": "2020-07-16T18:28:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk4Nzc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM0ODE2MQ==", "url": "https://github.com/pmd/pmd/pull/2629#discussion_r456348161", "bodyText": "Ok, I figured out the problem now: If we have kotlintest-runner-junit5 as a dependency, this pulls in junit-platform 1.2.0, but for the junit-vintage-engine, we would need 1.5.x. Reversing the order, pulls in either junit-platform 1.2.x from kotlintest or junit-plaform 1.5.x from junit-vintage-engine. And surefire seems to need the newer version.\nThe correct way is, to define the two engines as plugin dependencies for surefire (see https://maven.apache.org/surefire/maven-surefire-plugin/examples/junit-platform.html), section \"JUnit4 API in test dependencies\": We have the Junit4 API (@Test, etc.) as a test-scope-dependency, but the engine is not available for tests - only for surefire, to run the tests.\nWe can add both kotlin and junit-vintage engines - but that only works with surefire-plugin 3+, so I've upgraded this plugin as well.\nWith that change, the order of the dependencies now doesn't matter anymore.\nRemoving kotlintest-runner-junit5 as a small issue: this not only provided the engine, but also part of the testing API (package io.kotlintest.specs), e.g. the base class FunSpec. This is now not longer available and I switched that to simply use AbstractFunSpec - which is available from io.kotlintest.core.\nI tried to update io.kotlintest, but there are some incompatibilites (something to to with suspend/coroutines in the test framework), so I stayed at 3.1.8.\nThe io.kotlintest framework has been renamed with version 4.x to kotest: https://github.com/kotest/kotest - the upgrade will take a bit more effort. But in that version, FunSpec would be available in the core module, and the runner really only contains the engine...\n@oowekyala : just FYI", "author": "adangel", "createdAt": "2020-07-17T10:04:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk4Nzc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU2MDUzMg==", "url": "https://github.com/pmd/pmd/pull/2629#discussion_r456560532", "bodyText": "Ok thanks for figuring this out! I'll open a ticket to track the kotest upgrade", "author": "oowekyala", "createdAt": "2020-07-17T16:55:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk4Nzc2MA=="}], "type": "inlineReview"}]}