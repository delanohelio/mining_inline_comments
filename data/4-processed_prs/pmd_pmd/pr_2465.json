{"pr_number": 2465, "pr_title": "[dependencies] Upgrade hamcrest, mockito and JUnit", "pr_createdAt": "2020-05-04T00:23:07Z", "pr_url": "https://github.com/pmd/pmd/pull/2465", "timeline": [{"oid": "3fba3f6217b827a7c51b9524c247f9c286731553", "url": "https://github.com/pmd/pmd/commit/3fba3f6217b827a7c51b9524c247f9c286731553", "message": "Update hamcrest to 2.2, Junit to 4.13, mockito to 2.28.2", "committedDate": "2020-05-04T20:00:28Z", "type": "commit"}, {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553", "url": "https://github.com/pmd/pmd/commit/3fba3f6217b827a7c51b9524c247f9c286731553", "message": "Update hamcrest to 2.2, Junit to 4.13, mockito to 2.28.2", "committedDate": "2020-05-04T20:00:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMwOTgwNA==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421309804", "bodyText": "Note: this has nothing to do with your change, but I'm wondering, why we didn't declare this dependency down below the section starting with comment <!-- TEST DEPENDENCIES -->? I think, mockito would be used only in scope test later on... likewise wiremock, system-rules and assertj-core...\nWould you mind to have a look at this as well?", "author": "adangel", "createdAt": "2020-05-07T07:54:50Z", "path": "pom.xml", "diffHunk": "@@ -664,8 +664,8 @@\n             </dependency>\n             <dependency>\n                 <groupId>org.mockito</groupId>\n-                <artifactId>mockito-all</artifactId>\n-                <version>1.10.19</version>\n+                <artifactId>mockito-core</artifactId>", "originalCommit": "3fba3f6217b827a7c51b9524c247f9c286731553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk4NTc5Mw==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r422985793", "bodyText": "Speaking about assertj, it seems to be used only in pmd-java module for tests. The rule JUnitTestsShouldIncludeAssertRule finds and checks whether soft assertion is an assertj one but it does it with TypeHelper.isA(variables.get(varName), \"org.assertj.core.api.AbstractSoftAssertions\"); this assertj doesn't seem to be needed as a compile dependency.", "author": "KroArtem", "createdAt": "2020-05-11T11:54:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMwOTgwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk5OTk4NA==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r422999984", "bodyText": "I've removed assertj from root pom as it's not used anywhere except pmd-java, also moved mockito, wiremock, system-rules under  and marked them with test scope", "author": "KroArtem", "createdAt": "2020-05-11T12:22:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMwOTgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyNTg2NA==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421325864", "bodyText": "Do we still need hamcrest-library? I thought, from 2.x on, everything is now in hamcrest?\nI think we should avoid using hamcrest-library altogether (and make sure to exclude both hamcrest-library and hamcrest-core from junit).\nWe don't need to add these old (empty) hamcrest-core/hamcrest-library dependencies, because we use exclusions. And then it should also make no difference whether hamcrest is defined before or after junit, because we pretend, that junit doesn't use hamcrest (via the excludes) - giving us the task of dependency management, to make sure, hamcrest is declared whenever junit is used.", "author": "adangel", "createdAt": "2020-05-07T08:22:14Z", "path": "pom.xml", "diffHunk": "@@ -720,16 +720,28 @@\n             </dependency>\n \n             <dependency>\n-                <groupId>junit</groupId>\n-                <artifactId>junit</artifactId>\n-                <version>4.12</version>\n+                <groupId>org.hamcrest</groupId>\n+                <artifactId>hamcrest</artifactId>\n+                <version>2.2</version>\n                 <scope>test</scope>\n             </dependency>\n             <dependency>\n                 <groupId>org.hamcrest</groupId>\n                 <artifactId>hamcrest-library</artifactId>", "originalCommit": "3fba3f6217b827a7c51b9524c247f9c286731553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjkzNjY0Ng==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r422936646", "bodyText": "The explanation at their site is vague and this comment also highlights it hamcrest/JavaHamcrest#224 (comment)\nI'll try to get rid of hamcrest-core/hamcrest-library.", "author": "KroArtem", "createdAt": "2020-05-11T10:18:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyNTg2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0Njc4OA==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r429146788", "bodyText": "FYI - I was using the explanation here: http://hamcrest.org/JavaHamcrest/distributables#maven-upgrade-example which says, what hamcrest-core and hamcrest-library actually is...", "author": "adangel", "createdAt": "2020-05-22T09:39:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyNTg2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyODA2NQ==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421328065", "bodyText": "also add\n                    <exclusion>\n                        <groupId>org.hamcrest</groupId>\n                        <artifactId>hamcrest-library</artifactId>\n                    </exclusion>", "author": "adangel", "createdAt": "2020-05-07T08:25:49Z", "path": "pom.xml", "diffHunk": "@@ -720,16 +720,28 @@\n             </dependency>\n \n             <dependency>\n-                <groupId>junit</groupId>\n-                <artifactId>junit</artifactId>\n-                <version>4.12</version>\n+                <groupId>org.hamcrest</groupId>\n+                <artifactId>hamcrest</artifactId>\n+                <version>2.2</version>\n                 <scope>test</scope>\n             </dependency>\n             <dependency>\n                 <groupId>org.hamcrest</groupId>\n                 <artifactId>hamcrest-library</artifactId>\n-                <version>1.3</version>\n+                <version>2.2</version>\n+            </dependency>\n+\n+            <dependency>\n+                <groupId>junit</groupId>\n+                <artifactId>junit</artifactId>\n+                <version>4.13</version>\n                 <scope>test</scope>\n+                <exclusions>\n+                    <exclusion>\n+                        <groupId>org.hamcrest</groupId>\n+                        <artifactId>hamcrest-core</artifactId>\n+                    </exclusion>", "originalCommit": "3fba3f6217b827a7c51b9524c247f9c286731553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNDg0Mg==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r422714842", "bodyText": "According to mvn dependency:tree there is no need to exclude hamcrest-library", "author": "KroArtem", "createdAt": "2020-05-10T23:16:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyODA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAwMDk5NA==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r423000994", "bodyText": "Based on your comment https://github.com/pmd/pmd/pull/2465/files#r421325864 I've removed hamcrest-library, hamcrest-core and also excluded them from junit", "author": "KroArtem", "createdAt": "2020-05-11T12:24:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyODA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzMzA4Mw==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r429133083", "bodyText": "ah, yes, I see: https://search.maven.org/artifact/junit/junit/4.13/jar junit has hamcrest-library only as a scope testing dependency.", "author": "adangel", "createdAt": "2020-05-22T09:10:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyODA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYzODE3MQ==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r429638171", "bodyText": "Yes, I believe, we had a little misunderstanding first. :)", "author": "KroArtem", "createdAt": "2020-05-24T13:43:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyODA2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyOTYxMw==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421329613", "bodyText": "Defining the hamcrest dependencies here explicitly is actually more correct than it was before: Since we use hamcrest directly - so we not only depend transitively but directly.", "author": "adangel", "createdAt": "2020-05-07T08:28:15Z", "path": "pmd-apex/pom.xml", "diffHunk": "@@ -64,7 +64,11 @@\n       <artifactId>saxon</artifactId>\n     </dependency>\n \n-\n+    <dependency>", "originalCommit": "3fba3f6217b827a7c51b9524c247f9c286731553", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzMDAzNQ==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421330035", "bodyText": "please use hamcrest instead of hamcrest-library", "author": "adangel", "createdAt": "2020-05-07T08:28:53Z", "path": "pmd-core/pom.xml", "diffHunk": "@@ -157,13 +157,13 @@\n             <scope>test</scope>\n         </dependency>\n         <dependency>\n-            <groupId>junit</groupId>\n-            <artifactId>junit</artifactId>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest-library</artifactId>", "originalCommit": "3fba3f6217b827a7c51b9524c247f9c286731553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAxNTIxMw==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r423015213", "bodyText": "done", "author": "KroArtem", "createdAt": "2020-05-11T12:50:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzMDAzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAzMjIxNg==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r423032216", "bodyText": "done", "author": "KroArtem", "createdAt": "2020-05-11T13:18:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzMDAzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzODU0Nw==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421338547", "bodyText": "Maybe we do not need to declare the dependency here - because we should get it transitively via pmd-test (see the comment there).\nCan you try this?\nIn general, we should declare the hamcrest dependency explicitly, if we use hamcrest matchers directly in our unit tests (instead of JUnit's Asserts).\nBtw. the JUnit's Assert is implemented internally by using hamcrest, so, if we don't have the hamcrest dependency at all, no Asserts will work.\nBut I think, that's ok - we will immediately see, when we have forgotten the dependency, because then we will have test failures.", "author": "adangel", "createdAt": "2020-05-07T08:42:39Z", "path": "pmd-cpp/pom.xml", "diffHunk": "@@ -73,7 +73,11 @@\n             <groupId>commons-io</groupId>\n             <artifactId>commons-io</artifactId>\n         </dependency>\n-\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>", "originalCommit": "3fba3f6217b827a7c51b9524c247f9c286731553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAzMjAyNw==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r423032027", "bodyText": "I've tried to remove dependencies in modules that have pmd-test but it didn't help: tests fail with\njava.lang.NoClassDefFoundError: org/hamcrest/SelfDescribing```\nthat clearly indicates that hamcrest was not resolved.", "author": "KroArtem", "createdAt": "2020-05-11T13:18:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzODU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzNzY2NQ==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r429137665", "bodyText": "I've tried it now - it works for me... Did you maybe execute the build for the module pmd-cpp in isolation without building pmd-test?", "author": "adangel", "createdAt": "2020-05-22T09:19:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzODU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0ODMwNA==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r429148304", "bodyText": "I'll remove these dependencies in the modules, which don't use hamcrest directly when merging", "author": "adangel", "createdAt": "2020-05-22T09:42:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzODU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYzODI0Mg==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r429638242", "bodyText": "Thanks! Yes, I think I indeed built the module pmd-cpp in isolation without building pmd-test! My fault", "author": "KroArtem", "createdAt": "2020-05-24T13:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzODU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM0ODg0MA==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421348840", "bodyText": "I think, that might actually be a solution: This hamcrest dependency here will become a transitive dependency for all the other modules, that depend on pmd-test (which should be all modules except for pmd-core).\nNote: while the scope here is compile (for pmd-test), it will be the scope test for the other modules, since pmd-test is included there as scope test.", "author": "adangel", "createdAt": "2020-05-07T08:58:31Z", "path": "pmd-test/pom.xml", "diffHunk": "@@ -12,6 +12,11 @@\n     </parent>\n \n     <dependencies>\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <scope>compile</scope>", "originalCommit": "3fba3f6217b827a7c51b9524c247f9c286731553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzA2MDAxNw==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r423060017", "bodyText": "Well, that didn't work. I've tried it locally as I wrote here. #2465 (comment)", "author": "KroArtem", "createdAt": "2020-05-11T13:59:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM0ODg0MA=="}], "type": "inlineReview"}, {"oid": "5053b7beb4f634c67a250986e0471b86ac0ba90a", "url": "https://github.com/pmd/pmd/commit/5053b7beb4f634c67a250986e0471b86ac0ba90a", "message": "review fixes: exclude hamcrest-library, hamcrest-core from junit, rm assertj-core from root pom, move mockito, wiremock and system-rules to test scope", "committedDate": "2020-05-11T12:25:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0MTcyNQ==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r429141725", "bodyText": "Note, this should be scope compile - see comment above in the pom file.... I'll change that before merging", "author": "adangel", "createdAt": "2020-05-22T09:28:15Z", "path": "pmd-lang-test/pom.xml", "diffHunk": "@@ -93,6 +93,11 @@\n              so that they are automatically available to users\n              of the pmd-lang-test module\n         -->\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <scope>test</scope>", "originalCommit": "5053b7beb4f634c67a250986e0471b86ac0ba90a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYzODI5Mg==", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r429638292", "bodyText": "Thanks!", "author": "KroArtem", "createdAt": "2020-05-24T13:44:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0MTcyNQ=="}], "type": "inlineReview"}]}