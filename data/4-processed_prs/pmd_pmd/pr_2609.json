{"pr_number": 2609, "pr_title": "[core] Deprecate support for List attributes with XPath 2.0", "pr_createdAt": "2020-06-20T12:57:48Z", "pr_url": "https://github.com/pmd/pmd/pull/2609", "timeline": [{"oid": "9c48ad1523d16a1ab1c7176245bc9f069e7fc6a8", "url": "https://github.com/pmd/pmd/commit/9c48ad1523d16a1ab1c7176245bc9f069e7fc6a8", "message": "[core] Deprecate support for List attributes with XPath 2.0\n\nFixes #2451", "committedDate": "2020-06-20T12:44:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMzMzMg==", "url": "https://github.com/pmd/pmd/pull/2609#discussion_r443233332", "bodyText": "I think we should mention that properties still support sequence types.", "author": "oowekyala", "createdAt": "2020-06-21T16:01:34Z", "path": "docs/pages/pmd/userdocs/extending/writing_xpath_rules.md", "diffHunk": "@@ -80,11 +80,16 @@ function from Java types to XDM types.\n |`String`         | `xs:string`\n |`Character`      | `xs:string`\n |`Enum<E>`        | `xs:string` (uses `Object::toString`)\n-|`List<E>`        | `conv(E)*` (a sequence type)\n+|`List<E>`        | `conv(E)*` (a sequence type) <br> \u26a0\ufe0f List support is deprecated with 6.25.0. See below.\n \n \n The same `conv` function is used to translate rule property values to XDM values.\n \n+{% include warning.html content=\"Support for attributes of type `List<E>` has been deprecated\n+with PMD 6.25.0 and will be removed completely with PMD 7. The reason is that newer Saxon\n+versions don't support sequences as attributes anymore. Lists are still possible in Java-based\n+rules but not with XPath.\" %}", "originalCommit": "9c48ad1523d16a1ab1c7176245bc9f069e7fc6a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzMzM5Mw==", "url": "https://github.com/pmd/pmd/pull/2609#discussion_r443233393", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            result = \"\";\n          \n          \n            \n                            result = DeprecatedAttribute.NO_REPLACEMENT;", "author": "oowekyala", "createdAt": "2020-06-21T16:02:20Z", "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/ast/xpath/Attribute.java", "diffHunk": "@@ -75,11 +75,16 @@ public String replacementIfDeprecated() {\n             return null;\n         } else {\n             DeprecatedAttribute annot = method.getAnnotation(DeprecatedAttribute.class);\n-            return annot != null\n+            String result = annot != null\n                    ? annot.replaceWith()\n                    : method.isAnnotationPresent(Deprecated.class)\n                      ? DeprecatedAttribute.NO_REPLACEMENT\n                      : null;\n+            if (result == null && List.class.isAssignableFrom(method.getReturnType())) {\n+                // Lists are generally deprecated, see #2451\n+                result = \"\";", "originalCommit": "9c48ad1523d16a1ab1c7176245bc9f069e7fc6a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c098936708d7bce3c465823132fdfa0c7249fe73", "url": "https://github.com/pmd/pmd/commit/c098936708d7bce3c465823132fdfa0c7249fe73", "message": "[core] Use DeprecatedAttribute.NO_REPLACEMENT for List attributes\n\nCo-authored-by: Cl\u00e9ment Fournier <clement.fournier76@gmail.com>", "committedDate": "2020-06-22T17:18:55Z", "type": "commit"}, {"oid": "6143163b640814ef744c6157907662c52188d446", "url": "https://github.com/pmd/pmd/commit/6143163b640814ef744c6157907662c52188d446", "message": "[doc] Multivalued rule properties are still supported for xpath 2.0.", "committedDate": "2020-06-22T17:25:33Z", "type": "commit"}]}