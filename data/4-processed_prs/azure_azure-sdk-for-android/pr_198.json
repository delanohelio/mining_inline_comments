{"pr_number": 198, "pr_title": "Unit testing azure-core interceptors", "pr_createdAt": "2020-02-22T08:04:38Z", "pr_url": "https://github.com/Azure/azure-sdk-for-android/pull/198", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAzMDk1OQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/198#discussion_r388030959", "bodyText": "Why can't we use ThreeTenApb in the tests?", "author": "bsiegel", "createdAt": "2020-03-05T01:26:25Z", "path": "build.gradle", "diffHunk": "@@ -122,6 +122,7 @@ allprojects {\n         retrofitVersion = \"2.6.2\"\n         staxApiVersion = \"1.0-2\"\n         threeTenAbpVersion = \"1.2.1\"\n+        threeTenBpVersion = \"1.4.0\"", "originalCommit": "ac07ce7a59a083bcacedb6a5dd34ef1ff3ab76d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYyMjc4Nw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/198#discussion_r388622787", "bodyText": "In short, because it uses Android APIs to obtain timezone data and we cannot make use of them when running unit tests. The README explains a bit more about it.\nIn case you want to see where I found about this solution, refer to this thread in the ThreeTenABP repository.", "author": "vcolin7", "createdAt": "2020-03-05T23:20:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAzMDk1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY0MjkxOA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/198#discussion_r388642918", "bodyText": "Thanks - that makes sense. How hard would it be to just stick with java.util.Date & co? We could make some utility functions that accept ThreeTenABP instances and convert them to work with Date. I know that API sucks but if it's not a TON of work it might be nice to avoid adding this dep (even if it's only for test).", "author": "bsiegel", "createdAt": "2020-03-06T00:27:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAzMDk1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDAyNzEzMA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/198#discussion_r390027130", "bodyText": "I don't think it would be too hard but we have some classes like DateTimeRfc1123 the where we still probably need to import this dependency for testing, which is what I'm doing right now on this PR.", "author": "vcolin7", "createdAt": "2020-03-10T00:07:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAzMDk1OQ=="}], "type": "inlineReview"}, {"oid": "c8832746092e3b73ffd26021fb78d1f09ef01ff1", "url": "https://github.com/Azure/azure-sdk-for-android/commit/c8832746092e3b73ffd26021fb78d1f09ef01ff1", "message": "Added tests for LogUtils and LogOptions.", "committedDate": "2020-03-11T23:21:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3NzY5OQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/198#discussion_r391477699", "bodyText": "We shouldn't unhide fields just so we can access them from tests. It ends up with our tests knowing too much about our internal structure of the code under test. When writing tests, it's okay to have some duplication rather than having to DRY up everything.", "author": "bsiegel", "createdAt": "2020-03-12T08:57:26Z", "path": "sdk/core/azure-core/src/main/java/com/azure/android/core/http/interceptor/AddDateInterceptor.java", "diffHunk": "@@ -20,12 +20,13 @@\n  * HTTP request.\n  */\n public class AddDateInterceptor implements Interceptor {\n-    private static final String DATE_HEADER = \"Date\";", "originalCommit": "c8832746092e3b73ffd26021fb78d1f09ef01ff1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1f88936965efe0008d29e5f20d4a8e730435d8d2", "url": "https://github.com/Azure/azure-sdk-for-android/commit/1f88936965efe0008d29e5f20d4a8e730435d8d2", "message": "Refactored requestIdHeaderIsPopulated() in RequestIdInterceptorTest to make it easier to read.", "committedDate": "2020-03-13T20:50:29Z", "type": "commit"}, {"oid": "d6252f5453fcb293db46fc7b1e5633f2519ebfce", "url": "https://github.com/Azure/azure-sdk-for-android/commit/d6252f5453fcb293db46fc7b1e5633f2519ebfce", "message": "Created a base class for all our interceptor tests that verify header content; also, created AddDateInterceptorTest which extends from this and made RequestIdInterceptorTest extend from it as well.", "committedDate": "2020-03-13T20:54:18Z", "type": "commit"}, {"oid": "6e116aca708790bb2c0efd57a0cf29672e465779", "url": "https://github.com/Azure/azure-sdk-for-android/commit/6e116aca708790bb2c0efd57a0cf29672e465779", "message": "Separated test utility methods from set-up logic.", "committedDate": "2020-03-13T20:55:12Z", "type": "commit"}, {"oid": "4dbfd678731431a3b418065c03562eccbcd7e4e4", "url": "https://github.com/Azure/azure-sdk-for-android/commit/4dbfd678731431a3b418065c03562eccbcd7e4e4", "message": "Got rid of inheritance in our interceptor tests.", "committedDate": "2020-03-13T20:57:16Z", "type": "commit"}, {"oid": "4d29f820307716fab64fdab5b34ad5eda4e5c77a", "url": "https://github.com/Azure/azure-sdk-for-android/commit/4d29f820307716fab64fdab5b34ad5eda4e5c77a", "message": "Added some more utility methods that will likely be used across our interceptor unit tests.", "committedDate": "2020-03-13T20:58:10Z", "type": "commit"}, {"oid": "d80e5ec30dd8123268b3ece76ee2853dd5b37a86", "url": "https://github.com/Azure/azure-sdk-for-android/commit/d80e5ec30dd8123268b3ece76ee2853dd5b37a86", "message": "Created UserAgentInterceptorTest.", "committedDate": "2020-03-13T21:08:46Z", "type": "commit"}, {"oid": "3e2a5d58b968c48b1c8289bcf312101e0daa2567", "url": "https://github.com/Azure/azure-sdk-for-android/commit/3e2a5d58b968c48b1c8289bcf312101e0daa2567", "message": "Made some formatting changes to our interceptor test classes and test utility class.", "committedDate": "2020-03-13T21:08:48Z", "type": "commit"}, {"oid": "a4898380ed4d1b35d03d19cfbca1f6669e4c4dd9", "url": "https://github.com/Azure/azure-sdk-for-android/commit/a4898380ed4d1b35d03d19cfbca1f6669e4c4dd9", "message": "Modified and added some tests to include changes made to the UserAgentInterceptor where the applicationId should be trimmed and truncated to follow the design guidelines.", "committedDate": "2020-03-13T21:09:45Z", "type": "commit"}, {"oid": "0852e4380da43555bcc3c83a60afcd608128d426", "url": "https://github.com/Azure/azure-sdk-for-android/commit/0852e4380da43555bcc3c83a60afcd608128d426", "message": "Created the EnqueueMockResponse TestRule since it is something we constantly need to set-up for many of our interceptor unit test. Reordered some of the code and rephrased some explanations in favor of clarity in unit tests.", "committedDate": "2020-03-13T21:09:47Z", "type": "commit"}, {"oid": "fb5df7d77d8df33cd1bc8d374102077084296899", "url": "https://github.com/Azure/azure-sdk-for-android/commit/fb5df7d77d8df33cd1bc8d374102077084296899", "message": "Created test classes for our logging interceptors and implemented a couple tests.", "committedDate": "2020-03-13T21:17:07Z", "type": "commit"}, {"oid": "7b03ec9f76fbddaa36b304c4e8c492a27ec6972d", "url": "https://github.com/Azure/azure-sdk-for-android/commit/7b03ec9f76fbddaa36b304c4e8c492a27ec6972d", "message": "Renamed the methods in our Date and Request ID interceptors to be more consistent.", "committedDate": "2020-03-13T21:17:18Z", "type": "commit"}, {"oid": "c9e0edc34c05702fc40f357e7293b48ea1bc0f69", "url": "https://github.com/Azure/azure-sdk-for-android/commit/c9e0edc34c05702fc40f357e7293b48ea1bc0f69", "message": "Added more test cases for the LoggingInterceptor.", "committedDate": "2020-03-13T21:18:46Z", "type": "commit"}, {"oid": "a23129b0d25fa4950ddc9c54d2947c03850422c1", "url": "https://github.com/Azure/azure-sdk-for-android/commit/a23129b0d25fa4950ddc9c54d2947c03850422c1", "message": "Added all remaining unit tests for the LoggingInterceptor.", "committedDate": "2020-03-13T21:20:09Z", "type": "commit"}, {"oid": "87568136858adf2c56984af2f936edafc4b222ac", "url": "https://github.com/Azure/azure-sdk-for-android/commit/87568136858adf2c56984af2f936edafc4b222ac", "message": "Added unit tests for the CurlLoggingInterceptor.", "committedDate": "2020-03-13T21:52:31Z", "type": "commit"}, {"oid": "dafddbc6af876f48435fb96669e0e90900ab82a8", "url": "https://github.com/Azure/azure-sdk-for-android/commit/dafddbc6af876f48435fb96669e0e90900ab82a8", "message": "Made slight changes to how we call methods in the Assert class to improve readability.", "committedDate": "2020-03-13T21:52:31Z", "type": "commit"}, {"oid": "eb385080614981b322b69caff53f00302bc44e65", "url": "https://github.com/Azure/azure-sdk-for-android/commit/eb385080614981b322b69caff53f00302bc44e65", "message": "Added tests for LogOptions.", "committedDate": "2020-03-13T21:52:31Z", "type": "commit"}, {"oid": "eb385080614981b322b69caff53f00302bc44e65", "url": "https://github.com/Azure/azure-sdk-for-android/commit/eb385080614981b322b69caff53f00302bc44e65", "message": "Added tests for LogOptions.", "committedDate": "2020-03-13T21:52:31Z", "type": "forcePushed"}]}