{"pr_number": 4999, "pr_title": "Issue 5852: Speed up build verification", "pr_createdAt": "2020-07-30T00:37:56Z", "pr_url": "https://github.com/pravega/pravega/pull/4999", "timeline": [{"oid": "8ae0239b44de370c5540d76ac65cdd30d3352983", "url": "https://github.com/pravega/pravega/commit/8ae0239b44de370c5540d76ac65cdd30d3352983", "message": "PR feedback\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-17T18:55:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTkxNTc2MA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595915760", "bodyText": "nit: typo.", "author": "shrids", "createdAt": "2021-03-17T11:04:30Z", "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/LocalController.java", "diffHunk": "@@ -157,9 +156,9 @@ public LocalController(ControllerService controller, boolean authorizationEnable\n             case FAILURE:\n                 throw new ControllerFailureException(\"Failed to createing stream: \" + streamConfig);", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "27b4f1073835ce5a8bc152ce357a851f093c5efe", "url": "https://github.com/pravega/pravega/commit/27b4f1073835ce5a8bc152ce357a851f093c5efe", "message": "PR feedback - fix typo\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-18T16:42:37Z", "type": "commit"}, {"oid": "18621313203fd879091c471e9a5aa5b612c1a515", "url": "https://github.com/pravega/pravega/commit/18621313203fd879091c471e9a5aa5b612c1a515", "message": "Merge with master\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-18T17:39:43Z", "type": "commit"}, {"oid": "6b9af5ceacfc811e7d4146025ac11cee248fd03e", "url": "https://github.com/pravega/pravega/commit/6b9af5ceacfc811e7d4146025ac11cee248fd03e", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-22T05:15:13Z", "type": "commit"}, {"oid": "97a38dcad04788445bdbb5e2c11c86ff96f32c47", "url": "https://github.com/pravega/pravega/commit/97a38dcad04788445bdbb5e2c11c86ff96f32c47", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-24T16:18:17Z", "type": "commit"}, {"oid": "6d6419e41e8eb0524e456b2e7284d1523913fb71", "url": "https://github.com/pravega/pravega/commit/6d6419e41e8eb0524e456b2e7284d1523913fb71", "message": "Add more debugging info for metrics test.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-27T00:04:30Z", "type": "commit"}, {"oid": "32697e55c2212ce844b55ee93692209134e9d9cf", "url": "https://github.com/pravega/pravega/commit/32697e55c2212ce844b55ee93692209134e9d9cf", "message": "Merge with master\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-27T00:49:45Z", "type": "commit"}, {"oid": "c3e732629e3a279671c980b00ad73fae8695fa5c", "url": "https://github.com/pravega/pravega/commit/c3e732629e3a279671c980b00ad73fae8695fa5c", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-29T17:29:40Z", "type": "commit"}, {"oid": "3add60e4b3d4eaf04ef637f089f944032fb570b0", "url": "https://github.com/pravega/pravega/commit/3add60e4b3d4eaf04ef637f089f944032fb570b0", "message": "Fix headers.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-29T23:29:09Z", "type": "commit"}, {"oid": "21ebc092eb9ca19a8202ae066b791dba0373d6b0", "url": "https://github.com/pravega/pravega/commit/21ebc092eb9ca19a8202ae066b791dba0373d6b0", "message": "Merge branch 'faster-build' of github.com:tkaitchuck/pravega-1 into faster-build", "committedDate": "2021-03-29T23:29:19Z", "type": "commit"}, {"oid": "64df458f964395abf5832a6eef7b86f7db8c01a5", "url": "https://github.com/pravega/pravega/commit/64df458f964395abf5832a6eef7b86f7db8c01a5", "message": "Prevent cross-test metrics conflicts.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-30T19:57:11Z", "type": "commit"}, {"oid": "b3e606210e030a84163fe2baea996758c608bc7f", "url": "https://github.com/pravega/pravega/commit/b3e606210e030a84163fe2baea996758c608bc7f", "message": "Inmemory tests should use loopback interface\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-31T01:05:57Z", "type": "commit"}, {"oid": "d4aee7347d34348537ba9bd8ea77946ce69f84fe", "url": "https://github.com/pravega/pravega/commit/d4aee7347d34348537ba9bd8ea77946ce69f84fe", "message": "ServiceStarterTest needs to run in serial\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-31T01:06:37Z", "type": "commit"}, {"oid": "0ddb70440cbf58ffa5880aa8ddda2bcf5af28ae3", "url": "https://github.com/pravega/pravega/commit/0ddb70440cbf58ffa5880aa8ddda2bcf5af28ae3", "message": "Don't initialize metrics if they aren't enabled.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-31T01:07:01Z", "type": "commit"}, {"oid": "5f6f669a9a55acb20127c7df22a8aae6019f27bf", "url": "https://github.com/pravega/pravega/commit/5f6f669a9a55acb20127c7df22a8aae6019f27bf", "message": "Only initialize host metrics once.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-31T01:07:31Z", "type": "commit"}, {"oid": "540c4c83fff1aa3b77732782ebfb9e9a76a1d384", "url": "https://github.com/pravega/pravega/commit/540c4c83fff1aa3b77732782ebfb9e9a76a1d384", "message": "Remove useless config setting (it is overridden below)\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-31T01:07:55Z", "type": "commit"}, {"oid": "5f963b23458580d9ef7eef2f84ee9db49444c9a7", "url": "https://github.com/pravega/pravega/commit/5f963b23458580d9ef7eef2f84ee9db49444c9a7", "message": "Don't tie use of localhost to authentication\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-31T01:09:51Z", "type": "commit"}, {"oid": "be40e3fb144bf9e97eefdb49fd1f7b69162565f7", "url": "https://github.com/pravega/pravega/commit/be40e3fb144bf9e97eefdb49fd1f7b69162565f7", "message": "Add host tag at initialization\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-31T19:00:42Z", "type": "commit"}, {"oid": "3e8362b53c47d66ad64ead55b536775e8e7b5657", "url": "https://github.com/pravega/pravega/commit/3e8362b53c47d66ad64ead55b536775e8e7b5657", "message": "Add timeouts to tests missing them.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-31T23:17:01Z", "type": "commit"}, {"oid": "895b6113b8ea8b0b559d05ba670967642ea6bc0e", "url": "https://github.com/pravega/pravega/commit/895b6113b8ea8b0b559d05ba670967642ea6bc0e", "message": "Checkstyle\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-01T00:20:26Z", "type": "commit"}, {"oid": "64ee42725153bdaa5e9aa26ecc3be2720ecd0d27", "url": "https://github.com/pravega/pravega/commit/64ee42725153bdaa5e9aa26ecc3be2720ecd0d27", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-04-01T18:09:12Z", "type": "commit"}, {"oid": "08d1e005f834b05845200ec6f26a4a15adae7274", "url": "https://github.com/pravega/pravega/commit/08d1e005f834b05845200ec6f26a4a15adae7274", "message": "Ensure close is called on objects created for tests.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-01T21:02:19Z", "type": "commit"}, {"oid": "ea3882a804f15d0671f21d57d4bd613d46001caf", "url": "https://github.com/pravega/pravega/commit/ea3882a804f15d0671f21d57d4bd613d46001caf", "message": "Add assertion\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-01T21:02:30Z", "type": "commit"}, {"oid": "7c24ad0fa217041385821d3d48a3abc4b1e668da", "url": "https://github.com/pravega/pravega/commit/7c24ad0fa217041385821d3d48a3abc4b1e668da", "message": "Increase parallelism for integration tests.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-01T21:02:44Z", "type": "commit"}, {"oid": "fca63bd3aaa7b0a590856b6fb26901ce78996f4c", "url": "https://github.com/pravega/pravega/commit/fca63bd3aaa7b0a590856b6fb26901ce78996f4c", "message": "Log tests starting\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-01T21:25:06Z", "type": "commit"}, {"oid": "3dce76916db518c31cbf92911cb65ebe331007ec", "url": "https://github.com/pravega/pravega/commit/3dce76916db518c31cbf92911cb65ebe331007ec", "message": "Merge branch 'faster-build' of github.com:tkaitchuck/pravega-1 into faster-build", "committedDate": "2021-04-01T21:25:16Z", "type": "commit"}, {"oid": "b3e444d1e176c9ca7e2ba4ac51aebd8bc6072f67", "url": "https://github.com/pravega/pravega/commit/b3e444d1e176c9ca7e2ba4ac51aebd8bc6072f67", "message": "Spotbugs issues\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T00:29:03Z", "type": "commit"}, {"oid": "ab054cdf3891bde7df289f092db6d4288d651947", "url": "https://github.com/pravega/pravega/commit/ab054cdf3891bde7df289f092db6d4288d651947", "message": "Re-enable timeout\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T00:29:14Z", "type": "commit"}, {"oid": "96d2a515cef9ea644b525b56a7977dce72a90e4e", "url": "https://github.com/pravega/pravega/commit/96d2a515cef9ea644b525b56a7977dce72a90e4e", "message": "Disable unneeded rest listener\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T00:29:35Z", "type": "commit"}, {"oid": "bbef6ac917d6cdd43215495ea915aa8b7b507522", "url": "https://github.com/pravega/pravega/commit/bbef6ac917d6cdd43215495ea915aa8b7b507522", "message": "Extend timeout\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T00:29:45Z", "type": "commit"}, {"oid": "789191ceb7462050e3e6f80ddde603518b0fe0e4", "url": "https://github.com/pravega/pravega/commit/789191ceb7462050e3e6f80ddde603518b0fe0e4", "message": "Add comment for SSH access.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T22:06:32Z", "type": "commit"}, {"oid": "239c0ec64d5f9406257dd0092f7658bd547df6b7", "url": "https://github.com/pravega/pravega/commit/239c0ec64d5f9406257dd0092f7658bd547df6b7", "message": "Add timeouts on controller startup\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T22:06:58Z", "type": "commit"}, {"oid": "5304137158576f9f859acab6022a68622127c33e", "url": "https://github.com/pravega/pravega/commit/5304137158576f9f859acab6022a68622127c33e", "message": "Prevent NPE\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T22:16:26Z", "type": "commit"}, {"oid": "2f32368908df98788f98e831db4d422f7e513fad", "url": "https://github.com/pravega/pravega/commit/2f32368908df98788f98e831db4d422f7e513fad", "message": "Allow reuse of PravegaResource.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T22:31:11Z", "type": "commit"}, {"oid": "2f32368908df98788f98e831db4d422f7e513fad", "url": "https://github.com/pravega/pravega/commit/2f32368908df98788f98e831db4d422f7e513fad", "message": "Allow reuse of PravegaResource.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T22:31:11Z", "type": "forcePushed"}, {"oid": "9aa1e688ea049566b942468c7a285a16224ca5fa", "url": "https://github.com/pravega/pravega/commit/9aa1e688ea049566b942468c7a285a16224ca5fa", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-04-02T22:34:16Z", "type": "commit"}, {"oid": "15bc57db7f4326450f783f7dd1fd049ea5faba47", "url": "https://github.com/pravega/pravega/commit/15bc57db7f4326450f783f7dd1fd049ea5faba47", "message": "Move protocol and security tests into client section.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T23:02:41Z", "type": "commit"}, {"oid": "1f0788e0e616045177508468b937a4002cb9cb25", "url": "https://github.com/pravega/pravega/commit/1f0788e0e616045177508468b937a4002cb9cb25", "message": "Optimize shutdown logic in case of failure.\n\n(If ZK can't be written to give up after first failure)\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-02T23:50:49Z", "type": "commit"}, {"oid": "14f1161f4c00142dd53ac37d8a8a2cc640c8f934", "url": "https://github.com/pravega/pravega/commit/14f1161f4c00142dd53ac37d8a8a2cc640c8f934", "message": "Increase coverage of test\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-03T00:24:54Z", "type": "commit"}, {"oid": "f921c18163e3976fc6619ee901251447a1765e42", "url": "https://github.com/pravega/pravega/commit/f921c18163e3976fc6619ee901251447a1765e42", "message": "Add coverage for interupts\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-05T17:45:52Z", "type": "commit"}, {"oid": "53408d2dde3b855a80399907cd848674221b38c7", "url": "https://github.com/pravega/pravega/commit/53408d2dde3b855a80399907cd848674221b38c7", "message": "Delete unused code.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-05T17:46:03Z", "type": "commit"}, {"oid": "0fc19077f02cd201d24623cf6f8613395e786603", "url": "https://github.com/pravega/pravega/commit/0fc19077f02cd201d24623cf6f8613395e786603", "message": "Use preconditions to boost coverage.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-05T17:52:49Z", "type": "commit"}, {"oid": "bfced3b6e389158e8c8f6f8433c773592fe330d4", "url": "https://github.com/pravega/pravega/commit/bfced3b6e389158e8c8f6f8433c773592fe330d4", "message": "Unify controller event processor shutdown logic.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-05T22:39:06Z", "type": "commit"}, {"oid": "7eb01aee241790ba52dcf59eb690ba8a19213177", "url": "https://github.com/pravega/pravega/commit/7eb01aee241790ba52dcf59eb690ba8a19213177", "message": "Remove unused import.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-05T22:44:00Z", "type": "commit"}, {"oid": "d608beadb3817e02d0558bb6d8db5138730fd740", "url": "https://github.com/pravega/pravega/commit/d608beadb3817e02d0558bb6d8db5138730fd740", "message": "Add additional test coverage.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-05T22:55:22Z", "type": "commit"}, {"oid": "19f864d8e83c901c7e07714659e574153ede2dec", "url": "https://github.com/pravega/pravega/commit/19f864d8e83c901c7e07714659e574153ede2dec", "message": "Controller api run under controller.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-05T23:39:16Z", "type": "commit"}, {"oid": "22a66c03630cd10c48120f9b9eb7f6e30035da75", "url": "https://github.com/pravega/pravega/commit/22a66c03630cd10c48120f9b9eb7f6e30035da75", "message": "Force codecov to wait before notifying github of the build status.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-06T00:18:07Z", "type": "commit"}, {"oid": "fab235c96f81b998a0ff37fc75960eb0d08fcfd4", "url": "https://github.com/pravega/pravega/commit/fab235c96f81b998a0ff37fc75960eb0d08fcfd4", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-04-06T18:26:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA1ODQwNg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608058406", "bodyText": "Minor: executionException -> ExecutionException. We don't necessarily need to address in this PR, but I'm wondering if we should be using @link for such references.", "author": "fpj", "createdAt": "2021-04-06T17:46:09Z", "path": "common/src/main/java/io/pravega/common/concurrent/Futures.java", "diffHunk": "@@ -217,6 +238,43 @@\n             }\n         }\n     }\n+    \n+    /**\n+     * Calls get on the provided future, passing a timeout, handling interrupted, and transforming\n+     * the executionException into an exception of the type whose constructor is provided.", "originalCommit": "22a66c03630cd10c48120f9b9eb7f6e30035da75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODIxMTcwNw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608211707", "bodyText": "Done", "author": "tkaitchuck", "createdAt": "2021-04-06T22:08:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA1ODQwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA2ODIxNA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608068214", "bodyText": "Haven't you used ledgers path + zkPort before? Should we use the same here? This is what I'm thinking about:\nhttps://github.com/pravega/pravega/pull/4999/files#diff-7cb38ef4f69c054db7f40fc17995e399cfbc2c96cc35ec1e5d40a969e3bb3aedR62", "author": "fpj", "createdAt": "2021-04-06T18:00:26Z", "path": "segmentstore/storage/impl/src/test/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperLogTests.java", "diffHunk": "@@ -82,41 +80,40 @@\n public abstract class BookKeeperLogTests extends DurableDataLogTestBase {\n     //region Setup, Config and Cleanup\n \n-    private static final AtomicBoolean SECURE_BK = new AtomicBoolean();\n-\n     private static final int CONTAINER_ID = 9999;\n     private static final int WRITE_COUNT = 500;\n     private static final int BOOKIE_COUNT = 1;\n     private static final int THREAD_POOL_SIZE = 3;\n     private static final int MAX_WRITE_ATTEMPTS = 5;\n     private static final int MAX_LEDGER_SIZE = WRITE_MAX_LENGTH * Math.max(10, WRITE_COUNT / 20);\n \n-    private static final AtomicReference<BookKeeperServiceRunner> BK_SERVICE = new AtomicReference<>();\n-    private static final AtomicInteger BK_PORT = new AtomicInteger();\n-\n     @Rule\n-    public Timeout globalTimeout = Timeout.seconds(100 * TIMEOUT.getSeconds());\n+    public Timeout globalTimeout = Timeout.seconds(100);\n     private final AtomicReference<BookKeeperConfig> config = new AtomicReference<>();\n     private final AtomicReference<CuratorFramework> zkClient = new AtomicReference<>();\n     private final AtomicReference<BookKeeperLogFactory> factory = new AtomicReference<>();\n+    private final AtomicBoolean secureBk = new AtomicBoolean();\n+    private final AtomicReference<BookKeeperServiceRunner> bkService = new AtomicReference<>();\n \n     /**\n      * Start BookKeeper once for the duration of this class. This is pretty strenuous, so in the interest of running time\n      * we only do it once.\n      */\n-    public static void setUpBookKeeper(boolean secure) throws Exception {\n+    public void setUpBookKeeper(boolean secure) throws Exception {\n         // Pick a random port to reduce chances of collisions during concurrent test executions.\n-        SECURE_BK.set(secure);\n-        BK_PORT.set(TestUtils.getAvailableListenPort());\n+        secureBk.set(secure);\n+        String testId = Long.toHexString(System.nanoTime());\n+        int zkPort = TestUtils.getAvailableListenPort();\n         val bookiePorts = new ArrayList<Integer>();\n         for (int i = 0; i < BOOKIE_COUNT; i++) {\n             bookiePorts.add(TestUtils.getAvailableListenPort());\n         }\n \n+        String ledgersPath = \"/pravega/bookkeeper/ledgers/\" + testId;\n         val runner = BookKeeperServiceRunner.builder()\n                                             .startZk(true)\n-                                            .zkPort(BK_PORT.get())\n-                                            .ledgersPath(\"/pravega/bookkeeper/ledgers\")\n+                                            .zkPort(zkPort)\n+                                            .ledgersPath(ledgersPath)", "originalCommit": "22a66c03630cd10c48120f9b9eb7f6e30035da75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODIxMDM3MQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608210371", "bodyText": "From the above:\n String ledgersPath = \"/pravega/bookkeeper/ledgers/\" + testId;\n\nWhere testId is:\nString testId = Long.toHexString(System.nanoTime());\n\nThis serves much the same function. Either way it ensures that parallel tests won't collide in their directories.", "author": "tkaitchuck", "createdAt": "2021-04-06T22:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA2ODIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA4MzUwNA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608083504", "bodyText": "Minor: extra spaces", "author": "fpj", "createdAt": "2021-04-06T18:24:14Z", "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/StatsLoggerProxy.java", "diffHunk": "@@ -99,17 +99,21 @@ public StatsLogger createScopeLogger(String scope) {\n      * @param <V>          Type of MetricProxy.\n      * @return Either the existing MetricProxy (if it is already registered) or the newly created one.\n      */\n-    private <T extends Metric, V extends MetricProxy<T>> V getOrSet(ConcurrentHashMap<String, V> cache, String name,\n-                                                                    Function<String, T> createMetric,\n-                                                                    ProxyCreator<T, V> createProxy, String... tags) {\n+    private static <T extends Metric, V extends MetricProxy<T, V>> V getOrSet(ConcurrentHashMap<String, V> cache, String name,\n+                                                                              Function<String, T> createMetric,\n+                                                                              ProxyCreator<T, V> createProxy, String... tags) {\n+        // We have to create the metric inside computeIfAbsent even though it is under lock, because micrometer is optimized\n+        // such that the call to create will return the original metric if it has already been created. So when close is called\n+        // on one of the metrics it will close both of them. \n         MetricsNames.MetricKey keys = metricKey(name, tags);\n-        return cache.computeIfAbsent(keys.getCacheKey(), key -> {\n-            T metric = createMetric.apply(keys.getRegistryKey());\n-            return createProxy.apply(metric, keys.getCacheKey(), cache::remove);\n+        Consumer<V> closeCallback = m -> cache.remove(m.getProxyName(), m);\n+        return cache.computeIfAbsent(keys.getCacheKey(), k -> {            \n+            T newMetric = createMetric.apply(keys.getRegistryKey());\n+            return createProxy.apply(newMetric, keys.getCacheKey(), closeCallback);\n         });\n     }\n-\n+    ", "originalCommit": "22a66c03630cd10c48120f9b9eb7f6e30035da75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA4NDU1NA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608084554", "bodyText": "It is odd that it is not recognizing this file as Java, is this just a UI bug?", "author": "fpj", "createdAt": "2021-04-06T18:25:50Z", "path": "shared/metrics/src/test/java/io/pravega/shared/metrics/BasicMetricTest.java", "diffHunk": "@@ -16,21 +16,23 @@\n package io.pravega.shared.metrics;\n \n import io.pravega.shared.MetricsTags;\n+import io.pravega.test.common.SerializedClassRunner;", "originalCommit": "22a66c03630cd10c48120f9b9eb7f6e30035da75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODIxMTYxNQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608211615", "bodyText": "No idea. It's working for me.", "author": "tkaitchuck", "createdAt": "2021-04-06T22:08:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA4NDU1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODA5MTkxNw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608091917", "bodyText": "Minor: extra spaces.", "author": "fpj", "createdAt": "2021-04-06T18:37:24Z", "path": "test/integration/src/test/java/io/pravega/test/integration/endtoendtest/EndToEndCBRTest.java", "diffHunk": "@@ -59,23 +57,23 @@\n public class EndToEndCBRTest extends AbstractEndToEndTest {\n \n     private static final long CLOCK_ADVANCE_INTERVAL = 60 * 1000000000L;\n-\n-    @Test\n+    ", "originalCommit": "fab235c96f81b998a0ff37fc75960eb0d08fcfd4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c8ee652f1c2123d16ee36022de85b5b202700cd2", "url": "https://github.com/pravega/pravega/commit/c8ee652f1c2123d16ee36022de85b5b202700cd2", "message": "PR feedback\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-06T22:07:36Z", "type": "commit"}, {"oid": "1e626eb61d358f7cde95b23b94de1aa436e54631", "url": "https://github.com/pravega/pravega/commit/1e626eb61d358f7cde95b23b94de1aa436e54631", "message": "Merge branch 'faster-build' of github.com:tkaitchuck/pravega-1 into faster-build", "committedDate": "2021-04-06T22:07:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NDA1Mg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608744052", "bodyText": "why are we removing this.. this is a zookeeper node which needs to be cleaned up.", "author": "shiveshr", "createdAt": "2021-04-07T15:08:47Z", "path": "controller/src/main/java/io/pravega/controller/eventProcessor/impl/EventProcessorCell.java", "diffHunk": "@@ -142,14 +143,6 @@ protected final void shutDown() throws Exception {\n                 } catch (Exception e) {\n                     log.info(\"Exception while closing EventProcessorCell reader from checkpointStore: {}.\", e.getMessage());\n                 }\n-\n-                // Next, clean up the reader and its position from checkpoint store\n-                log.info(\"Cleaning up checkpoint store for {}\", objectId);\n-                try {\n-                    checkpointStore.removeReader(process, readerGroupName, readerId);", "originalCommit": "1e626eb61d358f7cde95b23b94de1aa436e54631", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODgxMDA2Nw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608810067", "bodyText": "I moved it into checkpointStore:\nhttps://github.com/pravega/pravega/pull/4999/files#diff-36211c36a9b83866c7fae956d50dce693373d12d9d9e29bf550bd4d52b52851bR161-R164", "author": "tkaitchuck", "createdAt": "2021-04-07T16:26:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NDA1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NjM5MA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608746390", "bodyText": "why not remove the reader from inside cell.stop which terminates the reader and only after that we remove it. here we could be removing it prematurely.", "author": "shiveshr", "createdAt": "2021-04-07T15:11:18Z", "path": "controller/src/main/java/io/pravega/controller/eventProcessor/impl/EventProcessorGroupImpl.java", "diffHunk": "@@ -369,6 +364,7 @@ private void replaceCell(String readerId) {\n             log.info(\"Stopping event processor cell: {}\", cell);\n             try {\n                 cell.stopAsync();\n+                checkpointStore.removeReader(cell.getProcess(), readerGroup.getGroupName(), readerId);", "originalCommit": "1e626eb61d358f7cde95b23b94de1aa436e54631", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc2NDgzMg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608764832", "bodyText": "it would make a difference if we are unable to do a clean shutdown (where we use the last reader position and report it offline at that position..\nsay all of that failed but we removed the reader postion from zookeeper, then another controller will not be able to correctly failover this reader.", "author": "shiveshr", "createdAt": "2021-04-07T15:32:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NjM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODgyOTU3Nw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608829577", "bodyText": "While I agree it would be cleaner, my motivation for not doing it inside the cell, is because it causes problems on shutdown.\nSpecifically if the checkpointStore needs to be written to, then every cell will need to timeout writing to it. As there are many cells this results in very long delays in the tests. In fact it is the largest single contributor of integration test time.\nI have addressed the concern raised here about this being too soon by moving it after the await.", "author": "tkaitchuck", "createdAt": "2021-04-07T16:53:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NjM5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc0NjczMA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608746730", "bodyText": "thank you :)", "author": "shiveshr", "createdAt": "2021-04-07T15:11:41Z", "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/LocalController.java", "diffHunk": "@@ -161,11 +160,11 @@ public LocalController(ControllerService controller, boolean authorizationEnable\n         return this.controller.createStream(scope, streamName, streamConfig, System.currentTimeMillis()).thenApply(x -> {\n             switch (x.getStatus()) {\n             case FAILURE:\n-                throw new ControllerFailureException(\"Failed to createing stream: \" + streamConfig);\n+                throw new ControllerFailureException(\"Failed to create stream: \" + streamConfig);", "originalCommit": "1e626eb61d358f7cde95b23b94de1aa436e54631", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc1MjUwOA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608752508", "bodyText": "the reason why only FAILED event was present ref: #5441 (review)", "author": "shrids", "createdAt": "2021-04-07T15:18:23Z", "path": "gradle/java.gradle", "diffHunk": "@@ -94,12 +94,13 @@ plugins.withId('java') {\n         testLogging.showCauses = true\n         testLogging.showExceptions = true\n         testLogging.showStackTraces = true\n-        testLogging.events = [\"FAILED\"]\n-        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 1\n+        testLogging.events = [\"STARTED\", \"PASSED\", \"SKIPPED\", \"FAILED\"]", "originalCommit": "1e626eb61d358f7cde95b23b94de1aa436e54631", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODgyOTA0Mw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608829043", "bodyText": "I removed the duplicate on start.\nGiven that there is parallelization I don't consider 'passed' and 'started' redundant anymore, because it allows you to infer which are running at the same time.", "author": "tkaitchuck", "createdAt": "2021-04-07T16:52:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc1MjUwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc1Nzg3OA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608757878", "bodyText": "Is the reason for this change related to the below WARN message observed on Segment store ?\n2021-02-26 05:38:20,547 13644 [core-1] WARN  o.a.b.client.BookieWatcherImpl - New ensemble: [nautilus-bookie-2.nautilus-bookie-headless.nautilus-pravega.svc.cluster.local:3181, nautilus-bookie-0.nautilus-bookie-headless.nautilus-pravega.svc.cluster.local:3181, nautilus-bookie-1.nautilus-bookie-headless.nautilus-pravega.svc.cluster.local:3181] is not adhering to Placement Policy. quarantinedBookies: []", "author": "shrids", "createdAt": "2021-04-07T15:24:33Z", "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperLogFactory.java", "diffHunk": "@@ -189,6 +190,8 @@ private BookKeeper startBookKeeperClient() throws Exception {\n             config.setEnforceMinNumRacksPerWriteQuorum(this.config.isEnforceMinNumRacksPerWriteQuorum());\n             config.setMinNumRacksPerWriteQuorum(this.config.getMinNumRacksPerWriteQuorum());\n             config.setProperty(CommonConfigurationKeys.NET_TOPOLOGY_SCRIPT_FILE_NAME_KEY, this.config.getNetworkTopologyFileName());\n+        } else {\n+            config = config.setEnsemblePlacementPolicy(DefaultEnsemblePlacementPolicy.class);", "originalCommit": "1e626eb61d358f7cde95b23b94de1aa436e54631", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODgyOTMzNw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r608829337", "bodyText": "Yes.", "author": "tkaitchuck", "createdAt": "2021-04-07T16:53:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc1Nzg3OA=="}], "type": "inlineReview"}, {"oid": "87a5b217b92b29a834ff3452216bd498ed8c869d", "url": "https://github.com/pravega/pravega/commit/87a5b217b92b29a834ff3452216bd498ed8c869d", "message": "PR feedback\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-07T16:51:05Z", "type": "commit"}, {"oid": "e664a28893a9a041a6a8a44b269f2fd5006ee6f2", "url": "https://github.com/pravega/pravega/commit/e664a28893a9a041a6a8a44b269f2fd5006ee6f2", "message": "Color gradle output.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-07T23:44:47Z", "type": "commit"}, {"oid": "c3c29e75dd9b4d5b334dd8ca658739be66dc68b5", "url": "https://github.com/pravega/pravega/commit/c3c29e75dd9b4d5b334dd8ca658739be66dc68b5", "message": "Revert color\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-07T23:53:20Z", "type": "commit"}, {"oid": "3ea34d882544ff4157be08e4306ba5957930b536", "url": "https://github.com/pravega/pravega/commit/3ea34d882544ff4157be08e4306ba5957930b536", "message": "Allow artifact reuse between builds on the same branch.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T00:29:26Z", "type": "commit"}, {"oid": "d62a0a1f6e3d8522a91926cadcaba1b34837e46a", "url": "https://github.com/pravega/pravega/commit/d62a0a1f6e3d8522a91926cadcaba1b34837e46a", "message": "Reduce amount of data held in github actions cache.\n\nThis is done by pulling the source from the repo, and only holding onto\none copy of gradle's temporary files (instead of 3).\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T17:24:19Z", "type": "commit"}, {"oid": "3d36e702c1f5ee5dd4e3c9e8b6675d14d04e92bc", "url": "https://github.com/pravega/pravega/commit/3d36e702c1f5ee5dd4e3c9e8b6675d14d04e92bc", "message": "Add timeout to HDFS recovery test.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T17:42:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NjYzNA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r609946634", "bodyText": "Can you verify that this change won't impact workflow re-runs?\nThe point of all these caches is to have a particular job finish right away if it previously completed successfully and we re-run the whole workflow.", "author": "andreipaduroiu", "createdAt": "2021-04-08T17:43:12Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -29,18 +29,24 @@ on:\n # Define a few constants that are shared across all the jobs.\n env:\n   GLOBAL_CACHE_PATH: |\n-    .gradle\n     ~/.gradle\n     ~/.m2\n   GLOBAL_CACHE_KEY: gradle-m2-java-11\n   GLOBAL_CACHE_RESTORE_KEYS: |\n     gradle-m2-java-\n     gradle-m2\n-  # We cache the source code, resources and build output. This is generated on the build job and reused in dependent jobs.\n-  BUILD_CACHE_PATH: ./*\n+  # We cache the class files, resources and build output. This is generated on the build job and reused in dependent jobs.\n+  BUILD_CACHE_PATH: |\n+    .gradle", "originalCommit": "d62a0a1f6e3d8522a91926cadcaba1b34837e46a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDAxMjYxMg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r610012612", "bodyText": "I am checking", "author": "tkaitchuck", "createdAt": "2021-04-08T19:04:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NjYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDEwMzI2NQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r610103265", "bodyText": "Confirmed", "author": "tkaitchuck", "createdAt": "2021-04-08T21:02:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NjYzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NzU1Mg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r609947552", "bodyText": "What is the effect of this change? run_id would cache the output for re-runs of the same workflow.", "author": "andreipaduroiu", "createdAt": "2021-04-08T17:44:14Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -101,14 +112,14 @@ jobs:\n         uses: actions/cache@v2.1.0\n         with:\n           path: ${{env.BUILD_CACHE_PATH}}\n-          key: ${{github.run_id}}\n+          key: ${{github.ref}}", "originalCommit": "d62a0a1f6e3d8522a91926cadcaba1b34837e46a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMDAxMDg3NA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r610010874", "bodyText": "Now instead of being tied to a github actions run, it's tied to the source. (PR or Branch). This means that multiple pushes to the same branch can avoid re-executing if the tests for that target passed and no related code was changed just like the do locally.", "author": "tkaitchuck", "createdAt": "2021-04-08T19:02:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0NzU1Mg=="}], "type": "inlineReview"}, {"oid": "4524c0b16a178ee3d51924e517dada1860a9f75b", "url": "https://github.com/pravega/pravega/commit/4524c0b16a178ee3d51924e517dada1860a9f75b", "message": "Unify build and test caches.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T19:05:54Z", "type": "commit"}, {"oid": "027e3571ad69e723579b827f166396e1b7ea5643", "url": "https://github.com/pravega/pravega/commit/027e3571ad69e723579b827f166396e1b7ea5643", "message": "Add ordered fallback for cache. (Avoids not repopulating on hit)\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T19:31:31Z", "type": "commit"}, {"oid": "cd31259598a6473a91e267f15ba95ee5aecfacf0", "url": "https://github.com/pravega/pravega/commit/cd31259598a6473a91e267f15ba95ee5aecfacf0", "message": "Add clean step when building from branch.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T19:55:23Z", "type": "commit"}, {"oid": "6fb70309250d25aa8d5367672b6b46dd6c9f0e40", "url": "https://github.com/pravega/pravega/commit/6fb70309250d25aa8d5367672b6b46dd6c9f0e40", "message": "Experimentally disabling n-builds trigger for codecov\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T21:17:15Z", "type": "commit"}, {"oid": "d223a770abeea12338be6159bc250b95de431197", "url": "https://github.com/pravega/pravega/commit/d223a770abeea12338be6159bc250b95de431197", "message": "Manually combine codecov reports before uploading.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T22:12:58Z", "type": "commit"}, {"oid": "df374f065b3e0bda52dae3a0903934bd3b2cdeec", "url": "https://github.com/pravega/pravega/commit/df374f065b3e0bda52dae3a0903934bd3b2cdeec", "message": "Tar reports into a single file to reduce number of uploads\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T23:40:35Z", "type": "commit"}, {"oid": "df374f065b3e0bda52dae3a0903934bd3b2cdeec", "url": "https://github.com/pravega/pravega/commit/df374f065b3e0bda52dae3a0903934bd3b2cdeec", "message": "Tar reports into a single file to reduce number of uploads\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-08T23:40:35Z", "type": "forcePushed"}, {"oid": "d86674a092a733f1af80d06b11c7fb7eccbacf46", "url": "https://github.com/pravega/pravega/commit/d86674a092a733f1af80d06b11c7fb7eccbacf46", "message": "Fix path\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-09T00:09:48Z", "type": "commit"}, {"oid": "278525c4466861c64995ccfced95b493bc09707c", "url": "https://github.com/pravega/pravega/commit/278525c4466861c64995ccfced95b493bc09707c", "message": "Add compression\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-09T00:24:43Z", "type": "commit"}, {"oid": "637240bec5af4572b2ffa538e531c2f73bc106fa", "url": "https://github.com/pravega/pravega/commit/637240bec5af4572b2ffa538e531c2f73bc106fa", "message": "Fix codecov paths.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-09T00:49:49Z", "type": "commit"}, {"oid": "4eb3480a89e818acf2c30449761670e7b20f86db", "url": "https://github.com/pravega/pravega/commit/4eb3480a89e818acf2c30449761670e7b20f86db", "message": "Fix code cov paths attempt #2\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-09T01:21:40Z", "type": "commit"}, {"oid": "09eb1001603d61d26458f0f5c6a6d7c22fce462d", "url": "https://github.com/pravega/pravega/commit/09eb1001603d61d26458f0f5c6a6d7c22fce462d", "message": "Fix code cov paths attempt #3\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-04-09T01:52:49Z", "type": "commit"}, {"oid": "3435dc19be7f3f0d0f08b8b2e53895f7e6a925c7", "url": "https://github.com/pravega/pravega/commit/3435dc19be7f3f0d0f08b8b2e53895f7e6a925c7", "message": "Upgrade gradle version. (And spotbugs plugin to work with it)\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-24T22:55:08Z", "type": "commit"}, {"oid": "8c3fb0f5da2b5f141d38ca29d2943f1759985316", "url": "https://github.com/pravega/pravega/commit/8c3fb0f5da2b5f141d38ca29d2943f1759985316", "message": "Set default test forks to 4.\n\n(System test etc already override this to 1)\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-24T22:56:19Z", "type": "commit"}, {"oid": "23b75baf38add92c5156cc650efcaced4cbad3a6", "url": "https://github.com/pravega/pravega/commit/23b75baf38add92c5156cc650efcaced4cbad3a6", "message": "Enable gradle parallelism\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-29T17:14:00Z", "type": "commit"}, {"oid": "fc3f5fd4c8f41efbe8fb14fba200ea5b11aeb096", "url": "https://github.com/pravega/pravega/commit/fc3f5fd4c8f41efbe8fb14fba200ea5b11aeb096", "message": "Adjust some tests to work with parallel test runs.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-29T17:14:33Z", "type": "commit"}, {"oid": "3525b768debba2ecb17691f82d0d9f555a01191a", "url": "https://github.com/pravega/pravega/commit/3525b768debba2ecb17691f82d0d9f555a01191a", "message": "Dump heap on OOM\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-29T23:39:39Z", "type": "commit"}, {"oid": "0d3b78f8bce66635126e97cf00a36a7f8c07bfd7", "url": "https://github.com/pravega/pravega/commit/0d3b78f8bce66635126e97cf00a36a7f8c07bfd7", "message": "Prevent OOM from stack trace accumulation\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-29T23:40:00Z", "type": "commit"}, {"oid": "fa574ad8b0db3021ae1d85c5432a8339d4685aee", "url": "https://github.com/pravega/pravega/commit/fa574ad8b0db3021ae1d85c5432a8339d4685aee", "message": "Fix BookKeeperLogTest to work with multiple instances in parallel\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-29T23:50:14Z", "type": "commit"}, {"oid": "bf923726fac4d7bf56fd564aba9fd2651a3e0001", "url": "https://github.com/pravega/pravega/commit/bf923726fac4d7bf56fd564aba9fd2651a3e0001", "message": "Allow metrics to be reset between tests while others are running\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-30T00:32:34Z", "type": "commit"}, {"oid": "e46d8b9d5d7584fb9daebd6e6ba7073a1247fdef", "url": "https://github.com/pravega/pravega/commit/e46d8b9d5d7584fb9daebd6e6ba7073a1247fdef", "message": "Serialize integration tests, running as separate target.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-30T00:34:08Z", "type": "commit"}, {"oid": "2baf4b2eb348bccd0eb26518960379f61f2823bc", "url": "https://github.com/pravega/pravega/commit/2baf4b2eb348bccd0eb26518960379f61f2823bc", "message": "Upgrade lombok plugin\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-30T00:52:07Z", "type": "commit"}, {"oid": "cbe49c8253fd4ffb93cbd604ef3a447764bb2373", "url": "https://github.com/pravega/pravega/commit/cbe49c8253fd4ffb93cbd604ef3a447764bb2373", "message": "Merge branch 'master' into faster-build", "committedDate": "2020-07-30T01:35:14Z", "type": "commit"}, {"oid": "fe499f133ac32769f7afbfe5d836037c3707ae68", "url": "https://github.com/pravega/pravega/commit/fe499f133ac32769f7afbfe5d836037c3707ae68", "message": "Remove duplicate override\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>\nSigned-off-by: Tom Kaitchuck <Tom.Kaitchuck@gmail.com>", "committedDate": "2020-07-30T01:43:09Z", "type": "commit"}, {"oid": "fe499f133ac32769f7afbfe5d836037c3707ae68", "url": "https://github.com/pravega/pravega/commit/fe499f133ac32769f7afbfe5d836037c3707ae68", "message": "Remove duplicate override\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>\nSigned-off-by: Tom Kaitchuck <Tom.Kaitchuck@gmail.com>", "committedDate": "2020-07-30T01:43:09Z", "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "8bf1a5e5742effe816c17d73b365311bf7ac181a", "url": "https://github.com/pravega/pravega/commit/8bf1a5e5742effe816c17d73b365311bf7ac181a", "message": "Have Travis run the stages in parallel\n\nSigned-off-by: Tom Kaitchuck <Tom.Kaitchuck@gmail.com>", "committedDate": "2020-07-30T02:18:39Z", "type": "commit"}, {"oid": "8bf1a5e5742effe816c17d73b365311bf7ac181a", "url": "https://github.com/pravega/pravega/commit/8bf1a5e5742effe816c17d73b365311bf7ac181a", "message": "Have Travis run the stages in parallel\n\nSigned-off-by: Tom Kaitchuck <Tom.Kaitchuck@gmail.com>", "committedDate": "2020-07-30T02:18:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc0MDY5Nw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r462740697", "bodyText": "Why aren't we using junit TemporaryFolder rule?", "author": "eolivelli", "createdAt": "2020-07-30T05:17:06Z", "path": "bindings/src/test/java/io/pravega/storage/hdfs/HDFSStorageTest.java", "diffHunk": "@@ -64,7 +65,7 @@\n \n     @Before\n     public void setUp() throws Exception {\n-        this.baseDir = Files.createTempDirectory(\"test_hdfs\").toFile().getAbsoluteFile();\n+        this.baseDir = Files.createTempDirectory(\"test_hdfs_\" + UUID.randomUUID().toString()).toFile().getAbsoluteFile();", "originalCommit": "8bf1a5e5742effe816c17d73b365311bf7ac181a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMzk3MQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r464703971", "bodyText": "Done", "author": "tkaitchuck", "createdAt": "2020-08-03T22:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc0MDY5Nw=="}], "type": "inlineReview"}, {"oid": "42236bb96925b8170c7282f460d86ed3c71ce52c", "url": "https://github.com/pravega/pravega/commit/42236bb96925b8170c7282f460d86ed3c71ce52c", "message": "Merge branch 'master' into faster-build", "committedDate": "2020-07-30T08:52:30Z", "type": "commit"}, {"oid": "c5ffdf1384379e338fe12ad955ac889f93c81ef0", "url": "https://github.com/pravega/pravega/commit/c5ffdf1384379e338fe12ad955ac889f93c81ef0", "message": "PR feedback\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-07-30T17:45:48Z", "type": "commit"}, {"oid": "1a4745743821ffb2ce72239b71f9255a71381ec9", "url": "https://github.com/pravega/pravega/commit/1a4745743821ffb2ce72239b71f9255a71381ec9", "message": "Fix bugs in metrics implementation.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-03T22:17:03Z", "type": "commit"}, {"oid": "3e57a69fb72963ad99dd3e23512fbaed8d3af64f", "url": "https://github.com/pravega/pravega/commit/3e57a69fb72963ad99dd3e23512fbaed8d3af64f", "message": "Checkstyle\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-03T22:54:00Z", "type": "commit"}, {"oid": "f620485757e2c64d2ee408eaaba2f50425fbf7f1", "url": "https://github.com/pravega/pravega/commit/f620485757e2c64d2ee408eaaba2f50425fbf7f1", "message": "Merge branch 'faster-build' of github.com:tkaitchuck/pravega-1 into faster-build", "committedDate": "2020-08-03T22:55:05Z", "type": "commit"}, {"oid": "1f35a6cdc0691ec1577868423f9d58dab7c73be0", "url": "https://github.com/pravega/pravega/commit/1f35a6cdc0691ec1577868423f9d58dab7c73be0", "message": "Prevent NPE\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-04T00:34:05Z", "type": "commit"}, {"oid": "fd7df9af2be1e9d547cae7073fdeba522f2a6310", "url": "https://github.com/pravega/pravega/commit/fd7df9af2be1e9d547cae7073fdeba522f2a6310", "message": "Merge remote-tracking branch 'pravega/master' into faster-build", "committedDate": "2020-08-04T00:34:47Z", "type": "commit"}, {"oid": "6561d71eb46e5f61ef18ba8075663314387dcad2", "url": "https://github.com/pravega/pravega/commit/6561d71eb46e5f61ef18ba8075663314387dcad2", "message": "Ensure proper failure upon leak\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-04T01:10:35Z", "type": "commit"}, {"oid": "4091a6b0af014ad9e242f6abb7335c3e387008ef", "url": "https://github.com/pravega/pravega/commit/4091a6b0af014ad9e242f6abb7335c3e387008ef", "message": "Fix warnings in code merged from master\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-04T01:11:31Z", "type": "commit"}, {"oid": "c6ad873e88c1ed949497a5391653e023931eccd9", "url": "https://github.com/pravega/pravega/commit/c6ad873e88c1ed949497a5391653e023931eccd9", "message": "Improve port collision avoidance.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-04T01:11:49Z", "type": "commit"}, {"oid": "64b35ccdec395691444db0796e7a9de32e2c18f0", "url": "https://github.com/pravega/pravega/commit/64b35ccdec395691444db0796e7a9de32e2c18f0", "message": "Remove spotbugs complaint about single use random.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-06T18:28:49Z", "type": "commit"}, {"oid": "509c79a5741cc411a05e4cd7bd8dc2c8c602ed7a", "url": "https://github.com/pravega/pravega/commit/509c79a5741cc411a05e4cd7bd8dc2c8c602ed7a", "message": "Fix race condition in test\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-18T18:01:34Z", "type": "commit"}, {"oid": "fbd83346496e0dd3d0c0b487f02a688e7e6fbbec", "url": "https://github.com/pravega/pravega/commit/fbd83346496e0dd3d0c0b487f02a688e7e6fbbec", "message": "Prevent NPE\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-18T18:27:28Z", "type": "commit"}, {"oid": "2ea2fc5d28d3e09b43955ff8de34445d592cdc01", "url": "https://github.com/pravega/pravega/commit/2ea2fc5d28d3e09b43955ff8de34445d592cdc01", "message": "Add timeouts\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-19T17:52:43Z", "type": "commit"}, {"oid": "3db1a870b1a41e57754201f29c023f9686a26c01", "url": "https://github.com/pravega/pravega/commit/3db1a870b1a41e57754201f29c023f9686a26c01", "message": "Ensure instances don't collide\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-19T19:42:56Z", "type": "commit"}, {"oid": "b8658d61c76d35dc81694f778a49892f7bfd7de4", "url": "https://github.com/pravega/pravega/commit/b8658d61c76d35dc81694f778a49892f7bfd7de4", "message": "Add timeouts\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-19T19:43:08Z", "type": "commit"}, {"oid": "5f6a7cc08039ec0855bfca1cac45c69c543761da", "url": "https://github.com/pravega/pravega/commit/5f6a7cc08039ec0855bfca1cac45c69c543761da", "message": "Ensure joins on futures fail properly.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-19T19:43:46Z", "type": "commit"}, {"oid": "12a9eb61628376a5ec000bf57a224ca9ee8be5d9", "url": "https://github.com/pravega/pravega/commit/12a9eb61628376a5ec000bf57a224ca9ee8be5d9", "message": "Merge with master\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-19T19:46:23Z", "type": "commit"}, {"oid": "8451b3be28ff8c3a1d46f75583f88d308d0dafbb", "url": "https://github.com/pravega/pravega/commit/8451b3be28ff8c3a1d46f75583f88d308d0dafbb", "message": "Enforce order of startup\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-20T00:31:49Z", "type": "commit"}, {"oid": "6096b0584305f5874c818d4881465245c7b2282a", "url": "https://github.com/pravega/pravega/commit/6096b0584305f5874c818d4881465245c7b2282a", "message": "Avoid test dependency on native code\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-20T00:32:46Z", "type": "commit"}, {"oid": "6c6811f61c869ce5935fe3e563bb7580d2b57a84", "url": "https://github.com/pravega/pravega/commit/6c6811f61c869ce5935fe3e563bb7580d2b57a84", "message": "Add proper timeouts\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-20T00:33:45Z", "type": "commit"}, {"oid": "6c6811f61c869ce5935fe3e563bb7580d2b57a84", "url": "https://github.com/pravega/pravega/commit/6c6811f61c869ce5935fe3e563bb7580d2b57a84", "message": "Add proper timeouts\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-20T00:33:45Z", "type": "forcePushed"}, {"oid": "c1e91794f222738dc9bf6255863359d685f74da7", "url": "https://github.com/pravega/pravega/commit/c1e91794f222738dc9bf6255863359d685f74da7", "message": "Remove some warnings.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-21T21:25:24Z", "type": "commit"}, {"oid": "5f9f1835a3540008d379ad93e2cc629604db7e32", "url": "https://github.com/pravega/pravega/commit/5f9f1835a3540008d379ad93e2cc629604db7e32", "message": "Fix missing Synchronized annotation\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-25T18:29:45Z", "type": "commit"}, {"oid": "291dd4b126cca611d32b759d41307d0482ca5215", "url": "https://github.com/pravega/pravega/commit/291dd4b126cca611d32b759d41307d0482ca5215", "message": "Disable parallel integration tests.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-26T05:25:13Z", "type": "commit"}, {"oid": "5bee289e7be92052196992a68220f9df9063a5f0", "url": "https://github.com/pravega/pravega/commit/5bee289e7be92052196992a68220f9df9063a5f0", "message": "Merge branch 'master' into faster-build", "committedDate": "2020-08-26T19:09:14Z", "type": "commit"}, {"oid": "0a8c6c708731f78be881d86acec17e6cfd023d92", "url": "https://github.com/pravega/pravega/commit/0a8c6c708731f78be881d86acec17e6cfd023d92", "message": "Make method private\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-27T22:18:14Z", "type": "commit"}, {"oid": "bb290fa83b26cdab696e4bc874a2a23b4d81ee5b", "url": "https://github.com/pravega/pravega/commit/bb290fa83b26cdab696e4bc874a2a23b4d81ee5b", "message": "Prevent out of stack error when logging an error.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-27T22:18:51Z", "type": "commit"}, {"oid": "d9464d6923606e04f5b10c8e20abdf92fa4bfc9a", "url": "https://github.com/pravega/pravega/commit/d9464d6923606e04f5b10c8e20abdf92fa4bfc9a", "message": "Ensure listener is set before ZK start call\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-27T22:19:20Z", "type": "commit"}, {"oid": "cb260b9d7c0c65c0fe700e3d47144104186a8773", "url": "https://github.com/pravega/pravega/commit/cb260b9d7c0c65c0fe700e3d47144104186a8773", "message": "Prevent warnings in log durring test\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-27T22:19:44Z", "type": "commit"}, {"oid": "cc39f96513de8211e36873bbf03ad5c4f923bf63", "url": "https://github.com/pravega/pravega/commit/cc39f96513de8211e36873bbf03ad5c4f923bf63", "message": "If we aren't using rack settings in the config, don't run with them.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2020-08-27T22:20:32Z", "type": "commit"}, {"oid": "cd12d5ec5e8f4a2708ec15dc2d59704a2c13bd78", "url": "https://github.com/pravega/pravega/commit/cd12d5ec5e8f4a2708ec15dc2d59704a2c13bd78", "message": "Merge branch 'master' into faster-build", "committedDate": "2020-09-04T16:30:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5NTA3Ng==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r502095076", "bodyText": "Meter operations are NOOP'd until there is a SimpleMeterRegistry belonging to the composite.\nCompositeMeterRegistry composite = Metrics.globalRegistry;\nSimpleMeterRegistry simple = new SimpleMeterRegistry();\ncomposite.add(simple);\n\nWould fix the issue.\nhttps://micrometer.io/docs/concepts#_composite_registries", "author": "co-jo", "createdAt": "2020-10-09T00:35:46Z", "path": "shared/metrics/src/test/java/io/pravega/shared/metrics/MeterRegisterTest.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.shared.metrics;\n+\n+import io.micrometer.core.instrument.Metrics;\n+import io.micrometer.core.instrument.Timer;\n+import io.micrometer.core.instrument.composite.CompositeMeterRegistry;\n+import java.time.Duration;\n+import java.util.concurrent.TimeUnit;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class MeterRegisterTest {\n+\n+    private void initMetrics() {\n+        MetricsConfig metricsConfig = MetricsConfig.builder().with(MetricsConfig.ENABLE_STATSD_REPORTER, false).build();\n+        metricsConfig.setDynamicCacheEvictionDuration(Duration.ofMinutes(5));\n+        MetricsProvider.initialize(metricsConfig);\n+        StatsProvider statsProvider = MetricsProvider.getMetricsProvider();\n+        statsProvider.startWithoutExporting();\n+    }\n+    \n+    @Test\n+    public void testMeterRegister() {\n+        initMetrics();\n+        CompositeMeterRegistry registry = Metrics.globalRegistry;\n+        Timer success = Timer.builder(\"name\").tags().publishPercentiles(OpStatsData.PERCENTILE_ARRAY).register(registry);\n+        success.record(100, TimeUnit.MILLISECONDS);", "originalCommit": "cd12d5ec5e8f4a2708ec15dc2d59704a2c13bd78", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f9815e701e5992f7379418db05924bd40596da70", "url": "https://github.com/pravega/pravega/commit/f9815e701e5992f7379418db05924bd40596da70", "message": "Merge with master\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-02-19T20:55:51Z", "type": "commit"}, {"oid": "dae5aea1df8a819820cea4a85ac7f8b18be342d3", "url": "https://github.com/pravega/pravega/commit/dae5aea1df8a819820cea4a85ac7f8b18be342d3", "message": "Clean up after merge.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-02-19T20:59:41Z", "type": "commit"}, {"oid": "e0b6d3380db77f8554127f16bf7d844a459d31c4", "url": "https://github.com/pravega/pravega/commit/e0b6d3380db77f8554127f16bf7d844a459d31c4", "message": "Merge branch 'faster-build' of github.com:tkaitchuck/pravega-1 into faster-build", "committedDate": "2021-02-19T20:59:47Z", "type": "commit"}, {"oid": "df10f5f97cff66c2c2fb2f67f800e7c5509ddb1a", "url": "https://github.com/pravega/pravega/commit/df10f5f97cff66c2c2fb2f67f800e7c5509ddb1a", "message": "PR feedback\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-02-20T01:09:39Z", "type": "commit"}, {"oid": "87e0d3bf12b07599fdc070062ab60cb136048aee", "url": "https://github.com/pravega/pravega/commit/87e0d3bf12b07599fdc070062ab60cb136048aee", "message": "Re-do change in master to close lost in merge\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-02-20T01:10:06Z", "type": "commit"}, {"oid": "0b7a1515133e867fd7285eb46cca17d3eb7535c1", "url": "https://github.com/pravega/pravega/commit/0b7a1515133e867fd7285eb46cca17d3eb7535c1", "message": "Remove static from test.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-02-23T00:56:51Z", "type": "commit"}, {"oid": "3232c5904087580c35ba9b24de4424345c262843", "url": "https://github.com/pravega/pravega/commit/3232c5904087580c35ba9b24de4424345c262843", "message": "Serialize test that depend on metrics\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-02-28T23:00:57Z", "type": "commit"}, {"oid": "d8a1c099ae8b1acf4e40f479e7f628d093196441", "url": "https://github.com/pravega/pravega/commit/d8a1c099ae8b1acf4e40f479e7f628d093196441", "message": "Prevent NPE\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-02T02:00:12Z", "type": "commit"}, {"oid": "41a079db632c1979e0f1bf71c069c123d091e5d6", "url": "https://github.com/pravega/pravega/commit/41a079db632c1979e0f1bf71c069c123d091e5d6", "message": "Prevent URL parse error\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-02T02:00:34Z", "type": "commit"}, {"oid": "91851ef3a8938976268752859161943f1eeca521", "url": "https://github.com/pravega/pravega/commit/91851ef3a8938976268752859161943f1eeca521", "message": "Turn on Logs.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-02T02:02:32Z", "type": "commit"}, {"oid": "91851ef3a8938976268752859161943f1eeca521", "url": "https://github.com/pravega/pravega/commit/91851ef3a8938976268752859161943f1eeca521", "message": "Turn on Logs.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-02T02:02:32Z", "type": "forcePushed"}, {"oid": "77d41575f4dd321924a29b6533ff937a20fe6240", "url": "https://github.com/pravega/pravega/commit/77d41575f4dd321924a29b6533ff937a20fe6240", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-02T23:48:05Z", "type": "commit"}, {"oid": "918d483a8ed49ae8d112175b67ae6a9daebd17c1", "url": "https://github.com/pravega/pravega/commit/918d483a8ed49ae8d112175b67ae6a9daebd17c1", "message": "Fix NPE\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-03T00:04:10Z", "type": "commit"}, {"oid": "eab3f4ebd55769f8453b2ae86fdb2ec2a3909cf6", "url": "https://github.com/pravega/pravega/commit/eab3f4ebd55769f8453b2ae86fdb2ec2a3909cf6", "message": "Correct accidental useless assertion in test\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-03T00:04:32Z", "type": "commit"}, {"oid": "d6bf926706ca04166b1c845ed2f3ffc78464de46", "url": "https://github.com/pravega/pravega/commit/d6bf926706ca04166b1c845ed2f3ffc78464de46", "message": "Remove unused import\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-03T17:11:37Z", "type": "commit"}, {"oid": "740e558d86fc00a61a74b6451e4d3f24ccbb5bf1", "url": "https://github.com/pravega/pravega/commit/740e558d86fc00a61a74b6451e4d3f24ccbb5bf1", "message": "Add missing header\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-03T17:19:35Z", "type": "commit"}, {"oid": "6841d6d9bbdf82ff18ae26851732c8d566d2cda6", "url": "https://github.com/pravega/pravega/commit/6841d6d9bbdf82ff18ae26851732c8d566d2cda6", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-03T17:20:56Z", "type": "commit"}, {"oid": "a0b37559c9c132c508e5f515b40105c15d91771b", "url": "https://github.com/pravega/pravega/commit/a0b37559c9c132c508e5f515b40105c15d91771b", "message": "Force ZK/BK to use IPv4 loopback\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-03T22:04:44Z", "type": "commit"}, {"oid": "0248a96c9e8a8a7c5678d98e4f8e4d791e30c4ed", "url": "https://github.com/pravega/pravega/commit/0248a96c9e8a8a7c5678d98e4f8e4d791e30c4ed", "message": "Remove todo\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-03T22:04:55Z", "type": "commit"}, {"oid": "c53781652f2055a552f910089cb81d7b85cc83cf", "url": "https://github.com/pravega/pravega/commit/c53781652f2055a552f910089cb81d7b85cc83cf", "message": "Re-add timeout\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-03T22:05:10Z", "type": "commit"}, {"oid": "79291df94f9113c4961eb5b0b674ad2c19258660", "url": "https://github.com/pravega/pravega/commit/79291df94f9113c4961eb5b0b674ad2c19258660", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-03T22:14:39Z", "type": "commit"}, {"oid": "f6c580becb3124a6d60e2bceb8a8b85c4c6f9d33", "url": "https://github.com/pravega/pravega/commit/f6c580becb3124a6d60e2bceb8a8b85c4c6f9d33", "message": "Delete StreamSegmentServiceNoOpWriteOnlyTests\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-03T22:48:35Z", "type": "commit"}, {"oid": "e810a2af82df5b88d3a0cfdc89dd383f13f0d7bf", "url": "https://github.com/pravega/pravega/commit/e810a2af82df5b88d3a0cfdc89dd383f13f0d7bf", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-12T22:58:42Z", "type": "commit"}, {"oid": "06c325e503dde4ba2c8bd1c4d8e344ac712ddb47", "url": "https://github.com/pravega/pravega/commit/06c325e503dde4ba2c8bd1c4d8e344ac712ddb47", "message": "Give up on parallelizing standalone\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-12T23:32:25Z", "type": "commit"}, {"oid": "bb7f7d33135a5a88ec119f30083fdcde1f9e869a", "url": "https://github.com/pravega/pravega/commit/bb7f7d33135a5a88ec119f30083fdcde1f9e869a", "message": "Allow controller to reuse port\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-12T23:40:10Z", "type": "commit"}, {"oid": "7756c0e8c0cc723cee44fed44744a2096edc63f4", "url": "https://github.com/pravega/pravega/commit/7756c0e8c0cc723cee44fed44744a2096edc63f4", "message": "Merge branch 'faster-build' of github.com:tkaitchuck/pravega-1 into faster-build", "committedDate": "2021-03-12T23:40:35Z", "type": "commit"}, {"oid": "97cd8f49614674406b9a32db554014c5ee35a380", "url": "https://github.com/pravega/pravega/commit/97cd8f49614674406b9a32db554014c5ee35a380", "message": "Move common in with client and hosts in with segmentstore.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-15T18:36:42Z", "type": "commit"}, {"oid": "fafcd1d57ea30564a1c8e4e23812aa837e70d0d1", "url": "https://github.com/pravega/pravega/commit/fafcd1d57ea30564a1c8e4e23812aa837e70d0d1", "message": "Merge with master\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-15T18:45:18Z", "type": "commit"}, {"oid": "4e51f7ce672af4631ea9d48d7f956a48bbfdfef6", "url": "https://github.com/pravega/pravega/commit/4e51f7ce672af4631ea9d48d7f956a48bbfdfef6", "message": "Avoid duplicate setup\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:06:16Z", "type": "commit"}, {"oid": "454af8d25622f036f5fe88ed40c43d3cff89c97d", "url": "https://github.com/pravega/pravega/commit/454af8d25622f036f5fe88ed40c43d3cff89c97d", "message": "Add debugging info\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:09:06Z", "type": "commit"}, {"oid": "bc23a88d66190b5b9660dc61332287cad94a4b14", "url": "https://github.com/pravega/pravega/commit/bc23a88d66190b5b9660dc61332287cad94a4b14", "message": "Take advantage of PravegaResource to unify setup logic.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:10:06Z", "type": "commit"}, {"oid": "4c94d65f8b42480b88d39ab695d11b050d153f93", "url": "https://github.com/pravega/pravega/commit/4c94d65f8b42480b88d39ab695d11b050d153f93", "message": "Split SegmentStore into service and storage\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:11:14Z", "type": "commit"}, {"oid": "6a7494dc9028bd1e7498c08e2ddc3af3f0572104", "url": "https://github.com/pravega/pravega/commit/6a7494dc9028bd1e7498c08e2ddc3af3f0572104", "message": "Add parallelism to integration tests\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:11:40Z", "type": "commit"}, {"oid": "330883c8ad569a186e9b19ca6e12aebc66fa3b04", "url": "https://github.com/pravega/pravega/commit/330883c8ad569a186e9b19ca6e12aebc66fa3b04", "message": "Increase timeout\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:12:42Z", "type": "commit"}, {"oid": "7e6c84c9c11105e0f77c665d8c1a323d2022673e", "url": "https://github.com/pravega/pravega/commit/7e6c84c9c11105e0f77c665d8c1a323d2022673e", "message": "Boost coverage.\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:23:43Z", "type": "commit"}, {"oid": "afcb76f8c6fffcd1848cff06ea2fe07412a2fb53", "url": "https://github.com/pravega/pravega/commit/afcb76f8c6fffcd1848cff06ea2fe07412a2fb53", "message": "Checkstyle fixes\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:30:40Z", "type": "commit"}, {"oid": "7032999a4c71af7cdce46bc57b24600b9309ba6d", "url": "https://github.com/pravega/pravega/commit/7032999a4c71af7cdce46bc57b24600b9309ba6d", "message": "Add missing item to \"build_and_test_complete\"\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:34:01Z", "type": "commit"}, {"oid": "3098d809b106163c2ad7738629bf0dbe1ed79c85", "url": "https://github.com/pravega/pravega/commit/3098d809b106163c2ad7738629bf0dbe1ed79c85", "message": "Correct path to testcommon\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:44:48Z", "type": "commit"}, {"oid": "15918908ca6b6738ebc25495d90f9df0c9bcb9a4", "url": "https://github.com/pravega/pravega/commit/15918908ca6b6738ebc25495d90f9df0c9bcb9a4", "message": "Delay rat and spotbugs\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T00:51:17Z", "type": "commit"}, {"oid": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9", "url": "https://github.com/pravega/pravega/commit/46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-16T08:37:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAwNTQ3OA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595005478", "bodyText": "bindings:test is being invoked at line 161 too ...", "author": "shrids", "createdAt": "2021-03-16T09:42:27Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -157,14 +157,39 @@ jobs:\n         run: >\n           ./gradlew\n           segmentstore:server:test\n-          segmentstore:storage:test\n-          segmentstore:storage:impl:test\n+          segmentstore:server:host:test\n           bindings:test\n           --parallel ${{env.GRADLE_OPTS}}\n-      - name: Segment Store Host Tests      # Run this separately since it conflicts with segmentstore:storage:impl:test.\n+      - name: Codecov\n+        uses: codecov/codecov-action@v1.0.15\n+\n+  unit_storeage:\n+    name: Storage Unit Tests\n+    needs: build\n+    runs-on: ubuntu-20.04\n+    steps:\n+      - name: Gradle & Maven Cache\n+        uses: actions/cache@v2.1.0\n+        with:\n+          path: ${{env.GLOBAL_CACHE_PATH}}\n+          key: ${{env.GLOBAL_CACHE_KEY}}\n+          restore-keys: ${{env.GLOBAL_CACHE_RESTORE_KEYS}}\n+      - name: Build Output Cache\n+        uses: actions/cache@v2.1.0\n+        with:\n+          path: ${{env.BUILD_CACHE_PATH}}\n+          key: ${{github.run_id}}\n+      - name: Test Output Cache\n+        uses: actions/cache@v2.1.0\n+        with:\n+          path: ${{env.TEST_OUTPUT_CACHE_PATH}}\n+          key: ${{github.run_id}}-${{github.job}}\n+      - name: Segment Store Unit tests\n         run: >\n           ./gradlew\n-          segmentstore:server:host:test\n+          segmentstore:storage:test\n+          segmentstore:storage:impl:test\n+          bindings:test", "originalCommit": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTQ2MTQwMw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595461403", "bodyText": "Removed", "author": "tkaitchuck", "createdAt": "2021-03-16T19:01:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAwNTQ3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAwNjE0MQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595006141", "bodyText": "nit: typo in storage.", "author": "shrids", "createdAt": "2021-03-16T09:43:24Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -157,14 +157,39 @@ jobs:\n         run: >\n           ./gradlew\n           segmentstore:server:test\n-          segmentstore:storage:test\n-          segmentstore:storage:impl:test\n+          segmentstore:server:host:test\n           bindings:test\n           --parallel ${{env.GRADLE_OPTS}}\n-      - name: Segment Store Host Tests      # Run this separately since it conflicts with segmentstore:storage:impl:test.\n+      - name: Codecov\n+        uses: codecov/codecov-action@v1.0.15\n+\n+  unit_storeage:", "originalCommit": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTQ2MTMxOA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595461318", "bodyText": "Fixed", "author": "tkaitchuck", "createdAt": "2021-03-16T19:01:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAwNjE0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAxNjkxOA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595016918", "bodyText": "How is this different from the below snippet which is added subprojects for java 8 specific compilation?\ntasks.withType(JavaCompile) {\n        options.compilerArgs.remove(getDefaultJavaVersion())\n        options.compilerArgs.add(clientJavaVersion)\n    }", "author": "shrids", "createdAt": "2021-03-16T09:57:33Z", "path": "build.gradle", "diffHunk": "@@ -88,6 +88,13 @@ allprojects {\n         mavenLocal()\n     }\n \n+    gradle.projectsEvaluated {\n+        tasks.withType(JavaCompile) {\n+            sourceCompatibility = JavaVersion.VERSION_1_8", "originalCommit": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTQ2MTI0MQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595461241", "bodyText": "Removed", "author": "tkaitchuck", "createdAt": "2021-03-16T19:01:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAxNjkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAyMDg0Ng==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595020846", "bodyText": "Did not understand the reason for this change here.", "author": "shrids", "createdAt": "2021-03-16T10:02:58Z", "path": "client/src/main/java/io/pravega/client/connection/impl/ConnectionPoolImpl.java", "diffHunk": "@@ -194,6 +195,7 @@ public void pruneUnusedConnections() {\n     }\n \n     @Override\n+    @Synchronized", "originalCommit": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTQ2MTE2NQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595461165", "bodyText": "Removed", "author": "tkaitchuck", "createdAt": "2021-03-16T19:01:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAyMDg0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAyMzUwOA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595023508", "bodyText": "we could log the stream name here too...", "author": "shrids", "createdAt": "2021-03-16T10:06:35Z", "path": "controller/src/main/java/io/pravega/controller/server/eventProcessor/LocalController.java", "diffHunk": "@@ -159,7 +158,7 @@ public LocalController(ControllerService controller, boolean authorizationEnable\n             case INVALID_STREAM_NAME:\n                 throw new IllegalArgumentException(\"Illegal stream name: \" + streamConfig);", "originalCommit": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTAyOTI0OA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595029248", "bodyText": "\ud83d\udc4d  This should prevent port already in use on the GRPC server side.", "author": "shrids", "createdAt": "2021-03-16T10:14:42Z", "path": "controller/src/main/java/io/pravega/controller/server/rpc/grpc/GRPCServer.java", "diffHunk": "@@ -50,8 +52,9 @@ public GRPCServer(ControllerService controllerService, GRPCServerConfig serverCo\n         this.config = serverConfig;\n         GrpcAuthHelper authHelper = new GrpcAuthHelper(serverConfig.isAuthorizationEnabled(),\n                 serverConfig.getTokenSigningKey(), serverConfig.getAccessTokenTTLInSeconds());\n-        ServerBuilder<?> builder = ServerBuilder\n+        ServerBuilder<?> builder = NettyServerBuilder\n                 .forPort(serverConfig.getPort())\n+                .withChildOption(ChannelOption.SO_REUSEADDR, true)", "originalCommit": "46e3cb7d7eaa664a2e836d5578cd06b8c8ca32f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c3d9fb6f50c16353e0f63c0d4689bfe865033dc9", "url": "https://github.com/pravega/pravega/commit/c3d9fb6f50c16353e0f63c0d4689bfe865033dc9", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-16T10:49:20Z", "type": "commit"}, {"oid": "93f724698c66aefbfd25f8dd2ac25a5898e2bbb0", "url": "https://github.com/pravega/pravega/commit/93f724698c66aefbfd25f8dd2ac25a5898e2bbb0", "message": "PR feedback\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T18:53:54Z", "type": "commit"}, {"oid": "a0a2f3fc365ff268c2bfb3997b5bf89046424955", "url": "https://github.com/pravega/pravega/commit/a0a2f3fc365ff268c2bfb3997b5bf89046424955", "message": "Merge branch 'master' into faster-build", "committedDate": "2021-03-16T18:54:53Z", "type": "commit"}, {"oid": "475c0c938b6a9939c755a430d2ce3857dc0db340", "url": "https://github.com/pravega/pravega/commit/475c0c938b6a9939c755a430d2ce3857dc0db340", "message": "Merge branch 'faster-build' of github.com:tkaitchuck/pravega-1 into faster-build", "committedDate": "2021-03-16T18:55:15Z", "type": "commit"}, {"oid": "4d632399ae0503f43583529c4eca3fce614f92d3", "url": "https://github.com/pravega/pravega/commit/4d632399ae0503f43583529c4eca3fce614f92d3", "message": "Fix spelling\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-16T18:59:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5MDkzOA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595590938", "bodyText": "Is there a reason this is run here (in All Other Unit Tests). This will perform these tests for every project.", "author": "andreipaduroiu", "createdAt": "2021-03-16T22:44:50Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -190,10 +214,15 @@ jobs:\n         with:\n           path: ${{env.TEST_OUTPUT_CACHE_PATH}}\n           key: ${{github.run_id}}-${{github.job}}\n+      - name: Static analysis tests", "originalCommit": "4d632399ae0503f43583529c4eca3fce614f92d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYxOTM0Mg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595619342", "bodyText": "Yes. We want to run spotbugs on all of our code. It's here as opposed the the build step so that it can run in parallel to the unit tests.", "author": "tkaitchuck", "createdAt": "2021-03-16T23:58:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5MDkzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5MTg3Mg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595591872", "bodyText": "We don't use travis anymore. I am pretty sure it's safe to delete this file.", "author": "andreipaduroiu", "createdAt": "2021-03-16T22:46:54Z", "path": ".travis.yml", "diffHunk": "@@ -22,6 +22,7 @@ jobs:\n   include:\n     # Travis CI build has been deprecated in favor of GitHub Actions.\n     - stage: build\n+      name: check", "originalCommit": "4d632399ae0503f43583529c4eca3fce614f92d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYyMTc1NQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595621755", "bodyText": "Perhaps. We can do that in another PR.", "author": "tkaitchuck", "createdAt": "2021-03-17T00:05:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5MTg3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDEyNg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595594126", "bodyText": "Should this be set to the number of available processors? In Github Actions, we only have 2 cores per VM.", "author": "andreipaduroiu", "createdAt": "2021-03-16T22:52:02Z", "path": "gradle/java.gradle", "diffHunk": "@@ -90,11 +90,12 @@ plugins.withId('java') {\n         testLogging.showExceptions = true\n         testLogging.showStackTraces = true\n         testLogging.events = [\"FAILED\"]\n-        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 1\n+        maxParallelForks = System.properties['maxParallelForks'] ? System.properties['maxParallelForks'].toInteger() : 4", "originalCommit": "4d632399ae0503f43583529c4eca3fce614f92d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYxOTY4Ng==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595619686", "bodyText": "Is there a way to obtain the number of cores?", "author": "tkaitchuck", "createdAt": "2021-03-16T23:59:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDEyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg0ODY0Mw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595848643", "bodyText": "According to this reference:\nhttps://discuss.gradle.org/t/set-maxparallelforks-to-number-of-cores-on-the-current-machine/4505\nwe can use: Runtime.runtime.availableProcessors.", "author": "fpj", "createdAt": "2021-03-17T09:31:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDEyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDQ2NA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595594464", "bodyText": "I can't comment on the above binary file, but why did gradle-wrapper.jar change?", "author": "andreipaduroiu", "createdAt": "2021-03-16T22:52:57Z", "path": "gradle/wrapper/gradle-wrapper.properties", "diffHunk": "@@ -1,5 +1,5 @@\n distributionBase=GRADLE_USER_HOME\n distributionPath=wrapper/dists\n+distributionUrl=https\\://services.gradle.org/distributions/gradle-6.5.1-bin.zip", "originalCommit": "4d632399ae0503f43583529c4eca3fce614f92d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYyMjAwMA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595622000", "bodyText": "I upgraded gradle. However since I started this PR gradle was upgraded by someone else. So it now shouldn't make any difference. I will revert.", "author": "tkaitchuck", "createdAt": "2021-03-17T00:06:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDQ2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NDYzNg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595594636", "bodyText": "Are these really necessary?", "author": "andreipaduroiu", "createdAt": "2021-03-16T22:53:24Z", "path": "gradlew", "diffHunk": "@@ -43,11 +43,11 @@ DEFAULT_JVM_OPTS=\"\"\n # Use the maximum available, or set MAX_FD != -1 to use that value.\n MAX_FD=\"maximum\"\n \n-warn ( ) {\n+warn () {", "originalCommit": "4d632399ae0503f43583529c4eca3fce614f92d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NTE3OQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595595179", "bodyText": "Was this the source of that cyclical reference we saw every now and then in logs?", "author": "andreipaduroiu", "createdAt": "2021-03-16T22:54:45Z", "path": "segmentstore/server/src/main/java/io/pravega/segmentstore/server/containers/StreamSegmentContainer.java", "diffHunk": "@@ -339,8 +339,6 @@ private void doStop(Throwable cause) {\n                     Throwable failureCause = getFailureCause(this.durableLog, this.writer, this.metadataCleaner);\n                     if (failureCause == null) {\n                         failureCause = cause;\n-                    } else if (cause != null && failureCause != cause) {", "originalCommit": "4d632399ae0503f43583529c4eca3fce614f92d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYyMTA3NA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595621074", "bodyText": "When I was debugging some of the tests this error path caused a ref cycle which would in a different part of the code caused a OutOfStackSpace error because it sent error message processing into an infinite loop.\nI am not aware of this having been encountered anywhere else.", "author": "tkaitchuck", "createdAt": "2021-03-17T00:03:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NTE3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NzEyNw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595597127", "bodyText": "Let's use config.getWriteTimeout().seconds() for this. At least we'll have a way to configure it in case we need to.", "author": "andreipaduroiu", "createdAt": "2021-03-16T22:59:07Z", "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/Ledgers.java", "diffHunk": "@@ -78,20 +83,21 @@\n      */\n     static WriteHandle create(BookKeeper bookKeeper, BookKeeperConfig config, int logId) throws DurableDataLogException {\n         try {\n-\n-            return Exceptions.handleInterruptedCall(() ->\n-                    FutureUtils.result(bookKeeper.newCreateLedgerOp()\n-                            .withEnsembleSize(config.getBkEnsembleSize())\n-                            .withWriteQuorumSize(config.getBkWriteQuorumSize())\n-                            .withAckQuorumSize(config.getBkAckQuorumSize())\n-                            .withDigestType(config.getDigestType())\n-                            .withPassword(config.getBKPassword())\n-                            .withCustomMetadata(createLedgerCustomMetadata(logId))\n-                            .execute(), BK_EXCEPTION_HANDLER) );\n+            CompletableFuture<WriteHandle> future = bookKeeper.newCreateLedgerOp()\n+                .withEnsembleSize(config.getBkEnsembleSize())\n+                .withWriteQuorumSize(config.getBkWriteQuorumSize())\n+                .withAckQuorumSize(config.getBkAckQuorumSize())\n+                .withDigestType(config.getDigestType())\n+                .withPassword(config.getBKPassword())\n+                .withCustomMetadata(createLedgerCustomMetadata(logId))\n+                .execute();\n+            return Futures.getAndHandleExceptions(future, BK_EXCEPTION_HANDLER, 20, TimeUnit.SECONDS);", "originalCommit": "4d632399ae0503f43583529c4eca3fce614f92d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTYyNjEyMg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595626122", "bodyText": "Done", "author": "tkaitchuck", "createdAt": "2021-03-17T00:18:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTU5NzEyNw=="}], "type": "inlineReview"}, {"oid": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "url": "https://github.com/pravega/pravega/commit/48ef263b64da8e874dffb5608cae69f8f8ecc88a", "message": "PR feedback\n\nSigned-off-by: Tom Kaitchuck <tom.kaitchuck@emc.com>", "committedDate": "2021-03-17T00:18:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg0OTQ3NA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595849474", "bodyText": "Are we using rack awareness in the tests?", "author": "fpj", "createdAt": "2021-03-17T09:32:16Z", "path": "segmentstore/server/host/src/test/java/io/pravega/segmentstore/server/host/BookKeeperIntegrationTestBase.java", "diffHunk": "@@ -67,6 +68,8 @@ protected ServiceBuilderConfig getBuilderConfig(ServiceBuilderConfig.Builder con\n         String id = Integer.toString(instanceId);\n         return configBuilder\n                 .makeCopy()\n+                .include(BookKeeperConfig.builder().with(BookKeeperConfig.BK_ENFORCE_MIN_NUM_RACKS_PER_WRITE, false)", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjM4OTQyNQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596389425", "bodyText": "This is forcing it off.", "author": "tkaitchuck", "createdAt": "2021-03-17T21:18:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg0OTQ3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1MTcwNQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595851705", "bodyText": "This is setting a global timeout of two minutes, that's a lot, no?", "author": "fpj", "createdAt": "2021-03-17T09:35:22Z", "path": "segmentstore/server/src/test/java/io/pravega/segmentstore/server/reading/ContainerReadIndexTests.java", "diffHunk": "@@ -95,7 +95,7 @@\n     private static final Duration SHORT_TIMEOUT = Duration.ofMillis(20);\n \n     @Rule\n-    public Timeout globalTimeout = Timeout.seconds(TIMEOUT.getSeconds());\n+    public Timeout globalTimeout = Timeout.seconds(2 * TIMEOUT.getSeconds());", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjMwMDY5MA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596300690", "bodyText": "Yes", "author": "tkaitchuck", "createdAt": "2021-03-17T18:56:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1MTcwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NTg2MA==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595855860", "bodyText": "This is also setting to two minutes, is it necessary to make it that long?", "author": "fpj", "createdAt": "2021-03-17T09:40:41Z", "path": "segmentstore/server/src/test/java/io/pravega/segmentstore/server/store/StreamSegmentStoreTestBase.java", "diffHunk": "@@ -262,7 +263,7 @@ public void testSegmentRestoration() throws Exception {\n      *\n      * @throws Exception If an exception occurred.\n      */\n-    @Test\n+    @Test(timeout = 120000)", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjMwMDU2Nw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596300567", "bodyText": "It sometimes failed before.", "author": "tkaitchuck", "createdAt": "2021-03-17T18:56:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NTg2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NjgxNw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595856817", "bodyText": "This change seems unnecessary, what's the reason for this change?", "author": "fpj", "createdAt": "2021-03-17T09:41:59Z", "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperServiceRunner.java", "diffHunk": "@@ -52,7 +51,7 @@\n     public static final String TLS_KEY_STORE = \"tlsKeyStore\";\n     public static final String PROPERTY_LEDGERS_DIR = \"ledgersDir\"; // File System path to store ledger data.\n \n-    private static final InetAddress LOOPBACK_ADDRESS = InetAddress.getLoopbackAddress();\n+    private static final String LOOPBACK_ADDRESS = \"127.0.0.1\";", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjE5NDYxNQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596194615", "bodyText": "InetAddress.getLoopbackAddress() can return the IPv6 address, and appears to do so at random. When it does and the binding is on IPv4, this results in connection failures. I observe this locally but have never seen it on Travis or Github Actions.", "author": "tkaitchuck", "createdAt": "2021-03-17T16:38:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NjgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjY0NjE0Mw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596646143", "bodyText": "Instead of hardwiring 127.0.0.1, could we instead say use java.net.preferIPv4Stack for tests?", "author": "fpj", "createdAt": "2021-03-18T08:33:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg1NjgxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2NDA5Ng==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595864096", "bodyText": "Minor: remove leading white spaces. Shouldn't our checkstyle be complaining about these things?", "author": "fpj", "createdAt": "2021-03-17T09:51:29Z", "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/MetricProxy.java", "diffHunk": "@@ -12,26 +12,23 @@\n import com.google.common.base.Preconditions;\n import io.micrometer.core.instrument.Meter;\n import io.pravega.common.Exceptions;\n-\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.concurrent.atomic.AtomicReference;\n import java.util.function.Consumer;\n import lombok.Getter;\n-import lombok.extern.slf4j.Slf4j;\n \n /**\n  * Base class for a Metric Proxy.\n  *\n- * @param <T> Type of Metric.\n+ * @param <MetricT> Type of Metric.\n  */\n-@Slf4j\n-abstract class MetricProxy<T extends Metric> implements AutoCloseable {\n-    private final AtomicReference<T> instance = new AtomicReference<>();\n+abstract class MetricProxy<MetricT extends Metric, SelfT extends MetricProxy<MetricT, SelfT>> implements AutoCloseable {\n+    private final AtomicReference<MetricT> instance = new AtomicReference<>();\n     private final AtomicBoolean closed = new AtomicBoolean();\n-\n+    ", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjE5NjEzNg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596196136", "bodyText": "Checkstyle only considers trailing whitespace a problem on lines with stuff on them. Lines that are all whitespace are permitted.", "author": "tkaitchuck", "createdAt": "2021-03-17T16:40:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2NDA5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2NDg1Mw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595864853", "bodyText": "It sounds like checkstyle is missing this rule.", "author": "fpj", "createdAt": "2021-03-17T09:52:33Z", "path": "shared/metrics/src/main/java/io/pravega/shared/metrics/OpStatsLoggerImpl.java", "diffHunk": "@@ -14,16 +14,17 @@\n import io.micrometer.core.instrument.MeterRegistry;\n import io.micrometer.core.instrument.Timer;\n import io.micrometer.core.instrument.distribution.HistogramSnapshot;\n-\n import java.time.Duration;\n import java.util.EnumMap;\n import java.util.concurrent.TimeUnit;\n+import lombok.EqualsAndHashCode;\n \n import static io.pravega.shared.MetricsNames.failMetricName;\n \n+@EqualsAndHashCode\n class OpStatsLoggerImpl implements OpStatsLogger {\n     //region Members\n-\n+    ", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2OTE0Mw==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595869143", "bodyText": "Are you following any guidelines for test timeouts or are you determining it based on test failure observations?", "author": "fpj", "createdAt": "2021-03-17T09:58:06Z", "path": "test/integration/src/test/java/io/pravega/test/integration/SingleThreadEndToEndTest.java", "diffHunk": "@@ -24,7 +24,7 @@\n  */\n public class SingleThreadEndToEndTest {\n \n-    @Test(timeout = 30000)\n+    @Test(timeout = 60000)", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjE5NjgzMg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596196832", "bodyText": "Just observed timeouts.", "author": "tkaitchuck", "createdAt": "2021-03-17T16:40:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg2OTE0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg3Mjc5Mg==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595872792", "bodyText": "For completeness, why did you have to write this class and what's that RunNotifier?", "author": "fpj", "createdAt": "2021-03-17T10:03:00Z", "path": "test/testcommon/src/main/java/io/pravega/test/common/SerializedClassRunner.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/**\n+ * Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.pravega.test.common;\n+\n+import org.junit.runner.notification.RunNotifier;\n+import org.junit.runners.BlockJUnit4ClassRunner;\n+import org.junit.runners.model.InitializationError;\n+\n+public class SerializedClassRunner extends BlockJUnit4ClassRunner {", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjE5OTU2MQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r596199561", "bodyText": "Added a Javadoc.\nIt's needed for some metrics tests which cannot be run in parallel.\nRunNotifier is a Junit class. It's not really being used here except as a pass-through to the parent implementation.", "author": "tkaitchuck", "createdAt": "2021-03-17T16:44:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg3Mjc5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTg3NzAwNQ==", "url": "https://github.com/pravega/pravega/pull/4999#discussion_r595877005", "bodyText": "Since we are moving static analysis to unit_other, this should be changed to just Compile.", "author": "fpj", "createdAt": "2021-03-17T10:08:40Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -78,7 +78,7 @@ jobs:\n           path: ${{env.BUILD_CACHE_PATH}}\n           key: ${{github.run_id}}\n       - name: Compile & Static Analysis", "originalCommit": "48ef263b64da8e874dffb5608cae69f8f8ecc88a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}