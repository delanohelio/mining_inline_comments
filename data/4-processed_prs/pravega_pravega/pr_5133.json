{"pr_number": 5133, "pr_title": "Issue 5132: segmentstore should use host name when TLS is enabled in standalone", "pr_createdAt": "2020-09-01T20:44:48Z", "pr_url": "https://github.com/pravega/pravega/pull/5133", "timeline": [{"oid": "4d04c0cb2a7efb6831dd604d2e68294a542922b4", "url": "https://github.com/pravega/pravega/commit/4d04c0cb2a7efb6831dd604d2e68294a542922b4", "message": "segmentstore should publish host name when tls is enabled in standalone\n\nSigned-off-by: Wenqi M <452787782@qq.com>", "committedDate": "2020-09-01T18:13:21Z", "type": "commit"}, {"oid": "7e531e2576fbfe0a2f9ed586016cbb2df2123a19", "url": "https://github.com/pravega/pravega/commit/7e531e2576fbfe0a2f9ed586016cbb2df2123a19", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-09-01T20:45:02Z", "type": "commit"}, {"oid": "4ed30108b77584b4529e25e59214f5e3f3f88b76", "url": "https://github.com/pravega/pravega/commit/4ed30108b77584b4529e25e59214f5e3f3f88b76", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-09-02T03:21:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTYwMTYxNA==", "url": "https://github.com/pravega/pravega/pull/5133#discussion_r481601614", "bodyText": "Curious, shouldn't this be PUBLISHED_IP_ADDRESS instead?\nI understand that you are trying to change this from IP address 127.0.1.1 that the Segment store listens on, to localhost, so that hostname verification can be turned on for client/controller-to-segment store communication. Is that correct?", "author": "ravisharda", "createdAt": "2020-09-02T03:24:21Z", "path": "standalone/src/main/java/io/pravega/local/InProcPravegaCluster.java", "diffHunk": "@@ -278,6 +278,7 @@ private void startLocalSegmentStore(int segmentStoreId) throws Exception {\n                         .with(ServiceConfig.KEY_FILE, this.keyFile)\n                         .with(ServiceConfig.CERT_FILE, this.certFile)\n                         .with(ServiceConfig.ENABLE_TLS_RELOAD, this.enableTlsReload)\n+                        .with(ServiceConfig.LISTENING_IP_ADDRESS, this.enableTls ? \"localhost\" : \"\")", "originalCommit": "4ed30108b77584b4529e25e59214f5e3f3f88b76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjYwNDUzMQ==", "url": "https://github.com/pravega/pravega/pull/5133#discussion_r482604531", "bodyText": "Thanks Ravi, yes, your understanding is correct, this is for hostname verification for segmentstore.\nActually I want to ask what's the difference between Published and Listening address? The reason I use Listening address is from this comment, looks like if we don't specify published address, it will default to listening address.", "author": "Tristan1900", "createdAt": "2020-09-02T23:50:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTYwMTYxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjcyNDA5MA==", "url": "https://github.com/pravega/pravega/pull/5133#discussion_r482724090", "bodyText": "Yes, if published IP and port are not registered with the Controller for the Segment Store service, the Controller returns the service's listening IP and port to the clients afaik. cc @andreipaduroiu", "author": "ravisharda", "createdAt": "2020-09-03T06:05:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTYwMTYxNA=="}], "type": "inlineReview"}, {"oid": "51f116171baa117a661ede7e7cf2a291e5a5d941", "url": "https://github.com/pravega/pravega/commit/51f116171baa117a661ede7e7cf2a291e5a5d941", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-10-15T02:12:07Z", "type": "commit"}, {"oid": "7a9a3e0887e9841da671304bededbd07c5e4fc19", "url": "https://github.com/pravega/pravega/commit/7a9a3e0887e9841da671304bededbd07c5e4fc19", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-10-16T18:36:34Z", "type": "commit"}, {"oid": "58799a3517f0a46ea53619e83d50d2fc17d2f647", "url": "https://github.com/pravega/pravega/commit/58799a3517f0a46ea53619e83d50d2fc17d2f647", "message": "add published host\n\nSigned-off-by: wenqi <452787782@qq.com>", "committedDate": "2020-10-16T19:22:41Z", "type": "commit"}, {"oid": "2a739bc5b14e06b1061d76622d72f48a48d01c3a", "url": "https://github.com/pravega/pravega/commit/2a739bc5b14e06b1061d76622d72f48a48d01c3a", "message": "Merge branch 'add-hostname-for-standalone' of https://github.com/Tristan1900/pravega into add-hostname-for-standalone", "committedDate": "2020-10-16T19:22:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQxNzcwMA==", "url": "https://github.com/pravega/pravega/pull/5133#discussion_r507417700", "bodyText": "@Tristan1900 one more ask: could you please extract the localhost string into a constant and use that here and above, so that it can be easily changed in one place (to say loopback address 127.0.0.1 or another interface during testing).", "author": "ravisharda", "createdAt": "2020-10-19T03:42:26Z", "path": "standalone/src/main/java/io/pravega/local/InProcPravegaCluster.java", "diffHunk": "@@ -278,6 +278,8 @@ private void startLocalSegmentStore(int segmentStoreId) throws Exception {\n                         .with(ServiceConfig.KEY_FILE, this.keyFile)\n                         .with(ServiceConfig.CERT_FILE, this.certFile)\n                         .with(ServiceConfig.ENABLE_TLS_RELOAD, this.enableTlsReload)\n+                        .with(ServiceConfig.LISTENING_IP_ADDRESS, this.enableTls ? \"localhost\" : \"\")\n+                        .with(ServiceConfig.PUBLISHED_IP_ADDRESS, this.enableTls ? \"localhost\" : \"\")", "originalCommit": "2a739bc5b14e06b1061d76622d72f48a48d01c3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQxODg0NA==", "url": "https://github.com/pravega/pravega/pull/5133#discussion_r507418844", "bodyText": "Also, curious isn't the condition used here wrong? It sets LISTENING_IP_ADDRESS and PUBLISHED_IP_ADDRESS to empty string, if TLS is not enabled. Am I missing something?", "author": "ravisharda", "createdAt": "2020-10-19T03:45:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQxNzcwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ1ODQxNw==", "url": "https://github.com/pravega/pravega/pull/5133#discussion_r507458417", "bodyText": "Sure, added. Thanks for pointing out.\nEmpty string is the default value for those two parameters. The constructor will replace the empty string with the right ip address in here", "author": "Tristan1900", "createdAt": "2020-10-19T04:57:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQxNzcwMA=="}], "type": "inlineReview"}, {"oid": "7979ff18c937b915fcd9279fc9c8c33297a55d2e", "url": "https://github.com/pravega/pravega/commit/7979ff18c937b915fcd9279fc9c8c33297a55d2e", "message": "add constant\n\nSigned-off-by: wenqi <452787782@qq.com>", "committedDate": "2020-10-19T04:47:39Z", "type": "commit"}, {"oid": "dd389788e2e4c80e74b0a39d48d74dd6df72d3be", "url": "https://github.com/pravega/pravega/commit/dd389788e2e4c80e74b0a39d48d74dd6df72d3be", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-10-28T05:28:16Z", "type": "commit"}, {"oid": "b749332012636885e6eac799ef62a562e109ca1c", "url": "https://github.com/pravega/pravega/commit/b749332012636885e6eac799ef62a562e109ca1c", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-10-29T19:48:43Z", "type": "commit"}, {"oid": "e4a20253b234798017ae09d647530a4445352a3b", "url": "https://github.com/pravega/pravega/commit/e4a20253b234798017ae09d647530a4445352a3b", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-11-05T18:49:43Z", "type": "commit"}, {"oid": "36634bc40d655bbc076e17efd0387da0cdf1c55f", "url": "https://github.com/pravega/pravega/commit/36634bc40d655bbc076e17efd0387da0cdf1c55f", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-11-11T20:43:23Z", "type": "commit"}, {"oid": "ca904e329249412780b7f920197b6a5476dda50f", "url": "https://github.com/pravega/pravega/commit/ca904e329249412780b7f920197b6a5476dda50f", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-11-12T23:32:27Z", "type": "commit"}, {"oid": "8835a47fbe0d67bb2057d504e1318d8b53690a98", "url": "https://github.com/pravega/pravega/commit/8835a47fbe0d67bb2057d504e1318d8b53690a98", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-11-13T19:28:17Z", "type": "commit"}, {"oid": "290b8c736902c21349fcc5a0df204df5205fae41", "url": "https://github.com/pravega/pravega/commit/290b8c736902c21349fcc5a0df204df5205fae41", "message": "Merge branch 'master' into add-hostname-for-standalone", "committedDate": "2020-11-16T20:09:24Z", "type": "commit"}]}