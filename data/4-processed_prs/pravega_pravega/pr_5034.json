{"pr_number": 5034, "pr_title": "Issue 5033: (SLTS) - Read ChunkedSegmentStorageConfig from properties.", "pr_createdAt": "2020-08-05T23:04:54Z", "pr_url": "https://github.com/pravega/pravega/pull/5034", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE0ODgxNA==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r466148814", "bodyText": "Is this right?\nWhat about 'storage' ?", "author": "eolivelli", "createdAt": "2020-08-06T05:07:17Z", "path": "segmentstore/storage/src/main/java/io/pravega/segmentstore/storage/chunklayer/ChunkedSegmentStorageConfig.java", "diffHunk": "@@ -35,6 +48,8 @@\n             .appendsDisabled(false)\n             .build();\n \n+    static final String COMPONENT_CODE = \"pravegaservice\";", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkzNjQ3OQ==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468936479", "bodyText": "fixed. Thanks", "author": "sachin-j-joshi", "createdAt": "2020-08-12T00:24:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE0ODgxNA=="}], "type": "inlineReview"}, {"oid": "1b50bf14d0fc64330f04b394761775e50f62dcd7", "url": "https://github.com/pravega/pravega/commit/1b50bf14d0fc64330f04b394761775e50f62dcd7", "message": "Issue 5033: (SLTS) - Read ChunkedSegmentStorageConfig from properties.\n\nSigned-off-by: Sachin Joshi <sachin.joshi@emc.com>", "committedDate": "2020-08-06T23:25:16Z", "type": "commit"}, {"oid": "1b50bf14d0fc64330f04b394761775e50f62dcd7", "url": "https://github.com/pravega/pravega/commit/1b50bf14d0fc64330f04b394761775e50f62dcd7", "message": "Issue 5033: (SLTS) - Read ChunkedSegmentStorageConfig from properties.\n\nSigned-off-by: Sachin Joshi <sachin.joshi@emc.com>", "committedDate": "2020-08-06T23:25:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0MzUwOQ==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468143509", "bodyText": "revert this", "author": "andreipaduroiu", "createdAt": "2020-08-10T19:50:44Z", "path": "bindings/src/main/java/io/pravega/storage/filesystem/FileSystemSimpleStorageFactory.java", "diffHunk": "@@ -13,16 +13,19 @@\n import io.pravega.segmentstore.storage.StorageFactory;\n import io.pravega.segmentstore.storage.chunklayer.ChunkedSegmentStorage;\n import io.pravega.segmentstore.storage.chunklayer.ChunkedSegmentStorageConfig;\n+import lombok.AllArgsConstructor;\n import lombok.NonNull;\n-import lombok.RequiredArgsConstructor;\n \n import java.util.concurrent.ExecutorService;\n \n /**\n- * Factory for FileSystem {@link Storage} implemented using {@link ChunkedSegmentStorage} and {@link FileSystemChunkStorage}.\n+ * Factory for ExtendedS3 {@link Storage} implemented using {@link ChunkedSegmentStorage} and {@link FileSystemChunkStorage}.", "originalCommit": "1b50bf14d0fc64330f04b394761775e50f62dcd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkzMzQwOA==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468933408", "bodyText": "fixed.", "author": "sachin-j-joshi", "createdAt": "2020-08-12T00:13:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0MzUwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0MzU5Mw==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468143593", "bodyText": "And this.", "author": "andreipaduroiu", "createdAt": "2020-08-10T19:50:55Z", "path": "bindings/src/main/java/io/pravega/storage/filesystem/FileSystemSimpleStorageFactory.java", "diffHunk": "@@ -13,16 +13,19 @@\n import io.pravega.segmentstore.storage.StorageFactory;\n import io.pravega.segmentstore.storage.chunklayer.ChunkedSegmentStorage;\n import io.pravega.segmentstore.storage.chunklayer.ChunkedSegmentStorageConfig;\n+import lombok.AllArgsConstructor;\n import lombok.NonNull;\n-import lombok.RequiredArgsConstructor;\n \n import java.util.concurrent.ExecutorService;\n \n /**\n- * Factory for FileSystem {@link Storage} implemented using {@link ChunkedSegmentStorage} and {@link FileSystemChunkStorage}.\n+ * Factory for ExtendedS3 {@link Storage} implemented using {@link ChunkedSegmentStorage} and {@link FileSystemChunkStorage}.\n  */\n-@RequiredArgsConstructor\n+@AllArgsConstructor", "originalCommit": "1b50bf14d0fc64330f04b394761775e50f62dcd7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0MzgzNg==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468143836", "bodyText": "I don't see why this is needed. RequiredArgsConstructor will generate the constructor for all final members.", "author": "andreipaduroiu", "createdAt": "2020-08-10T19:51:25Z", "path": "bindings/src/main/java/io/pravega/storage/hdfs/HDFSSimpleStorageFactory.java", "diffHunk": "@@ -13,18 +13,23 @@\n import io.pravega.segmentstore.storage.StorageFactory;\n import io.pravega.segmentstore.storage.chunklayer.ChunkedSegmentStorage;\n import io.pravega.segmentstore.storage.chunklayer.ChunkedSegmentStorageConfig;\n+import lombok.AllArgsConstructor;\n import lombok.NonNull;\n-import lombok.RequiredArgsConstructor;\n \n import java.util.concurrent.Executor;\n \n /**\n  * Factory for HDFS {@link Storage} implemented using {@link ChunkedSegmentStorage} and {@link HDFSChunkStorage}.\n  */\n-@RequiredArgsConstructor\n+@AllArgsConstructor", "originalCommit": "1b50bf14d0fc64330f04b394761775e50f62dcd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkzMzM0Nw==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468933347", "bodyText": "fixed", "author": "sachin-j-joshi", "createdAt": "2020-08-12T00:13:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0MzgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NDQ2MQ==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468144461", "bodyText": "Please rephrase this to be refer to the max argument.", "author": "andreipaduroiu", "createdAt": "2020-08-10T19:52:39Z", "path": "config/config.properties", "diffHunk": "@@ -106,6 +106,47 @@ pravegaservice.dataLog.impl.name=BOOKKEEPER\n # pravegaservice.storage.layout=ROLLING_STORAGE\n # NOTE: ChunkedSegmentStorage is an experimental feature. Its behavior and/or API should be expected to be in flux until fully released.\n \n+# Size of chunk in bytes above which it is no longer considered a small object.\n+# For small source objects, concat is not used.\n+# Valid values: non-negative long\n+# Default value: 0\n+# storage.concat.size.bytes.min=0\n+\n+# Size of chunk in bytes above which it is no longer considered for concat.", "originalCommit": "1b50bf14d0fc64330f04b394761775e50f62dcd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkzMzMwOQ==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468933309", "bodyText": "fixed", "author": "sachin-j-joshi", "createdAt": "2020-08-12T00:13:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NDQ2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NTY0NQ==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468145645", "bodyText": "Please be explicit about the bounds. A long can be a signed long or unsigned long. In this case, if I remember, the upper bound is 2^62, isn't it?\nPlease fix this for the other config descriptions too.", "author": "andreipaduroiu", "createdAt": "2020-08-10T19:54:53Z", "path": "config/config.properties", "diffHunk": "@@ -106,6 +106,47 @@ pravegaservice.dataLog.impl.name=BOOKKEEPER\n # pravegaservice.storage.layout=ROLLING_STORAGE\n # NOTE: ChunkedSegmentStorage is an experimental feature. Its behavior and/or API should be expected to be in flux until fully released.\n \n+# Size of chunk in bytes above which it is no longer considered a small object.\n+# For small source objects, concat is not used.\n+# Valid values: non-negative long\n+# Default value: 0\n+# storage.concat.size.bytes.min=0\n+\n+# Size of chunk in bytes above which it is no longer considered for concat.\n+# Valid values: non-negative long\n+# Default value: 9223372036854775807\n+# storage.concat.size.bytes.max=9223372036854775807\n+\n+# Maximum size for the buffer used while copying of data from one chunk to other.\n+# Valid values: non-negative integer\n+# Default value: 1048576 (1 MB)\n+# storage.appends.buffer.size.bytes.max=1048576\n+\n+# Max number of indexed segments to keep in read cache.\n+# Valid values: non-negative integer\n+# Default value: 1024 (1 K)\n+# storage.readindex.segments.max=1024\n+\n+# Max number of indexed chunks to keep per segment in read cache.\n+# Valid values: non-negative integer\n+# Default value: 1024 (1 K)\n+# storage.readindex.chunksPerSegment.max=1024\n+\n+# Max number of indexed chunks to keep in cache.\n+# Valid values: non-negative integer\n+# Default value: 16384 (16 K)\n+# storage.readindex.chunks.max=16384\n+\n+# The maximum size of a single Segment Chunk in Storage for metadata segments.\n+# Valid values: non-negative long", "originalCommit": "1b50bf14d0fc64330f04b394761775e50f62dcd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkzMzI3MA==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468933270", "bodyText": "done", "author": "sachin-j-joshi", "createdAt": "2020-08-12T00:13:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NTY0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NjA4MA==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468146080", "bodyText": "For someone who is not really familiar with this, it makes more sense to name this enabled rather than disabled.", "author": "andreipaduroiu", "createdAt": "2020-08-10T19:55:41Z", "path": "config/config.properties", "diffHunk": "@@ -106,6 +106,47 @@ pravegaservice.dataLog.impl.name=BOOKKEEPER\n # pravegaservice.storage.layout=ROLLING_STORAGE\n # NOTE: ChunkedSegmentStorage is an experimental feature. Its behavior and/or API should be expected to be in flux until fully released.\n \n+# Size of chunk in bytes above which it is no longer considered a small object.\n+# For small source objects, concat is not used.\n+# Valid values: non-negative long\n+# Default value: 0\n+# storage.concat.size.bytes.min=0\n+\n+# Size of chunk in bytes above which it is no longer considered for concat.\n+# Valid values: non-negative long\n+# Default value: 9223372036854775807\n+# storage.concat.size.bytes.max=9223372036854775807\n+\n+# Maximum size for the buffer used while copying of data from one chunk to other.\n+# Valid values: non-negative integer\n+# Default value: 1048576 (1 MB)\n+# storage.appends.buffer.size.bytes.max=1048576\n+\n+# Max number of indexed segments to keep in read cache.\n+# Valid values: non-negative integer\n+# Default value: 1024 (1 K)\n+# storage.readindex.segments.max=1024\n+\n+# Max number of indexed chunks to keep per segment in read cache.\n+# Valid values: non-negative integer\n+# Default value: 1024 (1 K)\n+# storage.readindex.chunksPerSegment.max=1024\n+\n+# Max number of indexed chunks to keep in cache.\n+# Valid values: non-negative integer\n+# Default value: 16384 (16 K)\n+# storage.readindex.chunks.max=16384\n+\n+# The maximum size of a single Segment Chunk in Storage for metadata segments.\n+# Valid values: non-negative long\n+# Default value: 4611686018427387903\n+# storage.metadata.rollover.size.bytes.max=4611686018427387903\n+\n+# Whether the append functionality is disabled.\n+# Valid values: true, false\n+# Default value: false\n+# storage.appends.disable=false", "originalCommit": "1b50bf14d0fc64330f04b394761775e50f62dcd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkzMzIzNw==", "url": "https://github.com/pravega/pravega/pull/5034#discussion_r468933237", "bodyText": "done", "author": "sachin-j-joshi", "createdAt": "2020-08-12T00:12:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NjA4MA=="}], "type": "inlineReview"}, {"oid": "7372a02dabf08bdb89ac3296fbff33248ae8e9e9", "url": "https://github.com/pravega/pravega/commit/7372a02dabf08bdb89ac3296fbff33248ae8e9e9", "message": "Issue 5033: (SLTS) - Use appends.enabled instead of appends.disabled. Address review comments.\n\nSigned-off-by: Sachin Joshi <sachin.joshi@emc.com>", "committedDate": "2020-08-12T00:09:33Z", "type": "commit"}, {"oid": "4622b7bc713f00addd803a72c782f309f8bd7e77", "url": "https://github.com/pravega/pravega/commit/4622b7bc713f00addd803a72c782f309f8bd7e77", "message": "Merge branch 'master' into issue-5033-init-ChunkedSegmentStorageConfig-from-file", "committedDate": "2020-08-12T14:50:20Z", "type": "commit"}, {"oid": "df9de49b2f450215b2e7351012f342bfceb968a4", "url": "https://github.com/pravega/pravega/commit/df9de49b2f450215b2e7351012f342bfceb968a4", "message": "Merge branch 'master' into issue-5033-init-ChunkedSegmentStorageConfig-from-file", "committedDate": "2020-08-12T17:49:54Z", "type": "commit"}]}