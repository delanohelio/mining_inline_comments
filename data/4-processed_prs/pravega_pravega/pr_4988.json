{"pr_number": 4988, "pr_title": "Issue 4977: Add Actions CI for Gradle, Codecov, Java 11", "pr_createdAt": "2020-07-29T05:45:01Z", "pr_url": "https://github.com/pravega/pravega/pull/4988", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "96c2ce9a51ad7824542a253244b9dec9e46b2509", "url": "https://github.com/pravega/pravega/commit/96c2ce9a51ad7824542a253244b9dec9e46b2509", "message": "add Actions CI for Gradle, Codecov, DCO, Java 8/11\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-07-29T16:10:31Z", "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "268f65b3529256564e5312f33cfa140a0f83bf02", "url": "https://github.com/pravega/pravega/commit/268f65b3529256564e5312f33cfa140a0f83bf02", "message": "separate build & test jobs, enable matrix in build job\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-08-11T23:28:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYxMTIzMw==", "url": "https://github.com/pravega/pravega/pull/4988#discussion_r469611233", "bodyText": "If we want this to be fast and not run integration tests, just add the argument:\n--exclude-task test:integration:test", "author": "tkaitchuck", "createdAt": "2020-08-12T23:56:44Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -0,0 +1,69 @@\n+# This workflow will build a Java project with Gradle\n+# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-gradle\n+\n+name: build\n+\n+on:\n+  push:\n+    branches: [ master ]\n+  pull_request:\n+    branches: [ master ]\n+\n+jobs:\n+  build:\n+\n+    runs-on: ubuntu-latest\n+    strategy:\n+      matrix:\n+        java: [8, 11, 14]\n+\n+    name: Java ${{ matrix.java }}\n+    steps:\n+    - uses: actions/checkout@v1\n+    - name: Restore local Gradle & Maven cache\n+      uses: actions/cache@v2.1.0\n+      with:\n+        path: |\n+          .gradle\n+          ~/.gradle\n+          ~/.m2\n+        key: gradle-m2-java-${{ matrix.java }}\n+        restore-keys: |\n+          gradle-m2-java-\n+          gradle-m2\n+    - name: Set up JDK ${{ matrix.java }}\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: ${{ matrix.java }}\n+    - name: Assemble with Gradle\n+      run: ./gradlew assemble\n+    - name: Javadoc with Gradle\n+      run: ./gradlew javadocs\n+\n+  test:\n+\n+    needs: build\n+    runs-on: ubuntu-latest\n+\n+    name: Test on Java 8\n+    steps:\n+    - uses: actions/checkout@v1\n+    - name: Restore local Gradle & Maven cache\n+      uses: actions/cache@v2.1.0\n+      with:\n+        path: |\n+          .gradle\n+          ~/.gradle\n+          ~/.m2\n+        key: gradle-m2-java-8\n+        restore-keys: |\n+          gradle-m2-java-\n+          gradle-m2\n+    - name: Set up JDK 8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 8\n+    - name: Check with Gradle\n+      run: ./gradlew check", "originalCommit": "268f65b3529256564e5312f33cfa140a0f83bf02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcwNTYxOQ==", "url": "https://github.com/pravega/pravega/pull/4988#discussion_r470705619", "bodyText": "I think we do want to run integration tests. Maybe not for all JDKs, but at least for one of them.", "author": "andreipaduroiu", "createdAt": "2020-08-14T15:44:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYxMTIzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQxMjcwNA==", "url": "https://github.com/pravega/pravega/pull/4988#discussion_r539412704", "bodyText": "./gradlew assemble is run against Java 11 and Java 14 in parallel, and ./gradlew check (including integration tests) is run against only Java 11 after the assemble workflow is successful.", "author": "derekm", "createdAt": "2020-12-09T15:39:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYxMTIzMw=="}], "type": "inlineReview"}, {"oid": "dd474684a22c81d3a95fb34dd372a17dc29ed681", "url": "https://github.com/pravega/pravega/commit/dd474684a22c81d3a95fb34dd372a17dc29ed681", "message": "remove Java 8 build; test with Java 11", "committedDate": "2020-11-09T19:57:53Z", "type": "forcePushed"}, {"oid": "8a6d95c7400315bbd2e0cb28fbd5d336d0ecfab0", "url": "https://github.com/pravega/pravega/commit/8a6d95c7400315bbd2e0cb28fbd5d336d0ecfab0", "message": "remove Java 8 build; test with Java 11\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-09T15:25:22Z", "type": "forcePushed"}, {"oid": "7e80dcf08df6801e1c22fe25cda85e43b4a8aa64", "url": "https://github.com/pravega/pravega/commit/7e80dcf08df6801e1c22fe25cda85e43b4a8aa64", "message": "run unit & integration tests serially, not in parallel\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-09T23:36:24Z", "type": "forcePushed"}, {"oid": "8434aad50806b873169f6d2860445e0517a6646e", "url": "https://github.com/pravega/pravega/commit/8434aad50806b873169f6d2860445e0517a6646e", "message": "build with only Java 11, remove 14 from matrix build\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-09T23:39:33Z", "type": "forcePushed"}, {"oid": "f8a66bf5a346c9e47c2a3694d09dcd800c5dd210", "url": "https://github.com/pravega/pravega/commit/f8a66bf5a346c9e47c2a3694d09dcd800c5dd210", "message": "build with only Java 11, remove 14 from matrix build\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-10T18:00:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE1Nzk2MQ==", "url": "https://github.com/pravega/pravega/pull/4988#discussion_r543157961", "bodyText": "we could use ./gradlew assemble --parallel. This reduced the time taken by this gradle task in my dev box.", "author": "shrids", "createdAt": "2020-12-15T08:54:06Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -0,0 +1,73 @@\n+# This workflow will build a Java project with Gradle\n+# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-gradle\n+\n+name: build\n+\n+on:\n+  push:\n+    branches: [ master ]\n+  pull_request:\n+    branches: [ master ]\n+\n+jobs:\n+  build:\n+\n+    runs-on: ubuntu-latest\n+    strategy:\n+      matrix:\n+        java: [11]\n+\n+    name: Java ${{ matrix.java }}\n+    steps:\n+    - uses: actions/checkout@v1\n+    - name: Restore local Gradle & Maven cache\n+      uses: actions/cache@v2.1.0\n+      with:\n+        path: |\n+          .gradle\n+          ~/.gradle\n+          ~/.m2\n+        key: gradle-m2-java-${{ matrix.java }}\n+        restore-keys: |\n+          gradle-m2-java-\n+          gradle-m2\n+    - name: Set up JDK ${{ matrix.java }}\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: ${{ matrix.java }}\n+    - name: Assemble with Gradle\n+      run: ./gradlew assemble", "originalCommit": "b995e272d0de078c1aabf8c285858570530e561c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk4NDkyNg==", "url": "https://github.com/pravega/pravega/pull/4988#discussion_r551984926", "bodyText": "with only 2 CPUs, the reduction in runtime isn't as dramatic; but if we ever get to targeting our own hosted runners (perhaps via CNCF infra), maybe we can allocate more CPUs later on", "author": "derekm", "createdAt": "2021-01-05T14:59:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE1Nzk2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2MDY3Mg==", "url": "https://github.com/pravega/pravega/pull/4988#discussion_r543160672", "bodyText": "This step can be removed since ./gradlew assemble invokes gradle task javadocs", "author": "shrids", "createdAt": "2020-12-15T08:58:08Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -0,0 +1,73 @@\n+# This workflow will build a Java project with Gradle\n+# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-gradle\n+\n+name: build\n+\n+on:\n+  push:\n+    branches: [ master ]\n+  pull_request:\n+    branches: [ master ]\n+\n+jobs:\n+  build:\n+\n+    runs-on: ubuntu-latest\n+    strategy:\n+      matrix:\n+        java: [11]\n+\n+    name: Java ${{ matrix.java }}\n+    steps:\n+    - uses: actions/checkout@v1\n+    - name: Restore local Gradle & Maven cache\n+      uses: actions/cache@v2.1.0\n+      with:\n+        path: |\n+          .gradle\n+          ~/.gradle\n+          ~/.m2\n+        key: gradle-m2-java-${{ matrix.java }}\n+        restore-keys: |\n+          gradle-m2-java-\n+          gradle-m2\n+    - name: Set up JDK ${{ matrix.java }}\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: ${{ matrix.java }}\n+    - name: Assemble with Gradle\n+      run: ./gradlew assemble\n+    - name: Javadoc with Gradle\n+      run: ./gradlew javadocs", "originalCommit": "b995e272d0de078c1aabf8c285858570530e561c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk4Mzc2OA==", "url": "https://github.com/pravega/pravega/pull/4988#discussion_r551983768", "bodyText": "thanks", "author": "derekm", "createdAt": "2021-01-05T14:57:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2MDY3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2MTU2MA==", "url": "https://github.com/pravega/pravega/pull/4988#discussion_r543161560", "bodyText": "we can use --parallel option.", "author": "shrids", "createdAt": "2020-12-15T08:59:27Z", "path": ".github/workflows/gradle.yml", "diffHunk": "@@ -0,0 +1,73 @@\n+# This workflow will build a Java project with Gradle\n+# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-gradle\n+\n+name: build\n+\n+on:\n+  push:\n+    branches: [ master ]\n+  pull_request:\n+    branches: [ master ]\n+\n+jobs:\n+  build:\n+\n+    runs-on: ubuntu-latest\n+    strategy:\n+      matrix:\n+        java: [11]\n+\n+    name: Java ${{ matrix.java }}\n+    steps:\n+    - uses: actions/checkout@v1\n+    - name: Restore local Gradle & Maven cache\n+      uses: actions/cache@v2.1.0\n+      with:\n+        path: |\n+          .gradle\n+          ~/.gradle\n+          ~/.m2\n+        key: gradle-m2-java-${{ matrix.java }}\n+        restore-keys: |\n+          gradle-m2-java-\n+          gradle-m2\n+    - name: Set up JDK ${{ matrix.java }}\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: ${{ matrix.java }}\n+    - name: Assemble with Gradle\n+      run: ./gradlew assemble\n+    - name: Javadoc with Gradle\n+      run: ./gradlew javadocs\n+    - name: Rat, Checkstyle & Spotbugs with Gradle\n+      run: ./gradlew rat checkstyleMain checkstyleTest spotbugsMain spotbugsTest", "originalCommit": "b995e272d0de078c1aabf8c285858570530e561c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "34cf4f0c3636ba4005ff9c59a3e6aefb9a0dcb67", "url": "https://github.com/pravega/pravega/commit/34cf4f0c3636ba4005ff9c59a3e6aefb9a0dcb67", "message": "add Actions CI for Gradle, Codecov & Java 8\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-23T11:59:57Z", "type": "commit"}, {"oid": "30e081c18583be6e1a5fab505f9439eabdb00c93", "url": "https://github.com/pravega/pravega/commit/30e081c18583be6e1a5fab505f9439eabdb00c93", "message": "separate build & test jobs, enable matrix in build job\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-23T11:59:57Z", "type": "commit"}, {"oid": "e2be61cfe845601bc31bc4147963fd62b82e9cd3", "url": "https://github.com/pravega/pravega/commit/e2be61cfe845601bc31bc4147963fd62b82e9cd3", "message": "remove Java 8 build; test with Java 11\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-23T11:59:57Z", "type": "commit"}, {"oid": "7e0405b0dad6da9244bb47871e0d53a27810c6e0", "url": "https://github.com/pravega/pravega/commit/7e0405b0dad6da9244bb47871e0d53a27810c6e0", "message": "run source checks in build, split unit/integration tests\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-23T11:59:57Z", "type": "commit"}, {"oid": "084db010f50cde17d143ad91ff372a2fadd3cb50", "url": "https://github.com/pravega/pravega/commit/084db010f50cde17d143ad91ff372a2fadd3cb50", "message": "run unit & integration tests serially, not in parallel\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-23T11:59:57Z", "type": "commit"}, {"oid": "25f9ee00dc58bd6750860c468266150db482103c", "url": "https://github.com/pravega/pravega/commit/25f9ee00dc58bd6750860c468266150db482103c", "message": "build with only Java 11, remove 14 from matrix build\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2020-12-23T11:59:57Z", "type": "commit"}, {"oid": "5d1af555ad3d35b3a26978fa2405c54077d77f82", "url": "https://github.com/pravega/pravega/commit/5d1af555ad3d35b3a26978fa2405c54077d77f82", "message": "Add CLI test configuration file to do not disrupt configuration of other tests.\n\nSigned-off-by: Ra\u00fal <raul.gracia@emc.com>", "committedDate": "2020-12-23T11:59:57Z", "type": "commit"}, {"oid": "5d1af555ad3d35b3a26978fa2405c54077d77f82", "url": "https://github.com/pravega/pravega/commit/5d1af555ad3d35b3a26978fa2405c54077d77f82", "message": "Add CLI test configuration file to do not disrupt configuration of other tests.\n\nSigned-off-by: Ra\u00fal <raul.gracia@emc.com>", "committedDate": "2020-12-23T11:59:57Z", "type": "forcePushed"}, {"oid": "c6ea0c5de3d2f29e79b114bfc223bc39e4cc5b74", "url": "https://github.com/pravega/pravega/commit/c6ea0c5de3d2f29e79b114bfc223bc39e4cc5b74", "message": "remove matrix strategy entirely from Actions build\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2021-01-04T15:54:00Z", "type": "commit"}, {"oid": "c6ea0c5de3d2f29e79b114bfc223bc39e4cc5b74", "url": "https://github.com/pravega/pravega/commit/c6ea0c5de3d2f29e79b114bfc223bc39e4cc5b74", "message": "remove matrix strategy entirely from Actions build\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2021-01-04T15:54:00Z", "type": "forcePushed"}, {"oid": "5944b342cef9d89afd097db0aa085cb3f3aae395", "url": "https://github.com/pravega/pravega/commit/5944b342cef9d89afd097db0aa085cb3f3aae395", "message": "use ubuntu-20.04 instead of ubuntu-latest (18.04)\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2021-01-04T16:33:14Z", "type": "commit"}, {"oid": "c0b007efbc1a1a87dfec2d29a764b121f4043f02", "url": "https://github.com/pravega/pravega/commit/c0b007efbc1a1a87dfec2d29a764b121f4043f02", "message": "use default AdoptOpenJDK Java instead of Azul Zulu\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2021-01-04T16:34:08Z", "type": "commit"}, {"oid": "dbd84cd2d3102af7e42f69d5efa92fd13135d66a", "url": "https://github.com/pravega/pravega/commit/dbd84cd2d3102af7e42f69d5efa92fd13135d66a", "message": "use 2GB heap for all Test tasks, was 512MB\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2021-01-04T18:28:54Z", "type": "commit"}, {"oid": "6a76b4802d4f073365b1b79281aa6fb9e7dee4f9", "url": "https://github.com/pravega/pravega/commit/6a76b4802d4f073365b1b79281aa6fb9e7dee4f9", "message": "run assemble & rat/checkstyle/spotbugs in parallel\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2021-01-04T21:50:32Z", "type": "commit"}, {"oid": "b8b5937e7965b6c97581b91bc6948ed3adffb9ab", "url": "https://github.com/pravega/pravega/commit/b8b5937e7965b6c97581b91bc6948ed3adffb9ab", "message": "remove javadocs run, included in assemble\n\nSigned-off-by: Derek Moore <derek.moore@dell.com>", "committedDate": "2021-01-04T21:50:42Z", "type": "commit"}, {"oid": "243e9bd896440ed3efbe849933c495cfe61ed0f7", "url": "https://github.com/pravega/pravega/commit/243e9bd896440ed3efbe849933c495cfe61ed0f7", "message": "Merge branch 'master' into actions-ci", "committedDate": "2021-01-06T19:37:11Z", "type": "commit"}, {"oid": "7d7be56dde98a47f21767da075df5653e2f54384", "url": "https://github.com/pravega/pravega/commit/7d7be56dde98a47f21767da075df5653e2f54384", "message": "Increased timeout to prevent sporadic failures in testAppendAndReadStream\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2021-01-07T18:37:09Z", "type": "commit"}, {"oid": "c5cfe595e6aceef2a20bb27a94da212eb46f43b5", "url": "https://github.com/pravega/pravega/commit/c5cfe595e6aceef2a20bb27a94da212eb46f43b5", "message": "Merge branch 'master' into actions-ci", "committedDate": "2021-01-08T17:33:34Z", "type": "commit"}]}