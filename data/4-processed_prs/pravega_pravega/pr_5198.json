{"pr_number": 5198, "pr_title": "Issue 5197: Limit number of transactions in a commit batch", "pr_createdAt": "2020-09-17T12:22:00Z", "pr_url": "https://github.com/pravega/pravega/pull/5198", "timeline": [{"oid": "ab660425e14d8c0a3b6b8c453affbc5a96edae8e", "url": "https://github.com/pravega/pravega/commit/ab660425e14d8c0a3b6b8c453affbc5a96edae8e", "message": "Issue 5197: Limit number of transactions in a commit batch\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>", "committedDate": "2020-09-17T11:14:18Z", "type": "commit"}, {"oid": "abb38b3a76a8a0a5148d700690a345895daeb469", "url": "https://github.com/pravega/pravega/commit/abb38b3a76a8a0a5148d700690a345895daeb469", "message": "expose the limit as a param on the store interface\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>", "committedDate": "2020-09-17T11:50:42Z", "type": "commit"}, {"oid": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8", "url": "https://github.com/pravega/pravega/commit/b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8", "message": "Merge branch 'master' into issue-5197", "committedDate": "2020-09-17T13:16:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI1MzA3Nw==", "url": "https://github.com/pravega/pravega/pull/5198#discussion_r490253077", "bodyText": "Math.min () can be used here ?", "author": "shrids", "createdAt": "2020-09-17T13:38:19Z", "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1673,7 +1677,11 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n             txnIds.add(x.getValue());\n         });\n \n-        return getTransactionRecords(epoch, txnIds).thenAccept(txns -> {\n+        AtomicInteger from = new AtomicInteger(0);\n+        Function<Integer, Integer> tillFunc = f -> f + limit < txnIds.size() ? f + limit : txnIds.size();", "originalCommit": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI2NDYyMg==", "url": "https://github.com/pravega/pravega/pull/5198#discussion_r490264622", "bodyText": "do we require this check given that the txnIds are not greater than the passed limit ?", "author": "shrids", "createdAt": "2020-09-17T13:54:05Z", "path": "controller/src/main/java/io/pravega/controller/store/stream/PersistentStreamBase.java", "diffHunk": "@@ -1683,6 +1691,9 @@ boolean compareWriterPositions(Map<Long, Long> position1, Map<Long, Long> positi\n                         if (txnRecord.getCommitOrder() == order) {\n                             // if entry matches record's position then include it\n                             transactionsMap.put(txnId, txnRecord);\n+                            if (transactionsMap.size() >= limit) {", "originalCommit": "b2e0efb39e1e3badf27d0a6ad02782bf0bfb41a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMxMzk4MA==", "url": "https://github.com/pravega/pravega/pull/5198#discussion_r490313980", "bodyText": "transactionsMap is actually accumulating filtered txns from the txnIds across all iterations and the limit s really to be imposed on the number of entries we put in this map as that will be sent back to the caller to use as the batch of transactions", "author": "shiveshr", "createdAt": "2020-09-17T14:51:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI2NDYyMg=="}], "type": "inlineReview"}, {"oid": "30cdb970177b6332c2aeb17070c103a3bc3e253e", "url": "https://github.com/pravega/pravega/commit/30cdb970177b6332c2aeb17070c103a3bc3e253e", "message": "PR comment\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>", "committedDate": "2020-09-17T14:55:27Z", "type": "commit"}, {"oid": "f87f606f2107885ff610f9767307c5b6d1b4ba51", "url": "https://github.com/pravega/pravega/commit/f87f606f2107885ff610f9767307c5b6d1b4ba51", "message": "Merge branch 'issue-5197' of https://github.com/shiveshr/pravega-1 into issue-5197", "committedDate": "2020-09-17T14:55:47Z", "type": "commit"}, {"oid": "e6500b9b01696eb09c6157022df86bcfab394ebf", "url": "https://github.com/pravega/pravega/commit/e6500b9b01696eb09c6157022df86bcfab394ebf", "message": "Merge branch 'master' into issue-5197", "committedDate": "2020-09-18T04:22:16Z", "type": "commit"}]}