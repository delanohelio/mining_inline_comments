{"pr_number": 5000, "pr_title": "Issue 4790: Pravega Standalone Enhancements", "pr_createdAt": "2020-07-30T00:45:29Z", "pr_url": "https://github.com/pravega/pravega/pull/5000", "timeline": [{"oid": "08601afd11463bf700a6d0af3f33dcb53f935e09", "url": "https://github.com/pravega/pravega/commit/08601afd11463bf700a6d0af3f33dcb53f935e09", "message": "Update K8 client APIs to use their 5.0.0 counterparts.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-02-21T00:13:24Z", "type": "commit"}, {"oid": "25a165d0293c34ee8703fff764e55cf8fda413dd", "url": "https://github.com/pravega/pravega/commit/25a165d0293c34ee8703fff764e55cf8fda413dd", "message": "Merge pull request #1 from co-jo/issue-4464-update-kubernetes-client-version\n\nIssue 4464 update kubernetes client version", "committedDate": "2020-02-21T18:42:03Z", "type": "commit"}, {"oid": "8cc2dd2be26feed2953258ff055c1657aeb57019", "url": "https://github.com/pravega/pravega/commit/8cc2dd2be26feed2953258ff055c1657aeb57019", "message": "Run system tests using alternative flag value.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-02-23T04:43:09Z", "type": "commit"}, {"oid": "c3fcbd2e627f9fc0a0f6bad7e42667db4439e092", "url": "https://github.com/pravega/pravega/commit/c3fcbd2e627f9fc0a0f6bad7e42667db4439e092", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-10T22:21:32Z", "type": "commit"}, {"oid": "f5f808cc42831892aeb8e7824c22d499a1f9fa03", "url": "https://github.com/pravega/pravega/commit/f5f808cc42831892aeb8e7824c22d499a1f9fa03", "message": "Merge branch 'master' of https://github.com/pravega/pravega", "committedDate": "2020-03-18T18:44:10Z", "type": "commit"}, {"oid": "7901435dc1127bed1c46845bbaf8024477e2078f", "url": "https://github.com/pravega/pravega/commit/7901435dc1127bed1c46845bbaf8024477e2078f", "message": "Merge branch 'master' of https://github.com/pravega/pravega\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-04-02T18:49:59Z", "type": "commit"}, {"oid": "d59b3e33f6d5bd90264753caadcea7ed7bbfe06c", "url": "https://github.com/pravega/pravega/commit/d59b3e33f6d5bd90264753caadcea7ed7bbfe06c", "message": "Merge branch 'master' of https://github.com/pravega/pravega", "committedDate": "2020-04-16T20:22:05Z", "type": "commit"}, {"oid": "aa090cad1d88812f2a88e9debacdb04df585adbf", "url": "https://github.com/pravega/pravega/commit/aa090cad1d88812f2a88e9debacdb04df585adbf", "message": "Merge branch 'master' of https://github.com/pravega/pravega", "committedDate": "2020-04-18T20:15:50Z", "type": "commit"}, {"oid": "e328bcb38239fdc32f866980ee1103c93dff522d", "url": "https://github.com/pravega/pravega/commit/e328bcb38239fdc32f866980ee1103c93dff522d", "message": "Merge branch 'master' of https://github.com/co-jo/pravega", "committedDate": "2020-05-11T22:25:21Z", "type": "commit"}, {"oid": "cd02180986f49a42002c7fd2ef28885d1f701af9", "url": "https://github.com/pravega/pravega/commit/cd02180986f49a42002c7fd2ef28885d1f701af9", "message": "Merge branch 'master' of https://github.com/pravega/pravega", "committedDate": "2020-05-11T22:25:27Z", "type": "commit"}, {"oid": "1408d7527ec73f1645418df04aea4aa1120b39e7", "url": "https://github.com/pravega/pravega/commit/1408d7527ec73f1645418df04aea4aa1120b39e7", "message": "Merge branch 'master' of https://github.com/co-jo/pravega", "committedDate": "2020-05-18T20:48:16Z", "type": "commit"}, {"oid": "e2719517850f39bce3e5f2c92f04c8c24122a520", "url": "https://github.com/pravega/pravega/commit/e2719517850f39bce3e5f2c92f04c8c24122a520", "message": "Merge branch 'master' of https://github.com/pravega/pravega", "committedDate": "2020-05-20T18:59:36Z", "type": "commit"}, {"oid": "b1d3648dd2c28a161dab520a48bf4bf657f9d14d", "url": "https://github.com/pravega/pravega/commit/b1d3648dd2c28a161dab520a48bf4bf657f9d14d", "message": "Merge branch 'master' of https://github.com/pravega/pravega", "committedDate": "2020-06-15T18:43:02Z", "type": "commit"}, {"oid": "78ff6324b40431e17d655d738a4174b2b634ecba", "url": "https://github.com/pravega/pravega/commit/78ff6324b40431e17d655d738a4174b2b634ecba", "message": "Merge branch 'master' of https://github.com/pravega/pravega", "committedDate": "2020-06-17T18:04:56Z", "type": "commit"}, {"oid": "3bc4cc9666bed4641f4c8125f7e701b2fb7067f8", "url": "https://github.com/pravega/pravega/commit/3bc4cc9666bed4641f4c8125f7e701b2fb7067f8", "message": "Merge branch 'master' of https://github.com/pravega/pravega", "committedDate": "2020-06-25T20:15:11Z", "type": "commit"}, {"oid": "2b815145acf970130cfba88e68b06f2809247fd2", "url": "https://github.com/pravega/pravega/commit/2b815145acf970130cfba88e68b06f2809247fd2", "message": "Merge branch 'master' of https://github.com/pravega/pravega into issue-4790-pravega-standalone-enhacements", "committedDate": "2020-07-06T19:25:40Z", "type": "commit"}, {"oid": "2779493a44ac97d51d85d17ef82ff284ecc76d90", "url": "https://github.com/pravega/pravega/commit/2779493a44ac97d51d85d17ef82ff284ecc76d90", "message": "* Initial logging changes.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-07-06T21:47:08Z", "type": "commit"}, {"oid": "a4822279899a33c0c834ed09a664f6efdb4ee07a", "url": "https://github.com/pravega/pravega/commit/a4822279899a33c0c834ed09a664f6efdb4ee07a", "message": "* Play around with logback configurations.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-07-06T23:22:08Z", "type": "commit"}, {"oid": "503fc1f8e4ad14d88f5d9a07d5ae26a5b07a2d99", "url": "https://github.com/pravega/pravega/commit/503fc1f8e4ad14d88f5d9a07d5ae26a5b07a2d99", "message": "Merge remote-tracking branch 'upstream/master' into issue-4790-pravega-standalone-enhacements", "committedDate": "2020-07-23T22:02:02Z", "type": "commit"}, {"oid": "01e63f3ab25117767a5df6b656207a0556a72aee", "url": "https://github.com/pravega/pravega/commit/01e63f3ab25117767a5df6b656207a0556a72aee", "message": "* Add some more logging to the standalone package.\n* Change the logback.xml file used for pravega-standalone to use INFO level logging by default.\n* Change the detailed logs to be forwarded to a file and essential service info to stdout.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-07-29T20:14:02Z", "type": "commit"}, {"oid": "36b46fe8845d54835e94077680ca16d36e0f95c2", "url": "https://github.com/pravega/pravega/commit/36b46fe8845d54835e94077680ca16d36e0f95c2", "message": "* Remove unintentionally added file.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-07-29T23:28:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY3MDE5NQ==", "url": "https://github.com/pravega/pravega/pull/5000#discussion_r462670195", "bodyText": "The idea with this change was to bring forward two things: readiness of various services (zookeeper, controller, segmentstore, etc) and highlight the configuration options of those services. It was separated from normal logging (which now is directed towards standalone.log) to ensure visibility of these things.", "author": "co-jo", "createdAt": "2020-07-30T00:49:08Z", "path": "config/logback.xml", "diffHunk": "@@ -11,14 +11,35 @@ You may obtain a copy of the License at\n <configuration scan=\"true\" scanPeriod=\"30 seconds\">\n     <logger name=\"org.apache.zookeeper\" level=\"WARN\"/>\n \n+    <appender name=\"FILE\" class=\"ch.qos.logback.core.FileAppender\">\n+        <file>standalone.log</file>\n+        <encoder>\n+            <charset>UTF-8</charset>\n+            <Pattern>%d %-4relative [%thread] %-5level %logger{35} - %msg%n</Pattern>\n+        </encoder>\n+    </appender>\n+\n     <appender name=\"STDOUT\" class=\"ch.qos.logback.core.ConsoleAppender\">\n         <encoder>\n             <charset>UTF-8</charset>\n             <Pattern>%d %-4relative [%thread] %-5level %logger{35} - %msg%n</Pattern>\n         </encoder>\n     </appender>\n \n-    <root level=\"DEBUG\">\n+    <logger name=\"io.pravega.local\" level=\"INFO\">", "originalCommit": "36b46fe8845d54835e94077680ca16d36e0f95c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIwNzU2NA==", "url": "https://github.com/pravega/pravega/pull/5000#discussion_r463207564", "bodyText": "Wouldn't be better to define all the necessary changes to logging for standalone in logback-standalone.xml file and use it whenever Standalone starts (like in a gradle file)?\notherwise these changes will be taking an effect in production as well and I am not sure how they fit K8s environments", "author": "medvedevigorek", "createdAt": "2020-07-30T19:00:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY3MDE5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI1NTIzMQ==", "url": "https://github.com/pravega/pravega/pull/5000#discussion_r463255231", "bodyText": "Good point. There are a number of different logback files spread throughout our codebase. We have to be sure that the correct one is picked up by Logback at runtime. We should also make sure this change doesn't get picked up when we publish the production jars for releases.", "author": "andreipaduroiu", "createdAt": "2020-07-30T20:34:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY3MDE5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc2MTM3Nw==", "url": "https://github.com/pravega/pravega/pull/5000#discussion_r463761377", "bodyText": "I thought that production environments use the logback.xml from dist/conf/? Although it does seem good to have a more explicitly named logback.xml file.", "author": "co-jo", "createdAt": "2020-07-31T18:18:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY3MDE5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY3MDg0Mw==", "url": "https://github.com/pravega/pravega/pull/5000#discussion_r462670843", "bodyText": "A change that is less needed with the changes performed in logback.xml but this further brings attention to pravega-standalone is in a ready state.", "author": "co-jo", "createdAt": "2020-07-30T00:51:29Z", "path": "standalone/src/main/java/io/pravega/local/LocalPravegaEmulator.java", "diffHunk": "@@ -125,12 +126,12 @@ public void run() {\n \n             log.info(\"Starting Pravega Emulator with ports: ZK port {}, controllerPort {}, SegmentStorePort {}\",\n                     conf.getZkPort(), conf.getControllerPort(), conf.getSegmentStorePort());\n-\n             localPravega.start();\n-\n-            System.out.println(\n-                    String.format(\"Pravega Sandbox is running locally now. You could access it at %s:%d\", \"127.0.0.1\",\n-                            conf.getControllerPort()));\n+            String msg = String.format(\"# Pravega Sandbox is running locally now. You could access it at %s:%d. #\", \"127.0.0.1\", conf.getControllerPort());", "originalCommit": "36b46fe8845d54835e94077680ca16d36e0f95c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ef7c832bab2fca6d79d8968baeb960d9d8ca1498", "url": "https://github.com/pravega/pravega/commit/ef7c832bab2fca6d79d8968baeb960d9d8ca1498", "message": "* Remove unsupported (Java 11) APIs.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-07-30T18:24:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE4OTk4NQ==", "url": "https://github.com/pravega/pravega/pull/5000#discussion_r463189985", "bodyText": "You don't need to do String format here. the log.info method takes an arg that is a formatted string. Use {} instead of %s.", "author": "andreipaduroiu", "createdAt": "2020-07-30T18:27:29Z", "path": "standalone/src/main/java/io/pravega/local/LocalPravegaEmulator.java", "diffHunk": "@@ -125,12 +126,11 @@ public void run() {\n \n             log.info(\"Starting Pravega Emulator with ports: ZK port {}, controllerPort {}, SegmentStorePort {}\",\n                     conf.getZkPort(), conf.getControllerPort(), conf.getSegmentStorePort());\n-\n             localPravega.start();\n-\n-            System.out.println(\n-                    String.format(\"Pravega Sandbox is running locally now. You could access it at %s:%d\", \"127.0.0.1\",\n-                            conf.getControllerPort()));\n+            log.info(\"\");\n+            log.info(\"Pravega Sandbox is running locally now. You could access it at {}:{}.\", \"127.0.0.1\", conf.getControllerPort());\n+            log.info(\"For more detailed logs, see: {}\", String.format(\"%s/%s\", System.getProperty(\"user.dir\"), \"standalone/standalone.log\"));", "originalCommit": "ef7c832bab2fca6d79d8968baeb960d9d8ca1498", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI3NDE0OA==", "url": "https://github.com/pravega/pravega/pull/5000#discussion_r463274148", "bodyText": "If this is a directory on disk, can we write an absolute path?", "author": "eolivelli", "createdAt": "2020-07-30T21:12:27Z", "path": "standalone/src/main/java/io/pravega/local/InProcPravegaCluster.java", "diffHunk": "@@ -238,7 +238,9 @@ private void cleanUpZK() {\n     }\n \n     private void startLocalHDFS() throws IOException {\n-        localHdfs = LocalHDFSEmulator.newBuilder().baseDirName(\"temp\").build();\n+        String baseDir = \"temp\";\n+        log.info(\"Starting HDFS Emulator @ {}/\", baseDir);", "originalCommit": "ef7c832bab2fca6d79d8968baeb960d9d8ca1498", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzgwMDY4NQ==", "url": "https://github.com/pravega/pravega/pull/5000#discussion_r463800685", "bodyText": "The baseDir is used within the context of a temp file so it should be absolute. I will alter the log message to make this clear.", "author": "co-jo", "createdAt": "2020-07-31T19:48:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI3NDE0OA=="}], "type": "inlineReview"}, {"oid": "84ad2b536e687997944fda7a467629d80f2d42f7", "url": "https://github.com/pravega/pravega/commit/84ad2b536e687997944fda7a467629d80f2d42f7", "message": "* Make it more clear which logback.xml file is used for the standalone.\n* Add back previous logback.xml\n* Remove @ToString for SingleNodeConfig in favour of LocalPravegaEmulator.\n* Add a pretty print method for the various config options for LocalPravegaEmulator.\n* Use absolute path for HDFS in log.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-07-31T19:52:56Z", "type": "commit"}, {"oid": "c032416465c08129135b2b898d2eed2c4d571e6d", "url": "https://github.com/pravega/pravega/commit/c032416465c08129135b2b898d2eed2c4d571e6d", "message": "* Change the 'pretty print' method to instead return a formatted string.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-07-31T20:12:53Z", "type": "commit"}, {"oid": "015b8f1055dfa6418f73224ceb7fa9759c1b577c", "url": "https://github.com/pravega/pravega/commit/015b8f1055dfa6418f73224ceb7fa9759c1b577c", "message": "* Fix checkstyle violation.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-08-03T17:40:37Z", "type": "commit"}, {"oid": "75526eaf3afc01513e071bb7c29b572ffd4e223b", "url": "https://github.com/pravega/pravega/commit/75526eaf3afc01513e071bb7c29b572ffd4e223b", "message": "Merge branch 'master' into issue-4790-pravega-standalone-enhacements", "committedDate": "2020-08-03T17:56:06Z", "type": "commit"}, {"oid": "27de1b3d8cba7d6e3d2c95ff359de651a394a398", "url": "https://github.com/pravega/pravega/commit/27de1b3d8cba7d6e3d2c95ff359de651a394a398", "message": "* Adhere to best practice.\n\nSigned-off-by: co-jo <colin.hryniowski@dell.com>", "committedDate": "2020-08-03T21:14:45Z", "type": "commit"}, {"oid": "f477f2a70f48090bab98db936774ea45472f2028", "url": "https://github.com/pravega/pravega/commit/f477f2a70f48090bab98db936774ea45472f2028", "message": "Merge remote-tracking branch 'origin/issue-4790-pravega-standalone-enhacements' into issue-4790-pravega-standalone-enhacements", "committedDate": "2020-08-03T21:14:55Z", "type": "commit"}, {"oid": "c3688787d457ccee72829417f22de5405da5f33c", "url": "https://github.com/pravega/pravega/commit/c3688787d457ccee72829417f22de5405da5f33c", "message": "Merge branch 'master' into issue-4790-pravega-standalone-enhacements", "committedDate": "2020-08-03T21:15:54Z", "type": "commit"}, {"oid": "3670fe80ce9c66cfc1b3f2a475d042580bdf9286", "url": "https://github.com/pravega/pravega/commit/3670fe80ce9c66cfc1b3f2a475d042580bdf9286", "message": "Merge branch 'master' into issue-4790-pravega-standalone-enhacements", "committedDate": "2020-08-03T22:24:40Z", "type": "commit"}]}