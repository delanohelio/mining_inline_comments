{"pr_number": 1422, "pr_title": "HBASE-24106 Update getting started documentation after HBASE-24086", "pr_createdAt": "2020-04-02T19:35:00Z", "pr_url": "https://github.com/apache/hbase/pull/1422", "timeline": [{"oid": "c9c164e3d4d91e05c33418cba62fdcfb98b605ef", "url": "https://github.com/apache/hbase/commit/c9c164e3d4d91e05c33418cba62fdcfb98b605ef", "message": "HBASE-24106 Update getting started documentation after HBASE-24086", "committedDate": "2020-04-02T19:36:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYwMDQ0Mg==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r402600442", "bodyText": "oh fun, asciidoc rendered {version} as 3.0.0-SNAPSHOT.", "author": "ndimiduk", "createdAt": "2020-04-02T21:15:34Z", "path": "src/main/asciidoc/_chapters/getting_started.adoc", "diffHunk": "@@ -55,35 +55,43 @@ See <<java,Java>> for information about supported JDK versions.\n . Choose a download site from this list of link:https://www.apache.org/dyn/closer.lua/hbase/[Apache Download Mirrors].\n   Click on the suggested top link.\n   This will take you to a mirror of _HBase Releases_.\n-  Click on the folder named _stable_ and then download the binary file that ends in _.tar.gz_ to your local filesystem.\n-  Do not download the file ending in _src.tar.gz_ for now.\n+  Click on the folder named _stable_ and then download the binary file that looks like\n+  _hbase-{version}-bin.tar.gz_ to your local filesystem.", "originalCommit": "c9c164e3d4d91e05c33418cba62fdcfb98b605ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "27e6663c08bf158ef788f004f727f252e90dc92f", "url": "https://github.com/apache/hbase/commit/27e6663c08bf158ef788f004f727f252e90dc92f", "message": "HBASE-24106 Update getting started documentation after HBASE-24086", "committedDate": "2020-04-02T22:06:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NDU4OA==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r402664588", "bodyText": "Given this change is only going into specific versions, should we add a note for users on older versions? Something like...\nif you are on v < 2.3, disable stream enforcement by setting this flag.. later versions Hbase takes care of it automatically.....", "author": "bharathv", "createdAt": "2020-04-03T00:05:10Z", "path": "src/main/asciidoc/_chapters/getting_started.adoc", "diffHunk": "@@ -55,85 +55,67 @@ See <<java,Java>> for information about supported JDK versions.\n . Choose a download site from this list of link:https://www.apache.org/dyn/closer.lua/hbase/[Apache Download Mirrors].\n   Click on the suggested top link.\n   This will take you to a mirror of _HBase Releases_.\n-  Click on the folder named _stable_ and then download the binary file that ends in _.tar.gz_ to your local filesystem.\n-  Do not download the file ending in _src.tar.gz_ for now.\n+  Click on the folder named _stable_ and then download the binary file that looks like\n+  _hbase-<version>-bin.tar.gz_.\n \n-. Extract the downloaded file, and change to the newly-created directory.\n+. Extract the downloaded file and change to the newly-created directory.\n +\n-[source,subs=\"attributes\"]\n ----\n-\n-$ tar xzvf hbase-{Version}-bin.tar.gz\n-$ cd hbase-{Version}/\n+$ tar xzvf hbase-<version>-bin.tar.gz\n+$ cd hbase-<version>/\n ----\n \n-. You must set the `JAVA_HOME` environment variable before starting HBase.\n-  To make this easier, HBase lets you set it within the _conf/hbase-env.sh_ file. You must locate where Java is\n-  installed on your machine, and one way to find this is by using the _whereis java_ command. Once you have the location,\n-  edit the _conf/hbase-env.sh_ file and uncomment the line starting with _#export JAVA_HOME=_, and then set it to your Java installation path.\n+. Set the `JAVA_HOME` environment variable in _conf/hbase-env.sh_.\n+  First, locate the installation of `java` on your machine. On Unix systems, you can use the\n+  _whereis java_ command. Once you have the location, edit _conf/hbase-env.sh_ file, found inside\n+  the extracted _hbase-<version>_ directory, uncomment the line starting with `#export JAVA_HOME=`,\n+  and then set it to your Java installation path.\n +\n-.Example extract from _hbase-env.sh_ where _JAVA_HOME_ is set\n+.Example extract from _conf/hbase-env.sh_ where `JAVA_HOME` is set\n   # Set environment variables here.\n   # The java implementation to use.\n   export JAVA_HOME=/usr/jdk64/jdk1.8.0_112\n +\n \n-. Edit _conf/hbase-site.xml_, which is the main HBase configuration file.\n-  At this time, you need to specify the directory on the local filesystem where HBase and ZooKeeper write data and acknowledge some risks.\n-  By default, a new directory is created under /tmp.\n-  Many servers are configured to delete the contents of _/tmp_ upon reboot, so you should store the data elsewhere.\n-  The following configuration will store HBase's data in the _hbase_ directory, in the home directory of the user called `testuser`.\n-  Paste the `<property>` tags beneath the `<configuration>` tags, which should be empty in a new HBase install.\n+. Optionally set the <<hbase.tmp.dir,`hbase.tmp.dir`>> property in _conf/hbase-site.xml_.\n+  At this time, you may consider changing the location on the local filesystem where HBase writes\n+  its application data and the data  written by its embedded ZooKeeper  instance. By default, HBase\n+  uses paths under <<hbase.tmp.dir,`hbase.tmp.dir`>> for these directories.\n++\n+NOTE: On most systems, this is a path created under _/tmp_. Many system periodically delete the\n+  contents of _/tmp_. If you start working with HBase in this way, and then return after the\n+  cleanup operation takes place, you're likely to find strange errors. The following\n+  configuration will place HBase's runtime data in a _tmp_ directory found inside the extracted\n+  _hbase-<version>_ directory, where it will be safe from this periodic cleanup.\n++\n+Open _conf/hbase-site.xml_ and paste the `<property>` tags between the empty `<configuration>`\n+tags.\n +\n .Example _hbase-site.xml_ for Standalone HBase\n ====\n [source,xml]\n ----\n-\n <configuration>\n   <property>\n-    <name>hbase.rootdir</name>\n-    <value>file:///home/testuser/hbase</value>\n-  </property>\n-  <property>\n-    <name>hbase.zookeeper.property.dataDir</name>\n-    <value>/home/testuser/zookeeper</value>\n-  </property>\n-  <property>\n-    <name>hbase.unsafe.stream.capability.enforce</name>\n-    <value>false</value>\n-    <description>\n-      Controls whether HBase will check for stream capabilities (hflush/hsync).\n-\n-      Disable this if you intend to run on LocalFileSystem, denoted by a rootdir\n-      with the 'file://' scheme, but be mindful of the NOTE below.\n-\n-      WARNING: Setting this to false blinds you to potential data loss and\n-      inconsistent system state in the event of process and/or node failures. If\n-      HBase is complaining of an inability to use hsync or hflush it's most\n-      likely not a false positive.\n-    </description>\n+    <name>hbase.tmp.dir</name>\n+    <value>tmp</value>\n   </property>\n </configuration>\n ----\n ====\n +\n-You do not need to create the HBase data directory.\n-HBase will do this for you.  If you create the directory,\n-HBase will attempt to do a migration, which is not what you want.\n+You do not need to create the HBase _tmp_ directory; HBase will do this for you.\n +\n-NOTE: The _hbase.rootdir_ in the above example points to a directory\n-in the _local filesystem_. The 'file://' prefix is how we denote local\n-filesystem. You should take the WARNING present in the configuration example\n-to heart. In standalone mode HBase makes use of the local filesystem abstraction\n-from the Apache Hadoop project. That abstraction doesn't provide the durability\n-promises that HBase needs to operate safely. This is fine for local development\n-and testing use cases where the cost of cluster failure is well contained. It is\n-not appropriate for production deployments; eventually you will lose data.\n-\n-To home HBase on an existing instance of HDFS, set the _hbase.rootdir_ to point at a\n-directory up on your instance: e.g. _hdfs://namenode.example.org:8020/hbase_.\n-For more on this variant, see the section below on Standalone HBase over HDFS.\n+NOTE: When unconfigured, HBase uses <<hbase.tmp.dir,`hbase.tmp.dir`>> as a starting point for many\n+important configurations. Notable among them are <<hbase.rootdir,`hbase.rootdir`>>, the path under\n+which HBase stores its data. You can specify values for this configuration directly, as you'll see\n+in the subsequent sections.\n++\n+NOTE: In this example, HBase is running on Hadoop's `LocalFileSystem`. That abstraction doesn't", "originalCommit": "27e6663c08bf158ef788f004f727f252e90dc92f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk1MjUzNw==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r402952537", "bodyText": "Generally, documentation changes are merged to master and cherry-picked to appropriate branches. In this case the commit should be backported to branch-2 and branch-2.3 but not to branch-2.2.", "author": "petersomogyi", "createdAt": "2020-04-03T11:56:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NDU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzExMDk3Nw==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r403110977", "bodyText": "True..but I think most people refer to the ref-guide here https://hbase.apache.org/book.html rather than version specific one because it shows up in search results.. hence my comment.", "author": "bharathv", "createdAt": "2020-04-03T16:06:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NDU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEzOTQwNw==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r403139407", "bodyText": "We've never really solved challenges of the branch-specific documentation.\nI didn't try older versions of 2.x... let me see where they stand.", "author": "ndimiduk", "createdAt": "2020-04-03T16:47:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NDU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE0NjQ4OA==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r403146488", "bodyText": "The book says HBase 2.1 and 2.2 are \"untested\" with Hadoop 2.10. branch-2.2 builds with -Dhadoop-two.version=2.10.0 and produces a similar error at runtime:\njava.lang.IllegalStateException: The procedure WAL relies on the ability to hsync for proper operation during component failures, but the underlying filesystem does not support doing so. Please check th\ne config value of 'hbase.procedure.store.wal.use.hsync' to set the desired level of robustness and ensure the config value of 'hbase.wal.dir' points to a FileSystem mount that can provide it.\n        at org.apache.hadoop.hbase.procedure2.store.wal.WALProcedureStore.rollWriter(WALProcedureStore.java:1092)\n        at org.apache.hadoop.hbase.procedure2.store.wal.WALProcedureStore.recoverLease(WALProcedureStore.java:424)\n        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.init(ProcedureExecutor.java:586)\n        at org.apache.hadoop.hbase.master.HMaster.createProcedureExecutor(HMaster.java:1522)\n        at org.apache.hadoop.hbase.master.HMaster.lambda$run$0(HMaster.java:579)\n        at java.lang.Thread.run(Thread.java:748)\n\nbranch-2.1 does not build with hadoop-2.10.0,\n[INFO] --- maven-enforcer-plugin:3.0.0-M2:enforce (banned-jsr305) @ hbase-client ---\n[WARNING] Rule 0: org.apache.maven.plugins.enforcer.BannedDependencies failed with message:\nWe don't allow the JSR305 jar from the Findbugs project, see HBASE-16321.\nFound Banned Dependency: com.google.code.findbugs:jsr305:jar:1.3.9", "author": "ndimiduk", "createdAt": "2020-04-03T16:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NDU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE1OTI4NQ==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r403159285", "bodyText": "Given this change is only going into specific versions, should we add a note for users on older versions? Something like...\n\nif you are on v < 2.3, disable stream enforcement by setting this flag.. later versions Hbase takes care of it automatically.....\n\n\nThis is tricky. My understanding is that HBase has never had these durability guarantees when running on LocalFileSystem because no version of Hadoop has ever provided an implementation that provides hflush or hsync on that class. Thus this warning is applicable everywhere, to everyone.\nNow as far as HBase's behavior in the presence of a LocalFileSystem, that's a little different. On Hadoop-2.8.x, we had no way to ask Hadoop if the OutputStream supported these characteristics, so we simply move forward with a warning. It's not clear to me when we first exposed hbase.unsafe.stream.capability.enforce (on first glance, all the places that config is referenced appear to have been changed since its inception) or what our behavior was before then. Let me look into this further and see if I can make a recommendation.\nIf we back port the parent issue to branch-2.2, then I think the behavior will be the same on all branch-2 derivatives.", "author": "ndimiduk", "createdAt": "2020-04-03T17:13:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NDU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI2MDU0Ng==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r403260546", "bodyText": "HBASE-19289 has some nice history here...", "author": "ndimiduk", "createdAt": "2020-04-03T19:23:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NDU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc4OTg1MQ==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r403789851", "bodyText": "My understanding is that HBase has never had these durability guarantees when running on LocalFileSystem because no version of Hadoop has ever provided an implementation that provides hflush or hsync on that class\n\nYeah, agree on this point. Just driving by to also mention that there is the RawLocalFileSystem implementation which works with the local filesystem and does implement hflush/hsync. There's just some more trickery to get it set up for file:// instead of LocalFileSystem. I don't think we have this configured for HBase at all (I remember Accumulo used to do a bunch with it for UT's).", "author": "joshelser", "createdAt": "2020-04-06T01:34:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NDU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI3OTY2Nw==", "url": "https://github.com/apache/hbase/pull/1422#discussion_r404279667", "bodyText": "Yeah, agree on this point. Just driving by to also mention that there is the RawLocalFileSystem implementation which works with the local filesystem and does implement hflush/hsync. There's just some more trickery to get it set up for file:// instead of LocalFileSystem. I don't think we have this configured for HBase at all (I remember Accumulo used to do a bunch with it for UT's).\n\nThanks for the pointer @joshelser . I'm not up to speed on the differences between the two. I looked long enough to see that they follow different inheritance hierarchies.\nIf we could converge the majority of our small and medium test suite onto some equivalent to LocalFileSystem, it would make a huge difference in the runtime and resource usage of tests...", "author": "ndimiduk", "createdAt": "2020-04-06T17:52:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NDU4OA=="}], "type": "inlineReview"}, {"oid": "b409d17641a5cbad0bec0e069c1dce22e3f080cd", "url": "https://github.com/apache/hbase/commit/b409d17641a5cbad0bec0e069c1dce22e3f080cd", "message": "HBASE-24106 Update getting started documentation after HBASE-24086\n\nSigned-off-by: Josh Elser <elserj@apache.org>\nSigned-off-by: Bharath Vissapragada <bharathv@apache.org>\nSigned-off-by: Peter Somogyi <psomogyi@apache.org>", "committedDate": "2020-04-06T20:52:22Z", "type": "commit"}, {"oid": "b409d17641a5cbad0bec0e069c1dce22e3f080cd", "url": "https://github.com/apache/hbase/commit/b409d17641a5cbad0bec0e069c1dce22e3f080cd", "message": "HBASE-24106 Update getting started documentation after HBASE-24086\n\nSigned-off-by: Josh Elser <elserj@apache.org>\nSigned-off-by: Bharath Vissapragada <bharathv@apache.org>\nSigned-off-by: Peter Somogyi <psomogyi@apache.org>", "committedDate": "2020-04-06T20:52:22Z", "type": "forcePushed"}]}