{"pr_number": 1223, "pr_title": "HBASE-23739 BoundedRecoveredHFilesOutputSink should read the table de\u2026", "pr_createdAt": "2020-02-28T12:45:37Z", "pr_url": "https://github.com/apache/hbase/pull/1223", "timeline": [{"oid": "354fa73e495367ccdb3ae2b7319a3ac4bca9fe23", "url": "https://github.com/apache/hbase/commit/354fa73e495367ccdb3ae2b7319a3ac4bca9fe23", "message": "HBASE-23739 BoundedRecoveredHFilesOutputSink should read the table descriptor directly", "committedDate": "2020-02-28T23:40:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4MzkwMg==", "url": "https://github.com/apache/hbase/pull/1223#discussion_r385983902", "bodyText": "This changes the semantic? Not sure why but before this patch we only set this for HMaster?", "author": "Apache9", "createdAt": "2020-02-29T00:54:25Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java", "diffHunk": "@@ -721,20 +720,20 @@ private void initializeFileSystem() throws IOException {\n   }\n \n   private TableDescriptors getFsTableDescriptors() throws IOException {\n-    return new FSTableDescriptors(this.conf,\n-      this.dataFs, this.dataRootDir, !canUpdateTableDescriptor(), false, getMetaTableObserver());\n-  }\n-\n-  protected Function<TableDescriptorBuilder, TableDescriptorBuilder> getMetaTableObserver() {\n-    return null;\n+    if (canUpdateTableDescriptor()) {\n+      return new FSTableDescriptors(this.conf, this.dataFs, this.dataRootDir, false,\n+        builder -> builder.setRegionReplication(", "originalCommit": "354fa73e495367ccdb3ae2b7319a3ac4bca9fe23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4NDE1Mw==", "url": "https://github.com/apache/hbase/pull/1223#discussion_r385984153", "bodyText": "I think FSTableDescriptor should extends ReadOnlyFSTableDescriptor? And what is the problem for the old implementation where we just use a flag?", "author": "Apache9", "createdAt": "2020-02-29T00:56:23Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/ReadOnlyFSTableDescriptors.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.util;\n+\n+import java.io.IOException;\n+\n+import org.apache.commons.lang3.NotImplementedException;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hbase.TableName;\n+import org.apache.hadoop.hbase.client.TableDescriptor;\n+import org.apache.yetus.audience.InterfaceAudience;\n+\n+@InterfaceAudience.Private\n+public class ReadOnlyFSTableDescriptors extends FSTableDescriptors {", "originalCommit": "354fa73e495367ccdb3ae2b7319a3ac4bca9fe23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4OTI0NQ==", "url": "https://github.com/apache/hbase/pull/1223#discussion_r385989245", "bodyText": "Because FSTableDescriptor's constructer method throws IOException now. Let me open a new issue to refactor FSTableDescriptor firstly.", "author": "infraio", "createdAt": "2020-02-29T01:41:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4NDE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5MjQ0MQ==", "url": "https://github.com/apache/hbase/pull/1223#discussion_r385992441", "bodyText": "OK, in FSTableDescriptor we need to write the meta table descriptor to fs so it will throw an IOException. Got it. New issue is fine.", "author": "Apache9", "createdAt": "2020-02-29T02:18:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4NDE1Mw=="}], "type": "inlineReview"}, {"oid": "d339582bf9fe70b37a3d95a9dd51222bfbdae5e4", "url": "https://github.com/apache/hbase/commit/d339582bf9fe70b37a3d95a9dd51222bfbdae5e4", "message": "HBASE-23739 BoundedRecoveredHFilesOutputSink should read the table descriptor directly", "committedDate": "2020-03-04T02:07:19Z", "type": "forcePushed"}, {"oid": "17e9b023dd88be112e2c2a281e2afaff8e08b892", "url": "https://github.com/apache/hbase/commit/17e9b023dd88be112e2c2a281e2afaff8e08b892", "message": "HBASE-23739 BoundedRecoveredHFilesOutputSink should read the table descriptor directly", "committedDate": "2020-03-04T02:15:33Z", "type": "forcePushed"}, {"oid": "3d4d301d34ce6879d9d9bb6a060f2acf3d7351f6", "url": "https://github.com/apache/hbase/commit/3d4d301d34ce6879d9d9bb6a060f2acf3d7351f6", "message": "HBASE-23739 BoundedRecoveredHFilesOutputSink should read the table descriptor directly", "committedDate": "2020-03-04T02:17:44Z", "type": "forcePushed"}, {"oid": "2e8d35e826508d519c689e459e0427bbf1c81559", "url": "https://github.com/apache/hbase/commit/2e8d35e826508d519c689e459e0427bbf1c81559", "message": "HBASE-23739 BoundedRecoveredHFilesOutputSink should read the table descriptor directly", "committedDate": "2020-03-05T04:15:40Z", "type": "forcePushed"}, {"oid": "b61200ff54ab2808ca1726d7ffa4f09529c54171", "url": "https://github.com/apache/hbase/commit/b61200ff54ab2808ca1726d7ffa4f09529c54171", "message": "HBASE-23739 BoundedRecoveredHFilesOutputSink should read the table descriptor directly", "committedDate": "2020-03-05T07:03:41Z", "type": "commit"}, {"oid": "b61200ff54ab2808ca1726d7ffa4f09529c54171", "url": "https://github.com/apache/hbase/commit/b61200ff54ab2808ca1726d7ffa4f09529c54171", "message": "HBASE-23739 BoundedRecoveredHFilesOutputSink should read the table descriptor directly", "committedDate": "2020-03-05T07:03:41Z", "type": "forcePushed"}]}