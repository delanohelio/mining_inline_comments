{"pr_number": 1864, "pr_title": "HBASE-24515 batch Increment/Append fails when retrying the RPC", "pr_createdAt": "2020-06-07T01:48:19Z", "pr_url": "https://github.com/apache/hbase/pull/1864", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMzOTk1NQ==", "url": "https://github.com/apache/hbase/pull/1864#discussion_r436339955", "bodyText": "Instead of assert statement, we can throw AssertionError with if condition? Just that assert might not be enabled server side.", "author": "virajjasani", "createdAt": "2020-06-07T08:42:49Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -794,6 +792,29 @@ private Result increment(final HRegion region, final OperationQuota quota,\n     return r == null ? Result.EMPTY_RESULT : r;\n   }\n \n+  private Get toGet(final Mutation mutation) throws IOException {\n+    assert mutation instanceof Increment || mutation instanceof Append;", "originalCommit": "ed665f824c7b84403f680b856bd9d13c409c6606", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDEzNA==", "url": "https://github.com/apache/hbase/pull/1864#discussion_r436340134", "bodyText": "Looks like a candidate for static util method. Maybe we can move this to some Mutation related util class? This file anyways has lot of code (with more APIs, it will just increase :) )", "author": "virajjasani", "createdAt": "2020-06-07T08:45:12Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java", "diffHunk": "@@ -794,6 +792,29 @@ private Result increment(final HRegion region, final OperationQuota quota,\n     return r == null ? Result.EMPTY_RESULT : r;\n   }\n \n+  private Get toGet(final Mutation mutation) throws IOException {", "originalCommit": "ed665f824c7b84403f680b856bd9d13c409c6606", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM1OTgzMg==", "url": "https://github.com/apache/hbase/pull/1864#discussion_r436359832", "bodyText": "Thank you for your review!\nI couldn't find any existing Mutation related util class. I will just add static here.", "author": "brfrn169", "createdAt": "2020-06-07T12:47:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDEzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDM1Mw==", "url": "https://github.com/apache/hbase/pull/1864#discussion_r436340353", "bodyText": "Same here", "author": "virajjasani", "createdAt": "2020-06-07T08:47:48Z", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestIncrementsFromClientSide.java", "diffHunk": "@@ -131,6 +132,44 @@ public void testDuplicateIncrement() throws Exception {\n     }\n   }\n \n+  /**\n+   * Test batch increment result when there are duplicate rpc request.\n+   */\n+  @Test\n+  public void testDuplicateBatchIncrement() throws Exception {\n+    HTableDescriptor hdt = TEST_UTIL.createTableDescriptor(TableName.valueOf(name.getMethodName()));", "originalCommit": "ed665f824c7b84403f680b856bd9d13c409c6606", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDQ3MQ==", "url": "https://github.com/apache/hbase/pull/1864#discussion_r436340471", "bodyText": "Use relevant method for createModifyableTableDescriptor? Given that HTableDescriptor is deprecated.", "author": "virajjasani", "createdAt": "2020-06-07T08:49:54Z", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java", "diffHunk": "@@ -147,6 +148,47 @@ public void testDuplicateAppend() throws Exception {\n     }\n   }\n \n+  /**\n+   * Test batch append result when there are duplicate rpc request.\n+   */\n+  @Test\n+  public void testDuplicateBatchAppend() throws Exception {\n+    HTableDescriptor hdt = TEST_UTIL\n+      .createTableDescriptor(name.getTableName(), HColumnDescriptor.DEFAULT_MIN_VERSIONS, 3,", "originalCommit": "ed665f824c7b84403f680b856bd9d13c409c6606", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d40368e96bb0b875132e4941066e765c9825185e", "url": "https://github.com/apache/hbase/commit/d40368e96bb0b875132e4941066e765c9825185e", "message": "HBASE-24515 batch Increment/Append fails when retrying the RPC", "committedDate": "2020-06-07T13:20:12Z", "type": "commit"}, {"oid": "d40368e96bb0b875132e4941066e765c9825185e", "url": "https://github.com/apache/hbase/commit/d40368e96bb0b875132e4941066e765c9825185e", "message": "HBASE-24515 batch Increment/Append fails when retrying the RPC", "committedDate": "2020-06-07T13:20:12Z", "type": "forcePushed"}]}