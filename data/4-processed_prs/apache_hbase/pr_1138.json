{"pr_number": 1138, "pr_title": "HBASE-22827 Expose multi-region merge in shell and Admin API", "pr_createdAt": "2020-02-06T11:41:06Z", "pr_url": "https://github.com/apache/hbase/pull/1138", "timeline": [{"oid": "24aa84086618126da6880cadf81b255053b4ec29", "url": "https://github.com/apache/hbase/commit/24aa84086618126da6880cadf81b255053b4ec29", "message": "HBASE-22827 Expose multi-region merge in shell and Admin API", "committedDate": "2020-02-06T11:37:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYzODM0Mg==", "url": "https://github.com/apache/hbase/pull/1138#discussion_r376638342", "bodyText": "Can we add support for the previous syntax? and not just when an array is used?", "author": "esteban", "createdAt": "2020-02-07T22:31:09Z", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -535,14 +535,20 @@ def move(encoded_region_name, server = nil)\n     end\n \n     #----------------------------------------------------------------------------------------------\n-    # Merge two regions\n-    def merge_region(region_a_name, region_b_name, force)\n-      @admin.mergeRegionsAsync(\n-        region_a_name.to_java_bytes,\n-        region_b_name.to_java_bytes,\n-        java.lang.Boolean.valueOf(force)\n+    # Merge multiple regions\n+    def merge_region(regions = [], force)", "originalCommit": "24aa84086618126da6880cadf81b255053b4ec29", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY3ODU5NQ==", "url": "https://github.com/apache/hbase/pull/1138#discussion_r376678595", "bodyText": "Sure", "author": "jatsakthi", "createdAt": "2020-02-08T02:08:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYzODM0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYzODYzMA==", "url": "https://github.com/apache/hbase/pull/1138#discussion_r376638630", "bodyText": "As my previous comment, if we keep support of the syntax for adding only two regions and multiple regions we should keep both examples.", "author": "esteban", "createdAt": "2020-02-07T22:32:01Z", "path": "hbase-shell/src/main/ruby/shell/commands/merge_region.rb", "diffHunk": "@@ -33,16 +33,18 @@ def help\n \n Examples:\n \n-  hbase> merge_region 'FULL_REGIONNAME', 'FULL_REGIONNAME'\n-  hbase> merge_region 'FULL_REGIONNAME', 'FULL_REGIONNAME', true\n+  hbase> merge_region ['FULL_REGIONNAME', 'FULL_REGIONNAME']\n+  hbase> merge_region ['FULL_REGIONNAME', 'FULL_REGIONNAME', 'FULL_REGIONNAME', ...]\n+  hbase> merge_region ['FULL_REGIONNAME', 'FULL_REGIONNAME', 'FULL_REGIONNAME', ...], true\n \n-  hbase> merge_region 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME'\n-  hbase> merge_region 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', true\n+  hbase> merge_region ['ENCODED_REGIONNAME', 'ENCODED_REGIONNAME']\n+  hbase> merge_region ['ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', ...]\n+  hbase> merge_region ['ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', ...], true", "originalCommit": "24aa84086618126da6880cadf81b255053b4ec29", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY3ODU5MA==", "url": "https://github.com/apache/hbase/pull/1138#discussion_r376678590", "bodyText": "Done.", "author": "jatsakthi", "createdAt": "2020-02-08T02:08:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYzODYzMA=="}], "type": "inlineReview"}, {"oid": "7ae7711ce022baeae04809f9bc418466196e8671", "url": "https://github.com/apache/hbase/commit/7ae7711ce022baeae04809f9bc418466196e8671", "message": "Review Comments 1", "committedDate": "2020-02-08T02:06:38Z", "type": "commit"}, {"oid": "ae0d68a3757890e8f98c46f299aa446d99b06a97", "url": "https://github.com/apache/hbase/commit/ae0d68a3757890e8f98c46f299aa446d99b06a97", "message": "Review Comments 2 : Modify examples to show array of regions is accepted", "committedDate": "2020-02-11T02:43:30Z", "type": "commit"}, {"oid": "d4c921a2015a41fc89ac14a37c85c53d5be6113d", "url": "https://github.com/apache/hbase/commit/d4c921a2015a41fc89ac14a37c85c53d5be6113d", "message": "Add test case to test acceptance of array of regions", "committedDate": "2020-02-11T03:10:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAzNDg5NA==", "url": "https://github.com/apache/hbase/pull/1138#discussion_r379034894", "bodyText": "nit: \"at least\"", "author": "joshelser", "createdAt": "2020-02-13T18:18:05Z", "path": "hbase-shell/src/main/ruby/shell/commands/merge_region.rb", "diffHunk": "@@ -31,18 +31,42 @@ def help\n TestTable,0094429456,1289497600452.527db22f95c8a9e0116f0cc13c680396. then\n the encoded region name portion is 527db22f95c8a9e0116f0cc13c680396\n \n+You can either pass the list of regions as comma separated values or as an\n+array of regions as shown:\n+\n Examples:\n \n   hbase> merge_region 'FULL_REGIONNAME', 'FULL_REGIONNAME'\n-  hbase> merge_region 'FULL_REGIONNAME', 'FULL_REGIONNAME', true\n+  hbase> merge_region 'FULL_REGIONNAME', 'FULL_REGIONNAME', 'FULL_REGIONNAME', ...\n+  hbase> merge_region 'FULL_REGIONNAME', 'FULL_REGIONNAME', 'FULL_REGIONNAME', ..., true\n+\n+  hbase> merge_region ['FULL_REGIONNAME', 'FULL_REGIONNAME']\n+  hbase> merge_region ['FULL_REGIONNAME', 'FULL_REGIONNAME', 'FULL_REGIONNAME', ...]\n+  hbase> merge_region ['FULL_REGIONNAME', 'FULL_REGIONNAME', 'FULL_REGIONNAME', ..., true]\n \n   hbase> merge_region 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME'\n-  hbase> merge_region 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', true\n+  hbase> merge_region 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', ...\n+  hbase> merge_region 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', ..., true\n+\n+  hbase> merge_region ['ENCODED_REGIONNAME', 'ENCODED_REGIONNAME']\n+  hbase> merge_region ['ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', ...]\n+  hbase> merge_region ['ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', 'ENCODED_REGIONNAME', ..., true]\n EOF\n       end\n \n-      def command(region_a_name, region_b_name, force = 'false')\n-        admin.merge_region(region_a_name, region_b_name, force)\n+      def command(*args)\n+        args = args.flatten.compact\n+        args_len = args.length\n+        raise(ArgumentError, 'Must pass atleast 2 regions to merge') unless args_len > 1", "originalCommit": "d4c921a2015a41fc89ac14a37c85c53d5be6113d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA1NTU2OQ==", "url": "https://github.com/apache/hbase/pull/1138#discussion_r379055569", "bodyText": "thanks @joshelser let me make a quick change and push the new commit", "author": "jatsakthi", "createdAt": "2020-02-13T18:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAzNDg5NA=="}], "type": "inlineReview"}, {"oid": "86ce51cb6712b53898f739caec922e66719dbb8b", "url": "https://github.com/apache/hbase/commit/86ce51cb6712b53898f739caec922e66719dbb8b", "message": "Review comments 3: fix spelling", "committedDate": "2020-02-13T21:48:01Z", "type": "commit"}, {"oid": "43de33945a0645232dcec30a743bf22afb34cccd", "url": "https://github.com/apache/hbase/commit/43de33945a0645232dcec30a743bf22afb34cccd", "message": "Fix the array example", "committedDate": "2020-02-13T21:52:48Z", "type": "commit"}]}