{"pr_number": 2254, "pr_title": "HBASE-24875 Remove the force param for unassign since it dose not take effect any more", "pr_createdAt": "2020-08-13T08:20:35Z", "pr_url": "https://github.com/apache/hbase/pull/2254", "timeline": [{"oid": "8fe4e722e172db132319a4a263574f8d6c9bfa0a", "url": "https://github.com/apache/hbase/commit/8fe4e722e172db132319a4a263574f8d6c9bfa0a", "message": "HBASE-24875 Remove the force param for unassign since it dose not take effect any more", "committedDate": "2020-08-13T11:18:25Z", "type": "commit"}, {"oid": "8fe4e722e172db132319a4a263574f8d6c9bfa0a", "url": "https://github.com/apache/hbase/commit/8fe4e722e172db132319a4a263574f8d6c9bfa0a", "message": "HBASE-24875 Remove the force param for unassign since it dose not take effect any more", "committedDate": "2020-08-13T11:18:25Z", "type": "forcePushed"}, {"oid": "dc9832ea94a308f865f0195912dfd22470b446d6", "url": "https://github.com/apache/hbase/commit/dc9832ea94a308f865f0195912dfd22470b446d6", "message": "remove force var from UnassignProcedure", "committedDate": "2020-08-13T15:41:36Z", "type": "commit"}, {"oid": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "url": "https://github.com/apache/hbase/commit/e388b36c59e2f0365fe59053cc5b5a94dcd71907", "message": "fix checkstyle warnings", "committedDate": "2020-08-14T02:17:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5NTM1OA==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470395358", "bodyText": "use a default method here to call unassign(b[]) so that our various implementations can skip including the same.", "author": "busbey", "createdAt": "2020-08-14T03:53:11Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "diffHunk": "@@ -784,9 +791,12 @@ default void move(byte[] encodedRegionName, byte[] destServerName) throws IOExce\n    * @param force If <code>true</code>, force unassign (Will remove region from regions-in-transition too if\n    * present. If results in double assignment use hbck -fix to resolve. To be used by experts).\n    * @throws IOException if a remote or network exception occurs\n+   * @deprecated since 2.4.0 and will be removed in 4.0.0. Use {@link #unassign(byte[])}\n+   *   instead.\n+   * @see <a href=\"https://issues.apache.org/jira/browse/HBASE-24875\">HBASE-24875</a>\n    */\n-  void unassign(byte[] regionName, boolean force)\n-      throws IOException;\n+  @Deprecated\n+  void unassign(byte[] regionName, boolean force) throws IOException;", "originalCommit": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQyMjM3Nw==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470422377", "bodyText": "Will fix later. Thanks.", "author": "bsglz", "createdAt": "2020-08-14T05:46:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5NTM1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5NTcyNQ==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470395725", "bodyText": "use a default method here to call unassign(b[]) so that our various implementations can skip including the same.", "author": "busbey", "createdAt": "2020-08-14T03:54:45Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/AsyncAdmin.java", "diffHunk": "@@ -591,7 +596,11 @@\n    * @param forcible If true, force unassign (Will remove region from regions-in-transition too if\n    *          present. If results in double assignment use hbck -fix to resolve. To be used by\n    *          experts).\n+   * @deprecated since 2.4.0 and will be removed in 4.0.0. Use {@link #unassign(byte[])}\n+   *   instead.\n+   * @see <a href=\"https://issues.apache.org/jira/browse/HBASE-24875\">HBASE-24875</a>\n    */\n+  @Deprecated\n   CompletableFuture<Void> unassign(byte[] regionName, boolean forcible);", "originalCommit": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQyMjcyNQ==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470422725", "bodyText": "Will fix later. Thanks.", "author": "bsglz", "createdAt": "2020-08-14T05:48:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5NTcyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5NzA1Ng==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470397056", "bodyText": "This class is IA.LimitedPrivate, so we could choose to break compat for 2.4.0 and just remove this method for coprocessors.\nIf we are keeping it, when should a coprocessor expect this specific version of preUnassign to get called? would it be called instead of the version without the force parameter or in addition to? These details should be incldued in the javadoc.", "author": "busbey", "createdAt": "2020-08-14T04:00:13Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java", "diffHunk": "@@ -508,35 +508,57 @@ default void postAssign(final ObserverContext<MasterCoprocessorEnvironment> ctx,\n    * Called prior to unassigning a given region.\n    * @param ctx the environment to interact with the framework and master\n    * @param regionInfo\n-   * @param force whether to force unassignment or not\n    */\n   default void preUnassign(final ObserverContext<MasterCoprocessorEnvironment> ctx,\n-      final RegionInfo regionInfo, final boolean force) throws IOException {}\n+    final RegionInfo regionInfo) throws IOException {}\n \n   /**\n    * Called after the region unassignment has been requested.\n    * @param ctx the environment to interact with the framework and master\n    * @param regionInfo\n+   */\n+  default void postUnassign(final ObserverContext<MasterCoprocessorEnvironment> ctx,\n+    final RegionInfo regionInfo) throws IOException {}\n+\n+  /**\n+   * Called prior to unassigning a given region.\n+   * @param ctx the environment to interact with the framework and master\n+   * @param regionInfo region info\n+   * @param force whether to force unassignment or not\n+   * @deprecated since 2.4.0 and will be removed in 4.0.0.", "originalCommit": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQyMzM4OA==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470423388", "bodyText": "Make sense, let's remove it. Thanks.", "author": "bsglz", "createdAt": "2020-08-14T05:50:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5NzA1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5NzIxNQ==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470397215", "bodyText": "This class is IA.LimitedPrivate, so we could choose to break compat for 2.4.0 and just remove this method for coprocessors.\nIf we are keeping it, when should a coprocessor expect this specific version of postUnassign to get called? would it be called instead of the version without the force parameter or in addition to? These details should be incldued in the javadoc.", "author": "busbey", "createdAt": "2020-08-14T04:00:49Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java", "diffHunk": "@@ -508,35 +508,57 @@ default void postAssign(final ObserverContext<MasterCoprocessorEnvironment> ctx,\n    * Called prior to unassigning a given region.\n    * @param ctx the environment to interact with the framework and master\n    * @param regionInfo\n-   * @param force whether to force unassignment or not\n    */\n   default void preUnassign(final ObserverContext<MasterCoprocessorEnvironment> ctx,\n-      final RegionInfo regionInfo, final boolean force) throws IOException {}\n+    final RegionInfo regionInfo) throws IOException {}\n \n   /**\n    * Called after the region unassignment has been requested.\n    * @param ctx the environment to interact with the framework and master\n    * @param regionInfo\n+   */\n+  default void postUnassign(final ObserverContext<MasterCoprocessorEnvironment> ctx,\n+    final RegionInfo regionInfo) throws IOException {}\n+\n+  /**\n+   * Called prior to unassigning a given region.\n+   * @param ctx the environment to interact with the framework and master\n+   * @param regionInfo region info\n+   * @param force whether to force unassignment or not\n+   * @deprecated since 2.4.0 and will be removed in 4.0.0.\n+   *   Use {@link #preUnassign(ObserverContext, RegionInfo)} instead.\n+   */\n+  @Deprecated\n+  default void preUnassign(final ObserverContext<MasterCoprocessorEnvironment> ctx,\n+    final RegionInfo regionInfo, final boolean force) throws IOException {}\n+\n+  /**\n+   * Called after the region unassignment has been requested.\n+   * @param ctx the environment to interact with the framework and master\n+   * @param regionInfo region info\n    * @param force whether to force unassignment or not\n+   * @deprecated since 2.4.0 and will be removed in 4.0.0.", "originalCommit": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQyMzUwMA==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470423500", "bodyText": "Make sense, let's remove it. Thanks.", "author": "bsglz", "createdAt": "2020-08-14T05:50:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5NzIxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5ODA3OA==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470398078", "bodyText": "If we keep both preUnassign methods then this default method should call the one that includes a force flag, with the flag set to false. That would allow existing coprocessors to be used as-is without recompiling, would avoid needing to make a second call in the MasterCoprocessorHost, and would be  easy to document in the javadoc for the deprecation.", "author": "busbey", "createdAt": "2020-08-14T04:04:25Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java", "diffHunk": "@@ -508,35 +508,57 @@ default void postAssign(final ObserverContext<MasterCoprocessorEnvironment> ctx,\n    * Called prior to unassigning a given region.\n    * @param ctx the environment to interact with the framework and master\n    * @param regionInfo\n-   * @param force whether to force unassignment or not\n    */\n   default void preUnassign(final ObserverContext<MasterCoprocessorEnvironment> ctx,\n-      final RegionInfo regionInfo, final boolean force) throws IOException {}\n+    final RegionInfo regionInfo) throws IOException {}", "originalCommit": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQyNDczOQ==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470424739", "bodyText": "Will just remove them, since it is IA.LimitedPrivate. Thanks.", "author": "bsglz", "createdAt": "2020-08-14T05:55:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5ODA3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5ODc5MQ==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470398791", "bodyText": "this breaks compatibility for the shell and will need to be release noted. Alternatively you could do the analagous thing as in the Admin apis and deprecate the second parameter by making it optional and stating it is ignored.", "author": "busbey", "createdAt": "2020-08-14T04:07:12Z", "path": "hbase-shell/src/main/ruby/hbase/admin.rb", "diffHunk": "@@ -537,8 +537,8 @@ def assign(region_name)\n \n     #----------------------------------------------------------------------------------------------\n     # Unassign a region\n-    def unassign(region_name, force)\n-      @admin.unassign(region_name.to_java_bytes, java.lang.Boolean.valueOf(force))\n+    def unassign(region_name)", "originalCommit": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQyODM5OQ==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470428399", "bodyText": "Will fix later. Thanks.", "author": "bsglz", "createdAt": "2020-08-14T06:08:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5ODc5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU3MjMzMg==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r478572332", "bodyText": "this compatibility break is still present. could you correct it similar to how you did for the unassign shell command?", "author": "busbey", "createdAt": "2020-08-27T17:13:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5ODc5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgwNDIyOA==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r478804228", "bodyText": "Fixed, Thanks.", "author": "bsglz", "createdAt": "2020-08-28T03:02:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5ODc5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5OTc3MQ==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470399771", "bodyText": "this breaks compatibility for the shell and will need to be release noted. Alternatively you could keep the optional argument and note that it is deprecated and ignored.", "author": "busbey", "createdAt": "2020-08-14T04:11:34Z", "path": "hbase-shell/src/main/ruby/shell/commands/unassign.rb", "diffHunk": "@@ -23,23 +23,18 @@ class Unassign < Command\n       def help\n         <<-EOF\n Unassign a region. It could be executed only when region in expected state(OPEN).\n-Pass 'true' to force the unassignment ('force' will clear all in-memory state in\n-master before the reassign. If results in double assignment use hbck -fix to resolve.\n-To be used by experts).\n In addition, you can use \"unassigns\" command available on HBCK2 tool to skip the state check.\n (For more info on HBCK2: https://github.com/apache/hbase-operator-tools/blob/master/hbase-hbck2/README.md)\n Use with caution. For experts only.\n Examples:\n \n   hbase> unassign 'REGIONNAME'\n-  hbase> unassign 'REGIONNAME', true\n   hbase> unassign 'ENCODED_REGIONNAME'\n-  hbase> unassign 'ENCODED_REGIONNAME', true\n EOF\n       end\n \n-      def command(region_name, force = 'false')\n-        admin.unassign(region_name, force)\n+      def command(region_name)", "originalCommit": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQyODQyMQ==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470428421", "bodyText": "Will fix later. Thanks.", "author": "bsglz", "createdAt": "2020-08-14T06:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5OTc3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQwMTc3OA==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470401778", "bodyText": "we should add a comment to the protobuf definition for  UnassignRegionStateData in MasterProcedure that the field for force is ignored.", "author": "busbey", "createdAt": "2020-08-14T04:20:33Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/UnassignProcedure.java", "diffHunk": "@@ -80,9 +78,6 @@ protected void serializeStateData(ProcedureStateSerializer serializer) throws IO\n     if (this.destinationServer != null) {\n       state.setDestinationServer(ProtobufUtil.toServerName(destinationServer));\n     }\n-    if (force) {\n-      state.setForce(true);", "originalCommit": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQyOTIwOQ==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470429209", "bodyText": "Will fix later. Thanks.", "author": "bsglz", "createdAt": "2020-08-14T06:11:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQwMTc3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQwMjc3Nw==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470402777", "bodyText": "we should add a comment in the protobuf defition for UnassignRegionRequest in Master that the field for force is ignored.", "author": "busbey", "createdAt": "2020-08-14T04:25:09Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterRpcServices.java", "diffHunk": "@@ -1697,7 +1697,6 @@ public UnassignRegionResponse unassignRegion(RpcController controller,\n     try {\n       final byte [] regionName = req.getRegion().getValue().toByteArray();\n       RegionSpecifierType type = req.getRegion().getType();\n-      final boolean force = req.getForce();", "originalCommit": "e388b36c59e2f0365fe59053cc5b5a94dcd71907", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQyOTIzMA==", "url": "https://github.com/apache/hbase/pull/2254#discussion_r470429230", "bodyText": "Will fix later. Thanks.", "author": "bsglz", "createdAt": "2020-08-14T06:11:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQwMjc3Nw=="}], "type": "inlineReview"}, {"oid": "e34b3b26bb83a13cdb4d195047f6cbb284931146", "url": "https://github.com/apache/hbase/commit/e34b3b26bb83a13cdb4d195047f6cbb284931146", "message": "fix review issue", "committedDate": "2020-08-14T07:02:44Z", "type": "commit"}, {"oid": "4564dc3c7a276b51300171b51ac2d75d6f513501", "url": "https://github.com/apache/hbase/commit/4564dc3c7a276b51300171b51ac2d75d6f513501", "message": "fix review issue", "committedDate": "2020-08-28T03:00:50Z", "type": "commit"}]}