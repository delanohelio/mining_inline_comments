{"pr_number": 1771, "pr_title": "HBASE-24425 Run hbck_chore_run and catalogjanitor_run on draw of 'HBC\u2026", "pr_createdAt": "2020-05-25T03:57:18Z", "pr_url": "https://github.com/apache/hbase/pull/1771", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkxNDQwOQ==", "url": "https://github.com/apache/hbase/pull/1771#discussion_r429914409", "bodyText": "nit: Since we need boolean, we can directly use: Boolean.parseBoolean(cacheParameterValue)", "author": "virajjasani", "createdAt": "2020-05-25T12:41:42Z", "path": "hbase-server/src/main/resources/hbase-webapps/master/hbck.jsp", "diffHunk": "@@ -37,9 +37,17 @@\n <%@ page import=\"org.apache.hadoop.hbase.util.Pair\" %>\n <%@ page import=\"org.apache.hadoop.hbase.master.CatalogJanitor\" %>\n <%@ page import=\"org.apache.hadoop.hbase.master.CatalogJanitor.Report\" %>\n+<%@ page import=\"org.apache.hadoop.hbase.util.Threads\" %>\n <%\n+  final String cacheParameterValue = request.getParameter(\"cache\");\n+  boolean cache = Boolean.valueOf(cacheParameterValue);", "originalCommit": "fa988350db1629bce564889ced9ab8107bf25c05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkxNTI5Mw==", "url": "https://github.com/apache/hbase/pull/1771#discussion_r429915293", "bodyText": "MasterRpcServices throw ServiceException for both runHbckChore and runCatalogScan. Maybe we can handle it and print some nice error message?", "author": "virajjasani", "createdAt": "2020-05-25T12:43:51Z", "path": "hbase-server/src/main/resources/hbase-webapps/master/hbck.jsp", "diffHunk": "@@ -37,9 +37,17 @@\n <%@ page import=\"org.apache.hadoop.hbase.util.Pair\" %>\n <%@ page import=\"org.apache.hadoop.hbase.master.CatalogJanitor\" %>\n <%@ page import=\"org.apache.hadoop.hbase.master.CatalogJanitor.Report\" %>\n+<%@ page import=\"org.apache.hadoop.hbase.util.Threads\" %>\n <%\n+  final String cacheParameterValue = request.getParameter(\"cache\");\n+  boolean cache = Boolean.valueOf(cacheParameterValue);\n   final HMaster master = (HMaster) getServletContext().getAttribute(HMaster.MASTER);\n   pageContext.setAttribute(\"pageTitle\", \"HBase Master HBCK Report: \" + master.getServerName());\n+  if (!cache) {\n+    // Run the two reporters inline w/ drawing of the page. If exception, will show in page draw.\n+    master.getMasterRpcServices().runHbckChore(null, null);\n+    master.getMasterRpcServices().runCatalogScan(null, null);", "originalCommit": "fa988350db1629bce564889ced9ab8107bf25c05", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0OTQ1OQ==", "url": "https://github.com/apache/hbase/pull/1771#discussion_r430649459", "bodyText": "Yeah. Was thinking about it. Though the rare SE not the end of the world. Added something at your prompting.... it looks like this when generated...\n   if (!Boolean.parseBoolean(cacheParameterValue)) {\n     // Run the two reporters inline w/ drawing of the page. If exception, will show in page draw.\n     try {\n       master.getMasterRpcServices().runHbckChore(null, null);\n     } catch (org.apache.hbase.thirdparty.com.google.protobuf.ServiceException se) {\n       out.write(\"Failed generating a new hbck_chore report; using cache; try again or run hbck_chore_run in the shell: \" + se.getMessage() + \"\\n\");\n     }\n     try {\n       master.getMasterRpcServices().runCatalogScan(null, null);\n     } catch (org.apache.hbase.thirdparty.com.google.protobuf.ServiceException se) {\n       out.write(\"Failed generating a new catalogjanitor report; using cache; try again or run catalogjanitor_run in the shell: \" + se.getMessage() + \"\\n\");\n     }\n   }", "author": "saintstack", "createdAt": "2020-05-26T19:19:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkxNTI5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkxNjAyNw==", "url": "https://github.com/apache/hbase/pull/1771#discussion_r429916027", "bodyText": "Not being used it seems.", "author": "virajjasani", "createdAt": "2020-05-25T12:45:39Z", "path": "hbase-server/src/main/resources/hbase-webapps/master/hbck.jsp", "diffHunk": "@@ -37,9 +37,17 @@\n <%@ page import=\"org.apache.hadoop.hbase.util.Pair\" %>\n <%@ page import=\"org.apache.hadoop.hbase.master.CatalogJanitor\" %>\n <%@ page import=\"org.apache.hadoop.hbase.master.CatalogJanitor.Report\" %>\n+<%@ page import=\"org.apache.hadoop.hbase.util.Threads\" %>", "originalCommit": "fa988350db1629bce564889ced9ab8107bf25c05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0c8cd39d610e87f7aeed87605447cab8a732a580", "url": "https://github.com/apache/hbase/commit/0c8cd39d610e87f7aeed87605447cab8a732a580", "message": "HBASE-24425 Run hbck_chore_run and catalogjanitor_run on draw of 'HBCK Report' page", "committedDate": "2020-05-26T19:20:01Z", "type": "commit"}, {"oid": "0c8cd39d610e87f7aeed87605447cab8a732a580", "url": "https://github.com/apache/hbase/commit/0c8cd39d610e87f7aeed87605447cab8a732a580", "message": "HBASE-24425 Run hbck_chore_run and catalogjanitor_run on draw of 'HBCK Report' page", "committedDate": "2020-05-26T19:20:01Z", "type": "forcePushed"}]}