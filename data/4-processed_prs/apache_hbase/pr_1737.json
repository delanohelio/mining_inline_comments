{"pr_number": 1737, "pr_title": "HBASE-24382 Flush partial stores of region filtered by seqId when arc\u2026", "pr_createdAt": "2020-05-19T10:37:31Z", "pr_url": "https://github.com/apache/hbase/pull/1737", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQwNDQ2Mg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r428404462", "bodyText": "If we want to use contains then we better use a Set instead of a List?", "author": "Apache9", "createdAt": "2020-05-21T02:00:45Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2444,8 +2451,16 @@ public FlushResultImpl flushcache(boolean forceFlushAllStores, boolean writeFlus\n       }\n \n       try {\n-        Collection<HStore> specificStoresToFlush =\n+        Collection<HStore> specificStoresToFlush = null;\n+        if (!forceFlushAllStores && families != null) {\n+          specificStoresToFlush = stores.entrySet().stream()\n+            .filter(e -> families.contains(Bytes.toString(e.getKey())))", "originalCommit": "b8b0e46c7ae8aa73df09491b10bd55acd9b1a2be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQxMjQyNg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r428412426", "bodyText": "So why we choose String instead of byte[] here?\n\n1\u3001The family name stored as private byte[] in ImmutableByteArray, if use byte[], it need twice convertion.\n2\u3001We use the method of contains to filter them later, use string seems esaliy to do.\nCorrect me if i have some mistake.\n\nIf we want to use contains then we better use a Set instead of a List?\n\nYeah, you are right, will fix.\nThanks a lot.", "author": "bsglz", "createdAt": "2020-05-21T02:33:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQwNDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQxOTkzNw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r428419937", "bodyText": "If the String is ok, i will push a commit later, or else i will research more.\nThanks.", "author": "bsglz", "createdAt": "2020-05-21T03:04:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQwNDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ2NDk1Nw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r428464957", "bodyText": "In the WAL interface, we all use byte[] as family name, so I prefer we also use byte[] here. You could use TreeSet with BytesComparator to hold byte[].", "author": "Apache9", "createdAt": "2020-05-21T06:14:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQwNDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ2ODg1Ng==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r428468856", "bodyText": "Ok, will use byte[] instead of String.\nIn addition,since we do not need a sorted collection,  i could iterate the families to avoid use contains.\nThanks.", "author": "bsglz", "createdAt": "2020-05-21T06:26:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQwNDQ2Mg=="}], "type": "inlineReview"}, {"oid": "631f0f66585a559ecddc32b302c4bc4304ab0376", "url": "https://github.com/apache/hbase/commit/631f0f66585a559ecddc32b302c4bc4304ab0376", "message": "HBASE-24382 Flush partial stores of region filtered by seqId when archive wal due to too many wals", "committedDate": "2020-05-23T09:31:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMjAxNw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r429532017", "bodyText": "Change the comment?", "author": "Apache9", "createdAt": "2020-05-23T09:48:31Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/LogRoller.java", "diffHunk": "@@ -59,7 +61,7 @@ protected void scheduleFlush(String encodedRegionName) {\n       return;\n     }\n     // force flushing all stores to clean old logs", "originalCommit": "631f0f66585a559ecddc32b302c4bc4304ab0376", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0MDI3Mw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r429540273", "bodyText": "Fixed.", "author": "bsglz", "createdAt": "2020-05-23T12:07:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMjAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMjE0NA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r429532144", "bodyText": "Better use a TreeMap with BytesComparator?", "author": "Apache9", "createdAt": "2020-05-23T09:50:49Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/SequenceIdAccounting.java", "diffHunk": "@@ -440,27 +440,27 @@ boolean areAllLower(Map<byte[], Long> sequenceids, Collection<byte[]> keysBlocki\n    * {@link #lowestUnflushedSequenceIds} has a sequence id less than that passed in\n    * <code>sequenceids</code> then return it.\n    * @param sequenceids Sequenceids keyed by encoded region name.\n-   * @return regions found in this instance with sequence ids less than those passed in.\n+   * @return stores of regions found in this instance with sequence ids less than those passed in.\n    */\n-  byte[][] findLower(Map<byte[], Long> sequenceids) {\n-    List<byte[]> toFlush = null;\n+  Map<byte[], List<byte[]>> findLower(Map<byte[], Long> sequenceids) {\n+    Map<byte[], List<byte[]>> toFlush = null;\n     // Keeping the old behavior of iterating unflushedSeqNums under oldestSeqNumsLock.\n     synchronized (tieLock) {\n       for (Map.Entry<byte[], Long> e : sequenceids.entrySet()) {\n         Map<ImmutableByteArray, Long> m = this.lowestUnflushedSequenceIds.get(e.getKey());\n         if (m == null) {\n           continue;\n         }\n-        // The lowest sequence id outstanding for this region.\n-        long lowest = getLowestSequenceId(m);\n-        if (lowest != HConstants.NO_SEQNUM && lowest <= e.getValue()) {\n-          if (toFlush == null) {\n-            toFlush = new ArrayList<>();\n+        for (Map.Entry<ImmutableByteArray, Long> me : m.entrySet()) {\n+          if (me.getValue() <= e.getValue()) {\n+            if (toFlush == null) {\n+              toFlush = new HashMap<>();", "originalCommit": "631f0f66585a559ecddc32b302c4bc4304ab0376", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0MDMxOQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r429540319", "bodyText": "Fixed.\nThanks a lot.", "author": "bsglz", "createdAt": "2020-05-23T12:08:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMjE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4NzE3NQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r431987175", "bodyText": "Should this family selection pass through the flushPolicy?", "author": "saintstack", "createdAt": "2020-05-28T17:00:28Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2444,8 +2451,16 @@ public FlushResultImpl flushcache(boolean forceFlushAllStores, boolean writeFlus\n       }\n \n       try {\n-        Collection<HStore> specificStoresToFlush =\n+        Collection<HStore> specificStoresToFlush = null;\n+        if (!forceFlushAllStores && families != null) {\n+          specificStoresToFlush = new ArrayList<>();\n+          for (byte[] family : families) {\n+            specificStoresToFlush.add(stores.get(family));", "originalCommit": "bc0089a687d02b55706b0b4baf9173b013531de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3MTk2NA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r432271964", "bodyText": "Moved to FlushPolicy, seems better.", "author": "bsglz", "createdAt": "2020-05-29T06:01:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4NzE3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4NzM4Nw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r431987387", "bodyText": "Be careful here. Make code look like rest of the file. Add space around the 'else'.", "author": "saintstack", "createdAt": "2020-05-28T17:00:50Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2444,8 +2451,16 @@ public FlushResultImpl flushcache(boolean forceFlushAllStores, boolean writeFlus\n       }\n \n       try {\n-        Collection<HStore> specificStoresToFlush =\n+        Collection<HStore> specificStoresToFlush = null;\n+        if (!forceFlushAllStores && families != null) {\n+          specificStoresToFlush = new ArrayList<>();\n+          for (byte[] family : families) {\n+            specificStoresToFlush.add(stores.get(family));\n+          }\n+        }else{", "originalCommit": "bc0089a687d02b55706b0b4baf9173b013531de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2NzU5Ng==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r432267596", "bodyText": "Sorry for the careless.", "author": "bsglz", "createdAt": "2020-05-29T05:46:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4NzM4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4ODAyNg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r431988026", "bodyText": "Space after comma (Make your code follow convention of surrounding code)", "author": "saintstack", "createdAt": "2020-05-28T17:01:43Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MemStoreFlusher.java", "diffHunk": "@@ -459,13 +459,18 @@ private FlushType isAboveLowWaterMark() {\n   }\n \n   @Override\n-  public boolean requestFlush(HRegion r, boolean forceFlushAllStores,\n-                              FlushLifeCycleTracker tracker) {\n+  public boolean requestFlush(HRegion r, boolean forceFlushAllStores,FlushLifeCycleTracker tracker) {", "originalCommit": "bc0089a687d02b55706b0b4baf9173b013531de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2Nzk2NQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r432267965", "bodyText": "Ditto", "author": "bsglz", "createdAt": "2020-05-29T05:47:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4ODAyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk5MDE0OQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r431990149", "bodyText": "Usually ',' for lists.", "author": "saintstack", "createdAt": "2020-05-28T17:04:16Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/AbstractFSWAL.java", "diffHunk": "@@ -639,26 +641,30 @@ public int getNumLogFiles() {\n    * If the number of un-archived WAL files ('live' WALs) is greater than maximum allowed,\n    * check the first (oldest) WAL, and return those regions which should be flushed so that\n    * it can be let-go/'archived'.\n-   * @return regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n+   * @return stores of regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n    */\n-  byte[][] findRegionsToForceFlush() throws IOException {\n-    byte[][] regions = null;\n+  Map<byte[], List<byte[]>> findRegionsToForceFlush() throws IOException {\n+    Map<byte[], List<byte[]>> regions = null;\n     int logCount = getNumRolledLogFiles();\n     if (logCount > this.maxLogs && logCount > 0) {\n       Map.Entry<Path, WalProps> firstWALEntry = this.walFile2Props.firstEntry();\n       regions =\n         this.sequenceIdAccounting.findLower(firstWALEntry.getValue().encodedName2HighestSequenceId);\n     }\n     if (regions != null) {\n-      StringBuilder sb = new StringBuilder();\n-      for (int i = 0; i < regions.length; i++) {\n-        if (i > 0) {\n-          sb.append(\", \");\n+      List<String> listForPrint = new ArrayList();\n+      for (Map.Entry<byte[], List<byte[]>> r : regions.entrySet()) {\n+        StringBuffer families = new StringBuffer();\n+        for (int i = 0; i < r.getValue().size(); i++) {\n+          if (i > 0) {\n+            families.append(\"|\");", "originalCommit": "bc0089a687d02b55706b0b4baf9173b013531de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2ODY5Mg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r432268692", "bodyText": "Will fix", "author": "bsglz", "createdAt": "2020-05-29T05:50:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk5MDE0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAwMDgyOA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r432000828", "bodyText": "s/forcing flush partial stores of/forcing (partial) flush of/", "author": "saintstack", "createdAt": "2020-05-28T17:22:53Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/AbstractFSWAL.java", "diffHunk": "@@ -639,26 +641,30 @@ public int getNumLogFiles() {\n    * If the number of un-archived WAL files ('live' WALs) is greater than maximum allowed,\n    * check the first (oldest) WAL, and return those regions which should be flushed so that\n    * it can be let-go/'archived'.\n-   * @return regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n+   * @return stores of regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n    */\n-  byte[][] findRegionsToForceFlush() throws IOException {\n-    byte[][] regions = null;\n+  Map<byte[], List<byte[]>> findRegionsToForceFlush() throws IOException {\n+    Map<byte[], List<byte[]>> regions = null;\n     int logCount = getNumRolledLogFiles();\n     if (logCount > this.maxLogs && logCount > 0) {\n       Map.Entry<Path, WalProps> firstWALEntry = this.walFile2Props.firstEntry();\n       regions =\n         this.sequenceIdAccounting.findLower(firstWALEntry.getValue().encodedName2HighestSequenceId);\n     }\n     if (regions != null) {\n-      StringBuilder sb = new StringBuilder();\n-      for (int i = 0; i < regions.length; i++) {\n-        if (i > 0) {\n-          sb.append(\", \");\n+      List<String> listForPrint = new ArrayList();\n+      for (Map.Entry<byte[], List<byte[]>> r : regions.entrySet()) {\n+        StringBuffer families = new StringBuffer();\n+        for (int i = 0; i < r.getValue().size(); i++) {\n+          if (i > 0) {\n+            families.append(\"|\");\n+          }\n+          families.append(Bytes.toString(r.getValue().get(i)));\n         }\n-        sb.append(Bytes.toStringBinary(regions[i]));\n+        listForPrint.add(Bytes.toStringBinary(r.getKey()) + \"[\" + families.toString() + \"]\");\n       }\n       LOG.info(\"Too many WALs; count=\" + logCount + \", max=\" + this.maxLogs +\n-        \"; forcing flush of \" + regions.length + \" regions(s): \" + sb.toString());\n+        \"; forcing flush partial stores of \" + regions.size() + \" region(s): \" + StringUtils.join(\",\", listForPrint));", "originalCommit": "bc0089a687d02b55706b0b4baf9173b013531de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2OTAxMg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r432269012", "bodyText": "Will fix.", "author": "bsglz", "createdAt": "2020-05-29T05:51:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAwMDgyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4OTYxNw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r430389617", "bodyText": "StringBuilder", "author": "Apache9", "createdAt": "2020-05-26T12:55:01Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/AbstractFSWAL.java", "diffHunk": "@@ -639,26 +641,30 @@ public int getNumLogFiles() {\n    * If the number of un-archived WAL files ('live' WALs) is greater than maximum allowed,\n    * check the first (oldest) WAL, and return those regions which should be flushed so that\n    * it can be let-go/'archived'.\n-   * @return regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n+   * @return stores of regions (encodedRegionNames) to flush in order to archive oldest WAL file.\n    */\n-  byte[][] findRegionsToForceFlush() throws IOException {\n-    byte[][] regions = null;\n+  Map<byte[], List<byte[]>> findRegionsToForceFlush() throws IOException {\n+    Map<byte[], List<byte[]>> regions = null;\n     int logCount = getNumRolledLogFiles();\n     if (logCount > this.maxLogs && logCount > 0) {\n       Map.Entry<Path, WalProps> firstWALEntry = this.walFile2Props.firstEntry();\n       regions =\n         this.sequenceIdAccounting.findLower(firstWALEntry.getValue().encodedName2HighestSequenceId);\n     }\n     if (regions != null) {\n-      StringBuilder sb = new StringBuilder();\n-      for (int i = 0; i < regions.length; i++) {\n-        if (i > 0) {\n-          sb.append(\", \");\n+      List<String> listForPrint = new ArrayList();\n+      for (Map.Entry<byte[], List<byte[]>> r : regions.entrySet()) {\n+        StringBuffer families = new StringBuffer();", "originalCommit": "bc0089a687d02b55706b0b4baf9173b013531de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEyMjc1Mg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r433122752", "bodyText": "Will fix.", "author": "bsglz", "createdAt": "2020-06-01T09:05:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4OTYxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4OTg0NQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r430389845", "bodyText": "Avoid star imports.", "author": "Apache9", "createdAt": "2020-05-26T12:55:22Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/SequenceIdAccounting.java", "diffHunk": "@@ -19,13 +19,7 @@\n \n import static org.apache.hadoop.hbase.util.ConcurrentMapUtils.computeIfAbsent;\n \n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.Collections;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n+import java.util.*;", "originalCommit": "bc0089a687d02b55706b0b4baf9173b013531de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEyMjgyMw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r433122823", "bodyText": "Will fix.", "author": "bsglz", "createdAt": "2020-06-01T09:05:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM4OTg0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM5MDIwOA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r430390208", "bodyText": "Just return toFlush?", "author": "Apache9", "createdAt": "2020-05-26T12:55:59Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/SequenceIdAccounting.java", "diffHunk": "@@ -440,27 +434,27 @@ boolean areAllLower(Map<byte[], Long> sequenceids, Collection<byte[]> keysBlocki\n    * {@link #lowestUnflushedSequenceIds} has a sequence id less than that passed in\n    * <code>sequenceids</code> then return it.\n    * @param sequenceids Sequenceids keyed by encoded region name.\n-   * @return regions found in this instance with sequence ids less than those passed in.\n+   * @return stores of regions found in this instance with sequence ids less than those passed in.\n    */\n-  byte[][] findLower(Map<byte[], Long> sequenceids) {\n-    List<byte[]> toFlush = null;\n+  Map<byte[], List<byte[]>> findLower(Map<byte[], Long> sequenceids) {\n+    Map<byte[], List<byte[]>> toFlush = null;\n     // Keeping the old behavior of iterating unflushedSeqNums under oldestSeqNumsLock.\n     synchronized (tieLock) {\n       for (Map.Entry<byte[], Long> e : sequenceids.entrySet()) {\n         Map<ImmutableByteArray, Long> m = this.lowestUnflushedSequenceIds.get(e.getKey());\n         if (m == null) {\n           continue;\n         }\n-        // The lowest sequence id outstanding for this region.\n-        long lowest = getLowestSequenceId(m);\n-        if (lowest != HConstants.NO_SEQNUM && lowest <= e.getValue()) {\n-          if (toFlush == null) {\n-            toFlush = new ArrayList<>();\n+        for (Map.Entry<ImmutableByteArray, Long> me : m.entrySet()) {\n+          if (me.getValue() <= e.getValue()) {\n+            if (toFlush == null) {\n+              toFlush = new TreeMap(Bytes.BYTES_COMPARATOR);\n+            }\n+            toFlush.computeIfAbsent(e.getKey(), k -> new ArrayList<>()).add(Bytes.toBytes(me.getKey().toString()));\n           }\n-          toFlush.add(e.getKey());\n         }\n       }\n     }\n-    return toFlush == null ? null : toFlush.toArray(new byte[0][]);\n+    return toFlush == null ? null : toFlush;", "originalCommit": "bc0089a687d02b55706b0b4baf9173b013531de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEyMjYxMQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r433122611", "bodyText": "Oh, awkward.", "author": "bsglz", "createdAt": "2020-06-01T09:05:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM5MDIwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzExMDgzNg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r433110836", "bodyText": "What's this?", "author": "Apache9", "createdAt": "2020-06-01T08:39:02Z", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/AbstractTestWALReplay.java", "diffHunk": "@@ -9,7 +9,7 @@\n  * with the License.  You may obtain a copy of the License at\n  *\n  *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n+ *TestFlusher", "originalCommit": "e1463fb7a0b15c15a29ce622ec8ad23505975d99", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEyMzc0MA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r433123740", "bodyText": "Will fix, editing error.\nThanks.", "author": "bsglz", "createdAt": "2020-06-01T09:07:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzExMDgzNg=="}], "type": "inlineReview"}, {"oid": "f62cb51f58fb416df00c8828931e84f871dbee34", "url": "https://github.com/apache/hbase/commit/f62cb51f58fb416df00c8828931e84f871dbee34", "message": "HBASE-24382 Flush partial stores of region filtered by seqId when archive wal due to too many wals", "committedDate": "2020-06-01T13:34:01Z", "type": "forcePushed"}, {"oid": "ba27fe16f14d7f620dbfc7d010cafe4c40b7f8f7", "url": "https://github.com/apache/hbase/commit/ba27fe16f14d7f620dbfc7d010cafe4c40b7f8f7", "message": "HBASE-24382 Flush partial stores of region filtered by seqId when archive wal due to too many wals", "committedDate": "2020-06-02T03:09:13Z", "type": "commit"}, {"oid": "ba27fe16f14d7f620dbfc7d010cafe4c40b7f8f7", "url": "https://github.com/apache/hbase/commit/ba27fe16f14d7f620dbfc7d010cafe4c40b7f8f7", "message": "HBASE-24382 Flush partial stores of region filtered by seqId when archive wal due to too many wals", "committedDate": "2020-06-02T03:09:13Z", "type": "forcePushed"}, {"oid": "994a2eb60d9a0acccfc761429b2ae7a33349efd9", "url": "https://github.com/apache/hbase/commit/994a2eb60d9a0acccfc761429b2ae7a33349efd9", "message": "fix checkstyle and javadoc issue", "committedDate": "2020-06-05T13:48:05Z", "type": "commit"}, {"oid": "ff0b09041215c4a49200c938aa4a52d7aa43f87c", "url": "https://github.com/apache/hbase/commit/ff0b09041215c4a49200c938aa4a52d7aa43f87c", "message": "fix javadoc issues", "committedDate": "2020-06-05T14:48:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MDkxMw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436450913", "bodyText": "Could be static?", "author": "saintstack", "createdAt": "2020-06-08T04:24:41Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushPolicy.java", "diffHunk": "@@ -46,4 +49,16 @@ protected void configureForRegion(HRegion region) {\n    */\n   public abstract Collection<HStore> selectStoresToFlush();\n \n+  /**\n+   * select stores which matches the specified families\n+   *\n+   * @return the stores need to be flushed.\n+   */\n+  public Collection<HStore> selectStoresToFlush(Map<byte[], HStore> stores, List<byte[]> families) {", "originalCommit": "ff0b09041215c4a49200c938aa4a52d7aa43f87c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ5MTQzMQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436491431", "bodyText": "Yeah, if still as part of FlushPolicy after discuss.", "author": "bsglz", "createdAt": "2020-06-08T06:59:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MDkxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436451263", "bodyText": "If this true, does it mean flush all familes even if only a subset passed in families?", "author": "saintstack", "createdAt": "2020-06-08T04:26:43Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushRequester.java", "diffHunk": "@@ -36,6 +38,18 @@\n    */\n   boolean requestFlush(HRegion region, boolean forceFlushAllStores, FlushLifeCycleTracker tracker);\n \n+  /**\n+   * Tell the listener the cache needs to be flushed.\n+   *\n+   * @param region the Region requesting the cache flush\n+   * @param forceFlushAllStores whether we want to flush all stores. e.g., when request from log", "originalCommit": "ff0b09041215c4a49200c938aa4a52d7aa43f87c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTgzOQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436451839", "bodyText": "If this is case, maybe say so in the javadoc?", "author": "saintstack", "createdAt": "2020-06-08T04:30:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MjU0OA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436452548", "bodyText": "Yeah, if this is true, families are ignored.", "author": "saintstack", "createdAt": "2020-06-08T04:34:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ5Mjk4MA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436492980", "bodyText": "Will add some content for this.", "author": "bsglz", "createdAt": "2020-06-08T07:03:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzIyNw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445307227", "bodyText": "Did you add comment to clarify what is going on here? I don't see it. Maybe it is elsewhere?", "author": "saintstack", "createdAt": "2020-06-25T04:59:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzM4MA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445307380", "bodyText": "Oh, I see it in next line. Let me resolve.", "author": "saintstack", "createdAt": "2020-06-25T04:59:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1MTI2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NDc2Nw==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436454767", "bodyText": "So, looking at the flushPolicy implementations we currently have, I see two:\nFlushAllStoresPolicy\nand\nFlushLargeStoresPolicy\nGiven the current implementations, passing a subset of families doesn't seem appropriate at least for the FlushAllStoresPolicy -- if we flush some families only, then we are not flushing AllStores -- and perhaps for the FlushLargeStoresPolicy since we are not flushing the large but the passed families.\nDo you need to create a new flush policy? One that does the subset of families passed? If user configures the FlushAllStoresPolicy and instead we only flush a subset, then they will be confused.\nWhy do we pass in stores into selectStoresToFlush? We do not need the list of stores in the flushAllStoresPolicy. It has access to 'this' so can figure what Stores are in the Region.", "author": "saintstack", "createdAt": "2020-06-08T04:46:43Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2457,8 +2463,13 @@ public FlushResultImpl flushcache(boolean forceFlushAllStores, boolean writeFlus\n       }\n \n       try {\n-        Collection<HStore> specificStoresToFlush =\n+        Collection<HStore> specificStoresToFlush = null;\n+        if (!forceFlushAllStores && families != null) {\n+          specificStoresToFlush = flushPolicy.selectStoresToFlush(stores, families);", "originalCommit": "ff0b09041215c4a49200c938aa4a52d7aa43f87c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ4NDY2NQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436484665", "bodyText": "Why do we pass in stores into selectStoresToFlush? We do not need the list of stores in the flushAllStoresPolicy. It has access to 'this' so can figure what Stores are in the Region.\n\nAs comment below, maybe it should not be part of flushPolicy?", "author": "bsglz", "createdAt": "2020-06-08T06:42:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NDc2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjE3NA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436456174", "bodyText": "We are in here because a force roll was requested.  You change the true to false. Isn't that changing behavior at least for the default flush all stores case?", "author": "saintstack", "createdAt": "2020-06-08T04:53:42Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/LogRoller.java", "diffHunk": "@@ -58,8 +60,8 @@ protected void scheduleFlush(String encodedRegionName) {\n         encodedRegionName, r);\n       return;\n     }\n-    // force flushing all stores to clean old logs\n-    requester.requestFlush(r, true, FlushLifeCycleTracker.DUMMY);\n+    // force flushing specified stores to clean old logs\n+    requester.requestFlush(r, false, families, FlushLifeCycleTracker.DUMMY);", "originalCommit": "ff0b09041215c4a49200c938aa4a52d7aa43f87c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ5MDkwNA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436490904", "bodyText": "Yeah, it changes and only changes behavior in case that wals is too many.", "author": "bsglz", "createdAt": "2020-06-08T06:58:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc2OTA1OA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r437769058", "bodyText": "Are you sure. You change the force from true to false in line above.", "author": "saintstack", "createdAt": "2020-06-09T23:02:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA3NDQ0NQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r438074445", "bodyText": "Errr, is this line could be executed in other case except too many wals?\nChecked the code again, seems not, Correct me if i miss something.", "author": "bsglz", "createdAt": "2020-06-10T12:14:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMxNTA5NA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445315094", "bodyText": "The flag is set when we are in a critical condition -- the WAL count is in excess of our WAL limit. The flag's intent IIRC is that we flush all stores regardless of what determination is made at flush time as to which stores are in need of flush or not; the old edit may actually be hanging out in a store that is small and not in need of flush normally or in accordance w/ some flush policy. The flag says 'force' the flush. My understanding is that this is a FlushRequest usually but the flag changes the request to a demand.\nHere you are passing a set of stores instead where the stores chosen are the ones that will free up WALs. So, this flag is now redundant? We should purge it. Now it will confuse since the 'force' instead is a list of families to flush -- else its null if old behavior.", "author": "saintstack", "createdAt": "2020-06-25T05:29:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMxODI4NA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445318284", "bodyText": "Looking around, this is the only time forceFlushAllStores is set to true -- when we have too many WALs and we need to clear the old ones out.", "author": "saintstack", "createdAt": "2020-06-25T05:41:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjE3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NzQ2Mg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436457462", "bodyText": "I do like this change in the return type from Region to Region Stores. I am wary that we are changing the default behavior.", "author": "saintstack", "createdAt": "2020-06-08T05:00:15Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/AbstractWALRoller.java", "diffHunk": "@@ -180,18 +181,18 @@ public void run() {\n           WAL wal = entry.getKey();\n           // reset the flag in front to avoid missing roll request before we return from rollWriter.\n           walNeedsRoll.put(wal, Boolean.FALSE);\n-          byte[][] regionsToFlush = null;\n+          Map<byte[], List<byte[]>> regionsToFlush = null;\n           try {\n             // Force the roll if the logroll.period is elapsed or if a roll was requested.\n-            // The returned value is an array of actual region names.\n+            // The returned value is an collection of actual region and family names.\n             regionsToFlush = wal.rollWriter(periodic || entry.getValue().booleanValue());\n           } catch (WALClosedException e) {\n             LOG.warn(\"WAL has been closed. Skipping rolling of writer and just remove it\", e);\n             iter.remove();\n           }\n           if (regionsToFlush != null) {\n-            for (byte[] r : regionsToFlush) {\n-              scheduleFlush(Bytes.toString(r));\n+            for (Map.Entry<byte[], List<byte[]>> r : regionsToFlush.entrySet()) {", "originalCommit": "ff0b09041215c4a49200c938aa4a52d7aa43f87c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ5MDE3MQ==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r436490171", "bodyText": "I understand your concern, but i think the test is enough, and we just change the behavier when families is not null, and it will only comes from logRoller, and it only could be happend when wals is too many.", "author": "bsglz", "createdAt": "2020-06-08T06:56:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NzQ2Mg=="}], "type": "inlineReview"}, {"oid": "5632d9f317506501ae72817808daed3d5af9d347", "url": "https://github.com/apache/hbase/commit/5632d9f317506501ae72817808daed3d5af9d347", "message": "move the geting of stores to HRegion, since it should not be part of FlushPolicy, and comment fix", "committedDate": "2020-06-09T13:33:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4OTM4Ng==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r444289386", "bodyText": "Should remove these imports? Seems we add a method in this class and then moved it out but forgot to remove these imports?", "author": "Apache9", "createdAt": "2020-06-23T14:55:32Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushPolicy.java", "diffHunk": "@@ -17,7 +17,10 @@\n  */\n package org.apache.hadoop.hbase.regionserver;\n \n+import java.util.ArrayList;", "originalCommit": "5632d9f317506501ae72817808daed3d5af9d347", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwMjkwMg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r444302902", "bodyText": "Oh, you are right, fixed.\nThanks.", "author": "bsglz", "createdAt": "2020-06-23T15:14:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4OTM4Ng=="}], "type": "inlineReview"}, {"oid": "78b9b5afdc77385e3d228467f512fe231c0f4e75", "url": "https://github.com/apache/hbase/commit/78b9b5afdc77385e3d228467f512fe231c0f4e75", "message": "fix checkstyle issue", "committedDate": "2020-06-23T15:12:21Z", "type": "commit"}, {"oid": "d494fca7e9ba36912ae4992366b3370860277d89", "url": "https://github.com/apache/hbase/commit/d494fca7e9ba36912ae4992366b3370860277d89", "message": "add some comment", "committedDate": "2020-06-25T05:29:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzU4OA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445307588", "bodyText": "If null is passed, does that mean all families?", "author": "saintstack", "createdAt": "2020-06-25T05:00:24Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2400,6 +2405,7 @@ public FlushResult flush(boolean force) throws IOException {\n    * <p>This method may block for some time, so it should not be called from a\n    * time-sensitive thread.\n    * @param forceFlushAllStores whether we want to flush all stores\n+   * @param families stores of region to flush.", "originalCommit": "78b9b5afdc77385e3d228467f512fe231c0f4e75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzczNg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445307736", "bodyText": "Yeah, looks like it.", "author": "saintstack", "createdAt": "2020-06-25T05:00:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMxNzMyMg==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445317322", "bodyText": "So all families in a Region if 'families' is null or if forceFlushAllStores is true?", "author": "saintstack", "createdAt": "2020-06-25T05:37:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMyMzU1Ng==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445323556", "bodyText": "No, only if forceFlushAllStores is true we select all families.", "author": "bsglz", "createdAt": "2020-06-25T05:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzU4OA=="}], "type": "inlineReview"}, {"oid": "9d2a3ea2f1e1c0a4c3cd2f18e29115fba5bfd713", "url": "https://github.com/apache/hbase/commit/9d2a3ea2f1e1c0a4c3cd2f18e29115fba5bfd713", "message": "remove the forceFlushAllStores since we can use families to determine how to select stores to flush", "committedDate": "2020-06-25T17:06:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NzUxNA==", "url": "https://github.com/apache/hbase/pull/1737#discussion_r445967514", "bodyText": "Good", "author": "saintstack", "createdAt": "2020-06-26T04:58:03Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -2386,6 +2386,16 @@ public FlushResult flush(boolean force) throws IOException {\n     boolean isCompactionNeeded();\n   }\n \n+  public FlushResultImpl flushcache(boolean flushAllStores, boolean writeFlushRequestWalMarker,\n+    FlushLifeCycleTracker tracker) throws IOException {\n+    List families = null;\n+    if (flushAllStores) {\n+      families = new ArrayList();\n+      families.addAll(this.getTableDescriptor().getColumnFamilyNames());\n+    }\n+    return this.flushcache(families, writeFlushRequestWalMarker, tracker);\n+  }", "originalCommit": "9d2a3ea2f1e1c0a4c3cd2f18e29115fba5bfd713", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}