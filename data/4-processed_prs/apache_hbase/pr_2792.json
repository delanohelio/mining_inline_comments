{"pr_number": 2792, "pr_title": "HBASE-25420 Some minor improvements in rpc implementation", "pr_createdAt": "2020-12-19T12:27:46Z", "pr_url": "https://github.com/apache/hbase/pull/2792", "timeline": [{"oid": "2ce0b8417b788999a11f91d8d305af264aa9d25f", "url": "https://github.com/apache/hbase/commit/2ce0b8417b788999a11f91d8d305af264aa9d25f", "message": "HBASE-25420 Some minor improvements in rpc implementation", "committedDate": "2020-12-19T12:24:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI2ODk4Nw==", "url": "https://github.com/apache/hbase/pull/2792#discussion_r546268987", "bodyText": "This a bug fix? Passing the executor?", "author": "saintstack", "createdAt": "2020-12-19T18:35:59Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/NettyRpcDuplexHandler.java", "diffHunk": "@@ -103,8 +103,8 @@ private void writeRequest(ChannelHandlerContext ctx, Call call, ChannelPromise p\n         ctx.write(buf, withoutCellBlockPromise);\n         ChannelPromise cellBlockPromise = ctx.newPromise();\n         ctx.write(cellBlock, cellBlockPromise);\n-        PromiseCombiner combiner = new PromiseCombiner();\n-        combiner.addAll(withoutCellBlockPromise, cellBlockPromise);\n+        PromiseCombiner combiner = new PromiseCombiner(ctx.executor());", "originalCommit": "2ce0b8417b788999a11f91d8d305af264aa9d25f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMxNDIwNw==", "url": "https://github.com/apache/hbase/pull/2792#discussion_r546314207", "bodyText": "The default constructor has been deprecated.\nhttps://github.com/netty/netty/blob/3e8e52725bbd9d999873880956bc8f241372daa8/common/src/main/java/io/netty/util/concurrent/PromiseCombiner.java#L73", "author": "Apache9", "createdAt": "2020-12-20T03:18:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI2ODk4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI2OTIxMQ==", "url": "https://github.com/apache/hbase/pull/2792#discussion_r546269211", "bodyText": "We need a cast is needed so we call a subclass method ?", "author": "saintstack", "createdAt": "2020-12-19T18:38:06Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/NettyRpcDuplexHandler.java", "diffHunk": "@@ -103,8 +103,8 @@ private void writeRequest(ChannelHandlerContext ctx, Call call, ChannelPromise p\n         ctx.write(buf, withoutCellBlockPromise);\n         ChannelPromise cellBlockPromise = ctx.newPromise();\n         ctx.write(cellBlock, cellBlockPromise);\n-        PromiseCombiner combiner = new PromiseCombiner();\n-        combiner.addAll(withoutCellBlockPromise, cellBlockPromise);\n+        PromiseCombiner combiner = new PromiseCombiner(ctx.executor());\n+        combiner.addAll((ChannelFuture) withoutCellBlockPromise, cellBlockPromise);", "originalCommit": "2ce0b8417b788999a11f91d8d305af264aa9d25f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMxNDMzNA==", "url": "https://github.com/apache/hbase/pull/2792#discussion_r546314334", "bodyText": "The method which takes Promises as parameters is deprecated.\nhttps://github.com/netty/netty/blob/3e8e52725bbd9d999873880956bc8f241372daa8/common/src/main/java/io/netty/util/concurrent/PromiseCombiner.java#L123\nSo here we cast the first one to a future to let it call the method which takes Futures as parameters(Promise is a sub interface of Future).", "author": "Apache9", "createdAt": "2020-12-20T03:19:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI2OTIxMQ=="}], "type": "inlineReview"}]}