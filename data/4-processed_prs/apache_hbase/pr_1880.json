{"pr_number": 1880, "pr_title": "HBASE-24144 Update docs from master", "pr_createdAt": "2020-06-09T22:59:30Z", "pr_url": "https://github.com/apache/hbase/pull/1880", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMzMjQzMA==", "url": "https://github.com/apache/hbase/pull/1880#discussion_r438332430", "bodyText": "@bharathv is there some tweak we can make to this language so that it's applicable to all the back ported branches as well? Backports have happened, so we can now be more precise about what the state is on each branch. Just a small change here saying something to the effect of \"this is the new default in 3.0, but it available as an optional feature in versions 1.x+ and 2.y+\" I see down in configuration.adoc it's very clear about what the state is on 3.x vs 2.3+.\nLet's get it as a separate ticket, I don't want to also make doc changes in this back-port ticket.", "author": "ndimiduk", "createdAt": "2020-06-10T18:38:09Z", "path": "src/main/asciidoc/_chapters/architecture.adoc", "diffHunk": "@@ -260,6 +260,73 @@ For region name, we only accept `byte[]` as the parameter type and it may be a f\n \n Information on non-Java clients and custom protocols is covered in <<external_apis>>\n \n+[[client.masterregistry]]\n+=== Master registry (new as of release 3.0.0)", "originalCommit": "6086874e0219ba4bdb3efe922e3a16f1201ef322", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQwMjgxMA==", "url": "https://github.com/apache/hbase/pull/1880#discussion_r438402810", "bodyText": "Will do as a part of https://issues.apache.org/jira/browse/HBASE-24535. Thanks for pointing it out.", "author": "bharathv", "createdAt": "2020-06-10T20:55:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMzMjQzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0MjUyNw==", "url": "https://github.com/apache/hbase/pull/1880#discussion_r438342527", "bodyText": "@bharathv @Apache9 what was the conclusion on RPC hedging? This was reverted, wasn't it? Need to update the docs here?", "author": "ndimiduk", "createdAt": "2020-06-10T18:56:56Z", "path": "src/main/asciidoc/_chapters/architecture.adoc", "diffHunk": "@@ -260,6 +260,73 @@ For region name, we only accept `byte[]` as the parameter type and it may be a f\n \n Information on non-Java clients and custom protocols is covered in <<external_apis>>\n \n+[[client.masterregistry]]\n+=== Master registry (new as of release 3.0.0)\n+\n+Client internally works with a _connection registry_ to fetch the metadata needed by connections.\n+This connection registry implementation is responsible for fetching the following metadata.\n+\n+* Active master address\n+* Current meta region(s) locations\n+* Cluster ID (unique to this cluster)\n+\n+This information is needed as a part of various client operations like connection set up, scans,\n+gets etc. Up until releases 2.x.y, the default connection registry is based on ZooKeeper as the\n+source of truth and the the clients fetched the metadata from zookeeper znodes. As of release 3.0.0,\n+the default implementation for connection registry has been switched  to a master based\n+implementation. With this change, the clients now fetch the required metadata from master RPC end\n+points directly. This change was done for the following reasons.\n+\n+* Reduce load on ZooKeeper since that is critical for cluster operation.\n+* Holistic client timeout and retry configurations since the new registry brings all the client\n+operations under HBase rpc framework.\n+* Remove the ZooKeeper client dependency on HBase client library.\n+\n+This means that\n+\n+* At least a single active or stand by master is needed for cluster connection setup. Refer to\n+<<master.runtime>> for more details.\n+* Master can be in a critical path of read/write operations, especially if the client metadata cache\n+is empty or stale.\n+* There is higher connection load on the masters that before since the clients talk directly to\n+HMasters instead of ZooKeeper ensemble`\n+\n+To reduce hot-spotting on a single master, all the masters (active & stand-by) expose the needed\n+service to fetch the connection metadata. This lets the client connect to any master (not just active).\n+\n+==== RPC hedging", "originalCommit": "6086874e0219ba4bdb3efe922e3a16f1201ef322", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQwMjYyOQ==", "url": "https://github.com/apache/hbase/pull/1880#discussion_r438402629", "bodyText": "Not really, the functionality was moved from rpc layer to the master registry, so from a user perspective it didn't change much. But certain configs changed, will cover as a part of https://issues.apache.org/jira/browse/HBASE-24535", "author": "bharathv", "createdAt": "2020-06-10T20:54:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0MjUyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQyOTcyNA==", "url": "https://github.com/apache/hbase/pull/1880#discussion_r438429724", "bodyText": "Okay, thank you. I started to do some word-smithing... my hope is that we have language in the docs on master that is version agnostic, covering all active release lines, so that it's simple as possible for release managers to copy them back.\nYou're the expert here, I'll let you handle it. Shout when you're ready for a review.", "author": "ndimiduk", "createdAt": "2020-06-10T21:54:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0MjUyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU0MDYxOQ==", "url": "https://github.com/apache/hbase/pull/1880#discussion_r438540619", "bodyText": "Here you go #1888", "author": "bharathv", "createdAt": "2020-06-11T04:48:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0MjUyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NjY3NA==", "url": "https://github.com/apache/hbase/pull/1880#discussion_r438346674", "bodyText": "Yikes! https://issues.apache.org/jira/browse/HBASE-24533", "author": "ndimiduk", "createdAt": "2020-06-10T19:05:09Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -139,7 +139,7 @@ Referential Integrity::\n \n Secondary Indexes::\n   You can use a coprocessor to maintain secondary indexes. For more information, see\n-  link:https://wiki.apache.org/hadoop/Hbase/SecondaryIndexing[SecondaryIndexing].\n+  link:https://cwiki.apache.org/confluence/display/HADOOP2/Hbase+SecondaryIndexing[SecondaryIndexing].", "originalCommit": "6086874e0219ba4bdb3efe922e3a16f1201ef322", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0OTM2Nw==", "url": "https://github.com/apache/hbase/pull/1880#discussion_r438349367", "bodyText": "Circular references are fun! https://issues.apache.org/jira/browse/HBASE-24534", "author": "ndimiduk", "createdAt": "2020-06-10T19:10:19Z", "path": "src/main/asciidoc/_chapters/faq.adoc", "diffHunk": "@@ -33,7 +33,7 @@ When should I use HBase?::\n   See <<arch.overview>> in the Architecture chapter.\n \n Are there other HBase FAQs?::\n-  See the FAQ that is up on the wiki, link:https://wiki.apache.org/hadoop/Hbase/FAQ[HBase Wiki FAQ].\n+  See the FAQ that is up on the wiki, link:https://cwiki.apache.org/confluence/display/HADOOP2/Hbase+FAQ[HBase Wiki FAQ].", "originalCommit": "6086874e0219ba4bdb3efe922e3a16f1201ef322", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM3MDI3NQ==", "url": "https://github.com/apache/hbase/pull/1880#discussion_r438370275", "bodyText": "Looks like I need to revert HBASE-23890 from this patch.", "author": "ndimiduk", "createdAt": "2020-06-10T19:50:41Z", "path": "src/main/asciidoc/_chapters/ops_mgt.adoc", "diffHunk": "@@ -3400,20 +3549,10 @@ Here is example using a few of the rsgroup  commands. To add a group, do as foll\n .RegionServer Groups must be Enabled\n [NOTE]\n ====\n-If you have not enabled the rsgroup Coprocessor Endpoint in the master and", "originalCommit": "6086874e0219ba4bdb3efe922e3a16f1201ef322", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6bf43354aeb0d73d80a500f61dcf4a805c667cc3", "url": "https://github.com/apache/hbase/commit/6bf43354aeb0d73d80a500f61dcf4a805c667cc3", "message": "delete docs re: backup", "committedDate": "2020-06-15T19:17:54Z", "type": "forcePushed"}, {"oid": "7ef6bec4a08f15aad6e651d68ac2322d67acaba9", "url": "https://github.com/apache/hbase/commit/7ef6bec4a08f15aad6e651d68ac2322d67acaba9", "message": "Bring back documentation from master branch (2ecbaf130e), using\n\n```\n$ git checkout master -- src/main/asciidoc/\n$ git checkout master -- src/site/asciidoc/\n```\n\nAnd then:\n * remove changes from HBASE-23890\n   This reverts commit 420e38083f13ebf9ca056d2ee2de2192c23801c7.\n * delete docs re: sync_replication\n * delete docs re: backup", "committedDate": "2020-06-15T20:21:28Z", "type": "forcePushed"}, {"oid": "1cee6ba5ca0f9d0aae15c11de10ff00e89975734", "url": "https://github.com/apache/hbase/commit/1cee6ba5ca0f9d0aae15c11de10ff00e89975734", "message": "HBASE-24144 Update docs from master\n\nBring back documentation from master branch (2ecbaf130e), using\n\n```\n$ git checkout master -- src/main/asciidoc/\n$ git checkout master -- src/site/asciidoc/\n```\n\nAnd then:\n * remove changes from HBASE-23890\n   This reverts commit 420e38083f13ebf9ca056d2ee2de2192c23801c7.\n * delete docs re: sync_replication\n * delete docs re: backup", "committedDate": "2020-06-15T20:22:28Z", "type": "commit"}, {"oid": "1cee6ba5ca0f9d0aae15c11de10ff00e89975734", "url": "https://github.com/apache/hbase/commit/1cee6ba5ca0f9d0aae15c11de10ff00e89975734", "message": "HBASE-24144 Update docs from master\n\nBring back documentation from master branch (2ecbaf130e), using\n\n```\n$ git checkout master -- src/main/asciidoc/\n$ git checkout master -- src/site/asciidoc/\n```\n\nAnd then:\n * remove changes from HBASE-23890\n   This reverts commit 420e38083f13ebf9ca056d2ee2de2192c23801c7.\n * delete docs re: sync_replication\n * delete docs re: backup", "committedDate": "2020-06-15T20:22:28Z", "type": "forcePushed"}]}