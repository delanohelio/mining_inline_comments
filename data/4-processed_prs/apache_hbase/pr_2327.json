{"pr_number": 2327, "pr_title": "Hbase-24764 : Add support of adding base peer configs via hbase-site.xml for all replication peers", "pr_createdAt": "2020-08-29T07:07:07Z", "pr_url": "https://github.com/apache/hbase/pull/2327", "timeline": [{"oid": "906db11e69e640c38ed3077907113ba04318bf80", "url": "https://github.com/apache/hbase/commit/906db11e69e640c38ed3077907113ba04318bf80", "message": "HBASE-24764: Add support of adding base peer configs via hbase-site.xml for all replication peers", "committedDate": "2020-08-29T07:00:46Z", "type": "commit"}, {"oid": "59a739beb4a4f05f796b30a8930aaf65d6d7c7f5", "url": "https://github.com/apache/hbase/commit/59a739beb4a4f05f796b30a8930aaf65d6d7c7f5", "message": "HBASE-24764: Reordering imports for checkstyle", "committedDate": "2020-08-31T22:26:18Z", "type": "commit"}, {"oid": "d558c30f67174c0007c91155462c7caf7ec22da6", "url": "https://github.com/apache/hbase/commit/d558c30f67174c0007c91155462c7caf7ec22da6", "message": "HBASE-24764: Modifying comments", "committedDate": "2020-09-01T18:57:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU3NDg0MA==", "url": "https://github.com/apache/hbase/pull/2327#discussion_r489574840", "bodyText": "nit: just use this.configuration directly?", "author": "bharathv", "createdAt": "2020-09-16T16:38:32Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeerConfig.java", "diffHunk": "@@ -99,6 +105,36 @@ public ReplicationPeerConfig setBandwidth(long bandwidth) {\n     return this;\n   }\n \n+  /**\n+   * Helper method to add base peer configs from Configuration to ReplicationPeerConfig\n+   * if not present in latter.\n+   *\n+   * This merges the user supplied peer configuration\n+   * {@link org.apache.hadoop.hbase.replication.ReplicationPeerConfig} with peer configs\n+   * provided as property hbase.replication.peer.base.configs in hbase configuration.\n+   * Expected format for this hbase configuration is \"k1=v1;k2=v2,v2_1\". Original value\n+   * of conf is retained if already present in ReplicationPeerConfig.\n+   *\n+   * @param conf Configuration\n+   */\n+  public void addBasePeerConfigsIfNotPresent(Configuration conf) {\n+    String basePeerConfigs = conf.get(HBASE_REPLICATION_PEER_BASE_CONFIG, \"\");\n+    Map<String,String> receivedPeerConfigMap = this.getConfiguration();\n+\n+    if (basePeerConfigs.length() != 0) {\n+      Map<String, String> basePeerConfigMap = Splitter.on(';').trimResults().omitEmptyStrings()\n+        .withKeyValueSeparator(\"=\").split(basePeerConfigs);\n+      for (Map.Entry<String,String> entry : basePeerConfigMap.entrySet()) {\n+        String configName = entry.getKey();\n+        String configValue = entry.getValue();\n+        // Only override if base config does not exist in existing replication peer configs\n+        if (!receivedPeerConfigMap.containsKey(configName)) {", "originalCommit": "d558c30f67174c0007c91155462c7caf7ec22da6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "233a4876e121426d6e5c8f2ba97dc0f8cd479960", "url": "https://github.com/apache/hbase/commit/233a4876e121426d6e5c8f2ba97dc0f8cd479960", "message": "HBASE-24764: Review comments. Note: branch-1 has design difference wrt to other branch for Hbase-24764. branch-1 does not have master based coordination for replication like master branch , and hence each RS is responsible for initing peers and updating ZK states. As part of this change we are updating zk state of peers after reading from configuration, so if there is a divergence in configuration across RS the result can be can be non-deteministic and the last RS RPC will win.", "committedDate": "2020-09-17T01:29:09Z", "type": "commit"}]}