{"pr_number": 1916, "pr_title": "HBASE-24546 CloneSnapshotProcedure unlimited retry", "pr_createdAt": "2020-06-17T09:08:48Z", "pr_url": "https://github.com/apache/hbase/pull/1916", "timeline": [{"oid": "a5f3f18fce3230ff538eae5675e60afec89075fa", "url": "https://github.com/apache/hbase/commit/a5f3f18fce3230ff538eae5675e60afec89075fa", "message": "HBASE-24546", "committedDate": "2020-06-16T02:37:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQyMjIwNA==", "url": "https://github.com/apache/hbase/pull/1916#discussion_r441422204", "bodyText": "The problem is: the retry will never succeed if the region dirs exist? Add comment here?", "author": "infraio", "createdAt": "2020-06-17T09:46:54Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/CloneSnapshotProcedure.java", "diffHunk": "@@ -457,6 +457,10 @@ private void postCloneSnapshot(final MasterProcedureEnv env)\n     // 1. Create Table Descriptor\n     // using a copy of descriptor, table will be created enabling first\n     final Path tempTableDir = FSUtils.getTableDir(tempdir, tableDescriptor.getTableName());\n+    if (FSUtils.isExists(mfs.getFileSystem(), tempTableDir)) {\n+      LOG.warn(\"temp table dir already exists on disk: {}, will be deleted.\", tempTableDir);\n+      FSUtils.deleteDirectory(mfs.getFileSystem(), tempTableDir);\n+    }", "originalCommit": "a5f3f18fce3230ff538eae5675e60afec89075fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkzMTcxNg==", "url": "https://github.com/apache/hbase/pull/1916#discussion_r441931716", "bodyText": "yes, RestoreSnapshotHelper.restoreHdfsRegions will remove the region dirs, but CloneSnapshotProcedure.createFilesystemLayout not allow exist remove. retrying will have the same effect", "author": "WenFeiYi", "createdAt": "2020-06-18T02:23:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQyMjIwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4OTMzMw==", "url": "https://github.com/apache/hbase/pull/1916#discussion_r442589333", "bodyText": "Sorry. I didn't follow here is why region dir changed? Add more comments to code too?", "author": "infraio", "createdAt": "2020-06-19T01:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQyMjIwNA=="}], "type": "inlineReview"}, {"oid": "07387b035296b2019196f641d28ce549e739fb59", "url": "https://github.com/apache/hbase/commit/07387b035296b2019196f641d28ce549e739fb59", "message": "add comments", "committedDate": "2020-06-19T09:46:34Z", "type": "commit"}, {"oid": "04236e288f41b7cde23a038c17837a171399a6c7", "url": "https://github.com/apache/hbase/commit/04236e288f41b7cde23a038c17837a171399a6c7", "message": "add comment", "committedDate": "2020-07-06T02:50:52Z", "type": "commit"}]}