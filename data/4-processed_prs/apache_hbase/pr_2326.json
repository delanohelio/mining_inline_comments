{"pr_number": 2326, "pr_title": "HBASE-24967 The table.jsp cost long time to load if the table include\u2026", "pr_createdAt": "2020-08-29T06:36:31Z", "pr_url": "https://github.com/apache/hbase/pull/2326", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzE4Mw==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r483317183", "bodyText": "1 sec is too short? And another way is: get the compaction state from master's memory and avoid rpc call.", "author": "infraio", "createdAt": "2020-09-04T00:12:01Z", "path": "hbase-server/src/main/resources/hbase-webapps/master/table.jsp", "diffHunk": "@@ -655,12 +656,14 @@\n <%\n   if (master.getAssignmentManager().isTableEnabled(table.getName())) {\n     try {\n-      CompactionState compactionState = admin.getCompactionState(table.getName()).get();\n+      CompactionState compactionState = admin.getCompactionState(table.getName()).get(1, TimeUnit.SECONDS);", "originalCommit": "9ddf0f116baf3482d4e76c6d7f2436dcd36a6cfd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0NjI4OA==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r483346288", "bodyText": "Thanks for the suggestion, let me try.", "author": "bsglz", "createdAt": "2020-09-04T02:09:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzE4Mw=="}], "type": "inlineReview"}, {"oid": "a56e77a3507bbf880dd15134750116c6edce25f4", "url": "https://github.com/apache/hbase/commit/a56e77a3507bbf880dd15134750116c6edce25f4", "message": "HBASE-24967 The table.jsp cost long time to load if the table include closed regions", "committedDate": "2020-09-05T08:41:53Z", "type": "commit"}, {"oid": "dcf271f6645f1ea905797aa4d555df85187a6260", "url": "https://github.com/apache/hbase/commit/dcf271f6645f1ea905797aa4d555df85187a6260", "message": "fix it  by another way", "committedDate": "2020-09-06T04:29:53Z", "type": "commit"}, {"oid": "dcf271f6645f1ea905797aa4d555df85187a6260", "url": "https://github.com/apache/hbase/commit/dcf271f6645f1ea905797aa4d555df85187a6260", "message": "fix it  by another way", "committedDate": "2020-09-06T04:29:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMzUzMg==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492013532", "bodyText": "Debug log?", "author": "Apache9", "createdAt": "2020-09-21T12:43:12Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java", "diffHunk": "@@ -1741,9 +1741,10 @@ RegionLoad createRegionLoad(final HRegion r, RegionLoad.Builder regionLoadBldr,\n       .setBlocksLocalWeight(blocksLocalWeight)\n       .setBlocksLocalWithSsdWeight(blocksLocalWithSsdWeight)\n       .setBlocksTotalWeight(blocksTotalWeight)\n+      .setCompactionState(ProtobufUtil.createCompactionStateForRegionLoad(r.getCompactionState()))\n       .setLastMajorCompactionTs(r.getOldestHfileTs(true));\n     r.setCompleteSequenceId(regionLoadBldr);\n-\n+    LOG.info(\">>>>>>setCompactionState:{}\",r.getCompactionState());", "originalCommit": "dcf271f6645f1ea905797aa4d555df85187a6260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0MTgzNQ==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492441835", "bodyText": "Will fix, thanks.", "author": "bsglz", "createdAt": "2020-09-22T02:17:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMzUzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMzg5Mg==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492013892", "bodyText": "Why full class name here?", "author": "Apache9", "createdAt": "2020-09-21T12:43:36Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -3907,4 +3909,51 @@ public MetaRegionLocationCache getMetaRegionLocationCache() {\n   public RSGroupInfoManager getRSGroupInfoManager() {\n     return rsGroupInfoManager;\n   }\n+\n+  /**\n+   * Get the compaction state of the table\n+   *\n+   * @param tableName The table name\n+   * @return CompactionState Compaction state of the table\n+   */\n+  public org.apache.hadoop.hbase.client.CompactionState getCompactionState(", "originalCommit": "dcf271f6645f1ea905797aa4d555df85187a6260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0Nzc5Mg==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492447792", "bodyText": "Conflict with org.apache.hadoop.hbase.shaded.protobuf.generated.AdminProtos.GetRegionInfoResponse.CompactionState", "author": "bsglz", "createdAt": "2020-09-22T02:48:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMzg5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0ODM3MA==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492448370", "bodyText": "Then better not import org.apache.hadoop.hbase.shaded.protobuf.generated.AdminProtos.GetRegionInfoResponse.CompactionState directly? Import org.apache.hadoop.hbase.shaded.protobuf.generated.AdminProtos.GetRegionInfoResponse, and then use GetRegionInfoResponse.CompactionState to reference the protobuf message.", "author": "Apache9", "createdAt": "2020-09-22T02:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMzg5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0OTg4MQ==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492449881", "bodyText": "Good idea, will fix, thanks.", "author": "bsglz", "createdAt": "2020-09-22T02:59:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMzg5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxNDM3MA==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492014370", "bodyText": "New line here?", "author": "Apache9", "createdAt": "2020-09-21T12:44:13Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/RegionMetricsBuilder.java", "diffHunk": "@@ -263,6 +268,10 @@ public RegionMetricsBuilder setBlocksTotalWeight(long value) {\n     this.blocksTotalWeight = value;\n     return this;\n   }\n+  public RegionMetricsBuilder setCompactionState(CompactionState compactionState) {\n+    this.compactionState = compactionState;\n+    return this;\n+  }", "originalCommit": "dcf271f6645f1ea905797aa4d555df85187a6260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0ODE4Nw==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492448187", "bodyText": "Ok, will fix.", "author": "bsglz", "createdAt": "2020-09-22T02:50:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxNDM3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxNTE5Mg==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492015192", "bodyText": "I think this test is for testing the HBaseAdmin.getCompactionState so we should not change to use master?", "author": "Apache9", "createdAt": "2020-09-21T12:45:35Z", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionState.java", "diffHunk": "@@ -164,10 +166,10 @@ private void compaction(final String tableName, final int flushes,\n       long curt = System.currentTimeMillis();\n       long waitTime = 5000;\n       long endt = curt + waitTime;\n-      CompactionState state = admin.getCompactionState(table);\n+      CompactionState state = master.getCompactionState(table);", "originalCommit": "dcf271f6645f1ea905797aa4d555df85187a6260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0OTExNg==", "url": "https://github.com/apache/hbase/pull/2326#discussion_r492449116", "bodyText": "Make sense, will fix later, thanks.", "author": "bsglz", "createdAt": "2020-09-22T02:55:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxNTE5Mg=="}], "type": "inlineReview"}, {"oid": "6364049f112d4bcadac2837fab0b3203f7453f14", "url": "https://github.com/apache/hbase/commit/6364049f112d4bcadac2837fab0b3203f7453f14", "message": "fix review issue", "committedDate": "2020-09-22T06:41:02Z", "type": "commit"}, {"oid": "2102697571a1c733aa3e4c5d04940eae75c73a92", "url": "https://github.com/apache/hbase/commit/2102697571a1c733aa3e4c5d04940eae75c73a92", "message": "fix checkstyle warnings", "committedDate": "2020-09-22T08:29:55Z", "type": "commit"}, {"oid": "ed3e8ce403dd5a8f8abc89c32dbf6e0b4a674a25", "url": "https://github.com/apache/hbase/commit/ed3e8ce403dd5a8f8abc89c32dbf6e0b4a674a25", "message": "fix checkstyle warning", "committedDate": "2020-09-22T09:02:19Z", "type": "commit"}]}