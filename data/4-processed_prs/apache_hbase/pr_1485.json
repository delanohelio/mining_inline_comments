{"pr_number": 1485, "pr_title": "HBASE-23969 Meta browser should show all `info` columns", "pr_createdAt": "2020-04-10T11:05:23Z", "pr_url": "https://github.com/apache/hbase/pull/1485", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1MDUwNg==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r406750506", "bodyText": "nit: ? : is good to use but here since we have some good computation, it might be preferable to return empty string if regionInfo is null initially. Better readability? WDYT?", "author": "virajjasani", "createdAt": "2020-04-10T13:10:48Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/webapp/RegionReplicaInfo.java", "diffHunk": "@@ -102,6 +117,27 @@ public ServerName getServerName() {\n     return serverName;\n   }\n \n+  public String getTransitioningOnServerName() {\n+    return transitioningOnServerName;\n+  }\n+\n+  public String getMergeRegionName() {\n+    return (mergeRegionInfo != null)\n+      ? mergeRegionInfo.stream()\n+                       .map(RegionInfo::getRegionName)\n+                       .map(Bytes::toStringBinary)\n+                       .collect(Collectors.joining(\", \"))\n+      : \"\";", "originalCommit": "c2a490a14b48fd76da03a78f58322a7af1d65264", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA0NzQxMA==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r407047410", "bodyText": "This has been simplified with nullable collection. So no ? : is required here then.", "author": "liuml07", "createdAt": "2020-04-11T10:34:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1MDUwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1MzU4OQ==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r406753589", "bodyText": "A small test case to cover this would be good. Maybe in TestMaster.", "author": "virajjasani", "createdAt": "2020-04-10T13:18:59Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/MetaTableAccessor.java", "diffHunk": "@@ -966,6 +966,22 @@ public static ServerName getServerName(final Result r, final int replicaId) {\n     }\n   }\n \n+  /**\n+   * Returns a host:port string of server where the region is transitioning on.\n+   * It reads \"sn\" column from {@link Result}, a row in catalog table.\n+   * @param r Result to pull from\n+   * @return A host:port string or null if necessary fields not found or empty.\n+   */\n+  @Nullable\n+  @InterfaceAudience.Private // for use by RegionReplicaInfo which is used by meta browser\n+  public static String getTransitioningOnServerName(final Result r, final int replicaId) {", "originalCommit": "c2a490a14b48fd76da03a78f58322a7af1d65264", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA0NzU2NA==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r407047564", "bodyText": "I navigate the source code tree, and found another place has implemented the same logic there. So in recent commit I simply move the code to MetaTableAccessor.java so it can be reused. I hope I have not broken any stuff, so wait for the QA to confirm. Since that is exactly the existing method, I guess a test is not required? But I can work on a UT if you still suggest. Thanks,", "author": "liuml07", "createdAt": "2020-04-11T10:36:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1MzU4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1OTc0NA==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r409159744", "bodyText": "What is rationale for moving this method? How is it MetaTableAccessor material?", "author": "saintstack", "createdAt": "2020-04-15T22:00:50Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/MetaTableAccessor.java", "diffHunk": "@@ -966,6 +965,33 @@ public static ServerName getServerName(final Result r, final int replicaId) {\n     }\n   }\n \n+  /**\n+   * Returns the {@link ServerName} from catalog table {@link Result} where the region is\n+   * transitioning on. It should be the same as {@link MetaTableAccessor#getServerName(Result,int)}\n+   * if the server is at OPEN state.\n+   *\n+   * @param r Result to pull the transitioning server name from\n+   * @return A ServerName instance or {@link MetaTableAccessor#getServerName(Result,int)}\n+   * if necessary fields not found or empty.\n+   */\n+  @Nullable\n+  public static ServerName getTargetServerName(final Result r, final int replicaId) {", "originalCommit": "659d4422a8a76d75209d1bc34ea2fe18bec7a93b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1OTg4Mw==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r409159883", "bodyText": ".. and not private to RegoinStateStore where it was originally?", "author": "saintstack", "createdAt": "2020-04-15T22:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1OTc0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIzNzAwMw==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r409237003", "bodyText": "@saintstack This method is used so far by both RegionStateStore and RegionReplicaInfo (new for table.jsp). So it can not be private to RegoinStateStore. We can keep it there and make it public, or we move to MetaTableAccessor which is more generic place for Read/write hbase:meta operations. I see all getXXColumn and getXX stuff are static methods in MetaTableAccessor which are similar to what this method does. So I moved the logic reading \"info:sn\" columns to MetaTableAccessor.\nThis also came from my coding experience. When I write the first patch, I implemented my version in MetaTableAccessor instead of calling the implementation in RegoinStateStore. I simply did not know existing logic is already someplace there. Meanwhile, both RegionStateStore and MetaTableAccessor have their own getServerNameColumn() method. I guess someone previously may have missed existing implementation as I did :) So overall I prefer the central place of getting columns and data from hbase:meta. But I understand this move makes it public in client module. If that is a concern, I can move it back.", "author": "liuml07", "createdAt": "2020-04-16T02:03:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1OTc0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzMTk5MA==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r420231990", "bodyText": "Long-stale conversation, perhaps...\nI agree with @liuml07 on this one -- it's a good thing to have a centralized place for encapsulating the serialization details of storing and retrieving content from meta. MetaTableAccessor seems like the place for it.", "author": "ndimiduk", "createdAt": "2020-05-05T16:13:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1OTc0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2MDk3Mw==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r409160973", "bodyText": "How we do merge? Merge names can be more merge001, merge002... we print them all out in Merge RegionNames? If so, why split different?", "author": "saintstack", "createdAt": "2020-04-15T22:03:28Z", "path": "hbase-server/src/main/resources/hbase-webapps/master/table.jsp", "diffHunk": "@@ -387,68 +388,91 @@ if (fqtn != null && master.isInitialized()) {\n     }\n   }\n %>\n-<table class=\"table table-striped\">\n-  <tr>\n-    <th>RegionName</th>\n-    <th>Start Key</th>\n-    <th>End Key</th>\n-    <th>Replica ID</th>\n-    <th>RegionState</th>\n-    <th>ServerName</th>\n-  </tr>\n-<%\n-  final boolean metaScanHasMore;\n-  byte[] lastRow = null;\n-  try (final MetaBrowser.Results results = metaBrowser.getResults()) {\n-    for (final RegionReplicaInfo regionReplicaInfo : results) {\n-      lastRow = Optional.ofNullable(regionReplicaInfo)\n-        .map(RegionReplicaInfo::getRow)\n-        .orElse(null);\n-      if (regionReplicaInfo == null) {\n-%>\n-  <tr>\n-    <td colspan=\"6\">Null result</td>\n-  </tr>\n-<%\n-      continue;\n-    }\n+<div style=\"overflow-x: auto\">\n+  <table class=\"table table-striped nowrap\">\n+    <tr>\n+      <th>RegionName</th>\n+      <th>Start Key</th>\n+      <th>End Key</th>\n+      <th>Replica ID</th>\n+      <th>RegionState</th>\n+      <th>ServerName</th>\n+      <th>Sequence Number</th>\n+      <th>Target ServerName</th>\n+      <th>Merge RegionNames</th>\n+      <th>SplitA</th>\n+      <th>SplitB</th>", "originalCommit": "659d4422a8a76d75209d1bc34ea2fe18bec7a93b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIzMTgxNw==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r409231817", "bodyText": "Yes merge is all columns matching regex \"info:merge*\" in hbase:meta. Do we need to know the column name? For \"info:split*\" I think we can merge A/B into one item as well. I'll make the change as discussion in the JIRA.", "author": "liuml07", "createdAt": "2020-04-16T01:44:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2MDk3Mw=="}], "type": "inlineReview"}, {"oid": "68aedc17db0a98195628b999f2805de1fc155c4d", "url": "https://github.com/apache/hbase/commit/68aedc17db0a98195628b999f2805de1fc155c4d", "message": "HBASE-23969 Meta browser should show all `info` columns", "committedDate": "2020-05-04T21:03:02Z", "type": "commit"}, {"oid": "0f2e1177da13603fd98c1474a89a363d1fe49029", "url": "https://github.com/apache/hbase/commit/0f2e1177da13603fd98c1474a89a363d1fe49029", "message": "Address Viraj and Nick comments\n\n1. transitioningOnServerName -> targetServerName, clearer and shorter\n2. Reuse existing getServerNameColumn and getRegionServer\n3. Add seqNum\n4. Merge (parent) region names joined by newline instead of ,\n5. Use table style instead of repeating th/td style for nowrap", "committedDate": "2020-05-04T21:03:04Z", "type": "commit"}, {"oid": "ee0184bf61762e1490db1a5ae895b74ad2b695ea", "url": "https://github.com/apache/hbase/commit/ee0184bf61762e1490db1a5ae895b74ad2b695ea", "message": "Minor fix for seqNum", "committedDate": "2020-05-04T21:03:04Z", "type": "commit"}, {"oid": "15564ea3135c919fbe763b5bc1eb7f5efb2d5f09", "url": "https://github.com/apache/hbase/commit/15564ea3135c919fbe763b5bc1eb7f5efb2d5f09", "message": "Address comments for sake of less interpretation\n\n- Rename \"ServerName\" to \"Server\", keep \"Target Server\" for info:sn\n- Show \"info:split*\" together with newline-delimited list\n- Rename \"Merger ServerName\" to \"info:merge*\"\n- Rename SplitA/SplitB columns to \"info:split*\"\n- Add tooltip for each column in table head", "committedDate": "2020-05-04T21:03:04Z", "type": "commit"}, {"oid": "eb258ff1ae9820d667c87397449214a2b4753354", "url": "https://github.com/apache/hbase/commit/eb258ff1ae9820d667c87397449214a2b4753354", "message": "Add tooltip to all <td/>", "committedDate": "2020-05-04T21:03:04Z", "type": "commit"}, {"oid": "9f8f10eb6518d39b1564f1c7597d2fb66933de39", "url": "https://github.com/apache/hbase/commit/9f8f10eb6518d39b1564f1c7597d2fb66933de39", "message": "Use LinkedHashMap to preserver insertion-ordered for split/merge columns", "committedDate": "2020-05-04T21:03:05Z", "type": "commit"}, {"oid": "9f8f10eb6518d39b1564f1c7597d2fb66933de39", "url": "https://github.com/apache/hbase/commit/9f8f10eb6518d39b1564f1c7597d2fb66933de39", "message": "Use LinkedHashMap to preserver insertion-ordered for split/merge columns", "committedDate": "2020-05-04T21:03:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzNTk1OQ==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r420235959", "bodyText": "unused import.", "author": "ndimiduk", "createdAt": "2020-05-05T16:19:06Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/MetaTableAccessor.java", "diffHunk": "@@ -26,6 +26,7 @@\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.Collections;\n+import java.util.HashMap;", "originalCommit": "9f8f10eb6518d39b1564f1c7597d2fb66933de39", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzODU1Mg==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r420238552", "bodyText": "A few unused imports to cleanup.", "author": "ndimiduk", "createdAt": "2020-05-05T16:22:57Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/webapp/RegionReplicaInfo.java", "diffHunk": "@@ -17,14 +17,22 @@\n  */\n package org.apache.hadoop.hbase.master.webapp;\n \n+import static org.apache.hbase.thirdparty.org.apache.commons.collections4.ListUtils.emptyIfNull;", "originalCommit": "9f8f10eb6518d39b1564f1c7597d2fb66933de39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU3OTk5OA==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r420579998", "bodyText": "Thanks! I have fixed this.\np.s. For a PR to Hadoop, I usually check the \"checkstyle\" report by Yetus and update the patch accordingly. I see the Yetus for HBase QA does not report \"checkstyle\" warnings in the comment table. I found there are report links in the \"Console output\" though. I'll follow there next time. :)", "author": "liuml07", "createdAt": "2020-05-06T06:56:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzODU1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI1Mjk1OQ==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r422252959", "bodyText": "Due to complications around multi-jdk support, we have Yetus run in 3 different invocations. Looks like the checkstyle check gave you a +1.", "author": "ndimiduk", "createdAt": "2020-05-08T16:52:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzODU1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MjQwOQ==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r420242409", "bodyText": "s/Server where the region is transitioning on/The server to which the region is transiting/", "author": "ndimiduk", "createdAt": "2020-05-05T16:28:44Z", "path": "hbase-server/src/main/resources/hbase-webapps/master/table.jsp", "diffHunk": "@@ -387,68 +388,93 @@ if (fqtn != null && master.isInitialized()) {\n     }\n   }\n %>\n-<table class=\"table table-striped\">\n-  <tr>\n-    <th>RegionName</th>\n-    <th>Start Key</th>\n-    <th>End Key</th>\n-    <th>Replica ID</th>\n-    <th>RegionState</th>\n-    <th>ServerName</th>\n-  </tr>\n-<%\n-  final boolean metaScanHasMore;\n-  byte[] lastRow = null;\n-  try (final MetaBrowser.Results results = metaBrowser.getResults()) {\n-    for (final RegionReplicaInfo regionReplicaInfo : results) {\n-      lastRow = Optional.ofNullable(regionReplicaInfo)\n-        .map(RegionReplicaInfo::getRow)\n-        .orElse(null);\n-      if (regionReplicaInfo == null) {\n-%>\n-  <tr>\n-    <td colspan=\"6\">Null result</td>\n-  </tr>\n-<%\n-      continue;\n-    }\n+<div style=\"overflow-x: auto\">\n+  <table class=\"table table-striped nowrap\">\n+    <tr>\n+      <th title=\"Region name\">RegionName</th>\n+      <th title=\"The startKey of this region\">Start Key</th>\n+      <th title=\"The endKey of this region\">End Key</th>\n+      <th title=\"Region replica id\">Replica ID</th>\n+      <th title=\"State of the region while undergoing transitions\">RegionState</th>\n+      <th title=\"Server hosting this region replica, stored in info:server column\">Server</th>\n+      <th title=\"The seqNum for the region at the time the server opened this region replica\">Sequence Number</th>\n+      <th title=\"Server where the region is transitioning on, stored in info:sn column\">Target Server</th>", "originalCommit": "9f8f10eb6518d39b1564f1c7597d2fb66933de39", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NTYxMQ==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r420245611", "bodyText": "It's a bit tedious, but how about we build all these labels from the values in HConstants? That way this page is captured by any future refactoring that happens down the line. For instance, the bit in this tool tip that says \"info:server\" would be replaced with + HConstants.CATALOG_FAMILY_STR + \":\" + HConstants.SERVER_QUALIFIER_STR.\nKind of fiddly. I'm not sure if it's worth it. Just a suggestion.", "author": "ndimiduk", "createdAt": "2020-05-05T16:33:23Z", "path": "hbase-server/src/main/resources/hbase-webapps/master/table.jsp", "diffHunk": "@@ -387,68 +388,93 @@ if (fqtn != null && master.isInitialized()) {\n     }\n   }\n %>\n-<table class=\"table table-striped\">\n-  <tr>\n-    <th>RegionName</th>\n-    <th>Start Key</th>\n-    <th>End Key</th>\n-    <th>Replica ID</th>\n-    <th>RegionState</th>\n-    <th>ServerName</th>\n-  </tr>\n-<%\n-  final boolean metaScanHasMore;\n-  byte[] lastRow = null;\n-  try (final MetaBrowser.Results results = metaBrowser.getResults()) {\n-    for (final RegionReplicaInfo regionReplicaInfo : results) {\n-      lastRow = Optional.ofNullable(regionReplicaInfo)\n-        .map(RegionReplicaInfo::getRow)\n-        .orElse(null);\n-      if (regionReplicaInfo == null) {\n-%>\n-  <tr>\n-    <td colspan=\"6\">Null result</td>\n-  </tr>\n-<%\n-      continue;\n-    }\n+<div style=\"overflow-x: auto\">\n+  <table class=\"table table-striped nowrap\">\n+    <tr>\n+      <th title=\"Region name\">RegionName</th>\n+      <th title=\"The startKey of this region\">Start Key</th>\n+      <th title=\"The endKey of this region\">End Key</th>\n+      <th title=\"Region replica id\">Replica ID</th>\n+      <th title=\"State of the region while undergoing transitions\">RegionState</th>\n+      <th title=\"Server hosting this region replica, stored in info:server column\">Server</th>", "originalCommit": "9f8f10eb6518d39b1564f1c7597d2fb66933de39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU2OTA1OA==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r420569058", "bodyText": "I like the idea. I have changed that. To make this table header fit in one line, I have defined some column name variables, which can be reused.", "author": "liuml07", "createdAt": "2020-05-06T06:26:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NTYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0ODM0NQ==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r420248345", "bodyText": "Do you intend to change the style of all td elements, or only those under table.nowrap? If the latter, I think you need table.nowrap th, table.nowrap td.", "author": "ndimiduk", "createdAt": "2020-05-05T16:37:08Z", "path": "hbase-server/src/main/resources/hbase-webapps/static/css/hbase.css", "diffHunk": "@@ -54,3 +54,7 @@ table.tablesorter thead tr .headerSortUp {\n table.tablesorter thead tr .headerSortDown {\n     background-image: url(desc.gif);\n }\n+\n+table.nowrap th, td {", "originalCommit": "9f8f10eb6518d39b1564f1c7597d2fb66933de39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU2MTA0Nw==", "url": "https://github.com/apache/hbase/pull/1485#discussion_r420561047", "bodyText": "Oh, right! No I was going to add the \"nowrap\" class only and changing default td style may make other places unhappy.", "author": "liuml07", "createdAt": "2020-05-06T06:00:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0ODM0NQ=="}], "type": "inlineReview"}, {"oid": "5bef876ddf20ba436e0789d19110410c43db327d", "url": "https://github.com/apache/hbase/commit/5bef876ddf20ba436e0789d19110410c43db327d", "message": "Address Nick Dimiduk comments", "committedDate": "2020-05-06T06:30:53Z", "type": "commit"}]}