{"pr_number": 2062, "pr_title": "HBASE-24705 MetaFixer#fixHoles() does not include the case for read r\u2026", "pr_createdAt": "2020-07-14T00:33:28Z", "pr_url": "https://github.com/apache/hbase/pull/2062", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIyOTkwMw==", "url": "https://github.com/apache/hbase/pull/2062#discussion_r454229903", "bodyText": "It seems addReplicas does not require TableDescriptor. Can you please remove it with this PR?", "author": "virajjasani", "createdAt": "2020-07-14T09:35:10Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java", "diffHunk": "@@ -174,22 +177,35 @@ private static RegionInfo buildRegionInfo(TableName tn, byte [] start, byte [] e\n   private static List<RegionInfo> createMetaEntries(final MasterServices masterServices,\n     final List<RegionInfo> newRegionInfos) {\n \n-    final List<Either<RegionInfo, IOException>> addMetaEntriesResults = newRegionInfos.stream()\n+    final List<Either<List<RegionInfo>, IOException>> addMetaEntriesResults = newRegionInfos.stream()\n       .map(regionInfo -> {\n         try {\n-          MetaTableAccessor.addRegionToMeta(masterServices.getConnection(), regionInfo);\n-          masterServices.getAssignmentManager()\n-            .getRegionStates()\n-            .updateRegionState(regionInfo, RegionState.State.CLOSED);\n-          return Either.<RegionInfo, IOException>ofLeft(regionInfo);\n+          TableDescriptor td = masterServices.getTableDescriptors().get(regionInfo.getTable());\n+\n+          // Add replicas if needed\n+          // we need to create regions with replicaIds starting from 1\n+          List<RegionInfo> newRegions = RegionReplicaUtil.addReplicas(td,", "originalCommit": "0ccc11505f7d9988a40a023756a3dbd6e08b1799", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxNTc5Mg==", "url": "https://github.com/apache/hbase/pull/2062#discussion_r454515792", "bodyText": "Ok, let me remove it.", "author": "huaxiangsun", "createdAt": "2020-07-14T17:17:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIyOTkwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIzNDc4NQ==", "url": "https://github.com/apache/hbase/pull/2062#discussion_r454234785", "bodyText": "nit: line is beyond 100 char limit. Spotbugs is no longer considering line max char limits it seems.", "author": "virajjasani", "createdAt": "2020-07-14T09:43:49Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java", "diffHunk": "@@ -174,22 +177,35 @@ private static RegionInfo buildRegionInfo(TableName tn, byte [] start, byte [] e\n   private static List<RegionInfo> createMetaEntries(final MasterServices masterServices,\n     final List<RegionInfo> newRegionInfos) {\n \n-    final List<Either<RegionInfo, IOException>> addMetaEntriesResults = newRegionInfos.stream()\n+    final List<Either<List<RegionInfo>, IOException>> addMetaEntriesResults = newRegionInfos.stream()", "originalCommit": "0ccc11505f7d9988a40a023756a3dbd6e08b1799", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxNTkzMw==", "url": "https://github.com/apache/hbase/pull/2062#discussion_r454515933", "bodyText": "Will do.", "author": "huaxiangsun", "createdAt": "2020-07-14T17:18:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIzNDc4NQ=="}], "type": "inlineReview"}, {"oid": "f106480e727a181dc982293093858d67a87ac25c", "url": "https://github.com/apache/hbase/commit/f106480e727a181dc982293093858d67a87ac25c", "message": "HBASE-24705 MetaFixer#fixHoles() does not include the case for read replicas (i.e, replica regions are not created)", "committedDate": "2020-07-14T17:35:03Z", "type": "commit"}, {"oid": "f106480e727a181dc982293093858d67a87ac25c", "url": "https://github.com/apache/hbase/commit/f106480e727a181dc982293093858d67a87ac25c", "message": "HBASE-24705 MetaFixer#fixHoles() does not include the case for read replicas (i.e, replica regions are not created)", "committedDate": "2020-07-14T17:35:03Z", "type": "forcePushed"}]}