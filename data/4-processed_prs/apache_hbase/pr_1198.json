{"pr_number": 1198, "pr_title": "HBASE-23740 Invalid StoreFile WARN log message printed for recovered.\u2026", "pr_createdAt": "2020-02-23T11:33:47Z", "pr_url": "https://github.com/apache/hbase/pull/1198", "timeline": [{"oid": "39045e30fcd6f88b95070a4a9f3d15f32bdb2a84", "url": "https://github.com/apache/hbase/commit/39045e30fcd6f88b95070a4a9f3d15f32bdb2a84", "message": "HBASE-23740 Invalid StoreFile WARN log message printed for recovered.hfiles directory", "committedDate": "2020-02-23T09:48:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAyOTQ1Nw==", "url": "https://github.com/apache/hbase/pull/1198#discussion_r383029457", "bodyText": "Might want to use {} for status.getPath()?", "author": "virajjasani", "createdAt": "2020-02-23T18:59:17Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionFileSystem.java", "diffHunk": "@@ -245,7 +245,11 @@ public String getStoragePolicyName(String familyName) {\n     ArrayList<StoreFileInfo> storeFiles = new ArrayList<>(files.length);\n     for (FileStatus status: files) {\n       if (validate && !StoreFileInfo.isValid(status)) {\n-        LOG.warn(\"Invalid StoreFile: \" + status.getPath());\n+        // recovered.hfiles directory is expected inside CF path when hbase.wal.split.to.hfile to\n+        // true, refer HBASE-23740\n+        if (!HConstants.RECOVERED_HFILES_DIR.equals(status.getPath().getName())) {\n+          LOG.warn(\"Invalid StoreFile: \" + status.getPath());", "originalCommit": "39045e30fcd6f88b95070a4a9f3d15f32bdb2a84", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE1Nzc4OA==", "url": "https://github.com/apache/hbase/pull/1198#discussion_r383157788", "bodyText": "Done in 34f2189", "author": "pankaj72981", "createdAt": "2020-02-24T09:37:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAyOTQ1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEzODM1Mw==", "url": "https://github.com/apache/hbase/pull/1198#discussion_r383138353", "bodyText": "Same here.", "author": "petersomogyi", "createdAt": "2020-02-24T08:53:40Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionFileSystem.java", "diffHunk": "@@ -278,7 +282,11 @@ public String getStoragePolicyName(String familyName) {\n     List<LocatedFileStatus> validStoreFiles = Lists.newArrayList();\n     for (LocatedFileStatus status : locatedFileStatuses) {\n       if (validate && !StoreFileInfo.isValid(status)) {\n-        LOG.warn(\"Invalid StoreFile: \" + status.getPath());\n+        // recovered.hfiles directory is expected inside CF path when hbase.wal.split.to.hfile to\n+        // true, refer HBASE-23740\n+        if (!HConstants.RECOVERED_HFILES_DIR.equals(status.getPath().getName())) {\n+          LOG.warn(\"Invalid StoreFile: \" + status.getPath());", "originalCommit": "39045e30fcd6f88b95070a4a9f3d15f32bdb2a84", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE1Nzg4Ng==", "url": "https://github.com/apache/hbase/pull/1198#discussion_r383157886", "bodyText": "Done 34f2189", "author": "pankaj72981", "createdAt": "2020-02-24T09:37:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEzODM1Mw=="}], "type": "inlineReview"}, {"oid": "34f2189716dd98c7a8319a1b7f2185a40b775503", "url": "https://github.com/apache/hbase/commit/34f2189716dd98c7a8319a1b7f2185a40b775503", "message": "HBASE-23740 Invalid StoreFile WARN log message printed for recovered.hfiles directory", "committedDate": "2020-02-24T09:34:45Z", "type": "commit"}]}