{"pr_number": 2825, "pr_title": "HBASE-25451 Upgrade commons-io to 2.8.0", "pr_createdAt": "2020-12-29T06:53:06Z", "pr_url": "https://github.com/apache/hbase/pull/2825", "timeline": [{"oid": "1f5ff871ea17ac5e2862cc62ccb91313b57d610e", "url": "https://github.com/apache/hbase/commit/1f5ff871ea17ac5e2862cc62ccb91313b57d610e", "message": "HBASE-25451 Upgrade commons-io to 2.8.0", "committedDate": "2020-12-29T06:52:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5MjM0NQ==", "url": "https://github.com/apache/hbase/pull/2825#discussion_r549592345", "bodyText": "What is the difference about Closeables.close and IOUtils.close?", "author": "infraio", "createdAt": "2020-12-29T07:01:54Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -832,7 +832,7 @@ private void finishActiveMasterInitialization(MonitoredTask status) throws IOExc\n             HBaseFsck.createLockRetryCounterFactory(this.conf).create());\n       } finally {\n         if (result != null) {\n-          IOUtils.closeQuietly(result.getSecond());\n+          Closeables.close(result.getSecond(), true);", "originalCommit": "1f5ff871ea17ac5e2862cc62ccb91313b57d610e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYwNDY3MA==", "url": "https://github.com/apache/hbase/pull/2825#discussion_r549604670", "bodyText": "Closeables.close(c, true) will swallow the IOException thrown while IOUtils.close will not.", "author": "Apache9", "createdAt": "2020-12-29T07:51:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5MjM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkwNjk4OQ==", "url": "https://github.com/apache/hbase/pull/2825#discussion_r549906989", "bodyText": "Seems there are three methods you used: Closeables.closeQuietly, Closeables.close, IOUtils.closeQuietly. Do we have a developer guide doc about what we recommend to use?", "author": "infraio", "createdAt": "2020-12-30T01:36:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5MjM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkwNzgyOQ==", "url": "https://github.com/apache/hbase/pull/2825#discussion_r549907829", "bodyText": "Closeables.close will still throw IOExceptions on the method signature, so usually it is only suitable to be used in UT, where we are free to change the method signature.\nIOUtils.closeQuietly will not throw any exceptions but you need to pass in a consumer to process the IOException(usually just a logging).\nCloseables.closeQuietly is for closing Reader and InputStream, where we will not throw any exceptions.", "author": "Apache9", "createdAt": "2020-12-30T01:41:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5MjM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIxMDM0NQ==", "url": "https://github.com/apache/hbase/pull/2825#discussion_r550210345", "bodyText": "And in general, I do not have very strong opinion on forcing these rules, developers are free to use these methods, just not use a deprecated one...", "author": "Apache9", "createdAt": "2020-12-30T14:20:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5MjM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM2ODg4NA==", "url": "https://github.com/apache/hbase/pull/2825#discussion_r550368884", "bodyText": "IOUtils.closeQuietly is also deprecated with a long time -- apache/commons-io@ce2b3e8", "author": "saintstack", "createdAt": "2020-12-31T01:05:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5MjM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM2OTIzNw==", "url": "https://github.com/apache/hbase/pull/2825#discussion_r550369237", "bodyText": "As is Closeables#closeQuietly... google/guava#1118", "author": "saintstack", "createdAt": "2020-12-31T01:07:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5MjM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM3MjA0NQ==", "url": "https://github.com/apache/hbase/pull/2825#discussion_r550372045", "bodyText": "For IOUtils.closeQuietly, now it provides a version with a consumer parameter to process the IOException which is not deprecated.\nFor Closeables.closeQuirtly, the version which takes a Closeable as parameter has already been removed for a long time, but the version which takes a InputStream or a Reader is still available and is not deprecated.", "author": "Apache9", "createdAt": "2020-12-31T01:29:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5MjM0NQ=="}], "type": "inlineReview"}, {"oid": "17f35e54598bd467490fb5d7703ad56a1cf5ac03", "url": "https://github.com/apache/hbase/commit/17f35e54598bd467490fb5d7703ad56a1cf5ac03", "message": "fix checkstyle issue", "committedDate": "2020-12-29T08:07:54Z", "type": "commit"}]}