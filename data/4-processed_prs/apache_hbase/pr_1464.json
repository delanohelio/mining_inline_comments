{"pr_number": 1464, "pr_title": "HBASE-24150 Allow module tests run in parallel", "pr_createdAt": "2020-04-09T04:20:26Z", "pr_url": "https://github.com/apache/hbase/pull/1464", "timeline": [{"oid": "b3a52ca980bc203a84260a69c8572947cd03e204", "url": "https://github.com/apache/hbase/commit/b3a52ca980bc203a84260a69c8572947cd03e204", "message": "HBASE-24150 Allow module tests run in parallel\nPass --threads=2 to mvn when yetus runs so some parallelism\nwhen dependencies allow.", "committedDate": "2020-04-09T04:16:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNjgzNQ==", "url": "https://github.com/apache/hbase/pull/1464#discussion_r406336835", "bodyText": "Not just parallel test suites, but everything. With this change, maven will run up to 2 concurrent modules when the dependency graph permits. I imaging this will be a nice general benefit.\nOne thing to note though is that some plugins don't support multithreading. IIRC, surefire-reports was one such plugin, and would print warnings in the build. Looks like this patch didn't actually trigger any maven invocation, so I cannot point you at the message. A simple mvn clean package -DskipTests should be enough to get the message printed.\nSince we use Jenkins to aggregate test results, I suggest we disable/remove surefire-reports (this was something I discussed with @busbey sometime back, but neither of us have gotten to it).", "author": "ndimiduk", "createdAt": "2020-04-09T16:44:38Z", "path": "dev-support/hbase-personality.sh", "diffHunk": "@@ -140,7 +140,10 @@ function personality_modules\n \n   clear_personality_queue\n \n-  extra=\"-DHBasePatchProcess\"\n+  # At a few points, hbase modules can run their test suites in parallel", "originalCommit": "b3a52ca980bc203a84260a69c8572947cd03e204", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM1MTgwOQ==", "url": "https://github.com/apache/hbase/pull/1464#discussion_r406351809", "bodyText": "Let me change the comment.\nI tried running the mvn clean ... above to find the message you refer to but too blind to see it. Let me add change in pom so its generated here.\nOn disabling the surefire reporting, you want that in this commit or on a follow-on?  Is it this you are referring too?\nmaven-surefire-report-plugin", "author": "saintstack", "createdAt": "2020-04-09T17:10:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNjgzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM2ODQxOQ==", "url": "https://github.com/apache/hbase/pull/1464#discussion_r406368419", "bodyText": "Yeah that's the plugin. Weirdly, now I try but I don't see the warning message. Hmm..\nRunning with -T1.0C I get a failure in\n[INFO] --- maven-enforcer-plugin:3.0.0-M2:enforce (check-aggregate-license) @ hbase-shaded-client ---                                                                                                           \n[WARNING] Rule 0: org.apache.maven.plugins.enforcer.EvaluateBeanshell failed with message:                                                                                                                      \nCouldn't evaluate condition: File license = new File(\"/Users/ndimiduk/repos/apache/hbase/hbase-shaded/hbase-shaded-client/target/maven-shared-archive-resources/META-INF/LICENSE\");                                                                                                                                                                                                                                             \n                    // Beanshell does not support try-with-resources,                                   \n                    // so we must close this scanner manually                                                                                                                                                   \n                    Scanner scanner = new Scanner(license);                                                                                                                                                     \n                                                                                                                                                                                                                \n                    while (scanner.hasNextLine()) {                                                                                                                                                             \n                      if (scanner.nextLine().startsWith(\"ERROR:\")) {                                                                                                                                            \n                        scanner.close();                                                                                                                                                                        \n                        return false;                                                                                                                                                                           \n                      }                                                                                                                                                                                         \n                    }                                                                                                                                                                                           \n                    scanner.close();                                                                                                                                                                            \n                    return true;", "author": "ndimiduk", "createdAt": "2020-04-09T17:40:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNjgzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM4ODU5Mg==", "url": "https://github.com/apache/hbase/pull/1464#discussion_r406388592", "bodyText": "Yeah, I see those WARNINGs locally too. Another issue?", "author": "saintstack", "createdAt": "2020-04-09T18:15:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNjgzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQxOTgwMA==", "url": "https://github.com/apache/hbase/pull/1464#discussion_r406419800", "bodyText": "For me it's not just a warning, it breaks the build. Yes another issue, but if it consistently breaks runs using -T, it would need to be a blocker of this one.", "author": "ndimiduk", "createdAt": "2020-04-09T19:12:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNjgzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNzE3Ng==", "url": "https://github.com/apache/hbase/pull/1464#discussion_r406337176", "bodyText": "There's no value in --threads for grabbing the version info, is there?", "author": "ndimiduk", "createdAt": "2020-04-09T16:45:15Z", "path": "dev-support/hbase_nightly_source-artifact.sh", "diffHunk": "@@ -125,7 +125,7 @@ fi\n # See http://hbase.apache.org/book.html#maven.release\n \n echo \"Maven details, in case our JDK doesn't match expectations:\"\n-mvn --version --offline | tee \"${working_dir}/maven_version\"\n+mvn --threads=2 --version --offline | tee \"${working_dir}/maven_version\"", "originalCommit": "b3a52ca980bc203a84260a69c8572947cd03e204", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM1MjM0OQ==", "url": "https://github.com/apache/hbase/pull/1464#discussion_r406352349", "bodyText": "Yeah. Dumb change. Undoing.", "author": "saintstack", "createdAt": "2020-04-09T17:11:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNzE3Ng=="}], "type": "inlineReview"}, {"oid": "260fbf65717339d940bf4f03f83161235f11baef", "url": "https://github.com/apache/hbase/commit/260fbf65717339d940bf4f03f83161235f11baef", "message": "Address feedback from Nick", "committedDate": "2020-04-09T17:15:26Z", "type": "commit"}]}