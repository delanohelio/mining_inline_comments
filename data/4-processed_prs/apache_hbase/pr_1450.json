{"pr_number": 1450, "pr_title": "HBASE-24126 Up the container nproc uplimit from 10000 to 12500", "pr_createdAt": "2020-04-07T17:31:35Z", "pr_url": "https://github.com/apache/hbase/pull/1450", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYzNjU0Ng==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405636546", "bodyText": "I don't think this should be here. we want this proc limit change all the time, not just when the hadoopcheck test is enabled.", "author": "busbey", "createdAt": "2020-04-08T16:01:30Z", "path": "dev-support/hbase-personality.sh", "diffHunk": "@@ -513,6 +516,7 @@ function hadoopcheck_parse_args\n ## @stability    evolving\n function hadoopcheck_docker_support\n {\n+  DOCKER_EXTRAARGS=(\"${DOCKER_EXTRAARGS[@]}\" \"--ulimit\" \"nproc=12500\")", "originalCommit": "da2beb832d5981a50f96f708341c1ace1ddf7b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNDU3Ng==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405704576", "bodyText": "I don't follow. The new 12500 number is put everywhere, not just here conditional on when hadoopcheck runs. Thanks for taking a look.", "author": "saintstack", "createdAt": "2020-04-08T17:48:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYzNjU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTczMDYwNw==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405730607", "bodyText": "the reference you've added here is in the function that defines what is needed when we run docker specifically just when we're doing the hadoopcheck test.\nif we need it all the time, then it should be elsewhere. It looks it should be coming in from the YETUS_ARGS that have been added to the wrapper. If that's the case, then removing it here should have no impact on what happens. If removing it here makes it so things don't do what you expect, then something else is broken because the inclusion here is only going to happen when the hadoopcheck test is enabled.", "author": "busbey", "createdAt": "2020-04-08T18:32:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYzNjU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgyNzIwMg==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405827202", "bodyText": "Let me push new patch w/ your change. Thanks @busbey", "author": "saintstack", "createdAt": "2020-04-08T21:31:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYzNjU0Ng=="}], "type": "inlineReview"}, {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2", "url": "https://github.com/apache/hbase/commit/baf2d8929e6c56deff5ee300631a9f432bd784b2", "message": "HBASE-24126 Up the container nproc uplimit from 10000 to 12500", "committedDate": "2020-04-08T21:30:13Z", "type": "commit"}, {"oid": "baf2d8929e6c56deff5ee300631a9f432bd784b2", "url": "https://github.com/apache/hbase/commit/baf2d8929e6c56deff5ee300631a9f432bd784b2", "message": "HBASE-24126 Up the container nproc uplimit from 10000 to 12500", "committedDate": "2020-04-08T21:30:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3MjE1Mw==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405872153", "bodyText": "Yikes. This is just hiding over here in the corner. TODO: update flaky reporting to use yetus to run builds.", "author": "ndimiduk", "createdAt": "2020-04-08T23:29:03Z", "path": "dev-support/flaky-tests/flaky-reporting.Jenkinsfile", "diffHunk": "@@ -43,7 +43,7 @@ pipeline {\n           flaky_args=(\"${flaky_args[@]}\" --urls \"${JENKINS_URL}/job/HBase%20Nightly/job/${BRANCH_NAME}\" --is-yetus True --max-builds 10)\n           flaky_args=(\"${flaky_args[@]}\" --urls \"${JENKINS_URL}/job/HBase-Flaky-Tests/job/${BRANCH_NAME}\" --is-yetus False --max-builds 30)\n           docker build -t hbase-dev-support dev-support\n-          docker run -v \"${WORKSPACE}\":/hbase --workdir=/hbase hbase-dev-support python dev-support/flaky-tests/report-flakies.py --mvn -v \"${flaky_args[@]}\"\n+          docker run --ulimit nproc=12500 -v \"${WORKSPACE}\":/hbase --workdir=/hbase hbase-dev-support python dev-support/flaky-tests/report-flakies.py --mvn -v \"${flaky_args[@]}\"", "originalCommit": "baf2d8929e6c56deff5ee300631a9f432bd784b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg5MDA1NQ==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405890055", "bodyText": "Yeah, one way to run all builds would be sweet.", "author": "saintstack", "createdAt": "2020-04-09T00:28:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3MjE1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3MzAzNA==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405873034", "bodyText": "Oh no, I didn't know this script existed. I probably broke it with the improvements that went in with HBASE-23945.", "author": "ndimiduk", "createdAt": "2020-04-08T23:31:58Z", "path": "dev-support/hbase_docker.sh", "diffHunk": "@@ -159,4 +159,4 @@ done\n echo \"Successfully built ${IMAGE_NAME}.\"\n ", "originalCommit": "baf2d8929e6c56deff5ee300631a9f432bd784b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDQzNw==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405874437", "bodyText": "Ah, yeah. In yetus, the env variable is PROC_LIMIT. You found a bug :)", "author": "ndimiduk", "createdAt": "2020-04-08T23:36:22Z", "path": "dev-support/hbase-personality.sh", "diffHunk": "@@ -81,8 +81,11 @@ function personality_globals\n \n   # Yetus 0.7.0 enforces limits. Default proclimit is 1000.\n   # Up it. See HBASE-19902 for how we arrived at this number.\n+  # NOTE: I don't think changing this has an effect. Set the\n+  # --proclimit passed to yetus. This seems to do what we\n+  # need changing proclimit.", "originalCommit": "baf2d8929e6c56deff5ee300631a9f432bd784b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg5MDI1MA==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405890250", "bodyText": "Let me try filing an issue.", "author": "saintstack", "createdAt": "2020-04-09T00:29:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDQzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDYzNQ==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405874635", "bodyText": "If the above change for PROC_LIMIT works, this line can be dropped.", "author": "ndimiduk", "createdAt": "2020-04-08T23:37:05Z", "path": "dev-support/hbase_nightly_yetus.sh", "diffHunk": "@@ -66,7 +66,7 @@ YETUS_ARGS=(\"--branch=${BRANCH_NAME}\" \"${YETUS_ARGS[@]}\")\n YETUS_ARGS=(\"--tests-filter=${TESTS_FILTER}\" \"${YETUS_ARGS[@]}\")\n YETUS_ARGS=(\"--ignore-unknown-options=true\" \"${YETUS_ARGS[@]}\")\n # Why are these not being picked up from hbase-personality?\n-YETUS_ARGS=(\"--proclimit=10000\" \"${YETUS_ARGS[@]}\")\n+YETUS_ARGS=(\"--proclimit=12500\" \"${YETUS_ARGS[@]}\")", "originalCommit": "baf2d8929e6c56deff5ee300631a9f432bd784b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg5MDM0MA==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405890340", "bodyText": "Yeah. For now they needed. Let me file an issue.", "author": "saintstack", "createdAt": "2020-04-09T00:29:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDYzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3NDY3OA==", "url": "https://github.com/apache/hbase/pull/1450#discussion_r405874678", "bodyText": "likewise.", "author": "ndimiduk", "createdAt": "2020-04-08T23:37:15Z", "path": "dev-support/jenkins_precommit_github_yetus.sh", "diffHunk": "@@ -102,7 +102,7 @@ YETUS_ARGS+=(\"--reapermode=kill\")\n # set relatively high limits for ASF machines\n # changing these to higher values may cause problems\n # with other jobs on systemd-enabled machines\n-YETUS_ARGS+=(\"--proclimit=10000\")\n+YETUS_ARGS+=(\"--proclimit=12500\")", "originalCommit": "baf2d8929e6c56deff5ee300631a9f432bd784b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}