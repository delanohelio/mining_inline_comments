{"pr_number": 1801, "pr_title": "HBASE-24441 CacheConfig details logged at Store open is not really u\u2026", "pr_createdAt": "2020-05-29T03:21:30Z", "pr_url": "https://github.com/apache/hbase/pull/1801", "timeline": [{"oid": "95f84f4a4451c6a0d1db98167088ce3e49c993e1", "url": "https://github.com/apache/hbase/commit/95f84f4a4451c6a0d1db98167088ce3e49c993e1", "message": "[HBASE-24441]CacheConfig details logged at Store open is not really useful", "committedDate": "2020-05-29T02:38:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjYxOA==", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432812618", "bodyText": "IMO better we should move this LOG from here to HStore.\nprotected void createCacheConf(final ColumnFamilyDescriptor family) {\nthis.cacheConf = new CacheConfig(conf, family, region.getBlockCache(),\nregion.getRegionServicesForStores().getByteBuffAllocator());\n}\nAfter the cacheConf is created.  CacheConfig is having toString() with all details.  This way we can avoid passing the RegionInfo/regionName unnecessarily to CacheConfig just for log.\nIn Master branch, we are not seeing the CacheConfig log with every compaction because of a different constructor being used.", "author": "anoopsjohn", "createdAt": "2020-05-30T05:32:39Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java", "diffHunk": "@@ -205,6 +206,7 @@ public CacheConfig(Configuration conf, ColumnFamilyDescriptor family, BlockCache\n     this.blockCache = blockCache;\n     this.byteBuffAllocator = byteBuffAllocator;\n     LOG.info(\"Created cacheConfig: \" + this + (family == null ? \"\" : \" for family \" + family) +", "originalCommit": "95f84f4a4451c6a0d1db98167088ce3e49c993e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwNjAzNA==", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432906034", "bodyText": "Yes, you are right, thank you for your suggestions", "author": "songxincun", "createdAt": "2020-05-31T03:30:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjYxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjY1MA==", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432812650", "bodyText": "Ya this is some thing we can avoid", "author": "anoopsjohn", "createdAt": "2020-05-30T05:32:58Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "diffHunk": "@@ -377,7 +377,7 @@ private MemStore getMemstore() {\n    * @param family The current column family.\n    */\n   protected void createCacheConf(final ColumnFamilyDescriptor family) {\n-    this.cacheConf = new CacheConfig(conf, family, region.getBlockCache(),\n+    this.cacheConf = new CacheConfig(conf, family, region.getRegionInfo(), region.getBlockCache(),", "originalCommit": "95f84f4a4451c6a0d1db98167088ce3e49c993e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjY2Ng==", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432812666", "bodyText": "All these test changes will be not needed", "author": "anoopsjohn", "createdAt": "2020-05-30T05:33:17Z", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheConfig.java", "diffHunk": "@@ -245,7 +245,8 @@ public void testDisableCacheDataBlock() throws IOException {\n         .setBlockCacheEnabled(false)\n         .build();\n \n-    cacheConfig = new CacheConfig(conf, columnFamilyDescriptor, null, ByteBuffAllocator.HEAP);", "originalCommit": "95f84f4a4451c6a0d1db98167088ce3e49c993e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjgzMg==", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432812832", "bodyText": "Here this blockCache will just give object identifier as no toString() there. BlockCache will be single object within RS. So IMO there is no need to log that with every Store create.  Anyway if you do other comment, we will avoid it as CacheConfig#toString() wont be having BlockCache object", "author": "anoopsjohn", "createdAt": "2020-05-30T05:35:44Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java", "diffHunk": "@@ -205,6 +206,7 @@ public CacheConfig(Configuration conf, ColumnFamilyDescriptor family, BlockCache\n     this.blockCache = blockCache;\n     this.byteBuffAllocator = byteBuffAllocator;\n     LOG.info(\"Created cacheConfig: \" + this + (family == null ? \"\" : \" for family \" + family) +\n+        (hri == null ? \"\" : \" in region \" + hri.getRegionNameAsString()) +\n         \" with blockCache=\" + blockCache);", "originalCommit": "95f84f4a4451c6a0d1db98167088ce3e49c993e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwNjEzOQ==", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432906139", "bodyText": "Yes, maybe we can log CacheConfig in the BlockCacheFactory#createBlockCache and remove it from here", "author": "songxincun", "createdAt": "2020-05-31T03:32:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxMjgzMg=="}], "type": "inlineReview"}, {"oid": "c4f5ded5da4e6485aa1203283030027d4cf9fb39", "url": "https://github.com/apache/hbase/commit/c4f5ded5da4e6485aa1203283030027d4cf9fb39", "message": "Revert \"[HBASE-24441]CacheConfig details logged at Store open is not really useful\"\n\nThis reverts commit 95f84f4a4451c6a0d1db98167088ce3e49c993e1.", "committedDate": "2020-05-31T01:45:14Z", "type": "commit"}, {"oid": "9b5d7d6202abcfb04a2a5b4a174e4c041ed30686", "url": "https://github.com/apache/hbase/commit/9b5d7d6202abcfb04a2a5b4a174e4c041ed30686", "message": "HBASE-24441 CacheConfig details logged at Store open is not really useful\n\nFix what Anoop suggests", "committedDate": "2020-05-31T03:28:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxNDA5Mw==", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432914093", "bodyText": "Looks good. There is another jira where we discuss abt  changing HStore#toString() to add region info also there. Then u will need to change this also.", "author": "anoopsjohn", "createdAt": "2020-05-31T06:19:32Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "diffHunk": "@@ -379,6 +379,9 @@ private MemStore getMemstore() {\n   protected void createCacheConf(final ColumnFamilyDescriptor family) {\n     this.cacheConf = new CacheConfig(conf, family, region.getBlockCache(),\n         region.getRegionServicesForStores().getByteBuffAllocator());\n+    LOG.info(\"Created cacheConfig: \" + this.getCacheConfig()", "originalCommit": "9b5d7d6202abcfb04a2a5b4a174e4c041ed30686", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxOTUxOQ==", "url": "https://github.com/apache/hbase/pull/1801#discussion_r432919519", "bodyText": "Looks good. There is another jira where we discuss abt changing HStore#toString() to add region info also there. Then u will need to change this also.\n\nBut, HStore#toString() prints only short name of column family without any attribute. I am not sure is it suitable to use here. @anoopsjohn  Would you give me some suggestions? Thanks a lot", "author": "songxincun", "createdAt": "2020-05-31T07:38:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxNDA5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAzNDgyNQ==", "url": "https://github.com/apache/hbase/pull/1801#discussion_r433034825", "bodyText": "Ya that should be fine IMO", "author": "anoopsjohn", "createdAt": "2020-06-01T04:19:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxNDA5Mw=="}], "type": "inlineReview"}, {"oid": "98443c09d818147e6768961062a8e4dc2ceb28b3", "url": "https://github.com/apache/hbase/commit/98443c09d818147e6768961062a8e4dc2ceb28b3", "message": "Use the new HStore#toString() provided by HBASE-24468 to print the HStore", "committedDate": "2020-06-01T04:50:37Z", "type": "commit"}]}