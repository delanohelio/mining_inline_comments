{"pr_number": 1487, "pr_title": "HBASE-23800 Add documentation about the CECPs changes", "pr_createdAt": "2020-04-11T04:31:31Z", "pr_url": "https://github.com/apache/hbase/pull/1487", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2NzUzMg==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407067532", "bodyText": "NIT: \"Since coprocessor is an advanced feature...\"", "author": "HorizonNet", "createdAt": "2020-04-11T14:01:12Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -178,11 +178,27 @@ average or summation for an entire table which spans hundreds of regions.\n \n In contrast to observer coprocessors, where your code is run transparently, endpoint\n coprocessors must be explicitly invoked using the\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html#coprocessorService-java.lang.Class-byte:A-byte:A-org.apache.hadoop.hbase.client.coprocessor.Batch.Call-[CoprocessorService()]\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html#coprocessorService-java.util.function.Function-org.apache.hadoop.hbase.client.ServiceCaller-byte:A-[CoprocessorService()]\n method available in\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n-or\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/HTable.html[HTable].\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html[AsyncTable].\n+\n+[WARNING]\n+.On using coprocessorService method with sync client\n+====\n+The coprocessorService method in link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n+has been deprecated.\n+\n+In link:https://issues.apache.org/jira/browse/HBASE-21512[HBASE-21512]\n+we reimplement the sync client based on the async client. And the coprocessorService\n+method defined in `Table` interface references the method from protobuf's\n+`BlockingInterface`, which means we need to use a separated thread pool to execute\n+the method to avoid blocking the async client, which is not good.\n+\n+Since coprocessor is an advance feature, we believe it is OK for coprocessor uses to", "originalCommit": "a03b847c5c6c4efe637282b05dedb23b019633de", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2NzYyNQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407067625", "bodyText": "NIT: \"There is a lightweight...\"", "author": "HorizonNet", "createdAt": "2020-04-11T14:02:11Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -178,11 +178,27 @@ average or summation for an entire table which spans hundreds of regions.\n \n In contrast to observer coprocessors, where your code is run transparently, endpoint\n coprocessors must be explicitly invoked using the\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html#coprocessorService-java.lang.Class-byte:A-byte:A-org.apache.hadoop.hbase.client.coprocessor.Batch.Call-[CoprocessorService()]\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html#coprocessorService-java.util.function.Function-org.apache.hadoop.hbase.client.ServiceCaller-byte:A-[CoprocessorService()]\n method available in\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n-or\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/HTable.html[HTable].\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html[AsyncTable].\n+\n+[WARNING]\n+.On using coprocessorService method with sync client\n+====\n+The coprocessorService method in link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n+has been deprecated.\n+\n+In link:https://issues.apache.org/jira/browse/HBASE-21512[HBASE-21512]\n+we reimplement the sync client based on the async client. And the coprocessorService\n+method defined in `Table` interface references the method from protobuf's\n+`BlockingInterface`, which means we need to use a separated thread pool to execute\n+the method to avoid blocking the async client, which is not good.\n+\n+Since coprocessor is an advance feature, we believe it is OK for coprocessor uses to\n+make use of the `AsyncTable` directly. And there is a lightweight", "originalCommit": "a03b847c5c6c4efe637282b05dedb23b019633de", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2NzY0NQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407067645", "bodyText": "NIT: \"In HBase 2.0.0,...\"", "author": "HorizonNet", "createdAt": "2020-04-11T14:02:29Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -193,6 +209,12 @@ link:https://issues.apache.org/jira/browse/HBASE-5448[HBASE-5448]). To upgrade y\n HBase cluster from 0.94 or earlier to 0.96 or later, you need to reimplement your\n coprocessor.\n \n+And in HBase 2.0.0, we make use of a shaded version of protobuf 3.x but still keep the", "originalCommit": "a03b847c5c6c4efe637282b05dedb23b019633de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2NzcxOQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407067719", "bodyText": "NIT: \"...protobuf 3.x, but still...\"", "author": "HorizonNet", "createdAt": "2020-04-11T14:03:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2NzY0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2NzkxOQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407067919", "bodyText": "NIT: \"In 3.0.0 we removed all dependencies on ...\"", "author": "HorizonNet", "createdAt": "2020-04-11T14:04:46Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -193,6 +209,12 @@ link:https://issues.apache.org/jira/browse/HBASE-5448[HBASE-5448]). To upgrade y\n HBase cluster from 0.94 or earlier to 0.96 or later, you need to reimplement your\n coprocessor.\n \n+And in HBase 2.0.0, we make use of a shaded version of protobuf 3.x but still keep the\n+protobuf for coprocessor on 2.5.0. And in 3.0.0, we removed all the dependency on non-shaded", "originalCommit": "a03b847c5c6c4efe637282b05dedb23b019633de", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "url": "https://github.com/apache/hbase/commit/17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "message": "fix typo", "committedDate": "2020-04-13T04:17:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MDIzOQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407870239", "bodyText": "s/And the/The/", "author": "saintstack", "createdAt": "2020-04-14T05:09:28Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -178,11 +178,27 @@ average or summation for an entire table which spans hundreds of regions.\n \n In contrast to observer coprocessors, where your code is run transparently, endpoint\n coprocessors must be explicitly invoked using the\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html#coprocessorService-java.lang.Class-byte:A-byte:A-org.apache.hadoop.hbase.client.coprocessor.Batch.Call-[CoprocessorService()]\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html#coprocessorService-java.util.function.Function-org.apache.hadoop.hbase.client.ServiceCaller-byte:A-[CoprocessorService()]\n method available in\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n-or\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/HTable.html[HTable].\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html[AsyncTable].\n+\n+[WARNING]\n+.On using coprocessorService method with sync client\n+====\n+The coprocessorService method in link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n+has been deprecated.\n+\n+In link:https://issues.apache.org/jira/browse/HBASE-21512[HBASE-21512]\n+we reimplement the sync client based on the async client. And the coprocessorService", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MDU3OQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407870579", "bodyText": "s/references the/directly references a/", "author": "saintstack", "createdAt": "2020-04-14T05:10:37Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -178,11 +178,27 @@ average or summation for an entire table which spans hundreds of regions.\n \n In contrast to observer coprocessors, where your code is run transparently, endpoint\n coprocessors must be explicitly invoked using the\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html#coprocessorService-java.lang.Class-byte:A-byte:A-org.apache.hadoop.hbase.client.coprocessor.Batch.Call-[CoprocessorService()]\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html#coprocessorService-java.util.function.Function-org.apache.hadoop.hbase.client.ServiceCaller-byte:A-[CoprocessorService()]\n method available in\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n-or\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/HTable.html[HTable].\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html[AsyncTable].\n+\n+[WARNING]\n+.On using coprocessorService method with sync client\n+====\n+The coprocessorService method in link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n+has been deprecated.\n+\n+In link:https://issues.apache.org/jira/browse/HBASE-21512[HBASE-21512]\n+we reimplement the sync client based on the async client. And the coprocessorService\n+method defined in `Table` interface references the method from protobuf's", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MDYxNA==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407870614", "bodyText": "s/separated/separate/", "author": "saintstack", "createdAt": "2020-04-14T05:10:51Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -178,11 +178,27 @@ average or summation for an entire table which spans hundreds of regions.\n \n In contrast to observer coprocessors, where your code is run transparently, endpoint\n coprocessors must be explicitly invoked using the\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html#coprocessorService-java.lang.Class-byte:A-byte:A-org.apache.hadoop.hbase.client.coprocessor.Batch.Call-[CoprocessorService()]\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html#coprocessorService-java.util.function.Function-org.apache.hadoop.hbase.client.ServiceCaller-byte:A-[CoprocessorService()]\n method available in\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n-or\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/HTable.html[HTable].\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html[AsyncTable].\n+\n+[WARNING]\n+.On using coprocessorService method with sync client\n+====\n+The coprocessorService method in link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n+has been deprecated.\n+\n+In link:https://issues.apache.org/jira/browse/HBASE-21512[HBASE-21512]\n+we reimplement the sync client based on the async client. And the coprocessorService\n+method defined in `Table` interface references the method from protobuf's\n+`BlockingInterface`, which means we need to use a separated thread pool to execute", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MDgzMA==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407870830", "bodyText": "s/to avoid blocking/so we avoid blocking/\ns/, which is not good/(We want to avoid blocking calls in our async implementation).", "author": "saintstack", "createdAt": "2020-04-14T05:11:43Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -178,11 +178,27 @@ average or summation for an entire table which spans hundreds of regions.\n \n In contrast to observer coprocessors, where your code is run transparently, endpoint\n coprocessors must be explicitly invoked using the\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html#coprocessorService-java.lang.Class-byte:A-byte:A-org.apache.hadoop.hbase.client.coprocessor.Batch.Call-[CoprocessorService()]\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html#coprocessorService-java.util.function.Function-org.apache.hadoop.hbase.client.ServiceCaller-byte:A-[CoprocessorService()]\n method available in\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n-or\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/HTable.html[HTable].\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html[AsyncTable].\n+\n+[WARNING]\n+.On using coprocessorService method with sync client\n+====\n+The coprocessorService method in link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n+has been deprecated.\n+\n+In link:https://issues.apache.org/jira/browse/HBASE-21512[HBASE-21512]\n+we reimplement the sync client based on the async client. And the coprocessorService\n+method defined in `Table` interface references the method from protobuf's\n+`BlockingInterface`, which means we need to use a separated thread pool to execute\n+the method to avoid blocking the async client, which is not good.", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MTk5OA==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407871998", "bodyText": "s/to make use of the/to instead switch over to use/\ns/directly//", "author": "saintstack", "createdAt": "2020-04-14T05:16:04Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -178,11 +178,27 @@ average or summation for an entire table which spans hundreds of regions.\n \n In contrast to observer coprocessors, where your code is run transparently, endpoint\n coprocessors must be explicitly invoked using the\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html#coprocessorService-java.lang.Class-byte:A-byte:A-org.apache.hadoop.hbase.client.coprocessor.Batch.Call-[CoprocessorService()]\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html#coprocessorService-java.util.function.Function-org.apache.hadoop.hbase.client.ServiceCaller-byte:A-[CoprocessorService()]\n method available in\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n-or\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/HTable.html[HTable].\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html[AsyncTable].\n+\n+[WARNING]\n+.On using coprocessorService method with sync client\n+====\n+The coprocessorService method in link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n+has been deprecated.\n+\n+In link:https://issues.apache.org/jira/browse/HBASE-21512[HBASE-21512]\n+we reimplement the sync client based on the async client. And the coprocessorService\n+method defined in `Table` interface references the method from protobuf's\n+`BlockingInterface`, which means we need to use a separated thread pool to execute\n+the method to avoid blocking the async client, which is not good.\n+\n+Since coprocessor is an advanced feature, we believe it is OK for coprocessor users to\n+make use of the `AsyncTable` directly. There is a lightweight", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MjA5OQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407872099", "bodyText": "s/Connection./Connection if needed./", "author": "saintstack", "createdAt": "2020-04-14T05:16:29Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -178,11 +178,27 @@ average or summation for an entire table which spans hundreds of regions.\n \n In contrast to observer coprocessors, where your code is run transparently, endpoint\n coprocessors must be explicitly invoked using the\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html#coprocessorService-java.lang.Class-byte:A-byte:A-org.apache.hadoop.hbase.client.coprocessor.Batch.Call-[CoprocessorService()]\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html#coprocessorService-java.util.function.Function-org.apache.hadoop.hbase.client.ServiceCaller-byte:A-[CoprocessorService()]\n method available in\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n-or\n-link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/HTable.html[HTable].\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/AsyncTable.html[AsyncTable].\n+\n+[WARNING]\n+.On using coprocessorService method with sync client\n+====\n+The coprocessorService method in link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Table.html[Table]\n+has been deprecated.\n+\n+In link:https://issues.apache.org/jira/browse/HBASE-21512[HBASE-21512]\n+we reimplement the sync client based on the async client. And the coprocessorService\n+method defined in `Table` interface references the method from protobuf's\n+`BlockingInterface`, which means we need to use a separated thread pool to execute\n+the method to avoid blocking the async client, which is not good.\n+\n+Since coprocessor is an advanced feature, we believe it is OK for coprocessor users to\n+make use of the `AsyncTable` directly. There is a lightweight\n+link:https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/client/Connection.html#toAsyncConnection--[toAsyncConnection]\n+method to get an `AsyncConnection` from `Connection`.", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MjQ0NA==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407872444", "bodyText": "s/In HBase 2.0.0/In HBase.2.x/\ns/make/made/\ns/still keep/kept/\ns/coprocessor/coprocessors/", "author": "saintstack", "createdAt": "2020-04-14T05:17:52Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -193,6 +209,12 @@ link:https://issues.apache.org/jira/browse/HBASE-5448[HBASE-5448]). To upgrade y\n HBase cluster from 0.94 or earlier to 0.96 or later, you need to reimplement your\n coprocessor.\n \n+In HBase 2.0.0, we make use of a shaded version of protobuf 3.x, but still keep the\n+protobuf for coprocessor on 2.5.0. In 3.0.0, we removed all dependencies on non-shaded", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MzEyMw==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407873123", "bodyText": "Oh, so you put together your own .pb file/pb Service, and then use the protobuf version over in hbase-thirdparty to generate stubs.\nif you need to convert your pb to pojos, you build your own. If you want to use internal hbase pb or pojo types, I suppose you just use them?  They are not audience private but limitedprivate to CPEP implementors?", "author": "saintstack", "createdAt": "2020-04-14T05:20:18Z", "path": "src/main/asciidoc/_chapters/cp.adoc", "diffHunk": "@@ -193,6 +209,12 @@ link:https://issues.apache.org/jira/browse/HBASE-5448[HBASE-5448]). To upgrade y\n HBase cluster from 0.94 or earlier to 0.96 or later, you need to reimplement your\n coprocessor.\n \n+In HBase 2.0.0, we make use of a shaded version of protobuf 3.x, but still keep the\n+protobuf for coprocessor on 2.5.0. In 3.0.0, we removed all dependencies on non-shaded\n+protobuf so you need to reimplement your coprocessor to make use of the shaded protobuf\n+version provided in hbase-thirdparty. Please see the <<protobuf,protobuf>> section for", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzk1MzU0OA==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407953548", "bodyText": "I think this is why we need a hbase-protocol modue in the past? The CPEP implementation could reference the protobuf defination. And in general, adding breaking changes to proto files is a no no, it will break wire compatible, so I think it is fine to reference them?", "author": "Apache9", "createdAt": "2020-04-14T08:22:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MzEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNzI5NQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r408327295", "bodyText": "I was asking what the audience for protos is. If used by CPEP, then they are not Private. LimitedPrivate for CPEPs?", "author": "saintstack", "createdAt": "2020-04-14T17:54:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MzEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU1MDAzNg==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r408550036", "bodyText": "Yes, I think it is LimitedPrivate for CPEPs. What I said above is that, we had this consensus in the past, otherwise we did not need to provide a hbase-protocol module which duplicates a lot of proto files...", "author": "Apache9", "createdAt": "2020-04-15T02:49:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MzEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyNDg3NA==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r410424874", "bodyText": "We should label it explicitly w/ the LimitedPrivate for CPEPs and in refguides. Another issue.", "author": "saintstack", "createdAt": "2020-04-17T19:24:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MzEyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MzMyMw==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407873323", "bodyText": "... this in hadoop 3. what? Should you say that here? The hadoop version that moved pb?", "author": "saintstack", "createdAt": "2020-04-14T05:21:04Z", "path": "src/main/asciidoc/_chapters/protobuf.adoc", "diffHunk": "@@ -148,3 +148,67 @@ consider extending it also in\n Going forward, we will provide a new module of common types for use\n by CPEPs that will have the same guarantees against change as does our\n public API. TODO.\n+\n+=== protobuf changes for hbase-3.0.0 (HBASE-23797)\n+Since hadoop also shades protobuf and bumps the version to 3.x, there is no", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzk1MjI1MQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407952251", "bodyText": "It's hadoop 3.3.x.", "author": "Apache9", "createdAt": "2020-04-14T08:20:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MzMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNzU2MQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r408327561", "bodyText": "k. Would be good to say in doc.", "author": "saintstack", "createdAt": "2020-04-14T17:55:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MzMyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3MzQ0OQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407873449", "bodyText": "Say hbase-3.0.0 because 3.0.0 could get confused w/ hadoop 3.0.0 which you just mentioned", "author": "saintstack", "createdAt": "2020-04-14T05:21:37Z", "path": "src/main/asciidoc/_chapters/protobuf.adoc", "diffHunk": "@@ -148,3 +148,67 @@ consider extending it also in\n Going forward, we will provide a new module of common types for use\n by CPEPs that will have the same guarantees against change as does our\n public API. TODO.\n+\n+=== protobuf changes for hbase-3.0.0 (HBASE-23797)\n+Since hadoop also shades protobuf and bumps the version to 3.x, there is no\n+reason for us to stay on protobuf 2.5.0 any more.\n+\n+In 3.0.0, the hbase-protocol module has been purged, the CPEP implementation", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3Mzc1Nw==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407873757", "bodyText": "Anything on the audience for this module? Previous it was meant to be private to hbase. Now its exposed for CPEPs.  Should we recognize that by adding annotation or noting it somewhere like here?", "author": "saintstack", "createdAt": "2020-04-14T05:22:40Z", "path": "src/main/asciidoc/_chapters/protobuf.adoc", "diffHunk": "@@ -148,3 +148,67 @@ consider extending it also in\n Going forward, we will provide a new module of common types for use\n by CPEPs that will have the same guarantees against change as does our\n public API. TODO.\n+\n+=== protobuf changes for hbase-3.0.0 (HBASE-23797)\n+Since hadoop also shades protobuf and bumps the version to 3.x, there is no\n+reason for us to stay on protobuf 2.5.0 any more.\n+\n+In 3.0.0, the hbase-protocol module has been purged, the CPEP implementation\n+should use the protos in hbase-protocol-shaded module, and also make use of\n+the shaded protobuf in hbase-thirdparty.", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzkyODg2MQ==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407928861", "bodyText": "We will keep protobuf version compatible for a whole major release, so maybe we could upgrade from 3.11.4 to 3.11.5 or even 3.12.0 for a new minor release line but we will never upgrade to 4.0.0. We could add this here.", "author": "Apache9", "createdAt": "2020-04-14T07:40:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3Mzc1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNzg0Mw==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r408327843", "bodyText": "Yeah. Don't think it noted anywhere else.", "author": "saintstack", "createdAt": "2020-04-14T17:55:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3Mzc1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3Mzk1Nw==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407873957", "bodyText": "Refer users to the hbase-protoocol-shaded module? It does this? Refer them as an example to copy?", "author": "saintstack", "createdAt": "2020-04-14T05:23:29Z", "path": "src/main/asciidoc/_chapters/protobuf.adoc", "diffHunk": "@@ -148,3 +148,67 @@ consider extending it also in\n Going forward, we will provide a new module of common types for use\n by CPEPs that will have the same guarantees against change as does our\n public API. TODO.\n+\n+=== protobuf changes for hbase-3.0.0 (HBASE-23797)\n+Since hadoop also shades protobuf and bumps the version to 3.x, there is no\n+reason for us to stay on protobuf 2.5.0 any more.\n+\n+In 3.0.0, the hbase-protocol module has been purged, the CPEP implementation\n+should use the protos in hbase-protocol-shaded module, and also make use of\n+the shaded protobuf in hbase-thirdparty.\n+\n+Add this dependency to your pom:\n+[source,xml]\n+----\n+<dependency>\n+  <groupId>org.apache.hbase.thirdparty</groupId>\n+  <artifactId>hbase-shaded-protobuf</artifactId>\n+  <!-- use the version that your target hbase cluster uses -->\n+  <version>${hbase-thirdparty.version}</version>\n+  <scope>provided</scope>\n+</dependency>\n+----\n+\n+And typically you also need to add this plugin to your pom to make your\n+generated protobuf code also use the shaded and relocated protobuf version\n+in hbase-thirdparty.", "originalCommit": "17ace70d477d9bbb81c4169e6d89019e1d8b13fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3NDE3NA==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407874174", "bodyText": "Is there an example updated CPEP that does this? Refer to it in this doc if so?", "author": "saintstack", "createdAt": "2020-04-14T05:24:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3Mzk1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzkyNzcyNg==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r407927726", "bodyText": "There is an example in hbase-examples module.", "author": "Apache9", "createdAt": "2020-04-14T07:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3Mzk1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyODA5Mg==", "url": "https://github.com/apache/hbase/pull/1487#discussion_r408328092", "bodyText": "Good. Point there? Thanks.", "author": "saintstack", "createdAt": "2020-04-14T17:56:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3Mzk1Nw=="}], "type": "inlineReview"}, {"oid": "c21f0a7febe45e6ad371261fcbeb1a4ba135e2f2", "url": "https://github.com/apache/hbase/commit/c21f0a7febe45e6ad371261fcbeb1a4ba135e2f2", "message": "change wording", "committedDate": "2020-04-14T12:50:17Z", "type": "forcePushed"}, {"oid": "0f5b075a714afee3e702944a2ba28ddc18b90af7", "url": "https://github.com/apache/hbase/commit/0f5b075a714afee3e702944a2ba28ddc18b90af7", "message": "HBASE-23800 Add documentation about the CECPs changes", "committedDate": "2020-04-15T02:40:47Z", "type": "commit"}, {"oid": "1e504a12ccc57f0191cce318e3cb8a3f097aae85", "url": "https://github.com/apache/hbase/commit/1e504a12ccc57f0191cce318e3cb8a3f097aae85", "message": "fix typo", "committedDate": "2020-04-15T02:40:47Z", "type": "commit"}, {"oid": "985411f92e8b136a19a233b85aa92e6c2b683fbc", "url": "https://github.com/apache/hbase/commit/985411f92e8b136a19a233b85aa92e6c2b683fbc", "message": "change wording", "committedDate": "2020-04-15T02:40:47Z", "type": "commit"}, {"oid": "03cc23389fec71cb8c2fb5ceff3069586f660df7", "url": "https://github.com/apache/hbase/commit/03cc23389fec71cb8c2fb5ceff3069586f660df7", "message": "rebase and small fix", "committedDate": "2020-04-15T02:54:30Z", "type": "commit"}, {"oid": "03cc23389fec71cb8c2fb5ceff3069586f660df7", "url": "https://github.com/apache/hbase/commit/03cc23389fec71cb8c2fb5ceff3069586f660df7", "message": "rebase and small fix", "committedDate": "2020-04-15T02:54:30Z", "type": "forcePushed"}]}