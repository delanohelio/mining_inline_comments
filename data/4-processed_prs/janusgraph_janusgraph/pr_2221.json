{"pr_number": 2221, "pr_title": "Add grpc server to janusgraph-server", "pr_createdAt": "2020-09-22T20:42:08Z", "pr_url": "https://github.com/JanusGraph/janusgraph/pull/2221", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk4MzkwNA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r497983904", "bodyText": "There is an open issue that says we should try to remove dependencies to guava if possible. If it is easily possible to replace the corresponding code by a different solution, please do so. If not, just ignore this comment.", "author": "rngcntr", "createdAt": "2020-10-01T04:58:14Z", "path": "janusgraph-server/pom.xml", "diffHunk": "@@ -22,6 +24,33 @@\n             <groupId>org.apache.tinkerpop</groupId>\n             <artifactId>gremlin-server</artifactId>\n         </dependency>\n+\n+        <dependency>\n+            <groupId>com.google.guava</groupId>\n+            <artifactId>guava</artifactId>", "originalCommit": "dd71056ba753c3990e010856b1f1e46df815bcf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxNjM3Nw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r500016377", "bodyText": "It will be dependency of grpc.", "author": "farodin91", "createdAt": "2020-10-06T05:38:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk4MzkwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk5MTgzOA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r497991838", "bodyText": "Where do JanusGraphManagerGrpc, JanusGraphManagerImplBase, GetJanusGraphContextRequest, JanusGraphContext and GetJanusGraphContextByGraphNameRequest come from? Although I do see the correlation to the messages in the proto definition for these ones, I can't find the point where this file is referenced.", "author": "rngcntr", "createdAt": "2020-10-01T05:29:58Z", "path": "janusgraph-server/src/main/java/org/janusgraph/graphdb/server/JanusGraphManagerImpl.java", "diffHunk": "@@ -0,0 +1,69 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.graphdb.server;\n+\n+import io.grpc.Status;\n+import io.grpc.stub.StreamObserver;\n+import org.apache.commons.lang.NullArgumentException;\n+import org.apache.tinkerpop.gremlin.server.GraphManager;\n+import org.apache.tinkerpop.gremlin.structure.Graph;\n+import org.janusgraph.core.JanusGraph;\n+\n+public class JanusGraphManagerImpl extends JanusGraphManagerGrpc.JanusGraphManagerImplBase {\n+    private final GraphManager graphManager;\n+\n+    public JanusGraphManagerImpl(GraphManager graphManager) {\n+        this.graphManager = graphManager;\n+    }\n+\n+    @Override\n+    public void getJanusGraphContexts(GetJanusGraphContextsRequest request, StreamObserver<JanusGraphContext> responseObserver) {", "originalCommit": "dd71056ba753c3990e010856b1f1e46df815bcf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwNTk0NA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r498005944", "bodyText": "Alright, @farodin91 says the classes are generated by maven. I never used proto, so is there a way to have the classes compiled and present so the IDE can resolve them?", "author": "rngcntr", "createdAt": "2020-10-01T06:17:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk5MTgzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxNjYwNQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r500016605", "bodyText": "It is done automatically on my site using intellij and maven.", "author": "farodin91", "createdAt": "2020-10-06T05:39:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk5MTgzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwMzI5Ng==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r498003296", "bodyText": "I find it very error-prone to just copy&paste the code from the TinkerPop Settings class here. Especially because SnakeYaml uses Reflection, the compiler will not instantly notice a change in the TinkerPop class and therefore resulting incompatibilities.\nWould it be possible to call super.read(...) and somehow integrate the obtained Settings object into the JanusGraphSettings? This isn't a nice solution either but at least it would not require to duplicate code.", "author": "rngcntr", "createdAt": "2020-10-01T06:09:45Z", "path": "janusgraph-server/src/main/java/org/janusgraph/graphdb/server/JanusGraphSettings.java", "diffHunk": "@@ -0,0 +1,85 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.graphdb.server;\n+\n+import org.apache.tinkerpop.gremlin.server.Settings;\n+import org.yaml.snakeyaml.TypeDescription;\n+import org.yaml.snakeyaml.Yaml;\n+import org.yaml.snakeyaml.constructor.Constructor;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.InputStream;\n+import java.util.Objects;\n+\n+public class JanusGraphSettings extends Settings {\n+    public JanusGraphSettings.GrpcServerSettings grpcServer = new JanusGraphSettings.GrpcServerSettings();\n+\n+    public static class GrpcServerSettings {\n+        public boolean enable = true;\n+        public int port = 10182;\n+    }\n+\n+    public static JanusGraphSettings read(final String file) throws Exception {\n+        InputStream input = new FileInputStream(new File(file));\n+        return read(input);\n+    }\n+\n+    public static JanusGraphSettings read(final InputStream stream) {", "originalCommit": "dd71056ba753c3990e010856b1f1e46df815bcf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxNzYwNQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r500017605", "bodyText": "Yaml fails to parse, if anything is not correctly defined.", "author": "farodin91", "createdAt": "2020-10-06T05:42:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwMzI5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc0ODg5OA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r549748898", "bodyText": "We are now using the default gremlin settings parser.", "author": "farodin91", "createdAt": "2020-12-29T15:36:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwMzI5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwNzEwMg==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r498007102", "bodyText": "You should add more tests which also overwrite the default values.", "author": "rngcntr", "createdAt": "2020-10-01T06:20:26Z", "path": "janusgraph-server/src/test/java/org/janusgraph/graphdb/server/JanusGraphSettingsTest.java", "diffHunk": "@@ -0,0 +1,31 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.graphdb.server;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class JanusGraphSettingsTest {\n+\n+    @Test\n+    public void testGrpcServerDefaultValues() throws Exception {", "originalCommit": "dd71056ba753c3990e010856b1f1e46df815bcf2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwOTY3OA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r498009678", "bodyText": "Nit: These two lines are often repeated so you could move them to a method which then takes the graph name as a parameter and returns the JanusGraphContext.", "author": "rngcntr", "createdAt": "2020-10-01T06:27:39Z", "path": "janusgraph-server/src/test/java/org/janusgraph/graphdb/server/JanusGraphManagerImplTest.java", "diffHunk": "@@ -0,0 +1,136 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.graphdb.server;\n+\n+import io.grpc.ManagedChannel;\n+import io.grpc.Server;\n+import io.grpc.StatusRuntimeException;\n+import io.grpc.inprocess.InProcessChannelBuilder;\n+import io.grpc.inprocess.InProcessServerBuilder;\n+import org.apache.tinkerpop.gremlin.server.GraphManager;\n+import org.apache.tinkerpop.gremlin.server.GremlinServer;\n+import org.apache.tinkerpop.gremlin.server.Settings;\n+import org.apache.tinkerpop.gremlin.server.util.DefaultGraphManager;\n+import org.javatuples.Pair;\n+import org.junit.jupiter.api.Test;\n+\n+import java.io.Closeable;\n+import java.io.IOException;\n+import java.util.*;\n+import java.util.concurrent.TimeUnit;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+public class JanusGraphManagerImplTest {\n+\n+    private GraphManager getGraphManager() {\n+        Settings settings = new Settings();\n+        HashMap<String, String> map = new HashMap<>();\n+        map.put(\"graph\", \"src/test/resources/janusgraph-inmemory.properties\");\n+        map.put(\"graph2\", \"src/test/resources/janusgraph-inmemory.properties\");\n+        map.put(\"tinkergraph\", \"src/test/resources/tinkergraph.properties\");\n+        settings.graphs = map;\n+        return new DefaultGraphManager(settings);\n+    }\n+\n+    private Pair<Server, String> createServer(GraphManager graphManager) throws IOException {\n+        String serverName = InProcessServerBuilder.generateName();\n+        Server server = InProcessServerBuilder\n+            .forName(serverName).directExecutor().addService(new JanusGraphManagerImpl(graphManager)).build().start();\n+        return new Pair<>(server, serverName);\n+    }\n+\n+    private Pair<TestingServerClosable, JanusGraphManagerGrpc.JanusGraphManagerBlockingStub> createServerStub(GraphManager graphManager) throws IOException {\n+        Pair<Server, String> server = createServer(graphManager);\n+        ManagedChannel channel = InProcessChannelBuilder.forName(server.getValue1()).directExecutor().build();\n+        JanusGraphManagerGrpc.JanusGraphManagerBlockingStub stub = JanusGraphManagerGrpc.newBlockingStub(channel);\n+        TestingServerClosable testingServerClosable = new TestingServerClosable(server.getValue0(), channel);\n+        return new Pair<>(testingServerClosable, stub);\n+    }\n+\n+    @Test\n+    public void testContextIsReturnedForGivenGraphName() throws IOException {\n+        GraphManager graphManager = getGraphManager();\n+        Pair<TestingServerClosable, JanusGraphManagerGrpc.JanusGraphManagerBlockingStub> serverStub = createServerStub(graphManager);\n+\n+        JanusGraphContext test = serverStub.getValue1().getJanusGraphContextByGraphName(\n+            GetJanusGraphContextByGraphNameRequest.newBuilder().setGraphName(\"graph\").build());\n+\n+        assertEquals(\"graph\", test.getGraphName());\n+        serverStub.getValue0().close();\n+    }\n+\n+    @Test\n+    public void testErrorIsReturnedForGivenGraphNameWhichIsNotAJanusGraph() throws IOException {\n+        GraphManager graphManager = getGraphManager();\n+        Pair<TestingServerClosable, JanusGraphManagerGrpc.JanusGraphManagerBlockingStub> serverStub = createServerStub(graphManager);\n+\n+        assertThrows(StatusRuntimeException.class, () ->\n+            serverStub.getValue1().getJanusGraphContextByGraphName(\n+                GetJanusGraphContextByGraphNameRequest.newBuilder().setGraphName(\"tinkergraph\").build()));", "originalCommit": "dd71056ba753c3990e010856b1f1e46df815bcf2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMTI4MQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r498011281", "bodyText": "Nit: If this class is only going to be used in JanusGraphManagerImplTest, it can be moved there as a private inner class.", "author": "rngcntr", "createdAt": "2020-10-01T06:32:03Z", "path": "janusgraph-server/src/test/java/org/janusgraph/graphdb/server/TestingServerClosable.java", "diffHunk": "@@ -0,0 +1,44 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.graphdb.server;\n+\n+import io.grpc.ManagedChannel;\n+import io.grpc.Server;\n+\n+import java.io.Closeable;\n+import java.io.IOException;\n+import java.util.concurrent.TimeUnit;\n+\n+public class TestingServerClosable implements Closeable {", "originalCommit": "dd71056ba753c3990e010856b1f1e46df815bcf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMjg3Mg==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r498012872", "bodyText": "I think that will be used for all upcoming test classes for the grpc api.", "author": "farodin91", "createdAt": "2020-10-01T06:36:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMTI4MQ=="}], "type": "inlineReview"}, {"oid": "fecf510ecbf5b76b8adf1ac70bcd4cb844817eda", "url": "https://github.com/JanusGraph/janusgraph/commit/fecf510ecbf5b76b8adf1ac70bcd4cb844817eda", "message": "add test", "committedDate": "2020-10-06T06:20:45Z", "type": "forcePushed"}, {"oid": "abb92f129ba5c7f1113f40773f5bafcf6614b311", "url": "https://github.com/JanusGraph/janusgraph/commit/abb92f129ba5c7f1113f40773f5bafcf6614b311", "message": "add test\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2020-10-07T07:27:02Z", "type": "forcePushed"}, {"oid": "a10e2ab3a3dd5711d6018062e0957b35b90a32b2", "url": "https://github.com/JanusGraph/janusgraph/commit/a10e2ab3a3dd5711d6018062e0957b35b90a32b2", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2020-11-18T10:08:22Z", "type": "forcePushed"}, {"oid": "857c8f1f970a3a277757a83ed576e144baeb98bf", "url": "https://github.com/JanusGraph/janusgraph/commit/857c8f1f970a3a277757a83ed576e144baeb98bf", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2020-12-29T15:34:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMTMzMw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r550231333", "bodyText": "@spmallette Do you have a better idea to extend default gremlin server config by custom values?", "author": "farodin91", "createdAt": "2020-12-30T15:24:56Z", "path": "janusgraph-server/src/main/java/org/janusgraph/graphdb/server/JanusGraphSettings.java", "diffHunk": "@@ -0,0 +1,75 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.graphdb.server;\n+\n+import org.apache.tinkerpop.gremlin.server.Settings;\n+import org.yaml.snakeyaml.TypeDescription;\n+import org.yaml.snakeyaml.Yaml;\n+import org.yaml.snakeyaml.constructor.Constructor;\n+import org.yaml.snakeyaml.representer.Representer;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.FileInputStream;\n+import java.io.InputStream;\n+import java.io.IOException;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+public class JanusGraphSettings {\n+    public JanusGraphSettings.GrpcServerSettings grpcServer = new JanusGraphSettings.GrpcServerSettings();\n+\n+    public static class GrpcServerSettings {\n+        public boolean enable = false;\n+        public int port = 10182;\n+    }\n+    private Settings gremlinSettings;\n+\n+    public Settings GetGremlinSettings() {\n+        return gremlinSettings;\n+    }\n+\n+    public static JanusGraphSettings read(final String file) throws Exception {\n+        InputStream input = new FileInputStream(file);\n+        return read(input);\n+    }\n+\n+    public static JanusGraphSettings read(final InputStream stream) throws IOException {\n+        Objects.requireNonNull(stream);\n+        Constructor constructor = new Constructor(JanusGraphSettings.class);\n+        TypeDescription grpcServerSettings = new TypeDescription(JanusGraphSettings.GrpcServerSettings.class);\n+        constructor.addTypeDescription(grpcServerSettings);\n+        Representer representer = new Representer();\n+        representer.getPropertyUtils().setSkipMissingProperties(true);\n+\n+        String yamlInput = getStringFromInputStream(stream);\n+\n+        Yaml yaml = new Yaml(constructor, representer);\n+        JanusGraphSettings settings = yaml.loadAs(yamlInput, JanusGraphSettings.class);\n+        Yaml yamlMap = new Yaml();\n+        Map<String, Object> obj = yamlMap.load(yamlInput);\n+        obj.remove(\"grpcServer\");\n+        String dump = yamlMap.dump(obj);\n+        settings.gremlinSettings = Settings.read(new ByteArrayInputStream(dump.getBytes()));", "originalCommit": "857c8f1f970a3a277757a83ed576e144baeb98bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI0MDkyMA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r550240920", "bodyText": "I'm not sure. I suppose you've already tried to just extend Settings directly and ran into a wall.  I'm afraid that I don't remember the particulars of snakeyaml and its parsing capabilities.", "author": "spmallette", "createdAt": "2020-12-30T15:54:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMTMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI0NDU5Nw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r550244597", "bodyText": "with:\nRepresenter representer = new Representer();\nrepresenter.getPropertyUtils().setSkipMissingProperties(true);\n\nYou can ignore unkown fields, but Settings doesn't set or allow to set this value.", "author": "farodin91", "createdAt": "2020-12-30T16:05:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMTMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ5NDczMA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r550494730", "bodyText": "Please feel free to propose a change on the TinkerPop dev list if you feel like this area of the code could be made more extensible:\nhttps://lists.apache.org/list.html?dev@tinkerpop.apache.org", "author": "spmallette", "createdAt": "2020-12-31T14:31:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMTMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQ2MDg3MQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r573460871", "bodyText": "@farodin91 Do you want to leave a TODO here and include the link to the proposed change (if you already created a thread on TinkerPop dev list)?", "author": "li-boxuan", "createdAt": "2021-02-10T05:35:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMTMzMw=="}], "type": "inlineReview"}, {"oid": "df368d93129b5bc9e4c50c8a10addf10e61e418a", "url": "https://github.com/JanusGraph/janusgraph/commit/df368d93129b5bc9e4c50c8a10addf10e61e418a", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2020-12-31T12:42:45Z", "type": "forcePushed"}, {"oid": "c8d0a1f562c48bcd2a7d9892575f2f5a91e0a34f", "url": "https://github.com/JanusGraph/janusgraph/commit/c8d0a1f562c48bcd2a7d9892575f2f5a91e0a34f", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-01-04T12:34:31Z", "type": "forcePushed"}, {"oid": "bc6b51e4e1b1c55e0d25fd2ebcb412ed1bbd5221", "url": "https://github.com/JanusGraph/janusgraph/commit/bc6b51e4e1b1c55e0d25fd2ebcb412ed1bbd5221", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-01-06T09:58:03Z", "type": "forcePushed"}, {"oid": "3bce5e9813dbd6f29e06c6d49364dfb6481e247f", "url": "https://github.com/JanusGraph/janusgraph/commit/3bce5e9813dbd6f29e06c6d49364dfb6481e247f", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-01-15T16:54:34Z", "type": "forcePushed"}, {"oid": "2da5c0b4584c04bd0afe4e604517ef98e16e3f52", "url": "https://github.com/JanusGraph/janusgraph/commit/2da5c0b4584c04bd0afe4e604517ef98e16e3f52", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-01-28T11:58:32Z", "type": "forcePushed"}, {"oid": "64c0ebc8a2b0146ef36c2acdd3ea41f6154a34df", "url": "https://github.com/JanusGraph/janusgraph/commit/64c0ebc8a2b0146ef36c2acdd3ea41f6154a34df", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-02-03T13:47:07Z", "type": "forcePushed"}, {"oid": "ab7e4aea1a7a013c6dfff499110f89ff81f16dc0", "url": "https://github.com/JanusGraph/janusgraph/commit/ab7e4aea1a7a013c6dfff499110f89ff81f16dc0", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-02-05T07:24:37Z", "type": "forcePushed"}, {"oid": "9872589fd3c07888cffb2a181b2966d29d5983cb", "url": "https://github.com/JanusGraph/janusgraph/commit/9872589fd3c07888cffb2a181b2966d29d5983cb", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-02-05T07:43:32Z", "type": "forcePushed"}, {"oid": "89edea7b0bd0870a284840ec543d446c111d6735", "url": "https://github.com/JanusGraph/janusgraph/commit/89edea7b0bd0870a284840ec543d446c111d6735", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-02-08T08:39:49Z", "type": "commit"}, {"oid": "89edea7b0bd0870a284840ec543d446c111d6735", "url": "https://github.com/JanusGraph/janusgraph/commit/89edea7b0bd0870a284840ec543d446c111d6735", "message": "Add grpc server to janusgraph-server\n\n* Add basic config parameters to the gremlin-server.yaml\n* Add first server component to get all configured JanusGraph graphNames.\n* Setup protobuf building process\n* Allow testing of new grpc components\n\nPart of #1853\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-02-08T08:39:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjcxMDE2Nw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r572710167", "bodyText": "why 2? Is 1 is reserved for future use?", "author": "li-boxuan", "createdAt": "2021-02-09T09:09:51Z", "path": "janusgraph-server/src/main/proto/graph-manager.proto", "diffHunk": "@@ -0,0 +1,38 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+syntax = \"proto3\";\n+\n+package grpc;\n+\n+option java_multiple_files = true;\n+option java_package = \"org.janusgraph.graphdb.server\";\n+option java_outer_classname = \"GraphManagerProto\";\n+\n+message JanusGraphContext {\n+    string graphName = 1;\n+}\n+\n+message GetJanusGraphContextByGraphNameRequest {\n+    string graphName = 2;", "originalCommit": "89edea7b0bd0870a284840ec543d446c111d6735", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUyMzYzNA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r573523634", "bodyText": "no", "author": "farodin91", "createdAt": "2021-02-10T08:13:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjcxMDE2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQzNTExNA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r573435114", "bodyText": "nitpick: this line is not correctly indented", "author": "li-boxuan", "createdAt": "2021-02-10T04:19:33Z", "path": "janusgraph-server/pom.xml", "diffHunk": "@@ -22,6 +24,39 @@\n             <groupId>org.apache.tinkerpop</groupId>\n             <artifactId>gremlin-server</artifactId>\n         </dependency>\n+\n+        <dependency>\n+            <groupId>com.google.guava</groupId>\n+            <artifactId>guava</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.google.protobuf</groupId>\n+            <artifactId>protobuf-java-util</artifactId>\n+            <version>${protobuf.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.grpc</groupId>\n+            <artifactId>grpc-netty-shaded</artifactId>\n+            <scope>runtime</scope>\n+            <version>${grpc.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.grpc</groupId>\n+            <artifactId>grpc-protobuf</artifactId>\n+            <version>${grpc.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.grpc</groupId>\n+            <artifactId>grpc-stub</artifactId>\n+            <version>${grpc.version}</version>\n+        </dependency>\n+        <dependency> <!-- necessary for Java 9+ -->\n+            <groupId>org.apache.tomcat</groupId>\n+            <artifactId>annotations-api</artifactId>\n+            <version>6.0.53</version>\n+            <scope>provided</scope>\n+          </dependency>", "originalCommit": "89edea7b0bd0870a284840ec543d446c111d6735", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQzOTA2Mg==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r573439062", "bodyText": "Why making them public? Is this a requirement for snakeyaml?", "author": "li-boxuan", "createdAt": "2021-02-10T04:34:17Z", "path": "janusgraph-server/src/main/java/org/janusgraph/graphdb/server/JanusGraphSettings.java", "diffHunk": "@@ -0,0 +1,76 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.graphdb.server;\n+\n+import org.apache.tinkerpop.gremlin.server.Settings;\n+import org.yaml.snakeyaml.TypeDescription;\n+import org.yaml.snakeyaml.Yaml;\n+import org.yaml.snakeyaml.constructor.Constructor;\n+import org.yaml.snakeyaml.representer.Representer;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+public class JanusGraphSettings {\n+    public JanusGraphSettings.GrpcServerSettings grpcServer = new JanusGraphSettings.GrpcServerSettings();\n+\n+    private Settings gremlinSettings;\n+\n+    public static class GrpcServerSettings {\n+        public boolean enable = false;\n+        public int port = 10182;", "originalCommit": "89edea7b0bd0870a284840ec543d446c111d6735", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQ3MzU1OQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r573473559", "bodyText": "\"enabled\" sounds more suitable to me", "author": "li-boxuan", "createdAt": "2021-02-10T06:14:24Z", "path": "janusgraph-server/src/main/java/org/janusgraph/graphdb/server/JanusGraphSettings.java", "diffHunk": "@@ -0,0 +1,76 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.graphdb.server;\n+\n+import org.apache.tinkerpop.gremlin.server.Settings;\n+import org.yaml.snakeyaml.TypeDescription;\n+import org.yaml.snakeyaml.Yaml;\n+import org.yaml.snakeyaml.constructor.Constructor;\n+import org.yaml.snakeyaml.representer.Representer;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+public class JanusGraphSettings {\n+    public JanusGraphSettings.GrpcServerSettings grpcServer = new JanusGraphSettings.GrpcServerSettings();\n+\n+    private Settings gremlinSettings;\n+\n+    public static class GrpcServerSettings {\n+        public boolean enable = false;", "originalCommit": "89edea7b0bd0870a284840ec543d446c111d6735", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQ3NDYwMA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2221#discussion_r573474600", "bodyText": "janusgraph-server-with-server-configs.yaml sounds a bit confusing to me, coz it gives me an illusion that janusgraph-server-with(out)-serializers.yaml does not contain server configs. What about janusgraph-server-with-rpc.yaml?", "author": "li-boxuan", "createdAt": "2021-02-10T06:17:27Z", "path": "janusgraph-server/src/test/java/org/janusgraph/graphdb/server/JanusGraphSettingsTest.java", "diffHunk": "@@ -0,0 +1,52 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.graphdb.server;\n+\n+import org.apache.tinkerpop.gremlin.server.Settings;\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class JanusGraphSettingsTest {\n+\n+    @Test\n+    public void testGrpcServerDefaultValues() throws Exception {\n+        JanusGraphSettings settings = JanusGraphSettings.read(\"src/test/resources/janusgraph-server-without-serializers.yaml\");\n+\n+        assertFalse(settings.grpcServer.enable);\n+        assertEquals(10182, settings.grpcServer.port);\n+    }\n+\n+    @Test\n+    public void testGrpcServerOverwriteDefaultValues() throws Exception {\n+        JanusGraphSettings settings = JanusGraphSettings.read(\"src/test/resources/janusgraph-server-with-server-configs.yaml\");", "originalCommit": "89edea7b0bd0870a284840ec543d446c111d6735", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b4004011363eaf608fb307e8d6c577564c46097", "url": "https://github.com/JanusGraph/janusgraph/commit/3b4004011363eaf608fb307e8d6c577564c46097", "message": "resolve pr comments\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-02-11T11:16:52Z", "type": "forcePushed"}, {"oid": "c0dfc62fa68c1305fef2f99f77ec801ffb209a4f", "url": "https://github.com/JanusGraph/janusgraph/commit/c0dfc62fa68c1305fef2f99f77ec801ffb209a4f", "message": "resolve pr comments\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-02-11T11:41:59Z", "type": "commit"}, {"oid": "c0dfc62fa68c1305fef2f99f77ec801ffb209a4f", "url": "https://github.com/JanusGraph/janusgraph/commit/c0dfc62fa68c1305fef2f99f77ec801ffb209a4f", "message": "resolve pr comments\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2021-02-11T11:41:59Z", "type": "forcePushed"}]}