{"pr_number": 2266, "pr_title": "Move release tests and doc to GitHub Actions", "pr_createdAt": "2020-12-07T07:31:55Z", "pr_url": "https://github.com/JanusGraph/janusgraph/pull/2266", "timeline": [{"oid": "eae096d140727a710fa48374857f10c147a6fb01", "url": "https://github.com/JanusGraph/janusgraph/commit/eae096d140727a710fa48374857f10c147a6fb01", "message": "Move release tests and doc to GitHub Actions\n\nPart of #2260\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2020-12-07T07:42:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537396153", "bodyText": "Does it mean that we now deploy on master branch only? What about v* branches?\nAs I understand we can do something like:\non:\n  push:\n    # Deploy when push to `master` branch and all `v*` branches \n    branches:\n      - master\n      - v*\n\nAnd then we could do something like:\npush:\n    needs: build-doc\n    runs-on: ubuntu-20.04\n    if: github.event_name == 'push'\n    ...\n\nI could be wrong, did research GitHub Actions too much yet but as far as I know the above should work and trigger push on master, v0.5, v0.4, etc.", "author": "porunov", "createdAt": "2020-12-07T10:30:56Z", "path": ".github/workflows/ci-docs.yml", "diffHunk": "@@ -0,0 +1,95 @@\n+# Copyright 2020 JanusGraph Authors\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: CI Docs\n+\n+on:\n+  pull_request:\n+  push:\n+\n+env:\n+  STRUCTOR_VERSION: v1.7.1\n+  BUILD_MAVEN_OPTS: \"-Dmaven.javadoc.skip=true -DskipTests=true --batch-mode --also-make\"\n+  VERIFY_MAVEN_OPTS: \"-Pcoverage\"\n+\n+jobs:\n+  build-all:\n+    runs-on: ubuntu-20.04\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-maven-\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - run: mvn clean install --projects janusgraph-all ${{ env.BUILD_MAVEN_OPTS }}\n+\n+  build-doc:\n+    runs-on: ubuntu-20.04\n+    needs: build-all\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-maven-\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - run: mvn clean install -pl janusgraph-doc ${{ env.BUILD_MAVEN_OPTS }}\n+      - run: git diff  --exit-code docs/basics/janusgraph-cfg.md\n+      - run: docker build -t doc-site:mkdocs -f docs/docs.Dockerfile ./docs\n+      - run: docker run --rm -v $PWD:/mkdocs doc-site:mkdocs mkdocs build\n+      - uses: actions/upload-artifact@v2\n+        if: github.ref != 'ref/head/master'\n+        with:\n+          name: distribution-builds\n+          path: site\n+\n+  deploy-doc:\n+    runs-on: ubuntu-20.04\n+    needs: build-doc\n+    steps: \n+      - uses: actions/checkout@v2\n+        with:\n+          fetch-depth: 0\n+      - run: mkdir ./bin\n+      - run: curl -sfL https://raw.githubusercontent.com/traefik/structor/master/godownloader.sh | bash -s -- -b ./bin ${STRUCTOR_VERSION}\n+      # TODO: change --dockerfile-url=\".../v0.5/docs.Dockerfile\" to --dockerfile-url=\".../master/docs/docs.Dockerfile\"\n+      - run: sudo ./bin/structor -o janusgraph -r janusgraph \n+            --force-edit-url \n+            --rqts-url=\"https://raw.githubusercontent.com/janusgraph/janusgraph/master/requirements.txt\" \n+            --dockerfile-url=\"https://raw.githubusercontent.com/janusgraph/janusgraph/v0.5/docs.Dockerfile\" \n+            --dockerfile-name=\"default-docs.Dockerfile\" \n+            --menu.js-url=\"https://raw.githubusercontent.com/janusgraph/janusgraph/master/docs/theme/structor-menu.js.gotmpl\" \n+            --exp-branch=master --debug\n+      - uses: actions/upload-artifact@v2\n+        if: github.ref != 'ref/head/master'", "originalCommit": "eae096d140727a710fa48374857f10c147a6fb01", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQwNDk2OQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537404969", "bodyText": "My idea is to run the deploy docs just on master.", "author": "farodin91", "createdAt": "2020-12-07T10:44:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQwNzE5Mw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537407193", "bodyText": "Structor solution could run into some issue, if it is running on branches except the master.", "author": "farodin91", "createdAt": "2020-12-07T10:47:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ0NTI2Mw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537445263", "bodyText": "I don't have a strong opinion here but if we run documentation deployment in master branch only, it means that we will not update documentation for older versions if we don't merge that commit in master branch. That said, we usually merge all commits from v* branches into master branch, so, in most cases there will be no problem.\nI'm just curious what has changed in GitHub Actions so that it may run in some issue in other branches. Do you know what issue we may have? Do you know why don't we have that issue with TravisCI but we have it with GitHub Actions?", "author": "porunov", "createdAt": "2020-12-07T11:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ2Njg5Mg==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537466892", "bodyText": "The issue exists before. We had to go through all old branch and update the docker image and TravisCI.\nTo explain the issue:\nThe document will be built and deploy for all branches with on single branch which could lead to deploy the documentation with a old design if we deploy the documentation from old branch. Someone forgot to update the structor version in older branch. We had this already sometime, it can be fixed by triggering master branch again to rebuilt the doc.", "author": "farodin91", "createdAt": "2020-12-07T12:26:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ5MTkxMQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537491911", "bodyText": "Got it. Thank you for the explanation. I think, we could extend it this file later to trigger master documentation build when we push to v* branches. That said, no need to do it right now. What I think, is that it might be better to trigger this workflow only when we push to the necessary branch. I.e. you can see in this PR that we actually triggered [deploy-doc] and we spent more then 2 minutes on that workflow even so we didn't actually push the changes and we didn't actually deployed any documentation for this PR.\nBasically, what I think, is that it's better to not trigger this step at all if it shouldn't be triggered.\nI would still suggest to do it like this: #2266 (comment) . The only thing to change is to remove - v* line. In such case, we will save time not downloading Structor and not doing unnecessary job when it should be skipped.", "author": "porunov", "createdAt": "2020-12-07T13:06:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ5NzQ2NQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537497465", "bodyText": "We could put an if condition to deploy task.\nYou can dispatch events in different workflows or branches.\nI would like to see that docs build is built and can be checked.", "author": "farodin91", "createdAt": "2020-12-07T13:16:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUwNTU1OA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537505558", "bodyText": "I think I was just confused about [deploy-doc] step. I thought this step doesn't b build anything and that [build-doc] is fully responsible for building documentation. Should we move those parts which build documentation to [build-doc] and leave [deploy-doc] with logic just to deploy documentation?\nIf that's problematic or less efficient, I'm fine leaving it as is", "author": "porunov", "createdAt": "2020-12-07T13:28:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUwODQ0NA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537508444", "bodyText": "build-doc builds the documentation without versioning and builds and deploys the doc with versioning.", "author": "farodin91", "createdAt": "2020-12-07T13:33:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxMTAxOQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537511019", "bodyText": "I could change the deploy-doc method to:\n  deploy-doc:\n    runs-on: ubuntu-20.04\n    if: github.ref == 'ref/head/master'\n    needs: build-doc\n    steps: \n      - uses: actions/checkout@v2\n        with:\n          fetch-depth: 0\n      - run: mkdir ./bin\n      - run: curl -sfL https://raw.githubusercontent.com/traefik/structor/master/godownloader.sh | bash -s -- -b ./bin ${STRUCTOR_VERSION}\n      # TODO: change --dockerfile-url=\".../v0.5/docs.Dockerfile\" to --dockerfile-url=\".../master/docs/docs.Dockerfile\"\n      - run: sudo ./bin/structor -o janusgraph -r janusgraph \n            --force-edit-url \n            --rqts-url=\"https://raw.githubusercontent.com/janusgraph/janusgraph/master/requirements.txt\" \n            --dockerfile-url=\"https://raw.githubusercontent.com/janusgraph/janusgraph/v0.5/docs.Dockerfile\" \n            --dockerfile-name=\"default-docs.Dockerfile\" \n            --menu.js-url=\"https://raw.githubusercontent.com/janusgraph/janusgraph/master/docs/theme/structor-menu.js.gotmpl\" \n            --exp-branch=master --debug\n      - uses: JamesIves/github-pages-deploy-action@3.7.1\n        with:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n          REPOSITORY_NAME: JanusGraph/docs.janusgraph.org\n          BRANCH: master\n          FOLDER: site\n          SINGLE_COMMIT: true", "author": "farodin91", "createdAt": "2020-12-07T13:37:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwNTUzOQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r537905539", "bodyText": "I don't have strong preference here. I'm fine with either of the solutions. If deploy-doc should be executed to verify documentation build works correctly, I'm good with it.", "author": "porunov", "createdAt": "2020-12-07T23:16:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA2NjE3Mw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r538066173", "bodyText": "I would change it if it has run in the master branch once.", "author": "farodin91", "createdAt": "2020-12-08T06:23:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5NjE1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE0OTU5Mg==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r539149592", "bodyText": "(nitpick) tinkerpop -> TinkerPop", "author": "FlorianHockmann", "createdAt": "2020-12-09T09:34:28Z", "path": "RELEASING.md", "diffHunk": "@@ -197,7 +197,7 @@ git tag -a v0.3.2 -m \"\"\n #### Create the Pull Request\n \n Open up pull requests for the version updates.\n-It is recommended to add `[full build]` to the commit message so the full suite of compatibility tests will run.\n+It is recommended to add `[tp-tests]` to the commit message so the tinkerpop test suite will run.", "originalCommit": "eae096d140727a710fa48374857f10c147a6fb01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MDcyMA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r539150720", "bodyText": "Looks like this should be ci-docs.yml.", "author": "FlorianHockmann", "createdAt": "2020-12-09T09:36:03Z", "path": ".github/workflows/ci-release.yml", "diffHunk": "@@ -0,0 +1,105 @@\n+# Copyright 2020 JanusGraph Authors\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: CI Release\n+\n+on:\n+  pull_request:\n+    paths-ignore:\n+    - 'docs/**'\n+    - '.github/workflows/build-deploy-doc.yml'", "originalCommit": "eae096d140727a710fa48374857f10c147a6fb01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE5MDYyNQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r539190625", "bodyText": "These are not uploaded on master because we deploy them there completely?", "author": "FlorianHockmann", "createdAt": "2020-12-09T10:31:57Z", "path": ".github/workflows/ci-docs.yml", "diffHunk": "@@ -0,0 +1,95 @@\n+# Copyright 2020 JanusGraph Authors\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: CI Docs\n+\n+on:\n+  pull_request:\n+  push:\n+\n+env:\n+  STRUCTOR_VERSION: v1.7.1\n+  BUILD_MAVEN_OPTS: \"-Dmaven.javadoc.skip=true -DskipTests=true --batch-mode --also-make\"\n+  VERIFY_MAVEN_OPTS: \"-Pcoverage\"\n+\n+jobs:\n+  build-all:\n+    runs-on: ubuntu-20.04\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-maven-\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - run: mvn clean install --projects janusgraph-all ${{ env.BUILD_MAVEN_OPTS }}\n+\n+  build-doc:\n+    runs-on: ubuntu-20.04\n+    needs: build-all\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-maven-\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - run: mvn clean install -pl janusgraph-doc ${{ env.BUILD_MAVEN_OPTS }}\n+      - run: git diff  --exit-code docs/basics/janusgraph-cfg.md\n+      - run: docker build -t doc-site:mkdocs -f docs/docs.Dockerfile ./docs\n+      - run: docker run --rm -v $PWD:/mkdocs doc-site:mkdocs mkdocs build\n+      - uses: actions/upload-artifact@v2\n+        if: github.ref != 'ref/head/master'", "originalCommit": "eae096d140727a710fa48374857f10c147a6fb01", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE5ODIzMw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r539198233", "bodyText": "We deploy the documentation on the master. I think their is no reason store the artefacts.", "author": "farodin91", "createdAt": "2020-12-09T10:42:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE5MDYyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE5MTQ2MQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r539191461", "bodyText": "(nitpick) The variable STRUCTOR_VERSION can now also be removed completely.", "author": "FlorianHockmann", "createdAt": "2020-12-09T10:33:06Z", "path": ".travis.yml", "diffHunk": "@@ -154,42 +147,6 @@ jobs:\n                 -i janusgraph/analysis;\n       if: branch = coverity_scan\n \n-    - stage: documentation\n-      install: docker build -t doc-site:mkdocs -f docs.Dockerfile .\n-      script:\n-        - echo \"Updating configuration markdown\";\n-          mvn --quiet clean install -DskipTests=true -pl janusgraph-doc -am;\n-        - echo \"Check for changes in configuration\";\n-          git diff  --exit-code docs/basics/janusgraph-cfg.md;\n-        - docker run --rm -v $PWD:/mkdocs doc-site:mkdocs mkdocs build\n-\n-    - stage: deploy\n-      install: skip\n-      script: skip\n-      before_deploy:\n-        - echo \"Download documentation generator\";\n-          curl -sfL https://raw.githubusercontent.com/containous/structor/master/godownloader.sh | bash -s -- -b $GOPATH/bin ${STRUCTOR_VERSION}", "originalCommit": "eae096d140727a710fa48374857f10c147a6fb01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b3333c9c54517df88d23cae833c58f0c65b7d00", "url": "https://github.com/JanusGraph/janusgraph/commit/3b3333c9c54517df88d23cae833c58f0c65b7d00", "message": "Move release tests and doc to GitHub Actions\n\nPart of #2260\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2020-12-09T12:12:02Z", "type": "commit"}, {"oid": "3b3333c9c54517df88d23cae833c58f0c65b7d00", "url": "https://github.com/JanusGraph/janusgraph/commit/3b3333c9c54517df88d23cae833c58f0c65b7d00", "message": "Move release tests and doc to GitHub Actions\n\nPart of #2260\n\nSigned-off-by: Jan Jansen <jan.jansen@gdata.de>", "committedDate": "2020-12-09T12:12:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk5NzU0NQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r539997545", "bodyText": "When should we change this url? Why not to change it right now? This PR is targeting master branch", "author": "porunov", "createdAt": "2020-12-10T09:12:09Z", "path": ".github/workflows/ci-docs.yml", "diffHunk": "@@ -0,0 +1,90 @@\n+# Copyright 2020 JanusGraph Authors\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: CI Docs\n+\n+on:\n+  pull_request:\n+  push:\n+\n+env:\n+  STRUCTOR_VERSION: v1.7.1\n+  BUILD_MAVEN_OPTS: \"-Dmaven.javadoc.skip=true -DskipTests=true --batch-mode --also-make\"\n+  VERIFY_MAVEN_OPTS: \"-Pcoverage\"\n+\n+jobs:\n+  build-all:\n+    runs-on: ubuntu-20.04\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-maven-\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - run: mvn clean install --projects janusgraph-all ${{ env.BUILD_MAVEN_OPTS }}\n+\n+  build-doc:\n+    runs-on: ubuntu-20.04\n+    needs: build-all\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-maven-\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - run: mvn clean install -pl janusgraph-doc ${{ env.BUILD_MAVEN_OPTS }}\n+      - run: git diff  --exit-code docs/basics/janusgraph-cfg.md\n+      - run: docker build -t doc-site:mkdocs -f docs/docs.Dockerfile ./docs\n+      - run: docker run --rm -v $PWD:/mkdocs doc-site:mkdocs mkdocs build\n+      - uses: actions/upload-artifact@v2\n+        if: github.ref != 'ref/head/master'\n+        with:\n+          name: distribution-builds\n+          path: site\n+\n+  deploy-doc:\n+    runs-on: ubuntu-20.04\n+    if: github.ref == 'ref/head/master'\n+    needs: build-doc\n+    steps: \n+      - uses: actions/checkout@v2\n+        with:\n+          fetch-depth: 0\n+      - run: mkdir ./bin\n+      - run: curl -sfL https://raw.githubusercontent.com/traefik/structor/master/godownloader.sh | bash -s -- -b ./bin ${STRUCTOR_VERSION}\n+      # TODO: change --dockerfile-url=\".../v0.5/docs.Dockerfile\" to --dockerfile-url=\".../master/docs/docs.Dockerfile\"", "originalCommit": "3b3333c9c54517df88d23cae833c58f0c65b7d00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAzMzMxNw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r540033317", "bodyText": "The file doesn't exists right now in master. It will be create with this PR.", "author": "farodin91", "createdAt": "2020-12-10T10:01:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk5NzU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAzNzU3OQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r540037579", "bodyText": "I didn't research structor flow. I see that the file exists: https://raw.githubusercontent.com/janusgraph/janusgraph/master/docs.Dockerfile\nMaybe I'm just missing something", "author": "porunov", "createdAt": "2020-12-10T10:07:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk5NzU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAzOTAyNw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r540039027", "bodyText": "I think I understand. Most likely we will need to change the URL with a separate PR. I'm good with it", "author": "porunov", "createdAt": "2020-12-10T10:09:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk5NzU0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAwNDg5NQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r540004895", "bodyText": "Should we use master here instead of v0.5?", "author": "porunov", "createdAt": "2020-12-10T09:22:28Z", "path": ".github/workflows/ci-docs.yml", "diffHunk": "@@ -0,0 +1,90 @@\n+# Copyright 2020 JanusGraph Authors\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: CI Docs\n+\n+on:\n+  pull_request:\n+  push:\n+\n+env:\n+  STRUCTOR_VERSION: v1.7.1\n+  BUILD_MAVEN_OPTS: \"-Dmaven.javadoc.skip=true -DskipTests=true --batch-mode --also-make\"\n+  VERIFY_MAVEN_OPTS: \"-Pcoverage\"\n+\n+jobs:\n+  build-all:\n+    runs-on: ubuntu-20.04\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-maven-\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - run: mvn clean install --projects janusgraph-all ${{ env.BUILD_MAVEN_OPTS }}\n+\n+  build-doc:\n+    runs-on: ubuntu-20.04\n+    needs: build-all\n+    steps:\n+      - uses: actions/checkout@v2\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-maven-\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - run: mvn clean install -pl janusgraph-doc ${{ env.BUILD_MAVEN_OPTS }}\n+      - run: git diff  --exit-code docs/basics/janusgraph-cfg.md\n+      - run: docker build -t doc-site:mkdocs -f docs/docs.Dockerfile ./docs\n+      - run: docker run --rm -v $PWD:/mkdocs doc-site:mkdocs mkdocs build\n+      - uses: actions/upload-artifact@v2\n+        if: github.ref != 'ref/head/master'\n+        with:\n+          name: distribution-builds\n+          path: site\n+\n+  deploy-doc:\n+    runs-on: ubuntu-20.04\n+    if: github.ref == 'ref/head/master'\n+    needs: build-doc\n+    steps: \n+      - uses: actions/checkout@v2\n+        with:\n+          fetch-depth: 0\n+      - run: mkdir ./bin\n+      - run: curl -sfL https://raw.githubusercontent.com/traefik/structor/master/godownloader.sh | bash -s -- -b ./bin ${STRUCTOR_VERSION}\n+      # TODO: change --dockerfile-url=\".../v0.5/docs.Dockerfile\" to --dockerfile-url=\".../master/docs/docs.Dockerfile\"\n+      - run: sudo ./bin/structor -o janusgraph -r janusgraph \n+            --force-edit-url \n+            --rqts-url=\"https://raw.githubusercontent.com/janusgraph/janusgraph/master/requirements.txt\" \n+            --dockerfile-url=\"https://raw.githubusercontent.com/janusgraph/janusgraph/v0.5/docs.Dockerfile\" ", "originalCommit": "3b3333c9c54517df88d23cae833c58f0c65b7d00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAzMzYxNQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2266#discussion_r540033615", "bodyText": "Same as above.", "author": "farodin91", "createdAt": "2020-12-10T10:02:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAwNDg5NQ=="}], "type": "inlineReview"}]}