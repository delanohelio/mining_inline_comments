{"pr_number": 2158, "pr_title": "Add optional datastax request logger", "pr_createdAt": "2020-07-06T21:19:02Z", "pr_url": "https://github.com/JanusGraph/janusgraph/pull/2158", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY0OTg3NQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2158#discussion_r450649875", "bodyText": "I thought our policy is to not use a star import.", "author": "farodin91", "createdAt": "2020-07-07T06:59:32Z", "path": "janusgraph-cql/src/main/java/org/janusgraph/diskstorage/cql/CQLStoreManager.java", "diffHunk": "@@ -21,32 +21,7 @@\n import static io.vavr.API.$;\n import static io.vavr.API.Case;\n import static io.vavr.API.Match;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.ATOMIC_BATCH_MUTATE;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.BATCH_STATEMENT_SIZE;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.CLUSTER_NAME;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.ONLY_USE_LOCAL_CONSISTENCY_FOR_SYSTEM_OPERATIONS;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.KEYSPACE;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.LOCAL_CORE_CONNECTIONS_PER_HOST;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.LOCAL_DATACENTER;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.LOCAL_MAX_CONNECTIONS_PER_HOST;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.LOCAL_MAX_REQUESTS_PER_CONNECTION;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.PROTOCOL_VERSION;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.READ_CONSISTENCY;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.REMOTE_CORE_CONNECTIONS_PER_HOST;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.REMOTE_MAX_CONNECTIONS_PER_HOST;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.REMOTE_MAX_REQUESTS_PER_CONNECTION;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.REPLICATION_FACTOR;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.REPLICATION_OPTIONS;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.REPLICATION_STRATEGY;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.SSL_ENABLED;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.SSL_TRUSTSTORE_LOCATION;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.SSL_TRUSTSTORE_PASSWORD;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.SSL_CLIENT_AUTHENTICATION_ENABLED;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.SSL_KEYSTORE_LOCATION;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.SSL_KEYSTORE_KEY_PASSWORD;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.SSL_KEYSTORE_STORE_PASSWORD;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.WRITE_CONSISTENCY;\n-import static org.janusgraph.diskstorage.cql.CQLConfigOptions.USE_EXTERNAL_LOCKING;\n+import static org.janusgraph.diskstorage.cql.CQLConfigOptions.*;", "originalCommit": "005742cdcdc24b8a765407967a920fc722c783e5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY1MTM5OA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2158#discussion_r450651398", "bodyText": "It would be okay to have on default value.", "author": "farodin91", "createdAt": "2020-07-07T07:03:09Z", "path": "janusgraph-cql/src/main/java/org/janusgraph/diskstorage/cql/CQLConfigOptions.java", "diffHunk": "@@ -285,4 +285,44 @@\n             ConfigOption.Type.MASKABLE,\n             String.class);\n \n+    // Query logger\n+    ConfigNamespace QUERY_LOGGER = new ConfigNamespace(\n+        CQL_NS,\n+        \"query-logger\",\n+        \"CQL query logger options\");\n+\n+    ConfigOption<Boolean> QUERY_LOGGER_ENABLED = new ConfigOption<>(\n+        QUERY_LOGGER,\n+        \"enabled\",\n+        \"Registers a query logger with datastax cassandra driver\",\n+        ConfigOption.Type.LOCAL,\n+        false);\n+\n+    ConfigOption<Integer> QUERY_LOGGER_MAX_QUERY_STRING_LENGTH = new ConfigOption<>(\n+        QUERY_LOGGER,\n+        \"max-query-string-length\",\n+        \"Max query string length to be logged when query logger is enabled. Use '-1' to use datastax default value.\",\n+        ConfigOption.Type.LOCAL,\n+        -1);", "originalCommit": "005742cdcdc24b8a765407967a920fc722c783e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY1MjQ1Nw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2158#discussion_r450652457", "bodyText": "https://github.com/JanusGraph/janusgraph/blob/master/janusgraph-core/src/main/java/org/janusgraph/graphdb/configuration/GraphDatabaseConfiguration.java#L394", "author": "farodin91", "createdAt": "2020-07-07T07:05:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY1MTM5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY1Mzk3NQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2158#discussion_r450653975", "bodyText": "You forgot a space in each if.", "author": "farodin91", "createdAt": "2020-07-07T07:09:04Z", "path": "janusgraph-cql/src/main/java/org/janusgraph/diskstorage/cql/CQLStoreManager.java", "diffHunk": "@@ -316,7 +281,35 @@ Cluster initializeCluster() throws PermanentBackendException {\n                     HostDistance.REMOTE,\n                     configuration.get(REMOTE_CORE_CONNECTIONS_PER_HOST),\n                     configuration.get(REMOTE_MAX_CONNECTIONS_PER_HOST));\n-        return builder.withPoolingOptions(poolingOptions).build();\n+\n+        Cluster cluster = builder.withPoolingOptions(poolingOptions).build();\n+\n+        if(configuration.get(QUERY_LOGGER_ENABLED)){", "originalCommit": "005742cdcdc24b8a765407967a920fc722c783e5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f7dfe957b36ab56b94f945881a60ec44f789813f", "url": "https://github.com/JanusGraph/janusgraph/commit/f7dfe957b36ab56b94f945881a60ec44f789813f", "message": "Add optional DataStax request logger\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-11-30T23:21:15Z", "type": "forcePushed"}, {"oid": "5d375eff357e63a855c1210e2dd9867faf465d55", "url": "https://github.com/JanusGraph/janusgraph/commit/5d375eff357e63a855c1210e2dd9867faf465d55", "message": "Add optional DataStax request logger\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-11-30T23:26:16Z", "type": "forcePushed"}, {"oid": "3e6e09098e72ef54b55495f1b758b80bc803744f", "url": "https://github.com/JanusGraph/janusgraph/commit/3e6e09098e72ef54b55495f1b758b80bc803744f", "message": "Add optional DataStax request logger\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-12-02T14:49:20Z", "type": "commit"}, {"oid": "3e6e09098e72ef54b55495f1b758b80bc803744f", "url": "https://github.com/JanusGraph/janusgraph/commit/3e6e09098e72ef54b55495f1b758b80bc803744f", "message": "Add optional DataStax request logger\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-12-02T14:49:20Z", "type": "forcePushed"}]}