{"pr_number": 9731, "pr_title": "MINOR: Make Log.recordVersion private and other small cleanups", "pr_createdAt": "2020-12-11T03:22:18Z", "pr_url": "https://github.com/apache/kafka/pull/9731", "timeline": [{"oid": "496554be115093d4a523b0c0a80e5a579b0f0584", "url": "https://github.com/apache/kafka/commit/496554be115093d4a523b0c0a80e5a579b0f0584", "message": "MINOR: Make Log.recordVersion private and refactor to use the same", "committedDate": "2020-12-11T03:24:43Z", "type": "commit"}, {"oid": "496554be115093d4a523b0c0a80e5a579b0f0584", "url": "https://github.com/apache/kafka/commit/496554be115093d4a523b0c0a80e5a579b0f0584", "message": "MINOR: Make Log.recordVersion private and refactor to use the same", "committedDate": "2020-12-11T03:24:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY2NDUyMQ==", "url": "https://github.com/apache/kafka/pull/9731#discussion_r540664521", "bodyText": "How about replacing messageFormatVersion by recordVersion.value for all usages in this method.", "author": "chia7712", "createdAt": "2020-12-11T03:30:35Z", "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -893,7 +892,7 @@ class Log(@volatile private var _dir: File,\n     // offset (see below). The next time the log is reloaded, we will load producer state using this snapshot\n     // (or later snapshots). Otherwise, if there is no snapshot file, then we have to rebuild producer state\n     // from the first segment.\n-    if (messageFormatVersion < RecordBatch.MAGIC_VALUE_V2 ||\n+    if (recordVersion.value < RecordBatch.MAGIC_VALUE_V2 ||", "originalCommit": "496554be115093d4a523b0c0a80e5a579b0f0584", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY4Mzc4MA==", "url": "https://github.com/apache/kafka/pull/9731#discussion_r540683780", "bodyText": "This was already done. Please let me now if thats not the case.", "author": "kowshik", "createdAt": "2020-12-11T04:33:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY2NDUyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY2NTUxNA==", "url": "https://github.com/apache/kafka/pull/9731#discussion_r540665514", "bodyText": "there is a same issue https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/log/LogCleaner.scala#L456", "author": "chia7712", "createdAt": "2020-12-11T03:33:45Z", "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -1970,7 +1969,6 @@ class Log(@volatile private var _dir: File,\n           baseOffset = newOffset,\n           config,\n           time = time,", "originalCommit": "496554be115093d4a523b0c0a80e5a579b0f0584", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY4MzgwMg==", "url": "https://github.com/apache/kafka/pull/9731#discussion_r540683802", "bodyText": "Done.", "author": "kowshik", "createdAt": "2020-12-11T04:33:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY2NTUxNA=="}], "type": "inlineReview"}, {"oid": "2d2b4a2e732b42397df62da141df30856e5c88db", "url": "https://github.com/apache/kafka/commit/2d2b4a2e732b42397df62da141df30856e5c88db", "message": "Address comments from @chia7712", "committedDate": "2020-12-11T04:32:48Z", "type": "commit"}]}