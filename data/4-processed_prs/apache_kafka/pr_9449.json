{"pr_number": 9449, "pr_title": "MINOR: simplify implementation of ConsumerGroupOperationContext.hasCo\u2026", "pr_createdAt": "2020-10-16T05:06:24Z", "pr_url": "https://github.com/apache/kafka/pull/9449", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYzMDA2Mg==", "url": "https://github.com/apache/kafka/pull/9449#discussion_r507630062", "bodyText": "While the code is cleaner, the error counts map (errorCounts) is re-computed 3 times now. Once in hasCoordinatorMoved and twice in shouldRefreshCoordinator. It would be better if we could get it once and reuse it.", "author": "dajac", "createdAt": "2020-10-19T10:12:03Z", "path": "clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java", "diffHunk": "@@ -3938,25 +3938,15 @@ private Call getAlterConsumerGroupOffsetsCall(ConsumerGroupOperationContext<Map<\n             void handleResponse(AbstractResponse abstractResponse) {\n                 final OffsetCommitResponse response = (OffsetCommitResponse) abstractResponse;\n \n-                // If coordinator changed since we fetched it, retry\n-                if (ConsumerGroupOperationContext.hasCoordinatorMoved(response)) {\n+                // 1) If coordinator changed since we fetched it, retry\n+                // 2) If there is a coordinator error, retry\n+                if (ConsumerGroupOperationContext.hasCoordinatorMoved(response) ||\n+                    ConsumerGroupOperationContext.shouldRefreshCoordinator(response)) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg1MjQ0OA==", "url": "https://github.com/apache/kafka/pull/9449#discussion_r507852448", "bodyText": "You are right!", "author": "chia7712", "createdAt": "2020-10-19T15:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYzMDA2Mg=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "ba3b3e8856317c785956970056d07c2d7d37005d", "url": "https://github.com/apache/kafka/commit/ba3b3e8856317c785956970056d07c2d7d37005d", "message": "MINOR: simplify implementation of ConsumerGroupOperationContext.hasCoordinatorMoved", "committedDate": "2020-10-21T07:13:51Z", "type": "commit"}, {"oid": "784cc3283c1b6a435a170e8ae3e29d15f7cefcad", "url": "https://github.com/apache/kafka/commit/784cc3283c1b6a435a170e8ae3e29d15f7cefcad", "message": "reuse error counts", "committedDate": "2020-10-21T07:13:51Z", "type": "commit"}, {"oid": "784cc3283c1b6a435a170e8ae3e29d15f7cefcad", "url": "https://github.com/apache/kafka/commit/784cc3283c1b6a435a170e8ae3e29d15f7cefcad", "message": "reuse error counts", "committedDate": "2020-10-21T07:13:51Z", "type": "forcePushed"}]}