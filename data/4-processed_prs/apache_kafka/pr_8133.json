{"pr_number": 8133, "pr_title": "MINOR: Fix gradle error writing test stdout", "pr_createdAt": "2020-02-18T17:46:20Z", "pr_url": "https://github.com/apache/kafka/pull/8133", "timeline": [{"oid": "700edd3a0342503ffd7a145355e41f76b886195a", "url": "https://github.com/apache/kafka/commit/700edd3a0342503ffd7a145355e41f76b886195a", "message": "MINOR: Fix gradle error writing test stdout\n\nFix the following message we have been seeing in recent builds:\n\n> ERROR: Failed to write output for test org.apache.kafka.streams.integration\n> .QueryableStateIntegrationTest.shouldBeAbleQueryStandbyStateDuringRebalance\n> java.lang.NullPointerException: Cannot invoke method write() on null object", "committedDate": "2020-02-18T17:41:46Z", "type": "commit"}, {"oid": "11e4948d706181ef91f9834ce09f560e3988335f", "url": "https://github.com/apache/kafka/commit/11e4948d706181ef91f9834ce09f560e3988335f", "message": "update with a (probably better) strategy", "committedDate": "2020-02-18T17:54:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc5NDY4MQ==", "url": "https://github.com/apache/kafka/pull/8133#discussion_r382794681", "bodyText": "The problem with just ignoring here is that we don't really have an explanation for how this can happen. I forget the exact details of what the output was (other than note that it might be \"leftover\" from buggy test runner, and my immediate thought that some could also be from things like static initialization). If anything, we actually might want to log *more info. Aside from potential log size (and noise) I don't remember why I didn't include the toe.message in the exception handler logging below.\nHave we run with that modification to see if it's possible to tell what type of log output is getting lost? We could also change ERROR to WARNING. The main reason I wanted it at the scarier ERROR level was because it was unclear at the time just how frequent it would be, and so there was some indication in the log that some output from some test that was running before that one might have missing log data.\nWe also might not need the stack trace, which adds more noise. I think I included that so if we saw it consistently we could try to track down when this would commonly occur (e.g. if we could track it down to something like static initialization as the common cause).", "author": "ewencp", "createdAt": "2020-02-21T20:38:57Z", "path": "build.gradle", "diffHunk": "@@ -252,7 +252,7 @@ subprojects {\n       // code in the test (best guess is that it is tail output from last test). We won't have\n       // an output file for these, so simply ignore them. If they become critical for debugging,\n       // they can be seen with showStandardStreams.\n-      if (td.name == td.className) {", "originalCommit": "11e4948d706181ef91f9834ce09f560e3988335f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA5ODA0MA==", "url": "https://github.com/apache/kafka/pull/8133#discussion_r384098040", "bodyText": "Hi @ewencp , thanks for the review!\nIt wasn't clear to me that we think it shouldn't happen. With that knowledge, it does seem worthwhile to include some debugging logs to try and understand what is going on.\nFWIW, I like the stacktrace. That's actually the thing that tipped me off that the problem was with the build itself, rather than a test, thereby saving me from hours of digging in the wrong direction.\nI might be an idealist, but I'm not worried about the \"level of noise\", as in \"number of log lines\". The fact is that the build system isn't behaving the way we think it should, so we should try to figure out why. Once we understand why, we'll know what to do, and then we won't have to listen to any more noise.\nI'll update the PR.", "author": "vvcephei", "createdAt": "2020-02-25T20:07:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc5NDY4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzOTQ5Mw==", "url": "https://github.com/apache/kafka/pull/8133#discussion_r384139493", "bodyText": "Yeah, unfortunately iirc it previously looked like Gradle's implementation of this feature was just buggy so might not be completely fixable without figuring out what to fix upstream. I prefer more info as well, but since people already often have trouble finding the real source of issues in long logs, I am a bit hesitant to make them even more voluminous. I think current modification is reasonable tradeoff.", "author": "ewencp", "createdAt": "2020-02-25T21:34:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc5NDY4MQ=="}], "type": "inlineReview"}, {"oid": "f65bc5df51457ec36d90939d8a7cea6fa8cfc07e", "url": "https://github.com/apache/kafka/commit/f65bc5df51457ec36d90939d8a7cea6fa8cfc07e", "message": "add warning", "committedDate": "2020-02-25T20:11:28Z", "type": "commit"}, {"oid": "adb5e71a065148320ad09be18665d432dc507e9b", "url": "https://github.com/apache/kafka/commit/adb5e71a065148320ad09be18665d432dc507e9b", "message": "ignore known cause", "committedDate": "2020-02-25T23:10:08Z", "type": "commit"}, {"oid": "bc87c3339725fde732c6f261637ce87c948c679b", "url": "https://github.com/apache/kafka/commit/bc87c3339725fde732c6f261637ce87c948c679b", "message": "expect the unexpected", "committedDate": "2020-02-26T02:21:05Z", "type": "commit"}]}