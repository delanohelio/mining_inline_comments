{"pr_number": 8453, "pr_title": "KAFKA-9841: Revoke duplicate connectors and tasks when zombie workers return with an outdated assignment", "pr_createdAt": "2020-04-09T07:28:22Z", "pr_url": "https://github.com/apache/kafka/pull/8453", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxMjA2Mw==", "url": "https://github.com/apache/kafka/pull/8453#discussion_r437612063", "bodyText": "The comment is a bit unclear. This code is not causing the duplicated assignment. Is resolving it by revoking redundant tasks. Can we rephrase?", "author": "kkonstantine", "createdAt": "2020-06-09T17:50:37Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/distributed/IncrementalCooperativeAssignor.java", "diffHunk": "@@ -229,6 +229,10 @@ private Long ensureLeaderConfig(long maxOffset, WorkerCoordinator coordinator) {\n         Map<String, ConnectorsAndTasks> toRevoke = computeDeleted(deleted, connectorAssignments, taskAssignments);\n         log.debug(\"Connector and task to delete assignments: {}\", toRevoke);\n \n+        // It may cause some duplicated assignment, when a worker with old generation assignment re-join the group", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4NDUxMg==", "url": "https://github.com/apache/kafka/pull/8453#discussion_r438084512", "bodyText": "Thank you, @kkonstantine. I have rebased the trunk and rephrased the comment. Please have a check.", "author": "Lucent-Wong", "createdAt": "2020-06-10T12:31:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxMjA2Mw=="}], "type": "inlineReview"}, {"oid": "00bacb7d72ba49debf3f1fec979bd3b99ce479d8", "url": "https://github.com/apache/kafka/commit/00bacb7d72ba49debf3f1fec979bd3b99ce479d8", "message": "KAFKA-9841: Connector and Task duplicated when a worker join with old generation assignment\nDetect duplicated connectors/tasks in IncrementalCooperativeAssignor then revoke all of them to trigger next round reassignment.", "committedDate": "2020-06-10T12:22:25Z", "type": "commit"}, {"oid": "76bd2ce316a19da027b632ee80d8856f413ae8a1", "url": "https://github.com/apache/kafka/commit/76bd2ce316a19da027b632ee80d8856f413ae8a1", "message": "KAFKA-9841: Connector and Task duplicated when a worker join with old generation assignment\nfix checkstyle", "committedDate": "2020-06-10T12:22:25Z", "type": "commit"}, {"oid": "76bd2ce316a19da027b632ee80d8856f413ae8a1", "url": "https://github.com/apache/kafka/commit/76bd2ce316a19da027b632ee80d8856f413ae8a1", "message": "KAFKA-9841: Connector and Task duplicated when a worker join with old generation assignment\nfix checkstyle", "committedDate": "2020-06-10T12:22:25Z", "type": "forcePushed"}, {"oid": "1621e8337e157b2c0243b827ecac803171dc43c8", "url": "https://github.com/apache/kafka/commit/1621e8337e157b2c0243b827ecac803171dc43c8", "message": "KAFKA-9841: Rephase the comment and fix the unit test", "committedDate": "2020-06-10T12:29:29Z", "type": "commit"}]}