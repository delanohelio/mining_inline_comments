{"pr_number": 9067, "pr_title": "MINOR: Streams integration tests should not call exit", "pr_createdAt": "2020-07-23T20:43:31Z", "pr_url": "https://github.com/apache/kafka/pull/9067", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI4Mjk1Mg==", "url": "https://github.com/apache/kafka/pull/9067#discussion_r460282952", "bodyText": "Nice one!", "author": "mjsax", "createdAt": "2020-07-24T20:52:57Z", "path": "checkstyle/checkstyle.xml", "diffHunk": "@@ -103,6 +103,13 @@\n       <property name=\"ignoreComments\" value=\"true\"/>\n     </module>\n \n+    <module name=\"Regexp\">\n+      <property name=\"format\" value=\"System\\.exit\"/>\n+      <property name=\"illegalPattern\" value=\"true\"/>\n+      <property name=\"ignoreComments\" value=\"true\"/>\n+      <property name=\"message\" value=\"'System.exit': Should not directly call System.exit, but Exit.exit instead.\"/>", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDMyMjMxOA==", "url": "https://github.com/apache/kafka/pull/9067#discussion_r460322318", "bodyText": "Thank you for this!", "author": "lbradstreet", "createdAt": "2020-07-24T22:59:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI4Mjk1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxNDEyNQ==", "url": "https://github.com/apache/kafka/pull/9067#discussion_r460714125", "bodyText": "It seems really brittle to have line numbers in the suppression. Could we:\n\nRemove the lines part.\nGive a name to the Regexp so that we only exclude the one related to System.exit (not sure if this is possible)", "author": "ijuma", "createdAt": "2020-07-27T08:03:17Z", "path": "checkstyle/suppressions.xml", "diffHunk": "@@ -17,8 +17,14 @@\n               files=\"(ApiMessageType).java|MessageDataGenerator.java\"/>\n     <suppress checks=\"MethodLength\"\n               files=\"MessageDataGenerator.java\"/>\n+    <suppress checks=\"Regexp\"\n+              files=\"MessageGenerator.java\"\n+              lines=\"285,288\"/>\n \n     <!-- Clients -->\n+    <suppress checks=\"Regexp\"\n+              files=\"Exit.java\"\n+              lines=\"43\"/>", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk2NTA4Nw==", "url": "https://github.com/apache/kafka/pull/9067#discussion_r460965087", "bodyText": "I agree, @ijuma , but this is the best I could come up with. Apparently, it's not possible to give it a name, so the only alternative would be to suppress all Regexp checks for this file.", "author": "vvcephei", "createdAt": "2020-07-27T15:13:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxNDEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxNDU0Nw==", "url": "https://github.com/apache/kafka/pull/9067#discussion_r460714547", "bodyText": "I think it was intentional not to use an internal class in demos that others may copy.", "author": "ijuma", "createdAt": "2020-07-27T08:04:06Z", "path": "streams/examples/src/main/java/org/apache/kafka/streams/examples/wordcount/WordCountTransformerDemo.java", "diffHunk": "@@ -153,8 +154,8 @@ public void run() {\n             streams.start();\n             latch.await();\n         } catch (final Throwable e) {\n-            System.exit(1);\n+            Exit.exit(1);\n         }\n-        System.exit(0);\n+        Exit.exit(0);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk2NzE0NQ==", "url": "https://github.com/apache/kafka/pull/9067#discussion_r460967145", "bodyText": "Ok, I can back this change out of the demos. I'd taken an \"agricultural fire\" approach to this, since it seemed like the error was coming from a source I couldn't identify. Namely, the reported error is from the \"unitTest\" task, whereas the only test that would have called \"Sytem.exit\" I could find was in the JUnit IntegrationTest category.", "author": "vvcephei", "createdAt": "2020-07-27T15:16:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxNDU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxNDczMQ==", "url": "https://github.com/apache/kafka/pull/9067#discussion_r460714731", "bodyText": "Did you read the comment immediately above this line? Also applies to VerifiableConsumer.", "author": "ijuma", "createdAt": "2020-07-27T08:04:28Z", "path": "tools/src/main/java/org/apache/kafka/tools/VerifiableProducer.java", "diffHunk": "@@ -241,7 +240,7 @@ public static VerifiableProducer createFromArgs(ArgumentParser parser, String[]\n         } else {\n             parser.printHelp();\n             // Can't use `Exit.exit` here because it didn't exist until 0.11.0.0.\n-            System.exit(0);\n+            Exit.exit(0);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk2NTM5Nw==", "url": "https://github.com/apache/kafka/pull/9067#discussion_r460965397", "bodyText": "Haha, no I didn't. Sorry about that.", "author": "vvcephei", "createdAt": "2020-07-27T15:14:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxNDczMQ=="}], "type": "inlineReview"}, {"oid": "fc8b3f5b3c3212387e431a89dc4ab5a802cd1e76", "url": "https://github.com/apache/kafka/commit/fc8b3f5b3c3212387e431a89dc4ab5a802cd1e76", "message": "MINOR: Streams integration tests should not call exit", "committedDate": "2020-08-05T00:49:56Z", "type": "commit"}, {"oid": "6040882ac70726d6e8edc77462091e7f477fdda1", "url": "https://github.com/apache/kafka/commit/6040882ac70726d6e8edc77462091e7f477fdda1", "message": "replace all System.exit with Exit.exit", "committedDate": "2020-08-05T00:49:56Z", "type": "commit"}, {"oid": "b80077e7b43995eb81b467a7843137a010c51217", "url": "https://github.com/apache/kafka/commit/b80077e7b43995eb81b467a7843137a010c51217", "message": "forbid use of System.exit", "committedDate": "2020-08-05T00:49:56Z", "type": "commit"}, {"oid": "68b2ee1bd78213c0927568169c7526604d02c3b7", "url": "https://github.com/apache/kafka/commit/68b2ee1bd78213c0927568169c7526604d02c3b7", "message": "Github comments:\n - revert using Exit.exit in VerifiableConsumer, VerifyableProducer,\n   Kafka Streams archtype project, and Kafka Streams examples\n - add corresponding checkstyle exceptions", "committedDate": "2020-08-05T00:49:56Z", "type": "commit"}, {"oid": "af1a951e6cbf5f6fa18e83ca1324786f630c0375", "url": "https://github.com/apache/kafka/commit/af1a951e6cbf5f6fa18e83ca1324786f630c0375", "message": "Add rule ID and suppress only single rule for whole files", "committedDate": "2020-08-05T00:49:56Z", "type": "commit"}, {"oid": "ba4c016e1ec1d1046621a77e28e5715d9899740e", "url": "https://github.com/apache/kafka/commit/ba4c016e1ec1d1046621a77e28e5715d9899740e", "message": "Rebased and updated new 2.6 StreamsSmokeTest", "committedDate": "2020-08-05T00:51:06Z", "type": "commit"}]}