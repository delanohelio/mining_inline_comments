{"pr_number": 8527, "pr_title": "Remove dependencies on deprecated --zookeeper command flags in junit tests", "pr_createdAt": "2020-04-22T03:38:27Z", "pr_url": "https://github.com/apache/kafka/pull/8527", "timeline": [{"oid": "9385a654005731670888e74d4efc3be0ad18cc1d", "url": "https://github.com/apache/kafka/commit/9385a654005731670888e74d4efc3be0ad18cc1d", "message": "Splitted unit tests for --zookeeper flag removal", "committedDate": "2020-04-22T03:34:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxMzkwNw==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r413713907", "bodyText": "Hmm.  Do we need this if we have passwordConfigs?", "author": "cmccabe", "createdAt": "2020-04-23T10:50:35Z", "path": "core/src/test/scala/integration/kafka/server/DynamicBrokerReconfigurationTest.scala", "diffHunk": "@@ -1408,13 +1408,23 @@ class DynamicBrokerReconfigurationTest extends ZooKeeperTestHarness with SaslSet\n     sslStoreProps.put(KafkaConfig.PasswordEncoderSecretProp, kafkaConfig.passwordEncoderSecret.map(_.value).orNull)\n     zkClient.makeSurePersistentPathExists(ConfigEntityChangeNotificationZNode.path)\n \n-    val args = Array(\"--zookeeper\", kafkaConfig.zkConnect,\n-      \"--alter\", \"--add-config\", sslStoreProps.asScala.map { case (k, v) => s\"$k=$v\" }.mkString(\",\"),\n-      \"--entity-type\", \"brokers\",\n-      \"--entity-name\", kafkaConfig.brokerId.toString)\n-    ConfigCommand.main(args)\n+    val entityType = ConfigType.Broker\n+    val entityName = kafkaConfig.brokerId.toString\n \n+    val passwordConfigs = sslStoreProps.asScala.keySet.filter(DynamicBrokerConfig.isPasswordConfig)\n+    val passwordEncoderConfigs = new Properties\n+    passwordEncoderConfigs ++= sslStoreProps.asScala.filter { case (key, _) => key.startsWith(\"password.encoder.\") }", "originalCommit": "9385a654005731670888e74d4efc3be0ad18cc1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg0NDA5NQ==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r414844095", "bodyText": "Good catch. Deleted.", "author": "ctan888", "createdAt": "2020-04-24T20:29:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxMzkwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxODg5Mw==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r413718893", "bodyText": "There should be a \"get\" here to ensure that we actually create the partitions before shutting down, right?", "author": "cmccabe", "createdAt": "2020-04-23T10:58:43Z", "path": "core/src/test/scala/unit/kafka/admin/DeleteTopicTest.scala", "diffHunk": "@@ -227,8 +227,10 @@ class DeleteTopicTest extends ZooKeeperTestHarness {\n     }, s\"Not all replicas for topic $topic are in states of either ReplicaDeletionSuccessful or OfflineReplica\")\n \n     // increase the partition count for topic\n-    val topicCommandOptions = new TopicCommand.TopicCommandOptions(Array(\"--zookeeper\", zkConnect, \"--alter\", \"--topic\", topic, \"--partitions\", \"2\"))\n-    new ZookeeperTopicService(zkClient).alterTopic(topicCommandOptions)\n+    val props = new Properties()\n+    props.setProperty(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, TestUtils.getBrokerListStrFromServers(servers))\n+    val adminClient = Admin.create(props)\n+    adminClient.createPartitions(Map(topic -> NewPartitions.increaseTo(2)).asJava)", "originalCommit": "9385a654005731670888e74d4efc3be0ad18cc1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDk0NTI5Nw==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r414945297", "bodyText": "Good catch. Although this will return an API exception (can't increase partition number during topic deletion), we still need to wait for the completion.", "author": "ctan888", "createdAt": "2020-04-25T01:25:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxODg5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxOTg5Mg==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r413719892", "bodyText": "This is a good change since the test is not specifically testing the legacy mode (so it should use the new mode)  Keep this one", "author": "cmccabe", "createdAt": "2020-04-23T11:00:22Z", "path": "core/src/test/scala/unit/kafka/admin/ReassignPartitionsCommandArgsTest.scala", "diffHunk": "@@ -255,7 +225,7 @@ class ReassignPartitionsCommandArgsTest {\n   @Test\n   def shouldNotAllowBrokersListWithVerifyOption(): Unit = {\n     val args = Array(\n-      \"--zookeeper\", \"localhost:1234\",\n+      \"--bootstrap-server\", \"localhost:1234\",", "originalCommit": "9385a654005731670888e74d4efc3be0ad18cc1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDk1Mjk5MA==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r414952990", "bodyText": "ok", "author": "ctan888", "createdAt": "2020-04-25T02:08:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxOTg5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxOTk4Mw==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r413719983", "bodyText": "keep this change", "author": "cmccabe", "createdAt": "2020-04-23T11:00:30Z", "path": "core/src/test/scala/unit/kafka/admin/ReassignPartitionsCommandArgsTest.scala", "diffHunk": "@@ -275,7 +245,7 @@ class ReassignPartitionsCommandArgsTest {\n   @Test\n   def shouldNotAllowTopicsOptionWithVerify(): Unit = {\n     val args = Array(\n-      \"--zookeeper\", \"localhost:1234\",\n+      \"--bootstrap-server\", \"localhost:1234\",", "originalCommit": "9385a654005731670888e74d4efc3be0ad18cc1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDk1MzAxNw==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r414953017", "bodyText": "ok", "author": "ctan888", "createdAt": "2020-04-25T02:08:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxOTk4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMDA2Ng==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r413720066", "bodyText": "keep this change", "author": "cmccabe", "createdAt": "2020-04-23T11:00:37Z", "path": "core/src/test/scala/unit/kafka/admin/ReassignPartitionsCommandArgsTest.scala", "diffHunk": "@@ -265,7 +235,7 @@ class ReassignPartitionsCommandArgsTest {\n   @Test\n   def shouldNotAllowThrottleWithVerifyOption(): Unit = {\n     val args = Array(\n-      \"--zookeeper\", \"localhost:1234\",\n+      \"--bootstrap-server\", \"localhost:1234\",", "originalCommit": "9385a654005731670888e74d4efc3be0ad18cc1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDk1MzAwMw==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r414953003", "bodyText": "ok", "author": "ctan888", "createdAt": "2020-04-25T02:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMDA2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMDk1MA==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r413720950", "bodyText": "It's weird that this is even in this file.  This should be moved to TopicCommandWithZKClientTest.scala, I think", "author": "cmccabe", "createdAt": "2020-04-23T11:02:00Z", "path": "core/src/test/scala/unit/kafka/admin/TopicCommandWithAdminClientTest.scala", "diffHunk": "@@ -293,13 +293,6 @@ class TopicCommandWithAdminClientTest extends KafkaServerTestHarness with Loggin\n     }\n   }\n \n-  @Test\n-  def testCreateWithUnspecifiedReplicationFactorAndPartitionsWithZkClient(): Unit = {", "originalCommit": "9385a654005731670888e74d4efc3be0ad18cc1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDk1NTA4MQ==", "url": "https://github.com/apache/kafka/pull/8527#discussion_r414955081", "bodyText": "Yes. If we are ignoring the tests instead of deleting the tests, we should move this one into TopicCommandWithZKClientTest.scala", "author": "ctan888", "createdAt": "2020-04-25T02:20:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMDk1MA=="}], "type": "inlineReview"}, {"oid": "ccb7bb2d581cd6b3fdfed4bb37af978e1f83134c", "url": "https://github.com/apache/kafka/commit/ccb7bb2d581cd6b3fdfed4bb37af978e1f83134c", "message": "Merge branch 'trunk' into HEAD", "committedDate": "2020-04-24T20:07:58Z", "type": "commit"}, {"oid": "f8f7bdb7381734630d1ce4ff6ffa8e4f56282bbd", "url": "https://github.com/apache/kafka/commit/f8f7bdb7381734630d1ce4ff6ffa8e4f56282bbd", "message": "It gnore the tests instead of deletion", "committedDate": "2020-04-25T02:41:02Z", "type": "commit"}, {"oid": "f8f7bdb7381734630d1ce4ff6ffa8e4f56282bbd", "url": "https://github.com/apache/kafka/commit/f8f7bdb7381734630d1ce4ff6ffa8e4f56282bbd", "message": "It gnore the tests instead of deletion", "committedDate": "2020-04-25T02:41:02Z", "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "ccb7bb2d581cd6b3fdfed4bb37af978e1f83134c", "url": "https://github.com/apache/kafka/commit/ccb7bb2d581cd6b3fdfed4bb37af978e1f83134c", "message": "Merge branch 'trunk' into HEAD", "committedDate": "2020-04-24T20:07:58Z", "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "920eec4c3ab3d7d0a4a9e9d1eaf0762805138301", "url": "https://github.com/apache/kafka/commit/920eec4c3ab3d7d0a4a9e9d1eaf0762805138301", "message": "Remove decorator", "committedDate": "2020-04-30T20:57:14Z", "type": "commit"}, {"oid": "920eec4c3ab3d7d0a4a9e9d1eaf0762805138301", "url": "https://github.com/apache/kafka/commit/920eec4c3ab3d7d0a4a9e9d1eaf0762805138301", "message": "Remove decorator", "committedDate": "2020-04-30T20:57:14Z", "type": "forcePushed"}]}