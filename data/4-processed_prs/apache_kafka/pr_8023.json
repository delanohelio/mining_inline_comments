{"pr_number": 8023, "pr_title": "KAFKA-8507 kip 499 Unify connection name flag for command line tool", "pr_createdAt": "2020-01-31T03:56:40Z", "pr_url": "https://github.com/apache/kafka/pull/8023", "timeline": [{"oid": "fe3cd78161d9c84a3695d362ecb590b4f4d53d9b", "url": "https://github.com/apache/kafka/commit/fe3cd78161d9c84a3695d362ecb590b4f4d53d9b", "message": "update example reassign file to include log_dirs configuration in alignment with KIP-113", "committedDate": "2020-01-29T23:10:52Z", "type": "commit"}, {"oid": "9a84cb1fdffa23ff06151923f65792c1060c8b5a", "url": "https://github.com/apache/kafka/commit/9a84cb1fdffa23ff06151923f65792c1060c8b5a", "message": "KIP-499", "committedDate": "2020-01-31T03:24:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMxODgxMg==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373318812", "bodyText": "Add \"DEPRECATED, use --bootstrap-server instead; ignored if --bootstrap-server is specified\"", "author": "rondagostino", "createdAt": "2020-01-31T05:14:02Z", "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -125,7 +129,11 @@ object ConsoleProducer {\n       .withRequiredArg\n       .describedAs(\"topic\")\n       .ofType(classOf[String])\n-    val brokerListOpt = parser.accepts(\"broker-list\", \"REQUIRED: The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n+    val bootstrapServerOpt = parser.accepts(\"bootstrap-server\", \"REQUIRED: The server(s) to connect to.\")\n+      .withRequiredArg\n+      .describedAs(\"server to connect to\")\n+      .ofType(classOf[String])\n+    val brokerListOpt = parser.accepts(\"broker-list\", \"The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")", "originalCommit": "9a84cb1fdffa23ff06151923f65792c1060c8b5a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMyMDUzNg==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373320536", "bodyText": "You can define bootstrapServerOpt with .requiredUnless(\"broker-list\") as long as you define broker-list first; then the parser will check everything for you automatically.  Also technically not REQUIRED since --broker-list is only being deprecated and not removed.  So probably \"REQUIRED unless --broker-list is specified\" is more accurate.  Also, need to update ConsoleProducerTest to test valid and invalid option combinations.", "author": "rondagostino", "createdAt": "2020-01-31T05:24:34Z", "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -125,7 +129,11 @@ object ConsoleProducer {\n       .withRequiredArg\n       .describedAs(\"topic\")\n       .ofType(classOf[String])\n-    val brokerListOpt = parser.accepts(\"broker-list\", \"REQUIRED: The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n+    val bootstrapServerOpt = parser.accepts(\"bootstrap-server\", \"REQUIRED: The server(s) to connect to.\")\n+      .withRequiredArg", "originalCommit": "9a84cb1fdffa23ff06151923f65792c1060c8b5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyNTkwOQ==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r375825909", "bodyText": "Updated with suggestion", "author": "mitchell-h", "createdAt": "2020-02-06T13:15:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMyMDUzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMyNzc0MA==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373327740", "bodyText": "No need to manually check these if you use .requiredUnless(\"broker-list\").", "author": "rondagostino", "createdAt": "2020-01-31T06:05:39Z", "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -220,11 +228,28 @@ object ConsoleProducer {\n     options = tryParse(parser, args)\n \n     CommandLineUtils.printHelpAndExitIfNeeded(this, \"This tool helps to read data from standard input and publish it to Kafka.\")\n-    CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, brokerListOpt)\n+", "originalCommit": "9a84cb1fdffa23ff06151923f65792c1060c8b5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyNTkzMw==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r375825933", "bodyText": "Updated with requiredUnless", "author": "mitchell-h", "createdAt": "2020-02-06T13:15:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMyNzc0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMyODY2NQ==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373328665", "bodyText": "Probably want to do something like this:\nval brokerHostsAndPorts = options.valueOf(if (options.has(bootstrapServerOpt)) bootstrapServerOpt else brokerListOpt)\nToolsUtils.validatePortOrDie(parser, brokerHostsAndPorts)", "author": "rondagostino", "createdAt": "2020-01-31T06:10:37Z", "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -220,11 +228,28 @@ object ConsoleProducer {\n     options = tryParse(parser, args)\n \n     CommandLineUtils.printHelpAndExitIfNeeded(this, \"This tool helps to read data from standard input and publish it to Kafka.\")\n-    CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, brokerListOpt)\n+\n+    if (!options.has(bootstrapServerOpt) && !options.has(brokerListOpt))\n+      CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, bootstrapServerOpt)\n+\n+    if (options.has(bootstrapServerOpt))\n+      CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, bootstrapServerOpt)\n+\n+    if (options.has(brokerListOpt))\n+      CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, brokerListOpt)\n+\n \n     val topic = options.valueOf(topicOpt)\n+\n+    val bootstrapServer = options.valueOf(bootstrapServerOpt)", "originalCommit": "9a84cb1fdffa23ff06151923f65792c1060c8b5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyNTk5Ng==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r375825996", "bodyText": "Updated with suggestion", "author": "mitchell-h", "createdAt": "2020-02-06T13:15:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMyODY2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc1Mzc0Mg==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373753742", "bodyText": "We also want to deprecate the old options. Typically we just prefix the description with DEPRECATED. See for example, the --zookeeper argument use in TopicCommand. We could also print a warning, but it may be overkill.", "author": "hachikuji", "createdAt": "2020-02-01T03:10:28Z", "path": "tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java", "diffHunk": "@@ -503,10 +503,17 @@ private static ArgumentParser argParser() {\n                 .newArgumentParser(\"verifiable-consumer\")\n                 .defaultHelp(true)\n                 .description(\"This tool consumes messages from a specific topic and emits consumer events (e.g. group rebalances, received messages, and offsets committed) as JSON objects to STDOUT.\");\n+        parser.addArgument(\"--bootstrap-server\")", "originalCommit": "9a84cb1fdffa23ff06151923f65792c1060c8b5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwMjM5MQ==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r376802391", "bodyText": "Updated", "author": "mitchell-h", "createdAt": "2020-02-09T17:59:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc1Mzc0Mg=="}], "type": "inlineReview"}, {"oid": "7e44ecdc07e086ac89897688bc524d6ee788d307", "url": "https://github.com/apache/kafka/commit/7e44ecdc07e086ac89897688bc524d6ee788d307", "message": "KIP-499 - Updated inline with commit comments.  Added requiredUnless options.  simplified validateOrDie logic.", "committedDate": "2020-02-04T23:59:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgzODgwOA==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r375838808", "bodyText": "The document \"The broker list string in the form HOST1:PORT1,HOST2:PORT2.\" is useful to terminal user. Could we keep it?", "author": "chia7712", "createdAt": "2020-02-06T13:41:25Z", "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -125,10 +129,15 @@ object ConsoleProducer {\n       .withRequiredArg\n       .describedAs(\"topic\")\n       .ofType(classOf[String])\n-    val brokerListOpt = parser.accepts(\"broker-list\", \"REQUIRED: The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n+    val brokerListOpt = parser.accepts(\"broker-list\", \"DEPRECATED, use --bootstrap-server instead; ignored if --bootstrap-server is specified.  The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n       .withRequiredArg\n       .describedAs(\"broker-list\")\n       .ofType(classOf[String])\n+    val bootstrapServerOpt = parser.accepts(\"bootstrap-server\", \"REQUIRED unless --broker-list(deprecated) is specified. The server(s) to connect to.\")", "originalCommit": "7e44ecdc07e086ac89897688bc524d6ee788d307", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwMjgxOQ==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r376802819", "bodyText": "Fixed and updated.  Thanks.", "author": "mitchell-h", "createdAt": "2020-02-09T18:05:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgzODgwOA=="}], "type": "inlineReview"}, {"oid": "359190fc37d337a37243657827b26b4000ea569d", "url": "https://github.com/apache/kafka/commit/359190fc37d337a37243657827b26b4000ea569d", "message": "Updated /docs to use `kafka-console-producer --bootstrap-server` instead of --broker-list\n\nadded 'The broker list string in the form HOST1:PORT1,HOST2:PORT2' to command line usage for kafka-console-producer", "committedDate": "2020-02-09T18:05:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMyOTA3Mg==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r378329072", "bodyText": "Should we also add The broker list string in the form HOST1:PORT1,HOST2:PORT2. to this message?", "author": "stanislavkozlovski", "createdAt": "2020-02-12T15:35:35Z", "path": "core/src/main/scala/kafka/tools/ConsumerPerformance.scala", "diffHunk": "@@ -202,9 +203,14 @@ object ConsumerPerformance extends LazyLogging {\n   }\n \n   class ConsumerPerfConfig(args: Array[String]) extends PerfConfig(args) {\n-    val bootstrapServersOpt = parser.accepts(\"broker-list\", \"REQUIRED: The server(s) to connect to.\")\n-      .withRequiredArg()\n-      .describedAs(\"host\")\n+    val brokerListOpt = parser.accepts(\"broker-list\", \"DEPRECATED, use --bootstrap-server instead; ignored if --bootstrap-server is specified.  The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n+      .withRequiredArg\n+      .describedAs(\"broker-list\")\n+      .ofType(classOf[String])\n+    val bootstrapServerOpt = parser.accepts(\"bootstrap-server\", \"REQUIRED unless --broker-list(deprecated) is specified. The server(s) to connect to.\")", "originalCommit": "359190fc37d337a37243657827b26b4000ea569d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMyOTQ3Mw==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r378329473", "bodyText": "nit: camelCase naming would be bootstrapServerValidArgs", "author": "stanislavkozlovski", "createdAt": "2020-02-12T15:36:07Z", "path": "core/src/test/scala/unit/kafka/tools/ConsoleProducerTest.scala", "diffHunk": "@@ -37,20 +37,45 @@ class ConsoleProducerTest {\n     \"--property\",\n     \"key.separator=#\"\n   )\n-\n+  val bootStrapServerValidArgs: Array[String] = Array(", "originalCommit": "359190fc37d337a37243657827b26b4000ea569d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMyOTY3NQ==", "url": "https://github.com/apache/kafka/pull/8023#discussion_r378329675", "bodyText": "nit: ditto on the camel case", "author": "stanislavkozlovski", "createdAt": "2020-02-12T15:36:27Z", "path": "core/src/test/scala/unit/kafka/tools/ConsoleProducerTest.scala", "diffHunk": "@@ -37,20 +37,45 @@ class ConsoleProducerTest {\n     \"--property\",\n     \"key.separator=#\"\n   )\n-\n+  val bootStrapServerValidArgs: Array[String] = Array(\n+    \"--bootstrap-server\",\n+    \"localhost:1003,localhost:1004\",\n+    \"--topic\",\n+    \"t3\",\n+    \"--property\",\n+    \"parse.key=true\",\n+    \"--property\",\n+    \"key.separator=#\"\n+  )\n   val invalidArgs: Array[String] = Array(\n     \"--t\", // not a valid argument\n     \"t3\"\n   )\n+  val bootStrapserverOverride: Array[String] = Array(", "originalCommit": "359190fc37d337a37243657827b26b4000ea569d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b18d3c6b5be06d2bcd7eb262147cfa0ff17b881", "url": "https://github.com/apache/kafka/commit/6b18d3c6b5be06d2bcd7eb262147cfa0ff17b881", "message": "Fix checkstyle", "committedDate": "2020-02-13T17:32:29Z", "type": "commit"}, {"oid": "11a49210eb9233fef111c9a5ddfefe3588a9addd", "url": "https://github.com/apache/kafka/commit/11a49210eb9233fef111c9a5ddfefe3588a9addd", "message": "Fix test cases in ConsoleProducerTest", "committedDate": "2020-02-13T17:39:16Z", "type": "commit"}]}