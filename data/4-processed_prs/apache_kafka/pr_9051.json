{"pr_number": 9051, "pr_title": "KAFKA-10268: dynamic config like \"--delete-config log.retention.ms\" doesn't work", "pr_createdAt": "2020-07-22T02:42:26Z", "pr_url": "https://github.com/apache/kafka/pull/9051", "timeline": [{"oid": "88226a4d2989c7e23243a120a93d9f5f80d09760", "url": "https://github.com/apache/kafka/commit/88226a4d2989c7e23243a120a93d9f5f80d09760", "message": "KAFKA-10268: dynamic config like \"--delete-config log.retention.ms\" doesn't work\n\nhttps://issues.apache.org/jira/browse/KAFKA-10268\n\nCurrently, ConfigCommand --delete-config API does not restore the config to default value, no matter at broker-level or broker-default level. Besides, Admin.incrementalAlterConfigs API also runs into this problem. This patch fixes it by removing the corresponding config from the newConfig properties when reconfiguring dynamic broker config.", "committedDate": "2020-07-22T02:31:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MDkyMQ==", "url": "https://github.com/apache/kafka/pull/9051#discussion_r458580921", "bodyText": "Shouldn't we also waitForConfigOnServer after the first alteration of the config?", "author": "dajac", "createdAt": "2020-07-22T07:10:18Z", "path": "core/src/test/scala/integration/kafka/server/DynamicBrokerReconfigurationTest.scala", "diffHunk": "@@ -775,6 +775,24 @@ class DynamicBrokerReconfigurationTest extends ZooKeeperTestHarness with SaslSet\n     verifyMarkPartitionsForTruncation()\n   }\n \n+  @Test\n+  def testDefaultValueRestoredAfterDeleteDynamicConfig(): Unit = {\n+    val newProps = new Properties\n+    newProps.put(KafkaConfig.LogRetentionTimeMillisProp, \"100000\")\n+    newProps.put(KafkaConfig.LogFlushIntervalMsProp, \"10000\")\n+    TestUtils.incrementalAlterConfigs(servers, adminClients.head, newProps, perBrokerConfig = false).all.get", "originalCommit": "88226a4d2989c7e23243a120a93d9f5f80d09760", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYxMzk4MA==", "url": "https://github.com/apache/kafka/pull/9051#discussion_r458613980", "bodyText": "Thanks for the comments. We could add but not necessary since we care about the fact that the value for broker-default level should be overwritten by that for broker-level. Does it make sense?", "author": "huxihx", "createdAt": "2020-07-22T08:11:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MDkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI1MjExMw==", "url": "https://github.com/apache/kafka/pull/9051#discussion_r459252113", "bodyText": "That makes sense, thanks.", "author": "dajac", "createdAt": "2020-07-23T07:06:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MDkyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODcwMTQwMQ==", "url": "https://github.com/apache/kafka/pull/9051#discussion_r458701401", "bodyText": "Can we move this into DynamicBrokerReconfigurationTest.testDefaultTopicConfig() and also verify that configs of existing topics have been updated? Or add a topic in this test to verify.", "author": "rajinisivaram", "createdAt": "2020-07-22T10:42:48Z", "path": "core/src/test/scala/integration/kafka/server/DynamicBrokerReconfigurationTest.scala", "diffHunk": "@@ -775,6 +775,24 @@ class DynamicBrokerReconfigurationTest extends ZooKeeperTestHarness with SaslSet\n     verifyMarkPartitionsForTruncation()\n   }\n \n+  @Test\n+  def testDefaultValueRestoredAfterDeleteDynamicConfig(): Unit = {", "originalCommit": "88226a4d2989c7e23243a120a93d9f5f80d09760", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d604a82ff5a73bdd44bd25e312d09fd5442fab63", "url": "https://github.com/apache/kafka/commit/d604a82ff5a73bdd44bd25e312d09fd5442fab63", "message": "addressed rajinisivaram's comments", "committedDate": "2020-07-23T03:10:40Z", "type": "commit"}]}