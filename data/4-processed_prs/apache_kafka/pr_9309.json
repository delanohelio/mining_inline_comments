{"pr_number": 9309, "pr_title": "KAFKA-10503: MockProducer doesn't throw ClassCastException when no", "pr_createdAt": "2020-09-19T14:04:05Z", "pr_url": "https://github.com/apache/kafka/pull/9309", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMjU0MQ==", "url": "https://github.com/apache/kafka/pull/9309#discussion_r497712541", "bodyText": "We should avoid to suppress warning. Seems, you need to add generics to ProducerRecord in L774 to fix it?", "author": "mjsax", "createdAt": "2020-09-30T18:22:05Z", "path": "clients/src/test/java/org/apache/kafka/clients/producer/MockProducerTest.java", "diffHunk": "@@ -765,6 +766,16 @@ public void shouldThrowOnFlushProducerIfProducerIsClosed() {\n             fail(\"Should have thrown as producer is already closed\");\n         } catch (IllegalStateException e) { }\n     }\n+    \n+    @Test\n+    @SuppressWarnings(\"unchecked\")", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg0MDExOA==", "url": "https://github.com/apache/kafka/pull/9309#discussion_r497840118", "bodyText": "Thanks a lot for your review @mjsax\nIf I add generics, bounded type parameters will make compilation fail, as types are checked and incompatible.\nIn fact, the purpose of this enhancement is that MockProducer throws the exception when types are not restricted, wdyt?", "author": "gmunozfe", "createdAt": "2020-09-30T22:39:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMjU0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk5MTIyNA==", "url": "https://github.com/apache/kafka/pull/9309#discussion_r497991224", "bodyText": "Oh, I see. We actually want to pass in an incorrect key-type to get the ClassCastException. So you are right, for this case we cannot specify the generics. Keeping the code as-is and to suppress the warning is fine than. Totally missed this. Thanks for clarifying.", "author": "mjsax", "createdAt": "2020-10-01T05:27:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMjU0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMzIzNQ==", "url": "https://github.com/apache/kafka/pull/9309#discussion_r497713235", "bodyText": "instead of fail we should use ```\nassertThrows(\nClassCastException.class,\n() -> producer.send(record);\n);\n\nFor this case, we can remove the `catch` block below.", "author": "mjsax", "createdAt": "2020-09-30T18:23:22Z", "path": "clients/src/test/java/org/apache/kafka/clients/producer/MockProducerTest.java", "diffHunk": "@@ -765,6 +766,16 @@ public void shouldThrowOnFlushProducerIfProducerIsClosed() {\n             fail(\"Should have thrown as producer is already closed\");\n         } catch (IllegalStateException e) { }\n     }\n+    \n+    @Test\n+    @SuppressWarnings(\"unchecked\")\n+    public void shouldThrowClassCastException() {\n+        try (MockProducer<Integer, String> producer = new MockProducer<>(true, new IntegerSerializer(), new StringSerializer());) {\n+            ProducerRecord record = new ProducerRecord(topic, \"key1\", \"value1\");\n+            producer.send(record);\n+            fail(\"Should have thrown ClassCastException because record cannot be casted with serializers\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg0MDUzMw==", "url": "https://github.com/apache/kafka/pull/9309#discussion_r497840533", "bodyText": "Done, I have followed the same approach that other tests in the same class, but assertThrows is also a good alternative", "author": "gmunozfe", "createdAt": "2020-09-30T22:40:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMzIzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk5MTU0Mg==", "url": "https://github.com/apache/kafka/pull/9309#discussion_r497991542", "bodyText": "Yes, we used an older version of the test libraries and thus existing code uses a different pattern. We just try to use the newer (and better) pattern in new code and migrate existing code lazily to the new pattern.", "author": "mjsax", "createdAt": "2020-10-01T05:28:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMzIzNQ=="}], "type": "inlineReview"}, {"oid": "5bcdb44e764ebe93af78ad8910b549915b9fdd97", "url": "https://github.com/apache/kafka/commit/5bcdb44e764ebe93af78ad8910b549915b9fdd97", "message": "[KAFKA-10503] MockProducer doesn't throw ClassCastException when no\npartition for topic", "committedDate": "2020-09-30T22:33:05Z", "type": "commit"}, {"oid": "5bcdb44e764ebe93af78ad8910b549915b9fdd97", "url": "https://github.com/apache/kafka/commit/5bcdb44e764ebe93af78ad8910b549915b9fdd97", "message": "[KAFKA-10503] MockProducer doesn't throw ClassCastException when no\npartition for topic", "committedDate": "2020-09-30T22:33:05Z", "type": "forcePushed"}]}