{"pr_number": 8169, "pr_title": "KAFKA-9610: Do not throw illegal state when remaining partitions are not empty", "pr_createdAt": "2020-02-25T23:17:33Z", "pr_url": "https://github.com/apache/kafka/pull/8169", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4OTk1Mg==", "url": "https://github.com/apache/kafka/pull/8169#discussion_r384189952", "bodyText": "This doesn't really make sense, onPartitionsRevoked is always called before onAssignment", "author": "ableegoldman", "createdAt": "2020-02-25T23:29:03Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/TaskManager.java", "diffHunk": "@@ -304,8 +304,8 @@ void handleRevocation(final Collection<TopicPartition> revokedPartitions) {\n         }\n \n         if (!remainingPartitions.isEmpty()) {\n-            throw new IllegalStateException(\"Some revoked partitions that do not belong \" +\n-                \"to any tasks remain: \" + remainingPartitions);\n+            log.info(\"The following partitions {} are missing from the task partitions. It is possible that\" +\n+                \"they have been cleaned up by the onAssignment callback\", remainingPartitions);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5MDI5Mw==", "url": "https://github.com/apache/kafka/pull/8169#discussion_r384190293", "bodyText": "Not sure if we want to log as warn or debug though -- hitting this indicates we hit the (likely not that common) race condition, or a bug.", "author": "ableegoldman", "createdAt": "2020-02-25T23:30:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4OTk1Mg=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "67e9be7d1a39e581ba24a00bfc1fd6562d6e65f3", "url": "https://github.com/apache/kafka/commit/67e9be7d1a39e581ba24a00bfc1fd6562d6e65f3", "message": "do not throw illegal state exception for remaining partitions", "committedDate": "2020-02-26T05:23:57Z", "type": "commit"}, {"oid": "98e8f2816533f78e7b0c655694f781a1921fd623", "url": "https://github.com/apache/kafka/commit/98e8f2816533f78e7b0c655694f781a1921fd623", "message": "Revert \"Close the producer only in EOS\"\n\nThis reverts commit db81ce6b7cd31f6b133c044cec6f3a9742573a4e.", "committedDate": "2020-02-26T05:23:57Z", "type": "commit"}, {"oid": "904985357962c26b36350de5969b388aad8b016a", "url": "https://github.com/apache/kafka/commit/904985357962c26b36350de5969b388aad8b016a", "message": "fix wording", "committedDate": "2020-02-26T05:23:57Z", "type": "commit"}, {"oid": "2231605016b4f00196f0e83b222349d7f40ad945", "url": "https://github.com/apache/kafka/commit/2231605016b4f00196f0e83b222349d7f40ad945", "message": "unit test for warning", "committedDate": "2020-02-26T05:23:57Z", "type": "commit"}, {"oid": "4f85b121a482ae2423422d12d96dfe0eeae3c700", "url": "https://github.com/apache/kafka/commit/4f85b121a482ae2423422d12d96dfe0eeae3c700", "message": "Revert \"Revert \"Close the producer only in EOS\"\"\n\nThis reverts commit b87d35f7eeec2a70a10a86ced9e300bccefc8c13.", "committedDate": "2020-02-26T05:23:57Z", "type": "commit"}, {"oid": "4f85b121a482ae2423422d12d96dfe0eeae3c700", "url": "https://github.com/apache/kafka/commit/4f85b121a482ae2423422d12d96dfe0eeae3c700", "message": "Revert \"Revert \"Close the producer only in EOS\"\"\n\nThis reverts commit b87d35f7eeec2a70a10a86ced9e300bccefc8c13.", "committedDate": "2020-02-26T05:23:57Z", "type": "forcePushed"}]}