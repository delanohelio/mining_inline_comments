{"pr_number": 8360, "pr_title": "KAFKA-9768: Fix handling of rest.advertised.listener config", "pr_createdAt": "2020-03-26T01:18:41Z", "pr_url": "https://github.com/apache/kafka/pull/8360", "timeline": [{"oid": "08a03912d201982556dad3327239ef2f2dbd3c19", "url": "https://github.com/apache/kafka/commit/08a03912d201982556dad3327239ef2f2dbd3c19", "message": "KAFKA-9768: Fix handling of rest.advertised.listener config", "committedDate": "2020-03-26T01:13:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwODYzNg==", "url": "https://github.com/apache/kafka/pull/8360#discussion_r398808636", "bodyText": "I see how the names are by-convention of the form {protocol}_{host}{port} and that this technically works. Seems like at a minimum we need a comment (or better yet JavaDoc) that describes why this works and the assumptions it makes.", "author": "rhauch", "createdAt": "2020-03-26T18:43:32Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/RestServer.java", "diffHunk": "@@ -419,7 +419,7 @@ else if (listeners.contains(String.format(\"%s://\", PROTOCOL_HTTPS)))\n     ServerConnector findConnector(String protocol) {\n         for (Connector connector : jettyServer.getConnectors()) {\n             String connectorName = connector.getName();\n-            if (connectorName.startsWith(protocol) && !ADMIN_SERVER_CONNECTOR_NAME.equals(connectorName))\n+            if (connectorName.startsWith(protocol + \"_\") && !ADMIN_SERVER_CONNECTOR_NAME.equals(connectorName))", "originalCommit": "08a03912d201982556dad3327239ef2f2dbd3c19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNzA1Ng==", "url": "https://github.com/apache/kafka/pull/8360#discussion_r398817056", "bodyText": "\ud83d\udc4d for the comment, so we won't have to rediscover this convention in the future.", "author": "kkonstantine", "createdAt": "2020-03-26T18:56:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwODYzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgyOTQ5MQ==", "url": "https://github.com/apache/kafka/pull/8360#discussion_r398829491", "bodyText": "Ack, will address", "author": "C0urante", "createdAt": "2020-03-26T19:16:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwODYzNg=="}], "type": "inlineReview"}, {"oid": "35dd4d2836db7a4c078f78b22fad20ba1480a3f0", "url": "https://github.com/apache/kafka/commit/35dd4d2836db7a4c078f78b22fad20ba1480a3f0", "message": "KAFKA-9768: Add comments on server connector names", "committedDate": "2020-03-26T19:25:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcxNTc4NQ==", "url": "https://github.com/apache/kafka/pull/8360#discussion_r401715785", "bodyText": "Nit: perhaps mention that the order of the listeners config is important:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // correct listener is chosen when http and https are configured and advertised listener is http\n          \n          \n            \n                    // correct listener is chosen when https listener is configured before http listener and advertised listener is http", "author": "rhauch", "createdAt": "2020-04-01T15:43:20Z", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/rest/RestServerTest.java", "diffHunk": "@@ -174,6 +174,14 @@ public void testAdvertisedUri() {\n         config = new DistributedConfig(configMap);\n         server = new RestServer(config);\n         Assert.assertEquals(\"http://my-hostname:8080/\", server.advertisedUrl().toString());\n+\n+        // correct listener is chosen when http and https are configured and advertised listener is http", "originalCommit": "35dd4d2836db7a4c078f78b22fad20ba1480a3f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1MjU3Mg==", "url": "https://github.com/apache/kafka/pull/8360#discussion_r401752572", "bodyText": "Ack, added.", "author": "C0urante", "createdAt": "2020-04-01T16:35:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcxNTc4NQ=="}], "type": "inlineReview"}, {"oid": "be4496b213ffa775c8e4693c023485fa2e96f6a8", "url": "https://github.com/apache/kafka/commit/be4496b213ffa775c8e4693c023485fa2e96f6a8", "message": "KAFKA-9768: Update RestServerTest comment\n\nCo-Authored-By: Randall Hauch <rhauch@gmail.com>", "committedDate": "2020-04-01T16:35:37Z", "type": "commit"}]}