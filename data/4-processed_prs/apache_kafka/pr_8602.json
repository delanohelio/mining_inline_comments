{"pr_number": 8602, "pr_title": "KAFKA-9947; Ensure proper shutdown of components in `TransactionsBounceTest`", "pr_createdAt": "2020-05-02T00:09:24Z", "pr_url": "https://github.com/apache/kafka/pull/8602", "timeline": [{"oid": "0205968a8a25c0f51c33bcea4a9fd99a208ab589", "url": "https://github.com/apache/kafka/commit/0205968a8a25c0f51c33bcea4a9fd99a208ab589", "message": "KAFKA-9947; Ensure proper shutdown of components in `TransactionsBounceTest`", "committedDate": "2020-05-02T00:07:34Z", "type": "commit"}, {"oid": "740dbb0fb893ef1fa3da5e86fe13f7f547671146", "url": "https://github.com/apache/kafka/commit/740dbb0fb893ef1fa3da5e86fe13f7f547671146", "message": "Fix compilation issue", "committedDate": "2020-05-02T01:17:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MDYxNw==", "url": "https://github.com/apache/kafka/pull/8602#discussion_r419160617", "bodyText": "We are now relying on the lifecycle methods to close the producer and consumer. Did you do that to simplify the code, i.e. it has no impact on the behavior of the test?", "author": "ijuma", "createdAt": "2020-05-03T21:09:28Z", "path": "core/src/test/scala/integration/kafka/api/TransactionsBounceTest.scala", "diffHunk": "@@ -130,13 +129,10 @@ class TransactionsBounceTest extends KafkaServerTestHarness {\n         iteration += 1\n       }\n     } finally {\n-      producer.close()\n-      consumer.close()", "originalCommit": "740dbb0fb893ef1fa3da5e86fe13f7f547671146", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU5NTg1NQ==", "url": "https://github.com/apache/kafka/pull/8602#discussion_r419595855", "bodyText": "Yeah, I thought it is a preferred pattern to simplify cleanup a little bit in test cases. It does not change the behavior of the test.", "author": "hachikuji", "createdAt": "2020-05-04T17:17:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MDYxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0MjY3Mg==", "url": "https://github.com/apache/kafka/pull/8602#discussion_r420942672", "bodyText": "I was checking the difference between what we do now and before and noticed that we have this line in the helper method we were using previously:\n\nprops.put(ProducerConfig.REQUEST_TIMEOUT_MS_CONFIG, deliveryTimeoutMs.toString)\n\nThat seems a bit questionable. Should we remove it from that method?", "author": "ijuma", "createdAt": "2020-05-06T16:53:52Z", "path": "core/src/test/scala/integration/kafka/api/TransactionsBounceTest.scala", "diffHunk": "@@ -156,17 +152,26 @@ class TransactionsBounceTest extends KafkaServerTestHarness {\n \n     val expectedValues = (0 until numInputRecords).toSet\n     assertEquals(s\"Missing messages: ${expectedValues -- recordSet}\", expectedValues, recordSet)\n+  }\n \n-    verifyingConsumer.close()\n+  private def createTransactionalProducer(transactionalId: String) = {\n+    val props = new Properties()\n+    props.put(ProducerConfig.ACKS_CONFIG, \"all\")\n+    props.put(ProducerConfig.BATCH_SIZE_CONFIG, \"512\")\n+    props.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG, transactionalId)\n+    props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, \"true\")\n+    createProducer(configOverrides = props)", "originalCommit": "740dbb0fb893ef1fa3da5e86fe13f7f547671146", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0ODg1Mg==", "url": "https://github.com/apache/kafka/pull/8602#discussion_r420948852", "bodyText": "Nice catch. Yeah, let me fix that.", "author": "hachikuji", "createdAt": "2020-05-06T17:03:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0MjY3Mg=="}], "type": "inlineReview"}, {"oid": "ec883189a86bcf5234926a235b92cd4279d65549", "url": "https://github.com/apache/kafka/commit/ec883189a86bcf5234926a235b92cd4279d65549", "message": "Use separate requestTimeout parameter in createTransactionalProducer", "committedDate": "2020-05-06T17:10:29Z", "type": "commit"}, {"oid": "6015bc0fb075cd15a78f00dd1c1f23bd0654fcfa", "url": "https://github.com/apache/kafka/commit/6015bc0fb075cd15a78f00dd1c1f23bd0654fcfa", "message": "Use request timeout consistent with delivery timeout", "committedDate": "2020-05-06T19:22:54Z", "type": "commit"}]}