{"pr_number": 8146, "pr_title": "MINOR: Standby task commit needed when offsets updated", "pr_createdAt": "2020-02-21T01:15:11Z", "pr_url": "https://github.com/apache/kafka/pull/8146", "timeline": [{"oid": "15fb9579d34d815cc8fadcad528ebc3a1c730fb5", "url": "https://github.com/apache/kafka/commit/15fb9579d34d815cc8fadcad528ebc3a1c730fb5", "message": "standby task commit needed", "committedDate": "2020-02-21T01:13:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc0NTk1NA==", "url": "https://github.com/apache/kafka/pull/8146#discussion_r382745954", "bodyText": "offsetSnapshotSinceLastCommit", "author": "abbccdda", "createdAt": "2020-02-21T18:48:11Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StandbyTask.java", "diffHunk": "@@ -42,6 +42,8 @@\n     private final Sensor closeTaskSensor;\n     private final InternalProcessorContext processorContext;\n \n+    private Map<TopicPartition, Long> changelogOffsetSnapshot;", "originalCommit": "15fb9579d34d815cc8fadcad528ebc3a1c730fb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2MjMwNA==", "url": "https://github.com/apache/kafka/pull/8146#discussion_r382762304", "bodyText": "Ack.", "author": "guozhangwang", "createdAt": "2020-02-21T19:24:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc0NTk1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1NzI5MQ==", "url": "https://github.com/apache/kafka/pull/8146#discussion_r382757291", "bodyText": "Should we make a copy of the map, to guard against the state manager implementation?", "author": "vvcephei", "createdAt": "2020-02-21T19:12:42Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StandbyTask.java", "diffHunk": "@@ -125,6 +127,8 @@ public void commit() {\n                 // and the state current offset would be used to checkpoint\n                 stateMgr.checkpoint(Collections.emptyMap());\n \n+                changelogOffsetSnapshot = stateMgr.changelogOffsets();", "originalCommit": "15fb9579d34d815cc8fadcad528ebc3a1c730fb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2MjQwOQ==", "url": "https://github.com/apache/kafka/pull/8146#discussion_r382762409", "bodyText": "Yup, that's a better idea.", "author": "guozhangwang", "createdAt": "2020-02-21T19:24:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1NzI5MQ=="}], "type": "inlineReview"}, {"oid": "e43aa9b7c255bef79a3409173327f8fde1bb35bf", "url": "https://github.com/apache/kafka/commit/e43aa9b7c255bef79a3409173327f8fde1bb35bf", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into KMinor-standby-task-commit", "committedDate": "2020-02-21T19:27:40Z", "type": "commit"}, {"oid": "849d4e0abb262c0a78d7e82004e8b71694d025d6", "url": "https://github.com/apache/kafka/commit/849d4e0abb262c0a78d7e82004e8b71694d025d6", "message": "address comments", "committedDate": "2020-02-21T19:31:38Z", "type": "commit"}, {"oid": "aba2cf0f2cb94b9729aa4bdc2450221f3fd980f4", "url": "https://github.com/apache/kafka/commit/aba2cf0f2cb94b9729aa4bdc2450221f3fd980f4", "message": "fix unit tests", "committedDate": "2020-02-21T20:05:07Z", "type": "commit"}]}