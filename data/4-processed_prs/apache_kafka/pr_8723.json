{"pr_number": 8723, "pr_title": "KIP-569-KAFKA-9494: DescribeConfigsResponse - include additional metadata information", "pr_createdAt": "2020-05-25T08:33:08Z", "pr_url": "https://github.com/apache/kafka/pull/8723", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3MDIxOA==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r431870218", "bodyText": "Should this return UNKNOWN since there may be a type in a new version that the client doesn't know about?", "author": "rajinisivaram", "createdAt": "2020-05-28T14:18:11Z", "path": "clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java", "diffHunk": "@@ -2052,6 +2057,49 @@ void handleFailure(Throwable throwable) {\n         return configSource;\n     }\n \n+    private ConfigEntry.ConfigType configType(DescribeConfigsResponse.ConfigType type) {\n+        if (type == null) {\n+            return ConfigEntry.ConfigType.UNKNOWN;\n+        }\n+\n+        ConfigEntry.ConfigType configType;\n+        switch (type) {\n+            case BOOLEAN:\n+                configType = ConfigEntry.ConfigType.BOOLEAN;\n+                break;\n+            case CLASS:\n+                configType = ConfigEntry.ConfigType.CLASS;\n+                break;\n+            case DOUBLE:\n+                configType = ConfigEntry.ConfigType.DOUBLE;\n+                break;\n+            case INT:\n+                configType = ConfigEntry.ConfigType.INT;\n+                break;\n+            case LIST:\n+                configType = ConfigEntry.ConfigType.LIST;\n+                break;\n+            case LONG:\n+                configType = ConfigEntry.ConfigType.LONG;\n+                break;\n+            case PASSWORD:\n+                configType = ConfigEntry.ConfigType.PASSWORD;\n+                break;\n+            case SHORT:\n+                configType = ConfigEntry.ConfigType.SHORT;\n+                break;\n+            case STRING:\n+                configType = ConfigEntry.ConfigType.STRING;\n+                break;\n+            case UNKNOWN:\n+                configType = ConfigEntry.ConfigType.UNKNOWN;\n+                break;\n+            default:\n+                throw new IllegalArgumentException(\"Unexpected config type \" + type);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE0NTU2OA==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432145568", "bodyText": "hmm.. yes.", "author": "srpanwar-confluent", "createdAt": "2020-05-28T21:54:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3MDIxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3MDg1Mg==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r431870852", "bodyText": "Since this is a public API, we should include this change in the KIP.", "author": "rajinisivaram", "createdAt": "2020-05-28T14:19:06Z", "path": "clients/src/main/java/org/apache/kafka/common/config/AbstractConfig.java", "diffHunk": "@@ -201,6 +201,13 @@ public String getString(String key) {\n         return configKey.type;\n     }\n \n+    public String documentationOf(String key) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE0ODI5NQ==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432148295", "bodyText": "Done https://cwiki.apache.org/confluence/display/KAFKA/KIP-569%3A+DescribeConfigsResponse+-+Update+the+schema+to+include+additional+metadata+information+of+the+field#KIP-569:DescribeConfigsResponse-Updatetheschematoincludeadditionalmetadatainformationofthefield-AbstractConfigClass", "author": "srpanwar-confluent", "createdAt": "2020-05-28T22:00:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3MDg1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4MDI2Nw==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432380267", "bodyText": "We should also send a note to the VOTE thread on the mailing list to mention that the KIP was updated.", "author": "rajinisivaram", "createdAt": "2020-05-29T09:55:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3MDg1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3NTM4OA==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r431875388", "bodyText": "Can we switch over to using the generated DescribeConfigsRequestData class?", "author": "rajinisivaram", "createdAt": "2020-05-28T14:24:59Z", "path": "clients/src/main/java/org/apache/kafka/common/requests/DescribeConfigsRequest.java", "diffHunk": "@@ -43,6 +43,7 @@\n     private static final String RESOURCE_TYPE_KEY_NAME = \"resource_type\";\n     private static final String RESOURCE_NAME_KEY_NAME = \"resource_name\";\n     private static final String CONFIG_NAMES_KEY_NAME = \"config_names\";\n+    private static final String INCLUDE_DOCUMENTATION = \"include_documentation\";", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3NjQwMg==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r431876402", "bodyText": "Same as the request, can we switch over to the generated class?", "author": "rajinisivaram", "createdAt": "2020-05-28T14:26:23Z", "path": "clients/src/main/java/org/apache/kafka/common/requests/DescribeConfigsResponse.java", "diffHunk": "@@ -56,6 +56,8 @@\n     private static final String IS_SENSITIVE_KEY_NAME = \"is_sensitive\";\n     private static final String IS_DEFAULT_KEY_NAME = \"is_default\";\n     private static final String READ_ONLY_KEY_NAME = \"read_only\";\n+    private static final String CONFIG_VALUE_TYPE_KEY_NAME = \"config_value_type\";\n+    private static final String CONFIG_DOCUMENTATION_KEY_NAME = \"config_documentation\";", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3OTY0NQ==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r431879645", "bodyText": "Unrelated to this PR, but since you are updating this file anyway, can you fix the typo in IncludeSynonyms?", "author": "rajinisivaram", "createdAt": "2020-05-28T14:29:51Z", "path": "clients/src/main/resources/common/message/DescribeConfigsRequest.json", "diffHunk": "@@ -32,6 +32,8 @@\n         \"about\": \"The configuration keys to list, or null to list all configuration keys.\" }\n     ]},\n     { \"name\": \"IncludeSynoyms\", \"type\": \"bool\", \"versions\": \"1+\", \"default\": \"false\", \"ignorable\": false,", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg4NDgwOQ==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r431884809", "bodyText": "indentation", "author": "rajinisivaram", "createdAt": "2020-05-28T14:34:58Z", "path": "core/src/main/scala/kafka/server/AdminManager.scala", "diffHunk": "@@ -347,7 +347,7 @@ class AdminManager(val config: KafkaConfig,\n     }\n   }\n \n-  def describeConfigs(resourceToConfigNames: Map[ConfigResource, Option[Set[String]]], includeSynonyms: Boolean): Map[ConfigResource, DescribeConfigsResponse.Config] = {\n+    def describeConfigs(resourceToConfigNames: Map[ConfigResource, Option[Set[String]]], includeSynonyms: Boolean, includeDocumentation: Boolean): Map[ConfigResource, DescribeConfigsResponse.Config] = {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM0MTc5Mg==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432341792", "bodyText": "ConfigType.UNKNOWN instead of null since we use that as the default elsewhere?", "author": "rajinisivaram", "createdAt": "2020-05-29T08:43:20Z", "path": "clients/src/main/java/org/apache/kafka/common/requests/DescribeConfigsResponse.java", "diffHunk": "@@ -248,6 +321,14 @@ public DescribeConfigsResponse(Struct struct) {\n                 String configName = configEntriesStruct.getString(CONFIG_NAME_KEY_NAME);\n                 String configValue = configEntriesStruct.getString(CONFIG_VALUE_KEY_NAME);\n                 boolean isSensitive = configEntriesStruct.getBoolean(IS_SENSITIVE_KEY_NAME);\n+                ConfigType type = null;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM0NTA2Mg==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432345062", "bodyText": "Why is ConfigValue Type ignorable, but Documentation not?", "author": "rajinisivaram", "createdAt": "2020-05-29T08:49:27Z", "path": "clients/src/main/resources/common/message/DescribeConfigsResponse.json", "diffHunk": "@@ -59,7 +59,11 @@\n             \"about\": \"The synonym value.\" },\n           { \"name\": \"Source\", \"type\": \"int8\", \"versions\": \"1+\",\n             \"about\": \"The synonym source.\" }\n-        ]}\n+        ]},\n+        { \"name\": \"ConfigValueType\", \"type\": \"int8\", \"versions\": \"3+\", \"default\": \"0\", \"ignorable\": true,\n+          \"about\": \"The configuration data type. Type can be one of the following values - BOOLEAN, STRING, INT, SHORT, LONG, DOUBLE, LIST, CLASS, PASSWORD\" },\n+        { \"name\": \"Documentation\", \"type\": \"string\", \"versions\": \"3+\", \"nullableVersions\": \"0+\",", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM1Njk4NA==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432356984", "bodyText": "Documentation should be ignorable as well. I'll update the kip.", "author": "srpanwar-confluent", "createdAt": "2020-05-29T09:11:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM0NTA2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM0NTQ1OA==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432345458", "bodyText": "ConfigType.UNKNOWN instead of null?", "author": "rajinisivaram", "createdAt": "2020-05-29T08:50:07Z", "path": "clients/src/test/java/org/apache/kafka/clients/admin/ConfigTest.java", "diffHunk": "@@ -92,6 +92,6 @@ public void shouldImplementToStringProperly() {\n \n     public static ConfigEntry newConfigEntry(String name, String value, ConfigEntry.ConfigSource source, boolean isSensitive,\n                                              boolean isReadOnly, List<ConfigEntry.ConfigSynonym> synonyms) {\n-        return new ConfigEntry(name, value, source, isSensitive, isReadOnly, synonyms);\n+        return new ConfigEntry(name, value, source, isSensitive, isReadOnly, synonyms, null, null);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM0NjQxMA==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432346410", "bodyText": "case _ => UNKNOWN or throw an exception?", "author": "rajinisivaram", "createdAt": "2020-05-29T08:51:47Z", "path": "core/src/main/scala/kafka/server/AdminManager.scala", "diffHunk": "@@ -658,6 +658,26 @@ class AdminManager(val config: KafkaConfig,\n     DynamicBrokerConfig.brokerConfigSynonyms(name, matchListenerOverride = true)\n   }\n \n+  private def brokerDocumentation(name: String): String = {\n+    config.documentationOf(name)\n+  }\n+\n+  private def configResponseType(configType: Option[ConfigDef.Type]): DescribeConfigsResponse.ConfigType = {\n+    if (configType.isEmpty)\n+      DescribeConfigsResponse.ConfigType.UNKNOWN\n+    else configType.get match {\n+      case ConfigDef.Type.BOOLEAN => DescribeConfigsResponse.ConfigType.BOOLEAN\n+      case ConfigDef.Type.STRING => DescribeConfigsResponse.ConfigType.STRING\n+      case ConfigDef.Type.INT => DescribeConfigsResponse.ConfigType.INT\n+      case ConfigDef.Type.SHORT => DescribeConfigsResponse.ConfigType.SHORT\n+      case ConfigDef.Type.LONG => DescribeConfigsResponse.ConfigType.LONG\n+      case ConfigDef.Type.DOUBLE => DescribeConfigsResponse.ConfigType.DOUBLE\n+      case ConfigDef.Type.LIST => DescribeConfigsResponse.ConfigType.LIST\n+      case ConfigDef.Type.CLASS => DescribeConfigsResponse.ConfigType.CLASS\n+      case ConfigDef.Type.PASSWORD => DescribeConfigsResponse.ConfigType.PASSWORD", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM3MDE0NQ==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432370145", "bodyText": "Return UNKNOWN to prevent older clients from breaking", "author": "srpanwar-confluent", "createdAt": "2020-05-29T09:36:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM0NjQxMA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4MjYxNQ==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432382615", "bodyText": "Any reason this is called ConfigValueType here while it is called ConfigType everywhere else?", "author": "rajinisivaram", "createdAt": "2020-05-29T09:59:39Z", "path": "clients/src/main/resources/common/message/DescribeConfigsResponse.json", "diffHunk": "@@ -59,7 +59,11 @@\n             \"about\": \"The synonym value.\" },\n           { \"name\": \"Source\", \"type\": \"int8\", \"versions\": \"1+\",\n             \"about\": \"The synonym source.\" }\n-        ]}\n+        ]},\n+        { \"name\": \"ConfigValueType\", \"type\": \"int8\", \"versions\": \"3+\", \"default\": \"0\", \"ignorable\": true,", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM5OTkwMg==", "url": "https://github.com/apache/kafka/pull/8723#discussion_r432399902", "bodyText": "No, I should have used ConfigType everywhere.", "author": "srpanwar-confluent", "createdAt": "2020-05-29T10:36:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4MjYxNQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "3c104079898cb4b1034d90ba5586557b26d55425", "url": "https://github.com/apache/kafka/commit/3c104079898cb4b1034d90ba5586557b26d55425", "message": "KAFKA-9494 Include additional metadata information in DescribeConfig response", "committedDate": "2020-05-29T18:45:24Z", "type": "commit"}, {"oid": "3c104079898cb4b1034d90ba5586557b26d55425", "url": "https://github.com/apache/kafka/commit/3c104079898cb4b1034d90ba5586557b26d55425", "message": "KAFKA-9494 Include additional metadata information in DescribeConfig response", "committedDate": "2020-05-29T18:45:24Z", "type": "forcePushed"}]}