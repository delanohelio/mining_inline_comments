{"pr_number": 8783, "pr_title": "KAFKA-10063 UnsupportedOperation when querying cleaner metrics after \u2026", "pr_createdAt": "2020-06-02T16:57:36Z", "pr_url": "https://github.com/apache/kafka/pull/8783", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ1Njg5MQ==", "url": "https://github.com/apache/kafka/pull/8783#discussion_r434456891", "bodyText": "a workaround for scala 2.12", "author": "chia7712", "createdAt": "2020-06-03T10:08:11Z", "path": "core/src/main/scala/kafka/log/LogCleaner.scala", "diffHunk": "@@ -112,9 +112,19 @@ class LogCleaner(initialConfig: CleanerConfig,\n \n   private[log] val cleaners = mutable.ArrayBuffer[CleanerThread]()\n \n+  /**\n+   * scala 2.12 does not support maxOption so we handle the empty manually.\n+   * @param f to compute the result\n+   * @return the computed value or 0 if there is no cleaner\n+   */\n+  private def computeCleanerThread(f: Seq[CleanerThread] => Int): Int =", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwMjMwNA==", "url": "https://github.com/apache/kafka/pull/8783#discussion_r436402304", "bodyText": "Maybe we could turn this into a foldLeft and avoid the map. For example:\n  private def maxOverCleanerThreads(f: CleanerThread => Int): Int = {\n    cleaners.foldLeft(0, (acc: Int, thread: CleanerThread) => math.max(acc, f(thread)))\n  }", "author": "hachikuji", "createdAt": "2020-06-07T21:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ1Njg5MQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "6482382c9336970d9042dbc076e60204a79aad6d", "url": "https://github.com/apache/kafka/commit/6482382c9336970d9042dbc076e60204a79aad6d", "message": "KAFKA-10063 UnsupportedOperation when querying cleaner metrics after shutdown", "committedDate": "2020-06-08T06:59:43Z", "type": "commit"}, {"oid": "6482382c9336970d9042dbc076e60204a79aad6d", "url": "https://github.com/apache/kafka/commit/6482382c9336970d9042dbc076e60204a79aad6d", "message": "KAFKA-10063 UnsupportedOperation when querying cleaner metrics after shutdown", "committedDate": "2020-06-08T06:59:43Z", "type": "forcePushed"}]}