{"pr_number": 7886, "pr_title": "KAFKA-9353: Add groupInstanceId to DescribeGroup for better visibility", "pr_createdAt": "2020-01-02T10:20:21Z", "pr_url": "https://github.com/apache/kafka/pull/7886", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0Mjg5MQ==", "url": "https://github.com/apache/kafka/pull/7886#discussion_r368242891", "bodyText": "What do you think about adding this field only if the group instance id is not null?", "author": "hachikuji", "createdAt": "2020-01-18T19:01:37Z", "path": "core/src/main/scala/kafka/admin/ConsumerGroupCommand.scala", "diffHunk": "@@ -249,20 +249,21 @@ object ConsumerGroupCommand extends Logging {\n       for ((groupId, (state, assignments)) <- members) {\n         if (shouldPrintMemberState(groupId, state, size(assignments))) {\n           // find proper columns width\n-          var (maxGroupLen, maxConsumerIdLen, maxHostLen, maxClientIdLen) = (15, 15, 15, 15)\n+          var (maxGroupLen, maxConsumerIdLen, maxGroupInstanceIdLen, maxHostLen, maxClientIdLen) = (15, 15, 17, 15, 15)\n           assignments match {\n             case None => // do nothing\n             case Some(memberAssignments) =>\n               memberAssignments.foreach { memberAssignment =>\n                 maxGroupLen = Math.max(maxGroupLen, memberAssignment.group.length)\n                 maxConsumerIdLen = Math.max(maxConsumerIdLen, memberAssignment.consumerId.length)\n+                maxGroupInstanceIdLen =  Math.max(maxGroupInstanceIdLen, memberAssignment.groupInstanceId.length)\n                 maxHostLen = Math.max(maxHostLen, memberAssignment.host.length)\n                 maxClientIdLen = Math.max(maxClientIdLen, memberAssignment.clientId.length)\n               }\n           }\n \n-          print(s\"\\n%${-maxGroupLen}s %${-maxConsumerIdLen}s %${-maxHostLen}s %${-maxClientIdLen}s %-15s \"\n-            .format(\"GROUP\", \"CONSUMER-ID\", \"HOST\", \"CLIENT-ID\", \"#PARTITIONS\"))\n+          print(s\"\\n%${-maxGroupLen}s %${-maxConsumerIdLen}s %${-maxGroupInstanceIdLen}s %${-maxHostLen}s %${-maxClientIdLen}s %-15s \"", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI2MDgyMQ==", "url": "https://github.com/apache/kafka/pull/7886#discussion_r368260821", "bodyText": "I originally thought about that, but then I realize that group instance id in the same consumer-group may have both null and not null, so I give up.\nI now also think it's better to remove this field if all the group instance id is null, I will change it.", "author": "dengziming", "createdAt": "2020-01-19T02:32:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0Mjg5MQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM3ODg1OQ==", "url": "https://github.com/apache/kafka/pull/7886#discussion_r369378859", "bodyText": "nit: it's a little surprising to see nullGroupInstanceId and groupInstanceId.length in the same expression. I'd expect that to be an NPE if I didn't see how it is called. I think I'd suggest inverting this. Instead of nullGroupInstanceId, how about includeGroupInstanceId? Then this becomes\nincludeGroupInstanceId = includeGroupInstanceId || memberAssignment.groupInstanceId.length > 0", "author": "hachikuji", "createdAt": "2020-01-22T05:44:44Z", "path": "core/src/main/scala/kafka/admin/ConsumerGroupCommand.scala", "diffHunk": "@@ -249,20 +249,27 @@ object ConsumerGroupCommand extends Logging {\n       for ((groupId, (state, assignments)) <- members) {\n         if (shouldPrintMemberState(groupId, state, size(assignments))) {\n           // find proper columns width\n-          var (maxGroupLen, maxConsumerIdLen, maxHostLen, maxClientIdLen) = (15, 15, 15, 15)\n+          var (maxGroupLen, maxConsumerIdLen, maxGroupInstanceIdLen, maxHostLen, maxClientIdLen, nullGroupInstanceId) = (15, 15, 17, 15, 15, true)\n           assignments match {\n             case None => // do nothing\n             case Some(memberAssignments) =>\n               memberAssignments.foreach { memberAssignment =>\n                 maxGroupLen = Math.max(maxGroupLen, memberAssignment.group.length)\n                 maxConsumerIdLen = Math.max(maxConsumerIdLen, memberAssignment.consumerId.length)\n+                maxGroupInstanceIdLen =  Math.max(maxGroupInstanceIdLen, memberAssignment.groupInstanceId.length)\n                 maxHostLen = Math.max(maxHostLen, memberAssignment.host.length)\n                 maxClientIdLen = Math.max(maxClientIdLen, memberAssignment.clientId.length)\n+                nullGroupInstanceId = nullGroupInstanceId && memberAssignment.groupInstanceId.length == 0", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM1MjM2NA==", "url": "https://github.com/apache/kafka/pull/7886#discussion_r373352364", "bodyText": "Hi @hachikuji , thank you for your suggestion, it's very useful to me, done!", "author": "dengziming", "createdAt": "2020-01-31T07:53:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM3ODg1OQ=="}], "type": "inlineReview"}, {"oid": "0f7f75b5a87b9a4a6f81b679270d2dcbfd8728b9", "url": "https://github.com/apache/kafka/commit/0f7f75b5a87b9a4a6f81b679270d2dcbfd8728b9", "message": "KAFKA-9353: Add groupInstanceId to DescribeGroup for better visibility", "committedDate": "2020-01-31T07:51:31Z", "type": "commit"}, {"oid": "0f7f75b5a87b9a4a6f81b679270d2dcbfd8728b9", "url": "https://github.com/apache/kafka/commit/0f7f75b5a87b9a4a6f81b679270d2dcbfd8728b9", "message": "KAFKA-9353: Add groupInstanceId to DescribeGroup for better visibility", "committedDate": "2020-01-31T07:51:31Z", "type": "forcePushed"}]}