{"pr_number": 8359, "pr_title": "KAFKA-9778: Add validateConnector functionality to the EmbeddedConnectCluster", "pr_createdAt": "2020-03-26T01:11:44Z", "pr_url": "https://github.com/apache/kafka/pull/8359", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTUwNA==", "url": "https://github.com/apache/kafka/pull/8359#discussion_r398339504", "bodyText": "minus two lines this method is the same as the above configureConnector. Should we refactor the common parts into a putConnectorConfig method or something?", "author": "kkonstantine", "createdAt": "2020-03-26T06:20:00Z", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/util/clusters/EmbeddedConnectCluster.java", "diffHunk": "@@ -291,6 +293,35 @@ public String configureConnector(String connName, Map<String, String> connConfig\n                 \"Could not execute PUT request. Error response: \" + responseToString(response));\n     }\n \n+    /**\n+     * Validate a given connector configuration. If the configuration validates or\n+     * has a configuration error, an instance of {@link Response} is returned. If the validation fails\n+     * an exception is thrown.\n+     *\n+     * @param connClassName the name of the connector class\n+     * @param connConfig    the intended configuration\n+     * @throws JsonProcessingException if the response failed to deserialize into a {@link ConfigInfos} instance\n+     * @throws ConnectRestException if the REST api returns error status\n+     * @throws ConnectException if the configuration fails to be serialized or if the request could not be sent\n+     */\n+    public ConfigInfos validateConnectorConfig(String connClassName, Map<String, String> connConfig)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcxNzEzMw==", "url": "https://github.com/apache/kafka/pull/8359#discussion_r398717133", "bodyText": "@kkonstantine Yes we could do that, should we make putConnectorConfig a public or private method? If we were to implement the new shared method, I'm thinking it could take a url and a config, and return a type of Response.", "author": "dosvath", "createdAt": "2020-03-26T16:34:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyODgyOQ==", "url": "https://github.com/apache/kafka/pull/8359#discussion_r398928829", "bodyText": "I'd recommend protected, in case we need to subclass in the future.\nAlso, I'd say, let's return a String from responseToString(response) which your new method will parse to get the ConfigInfos object then. Otherwise, it's close to what requestPut does already. wdyt?\nRe: the input arguments, yes I agree, url and config make sense.", "author": "kkonstantine", "createdAt": "2020-03-26T22:24:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1OTgwNg==", "url": "https://github.com/apache/kafka/pull/8359#discussion_r399559806", "bodyText": "I like that approach, updated.", "author": "dosvath", "createdAt": "2020-03-27T22:06:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTUwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTcxNA==", "url": "https://github.com/apache/kafka/pull/8359#discussion_r398339714", "bodyText": "there's responseToString below, which increases the similarities with configureConnector", "author": "kkonstantine", "createdAt": "2020-03-26T06:20:43Z", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/util/clusters/EmbeddedConnectCluster.java", "diffHunk": "@@ -291,6 +293,35 @@ public String configureConnector(String connName, Map<String, String> connConfig\n                 \"Could not execute PUT request. Error response: \" + responseToString(response));\n     }\n \n+    /**\n+     * Validate a given connector configuration. If the configuration validates or\n+     * has a configuration error, an instance of {@link Response} is returned. If the validation fails\n+     * an exception is thrown.\n+     *\n+     * @param connClassName the name of the connector class\n+     * @param connConfig    the intended configuration\n+     * @throws JsonProcessingException if the response failed to deserialize into a {@link ConfigInfos} instance\n+     * @throws ConnectRestException if the REST api returns error status\n+     * @throws ConnectException if the configuration fails to be serialized or if the request could not be sent\n+     */\n+    public ConfigInfos validateConnectorConfig(String connClassName, Map<String, String> connConfig)\n+        throws JsonProcessingException {\n+        String url = endpointForResource(String.format(\"connector-plugins/%s/config/validate\", connClassName));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String content;\n+        try {\n+            content = mapper.writeValueAsString(connConfig);\n+        } catch (IOException e) {\n+            throw new ConnectException(\"Could not serialize connector configuration and execute PUT request\");\n+        }\n+        Response response = requestPut(url, content);\n+        if (response.getStatus() < Response.Status.BAD_REQUEST.getStatusCode()) {\n+            return mapper.readValue(response.getEntity().toString(), ConfigInfos.class);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "84f3375948744ab0a8bb6e726c59ba8f5aafee6f", "url": "https://github.com/apache/kafka/commit/84f3375948744ab0a8bb6e726c59ba8f5aafee6f", "message": "Add validateConnector functionality to the EmbeddedConnectCluster", "committedDate": "2020-03-27T22:07:53Z", "type": "commit"}, {"oid": "84f3375948744ab0a8bb6e726c59ba8f5aafee6f", "url": "https://github.com/apache/kafka/commit/84f3375948744ab0a8bb6e726c59ba8f5aafee6f", "message": "Add validateConnector functionality to the EmbeddedConnectCluster", "committedDate": "2020-03-27T22:07:53Z", "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "d1aefa5e81d118d1f07ef62eb9ac22d8ca409cfe", "url": "https://github.com/apache/kafka/commit/d1aefa5e81d118d1f07ef62eb9ac22d8ca409cfe", "message": "PR Revision - added ConnectException conversion, validateConnectorConfig calls to ExampleConnectIntegrationTest", "committedDate": "2020-03-30T20:44:21Z", "type": "commit"}, {"oid": "d1aefa5e81d118d1f07ef62eb9ac22d8ca409cfe", "url": "https://github.com/apache/kafka/commit/d1aefa5e81d118d1f07ef62eb9ac22d8ca409cfe", "message": "PR Revision - added ConnectException conversion, validateConnectorConfig calls to ExampleConnectIntegrationTest", "committedDate": "2020-03-30T20:44:21Z", "type": "forcePushed"}, {"oid": "76a44f847fc3393285b1963148c1ac1aae6d7717", "url": "https://github.com/apache/kafka/commit/76a44f847fc3393285b1963148c1ac1aae6d7717", "message": "PR Revision - Made error message more specific", "committedDate": "2020-03-30T22:00:48Z", "type": "commit"}, {"oid": "8e1a99aed98c592fa36f421f17c6da1f474a4cef", "url": "https://github.com/apache/kafka/commit/8e1a99aed98c592fa36f421f17c6da1f474a4cef", "message": "PR Revision - Added comments to ExampleConnectIntegrationTest", "committedDate": "2020-03-30T22:32:32Z", "type": "commit"}, {"oid": "3806b914e1a07c1b9818fa66cf4700760cc968e0", "url": "https://github.com/apache/kafka/commit/3806b914e1a07c1b9818fa66cf4700760cc968e0", "message": "PR Revision - Unused imports, whitespace fixes", "committedDate": "2020-03-31T17:39:51Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "45ec78a919d6220521b55ca63582d365664b85c1", "url": "https://github.com/apache/kafka/commit/45ec78a919d6220521b55ca63582d365664b85c1", "message": "PR revision - Added EmbeddedConnectClusterAssertions", "committedDate": "2020-04-01T22:32:41Z", "type": "commit"}, {"oid": "45ec78a919d6220521b55ca63582d365664b85c1", "url": "https://github.com/apache/kafka/commit/45ec78a919d6220521b55ca63582d365664b85c1", "message": "PR revision - Added EmbeddedConnectClusterAssertions", "committedDate": "2020-04-01T22:32:41Z", "type": "forcePushed"}]}