{"pr_number": 9108, "pr_title": "KAFKA-9273: Extract testShouldAutoShutdownOnIncompleteMetadata from S\u2026", "pr_createdAt": "2020-07-31T04:35:15Z", "pr_url": "https://github.com/apache/kafka/pull/9108", "timeline": [{"oid": "166950971b19d3f11de0ef92d57ecdeb55c7c107", "url": "https://github.com/apache/kafka/commit/166950971b19d3f11de0ef92d57ecdeb55c7c107", "message": "KAFKA-9273: Extract testShouldAutoShutdownOnIncompleteMetadata from StreamTableJoinIntegrationTest into its own test\n\nThe main goal is to remove usage of embedded broker (EmbeddedKafkaCluster) in AbstractJoinIntegrationTest and its subclasses.\nThis is because the tests under this class are no longer using the embedded broker, except for two.\ntestShouldAutoShutdownOnIncompleteMetadata is one of such tests.\nFurthermore, this test does not actually perfom stream-table join; it is testing an edge case of joining with a non-existent topic, so it should be in a separate test.", "committedDate": "2020-08-01T02:28:59Z", "type": "commit"}, {"oid": "166950971b19d3f11de0ef92d57ecdeb55c7c107", "url": "https://github.com/apache/kafka/commit/166950971b19d3f11de0ef92d57ecdeb55c7c107", "message": "KAFKA-9273: Extract testShouldAutoShutdownOnIncompleteMetadata from StreamTableJoinIntegrationTest into its own test\n\nThe main goal is to remove usage of embedded broker (EmbeddedKafkaCluster) in AbstractJoinIntegrationTest and its subclasses.\nThis is because the tests under this class are no longer using the embedded broker, except for two.\ntestShouldAutoShutdownOnIncompleteMetadata is one of such tests.\nFurthermore, this test does not actually perfom stream-table join; it is testing an edge case of joining with a non-existent topic, so it should be in a separate test.", "committedDate": "2020-08-01T02:28:59Z", "type": "forcePushed"}, {"oid": "08528e90fc3538c40cff6edd3856fb595b7a6b14", "url": "https://github.com/apache/kafka/commit/08528e90fc3538c40cff6edd3856fb595b7a6b14", "message": "KAFKA-9273: Extract shouldNotAccessJoinStoresWhenGivingName from StreamStreamJoinIntegrationTest into its own test.\n\nshouldNotAccessJoinStoresWhenGivingName is the last unit test that has a dependency to embedded broker in AbstractJoinIntegrationTest.\nThis test does not actually test the behaviour of stream-stream join;\nIt is testing an edge case of accessing the store of a join, so it should be in a separate test.", "committedDate": "2020-08-01T06:54:08Z", "type": "commit"}, {"oid": "865379e0182b685ba128cbd5d3491e9536bdfd38", "url": "https://github.com/apache/kafka/commit/865379e0182b685ba128cbd5d3491e9536bdfd38", "message": "KAFKA-9273: Remove dependency on embedded broker from AbstractJoinIntegrationTest.\n\nThe tests under AbstractJoinIntegrationTest previously requires embedded broker, but it is better to use TopologyTestDriver instead.\nExisting stream-stream join tests that still make use of embedded broker is moved to use TopologyTestDriver, by specifying it under BOOTSTRAP_SERVERS_CONFIG.\nAnd then the old EmbeddedKafkaCluster in AbstractJoinIntegrationTest is safely removed.", "committedDate": "2020-08-01T06:54:11Z", "type": "commit"}, {"oid": "865379e0182b685ba128cbd5d3491e9536bdfd38", "url": "https://github.com/apache/kafka/commit/865379e0182b685ba128cbd5d3491e9536bdfd38", "message": "KAFKA-9273: Remove dependency on embedded broker from AbstractJoinIntegrationTest.\n\nThe tests under AbstractJoinIntegrationTest previously requires embedded broker, but it is better to use TopologyTestDriver instead.\nExisting stream-stream join tests that still make use of embedded broker is moved to use TopologyTestDriver, by specifying it under BOOTSTRAP_SERVERS_CONFIG.\nAnd then the old EmbeddedKafkaCluster in AbstractJoinIntegrationTest is safely removed.", "committedDate": "2020-08-01T06:54:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU5MzE2NA==", "url": "https://github.com/apache/kafka/pull/9108#discussion_r469593164", "bodyText": "@albert02lowis I've confirmed locally that the test failures are related.  The TopologyTestDriver still needs a bootstrap servers config value.\nAdding something like STREAMS_CONFIG.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"test:0000\"); into the AbstractJoinIntegrationTest.setupConfigsAndUtils() gets all tests passing.\nI'm not sure how the JDK 14 tests passed as locally I got the same errors as the JDK 8 and 11 build locally.", "author": "bbejeck", "createdAt": "2020-08-12T22:59:35Z", "path": "streams/src/test/java/org/apache/kafka/streams/integration/AbstractJoinIntegrationTest.java", "diffHunk": "@@ -123,25 +117,18 @@\n     public static void setupConfigsAndUtils() {\n \n         STREAMS_CONFIG.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, \"earliest\");\n-        STREAMS_CONFIG.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, CLUSTER.bootstrapServers());", "originalCommit": "865379e0182b685ba128cbd5d3491e9536bdfd38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTcwNDMxOQ==", "url": "https://github.com/apache/kafka/pull/9108#discussion_r469704319", "bodyText": "I see, let me add back this BOOTSTRAP_SERVERS_CONFIG inside setupConfigsAndUtils then \ud83d\udc4d\ud83c\udffb", "author": "albert02lowis", "createdAt": "2020-08-13T05:26:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU5MzE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTcwNzc2MQ==", "url": "https://github.com/apache/kafka/pull/9108#discussion_r469707761", "bodyText": "Hi @bbejeck I have done the required change in a new commit. I have also extracted out redundant calls to set BOOTSTRAP_SERVERS_CONFIG in the subclasses' test methods.", "author": "albert02lowis", "createdAt": "2020-08-13T05:38:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU5MzE2NA=="}], "type": "inlineReview"}, {"oid": "af05f07cda3b0cc232e2ed89d5f3d0f91fcf416a", "url": "https://github.com/apache/kafka/commit/af05f07cda3b0cc232e2ed89d5f3d0f91fcf416a", "message": "Centralize setting of BOOTSTRAP_SERVERS_CONFIG inside AbstractJoinIntegrationTest.\n\nPreviously the setting of BOOTSTRAP_SERVERS_CONFIG is added on each test method, but this can actually be extracted to the BeforeClass method which is setupConfigsAndUtils in AbstractJoinIntegrationTest.", "committedDate": "2020-08-13T05:34:26Z", "type": "commit"}]}