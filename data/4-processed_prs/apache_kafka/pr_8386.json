{"pr_number": 8386, "pr_title": "MINOR: Improve close tests of caching state store", "pr_createdAt": "2020-03-30T12:21:38Z", "pr_url": "https://github.com/apache/kafka/pull/8386", "timeline": [{"oid": "15157c0c05f0d883e6db1791936d8f0db17fa7a5", "url": "https://github.com/apache/kafka/commit/15157c0c05f0d883e6db1791936d8f0db17fa7a5", "message": "MINOR: Improve close tests of caching state store", "committedDate": "2020-03-30T12:20:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NzkwNg==", "url": "https://github.com/apache/kafka/pull/8386#discussion_r400147906", "bodyText": "I added the check for the exception.", "author": "cadonna", "createdAt": "2020-03-30T12:22:20Z", "path": "streams/src/test/java/org/apache/kafka/streams/state/internals/CachingKeyValueStoreTest.java", "diffHunk": "@@ -122,38 +123,34 @@ public void shouldAvoidFlushingDeletionsWithoutDirtyKeys() {\n     }\n \n     @Test\n-    public void shouldCloseWrappedStoreAfterErrorDuringCacheFlush() {\n+    public void shouldCloseWrappedStoreAndCacheAfterErrorDuringCacheFlush() {\n         setUpCloseTests();\n+        EasyMock.reset(cache);\n         cache.flush(CACHE_NAMESPACE);\n-        EasyMock.expectLastCall().andThrow(new NullPointerException(\"Simulating an error on flush\"));\n+        EasyMock.expectLastCall().andThrow(new RuntimeException(\"Simulating an error on flush\"));\n         EasyMock.replay(cache);\n         EasyMock.reset(underlyingStore);\n         underlyingStore.close();\n         EasyMock.replay(underlyingStore);\n \n-        try {\n-            store.close();\n-        } catch (final RuntimeException exception) {\n-            EasyMock.verify(underlyingStore);\n-        }\n+        assertThrows(RuntimeException.class, store::close);", "originalCommit": "15157c0c05f0d883e6db1791936d8f0db17fa7a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0ODQ2NQ==", "url": "https://github.com/apache/kafka/pull/8386#discussion_r400148465", "bodyText": "I added the verification for the call to close() of underlying store and cache.", "author": "cadonna", "createdAt": "2020-03-30T12:23:17Z", "path": "streams/src/test/java/org/apache/kafka/streams/state/internals/CachingKeyValueStoreTest.java", "diffHunk": "@@ -122,38 +123,34 @@ public void shouldAvoidFlushingDeletionsWithoutDirtyKeys() {\n     }\n \n     @Test\n-    public void shouldCloseWrappedStoreAfterErrorDuringCacheFlush() {\n+    public void shouldCloseWrappedStoreAndCacheAfterErrorDuringCacheFlush() {\n         setUpCloseTests();\n+        EasyMock.reset(cache);\n         cache.flush(CACHE_NAMESPACE);\n-        EasyMock.expectLastCall().andThrow(new NullPointerException(\"Simulating an error on flush\"));\n+        EasyMock.expectLastCall().andThrow(new RuntimeException(\"Simulating an error on flush\"));\n         EasyMock.replay(cache);\n         EasyMock.reset(underlyingStore);\n         underlyingStore.close();\n         EasyMock.replay(underlyingStore);\n \n-        try {\n-            store.close();\n-        } catch (final RuntimeException exception) {\n-            EasyMock.verify(underlyingStore);\n-        }\n+        assertThrows(RuntimeException.class, store::close);\n+        EasyMock.verify(cache, underlyingStore);", "originalCommit": "15157c0c05f0d883e6db1791936d8f0db17fa7a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}