{"pr_number": 8971, "pr_title": "MINOR: prune the metadata upgrade test matrix", "pr_createdAt": "2020-07-01T19:55:58Z", "pr_url": "https://github.com/apache/kafka/pull/8971", "timeline": [{"oid": "9d1f638fac6cedc9e95ce52d490a823cacc0ec72", "url": "https://github.com/apache/kafka/commit/9d1f638fac6cedc9e95ce52d490a823cacc0ec72", "message": "MINOR: prune the metadata upgrade test matrix", "committedDate": "2020-07-01T18:30:00Z", "type": "commit"}, {"oid": "cc267912abe5fe304e9d5e00e1964dc31fdeb244", "url": "https://github.com/apache/kafka/commit/cc267912abe5fe304e9d5e00e1964dc31fdeb244", "message": "Merge branch 'trunk' into minor-prune-meta-upgrade-test-matrix", "committedDate": "2020-07-02T23:16:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY4NTU1Mw==", "url": "https://github.com/apache/kafka/pull/8971#discussion_r449685553", "bodyText": "I was originally thinking that streams_application_upgrade_test.py and streams_upgrade_test.py can be re-consolidated so that the latter would be for broker-clients compatibility (including rolling upgrade the brokers), and would for now be ignored. While the former would be used for upgrading / downgrading clients for different paths (one rolling bounce including version probing, two rolling bounces, full shutdown and restart). In that case, this test and the test_version_probing_upgrade below could be moved into the other file. WDYT?", "author": "guozhangwang", "createdAt": "2020-07-03T19:11:25Z", "path": "tests/kafkatest/tests/streams/streams_upgrade_test.py", "diffHunk": "@@ -189,9 +185,8 @@ def test_upgrade_downgrade_brokers(self, from_version, to_version):\n         processor.stop()\n         processor.node.account.ssh_capture(\"grep SMOKE-TEST-CLIENT-CLOSED %s\" % processor.STDOUT_FILE, allow_fail=False)\n \n-    @matrix(from_version=metadata_1_versions, to_version=backward_compatible_metadata_2_versions)\n-    @matrix(from_version=metadata_1_versions, to_version=metadata_3_or_higher_versions)\n-    @matrix(from_version=metadata_2_versions, to_version=metadata_3_or_higher_versions)\n+    @matrix(from_version=metadata_1_versions, to_version=[str(DEV_VERSION)])\n+    @matrix(from_version=metadata_2_versions, to_version=[str(DEV_VERSION)])", "originalCommit": "cc267912abe5fe304e9d5e00e1964dc31fdeb244", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM2NzUwMA==", "url": "https://github.com/apache/kafka/pull/8971#discussion_r450367500", "bodyText": "Ah, I see.\nSince you mention the client-broker test, I was going to pose this question to you: The test is currently ignored, as has been ignored for as long as I can remember. It seems like we should fix it or delete it. I'm guessing your preference would be to fix it, right?\nTo the point about the client-client metadata upgrade test, I left it and the version probing test here because they are specifically testing that the relevant metadata versions get upgraded, whereas the test I moved was instead just about making sure that the app keeps running after an upgrade.\nIt does seem like we could improve the metadata and broker upgrade tests by making them run the full soak app instead, but I'm wondering if we could do it separately. This PR in particular seems like a good addition to add asap, since it should dramatically reduce the number of tests we have to run during system tests.", "author": "vvcephei", "createdAt": "2020-07-06T17:15:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY4NTU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ4ODk5Mg==", "url": "https://github.com/apache/kafka/pull/8971#discussion_r450488992", "bodyText": "Yes I agree. That makes sense. My thoughts are just aligned with our previous discussions about merging various tests, especially even considering merging the StreamsSmokeTest with StreamsUpgradeTest but that is out of the scope of this one.", "author": "guozhangwang", "createdAt": "2020-07-06T21:27:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY4NTU1Mw=="}], "type": "inlineReview"}]}