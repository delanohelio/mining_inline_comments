{"pr_number": 9718, "pr_title": "KAFKA-10832: Fix Log to use the correct ProducerStateManager instance when updating producers", "pr_createdAt": "2020-12-09T06:32:56Z", "pr_url": "https://github.com/apache/kafka/pull/9718", "timeline": [{"oid": "f0466b2420dc500112b4839678564996c0677d2e", "url": "https://github.com/apache/kafka/commit/f0466b2420dc500112b4839678564996c0677d2e", "message": "MINOR: Use the correct ProducerStateManager when updating producers", "committedDate": "2020-12-09T06:28:00Z", "type": "commit"}, {"oid": "6d348bcc12f9e8b2ddf0552c089945b4eda67538", "url": "https://github.com/apache/kafka/commit/6d348bcc12f9e8b2ddf0552c089945b4eda67538", "message": "Address comments from @ijuma", "committedDate": "2020-12-10T21:11:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3MTI0NA==", "url": "https://github.com/apache/kafka/pull/9718#discussion_r540571244", "bodyText": "This seems too large as a companion method. I am also not sure that we should pass along Log to this method since it exposes all internal states in Log, which make it harder to track usage.", "author": "junrao", "createdAt": "2020-12-10T23:16:24Z", "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -2670,6 +2573,112 @@ object Log {\n   private def isLogFile(file: File): Boolean =\n     file.getPath.endsWith(LogFileSuffix)\n \n+  // Rebuild producer state until lastOffset. This method may be called from the recovery code path, and thus must be\n+  // free of all side-effects, i.e. it must not update any log-specific state.\n+  private def rebuildProducerState(log: Log,", "originalCommit": "6d348bcc12f9e8b2ddf0552c089945b4eda67538", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3MzA4Mg==", "url": "https://github.com/apache/kafka/pull/9718#discussion_r540573082", "bodyText": "That is true. Do you feel the original approach in f0466b2 was better, where, we didn't move methods into a companion object? I'd be happy to revert to that.", "author": "kowshik", "createdAt": "2020-12-10T23:20:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3MTI0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4ODk5NA==", "url": "https://github.com/apache/kafka/pull/9718#discussion_r540588994", "bodyText": "We can probably keep the two other two simpler methods (without Log as the input) as the companion methods.", "author": "junrao", "createdAt": "2020-12-10T23:57:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3MTI0NA=="}], "type": "inlineReview"}, {"oid": "31f95a01c6ba66cc81fd5e8533213947b5946478", "url": "https://github.com/apache/kafka/commit/31f95a01c6ba66cc81fd5e8533213947b5946478", "message": "Address comments from @junrao", "committedDate": "2020-12-11T02:21:52Z", "type": "forcePushed"}, {"oid": "5d798b7d884bd11e43884318ae3fc8d12e635c40", "url": "https://github.com/apache/kafka/commit/5d798b7d884bd11e43884318ae3fc8d12e635c40", "message": "Address comments from @junrao", "committedDate": "2020-12-11T02:22:31Z", "type": "commit"}, {"oid": "5d798b7d884bd11e43884318ae3fc8d12e635c40", "url": "https://github.com/apache/kafka/commit/5d798b7d884bd11e43884318ae3fc8d12e635c40", "message": "Address comments from @junrao", "committedDate": "2020-12-11T02:22:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTI4MDc1MA==", "url": "https://github.com/apache/kafka/pull/9718#discussion_r541280750", "bodyText": "Perhaps this could be name loadProducersFromRecords?", "author": "junrao", "createdAt": "2020-12-11T20:56:10Z", "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -2670,6 +2645,34 @@ object Log {\n   private def isLogFile(file: File): Boolean =\n     file.getPath.endsWith(LogFileSuffix)\n \n+  private def loadProducersFromLog(producerStateManager: ProducerStateManager, records: Records): Unit = {", "originalCommit": "5d798b7d884bd11e43884318ae3fc8d12e635c40", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTI4ODgyMg==", "url": "https://github.com/apache/kafka/pull/9718#discussion_r541288822", "bodyText": "Done", "author": "kowshik", "createdAt": "2020-12-11T21:04:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTI4MDc1MA=="}], "type": "inlineReview"}, {"oid": "ec00e9f2226b976e618b402fd54b11b8405b5502", "url": "https://github.com/apache/kafka/commit/ec00e9f2226b976e618b402fd54b11b8405b5502", "message": "Address comments from @junrao", "committedDate": "2020-12-11T21:03:47Z", "type": "commit"}]}