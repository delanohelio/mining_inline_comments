{"pr_number": 8992, "pr_title": "MINOR: Closing resources in SaslClientsWithInvalidCredentialsTest", "pr_createdAt": "2020-07-08T11:23:34Z", "pr_url": "https://github.com/apache/kafka/pull/8992", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA5MjE4MA==", "url": "https://github.com/apache/kafka/pull/8992#discussion_r452092180", "bodyText": "@akatona84 Thanks for the PR.  Normally producer/consumer instances created in the test are closed in IntegrationTestHarness.tearDown . many core tests extends IntegrationTestHarness class.\nDo we know, which tests were failed?", "author": "omkreddy", "createdAt": "2020-07-09T09:37:27Z", "path": "core/src/test/scala/integration/kafka/api/SaslClientsWithInvalidCredentialsTest.scala", "diffHunk": "@@ -74,48 +75,58 @@ class SaslClientsWithInvalidCredentialsTest extends IntegrationTestHarness with\n   @Test\n   def testProducerWithAuthenticationFailure(): Unit = {\n     val producer = createProducer()\n-    verifyAuthenticationException(sendOneRecord(producer, maxWaitMs = 10000))\n-    verifyAuthenticationException(producer.partitionsFor(topic))\n+    try {\n+      verifyAuthenticationException(sendOneRecord(producer, maxWaitMs = 10000))\n+      verifyAuthenticationException(producer.partitionsFor(topic))\n \n-    createClientCredential()\n-    verifyWithRetry(sendOneRecord(producer))\n+      createClientCredential()\n+      verifyWithRetry(sendOneRecord(producer))\n+    } finally producer.close()", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEwODc4Ng==", "url": "https://github.com/apache/kafka/pull/8992#discussion_r452108786", "bodyText": "Oh, right, it was suspicious that I did not see consumer thread on the failed .classMethod cases :) Thanks.\ntestConsumerGroupServiceWithAuthenticationSuccess failed and left adminclient threads for later ones:\n\njava.lang.AssertionError: Found unexpected threads during @AfterClass, allThreads=Set(Test worker, metrics-meter-tick-thread-2, main, Signal Dispatcher, Reference Handler, Finalizer, /0:0:0:0:0:0:0:1:55620 to /0:0:0:0:0:0:0:1:33045 workers Thread 2, kafka-admin-client-thread | adminclient-45, /0:0:0:0:0:0:0:1:55620 to /0:0:0:0:0:0:0:1:33045 workers Thread 3, metrics-meter-tick-thread-1), unexpected=Set(kafka-admin-client-thread | adminclient-45)", "author": "akatona84", "createdAt": "2020-07-09T10:06:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA5MjE4MA=="}], "type": "inlineReview"}, {"oid": "dcf187b566f48a4fb817250031a3dd484a5a86e4", "url": "https://github.com/apache/kafka/commit/dcf187b566f48a4fb817250031a3dd484a5a86e4", "message": "MINOR: Closing consumerGroupService resources in SaslClientsWithInvalidCredentialsTest", "committedDate": "2020-07-09T10:01:02Z", "type": "commit"}, {"oid": "dcf187b566f48a4fb817250031a3dd484a5a86e4", "url": "https://github.com/apache/kafka/commit/dcf187b566f48a4fb817250031a3dd484a5a86e4", "message": "MINOR: Closing consumerGroupService resources in SaslClientsWithInvalidCredentialsTest", "committedDate": "2020-07-09T10:01:02Z", "type": "forcePushed"}]}