{"pr_number": 9541, "pr_title": "KAFKA-10675: Add schema name to ConnectSchema.validateValue() error message", "pr_createdAt": "2020-11-02T22:34:14Z", "pr_url": "https://github.com/apache/kafka/pull/9541", "timeline": [{"oid": "b6912b942670404d5a41f7b8506e9493a53e3b5f", "url": "https://github.com/apache/kafka/commit/b6912b942670404d5a41f7b8506e9493a53e3b5f", "message": "KAFKA-10675 Add schema name to error message from ConnectSchema.validateValue()", "committedDate": "2021-02-20T20:04:19Z", "type": "forcePushed"}, {"oid": "12ddffd7ba7741cac15bf1491e82902a02298579", "url": "https://github.com/apache/kafka/commit/12ddffd7ba7741cac15bf1491e82902a02298579", "message": "KAFKA-10675 Add schema name to error message from ConnectSchema.validateValue()", "committedDate": "2021-02-20T22:45:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDgxMDc0Mg==", "url": "https://github.com/apache/kafka/pull/9541#discussion_r584810742", "bodyText": "Given that this is only used in one place, and the string that it creates is itself added to a formatted string, I think it'd be a bit more readable if we removed this method and inlined all the logic where it's being invoked right now.", "author": "C0urante", "createdAt": "2021-03-01T15:34:43Z", "path": "connect/api/src/main/java/org/apache/kafka/connect/data/ConnectSchema.java", "diffHunk": "@@ -266,10 +261,19 @@ public static void validateValue(String name, Schema schema, Object value) {\n     private static List<Class> expectedClassesFor(Schema schema) {\n         List<Class> expectedClasses = LOGICAL_TYPE_CLASSES.get(schema.name());\n         if (expectedClasses == null)\n-            expectedClasses = SCHEMA_TYPE_CLASSES.get(schema.type());\n+            expectedClasses = SCHEMA_TYPE_CLASSES.getOrDefault(schema.type(), Collections.emptyList());\n         return expectedClasses;\n     }\n \n+    private static String buildSchemaInfo(Schema schema) {\n+        StringBuilder schemaInfo = new StringBuilder(\"schema\");\n+        if (schema.name() != null) {\n+            schemaInfo.append(\" \\\"\").append(schema.name()).append(\"\\\"\");\n+        }\n+        schemaInfo.append(\" with type \").append(schema.type());\n+        return schemaInfo.toString();\n+    }", "originalCommit": "1b02708a04d0c290e700db722dc0b2f77cf0bbcd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NzgxMTM2MA==", "url": "https://github.com/apache/kafka/pull/9541#discussion_r587811360", "bodyText": "Thanks for reviewing! Fixes were pushed", "author": "Iskuskov", "createdAt": "2021-03-04T20:43:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDgxMDc0Mg=="}], "type": "inlineReview"}, {"oid": "9cfcb66adda23cc84556a9ca02169dadb01a6f57", "url": "https://github.com/apache/kafka/commit/9cfcb66adda23cc84556a9ca02169dadb01a6f57", "message": "KAFKA-10675 fix after review", "committedDate": "2021-03-04T20:36:43Z", "type": "forcePushed"}, {"oid": "c8a361cf23bc1803402fc139c047db7c1fbdca07", "url": "https://github.com/apache/kafka/commit/c8a361cf23bc1803402fc139c047db7c1fbdca07", "message": "KAFKA-10675 fix after review", "committedDate": "2021-03-04T20:53:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTk3NTE4OA==", "url": "https://github.com/apache/kafka/pull/9541#discussion_r615975188", "bodyText": "Strictly speaking, this shouldn't be necessary as SCHEMA_TYPE_CLASSES should have a Schema instance for all Schema.Type literals. And with SchemaBuilder a connector or converter cannot create a schema instance with a null Schema.Type.\nHowever, it is possible to construct a ConnectSchema instance with a null Type reference (like what FakeSchema essentially does in the existing test), which of course without this change would result in this method returning a null list.\nSo +1 for this line change since it simplifies the error handling in the calling code.", "author": "rhauch", "createdAt": "2021-04-19T15:58:51Z", "path": "connect/api/src/main/java/org/apache/kafka/connect/data/ConnectSchema.java", "diffHunk": "@@ -266,7 +267,7 @@ public static void validateValue(String name, Schema schema, Object value) {\n     private static List<Class> expectedClassesFor(Schema schema) {\n         List<Class> expectedClasses = LOGICAL_TYPE_CLASSES.get(schema.name());\n         if (expectedClasses == null)\n-            expectedClasses = SCHEMA_TYPE_CLASSES.get(schema.type());\n+            expectedClasses = SCHEMA_TYPE_CLASSES.getOrDefault(schema.type(), Collections.emptyList());", "originalCommit": "c8a361cf23bc1803402fc139c047db7c1fbdca07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzQyMzQ1Mg==", "url": "https://github.com/apache/kafka/pull/9541#discussion_r617423452", "bodyText": "Thank you! Highly appreciate your comment", "author": "Iskuskov", "createdAt": "2021-04-21T10:44:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTk3NTE4OA=="}], "type": "inlineReview"}, {"oid": "468790f2fae38e50c4c80d964962d8fda6f8ecb0", "url": "https://github.com/apache/kafka/commit/468790f2fae38e50c4c80d964962d8fda6f8ecb0", "message": "KAFKA-10675 Add schema name to error message from ConnectSchema.validateValue()", "committedDate": "2021-07-09T09:12:25Z", "type": "commit"}, {"oid": "ea28af762c8b57971c6ab2244754a18ef4b09f15", "url": "https://github.com/apache/kafka/commit/ea28af762c8b57971c6ab2244754a18ef4b09f15", "message": "KAFKA-10675 refactoring", "committedDate": "2021-07-09T09:27:06Z", "type": "commit"}, {"oid": "3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1", "url": "https://github.com/apache/kafka/commit/3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1", "message": "KAFKA-10675 fix after review", "committedDate": "2021-07-09T09:27:09Z", "type": "commit"}, {"oid": "3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1", "url": "https://github.com/apache/kafka/commit/3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1", "message": "KAFKA-10675 fix after review", "committedDate": "2021-07-09T09:27:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzIyNTczMA==", "url": "https://github.com/apache/kafka/pull/9541#discussion_r667225730", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<Class> expectedClasses = expectedClassesFor(schema);\n          \n          \n            \n                    List<Class<?>> expectedClasses = expectedClassesFor(schema);", "author": "kkonstantine", "createdAt": "2021-07-09T21:45:15Z", "path": "connect/api/src/main/java/org/apache/kafka/connect/data/ConnectSchema.java", "diffHunk": "@@ -221,13 +221,7 @@ public static void validateValue(String name, Schema schema, Object value) {\n             return;\n         }\n \n-        List<Class<?>> expectedClasses = expectedClassesFor(schema);\n-\n-        if (expectedClasses == null)\n-            throw new DataException(\"Invalid Java object for schema type \" + schema.type()\n-                    + \": \" + value.getClass()\n-                    + \" for field: \\\"\" + name + \"\\\"\");\n-\n+        List<Class> expectedClasses = expectedClassesFor(schema);", "originalCommit": "3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a5b765f5ade561451b71c1fdd4b5a4c19ed5131b", "url": "https://github.com/apache/kafka/commit/a5b765f5ade561451b71c1fdd4b5a4c19ed5131b", "message": "Don't use raw type for Class", "committedDate": "2021-07-09T21:47:56Z", "type": "commit"}]}