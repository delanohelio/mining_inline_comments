{"pr_number": 8245, "pr_title": "MINOR: break up StreamsPartitionAssignor's gargantuan #assign", "pr_createdAt": "2020-03-06T22:51:32Z", "pr_url": "https://github.com/apache/kafka/pull/8245", "timeline": [{"oid": "35ca487cc05aed3162c2e65043141cd5a2f50209", "url": "https://github.com/apache/kafka/commit/35ca487cc05aed3162c2e65043141cd5a2f50209", "message": "break up #assign", "committedDate": "2020-03-06T22:46:34Z", "type": "commit"}, {"oid": "0b0ee15f3dd8c268656d0b17d47beda0445d24dd", "url": "https://github.com/apache/kafka/commit/0b0ee15f3dd8c268656d0b17d47beda0445d24dd", "message": "checkstyle", "committedDate": "2020-03-06T22:53:07Z", "type": "commit"}, {"oid": "0acd802317eb6dbc008a8959d82c4b64b715aff5", "url": "https://github.com/apache/kafka/commit/0acd802317eb6dbc008a8959d82c4b64b715aff5", "message": "futureclientmetadata", "committedDate": "2020-03-06T23:03:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTI2NjE2Ng==", "url": "https://github.com/apache/kafka/pull/8245#discussion_r389266166", "bodyText": "nit: add an error log entry as well?", "author": "guozhangwang", "createdAt": "2020-03-07T16:31:18Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignor.java", "diffHunk": "@@ -321,13 +320,107 @@ public GroupAssignment assign(final Cluster metadata, final GroupSubscription gr\n             clientMetadata.addPreviousTasks(info);\n         }\n \n+        final boolean versionProbing =\n+            checkMetadataVersions(minReceivedMetadataVersion, minSupportedMetadataVersion, futureMetadataVersion);\n+\n+        log.debug(\"Constructed client metadata {} from the member subscriptions.\", clientMetadataMap);\n+\n+        // ---------------- Step One ---------------- //\n+\n+        // parse the topology to determine the repartition source topics,\n+        // making sure they are created with the number of partitions as\n+        // the maximum of the depending sub-topologies source topics' number of partitions\n+        final Map<Integer, InternalTopologyBuilder.TopicsInfo> topicGroups = taskManager.builder().topicGroups();\n+\n+        final Map<TopicPartition, PartitionInfo> allRepartitionTopicPartitions;\n+        try {\n+            allRepartitionTopicPartitions = prepareRepartitionTopics(topicGroups, metadata);\n+        } catch (final TaskAssignmentException e) {\n+            return new GroupAssignment(", "originalCommit": "0acd802317eb6dbc008a8959d82c4b64b715aff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxMTY1NQ==", "url": "https://github.com/apache/kafka/pull/8245#discussion_r389311655", "bodyText": "We actually log an exception before throwing it in the inner method", "author": "ableegoldman", "createdAt": "2020-03-07T20:57:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTI2NjE2Ng=="}], "type": "inlineReview"}]}