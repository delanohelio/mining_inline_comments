{"pr_number": 8701, "pr_title": "MINOR: Add reason to log message when incrementing the log start offset", "pr_createdAt": "2020-05-20T23:11:54Z", "pr_url": "https://github.com/apache/kafka/pull/8701", "timeline": [{"oid": "d5160cb23bfe6af3202811e30191db10886798b3", "url": "https://github.com/apache/kafka/commit/d5160cb23bfe6af3202811e30191db10886798b3", "message": "MINOR: Add reason to log message when incrementing the log start offset", "committedDate": "2020-05-20T23:09:23Z", "type": "commit"}, {"oid": "b8a9021a3689f6b2fb1ae928640a633c899a7689", "url": "https://github.com/apache/kafka/commit/b8a9021a3689f6b2fb1ae928640a633c899a7689", "message": "Add enum and remove overload", "committedDate": "2020-05-21T00:02:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5NTE5MA==", "url": "https://github.com/apache/kafka/pull/8701#discussion_r428495190", "bodyText": "How about LogStartOffsetIncrementCause ?", "author": "chia7712", "createdAt": "2020-05-21T07:38:56Z", "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -180,6 +180,17 @@ object RollParams {\n   }\n }\n \n+sealed trait LogStartIncrementCause", "originalCommit": "b8a9021a3689f6b2fb1ae928640a633c899a7689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgxOTkxMQ==", "url": "https://github.com/apache/kafka/pull/8701#discussion_r428819911", "bodyText": "I knew someone was going to ask this \ud83d\ude42 . I guess I'll do it.", "author": "hachikuji", "createdAt": "2020-05-21T18:00:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5NTE5MA=="}], "type": "inlineReview"}, {"oid": "788544da1e4dd5394d52428f28ffbda1f7c62732", "url": "https://github.com/apache/kafka/commit/788544da1e4dd5394d52428f28ffbda1f7c62732", "message": "LogStartIncrementCause -> LogStartOffsetIncrementCause", "committedDate": "2020-05-21T19:17:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MTYxMw==", "url": "https://github.com/apache/kafka/pull/8701#discussion_r429551613", "bodyText": "Nit: LogStartOffsetIncrementReason?", "author": "ijuma", "createdAt": "2020-05-23T14:38:22Z", "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -180,6 +180,17 @@ object RollParams {\n   }\n }\n \n+sealed trait LogStartOffsetIncrementCause", "originalCommit": "788544da1e4dd5394d52428f28ffbda1f7c62732", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MTc5OA==", "url": "https://github.com/apache/kafka/pull/8701#discussion_r429551798", "bodyText": "Maybe we should just say segment deletion? We can also delete segments during recovery and such. Could that not trigger this path?", "author": "ijuma", "createdAt": "2020-05-23T14:41:08Z", "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -180,6 +180,17 @@ object RollParams {\n   }\n }\n \n+sealed trait LogStartOffsetIncrementCause\n+case object ClientRecordDeletion extends LogStartOffsetIncrementCause {\n+  override def toString: String = \"client delete records request\"\n+}\n+case object LeaderOffsetIncremented extends LogStartOffsetIncrementCause {\n+  override def toString: String = \"leader offset increment\"\n+}\n+case object SegmentDeletion extends LogStartOffsetIncrementCause {\n+  override def toString: String = \"segment deletion to enforce retention\"", "originalCommit": "788544da1e4dd5394d52428f28ffbda1f7c62732", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MjAxOA==", "url": "https://github.com/apache/kafka/pull/8701#discussion_r429552018", "bodyText": "Nit: would due be better than after here?", "author": "ijuma", "createdAt": "2020-05-23T14:44:22Z", "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -1275,8 +1286,8 @@ class Log(@volatile private var _dir: File,\n       lock synchronized {\n         checkIfMemoryMappedBufferClosed()\n         if (newLogStartOffset > logStartOffset) {\n-          info(s\"Incrementing log start offset to $newLogStartOffset\")\n           updateLogStartOffset(newLogStartOffset)\n+          info(s\"Incremented log start offset to $newLogStartOffset after $cause\")", "originalCommit": "788544da1e4dd5394d52428f28ffbda1f7c62732", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "268296fdc14c18f931c8f1797898d76ec00e8527", "url": "https://github.com/apache/kafka/commit/268296fdc14c18f931c8f1797898d76ec00e8527", "message": "review comments", "committedDate": "2020-05-26T17:16:21Z", "type": "commit"}]}