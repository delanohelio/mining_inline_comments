{"pr_number": 618, "pr_title": "#571 - Added docs for path patterns support & fixed GET endpoint", "pr_createdAt": "2020-09-22T08:29:56Z", "pr_url": "https://github.com/artipie/artipie/pull/618", "timeline": [{"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef", "url": "https://github.com/artipie/artipie/commit/6a9e9eae4158eeca61172c47f2b8fb41d04c1bef", "message": "#571 - Added docs for path patterns support & fixed GET endpoint", "committedDate": "2020-09-22T08:27:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU5ODU1Ng==", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492598556", "bodyText": "@olegmoz I'd suggest to simplify this sentence to \"Path patterns to apply permissions to\"", "author": "olenagerasimova", "createdAt": "2020-09-22T09:32:04Z", "path": "REST_API.md", "diffHunk": "@@ -143,6 +144,7 @@ Fields description:\n \n Field name | Type | Meaning | Required\n ------ | ------ | ------ | ------\n+includesPattern | string | Path pattern to which permissions are applied | Y", "originalCommit": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwMTA0OQ==", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492601049", "bodyText": "@olegmoz I'd suggest to rephrase:\ninclude-patterns is an optional argument (effectively value [\"**\"] is set by default)\nwhich allows specifying path patterns to apply permissions to.", "author": "olenagerasimova", "createdAt": "2020-09-22T09:36:23Z", "path": "REST_API.md", "diffHunk": "@@ -183,9 +186,15 @@ The following synonyms and shortened values for standard operations are supporte\n - `delete` - `d`\n - `manage` (any operation is allowed) - `m`, `admin`\n \n+`include-patterns` is an optional argument (effectively is `[\"**\"]` by default) \n+which allows specifying path patterns to which permissions are applied.", "originalCommit": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwMTYxMA==", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492601610", "bodyText": "@olegmoz let's remove point at the end of the sentence, they are not required in the lists", "author": "olenagerasimova", "createdAt": "2020-09-22T09:37:15Z", "path": "REST_API.md", "diffHunk": "@@ -183,9 +186,15 @@ The following synonyms and shortened values for standard operations are supporte\n - `delete` - `d`\n - `manage` (any operation is allowed) - `m`, `admin`\n \n+`include-patterns` is an optional argument (effectively is `[\"**\"]` by default) \n+which allows specifying path patterns to which permissions are applied.\n+Path patterns are specified by Ant-like expressions.\n+\n Possible responses:\n - `200 OK` when permissions were added successfully\n - `500 INTERNAL ERROR` in the case of unexpected server error\n+- `400 BAD REQUEST` in the cases when repository name does not exist \n+ or `include-patterns` format is invalid.", "originalCommit": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwNDA5Mg==", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492604092", "bodyText": "@olegmoz I'm not sure I like these changes as include-patterns is actually a list, would not it be better to revert changes here and add several patterns in one test method?", "author": "olenagerasimova", "createdAt": "2020-09-22T09:41:32Z", "path": "src/test/java/com/artipie/api/artifactory/GetPermissionSliceTest.java", "diffHunk": "@@ -129,25 +127,17 @@ void returnsUsersAndPermissionsList() {\n                             .add(john, Json.createArrayBuilder().add(\"r\").add(\"w\").build())\n                             .add(mark, Json.createArrayBuilder().add(\"m\").build())\n                             .build(),\n-                        Collections.singletonList(\"**\")\n+                        \"**/*\"\n                     )\n                 ),\n                 new RequestLine(RqMethod.GET, String.format(\"/api/security/permissions/%s\", repo))\n             )\n         );\n     }\n \n-    private byte[] response(\n-        final String repo,\n-        final JsonObject users,\n-        final Collection<String> patterns\n-    ) {\n-        final JsonArrayBuilder incpatterns = Json.createArrayBuilder();\n-        for (final String pattern : patterns) {\n-            incpatterns.add(pattern);\n-        }\n+    private byte[] response(final String repo, final JsonObject users, final String pattern) {\n         return Json.createObjectBuilder()\n-            .add(\"include-patterns\", incpatterns)\n+            .add(\"includesPattern\", pattern)\n             .add(\"repositories\", Json.createArrayBuilder().add(repo).build())", "originalCommit": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyNDQ1NA==", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492624454", "bodyText": "@olenagerasimova that's not about test - it happens that original API has only one path in GET response, see https://www.jfrog.com/confluence/display/rtf/artifactory+rest+api#ArtifactoryRESTAPI-GetPermissionTargetDetails and application/vnd.org.jfrog.artifactory.security.PermissionTarget+json format description here: https://www.jfrog.com/confluence/display/JFROG/Security+Configuration+JSON\nSo original implementation was wrong. I noticed it only updating the docs", "author": "olegmoz", "createdAt": "2020-09-22T10:18:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwNDA5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY4MTA4OA==", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492681088", "bodyText": "@olegmoz oh, I see, thanks", "author": "olenagerasimova", "createdAt": "2020-09-22T12:08:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwNDA5Mg=="}], "type": "inlineReview"}, {"oid": "b3e5b8c65761d1d83b2e51e9821807a02c9592fe", "url": "https://github.com/artipie/artipie/commit/b3e5b8c65761d1d83b2e51e9821807a02c9592fe", "message": "#571 - Changes by review", "committedDate": "2020-09-22T10:20:29Z", "type": "commit"}, {"oid": "effae426b8f786273ae886d9a6f90b4be568feca", "url": "https://github.com/artipie/artipie/commit/effae426b8f786273ae886d9a6f90b4be568feca", "message": "Merge branch 'master' into 571-include-patterns-doc-and-fix", "committedDate": "2020-09-22T13:40:19Z", "type": "commit"}]}