{"pr_number": 2930, "pr_title": "ServiceDAO findByField improvements", "pr_createdAt": "2020-04-07T11:15:33Z", "pr_url": "https://github.com/eclipse/kapua/pull/2930", "timeline": [{"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "url": "https://github.com/eclipse/kapua/commit/7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "message": "Add scopeId to findByName\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-07T14:25:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5MjkxMw==", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404892913", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "author": "Coduz", "createdAt": "2020-04-07T15:18:21Z", "path": "service/job/internal/src/main/java/org/eclipse/kapua/service/job/step/internal/JobStepDAO.java", "diffHunk": "@@ -92,7 +92,7 @@ public static JobStep find(EntityManager em, KapuaId scopeId, KapuaId jobStepId)\n      * @return\n      */\n     public static JobStep findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, JobStepImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, JobStepImpl.class, null, \"name\", name);", "originalCommit": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5MzI3Mw==", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404893273", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "author": "Coduz", "createdAt": "2020-04-07T15:18:45Z", "path": "service/job/internal/src/main/java/org/eclipse/kapua/service/job/internal/JobDAO.java", "diffHunk": "@@ -89,7 +89,7 @@ public static Job find(EntityManager em, KapuaId scopeId, KapuaId jobId) {\n      * @return\n      */\n     public static Job findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, JobImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, JobImpl.class, null, \"name\", name);", "originalCommit": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5MzQwNg==", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404893406", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "author": "Coduz", "createdAt": "2020-04-07T15:18:54Z", "path": "service/job/internal/src/main/java/org/eclipse/kapua/service/job/execution/internal/JobExecutionDAO.java", "diffHunk": "@@ -92,7 +92,7 @@ public static JobExecution find(EntityManager em, KapuaId scopeId, KapuaId jobEx\n      * @since 1.0.0\n      */\n     public static JobExecution findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, JobExecutionImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, JobExecutionImpl.class, null, \"name\", name);", "originalCommit": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5MzYzNQ==", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404893635", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "author": "Coduz", "createdAt": "2020-04-07T15:19:12Z", "path": "service/account/internal/src/main/java/org/eclipse/kapua/service/account/internal/AccountDAO.java", "diffHunk": "@@ -95,7 +95,7 @@ public static Account find(EntityManager em, KapuaId scopeId, KapuaId accountId)\n      * @return\n      */\n     public static Account findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, AccountImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, AccountImpl.class, null, \"name\", name);", "originalCommit": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5Mzg4Ng==", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404893886", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "author": "Coduz", "createdAt": "2020-04-07T15:19:30Z", "path": "service/job/internal/src/main/java/org/eclipse/kapua/service/job/targets/internal/JobTargetDAO.java", "diffHunk": "@@ -92,7 +92,7 @@ public static JobTarget find(EntityManager em, KapuaId scopeId, KapuaId jobTarge\n      * @return\n      */\n     public static JobTarget findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, JobTargetImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, JobTargetImpl.class, null, \"name\", name);", "originalCommit": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5Njk0OQ==", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404896949", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "author": "Coduz", "createdAt": "2020-04-07T15:23:19Z", "path": "service/user/internal/src/main/java/org/eclipse/kapua/service/user/internal/UserDAO.java", "diffHunk": "@@ -89,7 +89,7 @@ public static User find(EntityManager em, KapuaId scopeId, KapuaId userId) {\n      * @return\n      */\n     public static User findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, UserImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, UserImpl.class, null, \"name\", name);", "originalCommit": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5NzE3NQ==", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404897175", "bodyText": "Please use UserAttributes.EXTETNAL_ID", "author": "Coduz", "createdAt": "2020-04-07T15:23:34Z", "path": "service/user/internal/src/main/java/org/eclipse/kapua/service/user/internal/UserDAO.java", "diffHunk": "@@ -100,7 +100,7 @@ public static User findByName(EntityManager em, String name) {\n      * @return the user record, may be {@code null}\n      */\n     public static User findByExternalId(final EntityManager em, final String externalId) {\n-        return ServiceDAO.findByField(em, UserImpl.class, \"externalId\", externalId);\n+        return ServiceDAO.findByField(em, UserImpl.class, null, \"externalId\", externalId);", "originalCommit": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5NzQ5MA==", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404897490", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "author": "Coduz", "createdAt": "2020-04-07T15:23:59Z", "path": "commons/src/main/java/org/eclipse/kapua/commons/configuration/ServiceConfigDAO.java", "diffHunk": "@@ -83,7 +83,7 @@ public static ServiceConfig find(EntityManager em, KapuaId scopeId, KapuaId user\n      * @return\n      */\n     public static ServiceConfig findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, ServiceConfigImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, ServiceConfigImpl.class, null, \"name\", name);", "originalCommit": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkwMDkzOA==", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404900938", "bodyText": "I would have kept\n\nfindByField(em, clazz, name, value) \nfindByField(em, clazz, scopeId name, value)\n\nin order to avoid to pass null to a methods which usage could be confusing.\nAlso they actually have a slight difference which is that the one without scopeId needs checkaccess perfomed after invokation while with scopeId check access should have already happened", "author": "Coduz", "createdAt": "2020-04-07T15:28:20Z", "path": "commons/src/main/java/org/eclipse/kapua/commons/service/internal/ServiceDAO.java", "diffHunk": "@@ -268,14 +271,21 @@ protected ServiceDAO() {\n     /**\n      * Find by fields {@link KapuaEntity} utility method\n      *\n-     * @param em    The {@link EntityManager} that holds the transaction.\n-     * @param clazz The {@link KapuaEntity} class. This must be the implementing {@code class}.\n-     * @param name  The {@link KapuaEntity} name of the field from which to search.\n-     * @param value The value of the field from which to search.\n+     * @param em      The {@link EntityManager} that holds the transaction.\n+     * @param clazz   The {@link KapuaEntity} class. This must be the implementing {@code class}.\n+     * @param scopeId\n+     * @param name    The {@link KapuaEntity} name of the field from which to search.\n+     * @param value   The value of the field from which to search.\n      * @return The {@link KapuaEntity} found, or {@code null} if not found.\n+     * @throws NonUniqueResultException When more than one result is returned\n      * @since 1.0.0\n      */\n-    public static <E extends KapuaEntity> E findByField(@NotNull EntityManager em, @NotNull Class<E> clazz, @NotNull String name, @NotNull String value) {\n+    @Nullable\n+    public static <E extends KapuaEntity> E findByField(@NotNull EntityManager em,", "originalCommit": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "933bcabffb399cce5508a23390a83c91c6d133de", "url": "https://github.com/eclipse/kapua/commit/933bcabffb399cce5508a23390a83c91c6d133de", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-07T16:08:18Z", "type": "forcePushed"}, {"oid": "9b69d33795d1aaa91555a9b511fbf4986835bf4f", "url": "https://github.com/eclipse/kapua/commit/9b69d33795d1aaa91555a9b511fbf4986835bf4f", "message": "Throw exception if multiple results are found, non-string value search\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-08T15:54:23Z", "type": "commit"}, {"oid": "d7a516f6ebb4db1f62a5b71c05dddaf235f585b7", "url": "https://github.com/eclipse/kapua/commit/d7a516f6ebb4db1f62a5b71c05dddaf235f585b7", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-08T15:54:23Z", "type": "forcePushed"}, {"oid": "32bad670c3d6cc775b3ca2574ce763cb86322e4e", "url": "https://github.com/eclipse/kapua/commit/32bad670c3d6cc775b3ca2574ce763cb86322e4e", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-08T15:55:48Z", "type": "forcePushed"}, {"oid": "d08048c6b989b814ecdb1a6781e15ba26a7b24bf", "url": "https://github.com/eclipse/kapua/commit/d08048c6b989b814ecdb1a6781e15ba26a7b24bf", "message": "Use findByName() methods instead of query() where applicable\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-09T08:34:00Z", "type": "commit"}, {"oid": "183fa9350682645bab53b5cd16a8bc98a84604bc", "url": "https://github.com/eclipse/kapua/commit/183fa9350682645bab53b5cd16a8bc98a84604bc", "message": "Add scopeId to findByName\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-09T08:34:49Z", "type": "commit"}, {"oid": "2aacbd93d82c5b1d228e076fd32d7092c1a1824b", "url": "https://github.com/eclipse/kapua/commit/2aacbd93d82c5b1d228e076fd32d7092c1a1824b", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-09T08:35:10Z", "type": "commit"}, {"oid": "08bef72cf161873e34c3578dbb7b097bcf798895", "url": "https://github.com/eclipse/kapua/commit/08bef72cf161873e34c3578dbb7b097bcf798895", "message": "Add doPriviledge to findByField method calls\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-09T08:35:13Z", "type": "commit"}, {"oid": "08bef72cf161873e34c3578dbb7b097bcf798895", "url": "https://github.com/eclipse/kapua/commit/08bef72cf161873e34c3578dbb7b097bcf798895", "message": "Add doPriviledge to findByField method calls\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-09T08:35:13Z", "type": "forcePushed"}]}