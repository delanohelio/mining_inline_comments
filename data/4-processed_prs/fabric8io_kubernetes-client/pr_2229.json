{"pr_number": 2229, "pr_title": "Fix #2226: SharedIndexInformer for non-namespaced resources not working", "pr_createdAt": "2020-05-14T17:29:37Z", "pr_url": "https://github.com/fabric8io/kubernetes-client/pull/2229", "timeline": [{"oid": "4319c22ad58a34c03ad3e38b8ac2cbd69e796573", "url": "https://github.com/fabric8io/kubernetes-client/commit/4319c22ad58a34c03ad3e38b8ac2cbd69e796573", "message": "Fix #2226: SharedIndexInformer for non-namespaced resources not working\n\nWe are using BaseOperation for all list/watch operations in SharedInformerFactory, but\nwe are not aware of whether the resource is namespaced or not. This PR modifies code in\nBaseOperation to read it from the annotation inside class of Kubernetes resource.", "committedDate": "2020-05-15T06:05:06Z", "type": "forcePushed"}, {"oid": "17ac3a7835a217f3995346cebd07776ff84c5b48", "url": "https://github.com/fabric8io/kubernetes-client/commit/17ac3a7835a217f3995346cebd07776ff84c5b48", "message": "Fix #2226: SharedIndexInformer for non-namespaced resources not working\n\nWe are using BaseOperation for all list/watch operations in SharedInformerFactory, but\nwe are not aware of whether the resource is namespaced or not. This PR modifies code in\nBaseOperation to read it from the annotation inside class of Kubernetes resource.", "committedDate": "2020-05-15T12:06:20Z", "type": "forcePushed"}, {"oid": "17cf91fb9c5fa3766a4d21033ba1623f7082e1d1", "url": "https://github.com/fabric8io/kubernetes-client/commit/17cf91fb9c5fa3766a4d21033ba1623f7082e1d1", "message": "Fix #2226: SharedIndexInformer for non-namespaced resources not working\n\nWe are using BaseOperation for all list/watch operations in SharedInformerFactory, but\nwe are not aware of whether the resource is namespaced or not. This PR modifies code in\nBaseOperation to read it from the annotation inside class of Kubernetes resource.", "committedDate": "2020-05-15T13:57:49Z", "type": "forcePushed"}, {"oid": "337ea056437e8c88f4f6aa4709df41271f8519ec", "url": "https://github.com/fabric8io/kubernetes-client/commit/337ea056437e8c88f4f6aa4709df41271f8519ec", "message": "Fix #2226: SharedIndexInformer for non-namespaced resources not working\n\nWe are using BaseOperation for all list/watch operations in SharedInformerFactory, but\nwe are not aware of whether the resource is namespaced or not. This PR modifies code in\nBaseOperation to read it from the annotation inside class of Kubernetes resource.", "committedDate": "2020-05-15T14:16:14Z", "type": "forcePushed"}, {"oid": "8875aedb16c9560595e65d6896099f77a6b050b8", "url": "https://github.com/fabric8io/kubernetes-client/commit/8875aedb16c9560595e65d6896099f77a6b050b8", "message": "Updated Kubernetes Model to use Namespaced interface instead of annotation", "committedDate": "2020-05-19T11:26:42Z", "type": "forcePushed"}, {"oid": "cffc2f723065f4a03fd816128f43f9d48617dd14", "url": "https://github.com/fabric8io/kubernetes-client/commit/cffc2f723065f4a03fd816128f43f9d48617dd14", "message": "Updated Kubernetes Model to use Namespaced interface instead of annotation", "committedDate": "2020-05-19T11:49:21Z", "type": "forcePushed"}, {"oid": "32e52d876470886bc78c38bb1a437434e08c3e8b", "url": "https://github.com/fabric8io/kubernetes-client/commit/32e52d876470886bc78c38bb1a437434e08c3e8b", "message": "Fix failing PodCrudTest\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-19T16:52:08Z", "type": "forcePushed"}, {"oid": "5cc2747313e9a935533b45676ed991f28e5b8b0c", "url": "https://github.com/fabric8io/kubernetes-client/commit/5cc2747313e9a935533b45676ed991f28e5b8b0c", "message": "Fix failing PodCrudTest\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-20T07:26:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgxMjA1Mw==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2229#discussion_r427812053", "bodyText": "are you sure about the tab spacing here?", "author": "dev-gaur", "createdAt": "2020-05-20T07:56:36Z", "path": "kubernetes-model/pkg/schemagen/generate.go", "diffHunk": "@@ -30,29 +30,36 @@ type PackageDescriptor struct {\n }\n \n type schemaGenerator struct {\n-\ttypes              map[reflect.Type]*JSONObjectDescriptor\n-\ttypeNames          map[reflect.Type]string\n-\tcustomTypeNames    map[string]string\n-\tpackages           map[string]PackageDescriptor\n-\ttypeMap            map[reflect.Type]reflect.Type\n+\ttypes           map[reflect.Type]*JSONObjectDescriptor\n+\ttypeNames       map[reflect.Type]string\n+\tcustomTypeNames map[string]string", "originalCommit": "5cc2747313e9a935533b45676ed991f28e5b8b0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzNDkwOA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2229#discussion_r427834908", "bodyText": "Umm, I'm not sure. I just used go fmt kubernetes-model/pkg/schemagen/generate.go for formatting. Do you think it can have some side effects?", "author": "rohanKanojia", "createdAt": "2020-05-20T08:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgxMjA1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ2MDE0OQ==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2229#discussion_r428460149", "bodyText": "oh. If go fmt says so then its alright :)", "author": "dev-gaur", "createdAt": "2020-05-21T05:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgxMjA1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgxNjE0NQ==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2229#discussion_r427816145", "bodyText": "I see that you're trying to create an enumeration here. I suggest using iota\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tNamespaced CrdScope = 0\n          \n          \n            \n            \tCluster    CrdScope = 1\n          \n          \n            \n            \tNamespaced CrdScope = iota\n          \n          \n            \n            \tCluster    CrdScope = iota", "author": "dev-gaur", "createdAt": "2020-05-20T08:03:34Z", "path": "kubernetes-model/pkg/schemagen/generate.go", "diffHunk": "@@ -30,29 +30,36 @@ type PackageDescriptor struct {\n }\n \n type schemaGenerator struct {\n-\ttypes              map[reflect.Type]*JSONObjectDescriptor\n-\ttypeNames          map[reflect.Type]string\n-\tcustomTypeNames    map[string]string\n-\tpackages           map[string]PackageDescriptor\n-\ttypeMap            map[reflect.Type]reflect.Type\n+\ttypes           map[reflect.Type]*JSONObjectDescriptor\n+\ttypeNames       map[reflect.Type]string\n+\tcustomTypeNames map[string]string\n+\tpackages        map[string]PackageDescriptor\n+\ttypeMap         map[reflect.Type]reflect.Type\n }\n \n-func GenerateSchema(t reflect.Type, packages []PackageDescriptor, typeMap map[reflect.Type]reflect.Type, customTypeNames  map[string]string, moduleName string) (*JSONSchema, error) {\n+type CrdScope int32\n+\n+const (\n+\tNamespaced CrdScope = 0\n+\tCluster    CrdScope = 1", "originalCommit": "5cc2747313e9a935533b45676ed991f28e5b8b0c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgxODUwNA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2229#discussion_r427818504", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tswitch t.Name() {\n          \n          \n            \n            \tcase \"MutatingWebhookConfiguration\",\n          \n          \n            \n            \t\t\"ValidatingWebhookConfiguration\",\n          \n          \n            \n            \t\t\"CustomResourceDefinition\",\n          \n          \n            \n            \t\t\"ComponentStatus\",\n          \n          \n            \n            \t\t\"Namespace\",\n          \n          \n            \n            \t\t\"Node\",\n          \n          \n            \n            \t\t\"PersistentVolume\",\n          \n          \n            \n            \t\t\"PodSecurityPolicy\",\n          \n          \n            \n            \t\t\"ClusterRoleBinding\",\n          \n          \n            \n            \t\t\"ClusterRole\",\n          \n          \n            \n            \t\t\"PriorityClass\",\n          \n          \n            \n            \t\t\"StorageClass\":\n          \n          \n            \n            \t\treturn Cluster\n          \n          \n            \n            \t}\n          \n          \n            \n            \treturn Namespaced\n          \n          \n            \n            \tswitch t.Name() {\n          \n          \n            \n            \tcase \"MutatingWebhookConfiguration\",\n          \n          \n            \n            \t\t\"ValidatingWebhookConfiguration\",\n          \n          \n            \n            \t\t\"CustomResourceDefinition\",\n          \n          \n            \n            \t\t\"ComponentStatus\",\n          \n          \n            \n            \t\t\"Namespace\",\n          \n          \n            \n            \t\t\"Node\",\n          \n          \n            \n            \t\t\"PersistentVolume\",\n          \n          \n            \n            \t\t\"PodSecurityPolicy\",\n          \n          \n            \n            \t\t\"ClusterRoleBinding\",\n          \n          \n            \n            \t\t\"ClusterRole\",\n          \n          \n            \n            \t\t\"PriorityClass\",\n          \n          \n            \n            \t\t\"StorageClass\":\n          \n          \n            \n                        return Cluster\n          \n          \n            \n            \tdefault:\n          \n          \n            \n            \t    return Namespaced    \n          \n          \n            \n            \t}", "author": "dev-gaur", "createdAt": "2020-05-20T08:07:32Z", "path": "kubernetes-model/pkg/schemagen/generate.go", "diffHunk": "@@ -541,3 +553,22 @@ func (g *schemaGenerator) addConstraints(objectName string, propName string, pro\n func pkgPath(t reflect.Type) string {\n \treturn strings.TrimPrefix(t.PkgPath(), \"github.com/fabric8io/kubernetes-client/kubernetes-model/vendor/\")\n }\n+\n+func (g *schemaGenerator) crdScope(t reflect.Type) CrdScope {\n+\tswitch t.Name() {\n+\tcase \"MutatingWebhookConfiguration\",\n+\t\t\"ValidatingWebhookConfiguration\",\n+\t\t\"CustomResourceDefinition\",\n+\t\t\"ComponentStatus\",\n+\t\t\"Namespace\",\n+\t\t\"Node\",\n+\t\t\"PersistentVolume\",\n+\t\t\"PodSecurityPolicy\",\n+\t\t\"ClusterRoleBinding\",\n+\t\t\"ClusterRole\",\n+\t\t\"PriorityClass\",\n+\t\t\"StorageClass\":\n+\t\treturn Cluster\n+\t}\n+\treturn Namespaced", "originalCommit": "5cc2747313e9a935533b45676ed991f28e5b8b0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzMDQ1Mg==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2229#discussion_r427830452", "bodyText": "What's the benefit of this change?", "author": "rohanKanojia", "createdAt": "2020-05-20T08:27:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgxODUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkzNzkwNw==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2229#discussion_r427937907", "bodyText": "I think you're right. Switch case without default is generally considered code smell. let me modify this too in the next update.", "author": "rohanKanojia", "createdAt": "2020-05-20T11:32:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgxODUwNA=="}], "type": "inlineReview"}, {"oid": "5c0b47aada69049226858fc1189d1cb19239221e", "url": "https://github.com/fabric8io/kubernetes-client/commit/5c0b47aada69049226858fc1189d1cb19239221e", "message": "Fix failing PodCrudTest\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-20T08:11:39Z", "type": "forcePushed"}, {"oid": "9fd35f09657b3256ec8387f4975fbc3ac3b88a86", "url": "https://github.com/fabric8io/kubernetes-client/commit/9fd35f09657b3256ec8387f4975fbc3ac3b88a86", "message": "Fix failing PodCrudTest\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-20T08:48:40Z", "type": "forcePushed"}, {"oid": "9478c2ae66b6d8cdbc175cf98b629838a8c0488b", "url": "https://github.com/fabric8io/kubernetes-client/commit/9478c2ae66b6d8cdbc175cf98b629838a8c0488b", "message": "Fix failing PodCrudTest\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-20T08:55:00Z", "type": "forcePushed"}, {"oid": "dbc33ee223199bcf451befa07ffff85c8cf032be", "url": "https://github.com/fabric8io/kubernetes-client/commit/dbc33ee223199bcf451befa07ffff85c8cf032be", "message": "Fix failing tests\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-20T11:56:41Z", "type": "forcePushed"}, {"oid": "047870081ef152771a6a27ce979295ddb71c2c9c", "url": "https://github.com/fabric8io/kubernetes-client/commit/047870081ef152771a6a27ce979295ddb71c2c9c", "message": "Fix failing tests\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-20T14:20:19Z", "type": "forcePushed"}, {"oid": "60ac057cc7a8cfc256c8d2cca4725e9b240e2fef", "url": "https://github.com/fabric8io/kubernetes-client/commit/60ac057cc7a8cfc256c8d2cca4725e9b240e2fef", "message": "Fix failing tests\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-20T15:32:03Z", "type": "forcePushed"}, {"oid": "1702b9a66f4c11676487d319991929f96e8436c2", "url": "https://github.com/fabric8io/kubernetes-client/commit/1702b9a66f4c11676487d319991929f96e8436c2", "message": "Fix failing tests\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-20T16:07:38Z", "type": "forcePushed"}, {"oid": "b2c0b69e548f93ee18483e4cbabc17e1ce4af87b", "url": "https://github.com/fabric8io/kubernetes-client/commit/b2c0b69e548f93ee18483e4cbabc17e1ce4af87b", "message": "Fix #2226: SharedIndexInformer for non-namespaced resources not working\n\nWe are using BaseOperation for all list/watch operations in SharedInformerFactory, but\nwe are not aware of whether the resource is namespaced or not. This PR modifies code in\nBaseOperation to read it from the annotation inside class of Kubernetes resource.", "committedDate": "2020-05-21T08:49:21Z", "type": "commit"}, {"oid": "94857bd381b891eb7123112bfa975d7b17382ffd", "url": "https://github.com/fabric8io/kubernetes-client/commit/94857bd381b891eb7123112bfa975d7b17382ffd", "message": "Updated Kubernetes Model to use Namespaced interface instead of annotation", "committedDate": "2020-05-21T08:49:21Z", "type": "commit"}, {"oid": "c03d43ce1834a35cd279d1745605f910df57bbd2", "url": "https://github.com/fabric8io/kubernetes-client/commit/c03d43ce1834a35cd279d1745605f910df57bbd2", "message": "Fix failing tests\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-21T09:13:32Z", "type": "commit"}, {"oid": "c03d43ce1834a35cd279d1745605f910df57bbd2", "url": "https://github.com/fabric8io/kubernetes-client/commit/c03d43ce1834a35cd279d1745605f910df57bbd2", "message": "Fix failing tests\n\n+ Fix failing PodCrudTest\n+ Added Namespaced interface in Custom Resources used in tests", "committedDate": "2020-05-21T09:13:32Z", "type": "forcePushed"}]}