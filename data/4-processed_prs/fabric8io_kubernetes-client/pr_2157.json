{"pr_number": 2157, "pr_title": "Knative Generator Rewrite", "pr_createdAt": "2020-04-22T07:20:07Z", "pr_url": "https://github.com/fabric8io/kubernetes-client/pull/2157", "timeline": [{"oid": "f629b9c24f93ea1d07c80c36d4a96a020b8319ba", "url": "https://github.com/fabric8io/kubernetes-client/commit/f629b9c24f93ea1d07c80c36d4a96a020b8319ba", "message": "- only include CRDs (not Lists) in generated code", "committedDate": "2020-04-22T07:49:41Z", "type": "forcePushed"}, {"oid": "3b8b55e9498ec35b4c6155536be89b9e9bcc9977", "url": "https://github.com/fabric8io/kubernetes-client/commit/3b8b55e9498ec35b4c6155536be89b9e9bcc9977", "message": "[knative]\n- update generator to use shared logic\n- replace knative-annotator with shared model-annotator\n- remove the generated *Schema class\n\n[tekton]\n- update to knative package change\n\n[common]\n- add editorconfig for *.go (although this is not applied to all go files yet)", "committedDate": "2020-05-04T13:22:49Z", "type": "forcePushed"}, {"oid": "d9376eb01f7fc8c2f813a6b42738aee03177e750", "url": "https://github.com/fabric8io/kubernetes-client/commit/d9376eb01f7fc8c2f813a6b42738aee03177e750", "message": "This commit updates the generation logic for *OperationsImpl to include proper scoping (namespaced vs cluster-wide) for all parts using the rewritten go generator.\n\nChanges:\n- go configuration requires scoping definition for all CRDs\n- marker interface 'Namespaced' added\n- go generator adds the marker interface to all Namespaced CRDs\n- during the generation of the *OperationsImpl, the marker interface is used to detect the proper scoping.\n\nThis fixes #2193", "committedDate": "2020-05-05T16:15:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU0ODQwOA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2157#discussion_r420548408", "bodyText": "Umm, why have you removed all resources from duck v1beta1. Are they not part of Knative model?", "author": "rohanKanojia", "createdAt": "2020-05-06T05:11:02Z", "path": "extensions/knative/generator/cmd/generate/generate.go", "diffHunk": "@@ -16,169 +16,91 @@\n package main\n \n import (\n-\t\"bytes\"\n-\t\"encoding/json\"\n \t\"fmt\"\n-\t\"github.com/fabric8io/kubernetes-client/extensions/knative/generator/pkg/schemagen\"\n-\teventingv1alpha1 \"github.com/knative/eventing/pkg/apis/eventing/v1alpha1\"\n-\tmessagingv1alpha1 \"github.com/knative/eventing/pkg/apis/messaging/v1alpha1\"\n-\tservingv1 \"github.com/knative/serving/pkg/apis/serving/v1\"\n-  flowsv1alpha1 \"github.com/knative/eventing/pkg/apis/flows/v1alpha1\"\n-\tservingv1alpha1 \"github.com/knative/serving/pkg/apis/serving/v1alpha1\"\n-\tservingv1beta1 \"github.com/knative/serving/pkg/apis/serving/v1beta1\"\n-  duckv1alpha1 \"github.com/knative/eventing/pkg/apis/duck/v1alpha1\"\n-  duckv1beta1 \"github.com/knative/eventing/pkg/apis/duck/v1beta1\"\n-  legacysourcesv1alpha1 \"github.com/knative/eventing/pkg/apis/legacysources/v1alpha1\"\n-\n-\t\"log\"\n-\t\"os\"\n+\t\"github.com/fabric8io/kubernetes-client/generator/pkg/schemagen\"\n+\teventing_v1alpha1 \"github.com/knative/eventing/pkg/apis/eventing/v1alpha1\"\n+\tserving_v1 \"github.com/knative/serving/pkg/apis/serving/v1\"\n+\tserving_v1beta1 \"github.com/knative/serving/pkg/apis/serving/v1beta1\"\n+\t\"k8s.io/apimachinery/pkg/runtime\"\n+\tflows_v1alpha1 \"knative.dev/eventing/pkg/apis/flows/v1alpha1\"\n+\tmessaging_v1alpha1 \"knative.dev/eventing/pkg/apis/messaging/v1alpha1\"\n+\t\"knative.dev/pkg/apis\"\n \t\"reflect\"\n-\t\"strings\"\n-\t\"time\"\n )\n \n-//A Schema with the core types of the Service Catalog\n-type Schema struct {\n-\t//Serving\n-\tV1alpha1Service           servingv1alpha1.Service\n-\tV1alpha1ServiceList       servingv1alpha1.ServiceList\n-\tV1alpha1Route             servingv1alpha1.Route\n-\tV1alpha1RouteList         servingv1alpha1.RouteList\n-\tV1alpha1Revision          servingv1alpha1.Revision\n-\tV1alpha1RevisionList      servingv1alpha1.RevisionList\n-\tV1alpha1Configuration     servingv1alpha1.Configuration\n-\tV1alpha1ConfigurationList servingv1alpha1.ConfigurationList\n-\n-\tV1beta1Service           servingv1beta1.Service\n-\tV1beta1ServiceList       servingv1beta1.ServiceList\n-\tV1beta1Route             servingv1beta1.Route\n-\tV1beta1RouteList         servingv1beta1.RouteList\n-\tV1beta1Revision          servingv1beta1.Revision\n-\tV1beta1RevisionList      servingv1beta1.RevisionList\n-\tV1beta1Configuration     servingv1beta1.Configuration\n-\tV1beta1ConfigurationList servingv1beta1.ConfigurationList\n-\n-\tV1Service           servingv1.Service\n-\tV1ServiceList       servingv1.ServiceList\n-\tV1Route             servingv1.Route\n-\tV1RouteList         servingv1.RouteList\n-\tV1Revision          servingv1.Revision\n-\tV1RevisionList      servingv1.RevisionList\n-\tV1Configuration     servingv1.Configuration\n-\tV1ConfigurationList servingv1.ConfigurationList\n-\n-\t//Eventing\n-\tBroker                        eventingv1alpha1.Broker\n-\tBrokerList                    eventingv1alpha1.BrokerList\n-\tTrigger                       eventingv1alpha1.Trigger\n-\tTriggerList                   eventingv1alpha1.TriggerList\n-\tEventType                     eventingv1alpha1.EventType\n-\tEventTypeList                 eventingv1alpha1.EventTypeList\n-\n-\t//Eventing - Messaging\n-  Channel             messagingv1alpha1.Channel\n-  ChannelList         messagingv1alpha1.ChannelList\n-  Subscription        messagingv1alpha1.Subscription\n-  SubscriptionList    messagingv1alpha1.SubscriptionList\n-  InMemoryChannel     messagingv1alpha1.InMemoryChannel\n-  InMemoryChannelList messagingv1alpha1.InMemoryChannelList\n-\n-  Sequence                   flowsv1alpha1.Sequence\n-  SequenceList               flowsv1alpha1.SequenceList\n-  Parallel                   flowsv1alpha1.Parallel\n-  ParallelList               flowsv1alpha1.ParallelList\n-  ParallelBranch             flowsv1alpha1.ParallelBranch\n-  ParallelBranchStatus       flowsv1alpha1.ParallelBranchStatus\n-  ParallelChannelStatus      flowsv1alpha1.ParallelChannelStatus\n-  ParallelSubscriptionStatus flowsv1alpha1.ParallelSubscriptionStatus\n-\n-  V1alpha1Resource             duckv1alpha1.Resource\n-  V1alpha1ResourceList         duckv1alpha1.ResourceList\n-  V1alpha1Channelable          duckv1alpha1.Channelable\n-  V1alpha1ChanalableList       duckv1alpha1.ChannelableList\n-  V1alpha1Subscribable         duckv1alpha1.Subscribable\n-  V1alpha1SubscribableTypeList duckv1alpha1.SubscribableTypeList\n-  V1alpha1SubscribableType     duckv1alpha1.SubscribableType\n-\n-  V1beta1Subscribable         duckv1beta1.Subscribable\n-  V1beta1SubscribableList     duckv1beta1.SubscribableList\n-  V1beta1Channelable          duckv1beta1.Channelable\n-  V1beta1ChanalableList       duckv1beta1.ChannelableList\n-  V1beta1BackoffPolicyType    duckv1beta1.BackoffPolicyType\n-  V1beta1DeliverySpec         duckv1beta1.DeliverySpec\n-  V1beta1SubscriberStatus     duckv1beta1.SubscriberStatus\n-  V1beta1SubscribableStatus   duckv1beta1.SubscribableStatus\n-\n-\n-  ApiServerSource     legacysourcesv1alpha1.ApiServerSource\n-  ApiServerResource   legacysourcesv1alpha1.ApiServerResource\n-  ApiServerSourceList legacysourcesv1alpha1.ApiServerSourceList\n-  ContainerSource     legacysourcesv1alpha1.ContainerSource\n-  ContainerSourceList legacysourcesv1alpha1.ContainerSourceList\n-  CronJobSource       legacysourcesv1alpha1.CronJobSource\n-  CronJobSourceList   legacysourcesv1alpha1.CronJobSourceList\n-  SinkBinding         legacysourcesv1alpha1.SinkBinding\n-  SinkBindingList     legacysourcesv1alpha1.SinkBindingList\n-}\n-\n func main() {\n-\tpackages := []schemagen.PackageDescriptor{\n-\t\t{\"k8s.io/api/core/v1\", \"v1\", \"io.fabric8.kubernetes.api.model\", \"kubernetes_\"},\n-\t\t{\"k8s.io/apimachinery/pkg/api/resource\", \"v1\", \"io.fabric8.kubernetes.api.model\", \"kubernetes_\"},\n-\t\t{\"k8s.io/apimachinery/pkg/apis/meta/v1\", \"v1\", \"io.fabric8.kubernetes.api.model\", \"kubernetes_meta_\"},\n-\t\t{\"k8s.io/apimachinery/pkg/util\", \"v1\", \"io.fabric8.kubernetes.api.model\", \"kubernetes_uti_\"},\n-\t\t{\"k8s.io/apimachinery/pkg/runtime\", \"v1\", \"io.fabric8.kubernetes.api.model\", \"kubernetes_uti_\"},\n-\t\t{\"net/url\", \"v1\", \"io.fabric8.knative.net\", \"knative_\"},\n-\t\t{\"knative.dev/pkg/apis\", \"v1\", \"io.fabric8.knative.v1\", \"knative_\"},\n-\t\t{\"knative.dev/pkg/apis/v1alpha1\", \"v1alpha1\", \"io.fabric8.knative.v1\", \"knative_v1alpha1_\"},\n-\t\t{\"knative.dev/pkg/tracker\", \"tracker\", \"io.fabric8.knative.tracker\", \"knative_tracker_\"},\n-\t\t{\"github.com/knative/pkg/apis\", \"v1\", \"io.fabric8.knative.v1\", \"knative_\"},\n-\t\t{\"knative.dev/eventing/pkg/apis/duck/v1beta1\", \"duck\", \"io.fabric8.knative.dev.duck.v1beta1\", \"knative_dev_duck_v1beta1_\"},\n-\t\t{\"knative.dev/eventing/pkg/apis/duck/v1alpha1\", \"duck\", \"io.fabric8.knative.dev.duck.v1alpha1\", \"knative_dev_duck_v1alpha1_\"},\n-\t\t{\"knative.dev/pkg/apis/duck/v1\", \"duck\", \"io.fabric8.knative.duck.v1\", \"knative_dev_duck_v1_\"},\n-    {\"knative.dev/pkg/apis/duck/v1beta1\", \"duck\", \"io.fabric8.knative.duck.v1beta1\", \"knative_dev_duck_v1beta1_\"},\n-    {\"knative.dev/pkg/apis/duck/v1alpha1\", \"duck\", \"io.fabric8.knative.duck.v1alpha1\", \"knative_dev_duck_v1alpha1_\"},\n-\t\t{\"github.com/knative/pkg/apis/duck/v1\", \"duck\", \"io.fabric8.knative.duck.v1\", \"knative_duck_v1_\"},\n-\t\t{\"github.com/knative/serving/pkg/apis/serving/v1alpha1\", \"serving\", \"io.fabric8.knative.serving.v1alpha1\", \"knative_serving_v1alpha1_\"},\n-\t\t{\"github.com/knative/serving/pkg/apis/serving/v1beta1\", \"serving\", \"io.fabric8.knative.serving.v1beta1\", \"knative_serving_v1beta1_\"},\n-\t\t{\"github.com/knative/serving/pkg/apis/serving/v1\", \"serving\", \"io.fabric8.knative.serving.v1\", \"knative_serving_v1_\"},\n-\t\t{\"knative.dev/serving/pkg/apis/serving/v1\", \"serving\", \"io.fabric8.knative.serving.v1\", \"knative_serving_v1_\"},\n-\t\t{\"knative.dev/eventing/pkg/apis/messaging/v1beta1\", \"messaging\", \"io.fabric8.knative.dev.messaging.v1beta1\", \"knative_dev_messaging_v1beta1_\"},\n-\t\t{\"knative.dev/eventing/pkg/apis/duck/v1beta1\", \"duck\", \"io.fabric8.knative.dev.duck.v1beta1\", \"knative_dev_duck_v1beta1_\"},\n-\t\t{\"github.com/knative/eventing/pkg/apis/eventing/v1alpha1\", \"eventing\", \"io.fabric8.knative.eventing.v1alpha1\", \"knative_eventing_v1alpha1_\"},\n-\t\t{\"github.com/knative/eventing/pkg/apis/messaging/v1alpha1\", \"messaging\", \"io.fabric8.knative.messaging.v1alpha1\", \"knative_messaging_v1alpha1_\"},\n-    {\"github.com/knative/eventing/pkg/apis/messaging/v1beta1\", \"messaging\", \"io.fabric8.knative.messaging.v1beta1\", \"knative_messaging_v1beta1_\"},\n-\t\t{\"github.com/knative/eventing/pkg/apis/duck/v1alpha1\", \"duck\", \"io.fabric8.knative.duck.v1alpha1\", \"knative_duck_v1alpha1_\"},\n-    {\"github.com/knative/eventing/pkg/apis/duck/v1beta1\", \"duck\", \"io.fabric8.knative.duck.v1beta1\", \"knative_duck_v1beta1_\"},\n-    {\"github.com/knative/eventing/pkg/apis/flows/v1alpha1\", \"flows\", \"io.fabric8.knative.flows.v1alpha1\", \"knative_flows_v1alpha1_\"},\n-    {\"github.com/knative/eventing/pkg/apis/legacysources/v1alpha1\", \"legacysources\", \"io.fabric8.knative.legacysources.v1alpha1\", \"knative_legacysources_v1alpha1_\"},\n-\t}\n \n-\ttypeMap := map[reflect.Type]reflect.Type{\n-\t\treflect.TypeOf(time.Time{}): reflect.TypeOf(\"\"),\n-\t\treflect.TypeOf(struct{}{}):  reflect.TypeOf(\"\"),\n+\t// the CRD List types for which the model should be generated\n+\t// no other types need to be defined as they are auto discovered\n+\tcrdLists := []reflect.Type{\n+\n+\t\t// serving v1", "originalCommit": "3b8b55e9498ec35b4c6155536be89b9e9bcc9977", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY5NTIyNw==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2157#discussion_r420695227", "bodyText": "2 things:\n\nall types that are only used internally are auto-discovered by the generator. Only CRDs need to be passed in as a starting point.\nAFAIK everything related to duck is not a CRD exposed by knative. Instead that is somehow used internally for duck typing. I might be wrong on this, do you have other information?", "author": "Fabian-K", "createdAt": "2020-05-06T10:39:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU0ODQwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk0MzQyMA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2157#discussion_r421943420", "bodyText": "Umm, I don't have much idea about Knative. I think it's okay if duck classes were not exposed earlier. I was just concerned if we could break something by dropping something that was present earlier.", "author": "rohanKanojia", "createdAt": "2020-05-08T05:18:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU0ODQwOA=="}], "type": "inlineReview"}, {"oid": "3801b48583f505a4040b0ab13abf262742a9518d", "url": "https://github.com/fabric8io/kubernetes-client/commit/3801b48583f505a4040b0ab13abf262742a9518d", "message": "[knative]\n- update generator to use shared logic\n- replace knative-annotator with shared model-annotator\n- remove the generated *Schema class\n\n[tekton]\n- update to knative package change\n\n[common]\n- add editorconfig for *.go (although this is not applied to all go files yet)", "committedDate": "2020-05-06T10:15:01Z", "type": "commit"}, {"oid": "b1efad105f571483f33bb1b25c97d7eddbbe0d55", "url": "https://github.com/fabric8io/kubernetes-client/commit/b1efad105f571483f33bb1b25c97d7eddbbe0d55", "message": "[knative] add crd scoping information to generate.go", "committedDate": "2020-05-06T10:29:57Z", "type": "commit"}, {"oid": "b1efad105f571483f33bb1b25c97d7eddbbe0d55", "url": "https://github.com/fabric8io/kubernetes-client/commit/b1efad105f571483f33bb1b25c97d7eddbbe0d55", "message": "[knative] add crd scoping information to generate.go", "committedDate": "2020-05-06T10:29:57Z", "type": "forcePushed"}]}