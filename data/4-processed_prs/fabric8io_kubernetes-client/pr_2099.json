{"pr_number": 2099, "pr_title": "Fix #1586: Replace of Job should add extra selector property to the resource", "pr_createdAt": "2020-03-31T10:02:47Z", "pr_url": "https://github.com/fabric8io/kubernetes-client/pull/2099", "timeline": [{"oid": "cbfa52a0d2e1a58b5c7ff653fc5052b18043d6fb", "url": "https://github.com/fabric8io/kubernetes-client/commit/cbfa52a0d2e1a58b5c7ff653fc5052b18043d6fb", "message": "Fix #1586: Replace of Job should add extra selector property to the resource", "committedDate": "2020-03-31T10:01:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgxOTA2NQ==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2099#discussion_r400819065", "bodyText": "Is it possible that the replacing job (new) will contain additional labels?\nIf so, shouldn't we purAll labels from server and keep the current.\nWhat if replacing job is removing some labels, is this the expected behavior?", "author": "manusa", "createdAt": "2020-03-31T10:52:24Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/dsl/internal/JobOperationsImpl.java", "diffHunk": "@@ -223,4 +223,24 @@ public LogWatch watchLog(OutputStream out) {\n     }\n     return null;\n   }\n+\n+  @Override\n+  public Job replace(Job job) {\n+    if (job == null) {\n+      job = getItem();\n+    }\n+    // Fetch item from server and patch Selector and PodTemplate\n+    // metadata in case not present already in order to avoid 422\n+    Job jobFromServer = fromServer().get();\n+    if (job.getSpec().getSelector() == null) {\n+      job.getSpec().setSelector(jobFromServer.getSpec().getSelector());\n+    }\n+    if (job.getSpec().getTemplate().getMetadata() != null) {\n+      job.getSpec().getTemplate().getMetadata().setLabels(jobFromServer.getSpec().getTemplate().getMetadata().getLabels());", "originalCommit": "cbfa52a0d2e1a58b5c7ff653fc5052b18043d6fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgzMTkxOA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2099#discussion_r400831918", "bodyText": "Job resource's labels are different from PodTemplate's labels. I think these are assigned from kube-apiserver after initial creation.", "author": "rohanKanojia", "createdAt": "2020-03-31T11:16:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgxOTA2NQ=="}], "type": "inlineReview"}]}