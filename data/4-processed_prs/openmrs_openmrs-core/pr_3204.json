{"pr_number": 3204, "pr_title": "TRUNK-4830 Avoid running legacy liquibase changesets", "pr_createdAt": "2020-05-17T10:13:09Z", "pr_url": "https://github.com/openmrs/openmrs-core/pull/3204", "timeline": [{"oid": "504224d11b0efc3972addd234e809188530ac022", "url": "https://github.com/openmrs/openmrs-core/commit/504224d11b0efc3972addd234e809188530ac022", "message": "TRUNK-4830 log un-run change sets", "committedDate": "2020-05-17T09:59:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI0Mzg5OA==", "url": "https://github.com/openmrs/openmrs-core/pull/3204#discussion_r426243898", "bodyText": "I guess these are usually not many, from the performance perspective. Correct?", "author": "dkayiwa", "createdAt": "2020-05-17T10:24:29Z", "path": "api/src/main/java/org/openmrs/liquibase/ChangeLogDetective.java", "diffHunk": "@@ -157,13 +161,22 @@ boolean isVintageChangeSet(String filename, ChangeSet changeSet) {\n \t\t}\n \t\treturn false;\n \t}\n-\t\n-\tprivate void logUnrunChangeSetDetails(String filename, List<ChangeSet> filteredUnrunChangeSets) {\n-\t\tif (filteredUnrunChangeSets.size() < MAX_NUMBER_OF_CHANGE_SETS_TO_LOG) {\n-\t\t\tfor (ChangeSet changeSet : filteredUnrunChangeSets) {\n-\t\t\t\tlog.debug(\"file '{}' contains un-run change set with id '{}' by author '{}'\", filename, changeSet.getId(),\n+\n+\t/**\n+\t * Logs un-run change sets no more than a given number and only for the 1.9.x Liquibase snapshots.\n+\t * \n+\t * @return a boolean value indicating whether the change sets were logged. The value is used for testing.\n+\t */\n+\tboolean logUnRunChangeSetDetails( String filename, List<ChangeSet> ChangeSets) {\n+\t\tif (ChangeSets.size() < MAX_NUMBER_OF_CHANGE_SETS_TO_LOG", "originalCommit": "504224d11b0efc3972addd234e809188530ac022", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI0NDYzNA==", "url": "https://github.com/openmrs/openmrs-core/pull/3204#discussion_r426244634", "bodyText": "Yes, I remembered our discussion about having extra logs at all and took care to keep the number small.\nIn the case of the reference application there were two un-run change sets only and the max number to be logged is 9. If, for some reason, all of 1.9.x went missing, we still get the error and a single log messages stating the number of un-run change sets.\nIt took a couple of hours to recreate the bug and confirm what went wrong with the reference application yesterday, this patch is buying as and the community time where we can respond faster to any more findings.", "author": "WolfSchlegel", "createdAt": "2020-05-17T10:32:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI0Mzg5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI0NTc1MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3204#discussion_r426245750", "bodyText": "Fair enough. \ud83d\udc4d", "author": "dkayiwa", "createdAt": "2020-05-17T10:44:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI0Mzg5OA=="}], "type": "inlineReview"}]}