{"pr_number": 3135, "pr_title": "TRUNK-5068: Add tests to ProgramWorkflowService", "pr_createdAt": "2020-02-26T23:02:42Z", "pr_url": "https://github.com/openmrs/openmrs-core/pull/3135", "timeline": [{"oid": "6def676558c1272d840faf7fef9f8547f7395f10", "url": "https://github.com/openmrs/openmrs-core/commit/6def676558c1272d840faf7fef9f8547f7395f10", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-02-26T23:25:33Z", "type": "forcePushed"}, {"oid": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "url": "https://github.com/openmrs/openmrs-core/commit/43e87aeb06792488df3b8c8dea49d4409f73e62c", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-02-27T23:14:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyMzg3MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385723870", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tList<Program> programs = pws.getPrograms(\"MAL\");\n          \n          \n            \n            \t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:27:11Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0Njk3Mg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386046972", "bodyText": "I did this", "author": "alinmihaila99", "createdAt": "2020-02-29T18:39:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyMzg3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNDAzNg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385724036", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n          \n          \n            \n            \t\tList<Program> pRPrograms = pws.getPrograms(\"PR\");", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:27:32Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNDgxNQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385724815", "bodyText": "retireProgram_shouldTestRetireProgram is not descriptive enough what it has to do", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:29:00Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0Njk5Mg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386046992", "bodyText": "I put there a comment", "author": "alinmihaila99", "createdAt": "2020-02-29T18:40:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNDgxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NjgxNA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386096814", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void retireProgram_shouldTestRetireProgram() {\n          \n          \n            \n            \tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n          \n      \n    \n    \n  \n\nI meant to change the test case name. Please remove the comment. It is unnecessary. Also, you forgot to assert the retired reason in your test case.", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:42:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNDgxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNTQ5Mw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385725493", "bodyText": "shouldn't you also need to check whether workflow.getStates() is not empty?", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:30:16Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzAyMA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047020", "bodyText": "yes, I added this", "author": "alinmihaila99", "createdAt": "2020-02-29T18:40:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNTQ5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNjMxNQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385726315", "bodyText": "same as above comment for test case name", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:31:41Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NjU2NA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386096564", "bodyText": "I meant to modify the test case name like below. Leaving comment is not recommended to describe the test case. Please remove the comment.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void unretireProgram_shouldTestUnretireProgram() {\n          \n          \n            \n            \tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:37:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNjMxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNjgzMw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385726833", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tUser user = Context.getUserService().getAllUsers().get(0);\n          \n          \n            \n            \t\tUser testUser = Context.getUserService().getAllUsers().get(0);", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:32:44Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzA2NQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047065", "bodyText": "I changed the variable name", "author": "alinmihaila99", "createdAt": "2020-02-29T18:41:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNjgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNzIzNA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385727234", "bodyText": "unnecessary variable. You have only 1 usage of this variable.", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:33:21Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(user);\n+\t\tList<Program> list = pws.getAllPrograms();\n+\t\tString uuid = program.getUuid();", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzgzNA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047834", "bodyText": "I removed it", "author": "alinmihaila99", "createdAt": "2020-02-29T18:53:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNzIzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NjYwMQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386096601", "bodyText": "I don't see it. What I meant is the suggested change in line 813.", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:38:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNzIzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNzk4Nw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385727987", "bodyText": "what is this variable?", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:34:45Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(user);\n+\t\tList<Program> list = pws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tint i = 0;", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzEwMg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047102", "bodyText": "I left it there by accident. I removed this", "author": "alinmihaila99", "createdAt": "2020-02-29T18:41:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyNzk4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyODc3MQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385728771", "bodyText": "voidDate is not human understandable. Use a english name for void? what does this date is relevant.", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:36:20Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(user);\n+\t\tList<Program> list = pws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"expired\");\n+\t\tDate voidDate = patientProgram.getDateVoided();", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzI3NA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047274", "bodyText": "I added a comment", "author": "alinmihaila99", "createdAt": "2020-02-29T18:44:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyODc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NzA1Mg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386097052", "bodyText": "Adding comments is not the solution. You should rename your variable names. That is what I am expecting.", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:46:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyODc3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTQwMA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385729400", "bodyText": "same as my above comments on variable names", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:37:29Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(user);\n+\t\tList<Program> list = pws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"expired\");\n+\t\tDate voidDate = patientProgram.getDateVoided();\n+\t\tpatientProgram1 = pws.unvoidPatientProgram(patientProgram);\n+\t\tassertEquals(patientProgram1.getVoided(), false);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tif (voidDate != null && voidDate.equals(state.getDateVoided())) {\n+\t\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException1 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException1.expect(APIException.class);\n+\t\texpectedException1.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzI5MQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047291", "bodyText": "I put there some comments", "author": "alinmihaila99", "createdAt": "2020-02-29T18:44:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTQwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTU5NQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385729595", "bodyText": "what uuid is this?", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:37:50Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(user);\n+\t\tList<Program> list = pws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"expired\");\n+\t\tDate voidDate = patientProgram.getDateVoided();\n+\t\tpatientProgram1 = pws.unvoidPatientProgram(patientProgram);\n+\t\tassertEquals(patientProgram1.getVoided(), false);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tif (voidDate != null && voidDate.equals(state.getDateVoided())) {\n+\t\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException1 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException1.expect(APIException.class);\n+\t\texpectedException1.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tconceptStateConversion.setConcept(conceptStateConversion1.getConcept());\n+\t\tconceptStateConversion.setProgramWorkflow(conceptStateConversion1.getProgramWorkflow());\n+\t\tconceptStateConversion.setProgramWorkflowState(conceptStateConversion1.getProgramWorkflowState());\n+\t\tString uuid = conceptStateConversion.getUuid();", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzQ0OA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047448", "bodyText": "I added a new name to this variable", "author": "alinmihaila99", "createdAt": "2020-02-29T18:46:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTU5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTY5NA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385729694", "bodyText": "id is not a good name", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:38:02Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(user);\n+\t\tList<Program> list = pws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"expired\");\n+\t\tDate voidDate = patientProgram.getDateVoided();\n+\t\tpatientProgram1 = pws.unvoidPatientProgram(patientProgram);\n+\t\tassertEquals(patientProgram1.getVoided(), false);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tif (voidDate != null && voidDate.equals(state.getDateVoided())) {\n+\t\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException1 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException1.expect(APIException.class);\n+\t\texpectedException1.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tconceptStateConversion.setConcept(conceptStateConversion1.getConcept());\n+\t\tconceptStateConversion.setProgramWorkflow(conceptStateConversion1.getProgramWorkflow());\n+\t\tconceptStateConversion.setProgramWorkflowState(conceptStateConversion1.getProgramWorkflowState());\n+\t\tString uuid = conceptStateConversion.getUuid();\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t\tConceptStateConversion conceptStateConversion2 = dao.getConceptStateConversionByUuid(uuid);\n+\t\tassertEquals(uuid, conceptStateConversion2.getUuid());\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldTestGetConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tint id = conceptStateConversion1.getId();", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzQ3Mg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047472", "bodyText": "I added a new name for this variable", "author": "alinmihaila99", "createdAt": "2020-02-29T18:47:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTY5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTg1Ng==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385729856", "bodyText": "len is unnecessary variable name", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:38:24Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(user);\n+\t\tList<Program> list = pws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"expired\");\n+\t\tDate voidDate = patientProgram.getDateVoided();\n+\t\tpatientProgram1 = pws.unvoidPatientProgram(patientProgram);\n+\t\tassertEquals(patientProgram1.getVoided(), false);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tif (voidDate != null && voidDate.equals(state.getDateVoided())) {\n+\t\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException1 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException1.expect(APIException.class);\n+\t\texpectedException1.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tconceptStateConversion.setConcept(conceptStateConversion1.getConcept());\n+\t\tconceptStateConversion.setProgramWorkflow(conceptStateConversion1.getProgramWorkflow());\n+\t\tconceptStateConversion.setProgramWorkflowState(conceptStateConversion1.getProgramWorkflowState());\n+\t\tString uuid = conceptStateConversion.getUuid();\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t\tConceptStateConversion conceptStateConversion2 = dao.getConceptStateConversionByUuid(uuid);\n+\t\tassertEquals(uuid, conceptStateConversion2.getUuid());\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldTestGetConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tint id = conceptStateConversion1.getId();\n+\t\tConceptStateConversion conceptStateConversion2 = pws.getConceptStateConversion(id);\n+\t\tassertEquals(conceptStateConversion1, conceptStateConversion2);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllConceptStateConversion_shouldTestGetAllConceptStateConversion() {\n+\t\tList<ConceptStateConversion> conceptStateConversions = pws.getAllConceptStateConversions();\n+\t\tint len = conceptStateConversions.size();", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzQ4MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047480", "bodyText": "yes, I removed it", "author": "alinmihaila99", "createdAt": "2020-02-29T18:47:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTg1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTk4Mw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r385729983", "bodyText": "unnecessary variable", "author": "JudeNiroshan", "createdAt": "2020-02-28T14:38:38Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(user);\n+\t\tList<Program> list = pws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"expired\");\n+\t\tDate voidDate = patientProgram.getDateVoided();\n+\t\tpatientProgram1 = pws.unvoidPatientProgram(patientProgram);\n+\t\tassertEquals(patientProgram1.getVoided(), false);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tif (voidDate != null && voidDate.equals(state.getDateVoided())) {\n+\t\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException1 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException1.expect(APIException.class);\n+\t\texpectedException1.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tconceptStateConversion.setConcept(conceptStateConversion1.getConcept());\n+\t\tconceptStateConversion.setProgramWorkflow(conceptStateConversion1.getProgramWorkflow());\n+\t\tconceptStateConversion.setProgramWorkflowState(conceptStateConversion1.getProgramWorkflowState());\n+\t\tString uuid = conceptStateConversion.getUuid();\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t\tConceptStateConversion conceptStateConversion2 = dao.getConceptStateConversionByUuid(uuid);\n+\t\tassertEquals(uuid, conceptStateConversion2.getUuid());\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldTestGetConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tint id = conceptStateConversion1.getId();\n+\t\tConceptStateConversion conceptStateConversion2 = pws.getConceptStateConversion(id);\n+\t\tassertEquals(conceptStateConversion1, conceptStateConversion2);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllConceptStateConversion_shouldTestGetAllConceptStateConversion() {\n+\t\tList<ConceptStateConversion> conceptStateConversions = pws.getAllConceptStateConversions();\n+\t\tint len = conceptStateConversions.size();\n+\t\tassertEquals(len, 1);\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void purgeConceptStateConversion_shouldTestPurgeConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = pws.getAllConceptStateConversions().get(0);\n+\t\tContext.getProgramWorkflowService().purgeConceptStateConversion(conceptStateConversion, false);\n+\t\tList<ConceptStateConversion> list = pws.getAllConceptStateConversions();\n+\t\tint len = list.size();", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzQ5OA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047498", "bodyText": "I removed this", "author": "alinmihaila99", "createdAt": "2020-02-29T18:47:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyOTk4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAxNzc4MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386017780", "bodyText": "Is there a need for this variable ?", "author": "varung-31", "createdAt": "2020-02-29T10:13:52Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +751,249 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> programs = pws.getPrograms(\"MAL\");\n+\t\tList<Program> programs1 = pws.getPrograms(\"PR\");\n+\t\tassertEquals(programs.size(), 1);\n+\t\tassertEquals(programs1.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser user = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(user);\n+\t\tList<Program> list = pws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;", "originalCommit": "43e87aeb06792488df3b8c8dea49d4409f73e62c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0NzUyNg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386047526", "bodyText": "I left it there accidentally", "author": "alinmihaila99", "createdAt": "2020-02-29T18:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAxNzc4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5Njg5Mg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386096892", "bodyText": "Please remove it. I still see it here.", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:43:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAxNzc4MA=="}], "type": "inlineReview"}, {"oid": "45b5c0dba6a24922c151415a450ebbbc725a9a77", "url": "https://github.com/openmrs/openmrs-core/commit/45b5c0dba6a24922c151415a450ebbbc725a9a77", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-02-29T13:13:10Z", "type": "forcePushed"}, {"oid": "1a15175538f2a5bbac8eae40980470bc2de4a23f", "url": "https://github.com/openmrs/openmrs-core/commit/1a15175538f2a5bbac8eae40980470bc2de4a23f", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-02-29T13:24:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NjM4Nw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386096387", "bodyText": "You should move this line before the for loop.", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:35:19Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,262 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\t/*This method should retire a program, by setting a reason, and also\n+\t\tsetting it's workflows and workflow states to retired*/\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertNotNull(workflow.getStates());", "originalCommit": "1a15175538f2a5bbac8eae40980470bc2de4a23f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyNzg5OQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386727899", "bodyText": "Did this", "author": "alinmihaila99", "createdAt": "2020-03-03T00:12:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NjM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0ODAwNA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r395048004", "bodyText": "@alinmihaila99 It looks like there are a few of the comments where you said you made the changes, but they aren't reflected in the current PR. Could you make sure this is the most up-to-date code?", "author": "ibacher", "createdAt": "2020-03-19T14:02:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NjM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwNTEwNg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r399505106", "bodyText": "@alinmihaila99: Could you move this assertNotNull out of the for loop?", "author": "ibacher", "createdAt": "2020-03-27T19:52:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NjM4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NjY0Nw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386096647", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tProgram program1 = dao.getProgramByUuid(uuid);\n          \n          \n            \n            \t\tProgram program1 = dao.getProgramByUuid(program.getUuid());", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:39:08Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,262 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\t/*This method should retire a program, by setting a reason, and also\n+\t\tsetting it's workflows and workflow states to retired*/\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\t/*This method should unretire a program, by setting\n+\t\tit's workflows and workflow states  retired to false*/\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);", "originalCommit": "1a15175538f2a5bbac8eae40980470bc2de4a23f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyODQxMA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386728410", "bodyText": "I added this and erased the variable", "author": "alinmihaila99", "createdAt": "2020-03-03T00:13:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NjY0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5Njk3NQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386096975", "bodyText": "It is not a good practice to write comments for each variable you write. Make your variable names to interpret what it does instead of writing comments. So, please remove those comments.", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:45:10Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,262 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\t/*This method should retire a program, by setting a reason, and also\n+\t\tsetting it's workflows and workflow states to retired*/\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\t/*This method should unretire a program, by setting\n+\t\tit's workflows and workflow states  retired to false*/\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\t//patientProgram retains a PatientProgram", "originalCommit": "1a15175538f2a5bbac8eae40980470bc2de4a23f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyODYyMw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386728623", "bodyText": "I removed them", "author": "alinmihaila99", "createdAt": "2020-03-03T00:14:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5Njk3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NzE0Ng==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386097146", "bodyText": "just say newConceptStateConversion. You don't need that comment. Remove it.", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:47:27Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,262 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\t/*This method should retire a program, by setting a reason, and also\n+\t\tsetting it's workflows and workflow states to retired*/\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\t/*This method should unretire a program, by setting\n+\t\tit's workflows and workflow states  retired to false*/\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\t//patientProgram retains a PatientProgram\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\t\n+\t\t//patientProgramVoided is the patientProgram afeter voiding it\n+\t\tPatientProgram patientProgramVoided = pws.voidPatientProgram(patientProgram, \"expired\");\n+\t\t\n+\t\t//voidDate retains the voiding date for patientProgram\n+\t\tDate voidDate = patientProgram.getDateVoided();\n+\t\tpatientProgramVoided = pws.unvoidPatientProgram(patientProgram);\n+\t\tassertEquals(patientProgramVoided.getVoided(), false);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tif (voidDate != null && voidDate.equals(state.getDateVoided())) {\n+\t\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException1 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException1.expect(APIException.class);\n+\t\texpectedException1.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\t//conceptStateConversion is the ConceptStateConversion we want to be saved\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();", "originalCommit": "1a15175538f2a5bbac8eae40980470bc2de4a23f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NzIxNA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386097214", "bodyText": "you can rename the variable as existingConceptStateConversion. No need to write explainations as comments. remove it please.", "author": "JudeNiroshan", "createdAt": "2020-03-01T10:48:26Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,262 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldTestRetireProgram() {\n+\t\t/*This method should retire a program, by setting a reason, and also\n+\t\tsetting it's workflows and workflow states to retired*/\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t}\n+\t\t}\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldTestUnretireProgram() {\n+\t\t/*This method should unretire a program, by setting\n+\t\tit's workflows and workflow states  retired to false*/\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tString uuid = program.getUuid();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(uuid);\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tint i = 0;\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\t//patientProgram retains a PatientProgram\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\t\n+\t\t//patientProgramVoided is the patientProgram afeter voiding it\n+\t\tPatientProgram patientProgramVoided = pws.voidPatientProgram(patientProgram, \"expired\");\n+\t\t\n+\t\t//voidDate retains the voiding date for patientProgram\n+\t\tDate voidDate = patientProgram.getDateVoided();\n+\t\tpatientProgramVoided = pws.unvoidPatientProgram(patientProgram);\n+\t\tassertEquals(patientProgramVoided.getVoided(), false);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tif (voidDate != null && voidDate.equals(state.getDateVoided())) {\n+\t\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException1 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException1.expect(APIException.class);\n+\t\texpectedException1.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\t//conceptStateConversion is the ConceptStateConversion we want to be saved\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\t\n+\t\t/*conceptStateConversion1 is an existing ConceptStateConversion\n+\t\twe used this for taking some of it's attributes and assigning to \n+\t'\tthe conceptStateConversion*/\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);", "originalCommit": "1a15175538f2a5bbac8eae40980470bc2de4a23f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyODc1NQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r386728755", "bodyText": "Changed this", "author": "alinmihaila99", "createdAt": "2020-03-03T00:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5NzIxNA=="}], "type": "inlineReview"}, {"oid": "dfa82b05218d83c1617f7f34db3aedd2f55ff8e6", "url": "https://github.com/openmrs/openmrs-core/commit/dfa82b05218d83c1617f7f34db3aedd2f55ff8e6", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-03-02T21:12:49Z", "type": "forcePushed"}, {"oid": "e74128e7c20bae22d9b3166f475be7f6304f16a9", "url": "https://github.com/openmrs/openmrs-core/commit/e74128e7c20bae22d9b3166f475be7f6304f16a9", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-03-04T19:30:34Z", "type": "forcePushed"}, {"oid": "6408e665e6a89e93c3b2dae61312f7600f062f72", "url": "https://github.com/openmrs/openmrs-core/commit/6408e665e6a89e93c3b2dae61312f7600f062f72", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-03-18T20:23:52Z", "type": "forcePushed"}, {"oid": "d4b23a2bf03f6e7ad317ff16c4c546d8b6f922dc", "url": "https://github.com/openmrs/openmrs-core/commit/d4b23a2bf03f6e7ad317ff16c4c546d8b6f922dc", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-03-18T20:53:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0OTQ5MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r395049490", "bodyText": "Why don't you just mark the dao field as @Autowired?", "author": "ibacher", "createdAt": "2020-03-19T14:04:49Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -71,6 +78,9 @@ public void runBeforeEachTest() {\n \t\t\tencounterService = Context.getEncounterService();\n \t\t\tcs = Context.getConceptService();\n \t\t}\n+\t\tif (dao == null) {\n+\t\t\tdao = (ProgramWorkflowDAO) applicationContext.getBean(\"programWorkflowDAO\");", "originalCommit": "d4b23a2bf03f6e7ad317ff16c4c546d8b6f922dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNTEyMw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r396135123", "bodyText": "I did this and it worked. But i also did the same for class ProgramWorkflowServiceImpl and this causes some errors. This is the error:\nhttps://pastebin.com/T49m4Dzg", "author": "alinmihaila99", "createdAt": "2020-03-22T20:05:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0OTQ5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2OTAzOQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r396469039", "bodyText": "Since ProgramWorkflowService is the class being tested here, I wouldn't autowire or mock it, but instantiate it with new. I know Spring discourages the use of new, but it test cases, its fine.", "author": "ibacher", "createdAt": "2020-03-23T13:56:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0OTQ5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUwNTM4MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r396505380", "bodyText": "Ok, thank you!", "author": "alinmihaila99", "createdAt": "2020-03-23T14:46:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0OTQ5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MDUwMA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r395050500", "bodyText": "This program doesn't seem to have any associated ProgramWorkflows. Would it be possible to find one that does for this test?", "author": "ibacher", "createdAt": "2020-03-19T14:06:13Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,263 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);", "originalCommit": "d4b23a2bf03f6e7ad317ff16c4c546d8b6f922dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA5MTc0Nw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r396091747", "bodyText": "No, there are only 3 programs and none of them has workflows. What should I do?", "author": "alinmihaila99", "createdAt": "2020-03-22T13:08:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MDUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ3MTQzOQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r396471439", "bodyText": "Assuming you've found the XML files with data, add a new one with a program and give it some associated workflows. Or just also load the file org/openmrs/api/include/ProgramWorkflowServiceTest-otherProgramWorkflows.xml which has a single workflow for Program 2.", "author": "ibacher", "createdAt": "2020-03-23T14:00:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MDUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUwNjAyMw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r396506023", "bodyText": "Ok, I will try. Thank you!", "author": "alinmihaila99", "createdAt": "2020-03-23T14:47:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MDUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxMzY4MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r396513680", "bodyText": "Please reach out if you run into any difficulties implementing this!", "author": "ibacher", "createdAt": "2020-03-23T14:56:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MDUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzNjIyMA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r396536220", "bodyText": "Yes, thank you for support!", "author": "alinmihaila99", "createdAt": "2020-03-23T15:26:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MDUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkwNDQ5NA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r398904494", "bodyText": "I loaded the file and it worked. I will upload the commit soon", "author": "alinmihaila99", "createdAt": "2020-03-26T21:29:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MDUwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MDg2Ng==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r395050866", "bodyText": "You don't need this blank line here", "author": "ibacher", "createdAt": "2020-03-19T14:06:42Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,263 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t\t", "originalCommit": "d4b23a2bf03f6e7ad317ff16c4c546d8b6f922dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk0OTQ5Ng==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r398949496", "bodyText": "Removed it", "author": "alinmihaila99", "createdAt": "2020-03-26T23:22:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MDg2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MjQyOA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r395052428", "bodyText": "Why do we need another ExpectedException here?", "author": "ibacher", "createdAt": "2020-03-19T14:08:49Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,263 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(program.getUuid());\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();", "originalCommit": "d4b23a2bf03f6e7ad317ff16c4c546d8b6f922dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1Mjg4MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r395052880", "bodyText": "This should be at the top of the file with all the other fields. Also, it should be marked as protected.", "author": "ibacher", "createdAt": "2020-03-19T14:09:31Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,263 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(program.getUuid());\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();", "originalCommit": "d4b23a2bf03f6e7ad317ff16c4c546d8b6f922dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk0OTQxNQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r398949415", "bodyText": "Tried to do this and caused the following error:\nhttps://pastebin.com/bJnE0QDu", "author": "alinmihaila99", "createdAt": "2020-03-26T23:22:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1Mjg4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MzcwMw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r395053703", "bodyText": "Is this actually needed?", "author": "ibacher", "createdAt": "2020-03-19T14:10:40Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,263 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(program.getUuid());\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram existingPatientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram existingPatientProgramVoided = pws.voidPatientProgram(existingPatientProgram, \"expired\");\n+\t\tDate patientProgramDateVoided = existingPatientProgramVoided.getDateVoided();\n+\t\texistingPatientProgramVoided = pws.unvoidPatientProgram(existingPatientProgram);\n+\t\tassertEquals(existingPatientProgramVoided.getVoided(), false);\n+\t\tfor (PatientState state : existingPatientProgram.getStates()) {\n+\t\t\tif (patientProgramDateVoided != null && patientProgramDateVoided.equals(state.getDateVoided())) {\n+\t\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException1 = ExpectedException.none();", "originalCommit": "d4b23a2bf03f6e7ad317ff16c4c546d8b6f922dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk0ODk1OQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r398948959", "bodyText": "I removed all and put one on the top.", "author": "alinmihaila99", "createdAt": "2020-03-26T23:20:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MzcwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1ODgyNg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r395058826", "bodyText": "Please ensure that all states of this program are also properly voided", "author": "ibacher", "createdAt": "2020-03-19T14:17:34Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +750,263 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\tProgram programTest = pws.getAllPrograms().get(0);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(program.getUuid());\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Rule\n+\tpublic ExpectedException expectedException2 = ExpectedException.none();\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException2.expect(APIException.class);\n+\t\texpectedException2.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram existingPatientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram existingPatientProgramVoided = pws.voidPatientProgram(existingPatientProgram, \"expired\");\n+\t\tDate patientProgramDateVoided = existingPatientProgramVoided.getDateVoided();", "originalCommit": "d4b23a2bf03f6e7ad317ff16c4c546d8b6f922dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "373c34bd2f261cfbea9a7e5a506379ddf7e416de", "url": "https://github.com/openmrs/openmrs-core/commit/373c34bd2f261cfbea9a7e5a506379ddf7e416de", "message": "Upgrading hibernate-validator to 5.4.0-Final - TRUNK-5498", "committedDate": "2020-03-19T23:30:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwNDYwMw==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r399504603", "bodyText": "Do not use wildcard imports.", "author": "ibacher", "createdAt": "2020-03-27T19:51:31Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -16,15 +16,14 @@\n import static org.junit.Assert.assertThat;\n import static org.junit.Assert.assertTrue;\n \n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.Date;\n-import java.util.List;\n-import java.util.Set;\n+import java.util.*;", "originalCommit": "60cc1928679126b86a76040a200167259de865c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1NTMxMg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r406755312", "bodyText": "I added al required imports", "author": "alinmihaila99", "createdAt": "2020-04-10T13:23:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwNDYwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwNTMyNg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r399505326", "bodyText": "Please remove this excess empty space", "author": "ibacher", "createdAt": "2020-03-27T19:53:00Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +755,292 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\texecuteDataSet(\"org/openmrs/api/include/ProgramWorkflowServiceTest-otherProgramWorkflows.xml\");\n+\t\tConcept concept = Context.getConceptService().getConcept(12);\n+\t\tProgramWorkflow programWorkflow = dao.getProgramWorkflowsByConcept(concept).get(1);\n+\t\tArrayList<ProgramWorkflow> programWorkflows = new ArrayList<>();\n+\t\tprogramWorkflows.add(programWorkflow);\n+\t\tSet<ProgramWorkflow> allWorkflows = new HashSet<>(programWorkflows);\n+\t\tProgram programTest = pws.getAllPrograms().get(1);\n+\t\tprogramTest.setAllWorkflows(allWorkflows);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(program.getUuid());\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram existingPatientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram existingPatientProgramVoided = pws.voidPatientProgram(existingPatientProgram, \"expired\");\n+\t\tDate patientProgramDateVoided = existingPatientProgramVoided.getDateVoided();\n+\t\texistingPatientProgramVoided = pws.unvoidPatientProgram(existingPatientProgram);\n+\t\tassertEquals(existingPatientProgramVoided.getVoided(), false);\n+\t\tfor (PatientState state : existingPatientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\tif (patientProgramDateVoided != null && patientProgramDateVoided.equals(state.getDateVoided())) {\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: \" +\n+\t\t\t\"concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\tConceptStateConversion newConceptStateConversion = new ConceptStateConversion();\n+\t\tConceptStateConversion existingConceptStateConversion = pws.getAllConceptStateConversions().get(0);\n+\t\tnewConceptStateConversion.setConcept(existingConceptStateConversion.getConcept());\n+\t\tnewConceptStateConversion.setProgramWorkflow(existingConceptStateConversion.getProgramWorkflow());\n+\t\tnewConceptStateConversion.setProgramWorkflowState(existingConceptStateConversion.getProgramWorkflowState());\n+\t\tString conceptStateConversionUuid = newConceptStateConversion.getUuid();\n+\t\tpws.saveConceptStateConversion(newConceptStateConversion);\n+\t\tConceptStateConversion conceptStateConversion2 = dao.getConceptStateConversionByUuid(conceptStateConversionUuid);\n+\t\tassertEquals(conceptStateConversionUuid, conceptStateConversion2.getUuid());\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldTestGetConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tint conceptStateConversion1Id = conceptStateConversion1.getId();\n+\t\tConceptStateConversion conceptStateConversion2 = pws.getConceptStateConversion(conceptStateConversion1Id);\n+\t\tassertEquals(conceptStateConversion1, conceptStateConversion2);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllConceptStateConversion_shouldTestGetAllConceptStateConversion() {\n+\t\tList<ConceptStateConversion> conceptStateConversions = pws.getAllConceptStateConversions();\n+\t\tassertEquals(conceptStateConversions.size(), 1);\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void purgeConceptStateConversion_shouldTestPurgeConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = pws.getAllConceptStateConversions().get(0);\n+\t\tContext.getProgramWorkflowService().purgeConceptStateConversion(conceptStateConversion, false);\n+\t\tList<ConceptStateConversion> list = pws.getAllConceptStateConversions();\n+\t\tassertEquals(list.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getProgramsByConcept_shouldTestGetProgramsByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<Program> programs = pws.getProgramsByConcept(concept);\n+\t\tassertEquals(programs.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void programWorkflowsByConcept_shouldTestGetProgramWorkflowsByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<ProgramWorkflow> programWorkflows = pws.getProgramWorkflowsByConcept(concept);\n+\t\tassertEquals(programWorkflows.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void programWorkflowStatesByConcept_shouldTestGetProgramWorkflowStatesByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<ProgramWorkflowState> programWorkflowStates = pws.getProgramWorkflowStatesByConcept(concept);\n+\t\tassertEquals(programWorkflowStates.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllPrograms_shouldTestGetAllPrograms() {\n+\t\tList<Program> programs = pws.getAllPrograms();\n+\t\tassertEquals(programs.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldGetConceptStateConversion(){\n+\t\tProgramWorkflow programWorkflow = pws.getProgram(1).getWorkflow(2);\n+\t\tConcept concept = dao.getAllConceptStateConversions().get(0).getConcept();\n+\t\tConceptStateConversion conceptStateConversion = dao.getConceptStateConversion(programWorkflow, concept);\n+\t\tassertEquals(conceptStateConversion, dao.getAllConceptStateConversions().get(0));\n+\t}\n+\t\n+\t@Test \n+\tpublic void getProgram_shouldGetProgramByName(){\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tString programName = program.getName();\n+\t\tassertEquals(Context.getProgramWorkflowService().getProgramByName(programName), program);\n+\t}\n+\t\n+\t@Test\n+\tpublic void triggerStateConversion_shouldTrowConvertStateInvalidPatient(){\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"Attempting to convert state of an invalid patient\");\n+\t\tConcept trigger = Context.getConceptService().getAllConcepts().get(0);\n+\t\tDate dateConverted = new Date();\n+\t\tpwsi.triggerStateConversion(null, trigger, dateConverted);\n+\t}\n+\n+\t@Test\n+\tpublic void triggerStateConversion_shouldTrowConvertStatePatientWithoutValidTrigger(){\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"Attempting to convert state for a patient without a valid trigger concept\");\n+\t\tPatient patient = Context.getPatientService().getAllPatients().get(0);\n+\t\tDate dateConverted = new Date();\n+\t\tpwsi.triggerStateConversion(patient, null, dateConverted);\n+\t}\n+\n+\t@Test\n+\tpublic void triggerStateConversion_shouldTrowConvertStateInvalidDate(){\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"Invalid date for converting patient state\");\n+\t\tPatient patient = Context.getPatientService().getAllPatients().get(0);\n+\t\tConcept trigger = Context.getConceptService().getAllConcepts().get(0);\n+\t\tpwsi.triggerStateConversion(patient, trigger, null);\n+\t}\n+\t\n+\t\n+\t\n+\t\n+\t", "originalCommit": "60cc1928679126b86a76040a200167259de865c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1NTQzNg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r406755436", "bodyText": "Did this", "author": "alinmihaila99", "createdAt": "2020-04-10T13:24:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwNTMyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwNTQ0MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r399505440", "bodyText": "Throw instead of Trow", "author": "ibacher", "createdAt": "2020-03-27T19:53:17Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +755,292 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\texecuteDataSet(\"org/openmrs/api/include/ProgramWorkflowServiceTest-otherProgramWorkflows.xml\");\n+\t\tConcept concept = Context.getConceptService().getConcept(12);\n+\t\tProgramWorkflow programWorkflow = dao.getProgramWorkflowsByConcept(concept).get(1);\n+\t\tArrayList<ProgramWorkflow> programWorkflows = new ArrayList<>();\n+\t\tprogramWorkflows.add(programWorkflow);\n+\t\tSet<ProgramWorkflow> allWorkflows = new HashSet<>(programWorkflows);\n+\t\tProgram programTest = pws.getAllPrograms().get(1);\n+\t\tprogramTest.setAllWorkflows(allWorkflows);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(program.getUuid());\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram existingPatientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram existingPatientProgramVoided = pws.voidPatientProgram(existingPatientProgram, \"expired\");\n+\t\tDate patientProgramDateVoided = existingPatientProgramVoided.getDateVoided();\n+\t\texistingPatientProgramVoided = pws.unvoidPatientProgram(existingPatientProgram);\n+\t\tassertEquals(existingPatientProgramVoided.getVoided(), false);\n+\t\tfor (PatientState state : existingPatientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\tif (patientProgramDateVoided != null && patientProgramDateVoided.equals(state.getDateVoided())) {\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: \" +\n+\t\t\t\"concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\tConceptStateConversion newConceptStateConversion = new ConceptStateConversion();\n+\t\tConceptStateConversion existingConceptStateConversion = pws.getAllConceptStateConversions().get(0);\n+\t\tnewConceptStateConversion.setConcept(existingConceptStateConversion.getConcept());\n+\t\tnewConceptStateConversion.setProgramWorkflow(existingConceptStateConversion.getProgramWorkflow());\n+\t\tnewConceptStateConversion.setProgramWorkflowState(existingConceptStateConversion.getProgramWorkflowState());\n+\t\tString conceptStateConversionUuid = newConceptStateConversion.getUuid();\n+\t\tpws.saveConceptStateConversion(newConceptStateConversion);\n+\t\tConceptStateConversion conceptStateConversion2 = dao.getConceptStateConversionByUuid(conceptStateConversionUuid);\n+\t\tassertEquals(conceptStateConversionUuid, conceptStateConversion2.getUuid());\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldTestGetConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tint conceptStateConversion1Id = conceptStateConversion1.getId();\n+\t\tConceptStateConversion conceptStateConversion2 = pws.getConceptStateConversion(conceptStateConversion1Id);\n+\t\tassertEquals(conceptStateConversion1, conceptStateConversion2);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllConceptStateConversion_shouldTestGetAllConceptStateConversion() {\n+\t\tList<ConceptStateConversion> conceptStateConversions = pws.getAllConceptStateConversions();\n+\t\tassertEquals(conceptStateConversions.size(), 1);\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void purgeConceptStateConversion_shouldTestPurgeConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = pws.getAllConceptStateConversions().get(0);\n+\t\tContext.getProgramWorkflowService().purgeConceptStateConversion(conceptStateConversion, false);\n+\t\tList<ConceptStateConversion> list = pws.getAllConceptStateConversions();\n+\t\tassertEquals(list.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getProgramsByConcept_shouldTestGetProgramsByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<Program> programs = pws.getProgramsByConcept(concept);\n+\t\tassertEquals(programs.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void programWorkflowsByConcept_shouldTestGetProgramWorkflowsByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<ProgramWorkflow> programWorkflows = pws.getProgramWorkflowsByConcept(concept);\n+\t\tassertEquals(programWorkflows.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void programWorkflowStatesByConcept_shouldTestGetProgramWorkflowStatesByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<ProgramWorkflowState> programWorkflowStates = pws.getProgramWorkflowStatesByConcept(concept);\n+\t\tassertEquals(programWorkflowStates.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllPrograms_shouldTestGetAllPrograms() {\n+\t\tList<Program> programs = pws.getAllPrograms();\n+\t\tassertEquals(programs.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldGetConceptStateConversion(){\n+\t\tProgramWorkflow programWorkflow = pws.getProgram(1).getWorkflow(2);\n+\t\tConcept concept = dao.getAllConceptStateConversions().get(0).getConcept();\n+\t\tConceptStateConversion conceptStateConversion = dao.getConceptStateConversion(programWorkflow, concept);\n+\t\tassertEquals(conceptStateConversion, dao.getAllConceptStateConversions().get(0));\n+\t}\n+\t\n+\t@Test \n+\tpublic void getProgram_shouldGetProgramByName(){\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tString programName = program.getName();\n+\t\tassertEquals(Context.getProgramWorkflowService().getProgramByName(programName), program);\n+\t}\n+\t\n+\t@Test\n+\tpublic void triggerStateConversion_shouldTrowConvertStateInvalidPatient(){", "originalCommit": "60cc1928679126b86a76040a200167259de865c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1NTU0MQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r406755541", "bodyText": "yes, i corrected this mistakes", "author": "alinmihaila99", "createdAt": "2020-04-10T13:24:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwNTQ0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwNTQ4MQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r399505481", "bodyText": "Throw instead of Trow", "author": "ibacher", "createdAt": "2020-03-27T19:53:21Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +755,292 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\texecuteDataSet(\"org/openmrs/api/include/ProgramWorkflowServiceTest-otherProgramWorkflows.xml\");\n+\t\tConcept concept = Context.getConceptService().getConcept(12);\n+\t\tProgramWorkflow programWorkflow = dao.getProgramWorkflowsByConcept(concept).get(1);\n+\t\tArrayList<ProgramWorkflow> programWorkflows = new ArrayList<>();\n+\t\tprogramWorkflows.add(programWorkflow);\n+\t\tSet<ProgramWorkflow> allWorkflows = new HashSet<>(programWorkflows);\n+\t\tProgram programTest = pws.getAllPrograms().get(1);\n+\t\tprogramTest.setAllWorkflows(allWorkflows);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(program.getUuid());\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram existingPatientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram existingPatientProgramVoided = pws.voidPatientProgram(existingPatientProgram, \"expired\");\n+\t\tDate patientProgramDateVoided = existingPatientProgramVoided.getDateVoided();\n+\t\texistingPatientProgramVoided = pws.unvoidPatientProgram(existingPatientProgram);\n+\t\tassertEquals(existingPatientProgramVoided.getVoided(), false);\n+\t\tfor (PatientState state : existingPatientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\tif (patientProgramDateVoided != null && patientProgramDateVoided.equals(state.getDateVoided())) {\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: \" +\n+\t\t\t\"concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\tConceptStateConversion newConceptStateConversion = new ConceptStateConversion();\n+\t\tConceptStateConversion existingConceptStateConversion = pws.getAllConceptStateConversions().get(0);\n+\t\tnewConceptStateConversion.setConcept(existingConceptStateConversion.getConcept());\n+\t\tnewConceptStateConversion.setProgramWorkflow(existingConceptStateConversion.getProgramWorkflow());\n+\t\tnewConceptStateConversion.setProgramWorkflowState(existingConceptStateConversion.getProgramWorkflowState());\n+\t\tString conceptStateConversionUuid = newConceptStateConversion.getUuid();\n+\t\tpws.saveConceptStateConversion(newConceptStateConversion);\n+\t\tConceptStateConversion conceptStateConversion2 = dao.getConceptStateConversionByUuid(conceptStateConversionUuid);\n+\t\tassertEquals(conceptStateConversionUuid, conceptStateConversion2.getUuid());\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldTestGetConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tint conceptStateConversion1Id = conceptStateConversion1.getId();\n+\t\tConceptStateConversion conceptStateConversion2 = pws.getConceptStateConversion(conceptStateConversion1Id);\n+\t\tassertEquals(conceptStateConversion1, conceptStateConversion2);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllConceptStateConversion_shouldTestGetAllConceptStateConversion() {\n+\t\tList<ConceptStateConversion> conceptStateConversions = pws.getAllConceptStateConversions();\n+\t\tassertEquals(conceptStateConversions.size(), 1);\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void purgeConceptStateConversion_shouldTestPurgeConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = pws.getAllConceptStateConversions().get(0);\n+\t\tContext.getProgramWorkflowService().purgeConceptStateConversion(conceptStateConversion, false);\n+\t\tList<ConceptStateConversion> list = pws.getAllConceptStateConversions();\n+\t\tassertEquals(list.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getProgramsByConcept_shouldTestGetProgramsByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<Program> programs = pws.getProgramsByConcept(concept);\n+\t\tassertEquals(programs.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void programWorkflowsByConcept_shouldTestGetProgramWorkflowsByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<ProgramWorkflow> programWorkflows = pws.getProgramWorkflowsByConcept(concept);\n+\t\tassertEquals(programWorkflows.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void programWorkflowStatesByConcept_shouldTestGetProgramWorkflowStatesByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<ProgramWorkflowState> programWorkflowStates = pws.getProgramWorkflowStatesByConcept(concept);\n+\t\tassertEquals(programWorkflowStates.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllPrograms_shouldTestGetAllPrograms() {\n+\t\tList<Program> programs = pws.getAllPrograms();\n+\t\tassertEquals(programs.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldGetConceptStateConversion(){\n+\t\tProgramWorkflow programWorkflow = pws.getProgram(1).getWorkflow(2);\n+\t\tConcept concept = dao.getAllConceptStateConversions().get(0).getConcept();\n+\t\tConceptStateConversion conceptStateConversion = dao.getConceptStateConversion(programWorkflow, concept);\n+\t\tassertEquals(conceptStateConversion, dao.getAllConceptStateConversions().get(0));\n+\t}\n+\t\n+\t@Test \n+\tpublic void getProgram_shouldGetProgramByName(){\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tString programName = program.getName();\n+\t\tassertEquals(Context.getProgramWorkflowService().getProgramByName(programName), program);\n+\t}\n+\t\n+\t@Test\n+\tpublic void triggerStateConversion_shouldTrowConvertStateInvalidPatient(){\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"Attempting to convert state of an invalid patient\");\n+\t\tConcept trigger = Context.getConceptService().getAllConcepts().get(0);\n+\t\tDate dateConverted = new Date();\n+\t\tpwsi.triggerStateConversion(null, trigger, dateConverted);\n+\t}\n+\n+\t@Test\n+\tpublic void triggerStateConversion_shouldTrowConvertStatePatientWithoutValidTrigger(){", "originalCommit": "60cc1928679126b86a76040a200167259de865c1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwNTU1MQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r399505551", "bodyText": "Throw instead of Trow", "author": "ibacher", "createdAt": "2020-03-27T19:53:28Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +755,292 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\texecuteDataSet(\"org/openmrs/api/include/ProgramWorkflowServiceTest-otherProgramWorkflows.xml\");\n+\t\tConcept concept = Context.getConceptService().getConcept(12);\n+\t\tProgramWorkflow programWorkflow = dao.getProgramWorkflowsByConcept(concept).get(1);\n+\t\tArrayList<ProgramWorkflow> programWorkflows = new ArrayList<>();\n+\t\tprogramWorkflows.add(programWorkflow);\n+\t\tSet<ProgramWorkflow> allWorkflows = new HashSet<>(programWorkflows);\n+\t\tProgram programTest = pws.getAllPrograms().get(1);\n+\t\tprogramTest.setAllWorkflows(allWorkflows);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(program.getUuid());\n+\t\tassertEquals(program, program1);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestThrowPatientStateRequiresException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'PatientProgram(id=1, patient=Patient#2, program=Program(id=1, concept=Concept #1738, \" +\n+\t\t\t\t\t\t\t\t\t\t\t\"workflows=[ProgramWorkflow(id=1), ProgramWorkflow(id=2)]))' failed to validate with reason: states: {0} is required for a patient state\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setState(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getPatientProgram(), patientProgram);\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldThrowPatientProgramAlreadyAssignedException() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"This PatientProgram contains a ProgramWorkflowState whose parent is already assigned \" +\n+\t\t\t\t\t\t\t\t\t\t\t \"to PatientProgram(id=2, patient=Patient#2, program=Program(id=2, concept=Concept #10, workflows=[]))\");\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.getPatientProgram(2);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setPatientProgram(patientProgram1);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t}\n+\t\n+\t@Test\n+\tpublic void savePatientProgram_shouldTestSetState() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tpws.voidPatientProgram(patientProgram, \"test\");\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tstate.setVoided(false);\n+\t\t\tstate.setVoidReason(null);\n+\t\t}\n+\t\tpws.savePatientProgram(patientProgram);\n+\t\tfor (PatientState state : patientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), true);\n+\t\t\tassertEquals(state.getVoidReason(), \"test\");\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.getMemberIds().clear();\n+\t\tpatientPrograms = dao.getPatientPrograms(null, programs);\n+\t\tassertEquals(patientPrograms.size(), 4);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetProgramsIfCohortIsNotEmpty() {\n+\t\tCohort cohort = new Cohort();\n+\t\tCollection<Program> programs = pws.getAllPrograms();\n+\t\tList<PatientProgram> patientPrograms;\n+\t\tcohort.addMember(1);\n+\t\tcohort.addMember(2);\n+\t\tpatientPrograms = dao.getPatientPrograms(cohort, programs);\n+\t\tassertEquals(patientPrograms.size(), 2);\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void voidPatientProgram_shouldTestVoidPatientProgram() {\n+\t\tPatientProgram patientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram patientProgram1 = pws.voidPatientProgram(patientProgram, \"abc\");\n+\t\tassertEquals(patientProgram1.getVoided(), true);\n+\t\tassertEquals(patientProgram1.getVoidReason(), \"abc\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unvoidPatientProgram_shouldTestUnvoidPatientProgram() {\n+\t\tPatientProgram existingPatientProgram = pws.getPatientProgram(1);\n+\t\tPatientProgram existingPatientProgramVoided = pws.voidPatientProgram(existingPatientProgram, \"expired\");\n+\t\tDate patientProgramDateVoided = existingPatientProgramVoided.getDateVoided();\n+\t\texistingPatientProgramVoided = pws.unvoidPatientProgram(existingPatientProgram);\n+\t\tassertEquals(existingPatientProgramVoided.getVoided(), false);\n+\t\tfor (PatientState state : existingPatientProgram.getStates()) {\n+\t\t\tassertEquals(state.getVoided(), false);\n+\t\t\tif (patientProgramDateVoided != null && patientProgramDateVoided.equals(state.getDateVoided())) {\n+\t\t\t\tassertNull(state.getVoidedBy());\n+\t\t\t\tassertNull(state.getDateVoided());\n+\t\t\t\tassertNull(state.getVoidReason());\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldThrowConceptStateConversionRequire() {\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"'ConceptStateConversion: Concept[null] results in State [null] for workflow [null]' failed to validate with reason: \" +\n+\t\t\t\"concept: Invalid concept, programWorkflow: Invalid Programme Workflow, programWorkflowState: Invalid Programme Workflow State\");\n+\t\tConceptStateConversion conceptStateConversion = new ConceptStateConversion();\n+\t\tconceptStateConversion.setConcept(null);\n+\t\tpws.saveConceptStateConversion(conceptStateConversion);\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveConceptStateConversion_shouldTestSaveConceptStateConversion() {\n+\t\tConceptStateConversion newConceptStateConversion = new ConceptStateConversion();\n+\t\tConceptStateConversion existingConceptStateConversion = pws.getAllConceptStateConversions().get(0);\n+\t\tnewConceptStateConversion.setConcept(existingConceptStateConversion.getConcept());\n+\t\tnewConceptStateConversion.setProgramWorkflow(existingConceptStateConversion.getProgramWorkflow());\n+\t\tnewConceptStateConversion.setProgramWorkflowState(existingConceptStateConversion.getProgramWorkflowState());\n+\t\tString conceptStateConversionUuid = newConceptStateConversion.getUuid();\n+\t\tpws.saveConceptStateConversion(newConceptStateConversion);\n+\t\tConceptStateConversion conceptStateConversion2 = dao.getConceptStateConversionByUuid(conceptStateConversionUuid);\n+\t\tassertEquals(conceptStateConversionUuid, conceptStateConversion2.getUuid());\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldTestGetConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion1 = pws.getAllConceptStateConversions().get(0);\n+\t\tint conceptStateConversion1Id = conceptStateConversion1.getId();\n+\t\tConceptStateConversion conceptStateConversion2 = pws.getConceptStateConversion(conceptStateConversion1Id);\n+\t\tassertEquals(conceptStateConversion1, conceptStateConversion2);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllConceptStateConversion_shouldTestGetAllConceptStateConversion() {\n+\t\tList<ConceptStateConversion> conceptStateConversions = pws.getAllConceptStateConversions();\n+\t\tassertEquals(conceptStateConversions.size(), 1);\n+\t\t\n+\t}\n+\t\n+\t@Test\n+\tpublic void purgeConceptStateConversion_shouldTestPurgeConceptStateConversion() {\n+\t\tConceptStateConversion conceptStateConversion = pws.getAllConceptStateConversions().get(0);\n+\t\tContext.getProgramWorkflowService().purgeConceptStateConversion(conceptStateConversion, false);\n+\t\tList<ConceptStateConversion> list = pws.getAllConceptStateConversions();\n+\t\tassertEquals(list.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getProgramsByConcept_shouldTestGetProgramsByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<Program> programs = pws.getProgramsByConcept(concept);\n+\t\tassertEquals(programs.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void programWorkflowsByConcept_shouldTestGetProgramWorkflowsByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<ProgramWorkflow> programWorkflows = pws.getProgramWorkflowsByConcept(concept);\n+\t\tassertEquals(programWorkflows.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void programWorkflowStatesByConcept_shouldTestGetProgramWorkflowStatesByConcept() {\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tList<ProgramWorkflowState> programWorkflowStates = pws.getProgramWorkflowStatesByConcept(concept);\n+\t\tassertEquals(programWorkflowStates.size(), 0);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getAllPrograms_shouldTestGetAllPrograms() {\n+\t\tList<Program> programs = pws.getAllPrograms();\n+\t\tassertEquals(programs.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void getConceptStateConversion_shouldGetConceptStateConversion(){\n+\t\tProgramWorkflow programWorkflow = pws.getProgram(1).getWorkflow(2);\n+\t\tConcept concept = dao.getAllConceptStateConversions().get(0).getConcept();\n+\t\tConceptStateConversion conceptStateConversion = dao.getConceptStateConversion(programWorkflow, concept);\n+\t\tassertEquals(conceptStateConversion, dao.getAllConceptStateConversions().get(0));\n+\t}\n+\t\n+\t@Test \n+\tpublic void getProgram_shouldGetProgramByName(){\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tString programName = program.getName();\n+\t\tassertEquals(Context.getProgramWorkflowService().getProgramByName(programName), program);\n+\t}\n+\t\n+\t@Test\n+\tpublic void triggerStateConversion_shouldTrowConvertStateInvalidPatient(){\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"Attempting to convert state of an invalid patient\");\n+\t\tConcept trigger = Context.getConceptService().getAllConcepts().get(0);\n+\t\tDate dateConverted = new Date();\n+\t\tpwsi.triggerStateConversion(null, trigger, dateConverted);\n+\t}\n+\n+\t@Test\n+\tpublic void triggerStateConversion_shouldTrowConvertStatePatientWithoutValidTrigger(){\n+\t\texpectedException.expect(APIException.class);\n+\t\texpectedException.expectMessage(\"Attempting to convert state for a patient without a valid trigger concept\");\n+\t\tPatient patient = Context.getPatientService().getAllPatients().get(0);\n+\t\tDate dateConverted = new Date();\n+\t\tpwsi.triggerStateConversion(patient, null, dateConverted);\n+\t}\n+\n+\t@Test\n+\tpublic void triggerStateConversion_shouldTrowConvertStateInvalidDate(){", "originalCommit": "60cc1928679126b86a76040a200167259de865c1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwOTUwOQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r399509509", "bodyText": "Instead of doing this here, I would create a constant with the others, something like protected static final OTHER_PROGRAM_WORKFLOWS = \"org/openmrs/api/include/ProgramWorkflowServiceTest-otherProgramWorkflows.xml\";\nThen add to the runBeforeEachTest() method:\nexecuteDataset(OTHER_PROGRAM_WORKFLOWS).", "author": "ibacher", "createdAt": "2020-03-27T20:01:43Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +755,292 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\texecuteDataSet(\"org/openmrs/api/include/ProgramWorkflowServiceTest-otherProgramWorkflows.xml\");", "originalCommit": "60cc1928679126b86a76040a200167259de865c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1NTY3OQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r406755679", "bodyText": "Moved this in the method you specified", "author": "alinmihaila99", "createdAt": "2020-04-10T13:24:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwOTUwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MTkyMA==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r399691920", "bodyText": "Do we need this variable ?", "author": "varung-31", "createdAt": "2020-03-28T18:08:56Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +755,292 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\texecuteDataSet(\"org/openmrs/api/include/ProgramWorkflowServiceTest-otherProgramWorkflows.xml\");\n+\t\tConcept concept = Context.getConceptService().getConcept(12);\n+\t\tProgramWorkflow programWorkflow = dao.getProgramWorkflowsByConcept(concept).get(1);\n+\t\tArrayList<ProgramWorkflow> programWorkflows = new ArrayList<>();\n+\t\tprogramWorkflows.add(programWorkflow);\n+\t\tSet<ProgramWorkflow> allWorkflows = new HashSet<>(programWorkflows);\n+\t\tProgram programTest = pws.getAllPrograms().get(1);\n+\t\tprogramTest.setAllWorkflows(allWorkflows);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);", "originalCommit": "60cc1928679126b86a76040a200167259de865c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1NTc1Mg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r406755752", "bodyText": "I removed it", "author": "alinmihaila99", "createdAt": "2020-04-10T13:24:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MTkyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MjA2Ng==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r399692066", "bodyText": "Please think of a better variable name\n\"program1\" doesn't really signify anything.", "author": "varung-31", "createdAt": "2020-03-28T18:10:44Z", "path": "api/src/test/java/org/openmrs/api/ProgramWorkflowServiceTest.java", "diffHunk": "@@ -740,7 +755,292 @@ public void shouldTestPurgeProgramAttributeType() throws Exception {\n                 int totalAttributeTypes = pws.getAllProgramAttributeTypes().size();\n \t\tpws.purgeProgramAttributeType(programAttributeType);\n \t\tassertEquals((totalAttributeTypes - 1), pws.getAllProgramAttributeTypes().size());\n-}\n+\t}\n+\t\n+\t\n+\t@Test\n+\tpublic void getPrograms_shouldTestGetPrograms() {\n+\t\tList<Program> malPrograms = pws.getPrograms(\"MAL\");\n+\t\tList<Program> prPrograms = pws.getPrograms(\"PR\");\n+\t\tassertEquals(malPrograms.size(), 1);\n+\t\tassertEquals(prPrograms.size(), 3);\n+\t}\n+\t\n+\t@Test\n+\tpublic void retireProgram_shouldSetRetiredStateToFalseAndSetAReason() {\n+\t\texecuteDataSet(\"org/openmrs/api/include/ProgramWorkflowServiceTest-otherProgramWorkflows.xml\");\n+\t\tConcept concept = Context.getConceptService().getConcept(12);\n+\t\tProgramWorkflow programWorkflow = dao.getProgramWorkflowsByConcept(concept).get(1);\n+\t\tArrayList<ProgramWorkflow> programWorkflows = new ArrayList<>();\n+\t\tprogramWorkflows.add(programWorkflow);\n+\t\tSet<ProgramWorkflow> allWorkflows = new HashSet<>(programWorkflows);\n+\t\tProgram programTest = pws.getAllPrograms().get(1);\n+\t\tprogramTest.setAllWorkflows(allWorkflows);\n+\t\tProgram program = pws.retireProgram(programTest, \"expired\");\n+\t\tfor (ProgramWorkflow workflow : program.getWorkflows()) {\n+\t\t\tassertEquals(workflow.getRetired(), true);\n+\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\tassertNotNull(workflow.getStates());\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t\tassertEquals(state.getRetired(), true);\n+\t\t\t}\n+\t\t}\n+\t\tassertEquals(program.getRetireReason(), \"expired\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void unretireProgram_shouldSetRetireFalseForWorkflowsAndWorkflowStates() {\n+\t\tProgram program = pws.getAllPrograms().get(0);\n+\t\tDate lastModifiedDate = program.getDateChanged();\n+\t\tProgram program1 = pws.unretireProgram(program);\n+\t\tassertEquals(program.getRetired(), false);\n+\t\tfor (ProgramWorkflow workflow : program.getAllWorkflows()) {\n+\t\t\tif (lastModifiedDate != null && lastModifiedDate.equals(workflow.getDateChanged())) {\n+\t\t\t\tassertEquals(workflow.getRetired(), false);\n+\t\t\t\tfor (ProgramWorkflowState state : workflow.getStates()) {\n+\t\t\t\t\tif (lastModifiedDate.equals(state.getDateChanged())) {\n+\t\t\t\t\t\tassertEquals(state.getRetired(), false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void saveUnretireProgram_shouldTestSaveUnretireProgram() {\n+\t\tProgram program = new Program();\n+\t\tConcept concept = Context.getConceptService().getAllConcepts().get(0);\n+\t\tUser testUser = Context.getUserService().getAllUsers().get(0);\n+\t\tprogram.setConcept(concept);\n+\t\tprogram.setDescription(\"test\");\n+\t\tprogram.setName(\"programTest\");\n+\t\tprogram.setCreator(testUser);\n+\t\tpws.getAllPrograms();\n+\t\tpws.retireProgram(program, \"abc\");\n+\t\tpws.unretireProgram(program);\n+\t\tProgram program1 = dao.getProgramByUuid(program.getUuid());", "originalCommit": "60cc1928679126b86a76040a200167259de865c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc1NTgyMg==", "url": "https://github.com/openmrs/openmrs-core/pull/3135#discussion_r406755822", "bodyText": "I changed the name", "author": "alinmihaila99", "createdAt": "2020-04-10T13:25:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MjA2Ng=="}], "type": "inlineReview"}, {"oid": "bce2e65634f4f68f0dd39214d4ebf20c0db251e5", "url": "https://github.com/openmrs/openmrs-core/commit/bce2e65634f4f68f0dd39214d4ebf20c0db251e5", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-04-10T13:35:34Z", "type": "commit"}, {"oid": "bce2e65634f4f68f0dd39214d4ebf20c0db251e5", "url": "https://github.com/openmrs/openmrs-core/commit/bce2e65634f4f68f0dd39214d4ebf20c0db251e5", "message": "TRUNK-5068 Add tests to ProgramWorkflowService", "committedDate": "2020-04-10T13:35:34Z", "type": "forcePushed"}]}