{"pr_number": 3550, "pr_title": "TRUNK-5821: Adding indices to order_number and accession_number colum\u2026", "pr_createdAt": "2020-08-30T15:55:22Z", "pr_url": "https://github.com/openmrs/openmrs-core/pull/3550", "timeline": [{"oid": "dd9b2e5d2728a509e3e8137ed255c4816c45e458", "url": "https://github.com/openmrs/openmrs-core/commit/dd9b2e5d2728a509e3e8137ed255c4816c45e458", "message": "TRUNK-5821: Adding indices to order_number and accession_number columns in orders table with passing Database IT tests.", "committedDate": "2020-08-30T19:44:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDc0MzQ4Mw==", "url": "https://github.com/openmrs/openmrs-core/pull/3550#discussion_r484743483", "bodyText": "For the index name, can you prefix the table name as done in this file? https://github.com/openmrs/openmrs-core/blob/master/api/src/main/resources/org/openmrs/liquibase/snapshots/schema-only/liquibase-schema-only-1.9.x.xml", "author": "dkayiwa", "createdAt": "2020-09-08T08:29:29Z", "path": "api/src/main/resources/org/openmrs/liquibase/updates/liquibase-update-to-latest-2.4.x.xml", "diffHunk": "@@ -233,7 +228,26 @@\n         <addForeignKeyConstraint constraintName=\"order_set_attribute_creator_fk\" baseTableName=\"order_set_attribute\" baseColumnNames=\"creator\" referencedTableName=\"users\" referencedColumnNames=\"user_id\" />\n         <addForeignKeyConstraint constraintName=\"order_set_attribute_changed_by_fk\" baseTableName=\"order_set_attribute\" baseColumnNames=\"changed_by\" referencedTableName=\"users\" referencedColumnNames=\"user_id\" />\n         <addForeignKeyConstraint constraintName=\"order_set_attribute_voided_by_fk\" baseTableName=\"order_set_attribute\" baseColumnNames=\"voided_by\" referencedTableName=\"users\" referencedColumnNames=\"user_id\" />\n-    </changeSet>   \n-    \n+    </changeSet>\n+\t\n+\t<changeSet id=\"2020-08-29-2200-TRUNK-5821\" author=\"miirochristopher\">\n+\t\t<preConditions onFail=\"MARK_RAN\" onFailMessage=\"Index idx_order_number already exists.\">\n+\t\t\t<tableExists tableName=\"orders\"/>\n+\t\t</preConditions>\n+\t\t<comment>Adding index to order_number column in Orders table</comment>\n+\t\t<createIndex  indexName=\"idx_order_number\" tableName=\"orders\" unique=\"true\">", "originalCommit": "dd9b2e5d2728a509e3e8137ed255c4816c45e458", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDc0MzkzNQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3550#discussion_r484743935", "bodyText": "Do we need to again specify the type?", "author": "dkayiwa", "createdAt": "2020-09-08T08:30:07Z", "path": "api/src/main/resources/org/openmrs/liquibase/updates/liquibase-update-to-latest-2.4.x.xml", "diffHunk": "@@ -233,7 +228,26 @@\n         <addForeignKeyConstraint constraintName=\"order_set_attribute_creator_fk\" baseTableName=\"order_set_attribute\" baseColumnNames=\"creator\" referencedTableName=\"users\" referencedColumnNames=\"user_id\" />\n         <addForeignKeyConstraint constraintName=\"order_set_attribute_changed_by_fk\" baseTableName=\"order_set_attribute\" baseColumnNames=\"changed_by\" referencedTableName=\"users\" referencedColumnNames=\"user_id\" />\n         <addForeignKeyConstraint constraintName=\"order_set_attribute_voided_by_fk\" baseTableName=\"order_set_attribute\" baseColumnNames=\"voided_by\" referencedTableName=\"users\" referencedColumnNames=\"user_id\" />\n-    </changeSet>   \n-    \n+    </changeSet>\n+\t\n+\t<changeSet id=\"2020-08-29-2200-TRUNK-5821\" author=\"miirochristopher\">\n+\t\t<preConditions onFail=\"MARK_RAN\" onFailMessage=\"Index idx_order_number already exists.\">\n+\t\t\t<tableExists tableName=\"orders\"/>\n+\t\t</preConditions>\n+\t\t<comment>Adding index to order_number column in Orders table</comment>\n+\t\t<createIndex  indexName=\"idx_order_number\" tableName=\"orders\" unique=\"true\">\n+\t\t\t<column   name=\"order_number\" type=\"varchar(50)\"/>\n+\t\t</createIndex>\n+\t</changeSet>\n+\t\n+\t<changeSet id=\"2020-08-30-100-TRUNK-5821\" author=\"miirochristopher\">\n+\t\t<preConditions onFail=\"MARK_RAN\" onFailMessage=\"Index idx_accession_number already exists.\">\n+\t\t\t<tableExists tableName=\"orders\"/>\n+\t\t</preConditions>\n+\t\t<comment>Adding index to accession_number column in Orders table</comment>\n+\t\t<createIndex  indexName=\"idx_accession_number\"  tableName=\"orders\" unique=\"true\">\n+\t\t\t<column   name=\"accession_number\" type=\"varchar(255)\"/>", "originalCommit": "dd9b2e5d2728a509e3e8137ed255c4816c45e458", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "33290ea32bf358885bfc74acffd1353ac3837dfb", "url": "https://github.com/openmrs/openmrs-core/commit/33290ea32bf358885bfc74acffd1353ac3837dfb", "message": "TRUNK-5821: Adding indices to order_number and accession_number columns in orders table.", "committedDate": "2020-09-08T15:36:14Z", "type": "forcePushed"}, {"oid": "98aa84cb478b329fb411cac03e52becdef746b69", "url": "https://github.com/openmrs/openmrs-core/commit/98aa84cb478b329fb411cac03e52becdef746b69", "message": "TRUNK-5821: Adding indices to order_number and accession_number columns in the orders table.", "committedDate": "2020-09-10T10:39:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ2OTA5MQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3550#discussion_r486469091", "bodyText": "What happens when the index already exists?", "author": "dkayiwa", "createdAt": "2020-09-10T16:16:04Z", "path": "api/src/main/resources/org/openmrs/liquibase/updates/liquibase-update-to-latest-2.4.x.xml", "diffHunk": "@@ -299,4 +299,25 @@\n \t\t<addForeignKeyConstraint constraintName=\"order_group_attribute_changed_by_fk\" baseTableName=\"order_group_attribute\" baseColumnNames=\"changed_by\" referencedTableName=\"users\" referencedColumnNames=\"user_id\" />\n \t\t<addForeignKeyConstraint constraintName=\"order_group_attribute_voided_by_fk\" baseTableName=\"order_group_attribute\" baseColumnNames=\"voided_by\" referencedTableName=\"users\" referencedColumnNames=\"user_id\" />\n \t</changeSet>\n+\n+\t<changeSet id=\"2020-08-29-2200-TRUNK-5821\" author=\"miirochristopher\">\n+\t\t<preConditions onFail=\"MARK_RAN\" onFailMessage=\"Table orders does not exist or the index orders_order_number already exists.\">\n+\t\t\t<tableExists tableName=\"orders\"/>", "originalCommit": "98aa84cb478b329fb411cac03e52becdef746b69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7047a0d3816f12bc8ff20392afba8c6c4671a64a", "url": "https://github.com/openmrs/openmrs-core/commit/7047a0d3816f12bc8ff20392afba8c6c4671a64a", "message": "TRUNK-5821: Adding indices to order_number and accession_number columns in orders table.", "committedDate": "2020-09-11T08:59:52Z", "type": "commit"}, {"oid": "7047a0d3816f12bc8ff20392afba8c6c4671a64a", "url": "https://github.com/openmrs/openmrs-core/commit/7047a0d3816f12bc8ff20392afba8c6c4671a64a", "message": "TRUNK-5821: Adding indices to order_number and accession_number columns in orders table.", "committedDate": "2020-09-11T08:59:52Z", "type": "forcePushed"}, {"oid": "3e126cf3c8605dd750afbaa943a09913b23fe6bc", "url": "https://github.com/openmrs/openmrs-core/commit/3e126cf3c8605dd750afbaa943a09913b23fe6bc", "message": "TRUNK-5821: Adding indices to order_number and accession_number columns in orders table.", "committedDate": "2020-09-11T11:41:27Z", "type": "commit"}]}