{"pr_number": 1624, "pr_title": "[IOTDB-836] [To rel/0.10] Fix merging statistics failed when endFile", "pr_createdAt": "2020-08-15T08:39:23Z", "pr_url": "https://github.com/apache/iotdb/pull/1624", "timeline": [{"oid": "bff38b2be89c271133c48a6b5b586800c010e0da", "url": "https://github.com/apache/iotdb/commit/bff38b2be89c271133c48a6b5b586800c010e0da", "message": "[IOTDB-836] Fix merging statistics failed when endFile", "committedDate": "2020-08-15T08:36:11Z", "type": "commit"}, {"oid": "4006e0a4362bc999a67e7ffe4ed6b8b6e6ad9362", "url": "https://github.com/apache/iotdb/commit/4006e0a4362bc999a67e7ffe4ed6b8b6e6ad9362", "message": "Fix sonar problem", "committedDate": "2020-08-15T08:48:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA1NjU5Ng==", "url": "https://github.com/apache/iotdb/pull/1624#discussion_r471056596", "bodyText": "what's this for?", "author": "qiaojialin", "createdAt": "2020-08-16T02:42:41Z", "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/writer/TsFileIOWriter.java", "diffHunk": "@@ -335,6 +335,21 @@ public long getPos() throws IOException {\n     return deviceChunkMetadataMap;\n   }\n \n+  public void deleteMeasurementFromChunkGroupMetadataList(String deviceId, String measurementId) {\n+    for (ChunkGroupMetadata chunkGroupMetadata : chunkGroupMetadataList) {\n+      VersionUtils.applyVersion(chunkGroupMetadata.getChunkMetadataList(), versionInfo);", "originalCommit": "4006e0a4362bc999a67e7ffe4ed6b8b6e6ad9362", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA1OTU4OA==", "url": "https://github.com/apache/iotdb/pull/1624#discussion_r471059588", "bodyText": "Removed", "author": "samperson1997", "createdAt": "2020-08-16T03:25:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA1NjU5Ng=="}], "type": "inlineReview"}, {"oid": "696fbdc4cf2bc71fd15b97bcf6eda156c8273269", "url": "https://github.com/apache/iotdb/commit/696fbdc4cf2bc71fd15b97bcf6eda156c8273269", "message": "Fix recover", "committedDate": "2020-08-17T06:35:22Z", "type": "commit"}, {"oid": "8d1dc85fe5c8d7f5a69303775f120f2da89065d8", "url": "https://github.com/apache/iotdb/commit/8d1dc85fe5c8d7f5a69303775f120f2da89065d8", "message": "Remove applying version", "committedDate": "2020-08-17T06:37:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUyOTAxMg==", "url": "https://github.com/apache/iotdb/pull/1624#discussion_r471529012", "bodyText": "this does not take effect?", "author": "qiaojialin", "createdAt": "2020-08-17T14:45:05Z", "path": "server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "diffHunk": "@@ -244,6 +244,13 @@ public void deleteDataInMemory(Deletion deletion) {\n         workMemTable\n             .delete(deletion.getDevice(), deletion.getMeasurement(), deletion.getTimestamp());\n       }\n+\n+      // clear ChunkMetaData of the deleted timeseries\n+      if (deletion.getTimestamp() == Long.MAX_VALUE) {\n+        writer.deleteMeasurementFromChunkGroupMetadataList(deletion.getDevice(),", "originalCommit": "8d1dc85fe5c8d7f5a69303775f120f2da89065d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cdc9d6d9f093533f416a7549444dd033929b44b1", "url": "https://github.com/apache/iotdb/commit/cdc9d6d9f093533f416a7549444dd033929b44b1", "message": "Update logic", "committedDate": "2020-08-17T15:13:25Z", "type": "commit"}, {"oid": "9e82ecb3c13e55ff44bb506b3c1e47fe35c9a075", "url": "https://github.com/apache/iotdb/commit/9e82ecb3c13e55ff44bb506b3c1e47fe35c9a075", "message": "Filter chunkMetadata when endFile", "committedDate": "2020-08-20T01:52:48Z", "type": "commit"}, {"oid": "9e82ecb3c13e55ff44bb506b3c1e47fe35c9a075", "url": "https://github.com/apache/iotdb/commit/9e82ecb3c13e55ff44bb506b3c1e47fe35c9a075", "message": "Filter chunkMetadata when endFile", "committedDate": "2020-08-20T01:52:48Z", "type": "forcePushed"}, {"oid": "96b24a6cbe2a63f1fe11f0b88f165965d8c44424", "url": "https://github.com/apache/iotdb/commit/96b24a6cbe2a63f1fe11f0b88f165965d8c44424", "message": "Add test and comment", "committedDate": "2020-08-20T02:24:05Z", "type": "commit"}, {"oid": "829fab88bceee82c5717c4bf70bdc5e634e27503", "url": "https://github.com/apache/iotdb/commit/829fab88bceee82c5717c4bf70bdc5e634e27503", "message": "Remove deleting ChunkMetadata while deleting timeseries", "committedDate": "2020-08-20T07:14:25Z", "type": "commit"}, {"oid": "71a4dde4efb12514b0bb12d2961a5ee9777509ca", "url": "https://github.com/apache/iotdb/commit/71a4dde4efb12514b0bb12d2961a5ee9777509ca", "message": "Remove unused import", "committedDate": "2020-08-20T07:46:12Z", "type": "commit"}, {"oid": "9dd013925d6e255362a674040d0a082745a18eab", "url": "https://github.com/apache/iotdb/commit/9dd013925d6e255362a674040d0a082745a18eab", "message": "Refactor codes", "committedDate": "2020-08-20T12:02:06Z", "type": "commit"}]}