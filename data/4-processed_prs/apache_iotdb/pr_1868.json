{"pr_number": 1868, "pr_title": "Stop iotdb instance when RPC ip address or port is unavailable", "pr_createdAt": "2020-10-27T02:06:58Z", "pr_url": "https://github.com/apache/iotdb/pull/1868", "timeline": [{"oid": "ec3ca2bfa93656491cae688a05d827d3457998f2", "url": "https://github.com/apache/iotdb/commit/ec3ca2bfa93656491cae688a05d827d3457998f2", "message": "stop iotdb instance when ip address or port is unavailable", "committedDate": "2020-10-27T02:03:51Z", "type": "commit"}, {"oid": "b4de5c3a8597f6ed35631a66a93d8b4e9270fe52", "url": "https://github.com/apache/iotdb/commit/b4de5c3a8597f6ed35631a66a93d8b4e9270fe52", "message": "stop iotdb instance when ip address or port is unavailable", "committedDate": "2020-10-27T02:04:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU2ODU2NQ==", "url": "https://github.com/apache/iotdb/pull/1868#discussion_r512568565", "bodyText": "Format here.\nBesides, instead of shutting down immediately, I would suggest a few retries, which may prevent test failures when the socket is not shut down timely.", "author": "jt2594838", "createdAt": "2020-10-27T10:20:07Z", "path": "server/src/main/java/org/apache/iotdb/db/service/RPCService.java", "diffHunk": "@@ -61,12 +63,17 @@ public void initTProcessor() throws ClassNotFoundException,IllegalAccessExceptio\n   public void initThriftServiceThread()\n       throws IllegalAccessException, InstantiationException, ClassNotFoundException {\n     IoTDBConfig config = IoTDBDescriptor.getInstance().getConfig();\n-    thriftServiceThread = new ThriftServiceThread(processor,\n-        getID().getName(), ThreadName.RPC_CLIENT.getName(),\n-        config.getRpcAddress(), config.getRpcPort(), config.getRpcMaxConcurrentClientNum(),\n-        config.getThriftServerAwaitTimeForStopService(),\n-        new RPCServiceThriftHandler(impl),\n-        IoTDBDescriptor.getInstance().getConfig().isRpcThriftCompressionEnable());\n+    try {\n+      thriftServiceThread = new ThriftServiceThread(processor,\n+          getID().getName(), ThreadName.RPC_CLIENT.getName(),\n+          config.getRpcAddress(), config.getRpcPort(), config.getRpcMaxConcurrentClientNum(),\n+          config.getThriftServerAwaitTimeForStopService(),\n+          new RPCServiceThriftHandler(impl),\n+          IoTDBDescriptor.getInstance().getConfig().isRpcThriftCompressionEnable());\n+    }\n+    catch (RPCServiceException e) {\n+      throw new IllegalAccessException(e.getMessage());", "originalCommit": "b4de5c3a8597f6ed35631a66a93d8b4e9270fe52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjcwNDcwNw==", "url": "https://github.com/apache/iotdb/pull/1868#discussion_r512704707", "bodyText": "Good idea.\nSo do you think we should add the retries in this pr or do it in another pr later? I don't see any test failed so far....", "author": "HTHou", "createdAt": "2020-10-27T13:46:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU2ODU2NQ=="}], "type": "inlineReview"}, {"oid": "777e42a01939dc48e0c08931f0dca2e67f3deda2", "url": "https://github.com/apache/iotdb/commit/777e42a01939dc48e0c08931f0dca2e67f3deda2", "message": "reformat", "committedDate": "2020-10-27T13:42:07Z", "type": "commit"}]}