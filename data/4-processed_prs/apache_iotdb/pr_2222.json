{"pr_number": 2222, "pr_title": "[Distributed] fix session cache leader interface and docs ", "pr_createdAt": "2020-12-09T03:08:57Z", "pr_url": "https://github.com/apache/iotdb/pull/2222", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTc2MzQ4NA==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r539763484", "bodyText": "Where is this set?", "author": "jt2594838", "createdAt": "2020-12-10T01:00:04Z", "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -75,6 +75,7 @@\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n   private boolean enableCompression = false;\n+  private boolean enableCacheLeader = false;", "originalCommit": "593d9ec8beb824fc9142fbea4bd40a47bb561a06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgwMzQ3NA==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r539803474", "bodyText": "OK, I will add this interfance for SessionPool~", "author": "LebronAl", "createdAt": "2020-12-10T02:47:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTc2MzQ4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NTk5OA==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540675998", "bodyText": "false -> Config.DEFAULT_CACHE_LEADER_MODE", "author": "jixuan1989", "createdAt": "2020-12-11T04:08:04Z", "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -74,29 +74,36 @@\n   private int fetchSize;\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n-  private boolean enableCompression = false;\n+  private boolean enableCompression;\n+  private boolean enableCacheLeader;\n   private ZoneId zoneId;\n \n   private boolean closed;//whether the queue is closed.\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null, false);", "originalCommit": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDkyODc5MQ==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540928791", "bodyText": "OK", "author": "LebronAl", "createdAt": "2020-12-11T12:58:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NTk5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjAzNw==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540676037", "bodyText": "false -> Config.DEFAULT_CACHE_LEADER_MODE", "author": "jixuan1989", "createdAt": "2020-12-11T04:08:09Z", "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -74,29 +74,36 @@\n   private int fetchSize;\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n-  private boolean enableCompression = false;\n+  private boolean enableCompression;\n+  private boolean enableCacheLeader;\n   private ZoneId zoneId;\n \n   private boolean closed;//whether the queue is closed.\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null, false);\n   }\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize,\n       boolean enableCompression) {\n     this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, enableCompression,\n-        null);\n+        null, false);", "originalCommit": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDkyOTA3NA==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540929074", "bodyText": "OK", "author": "LebronAl", "createdAt": "2020-12-11T12:58:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjAzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjA4Mg==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540676082", "bodyText": "false -> Config.DEFAULT_CACHE_LEADER_MODE", "author": "jixuan1989", "createdAt": "2020-12-11T04:08:23Z", "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -74,29 +74,36 @@\n   private int fetchSize;\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n-  private boolean enableCompression = false;\n+  private boolean enableCompression;\n+  private boolean enableCacheLeader;\n   private ZoneId zoneId;\n \n   private boolean closed;//whether the queue is closed.\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null, false);\n   }\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize,\n       boolean enableCompression) {\n     this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, enableCompression,\n-        null);\n+        null, false);\n+  }\n+\n+  public SessionPool(String ip, int port, String user, String password, int maxSize,\n+      boolean enableCompression, boolean enableCacheLeader) {\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, enableCompression,\n+        null, enableCacheLeader);\n   }\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize,\n       ZoneId zoneId) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, zoneId);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, zoneId, false);", "originalCommit": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDkyODg3MA==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540928870", "bodyText": "OK", "author": "LebronAl", "createdAt": "2020-12-11T12:58:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjA4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjI0Mg==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540676242", "bodyText": "Is there some UT for set the enableCache as true?", "author": "jixuan1989", "createdAt": "2020-12-11T04:08:54Z", "path": "session/src/test/java/org/apache/iotdb/session/pool/SessionPoolTest.java", "diffHunk": "@@ -164,7 +164,7 @@ private void correctQuery(SessionPool pool) {\n \n   @Test\n   public void tryIfTheServerIsRestart() {\n-    SessionPool pool = new SessionPool(\"127.0.0.1\", 6667, \"root\", \"root\", 3, 1, 6000, false, null);\n+    SessionPool pool = new SessionPool(\"127.0.0.1\", 6667, \"root\", \"root\", 3, 1, 6000, false, null, false);", "originalCommit": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDkyOTM2Mw==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540929363", "bodyText": "I will add UT for this laterly", "author": "LebronAl", "createdAt": "2020-12-11T12:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjI0Mg=="}], "type": "inlineReview"}, {"oid": "e2b32eb8093d8ef0a18e8bb7f4201123d5bc499e", "url": "https://github.com/apache/iotdb/commit/e2b32eb8093d8ef0a18e8bb7f4201123d5bc499e", "message": "fix", "committedDate": "2020-12-28T03:27:39Z", "type": "commit"}, {"oid": "5e0b65a76b84ac1d650d1ec9966bb3fec2e1a455", "url": "https://github.com/apache/iotdb/commit/5e0b65a76b84ac1d650d1ec9966bb3fec2e1a455", "message": "fix session pool", "committedDate": "2020-12-28T03:27:39Z", "type": "commit"}, {"oid": "2bc85ab5e8a5ccba7f0716028e7abd46664b9452", "url": "https://github.com/apache/iotdb/commit/2bc85ab5e8a5ccba7f0716028e7abd46664b9452", "message": "change default cacheLeader", "committedDate": "2020-12-28T03:27:40Z", "type": "commit"}, {"oid": "25714a3ce5d50488f663de616ce3219b070e5c60", "url": "https://github.com/apache/iotdb/commit/25714a3ce5d50488f663de616ce3219b070e5c60", "message": "fix zeeppelin session init", "committedDate": "2020-12-28T09:11:58Z", "type": "commit"}, {"oid": "a3140d0e67723bc51719260e5becc066de67808b", "url": "https://github.com/apache/iotdb/commit/a3140d0e67723bc51719260e5becc066de67808b", "message": "Merge branch 'master' of github.com:Apache/incubator-iotdb into cluster_fix_session", "committedDate": "2021-01-11T02:49:34Z", "type": "commit"}, {"oid": "a3140d0e67723bc51719260e5becc066de67808b", "url": "https://github.com/apache/iotdb/commit/a3140d0e67723bc51719260e5becc066de67808b", "message": "Merge branch 'master' of github.com:Apache/incubator-iotdb into cluster_fix_session", "committedDate": "2021-01-11T02:49:34Z", "type": "forcePushed"}, {"oid": "1fa0887e008f4cbad7e264747bd04e001c3e84ce", "url": "https://github.com/apache/iotdb/commit/1fa0887e008f4cbad7e264747bd04e001c3e84ce", "message": "add cache leader UT && fix inserTablets judgement error", "committedDate": "2021-01-11T09:46:33Z", "type": "forcePushed"}, {"oid": "c41ec775ddcc622f3ac39cfae2d5124a9afb4843", "url": "https://github.com/apache/iotdb/commit/c41ec775ddcc622f3ac39cfae2d5124a9afb4843", "message": "add cache leader UT && fix inserTablets judgement error", "committedDate": "2021-01-11T09:57:47Z", "type": "commit"}, {"oid": "c41ec775ddcc622f3ac39cfae2d5124a9afb4843", "url": "https://github.com/apache/iotdb/commit/c41ec775ddcc622f3ac39cfae2d5124a9afb4843", "message": "add cache leader UT && fix inserTablets judgement error", "committedDate": "2021-01-11T09:57:47Z", "type": "forcePushed"}, {"oid": "8be30f75e6ae2eecc54cb5a3670004cbf1b2a571", "url": "https://github.com/apache/iotdb/commit/8be30f75e6ae2eecc54cb5a3670004cbf1b2a571", "message": "Merge branch 'master' of github.com:Apache/incubator-iotdb into cluster_fix_session", "committedDate": "2021-01-14T07:49:19Z", "type": "commit"}, {"oid": "ac0ed556fd9a44481ae48793238bac9dcff8b705", "url": "https://github.com/apache/iotdb/commit/ac0ed556fd9a44481ae48793238bac9dcff8b705", "message": "delete useless doc && revert inserttablets redirection", "committedDate": "2021-01-14T07:57:51Z", "type": "commit"}, {"oid": "ac0ed556fd9a44481ae48793238bac9dcff8b705", "url": "https://github.com/apache/iotdb/commit/ac0ed556fd9a44481ae48793238bac9dcff8b705", "message": "delete useless doc && revert inserttablets redirection", "committedDate": "2021-01-14T07:57:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI3OTg2Mg==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r559279862", "bodyText": "It would be better to use an annotation, and please format the code.", "author": "jt2594838", "createdAt": "2021-01-18T02:01:51Z", "path": "session/src/main/java/org/apache/iotdb/session/SessionConnection.java", "diffHunk": "@@ -67,6 +67,9 @@\n   private ZoneId zoneId;\n   private EndPoint endPoint;\n \n+  //TestOnly\n+  public SessionConnection(){}", "originalCommit": "ac0ed556fd9a44481ae48793238bac9dcff8b705", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTMzNDA5MQ==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r559334091", "bodyText": "Testonly's anonation is currently in the server module. The session module does not currently have a dependency on the server module, so I don't think it would be appropriate to introduce a dependency just for this purpose. As for creating a new testonly anotation in the session module, I think it's a bit redundant because it's the only one we've used so far. But if you think it's worth creating a new anonation in the Session Module, I'll do it. What your opinion?", "author": "LebronAl", "createdAt": "2021-01-18T06:06:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI3OTg2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjMyNTU5Ng==", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r562325596", "bodyText": "That is the case, we can extract that into another module later.", "author": "jt2594838", "createdAt": "2021-01-22T02:08:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI3OTg2Mg=="}], "type": "inlineReview"}, {"oid": "e7a10f73d49ad5250d76806fa97dd25e5b69428a", "url": "https://github.com/apache/iotdb/commit/e7a10f73d49ad5250d76806fa97dd25e5b69428a", "message": "format", "committedDate": "2021-01-18T06:10:09Z", "type": "commit"}, {"oid": "7c65e74b1921c0dc118d684def29269d4a92870f", "url": "https://github.com/apache/iotdb/commit/7c65e74b1921c0dc118d684def29269d4a92870f", "message": "Merge branch 'master' of github.com:Apache/incubator-iotdb into cluster_fix_session", "committedDate": "2021-01-18T06:27:36Z", "type": "commit"}, {"oid": "66c23f03605960fbfe2ed209860bdf96efe79d45", "url": "https://github.com/apache/iotdb/commit/66c23f03605960fbfe2ed209860bdf96efe79d45", "message": "Merge branch 'master' of github.com:Apache/incubator-iotdb into cluster_fix_session", "committedDate": "2021-01-19T11:55:28Z", "type": "commit"}]}