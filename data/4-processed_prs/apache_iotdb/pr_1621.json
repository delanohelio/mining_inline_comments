{"pr_number": 1621, "pr_title": "[New feature] Add the alias and show it as column name when querying", "pr_createdAt": "2020-08-14T08:27:05Z", "pr_url": "https://github.com/apache/iotdb/pull/1621", "timeline": [{"oid": "a163f55748dd1b5a29a278098cbd0b8cf2ee2436", "url": "https://github.com/apache/iotdb/commit/a163f55748dd1b5a29a278098cbd0b8cf2ee2436", "message": "Remove select const element", "committedDate": "2020-08-13T07:16:23Z", "type": "commit"}, {"oid": "fec5f9150932265db489ce5da792ba7444a8aab6", "url": "https://github.com/apache/iotdb/commit/fec5f9150932265db489ce5da792ba7444a8aab6", "message": "implement raw data query", "committedDate": "2020-08-13T14:38:03Z", "type": "commit"}, {"oid": "cfa2051bbeeaaf9a86d0b0d9dc6293b9a1c7a37e", "url": "https://github.com/apache/iotdb/commit/cfa2051bbeeaaf9a86d0b0d9dc6293b9a1c7a37e", "message": "support align by device", "committedDate": "2020-08-14T07:04:34Z", "type": "commit"}, {"oid": "34d015fef0def5e0ec4a10a6a9006d7fef64c35b", "url": "https://github.com/apache/iotdb/commit/34d015fef0def5e0ec4a10a6a9006d7fef64c35b", "message": "support aggregation", "committedDate": "2020-08-14T08:18:05Z", "type": "commit"}, {"oid": "0b8a5d0e0e5b1ad1771d76152fb43a819eedca17", "url": "https://github.com/apache/iotdb/commit/0b8a5d0e0e5b1ad1771d76152fb43a819eedca17", "message": "support last", "committedDate": "2020-08-14T09:20:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQyNjEzOQ==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r474426139", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String column = path.getTsAlias() != null ? path.getTsAlias() : null;\n          \n          \n            \n                    String column = path.getTsAlias();", "author": "JackieTien97", "createdAt": "2020-08-21T06:04:03Z", "path": "server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java", "diffHunk": "@@ -664,11 +674,9 @@ private void deduplicate(QueryPlan queryPlan) throws MetadataException {\n     if (queryPlan instanceof LastQueryPlan) {\n       for (int i = 0; i < paths.size(); i++) {\n         Path path = paths.get(i);\n-        String column;\n-        if (path.getAlias() != null) {\n-          column = path.getFullPathWithAlias();\n-        } else {\n-          column = path.toString();\n+        String column = path.getTsAlias() != null ? path.getTsAlias() : null;", "originalCommit": "0b8a5d0e0e5b1ad1771d76152fb43a819eedca17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQ1MDcwMw==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r474450703", "bodyText": "Sorry...Fixed.", "author": "Alima777", "createdAt": "2020-08-21T07:05:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQyNjEzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQyNzk1MQ==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r474427951", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  String column = indexedPath.left.getTsAlias() != null ? indexedPath.left.getTsAlias() : null;\n          \n          \n            \n                  String column = indexedPath.left.getTsAlias();", "author": "JackieTien97", "createdAt": "2020-08-21T06:09:30Z", "path": "server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java", "diffHunk": "@@ -689,14 +697,14 @@ private void deduplicate(QueryPlan queryPlan) throws MetadataException {\n \n     int index = 0;\n     for (Pair<Path, Integer> indexedPath : indexedPaths) {\n-      String column;\n-      if (indexedPath.left.getAlias() != null) {\n-        column = indexedPath.left.getFullPathWithAlias();\n-      } else {\n-        column = indexedPath.left.toString();\n-      }\n-      if (queryPlan instanceof AggregationPlan) {\n-        column = queryPlan.getAggregations().get(indexedPath.right) + \"(\" + column + \")\";\n+      // judge whether as clause is used or not first\n+      String column = indexedPath.left.getTsAlias() != null ? indexedPath.left.getTsAlias() : null;", "originalCommit": "0b8a5d0e0e5b1ad1771d76152fb43a819eedca17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQ1MDc3NA==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r474450774", "bodyText": "Fixed.", "author": "Alima777", "createdAt": "2020-08-21T07:05:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQyNzk1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQ0MTQxMQ==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r474441411", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      String column = path.getTsAlias() != null ? path.getTsAlias() : null;\n          \n          \n            \n                      String column = path.getTsAlias();", "author": "JackieTien97", "createdAt": "2020-08-21T06:48:50Z", "path": "server/src/main/java/org/apache/iotdb/db/service/TSServiceImpl.java", "diffHunk": "@@ -788,11 +787,15 @@ private void getWideQueryHeaders(\n           }\n         }\n         for (int i = 0; i < paths.size(); i++) {\n-          if (paths.get(i).getAlias() != null) {\n-            respColumns.add(aggregations.get(i) + \"(\" + paths.get(i).getFullPathWithAlias() + \")\");\n-          } else {\n-            respColumns.add(aggregations.get(i) + \"(\" + paths.get(i).getFullPath() + \")\");\n+          Path path = paths.get(i);\n+          // judge whether as clause is used or not first\n+          String column = path.getTsAlias() != null ? path.getTsAlias() : null;", "originalCommit": "0b8a5d0e0e5b1ad1771d76152fb43a819eedca17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQ1MDgzMg==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r474450832", "bodyText": "Fixed.", "author": "Alima777", "createdAt": "2020-08-21T07:05:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQ0MTQxMQ=="}], "type": "inlineReview"}, {"oid": "223c942a0e8abfb4cc10a60f36a2593229e61e26", "url": "https://github.com/apache/iotdb/commit/223c942a0e8abfb4cc10a60f36a2593229e61e26", "message": "fix code style", "committedDate": "2020-08-21T07:05:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc4Nzk1Mw==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r478787953", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      // judge whether as clause is used or not first\n          \n          \n            \n                      String column = path.getTsAlias() != null ? path.getTsAlias() : null;\n          \n          \n            \n                      // judge whether as clause is used or not first\n          \n          \n            \n                      String column = path.getTsAlias();", "author": "HTHou", "createdAt": "2020-08-28T01:55:03Z", "path": "server/src/main/java/org/apache/iotdb/db/service/TSServiceImpl.java", "diffHunk": "@@ -761,22 +759,23 @@ private TSExecuteStatementResp getQueryColumnHeaders(PhysicalPlan physicalPlan,\n   // wide means not align by device\n   private void getWideQueryHeaders(\n       QueryPlan plan, List<String> respColumns, List<String> columnTypes)\n-      throws TException, QueryProcessException, MetadataException {\n+      throws TException, MetadataException {\n     // Restore column header of aggregate to func(column_name), only\n     // support single aggregate function for now\n     List<Path> paths = plan.getPaths();\n-    List<TSDataType> seriesTypes;\n+    List<TSDataType> seriesTypes = new ArrayList<>();\n     switch (plan.getOperatorType()) {\n       case QUERY:\n       case FILL:\n         for (Path path : paths) {\n-          if (path.getAlias() != null) {\n-            respColumns.add(path.getFullPathWithAlias());\n-          } else {\n-            respColumns.add(path.getFullPath());\n+          // judge whether as clause is used or not first\n+          String column = path.getTsAlias() != null ? path.getTsAlias() : null;", "originalCommit": "223c942a0e8abfb4cc10a60f36a2593229e61e26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMjIwMA==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r478812200", "bodyText": "fixed", "author": "Alima777", "createdAt": "2020-08-28T03:36:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc4Nzk1Mw=="}], "type": "inlineReview"}, {"oid": "508acdc753a8d0d26d273d1fcad15cc89a222536", "url": "https://github.com/apache/iotdb/commit/508acdc753a8d0d26d273d1fcad15cc89a222536", "message": "Update server/src/main/java/org/apache/iotdb/db/service/TSServiceImpl.java\r\n\r\nfix code style\n\nCo-authored-by: Haonan <hhaonan@outlook.com>", "committedDate": "2020-08-28T03:35:53Z", "type": "commit"}, {"oid": "2ad386d080507a95c1c8712fcc0ee97ae7fc4c8f", "url": "https://github.com/apache/iotdb/commit/2ad386d080507a95c1c8712fcc0ee97ae7fc4c8f", "message": "Merge branch 'asFunction' of https://github.com/Alima777/incubator-iotdb into asFunction", "committedDate": "2020-08-28T09:31:52Z", "type": "commit"}, {"oid": "85160f4c544a6f1611b121d11b0e512696d3588e", "url": "https://github.com/apache/iotdb/commit/85160f4c544a6f1611b121d11b0e512696d3588e", "message": "fix conflict", "committedDate": "2020-08-30T06:35:44Z", "type": "commit"}, {"oid": "2657168cfa0a5f9cd1f10b38c102a654a79969d7", "url": "https://github.com/apache/iotdb/commit/2657168cfa0a5f9cd1f10b38c102a654a79969d7", "message": "optimize align by device", "committedDate": "2020-08-30T07:10:39Z", "type": "commit"}, {"oid": "7604913099a74fea226af5e543e672c0f3221cec", "url": "https://github.com/apache/iotdb/commit/7604913099a74fea226af5e543e672c0f3221cec", "message": "fix doc style", "committedDate": "2020-08-30T08:18:07Z", "type": "commit"}, {"oid": "7604913099a74fea226af5e543e672c0f3221cec", "url": "https://github.com/apache/iotdb/commit/7604913099a74fea226af5e543e672c0f3221cec", "message": "fix doc style", "committedDate": "2020-08-30T08:18:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5NTMwNA==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r480995304", "bodyText": "measurementAlias", "author": "qiaojialin", "createdAt": "2020-09-01T09:21:25Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -31,7 +31,10 @@\n public class PartialPath extends Path implements Comparable<Path> {\n \n   private String[] nodes;\n-  private String alias;\n+  // alias of sensor\n+  private String alias = null;", "originalCommit": "7604913099a74fea226af5e543e672c0f3221cec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTExOTgyNA==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r481119824", "bodyText": "Fixed.", "author": "Alima777", "createdAt": "2020-09-01T13:02:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5NTMwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5NTQ1OQ==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r480995459", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              // alias of sensor\n          \n          \n            \n              // alias of measurement", "author": "qiaojialin", "createdAt": "2020-09-01T09:21:42Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -31,7 +31,10 @@\n public class PartialPath extends Path implements Comparable<Path> {\n \n   private String[] nodes;\n-  private String alias;\n+  // alias of sensor", "originalCommit": "7604913099a74fea226af5e543e672c0f3221cec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTExOTg5Mg==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r481119892", "bodyText": "Fixed.", "author": "Alima777", "createdAt": "2020-09-01T13:02:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5NTQ1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5OTQ0OQ==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r480999449", "bodyText": "what is not first?", "author": "qiaojialin", "createdAt": "2020-09-01T09:28:23Z", "path": "server/src/main/java/org/apache/iotdb/db/qp/strategy/PhysicalGenerator.java", "diffHunk": "@@ -690,14 +700,14 @@ private void deduplicate(QueryPlan queryPlan) throws MetadataException {\n \n     int index = 0;\n     for (Pair<PartialPath, Integer> indexedPath : indexedPaths) {\n-      String column;\n-      if (indexedPath.left.getAlias() != null) {\n-        column = indexedPath.left.getFullPathWithAlias();\n-      } else {\n-        column = indexedPath.left.getFullPath();\n-      }\n-      if (queryPlan instanceof AggregationPlan) {\n-        column = queryPlan.getAggregations().get(indexedPath.right) + \"(\" + column + \")\";\n+      // judge whether as clause is used or not first", "originalCommit": "7604913099a74fea226af5e543e672c0f3221cec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTExOTc2OA==", "url": "https://github.com/apache/iotdb/pull/1621#discussion_r481119768", "bodyText": "If as clause is used, measurementAlias will be covered.", "author": "Alima777", "createdAt": "2020-09-01T13:02:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5OTQ0OQ=="}], "type": "inlineReview"}, {"oid": "713e2aab9e0c7f8972ff4783380819321b4d7ecf", "url": "https://github.com/apache/iotdb/commit/713e2aab9e0c7f8972ff4783380819321b4d7ecf", "message": "rename alias as measurementAlias", "committedDate": "2020-09-01T13:02:51Z", "type": "commit"}, {"oid": "289ecb2c832a91a509ec2aea3672b7f0aeaa7760", "url": "https://github.com/apache/iotdb/commit/289ecb2c832a91a509ec2aea3672b7f0aeaa7760", "message": "fix align by device bug", "committedDate": "2020-09-02T10:56:41Z", "type": "commit"}, {"oid": "fe08fedcb41429d1fe44625971479ccf48a60023", "url": "https://github.com/apache/iotdb/commit/fe08fedcb41429d1fe44625971479ccf48a60023", "message": "remove comment", "committedDate": "2020-09-02T12:06:32Z", "type": "commit"}, {"oid": "b9b1fd788e4fde8da90ecb2ca5191d49b2553ed2", "url": "https://github.com/apache/iotdb/commit/b9b1fd788e4fde8da90ecb2ca5191d49b2553ed2", "message": "remove redundant comments", "committedDate": "2020-09-02T13:24:57Z", "type": "commit"}]}