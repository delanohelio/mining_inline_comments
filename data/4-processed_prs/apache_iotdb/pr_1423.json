{"pr_number": 1423, "pr_title": "[IOTDB-782] [Experimental] Clear mlog when creating snapshot", "pr_createdAt": "2020-06-26T18:32:09Z", "pr_url": "https://github.com/apache/iotdb/pull/1423", "timeline": [{"oid": "73c07f25f607d466247dfbb18d1797309d74bb60", "url": "https://github.com/apache/iotdb/commit/73c07f25f607d466247dfbb18d1797309d74bb60", "message": "Clear mlog when creating snapshot", "committedDate": "2020-06-28T03:59:49Z", "type": "commit"}, {"oid": "73c07f25f607d466247dfbb18d1797309d74bb60", "url": "https://github.com/apache/iotdb/commit/73c07f25f607d466247dfbb18d1797309d74bb60", "message": "Clear mlog when creating snapshot", "committedDate": "2020-06-28T03:59:49Z", "type": "forcePushed"}, {"oid": "55f0d3454f51c8b2de6c41648638de4ee6b306d7", "url": "https://github.com/apache/iotdb/commit/55f0d3454f51c8b2de6c41648638de4ee6b306d7", "message": "No need to serialize snapshotLineNumber\nAdd user guide and system design documents", "committedDate": "2020-06-28T12:13:35Z", "type": "commit"}, {"oid": "b798469c563386df70151ca9566a267da7da0bda", "url": "https://github.com/apache/iotdb/commit/b798469c563386df70151ca9566a267da7da0bda", "message": "Fix typo", "committedDate": "2020-06-28T12:21:43Z", "type": "commit"}, {"oid": "8a78c46ba29c4391b6e18ddf0ed536529cbb5f4f", "url": "https://github.com/apache/iotdb/commit/8a78c46ba29c4391b6e18ddf0ed536529cbb5f4f", "message": "Add more system design documents", "committedDate": "2020-06-28T15:34:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjcyNjEwOA==", "url": "https://github.com/apache/iotdb/pull/1423#discussion_r446726108", "bodyText": "Maybe you should use file.getChannel().truncate(0) to clear mlog", "author": "SilverNarcissus", "createdAt": "2020-06-29T01:18:09Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MLogWriter.java", "diffHunk": "@@ -160,6 +162,14 @@ public static void upgradeMLog(String schemaDir, String logFileName) throws IOEx\n     FSFactoryProducer.getFSFactory().moveFile(tmpLogFile, logFile);\n   }\n \n+  public void clear() throws IOException {\n+    writer.close();\n+    Files.delete(logFile.toPath());\n+    FileWriter fileWriter = new FileWriter(logFile, true);", "originalCommit": "8a78c46ba29c4391b6e18ddf0ed536529cbb5f4f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}