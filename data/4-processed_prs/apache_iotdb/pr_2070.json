{"pr_number": 2070, "pr_title": "Update level compaction delete and change list lock", "pr_createdAt": "2020-11-18T08:35:29Z", "pr_url": "https://github.com/apache/iotdb/pull/2070", "timeline": [{"oid": "09288cdfa689921fadd6f794884515dc909302aa", "url": "https://github.com/apache/iotdb/commit/09288cdfa689921fadd6f794884515dc909302aa", "message": "add enable unseq compaction", "committedDate": "2020-11-06T11:30:43Z", "type": "commit"}, {"oid": "49fab34ba14c60d99f540297a3113295eee3a08f", "url": "https://github.com/apache/iotdb/commit/49fab34ba14c60d99f540297a3113295eee3a08f", "message": "Merge branch 'master' of https://github.com/apache/iotdb", "committedDate": "2020-11-07T06:18:17Z", "type": "commit"}, {"oid": "2854f931acefe3bca3d9548ddcf5b37760473980", "url": "https://github.com/apache/iotdb/commit/2854f931acefe3bca3d9548ddcf5b37760473980", "message": "Merge branch 'master' of https://github.com/apache/iotdb", "committedDate": "2020-11-07T10:43:36Z", "type": "commit"}, {"oid": "9ba681617dab53da7e51865d9aee14dd6ebbe335", "url": "https://github.com/apache/iotdb/commit/9ba681617dab53da7e51865d9aee14dd6ebbe335", "message": "Merge branches 'master' and 'master' of https://github.com/apache/iotdb", "committedDate": "2020-11-08T08:34:09Z", "type": "commit"}, {"oid": "9da683521fabfb7ad05f84d319d9b504c71a4f2b", "url": "https://github.com/apache/iotdb/commit/9da683521fabfb7ad05f84d319d9b504c71a4f2b", "message": "Merge branch 'master' of https://github.com/apache/iotdb", "committedDate": "2020-11-10T05:54:00Z", "type": "commit"}, {"oid": "f438705f15d0e2eea26ed27f5348414f2e58f231", "url": "https://github.com/apache/iotdb/commit/f438705f15d0e2eea26ed27f5348414f2e58f231", "message": "Merge branch 'master' of https://github.com/apache/iotdb", "committedDate": "2020-11-11T03:13:16Z", "type": "commit"}, {"oid": "b5a17d52eea06efa2650921ecb1d104e00309415", "url": "https://github.com/apache/iotdb/commit/b5a17d52eea06efa2650921ecb1d104e00309415", "message": "Merge branch 'master' of https://github.com/apache/iotdb", "committedDate": "2020-11-12T02:03:02Z", "type": "commit"}, {"oid": "ae79d884d1c520da33dba51a4f1ef84ee52a70a8", "url": "https://github.com/apache/iotdb/commit/ae79d884d1c520da33dba51a4f1ef84ee52a70a8", "message": "Merge branch 'master' of https://github.com/apache/iotdb", "committedDate": "2020-11-12T10:33:05Z", "type": "commit"}, {"oid": "97a2b13f188a81b9f6228fd599e18a818fcf331a", "url": "https://github.com/apache/iotdb/commit/97a2b13f188a81b9f6228fd599e18a818fcf331a", "message": "Merge branch 'master' of https://github.com/apache/iotdb", "committedDate": "2020-11-13T02:41:57Z", "type": "commit"}, {"oid": "b80249f4cc9d090ce560146d5c86197be7f217ac", "url": "https://github.com/apache/iotdb/commit/b80249f4cc9d090ce560146d5c86197be7f217ac", "message": "Merge branch 'master' of https://github.com/zhanglingzhe0820/incubator-iotdb", "committedDate": "2020-11-18T06:23:54Z", "type": "commit"}, {"oid": "91271f011d1e01f124cb5ee52c284342a0fa3b73", "url": "https://github.com/apache/iotdb/commit/91271f011d1e01f124cb5ee52c284342a0fa3b73", "message": "update level compaction delete and change list lock", "committedDate": "2020-11-18T08:32:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA3MTI4Mg==", "url": "https://github.com/apache/iotdb/pull/2070#discussion_r526071282", "bodyText": "Why not combine these two statements into one function, because most of the time they appear at the same time", "author": "EJTTianYu", "createdAt": "2020-11-18T13:07:04Z", "path": "server/src/main/java/org/apache/iotdb/db/engine/compaction/level/LevelCompactionTsFileManagement.java", "diffHunk": "@@ -338,12 +342,14 @@ public void recover() {\n             if (isSeq) {\n               for (TreeSet<TsFileResource> currMergeFile : sequenceTsFileResources\n                   .get(timePartition)) {\n-                deleteLevelFiles(timePartition, currMergeFile);\n+                deleteLevelFilesInDisk(currMergeFile);\n+                deleteLevelFilesInList(timePartition, currMergeFile);\n               }\n             } else {\n               for (List<TsFileResource> currMergeFile : unSequenceTsFileResources\n                   .get(timePartition)) {\n-                deleteLevelFiles(timePartition, currMergeFile);\n+                deleteLevelFilesInDisk(currMergeFile);\n+                deleteLevelFilesInList(timePartition, currMergeFile);", "originalCommit": "91271f011d1e01f124cb5ee52c284342a0fa3b73", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3424f39106bfdcbc0dfd600b9e539f2f9020b388", "url": "https://github.com/apache/iotdb/commit/3424f39106bfdcbc0dfd600b9e539f2f9020b388", "message": "rebase master", "committedDate": "2020-11-18T14:06:45Z", "type": "commit"}]}