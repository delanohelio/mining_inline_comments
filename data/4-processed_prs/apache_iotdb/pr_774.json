{"pr_number": 774, "pr_title": "Hive-Connector Design Document", "pr_createdAt": "2020-02-06T03:09:42Z", "pr_url": "https://github.com/apache/iotdb/pull/774", "timeline": [{"oid": "f256b748dab74bea35f6b3d809407e77d13bf7e7", "url": "https://github.com/apache/iotdb/commit/f256b748dab74bea35f6b3d809407e77d13bf7e7", "message": "hive-connector", "committedDate": "2020-02-06T01:57:07Z", "type": "commit"}, {"oid": "93b8bce5e58615e737a014d83ae93e8b6abc1169", "url": "https://github.com/apache/iotdb/commit/93b8bce5e58615e737a014d83ae93e8b6abc1169", "message": "Hive-connector design document", "committedDate": "2020-02-06T03:08:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY4NTYwNw==", "url": "https://github.com/apache/iotdb/pull/774#discussion_r375685607", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            TsFile\u7684Hive\u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u5bf9Hive\u8bfb\u53d6\u5916\u90e8Tsfile\u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c\n          \n          \n            \n            TsFile \u7684 Hive \u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u5bf9 Hive \u8bfb\u53d6\u5916\u90e8 TsFile \u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c", "author": "qiaojialin", "createdAt": "2020-02-06T08:02:09Z", "path": "docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "diffHunk": "@@ -0,0 +1,115 @@\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+## TsFile\u7684Hive\u8fde\u63a5\u5668\n+\n+TsFile\u7684Hive\u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u5bf9Hive\u8bfb\u53d6\u5916\u90e8Tsfile\u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c", "originalCommit": "93b8bce5e58615e737a014d83ae93e8b6abc1169", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8829f1d625248251a6b6941bb9ee4348cbe6bdf2", "url": "https://github.com/apache/iotdb/commit/8829f1d625248251a6b6941bb9ee4348cbe6bdf2", "message": "optimize doc", "committedDate": "2020-02-06T09:22:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyNzE1Nw==", "url": "https://github.com/apache/iotdb/pull/774#discussion_r375727157", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8etsfile\u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\n          \n          \n            \n            \u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8e TsFile \u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684", "author": "qiaojialin", "createdAt": "2020-02-06T09:36:25Z", "path": "docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "diffHunk": "@@ -0,0 +1,114 @@\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+## TsFile \u7684 Hive \u8fde\u63a5\u5668\n+\n+TsFile \u7684 Hive \u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u901a\u8fc7 Hive \u8bfb\u53d6\u5916\u90e8 TsFile \u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u901a\u8fc7 Hive \u64cd\u4f5c TsFile\u3002\n+\n+\u8fde\u63a5\u5668\u7684\u4e3b\u8981\u529f\u80fd\uff1a\n+\n+* \u5c06\u5355\u4e2a TsFile \u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u5c06\u67d0\u4e2a\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u4f7f\u7528 HQL \u67e5\u8be2 TsFile\n+* \u5230\u73b0\u5728\u4e3a\u6b62, \u5199\u64cd\u4f5c\u5728 hive-connector \u4e2d\u8fd8\u4e0d\u652f\u6301. \u6240\u4ee5, HQL \u4e2d\u7684 insert \u64cd\u4f5c\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\n+\n+### \u8bbe\u8ba1\u539f\u7406\n+\n+Hive \u8fde\u63a5\u5668\u9700\u8981\u80fd\u591f\u89e3\u6790 TsFile \u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6309\u884c\u8fd4\u56de\u7684\u683c\u5f0f\u3002\u4e5f\u9700\u8981\u80fd\u591f\u6839\u636e\u7528\u6237\u5b9a\u4e49\u7684 Table \u7684\u5f62\u5f0f\uff0c\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u6240\u4ee5\uff0cHive \u8fde\u63a5\u5668\u7684\u529f\u80fd\u5b9e\u73b0\u4e3b\u8981\u5206\u6210\u56db\u4e2a\u90e8\u5206\n+\n+* \u5c06\u6574\u4e2a TsFile \u6587\u4ef6\u5206\u7247\n+* \u4ece\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6570\u636e\u7c7b\u578b\n+* \u89e3\u6790\u7528\u6237\u81ea\u5b9a\u4e49\u7684 Table\n+* \u5c06\u6570\u636e\u53cd\u5e8f\u5217\u5316\u4e3a Hive \u7684\u8f93\u51fa\u683c\u5f0f\n+\n+### \u5177\u4f53\u5b9e\u73b0\u7c7b\n+\n+\u4e0a\u8ff0\u7684\u4e3b\u8981\u56db\u4e2a\u529f\u80fd\u6a21\u5757\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e0b\u9762\u5c31\u5206\u522b\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u56db\u4e2a\u5b9e\u73b0\u7c7b\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveInputFormat\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8etsfile\u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684", "originalCommit": "8829f1d625248251a6b6941bb9ee4348cbe6bdf2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9c0ac33853a58309e110b450a430a2e399c1262c", "url": "https://github.com/apache/iotdb/commit/9c0ac33853a58309e110b450a430a2e399c1262c", "message": "Update docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "committedDate": "2020-02-06T09:36:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyNzgyNw==", "url": "https://github.com/apache/iotdb/pull/774#discussion_r375727827", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              \u8fd9\u4e2a\u5206\u7247\u6240\u751f\u6210\u7684\u6240\u6709\u7684QueryDataSet\n          \n          \n            \n              \u8fd9\u4e2a\u5206\u7247\u6240\u751f\u6210\u7684\u6240\u6709\u7684 QueryDataSet", "author": "qiaojialin", "createdAt": "2020-02-06T09:37:43Z", "path": "docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "diffHunk": "@@ -0,0 +1,114 @@\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+## TsFile \u7684 Hive \u8fde\u63a5\u5668\n+\n+TsFile \u7684 Hive \u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u901a\u8fc7 Hive \u8bfb\u53d6\u5916\u90e8 TsFile \u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u901a\u8fc7 Hive \u64cd\u4f5c TsFile\u3002\n+\n+\u8fde\u63a5\u5668\u7684\u4e3b\u8981\u529f\u80fd\uff1a\n+\n+* \u5c06\u5355\u4e2a TsFile \u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u5c06\u67d0\u4e2a\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u4f7f\u7528 HQL \u67e5\u8be2 TsFile\n+* \u5230\u73b0\u5728\u4e3a\u6b62, \u5199\u64cd\u4f5c\u5728 hive-connector \u4e2d\u8fd8\u4e0d\u652f\u6301. \u6240\u4ee5, HQL \u4e2d\u7684 insert \u64cd\u4f5c\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\n+\n+### \u8bbe\u8ba1\u539f\u7406\n+\n+Hive \u8fde\u63a5\u5668\u9700\u8981\u80fd\u591f\u89e3\u6790 TsFile \u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6309\u884c\u8fd4\u56de\u7684\u683c\u5f0f\u3002\u4e5f\u9700\u8981\u80fd\u591f\u6839\u636e\u7528\u6237\u5b9a\u4e49\u7684 Table \u7684\u5f62\u5f0f\uff0c\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u6240\u4ee5\uff0cHive \u8fde\u63a5\u5668\u7684\u529f\u80fd\u5b9e\u73b0\u4e3b\u8981\u5206\u6210\u56db\u4e2a\u90e8\u5206\n+\n+* \u5c06\u6574\u4e2a TsFile \u6587\u4ef6\u5206\u7247\n+* \u4ece\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6570\u636e\u7c7b\u578b\n+* \u89e3\u6790\u7528\u6237\u81ea\u5b9a\u4e49\u7684 Table\n+* \u5c06\u6570\u636e\u53cd\u5e8f\u5217\u5316\u4e3a Hive \u7684\u8f93\u51fa\u683c\u5f0f\n+\n+### \u5177\u4f53\u5b9e\u73b0\u7c7b\n+\n+\u4e0a\u8ff0\u7684\u4e3b\u8981\u56db\u4e2a\u529f\u80fd\u6a21\u5757\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e0b\u9762\u5c31\u5206\u522b\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u56db\u4e2a\u5b9e\u73b0\u7c7b\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveInputFormat\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8e TsFile \u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\n+`TSFHiveRecordReader`\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveRecordReader\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6 TsFile \u7684\u6570\u636e\u3002\n+\n+\u5b83\u5b9e\u73b0\u4e86`IReaderSet`\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u91cc\u662f\u4e00\u4e9b\u8bbe\u7f6e\u7c7b\u5185\u90e8\u5c5e\u6027\u7684\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u62bd\u51fa`TSRecordReader`\u548c`TSHiveRecordReader`\u4e2d\u91cd\u590d\u7684\u4ee3\u7801\u90e8\u5206\u3002\n+\n+```\n+public interface IReaderSet {\n+\n+  void setReader(TsFileSequenceReader reader);\n+\n+  void setMeasurementIds(List<String> measurementIds);\n+\n+  void setReadDeviceId(boolean isReadDeviceId);\n+\n+  void setReadTime(boolean isReadTime);\n+}\n+```\n+\n+\u4e0b\u9762\u5148\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u7c7b\u7684\u4e00\u4e9b\u91cd\u8981\u5b57\u6bb5\n+\n+* private List<QueryDataSet> dataSetList = new ArrayList<>();\n+\n+  \u8fd9\u4e2a\u5206\u7247\u6240\u751f\u6210\u7684\u6240\u6709\u7684QueryDataSet", "originalCommit": "9c0ac33853a58309e110b450a430a2e399c1262c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyNzk4MQ==", "url": "https://github.com/apache/iotdb/pull/774#discussion_r375727981", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              \u8bbe\u5907\u540d\u5217\u8868\uff0c\u8fd9\u4e2a\u987a\u5e8f\u4e0edataSetList\u7684\u987a\u5e8f\u4e00\u81f4\uff0c\u5373deviceIdList[i]\u662fdataSetList[i]\u7684\u8bbe\u5907\u540d.\n          \n          \n            \n              \u8bbe\u5907\u540d\u5217\u8868\uff0c\u8fd9\u4e2a\u987a\u5e8f\u4e0e dataSetList \u7684\u987a\u5e8f\u4e00\u81f4\uff0c\u5373 deviceIdList[i] \u662f dataSetList[i] \u7684\u8bbe\u5907\u540d.", "author": "qiaojialin", "createdAt": "2020-02-06T09:38:01Z", "path": "docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "diffHunk": "@@ -0,0 +1,114 @@\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+## TsFile \u7684 Hive \u8fde\u63a5\u5668\n+\n+TsFile \u7684 Hive \u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u901a\u8fc7 Hive \u8bfb\u53d6\u5916\u90e8 TsFile \u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u901a\u8fc7 Hive \u64cd\u4f5c TsFile\u3002\n+\n+\u8fde\u63a5\u5668\u7684\u4e3b\u8981\u529f\u80fd\uff1a\n+\n+* \u5c06\u5355\u4e2a TsFile \u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u5c06\u67d0\u4e2a\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u4f7f\u7528 HQL \u67e5\u8be2 TsFile\n+* \u5230\u73b0\u5728\u4e3a\u6b62, \u5199\u64cd\u4f5c\u5728 hive-connector \u4e2d\u8fd8\u4e0d\u652f\u6301. \u6240\u4ee5, HQL \u4e2d\u7684 insert \u64cd\u4f5c\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\n+\n+### \u8bbe\u8ba1\u539f\u7406\n+\n+Hive \u8fde\u63a5\u5668\u9700\u8981\u80fd\u591f\u89e3\u6790 TsFile \u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6309\u884c\u8fd4\u56de\u7684\u683c\u5f0f\u3002\u4e5f\u9700\u8981\u80fd\u591f\u6839\u636e\u7528\u6237\u5b9a\u4e49\u7684 Table \u7684\u5f62\u5f0f\uff0c\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u6240\u4ee5\uff0cHive \u8fde\u63a5\u5668\u7684\u529f\u80fd\u5b9e\u73b0\u4e3b\u8981\u5206\u6210\u56db\u4e2a\u90e8\u5206\n+\n+* \u5c06\u6574\u4e2a TsFile \u6587\u4ef6\u5206\u7247\n+* \u4ece\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6570\u636e\u7c7b\u578b\n+* \u89e3\u6790\u7528\u6237\u81ea\u5b9a\u4e49\u7684 Table\n+* \u5c06\u6570\u636e\u53cd\u5e8f\u5217\u5316\u4e3a Hive \u7684\u8f93\u51fa\u683c\u5f0f\n+\n+### \u5177\u4f53\u5b9e\u73b0\u7c7b\n+\n+\u4e0a\u8ff0\u7684\u4e3b\u8981\u56db\u4e2a\u529f\u80fd\u6a21\u5757\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e0b\u9762\u5c31\u5206\u522b\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u56db\u4e2a\u5b9e\u73b0\u7c7b\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveInputFormat\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8e TsFile \u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\n+`TSFHiveRecordReader`\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveRecordReader\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6 TsFile \u7684\u6570\u636e\u3002\n+\n+\u5b83\u5b9e\u73b0\u4e86`IReaderSet`\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u91cc\u662f\u4e00\u4e9b\u8bbe\u7f6e\u7c7b\u5185\u90e8\u5c5e\u6027\u7684\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u62bd\u51fa`TSRecordReader`\u548c`TSHiveRecordReader`\u4e2d\u91cd\u590d\u7684\u4ee3\u7801\u90e8\u5206\u3002\n+\n+```\n+public interface IReaderSet {\n+\n+  void setReader(TsFileSequenceReader reader);\n+\n+  void setMeasurementIds(List<String> measurementIds);\n+\n+  void setReadDeviceId(boolean isReadDeviceId);\n+\n+  void setReadTime(boolean isReadTime);\n+}\n+```\n+\n+\u4e0b\u9762\u5148\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u7c7b\u7684\u4e00\u4e9b\u91cd\u8981\u5b57\u6bb5\n+\n+* private List<QueryDataSet> dataSetList = new ArrayList<>();\n+\n+  \u8fd9\u4e2a\u5206\u7247\u6240\u751f\u6210\u7684\u6240\u6709\u7684QueryDataSet\n+\n+* private List<String> deviceIdList = new ArrayList<>();\n+\n+  \u8bbe\u5907\u540d\u5217\u8868\uff0c\u8fd9\u4e2a\u987a\u5e8f\u4e0edataSetList\u7684\u987a\u5e8f\u4e00\u81f4\uff0c\u5373deviceIdList[i]\u662fdataSetList[i]\u7684\u8bbe\u5907\u540d.", "originalCommit": "9c0ac33853a58309e110b450a430a2e399c1262c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyODA4Ng==", "url": "https://github.com/apache/iotdb/pull/774#discussion_r375728086", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              \u5f53\u524d\u6b63\u5728\u88ab\u5904\u7406\u7684QueryDataSet\u7684\u4e0b\u6807\n          \n          \n            \n              \u5f53\u524d\u6b63\u5728\u88ab\u5904\u7406\u7684 QueryDataSet \u7684\u4e0b\u6807", "author": "qiaojialin", "createdAt": "2020-02-06T09:38:14Z", "path": "docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "diffHunk": "@@ -0,0 +1,114 @@\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+## TsFile \u7684 Hive \u8fde\u63a5\u5668\n+\n+TsFile \u7684 Hive \u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u901a\u8fc7 Hive \u8bfb\u53d6\u5916\u90e8 TsFile \u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u901a\u8fc7 Hive \u64cd\u4f5c TsFile\u3002\n+\n+\u8fde\u63a5\u5668\u7684\u4e3b\u8981\u529f\u80fd\uff1a\n+\n+* \u5c06\u5355\u4e2a TsFile \u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u5c06\u67d0\u4e2a\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u4f7f\u7528 HQL \u67e5\u8be2 TsFile\n+* \u5230\u73b0\u5728\u4e3a\u6b62, \u5199\u64cd\u4f5c\u5728 hive-connector \u4e2d\u8fd8\u4e0d\u652f\u6301. \u6240\u4ee5, HQL \u4e2d\u7684 insert \u64cd\u4f5c\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\n+\n+### \u8bbe\u8ba1\u539f\u7406\n+\n+Hive \u8fde\u63a5\u5668\u9700\u8981\u80fd\u591f\u89e3\u6790 TsFile \u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6309\u884c\u8fd4\u56de\u7684\u683c\u5f0f\u3002\u4e5f\u9700\u8981\u80fd\u591f\u6839\u636e\u7528\u6237\u5b9a\u4e49\u7684 Table \u7684\u5f62\u5f0f\uff0c\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u6240\u4ee5\uff0cHive \u8fde\u63a5\u5668\u7684\u529f\u80fd\u5b9e\u73b0\u4e3b\u8981\u5206\u6210\u56db\u4e2a\u90e8\u5206\n+\n+* \u5c06\u6574\u4e2a TsFile \u6587\u4ef6\u5206\u7247\n+* \u4ece\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6570\u636e\u7c7b\u578b\n+* \u89e3\u6790\u7528\u6237\u81ea\u5b9a\u4e49\u7684 Table\n+* \u5c06\u6570\u636e\u53cd\u5e8f\u5217\u5316\u4e3a Hive \u7684\u8f93\u51fa\u683c\u5f0f\n+\n+### \u5177\u4f53\u5b9e\u73b0\u7c7b\n+\n+\u4e0a\u8ff0\u7684\u4e3b\u8981\u56db\u4e2a\u529f\u80fd\u6a21\u5757\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e0b\u9762\u5c31\u5206\u522b\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u56db\u4e2a\u5b9e\u73b0\u7c7b\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveInputFormat\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8e TsFile \u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\n+`TSFHiveRecordReader`\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveRecordReader\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6 TsFile \u7684\u6570\u636e\u3002\n+\n+\u5b83\u5b9e\u73b0\u4e86`IReaderSet`\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u91cc\u662f\u4e00\u4e9b\u8bbe\u7f6e\u7c7b\u5185\u90e8\u5c5e\u6027\u7684\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u62bd\u51fa`TSRecordReader`\u548c`TSHiveRecordReader`\u4e2d\u91cd\u590d\u7684\u4ee3\u7801\u90e8\u5206\u3002\n+\n+```\n+public interface IReaderSet {\n+\n+  void setReader(TsFileSequenceReader reader);\n+\n+  void setMeasurementIds(List<String> measurementIds);\n+\n+  void setReadDeviceId(boolean isReadDeviceId);\n+\n+  void setReadTime(boolean isReadTime);\n+}\n+```\n+\n+\u4e0b\u9762\u5148\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u7c7b\u7684\u4e00\u4e9b\u91cd\u8981\u5b57\u6bb5\n+\n+* private List<QueryDataSet> dataSetList = new ArrayList<>();\n+\n+  \u8fd9\u4e2a\u5206\u7247\u6240\u751f\u6210\u7684\u6240\u6709\u7684QueryDataSet\n+\n+* private List<String> deviceIdList = new ArrayList<>();\n+\n+  \u8bbe\u5907\u540d\u5217\u8868\uff0c\u8fd9\u4e2a\u987a\u5e8f\u4e0edataSetList\u7684\u987a\u5e8f\u4e00\u81f4\uff0c\u5373deviceIdList[i]\u662fdataSetList[i]\u7684\u8bbe\u5907\u540d.\n+\n+* private int currentIndex = 0;\n+\n+  \u5f53\u524d\u6b63\u5728\u88ab\u5904\u7406\u7684QueryDataSet\u7684\u4e0b\u6807", "originalCommit": "9c0ac33853a58309e110b450a430a2e399c1262c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f1866df5f43aa26fd7c6f20ad47a44ce25420e72", "url": "https://github.com/apache/iotdb/commit/f1866df5f43aa26fd7c6f20ad47a44ce25420e72", "message": "Update docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "committedDate": "2020-02-06T09:38:22Z", "type": "commit"}, {"oid": "7607b82762e2d4b2fb1232bc9e76eba3e3327653", "url": "https://github.com/apache/iotdb/commit/7607b82762e2d4b2fb1232bc9e76eba3e3327653", "message": "Update docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "committedDate": "2020-02-06T09:38:37Z", "type": "commit"}, {"oid": "be9102102aaab69f2a6b653cfddc7adee95b6c1c", "url": "https://github.com/apache/iotdb/commit/be9102102aaab69f2a6b653cfddc7adee95b6c1c", "message": "Update docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "committedDate": "2020-02-06T09:39:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyODc5MA==", "url": "https://github.com/apache/iotdb/pull/774#discussion_r375728790", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \u8fd9\u4e2a\u7c7b\u5728\u6784\u9020\u51fd\u6570\u91cc\uff0c\u8c03\u7528\u4e86`TSFRecordReader`\u7684`initialize(TSFInputSplit, Configuration, IReaderSet, List<QueryDataSet>, List<String>)`\u65b9\u6cd5\u53bb\u521d\u59cb\u5316\u4e0a\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u7c7b\u5b57\u6bb5\u3002\u5b83\u8986\u5199\u4e86`RecordReader`\u7684`next()`\u65b9\u6cd5\uff0c\u7528\u4ee5\u8fd4\u56de\u4ecetsfile\u91cc\u8bfb\u51fa\u7684\u6570\u636e\u3002\n          \n          \n            \n            \u8fd9\u4e2a\u7c7b\u5728\u6784\u9020\u51fd\u6570\u91cc\uff0c\u8c03\u7528\u4e86`TSFRecordReader`\u7684`initialize(TSFInputSplit, Configuration, IReaderSet, List<QueryDataSet>, List<String>)`\u65b9\u6cd5\u53bb\u521d\u59cb\u5316\u4e0a\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u7c7b\u5b57\u6bb5\u3002\u5b83\u8986\u5199\u4e86`RecordReader`\u7684`next()`\u65b9\u6cd5\uff0c\u7528\u4ee5\u8fd4\u56de\u4ece TsFile \u91cc\u8bfb\u51fa\u7684\u6570\u636e\u3002", "author": "qiaojialin", "createdAt": "2020-02-06T09:39:33Z", "path": "docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "diffHunk": "@@ -0,0 +1,114 @@\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+## TsFile \u7684 Hive \u8fde\u63a5\u5668\n+\n+TsFile \u7684 Hive \u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u901a\u8fc7 Hive \u8bfb\u53d6\u5916\u90e8 TsFile \u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u901a\u8fc7 Hive \u64cd\u4f5c TsFile\u3002\n+\n+\u8fde\u63a5\u5668\u7684\u4e3b\u8981\u529f\u80fd\uff1a\n+\n+* \u5c06\u5355\u4e2a TsFile \u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u5c06\u67d0\u4e2a\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u4f7f\u7528 HQL \u67e5\u8be2 TsFile\n+* \u5230\u73b0\u5728\u4e3a\u6b62, \u5199\u64cd\u4f5c\u5728 hive-connector \u4e2d\u8fd8\u4e0d\u652f\u6301. \u6240\u4ee5, HQL \u4e2d\u7684 insert \u64cd\u4f5c\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\n+\n+### \u8bbe\u8ba1\u539f\u7406\n+\n+Hive \u8fde\u63a5\u5668\u9700\u8981\u80fd\u591f\u89e3\u6790 TsFile \u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6309\u884c\u8fd4\u56de\u7684\u683c\u5f0f\u3002\u4e5f\u9700\u8981\u80fd\u591f\u6839\u636e\u7528\u6237\u5b9a\u4e49\u7684 Table \u7684\u5f62\u5f0f\uff0c\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u6240\u4ee5\uff0cHive \u8fde\u63a5\u5668\u7684\u529f\u80fd\u5b9e\u73b0\u4e3b\u8981\u5206\u6210\u56db\u4e2a\u90e8\u5206\n+\n+* \u5c06\u6574\u4e2a TsFile \u6587\u4ef6\u5206\u7247\n+* \u4ece\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6570\u636e\u7c7b\u578b\n+* \u89e3\u6790\u7528\u6237\u81ea\u5b9a\u4e49\u7684 Table\n+* \u5c06\u6570\u636e\u53cd\u5e8f\u5217\u5316\u4e3a Hive \u7684\u8f93\u51fa\u683c\u5f0f\n+\n+### \u5177\u4f53\u5b9e\u73b0\u7c7b\n+\n+\u4e0a\u8ff0\u7684\u4e3b\u8981\u56db\u4e2a\u529f\u80fd\u6a21\u5757\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e0b\u9762\u5c31\u5206\u522b\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u56db\u4e2a\u5b9e\u73b0\u7c7b\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveInputFormat\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8e TsFile \u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\n+`TSFHiveRecordReader`\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveRecordReader\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6 TsFile \u7684\u6570\u636e\u3002\n+\n+\u5b83\u5b9e\u73b0\u4e86`IReaderSet`\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u91cc\u662f\u4e00\u4e9b\u8bbe\u7f6e\u7c7b\u5185\u90e8\u5c5e\u6027\u7684\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u62bd\u51fa`TSRecordReader`\u548c`TSHiveRecordReader`\u4e2d\u91cd\u590d\u7684\u4ee3\u7801\u90e8\u5206\u3002\n+\n+```\n+public interface IReaderSet {\n+\n+  void setReader(TsFileSequenceReader reader);\n+\n+  void setMeasurementIds(List<String> measurementIds);\n+\n+  void setReadDeviceId(boolean isReadDeviceId);\n+\n+  void setReadTime(boolean isReadTime);\n+}\n+```\n+\n+\u4e0b\u9762\u5148\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u7c7b\u7684\u4e00\u4e9b\u91cd\u8981\u5b57\u6bb5\n+\n+* private List<QueryDataSet> dataSetList = new ArrayList<>();\n+\n+  \u8fd9\u4e2a\u5206\u7247\u6240\u751f\u6210\u7684\u6240\u6709\u7684 QueryDataSet\n+\n+* private List<String> deviceIdList = new ArrayList<>();\n+\n+  \u8bbe\u5907\u540d\u5217\u8868\uff0c\u8fd9\u4e2a\u987a\u5e8f\u4e0e dataSetList \u7684\u987a\u5e8f\u4e00\u81f4\uff0c\u5373 deviceIdList[i] \u662f dataSetList[i] \u7684\u8bbe\u5907\u540d.\n+\n+* private int currentIndex = 0;\n+\n+  \u5f53\u524d\u6b63\u5728\u88ab\u5904\u7406\u7684 QueryDataSet \u7684\u4e0b\u6807\n+  \n+\u8fd9\u4e2a\u7c7b\u5728\u6784\u9020\u51fd\u6570\u91cc\uff0c\u8c03\u7528\u4e86`TSFRecordReader`\u7684`initialize(TSFInputSplit, Configuration, IReaderSet, List<QueryDataSet>, List<String>)`\u65b9\u6cd5\u53bb\u521d\u59cb\u5316\u4e0a\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u7c7b\u5b57\u6bb5\u3002\u5b83\u8986\u5199\u4e86`RecordReader`\u7684`next()`\u65b9\u6cd5\uff0c\u7528\u4ee5\u8fd4\u56de\u4ecetsfile\u91cc\u8bfb\u51fa\u7684\u6570\u636e\u3002", "originalCommit": "be9102102aaab69f2a6b653cfddc7adee95b6c1c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "14f551d710a3319652fc27d772c1bc22572f63ca", "url": "https://github.com/apache/iotdb/commit/14f551d710a3319652fc27d772c1bc22572f63ca", "message": "Update docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "committedDate": "2020-02-06T09:39:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyOTE4Mw==", "url": "https://github.com/apache/iotdb/pull/774#discussion_r375729183", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \u6211\u4eec\u6ce8\u610f\u5230\u5b83\u4ece TsFile \u8bfb\u53d6\u51fa\u6765\u6570\u636e\u4e4b\u540e\uff0c\u662f\u4ee5`MapWritable`\u7684\u5f62\u5f0f\u8fd4\u56de\u7684\uff0c\u8fd9\u91cc\u7684`MapWritable`\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a`Map`\uff0c\u53ea\u4e0d\u8fc7\u5b83\u7684key\u4e0evalue\u90fd\u505a\u4e86\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u7684\u7279\u6b8a\u9002\u914d\uff0c\u5b83\u7684\u8bfb\u53d6\u6d41\u7a0b\u5982\u4e0b\n          \n          \n            \n            \u6211\u4eec\u6ce8\u610f\u5230\u5b83\u4ece TsFile \u8bfb\u53d6\u51fa\u6765\u6570\u636e\u4e4b\u540e\uff0c\u662f\u4ee5`MapWritable`\u7684\u5f62\u5f0f\u8fd4\u56de\u7684\uff0c\u8fd9\u91cc\u7684`MapWritable`\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a`Map`\uff0c\u53ea\u4e0d\u8fc7\u5b83\u7684 key \u4e0e value \u90fd\u505a\u4e86\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u7684\u7279\u6b8a\u9002\u914d\uff0c\u5b83\u7684\u8bfb\u53d6\u6d41\u7a0b\u5982\u4e0b", "author": "qiaojialin", "createdAt": "2020-02-06T09:40:23Z", "path": "docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "diffHunk": "@@ -0,0 +1,114 @@\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+## TsFile \u7684 Hive \u8fde\u63a5\u5668\n+\n+TsFile \u7684 Hive \u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u901a\u8fc7 Hive \u8bfb\u53d6\u5916\u90e8 TsFile \u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u901a\u8fc7 Hive \u64cd\u4f5c TsFile\u3002\n+\n+\u8fde\u63a5\u5668\u7684\u4e3b\u8981\u529f\u80fd\uff1a\n+\n+* \u5c06\u5355\u4e2a TsFile \u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u5c06\u67d0\u4e2a\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u4f7f\u7528 HQL \u67e5\u8be2 TsFile\n+* \u5230\u73b0\u5728\u4e3a\u6b62, \u5199\u64cd\u4f5c\u5728 hive-connector \u4e2d\u8fd8\u4e0d\u652f\u6301. \u6240\u4ee5, HQL \u4e2d\u7684 insert \u64cd\u4f5c\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\n+\n+### \u8bbe\u8ba1\u539f\u7406\n+\n+Hive \u8fde\u63a5\u5668\u9700\u8981\u80fd\u591f\u89e3\u6790 TsFile \u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6309\u884c\u8fd4\u56de\u7684\u683c\u5f0f\u3002\u4e5f\u9700\u8981\u80fd\u591f\u6839\u636e\u7528\u6237\u5b9a\u4e49\u7684 Table \u7684\u5f62\u5f0f\uff0c\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u6240\u4ee5\uff0cHive \u8fde\u63a5\u5668\u7684\u529f\u80fd\u5b9e\u73b0\u4e3b\u8981\u5206\u6210\u56db\u4e2a\u90e8\u5206\n+\n+* \u5c06\u6574\u4e2a TsFile \u6587\u4ef6\u5206\u7247\n+* \u4ece\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6570\u636e\u7c7b\u578b\n+* \u89e3\u6790\u7528\u6237\u81ea\u5b9a\u4e49\u7684 Table\n+* \u5c06\u6570\u636e\u53cd\u5e8f\u5217\u5316\u4e3a Hive \u7684\u8f93\u51fa\u683c\u5f0f\n+\n+### \u5177\u4f53\u5b9e\u73b0\u7c7b\n+\n+\u4e0a\u8ff0\u7684\u4e3b\u8981\u56db\u4e2a\u529f\u80fd\u6a21\u5757\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e0b\u9762\u5c31\u5206\u522b\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u56db\u4e2a\u5b9e\u73b0\u7c7b\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveInputFormat\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8e TsFile \u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\n+`TSFHiveRecordReader`\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveRecordReader\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6 TsFile \u7684\u6570\u636e\u3002\n+\n+\u5b83\u5b9e\u73b0\u4e86`IReaderSet`\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u91cc\u662f\u4e00\u4e9b\u8bbe\u7f6e\u7c7b\u5185\u90e8\u5c5e\u6027\u7684\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u62bd\u51fa`TSRecordReader`\u548c`TSHiveRecordReader`\u4e2d\u91cd\u590d\u7684\u4ee3\u7801\u90e8\u5206\u3002\n+\n+```\n+public interface IReaderSet {\n+\n+  void setReader(TsFileSequenceReader reader);\n+\n+  void setMeasurementIds(List<String> measurementIds);\n+\n+  void setReadDeviceId(boolean isReadDeviceId);\n+\n+  void setReadTime(boolean isReadTime);\n+}\n+```\n+\n+\u4e0b\u9762\u5148\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u7c7b\u7684\u4e00\u4e9b\u91cd\u8981\u5b57\u6bb5\n+\n+* private List<QueryDataSet> dataSetList = new ArrayList<>();\n+\n+  \u8fd9\u4e2a\u5206\u7247\u6240\u751f\u6210\u7684\u6240\u6709\u7684 QueryDataSet\n+\n+* private List<String> deviceIdList = new ArrayList<>();\n+\n+  \u8bbe\u5907\u540d\u5217\u8868\uff0c\u8fd9\u4e2a\u987a\u5e8f\u4e0e dataSetList \u7684\u987a\u5e8f\u4e00\u81f4\uff0c\u5373 deviceIdList[i] \u662f dataSetList[i] \u7684\u8bbe\u5907\u540d.\n+\n+* private int currentIndex = 0;\n+\n+  \u5f53\u524d\u6b63\u5728\u88ab\u5904\u7406\u7684 QueryDataSet \u7684\u4e0b\u6807\n+  \n+\u8fd9\u4e2a\u7c7b\u5728\u6784\u9020\u51fd\u6570\u91cc\uff0c\u8c03\u7528\u4e86`TSFRecordReader`\u7684`initialize(TSFInputSplit, Configuration, IReaderSet, List<QueryDataSet>, List<String>)`\u65b9\u6cd5\u53bb\u521d\u59cb\u5316\u4e0a\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u7c7b\u5b57\u6bb5\u3002\u5b83\u8986\u5199\u4e86`RecordReader`\u7684`next()`\u65b9\u6cd5\uff0c\u7528\u4ee5\u8fd4\u56de\u4ece TsFile \u91cc\u8bfb\u51fa\u7684\u6570\u636e\u3002\n+  \n+##### next(NullWritable, MapWritable)\n+\n+\u6211\u4eec\u6ce8\u610f\u5230\u5b83\u4ece TsFile \u8bfb\u53d6\u51fa\u6765\u6570\u636e\u4e4b\u540e\uff0c\u662f\u4ee5`MapWritable`\u7684\u5f62\u5f0f\u8fd4\u56de\u7684\uff0c\u8fd9\u91cc\u7684`MapWritable`\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a`Map`\uff0c\u53ea\u4e0d\u8fc7\u5b83\u7684key\u4e0evalue\u90fd\u505a\u4e86\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u7684\u7279\u6b8a\u9002\u914d\uff0c\u5b83\u7684\u8bfb\u53d6\u6d41\u7a0b\u5982\u4e0b", "originalCommit": "14f551d710a3319652fc27d772c1bc22572f63ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1b5e7077224c5928c11bc4a7a0cd58ee1db5a7e6", "url": "https://github.com/apache/iotdb/commit/1b5e7077224c5928c11bc4a7a0cd58ee1db5a7e6", "message": "Update docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "committedDate": "2020-02-06T09:40:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyOTQ0Mw==", "url": "https://github.com/apache/iotdb/pull/774#discussion_r375729443", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            3. \u6700\u540e\u8c03\u7528`TSFRecordReader`\u7684`getCurrentValue()`\u65b9\u6cd5\uff0c\u5c06`RowRecord`\u4e2d\u7684\u503cset\u8fdb`MapWritable`\u91cc\n          \n          \n            \n            3. \u6700\u540e\u8c03\u7528`TSFRecordReader`\u7684`getCurrentValue()`\u65b9\u6cd5\uff0c\u5c06`RowRecord`\u4e2d\u7684\u503c\u653e\u5165`MapWritable`\u91cc", "author": "qiaojialin", "createdAt": "2020-02-06T09:40:56Z", "path": "docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "diffHunk": "@@ -0,0 +1,114 @@\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+## TsFile \u7684 Hive \u8fde\u63a5\u5668\n+\n+TsFile \u7684 Hive \u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u901a\u8fc7 Hive \u8bfb\u53d6\u5916\u90e8 TsFile \u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u901a\u8fc7 Hive \u64cd\u4f5c TsFile\u3002\n+\n+\u8fde\u63a5\u5668\u7684\u4e3b\u8981\u529f\u80fd\uff1a\n+\n+* \u5c06\u5355\u4e2a TsFile \u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u5c06\u67d0\u4e2a\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u4f7f\u7528 HQL \u67e5\u8be2 TsFile\n+* \u5230\u73b0\u5728\u4e3a\u6b62, \u5199\u64cd\u4f5c\u5728 hive-connector \u4e2d\u8fd8\u4e0d\u652f\u6301. \u6240\u4ee5, HQL \u4e2d\u7684 insert \u64cd\u4f5c\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\n+\n+### \u8bbe\u8ba1\u539f\u7406\n+\n+Hive \u8fde\u63a5\u5668\u9700\u8981\u80fd\u591f\u89e3\u6790 TsFile \u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6309\u884c\u8fd4\u56de\u7684\u683c\u5f0f\u3002\u4e5f\u9700\u8981\u80fd\u591f\u6839\u636e\u7528\u6237\u5b9a\u4e49\u7684 Table \u7684\u5f62\u5f0f\uff0c\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u6240\u4ee5\uff0cHive \u8fde\u63a5\u5668\u7684\u529f\u80fd\u5b9e\u73b0\u4e3b\u8981\u5206\u6210\u56db\u4e2a\u90e8\u5206\n+\n+* \u5c06\u6574\u4e2a TsFile \u6587\u4ef6\u5206\u7247\n+* \u4ece\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6570\u636e\u7c7b\u578b\n+* \u89e3\u6790\u7528\u6237\u81ea\u5b9a\u4e49\u7684 Table\n+* \u5c06\u6570\u636e\u53cd\u5e8f\u5217\u5316\u4e3a Hive \u7684\u8f93\u51fa\u683c\u5f0f\n+\n+### \u5177\u4f53\u5b9e\u73b0\u7c7b\n+\n+\u4e0a\u8ff0\u7684\u4e3b\u8981\u56db\u4e2a\u529f\u80fd\u6a21\u5757\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e0b\u9762\u5c31\u5206\u522b\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u56db\u4e2a\u5b9e\u73b0\u7c7b\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveInputFormat\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8e TsFile \u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\n+`TSFHiveRecordReader`\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveRecordReader\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6 TsFile \u7684\u6570\u636e\u3002\n+\n+\u5b83\u5b9e\u73b0\u4e86`IReaderSet`\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u91cc\u662f\u4e00\u4e9b\u8bbe\u7f6e\u7c7b\u5185\u90e8\u5c5e\u6027\u7684\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u62bd\u51fa`TSRecordReader`\u548c`TSHiveRecordReader`\u4e2d\u91cd\u590d\u7684\u4ee3\u7801\u90e8\u5206\u3002\n+\n+```\n+public interface IReaderSet {\n+\n+  void setReader(TsFileSequenceReader reader);\n+\n+  void setMeasurementIds(List<String> measurementIds);\n+\n+  void setReadDeviceId(boolean isReadDeviceId);\n+\n+  void setReadTime(boolean isReadTime);\n+}\n+```\n+\n+\u4e0b\u9762\u5148\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u7c7b\u7684\u4e00\u4e9b\u91cd\u8981\u5b57\u6bb5\n+\n+* private List<QueryDataSet> dataSetList = new ArrayList<>();\n+\n+  \u8fd9\u4e2a\u5206\u7247\u6240\u751f\u6210\u7684\u6240\u6709\u7684 QueryDataSet\n+\n+* private List<String> deviceIdList = new ArrayList<>();\n+\n+  \u8bbe\u5907\u540d\u5217\u8868\uff0c\u8fd9\u4e2a\u987a\u5e8f\u4e0e dataSetList \u7684\u987a\u5e8f\u4e00\u81f4\uff0c\u5373 deviceIdList[i] \u662f dataSetList[i] \u7684\u8bbe\u5907\u540d.\n+\n+* private int currentIndex = 0;\n+\n+  \u5f53\u524d\u6b63\u5728\u88ab\u5904\u7406\u7684 QueryDataSet \u7684\u4e0b\u6807\n+  \n+\u8fd9\u4e2a\u7c7b\u5728\u6784\u9020\u51fd\u6570\u91cc\uff0c\u8c03\u7528\u4e86`TSFRecordReader`\u7684`initialize(TSFInputSplit, Configuration, IReaderSet, List<QueryDataSet>, List<String>)`\u65b9\u6cd5\u53bb\u521d\u59cb\u5316\u4e0a\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u7c7b\u5b57\u6bb5\u3002\u5b83\u8986\u5199\u4e86`RecordReader`\u7684`next()`\u65b9\u6cd5\uff0c\u7528\u4ee5\u8fd4\u56de\u4ece TsFile \u91cc\u8bfb\u51fa\u7684\u6570\u636e\u3002\n+  \n+##### next(NullWritable, MapWritable)\n+\n+\u6211\u4eec\u6ce8\u610f\u5230\u5b83\u4ece TsFile \u8bfb\u53d6\u51fa\u6765\u6570\u636e\u4e4b\u540e\uff0c\u662f\u4ee5`MapWritable`\u7684\u5f62\u5f0f\u8fd4\u56de\u7684\uff0c\u8fd9\u91cc\u7684`MapWritable`\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a`Map`\uff0c\u53ea\u4e0d\u8fc7\u5b83\u7684 key \u4e0e value \u90fd\u505a\u4e86\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u7684\u7279\u6b8a\u9002\u914d\uff0c\u5b83\u7684\u8bfb\u53d6\u6d41\u7a0b\u5982\u4e0b\n+\n+1. \u9996\u5148\u5224\u65ad`dataSetList`\u5f53\u524d\u4f4d\u7f6e\u7684`QueryDataSet`\u8fd8\u6709\u6ca1\u6709\u503c\uff0c\u5982\u679c\u6ca1\u6709\u503c\uff0c\u5219\u5c06`currentIndex`\u9012\u589e1\uff0c\u76f4\u5230\u627e\u5230\u7b2c\u4e00\u4e2a\u6709\u503c\u7684`QueryDataSet`\n+2. \u7136\u540e\u8c03\u7528`QueryDataSet`\u7684`next()`\u65b9\u6cd5\u83b7\u5f97`RowRecord`\n+3. \u6700\u540e\u8c03\u7528`TSFRecordReader`\u7684`getCurrentValue()`\u65b9\u6cd5\uff0c\u5c06`RowRecord`\u4e2d\u7684\u503cset\u8fdb`MapWritable`\u91cc", "originalCommit": "1b5e7077224c5928c11bc4a7a0cd58ee1db5a7e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d5e694838ccecf8018fb9e68660a3f16781f5f1", "url": "https://github.com/apache/iotdb/commit/4d5e694838ccecf8018fb9e68660a3f16781f5f1", "message": "Update docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "committedDate": "2020-02-06T09:41:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyOTgwNQ==", "url": "https://github.com/apache/iotdb/pull/774#discussion_r375729805", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \u5b83\u8986\u5199\u4e86`AbstractSerDe`\u7684`initialize()`\u65b9\u6cd5\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\uff0c\u4ece\u7528\u6237\u7684\u5efa\u8868 sql \u91cc\uff0c\u89e3\u6790\u51fa\u76f8\u5e94\u7684\u8bbe\u5907\u540d\uff0c\u4f20\u611f\u5668\u540d\u4ee5\u53ca\u4f20\u611f\u5668\u5bf9\u5e94\u7684\u7c7b\u578b\u3002\u8fd8\u8981\u6784\u5efa\u51fa`ObjectInspector`\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u4e3b\u8981\u8d1f\u8d23\u6570\u636e\u7c7b\u578b\u7684\u8f6c\u5316\uff0c\u7531\u4e8eTsfile\u53ea\u652f\u6301\u539f\u59cb\u6570\u636e\u7c7b\u578b\uff0c\u6240\u4ee5\u5f53\u51fa\u73b0\u5176\u4ed6\u6570\u636e\u7c7b\u578b\u65f6\uff0c\u9700\u8981\u629b\u51fa\u5f02\u5e38\uff0c\u5177\u4f53\u7684\u6784\u5efa\u8fc7\u7a0b\u5728`createObjectInspectorWorker()`\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u770b\u5230\n          \n          \n            \n            \u5b83\u8986\u5199\u4e86`AbstractSerDe`\u7684`initialize()`\u65b9\u6cd5\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\uff0c\u4ece\u7528\u6237\u7684\u5efa\u8868 sql \u91cc\uff0c\u89e3\u6790\u51fa\u76f8\u5e94\u7684\u8bbe\u5907\u540d\uff0c\u4f20\u611f\u5668\u540d\u4ee5\u53ca\u4f20\u611f\u5668\u5bf9\u5e94\u7684\u7c7b\u578b\u3002\u8fd8\u8981\u6784\u5efa\u51fa`ObjectInspector`\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u4e3b\u8981\u8d1f\u8d23\u6570\u636e\u7c7b\u578b\u7684\u8f6c\u5316\uff0c\u7531\u4e8e TsFile \u53ea\u652f\u6301\u539f\u59cb\u6570\u636e\u7c7b\u578b\uff0c\u6240\u4ee5\u5f53\u51fa\u73b0\u5176\u4ed6\u6570\u636e\u7c7b\u578b\u65f6\uff0c\u9700\u8981\u629b\u51fa\u5f02\u5e38\uff0c\u5177\u4f53\u7684\u6784\u5efa\u8fc7\u7a0b\u5728`createObjectInspectorWorker()`\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u770b\u5230\u3002", "author": "qiaojialin", "createdAt": "2020-02-06T09:41:37Z", "path": "docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "diffHunk": "@@ -0,0 +1,114 @@\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+## TsFile \u7684 Hive \u8fde\u63a5\u5668\n+\n+TsFile \u7684 Hive \u8fde\u63a5\u5668\u5b9e\u73b0\u4e86\u901a\u8fc7 Hive \u8bfb\u53d6\u5916\u90e8 TsFile \u7c7b\u578b\u7684\u6587\u4ef6\u683c\u5f0f\u7684\u652f\u6301\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u901a\u8fc7 Hive \u64cd\u4f5c TsFile\u3002\n+\n+\u8fde\u63a5\u5668\u7684\u4e3b\u8981\u529f\u80fd\uff1a\n+\n+* \u5c06\u5355\u4e2a TsFile \u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u5c06\u67d0\u4e2a\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u52a0\u8f7d\u8fdb Hive\uff0c\u4e0d\u8bba\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u662f HDFS \u4e2d\n+* \u4f7f\u7528 HQL \u67e5\u8be2 TsFile\n+* \u5230\u73b0\u5728\u4e3a\u6b62, \u5199\u64cd\u4f5c\u5728 hive-connector \u4e2d\u8fd8\u4e0d\u652f\u6301. \u6240\u4ee5, HQL \u4e2d\u7684 insert \u64cd\u4f5c\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\n+\n+### \u8bbe\u8ba1\u539f\u7406\n+\n+Hive \u8fde\u63a5\u5668\u9700\u8981\u80fd\u591f\u89e3\u6790 TsFile \u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6309\u884c\u8fd4\u56de\u7684\u683c\u5f0f\u3002\u4e5f\u9700\u8981\u80fd\u591f\u6839\u636e\u7528\u6237\u5b9a\u4e49\u7684 Table \u7684\u5f62\u5f0f\uff0c\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u6240\u4ee5\uff0cHive \u8fde\u63a5\u5668\u7684\u529f\u80fd\u5b9e\u73b0\u4e3b\u8981\u5206\u6210\u56db\u4e2a\u90e8\u5206\n+\n+* \u5c06\u6574\u4e2a TsFile \u6587\u4ef6\u5206\u7247\n+* \u4ece\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8f6c\u5316\u4e3a Hive \u80fd\u591f\u8bc6\u522b\u7684\u6570\u636e\u7c7b\u578b\n+* \u89e3\u6790\u7528\u6237\u81ea\u5b9a\u4e49\u7684 Table\n+* \u5c06\u6570\u636e\u53cd\u5e8f\u5217\u5316\u4e3a Hive \u7684\u8f93\u51fa\u683c\u5f0f\n+\n+### \u5177\u4f53\u5b9e\u73b0\u7c7b\n+\n+\u4e0a\u8ff0\u7684\u4e3b\u8981\u56db\u4e2a\u529f\u80fd\u6a21\u5757\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e0b\u9762\u5c31\u5206\u522b\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u56db\u4e2a\u5b9e\u73b0\u7c7b\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveInputFormat\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u5bf9\u8f93\u5165\u7684 TsFile \u6587\u4ef6\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u5b83\u7ee7\u627f\u4e86`FileInputFormat<NullWritable, MapWritable>`\u7c7b\uff0c\u4e00\u4e9b\u901a\u7528\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\u5728`FileInputFormat`\u4e2d\u5df2\u7ecf\u6709\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u8986\u5199\u4e86\u5b83\u7684`getSplits(JobConf, int)`\u65b9\u6cd5\uff0c\u81ea\u5b9a\u4e49\u4e86\u5bf9\u4e8e TsFile \u6587\u4ef6\u7684\u5206\u7247\u65b9\u5f0f\uff1b\u4ee5\u53ca`getRecordReader(InputSpli, JobConf, Reporter)`\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u5177\u4f53\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\n+`TSFHiveRecordReader`\u3002\n+\n+#### org.apache.iotdb.hive.TSFHiveRecordReader\n+\n+\u8be5\u7c7b\u4e3b\u8981\u8d1f\u8d23\u4ece\u4e00\u4e2a\u5206\u7247\u4e2d\u8bfb\u53d6 TsFile \u7684\u6570\u636e\u3002\n+\n+\u5b83\u5b9e\u73b0\u4e86`IReaderSet`\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u91cc\u662f\u4e00\u4e9b\u8bbe\u7f6e\u7c7b\u5185\u90e8\u5c5e\u6027\u7684\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u62bd\u51fa`TSRecordReader`\u548c`TSHiveRecordReader`\u4e2d\u91cd\u590d\u7684\u4ee3\u7801\u90e8\u5206\u3002\n+\n+```\n+public interface IReaderSet {\n+\n+  void setReader(TsFileSequenceReader reader);\n+\n+  void setMeasurementIds(List<String> measurementIds);\n+\n+  void setReadDeviceId(boolean isReadDeviceId);\n+\n+  void setReadTime(boolean isReadTime);\n+}\n+```\n+\n+\u4e0b\u9762\u5148\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u7c7b\u7684\u4e00\u4e9b\u91cd\u8981\u5b57\u6bb5\n+\n+* private List<QueryDataSet> dataSetList = new ArrayList<>();\n+\n+  \u8fd9\u4e2a\u5206\u7247\u6240\u751f\u6210\u7684\u6240\u6709\u7684 QueryDataSet\n+\n+* private List<String> deviceIdList = new ArrayList<>();\n+\n+  \u8bbe\u5907\u540d\u5217\u8868\uff0c\u8fd9\u4e2a\u987a\u5e8f\u4e0e dataSetList \u7684\u987a\u5e8f\u4e00\u81f4\uff0c\u5373 deviceIdList[i] \u662f dataSetList[i] \u7684\u8bbe\u5907\u540d.\n+\n+* private int currentIndex = 0;\n+\n+  \u5f53\u524d\u6b63\u5728\u88ab\u5904\u7406\u7684 QueryDataSet \u7684\u4e0b\u6807\n+  \n+\u8fd9\u4e2a\u7c7b\u5728\u6784\u9020\u51fd\u6570\u91cc\uff0c\u8c03\u7528\u4e86`TSFRecordReader`\u7684`initialize(TSFInputSplit, Configuration, IReaderSet, List<QueryDataSet>, List<String>)`\u65b9\u6cd5\u53bb\u521d\u59cb\u5316\u4e0a\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u7c7b\u5b57\u6bb5\u3002\u5b83\u8986\u5199\u4e86`RecordReader`\u7684`next()`\u65b9\u6cd5\uff0c\u7528\u4ee5\u8fd4\u56de\u4ece TsFile \u91cc\u8bfb\u51fa\u7684\u6570\u636e\u3002\n+  \n+##### next(NullWritable, MapWritable)\n+\n+\u6211\u4eec\u6ce8\u610f\u5230\u5b83\u4ece TsFile \u8bfb\u53d6\u51fa\u6765\u6570\u636e\u4e4b\u540e\uff0c\u662f\u4ee5`MapWritable`\u7684\u5f62\u5f0f\u8fd4\u56de\u7684\uff0c\u8fd9\u91cc\u7684`MapWritable`\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a`Map`\uff0c\u53ea\u4e0d\u8fc7\u5b83\u7684 key \u4e0e value \u90fd\u505a\u4e86\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u7684\u7279\u6b8a\u9002\u914d\uff0c\u5b83\u7684\u8bfb\u53d6\u6d41\u7a0b\u5982\u4e0b\n+\n+1. \u9996\u5148\u5224\u65ad`dataSetList`\u5f53\u524d\u4f4d\u7f6e\u7684`QueryDataSet`\u8fd8\u6709\u6ca1\u6709\u503c\uff0c\u5982\u679c\u6ca1\u6709\u503c\uff0c\u5219\u5c06`currentIndex`\u9012\u589e1\uff0c\u76f4\u5230\u627e\u5230\u7b2c\u4e00\u4e2a\u6709\u503c\u7684`QueryDataSet`\n+2. \u7136\u540e\u8c03\u7528`QueryDataSet`\u7684`next()`\u65b9\u6cd5\u83b7\u5f97`RowRecord`\n+3. \u6700\u540e\u8c03\u7528`TSFRecordReader`\u7684`getCurrentValue()`\u65b9\u6cd5\uff0c\u5c06`RowRecord`\u4e2d\u7684\u503c\u653e\u5165`MapWritable`\u91cc\n+\n+\n+#### org.apache.iotdb.hive.TsFileSerDe\n+\n+\u8fd9\u4e2a\u7c7b\u7ee7\u627f\u4e86`AbstractSerDe`\uff0c\u4e5f\u662f\u6211\u4eec\u5b9e\u73b0Hive\u4ece\u81ea\u5b9a\u4e49\u8f93\u5165\u683c\u5f0f\u4e2d\u8bfb\u53d6\u6570\u636e\u6240\u5fc5\u987b\u7684\u3002\n+\n+\u5b83\u8986\u5199\u4e86`AbstractSerDe`\u7684`initialize()`\u65b9\u6cd5\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\uff0c\u4ece\u7528\u6237\u7684\u5efa\u8868 sql \u91cc\uff0c\u89e3\u6790\u51fa\u76f8\u5e94\u7684\u8bbe\u5907\u540d\uff0c\u4f20\u611f\u5668\u540d\u4ee5\u53ca\u4f20\u611f\u5668\u5bf9\u5e94\u7684\u7c7b\u578b\u3002\u8fd8\u8981\u6784\u5efa\u51fa`ObjectInspector`\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u4e3b\u8981\u8d1f\u8d23\u6570\u636e\u7c7b\u578b\u7684\u8f6c\u5316\uff0c\u7531\u4e8eTsfile\u53ea\u652f\u6301\u539f\u59cb\u6570\u636e\u7c7b\u578b\uff0c\u6240\u4ee5\u5f53\u51fa\u73b0\u5176\u4ed6\u6570\u636e\u7c7b\u578b\u65f6\uff0c\u9700\u8981\u629b\u51fa\u5f02\u5e38\uff0c\u5177\u4f53\u7684\u6784\u5efa\u8fc7\u7a0b\u5728`createObjectInspectorWorker()`\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u770b\u5230", "originalCommit": "4d5e694838ccecf8018fb9e68660a3f16781f5f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "61a3e2bd3a38e20584e7efb9c6e3da18acddfc4b", "url": "https://github.com/apache/iotdb/commit/61a3e2bd3a38e20584e7efb9c6e3da18acddfc4b", "message": "Update docs/Documentation-CHN/SystemDesign/7-Connector/2-Hive-TsFile.md", "committedDate": "2020-02-06T09:41:44Z", "type": "commit"}]}