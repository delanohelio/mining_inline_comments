{"pr_number": 1694, "pr_title": "[IOTDB-813] Show storage group under given path prefix", "pr_createdAt": "2020-09-06T07:49:18Z", "pr_url": "https://github.com/apache/iotdb/pull/1694", "timeline": [{"oid": "8c1f53f078c1219f8967bedc2b7ba0a067696db9", "url": "https://github.com/apache/iotdb/commit/8c1f53f078c1219f8967bedc2b7ba0a067696db9", "message": "[IOTDB-813] Show storage group under given path prefix", "committedDate": "2020-09-06T07:35:27Z", "type": "commit"}, {"oid": "d77fa24f65db82eb33a02116a76b9212c21fcf3d", "url": "https://github.com/apache/iotdb/commit/d77fa24f65db82eb33a02116a76b9212c21fcf3d", "message": "[IOTDB-813] Show storage group under given path prefix", "committedDate": "2020-09-06T07:42:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA1Njc4NA==", "url": "https://github.com/apache/iotdb/pull/1694#discussion_r484056784", "bodyText": "Hi, please put these into one or two lines.", "author": "qiaojialin", "createdAt": "2020-09-06T11:18:55Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "diffHunk": "@@ -502,6 +502,54 @@ private void findStorageGroup(\n     return res;\n   }\n \n+  /**\n+   * Get all storage group under give path\n+   *\n+   * @return a list contains all storage group names under give path\n+   */\n+  List<PartialPath> getStorageGroupPaths(PartialPath prefixPath) throws MetadataException {\n+    String[] nodes = prefixPath.getNodes();\n+    if (nodes.length == 0 || !nodes[0].equals(root.getName())) {\n+      throw new IllegalPathException(prefixPath.getFullPath());\n+    }\n+    List<PartialPath> storageGroupPaths = new ArrayList<>();\n+    findStorageGroupPaths(root, nodes, 1, \"\", storageGroupPaths);\n+    return storageGroupPaths;\n+  }\n+\n+  /**\n+   * Traverse the MTree to match all storage group with prefix path.\n+   *\n+   * @param node              the current traversing node\n+   * @param nodes             split the prefix path with '.'\n+   * @param idx               the current index of array nodes\n+   * @param parent            current parent path\n+   * @param storageGroupPaths store all matched storage group names\n+   */\n+  private void findStorageGroupPaths(MNode node, String[] nodes, int idx, String parent,\n+      List<PartialPath> storageGroupPaths) {\n+    if (node instanceof StorageGroupMNode) {\n+      storageGroupPaths.add(node.getPartialPath());\n+      return;\n+    }\n+    String nodeReg = MetaUtils.getNodeRegByIdx(idx, nodes);\n+    if (!(PATH_WILDCARD).equals(nodeReg)) {\n+      if (node.hasChild(nodeReg)) {\n+        findStorageGroupPaths(\n+            node.getChild(nodeReg),\n+            nodes,\n+            idx + 1,\n+            parent + node.getName() + PATH_SEPARATOR,\n+            storageGroupPaths);", "originalCommit": "d77fa24f65db82eb33a02116a76b9212c21fcf3d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE0NDQzMA==", "url": "https://github.com/apache/iotdb/pull/1694#discussion_r484144430", "bodyText": "Copy that. I'll change it", "author": "yanhongwangg", "createdAt": "2020-09-07T01:37:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA1Njc4NA=="}], "type": "inlineReview"}, {"oid": "4aab8bad14375fc7a1d9372b576b53755781128d", "url": "https://github.com/apache/iotdb/commit/4aab8bad14375fc7a1d9372b576b53755781128d", "message": "[IOTDB-813] Modify Mtree's format", "committedDate": "2020-09-07T01:50:02Z", "type": "commit"}]}