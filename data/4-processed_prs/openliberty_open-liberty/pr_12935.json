{"pr_number": 12935, "pr_title": "Issue 12934: Initial ejbLite-4.0 implemenation", "pr_createdAt": "2020-07-08T04:11:48Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/12935", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM4NjUxMg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12935#discussion_r451386512", "bodyText": "I created an convenience method for this that you might wish to try...\n\n  \n    \n      open-liberty/dev/fattest.simplicity/src/componenttest/rules/repeater/EERepeatTests.java\n    \n    \n         Line 61\n      in\n      654502a\n    \n    \n    \n    \n\n        \n          \n           public static RepeatTests with(String serverName, EEVersion version, EEVersion... otherVersions) {", "author": "tevans78", "createdAt": "2020-07-08T08:51:16Z", "path": "dev/com.ibm.ws.ejbcontainer.session.passivation_fat/fat/src/com/ibm/ws/ejbcontainer/session/passivation/tests/StatefulTimeoutTest.java", "diffHunk": "@@ -48,7 +49,7 @@ public LibertyServer getServer() {\n     }\n \n     @ClassRule\n-    public static RepeatTests r = RepeatTests.with(FeatureReplacementAction.EE7_FEATURES().forServers(\"com.ibm.ws.ejbcontainer.session.passivation.fat.sfTimeout\")).andWith(FeatureReplacementAction.EE8_FEATURES().forServers(\"com.ibm.ws.ejbcontainer.session.passivation.fat.sfTimeout\"));\n+    public static RepeatTests r = RepeatTests.with(FeatureReplacementAction.EE7_FEATURES().forServers(\"com.ibm.ws.ejbcontainer.session.passivation.fat.sfTimeout\")).andWith(FeatureReplacementAction.EE8_FEATURES().forServers(\"com.ibm.ws.ejbcontainer.session.passivation.fat.sfTimeout\")).andWith(new JakartaEE9Action().forServers(\"com.ibm.ws.ejbcontainer.session.passivation.fat.sfTimeout\"));", "originalCommit": "eeaeb5a22b876d29c1401161321dbcd408ec6c7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU3OTE5NA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12935#discussion_r451579194", "bodyText": "@tevans78 That is a nice convenience method, but I generally try to adhere to the FAT guidelines that indicate FAT should only run one repeat action in lite mode, the others in full mode.  I had overlooked that this test was repeating both 7 and 8 in lite mode already..... I've updated the test to repeat ee7 in full mode only.  For now, it will run both ee8 and ee9 in lite mode, as I don't want to lose the ee8 since it is the ga version, but would like to get some minimal ee9 testing.\nPerhaps that convenience method could be updated to allow passing in something like (\"myserver\", EE7-FF, EE8, EE9-FF), to allow designating some to repeat full fat only?  We like to switch things up a bit, always have some FAT run lite mode for  EE7, some EE8, and eventually some EE9, but the majority run the latest ga in lite.", "author": "tkburroughs", "createdAt": "2020-07-08T14:15:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM4NjUxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM4OTI0Mg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12935#discussion_r451389242", "bodyText": "I know that the ejb container has kinda been named this way for decades (?!) but would you consider calling this something like io.openliberty.ejb.4.0.internal.container? Something that follows the guidelines here: https://github.com/OpenLiberty/open-liberty/wiki/Open-Liberty-naming-guidelines#examples", "author": "tevans78", "createdAt": "2020-07-08T08:55:31Z", "path": "dev/io.openliberty.ejbcontainer.v40/bnd.bnd", "diffHunk": "@@ -0,0 +1,36 @@\n+#*******************************************************************************\n+# Copyright (c) 2020 IBM Corporation and others.\n+# All rights reserved. This program and the accompanying materials\n+# are made available under the terms of the Eclipse Public License v1.0\n+# which accompanies this distribution, and is available at\n+# http://www.eclipse.org/legal/epl-v10.html\n+#\n+# Contributors:\n+#     IBM Corporation - initial API and implementation\n+#*******************************************************************************\n+-include= ~../cnf/resources/bnd/bundle.props\n+bVersion=1.0\n+\n+Bundle-Name: Jakarta Enterprise Beans 4.0 Runtime\n+Bundle-SymbolicName: io.openliberty.ejbcontainer.v40", "originalCommit": "eeaeb5a22b876d29c1401161321dbcd408ec6c7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYyNDI3OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12935#discussion_r451624278", "bodyText": "@tevans78 Ah, I thought I was following those guidelines; in \"io.openliberty.xxx.internal\", I interpreted \"xxx\" to be \"component\" not \"feature\".... and this is for the \"ejbcontainer.v40\" component.... so \"io.openliberty.ejbcontainer.v40\" and \"io.openliberty.ejbcontainer.v40.internal\" for the package name.  I think the guidelines need to be updated to also consider the concept of \"component\" features, which are used by multiple public features.\nThe problem is, this \"private\" feature is not directly tied to a single public feature, so replacing \"xxx\" with \"ejb.4.0\" is not accurate.  This will in fact be used by multiple public features (at the moment it just happens to be ejbLite-4.0):\n\nejbLite-4.0\nejbHome-4.0\nejbPersistentTimer-4.0\nejbRemote-4.0\nejb-4.0\nmdb-4.0\n\nand could also be applicable to \"managedBeans-2.0\" in the future, since that feature is also based on the \"ejbcontainer\" component.\nBased on the guidelines, if I happened to do \"mdb-4.0\" first, then it would be called \"io.openliberty.mdb.4.0.internal\", but it really wouldn't then fit the guideline when I pull it into the others.  Similarly, even using \"4.0\" doesn't necessarily work, as the code it effects is also part of the the \"managedBeans-2.0\" public feature.\nInstead, I chose to consider this like \"io.openliberty.connector-2.0\" or \"com.ibm.websphere.appserver.transaction-2.0\" (that would be io.openliberty.transaction-2.0 if we could rename it).  These are \"component\" features that are pulled in by multiple public features with different public names.  \"transaction-2.0 may be used by both the ejb-4.0 and servlet-5.0 public features.\nI consider this a \"component\" feature, used by multiple public features.  I consider the component name to be \"ejbcontainer.v40\" partly for legacy purposes, but also to differentiate it from \"ejb\", which is pretty ambiguous; there are many other components, like security or jax-rs, or cdi that might include \"ejb\" in a project, feature, or package name.\nThe \"ejbcontainer\" component is also broken down into many sub components that also don't directly relate to public features.  Many of these sub-component projects are just \"transformed\" now, so don't have \"io.openliberty\" project names.... but if I were to create new projects, they would be something like:\nio.openliberty.ejbcontainer.async\nio.openliberty.ejbcontainer.ejb2x (yes, part of multiple public features, including several 4.0 ones)\nio.openliberty.ejbcontainer.jpa\nio.openliberty.ejbcontainer.mdb\nio.openliberty.ejbcontainer.remote\nio.openliberty.ejbcontainer.session\nio.openliberty.ejbcontainer.timer\nMost of these will be pulled into multiple public features, for example \"ejbcontainer.timer\" will be in \"ejbLite-4.0\", \"ejb-4.0\", \"ejbHome-4.0\", \"ejbRemote-4.0\" and \"mdb-4.0\".\nAlso chose to use \"ejbcontainer.v40\" as the component, as it fits well with the above list, and makes it easier to identify as the follow-on to \"ejbcontainer.v31/v32\".  It also separates it from the \"4.0\" convention since it could be included by \"managedBeans-2.0\".\nThe use of \"ejbcontainer\" also makes things easier for support purposes; easier to direct to proper support queues.\nMy preference is still to stick with \"io.openliberty.ejbcontainer.v40\" as a component project. I thought the \"internal\" convention was only for package names, but I could see renaming the project to \"io.openliberty.ejbcontainer.v40.internal\" since it would not likely ever also include any API or SPI packages.", "author": "tkburroughs", "createdAt": "2020-07-08T15:15:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM4OTI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTY1Mzc5Ng==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12935#discussion_r451653796", "bodyText": "@tkburroughs you make a good argument there. I will try to add something to the wiki to capture this. I think that the project/bundle should still be suffixed with internal ... so your suggestion of io.openliberty.ejbcontainer.v40.internal was a good one, particularly since that it matches up with the package name below.", "author": "tevans78", "createdAt": "2020-07-08T15:58:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM4OTI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTcwMDE2OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12935#discussion_r451700169", "bodyText": "@tevans78 I've renamed the project to \"io.openliberty.ejbcontainer.v40.internal\".", "author": "tkburroughs", "createdAt": "2020-07-08T17:11:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM4OTI0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM5Mjk0Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12935#discussion_r451392947", "bodyText": "The wiki doesn't have an example for a version specific package name but how about\nio.openliberty.ejb.internal.container.v40?", "author": "tevans78", "createdAt": "2020-07-08T09:01:19Z", "path": "dev/io.openliberty.ejbcontainer.v40/src/io/openliberty/ejbcontainer/v40/internal/EJBRuntimeVersionV40.java", "diffHunk": "@@ -0,0 +1,19 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package io.openliberty.ejbcontainer.v40.internal;", "originalCommit": "eeaeb5a22b876d29c1401161321dbcd408ec6c7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYzMjQyNQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12935#discussion_r451632425", "bodyText": "@tevans78 see my above comments. I consider this a \"component\" project not directly related to a specific public \"ejb\" feature.  I view \".ejb.\" in the package name to be too ambiguous.  Using \"ejbcotnainer\" makes it easier to identify which aspec of EJB, Managed Beans, and MDB this relates to.... the EJB container, not EJB security, or EJB integration with CDI, JAX-RS, WebContainer, etc.\nI prefer to include the full \"component\" (i.e. project name) prior to the \"internal\".  Seems to make it easier to avoid multiple project/bundles ever exporting the same package.  Also, with the other ejbcontainer projects, I assume this view would make more sense:\nio.openliberty.ejbcontainer.async\nio.openliberty.ejbcontainer.async.spi\nio.openliberty.ejbcontainer.async.internal\nio.openliberty.ejbcontainer.timer\nio.openliberty.ejbcontainer.timer.spi\nio.openliberty.ejbcontainer.timer.internal\nio.openliberty.ejbcontainer.v40\nio.openliberty.ejbcontainer.v40.spi\nio.openliberty.ejbcontainer.v40.internal\nKeep in mind that these are all related to a component, like \"transactions\", which are included by many features, some with \"ejb\" in the name, and some not, like \"mdb\" and \"managedBeans\".", "author": "tkburroughs", "createdAt": "2020-07-08T15:27:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM5Mjk0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTY1NTk2Mg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12935#discussion_r451655962", "bodyText": "Agreed. I like your examples so I may use those in the wiki. Just need to try and define what a \"component\" is??", "author": "tevans78", "createdAt": "2020-07-08T16:01:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM5Mjk0Nw=="}], "type": "inlineReview"}, {"oid": "8fcd32e030d2bb7138ef6cc3b022f43b5b9046f9", "url": "https://github.com/OpenLiberty/open-liberty/commit/8fcd32e030d2bb7138ef6cc3b022f43b5b9046f9", "message": "Issue 12934: Initial ejbLite-4.0 implemenation\n\nAdd necessary transforms for jakarta ee and add required\nfeatures to support ejbLite-4.0\n\nEnabled one basic test using repeat action.", "committedDate": "2020-07-08T14:07:37Z", "type": "forcePushed"}, {"oid": "29da03e33585922d782f40b6dafa786ba02d8376", "url": "https://github.com/OpenLiberty/open-liberty/commit/29da03e33585922d782f40b6dafa786ba02d8376", "message": "Issue 12934: Initial ejbLite-4.0 implemenation\n\nAdd necessary transforms for jakarta ee and add required\nfeatures to support ejbLite-4.0\n\nEnabled one basic test using repeat action.", "committedDate": "2020-07-08T17:07:53Z", "type": "commit"}, {"oid": "29da03e33585922d782f40b6dafa786ba02d8376", "url": "https://github.com/OpenLiberty/open-liberty/commit/29da03e33585922d782f40b6dafa786ba02d8376", "message": "Issue 12934: Initial ejbLite-4.0 implemenation\n\nAdd necessary transforms for jakarta ee and add required\nfeatures to support ejbLite-4.0\n\nEnabled one basic test using repeat action.", "committedDate": "2020-07-08T17:07:53Z", "type": "forcePushed"}]}