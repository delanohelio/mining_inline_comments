{"pr_number": 13811, "pr_title": "Connectors 2.0 Jakarta Generic Testing", "pr_createdAt": "2020-09-05T00:12:47Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/13811", "timeline": [{"oid": "63922faa21b6117ef80758de60eaffcf1fbc95d0", "url": "https://github.com/OpenLiberty/open-liberty/commit/63922faa21b6117ef80758de60eaffcf1fbc95d0", "message": "refactor to work with jakarta", "committedDate": "2020-10-01T18:53:14Z", "type": "forcePushed"}, {"oid": "10a2a590e88a902de46f8bd17dadccf1803986fd", "url": "https://github.com/OpenLiberty/open-liberty/commit/10a2a590e88a902de46f8bd17dadccf1803986fd", "message": "refactor to work with jakarta", "committedDate": "2020-10-05T18:24:36Z", "type": "forcePushed"}, {"oid": "445d26bb53d9eb7bb0f894347fce0507ff201497", "url": "https://github.com/OpenLiberty/open-liberty/commit/445d26bb53d9eb7bb0f894347fce0507ff201497", "message": "introduce jakarta testing\n\nrefactor to work with jakarta\n\nrevert rules", "committedDate": "2020-10-05T18:33:30Z", "type": "forcePushed"}, {"oid": "d4f2a35fb4a2587bf650f8f8fc45aa410aa94da6", "url": "https://github.com/OpenLiberty/open-liberty/commit/d4f2a35fb4a2587bf650f8f8fc45aa410aa94da6", "message": "introduce jakarta testing\n\nrefactor to work with jakarta\n\nrevert rules", "committedDate": "2020-10-06T16:46:27Z", "type": "commit"}, {"oid": "d8d69059ce8c08f901740aa90b884935862ad7b0", "url": "https://github.com/OpenLiberty/open-liberty/commit/d8d69059ce8c08f901740aa90b884935862ad7b0", "message": "clean up jakarta rules", "committedDate": "2020-10-06T16:47:13Z", "type": "commit"}, {"oid": "d8d69059ce8c08f901740aa90b884935862ad7b0", "url": "https://github.com/OpenLiberty/open-liberty/commit/d8d69059ce8c08f901740aa90b884935862ad7b0", "message": "clean up jakarta rules", "committedDate": "2020-10-06T16:47:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4NDY1OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13811#discussion_r500484659", "bodyText": "Normally the feature replacement repeat action would update the server for you. Is there a reason that doesn't work in this case?", "author": "njr-11", "createdAt": "2020-10-06T17:48:05Z", "path": "dev/com.ibm.ws.jca_fat/fat/src/com/ibm/ws/jca/fat/FATSuite.java", "diffHunk": "@@ -29,7 +32,21 @@\n                 ConnectionManagerMBeanTest.class\n })\n public class FATSuite {\n+\n+    public static final String javaeeServer = \"com.ibm.ws.jca.fat\";\n+    public static final String jakartaeeServer = \"com.ibm.ws.jca.fat.jakarta\";\n+\n     @ClassRule\n     public static RepeatTests r = RepeatTests.withoutModification()\n-                    .andWith(FeatureReplacementAction.EE8_FEATURES());\n-}\n\\ No newline at end of file\n+                    .andWith(FeatureReplacementAction.EE8_FEATURES())\n+                    .andWith(new JakartaEE9Action());\n+\n+    public static LibertyServer getServer() {\n+        if (JakartaEE9Action.isActive()) {\n+            return LibertyServerFactory.getLibertyServer(jakartaeeServer);\n+        } else {\n+            return LibertyServerFactory.getLibertyServer(javaeeServer);", "originalCommit": "d8d69059ce8c08f901740aa90b884935862ad7b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUwODI0NQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13811#discussion_r500508245", "bodyText": "The feature replacement action just replaces features, but in this case the server.xml file has configurations like:\n    <jmsActivationSpec id=\"FVTMessageDrivenBeanBindingOverride\">\n      <properties.FAT1 destinationRef=\"topic1\" destinationType=\"javax.jms.Topic\"/>\n    </jmsActivationSpec>\n\nInstead of trying to run the transformer on the server.xml file, I figured it would be easier and quicker just to make a copy and change the configuration manually.", "author": "KyleAure", "createdAt": "2020-10-06T18:25:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4NDY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUxNTc5NA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13811#discussion_r500515794", "bodyText": "That's a good point.  I'm sure making the copy is easier for now, but it will be more difficult in the long term to maintain.  With two copies, we will inevitably end up with developers making a fix or improvement in only one of the files and they will get out of sync.  It seems like it ought to be something the EE9 replacement action can do to update config element values automatically with the simplicity config support in place.  Does that not apply here because this is generated metatype/config?  Otherwise it ought to be possible.", "author": "njr-11", "createdAt": "2020-10-06T18:37:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4NDY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE3MDkwNw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13811#discussion_r501170907", "bodyText": "Opened this as a new issue here: #14374", "author": "KyleAure", "createdAt": "2020-10-07T17:02:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4NDY1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4NjA2OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13811#discussion_r500486068", "bodyText": "It's fine to skip the test, but this seems like something to report to the team that is working on the transformer if you haven't already.", "author": "njr-11", "createdAt": "2020-10-06T17:50:20Z", "path": "dev/com.ibm.ws.jca_fat/fat/src/com/ibm/ws/jca/fat/app/JCATest.java", "diffHunk": "@@ -134,27 +101,28 @@ public static void tearDown() throws Exception {\n \n     @Test\n     public void testActivationSpec() throws Exception {\n-        runInServlet(\"testActivationSpec\", fvtweb);\n+        runTest();\n     }\n \n     @Test\n     public void testActivationSpecBindings() throws Exception {\n-        runInServlet(\"testActivationSpecBindings\", fvtweb);\n+        runTest();\n     }\n \n     @Test\n     public void testDestinations() throws Exception {\n-        runInServlet(\"testDestinations\", fvtweb);\n+        runTest();\n     }\n \n     @Test\n+    @SkipForRepeat(EE9_FEATURES) //Transformer does not seem to transform jars inside of jars", "originalCommit": "d8d69059ce8c08f901740aa90b884935862ad7b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUwODQ3OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13811#discussion_r500508478", "bodyText": "\ud83d\udc4d Will do!", "author": "KyleAure", "createdAt": "2020-10-06T18:26:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4NjA2OA=="}], "type": "inlineReview"}]}