{"pr_number": 12719, "pr_title": "Issue 12628: Clone keystore on write for WSKeyStore", "pr_createdAt": "2020-06-19T22:10:00Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/12719", "timeline": [{"oid": "736e577e036f10dbb721d20263d5140e627a5864", "url": "https://github.com/OpenLiberty/open-liberty/commit/736e577e036f10dbb721d20263d5140e627a5864", "message": "Issue 12628: Clone keystore on write for WSKeyStore", "committedDate": "2020-06-22T15:43:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4OTcwNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719#discussion_r443789706", "bodyText": "Can't we do this in store(...) instead?", "author": "jvanhill", "createdAt": "2020-06-22T19:53:35Z", "path": "dev/com.ibm.ws.ssl/src/com/ibm/ws/ssl/config/WSKeyStore.java", "diffHunk": "@@ -1322,7 +1367,8 @@ public void setCertificateEntry(String alias, Certificate cert) throws KeyStoreE\n             jKeyStore.setCertificateEntry(alias, cert);\n \n             try {\n-                store();\n+                store(jKeyStore);\n+                myKeyStore = jKeyStore;", "originalCommit": "736e577e036f10dbb721d20263d5140e627a5864", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE4MjM2MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719#discussion_r444182360", "bodyText": "Changes made", "author": "kristip17", "createdAt": "2020-06-23T12:25:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4OTcwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4OTc2OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719#discussion_r443789769", "bodyText": "Can't we do this in store(...) instead?", "author": "jvanhill", "createdAt": "2020-06-22T19:53:44Z", "path": "dev/com.ibm.ws.ssl/src/com/ibm/ws/ssl/config/WSKeyStore.java", "diffHunk": "@@ -1415,13 +1464,16 @@ public void setKeyEntry(String alias, Key key, Certificate[] chain) throws KeySt\n \n             // store the key... errors are thrown if conflicts or errors occur\n             jKeyStore.setKeyEntry(alias, key, decodedPassword.toCharArray(), chain);\n-            store();\n+            store(jKeyStore);\n+            myKeyStore = jKeyStore;", "originalCommit": "736e577e036f10dbb721d20263d5140e627a5864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5MDA2Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719#discussion_r443790067", "bodyText": "See other findings about setting the keystore in this method. Only need to do it if we sent in the clonedKeyStore. Should do it after we know the store to the file has succeeded.", "author": "jvanhill", "createdAt": "2020-06-22T19:54:20Z", "path": "dev/com.ibm.ws.ssl/src/com/ibm/ws/ssl/config/WSKeyStore.java", "diffHunk": "@@ -1045,7 +1089,7 @@ public void store() throws Exception {\n             boolean fileBased = Boolean.parseBoolean(getProperty(Constants.SSLPROP_KEY_STORE_FILE_BASED));\n             String SSLKeyStoreStash = getProperty(Constants.SSLPROP_KEY_STORE_CREATE_CMS_STASH);\n \n-            KeyStore ks = getKeyStore(false, false);\n+            KeyStore ks = clonedKeyStore == null ? getKeyStore(false, false) : clonedKeyStore;", "originalCommit": "736e577e036f10dbb721d20263d5140e627a5864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6549fb9494daed152cfa4c3925a958b499f5fa0b", "url": "https://github.com/OpenLiberty/open-liberty/commit/6549fb9494daed152cfa4c3925a958b499f5fa0b", "message": "Issue 12628: Clone keystore on write for WSKeyStore", "committedDate": "2020-06-22T20:09:05Z", "type": "commit"}, {"oid": "6549fb9494daed152cfa4c3925a958b499f5fa0b", "url": "https://github.com/OpenLiberty/open-liberty/commit/6549fb9494daed152cfa4c3925a958b499f5fa0b", "message": "Issue 12628: Clone keystore on write for WSKeyStore", "committedDate": "2020-06-22T20:09:05Z", "type": "forcePushed"}]}