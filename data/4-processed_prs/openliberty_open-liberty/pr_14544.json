{"pr_number": 14544, "pr_title": "implement CacheConfig.getProperties()", "pr_createdAt": "2020-10-19T14:50:51Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/14544", "timeline": [{"oid": "b069f1a6ccbebcd6e8488a8f945864db7645e159", "url": "https://github.com/OpenLiberty/open-liberty/commit/b069f1a6ccbebcd6e8488a8f945864db7645e159", "message": "implement CacheConfig.getProperties()", "committedDate": "2020-10-19T14:23:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyMjIxOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14544#discussion_r514422218", "bodyText": "If the values of the system properties are changed by another thread while calling putAll it will lead to a ConcurrentModificationException:\n\nStack Dump = java.util.ConcurrentModificationException\nat java.util.Hashtable$Enumerator.next(Hashtable.java:1506)\nat java.util.concurrent.ConcurrentHashMap.putAll(ConcurrentHashMap.java:1094)\nat com.ibm.ws.cache.CacheConfig.(CacheConfig.java:382)\nat com.ibm.ws.cache.CacheServiceImpl.parsePropertiesFromOSGiConfigAdmin(CacheServiceImpl.java:210)\nat com.ibm.ws.cache.CacheServiceImpl.start(CacheServiceImpl.java:140)", "author": "tjwatson", "createdAt": "2020-10-29T17:03:43Z", "path": "dev/com.ibm.ws.dynacache/src/com/ibm/ws/cache/CacheConfig.java", "diffHunk": "@@ -455,6 +459,8 @@ public CacheConfig(Properties properties, CacheConfig config) {\n         // -------------------------------------------------\n         FieldInitializer.initFromSystemProperties(this);\n         overrideCacheConfig(properties);\n+        _passedInProperties.putAll(properties);\n+        _passedInProperties.putAll(System.getProperties());", "originalCommit": "b069f1a6ccbebcd6e8488a8f945864db7645e159", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyMzIyMw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14544#discussion_r514423223", "bodyText": "When doing putAll across system properties you will need to synchronize on the properties object returned by System.getProperties while calling putAll here.", "author": "tjwatson", "createdAt": "2020-10-29T17:05:16Z", "path": "dev/com.ibm.ws.dynacache/src/com/ibm/ws/cache/CacheConfig.java", "diffHunk": "@@ -377,6 +378,9 @@ public CacheConfig(Map<String, Object> map) {\n         FieldInitializer.initFromSystemProperties(this);\n         overrideCacheConfig(convert(map));\n         determineCacheProvider();\n+        _passedInProperties.putAll(map);\n+        _passedInProperties.putAll(System.getProperties());", "originalCommit": "b069f1a6ccbebcd6e8488a8f945864db7645e159", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}