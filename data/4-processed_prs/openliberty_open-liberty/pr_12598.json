{"pr_number": 12598, "pr_title": "Add custom access log fields to JSON logs and logstashCollector", "pr_createdAt": "2020-06-12T17:06:23Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/12598", "timeline": [{"oid": "73046800b8060ac0fe0510e508d035c89b1f3618", "url": "https://github.com/OpenLiberty/open-liberty/commit/73046800b8060ac0fe0510e508d035c89b1f3618", "message": "Working basic impl\n\nCondense populateFormatters into two instead of four\n\nMove static var out of AccessLogData, fix configuration checkers\n\nAdd ability to rename/omit specific cookie/header fields\n\nAdd omit cookies/headers functionality and fix field name inconsistency\n\nFix wrong server name and user dir fields being printed in JSON logs\n\nAddress comments\n\nAddress comments\n\nAddress comment\n\ntemporarily disable access log tests to build\n\nFix duplicate fields being printed", "committedDate": "2020-06-12T16:56:40Z", "type": "commit"}, {"oid": "e2aff326d204f7648e3c4e550fd1801215a4bb39", "url": "https://github.com/OpenLiberty/open-liberty/commit/e2aff326d204f7648e3c4e550fd1801215a4bb39", "message": "Add FAT tests for new jsonAccessLogFields property", "committedDate": "2020-06-12T16:56:49Z", "type": "commit"}, {"oid": "51453a45284f82bcfc1dd67286df7e0871cbb058", "url": "https://github.com/OpenLiberty/open-liberty/commit/51453a45284f82bcfc1dd67286df7e0871cbb058", "message": "Decouple logstashCollector feature from http, fix duplicate headers/cookie bug, address test bugs\n\nFix timing issue in test, add multiple endpoints test\n\nClose BufferedReader and add connection logs\n\nAdd lower timeout threshold for waits in assertNull", "committedDate": "2020-06-12T16:56:56Z", "type": "commit"}, {"oid": "9aa5c290363b12cb8d9bdf70c1c022cd6b275117", "url": "https://github.com/OpenLiberty/open-liberty/commit/9aa5c290363b12cb8d9bdf70c1c022cd6b275117", "message": "Address thread safety issue with cached start fields, use better method to remove duplicate tokens\n\nRemove removeDuplicates() method, replace with better method that splits tokens into a HashMap while removing duplicates\n\nalways call updateFieldMappings after server config update\n\nFix the startMessageJsonFields method to match the other similar methods", "committedDate": "2020-06-12T16:57:03Z", "type": "commit"}, {"oid": "d2202f1ee15c8ff7e51a5851fa14b80074aba14a", "url": "https://github.com/OpenLiberty/open-liberty/commit/d2202f1ee15c8ff7e51a5851fa14b80074aba14a", "message": "Fix up formatting, simplify the startXXXJsonFields methods, add setters\n\nRemove tempStartFields var\n\nFinal code clean up + fix copyright dates", "committedDate": "2020-06-12T16:57:10Z", "type": "commit"}, {"oid": "1e3a18bbe7e328e574021dcea4b7ad219bacdd81", "url": "https://github.com/OpenLiberty/open-liberty/commit/1e3a18bbe7e328e574021dcea4b7ad219bacdd81", "message": "Remove case sensitivity for headers, add warning for not providing header name, add null check to prevent NPE to continue after logging warning msg", "committedDate": "2020-06-12T16:57:15Z", "type": "commit"}, {"oid": "6db07fcad12fd4c18450bb36e9b0b2bc38f8d2b9", "url": "https://github.com/OpenLiberty/open-liberty/commit/6db07fcad12fd4c18450bb36e9b0b2bc38f8d2b9", "message": "Change bytesSent field to long instead of String, fix warning messages", "committedDate": "2020-06-12T16:57:21Z", "type": "commit"}, {"oid": "dbf39a918effd65f1a3fbda753031e298b04321e", "url": "https://github.com/OpenLiberty/open-liberty/commit/dbf39a918effd65f1a3fbda753031e298b04321e", "message": "Edit TRAS3012W warning message, move applyJsonFields method call\n\nMove applyJsonFields method call to after creating handlers\n\nFix message", "committedDate": "2020-06-12T16:57:26Z", "type": "commit"}, {"oid": "a6f6144f79277f8e82c8e3eb4a132c4e13c6bf8f", "url": "https://github.com/OpenLiberty/open-liberty/commit/a6f6144f79277f8e82c8e3eb4a132c4e13c6bf8f", "message": "Add null checks for waitForStringInLog, wait for CWWKO0219I before hitting /metrics endpoint", "committedDate": "2020-06-12T16:57:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzMTE1Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12598#discussion_r441631157", "bodyText": "Rather than \"field(s),\" use \"fields\" or add \"one or more\" to the sentence. Suggested rewrites:\n\nHeader name was not specified for accessLogging logFormat fields: {0}.\n\n\nHeader name is missing for one or more accessLogging logFormat fields: {0}.", "author": "helyarp", "createdAt": "2020-06-17T15:22:49Z", "path": "dev/com.ibm.ws.logging/resources/com/ibm/ws/logging/internal/resources/LoggingMessages.nlsprops", "diffHunk": "@@ -156,6 +156,10 @@ JSON_FIELDS_INVALID_CHARACHTER=TRAS3011W: An invalid character was provided in t\n JSON_FIELDS_INVALID_CHARACHTER.explanation= Only letters, numbers, and : are accepted in the JSON logging field name mapping property\n JSON_FIELDS_INVALID_CHARACHTER.useraction= Change your JSON logging field name mapping property value to remove invalid characters\n \n+JSON_ACCESS_LOG_NO_HEADER_NAME_SPECIFIED=TRAS3012W: Header name was not specified for accessLogging logFormat field(s): {0}.", "originalCommit": "a6f6144f79277f8e82c8e3eb4a132c4e13c6bf8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwNjQ0NA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12598#discussion_r442206444", "bodyText": "I'll address these comments in a follow-up PR so that someone else can deliver their code (which has merge conflicts with mine). Thanks for the review!", "author": "jennifer-c", "createdAt": "2020-06-18T12:59:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzMTE1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzNzc0NQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12598#discussion_r441637745", "bodyText": "Suggested changes to shorten the description:\n\nSpecifies the maximum number of events to send per second. To throttle the events, specify a value greater than zero.\n\n\nSpecifies the maximum number of events to send per second. A value greater than zero throttles the events.", "author": "helyarp", "createdAt": "2020-06-17T15:32:18Z", "path": "dev/com.ibm.ws.logstash.collector/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -25,4 +25,9 @@ maxFieldLength=Maximum field length\n maxFieldLength.desc=Specifies maximum number of characters for the message field associated with the events for various sources. If you specify a value of 0 or -1, the maximum number of characters is unlimited.\n \n maxEvents=Maximum events per second\n-maxEvents.desc=Specifies the maximum number of events to be sent per second. If you specify a value greater than zero, then it will be used for throttling the events.\n\\ No newline at end of file\n+maxEvents.desc=Specifies the maximum number of events to be sent per second. If you specify a value greater than zero, then it will be used for throttling the events.", "originalCommit": "a6f6144f79277f8e82c8e3eb4a132c4e13c6bf8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg0ODIyMQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12598#discussion_r442848221", "bodyText": "This message has already been GAed. If you think this message will have a significant impact to the customer, I can make the change - but otherwise, I think we can leave it as it is.", "author": "jennifer-c", "createdAt": "2020-06-19T13:42:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzNzc0NQ=="}], "type": "inlineReview"}]}