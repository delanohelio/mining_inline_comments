{"pr_number": 14722, "pr_title": "[14698] Improve perf and log message when using RequestScoped interface", "pr_createdAt": "2020-10-27T21:29:47Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/14722", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA2Mjk0Mg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14722#discussion_r513062942", "bodyText": "I'd guess there will be some translation problems with this (maybe not).  Maybe \"If possible, use the @applicationScoped annotation on the interface to avoid redundant initialization.\"", "author": "jim-krueger", "createdAt": "2020-10-27T22:09:53Z", "path": "dev/com.ibm.ws.microprofile.rest.client.cdi/resources/com/ibm/ws/microprofile/rest/client/cdi/nls/MPRestClientMessages.nlsprops", "diffHunk": "@@ -0,0 +1,26 @@\n+###############################################################################\n+# Copyright (c) 2020 IBM Corporation and others.\n+# All rights reserved. This program and the accompanying materials\n+# are made available under the terms of the Eclipse Public License v1.0\n+# which accompanies this distribution, and is available at\n+# http://www.eclipse.org/legal/epl-v10.html\n+#\n+# Contributors:\n+#     IBM Corporation - initial API and implementation\n+###############################################################################\n+\n+# NLS_MESSAGEFORMAT_ALL\n+#\n+#CMVCPATHNAME com.ibm.ws.jaxrs20.client/resources/com/ibm/ws/jaxrs20/client/internal/resources/JAXRSClientMessages.nlsprops\n+#ISMESSAGEFILE TRUE\n+#COMPONENTPREFIX CWWKW\n+#COMPONENTNAMEFOR CWWKW WebSphere JAXRS20 Client Code\n+#RANGE 0750 - 0799\n+#\n+#NLS_MESSAGEFORMAT_VAR\n+#NLS_ENCODING=UNICODE\n+\n+# {0} is a space separated list of interface class names\n+rest.client.interface.using.request.scope=CWWKW0750I: The following interfaces are configured as RequestScoped which will result in slower performance: {0} \n+rest.client.interface.using.request.scope.explanation=MicroProfile Rest Client interfaces that are request scoped are initialized on each request which often involves redundant computations. Application scoped interface will only perform the initialization process once per application instance. \n+rest.client.interface.using.request.scope.useraction=Unless there is a valid reason not to, consider using the @ApplicationScoped annotation on the interface to avoid redundant initialization.", "originalCommit": "9fece0b2ae3a9426bf5d9dd92296534cfd47576a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA2NDQwOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14722#discussion_r513064408", "bodyText": "Any need for null checks for processBean or bean?", "author": "jim-krueger", "createdAt": "2020-10-27T22:13:25Z", "path": "dev/com.ibm.ws.microprofile.rest.client.cdi/src/com/ibm/ws/microprofile/rest/client/cdi/LibertyRestClientExtension.java", "diffHunk": "@@ -91,5 +96,24 @@ public void registerClientBeans(@Observes AfterBeanDiscovery afterBeanDiscovery,\n \n     public void registerErrors(@Observes AfterDeploymentValidation afterDeploymentValidation) {\n         errors.forEach(afterDeploymentValidation::addDeploymentProblem);\n+        if (!requestScopedInterfaces.isEmpty()) {\n+            \n+            Tr.info(tc, \"rest.client.interface.using.request.scope\", \n+                    requestScopedInterfaces.stream().map(c -> c.getName()).collect(Collectors.joining(\" \")));\n+        }\n+        \n+    }\n+\n+    public void logRequestScopedClientInterfaces(@Observes ProcessBean<?> processBean) {", "originalCommit": "9fece0b2ae3a9426bf5d9dd92296534cfd47576a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzEzOTk5MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14722#discussion_r513139991", "bodyText": "According to the CDI docs/examples, the processBean should always be non-null.", "author": "andymc12", "createdAt": "2020-10-28T02:20:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA2NDQwOA=="}], "type": "inlineReview"}, {"oid": "8319118f05e30a921cc463295ecb0953c4dba8be", "url": "https://github.com/OpenLiberty/open-liberty/commit/8319118f05e30a921cc463295ecb0953c4dba8be", "message": "[14698] Improve perf and log message when using RequestScoped interface", "committedDate": "2020-10-29T16:31:49Z", "type": "commit"}, {"oid": "f72414df2d8e71623bb59fbbada91dd5f7f148a2", "url": "https://github.com/OpenLiberty/open-liberty/commit/f72414df2d8e71623bb59fbbada91dd5f7f148a2", "message": "[14698] Upgrade CXF 3.4.1 snapshot for MP bundle", "committedDate": "2020-10-29T16:31:50Z", "type": "forcePushed"}, {"oid": "cadc969499a02e5fd1d794ebaab85183ccb366ea", "url": "https://github.com/OpenLiberty/open-liberty/commit/cadc969499a02e5fd1d794ebaab85183ccb366ea", "message": "[14698] Log `@Dependent` client intf injected into `@RequestScoped` bean\n\nThis anti-pattern results in the same net performance loss as if the\nrest client interface were explicitly annotated with `@RequestScoped`.", "committedDate": "2020-10-30T13:47:14Z", "type": "commit"}, {"oid": "08912940dd86de359a238522ccc947ab5bfad786", "url": "https://github.com/OpenLiberty/open-liberty/commit/08912940dd86de359a238522ccc947ab5bfad786", "message": "[14698] Upgrade CXF 3.4.1 snapshot for MP bundle", "committedDate": "2020-10-30T13:47:34Z", "type": "commit"}, {"oid": "08912940dd86de359a238522ccc947ab5bfad786", "url": "https://github.com/OpenLiberty/open-liberty/commit/08912940dd86de359a238522ccc947ab5bfad786", "message": "[14698] Upgrade CXF 3.4.1 snapshot for MP bundle", "committedDate": "2020-10-30T13:47:34Z", "type": "forcePushed"}]}