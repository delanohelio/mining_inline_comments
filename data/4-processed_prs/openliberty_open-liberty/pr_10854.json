{"pr_number": 10854, "pr_title": "Make updating JSON extension aliases threadsafe", "pr_createdAt": "2020-02-12T16:32:02Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/10854", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NjgxOQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#discussion_r384696819", "bodyText": "This won't fix the issue... LogTraceData has unsynchronized access to originalExtensions / aliasesExtensions.", "author": "donbourne", "createdAt": "2020-02-26T18:57:48Z", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/data/NameAliases.java", "diffHunk": "@@ -23,11 +23,13 @@\n     public NameAliases(String[] originalNames) {\n         this.originalNames = originalNames;\n         this.aliases = originalNames.clone();\n-        this.originalExtensions = new ArrayList<>();\n-        this.aliasesExtensions = new ArrayList<>();\n+        synchronized (this) {\n+            this.originalExtensions = new ArrayList<>();\n+            this.aliasesExtensions = new ArrayList<>();\n+        }\n     }\n \n-    public void newAliases(Map<String, String> newAliases) {\n+    public synchronized void newAliases(Map<String, String> newAliases) {", "originalCommit": "f031c361c3b36fffeda18bb174c544c058fed01b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "url": "https://github.com/OpenLiberty/open-liberty/commit/62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "message": "Change JSON alias extensions to class for consistency when updating jsonFieldMappings", "committedDate": "2020-02-26T22:13:28Z", "type": "commit"}, {"oid": "62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "url": "https://github.com/OpenLiberty/open-liberty/commit/62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "message": "Change JSON alias extensions to class for consistency when updating jsonFieldMappings", "committedDate": "2020-02-26T22:13:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI4Mjk4NA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#discussion_r385282984", "bodyText": "this should probably be a static inner class inside NameAliases since NameAliases is the only class that uses it.", "author": "donbourne", "createdAt": "2020-02-27T18:12:07Z", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/data/ExtensionAliases.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package com.ibm.ws.logging.data;\n+\n+import java.util.ArrayList;\n+\n+/**\n+ *\n+ */\n+public class ExtensionAliases {\n+    public ArrayList<String> originalExtensions;\n+    public ArrayList<String> aliasesExtensions;\n+\n+    public ExtensionAliases() {\n+        this.originalExtensions = new ArrayList<String>();\n+        this.aliasesExtensions = new ArrayList<String>();\n+    }\n+\n+    public void addExtensionAlias(String originalName, String alias) {\n+        originalExtensions.add(originalName);\n+        aliasesExtensions.add(alias);\n+    }\n+}", "originalCommit": "62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI4NjgyNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#discussion_r385286826", "bodyText": "should add a method to ExtensionAliases to get an alias rather than iterating here... eg. getAlias(String original)", "author": "donbourne", "createdAt": "2020-02-27T18:19:37Z", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/data/LogTraceData.java", "diffHunk": "@@ -698,20 +698,17 @@ public static String getTypeKeyJSON(boolean isMessageEvent) {\n     }\n \n     public static String getExtensionNameKeyJSON(boolean isMessageEvent, String extKey) {\n-        ArrayList<String> tempExt = null;\n-        ArrayList<String> aliasesExt = null;\n+        ExtensionAliases tempExt = null;\n         if (isMessageEvent) {\n-            tempExt = jsonLoggingNameAliasesMessages.originalExtensions;\n-            aliasesExt = jsonLoggingNameAliasesMessages.aliasesExtensions;\n+            tempExt = jsonLoggingNameAliasesMessages.extensionAliases;\n \n         } else {\n-            tempExt = jsonLoggingNameAliasesTrace.originalExtensions;\n-            aliasesExt = jsonLoggingNameAliasesTrace.aliasesExtensions;\n+            tempExt = jsonLoggingNameAliasesTrace.extensionAliases;\n \n         }\n-        for (int i = 0; i < tempExt.size(); i++) {\n-            if (tempExt.get(i).equals(extKey)) {\n-                return aliasesExt.get(i);\n+        for (int i = 0; i < tempExt.originalExtensions.size(); i++) {\n+            if (tempExt.originalExtensions.get(i).equals(extKey)) {\n+                return tempExt.aliasesExtensions.get(i);", "originalCommit": "62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "990aadde1ab75688fa8f61f2a197da111c65b49a", "url": "https://github.com/OpenLiberty/open-liberty/commit/990aadde1ab75688fa8f61f2a197da111c65b49a", "message": "Make ExtensionAliases an inner class of NameAliases", "committedDate": "2020-02-27T18:50:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc0MjY4MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#discussion_r387742680", "bodyText": "please clean up vertical spacing in this method", "author": "donbourne", "createdAt": "2020-03-04T15:30:08Z", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/data/LogTraceData.java", "diffHunk": "@@ -698,23 +699,15 @@ public static String getTypeKeyJSON(boolean isMessageEvent) {\n     }\n \n     public static String getExtensionNameKeyJSON(boolean isMessageEvent, String extKey) {\n-        ArrayList<String> tempExt = null;\n-        ArrayList<String> aliasesExt = null;\n+        ExtensionAliases tempExt = null;\n         if (isMessageEvent) {\n-            tempExt = jsonLoggingNameAliasesMessages.originalExtensions;\n-            aliasesExt = jsonLoggingNameAliasesMessages.aliasesExtensions;\n+            tempExt = jsonLoggingNameAliasesMessages.extensionAliases;\n \n         } else {\n-            tempExt = jsonLoggingNameAliasesTrace.originalExtensions;\n-            aliasesExt = jsonLoggingNameAliasesTrace.aliasesExtensions;\n+            tempExt = jsonLoggingNameAliasesTrace.extensionAliases;\n \n         }\n-        for (int i = 0; i < tempExt.size(); i++) {\n-            if (tempExt.get(i).equals(extKey)) {\n-                return aliasesExt.get(i);\n-            }\n-        }\n-        return extKey;\n+        return tempExt.getAlias(extKey);", "originalCommit": "990aadde1ab75688fa8f61f2a197da111c65b49a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "96be6d9b55a83a6067e75947301c6046196f418a", "url": "https://github.com/OpenLiberty/open-liberty/commit/96be6d9b55a83a6067e75947301c6046196f418a", "message": "fix vertical spacing", "committedDate": "2020-03-04T16:15:31Z", "type": "commit"}, {"oid": "39a7030c4d6a5fff22d234c66764940d8b4ba730", "url": "https://github.com/OpenLiberty/open-liberty/commit/39a7030c4d6a5fff22d234c66764940d8b4ba730", "message": "update copyright year in NameAliases", "committedDate": "2020-03-05T14:47:17Z", "type": "commit"}, {"oid": "f1765172ad43fb08a16b10a5922fd379a5b3d038", "url": "https://github.com/OpenLiberty/open-liberty/commit/f1765172ad43fb08a16b10a5922fd379a5b3d038", "message": "Merge branch 'master' of github.com:OpenLiberty/open-liberty into 10707-threadsafeExt", "committedDate": "2020-03-06T16:13:39Z", "type": "commit"}, {"oid": "5dc8dd1575c487132ee935d4ac18806d2c85f670", "url": "https://github.com/OpenLiberty/open-liberty/commit/5dc8dd1575c487132ee935d4ac18806d2c85f670", "message": "Merge branch 'integration' into 10707-threadsafeExt", "committedDate": "2020-03-06T16:18:03Z", "type": "commit"}]}