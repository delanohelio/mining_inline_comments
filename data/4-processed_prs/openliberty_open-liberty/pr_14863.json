{"pr_number": 14863, "pr_title": "Enable RestEasy Bean Validation with Hibernate", "pr_createdAt": "2020-11-06T15:08:34Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/14863", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MjQzMg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14863#discussion_r520082432", "bodyText": "This is already pulled in to the common bundle.  Instead of including it here, we should depend on it from the common bundle.", "author": "andymc12", "createdAt": "2020-11-09T19:56:39Z", "path": "dev/io.openliberty.org.jboss.resteasy.validator.provider/bnd.bnd", "diffHunk": "@@ -0,0 +1,66 @@\n+#*******************************************************************************\n+# Copyright (c) 2020 IBM Corporation and others.\n+# All rights reserved. This program and the accompanying materials\n+# are made available under the terms of the Eclipse Public License v1.0\n+# which accompanies this distribution, and is available at\n+# http://www.eclipse.org/legal/epl-v10.html\n+#\n+# Contributors:\n+#     IBM Corporation - initial API and implementation\n+#*******************************************************************************\n+-include= ~../cnf/resources/bnd/bundle.props\n+bVersion=1.0\n+\n+Bundle-SymbolicName: io.openliberty.org.jboss.resteasy.validator.provider\n+\n+src: src, resources\n+\n+app-resources= \\\n+  META-INF/services/javax.ws.rs.ext.Providers| \\\n+  META-INF/services/javax.validation.spi.ValidationProvider\n+  \n+-cdiannotations:\n+\n+Service-Component: \\\n+  io.openliberty.org.jboss.resteasy.validator.provider.ResourceProvider; \\\n+    implementation:=com.ibm.wsspi.classloading.ResourceProvider; \\\n+    provide:=com.ibm.wsspi.classloading.ResourceProvider; \\\n+    configuration-policy:=optional; \\\n+    properties:=\"resources=${app-resources}\"    \n+\n+Export-Package: \\\n+  org.jboss.resteasy.plugins.validation;version=4.5.8.Final;thread-context=true\n+ Private-Package: \\\n+  org.jboss.resteasy.plugins.validation.i18n;version=4.5.8.Final\n+\n+# Using version=! in order to not have a version attached to the import for packages that were removed\n+# from Java after Java 8.  Doing this keeps the import like before Java 11 support. It will get the\n+# packages from Java when using Java 8 or earlier and from the new shipped bundles for Java 9 and later.\n+Import-Package: \\\n+  org.jboss.resteasy.api.validation, \\\n+  org.hibernate.validator.internal,\\\n+  jakarta.persistence,\\\n+  *\n+  \n+#  javax.activation;version=!, \\\n+#  javax.annotation;version=!, \\\n+#  javax.annotation.security;version=!, \\\n+\n+DynamicImport-Package: \\\n+  jakarta.validation.*, \\\n+  jakarta.persistence.*, \\\n+  jakarta.xml.*\n+\n+Include-Resource:\\\n+@${repo;org.jboss.resteasy:resteasy-core-spi;4.5.8.Final;EXACT}, \\", "originalCommit": "f915ac36e53d940183d30e8d518b25ee0de27c4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MzE3Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14863#discussion_r520083177", "bodyText": "Is there a com.ibm.*validator or io.openliberty.*validator project that we can depend on instead of the open source one?", "author": "andymc12", "createdAt": "2020-11-09T19:57:56Z", "path": "dev/io.openliberty.org.jboss.resteasy.validator.provider/bnd.bnd", "diffHunk": "@@ -0,0 +1,66 @@\n+#*******************************************************************************\n+# Copyright (c) 2020 IBM Corporation and others.\n+# All rights reserved. This program and the accompanying materials\n+# are made available under the terms of the Eclipse Public License v1.0\n+# which accompanies this distribution, and is available at\n+# http://www.eclipse.org/legal/epl-v10.html\n+#\n+# Contributors:\n+#     IBM Corporation - initial API and implementation\n+#*******************************************************************************\n+-include= ~../cnf/resources/bnd/bundle.props\n+bVersion=1.0\n+\n+Bundle-SymbolicName: io.openliberty.org.jboss.resteasy.validator.provider\n+\n+src: src, resources\n+\n+app-resources= \\\n+  META-INF/services/javax.ws.rs.ext.Providers| \\\n+  META-INF/services/javax.validation.spi.ValidationProvider\n+  \n+-cdiannotations:\n+\n+Service-Component: \\\n+  io.openliberty.org.jboss.resteasy.validator.provider.ResourceProvider; \\\n+    implementation:=com.ibm.wsspi.classloading.ResourceProvider; \\\n+    provide:=com.ibm.wsspi.classloading.ResourceProvider; \\\n+    configuration-policy:=optional; \\\n+    properties:=\"resources=${app-resources}\"    \n+\n+Export-Package: \\\n+  org.jboss.resteasy.plugins.validation;version=4.5.8.Final;thread-context=true\n+ Private-Package: \\\n+  org.jboss.resteasy.plugins.validation.i18n;version=4.5.8.Final\n+\n+# Using version=! in order to not have a version attached to the import for packages that were removed\n+# from Java after Java 8.  Doing this keeps the import like before Java 11 support. It will get the\n+# packages from Java when using Java 8 or earlier and from the new shipped bundles for Java 9 and later.\n+Import-Package: \\\n+  org.jboss.resteasy.api.validation, \\\n+  org.hibernate.validator.internal,\\\n+  jakarta.persistence,\\\n+  *\n+  \n+#  javax.activation;version=!, \\\n+#  javax.annotation;version=!, \\\n+#  javax.annotation.security;version=!, \\\n+\n+DynamicImport-Package: \\\n+  jakarta.validation.*, \\\n+  jakarta.persistence.*, \\\n+  jakarta.xml.*\n+\n+Include-Resource:\\\n+@${repo;org.jboss.resteasy:resteasy-core-spi;4.5.8.Final;EXACT}, \\\n+@${repo;org.jboss.resteasy:resteasy-validator-provider;4.5.8.Final;EXACT}, \\\n+META-INF=resources/META-INF\n+\n+-buildpath: \\\n+ org.hibernate.validator;version=latest", "originalCommit": "f915ac36e53d940183d30e8d518b25ee0de27c4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4NDIxMQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14863#discussion_r520084211", "bodyText": "same as other comment - can we use a com.ibm or io.openliberty project instead?", "author": "andymc12", "createdAt": "2020-11-09T19:59:39Z", "path": "dev/io.openliberty.restfulWS.3.0_fat/bnd.bnd", "diffHunk": "@@ -19,8 +19,11 @@ fat.project: true\n \n \n -buildpath: \\\n-    io.openliberty.jakarta.annotation.2.0;version=latest,\\\n-    io.openliberty.jakarta.jaxb.3.0;version=latest,\\\n-    io.openliberty.jakarta.restfulWS.3.0;version=latest,\\\n+\tio.openliberty.jakarta.annotation.2.0;version=latest,\\\n+\tio.openliberty.jakarta.jaxb.3.0;version=latest,\\\n+\tio.openliberty.jakarta.validation.3.0;version=latest,\\\n+\tio.openliberty.jakarta.restfulWS.3.0;version=latest,\\\n \tio.openliberty.jakarta.servlet.5.0;version=latest,\\\n-\tcom.ibm.ws.componenttest.2.0\n+\tcom.ibm.ws.componenttest.2.0,\\\n+\torg.hibernate.validator;version=latest,\\\n+\tjakarta.validation.jakarta.validation-api", "originalCommit": "f915ac36e53d940183d30e8d518b25ee0de27c4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4NjEzOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14863#discussion_r520086138", "bodyText": "It might be better to test with a different constraint annotation.  I'm not 100% sure, but I think it isn't possible to get a null id here anyway - because some sort of ID is required for matching the path.\nMaybe try using @Positive and then send in a negative number or alphabetic characters?", "author": "andymc12", "createdAt": "2020-11-09T20:02:56Z", "path": "dev/io.openliberty.restfulWS.3.0_fat/fat/src/io/openliberty/restfulWS30/fat/validator/Resource.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package io.openliberty.restfulWS30.fat.validator;\n+\n+import jakarta.ws.rs.PathParam;\n+\n+import jakarta.validation.constraints.NotNull;\n+\n+import jakarta.ws.rs.ApplicationPath;\n+import jakarta.ws.rs.POST;\n+import jakarta.ws.rs.Path;\n+import jakarta.ws.rs.Produces;\n+import jakarta.ws.rs.core.Application;\n+\n+\n+\n+@ApplicationPath(\"/app\")\n+@Path(\"/path/{id}\")\n+@Produces(\"text/plain\")\n+public class Resource extends Application {    \n+\n+    private String id;\n+\n+    @POST\n+    public String foo(@NotNull @PathParam(\"id\") String id) {", "originalCommit": "f915ac36e53d940183d30e8d518b25ee0de27c4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4NzcxOQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14863#discussion_r520087719", "bodyText": "I wonder if we need this file at all.  I think that when the beanValidation-3.0 feature is enabled, that will automatically supply a ValidationProvider for us.", "author": "andymc12", "createdAt": "2020-11-09T20:06:05Z", "path": "dev/io.openliberty.org.jboss.resteasy.validator.provider/resources/META-INF/services/javax.validation.spi.ValidationProvider", "diffHunk": "@@ -0,0 +1 @@\n+org.hibernate.validator.HibernateValidator", "originalCommit": "f915ac36e53d940183d30e8d518b25ee0de27c4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4NzkxNQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14863#discussion_r520087915", "bodyText": "Same as above - I wonder if we need this file at all. I think that when the beanValidation-3.0 feature is enabled, that will automatically supply a ValidationProvider for us.", "author": "andymc12", "createdAt": "2020-11-09T20:06:26Z", "path": "dev/io.openliberty.org.jboss.resteasy.validator.provider/resources/META-INF/services/javax.ws.rs.ext.Providers", "diffHunk": "@@ -0,0 +1,4 @@\n+org.hibernate.validator.HibernateValidator", "originalCommit": "f915ac36e53d940183d30e8d518b25ee0de27c4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "251867a9c0a68847e21166dc08213b947b030075", "url": "https://github.com/OpenLiberty/open-liberty/commit/251867a9c0a68847e21166dc08213b947b030075", "message": "Enable RestEasy Bean Validation with Hibernate", "committedDate": "2020-11-09T22:04:47Z", "type": "forcePushed"}, {"oid": "3f0b75d9fa7a3e84074766a6965ad45a4f5ac1d1", "url": "https://github.com/OpenLiberty/open-liberty/commit/3f0b75d9fa7a3e84074766a6965ad45a4f5ac1d1", "message": "Enable RestEasy Bean Validation with Hibernate", "committedDate": "2020-11-10T12:49:57Z", "type": "commit"}, {"oid": "7ce088aa5c8d57e4581d42ba17c95baeb478d297", "url": "https://github.com/OpenLiberty/open-liberty/commit/7ce088aa5c8d57e4581d42ba17c95baeb478d297", "message": "Enable RestEasy Bean Validation with Hibernate", "committedDate": "2020-11-10T12:49:57Z", "type": "commit"}, {"oid": "8b51e350594304f666fe4a7b28023d1b8adbee5c", "url": "https://github.com/OpenLiberty/open-liberty/commit/8b51e350594304f666fe4a7b28023d1b8adbee5c", "message": "Enable RestEasy Bean Validation with Hibernate", "committedDate": "2020-11-10T12:49:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5MjQzMw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14863#discussion_r520592433", "bodyText": "You shouldn't need this line since you have io.openliberty.jakarta.validation.3.0;version=latest,\\ above.  IIUC, there is a build time cost for depending on artifacts in Artifactory/Maven Central/etc. vs depending on artifacts built during the build.  The latter is preferred.", "author": "andymc12", "createdAt": "2020-11-10T14:13:50Z", "path": "dev/io.openliberty.restfulWS.3.0_fat/bnd.bnd", "diffHunk": "@@ -19,8 +19,10 @@ fat.project: true\n \n \n -buildpath: \\\n-    io.openliberty.jakarta.annotation.2.0;version=latest,\\\n-    io.openliberty.jakarta.jaxb.3.0;version=latest,\\\n-    io.openliberty.jakarta.restfulWS.3.0;version=latest,\\\n+\tio.openliberty.jakarta.annotation.2.0;version=latest,\\\n+\tio.openliberty.jakarta.jaxb.3.0;version=latest,\\\n+\tio.openliberty.jakarta.validation.3.0;version=latest,\\\n+\tio.openliberty.jakarta.restfulWS.3.0;version=latest,\\\n \tio.openliberty.jakarta.servlet.5.0;version=latest,\\\n-\tcom.ibm.ws.componenttest.2.0\n+\tcom.ibm.ws.componenttest.2.0,\\\n+\tjakarta.validation.jakarta.validation-api", "originalCommit": "251867a9c0a68847e21166dc08213b947b030075", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTkxNA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14863#discussion_r520601914", "bodyText": "I don't think we need this test.  It's basically just testing manual bean validation - I think the BV FATs have something similar.  We really only need tests that bean validation is performed on JAX-RS resources and providers.", "author": "andymc12", "createdAt": "2020-11-10T14:25:53Z", "path": "dev/io.openliberty.restfulWS.3.0_fat/fat/src/io/openliberty/restfulWS30/fat/validator/ValidatorTestServlet.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package io.openliberty.restfulWS30.fat.validator;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.InputStream;\n+import java.net.HttpURLConnection;\n+import java.net.URI;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import jakarta.servlet.annotation.WebServlet;\n+import jakarta.validation.ConstraintViolation;\n+import jakarta.validation.Validation;\n+import jakarta.validation.Validator;\n+import jakarta.validation.constraints.NotNull;\n+\n+import org.junit.Test;\n+\n+import componenttest.app.FATServlet;\n+\n+@SuppressWarnings(\"serial\")\n+@WebServlet(\"/ValidatorTestServlet\")\n+public class ValidatorTestServlet extends FATServlet {\n+\n+    @Test\n+    public void testNotNullViolations() {\n+        Validator validator = Validation.buildDefaultValidatorFactory().getValidator();\n+        System.out.println(\"testNotNullViolations validator \" + validator.toString());\n+        \n+        MyBean myBean = new MyBean();\n+        myBean.notNull = null;\n+        assertViolations(validator.validate(myBean), NotNull.class);\n+    }", "originalCommit": "251867a9c0a68847e21166dc08213b947b030075", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9d9154b704c8b68322cde470cb578542344812c3", "url": "https://github.com/OpenLiberty/open-liberty/commit/9d9154b704c8b68322cde470cb578542344812c3", "message": "Enable RestEasy Bean Validation with Hibernate Review comments", "committedDate": "2020-11-10T14:46:04Z", "type": "commit"}, {"oid": "9d9154b704c8b68322cde470cb578542344812c3", "url": "https://github.com/OpenLiberty/open-liberty/commit/9d9154b704c8b68322cde470cb578542344812c3", "message": "Enable RestEasy Bean Validation with Hibernate Review comments", "committedDate": "2020-11-10T14:46:04Z", "type": "forcePushed"}]}