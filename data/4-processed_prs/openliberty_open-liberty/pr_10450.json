{"pr_number": 10450, "pr_title": "jaxrs metrics changes", "pr_createdAt": "2020-01-15T19:43:40Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/10450", "timeline": [{"oid": "9ce22c68bb5ac1e94ff5e5ce0681c551e2e5d762", "url": "https://github.com/OpenLiberty/open-liberty/commit/9ce22c68bb5ac1e94ff5e5ce0681c551e2e5d762", "message": "jaxrs metrics changes", "committedDate": "2020-01-15T22:44:16Z", "type": "forcePushed"}, {"oid": "fc28a51c400ea41b9b341de8996700db47ab8fe1", "url": "https://github.com/OpenLiberty/open-liberty/commit/fc28a51c400ea41b9b341de8996700db47ab8fe1", "message": "jaxrs metrics changes", "committedDate": "2020-01-16T15:23:38Z", "type": "forcePushed"}, {"oid": "57da1ea8b59a6bba96dc5952610fc18777b2dff8", "url": "https://github.com/OpenLiberty/open-liberty/commit/57da1ea8b59a6bba96dc5952610fc18777b2dff8", "message": "jaxrs metrics changes", "committedDate": "2020-01-16T16:52:08Z", "type": "forcePushed"}, {"oid": "b129323a2c7c310f13cca9b44404d3924845d939", "url": "https://github.com/OpenLiberty/open-liberty/commit/b129323a2c7c310f13cca9b44404d3924845d939", "message": "jaxrs metrics changes", "committedDate": "2020-01-16T20:50:35Z", "type": "forcePushed"}, {"oid": "e8db33d18dd14f88d16f9f4651f6eb1fe0b0b4a6", "url": "https://github.com/OpenLiberty/open-liberty/commit/e8db33d18dd14f88d16f9f4651f6eb1fe0b0b4a6", "message": "jaxrs metrics changes", "committedDate": "2020-01-17T14:20:48Z", "type": "forcePushed"}, {"oid": "8f924859a561b155cbbf438b72480893b53cdbec", "url": "https://github.com/OpenLiberty/open-liberty/commit/8f924859a561b155cbbf438b72480893b53cdbec", "message": "jaxrs metrics changes", "committedDate": "2020-01-17T14:30:54Z", "type": "forcePushed"}, {"oid": "9b17af29544a77251c85585c517b37318269fbd7", "url": "https://github.com/OpenLiberty/open-liberty/commit/9b17af29544a77251c85585c517b37318269fbd7", "message": "jaxrs metrics changes", "committedDate": "2020-01-21T18:47:16Z", "type": "forcePushed"}, {"oid": "01812644268b2121c4a969d31dc5ef1b2c216d16", "url": "https://github.com/OpenLiberty/open-liberty/commit/01812644268b2121c4a969d31dc5ef1b2c216d16", "message": "jaxrs metrics changes", "committedDate": "2020-01-21T20:45:56Z", "type": "forcePushed"}, {"oid": "dc60c7694e1c2d5ed748c39369a15c2745fa83cd", "url": "https://github.com/OpenLiberty/open-liberty/commit/dc60c7694e1c2d5ed748c39369a15c2745fa83cd", "message": "jaxrs metrics changes", "committedDate": "2020-01-21T20:55:32Z", "type": "forcePushed"}, {"oid": "2ced4cd80f3de2e3634e087e05f7aa5379a6a9a4", "url": "https://github.com/OpenLiberty/open-liberty/commit/2ced4cd80f3de2e3634e087e05f7aa5379a6a9a4", "message": "jaxrs metrics changes", "committedDate": "2020-01-24T23:12:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1NDQ2Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r371954467", "bodyText": "Won't this cause problems since it is an auto feature for features that are already GA?  I think this needs to be GA too.", "author": "andymc12", "createdAt": "2020-01-28T17:39:55Z", "path": "dev/com.ibm.websphere.appserver.features/visibility/auto/com.ibm.websphere.appserver.jaxrsMonitor-1.0.feature", "diffHunk": "@@ -0,0 +1,11 @@\n+-include= ~${workspace}/cnf/resources/bnd/feature.props\n+symbolicName=com.ibm.websphere.appserver.jaxrsMonitor-1.0\n+Manifest-Version: 1.0\n+IBM-API-Package: com.ibm.websphere.jaxrs.monitor; type=\"ibm-api\"\n+IBM-Provision-Capability: \\\n+  osgi.identity; filter:=\"(&(type=osgi.subsystem.feature)(osgi.identity=com.ibm.websphere.appserver.monitor-1.0))\", \\\n+  osgi.identity; filter:=\"(&(type=osgi.subsystem.feature)(|(osgi.identity=com.ibm.websphere.appserver.jaxrs-2.0)(osgi.identity=com.ibm.websphere.appserver.jaxrs-2.1)))\"\n+IBM-Install-Policy: when-satisfied\n+-bundles=com.ibm.ws.jaxrs.2.x.monitor\n+kind=beta", "originalCommit": "2ced4cd80f3de2e3634e087e05f7aa5379a6a9a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk3Nzc3Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r371977777", "bodyText": "agreed.", "author": "jim-krueger", "createdAt": "2020-01-28T18:25:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1NDQ2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1NTkzNQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r371955935", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final int[] methodCounts = new int[11];\n          \n          \n            \n                private final int[] methodCounts = new int[METHOD_STRINGS.length];\n          \n      \n    \n    \n  \n\nThis should make it easier to add/remove methods.", "author": "andymc12", "createdAt": "2020-01-28T17:42:44Z", "path": "dev/com.ibm.ws.jaxrs.2.0_fat/fat/src/com/ibm/ws/jaxrs20/fat/restmetrics/RestMetricsTest.java", "diffHunk": "@@ -45,32 +46,36 @@\n @RunWith(FATRunner.class)\n public class RestMetricsTest {\n \n-     // Array to hold the names that identify the methods in metrics 2.0\n+     // Array to hold the names that identify the methods in metrics 2.3\n     static final String[] METHOD_STRINGS = {\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getMessage__\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_asyncMethod_javax_ws_rs_container_AsyncResponse_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getMultiParamMessage_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getMultiParamMessage_java_lang_String_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_postMessage_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_putMessage_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_deleteMessage__\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getCheckedException_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getUncheckedException_java_lang_String_\"};\n+                                            \"optionsMethod\",\n+                                            \"headMethod\",\n+                                            \"headFallbackMethod\",\n+                                            \"AsyncResponse\",\n+                                            \"getMultiParamMessage_java.lang.String\",\n+                                            \"getMultiParamMessage_java.lang.String_java.lang.String\",\n+                                            \"postMessage_java.lang.String\",\n+                                            \"putMessage_java.lang.String\",\n+                                            \"deleteMessage\",\n+                                            \"getCheckedException_java.lang.String\",\n+                                            \"getUncheckedException_java.lang.String\"};\n \n     static final String URI_CONTEXT_ROOT = \"http://localhost:\" + Integer.getInteger(\"bvt.prop.HTTP_default\") +\n                     \"/restmetrics/rest/\";\n \n     private static final String METRICSWAR = \"restmetrics\";\n \n+    private static final String METRICS_URL_STRING = \"/metrics/base/REST.request\";\n+\n     private final String MAPPEDURI = getBaseTestUri(METRICSWAR, \"rest\", \"restmetrics\");\n \n     private static final int BUFFER = 300; // margin or error in ms for response times.\n \n     private static final int EXPECTEDRT = 200; // Expected min. response time for a single request.\n \n-    private final int[] methodCounts = new int[9];\n+    private final int[] methodCounts = new int[11];", "originalCommit": "2ced4cd80f3de2e3634e087e05f7aa5379a6a9a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAxNTc5NA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r372015794", "bodyText": "agreed", "author": "jim-krueger", "createdAt": "2020-01-28T19:40:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1NTkzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1NjExOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r371956118", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final double[] responseTimes = new double[11];\n          \n          \n            \n                private final double[] responseTimes = new double[METHOD_STRINGS.length];\n          \n      \n    \n    \n  \n\nSame as above.", "author": "andymc12", "createdAt": "2020-01-28T17:43:04Z", "path": "dev/com.ibm.ws.jaxrs.2.0_fat/fat/src/com/ibm/ws/jaxrs20/fat/restmetrics/RestMetricsTest.java", "diffHunk": "@@ -45,32 +46,36 @@\n @RunWith(FATRunner.class)\n public class RestMetricsTest {\n \n-     // Array to hold the names that identify the methods in metrics 2.0\n+     // Array to hold the names that identify the methods in metrics 2.3\n     static final String[] METHOD_STRINGS = {\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getMessage__\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_asyncMethod_javax_ws_rs_container_AsyncResponse_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getMultiParamMessage_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getMultiParamMessage_java_lang_String_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_postMessage_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_putMessage_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_deleteMessage__\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getCheckedException_java_lang_String_\",\n-                                                   \"restmetrics_com_ibm_ws_jaxrs_fat_restmetrics_RestMetricsResource_getUncheckedException_java_lang_String_\"};\n+                                            \"optionsMethod\",\n+                                            \"headMethod\",\n+                                            \"headFallbackMethod\",\n+                                            \"AsyncResponse\",\n+                                            \"getMultiParamMessage_java.lang.String\",\n+                                            \"getMultiParamMessage_java.lang.String_java.lang.String\",\n+                                            \"postMessage_java.lang.String\",\n+                                            \"putMessage_java.lang.String\",\n+                                            \"deleteMessage\",\n+                                            \"getCheckedException_java.lang.String\",\n+                                            \"getUncheckedException_java.lang.String\"};\n \n     static final String URI_CONTEXT_ROOT = \"http://localhost:\" + Integer.getInteger(\"bvt.prop.HTTP_default\") +\n                     \"/restmetrics/rest/\";\n \n     private static final String METRICSWAR = \"restmetrics\";\n \n+    private static final String METRICS_URL_STRING = \"/metrics/base/REST.request\";\n+\n     private final String MAPPEDURI = getBaseTestUri(METRICSWAR, \"rest\", \"restmetrics\");\n \n     private static final int BUFFER = 300; // margin or error in ms for response times.\n \n     private static final int EXPECTEDRT = 200; // Expected min. response time for a single request.\n \n-    private final int[] methodCounts = new int[9];\n+    private final int[] methodCounts = new int[11];\n \n-    private final double[] responseTimes = new double[9];\n+    private final double[] responseTimes = new double[11];", "originalCommit": "2ced4cd80f3de2e3634e087e05f7aa5379a6a9a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk4OTYxMQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r371989611", "bodyText": "agreed.", "author": "jim-krueger", "createdAt": "2020-01-28T18:48:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1NjExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1OTg5MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r371959891", "bodyText": "With removing the mapping stuff, are you planning to add that back in in a separate PR?  Or is David?", "author": "andymc12", "createdAt": "2020-01-28T17:50:28Z", "path": "dev/com.ibm.ws.microprofile.metrics.2.0.monitor/src/com/ibm/ws/microprofile/metrics/monitor/MappingTable.java", "diffHunk": "@@ -63,13 +62,6 @@ private MappingTable() {\n         };\n \t\tmappingTable.put(\"WebSphere:type=ServletStats,name=*\", servletTable);\n \t\t\n-\t\tString[][] restfulTable = new String[][] {\n-        \t{ \"RESTful.request.total\", \"Total Request\", \"RESTful.request.total.description\", COUNTER, MetricUnits.NONE, \"RequestCount\", null, RESTFUL_TAG_NAME },\n-        \t{ \"RESTful.responseTime.total\", \"Total Response Time\", \"RESTful.responseTime.total.description\", GAUGE, MetricUnits.NANOSECONDS, \"ResponseTimeDetails\", \"total\", RESTFUL_TAG_NAME }\n-        };\n-\t\tmappingTable.put(\"WebSphere:type=RESTful_Stats,name=*\", restfulTable);\n-\n-", "originalCommit": "2ced4cd80f3de2e3634e087e05f7aa5379a6a9a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk3MTU3OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r371971578", "bodyText": "Yes,  it is part of Davids PR:  #10518", "author": "jim-krueger", "createdAt": "2020-01-28T18:13:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk1OTg5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk2MDYzNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r371960636", "bodyText": "I'm wondering if there isn't a better way to handle the \"indexing\"... maybe start with a counter at 0 and then increment?  It seems like this test will be difficult to maintain/update - especially after we haven't looked at it for a few months.", "author": "andymc12", "createdAt": "2020-01-28T17:51:54Z", "path": "dev/com.ibm.ws.jaxrs.2.0_fat/fat/src/com/ibm/ws/jaxrs20/fat/restmetrics/RestMetricsTest.java", "diffHunk": "@@ -120,41 +125,43 @@ private static String getHost() {\n     public void testCoreMethods() throws IOException {\n \n         // Execute a get method with varying numbers of parameters.\n-        runGetMethod(0, 200, \"/restmetrics/rest/restmetrics\", \"Metrics!\");\n+        runOptionsMethod(0, 200, \"/restmetrics/rest/restmetrics\", \"Metrics!\");", "originalCommit": "2ced4cd80f3de2e3634e087e05f7aa5379a6a9a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAxNDk0Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r372014947", "bodyText": "agreed", "author": "jim-krueger", "createdAt": "2020-01-28T19:39:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk2MDYzNg=="}], "type": "inlineReview"}, {"oid": "f776225ed57ffe91d98b31c89c24ad9e8cc4ed73", "url": "https://github.com/OpenLiberty/open-liberty/commit/f776225ed57ffe91d98b31c89c24ad9e8cc4ed73", "message": "jaxrs metrics changes", "committedDate": "2020-01-28T19:46:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0MjE5MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r372042191", "bodyText": "Could you combine runHeadMethod with runGetMethod (and maybe other methods) by adding another parameter (i.e. httpMethod) and then pass \"GET\" or \"HEAD\" to the new method?  That might make this easier to maintain.", "author": "andymc12", "createdAt": "2020-01-28T20:37:13Z", "path": "dev/com.ibm.ws.jaxrs.2.0_fat/fat/src/com/ibm/ws/jaxrs20/fat/restmetrics/RestMetricsTest.java", "diffHunk": "@@ -241,6 +285,46 @@ private void runCheckMonitorStats(int exprc, int index) throws IOException {\n         }\n     }\n \n+    private void runHeadMethod(int index, int exprc, String requestUri, String testOut) throws IOException {", "originalCommit": "f776225ed57ffe91d98b31c89c24ad9e8cc4ed73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU4MjIwNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10450#discussion_r372582206", "bodyText": "Unfortunately the runGetMethod and run HeadMethod have subtle differences,  but this comment is valid in general.   I will look for ways to combine methods.", "author": "jim-krueger", "createdAt": "2020-01-29T19:22:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0MjE5MQ=="}], "type": "inlineReview"}, {"oid": "1b54630b2094dd95254070c757d175629638bd58", "url": "https://github.com/OpenLiberty/open-liberty/commit/1b54630b2094dd95254070c757d175629638bd58", "message": "jaxrs metrics changes", "committedDate": "2020-01-29T20:39:09Z", "type": "commit"}, {"oid": "d0fab9a17d36ef57ff27e1e1ad899336137dc0ce", "url": "https://github.com/OpenLiberty/open-liberty/commit/d0fab9a17d36ef57ff27e1e1ad899336137dc0ce", "message": "Set min java level for testcase", "committedDate": "2020-01-29T21:15:22Z", "type": "commit"}, {"oid": "d0fab9a17d36ef57ff27e1e1ad899336137dc0ce", "url": "https://github.com/OpenLiberty/open-liberty/commit/d0fab9a17d36ef57ff27e1e1ad899336137dc0ce", "message": "Set min java level for testcase", "committedDate": "2020-01-29T21:15:22Z", "type": "forcePushed"}]}