{"pr_number": 12906, "pr_title": "Issue 12822: Add custom HTTP connect and read timeouts for acmeCA", "pr_createdAt": "2020-07-07T00:48:38Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/12906", "timeline": [{"oid": "7bca14b5a87b9cb671bb6fc97431822e12c978ba", "url": "https://github.com/OpenLiberty/open-liberty/commit/7bca14b5a87b9cb671bb6fc97431822e12c978ba", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-07T02:43:28Z", "type": "forcePushed"}, {"oid": "3c327117d395b7fad632843fc680846fe30ce4cf", "url": "https://github.com/OpenLiberty/open-liberty/commit/3c327117d395b7fad632843fc680846fe30ce4cf", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-07T03:07:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzNzM5OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r450937399", "bodyText": "Shouldn't these be ibm:type=\"duration\"?", "author": "jvanhill", "createdAt": "2020-07-07T15:06:59Z", "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/metatype/metatype.xml", "diffHunk": "@@ -70,6 +70,8 @@\n    <AD id=\"trustStore\"           name=\"%trustStore\"         description=\"%trustStore.desc\"         required=\"false\" type=\"String\" />\n    <AD id=\"trustStorePassword\"   name=\"%trustStorePassword\" description=\"%trustStorePassword.desc\" required=\"false\" type=\"String\" ibm:type=\"password\" />\n    <AD id=\"trustStoreType\"       name=\"%trustStoreType\"     description=\"%trustStoreType.desc\"     required=\"false\" type=\"String\" />\n+   <AD id=\"httpConnectTimeout\"   name=\"internal\" description=\"internal use only\" type=\"Integer\"  required=\"false\" default=\"10000\" min=\"0\" />", "originalCommit": "3c327117d395b7fad632843fc680846fe30ce4cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEwMDg2OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r451100869", "bodyText": "Changed to duration", "author": "kristip17", "createdAt": "2020-07-07T19:43:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzNzM5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzNzc4OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r450937789", "bodyText": "If you change the types in the metatype to ibm:type=\"duration\" then these will need to be Long.", "author": "jvanhill", "createdAt": "2020-07-07T15:07:31Z", "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeConfig.java", "diffHunk": "@@ -82,6 +82,10 @@\n \t// Minimum allowed time to check for expiration\n \tprivate Long renewCertMin;\n \t\n+\tprivate Integer httpConnectTimeout = AcmeConstants.HTTP_CONNECT_TIMEOUT_DEFAULT;", "originalCommit": "3c327117d395b7fad632843fc680846fe30ce4cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEwMDkzMQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r451100931", "bodyText": "Changed to duration", "author": "kristip17", "createdAt": "2020-07-07T19:43:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzNzc4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzODA5NA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r450938094", "bodyText": "If you change the types in the metatype to ibm:type=\"duration\" then these will need no longer be needed.", "author": "jvanhill", "createdAt": "2020-07-07T15:07:52Z", "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeConfig.java", "diffHunk": "@@ -274,6 +281,27 @@ private static Long getLongValue(Map<String, Object> configProps, String propert\n \t\treturn (Long) value;\n \t}\n \t\n+\t/**\n+\t * Get a {@link Integer} value from the config properties.\n+\t * \n+\t * @param configProps\n+\t *            The configuration properties passed in by declarative\n+\t *            services.\n+\t * @param property\n+\t *            The property to lookup.\n+\t * @param outcomeOnNull\n+\t *            The value to assign if the lookup is null.\n+\t * @return The {@link Integer} value, or outcomeOnNull if it doesn't exist.\n+\t */\n+\t@Trivial\n+\tprivate static Integer getIntValue(Map<String, Object> configProps, String property, Integer outcomeOnNull) {", "originalCommit": "3c327117d395b7fad632843fc680846fe30ce4cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEwMjg3Mg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r451102872", "bodyText": "Removed", "author": "kristip17", "createdAt": "2020-07-07T19:47:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzODA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzOTU1OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r450939558", "bodyText": "Did you intend to leave this here?", "author": "jvanhill", "createdAt": "2020-07-07T15:09:54Z", "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeConfigService.java", "diffHunk": "@@ -114,6 +114,8 @@ public void initialize(Map<String, Object> properties) throws AcmeCaException {\n \t\t */\n \t\tAcmeConfig acmeConfig = new AcmeConfig(properties, true);\n \t\tAcmeClient acmeClient = new AcmeClient(acmeConfig);\n+\t\t\n+\t\tTr.debug(tc, \"init httpconnect \" + acmeConfig.getHTTPConnectTimeout());", "originalCommit": "3c327117d395b7fad632843fc680846fe30ce4cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEwMjgzNA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r451102834", "bodyText": "Removed", "author": "kristip17", "createdAt": "2020-07-07T19:46:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzOTU1OA=="}], "type": "inlineReview"}, {"oid": "a378fc02ae79ff7555665c501d83eeb1b92fb2fb", "url": "https://github.com/OpenLiberty/open-liberty/commit/a378fc02ae79ff7555665c501d83eeb1b92fb2fb", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-07T18:51:06Z", "type": "forcePushed"}, {"oid": "44fb60e74556f82bfab3af70e5bca1c4d03a5d43", "url": "https://github.com/OpenLiberty/open-liberty/commit/44fb60e74556f82bfab3af70e5bca1c4d03a5d43", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-07T19:42:31Z", "type": "forcePushed"}, {"oid": "c5fe06d27aa9f66f9f84c55094929b5343dbe613", "url": "https://github.com/OpenLiberty/open-liberty/commit/c5fe06d27aa9f66f9f84c55094929b5343dbe613", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-07T19:46:32Z", "type": "forcePushed"}, {"oid": "7748279d6ee4c74e5f806b9acc459c43c31ee8c3", "url": "https://github.com/OpenLiberty/open-liberty/commit/7748279d6ee4c74e5f806b9acc459c43c31ee8c3", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-07T19:49:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEyNDE3MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r451124171", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            httpConnectTimeout.desc=The HTTP connect timeout for connecting to the Certificate Authority to create accounts or request certificates. A timeout of zero as an infinite timeout.\n          \n          \n            \n            httpConnectTimeout.desc=The HTTP connect timeout for connecting to the Certificate Authority to create accounts or request certificates. A timeout of zero is an infinite timeout. The default timeout is 10 seconds.", "author": "jvanhill", "createdAt": "2020-07-07T20:28:40Z", "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -88,7 +88,16 @@ certCheckerErrorSchedule=Certificate checker error schedule\n certCheckerErrorSchedule.desc=Performs the same function as the certCheckerSchedule attribute, but on an alternate schedule. For example, the certCheckerErrorSchedule attribute can be set to a shorter interval than the certCheckerSchedule attribute, to increase the frequency of checks after a failed request. The interval from the certCheckerSchedule attribute is resumed after the certificate is renewed. \n \n disableMinRenewWindow=Disable minimum renew window\n-disableMinRenewWindow.desc=Enables immediate certificate renew requests by disabling the specified minimum amount of time between renew requests. The minimum renew time is 15 seconds.\n+disableMinRenewWindow.desc=Enables immediate certificate renew requests by disabling the specified minimum amount of time between renew requests. The default minimum renew time is 15 seconds.\n \n disableRenewOnNewHistory=Disable certificate refresh if the ACME history file does not yet exist\n-disableRenewOnNewHistory.desc=Disables automatic certificate refresh when ACME creates the ACME history file.\n\\ No newline at end of file\n+disableRenewOnNewHistory.desc=Disables automatic certificate refresh when ACME creates the ACME history file.\n+\n+renewCertMin=Renew certificate minimum\n+renewCertMin.desc=Controls the timing between certificate renew requests. A renew request is not allowed until the amount of time set by the renewCertMin elapses.\n+\n+httpConnectTimeout=HTTP Connect Timeout\n+httpConnectTimeout.desc=The HTTP connect timeout for connecting to the Certificate Authority to create accounts or request certificates. A timeout of zero as an infinite timeout.", "originalCommit": "7748279d6ee4c74e5f806b9acc459c43c31ee8c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgzMTkwMw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r451831903", "bodyText": "Updated", "author": "kristip17", "createdAt": "2020-07-08T21:20:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEyNDE3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEyNDMyOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r451124328", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            httpReadTimeout.desc=The HTTP read timeout for reading from the Certificate Authority to create accounts or request certificates. A timeout of zero as an infinite timeout.\n          \n          \n            \n            httpReadTimeout.desc=The HTTP read timeout for reading from the Certificate Authority to create accounts or request certificates. A timeout of zero is an infinite timeout. The default timeout is 10 seconds.", "author": "jvanhill", "createdAt": "2020-07-07T20:29:00Z", "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -88,7 +88,16 @@ certCheckerErrorSchedule=Certificate checker error schedule\n certCheckerErrorSchedule.desc=Performs the same function as the certCheckerSchedule attribute, but on an alternate schedule. For example, the certCheckerErrorSchedule attribute can be set to a shorter interval than the certCheckerSchedule attribute, to increase the frequency of checks after a failed request. The interval from the certCheckerSchedule attribute is resumed after the certificate is renewed. \n \n disableMinRenewWindow=Disable minimum renew window\n-disableMinRenewWindow.desc=Enables immediate certificate renew requests by disabling the specified minimum amount of time between renew requests. The minimum renew time is 15 seconds.\n+disableMinRenewWindow.desc=Enables immediate certificate renew requests by disabling the specified minimum amount of time between renew requests. The default minimum renew time is 15 seconds.\n \n disableRenewOnNewHistory=Disable certificate refresh if the ACME history file does not yet exist\n-disableRenewOnNewHistory.desc=Disables automatic certificate refresh when ACME creates the ACME history file.\n\\ No newline at end of file\n+disableRenewOnNewHistory.desc=Disables automatic certificate refresh when ACME creates the ACME history file.\n+\n+renewCertMin=Renew certificate minimum\n+renewCertMin.desc=Controls the timing between certificate renew requests. A renew request is not allowed until the amount of time set by the renewCertMin elapses.\n+\n+httpConnectTimeout=HTTP Connect Timeout\n+httpConnectTimeout.desc=The HTTP connect timeout for connecting to the Certificate Authority to create accounts or request certificates. A timeout of zero as an infinite timeout.\n+\n+httpReadTimeout=HTTP Read Timeout\n+httpReadTimeout.desc=The HTTP read timeout for reading from the Certificate Authority to create accounts or request certificates. A timeout of zero as an infinite timeout.", "originalCommit": "7748279d6ee4c74e5f806b9acc459c43c31ee8c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEyNDU5Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r451124597", "bodyText": "I am wondering if both of these should be higher? 20 or 30s?", "author": "jvanhill", "createdAt": "2020-07-07T20:29:34Z", "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/metatype/metatype.xml", "diffHunk": "@@ -70,6 +70,8 @@\n    <AD id=\"trustStore\"           name=\"%trustStore\"         description=\"%trustStore.desc\"         required=\"false\" type=\"String\" />\n    <AD id=\"trustStorePassword\"   name=\"%trustStorePassword\" description=\"%trustStorePassword.desc\" required=\"false\" type=\"String\" ibm:type=\"password\" />\n    <AD id=\"trustStoreType\"       name=\"%trustStoreType\"     description=\"%trustStoreType.desc\"     required=\"false\" type=\"String\" />\n+   <AD id=\"httpConnectTimeout\"   name=\"internal\" description=\"internal use only\" type=\"String\"  required=\"false\" ibm:type=\"duration\" default=\"10s\" />", "originalCommit": "7748279d6ee4c74e5f806b9acc459c43c31ee8c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgzMjAyMQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12906#discussion_r451832021", "bodyText": "Set to 30 seconds and made related changes.", "author": "kristip17", "createdAt": "2020-07-08T21:20:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEyNDU5Nw=="}], "type": "inlineReview"}, {"oid": "e21f19984f6154d4247fed79fae54753ce59df4f", "url": "https://github.com/OpenLiberty/open-liberty/commit/e21f19984f6154d4247fed79fae54753ce59df4f", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-07T21:56:37Z", "type": "forcePushed"}, {"oid": "fae15a0e992af71bee7054b212a36c6e2792c9a6", "url": "https://github.com/OpenLiberty/open-liberty/commit/fae15a0e992af71bee7054b212a36c6e2792c9a6", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-08T15:42:16Z", "type": "forcePushed"}, {"oid": "b5114ebbfd8b22ec9ce04bae37e3536fa1ca4180", "url": "https://github.com/OpenLiberty/open-liberty/commit/b5114ebbfd8b22ec9ce04bae37e3536fa1ca4180", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-08T15:47:43Z", "type": "commit"}, {"oid": "b5114ebbfd8b22ec9ce04bae37e3536fa1ca4180", "url": "https://github.com/OpenLiberty/open-liberty/commit/b5114ebbfd8b22ec9ce04bae37e3536fa1ca4180", "message": "Issue 12822: Add custom connect timeouts", "committedDate": "2020-07-08T15:47:43Z", "type": "forcePushed"}]}