{"pr_number": 14820, "pr_title": "Create ServerLRAFilter as a CDI bean.", "pr_createdAt": "2020-11-04T14:33:32Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/14820", "timeline": [{"oid": "3b7784057f8774393cd10ca5b8f699cef594bc47", "url": "https://github.com/OpenLiberty/open-liberty/commit/3b7784057f8774393cd10ca5b8f699cef594bc47", "message": "Add some dummy classes for debug", "committedDate": "2020-11-05T17:15:27Z", "type": "forcePushed"}, {"oid": "8b3a6f5306bcb0689c7648b5ceb54c610c68ab1d", "url": "https://github.com/OpenLiberty/open-liberty/commit/8b3a6f5306bcb0689c7648b5ceb54c610c68ab1d", "message": "Add some dummy classes for debug", "committedDate": "2020-11-06T09:48:36Z", "type": "forcePushed"}, {"oid": "4c56f5c9f8ffa84e5d8f45fc73a9d204f0b06d59", "url": "https://github.com/OpenLiberty/open-liberty/commit/4c56f5c9f8ffa84e5d8f45fc73a9d204f0b06d59", "message": "Create ServerLRAFilter as a CDI bean.\n\nIt should have been like this from the start", "committedDate": "2020-11-03T15:01:14Z", "type": "forcePushed"}, {"oid": "244b5de26e885f4363bba2b9c87e56f3dd72cd25", "url": "https://github.com/OpenLiberty/open-liberty/commit/244b5de26e885f4363bba2b9c87e56f3dd72cd25", "message": "Create ServerLRAFilter as a CDI bean.\n\nIt should have been like this from the start", "committedDate": "2020-11-10T12:25:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU2NDQxNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14820#discussion_r520564416", "bodyText": "delete if not needed", "author": "tevans78", "createdAt": "2020-11-10T13:34:17Z", "path": "dev/io.openliberty.microprofile.lra.1.0.internal/bnd.bnd", "diffHunk": "@@ -45,6 +45,9 @@ Include-Resource: \\\n \tcom.ibm.ws.org.osgi.annotation.versioning;version=latest, \\\n \tcom.ibm.wsspi.org.osgi.service.component.annotations;version=latest, \\\n \tcom.ibm.websphere.javaee.jaxrs.2.1;version=latest, \\\n-\tcom.ibm.ws.jaxrs.2.1.common;version=latest\n+\tcom.ibm.ws.jaxrs.2.1.common;version=latest, \\\n+\tcom.ibm.websphere.javaee.cdi.2.0\n+\t#com.ibm.ws.cdi.interfaces;version=latest, \\", "originalCommit": "244b5de26e885f4363bba2b9c87e56f3dd72cd25", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTIxMA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14820#discussion_r520601210", "bodyText": "will remove", "author": "idlewis", "createdAt": "2020-11-10T14:25:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU2NDQxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU2NTcyMw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14820#discussion_r520565723", "bodyText": "Don't you still need some error handling if the bean can not be found?", "author": "tevans78", "createdAt": "2020-11-10T13:36:09Z", "path": "dev/io.openliberty.microprofile.lra.1.0.internal/src/io/openliberty/microprofile/lra/internal/LraFilterComponent.java", "diffHunk": "@@ -99,14 +101,8 @@ public void installProvider(boolean clientSide, List<Object> providers, Set<Stri\n             if (TraceComponent.isAnyTracingEnabled() && tc.isEventEnabled()) {\n                 Tr.event(tc, \"Registering serverside side filters\");\n             }\n-            try {\n-                // Rather unhelpfully, the ServerLRAFilter constructor throws 'Exception'. There isn't much we can do with\n-                // that. Re-throwing should prevent the servlet being initialized, which is probably better than swallowing\n-                // the exception\n-                providers.add(new ServerLRAFilter());\n-            } catch (Exception e) {\n-                throw new LraRuntimeException(Tr.formatMessage(tc, \"LRA_CANT_REGISTER_FILTERS.CWMRX5001E\", e), e);\n-            }\n+            ServerLRAFilter beanInstance = CDI.current().select(ServerLRAFilter.class).get();\n+            providers.add(beanInstance);", "originalCommit": "244b5de26e885f4363bba2b9c87e56f3dd72cd25", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU2Njk3MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14820#discussion_r520566970", "bodyText": "better to put the copyright above the package statement", "author": "tevans78", "createdAt": "2020-11-10T13:38:01Z", "path": "dev/io.openliberty.org.jboss.narayana.rts/src/io/openliberty/microprofile/lra/internal/CdiExtensionComponent.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package io.openliberty.microprofile.lra.internal;\n+/*******************************************************************************", "originalCommit": "244b5de26e885f4363bba2b9c87e56f3dd72cd25", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTM4Mg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14820#discussion_r520601382", "bodyText": "moved", "author": "idlewis", "createdAt": "2020-11-10T14:25:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU2Njk3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU3MjMwOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14820#discussion_r520572308", "bodyText": "I can't see any bundles which import these packages?? Are these exports actually needed, should the packages be private instead?", "author": "tevans78", "createdAt": "2020-11-10T13:45:33Z", "path": "dev/io.openliberty.org.jboss.narayana.rts/bnd.bnd", "diffHunk": "@@ -22,8 +22,21 @@ Export-Package: \\\n ", "originalCommit": "244b5de26e885f4363bba2b9c87e56f3dd72cd25", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMDcwMQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14820#discussion_r520600701", "bodyText": "They are imported implicitly by the buildpath statement in io.openliberty.microprofile.lra.1.0.internal", "author": "idlewis", "createdAt": "2020-11-10T14:24:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU3MjMwOA=="}], "type": "inlineReview"}, {"oid": "3195afae7fa1b0b6da3d06aef7d0fc8237a7ba84", "url": "https://github.com/OpenLiberty/open-liberty/commit/3195afae7fa1b0b6da3d06aef7d0fc8237a7ba84", "message": "Create ServerLRAFilter as a CDI bean.\n\nIt should have been like this from the start", "committedDate": "2020-11-11T13:39:56Z", "type": "commit"}, {"oid": "3195afae7fa1b0b6da3d06aef7d0fc8237a7ba84", "url": "https://github.com/OpenLiberty/open-liberty/commit/3195afae7fa1b0b6da3d06aef7d0fc8237a7ba84", "message": "Create ServerLRAFilter as a CDI bean.\n\nIt should have been like this from the start", "committedDate": "2020-11-11T13:39:56Z", "type": "forcePushed"}]}