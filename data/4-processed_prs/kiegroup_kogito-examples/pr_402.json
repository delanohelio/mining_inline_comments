{"pr_number": 402, "pr_title": "PLANNER-2142 Make OptaPlanner 8 a part of kogito release pipeline", "pr_createdAt": "2020-10-19T12:27:21Z", "pr_url": "https://github.com/kiegroup/kogito-examples/pull/402", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwNjg2OQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r507706869", "bodyText": "we should delete this before merge IMO", "author": "radtriste", "createdAt": "2020-10-19T12:30:23Z", "path": "Jenkinsfile.deploy", "diffHunk": "@@ -97,7 +98,10 @@ pipeline {\n                         if(params.MAVEN_DEPENDENCIES_REPOSITORY != ''){\n                             sh \"sed -i 's|<repositories>|<repositories><repository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></repository>|g' ${MAVEN_SETTINGS_FILE}\"\n                             sh \"sed -i 's|<pluginRepositories>|<pluginRepositories><pluginRepository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></pluginRepository>|g' ${MAVEN_SETTINGS_FILE}\"\n-                            sh \"sed -i 's|external:\\\\*|external:*,!staging|g' ${MAVEN_SETTINGS_FILE}\" // Done to allow Maven to download release artificats from MAVEN_DEPENDENCIES_REPOSITORY\n+                            sh \"sed -i 's|external:\\\\*|external:*,!staging|g' ${MAVEN_SETTINGS_FILE}\" // Done to allow Maven to download release artifacts from MAVEN_DEPENDENCIES_REPOSITORY\n+\n+                            echo 'Resulting maven settings.xml:'\n+                            sh \"cat ${MAVEN_SETTINGS_FILE}\"", "originalCommit": "b50d245fa6f7a483f8a7e48818b668fb914535ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxNjA3OQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r507716079", "bodyText": "It's easy to it put back. But seeing the content of his file may be handy: I noticed that after rerunning this pipeline (as a stage of the release pipeline), I had the same repository added multiple times. The settings.xml file must have been cached somewhere.", "author": "rsynek", "createdAt": "2020-10-19T12:45:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwNjg2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxODI1Mw==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r507718253", "bodyText": "weird as cleanWs() in post -> always should clean it...", "author": "radtriste", "createdAt": "2020-10-19T12:48:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwNjg2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwODE5Mw==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r507708193", "bodyText": "kogito-runtimes should already be in deployed repository. you should not need them here. they should be downloaded. (staging repository should be promoted to central already)", "author": "radtriste", "createdAt": "2020-10-19T12:32:28Z", "path": "Jenkinsfile.promote", "diffHunk": "@@ -96,9 +97,14 @@ pipeline {\n             }\n             steps {\n                 script {\n+                    dir('kogito-runtimes') { // kogito-examples depend on kogito-bom", "originalCommit": "b50d245fa6f7a483f8a7e48818b668fb914535ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxMjQ2NQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r507712465", "bodyText": "Truth; for testing it doesn't work though - the testing nexus would have to be added to the settings.xml for the next build.\nTODO: remove before merging (for testing purpose only)", "author": "rsynek", "createdAt": "2020-10-19T12:39:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwODE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwNTc1MQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r507905751", "bodyText": "ah now I understand. there is a bug in runtimes which should deploy snapshot artifact after the set next snapshot ... gonna quickly make a fix ;)", "author": "radtriste", "createdAt": "2020-10-19T16:54:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwODE5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwOTUwMg==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r507709502", "bodyText": "maybe we should save to deployment.properties this version if specified", "author": "radtriste", "createdAt": "2020-10-19T12:34:44Z", "path": "Jenkinsfile.deploy", "diffHunk": "@@ -32,6 +32,7 @@ pipeline {\n         // Release information\n         booleanParam(name: 'RELEASE', defaultValue: false, description: 'Is this build for a release?')\n         string(name: 'PROJECT_VERSION', defaultValue: '', description: 'Optional if not RELEASE. If RELEASE, cannot be empty.')\n+        string(name: 'OPTAPLANNER_VERSION', defaultValue: '', description: 'Optional if not RELEASE. If RELEASE, cannot be empty.')", "originalCommit": "b50d245fa6f7a483f8a7e48818b668fb914535ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwOTc4Nw==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r507709787", "bodyText": "what happen if params.OPTAPLANNER_VERSION is empty ?", "author": "radtriste", "createdAt": "2020-10-19T12:35:12Z", "path": "Jenkinsfile.deploy", "diffHunk": "@@ -112,6 +116,7 @@ pipeline {\n                 dir('kogito-examples') {\n                     script {\n                         maven.mvnVersionsSet(getProjectVersion())\n+                        updateOptaPlannerVersion(getOptaPlannerVersion())", "originalCommit": "b50d245fa6f7a483f8a7e48818b668fb914535ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyMDM1NQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r507720355", "bodyText": "I would love to test if the JBoss Nexus was working. I assume when nothing in, then nothing out, but will test it once it's possible.", "author": "rsynek", "createdAt": "2020-10-19T12:51:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwOTc4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM0ODAzMQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r508348031", "bodyText": "The set-property puts there an empty string if the property is not provided. Added assert to the initialize stage to make sure the property is always set in case of a release.", "author": "rsynek", "createdAt": "2020-10-20T09:26:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwOTc4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM1ODc0OQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/402#discussion_r508358749", "bodyText": "I'd rather not have a strong dependency on examples deploy for a release on optaplanner version.\nI would just put an if condition for the update if not empty.\nThis is up to the release (or any calling) pipeline to decide to give the optaplanner version or not.", "author": "radtriste", "createdAt": "2020-10-20T09:42:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwOTc4Nw=="}], "type": "inlineReview"}, {"oid": "7f842904df1b9841508b7c523f2547f4e958835d", "url": "https://github.com/kiegroup/kogito-examples/commit/7f842904df1b9841508b7c523f2547f4e958835d", "message": "Do not build dependencies locally", "committedDate": "2020-10-22T13:48:43Z", "type": "forcePushed"}, {"oid": "d7558dd4d1322cb495774b0278322df8961f9dc7", "url": "https://github.com/kiegroup/kogito-examples/commit/d7558dd4d1322cb495774b0278322df8961f9dc7", "message": "Upgrade optaplanner version in examples", "committedDate": "2020-10-22T19:55:12Z", "type": "commit"}, {"oid": "a8a3df0d91a3edc587f856b0bf550e8f269a708b", "url": "https://github.com/kiegroup/kogito-examples/commit/a8a3df0d91a3edc587f856b0bf550e8f269a708b", "message": "Update version.org.optaplanner on the release branch", "committedDate": "2020-10-22T19:55:12Z", "type": "commit"}, {"oid": "d741159aeec716017d0da5b7aaecef7865114c1a", "url": "https://github.com/kiegroup/kogito-examples/commit/d741159aeec716017d0da5b7aaecef7865114c1a", "message": "Add parameter for optaplanner version", "committedDate": "2020-10-22T19:57:03Z", "type": "commit"}, {"oid": "e98a255bb1fbc6d3e5993515ca4c8f36a88c02ad", "url": "https://github.com/kiegroup/kogito-examples/commit/e98a255bb1fbc6d3e5993515ca4c8f36a88c02ad", "message": "Use versions:set-property", "committedDate": "2020-10-22T19:57:03Z", "type": "commit"}, {"oid": "c87d796c52b46cb9043dc61aa2458b8eca373299", "url": "https://github.com/kiegroup/kogito-examples/commit/c87d796c52b46cb9043dc61aa2458b8eca373299", "message": "Build kogito-runtime BOMs", "committedDate": "2020-10-22T19:57:03Z", "type": "commit"}, {"oid": "1b61415937b82047252b9f8df06661ae6560c0ac", "url": "https://github.com/kiegroup/kogito-examples/commit/1b61415937b82047252b9f8df06661ae6560c0ac", "message": "Checkout kogito-runtimes to the right directory", "committedDate": "2020-10-22T19:57:03Z", "type": "commit"}, {"oid": "b06111047edca17e6c4d479a67249b0d3da5be2d", "url": "https://github.com/kiegroup/kogito-examples/commit/b06111047edca17e6c4d479a67249b0d3da5be2d", "message": "Fix OptaPlanner version change", "committedDate": "2020-10-22T19:57:03Z", "type": "commit"}, {"oid": "c277433bc5a6b8dd71d7370cdbed0b2b6fb39cc2", "url": "https://github.com/kiegroup/kogito-examples/commit/c277433bc5a6b8dd71d7370cdbed0b2b6fb39cc2", "message": "Address review comments", "committedDate": "2020-10-22T19:57:59Z", "type": "commit"}, {"oid": "82264901e1658bcd35eced51ad95b14f8f8adefc", "url": "https://github.com/kiegroup/kogito-examples/commit/82264901e1658bcd35eced51ad95b14f8f8adefc", "message": "Make sure optaplanner version is not empty", "committedDate": "2020-10-22T19:57:59Z", "type": "commit"}, {"oid": "3909da9030d8c0f9ba5f00af1d23f7c50c3cb050", "url": "https://github.com/kiegroup/kogito-examples/commit/3909da9030d8c0f9ba5f00af1d23f7c50c3cb050", "message": "Install new OptaPlanner artifacts", "committedDate": "2020-10-22T19:57:59Z", "type": "commit"}, {"oid": "ef8dd7d473181dd39f94a7d225d5e2b29259146c", "url": "https://github.com/kiegroup/kogito-examples/commit/ef8dd7d473181dd39f94a7d225d5e2b29259146c", "message": "Do not build dependencies locally", "committedDate": "2020-10-22T19:57:59Z", "type": "commit"}, {"oid": "ef8dd7d473181dd39f94a7d225d5e2b29259146c", "url": "https://github.com/kiegroup/kogito-examples/commit/ef8dd7d473181dd39f94a7d225d5e2b29259146c", "message": "Do not build dependencies locally", "committedDate": "2020-10-22T19:57:59Z", "type": "forcePushed"}]}