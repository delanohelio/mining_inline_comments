{"pr_number": 361, "pr_title": "KOGITO-3217 - trusty demonstration project", "pr_createdAt": "2020-09-15T09:14:06Z", "pr_url": "https://github.com/kiegroup/kogito-examples/pull/361", "timeline": [{"oid": "d47c948fcd060ddda95b7c4440b79498b58f1a17", "url": "https://github.com/kiegroup/kogito-examples/commit/d47c948fcd060ddda95b7c4440b79498b58f1a17", "message": "dmn-tracing-quarkus uber jar, add trusty demontration project", "committedDate": "2020-09-15T09:10:40Z", "type": "commit"}, {"oid": "c753678ac502db8c1aa792b8e232aa69024bb132", "url": "https://github.com/kiegroup/kogito-examples/commit/c753678ac502db8c1aa792b8e232aa69024bb132", "message": "add requirements", "committedDate": "2020-09-15T09:31:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg5NjgxMw==", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488896813", "bodyText": "What about add this COPY layer too?\nhttps://github.com/kiegroup/kogito-examples/blob/stable/dmn-drools-quarkus-metrics/Dockerfile#L25\nIt should make uberJar flag optional", "author": "danielezonca", "createdAt": "2020-09-15T18:57:53Z", "path": "dmn-tracing-quarkus/Dockerfile", "diffHunk": "@@ -0,0 +1,3 @@\n+FROM quay.io/kiegroup/kogito-quarkus-jvm-ubi8:latest\n+\n+COPY target/*-runner.jar $KOGITO_HOME/bin    ", "originalCommit": "c753678ac502db8c1aa792b8e232aa69024bb132", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU0MTk1Mg==", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r489541952", "bodyText": "Yeah, my env was broken and I thought that only uber jar was working. Fixed", "author": "r00ta", "createdAt": "2020-09-16T15:47:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg5NjgxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg5NzA1Mg==", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488897052", "bodyText": "See comment above", "author": "danielezonca", "createdAt": "2020-09-15T18:58:08Z", "path": "dmn-tracing-quarkus/pom.xml", "diffHunk": "@@ -76,9 +76,12 @@\n   <build>\n     <finalName>${project.artifactId}</finalName>\n     <plugins>\n-      <plugin>\n+     <plugin>\n         <groupId>io.quarkus</groupId>\n         <artifactId>quarkus-maven-plugin</artifactId>\n+        <configuration>\n+          <uberJar>true</uberJar>", "originalCommit": "c753678ac502db8c1aa792b8e232aa69024bb132", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg5Nzc1Ng==", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488897756", "bodyText": "Awesome? xD", "author": "danielezonca", "createdAt": "2020-09-15T18:58:48Z", "path": "trusty-demonstration/README.md", "diffHunk": "@@ -0,0 +1,212 @@\n+# Awesome Trusty", "originalCommit": "c753678ac502db8c1aa792b8e232aa69024bb132", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwMDM5MA==", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488900390", "bodyText": "Please change hardcoded version with a placeholder and refer to https://kogito.kie.org or similar to get the latest version.", "author": "danielezonca", "createdAt": "2020-09-15T19:03:15Z", "path": "trusty-demonstration/README.md", "diffHunk": "@@ -0,0 +1,212 @@\n+# Awesome Trusty\n+\n+This is a demonstration of the trusty AI tracing capabilities. \n+\n+## Requirements\n+\n+- docker version > 19.03.12\n+- minikube version  > 1.11.0\n+- java version > 1.9\n+- maven version > 3.6.3\n+- kubernetes version > 1.18\n+\n+Note: also previous versions of `docker`, `minikube` and `kubernetes`  might work, but they were not tested. \n+\n+## Build your kogito runtime application\n+\n+In this example, we will use the `dmn-tracing-quarkus` application that you can find in the root of this repository. This kogito application is using the `tracing-addon` so to export the tracing information that will be used by the trusty and explainability services for further analysis.\n+\n+Navigate under the folder `kogito-examples/dmn-tracing-quarkus` and run \n+```bash\n+mvn clean package -DskipTests\n+```\n+\n+Now you need to have an account on a remote hub like `quay` or `dockerhub` for example. Assuming that you have an account on `quay` and you are using `docker`, build the image with \n+```bash\n+docker build --tag quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0 .\n+```\n+replacing the string `<your_namespace>` with your namespace (i.e. your username).\n+\n+Push the image\n+```bash\n+docker push quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0\n+```\n+\n+## Deploy the infrastructure with minishift/kubernetes\n+\n+Navigate back to the current directory where this `README.md` file is stored. \n+\n+The first step is to start your `minikube` cluster: \n+\n+```bash\n+minikube start\n+minikube addons enable ingress\n+minikube addons enable olm\n+```\n+\n+and then download/unpack the kogito operator\n+\n+```bash\n+wget https://github.com/kiegroup/kogito-cloud-operator/releases/download/v0.15.0/kogito-cli-0.15.0-linux-amd64.tar.gz\n+tar zxf kogito-cli-0.14.0-linux-amd64.tar.gz", "originalCommit": "c753678ac502db8c1aa792b8e232aa69024bb132", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU0MjI0Mw==", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r489542243", "bodyText": "Changed so that the user can set the KOGITO_VERSION to be used", "author": "r00ta", "createdAt": "2020-09-16T15:47:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwMDM5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwMDk4NQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488900985", "bodyText": "Replace 0.17.0 hardcoded version", "author": "danielezonca", "createdAt": "2020-09-15T19:04:22Z", "path": "trusty-demonstration/README.md", "diffHunk": "@@ -0,0 +1,212 @@\n+# Awesome Trusty\n+\n+This is a demonstration of the trusty AI tracing capabilities. \n+\n+## Requirements\n+\n+- docker version > 19.03.12\n+- minikube version  > 1.11.0\n+- java version > 1.9\n+- maven version > 3.6.3\n+- kubernetes version > 1.18\n+\n+Note: also previous versions of `docker`, `minikube` and `kubernetes`  might work, but they were not tested. \n+\n+## Build your kogito runtime application\n+\n+In this example, we will use the `dmn-tracing-quarkus` application that you can find in the root of this repository. This kogito application is using the `tracing-addon` so to export the tracing information that will be used by the trusty and explainability services for further analysis.\n+\n+Navigate under the folder `kogito-examples/dmn-tracing-quarkus` and run \n+```bash\n+mvn clean package -DskipTests\n+```\n+\n+Now you need to have an account on a remote hub like `quay` or `dockerhub` for example. Assuming that you have an account on `quay` and you are using `docker`, build the image with \n+```bash\n+docker build --tag quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0 .\n+```\n+replacing the string `<your_namespace>` with your namespace (i.e. your username).\n+\n+Push the image\n+```bash\n+docker push quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0\n+```\n+\n+## Deploy the infrastructure with minishift/kubernetes\n+\n+Navigate back to the current directory where this `README.md` file is stored. \n+\n+The first step is to start your `minikube` cluster: \n+\n+```bash\n+minikube start\n+minikube addons enable ingress\n+minikube addons enable olm\n+```\n+\n+and then download/unpack the kogito operator\n+\n+```bash\n+wget https://github.com/kiegroup/kogito-cloud-operator/releases/download/v0.15.0/kogito-cli-0.15.0-linux-amd64.tar.gz\n+tar zxf kogito-cli-0.14.0-linux-amd64.tar.gz\n+```\n+\n+Create a new project called (for example) `trusty-demo` \n+\n+```bash \n+PROJECT_NAME=trusty-demo\n+kubectl create namespace \"$PROJECT_NAME\"\n+```\n+\n+Deploy the kogito operator\n+```bash\n+./kogito use-project \"$PROJECT_NAME\"\n+```\n+\n+You should see that the `kogito-operator` has one pod running within some minutes: the command `kubectl get pods -n \"trusty-demo\"` should return something like \n+\n+```bash\n+NAME                             READY   STATUS    RESTARTS   AGE\n+kogito-operator-9f575f64-zp56t   1/1     Running   0          98s\n+```\n+\n+Install the `kafka` and the `infinispan` operators with \n+\n+```bash\n+TARGET_DIR=\".\"\n+STRIMZI_VERSION=0.17.0\n+INFINISPAN_VERSION=1.1.1.Final\n+\n+echo \"Installing Infinispan Operator\"\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/crd.yaml\" -n ${PROJECT_NAME}\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/rbac.yaml\" -n ${PROJECT_NAME}\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/operator.yaml\" -n ${PROJECT_NAME}\n+\n+wget \"https://github.com/strimzi/strimzi-kafka-operator/releases/download/${STRIMZI_VERSION}/strimzi-${STRIMZI_VERSION}.tar.gz\" -P \"$TARGET_DIR/\"\n+tar zxf \"${TARGET_DIR}/strimzi-${STRIMZI_VERSION}.tar.gz\" -C \"$TARGET_DIR\"\n+find strimzi-0.17.0/install/cluster-operator -name '*RoleBinding*.yaml' -type f -exec sed -i \"s/namespace: .*/namespace: ${PROJECT_NAME}/\" {} \\;", "originalCommit": "c753678ac502db8c1aa792b8e232aa69024bb132", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwNTkxOA==", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488905918", "bodyText": "Which IP? My local env IP? Why don't suggest localhost if user is going to run everything locally specifying to change it if needed?\nAre both envs variables equivalent? Is it possible to have them differently?", "author": "danielezonca", "createdAt": "2020-09-15T19:13:27Z", "path": "trusty-demonstration/README.md", "diffHunk": "@@ -0,0 +1,212 @@\n+# Awesome Trusty\n+\n+This is a demonstration of the trusty AI tracing capabilities. \n+\n+## Requirements\n+\n+- docker version > 19.03.12\n+- minikube version  > 1.11.0\n+- java version > 1.9\n+- maven version > 3.6.3\n+- kubernetes version > 1.18\n+\n+Note: also previous versions of `docker`, `minikube` and `kubernetes`  might work, but they were not tested. \n+\n+## Build your kogito runtime application\n+\n+In this example, we will use the `dmn-tracing-quarkus` application that you can find in the root of this repository. This kogito application is using the `tracing-addon` so to export the tracing information that will be used by the trusty and explainability services for further analysis.\n+\n+Navigate under the folder `kogito-examples/dmn-tracing-quarkus` and run \n+```bash\n+mvn clean package -DskipTests\n+```\n+\n+Now you need to have an account on a remote hub like `quay` or `dockerhub` for example. Assuming that you have an account on `quay` and you are using `docker`, build the image with \n+```bash\n+docker build --tag quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0 .\n+```\n+replacing the string `<your_namespace>` with your namespace (i.e. your username).\n+\n+Push the image\n+```bash\n+docker push quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0\n+```\n+\n+## Deploy the infrastructure with minishift/kubernetes\n+\n+Navigate back to the current directory where this `README.md` file is stored. \n+\n+The first step is to start your `minikube` cluster: \n+\n+```bash\n+minikube start\n+minikube addons enable ingress\n+minikube addons enable olm\n+```\n+\n+and then download/unpack the kogito operator\n+\n+```bash\n+wget https://github.com/kiegroup/kogito-cloud-operator/releases/download/v0.15.0/kogito-cli-0.15.0-linux-amd64.tar.gz\n+tar zxf kogito-cli-0.14.0-linux-amd64.tar.gz\n+```\n+\n+Create a new project called (for example) `trusty-demo` \n+\n+```bash \n+PROJECT_NAME=trusty-demo\n+kubectl create namespace \"$PROJECT_NAME\"\n+```\n+\n+Deploy the kogito operator\n+```bash\n+./kogito use-project \"$PROJECT_NAME\"\n+```\n+\n+You should see that the `kogito-operator` has one pod running within some minutes: the command `kubectl get pods -n \"trusty-demo\"` should return something like \n+\n+```bash\n+NAME                             READY   STATUS    RESTARTS   AGE\n+kogito-operator-9f575f64-zp56t   1/1     Running   0          98s\n+```\n+\n+Install the `kafka` and the `infinispan` operators with \n+\n+```bash\n+TARGET_DIR=\".\"\n+STRIMZI_VERSION=0.17.0\n+INFINISPAN_VERSION=1.1.1.Final\n+\n+echo \"Installing Infinispan Operator\"\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/crd.yaml\" -n ${PROJECT_NAME}\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/rbac.yaml\" -n ${PROJECT_NAME}\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/operator.yaml\" -n ${PROJECT_NAME}\n+\n+wget \"https://github.com/strimzi/strimzi-kafka-operator/releases/download/${STRIMZI_VERSION}/strimzi-${STRIMZI_VERSION}.tar.gz\" -P \"$TARGET_DIR/\"\n+tar zxf \"${TARGET_DIR}/strimzi-${STRIMZI_VERSION}.tar.gz\" -C \"$TARGET_DIR\"\n+find strimzi-0.17.0/install/cluster-operator -name '*RoleBinding*.yaml' -type f -exec sed -i \"s/namespace: .*/namespace: ${PROJECT_NAME}/\" {} \\;\n+kubectl apply -f strimzi-${STRIMZI_VERSION}/install/cluster-operator/ -n ${PROJECT_NAME}\n+```\n+\n+Deploy a kafka instance and wait for it\n+```bash\n+kubectl apply -f resources/kafka.yaml -n ${PROJECT_NAME}\n+kubectl wait kafka/my-cluster --for=condition=Ready --timeout=300s -n ${PROJECT_NAME} \n+```\n+\n+Create the kafka topics\n+```bash\n+kubectl apply -f resources/kafka-topics.yaml -n ${PROJECT_NAME}\n+```\n+\n+and the infinispan resource\n+```bash\n+kubectl apply -f resources/infinispan-minimal.yaml -n ${PROJECT_NAME}\n+```\n+\n+Now extract the infinispan secrets with \n+```bash\n+kubectl get secret example-infinispan-generated-secret -o jsonpath=\"{.data.identities\\.yaml}\" -n ${PROJECT_NAME} | base64 --decode\n+```\n+\n+Take the `operator` name and password and calculate the `base64` encoding, and replace the keys `user` and `pass` in `resources/trusty-secrets.yaml` with the encoding. For example, if `operator` is the username and `mysecretpassword` is the password, then \n+```bash\n+$ printf \"operator\" | base64\n+b3BlcmF0b3I=\n+printf \"mysecretpassword\" | base64\n+bXlzZWNyZXRwYXNzd29yZA==\n+```\n+\n+and the content of `resources/trusty-secrets.yaml` should look like the following\n+```yaml\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  name: kogito-external-infinispan-secret\n+type: Opaque\n+data:\n+  user: b3BlcmF0b3I= \n+  pass: bXlzZWNyZXRwYXNzd29yZA==\n+```\n+\n+Deploy the secret with \n+\n+```bash\n+kubectl apply -f resources/trusty-secrets.yaml -n ${PROJECT_NAME}\n+```\n+\n+Get the ip address of the cluster with \n+```bash\n+minikube ip\n+```\n+\n+and replace the env variables `KOGITO_TRUSTY_ENDPOINT` and `KOGITO_TRUSTY_WS_URL` in the file `resources/trusty-ui.yaml`. For example, if the ip is `172.17.0.2`, then the content of the file should be ", "originalCommit": "c753678ac502db8c1aa792b8e232aa69024bb132", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIyNTQ4Mw==", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r489225483", "bodyText": "Hi @danielezonca , the cluster ip is never localhost, that's why we need to get the ip with minikube ip and then change accordingly the configuration in the trusty-ui.\nKOGITO_TRUSTY_ENDPOINT and KOGITO_TRUSTY_WS_URL contains the same ip but the prefix (\"http\" and \"ws\") is different, so that's why the user has to set both of them.", "author": "r00ta", "createdAt": "2020-09-16T07:34:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwNTkxOA=="}], "type": "inlineReview"}, {"oid": "7fe6c52240ed25f40bcd3493aef631727c3c49e9", "url": "https://github.com/kiegroup/kogito-examples/commit/7fe6c52240ed25f40bcd3493aef631727c3c49e9", "message": "fix comments", "committedDate": "2020-09-16T15:46:10Z", "type": "commit"}, {"oid": "cf8273fdc6ef4d9430195de261cd8f0f8610d958", "url": "https://github.com/kiegroup/kogito-examples/commit/cf8273fdc6ef4d9430195de261cd8f0f8610d958", "message": "update images", "committedDate": "2020-09-18T14:00:48Z", "type": "commit"}, {"oid": "a01cce57ea8f66ca3df490c9dce6b8cb0a101a6a", "url": "https://github.com/kiegroup/kogito-examples/commit/a01cce57ea8f66ca3df490c9dce6b8cb0a101a6a", "message": "add images", "committedDate": "2020-09-18T14:22:38Z", "type": "commit"}]}