{"pr_number": 487, "pr_title": "KOGITO-3994 Use Qute templating to handle Data Index config", "pr_createdAt": "2020-12-14T15:36:43Z", "pr_url": "https://github.com/kiegroup/kogito-examples/pull/487", "timeline": [{"oid": "7fe830e3353905857fc745e722f8663570483691", "url": "https://github.com/kiegroup/kogito-examples/commit/7fe830e3353905857fc745e722f8663570483691", "message": "KOGITO-3994 Use Qute templating to handle Data Index config", "committedDate": "2020-12-14T15:37:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMDQ0MQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543130441", "bodyText": "maybe rename to indexTpl", "author": "radtriste", "createdAt": "2020-12-15T08:11:16Z", "path": "kogito-travel-agency/extended/travels/src/main/java/org/kie/kogito/app/VertxRouter.java", "diffHunk": "@@ -15,57 +15,29 @@\n  */\n package org.kie.kogito.app;\n \n-import java.net.URL;\n-\n-import javax.annotation.PostConstruct;\n import javax.enterprise.context.ApplicationScoped;\n import javax.enterprise.event.Observes;\n import javax.inject.Inject;\n \n-import io.vertx.core.Vertx;\n-import io.vertx.core.buffer.Buffer;\n+import io.quarkus.qute.Template;\n import io.vertx.ext.web.Router;\n import io.vertx.ext.web.handler.FaviconHandler;\n import io.vertx.ext.web.handler.LoggerHandler;\n import io.vertx.ext.web.handler.StaticHandler;\n-import org.eclipse.microprofile.config.inject.ConfigProperty;\n \n import static io.vertx.core.http.HttpMethod.GET;\n-import static java.nio.charset.StandardCharsets.UTF_8;\n \n @ApplicationScoped\n public class VertxRouter {\n \n     @Inject\n-    @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\")\n-    String dataIndexHttpURL;\n-\n-    @Inject\n-    @ConfigProperty(name = \"kogito.dataindex.ws.url\", defaultValue = \"ws://localhost:8180\")\n-    String dataIndexWsURL;\n-\n-    @Inject\n-    Vertx vertx;\n-\n-    private Buffer resource;\n-\n-    @PostConstruct\n-    public void init() {\n-        try {\n-            resource = Buffer.buffer(vertx.fileSystem()\n-                                             .readFileBlocking(\"META-INF/resources/index.html\")\n-                                             .toString(UTF_8)\n-                                             .replace(\"__GRAPHQL_HTTP_ENDPOINT__\", \"\\\"\" + dataIndexHttpURL + \"/graphql\\\"\")\n-                                             .replace(\"__GRAPHQL_WS_ENDPOINT__\", \"\\\"\" + dataIndexWsURL + \"/graphql\\\"\"));\n-        } catch (Exception e) {\n-            throw new RuntimeException(e);\n-        }\n-    }\n+    Template index;", "originalCommit": "7fe830e3353905857fc745e722f8663570483691", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI2NDAzNA==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543264034", "bodyText": "this matches with the file name that gets injected, so not sure, wdyt?", "author": "cristianonicolai", "createdAt": "2020-12-15T11:28:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMDQ0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI2NTI2Mw==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543265263", "bodyText": "To know it is a template and not the index page rendered", "author": "radtriste", "createdAt": "2020-12-15T11:30:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMDQ0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3OTc0Ng==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543279746", "bodyText": "done", "author": "cristianonicolai", "createdAt": "2020-12-15T11:53:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMDQ0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMDY1Nw==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543130657", "bodyText": "maybe rename template -> indexPage", "author": "radtriste", "createdAt": "2020-12-15T08:11:35Z", "path": "kogito-travel-agency/extended/travels/src/main/java/org/kie/kogito/app/VertxRouter.java", "diffHunk": "@@ -15,57 +15,29 @@\n  */\n package org.kie.kogito.app;\n \n-import java.net.URL;\n-\n-import javax.annotation.PostConstruct;\n import javax.enterprise.context.ApplicationScoped;\n import javax.enterprise.event.Observes;\n import javax.inject.Inject;\n \n-import io.vertx.core.Vertx;\n-import io.vertx.core.buffer.Buffer;\n+import io.quarkus.qute.Template;\n import io.vertx.ext.web.Router;\n import io.vertx.ext.web.handler.FaviconHandler;\n import io.vertx.ext.web.handler.LoggerHandler;\n import io.vertx.ext.web.handler.StaticHandler;\n-import org.eclipse.microprofile.config.inject.ConfigProperty;\n \n import static io.vertx.core.http.HttpMethod.GET;\n-import static java.nio.charset.StandardCharsets.UTF_8;\n \n @ApplicationScoped\n public class VertxRouter {\n \n     @Inject\n-    @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\")\n-    String dataIndexHttpURL;\n-\n-    @Inject\n-    @ConfigProperty(name = \"kogito.dataindex.ws.url\", defaultValue = \"ws://localhost:8180\")\n-    String dataIndexWsURL;\n-\n-    @Inject\n-    Vertx vertx;\n-\n-    private Buffer resource;\n-\n-    @PostConstruct\n-    public void init() {\n-        try {\n-            resource = Buffer.buffer(vertx.fileSystem()\n-                                             .readFileBlocking(\"META-INF/resources/index.html\")\n-                                             .toString(UTF_8)\n-                                             .replace(\"__GRAPHQL_HTTP_ENDPOINT__\", \"\\\"\" + dataIndexHttpURL + \"/graphql\\\"\")\n-                                             .replace(\"__GRAPHQL_WS_ENDPOINT__\", \"\\\"\" + dataIndexWsURL + \"/graphql\\\"\"));\n-        } catch (Exception e) {\n-            throw new RuntimeException(e);\n-        }\n-    }\n+    Template index;\n \n     void setupRouter(@Observes Router router) {\n         router.route().handler(LoggerHandler.create());\n         router.route().handler(FaviconHandler.create());\n         router.route().handler(StaticHandler.create());\n-        router.route(GET, \"/\").handler(ctx -> ctx.response().end(resource));\n+        String template = index.render();", "originalCommit": "7fe830e3353905857fc745e722f8663570483691", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3OTgwOA==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543279808", "bodyText": "done", "author": "cristianonicolai", "createdAt": "2020-12-15T11:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzMDY1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE5MTAwNQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543191005", "bodyText": "Nitpicking too.. but could we have graphql as const?", "author": "pefernan", "createdAt": "2020-12-15T09:41:18Z", "path": "kogito-travel-agency/extended/travels/src/main/resources/templates/index.html", "diffHunk": "@@ -55,7 +71,7 @@ <h1>Travels</h1>\n </div>\n </div>\n <script>\n-    var graphql = __GRAPHQL_HTTP_ENDPOINT__;\n+    var graphql = '{config:property('kogito.dataindex.http.url') or 'http://localhost:8180'}/graphql';", "originalCommit": "7fe830e3353905857fc745e722f8663570483691", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3OTg3OQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543279879", "bodyText": "done", "author": "cristianonicolai", "createdAt": "2020-12-15T11:53:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE5MTAwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE5MTI2MA==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543191260", "bodyText": "Same", "author": "pefernan", "createdAt": "2020-12-15T09:41:39Z", "path": "kogito-travel-agency/extended/visas/src/main/resources/templates/index.html", "diffHunk": "@@ -48,7 +64,7 @@ <h1>Visa applications</h1>\n </div>\n </div>\n <script>\n-    var graphql = __GRAPHQL_HTTP_ENDPOINT__;\n+    var graphql = '{config:property('kogito.dataindex.http.url') or 'http://localhost:8180'}/graphql';", "originalCommit": "7fe830e3353905857fc745e722f8663570483691", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3OTk3OA==", "url": "https://github.com/kiegroup/kogito-examples/pull/487#discussion_r543279978", "bodyText": "done", "author": "cristianonicolai", "createdAt": "2020-12-15T11:53:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE5MTI2MA=="}], "type": "inlineReview"}, {"oid": "35422faa9156fbb5ccb737652f8c7170b12a42ef", "url": "https://github.com/kiegroup/kogito-examples/commit/35422faa9156fbb5ccb737652f8c7170b12a42ef", "message": "KOGITO-3994 Use Qute templating to handle Data Index config", "committedDate": "2020-12-15T11:38:18Z", "type": "forcePushed"}, {"oid": "df61ce1e9ae1f51b74378da7d89f5f0482ccb134", "url": "https://github.com/kiegroup/kogito-examples/commit/df61ce1e9ae1f51b74378da7d89f5f0482ccb134", "message": "KOGITO-3994 Use Qute templating to handle Data Index config", "committedDate": "2020-12-15T11:52:24Z", "type": "forcePushed"}, {"oid": "10f79e059c8189729cbfddcd2eea81090deaab04", "url": "https://github.com/kiegroup/kogito-examples/commit/10f79e059c8189729cbfddcd2eea81090deaab04", "message": "KOGITO-3994 Use Qute templating to handle Data Index config", "committedDate": "2020-12-15T14:24:40Z", "type": "commit"}, {"oid": "10f79e059c8189729cbfddcd2eea81090deaab04", "url": "https://github.com/kiegroup/kogito-examples/commit/10f79e059c8189729cbfddcd2eea81090deaab04", "message": "KOGITO-3994 Use Qute templating to handle Data Index config", "committedDate": "2020-12-15T14:24:40Z", "type": "forcePushed"}]}