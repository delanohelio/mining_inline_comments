{"pr_number": 216, "pr_title": "KOGITO-1829: BDD tests: Test that Spring boot cloud events are correc\u2026", "pr_createdAt": "2020-04-14T14:23:45Z", "pr_url": "https://github.com/kiegroup/kogito-examples/pull/216", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwMTUyNA==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408201524", "bodyText": "shouldn't this be provided by the kogito-events-spring-boot-addon ?", "author": "jstastny-cz", "createdAt": "2020-04-14T14:54:14Z", "path": "process-springboot-example/pom.xml", "diffHunk": "@@ -48,6 +50,10 @@\n       <groupId>org.kie.kogito</groupId>\n       <artifactId>process-management-addon</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.springframework.kafka</groupId>", "originalCommit": "ffc5bf1818d0cc061c03dac37accb0babdcd3ad7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxMTMyNQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408211325", "bodyText": "Indeed, the kafka dependency is provided by kogito-events-spring-boot-addon dependency. However, as we have several profiles (default, persistence and events) and for spring-boot I needed the KafkaConsumerConfig.java to make this example worked, I did need the kafka dependency to be added in all the profiles.\nStill, it would only do something in the \"events\" profile because the \"kogito-events-spring-boot-addon\" dependency is added, which is the glue between Kogito and Kafka.\nIn order to avoid possible drawbacks, I added the @ConditionalOnProperty in the KafkaConsumerConfig.java. This property is only provided when we deploy the example using the events profile.\nHowever, let me know your thoughts and/or you think any other approach.", "author": "Sgitario", "createdAt": "2020-04-14T15:06:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwMTUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIyMTc4Ng==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408221786", "bodyText": "This should be put as <optional>true<optional> and will be brought by kogito-events-spring-boot-addon on events profile, cool thing with Spring Boot :)\nAlso your @ConditionalOnProperty will always be true as the kafka.bootstrap.servers is set in the application.properties file.\nYou should do a @ConditionalOnClass and test for example that org.apache.kafka.clients.producer.ProducerConfig is present", "author": "radtriste", "createdAt": "2020-04-14T15:19:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwMTUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIzNTAwMA==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408235000", "bodyText": "Will do the optional thing.\nAbout the property, the configuration file is not set when deploying, hence the property won't exist.\nHowever, the ConfitionalOnClass will work too with the optional bit. Will change both things.", "author": "Sgitario", "createdAt": "2020-04-14T15:36:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwMTUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU5NzU2NQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408597565", "bodyText": "Changed", "author": "Sgitario", "createdAt": "2020-04-15T05:56:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwMTUyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxNjMzMQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408216331", "bodyText": "I think it should be KafkaProducerConfig", "author": "sutaakar", "createdAt": "2020-04-14T15:12:29Z", "path": "process-springboot-example/src/main/java/org/kie/kogito/examples/KafkaConsumerConfig.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package org.kie.kogito.examples;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.apache.kafka.clients.producer.ProducerConfig;\n+import org.apache.kafka.common.serialization.StringSerializer;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.kafka.annotation.EnableKafka;\n+import org.springframework.kafka.core.DefaultKafkaProducerFactory;\n+import org.springframework.kafka.core.KafkaTemplate;\n+import org.springframework.kafka.core.ProducerFactory;\n+import org.springframework.kafka.support.serializer.JsonSerializer;\n+\n+@EnableKafka\n+@Configuration\n+@ConditionalOnProperty(\"kafka.bootstrap.servers\")\n+public class KafkaConsumerConfig {", "originalCommit": "ffc5bf1818d0cc061c03dac37accb0babdcd3ad7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIzMzA0OA==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408233048", "bodyText": "Well spotted. Will rename it.", "author": "Sgitario", "createdAt": "2020-04-14T15:34:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxNjMzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIzMjM5NQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408232395", "bodyText": "as in kogito-kafka-quickstart-* examples, we should tell the user on which topic to listen for cloud events:\n\nkogito-processinstances-events\nkogito-usertaskinstances-events", "author": "radtriste", "createdAt": "2020-04-14T15:33:23Z", "path": "process-quarkus-example/README.md", "diffHunk": "@@ -76,6 +76,12 @@ Once Infinispan is up and running you can build this project with `-Ppersistence\n \n This extra profile in maven configuration adds additional dependencies needed to work with Infinispan as persistent store.\n \n+### Running with events enabled", "originalCommit": "ffc5bf1818d0cc061c03dac37accb0babdcd3ad7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU5NzQzNg==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408597436", "bodyText": "Added", "author": "Sgitario", "createdAt": "2020-04-15T05:55:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIzMjM5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIzMjY0OQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408232649", "bodyText": "same here on listening to cloud events topics", "author": "radtriste", "createdAt": "2020-04-14T15:33:42Z", "path": "process-springboot-example/README.md", "diffHunk": "@@ -56,6 +56,16 @@ Once Infinispan is up and running you can build this project with `-Ppersistence\n \n This extra profile in maven configuration adds additional dependencies needed to work with Infinispan as persistent store.\n \n+### Running with events enabled\n+\n+Kogito supports cloud events using Kafka as message broker. So to be able to enable this you need to have\n+Kafka cluster installed and available over the network. Refer to [Kafka Apache site](https://kafka.apache.org/quickstart) to more information about how to install. By default it expects it to be at (it can be configured via application.properties file located in src/main/resources):\n+\n+```\n+kafka.bootstrap.servers=localhost:9092\n+```\n+\n+Once Kafka is up and running you can build this project with `-Pevents` to enable additional processing during the build. This extra profile in maven configuration adds additional dependencies needed to work with Cloud Events.", "originalCommit": "ffc5bf1818d0cc061c03dac37accb0babdcd3ad7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU5NzQ2MA==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408597460", "bodyText": "Added", "author": "Sgitario", "createdAt": "2020-04-15T05:56:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIzMjY0OQ=="}], "type": "inlineReview"}, {"oid": "c4f6216ee69216b077e7cd72ed36a942be08e8f0", "url": "https://github.com/kiegroup/kogito-examples/commit/c4f6216ee69216b077e7cd72ed36a942be08e8f0", "message": "KOGITO-1829: BDD tests: Test that Spring boot cloud events are correctly received on data-index", "committedDate": "2020-04-15T05:59:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYyMzc3NQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408623775", "bodyText": "we need also to define the different queues in there, else nothing will be sent if we use the events profile", "author": "radtriste", "createdAt": "2020-04-15T07:05:05Z", "path": "process-springboot-example/src/main/resources/application.properties", "diffHunk": "@@ -2,4 +2,6 @@ spring.mvc.servlet.path=/docs\n \n resteasy.jaxrs.scan-packages=org.kie.kogito.**\n \n-infinispan.remote.server-list=127.0.0.1:11222\n\\ No newline at end of file\n+infinispan.remote.server-list=127.0.0.1:11222\n+\n+kafka.bootstrap.servers=127.0.0.1:9092", "originalCommit": "c4f6216ee69216b077e7cd72ed36a942be08e8f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzODg3Mw==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408638873", "bodyText": "solved. Spring Boot does not need extra config. Topics are configured in code ...\nhttps://github.com/kiegroup/kogito-runtimes/blob/master/addons/events/kogito-events-spring-boot-addon/src/main/java/org/kie/kogito/events/spring/KafkaEventPublisher.java", "author": "radtriste", "createdAt": "2020-04-15T07:34:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYyMzc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzOTkxMg==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r408639912", "bodyText": "As discussed in private, this is not necessary in spring.", "author": "Sgitario", "createdAt": "2020-04-15T07:36:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYyMzc3NQ=="}], "type": "inlineReview"}, {"oid": "de8010ce8440cd22688cd396e225a52077a6676c", "url": "https://github.com/kiegroup/kogito-examples/commit/de8010ce8440cd22688cd396e225a52077a6676c", "message": "KOGITO-1829: BDD tests: Test that Spring boot cloud events are correctly received on data-index", "committedDate": "2020-04-17T12:48:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM2OTk1OQ==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r411369959", "bodyText": "add copywrite please", "author": "cristianonicolai", "createdAt": "2020-04-20T13:19:05Z", "path": "process-springboot-example/src/main/java/org/kie/kogito/examples/KafkaProducerConfig.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package org.kie.kogito.examples;", "originalCommit": "de8010ce8440cd22688cd396e225a52077a6676c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM3NDA4Ng==", "url": "https://github.com/kiegroup/kogito-examples/pull/216#discussion_r411374086", "bodyText": "added", "author": "Sgitario", "createdAt": "2020-04-20T13:24:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM2OTk1OQ=="}], "type": "inlineReview"}, {"oid": "bd7e448cd7e8cd6dee5864f7fc43afebaaab055f", "url": "https://github.com/kiegroup/kogito-examples/commit/bd7e448cd7e8cd6dee5864f7fc43afebaaab055f", "message": "KOGITO-1829: BDD tests: Test that Spring boot cloud events are correctly received on data-index\n\n\n\nadd header", "committedDate": "2020-04-20T13:24:14Z", "type": "forcePushed"}, {"oid": "ef8e4099e934682e31ecca96f4cf11b3bf6d218a", "url": "https://github.com/kiegroup/kogito-examples/commit/ef8e4099e934682e31ecca96f4cf11b3bf6d218a", "message": "KOGITO-1829: BDD tests: Test that Spring boot cloud events are correctly received on data-index\n\n\n\nadd header", "committedDate": "2020-04-21T10:03:09Z", "type": "forcePushed"}, {"oid": "89198159d942dc5f4a890caaa9efeae3964b9098", "url": "https://github.com/kiegroup/kogito-examples/commit/89198159d942dc5f4a890caaa9efeae3964b9098", "message": "KOGITO-1829: BDD tests: Test that Spring boot cloud events are correctly received on data-index", "committedDate": "2020-04-21T12:40:01Z", "type": "commit"}, {"oid": "89198159d942dc5f4a890caaa9efeae3964b9098", "url": "https://github.com/kiegroup/kogito-examples/commit/89198159d942dc5f4a890caaa9efeae3964b9098", "message": "KOGITO-1829: BDD tests: Test that Spring boot cloud events are correctly received on data-index", "committedDate": "2020-04-21T12:40:01Z", "type": "forcePushed"}]}