{"pr_number": 1373, "pr_title": "DBZ-1663 Resume tests after Connect crash in OpenShift for MySQL and PostgreSQL", "pr_createdAt": "2020-03-30T08:01:27Z", "pr_url": "https://github.com/debezium/debezium/pull/1373", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2NTE0NQ==", "url": "https://github.com/debezium/debezium/pull/1373#discussion_r400165145", "bodyText": "Typo in name", "author": "jpechane", "createdAt": "2020-03-30T12:50:56Z", "path": "debezium-testing/debezium-testing-openshift/src/test/java/io/debezium/testing/openshift/ConnectorTestBase.java", "diffHunk": "@@ -126,13 +126,24 @@ protected void assertRecordsCount(String topic, int count) {\n         }\n     }\n \n+    protected void assertMinimaltRecordsCount(String topic, int count) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2NjY2MA==", "url": "https://github.com/debezium/debezium/pull/1373#discussion_r400166660", "bodyText": "Are you really scaling down operator?", "author": "jpechane", "createdAt": "2020-03-30T12:53:20Z", "path": "debezium-testing/debezium-testing-openshift/src/main/java/io/debezium/testing/openshift/tools/kafka/KafkaConnectController.java", "diffHunk": "@@ -73,6 +76,43 @@ public KafkaConnectController(KafkaConnect kafkaConnect, OpenShiftClient ocp, Ok\n         this.httpUtils = new HttpUtils(http);\n     }\n \n+    /**\n+     * Disables Strimzi cluster operator by scaling it to ZERO", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE5MDc1Mg==", "url": "https://github.com/debezium/debezium/pull/1373#discussion_r400190752", "bodyText": "Copy pasted docs ;)", "author": "jcechace", "createdAt": "2020-03-30T13:28:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2NjY2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2Njc5NQ==", "url": "https://github.com/debezium/debezium/pull/1373#discussion_r400166795", "bodyText": "Is the comment valid?", "author": "jpechane", "createdAt": "2020-03-30T12:53:33Z", "path": "debezium-testing/debezium-testing-openshift/src/main/java/io/debezium/testing/openshift/tools/kafka/KafkaConnectController.java", "diffHunk": "@@ -73,6 +76,43 @@ public KafkaConnectController(KafkaConnect kafkaConnect, OpenShiftClient ocp, Ok\n         this.httpUtils = new HttpUtils(http);\n     }\n \n+    /**\n+     * Disables Strimzi cluster operator by scaling it to ZERO\n+     *\n+     * NOTICE: cluster operator needs to be disabled first!\n+     */\n+    public void disable() {\n+        LOGGER.info(\"Disabling KafkaConnect deployment (scaling to ZERO).\");\n+        ocp.apps().deployments().inNamespace(project).withName(this.kafkaConnect.getMetadata().getName() + \"-connect\")\n+                .edit().editSpec().withReplicas(0).endSpec().done();\n+        await()\n+                .atMost(30, SECONDS)\n+                .pollDelay(5, SECONDS)\n+                .pollInterval(3, SECONDS)\n+                .until(() -> ocp.pods().inNamespace(project).withLabel(\"strimzi.io/kind\", \"KafkaConnect\").list().getItems().isEmpty());\n+    }\n+\n+    /**\n+     * Disables Strimzi cluster operator by scaling it to ZERO", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2ODI3Mw==", "url": "https://github.com/debezium/debezium/pull/1373#discussion_r400168273", "bodyText": "Should not this class have an @AfterClass method that would enable operator to make sure it is running for the further tests?", "author": "jpechane", "createdAt": "2020-03-30T12:55:46Z", "path": "debezium-testing/debezium-testing-openshift/src/test/java/io/debezium/testing/openshift/mysql/MySqlConnectorIT.java", "diffHunk": "@@ -138,4 +138,27 @@ public void shouldResumeStreamingAfterRedeployment() throws IOException, Interru\n                 .untilAsserted(() -> assertRecordsCount(connectorName + \".inventory.customers\", 6));\n         assertRecordsContain(connectorName + \".inventory.customers\", \"jerry@test.com\");\n     }\n+\n+    @Test\n+    @Order(7)\n+    public void shouldBeDownAfterCrash() throws SQLException {\n+        operatorController.disable();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIwOTY5NA==", "url": "https://github.com/debezium/debezium/pull/1373#discussion_r400209694", "bodyText": "Probably yes. However, I'd rather include this into @BeforeAll in order to minimize potential connector restarts.", "author": "jcechace", "createdAt": "2020-03-30T13:54:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2ODI3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyOTExMA==", "url": "https://github.com/debezium/debezium/pull/1373#discussion_r400229110", "bodyText": "It's doing it a bit backwards -- the parent kinda presumes the child could break something. But in this case, I think ensuring that Operator runs before each test class is fair enough.", "author": "jcechace", "createdAt": "2020-03-30T14:19:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2ODI3Mw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "1e36712bcb57fe9cc61a9ea6756c6c11b453b53a", "url": "https://github.com/debezium/debezium/commit/1e36712bcb57fe9cc61a9ea6756c6c11b453b53a", "message": "DBZ-1663 Resume tests after Connect crash in OpenShift for MySQL and PostgreSQL", "committedDate": "2020-03-30T18:54:11Z", "type": "commit"}, {"oid": "1e36712bcb57fe9cc61a9ea6756c6c11b453b53a", "url": "https://github.com/debezium/debezium/commit/1e36712bcb57fe9cc61a9ea6756c6c11b453b53a", "message": "DBZ-1663 Resume tests after Connect crash in OpenShift for MySQL and PostgreSQL", "committedDate": "2020-03-30T18:54:11Z", "type": "forcePushed"}]}