{"pr_number": 1655, "pr_title": "DBZ-2278 Resolve concurrent access to the thread map", "pr_createdAt": "2020-06-25T08:17:39Z", "pr_url": "https://github.com/debezium/debezium/pull/1655", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQxMDI1Ng==", "url": "https://github.com/debezium/debezium/pull/1655#discussion_r445410256", "bodyText": "You could keep it as a set, using newSetFromMap():\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final Map<String, Thread> binaryLogClientThreads = new ConcurrentHashMap<>(2);\n          \n          \n            \n                private final Map<String, Thread> binaryLogClientThreads = Collections.newSetFromMap(new ConcurrentHashMap<>(3));\n          \n      \n    \n    \n  \n\nAlso changed the initial size, as 2 wouldn't be enough to hold two elements actually without a resize when using the default load factor. Not that it makes any difference (I'd just call the parameterless constructor), but if we give a size explicitly, it should be large enough.", "author": "gunnarmorling", "createdAt": "2020-06-25T08:57:38Z", "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/BinlogReader.java", "diffHunk": "@@ -116,7 +115,7 @@\n     private Heartbeat heartbeat;\n     private MySqlJdbcContext connectionContext;\n     private final float heartbeatIntervalFactor = 0.8f;\n-    private final Set<Thread> binaryLogClientThreads = Collections.synchronizedSet(new HashSet<>(2));\n+    private final Map<String, Thread> binaryLogClientThreads = new ConcurrentHashMap<>(2);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3NTY3MA==", "url": "https://github.com/debezium/debezium/pull/1655#discussion_r445475670", "bodyText": "@gunnarmorling Initial size modified. Regadring the set, I know but I was contemplating usage of map from the start anyway so it was just nice fit", "author": "jpechane", "createdAt": "2020-06-25T10:58:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQxMDI1Ng=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "7ddef1729280b558c559aa9a7ed09c5826f7ca34", "url": "https://github.com/debezium/debezium/commit/7ddef1729280b558c559aa9a7ed09c5826f7ca34", "message": "DBZ-2278 Resolve concurrent access to the thread map", "committedDate": "2020-06-25T15:40:51Z", "type": "commit"}, {"oid": "7ddef1729280b558c559aa9a7ed09c5826f7ca34", "url": "https://github.com/debezium/debezium/commit/7ddef1729280b558c559aa9a7ed09c5826f7ca34", "message": "DBZ-2278 Resolve concurrent access to the thread map", "committedDate": "2020-06-25T15:40:51Z", "type": "forcePushed"}]}