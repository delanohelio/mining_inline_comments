{"pr_number": 1383, "pr_title": "DBZ-1925 Upgrade to Kafka 2.4.1 and CP 5.4.1", "pr_createdAt": "2020-04-01T19:10:46Z", "pr_url": "https://github.com/debezium/debezium/pull/1383", "timeline": [{"oid": "b6531bf3a698efb93c30a2aa9140a1926fab62bf", "url": "https://github.com/debezium/debezium/commit/b6531bf3a698efb93c30a2aa9140a1926fab62bf", "message": "DBZ-1925 Upgrade to Kafka 2.4.1", "committedDate": "2020-04-01T19:09:48Z", "type": "commit"}, {"oid": "75e1067a472152227089a8537bf17bab663dad74", "url": "https://github.com/debezium/debezium/commit/75e1067a472152227089a8537bf17bab663dad74", "message": "DBZ-1925 Fix incompatible tests with Kafak 2.4.1", "committedDate": "2020-04-02T16:22:40Z", "type": "commit"}, {"oid": "1d6e24bbd4045939e02c9143e36eb322e963a249", "url": "https://github.com/debezium/debezium/commit/1d6e24bbd4045939e02c9143e36eb322e963a249", "message": "DBZ-1925 Upgrade to Confluent Platform 5.4.1", "committedDate": "2020-04-03T16:35:14Z", "type": "commit"}, {"oid": "17864e8f9b50e0df8860f6bfb3214663f2381980", "url": "https://github.com/debezium/debezium/commit/17864e8f9b50e0df8860f6bfb3214663f2381980", "message": "DBZ-1925 Fix test regression after Confluent Platform 5.4.1 upgrade", "committedDate": "2020-04-03T18:57:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI2NzcyMg==", "url": "https://github.com/debezium/debezium/pull/1383#discussion_r403267722", "bodyText": "Thinking about it, I suppose this will impact the matrix job for Kafka versions on CI? Might need to have two flavours of this test which are enabled based on the tested Kafka version. WDYT?", "author": "gunnarmorling", "createdAt": "2020-04-03T19:33:59Z", "path": "debezium-connector-mongodb/src/test/java/io/debezium/connector/mongodb/transforms/ExtractNewDocumentStateTest.java", "diffHunk": "@@ -230,7 +230,9 @@ public void shouldFailWhenTheSchemaLooksValidButDoesNotHaveTheCorrectFields() {\n                 valueSchema,\n                 value);\n \n-        exceptionRule.expect(NullPointerException.class);\n+        // Prior to AK 2.4.1, this threw a NullPointerException\n+        // As of AK 2.4.1, this now causes an IllegalArgumentException\n+        exceptionRule.expect(IllegalArgumentException.class);", "originalCommit": "17864e8f9b50e0df8860f6bfb3214663f2381980", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3NDc5Mw==", "url": "https://github.com/debezium/debezium/pull/1383#discussion_r404074793", "bodyText": "I agree, but I took a slightly different approach and added a Testing.Kafka interface that allows us to test the major/minor/patch version in code and branch accordingly.  If we find we need more of this moving forward we can look into formalizing this into an annotation or something at that point.", "author": "Naros", "createdAt": "2020-04-06T13:06:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI2NzcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4NDYzNg==", "url": "https://github.com/debezium/debezium/pull/1383#discussion_r404284636", "bodyText": "After discussion with @jpechane we felt it was better to use annotations instead so I added the SkipWhenKafkaVersion annotation and its supporting files so we can use this in other spots going forward in tests.", "author": "Naros", "createdAt": "2020-04-06T18:00:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI2NzcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3NjA0Nw==", "url": "https://github.com/debezium/debezium/pull/1383#discussion_r404576047", "bodyText": "Nice!", "author": "gunnarmorling", "createdAt": "2020-04-07T06:54:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI2NzcyMg=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "3be41a87299a6aa318f2413c2c6bfafa1bb8c57c", "url": "https://github.com/debezium/debezium/commit/3be41a87299a6aa318f2413c2c6bfafa1bb8c57c", "message": "DBZ-1925 Introduced SkipWhenKafkaVersion annotation support", "committedDate": "2020-04-06T19:28:24Z", "type": "commit"}, {"oid": "3be41a87299a6aa318f2413c2c6bfafa1bb8c57c", "url": "https://github.com/debezium/debezium/commit/3be41a87299a6aa318f2413c2c6bfafa1bb8c57c", "message": "DBZ-1925 Introduced SkipWhenKafkaVersion annotation support", "committedDate": "2020-04-06T19:28:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3NjczMg==", "url": "https://github.com/debezium/debezium/pull/1383#discussion_r404576732", "bodyText": "LOL, feeling kinda guilty now about having done this change upstream, seeing the cost here ;)", "author": "gunnarmorling", "createdAt": "2020-04-07T06:56:32Z", "path": "debezium-connector-mongodb/src/test/java/io/debezium/connector/mongodb/transforms/ExtractNewDocumentStateTest.java", "diffHunk": "@@ -237,4 +247,39 @@ public void shouldFailWhenTheSchemaLooksValidButDoesNotHaveTheCorrectFields() {\n \n         assertThat(transformed).isNull();\n     }\n+\n+    @Test\n+    @FixFor(\"DBZ-1430\")\n+    @SkipWhenKafkaVersion(check = LESS_THAN, value = KAFKA_241, description = \"Kafka throws NullPointerException prior to 2.4.1\")", "originalCommit": "3be41a87299a6aa318f2413c2c6bfafa1bb8c57c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3ODYyNA==", "url": "https://github.com/debezium/debezium/pull/1383#discussion_r404578624", "bodyText": "That's interesting. It looks like we should exclue this (transitive) dependency, as we effectively have Jackson twice on the (test) classpath. Logged as https://issues.redhat.com/browse/DBZ-1943; could you take a look? Thanks!", "author": "gunnarmorling", "createdAt": "2020-04-07T07:00:28Z", "path": "debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/OutboxEventRouterIT.java", "diffHunk": "@@ -23,12 +23,13 @@\n import org.apache.kafka.connect.header.Header;\n import org.apache.kafka.connect.header.Headers;\n import org.apache.kafka.connect.source.SourceRecord;\n-import org.codehaus.jackson.JsonNode;", "originalCommit": "3be41a87299a6aa318f2413c2c6bfafa1bb8c57c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc5NDA5OQ==", "url": "https://github.com/debezium/debezium/pull/1383#discussion_r404794099", "bodyText": "Ah; good catch.  Will do.", "author": "Naros", "createdAt": "2020-04-07T13:08:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3ODYyNA=="}], "type": "inlineReview"}]}