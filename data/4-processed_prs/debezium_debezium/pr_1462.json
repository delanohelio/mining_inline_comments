{"pr_number": 1462, "pr_title": "DBZ-2014 Do not include outbox eventType field by default", "pr_createdAt": "2020-04-30T21:35:16Z", "pr_url": "https://github.com/debezium/debezium/pull/1462", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI1ODY1Nw==", "url": "https://github.com/debezium/debezium/pull/1462#discussion_r419258657", "bodyText": "Also the ENVELOPE_EVENT_TYPE constant and this variable eventTypeMappingProvided should be removed. With this change, there'll be nothing special about event type any longer.", "author": "gunnarmorling", "createdAt": "2020-05-04T07:39:19Z", "path": "debezium-core/src/main/java/io/debezium/transforms/outbox/EventRouterConfigDefinition.java", "diffHunk": "@@ -287,9 +287,6 @@ public static ConfigDef configDef() {\n                 }\n             }\n         }\n-        if (!eventTypeMappingProvided) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI1OTAxOQ==", "url": "https://github.com/debezium/debezium/pull/1462#discussion_r419259019", "bodyText": "I think this can be removed, right? It won't serve any purpose any longer, now that event type is solely an \"additional field\" as any other the SMT has no awareness of.", "author": "gunnarmorling", "createdAt": "2020-05-04T07:40:10Z", "path": "documentation/modules/ROOT/pages/configuration/outbox-event-router.adoc", "diffHunk": "@@ -90,69 +89,69 @@ This result was achieved with the link:#configuration-options[default configurat\n |Group\n |Description\n \n-|`table.field.event.id`\n+|[[configuration-property-table-field-event-id]]<<configuration-property-table-field-event-id, `table.field.event.id`>>\n |`id`\n |Table\n |The column which contains the event ID within the outbox table\n \n-|`table.field.event.key`\n+|[[configuration-property-table-field-event-key]]<<configuration-property-table-field-event-key, `table.field.event.key`>>\n |`aggregateid`\n |Table\n |The column which contains the event key within the outbox table; when this is set the value of this column will be used as a Kafka message key\n \n-|`table.field.event.type`\n+|[[configuration-property-table-field-event-type]]<<configuration-property-table-field-event-type, `table.field.event.type`>>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI1OTczOA==", "url": "https://github.com/debezium/debezium/pull/1462#discussion_r419259738", "bodyText": "See above, this entry should be removed altogether. But it should be presented as an example for using the generic \"additional fields\" option.", "author": "gunnarmorling", "createdAt": "2020-05-04T07:41:49Z", "path": "documentation/modules/ROOT/pages/configuration/outbox-event-router.adoc", "diffHunk": "@@ -184,14 +183,14 @@ After observing all those pieces we can see what the default configuration does:\n |The `id` shows up as a header in the Kafka message, this is the unique ID of the event, can be used for consumer side dedupe for instance.\n \n |`aggregatetype`\n-|Is the default field for the routing, it gets append to the topic name (check configuration `route.topic.replacement`)\n+|Is the default field for the routing, it gets append to the topic name (check configuration <<configuration-property-route-topic-replacement, `route.topic.replacement`>>)\n \n |`aggregateid`\n |Becomes the Kafka message key, which is important for keeping ordering within Kafka partitions\n \n |`type`\n-|The `type` column becomes either part of the message envelope as `eventType` or message header. +\n-See option `table.fields.additional.placement` for more details.\n+|The `type` column is not part of the message envelope or headers by default.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI2MDkxMQ==", "url": "https://github.com/debezium/debezium/pull/1462#discussion_r419260911", "bodyText": "See above, there shouldn't be any assumption about the eventType field. The contents in this section is good, though, it only needs slight tweaking to be presented as one example of using the additional fields mechanism:\n\"Suppose in your outbox table there's a column \"eventtype\" which indicates the type a given event is of (e.g. for events of the \"purchase order\" aggregate type, there might be event types like \"order created\", \"order shipped\" etc.)...\"", "author": "gunnarmorling", "createdAt": "2020-05-04T07:44:31Z", "path": "documentation/modules/ROOT/pages/configuration/outbox-event-router.adoc", "diffHunk": "@@ -221,9 +220,31 @@ apply the following configuration to the connector:\n ----\n transforms=outbox,...\n transforms.outbox.type=io.debezium.transforms.outbox.EventRouter\n-transforms.outbox.table.fields.additional.placement=type:header:eventType\n value.converter=io.debezium.converters.ByteBufferConverter\n ----\n \n-This moves the `eventType` value into a Kafka message header, leaving only the `payload` column value (the Avro data) as the sole message value.\n-Using `ByteBufferConverter` as the value converter will propagate that value as-is into the Kafka message value.\n+By default only the `payload` column value (the Avro data) is the sole message value.\n+Using `ByteBufferConverter` as the value converter propagates that value as-is into the Kafka message value.\n+\n+=== Emitting messages with the event type field\n+\n+The `eventType` field is not emitted in the outbox routing SMT by default.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2MDgxNA==", "url": "https://github.com/debezium/debezium/pull/1462#discussion_r419960814", "bodyText": "Could you add an anchor id so it can be linked to?", "author": "gunnarmorling", "createdAt": "2020-05-05T08:58:31Z", "path": "documentation/modules/ROOT/pages/configuration/outbox-event-router.adoc", "diffHunk": "@@ -221,9 +209,31 @@ apply the following configuration to the connector:\n ----\n transforms=outbox,...\n transforms.outbox.type=io.debezium.transforms.outbox.EventRouter\n-transforms.outbox.table.fields.additional.placement=type:header:eventType\n value.converter=io.debezium.converters.ByteBufferConverter\n ----\n \n-This moves the `eventType` value into a Kafka message header, leaving only the `payload` column value (the Avro data) as the sole message value.\n-Using `ByteBufferConverter` as the value converter will propagate that value as-is into the Kafka message value.\n+By default only the `payload` column value (the Avro data) is the sole message value.\n+Using `ByteBufferConverter` as the value converter propagates that value as-is into the Kafka message value.\n+\n+=== Emitting messages with additional fields", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cf6504ec25c161ac7da385e228b6b89c08afcf1e", "url": "https://github.com/debezium/debezium/commit/cf6504ec25c161ac7da385e228b6b89c08afcf1e", "message": "DBZ-2014 Do not include outbox eventType field by default", "committedDate": "2020-05-05T16:10:24Z", "type": "commit"}, {"oid": "1f5003ddb6115768be273c1cc155f68da5d990ba", "url": "https://github.com/debezium/debezium/commit/1f5003ddb6115768be273c1cc155f68da5d990ba", "message": "DBZ-2014 Suggested changes", "committedDate": "2020-05-05T16:10:24Z", "type": "commit"}, {"oid": "d3cf52305b706ce832a43dcc3c70ea58541062ab", "url": "https://github.com/debezium/debezium/commit/d3cf52305b706ce832a43dcc3c70ea58541062ab", "message": "DBZ-2014 Add anchor", "committedDate": "2020-05-05T16:21:44Z", "type": "commit"}, {"oid": "d3cf52305b706ce832a43dcc3c70ea58541062ab", "url": "https://github.com/debezium/debezium/commit/d3cf52305b706ce832a43dcc3c70ea58541062ab", "message": "DBZ-2014 Add anchor", "committedDate": "2020-05-05T16:21:44Z", "type": "forcePushed"}]}