{"pr_number": 1731, "pr_title": "DBZ-2225 Introduce MongoDB timeout configuration options", "pr_createdAt": "2020-08-03T16:27:54Z", "pr_url": "https://github.com/debezium/debezium/pull/1731", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0MzAwNQ==", "url": "https://github.com/debezium/debezium/pull/1731#discussion_r464943005", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final int connectTimeoutMS = config.getInteger(MongoDbConnectorConfig.CONNECT_TIMEOUT_MS);\n          \n          \n            \n                    final int connectTimeoutMs = config.getInteger(MongoDbConnectorConfig.CONNECT_TIMEOUT_MS);\n          \n      \n    \n    \n  \n\nSame for others.", "author": "gunnarmorling", "createdAt": "2020-08-04T10:05:49Z", "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/ConnectionContext.java", "diffHunk": "@@ -63,6 +63,10 @@ public ConnectionContext(Configuration config) {\n         final boolean useSSL = config.getBoolean(MongoDbConnectorConfig.SSL_ENABLED);\n         final boolean sslAllowInvalidHostnames = config.getBoolean(MongoDbConnectorConfig.SSL_ALLOW_INVALID_HOSTNAMES);\n \n+        final int connectTimeoutMS = config.getInteger(MongoDbConnectorConfig.CONNECT_TIMEOUT_MS);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTEzNzg1Ng==", "url": "https://github.com/debezium/debezium/pull/1731#discussion_r465137856", "bodyText": "Applied", "author": "Naros", "createdAt": "2020-08-04T15:29:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0MzAwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0MzU1Mw==", "url": "https://github.com/debezium/debezium/pull/1731#discussion_r464943553", "bodyText": "Should we prefix the option names with \"mongodb.\", e.g. \"mongodb.connect.timeout.ms\"? Looks like we do that for the properties which are mostly through to the client builder.", "author": "gunnarmorling", "createdAt": "2020-08-04T10:06:48Z", "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/MongoDbConnectorConfig.java", "diffHunk": "@@ -308,6 +308,30 @@ public static SnapshotMode parse(String value, String defaultValue) {\n                     + \"'initial' (the default) to specify the connector should always perform an initial sync when required; \"\n                     + \"'never' to specify the connector should never perform an initial sync \");\n \n+    public static final Field CONNECT_TIMEOUT_MS = Field.create(\"connect.timeout.ms\")", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA5ODQzNA==", "url": "https://github.com/debezium/debezium/pull/1731#discussion_r465098434", "bodyText": "That's probably a good idea, +1.", "author": "Naros", "createdAt": "2020-08-04T14:35:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0MzU1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0MTE2NA==", "url": "https://github.com/debezium/debezium/pull/1731#discussion_r465141164", "bodyText": "Let's convert it to Duration right here. In general the approach should be to represent temporal data using the strong semantical types like Duration internally, and only convert from/to ms and other representations at the system boundaries.", "author": "gunnarmorling", "createdAt": "2020-08-04T15:34:26Z", "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/ConnectionContext.java", "diffHunk": "@@ -132,8 +143,11 @@ public String hosts() {\n         return config.getString(MongoDbConnectorConfig.HOSTS);\n     }\n \n-    public int pollPeriodInSeconds() {\n-        return config.getInteger(MongoDbConnectorConfig.POLL_INTERVAL_SEC);\n+    public long pollPeriodInMilliSeconds() {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0MTYxNQ==", "url": "https://github.com/debezium/debezium/pull/1731#discussion_r465141615", "bodyText": "There should be a warning logged when using the old property name.", "author": "gunnarmorling", "createdAt": "2020-08-04T15:35:02Z", "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/ConnectionContext.java", "diffHunk": "@@ -132,8 +143,11 @@ public String hosts() {\n         return config.getString(MongoDbConnectorConfig.HOSTS);\n     }\n \n-    public int pollPeriodInSeconds() {\n-        return config.getInteger(MongoDbConnectorConfig.POLL_INTERVAL_SEC);\n+    public long pollPeriodInMilliSeconds() {\n+        if (config.hasKey(MongoDbConnectorConfig.MONGODB_POLL_INTERVAL_MS.name())) {\n+            return config.getLong(MongoDbConnectorConfig.MONGODB_POLL_INTERVAL_MS);\n+        }\n+        return TimeUnit.SECONDS.toMillis(config.getInteger(MongoDbConnectorConfig.POLL_INTERVAL_SEC));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "24ab0fcd70983d42ee8cac36da2bd905d348487b", "url": "https://github.com/debezium/debezium/commit/24ab0fcd70983d42ee8cac36da2bd905d348487b", "message": "DBZ-2225 Introduce MongoDB timeout configuration options\n\nThis adds configurable timeout options for:\n* server.selection.timeout.ms\n* connect.timeout.ms\n* socket.timeout.ms", "committedDate": "2020-08-04T15:53:34Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2MjM3NQ==", "url": "https://github.com/debezium/debezium/pull/1731#discussion_r465162375", "bodyText": "I think we gave the new option precedence in case both are given in similar cases?", "author": "gunnarmorling", "createdAt": "2020-08-04T16:05:39Z", "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/ConnectionContext.java", "diffHunk": "@@ -132,8 +142,12 @@ public String hosts() {\n         return config.getString(MongoDbConnectorConfig.HOSTS);\n     }\n \n-    public int pollPeriodInSeconds() {\n-        return config.getInteger(MongoDbConnectorConfig.POLL_INTERVAL_SEC);\n+    public Duration pollInterval() {\n+        if (config.hasKey(MongoDbConnectorConfig.POLL_INTERVAL_SEC.name())) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE4MTY0Mg==", "url": "https://github.com/debezium/debezium/pull/1731#discussion_r465181642", "bodyText": "I can definitely change it to be consistent.", "author": "Naros", "createdAt": "2020-08-04T16:35:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2MjM3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE4NDg1NA==", "url": "https://github.com/debezium/debezium/pull/1731#discussion_r465184854", "bodyText": "+1", "author": "gunnarmorling", "createdAt": "2020-08-04T16:40:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2MjM3NQ=="}], "type": "inlineReview"}, {"oid": "e0be7cf2748c36ce41029b449e3023a9fe15ec64", "url": "https://github.com/debezium/debezium/commit/e0be7cf2748c36ce41029b449e3023a9fe15ec64", "message": "DBZ-2400 Deprecate mongodb.poll.internval.sec for mongodb.poll.interval.ms", "committedDate": "2020-08-04T16:27:37Z", "type": "commit"}, {"oid": "e0be7cf2748c36ce41029b449e3023a9fe15ec64", "url": "https://github.com/debezium/debezium/commit/e0be7cf2748c36ce41029b449e3023a9fe15ec64", "message": "DBZ-2400 Deprecate mongodb.poll.internval.sec for mongodb.poll.interval.ms", "committedDate": "2020-08-04T16:27:37Z", "type": "forcePushed"}, {"oid": "435c4d2a533a2d6f026f1fce2aedeadcaa5def3e", "url": "https://github.com/debezium/debezium/commit/435c4d2a533a2d6f026f1fce2aedeadcaa5def3e", "message": "DBZ-2400 Change precedence", "committedDate": "2020-08-04T17:15:30Z", "type": "commit"}, {"oid": "0415f2687fefb67dceb214a172fd15a3d11337d4", "url": "https://github.com/debezium/debezium/commit/0415f2687fefb67dceb214a172fd15a3d11337d4", "message": "DBZ-2400 Fix test failures", "committedDate": "2020-08-04T20:36:37Z", "type": "commit"}]}