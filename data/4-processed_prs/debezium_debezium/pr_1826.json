{"pr_number": 1826, "pr_title": "DBZ 2567 Prepare revised SMT docs for downstream", "pr_createdAt": "2020-09-21T21:12:58Z", "pr_url": "https://github.com/debezium/debezium/pull/1826", "timeline": [{"oid": "9085241b15594880e87532fb180a1c0a96ae6f31", "url": "https://github.com/debezium/debezium/commit/9085241b15594880e87532fb180a1c0a96ae6f31", "message": "DBZ-2567 Add filter doc annotations. Update language. Some restructuring", "committedDate": "2020-09-21T20:50:26Z", "type": "commit"}, {"oid": "9b557981fa86e4a3047291e6e5fd7cf7e76f288f", "url": "https://github.com/debezium/debezium/commit/9b557981fa86e4a3047291e6e5fd7cf7e76f288f", "message": "DBZ-2567 Annotate content-based routing doc. Update language, structure.", "committedDate": "2020-09-21T20:53:37Z", "type": "commit"}, {"oid": "5f44b6d00d8dc341a56d02695597e826797b3fb1", "url": "https://github.com/debezium/debezium/commit/5f44b6d00d8dc341a56d02695597e826797b3fb1", "message": "DBZ-2567 Correct punctuation error.", "committedDate": "2020-09-22T01:06:51Z", "type": "commit"}, {"oid": "46000c08dad1036b0b5763d4ac3482ea333f7ee7", "url": "https://github.com/debezium/debezium/commit/46000c08dad1036b0b5763d4ac3482ea333f7ee7", "message": "DBZ-2567 Insert missing space", "committedDate": "2020-09-22T14:52:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgwMjI5MA==", "url": "https://github.com/debezium/debezium/pull/1826#discussion_r492802290", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            IMPORTANT: After the filter SMT is present in a Kafka Connect instance, any user who is allowed to add a connector to the instance can run scripting expressions.\n          \n          \n            \n            IMPORTANT: After the routing SMT is present in a Kafka Connect instance, any user who is allowed to add a connector to the instance can run scripting expressions.", "author": "gunnarmorling", "createdAt": "2020-09-22T14:55:09Z", "path": "documentation/modules/ROOT/pages/configuration/content-based-routing.adoc", "diffHunk": "@@ -33,27 +33,31 @@ The {prodname} content-based routing SMT is a Technology Preview feature. Techno\n ====\n endif::product[]\n \n-Kafka Connect allows to implement bespoke SMTs to encode routing logic using Java.\n-However, there are some drawbacks to that:\n+While it is possible to use Java to create a custom SMT to encode routing logic, using a custom-coded SMT has its drawbacks.\n+For example:\n \n * It is necessary to compile the transformation up front and deploy it to Kafka Connect.\n * Every change needs code recompilation and redeployment, leading to inflexible operations.\n \n The content-based routing SMT supports scripting languages that integrate with https://jcp.org/en/jsr/detail?id=223[JSR 223] (Scripting for the Java(TM) Platform).\n \n+{prodname} does not come with any implementations of the JSR 223 API.\n+To use an expression language with {prodname}, you must download the JSR 223 script engine implementation for the language, and add to your {prodname} connector plug-in directories, along any other JAR files used by the language implementation.\n+For example, for Groovy 3, you can download its JSR 223 implementation from https://groovy-lang.org/. \n+The JSR 223 implementation for GraalVM JavaScript is available at https://github.com/graalvm/graaljs.\n+\n+// Type: procedure\n+// Title: Setting up the {prodname] content-based-routing SMT\n+// ModuleID: setting-up-the-debezium-content-based-routing-smt\n [[set-up-content-based-routing]]\n == Set up\n \n-For security reasons, the content-based routing SMT is not part of the {prodname} connector archives,\n-but is provided in a separate artifact, debezium-scripting-{debezium-version}.tar.gz, which must be explicitly added to your Kafka Connect environment.\n-In order to use this SMT for a given connector plug-in, add the contents of debezium-scripting-{debezium-version}.tar.gz to the connector's plug-in directory.\n+For security reasons, the content-based routing SMT is not included with the {prodname} connector archives.\n+Instead, it is provided in a separate artifact, `debezium-scripting-{debezium-version}.tar.gz`.\n+To use the content-based routing SMT with a {prodname} connector plug-in, you must explicitly add the SMT artifact to your Kafka Connect environment.\n \n-Note that this allows anyone who can set up connectors in your Kafka Connect instance to execute scripting expressions.\n-You should therefore only add this SMT after securing your Kafka Connect instance and its configuration interface appropriately.\n-\n-{prodname} itself doesn't come with any implementations of the JSR 223 API.\n-To use an expression language, you must download the JSR 223 script engine implementation for the language, and add to your {prodname} connector plug-in directories, along any other JAR files used by the language implementation.\n-Eg. for Groovy 3, you can download its JSR 223 implementation from https://groovy-lang.org/. For GraalVM JavaScript, this is is available at https://github.com/graalvm/graaljs.\n+IMPORTANT: After the filter SMT is present in a Kafka Connect instance, any user who is allowed to add a connector to the instance can run scripting expressions.", "originalCommit": "46000c08dad1036b0b5763d4ac3482ea333f7ee7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgwMjQ0OA==", "url": "https://github.com/debezium/debezium/pull/1826#discussion_r492802448", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To ensure that scripting expressions can be run only by authorized users, be sure to secure the Kafka Connect instance and its configuration interface before you add the filter SMT.\n          \n          \n            \n            To ensure that scripting expressions can be run only by authorized users, be sure to secure the Kafka Connect instance and its configuration interface before you add the routing SMT.", "author": "gunnarmorling", "createdAt": "2020-09-22T14:55:19Z", "path": "documentation/modules/ROOT/pages/configuration/content-based-routing.adoc", "diffHunk": "@@ -33,27 +33,31 @@ The {prodname} content-based routing SMT is a Technology Preview feature. Techno\n ====\n endif::product[]\n \n-Kafka Connect allows to implement bespoke SMTs to encode routing logic using Java.\n-However, there are some drawbacks to that:\n+While it is possible to use Java to create a custom SMT to encode routing logic, using a custom-coded SMT has its drawbacks.\n+For example:\n \n * It is necessary to compile the transformation up front and deploy it to Kafka Connect.\n * Every change needs code recompilation and redeployment, leading to inflexible operations.\n \n The content-based routing SMT supports scripting languages that integrate with https://jcp.org/en/jsr/detail?id=223[JSR 223] (Scripting for the Java(TM) Platform).\n \n+{prodname} does not come with any implementations of the JSR 223 API.\n+To use an expression language with {prodname}, you must download the JSR 223 script engine implementation for the language, and add to your {prodname} connector plug-in directories, along any other JAR files used by the language implementation.\n+For example, for Groovy 3, you can download its JSR 223 implementation from https://groovy-lang.org/. \n+The JSR 223 implementation for GraalVM JavaScript is available at https://github.com/graalvm/graaljs.\n+\n+// Type: procedure\n+// Title: Setting up the {prodname] content-based-routing SMT\n+// ModuleID: setting-up-the-debezium-content-based-routing-smt\n [[set-up-content-based-routing]]\n == Set up\n \n-For security reasons, the content-based routing SMT is not part of the {prodname} connector archives,\n-but is provided in a separate artifact, debezium-scripting-{debezium-version}.tar.gz, which must be explicitly added to your Kafka Connect environment.\n-In order to use this SMT for a given connector plug-in, add the contents of debezium-scripting-{debezium-version}.tar.gz to the connector's plug-in directory.\n+For security reasons, the content-based routing SMT is not included with the {prodname} connector archives.\n+Instead, it is provided in a separate artifact, `debezium-scripting-{debezium-version}.tar.gz`.\n+To use the content-based routing SMT with a {prodname} connector plug-in, you must explicitly add the SMT artifact to your Kafka Connect environment.\n \n-Note that this allows anyone who can set up connectors in your Kafka Connect instance to execute scripting expressions.\n-You should therefore only add this SMT after securing your Kafka Connect instance and its configuration interface appropriately.\n-\n-{prodname} itself doesn't come with any implementations of the JSR 223 API.\n-To use an expression language, you must download the JSR 223 script engine implementation for the language, and add to your {prodname} connector plug-in directories, along any other JAR files used by the language implementation.\n-Eg. for Groovy 3, you can download its JSR 223 implementation from https://groovy-lang.org/. For GraalVM JavaScript, this is is available at https://github.com/graalvm/graaljs.\n+IMPORTANT: After the filter SMT is present in a Kafka Connect instance, any user who is allowed to add a connector to the instance can run scripting expressions.\n+To ensure that scripting expressions can be run only by authorized users, be sure to secure the Kafka Connect instance and its configuration interface before you add the filter SMT.", "originalCommit": "46000c08dad1036b0b5763d4ac3482ea333f7ee7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxMDgxMg==", "url": "https://github.com/debezium/debezium/pull/1826#discussion_r492810812", "bodyText": "Oh! Bad copy/paste. Sorry and thanks for catching it!", "author": "roldanbob", "createdAt": "2020-09-22T15:05:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgwMjQ0OA=="}], "type": "inlineReview"}, {"oid": "ba8c5f3e5d33c8720f211eb5126a5e8bbda665b4", "url": "https://github.com/debezium/debezium/commit/ba8c5f3e5d33c8720f211eb5126a5e8bbda665b4", "message": "DBZ-2567 Applying suggestions from code review", "committedDate": "2020-09-22T14:57:19Z", "type": "commit"}]}