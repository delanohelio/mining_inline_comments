{"pr_number": 1278, "pr_title": "DBZ-1817 CI job definition for OpenShift tests", "pr_createdAt": "2020-02-20T13:41:17Z", "pr_url": "https://github.com/debezium/debezium/pull/1278", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA4NDkxMQ==", "url": "https://github.com/debezium/debezium/pull/1278#discussion_r383084911", "bodyText": "Should not be spaces eroud =?", "author": "jpechane", "createdAt": "2020-02-24T04:48:13Z", "path": "jenkins-jobs/pipelines/openshift_pipeline.groovy", "diffHunk": "@@ -0,0 +1,102 @@\n+pipeline {\n+    agent {\n+        label 'Slave'\n+    }\n+\n+    stages {\n+        stage('Checkout') {\n+            when {\n+                expression { !params.PRODUCT_BUILD }\n+            }\n+            steps {\n+                checkout([\n+                        $class           : 'GitSCM',\n+                        branches         : [[name: \"${DBZ_GIT_BRANCH}\"]],\n+                        userRemoteConfigs: [[url: \"${DBZ_GIT_REPOSITORY}\"]],\n+                        extensions       : [[$class           : 'RelativeTargetDirectory',\n+                                             relativeTargetDir: 'debezium']],\n+                ])\n+\n+                checkout([\n+                        $class           : 'GitSCM',\n+                        branches         : [[name: \"${STRZ_GIT_BRANCH}\"]],\n+                        userRemoteConfigs: [[url: \"${STRZ_GIT_REPOSITORY}\"]],\n+                        extensions       : [[$class           : 'RelativeTargetDirectory',\n+                                             relativeTargetDir: 'strimzi']],\n+                ])\n+            }\n+        }\n+\n+        stage('Configure') {\n+            steps {\n+                script {\n+                    env.OCP_PROJECT_DEBEZIUM=\"debezium-${BUILD_NUMBER}\"", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMyMDM1OA==", "url": "https://github.com/debezium/debezium/pull/1278#discussion_r383320358", "bodyText": "Doesn't matter but added :)", "author": "jcechace", "createdAt": "2020-02-24T15:09:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA4NDkxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA4NTAwNA==", "url": "https://github.com/debezium/debezium/pull/1278#discussion_r383085004", "bodyText": "Why is this in two different sh steps?", "author": "jpechane", "createdAt": "2020-02-24T04:48:48Z", "path": "jenkins-jobs/pipelines/openshift_pipeline.groovy", "diffHunk": "@@ -0,0 +1,102 @@\n+pipeline {\n+    agent {\n+        label 'Slave'\n+    }\n+\n+    stages {\n+        stage('Checkout') {\n+            when {\n+                expression { !params.PRODUCT_BUILD }\n+            }\n+            steps {\n+                checkout([\n+                        $class           : 'GitSCM',\n+                        branches         : [[name: \"${DBZ_GIT_BRANCH}\"]],\n+                        userRemoteConfigs: [[url: \"${DBZ_GIT_REPOSITORY}\"]],\n+                        extensions       : [[$class           : 'RelativeTargetDirectory',\n+                                             relativeTargetDir: 'debezium']],\n+                ])\n+\n+                checkout([\n+                        $class           : 'GitSCM',\n+                        branches         : [[name: \"${STRZ_GIT_BRANCH}\"]],\n+                        userRemoteConfigs: [[url: \"${STRZ_GIT_REPOSITORY}\"]],\n+                        extensions       : [[$class           : 'RelativeTargetDirectory',\n+                                             relativeTargetDir: 'strimzi']],\n+                ])\n+            }\n+        }\n+\n+        stage('Configure') {\n+            steps {\n+                script {\n+                    env.OCP_PROJECT_DEBEZIUM=\"debezium-${BUILD_NUMBER}\"\n+                    env.OCP_PROJECT_MYSQL=\"debezium-${BUILD_NUMBER}-mysql\"\n+                    env.OCP_PROJECT_POSTGRESQL=\"debezium-${BUILD_NUMBER}-postgresql\"\n+                }\n+                withCredentials([\n+                        usernamePassword(credentialsId: \"${OCP_CREDENTIALS}\", usernameVariable: 'OCP_USERNAME', passwordVariable: 'OCP_PASSWORD'),\n+                ]) {\n+                    sh '''\n+                    set -x            \n+                    oc login ${OCP_URL} -u \"${OCP_USERNAME}\" --password=\"${OCP_PASSWORD}\" --insecure-skip-tls-verify=true >/dev/null\n+                    oc new-project ${OCP_PROJECT_DEBEZIUM}\n+                    oc new-project ${OCP_PROJECT_MYSQL}\n+                    oc new-project ${OCP_PROJECT_POSTGRESQL}\n+                    '''\n+                    sh '''", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMyMTI1NQ==", "url": "https://github.com/debezium/debezium/pull/1278#discussion_r383321255", "bodyText": "Just that these are two distinct operations so I used separate sh steps as a way to logically divide them.", "author": "jcechace", "createdAt": "2020-02-24T15:10:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA4NTAwNA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1ODQzMw==", "url": "https://github.com/debezium/debezium/pull/1278#discussion_r393058433", "bodyText": "Could the job (https://github.com/debezium/debezium/blob/master/jenkins-jobs/sync-images.yaml) be updated to use this script and extended to provide all-tags copy like this script https://github.com/debezium/docker-images/blob/master/image-sync/sync.sh ?", "author": "jpechane", "createdAt": "2020-03-16T14:20:23Z", "path": "jenkins-jobs/scripts/copy-images.sh", "diffHunk": "@@ -0,0 +1,55 @@\n+#! /usr/bin/env bash", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwODE0NQ==", "url": "https://github.com/debezium/debezium/pull/1278#discussion_r393108145", "bodyText": "I'm not quite sure I follow what you mean", "author": "jcechace", "createdAt": "2020-03-16T15:26:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1ODQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzExMjU5MQ==", "url": "https://github.com/debezium/debezium/pull/1278#discussion_r393112591", "bodyText": "Well, we have a job that syncs Docker Hub images to Quay.io - effectivelly doing more or less the same your script does. It is more adnnced in ability to copy all tags but otherwise much more limited.\nSo I was think about using your script to do the same task.", "author": "jpechane", "createdAt": "2020-03-16T15:32:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1ODQzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA3NzE4Nw==", "url": "https://github.com/debezium/debezium/pull/1278#discussion_r393077187", "bodyText": "Does this file belong to this PR?", "author": "jpechane", "createdAt": "2020-03-16T14:42:59Z", "path": "debezium-testing/mysql_repl.yaml", "diffHunk": "@@ -0,0 +1,140 @@\n+apiVersion: v1", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwNzIwOQ==", "url": "https://github.com/debezium/debezium/pull/1278#discussion_r393107209", "bodyText": "No it doesn't.... that's a rogue k8 descriptor :)", "author": "jcechace", "createdAt": "2020-03-16T15:25:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA3NzE4Nw=="}], "type": "inlineReview"}, {"oid": "a3c9fcb8f0fbfe15187d624aca28b65ae51ae563", "url": "https://github.com/debezium/debezium/commit/a3c9fcb8f0fbfe15187d624aca28b65ae51ae563", "message": "DBZ-1817 Jenkins job definition and pipeline for openshift tests\n\nRefactored image properties", "committedDate": "2020-03-16T15:27:15Z", "type": "commit"}, {"oid": "a3c9fcb8f0fbfe15187d624aca28b65ae51ae563", "url": "https://github.com/debezium/debezium/commit/a3c9fcb8f0fbfe15187d624aca28b65ae51ae563", "message": "DBZ-1817 Jenkins job definition and pipeline for openshift tests\n\nRefactored image properties", "committedDate": "2020-03-16T15:27:15Z", "type": "forcePushed"}]}