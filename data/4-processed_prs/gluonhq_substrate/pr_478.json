{"pr_number": 478, "pr_title": "pass user.home on ios to GraalVM", "pr_createdAt": "2020-03-27T16:50:01Z", "pr_url": "https://github.com/gluonhq/substrate/pull/478", "timeline": [{"oid": "06e53faaaf44cc3c1a2ef4bc9079d9b8ee1b8416", "url": "https://github.com/gluonhq/substrate/commit/06e53faaaf44cc3c1a2ef4bc9079d9b8ee1b8416", "message": "pass user.home on ios to GraalVM", "committedDate": "2020-03-27T16:49:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQxNTMyNg==", "url": "https://github.com/gluonhq/substrate/pull/478#discussion_r399415326", "bodyText": "Update year in license header", "author": "jperedadnr", "createdAt": "2020-03-27T17:08:20Z", "path": "src/main/resources/native/ios/AppDelegate.m", "diffHunk": "@@ -51,12 +51,9 @@ @interface AppDelegate : UIResponder <UIApplicationDelegate>\n \n @end\n \n-int startGVM();\n+int startGVM(const char* userHome);", "originalCommit": "06e53faaaf44cc3c1a2ef4bc9079d9b8ee1b8416", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQxNjE0MQ==", "url": "https://github.com/gluonhq/substrate/pull/478#discussion_r399416141", "bodyText": "Probably no need to create new objects, just inline:\nNSString *folderPath = [documentsDir stringByAppendingPathComponent:@\"gluon\"];\nNSString *userhomeProp = [@\"-Duser.home=\" stringByAppendingString: folderPath];", "author": "jperedadnr", "createdAt": "2020-03-27T17:09:42Z", "path": "src/main/resources/native/ios/AppDelegate.m", "diffHunk": "@@ -74,7 +71,23 @@ @implementation AppDelegate\n \n -(void)startVM:(id)selector {\n     gvmlog(@\"Starting vm...\");\n-    startGVM();\n+    NSArray *documentPaths = NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES);\n+    NSString *documentsDir = [documentPaths objectAtIndex:0];\n+    NSString *folder = @\"gluon\";\n+    NSString *folderPath = [documentsDir stringByAppendingPathComponent:folder];\n+    NSString *prop = @\"-Duser.home=\";\n+    NSString *userhomeProp = [prop stringByAppendingString: folderPath];", "originalCommit": "06e53faaaf44cc3c1a2ef4bc9079d9b8ee1b8416", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ5OTAxMQ==", "url": "https://github.com/gluonhq/substrate/pull/478#discussion_r399499011", "bodyText": "I prefer to keep those on separate lines. The resulting native code is the same, but I want to keep linenumber info as small as possible (if we see a crash in line X, I want a single statement to be the possible cause).", "author": "johanvos", "createdAt": "2020-03-27T19:39:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQxNjE0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQxNjk1OA==", "url": "https://github.com/gluonhq/substrate/pull/478#discussion_r399416958", "bodyText": "Update message log", "author": "jperedadnr", "createdAt": "2020-03-27T17:11:07Z", "path": "src/main/resources/native/ios/AppDelegate.m", "diffHunk": "@@ -74,7 +71,23 @@ @implementation AppDelegate\n \n -(void)startVM:(id)selector {\n     gvmlog(@\"Starting vm...\");\n-    startGVM();\n+    NSArray *documentPaths = NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES);\n+    NSString *documentsDir = [documentPaths objectAtIndex:0];\n+    NSString *folder = @\"gluon\";\n+    NSString *folderPath = [documentsDir stringByAppendingPathComponent:folder];\n+    NSString *prop = @\"-Duser.home=\";\n+    NSString *userhomeProp = [prop stringByAppendingString: folderPath];\n+\n+    if (!folderPath) {\n+        NSLog(@\"Error getting the private storage path\");", "originalCommit": "06e53faaaf44cc3c1a2ef4bc9079d9b8ee1b8416", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQxNzE3Mg==", "url": "https://github.com/gluonhq/substrate/pull/478#discussion_r399417172", "bodyText": "Update message log", "author": "jperedadnr", "createdAt": "2020-03-27T17:11:31Z", "path": "src/main/resources/native/ios/AppDelegate.m", "diffHunk": "@@ -74,7 +71,23 @@ @implementation AppDelegate\n \n -(void)startVM:(id)selector {\n     gvmlog(@\"Starting vm...\");\n-    startGVM();\n+    NSArray *documentPaths = NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES);\n+    NSString *documentsDir = [documentPaths objectAtIndex:0];\n+    NSString *folder = @\"gluon\";\n+    NSString *folderPath = [documentsDir stringByAppendingPathComponent:folder];\n+    NSString *prop = @\"-Duser.home=\";\n+    NSString *userhomeProp = [prop stringByAppendingString: folderPath];\n+\n+    if (!folderPath) {\n+        NSLog(@\"Error getting the private storage path\");\n+    }\n+\n+    NSFileManager *manager = [NSFileManager defaultManager];\n+    [manager createDirectoryAtPath: folderPath withIntermediateDirectories: NO attributes: nil error: nil];\n+\n+    NSLog(@\"Done creating private storage %@\", folderPath);", "originalCommit": "06e53faaaf44cc3c1a2ef4bc9079d9b8ee1b8416", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQxNzk1Mg==", "url": "https://github.com/gluonhq/substrate/pull/478#discussion_r399417952", "bodyText": "Is this a critical error? Anyway, the check should be done before NSString *userhomeProp = ...?", "author": "jperedadnr", "createdAt": "2020-03-27T17:12:48Z", "path": "src/main/resources/native/ios/AppDelegate.m", "diffHunk": "@@ -74,7 +71,23 @@ @implementation AppDelegate\n \n -(void)startVM:(id)selector {\n     gvmlog(@\"Starting vm...\");\n-    startGVM();\n+    NSArray *documentPaths = NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES);\n+    NSString *documentsDir = [documentPaths objectAtIndex:0];\n+    NSString *folder = @\"gluon\";\n+    NSString *folderPath = [documentsDir stringByAppendingPathComponent:folder];\n+    NSString *prop = @\"-Duser.home=\";\n+    NSString *userhomeProp = [prop stringByAppendingString: folderPath];\n+\n+    if (!folderPath) {", "originalCommit": "06e53faaaf44cc3c1a2ef4bc9079d9b8ee1b8416", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "63033ac481c5164eccdff2f1e372d00ba355f0dc", "url": "https://github.com/gluonhq/substrate/commit/63033ac481c5164eccdff2f1e372d00ba355f0dc", "message": "process comments", "committedDate": "2020-03-27T19:44:28Z", "type": "commit"}]}