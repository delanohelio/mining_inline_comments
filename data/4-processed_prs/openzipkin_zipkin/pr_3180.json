{"pr_number": 3180, "pr_title": "Improve search result table's design", "pr_createdAt": "2020-08-20T06:24:56Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3180", "timeline": [{"oid": "ec1f788e4dbdec2be5ccb9b6882dae24206bfbfa", "url": "https://github.com/openzipkin/zipkin/commit/ec1f788e4dbdec2be5ccb9b6882dae24206bfbfa", "message": "Add TraceSummary type and add root info to trace summary", "committedDate": "2020-08-18T12:49:35Z", "type": "commit"}, {"oid": "6055a6ca37049142ffd0b2da6fb2a701a9fd1829", "url": "https://github.com/openzipkin/zipkin/commit/6055a6ca37049142ffd0b2da6fb2a701a9fd1829", "message": "Add TraceSummaryTable", "committedDate": "2020-08-19T01:47:20Z", "type": "commit"}, {"oid": "a083bc57d5f701af0e3eb421fe3fe6dcde4a2f87", "url": "https://github.com/openzipkin/zipkin/commit/a083bc57d5f701af0e3eb421fe3fe6dcde4a2f87", "message": "Add Trace ID", "committedDate": "2020-08-19T01:54:15Z", "type": "commit"}, {"oid": "08884304f980c2fe16ae1ea5132cc66ebdcb22e3", "url": "https://github.com/openzipkin/zipkin/commit/08884304f980c2fe16ae1ea5132cc66ebdcb22e3", "message": "(package) Update recharts", "committedDate": "2020-08-19T03:56:13Z", "type": "commit"}, {"oid": "8f7570c7ac2e02ed920b6f403a15ff6347a46c36", "url": "https://github.com/openzipkin/zipkin/commit/8f7570c7ac2e02ed920b6f403a15ff6347a46c36", "message": "Add service and span count chart", "committedDate": "2020-08-19T03:56:31Z", "type": "commit"}, {"oid": "26d5d13ddeb1e9e27a164c1a6f8d5b098ae49e67", "url": "https://github.com/openzipkin/zipkin/commit/26d5d13ddeb1e9e27a164c1a6f8d5b098ae49e67", "message": "Add Link to trace page", "committedDate": "2020-08-20T04:36:08Z", "type": "commit"}, {"oid": "db904319d711031b28082c8673ec4333ff90ec22", "url": "https://github.com/openzipkin/zipkin/commit/db904319d711031b28082c8673ec4333ff90ec22", "message": "Update design", "committedDate": "2020-08-20T04:55:51Z", "type": "commit"}, {"oid": "60304e3a5c9beb06d79e1fd05047e0f3a34c2a05", "url": "https://github.com/openzipkin/zipkin/commit/60304e3a5c9beb06d79e1fd05047e0f3a34c2a05", "message": "Add sorter", "committedDate": "2020-08-20T05:56:03Z", "type": "commit"}, {"oid": "12c0788ef1ddc61fbb6f80a8efd344d944591022", "url": "https://github.com/openzipkin/zipkin/commit/12c0788ef1ddc61fbb6f80a8efd344d944591022", "message": "Remove labelFormatter", "committedDate": "2020-08-20T06:02:44Z", "type": "commit"}, {"oid": "2ba2e08c48de766b8da378a9670bc9ef44c8b572", "url": "https://github.com/openzipkin/zipkin/commit/2ba2e08c48de766b8da378a9670bc9ef44c8b572", "message": "Remove unused files", "committedDate": "2020-08-20T06:08:12Z", "type": "commit"}, {"oid": "e0550c3f8994ff20a906c25ec3790037d071ca38", "url": "https://github.com/openzipkin/zipkin/commit/e0550c3f8994ff20a906c25ec3790037d071ca38", "message": "Change root span cell design", "committedDate": "2020-08-21T00:06:44Z", "type": "commit"}, {"oid": "36066a60f9e85a591c0623092a1f45402a87400e", "url": "https://github.com/openzipkin/zipkin/commit/36066a60f9e85a591c0623092a1f45402a87400e", "message": "Add Filter feature", "committedDate": "2020-08-30T22:46:14Z", "type": "commit"}, {"oid": "940dbc03bd5681533693e056e072bcd3000dd6cf", "url": "https://github.com/openzipkin/zipkin/commit/940dbc03bd5681533693e056e072bcd3000dd6cf", "message": "Sort service names by span count", "committedDate": "2020-08-30T22:50:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODI4Mw==", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r479848283", "bodyText": "Is it possible to avoid this cast?", "author": "anuraaga", "createdAt": "2020-08-31T01:41:20Z", "path": "zipkin-lens/src/components/DiscoverPage/DiscoverPageContent.tsx", "diffHunk": "@@ -399,29 +404,60 @@ const DiscoverPageContent: React.FC<DiscoverPageContentProps> = ({\n     }\n   }, [setQueryParams, tempCriteria, tempLookback, tempLimit]);\n \n-  const [traces, isLoadingTraces] = useSelector((state: RootState) => [\n+  const [\n+    traces,\n+    isLoadingTraces,\n+    traceSummaries,\n+  ] = useSelector((state: RootState) => [\n     state.traces.traces,\n     state.traces.isLoading,\n+    state.traces.traceSummaries as TraceSummary[],", "originalCommit": "940dbc03bd5681533693e056e072bcd3000dd6cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDA4NTE3OA==", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r480085178", "bodyText": "Yes, but traceSummaries state is written in JavaScript, so this type is any..\nSo I want to cast until the type is attached to the state of traceSummaries..", "author": "tacigar", "createdAt": "2020-08-31T12:06:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODI4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODQxMw==", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r479848413", "bodyText": "Can you use Set instead of object / keys?", "author": "anuraaga", "createdAt": "2020-08-31T01:41:57Z", "path": "zipkin-lens/src/components/DiscoverPage/DiscoverPageContent.tsx", "diffHunk": "@@ -399,29 +404,60 @@ const DiscoverPageContent: React.FC<DiscoverPageContentProps> = ({\n     }\n   }, [setQueryParams, tempCriteria, tempLookback, tempLimit]);\n \n-  const [traces, isLoadingTraces] = useSelector((state: RootState) => [\n+  const [\n+    traces,\n+    isLoadingTraces,\n+    traceSummaries,\n+  ] = useSelector((state: RootState) => [\n     state.traces.traces,\n     state.traces.isLoading,\n+    state.traces.traceSummaries as TraceSummary[],\n   ]);\n \n   const [isShowingLookbackMenu, setIsShowingLookbackMenu] = useState(false);\n-\n   const toggleLookbackMenu = useCallback(() => {\n     setIsShowingLookbackMenu((prev) => !prev);\n   }, []);\n-\n   const closeLookbackMenu = useCallback(() => {\n     setIsShowingLookbackMenu(false);\n   }, []);\n \n   const [isOpeningSettings, setIsOpeningSettings] = useState(false);\n-\n   const handleSettingsButtonClick = useCallback(() => {\n     setIsOpeningSettings((prev) => !prev);\n   }, []);\n \n-  let content: JSX.Element | undefined;\n+  const [filters, setFilters] = useState<string[]>([]);\n+  const filterOptions = useMemo(\n+    () =>\n+      Object.keys(\n+        traceSummaries.reduce((acc, cur) => {\n+          cur.serviceSummaries.forEach((serviceSummary) => {\n+            acc[serviceSummary.serviceName] = true;", "originalCommit": "940dbc03bd5681533693e056e072bcd3000dd6cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDc0ODk1MA==", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r480748950", "bodyText": "Just confirming are you leaving this as is or considering Set?", "author": "anuraaga", "createdAt": "2020-09-01T04:04:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODQxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDgyNjM4MQ==", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r480826381", "bodyText": "Oops! I was correcting a different code.\nI'll use Set here.", "author": "tacigar", "createdAt": "2020-09-01T05:19:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODQxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk1OTkyNw==", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r480959927", "bodyText": "Done! \ud83d\ude47", "author": "tacigar", "createdAt": "2020-09-01T08:22:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODQxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODU5Ng==", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r479848596", "bodyText": "Can wait until all the UI feedback is finalized but let's not forget i18n", "author": "anuraaga", "createdAt": "2020-08-31T01:43:08Z", "path": "zipkin-lens/src/components/DiscoverPage/DiscoverPageContent.tsx", "diffHunk": "@@ -483,14 +525,30 @@ const DiscoverPageContent: React.FC<DiscoverPageContentProps> = ({\n               <SettingsIcon />\n             </SettingsButton>\n           </Box>\n-          {isOpeningSettings ? (\n+        </Container>\n+        <Collapse in={isOpeningSettings}>\n+          <Box mt={1.5} mb={1.5}>\n+            <Divider />\n+          </Box>\n+          <Container>\n             <Box\n               display=\"flex\"\n               alignItems=\"center\"\n               justifyContent=\"flex-end\"\n               mt={1.75}\n             >\n-              <Box mr={1} position=\"relative\">\n+              <TextField\n+                label=\"Limit\"", "originalCommit": "940dbc03bd5681533693e056e072bcd3000dd6cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0ODc3OA==", "url": "https://github.com/openzipkin/zipkin/pull/3180#discussion_r479848778", "bodyText": "Believe you may be able to use useReducer instead of useState + useCallback since you only toggle.", "author": "anuraaga", "createdAt": "2020-08-31T01:44:11Z", "path": "zipkin-lens/src/components/DiscoverPage/TraceSummaryRow.tsx", "diffHunk": "@@ -0,0 +1,231 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import {\n+  Box,\n+  Collapse,\n+  IconButton,\n+  TableCell,\n+  TableRow,\n+  Typography,\n+  useTheme,\n+  Button,\n+} from '@material-ui/core';\n+import KeyboardArrowDownIcon from '@material-ui/icons/KeyboardArrowDown';\n+import KeyboardArrowUpIcon from '@material-ui/icons/KeyboardArrowUp';\n+import moment from 'moment';\n+import React, { useCallback, useMemo, useState } from 'react';\n+import { Link } from 'react-router-dom';\n+import {\n+  Bar,\n+  BarChart,\n+  CartesianGrid,\n+  LabelList,\n+  ResponsiveContainer,\n+  Tooltip,\n+  XAxis,\n+  YAxis,\n+} from 'recharts';\n+import styled from 'styled-components';\n+\n+import { selectColorByInfoClass, selectServiceColor } from '../../colors';\n+import TraceSummary from '../../models/TraceSummary';\n+import { formatDuration } from '../../util/timestamp';\n+\n+const renderCustomizedLabel = (props: any) => {\n+  const { x, y, width, value } = props;\n+  const radius = 10;\n+\n+  return (\n+    <g>\n+      <circle\n+        cx={x + width / 2}\n+        cy={y - radius}\n+        r={radius}\n+        fill={selectServiceColor(value)}\n+      />\n+      <text\n+        x={x + width / 2}\n+        y={y - radius}\n+        fill=\"#fff\"\n+        textAnchor=\"middle\"\n+        dominantBaseline=\"middle\"\n+      >\n+        {value[0].toUpperCase()}\n+      </text>\n+    </g>\n+  );\n+};\n+\n+interface TraceSummaryRowProps {\n+  traceSummary: TraceSummary;\n+}\n+\n+const TraceSummaryRow: React.FC<TraceSummaryRowProps> = ({ traceSummary }) => {\n+  const theme = useTheme();\n+  const [open, setOpen] = useState(false);\n+  const handleOpenButtonClick = useCallback(() => {", "originalCommit": "940dbc03bd5681533693e056e072bcd3000dd6cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "06fef6f68e739fcf2d6349c47809de9e951379be", "url": "https://github.com/openzipkin/zipkin/commit/06fef6f68e739fcf2d6349c47809de9e951379be", "message": "Merge branch 'master' into tacigar/traces-page", "committedDate": "2020-08-31T12:00:48Z", "type": "commit"}, {"oid": "06fef6f68e739fcf2d6349c47809de9e951379be", "url": "https://github.com/openzipkin/zipkin/commit/06fef6f68e739fcf2d6349c47809de9e951379be", "message": "Merge branch 'master' into tacigar/traces-page", "committedDate": "2020-08-31T12:00:48Z", "type": "forcePushed"}, {"oid": "86babbb5be4ffac4d42086d8651054f46781f8a3", "url": "https://github.com/openzipkin/zipkin/commit/86babbb5be4ffac4d42086d8651054f46781f8a3", "message": "Use Set instead of object", "committedDate": "2020-08-31T12:14:01Z", "type": "commit"}, {"oid": "94981617af1fb0c2e638600f8f109c45ee36c131", "url": "https://github.com/openzipkin/zipkin/commit/94981617af1fb0c2e638600f8f109c45ee36c131", "message": "Use useReducer", "committedDate": "2020-08-31T12:25:15Z", "type": "commit"}, {"oid": "bbb5f0451995b90d9649b9b12e3a7fcdc82e9a12", "url": "https://github.com/openzipkin/zipkin/commit/bbb5f0451995b90d9649b9b12e3a7fcdc82e9a12", "message": "i18n", "committedDate": "2020-08-31T12:46:45Z", "type": "commit"}, {"oid": "67242254e58fffe263d85875b50a200bf45ba836", "url": "https://github.com/openzipkin/zipkin/commit/67242254e58fffe263d85875b50a200bf45ba836", "message": "Use Set", "committedDate": "2020-09-01T08:21:39Z", "type": "commit"}, {"oid": "5362d30e53b20f7559495d18d718f78a9d51d9cc", "url": "https://github.com/openzipkin/zipkin/commit/5362d30e53b20f7559495d18d718f78a9d51d9cc", "message": "Remove bar chart and revive service name badges", "committedDate": "2020-09-03T14:53:35Z", "type": "commit"}, {"oid": "063b6c413833bc9454c84e2fd775ccdd653f0190", "url": "https://github.com/openzipkin/zipkin/commit/063b6c413833bc9454c84e2fd775ccdd653f0190", "message": "Add expand all & collapse all button", "committedDate": "2020-09-03T15:22:59Z", "type": "commit"}, {"oid": "49073bd344d76f15ee7509d519ec2ea013e77cf9", "url": "https://github.com/openzipkin/zipkin/commit/49073bd344d76f15ee7509d519ec2ea013e77cf9", "message": "Refactor", "committedDate": "2020-09-03T15:35:19Z", "type": "commit"}]}