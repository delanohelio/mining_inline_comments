{"pr_number": 3060, "pr_title": "Use TypeScript for Dependencies page", "pr_createdAt": "2020-04-13T15:20:19Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3060", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzkzNTMzNQ==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r407935335", "bodyText": "Don't think we need the return type JSX.Element for components since React.FC defines a return type.", "author": "anuraaga", "createdAt": "2020-04-14T07:52:09Z", "path": "zipkin-lens/src/components/DependenciesPage/DependenciesGraph.tsx", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+/* eslint-disable no-shadow */\n+import React, { CSSProperties } from 'react';\n+import ReactSelect, { ValueType } from 'react-select';\n+import { AutoSizer } from 'react-virtualized';\n+import { Box, Grid, useTheme } from '@material-ui/core';\n+import { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\n+import moment from 'moment';\n+\n+import Dependencies from '../../types/Dependencies';\n+import VizceralWrapper from './VizceralWrapper';\n+import NodeDetailData from './NodeDetailData';\n+import { Edge } from './types';\n+\n+// These filter functions use any type because they are passed directly to untyped JS code.\n+const filterConnections = (object: any, value: any) => {\n+  if (!value) {\n+    return true;\n+  }\n+  if (object.name === value) {\n+    return true;\n+  }\n+  return object.source.name === value || object.target.name === value;\n+};\n+\n+const filterNodes = (object: any, value: any) => {\n+  if (!value) {\n+    return true;\n+  }\n+  if (object.name === value) {\n+    return true;\n+  }\n+  return (\n+    object.incomingConnections.find(\n+      (conn: any) => conn.source.name === value,\n+    ) ||\n+    object.outgoingConnections.find((conn: any) => conn.target.name === value)\n+  );\n+};\n+\n+const reactSelectStyles = {\n+  control: (base: CSSProperties) => ({\n+    ...base,\n+    width: '15rem',\n+  }),\n+};\n+\n+const useStyles = makeStyles((theme: Theme) =>\n+  createStyles({\n+    containerGrid: {\n+      height: '100%',\n+    },\n+    itemGrid: {\n+      height: '100%',\n+    },\n+    searchButton: {\n+      fontSize: '1.2rem',\n+      padding: theme.spacing(1),\n+      minWidth: 0,\n+      width: 32,\n+      height: 32,\n+    },\n+  }),\n+);\n+\n+interface Props {\n+  dependencies: Dependencies;\n+}\n+\n+const DependenciesGraph: React.FC<Props> = ({ dependencies }): JSX.Element => {", "originalCommit": "2a24d20800b10deb42d3ae50ac6ac3b71ffeeb06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE5NDc4MA==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r408194780", "bodyText": "OK!", "author": "tacigar", "createdAt": "2020-04-14T14:46:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzkzNTMzNQ=="}], "type": "inlineReview"}, {"oid": "15e4ce2d906454522875b075fe9800dd33935e06", "url": "https://github.com/openzipkin/zipkin/commit/15e4ce2d906454522875b075fe9800dd33935e06", "message": "Add unit tests for dependencies' action-creator and reducer", "committedDate": "2020-04-18T06:20:12Z", "type": "forcePushed"}, {"oid": "5519023647f037b88768a5ddedfc32afb3bf0fe4", "url": "https://github.com/openzipkin/zipkin/commit/5519023647f037b88768a5ddedfc32afb3bf0fe4", "message": "Update styles", "committedDate": "2020-04-18T17:05:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMjA4Mg==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410812082", "bodyText": "lingui already mostly provides typescript definitions but does have some bugs it seems (fixed at master until they release)\nCan you check whether we can add definitions here instead of using these old types?\nhttps://github.com/openzipkin/zipkin/blob/master/zipkin-lens/src/types.d.ts#L16", "author": "anuraaga", "createdAt": "2020-04-19T04:29:07Z", "path": "zipkin-lens/package.json", "diffHunk": "@@ -30,11 +30,16 @@\n     \"@types/enzyme-adapter-react-16\": \"^1.0.6\",\n     \"@types/fetch-mock\": \"^7.3.2\",\n     \"@types/jest\": \"^24.9.1\",\n+    \"@types/lingui__macro\": \"^2.7.3\",", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0NzkwMw==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410847903", "bodyText": "Ah, found linguis 3.0.0-10 is out, let's try updating I think it'll fix the types.", "author": "anuraaga", "createdAt": "2020-04-19T08:12:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMjA4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA1MjYzMQ==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r411052631", "bodyText": "Nice!\nBut I'd like to work on that after this PR, as the major version update may possibly need some major changes for migration.\nSo for now, I'm going to copy and paste the type definition into type.d.ts.", "author": "tacigar", "createdAt": "2020-04-20T02:24:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMjA4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMjUxOA==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410812518", "bodyText": "I guess in typescript it's pretty common to leave out return type for most functions, especially lambdas without logic, and let it infer.", "author": "anuraaga", "createdAt": "2020-04-19T04:32:58Z", "path": "zipkin-lens/src/actions/dependencies-action.ts", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+import { DependenciesAction, ActionTypes } from '../types/action-types';\n+import Dependencies from '../types/Dependencies';\n+import AppThunk from '../types/AppThunk';\n+import * as api from '../constants/api';\n+\n+export const loadDependenciesRequest = (): DependenciesAction => ({", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMjc1OQ==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410812759", "bodyText": "Think it's more conventional to use type definition isntead of cast\nconst nodes: { name: string }[] = [];", "author": "anuraaga", "createdAt": "2020-04-19T04:34:47Z", "path": "zipkin-lens/src/components/DependenciesPage/DependenciesGraph.tsx", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+/* eslint-disable no-shadow */\n+import React, { CSSProperties } from 'react';\n+import ReactSelect, { ValueType, ActionMeta } from 'react-select';\n+import { AutoSizer } from 'react-virtualized';\n+import { Box, Grid, useTheme } from '@material-ui/core';\n+import { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\n+import moment from 'moment';\n+\n+import Dependencies from '../../types/Dependencies';\n+import VizceralWrapper from './VizceralWrapper';\n+import NodeDetailData from './NodeDetailData';\n+import { Edge } from './types';\n+\n+// These filter functions use any type because they are passed directly to untyped JS code.\n+const filterConnections = (object: any, value: any) => {\n+  if (!value) {\n+    return true;\n+  }\n+  if (object.name === value) {\n+    return true;\n+  }\n+  return object.source.name === value || object.target.name === value;\n+};\n+\n+const filterNodes = (object: any, value: any) => {\n+  if (!value) {\n+    return true;\n+  }\n+  if (object.name === value) {\n+    return true;\n+  }\n+  return (\n+    object.incomingConnections.find(\n+      (conn: any) => conn.source.name === value,\n+    ) ||\n+    object.outgoingConnections.find((conn: any) => conn.target.name === value)\n+  );\n+};\n+\n+// Export for testing.\n+export const getNodesAndEdges = (dependencies: Dependencies) => {\n+  const nodes = [] as { name: string }[];", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMjk5Nw==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410812997", "bodyText": "Let's name Prop interfaces e.g. DependenciesGraphProps. While in apps, it's not so common to export / import props interfaces, it still happens and it prevents having to then rename it at the importer.", "author": "anuraaga", "createdAt": "2020-04-19T04:36:36Z", "path": "zipkin-lens/src/components/DependenciesPage/DependenciesGraph.tsx", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+/* eslint-disable no-shadow */\n+import React, { CSSProperties } from 'react';\n+import ReactSelect, { ValueType, ActionMeta } from 'react-select';\n+import { AutoSizer } from 'react-virtualized';\n+import { Box, Grid, useTheme } from '@material-ui/core';\n+import { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\n+import moment from 'moment';\n+\n+import Dependencies from '../../types/Dependencies';\n+import VizceralWrapper from './VizceralWrapper';\n+import NodeDetailData from './NodeDetailData';\n+import { Edge } from './types';\n+\n+// These filter functions use any type because they are passed directly to untyped JS code.\n+const filterConnections = (object: any, value: any) => {\n+  if (!value) {\n+    return true;\n+  }\n+  if (object.name === value) {\n+    return true;\n+  }\n+  return object.source.name === value || object.target.name === value;\n+};\n+\n+const filterNodes = (object: any, value: any) => {\n+  if (!value) {\n+    return true;\n+  }\n+  if (object.name === value) {\n+    return true;\n+  }\n+  return (\n+    object.incomingConnections.find(\n+      (conn: any) => conn.source.name === value,\n+    ) ||\n+    object.outgoingConnections.find((conn: any) => conn.target.name === value)\n+  );\n+};\n+\n+// Export for testing.\n+export const getNodesAndEdges = (dependencies: Dependencies) => {\n+  const nodes = [] as { name: string }[];\n+  const edges = [] as Edge[];\n+\n+  dependencies.forEach((edge) => {\n+    const nodeNames = nodes.map((node) => node.name);\n+\n+    if (!nodeNames.includes(edge.parent)) {\n+      nodes.push({ name: edge.parent });\n+    }\n+    if (!nodeNames.includes(edge.child)) {\n+      nodes.push({ name: edge.child });\n+    }\n+\n+    edges.push({\n+      source: edge.parent,\n+      target: edge.child,\n+      metrics: {\n+        normal: edge.callCount || 0,\n+        danger: edge.errorCount || 0,\n+      },\n+    });\n+  });\n+  return { nodes, edges };\n+};\n+\n+const reactSelectStyles = {\n+  control: (base: CSSProperties) => ({\n+    ...base,\n+    width: '15rem',\n+  }),\n+  option: (base: CSSProperties) => ({\n+    ...base,\n+    cursor: 'pointer',\n+  }),\n+  clearIndicator: (base: CSSProperties) => ({\n+    ...base,\n+    cursor: 'pointer',\n+  }),\n+  dropdownIndicator: (base: CSSProperties) => ({\n+    ...base,\n+    cursor: 'pointer',\n+  }),\n+};\n+\n+const useStyles = makeStyles((theme: Theme) =>\n+  createStyles({\n+    containerGrid: {\n+      height: '100%',\n+    },\n+    graphItemGrid: {\n+      height: '100%',\n+    },\n+    nodeDetailDataItemGrid: {\n+      height: '100%',\n+      boxShadow: theme.shadows[10],\n+      zIndex: 1,\n+    },\n+    vizceralWrapper: {\n+      // In Firefox, 100% height does not work...\n+      '& .vizceral': {\n+        height: '99%',\n+      },\n+    },\n+  }),\n+);\n+\n+interface Props {", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMzA4OQ==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410813089", "bodyText": "Import the methods from React?", "author": "anuraaga", "createdAt": "2020-04-19T04:37:15Z", "path": "zipkin-lens/src/components/DependenciesPage/DependenciesGraph.tsx", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+/* eslint-disable no-shadow */\n+import React, { CSSProperties } from 'react';\n+import ReactSelect, { ValueType, ActionMeta } from 'react-select';\n+import { AutoSizer } from 'react-virtualized';\n+import { Box, Grid, useTheme } from '@material-ui/core';\n+import { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\n+import moment from 'moment';\n+\n+import Dependencies from '../../types/Dependencies';\n+import VizceralWrapper from './VizceralWrapper';\n+import NodeDetailData from './NodeDetailData';\n+import { Edge } from './types';\n+\n+// These filter functions use any type because they are passed directly to untyped JS code.\n+const filterConnections = (object: any, value: any) => {\n+  if (!value) {\n+    return true;\n+  }\n+  if (object.name === value) {\n+    return true;\n+  }\n+  return object.source.name === value || object.target.name === value;\n+};\n+\n+const filterNodes = (object: any, value: any) => {\n+  if (!value) {\n+    return true;\n+  }\n+  if (object.name === value) {\n+    return true;\n+  }\n+  return (\n+    object.incomingConnections.find(\n+      (conn: any) => conn.source.name === value,\n+    ) ||\n+    object.outgoingConnections.find((conn: any) => conn.target.name === value)\n+  );\n+};\n+\n+// Export for testing.\n+export const getNodesAndEdges = (dependencies: Dependencies) => {\n+  const nodes = [] as { name: string }[];\n+  const edges = [] as Edge[];\n+\n+  dependencies.forEach((edge) => {\n+    const nodeNames = nodes.map((node) => node.name);\n+\n+    if (!nodeNames.includes(edge.parent)) {\n+      nodes.push({ name: edge.parent });\n+    }\n+    if (!nodeNames.includes(edge.child)) {\n+      nodes.push({ name: edge.child });\n+    }\n+\n+    edges.push({\n+      source: edge.parent,\n+      target: edge.child,\n+      metrics: {\n+        normal: edge.callCount || 0,\n+        danger: edge.errorCount || 0,\n+      },\n+    });\n+  });\n+  return { nodes, edges };\n+};\n+\n+const reactSelectStyles = {\n+  control: (base: CSSProperties) => ({\n+    ...base,\n+    width: '15rem',\n+  }),\n+  option: (base: CSSProperties) => ({\n+    ...base,\n+    cursor: 'pointer',\n+  }),\n+  clearIndicator: (base: CSSProperties) => ({\n+    ...base,\n+    cursor: 'pointer',\n+  }),\n+  dropdownIndicator: (base: CSSProperties) => ({\n+    ...base,\n+    cursor: 'pointer',\n+  }),\n+};\n+\n+const useStyles = makeStyles((theme: Theme) =>\n+  createStyles({\n+    containerGrid: {\n+      height: '100%',\n+    },\n+    graphItemGrid: {\n+      height: '100%',\n+    },\n+    nodeDetailDataItemGrid: {\n+      height: '100%',\n+      boxShadow: theme.shadows[10],\n+      zIndex: 1,\n+    },\n+    vizceralWrapper: {\n+      // In Firefox, 100% height does not work...\n+      '& .vizceral': {\n+        height: '99%',\n+      },\n+    },\n+  }),\n+);\n+\n+interface Props {\n+  dependencies: Dependencies;\n+}\n+\n+const DependenciesGraph: React.FC<Props> = ({ dependencies }) => {\n+  const classes = useStyles();\n+  const theme = useTheme();\n+  const vizStyle = {\n+    colorText: theme.palette.primary.contrastText,\n+    colorTextDisabled: theme.palette.primary.contrastText,\n+    colorConnectionLine: theme.palette.grey[800],\n+    colorTraffic: {\n+      normal: theme.palette.primary.dark,\n+      warning: theme.palette.secondary.dark,\n+      danger: theme.palette.secondary.dark,\n+    },\n+    colorDonutInternalColor: theme.palette.primary.light,\n+    colorDonutInternalColorHighlighted: theme.palette.primary.light,\n+    colorLabelBorder: theme.palette.primary.dark,\n+    colorLabelText: theme.palette.primary.contrastText,\n+    colorTrafficHighlighted: {\n+      normal: theme.palette.primary.main,\n+    },\n+  };\n+\n+  const [focusedNodeName, setFocusedNodeName] = React.useState('');", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAzODQ2NQ==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r411038465", "bodyText": "These days I prefer using React.useState over import { useState } from 'react'.\nThe reason for this is that if useState is no longer used in this file in the future, I won't have to check and change the import statement.", "author": "tacigar", "createdAt": "2020-04-20T01:24:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMzA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA1MzM2Nw==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r411053367", "bodyText": "I sort of understand the motivation, but it doesn't seem strong enough to use a pattern different from every tutorial on hooks on the web, including official one. We want to make sure the code is accessible to any contributor.", "author": "anuraaga", "createdAt": "2020-04-20T02:27:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMzA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI0MTcxNg==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r411241716", "bodyText": "OK!", "author": "tacigar", "createdAt": "2020-04-20T09:45:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMzA4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMzI0Nw==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410813247", "bodyText": "I guess this is related to my above comment, I think you can just copy-paste the type", "author": "anuraaga", "createdAt": "2020-04-19T04:38:24Z", "path": "zipkin-lens/src/components/DependenciesPage/DependenciesPage.tsx", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+import React from 'react';\n+import { useDispatch, useSelector } from 'react-redux';\n+import { withRouter, RouteComponentProps } from 'react-router-dom';\n+import { t } from '@lingui/macro';\n+import { useLingui } from '@lingui/react';\n+import { makeStyles, Theme, createStyles } from '@material-ui/core/styles';\n+import { Box, Typography, Button, CircularProgress } from '@material-ui/core';\n+import { KeyboardDateTimePicker } from '@material-ui/pickers';\n+import { MaterialUiPickersDate } from '@material-ui/pickers/typings/date';\n+import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n+import { faSearch } from '@fortawesome/free-solid-svg-icons';\n+import moment from 'moment';\n+import { History, Location } from 'history';\n+\n+import ExplainBox from './ExplainBox';\n+import TraceJsonUploader from '../Common/TraceJsonUploader';\n+import TraceIdSearchInput from '../Common/TraceIdSearchInput';\n+import {\n+  loadDependencies,\n+  clearDependencies,\n+} from '../../actions/dependencies-action';\n+import RootState from '../../types/RootState';\n+import DependenciesGraph from './DependenciesGraph';\n+\n+// Do require because tsc cannot find the definition of trans.\n+// TODO: Give a strict type.\n+const { Trans } = require('@lingui/macro');", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMzgwNQ==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410813805", "bodyText": "Can you make sure all new files that use JSX end with .jsx extension? And to confirm I guess you're waiting to do typescript in another PR?", "author": "anuraaga", "createdAt": "2020-04-19T04:42:05Z", "path": "zipkin-lens/src/components/DependenciesPage/DependenciesPage.test.js", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+/* eslint-disable no-shadow */\n+import React from 'react';\n+import { createMemoryHistory } from 'history';\n+import moment from 'moment';\n+import { fireEvent, waitForElement } from '@testing-library/react';\n+import fetchMock from 'fetch-mock';\n+\n+import render from '../../test/util/render-with-default-settings';\n+import DependenciesPage from './DependenciesPage';\n+\n+jest.mock('@material-ui/pickers', () => {\n+  // eslint-disable-next-line global-require\n+  const moment = require('moment');\n+  return {\n+    // eslint-disable-next-line react/prop-types\n+    KeyboardDateTimePicker: ({ value, onChange }) => (\n+      <input", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxMzk4Ng==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410813986", "bodyText": "Should this file be .tsx?", "author": "anuraaga", "createdAt": "2020-04-19T04:43:26Z", "path": "zipkin-lens/src/components/DependenciesPage/VizceralWrapper.js", "diffHunk": "@@ -11,16 +11,27 @@\n  * or implied. See the License for the specific language governing permissions and limitations under\n  * the License.\n  */\n+import React from 'react';", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxNDA1Mw==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410814053", "bodyText": "Remove", "author": "anuraaga", "createdAt": "2020-04-19T04:43:45Z", "path": "zipkin-lens/src/components/DependenciesPage/VizceralWrapper.js", "diffHunk": "@@ -11,16 +11,27 @@\n  * or implied. See the License for the specific language governing permissions and limitations under\n  * the License.\n  */\n+import React from 'react';\n import Vizceral from 'vizceral-react';\n \n // Vizceral (vizceral-react) does not release some resources when unmounting the component.\n // Therefore, when Vizceral is mounted many times, rendering speed decreases.\n // So this class inherits Vizceral and overrides componentWillUnmount for releasing resources.\n class VizceralExt extends Vizceral {\n+  constructor(props) {", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxNDE4Ng==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410814186", "bodyText": "I think it's better to define / export (or not) this in the file it's used in instead of having generic types.ts files, alternatively Edge.ts would also be idiomatic but overkill I think", "author": "anuraaga", "createdAt": "2020-04-19T04:44:45Z", "path": "zipkin-lens/src/components/DependenciesPage/types.ts", "diffHunk": "@@ -0,0 +1,21 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+export interface Edge {", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxNDQ0NA==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410814444", "bodyText": "Instead of aliasing types, it's common to override them instead in types.d.ts", "author": "anuraaga", "createdAt": "2020-04-19T04:46:34Z", "path": "zipkin-lens/src/types/AppThunk.ts", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+import { Action } from 'redux';\n+import { ThunkAction } from 'redux-thunk';\n+\n+import RootState from './RootState';\n+\n+type AppThunk<ReturnType = void> = ThunkAction<", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAzNjMwMA==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r411036300", "bodyText": "It is not overriding.\nAppThunk is an application specific type which is defined to avoid repeating the same type declaration for every thunk function.\nhttps://redux-toolkit.js.org/tutorials/advanced-tutorial#adding-a-reusable-thunk-function-type", "author": "tacigar", "createdAt": "2020-04-20T01:15:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxNDQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxNDY2OA==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410814668", "bodyText": "Similarly for everything in this folder, I'd define this where it's used. Being at this top level src/types location gives too little context on what this type is.", "author": "anuraaga", "createdAt": "2020-04-19T04:48:18Z", "path": "zipkin-lens/src/types/Dependencies.ts", "diffHunk": "@@ -0,0 +1,21 @@\n+/*\n+ * Copyright 2015-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+type Dependencies = {", "originalCommit": "da74d55e95139238a44234f31e9d98cde9bef864", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzMDAyOA==", "url": "https://github.com/openzipkin/zipkin/pull/3060#discussion_r410830028", "bodyText": "I realized we could think about this in another PR. I think we already have this folder hierarchy\nactions\n  dependencies-action.js\n  trace-action.js\ncomponents\n  DependenciesPage\n  TracePage\nreducers\n  dependencies\n  trace\n\nI would strongly suggest that at some point we move things to something like\ncomponents\n  DependenciesPage\n    index\n    actions\n    reducer\n  TracePage\n    index\n    actions\n    reducer\n\nAction / reducer / component (and now types) are highly coupled so maintenance is simpler by keeping them together rather than separate.", "author": "anuraaga", "createdAt": "2020-04-19T06:26:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgxNDY2OA=="}], "type": "inlineReview"}, {"oid": "9c67c640d957469449a3c017ee21119b208cd1b3", "url": "https://github.com/openzipkin/zipkin/commit/9c67c640d957469449a3c017ee21119b208cd1b3", "message": "Use TypeScript for DependenciesPage", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "fd7c40efc99ea65dc3bf33df3fdf789a99e46e4f", "url": "https://github.com/openzipkin/zipkin/commit/fd7c40efc99ea65dc3bf33df3fdf789a99e46e4f", "message": "Add clearDependencies reducer", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "d2ccefc49f01b6d36c7270fd8a8ed4619b8040ae", "url": "https://github.com/openzipkin/zipkin/commit/d2ccefc49f01b6d36c7270fd8a8ed4619b8040ae", "message": "Refactor", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "73bb831f7f275f49c8d4d6d0a3446ae7abf40470", "url": "https://github.com/openzipkin/zipkin/commit/73bb831f7f275f49c8d4d6d0a3446ae7abf40470", "message": "Change date time format", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "6ca5ffaac67a1fcbda350659cc21fdbe75c22b79", "url": "https://github.com/openzipkin/zipkin/commit/6ca5ffaac67a1fcbda350659cc21fdbe75c22b79", "message": "Refactor", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "46023d056b2c113dd6862133498bf602609c1f2c", "url": "https://github.com/openzipkin/zipkin/commit/46023d056b2c113dd6862133498bf602609c1f2c", "message": "Add NodeDetailData's unit tests", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "b34ff062d6e9f4a5bb6b8d8392f6fedc741073b1", "url": "https://github.com/openzipkin/zipkin/commit/b34ff062d6e9f4a5bb6b8d8392f6fedc741073b1", "message": "Add DependenciesGraph & DependencpesPage's unit tests", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "9dba307995f56912356d136cb15d44d75b45803b", "url": "https://github.com/openzipkin/zipkin/commit/9dba307995f56912356d136cb15d44d75b45803b", "message": "Add unit tests for dependencies' action-creator and reducer", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "a8eb920327347ac76810644ef879697a8010c64c", "url": "https://github.com/openzipkin/zipkin/commit/a8eb920327347ac76810644ef879697a8010c64c", "message": "Remove an unused file", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "581ae4af5533baddb3cbaecf8f20e146aeffd499", "url": "https://github.com/openzipkin/zipkin/commit/581ae4af5533baddb3cbaecf8f20e146aeffd499", "message": "Update license headers", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "93e214c425f093966ae3877513e14fefcfc07a8e", "url": "https://github.com/openzipkin/zipkin/commit/93e214c425f093966ae3877513e14fefcfc07a8e", "message": "Update styles", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "0b3e5edfbb94e956316021495c353f38e1b977dc", "url": "https://github.com/openzipkin/zipkin/commit/0b3e5edfbb94e956316021495c353f38e1b977dc", "message": "Clear the focused node name when filter is changed", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "5a24120b7e7f0ed3e5e29ea328b5628fc3481044", "url": "https://github.com/openzipkin/zipkin/commit/5a24120b7e7f0ed3e5e29ea328b5628fc3481044", "message": "Update style", "committedDate": "2020-04-20T09:59:05Z", "type": "commit"}, {"oid": "864fea412a483b9bc86c7c3c09fbf979af8d3e76", "url": "https://github.com/openzipkin/zipkin/commit/864fea412a483b9bc86c7c3c09fbf979af8d3e76", "message": "Order service names", "committedDate": "2020-04-20T09:59:06Z", "type": "commit"}, {"oid": "46726da831254e004e94d4564fee7f9b3ce23512", "url": "https://github.com/openzipkin/zipkin/commit/46726da831254e004e94d4564fee7f9b3ce23512", "message": "VizceralWrapper.js -> VizceralWrapper.tsx", "committedDate": "2020-04-20T09:59:06Z", "type": "commit"}, {"oid": "42cc1dc8de2170c864ef0ee03a4fab50db77bf70", "url": "https://github.com/openzipkin/zipkin/commit/42cc1dc8de2170c864ef0ee03a4fab50db77bf70", "message": "Remove unnecessary return types", "committedDate": "2020-04-20T09:59:06Z", "type": "commit"}, {"oid": "99bfca285cd42c67cda700f8ebe39f3957c7a45b", "url": "https://github.com/openzipkin/zipkin/commit/99bfca285cd42c67cda700f8ebe39f3957c7a45b", "message": "Add lingui Trans's type definition to type.d.ts", "committedDate": "2020-04-20T09:59:06Z", "type": "commit"}, {"oid": "2709a2c637bb93d7cb031c66b0f4dbfc2efe9f74", "url": "https://github.com/openzipkin/zipkin/commit/2709a2c637bb93d7cb031c66b0f4dbfc2efe9f74", "message": "Refactor", "committedDate": "2020-04-20T09:59:06Z", "type": "commit"}, {"oid": "2709a2c637bb93d7cb031c66b0f4dbfc2efe9f74", "url": "https://github.com/openzipkin/zipkin/commit/2709a2c637bb93d7cb031c66b0f4dbfc2efe9f74", "message": "Refactor", "committedDate": "2020-04-20T09:59:06Z", "type": "forcePushed"}, {"oid": "2278ba011d42817cbe2d828aa36e2494939b3523", "url": "https://github.com/openzipkin/zipkin/commit/2278ba011d42817cbe2d828aa36e2494939b3523", "message": "test.js -> test.jsx", "committedDate": "2020-04-20T13:49:05Z", "type": "commit"}, {"oid": "ac0bef2506aa1cb627b22a82de8b38c2d16d993d", "url": "https://github.com/openzipkin/zipkin/commit/ac0bef2506aa1cb627b22a82de8b38c2d16d993d", "message": "Merge branch 'master' into tacigar/typescript-dependencies", "committedDate": "2020-04-20T23:29:15Z", "type": "commit"}]}