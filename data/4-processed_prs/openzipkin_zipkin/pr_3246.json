{"pr_number": 3246, "pr_title": "Migrates to Datastax Driver v4", "pr_createdAt": "2020-10-18T08:30:37Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3246", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA0Mjc3Ng==", "url": "https://github.com/openzipkin/zipkin/pull/3246#discussion_r507042776", "bodyText": "while this enables it, heh we still get server side warnings 'SASI indexes are experimental and are not recommended for production use.'", "author": "codefromthecrypt", "createdAt": "2020-10-18T08:32:05Z", "path": "docker/storage/cassandra/install.sh", "diffHunk": "@@ -26,7 +26,9 @@ wget -qO- $APACHE_MIRROR/cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDR\n   --strip=1\n \n # Merge in our custom configuration\n-sed -i '/enable_user_defined_functions: false/cenable_user_defined_functions: true' conf/cassandra.yaml\n+for feature in enable_user_defined_functions enable_sasi_indexes; do", "originalCommit": "d615cd0a09c1f114af5a93e3906e77beb46a97b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA0Mjk3Nw==", "url": "https://github.com/openzipkin/zipkin/pull/3246#discussion_r507042977", "bodyText": "something else to upgrade now :)", "author": "codefromthecrypt", "createdAt": "2020-10-18T08:32:34Z", "path": "zipkin-server/pom.xml", "diffHunk": "@@ -248,12 +235,12 @@\n       <artifactId>brave-context-slf4j</artifactId>\n       <optional>true</optional>\n     </dependency>\n-    <dependency>\n-      <groupId>io.zipkin.brave.cassandra</groupId>\n-      <artifactId>brave-instrumentation-cassandra-driver</artifactId>\n-      <version>0.10.3</version>\n-      <optional>true</optional>\n-    </dependency>\n+<!--    <dependency>-->\n+<!--      <groupId>io.zipkin.brave.cassandra</groupId>-->", "originalCommit": "d615cd0a09c1f114af5a93e3906e77beb46a97b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA0MzE5MQ==", "url": "https://github.com/openzipkin/zipkin/pull/3246#discussion_r507043191", "bodyText": "@jeqo this is the style you can use for kafka (not the commenting out :P)", "author": "codefromthecrypt", "createdAt": "2020-10-18T08:33:17Z", "path": "zipkin-server/src/main/java/zipkin2/server/internal/cassandra3/ZipkinCassandra3StorageConfiguration.java", "diffHunk": "@@ -84,11 +82,11 @@ StorageComponent storage(\n     }\n \n     @Override public Object postProcessAfterInitialization(Object bean, String beanName) {\n-      if (bean instanceof SessionFactory && beanFactory.containsBean(\"tracing\")) {\n-        SessionFactory delegate = (SessionFactory) bean;\n-        Tracing tracing = beanFactory.getBean(Tracing.class);\n-        return (SessionFactory) storage -> TracingSession.create(tracing, delegate.create(storage));\n-      }\n+      //if (bean instanceof SessionFactory && beanFactory.containsBean(\"tracing\")) {", "originalCommit": "d615cd0a09c1f114af5a93e3906e77beb46a97b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA0MzM4NQ==", "url": "https://github.com/openzipkin/zipkin/pull/3246#discussion_r507043385", "bodyText": "instant -> timestamp column", "author": "codefromthecrypt", "createdAt": "2020-10-18T08:34:02Z", "path": "zipkin-storage/cassandra-v1/src/main/java/zipkin2/storage/cassandra/v1/CassandraUtil.java", "diffHunk": "@@ -144,10 +146,10 @@ static ByteBuffer toByteBuffer(String string) {\n   }\n \n   @SuppressWarnings(\"JdkObsolete\")\n-  static List<Date> getDays(long endTs, @Nullable Long lookback) {\n-    List<Date> result = new ArrayList<>();\n+  static List<Instant> getDays(long endTs, @Nullable Long lookback) {\n+    List<Instant> result = new ArrayList<>();", "originalCommit": "d615cd0a09c1f114af5a93e3906e77beb46a97b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ce60e5bad360c5efda6077eed91b77b2154cc9cc", "url": "https://github.com/openzipkin/zipkin/commit/ce60e5bad360c5efda6077eed91b77b2154cc9cc", "message": "Migrates to Datastax Driver v4\n\nThis migrates to the Netty-based Datastax Driver v4, which no longer\nuses guava. This is very different library architecture, most obvious in\nhow configuration is managed. This migration tries to be as conventional\nas possible while retaining defaults as close to as they were as\npossible.", "committedDate": "2020-10-21T02:54:54Z", "type": "commit"}, {"oid": "ce60e5bad360c5efda6077eed91b77b2154cc9cc", "url": "https://github.com/openzipkin/zipkin/commit/ce60e5bad360c5efda6077eed91b77b2154cc9cc", "message": "Migrates to Datastax Driver v4\n\nThis migrates to the Netty-based Datastax Driver v4, which no longer\nuses guava. This is very different library architecture, most obvious in\nhow configuration is managed. This migration tries to be as conventional\nas possible while retaining defaults as close to as they were as\npossible.", "committedDate": "2020-10-21T02:54:54Z", "type": "forcePushed"}]}