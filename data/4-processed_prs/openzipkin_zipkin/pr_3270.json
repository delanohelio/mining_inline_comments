{"pr_number": 3270, "pr_title": "Publishes multi-architecture Docker images", "pr_createdAt": "2020-10-30T11:46:28Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3270", "timeline": [{"oid": "b32503703cb5970d9417ee9cf02d4f6a0cec9915", "url": "https://github.com/openzipkin/zipkin/commit/b32503703cb5970d9417ee9cf02d4f6a0cec9915", "message": "Publishes multi-architecture Docker images\n\nThis runs tests with linux/amd64, but publishes linux/amd64,linux/arm64.\n\nFixes #3141", "committedDate": "2020-10-30T11:44:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA0MTk4Mw==", "url": "https://github.com/openzipkin/zipkin/pull/3270#discussion_r515041983", "bodyText": "@odidev when this PR merges, it should be ready to build on arm64. However, I don't know currently how to get the github action syntax to do a double-matrix (ex focal with amd64,arm64 against the docker image list)", "author": "codefromthecrypt", "createdAt": "2020-10-30T11:48:05Z", "path": ".github/workflows/docker-tests.yml", "diffHunk": "@@ -46,7 +46,7 @@ jobs:\n         with:\n           fetch-depth: 1\n       - name: Build Docker image openzipkin/${{ matrix.target }}:test\n-        run:  docker/build_image ${{ matrix.target }}\n+        run:  docker/build_image openzipkin/${{ matrix.target }}:test", "originalCommit": "b32503703cb5970d9417ee9cf02d4f6a0cec9915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MjU3OA==", "url": "https://github.com/openzipkin/zipkin/pull/3270#discussion_r515072578", "bodyText": "@adriancole\nThanks for the PR. Once this is merged we can add in Travis as it is faster for ARM64 with graviton2 in it. If you are ok with this, I can add and raise PR.", "author": "odidev", "createdAt": "2020-10-30T12:47:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA0MTk4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEwNzkwNw==", "url": "https://github.com/openzipkin/zipkin/pull/3270#discussion_r515107907", "bodyText": "at the moment we'll still need amd64 though at least on master branch, I think.. because that needs to do multi-arch push now. keep that in mind.\nat any rate, yep help appreciated!", "author": "codefromthecrypt", "createdAt": "2020-10-30T13:45:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA0MTk4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA0MjM4Mw==", "url": "https://github.com/openzipkin/zipkin/pull/3270#discussion_r515042383", "bodyText": "this cost a long time to figure out", "author": "codefromthecrypt", "createdAt": "2020-10-30T11:48:51Z", "path": "docker/bin/install.sh", "diffHunk": "@@ -23,6 +23,10 @@ if [ \"$RELEASE_FROM_CONTEXT\" = \"true\" ]; then\n   cp /code/zipkin-slim.jar zipkin-slim.jar\n elif [ \"$RELEASE_VERSION\" = \"master\" ]; then\n   echo \"*** Building from source...\"\n+\n+  # Defensively avoid arm64+alpine problems with posix_spawn\n+  export MAVEN_OPTS=\"-Djdk.lang.Process.launchMechanism=vfork\"", "originalCommit": "b32503703cb5970d9417ee9cf02d4f6a0cec9915", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8f50dc4f448ca8ff8076c3df3a734d14b64f200b", "url": "https://github.com/openzipkin/zipkin/commit/8f50dc4f448ca8ff8076c3df3a734d14b64f200b", "message": "drift", "committedDate": "2020-10-30T12:08:37Z", "type": "commit"}, {"oid": "d3add6c5b0b8430848587ab0c965c9ad0f0a2040", "url": "https://github.com/openzipkin/zipkin/commit/d3add6c5b0b8430848587ab0c965c9ad0f0a2040", "message": "more drift", "committedDate": "2020-10-30T12:11:41Z", "type": "commit"}]}