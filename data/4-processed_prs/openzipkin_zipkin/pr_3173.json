{"pr_number": 3173, "pr_title": "Update Kafka to 2.6 which formally supports JRE 14", "pr_createdAt": "2020-08-10T03:36:16Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3173", "timeline": [{"oid": "846c368e3483a63e581959cf02b138b14a5546db", "url": "https://github.com/openzipkin/zipkin/commit/846c368e3483a63e581959cf02b138b14a5546db", "message": "Update Docker Kafka to 2.6 which formally supports JRE 14\n\nWhile we haven't had any problems, it is nice to use the version that\nformally supports JRE 14 as that's our base image.\n\nI cleaned up a bit to keep the overall image the same as before.\n\nSee https://downloads.apache.org/kafka/2.6.0/RELEASE_NOTES.html", "committedDate": "2020-08-10T03:34:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3NDQ3MQ==", "url": "https://github.com/openzipkin/zipkin/pull/3173#discussion_r467674471", "bodyText": "ack that we are tossing the builder image so this part doesn't matter", "author": "codefromthecrypt", "createdAt": "2020-08-10T03:37:03Z", "path": "docker/collector/kafka/install.sh", "diffHunk": "@@ -41,4 +41,10 @@ EOF\n \n mkdir /kafka/logs\n \n+echo \"*** Cleaning Up\"\n+apk del jq curl --purge", "originalCommit": "846c368e3483a63e581959cf02b138b14a5546db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3NDUxNQ==", "url": "https://github.com/openzipkin/zipkin/pull/3173#discussion_r467674515", "bodyText": "deleting site-docs brought the size back to the same as 2.5+scala 12", "author": "codefromthecrypt", "createdAt": "2020-08-10T03:37:22Z", "path": "docker/collector/kafka/install.sh", "diffHunk": "@@ -41,4 +41,10 @@ EOF\n \n mkdir /kafka/logs\n \n+echo \"*** Cleaning Up\"\n+apk del jq curl --purge\n+# TODO: eventually cleanup irrelevant binaries from RocksDB\n+# https://issues.apache.org/jira/browse/KAFKA-10380\n+rm -rf kafka_$SCALA_VERSION-$KAFKA_VERSION site-docs bin/windows", "originalCommit": "846c368e3483a63e581959cf02b138b14a5546db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3NDc4NA==", "url": "https://github.com/openzipkin/zipkin/pull/3173#discussion_r467674784", "bodyText": "biggest single jar is the embedded RocksDB with several OS binaries inside: 15MB", "author": "codefromthecrypt", "createdAt": "2020-08-10T03:39:32Z", "path": "docker/collector/kafka/install.sh", "diffHunk": "@@ -41,4 +41,10 @@ EOF\n \n mkdir /kafka/logs\n \n+echo \"*** Cleaning Up\"\n+apk del jq curl --purge\n+# TODO: eventually cleanup irrelevant binaries from RocksDB\n+# https://issues.apache.org/jira/browse/KAFKA-10380", "originalCommit": "846c368e3483a63e581959cf02b138b14a5546db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEwNTQwNg==", "url": "https://github.com/openzipkin/zipkin/pull/3173#discussion_r468105406", "bodyText": "Good point, I don't think those binaries are required on the kafka package.", "author": "jeqo", "createdAt": "2020-08-10T18:44:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3NDc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEyNTE5Mw==", "url": "https://github.com/openzipkin/zipkin/pull/3173#discussion_r468125193", "bodyText": "Thanks for the reminder. I will check if testcontainers + zipkin kafka image can be used here to remove this dependency; similar to https://github.com/openzipkin-contrib/zipkin-storage-kafka/pull/70z", "author": "jeqo", "createdAt": "2020-08-10T19:22:16Z", "path": "zipkin-collector/kafka/pom.xml", "diffHunk": "@@ -29,6 +29,7 @@\n   <properties>\n     <main.basedir>${project.basedir}/../..</main.basedir>\n     <!-- when changing this, a change to the version of kafka-junit is likely needed, too -->\n+    <!-- TODO: update to 2.6.0 once https://github.com/charithe/kafka-junit/issues/54 is complete -->", "originalCommit": "846c368e3483a63e581959cf02b138b14a5546db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI5MDU3Mg==", "url": "https://github.com/openzipkin/zipkin/pull/3173#discussion_r468290572", "bodyText": "yeah we can use our own \"last image\" so that the version bumping matches on things like our mysql tests.", "author": "codefromthecrypt", "createdAt": "2020-08-11T02:30:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEyNTE5Mw=="}], "type": "inlineReview"}, {"oid": "4455d88c1cb21969e75eac02c2ebfd9a766fd543", "url": "https://github.com/openzipkin/zipkin/commit/4455d88c1cb21969e75eac02c2ebfd9a766fd543", "message": "use latest kafka in code too", "committedDate": "2020-08-11T02:25:56Z", "type": "commit"}]}