{"pr_number": 3012, "pr_title": "Refactors server configuration README", "pr_createdAt": "2020-03-08T01:52:48Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3012", "timeline": [{"oid": "487d24ca3a73fd8a7291bce1cc5b2308c0ed8581", "url": "https://github.com/openzipkin/zipkin/commit/487d24ca3a73fd8a7291bce1cc5b2308c0ed8581", "message": "Refactors server configuration README\n\nThis refactors the server README to remove redundant items about how we\nmap env to properties. This also adds an example of what property file\nSpring Boot will read by default for overrides: `zipkin-server.properties`.\n\nThe motivation for this is modules who have other configuration, and a\nnumber of questions over the last years about property files.", "committedDate": "2020-03-08T01:51:32Z", "type": "commit"}, {"oid": "7cd157bdda3e50ba73387055eebc0b60ef502e0f", "url": "https://github.com/openzipkin/zipkin/commit/7cd157bdda3e50ba73387055eebc0b60ef502e0f", "message": "kill trailing tick", "committedDate": "2020-03-08T02:02:20Z", "type": "commit"}, {"oid": "4a08c79d68fd1df404f5b2f9f2d03f102e23e8ff", "url": "https://github.com/openzipkin/zipkin/commit/4a08c79d68fd1df404f5b2f9f2d03f102e23e8ff", "message": "rewords heading", "committedDate": "2020-03-08T02:12:36Z", "type": "commit"}, {"oid": "8b6b40c75c16ccea38842efed1d383d7e957c809", "url": "https://github.com/openzipkin/zipkin/commit/8b6b40c75c16ccea38842efed1d383d7e957c809", "message": "iz", "committedDate": "2020-03-08T02:13:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMyOTg1Mw==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389329853", "bodyText": "I don't understand what this sentence is saying, Search may be disabled for the storage backend. Is it possible to rephrase it?", "author": "anuraaga", "createdAt": "2020-03-08T02:51:40Z", "path": "zipkin-server/README.md", "diffHunk": "@@ -100,26 +118,50 @@ counter.zipkin_collector.spans_dropped.$transport | cumulative spans dropped; re\n gauge.zipkin_collector.message_spans.$transport | last count of spans in a message\n gauge.zipkin_collector.message_bytes.$transport | last count of bytes in a message\n \n-## Self-Tracing\n-Self tracing exists to help troubleshoot performance of the zipkin-server. Production deployments\n-who enable self-tracing should lower the sample rate from 1.0 (100%) to a much smaller rate, like\n-0.001 (0.1% or 1 out of 1000).\n-\n-When Brave dependencies are in the classpath, and `zipkin.self-tracing.enabled=true`,\n-Zipkin will self-trace calls to the api.\n+## Configuration\n+We support ENV variable configuration, such as `STORAGE_TYPE=cassandra3`, as they are familiar to\n+administrators and easy to use in runtime environments such as Docker.\n \n-[yaml configuration](src/main/resources/zipkin-server-shared.yml) binds the following environment variables to spring properties:\n-\n-Variable | Property | Description\n---- | --- | ---\n-SELF_TRACING_ENABLED | zipkin.self-tracing.enabled | Set to true to enable self-tracing. Defaults to false\n-SELF_TRACING_SAMPLE_RATE`: Percentage of self-traces to retain, defaults to always sample (1.0).\n-SELF_TRACING_FLUSH_INTERVAL | zipkin.self-tracing.flush-interval | Interval in seconds to flush self-tracing data to storage. Defaults to 1\n+Here are the top-level configuration of Zipkin:\n+* `QUERY_PORT`: Listen port for the http api and web ui; Defaults to 9411\n+* `QUERY_ENABLED`: `false` disables the query api and UI assets. Search", "originalCommit": "8b6b40c75c16ccea38842efed1d383d7e957c809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMzMDExOA==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389330118", "bodyText": "this content was just moved up. I can address this now, if you think it is relevant to..", "author": "codefromthecrypt", "createdAt": "2020-03-08T02:57:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMyOTg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMzMDM0Nw==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389330347", "bodyText": "agree it is awkward.. I'll do this here as it shouldn't be too much chatter to find good text.", "author": "codefromthecrypt", "createdAt": "2020-03-08T03:02:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMyOTg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMyOTk2NQ==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389329965", "bodyText": "I think this relates to my above comment but if query is disabled isn't search always disabled? Do we need to mention storage backend?", "author": "anuraaga", "createdAt": "2020-03-08T02:54:20Z", "path": "zipkin-server/README.md", "diffHunk": "@@ -100,26 +118,50 @@ counter.zipkin_collector.spans_dropped.$transport | cumulative spans dropped; re\n gauge.zipkin_collector.message_spans.$transport | last count of spans in a message\n gauge.zipkin_collector.message_bytes.$transport | last count of bytes in a message\n \n-## Self-Tracing\n-Self tracing exists to help troubleshoot performance of the zipkin-server. Production deployments\n-who enable self-tracing should lower the sample rate from 1.0 (100%) to a much smaller rate, like\n-0.001 (0.1% or 1 out of 1000).\n-\n-When Brave dependencies are in the classpath, and `zipkin.self-tracing.enabled=true`,\n-Zipkin will self-trace calls to the api.\n+## Configuration\n+We support ENV variable configuration, such as `STORAGE_TYPE=cassandra3`, as they are familiar to\n+administrators and easy to use in runtime environments such as Docker.\n \n-[yaml configuration](src/main/resources/zipkin-server-shared.yml) binds the following environment variables to spring properties:\n-\n-Variable | Property | Description\n---- | --- | ---\n-SELF_TRACING_ENABLED | zipkin.self-tracing.enabled | Set to true to enable self-tracing. Defaults to false\n-SELF_TRACING_SAMPLE_RATE`: Percentage of self-traces to retain, defaults to always sample (1.0).\n-SELF_TRACING_FLUSH_INTERVAL | zipkin.self-tracing.flush-interval | Interval in seconds to flush self-tracing data to storage. Defaults to 1\n+Here are the top-level configuration of Zipkin:\n+* `QUERY_PORT`: Listen port for the http api and web ui; Defaults to 9411\n+* `QUERY_ENABLED`: `false` disables the query api and UI assets. Search\n+may also be disabled for the storage backend if it is not needed;\n+Defaults to true\n+* `SEARCH_ENABLED`: `false` disables trace search requests on the storage", "originalCommit": "8b6b40c75c16ccea38842efed1d383d7e957c809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMzMDEyMw==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389330123", "bodyText": "this content was just moved up. I can address this now, if you think it is relevant to..", "author": "codefromthecrypt", "createdAt": "2020-03-08T02:58:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMyOTk2NQ=="}], "type": "inlineReview"}, {"oid": "6934e5053d842724297b8c0867eacf229f90b6ac", "url": "https://github.com/openzipkin/zipkin/commit/6934e5053d842724297b8c0867eacf229f90b6ac", "message": "feedback", "committedDate": "2020-03-08T03:21:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1Mjk2Nw==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389352967", "bodyText": "I would bold custom servers are not supported.", "author": "jcchavezs", "createdAt": "2020-03-08T09:49:26Z", "path": "zipkin-server/README.md", "diffHunk": "@@ -1,9 +1,12 @@\n # zipkin-server\n-zipkin-server is a [Spring Boot](http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/) application, packaged as an executable jar. You need JRE 8+ to start zipkin-server.\n+Zipkin Server is a Java 1.8+ service, packaged as an executable jar.\n \n-Span storage and collectors are configurable. By default, storage is\n-in-memory, the http collector (POST /api/v2/spans endpoint) is enabled,\n-and the server listens on port 9411.\n+Span storage and collectors are [configurable](#configuration). By default, storage is in-memory,\n+the http collector (POST /api/v2/spans endpoint) is enabled, and the server listens on port 9411.\n+\n+Zipkin Server is implemented with [Armeria](https://github.com/line/armeria) and uses [Spring Boot](http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/)\n+internally for configuration. It should not be considered a normal Spring Boot application: custom\n+servers are not supported.", "originalCommit": "6934e5053d842724297b8c0867eacf229f90b6ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMzY0Nw==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389423647", "bodyText": "good point", "author": "codefromthecrypt", "createdAt": "2020-03-09T00:35:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1Mjk2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyNDcwNg==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389424706", "bodyText": "\ud83e\udd23", "author": "minwoox", "createdAt": "2020-03-09T00:46:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1Mjk2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMDA4OA==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389400088", "bodyText": "nit: HTTP API and Web UI to be consistent with the next paragraph?", "author": "jcchavezs", "createdAt": "2020-03-08T19:57:51Z", "path": "zipkin-server/README.md", "diffHunk": "@@ -100,26 +118,50 @@ counter.zipkin_collector.spans_dropped.$transport | cumulative spans dropped; re\n gauge.zipkin_collector.message_spans.$transport | last count of spans in a message\n gauge.zipkin_collector.message_bytes.$transport | last count of bytes in a message\n \n-## Self-Tracing\n-Self tracing exists to help troubleshoot performance of the zipkin-server. Production deployments\n-who enable self-tracing should lower the sample rate from 1.0 (100%) to a much smaller rate, like\n-0.001 (0.1% or 1 out of 1000).\n-\n-When Brave dependencies are in the classpath, and `zipkin.self-tracing.enabled=true`,\n-Zipkin will self-trace calls to the api.\n-\n-[yaml configuration](src/main/resources/zipkin-server-shared.yml) binds the following environment variables to spring properties:\n+## Configuration\n+We support ENV variable configuration, such as `STORAGE_TYPE=cassandra3`, as they are familiar to\n+administrators and easy to use in runtime environments such as Docker.\n \n-Variable | Property | Description\n---- | --- | ---\n-SELF_TRACING_ENABLED | zipkin.self-tracing.enabled | Set to true to enable self-tracing. Defaults to false\n-SELF_TRACING_SAMPLE_RATE`: Percentage of self-traces to retain, defaults to always sample (1.0).\n-SELF_TRACING_FLUSH_INTERVAL | zipkin.self-tracing.flush-interval | Interval in seconds to flush self-tracing data to storage. Defaults to 1\n+Here are the top-level configuration of Zipkin:\n+* `QUERY_PORT`: Listen port for the http api and web ui; Defaults to 9411", "originalCommit": "6934e5053d842724297b8c0867eacf229f90b6ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMzYzNw==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389423637", "bodyText": "done everywhere", "author": "codefromthecrypt", "createdAt": "2020-03-09T00:35:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMDA4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMDMwOA==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389400308", "bodyText": "How about specifying what is the name of the service or how to find such traces?", "author": "jcchavezs", "createdAt": "2020-03-08T20:00:50Z", "path": "zipkin-server/README.md", "diffHunk": "@@ -459,6 +477,19 @@ $ COLLECTOR_GRPC_ENABLED=true java -jar zipkin.jar\n \n As this service is experimental, it is not recommended to run this in production environments.\n \n+## Self-Tracing\n+Self tracing exists to help troubleshoot performance of the zipkin-server. Production deployments\n+who enable self-tracing should lower the sample rate from 1.0 (100%) to a much smaller rate, like\n+0.001 (0.1% or 1 out of 1000).\n+\n+When `zipkin.self-tracing.enabled=true`, Zipkin will self-trace calls to the api.", "originalCommit": "6934e5053d842724297b8c0867eacf229f90b6ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMzYyMg==", "url": "https://github.com/openzipkin/zipkin/pull/3012#discussion_r389423622", "bodyText": "done!", "author": "codefromthecrypt", "createdAt": "2020-03-09T00:35:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMDMwOA=="}], "type": "inlineReview"}, {"oid": "4a10aa1691e1deb5fcd94fb49707f8a8da167dd9", "url": "https://github.com/openzipkin/zipkin/commit/4a10aa1691e1deb5fcd94fb49707f8a8da167dd9", "message": "feedback", "committedDate": "2020-03-09T00:35:48Z", "type": "commit"}]}