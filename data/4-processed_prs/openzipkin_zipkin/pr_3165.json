{"pr_number": 3165, "pr_title": "Adjusts Docker HEALTHCHECK for Kafka from 2s to 5s timeout", "pr_createdAt": "2020-08-06T01:53:05Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3165", "timeline": [{"oid": "c6a55b00ef39b0ad5e8e792781fc13dc95e77304", "url": "https://github.com/openzipkin/zipkin/commit/c6a55b00ef39b0ad5e8e792781fc13dc95e77304", "message": "Adjusts Docker HEALTHCHECK for Kafka from 2s to 5s timeout\n\nThis helps avoid annoying flakes, or having people need to override our\ndefaults.", "committedDate": "2020-08-06T01:51:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA5OTUxNw==", "url": "https://github.com/openzipkin/zipkin/pull/3165#discussion_r466099517", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Compose, `kafka-topics.sh` was failed on 2s timeout after succeeding, causing a condition to break\n          \n          \n            \n            Compose, `kafka-topics.sh` timed out after 2s even though the prior run succeeded. This broke a condition", "author": "codefromthecrypt", "createdAt": "2020-08-06T01:54:20Z", "path": "docker/RATIONALE.md", "diffHunk": "@@ -15,3 +15,17 @@ Ex. The following command can be used ad-hoc or in scripts without the user know\n $ docker inspect --format='{{json .State.Health.Status}}' kafka-zookeeper\n \"unhealthy\"\n ```\n+\n+### Why default timeout to 5s for Kafka HEALTHCHECK?\n+\n+Docker `HEALTHCHECK` marks a container unhealthy on the first failure that occurs past its start\n+period. It is important to avoid false negatives that are host contention in nature, as they can\n+break orchestration such as docker-compose.\n+\n+Commands like `nc` will almost never timeout launching due to contention, even if they might timeout\n+on network connections themselves for the same reason.\n+\n+`kafka-topics.sh` uses Java and a relatively large classpath. It can be slow when many other\n+processes are starting at the same time. For example, when launching many containers in Docker\n+Compose, `kafka-topics.sh` was failed on 2s timeout after succeeding, causing a condition to break", "originalCommit": "c6a55b00ef39b0ad5e8e792781fc13dc95e77304", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3680748ec5e7f0c9830971f3af7fc130c357304f", "url": "https://github.com/openzipkin/zipkin/commit/3680748ec5e7f0c9830971f3af7fc130c357304f", "message": "Update docker/RATIONALE.md", "committedDate": "2020-08-06T01:55:18Z", "type": "commit"}]}