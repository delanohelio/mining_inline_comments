{"pr_number": 3038, "pr_title": "Default unsupported locales to English.", "pr_createdAt": "2020-03-17T08:46:01Z", "pr_url": "https://github.com/openzipkin/zipkin/pull/3038", "timeline": [{"oid": "ec21b7589a536d2aebc22f57e55be5b413d462cc", "url": "https://github.com/openzipkin/zipkin/commit/ec21b7589a536d2aebc22f57e55be5b413d462cc", "message": "Default unsupported locales to English.", "committedDate": "2020-03-17T08:44:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUyMTcyNQ==", "url": "https://github.com/openzipkin/zipkin/pull/3038#discussion_r393521725", "bodyText": "guessing this is the key", "author": "codefromthecrypt", "createdAt": "2020-03-17T08:47:47Z", "path": "zipkin-lens/src/util/locale.ts", "diffHunk": "@@ -12,25 +12,49 @@\n  * the License.\n  */\n \n+import { Catalogs, setupI18n } from '@lingui/core';\n+\n+import enMessages from '../translations/en/messages';\n+import esMessages from '../translations/es/messages';\n+import zhCnMessages from '../translations/zh-cn/messages';\n+\n const localeStorageKey = 'localeOverride';\n \n+const catalogs = {\n+  en: enMessages,\n+  es: esMessages,\n+  'zh-cn': zhCnMessages,\n+};\n+\n export function getLocale(): string {\n   const override = localStorage.getItem(localeStorageKey);\n   if (override) {\n     return override;\n   }\n+\n   const browserLanguage = navigator.language.toLowerCase();\n-  // Strip browser language to what we support.\n-  if (browserLanguage === 'en' || browserLanguage.startsWith('en-')) {\n-    return 'en';\n+\n+  if (catalogs.hasOwnProperty(browserLanguage)) {\n+    return browserLanguage;\n   }\n-  if (browserLanguage === 'zh-cn') {\n-    return 'zh-cn';\n+\n+  const hyphenIndex = browserLanguage.indexOf('-');\n+  if (hyphenIndex >= 0) {\n+    const stripped = browserLanguage.substring(0, hyphenIndex);\n+    if (catalogs.hasOwnProperty(stripped)) {\n+      return stripped;\n+    }\n   }\n \n-  return browserLanguage;\n+  // Default to English if we don't support the current browser language.\n+  return 'en';", "originalCommit": "ec21b7589a536d2aebc22f57e55be5b413d462cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9fd07fd44d63c0e9ed6b4f1b1d5ffeb1b6e6003c", "url": "https://github.com/openzipkin/zipkin/commit/9fd07fd44d63c0e9ed6b4f1b1d5ffeb1b6e6003c", "message": "Lint", "committedDate": "2020-03-17T08:53:27Z", "type": "commit"}, {"oid": "2f46eda49fcaaa5b2805f921fa05c4ad93615d9f", "url": "https://github.com/openzipkin/zipkin/commit/2f46eda49fcaaa5b2805f921fa05c4ad93615d9f", "message": "Wait for scribe on all tests not just success.", "committedDate": "2020-03-18T05:23:05Z", "type": "commit"}]}