{"pr_number": 10345, "pr_title": "Improving test coverage for SCIM2 paginations", "pr_createdAt": "2020-11-05T11:42:37Z", "pr_url": "https://github.com/wso2/product-is/pull/10345", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0ODg3Mw==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r521248873", "bodyText": "Remove souts...", "author": "sumedhe", "createdAt": "2020-11-11T10:06:20Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,228 @@\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.*;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.*;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    private CloseableHttpClient client;\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE=\"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE=\"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+\n+    private String adminUsername;\n+    private String adminPassword;\n+    private String tenant;\n+    private TestUserMode testUserMode;\n+\n+    List<String> userIds = new ArrayList<>();\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    public SCIM2PaginationTestCase() throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", TestUserMode.TENANT_ADMIN);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+        testUserMode = TestUserMode.TENANT_ADMIN;\n+    }\n+\n+    //validate user listing with pagination\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+        HttpGet request = new HttpGet(getUserPath()+\"?startIndex=\"+START_INDEX+\"&count=\"+COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT,\"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, START_INDEX,\"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, COUNT,\"itemsPerPage in pagination listing is incorrect\");\n+\n+        System.out.println(responseObj.toString());", "originalCommit": "b77550f9493118ceaae64bfc910b14ae7c0cbbe0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTc1OTAyMw==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r571759023", "bodyText": "Use each imports instead *", "author": "sumedhe", "createdAt": "2021-02-08T03:18:07Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,225 @@\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.*;", "originalCommit": "3c194fea01c9c1faa0a5face247640554b241f77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjgyOTM5OQ==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r576829399", "bodyText": "Use each imports instead", "author": "sumedhe", "createdAt": "2021-02-16T13:39:55Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Array;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.*;", "originalCommit": "ee355961ea40bda9032990303661fe81995579aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjgyOTkwMw==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r576829903", "bodyText": "Add a new line after the method signature", "author": "sumedhe", "createdAt": "2021-02-16T13:40:42Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Array;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.*;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    private CloseableHttpClient client;\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE=\"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE=\"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    private final int tenantUserCount;\n+\n+    List<String> userIds = new ArrayList<>();\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+        tenantUserCount=context.getContextTenant().getTenantUserList().size();\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][] {\n+                { TestUserMode.SUPER_TENANT_ADMIN }, { TestUserMode.TENANT_ADMIN }\n+        };\n+    }\n+\n+    //validate user listing with pagination\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {", "originalCommit": "ee355961ea40bda9032990303661fe81995579aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjgzMDM2Ng==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r576830366", "bodyText": "Add spaces when joining with \"+\"", "author": "sumedhe", "createdAt": "2021-02-16T13:41:21Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Array;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.*;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    private CloseableHttpClient client;\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE=\"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE=\"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    private final int tenantUserCount;\n+\n+    List<String> userIds = new ArrayList<>();\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+        tenantUserCount=context.getContextTenant().getTenantUserList().size();\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][] {\n+                { TestUserMode.SUPER_TENANT_ADMIN }, { TestUserMode.TENANT_ADMIN }\n+        };\n+    }\n+\n+    //validate user listing with pagination\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+        HttpGet request = new HttpGet(getUserPath()+\"?startIndex=\"+START_INDEX+\"&count=\"+COUNT);", "originalCommit": "ee355961ea40bda9032990303661fe81995579aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjgzMTExNw==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r576831117", "bodyText": "Comment start with capital. End with dot..", "author": "sumedhe", "createdAt": "2021-02-16T13:42:30Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Array;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.*;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    private CloseableHttpClient client;\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE=\"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE=\"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    private final int tenantUserCount;\n+\n+    List<String> userIds = new ArrayList<>();\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+        tenantUserCount=context.getContextTenant().getTenantUserList().size();\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][] {\n+                { TestUserMode.SUPER_TENANT_ADMIN }, { TestUserMode.TENANT_ADMIN }\n+        };\n+    }\n+\n+    //validate user listing with pagination\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+        HttpGet request = new HttpGet(getUserPath()+\"?startIndex=\"+START_INDEX+\"&count=\"+COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT,\"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, START_INDEX,\"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, COUNT,\"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray)((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(String.valueOf(resourcesSize),COUNT,\"resources size in pagination listing is incorrect\");\n+\n+    }\n+\n+    // validating legacy behavior support (returning all the results for not specified list param)", "originalCommit": "ee355961ea40bda9032990303661fe81995579aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjgzMTU0Nw==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r576831547", "bodyText": "Space after comman.. Fix similar places.", "author": "sumedhe", "createdAt": "2021-02-16T13:43:14Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Array;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.*;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    private CloseableHttpClient client;\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE=\"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE=\"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    private final int tenantUserCount;\n+\n+    List<String> userIds = new ArrayList<>();\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+        tenantUserCount=context.getContextTenant().getTenantUserList().size();\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][] {\n+                { TestUserMode.SUPER_TENANT_ADMIN }, { TestUserMode.TENANT_ADMIN }\n+        };\n+    }\n+\n+    //validate user listing with pagination\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+        HttpGet request = new HttpGet(getUserPath()+\"?startIndex=\"+START_INDEX+\"&count=\"+COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT,\"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, START_INDEX,\"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, COUNT,\"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray)((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(String.valueOf(resourcesSize),COUNT,\"resources size in pagination listing is incorrect\");\n+\n+    }\n+\n+    // validating legacy behavior support (returning all the results for not specified list param)\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPaginationWithoutParams() throws Exception {\n+\n+        // current no of users is equal to number of users created  + tenant context users + tenant admin user\n+        int currentUsers=userIds.size()+tenantUserCount + 1;\n+\n+        HttpGet request = new HttpGet(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, String.valueOf(currentUsers),\"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, \"1\",\"startIndex in pagination listing is incorrect\");", "originalCommit": "ee355961ea40bda9032990303661fe81995579aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjgzMTY5Ng==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r576831696", "bodyText": "Redundant newline", "author": "sumedhe", "createdAt": "2021-02-16T13:43:27Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,241 @@\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Array;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.*;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    private CloseableHttpClient client;\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE=\"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE=\"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    private final int tenantUserCount;\n+\n+    List<String> userIds = new ArrayList<>();\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+        tenantUserCount=context.getContextTenant().getTenantUserList().size();\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][] {\n+                { TestUserMode.SUPER_TENANT_ADMIN }, { TestUserMode.TENANT_ADMIN }\n+        };\n+    }\n+\n+    //validate user listing with pagination\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+        HttpGet request = new HttpGet(getUserPath()+\"?startIndex=\"+START_INDEX+\"&count=\"+COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT,\"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, START_INDEX,\"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, COUNT,\"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray)((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(String.valueOf(resourcesSize),COUNT,\"resources size in pagination listing is incorrect\");\n+\n+    }\n+\n+    // validating legacy behavior support (returning all the results for not specified list param)\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPaginationWithoutParams() throws Exception {\n+\n+        // current no of users is equal to number of users created  + tenant context users + tenant admin user\n+        int currentUsers=userIds.size()+tenantUserCount + 1;\n+\n+        HttpGet request = new HttpGet(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, String.valueOf(currentUsers),\"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, \"1\",\"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, String.valueOf(currentUsers),\"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray)((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(resourcesSize,currentUsers,\"resources size in pagination listing is incorrect\");\n+\n+    }\n+\n+    @Test\n+    public void testCreateUser() throws Exception {\n+\n+        for (int i = 0; i < 10; i++) {\n+            createUser(\"Family\"+i, \"user\"+i, \"user\"+i,\n+                    \"user\"+i+\"@gmail.com\", \"user\"+i+\"@gmail.com\", \"dummyPW\"+i);\n+        }\n+    }\n+\n+    private void createUser(String familyName, String givenName, String userName, String workEmail, String homeEmail,\n+                            String password) throws IOException {\n+\n+        HttpPost request = new HttpPost(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        JSONObject rootObject = new JSONObject();\n+\n+        JSONArray schemas = new JSONArray();\n+        rootObject.put(SCHEMAS_ATTRIBUTE, schemas);\n+\n+        JSONObject names = new JSONObject();\n+        names.put(FAMILY_NAME_ATTRIBUTE, familyName);\n+        names.put(GIVEN_NAME_ATTRIBUTE, givenName);\n+\n+        rootObject.put(NAME_ATTRIBUTE, names);\n+        rootObject.put(USER_NAME_ATTRIBUTE, userName);\n+\n+        JSONObject emailWork = new JSONObject();\n+        emailWork.put(TYPE_PARAM, EMAIL_TYPE_WORK_ATTRIBUTE);\n+        emailWork.put(VALUE_PARAM, workEmail);\n+\n+        JSONObject emailHome = new JSONObject();\n+        emailHome.put(TYPE_PARAM, EMAIL_TYPE_HOME_ATTRIBUTE);\n+        emailHome.put(VALUE_PARAM, homeEmail);\n+\n+        JSONArray emails = new JSONArray();\n+        emails.add(emailWork);\n+        emails.add(emailHome);\n+\n+        rootObject.put(EMAILS_ATTRIBUTE, emails);\n+\n+        rootObject.put(PASSWORD_ATTRIBUTE, password);\n+\n+        StringEntity entity = new StringEntity(rootObject.toString());\n+        request.setEntity(entity);\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 201, \"User has not been created successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String usernameFromResponse = ((JSONObject) responseObj).get(USER_NAME_ATTRIBUTE).toString();\n+        assertEquals(usernameFromResponse, userName);\n+\n+        String userId;\n+        userId = ((JSONObject) responseObj).get(ID_ATTRIBUTE).toString();\n+        userIds.add(userId);\n+        assertNotNull(userId);\n+    }\n+", "originalCommit": "ee355961ea40bda9032990303661fe81995579aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c0e8118430815079d6a22ea2328a79be52c1d4db", "url": "https://github.com/wso2/product-is/commit/c0e8118430815079d6a22ea2328a79be52c1d4db", "message": "added SCIM2 pagination test cases", "committedDate": "2021-02-22T09:18:55Z", "type": "commit"}, {"oid": "c0e8118430815079d6a22ea2328a79be52c1d4db", "url": "https://github.com/wso2/product-is/commit/c0e8118430815079d6a22ea2328a79be52c1d4db", "message": "added SCIM2 pagination test cases", "committedDate": "2021-02-22T09:18:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQzNzE3MA==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585437170", "bodyText": "Year 2020 --> 2021", "author": "Pushpalanka", "createdAt": "2021-03-02T10:16:44Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,307 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "c0e8118430815079d6a22ea2328a79be52c1d4db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTU2NTIxNg==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585565216", "bodyText": "done", "author": "EANimesha", "createdAt": "2021-03-02T13:30:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQzNzE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQzODMzNg==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585438336", "bodyText": "Ending dot of the sentense is required for the message.", "author": "Pushpalanka", "createdAt": "2021-03-02T10:18:18Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,307 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.integration.common.utils.LoginLogoutClient;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.clients.UserManagementClient;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.testng.Assert.assertTrue;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAILS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_HOME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_WORK_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.FAMILY_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.GIVEN_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.ID_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.PASSWORD_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCHEMAS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCIM2_USERS_ENDPOINT;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SERVER_URL;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.TYPE_PARAM;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.USER_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.VALUE_PARAM;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE = \"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE = \"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    List<String> userIds = new ArrayList<>();\n+    UserManagementClient userMgtClient;\n+    AutomationContext automationContext;\n+    String backendUrl = null;\n+    String sessionCookie = null;\n+    private CloseableHttpClient client;\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+\n+        automationContext = new AutomationContext(\"IDENTITY\", userMode);\n+        backendUrl = automationContext.getContextUrls().getBackEndUrl();\n+        sessionCookie = new LoginLogoutClient(automationContext).login();\n+        userMgtClient = new UserManagementClient(backendUrl, sessionCookie);\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][]{\n+                {TestUserMode.SUPER_TENANT_ADMIN}, {TestUserMode.TENANT_ADMIN}\n+        };\n+    }\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    /*\n+    Validate user listing with pagination.\n+    */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+\n+        HttpGet request = new HttpGet(getUserPath() + \"?startIndex=\" + START_INDEX + \"&count=\" + COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");", "originalCommit": "c0e8118430815079d6a22ea2328a79be52c1d4db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTU2NTQ2Mg==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585565462", "bodyText": "done", "author": "EANimesha", "createdAt": "2021-03-02T13:31:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQzODMzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQzODU5Ng==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585438596", "bodyText": "Ending dot of the sentense is required for the message. Use the sentense case with first letter Capital.", "author": "Pushpalanka", "createdAt": "2021-03-02T10:18:40Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,307 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.integration.common.utils.LoginLogoutClient;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.clients.UserManagementClient;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.testng.Assert.assertTrue;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAILS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_HOME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_WORK_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.FAMILY_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.GIVEN_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.ID_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.PASSWORD_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCHEMAS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCIM2_USERS_ENDPOINT;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SERVER_URL;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.TYPE_PARAM;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.USER_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.VALUE_PARAM;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE = \"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE = \"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    List<String> userIds = new ArrayList<>();\n+    UserManagementClient userMgtClient;\n+    AutomationContext automationContext;\n+    String backendUrl = null;\n+    String sessionCookie = null;\n+    private CloseableHttpClient client;\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+\n+        automationContext = new AutomationContext(\"IDENTITY\", userMode);\n+        backendUrl = automationContext.getContextUrls().getBackEndUrl();\n+        sessionCookie = new LoginLogoutClient(automationContext).login();\n+        userMgtClient = new UserManagementClient(backendUrl, sessionCookie);\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][]{\n+                {TestUserMode.SUPER_TENANT_ADMIN}, {TestUserMode.TENANT_ADMIN}\n+        };\n+    }\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    /*\n+    Validate user listing with pagination.\n+    */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+\n+        HttpGet request = new HttpGet(getUserPath() + \"?startIndex=\" + START_INDEX + \"&count=\" + COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT, \"total results in pagination listing is incorrect\");", "originalCommit": "c0e8118430815079d6a22ea2328a79be52c1d4db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQzODc5NQ==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585438795", "bodyText": "Check other places as well and correct.", "author": "Pushpalanka", "createdAt": "2021-03-02T10:18:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQzODU5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTU2NTU2OA==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585565568", "bodyText": "done", "author": "EANimesha", "createdAt": "2021-03-02T13:31:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQzODU5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQzOTcyMA==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585439720", "bodyText": "Shall we improve readability here. Use of String.format() can be helpful.", "author": "Pushpalanka", "createdAt": "2021-03-02T10:20:17Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,307 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.integration.common.utils.LoginLogoutClient;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.clients.UserManagementClient;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.testng.Assert.assertTrue;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAILS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_HOME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_WORK_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.FAMILY_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.GIVEN_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.ID_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.PASSWORD_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCHEMAS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCIM2_USERS_ENDPOINT;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SERVER_URL;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.TYPE_PARAM;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.USER_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.VALUE_PARAM;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE = \"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE = \"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    List<String> userIds = new ArrayList<>();\n+    UserManagementClient userMgtClient;\n+    AutomationContext automationContext;\n+    String backendUrl = null;\n+    String sessionCookie = null;\n+    private CloseableHttpClient client;\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+\n+        automationContext = new AutomationContext(\"IDENTITY\", userMode);\n+        backendUrl = automationContext.getContextUrls().getBackEndUrl();\n+        sessionCookie = new LoginLogoutClient(automationContext).login();\n+        userMgtClient = new UserManagementClient(backendUrl, sessionCookie);\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][]{\n+                {TestUserMode.SUPER_TENANT_ADMIN}, {TestUserMode.TENANT_ADMIN}\n+        };\n+    }\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    /*\n+    Validate user listing with pagination.\n+    */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+\n+        HttpGet request = new HttpGet(getUserPath() + \"?startIndex=\" + START_INDEX + \"&count=\" + COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT, \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, START_INDEX, \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, COUNT, \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(String.valueOf(resourcesSize), COUNT, \"resources size in pagination listing is incorrect\");\n+\n+    }\n+\n+    /*\n+    Validating legacy behavior support (returning all the results for not specified list param).\n+     */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPaginationWithoutParams() throws Exception {\n+\n+        int currentUsers = getCurrentUsersCount();\n+\n+        HttpGet request = new HttpGet(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        JSONArray resourcesResponse = (JSONArray) ((JSONObject) ((Object) responseObj)).get(RESOURCES_ATTRIBUTE);\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, String.valueOf(currentUsers), \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, \"1\", \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, String.valueOf(currentUsers), \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(resourcesSize, currentUsers, \"resources size in pagination listing is incorrect\");\n+\n+        assertTrue(isAllUsersExists(resourcesResponse));\n+\n+    }\n+\n+    @Test\n+    public void testCreateUser() throws Exception {\n+\n+        for (int i = 0; i < 10; i++) {\n+            createUser(\"Family\" + i, \"user\" + i, \"user\" + i,", "originalCommit": "c0e8118430815079d6a22ea2328a79be52c1d4db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQ0MDU2NQ==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585440565", "bodyText": "Java variable naming convention matters. userExists --> isUserExist", "author": "Pushpalanka", "createdAt": "2021-03-02T10:21:32Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,307 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.integration.common.utils.LoginLogoutClient;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.clients.UserManagementClient;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.testng.Assert.assertTrue;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAILS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_HOME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_WORK_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.FAMILY_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.GIVEN_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.ID_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.PASSWORD_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCHEMAS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCIM2_USERS_ENDPOINT;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SERVER_URL;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.TYPE_PARAM;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.USER_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.VALUE_PARAM;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE = \"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE = \"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    List<String> userIds = new ArrayList<>();\n+    UserManagementClient userMgtClient;\n+    AutomationContext automationContext;\n+    String backendUrl = null;\n+    String sessionCookie = null;\n+    private CloseableHttpClient client;\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+\n+        automationContext = new AutomationContext(\"IDENTITY\", userMode);\n+        backendUrl = automationContext.getContextUrls().getBackEndUrl();\n+        sessionCookie = new LoginLogoutClient(automationContext).login();\n+        userMgtClient = new UserManagementClient(backendUrl, sessionCookie);\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][]{\n+                {TestUserMode.SUPER_TENANT_ADMIN}, {TestUserMode.TENANT_ADMIN}\n+        };\n+    }\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    /*\n+    Validate user listing with pagination.\n+    */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+\n+        HttpGet request = new HttpGet(getUserPath() + \"?startIndex=\" + START_INDEX + \"&count=\" + COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT, \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, START_INDEX, \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, COUNT, \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(String.valueOf(resourcesSize), COUNT, \"resources size in pagination listing is incorrect\");\n+\n+    }\n+\n+    /*\n+    Validating legacy behavior support (returning all the results for not specified list param).\n+     */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPaginationWithoutParams() throws Exception {\n+\n+        int currentUsers = getCurrentUsersCount();\n+\n+        HttpGet request = new HttpGet(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        JSONArray resourcesResponse = (JSONArray) ((JSONObject) ((Object) responseObj)).get(RESOURCES_ATTRIBUTE);\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, String.valueOf(currentUsers), \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, \"1\", \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, String.valueOf(currentUsers), \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(resourcesSize, currentUsers, \"resources size in pagination listing is incorrect\");\n+\n+        assertTrue(isAllUsersExists(resourcesResponse));\n+\n+    }\n+\n+    @Test\n+    public void testCreateUser() throws Exception {\n+\n+        for (int i = 0; i < 10; i++) {\n+            createUser(\"Family\" + i, \"user\" + i, \"user\" + i,\n+                    \"user\" + i + \"@gmail.com\", \"user\" + i + \"@gmail.com\", \"dummyPW\" + i);\n+        }\n+    }\n+\n+    private void createUser(String familyName, String givenName, String userName, String workEmail, String homeEmail,\n+                            String password) throws IOException {\n+\n+        HttpPost request = new HttpPost(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        JSONObject rootObject = new JSONObject();\n+\n+        JSONArray schemas = new JSONArray();\n+        rootObject.put(SCHEMAS_ATTRIBUTE, schemas);\n+\n+        JSONObject names = new JSONObject();\n+        names.put(FAMILY_NAME_ATTRIBUTE, familyName);\n+        names.put(GIVEN_NAME_ATTRIBUTE, givenName);\n+\n+        rootObject.put(NAME_ATTRIBUTE, names);\n+        rootObject.put(USER_NAME_ATTRIBUTE, userName);\n+\n+        JSONObject emailWork = new JSONObject();\n+        emailWork.put(TYPE_PARAM, EMAIL_TYPE_WORK_ATTRIBUTE);\n+        emailWork.put(VALUE_PARAM, workEmail);\n+\n+        JSONObject emailHome = new JSONObject();\n+        emailHome.put(TYPE_PARAM, EMAIL_TYPE_HOME_ATTRIBUTE);\n+        emailHome.put(VALUE_PARAM, homeEmail);\n+\n+        JSONArray emails = new JSONArray();\n+        emails.add(emailWork);\n+        emails.add(emailHome);\n+\n+        rootObject.put(EMAILS_ATTRIBUTE, emails);\n+\n+        rootObject.put(PASSWORD_ATTRIBUTE, password);\n+\n+        StringEntity entity = new StringEntity(rootObject.toString());\n+        request.setEntity(entity);\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 201, \"User has not been created successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String usernameFromResponse = ((JSONObject) responseObj).get(USER_NAME_ATTRIBUTE).toString();\n+        assertEquals(usernameFromResponse, userName);\n+\n+        String userId;\n+        userId = ((JSONObject) responseObj).get(ID_ATTRIBUTE).toString();\n+        userIds.add(userId);\n+        assertNotNull(userId);\n+    }\n+\n+    @Test(dependsOnMethods = {\"testUserListingPagination\", \"testUserListingPaginationWithoutParams\"})\n+    public void testDeleteUser() throws Exception {\n+\n+        for (String userId : userIds) {\n+            deleteUser(userId);\n+        }\n+    }\n+\n+    private void deleteUser(String userId) throws IOException {\n+\n+        String userResourcePath = getUserPath() + \"/\" + userId;\n+        HttpDelete request = new HttpDelete(userResourcePath);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 204, \"User has not been retrieved successfully\");\n+\n+        EntityUtils.consume(response.getEntity());\n+\n+        userResourcePath = getUserPath() + \"/\" + userId;\n+        HttpGet getRequest = new HttpGet(userResourcePath);\n+        getRequest.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        getRequest.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 404, \"User has not been deleted successfully\");\n+        EntityUtils.consume(response.getEntity());\n+    }\n+\n+    private int getCurrentUsersCount() throws Exception {\n+\n+        return userMgtClient.getUserList().size();\n+    }\n+\n+    private boolean isAllUsersExists(JSONArray response) throws Exception {\n+\n+        boolean usersExists = false;", "originalCommit": "c0e8118430815079d6a22ea2328a79be52c1d4db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTU2NTgzMQ==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585565831", "bodyText": "done", "author": "EANimesha", "createdAt": "2021-03-02T13:31:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQ0MDU2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQ0MTM2Nw==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585441367", "bodyText": "Wrong code formatting. Please use the wso2 coding style.", "author": "Pushpalanka", "createdAt": "2021-03-02T10:22:44Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,307 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.integration.common.utils.LoginLogoutClient;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.clients.UserManagementClient;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.testng.Assert.assertTrue;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAILS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_HOME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_WORK_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.FAMILY_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.GIVEN_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.ID_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.PASSWORD_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCHEMAS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCIM2_USERS_ENDPOINT;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SERVER_URL;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.TYPE_PARAM;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.USER_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.VALUE_PARAM;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE = \"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE = \"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    List<String> userIds = new ArrayList<>();\n+    UserManagementClient userMgtClient;\n+    AutomationContext automationContext;\n+    String backendUrl = null;\n+    String sessionCookie = null;\n+    private CloseableHttpClient client;\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+\n+        automationContext = new AutomationContext(\"IDENTITY\", userMode);\n+        backendUrl = automationContext.getContextUrls().getBackEndUrl();\n+        sessionCookie = new LoginLogoutClient(automationContext).login();\n+        userMgtClient = new UserManagementClient(backendUrl, sessionCookie);\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][]{\n+                {TestUserMode.SUPER_TENANT_ADMIN}, {TestUserMode.TENANT_ADMIN}\n+        };\n+    }\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    /*\n+    Validate user listing with pagination.\n+    */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+\n+        HttpGet request = new HttpGet(getUserPath() + \"?startIndex=\" + START_INDEX + \"&count=\" + COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT, \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, START_INDEX, \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, COUNT, \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(String.valueOf(resourcesSize), COUNT, \"resources size in pagination listing is incorrect\");\n+\n+    }\n+\n+    /*\n+    Validating legacy behavior support (returning all the results for not specified list param).\n+     */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPaginationWithoutParams() throws Exception {\n+\n+        int currentUsers = getCurrentUsersCount();\n+\n+        HttpGet request = new HttpGet(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        JSONArray resourcesResponse = (JSONArray) ((JSONObject) ((Object) responseObj)).get(RESOURCES_ATTRIBUTE);\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, String.valueOf(currentUsers), \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, \"1\", \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, String.valueOf(currentUsers), \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(resourcesSize, currentUsers, \"resources size in pagination listing is incorrect\");\n+\n+        assertTrue(isAllUsersExists(resourcesResponse));\n+\n+    }\n+\n+    @Test\n+    public void testCreateUser() throws Exception {\n+\n+        for (int i = 0; i < 10; i++) {\n+            createUser(\"Family\" + i, \"user\" + i, \"user\" + i,\n+                    \"user\" + i + \"@gmail.com\", \"user\" + i + \"@gmail.com\", \"dummyPW\" + i);\n+        }\n+    }\n+\n+    private void createUser(String familyName, String givenName, String userName, String workEmail, String homeEmail,\n+                            String password) throws IOException {\n+\n+        HttpPost request = new HttpPost(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        JSONObject rootObject = new JSONObject();\n+\n+        JSONArray schemas = new JSONArray();\n+        rootObject.put(SCHEMAS_ATTRIBUTE, schemas);\n+\n+        JSONObject names = new JSONObject();\n+        names.put(FAMILY_NAME_ATTRIBUTE, familyName);\n+        names.put(GIVEN_NAME_ATTRIBUTE, givenName);\n+\n+        rootObject.put(NAME_ATTRIBUTE, names);\n+        rootObject.put(USER_NAME_ATTRIBUTE, userName);\n+\n+        JSONObject emailWork = new JSONObject();\n+        emailWork.put(TYPE_PARAM, EMAIL_TYPE_WORK_ATTRIBUTE);\n+        emailWork.put(VALUE_PARAM, workEmail);\n+\n+        JSONObject emailHome = new JSONObject();\n+        emailHome.put(TYPE_PARAM, EMAIL_TYPE_HOME_ATTRIBUTE);\n+        emailHome.put(VALUE_PARAM, homeEmail);\n+\n+        JSONArray emails = new JSONArray();\n+        emails.add(emailWork);\n+        emails.add(emailHome);\n+\n+        rootObject.put(EMAILS_ATTRIBUTE, emails);\n+\n+        rootObject.put(PASSWORD_ATTRIBUTE, password);\n+\n+        StringEntity entity = new StringEntity(rootObject.toString());\n+        request.setEntity(entity);\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 201, \"User has not been created successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String usernameFromResponse = ((JSONObject) responseObj).get(USER_NAME_ATTRIBUTE).toString();\n+        assertEquals(usernameFromResponse, userName);\n+\n+        String userId;\n+        userId = ((JSONObject) responseObj).get(ID_ATTRIBUTE).toString();\n+        userIds.add(userId);\n+        assertNotNull(userId);\n+    }\n+\n+    @Test(dependsOnMethods = {\"testUserListingPagination\", \"testUserListingPaginationWithoutParams\"})\n+    public void testDeleteUser() throws Exception {\n+\n+        for (String userId : userIds) {\n+            deleteUser(userId);\n+        }\n+    }\n+\n+    private void deleteUser(String userId) throws IOException {\n+\n+        String userResourcePath = getUserPath() + \"/\" + userId;\n+        HttpDelete request = new HttpDelete(userResourcePath);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 204, \"User has not been retrieved successfully\");\n+\n+        EntityUtils.consume(response.getEntity());\n+\n+        userResourcePath = getUserPath() + \"/\" + userId;\n+        HttpGet getRequest = new HttpGet(userResourcePath);\n+        getRequest.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        getRequest.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 404, \"User has not been deleted successfully\");\n+        EntityUtils.consume(response.getEntity());\n+    }\n+\n+    private int getCurrentUsersCount() throws Exception {\n+\n+        return userMgtClient.getUserList().size();\n+    }\n+\n+    private boolean isAllUsersExists(JSONArray response) throws Exception {\n+\n+        boolean usersExists = false;\n+        HashSet<String> usersList = new HashSet<>();\n+        for (Object user : response\n+        ) {", "originalCommit": "c0e8118430815079d6a22ea2328a79be52c1d4db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTU2NjAzMg==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585566032", "bodyText": "added", "author": "EANimesha", "createdAt": "2021-03-02T13:32:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQ0MTM2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQ0MTczNA==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585441734", "bodyText": "Initiate to Set<>. Use the parent collection at declaration.", "author": "Pushpalanka", "createdAt": "2021-03-02T10:23:18Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,307 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.integration.common.utils.LoginLogoutClient;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.clients.UserManagementClient;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.testng.Assert.assertTrue;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAILS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_HOME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_WORK_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.FAMILY_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.GIVEN_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.ID_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.PASSWORD_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCHEMAS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCIM2_USERS_ENDPOINT;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SERVER_URL;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.TYPE_PARAM;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.USER_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.VALUE_PARAM;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE = \"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE = \"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    List<String> userIds = new ArrayList<>();\n+    UserManagementClient userMgtClient;\n+    AutomationContext automationContext;\n+    String backendUrl = null;\n+    String sessionCookie = null;\n+    private CloseableHttpClient client;\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+\n+        automationContext = new AutomationContext(\"IDENTITY\", userMode);\n+        backendUrl = automationContext.getContextUrls().getBackEndUrl();\n+        sessionCookie = new LoginLogoutClient(automationContext).login();\n+        userMgtClient = new UserManagementClient(backendUrl, sessionCookie);\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][]{\n+                {TestUserMode.SUPER_TENANT_ADMIN}, {TestUserMode.TENANT_ADMIN}\n+        };\n+    }\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    /*\n+    Validate user listing with pagination.\n+    */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+\n+        HttpGet request = new HttpGet(getUserPath() + \"?startIndex=\" + START_INDEX + \"&count=\" + COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT, \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, START_INDEX, \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, COUNT, \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(String.valueOf(resourcesSize), COUNT, \"resources size in pagination listing is incorrect\");\n+\n+    }\n+\n+    /*\n+    Validating legacy behavior support (returning all the results for not specified list param).\n+     */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPaginationWithoutParams() throws Exception {\n+\n+        int currentUsers = getCurrentUsersCount();\n+\n+        HttpGet request = new HttpGet(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        JSONArray resourcesResponse = (JSONArray) ((JSONObject) ((Object) responseObj)).get(RESOURCES_ATTRIBUTE);\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, String.valueOf(currentUsers), \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, \"1\", \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, String.valueOf(currentUsers), \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(resourcesSize, currentUsers, \"resources size in pagination listing is incorrect\");\n+\n+        assertTrue(isAllUsersExists(resourcesResponse));\n+\n+    }\n+\n+    @Test\n+    public void testCreateUser() throws Exception {\n+\n+        for (int i = 0; i < 10; i++) {\n+            createUser(\"Family\" + i, \"user\" + i, \"user\" + i,\n+                    \"user\" + i + \"@gmail.com\", \"user\" + i + \"@gmail.com\", \"dummyPW\" + i);\n+        }\n+    }\n+\n+    private void createUser(String familyName, String givenName, String userName, String workEmail, String homeEmail,\n+                            String password) throws IOException {\n+\n+        HttpPost request = new HttpPost(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        JSONObject rootObject = new JSONObject();\n+\n+        JSONArray schemas = new JSONArray();\n+        rootObject.put(SCHEMAS_ATTRIBUTE, schemas);\n+\n+        JSONObject names = new JSONObject();\n+        names.put(FAMILY_NAME_ATTRIBUTE, familyName);\n+        names.put(GIVEN_NAME_ATTRIBUTE, givenName);\n+\n+        rootObject.put(NAME_ATTRIBUTE, names);\n+        rootObject.put(USER_NAME_ATTRIBUTE, userName);\n+\n+        JSONObject emailWork = new JSONObject();\n+        emailWork.put(TYPE_PARAM, EMAIL_TYPE_WORK_ATTRIBUTE);\n+        emailWork.put(VALUE_PARAM, workEmail);\n+\n+        JSONObject emailHome = new JSONObject();\n+        emailHome.put(TYPE_PARAM, EMAIL_TYPE_HOME_ATTRIBUTE);\n+        emailHome.put(VALUE_PARAM, homeEmail);\n+\n+        JSONArray emails = new JSONArray();\n+        emails.add(emailWork);\n+        emails.add(emailHome);\n+\n+        rootObject.put(EMAILS_ATTRIBUTE, emails);\n+\n+        rootObject.put(PASSWORD_ATTRIBUTE, password);\n+\n+        StringEntity entity = new StringEntity(rootObject.toString());\n+        request.setEntity(entity);\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 201, \"User has not been created successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String usernameFromResponse = ((JSONObject) responseObj).get(USER_NAME_ATTRIBUTE).toString();\n+        assertEquals(usernameFromResponse, userName);\n+\n+        String userId;\n+        userId = ((JSONObject) responseObj).get(ID_ATTRIBUTE).toString();\n+        userIds.add(userId);\n+        assertNotNull(userId);\n+    }\n+\n+    @Test(dependsOnMethods = {\"testUserListingPagination\", \"testUserListingPaginationWithoutParams\"})\n+    public void testDeleteUser() throws Exception {\n+\n+        for (String userId : userIds) {\n+            deleteUser(userId);\n+        }\n+    }\n+\n+    private void deleteUser(String userId) throws IOException {\n+\n+        String userResourcePath = getUserPath() + \"/\" + userId;\n+        HttpDelete request = new HttpDelete(userResourcePath);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 204, \"User has not been retrieved successfully\");\n+\n+        EntityUtils.consume(response.getEntity());\n+\n+        userResourcePath = getUserPath() + \"/\" + userId;\n+        HttpGet getRequest = new HttpGet(userResourcePath);\n+        getRequest.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        getRequest.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 404, \"User has not been deleted successfully\");\n+        EntityUtils.consume(response.getEntity());\n+    }\n+\n+    private int getCurrentUsersCount() throws Exception {\n+\n+        return userMgtClient.getUserList().size();\n+    }\n+\n+    private boolean isAllUsersExists(JSONArray response) throws Exception {\n+\n+        boolean usersExists = false;\n+        HashSet<String> usersList = new HashSet<>();", "originalCommit": "c0e8118430815079d6a22ea2328a79be52c1d4db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTU2NjE3Nw==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585566177", "bodyText": "done", "author": "EANimesha", "createdAt": "2021-03-02T13:32:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQ0MTczNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQ0Mjk0MA==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585442940", "bodyText": "Switch the variables side to avoid NPE.", "author": "Pushpalanka", "createdAt": "2021-03-02T10:25:03Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/scim2/SCIM2PaginationTestCase.java", "diffHunk": "@@ -0,0 +1,307 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.identity.integration.test.scim2;\n+\n+import org.apache.commons.codec.binary.Base64;\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.JSONValue;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.AutomationContext;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.integration.common.utils.LoginLogoutClient;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+import org.wso2.identity.integration.common.clients.UserManagementClient;\n+import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.testng.Assert.assertTrue;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAILS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_HOME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.EMAIL_TYPE_WORK_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.FAMILY_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.GIVEN_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.ID_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.PASSWORD_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCHEMAS_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SCIM2_USERS_ENDPOINT;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.SERVER_URL;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.TYPE_PARAM;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.USER_NAME_ATTRIBUTE;\n+import static org.wso2.identity.integration.test.scim2.SCIM2BaseTestCase.VALUE_PARAM;\n+\n+public class SCIM2PaginationTestCase extends ISIntegrationTest {\n+\n+    public static final String TOTAL_RESULTS_ATTRIBUTE = \"totalResults\";\n+    public static final String RESOURCES_ATTRIBUTE = \"Resources\";\n+    public static final String START_INDEX_ATTRIBUTE = \"startIndex\";\n+    public static final String ITEMS_PER_PAGE_ATTRIBUTE = \"itemsPerPage\";\n+    public static final String START_INDEX = \"2\";\n+    public static final String COUNT = \"4\";\n+    private final String adminUsername;\n+    private final String adminPassword;\n+    private final String tenant;\n+    List<String> userIds = new ArrayList<>();\n+    UserManagementClient userMgtClient;\n+    AutomationContext automationContext;\n+    String backendUrl = null;\n+    String sessionCookie = null;\n+    private CloseableHttpClient client;\n+\n+    @Factory(dataProvider = \"scim2UserConfigProvider\")\n+    public SCIM2PaginationTestCase(TestUserMode userMode) throws Exception {\n+\n+        AutomationContext context = new AutomationContext(\"IDENTITY\", userMode);\n+        this.adminUsername = context.getContextTenant().getTenantAdmin().getUserName();\n+        this.adminPassword = context.getContextTenant().getTenantAdmin().getPassword();\n+        this.tenant = context.getContextTenant().getDomain();\n+\n+        automationContext = new AutomationContext(\"IDENTITY\", userMode);\n+        backendUrl = automationContext.getContextUrls().getBackEndUrl();\n+        sessionCookie = new LoginLogoutClient(automationContext).login();\n+        userMgtClient = new UserManagementClient(backendUrl, sessionCookie);\n+    }\n+\n+    @DataProvider(name = \"scim2UserConfigProvider\")\n+    public static Object[][] scim2UserConfigProvider() {\n+\n+        return new Object[][]{\n+                {TestUserMode.SUPER_TENANT_ADMIN}, {TestUserMode.TENANT_ADMIN}\n+        };\n+    }\n+\n+    @BeforeClass(alwaysRun = true)\n+    public void testInit() throws Exception {\n+\n+        super.init();\n+        client = HttpClients.createDefault();\n+    }\n+\n+    /*\n+    Validate user listing with pagination.\n+    */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPagination() throws Exception {\n+\n+        HttpGet request = new HttpGet(getUserPath() + \"?startIndex=\" + START_INDEX + \"&count=\" + COUNT);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, COUNT, \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, START_INDEX, \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, COUNT, \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(String.valueOf(resourcesSize), COUNT, \"resources size in pagination listing is incorrect\");\n+\n+    }\n+\n+    /*\n+    Validating legacy behavior support (returning all the results for not specified list param).\n+     */\n+    @Test(dependsOnMethods = \"testCreateUser\")\n+    public void testUserListingPaginationWithoutParams() throws Exception {\n+\n+        int currentUsers = getCurrentUsersCount();\n+\n+        HttpGet request = new HttpGet(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 200, \"Users \" +\n+                \"has not been retrieved successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        JSONArray resourcesResponse = (JSONArray) ((JSONObject) ((Object) responseObj)).get(RESOURCES_ATTRIBUTE);\n+\n+        String totalResults = ((JSONObject) responseObj).get(TOTAL_RESULTS_ATTRIBUTE).toString();\n+        assertEquals(totalResults, String.valueOf(currentUsers), \"total results in pagination listing is incorrect\");\n+\n+        String startIndex = ((JSONObject) responseObj).get(START_INDEX_ATTRIBUTE).toString();\n+        assertEquals(startIndex, \"1\", \"startIndex in pagination listing is incorrect\");\n+\n+        String itemsPerPage = ((JSONObject) responseObj).get(ITEMS_PER_PAGE_ATTRIBUTE).toString();\n+        assertEquals(itemsPerPage, String.valueOf(currentUsers), \"itemsPerPage in pagination listing is incorrect\");\n+\n+        int resourcesSize = ((JSONArray) ((JSONObject) responseObj).get(RESOURCES_ATTRIBUTE)).size();\n+        assertEquals(resourcesSize, currentUsers, \"resources size in pagination listing is incorrect\");\n+\n+        assertTrue(isAllUsersExists(resourcesResponse));\n+\n+    }\n+\n+    @Test\n+    public void testCreateUser() throws Exception {\n+\n+        for (int i = 0; i < 10; i++) {\n+            createUser(\"Family\" + i, \"user\" + i, \"user\" + i,\n+                    \"user\" + i + \"@gmail.com\", \"user\" + i + \"@gmail.com\", \"dummyPW\" + i);\n+        }\n+    }\n+\n+    private void createUser(String familyName, String givenName, String userName, String workEmail, String homeEmail,\n+                            String password) throws IOException {\n+\n+        HttpPost request = new HttpPost(getUserPath());\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        JSONObject rootObject = new JSONObject();\n+\n+        JSONArray schemas = new JSONArray();\n+        rootObject.put(SCHEMAS_ATTRIBUTE, schemas);\n+\n+        JSONObject names = new JSONObject();\n+        names.put(FAMILY_NAME_ATTRIBUTE, familyName);\n+        names.put(GIVEN_NAME_ATTRIBUTE, givenName);\n+\n+        rootObject.put(NAME_ATTRIBUTE, names);\n+        rootObject.put(USER_NAME_ATTRIBUTE, userName);\n+\n+        JSONObject emailWork = new JSONObject();\n+        emailWork.put(TYPE_PARAM, EMAIL_TYPE_WORK_ATTRIBUTE);\n+        emailWork.put(VALUE_PARAM, workEmail);\n+\n+        JSONObject emailHome = new JSONObject();\n+        emailHome.put(TYPE_PARAM, EMAIL_TYPE_HOME_ATTRIBUTE);\n+        emailHome.put(VALUE_PARAM, homeEmail);\n+\n+        JSONArray emails = new JSONArray();\n+        emails.add(emailWork);\n+        emails.add(emailHome);\n+\n+        rootObject.put(EMAILS_ATTRIBUTE, emails);\n+\n+        rootObject.put(PASSWORD_ATTRIBUTE, password);\n+\n+        StringEntity entity = new StringEntity(rootObject.toString());\n+        request.setEntity(entity);\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 201, \"User has not been created successfully\");\n+\n+        Object responseObj = JSONValue.parse(EntityUtils.toString(response.getEntity()));\n+        EntityUtils.consume(response.getEntity());\n+\n+        String usernameFromResponse = ((JSONObject) responseObj).get(USER_NAME_ATTRIBUTE).toString();\n+        assertEquals(usernameFromResponse, userName);\n+\n+        String userId;\n+        userId = ((JSONObject) responseObj).get(ID_ATTRIBUTE).toString();\n+        userIds.add(userId);\n+        assertNotNull(userId);\n+    }\n+\n+    @Test(dependsOnMethods = {\"testUserListingPagination\", \"testUserListingPaginationWithoutParams\"})\n+    public void testDeleteUser() throws Exception {\n+\n+        for (String userId : userIds) {\n+            deleteUser(userId);\n+        }\n+    }\n+\n+    private void deleteUser(String userId) throws IOException {\n+\n+        String userResourcePath = getUserPath() + \"/\" + userId;\n+        HttpDelete request = new HttpDelete(userResourcePath);\n+        request.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        request.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        HttpResponse response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 204, \"User has not been retrieved successfully\");\n+\n+        EntityUtils.consume(response.getEntity());\n+\n+        userResourcePath = getUserPath() + \"/\" + userId;\n+        HttpGet getRequest = new HttpGet(userResourcePath);\n+        getRequest.addHeader(HttpHeaders.AUTHORIZATION, getAuthzHeader());\n+        getRequest.addHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n+\n+        response = client.execute(request);\n+        assertEquals(response.getStatusLine().getStatusCode(), 404, \"User has not been deleted successfully\");\n+        EntityUtils.consume(response.getEntity());\n+    }\n+\n+    private int getCurrentUsersCount() throws Exception {\n+\n+        return userMgtClient.getUserList().size();\n+    }\n+\n+    private boolean isAllUsersExists(JSONArray response) throws Exception {\n+\n+        boolean usersExists = false;\n+        HashSet<String> usersList = new HashSet<>();\n+        for (Object user : response\n+        ) {\n+            usersList.add(((JSONObject) user).get(USER_NAME_ATTRIBUTE).toString());\n+        }\n+        if (userMgtClient.getUserList().equals(usersList)) {\n+            usersExists = true;\n+        }\n+        return usersExists;\n+    }\n+\n+    private String getUserPath() {\n+\n+        if (tenant.equals(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME)) {", "originalCommit": "c0e8118430815079d6a22ea2328a79be52c1d4db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTU2NjMxNw==", "url": "https://github.com/wso2/product-is/pull/10345#discussion_r585566317", "bodyText": "done", "author": "EANimesha", "createdAt": "2021-03-02T13:32:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTQ0Mjk0MA=="}], "type": "inlineReview"}, {"oid": "816d781542d92f6114aa55773dd0857d75e10d04", "url": "https://github.com/wso2/product-is/commit/816d781542d92f6114aa55773dd0857d75e10d04", "message": "updated for comments, improve code style", "committedDate": "2021-03-02T13:29:04Z", "type": "commit"}]}