{"pr_number": 482, "pr_title": "HCS proto changes", "pr_createdAt": "2020-01-03T20:08:48Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/482", "timeline": [{"oid": "f26d2e7dd1b48a1f5dac1dcdaafc1a85ab8f2686", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f26d2e7dd1b48a1f5dac1dcdaafc1a85ab8f2686", "message": "Rename ConsensusService to ConsensusController\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-01-03T20:09:27Z", "type": "commit"}, {"oid": "6e75dc6e8939c15a11799db731232afba18e37d9", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6e75dc6e8939c15a11799db731232afba18e37d9", "message": "Remove t_entities.topic_valid_start_time\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-01-03T20:09:27Z", "type": "commit"}, {"oid": "0edf7dbc6e419c35e4054467ed1771e07727b28a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/0edf7dbc6e419c35e4054467ed1771e07727b28a", "message": "Add auto renew account to entities\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-01-03T20:09:27Z", "type": "commit"}, {"oid": "06ff38b0ade4d04d95ea6c384064b76843fe5d7f", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/06ff38b0ade4d04d95ea6c384064b76843fe5d7f", "message": "Update HCS transaction response codes\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-01-03T20:09:27Z", "type": "commit"}, {"oid": "2031c44359c6aca97a2aa683e6afa872077b91fd", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2031c44359c6aca97a2aa683e6afa872077b91fd", "message": "Remove deprecated entity fields\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-01-03T20:17:50Z", "type": "commit"}, {"oid": "2031c44359c6aca97a2aa683e6afa872077b91fd", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2031c44359c6aca97a2aa683e6afa872077b91fd", "message": "Remove deprecated entity fields\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-01-03T20:17:50Z", "type": "forcePushed"}, {"oid": "21e671231bda853b4e5052b059946ecd7899ae70", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/21e671231bda853b4e5052b059946ecd7899ae70", "message": "Fix doc rendering\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-01-03T20:20:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MjkzMg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362962932", "bodyText": "nit: you have this same logic repeated below.\nDid you want to move it into a single method so future edits don't miss one of the locations.", "author": "Nana-EC", "createdAt": "2020-01-03T21:12:41Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileLogger.java", "diffHunk": "@@ -558,23 +558,19 @@ private static Entities storeConsensusCreateTopic(TransactionBody body,\n         Entities entity = getEntity(transactionRecord.getReceipt().getTopicID());\n         var transactionBody = body.getConsensusCreateTopic();\n \n-        if (transactionBody.hasExpirationTime()) {\n-            Timestamp expirationTime = transactionBody.getExpirationTime();\n-            entity.setExpiryTimeNs(Utility.timestampInNanosMax(expirationTime));\n-            entity.setExpiryTimeSeconds(expirationTime.getSeconds());\n-            entity.setExpiryTimeNanos((long) expirationTime.getNanos());\n+        if (transactionBody.hasAutoRenewAccount()) {", "originalCommit": "21e671231bda853b4e5052b059946ecd7899ae70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2NTI3Ng==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362965276", "bodyText": "No other part of the two methods can be combined, just autorenewaccount and autorenewperiod. I don't think it's worthwhile for that and we'll probably be breaking them into separate transaction handler classes soon.", "author": "steven-sheehy", "createdAt": "2020-01-03T21:21:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MjkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3Nzc3NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362977774", "bodyText": "Okay", "author": "Nana-EC", "createdAt": "2020-01-03T22:09:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MjkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MzQzMg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362963432", "bodyText": "Should this have an upper bound also? Just in case someone runs migration out of flow when there exists proto_id's greater than the current range?", "author": "Nana-EC", "createdAt": "2020-01-03T21:14:40Z", "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.17.4__hcs_proto_changes.sql", "diffHunk": "@@ -0,0 +1,17 @@\n+alter table t_entities drop column topic_valid_start_time;\n+alter table t_entities drop column admin_key__deprecated;\n+alter table t_entities drop column exp_time_seconds;\n+alter table t_entities drop column exp_time_nanos;\n+alter table t_entities add column auto_renew_account_id bigint null;\n+alter table t_entities add constraint autorenew_account foreign key (auto_renew_account_id) references t_entities(id);\n+\n+delete from t_transaction_results where proto_id >= 150;", "originalCommit": "21e671231bda853b4e5052b059946ecd7899ae70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2NDgxNg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362964816", "bodyText": "It's not really necessary, the whole point of migrations are they are not ran out of order.", "author": "steven-sheehy", "createdAt": "2020-01-03T21:19:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MzQzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3NzcwNg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362977706", "bodyText": "Granted. Just bothers me that a flow exists to delete all the rows above a certain range. It's best practice to remove exactly what you want, unless you really don't care for anything that could exist above the range.\nI'll leave it to you though.", "author": "Nana-EC", "createdAt": "2020-01-03T22:09:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MzQzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk4Mzk5Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362983992", "bodyText": "Added", "author": "steven-sheehy", "createdAt": "2020-01-03T22:36:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MzQzMg=="}], "type": "inlineReview"}, {"oid": "dde8287b010b0fda9b88e113dde07c6a98a8c1c1", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/dde8287b010b0fda9b88e113dde07c6a98a8c1c1", "message": "Review feedback\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-01-03T22:36:14Z", "type": "commit"}]}