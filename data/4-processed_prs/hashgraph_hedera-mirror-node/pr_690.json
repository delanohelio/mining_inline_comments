{"pr_number": 690, "pr_title": "REST API swagger metrics", "pr_createdAt": "2020-04-15T18:59:29Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/690", "timeline": [{"oid": "7a8186b68fe54b43648949a407bd8d56fb140c35", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7a8186b68fe54b43648949a407bd8d56fb140c35", "message": "REST API swagger metrics\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-04-15T18:44:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgzNjc0MQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409836741", "bodyText": "We should not mix metrics user and database user. Let's create a separate username and password in config.", "author": "steven-sheehy", "createdAt": "2020-04-16T20:43:48Z", "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,52 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');\n+\n+// Load your swagger specification\n+// const apiSpec = require('./swagger.json');\n+\n+const metricsHandler = () => {\n+  return swStats.getMiddleware({\n+    name: process.env.npm_package_name,\n+    version: process.env.npm_package_version,\n+    authentication: true,\n+    onAuthenticate: onMetricsAuthenticate,\n+    uriPath: '/swagger',\n+    // swaggerSpec: apiSpec,\n+    // metricsPrefix: 'mirror-rest-'\n+  });\n+};\n+\n+const onMetricsAuthenticate = async (req, username, password) => {\n+  return new Promise(function (resolve, reject) {\n+    const match = username === config.db.apiUsername && password === config.db.apiPassword;", "originalCommit": "7a8186b68fe54b43648949a407bd8d56fb140c35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNDYxMw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410034613", "bodyText": "Fixed", "author": "Nana-EC", "createdAt": "2020-04-17T07:13:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgzNjc0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgzNjg5Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409836892", "bodyText": "Commented config in this file can be removed until needed. YAGNI", "author": "steven-sheehy", "createdAt": "2020-04-16T20:44:06Z", "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,52 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');\n+\n+// Load your swagger specification\n+// const apiSpec = require('./swagger.json');\n+\n+const metricsHandler = () => {\n+  return swStats.getMiddleware({\n+    name: process.env.npm_package_name,\n+    version: process.env.npm_package_version,\n+    authentication: true,\n+    onAuthenticate: onMetricsAuthenticate,\n+    uriPath: '/swagger',\n+    // swaggerSpec: apiSpec,", "originalCommit": "7a8186b68fe54b43648949a407bd8d56fb140c35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNDY5MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410034690", "bodyText": "Fixed", "author": "Nana-EC", "createdAt": "2020-04-17T07:13:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgzNjg5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0MTI3OA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409841278", "bodyText": "q: Does catching this error here swallow it instead of failing authentication?", "author": "steven-sheehy", "createdAt": "2020-04-16T20:52:45Z", "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,52 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');\n+\n+// Load your swagger specification\n+// const apiSpec = require('./swagger.json');\n+\n+const metricsHandler = () => {\n+  return swStats.getMiddleware({\n+    name: process.env.npm_package_name,\n+    version: process.env.npm_package_version,\n+    authentication: true,\n+    onAuthenticate: onMetricsAuthenticate,\n+    uriPath: '/swagger',\n+    // swaggerSpec: apiSpec,\n+    // metricsPrefix: 'mirror-rest-'\n+  });\n+};\n+\n+const onMetricsAuthenticate = async (req, username, password) => {\n+  return new Promise(function (resolve, reject) {\n+    const match = username === config.db.apiUsername && password === config.db.apiPassword;\n+    resolve(match);\n+  }).catch((err) => {\n+    logger.debug(`Auth error: ${err}`);", "originalCommit": "7a8186b68fe54b43648949a407bd8d56fb140c35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkxMTYwNg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409911606", "bodyText": "No it fails. It needs a valid resolve of true to let you on. I'll check about rethrowing though", "author": "Nana-EC", "createdAt": "2020-04-16T23:45:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0MTI3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzMzIyMQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410033221", "bodyText": "Verified regrowing does now swallow the error and auhtenmicationonly passes with a valid match and a resolve on the promise.", "author": "Nana-EC", "createdAt": "2020-04-17T07:10:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0MTI3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNDc3MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410034770", "bodyText": "Added the throw anyway", "author": "Nana-EC", "createdAt": "2020-04-17T07:13:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0MTI3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTExOTc0Mw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409119743", "bodyText": "which port does it use? Can we make swagger use different port then rest of the apis?\nWe shouldn't expose internal stats and metrics on a public port.", "author": "apeksharma", "createdAt": "2020-04-15T20:39:40Z", "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,52 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');", "originalCommit": "7a8186b68fe54b43648949a407bd8d56fb140c35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg1MDM0Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409850342", "bodyText": "I think it's fine. I've already discussed with Brad and he will ensure only /api gets exposed publically by the proxy. This is also the case with Kubernetes. Plus it has authentication enabled. Let's not complicate the setup.", "author": "steven-sheehy", "createdAt": "2020-04-16T21:10:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTExOTc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg3MzM5MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409873390", "bodyText": "sg.", "author": "apeksharma", "createdAt": "2020-04-16T21:59:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTExOTc0Mw=="}], "type": "inlineReview"}, {"oid": "02bee3a64678b8959093904acff7fd855fc57f52", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/02bee3a64678b8959093904acff7fd855fc57f52", "message": " Addressed feedback on  config and comments\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-04-17T07:12:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNDEzNg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410304136", "bodyText": "I don't think this needs to be exported.", "author": "steven-sheehy", "createdAt": "2020-04-17T15:37:27Z", "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,51 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');\n+\n+// Load your swagger specification\n+// const apiSpec = require('./swagger.json');\n+\n+const metricsHandler = () => {\n+  return swStats.getMiddleware({\n+    name: process.env.npm_package_name,\n+    version: process.env.npm_package_version,\n+    authentication: true,\n+    onAuthenticate: onMetricsAuthenticate,\n+    uriPath: '/swagger',\n+  });\n+};\n+\n+const onMetricsAuthenticate = async (req, username, password) => {\n+  return new Promise(function (resolve, reject) {\n+    const match = username === config.swagger.swaggerUsername && password === config.swagger.swaggerPassword;\n+    resolve(match);\n+  }).catch((err) => {\n+    logger.debug(`Auth error: ${err}`);\n+    throw err;\n+  });\n+};\n+\n+module.exports = {\n+  metricsHandler,\n+  onMetricsAuthenticate,", "originalCommit": "02bee3a64678b8959093904acff7fd855fc57f52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MjI5Ng==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410382296", "bodyText": "Had removed this, was yet to push", "author": "Nana-EC", "createdAt": "2020-04-17T17:57:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNDEzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNDMzNQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410304335", "bodyText": "Would prefer hedera.mirror.api.metrics.username/password", "author": "steven-sheehy", "createdAt": "2020-04-17T15:37:52Z", "path": "hedera-mirror-rest/config/application.yml", "diffHunk": "@@ -14,3 +14,6 @@ hedera:\n       name: mirror_node\n       port: 5432\n     shard: 0\n+    swagger:\n+      swaggerPassword: swagger_metrics_pass", "originalCommit": "02bee3a64678b8959093904acff7fd855fc57f52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MjQyNA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410382424", "bodyText": "Done", "author": "Nana-EC", "createdAt": "2020-04-17T17:57:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNDMzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNjcxMQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410306711", "bodyText": "Conditionally enabling based upon hedera.mirror.api.metrics.enabled would be nice", "author": "steven-sheehy", "createdAt": "2020-04-17T15:41:59Z", "path": "hedera-mirror-rest/server.js", "diffHunk": "@@ -90,6 +91,9 @@ app.use(bodyParser.json());\n app.use(compression());\n app.use(cors());\n \n+// metrics middleware\n+app.use(metricsHandler());", "originalCommit": "02bee3a64678b8959093904acff7fd855fc57f52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4Mjc2MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410382760", "bodyText": "Done", "author": "Nana-EC", "createdAt": "2020-04-17T17:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNjcxMQ=="}], "type": "inlineReview"}, {"oid": "7e2a328748149cad0ff558b2576d8f7f6e8c7374", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7e2a328748149cad0ff558b2576d8f7f6e8c7374", "message": "Added metric configs and updated documentation\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-04-17T17:56:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQwMDc5MQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410400791", "bodyText": "default values here, in operations.md, and in application.yml do not match.", "author": "apeksharma", "createdAt": "2020-04-17T18:33:24Z", "path": "docs/configuration.md", "diffHunk": "@@ -43,6 +43,11 @@ value, it is recommended to only populate overridden properties in the custom `a\n | `hedera.mirror.api.log.level`                               | debug                   | The logging level. Can be trace, debug, info, warn, error or fatal.                            |\n | `hedera.mirror.api.port`                                    | 5551                    | The REST API port                                                                              |\n | `hedera.mirror.api.includeHostInLink`                       | false                   | Whether to include the host:port in the next links returned by the REST API                    |\n+| `hedera.mirror.api.metrics.enabled`                         | true                    | Whether metrics are enabled for the REST API                                                   |\n+| `hedera.mirror.api.metrics.config.authentication`           | true                    | Whether access to metrics for the REST API is authenticated                                    |\n+| `hedera.mirror.api.metrics.config.username`                 | mirror_api_metrics      | The REST API metrics username to access the dashboard                                          |\n+| `hedera.mirror.api.metrics.config.password`                 | mirror_api_metrics_pass | The REST API metrics password to access the dashboard                                          |\n+| `hedera.mirror.api.metrics.config.uriPath`                  | './swagger'             | The REST API metrics uri path                                                                  |", "originalCommit": "7e2a328748149cad0ff558b2576d8f7f6e8c7374", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5NTY0NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410495644", "bodyText": "Only issue I see is on uriPath where './' are not in the docs. Can update that in a future PR.", "author": "Nana-EC", "createdAt": "2020-04-17T22:15:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQwMDc5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMjE3NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410502175", "bodyText": "Just fixed.", "author": "Nana-EC", "createdAt": "2020-04-17T22:39:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQwMDc5MQ=="}], "type": "inlineReview"}, {"oid": "7f92bae15cb96b951cbf8e8cd8cd6559f80e57a3", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7f92bae15cb96b951cbf8e8cd8cd6559f80e57a3", "message": "Push docker images on master and cleanup old images (#683)\n\n* Push docker images on master and cleanup\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Used circle.docker.tag in deploy\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Use creationTime instead of useCurrentTimestamp\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fixed bad substitution and updated prettyignore\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Added lastest tag config updated delete_before logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* echoed image tag lists\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Added loop logic for multiple tags\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Try delete old images logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Added echo for each image\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Update  multiline comment\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Remove gcloud delete\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Remove digest echo for delete command\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Update for loop formatting\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Update reference logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Use circleci v2.1 reuseable commands\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Hold off on commands and references. Verify split loop and list\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Single line tags list and fix commands indentation\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Comment out non cleanup jobs\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fix image path variable references\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add config list print\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Remove untagged old test master images\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Restore service account and project set\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Verify image tag filtering list\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* echo final filter command to verify time param\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fixed filter string format issue\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add echo for delete command\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* dry run of 19 hours\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Cleanup layout Leave delete commented out\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Force new image push 1\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Dry run for 7 days\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fixed array loop and test 1 hour ago cleanup\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Test 2 hour ago cleanup\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 4 hours ago test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 6 hours test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 6 hours test 2\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 14 hours test 1\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 14 hours test 2\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 14 hours test 3\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Use csv formatting to get digest and timestamp\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Escape cahrs for v2.1\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* removed braces\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Modify date format\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Removed UTC config\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add echo for bash env check\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Test filter timestamp formats\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Test filter timestamp formats 2\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 7 days ago test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 2 days ago test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Removed test branch logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Addressed feedback and added publsih test logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Removed branch publish test logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add untag logic and modify delete to delete untagged\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 24 hours untag test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 24 hours untag test 2\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fix tag filter\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Real untag clean up 24 hours\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add quiet option to untag\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Pull sha format for delete, no need for timestamp\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 3 hours ago test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Address fedback and remove brnach logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Removed tag filter for cleanup_images\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-04-17T21:28:10Z", "type": "commit"}, {"oid": "3dec608421c218c75e5d70bc3d9eb7c03ae40a19", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3dec608421c218c75e5d70bc3d9eb7c03ae40a19", "message": "REST API swagger metrics\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-04-17T22:33:41Z", "type": "commit"}, {"oid": "68778434acee53682adaa9558d38546f8718e9d5", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/68778434acee53682adaa9558d38546f8718e9d5", "message": " Addressed feedback on  config and comments\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-04-17T22:33:41Z", "type": "commit"}, {"oid": "4f8408505e5ef550925f20c4ad268af5e2e56a0c", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4f8408505e5ef550925f20c4ad268af5e2e56a0c", "message": "Added metric configs and updated documentation\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-04-17T22:33:41Z", "type": "commit"}, {"oid": "f775b4be2305e4bf9f517d826b6759d034965426", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f775b4be2305e4bf9f517d826b6759d034965426", "message": "Merge branch 'rest-metrics' of https://github.com/hashgraph/hedera-mirror-node into rest-metrics", "committedDate": "2020-04-17T22:33:55Z", "type": "commit"}, {"oid": "7d14fd87f78b8ab1d8d6ee3a7e1e36a8ba82b52a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7d14fd87f78b8ab1d8d6ee3a7e1e36a8ba82b52a", "message": "Correct deafult value ref\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-04-17T22:36:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUxNzczOQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410517739", "bodyText": "nit: if it was fixed in configuration.md, might as well have fixed it here.\nNo biggy.", "author": "apeksharma", "createdAt": "2020-04-17T23:49:03Z", "path": "docs/operations.md", "diffHunk": "@@ -182,3 +182,11 @@ for port in {6551..6560}; do curl -s \"http://127.0.0.1:${port}/api/v1/transactio\n ```\n \n To setup live monitoring, see [monitoring](../hedera-mirror-rest/monitoring/README.md) documentation.\n+\n+### Metrics\n+The REST API has metrics as provided by [Swagger Stats](https://swaggerstats.io).\n+Using this 3 endpoints are made available\n+- `http://<ip>:<port>/<metricsPath>` - Metrics dashboard\n+- `http://<ip>:<port>/<metricsPath>/stats` - Aggregated statistics\n+- `http://<ip>:<port>/<metricsPath>/metrics` - Prometheus formatted metrics\n+Where `<metricsPath>` is defined by hedera.mirror.api.metrics.config.uriPath, current default is 'swagger'", "originalCommit": "7d14fd87f78b8ab1d8d6ee3a7e1e36a8ba82b52a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}