{"pr_number": 1018, "pr_title": "return only the current address book from state proof alpha REST API", "pr_createdAt": "2020-09-04T14:51:04Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018", "timeline": [{"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3b189ea72e5e9a5db97bc026003c7564ee53f3fc", "message": "state proof alpha api to only return the address book current to the queried transaction\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-09-04T14:47:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjYzNw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483676637", "bodyText": "Would be better to make this a configuration option so we don't have to undo this change in the future. Something like hedera.mirror.rest.stateproof.addressBookHistory=false.", "author": "steven-sheehy", "createdAt": "2020-09-04T15:04:50Z", "path": "hedera-mirror-rest/stateproof.js", "diffHunk": "@@ -116,10 +117,18 @@ let getAddressBooksAndNodeAccountIdsByConsensusNs = async (consensusNs) => {\n          ON ab.start_consensus_timestamp = abe.consensus_timestamp\n        WHERE start_consensus_timestamp <= $1\n          AND file_id = 102\n-       GROUP BY start_consensus_timestamp\n-       ORDER BY start_consensus_timestamp`;\n+       GROUP BY start_consensus_timestamp`;\n+  if (!onlyCurrent) {", "originalCommit": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3ODIxOQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483678219", "bodyText": "sure. just have a little concern that if we should expose such an option or not. I'll implement it.", "author": "xin-hedera", "createdAt": "2020-09-04T15:07:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjYzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzcwNjAyNA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483706024", "bodyText": "added the option and it's not documented in configuration.md", "author": "xin-hedera", "createdAt": "2020-09-04T15:46:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjYzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3OTcyNw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483679727", "bodyText": "oops, this is by mistake. will revert back to logger.trace", "author": "xin-hedera", "createdAt": "2020-09-04T15:10:21Z", "path": "hedera-mirror-rest/stateproof.js", "diffHunk": "@@ -116,10 +117,18 @@ let getAddressBooksAndNodeAccountIdsByConsensusNs = async (consensusNs) => {\n          ON ab.start_consensus_timestamp = abe.consensus_timestamp\n        WHERE start_consensus_timestamp <= $1\n          AND file_id = 102\n-       GROUP BY start_consensus_timestamp\n-       ORDER BY start_consensus_timestamp`;\n+       GROUP BY start_consensus_timestamp`;\n+  if (!onlyCurrent) {\n+    sqlQuery += `\n+      ORDER BY start_consensus_timestamp`;\n+  } else {\n+    sqlQuery += `\n+      ORDER BY start_consensus_timestamp DESC\n+      LIMIT 1`;\n+  }\n+\n   if (logger.isTraceEnabled()) {\n-    logger.trace(`getAddressBooksAndNodeAccountIDsByConsensusNs: ${sqlQuery}, ${JSON.stringify(sqlParams)}`);\n+    logger.info(`getAddressBooksAndNodeAccountIDsByConsensusNs: ${sqlQuery}, ${JSON.stringify(sqlParams)}`);", "originalCommit": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ca912379d540e77ac411e5cda3747c1de6e84c7b", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ca912379d540e77ac411e5cda3747c1de6e84c7b", "message": "add config.stateproof.addressBookHistory, add test spec with 2 address books returned\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-09-04T15:45:16Z", "type": "commit"}]}