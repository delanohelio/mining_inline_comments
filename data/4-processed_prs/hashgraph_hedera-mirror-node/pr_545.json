{"pr_number": 545, "pr_title": "Set additional netty properties and memory limits ", "pr_createdAt": "2020-02-19T22:10:19Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/545", "timeline": [{"oid": "be149129bc99b4d2597fbada54a9d50017ae9587", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/be149129bc99b4d2597fbada54a9d50017ae9587", "message": "Set additional netty properties to protect grpc and ensure good connections. Also increased memory limits\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-02-19T22:04:32Z", "type": "commit"}, {"oid": "cb85b953313a0d106c260745b1c1da2e29828d4e", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/cb85b953313a0d106c260745b1c1da2e29828d4e", "message": "Removed keep alive netty props and updated configuration.md\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-02-19T22:58:12Z", "type": "commit"}, {"oid": "14efef27055c09b4f676137193c42cdbd1151938", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/14efef27055c09b4f676137193c42cdbd1151938", "message": "merge w master 2/20/20\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-02-20T19:14:19Z", "type": "commit"}, {"oid": "6789db30f3b6f16e28abcc1ae49db8d74c496d93", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6789db30f3b6f16e28abcc1ae49db8d74c496d93", "message": "Updated max heap from 12 to 10 gb. Gives us more buffer should we ever need it\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-02-20T19:39:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5MzkzNw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545#discussion_r382393937", "bodyText": "maxInboundMessageSize doesn't seem to be netty property, it's looks like grpc property?", "author": "apeksharma", "createdAt": "2020-02-21T04:39:16Z", "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/config/GrpcConfiguration.java", "diffHunk": "@@ -53,7 +53,11 @@ CompositeHealthContributor grpcServices(GrpcServiceDiscoverer grpcServiceDiscove\n \n     @Bean\n     public GrpcServerConfigurer grpcServerConfigurer(GrpcProperties grpcProperties) {\n+        NettyProperties nettyProperties = grpcProperties.getNetty();\n         return serverBuilder -> ((NettyServerBuilder) serverBuilder)\n-                .maxConcurrentCallsPerConnection(grpcProperties.getNetty().getMaxConcurrentCallsPerConnection());\n+                .flowControlWindow(nettyProperties.getFlowControlWindow())\n+                .maxConcurrentCallsPerConnection(nettyProperties.getMaxConcurrentCallsPerConnection())\n+                .maxInboundMessageSize(nettyProperties.getMaxMessageSize())", "originalCommit": "6789db30f3b6f16e28abcc1ae49db8d74c496d93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2NDgyNQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545#discussion_r382864825", "bodyText": "Addressed this comment in a new PR", "author": "Nana-EC", "createdAt": "2020-02-22T00:29:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5MzkzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5NDI3MQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545#discussion_r382394271", "bodyText": "let's name these exactly as grpc's/netty's internal property names. Will save us from having to keep extra mapping in mind when debugging things.\nI understand setting min for these two 'size' configs is weird since we'll never set them to low values like 10 or even 100. But a value like 8 seems mysterious. Why 8, why not 9 or 7? has to do something with int/long size?\nI'd suggest setting the Mins values to 0 to avoid attracting unneeded curiousness.", "author": "apeksharma", "createdAt": "2020-02-21T04:41:04Z", "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/config/NettyProperties.java", "diffHunk": "@@ -27,6 +27,15 @@\n @Data\n @Validated\n public class NettyProperties {\n+    @Min(1024) // 64 kb\n+    private int flowControlWindow = 64 * 1024;\n+\n     @Min(1)\n     private int maxConcurrentCallsPerConnection = 5;\n+\n+    @Min(8) // 6 kb\n+    private int maxMessageSize = 6 * 1024;", "originalCommit": "6789db30f3b6f16e28abcc1ae49db8d74c496d93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2NDczMQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545#discussion_r382864731", "bodyText": "8b was what I was seeing for our proto query message size, so figured it was a good start", "author": "Nana-EC", "createdAt": "2020-02-22T00:29:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5NDI3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg2NDc1OQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545#discussion_r382864759", "bodyText": "Addressed this in a new PR", "author": "Nana-EC", "createdAt": "2020-02-22T00:29:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5NDI3MQ=="}], "type": "inlineReview"}]}