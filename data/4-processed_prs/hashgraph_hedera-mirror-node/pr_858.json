{"pr_number": 858, "pr_title": "Hardcode bucket names to network enum", "pr_createdAt": "2020-07-09T03:21:22Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/858", "timeline": [{"oid": "2b7f4f6ce273727fe39a6e6d4f6e7fc619ded4e8", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2b7f4f6ce273727fe39a6e6d4f6e7fc619ded4e8", "message": "Hardcode bucket names to network enum\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-07-10T15:59:44Z", "type": "commit"}, {"oid": "2b7f4f6ce273727fe39a6e6d4f6e7fc619ded4e8", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2b7f4f6ce273727fe39a6e6d4f6e7fc619ded4e8", "message": "Hardcode bucket names to network enum\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-07-10T15:59:44Z", "type": "forcePushed"}, {"oid": "91f079bae7bac2431c0a497026219f8b75fe41db", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/91f079bae7bac2431c0a497026219f8b75fe41db", "message": "Fix abstractdownload beforeTest\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-07-10T16:57:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA3NzY2OQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453077669", "bodyText": "I don't see why we're changing the path to bucketName. It's still associated with the downloader component and should be namespaced under a path that reflects that. Also, it's an unnecessary breaking change to clients that should be avoided if possible.", "author": "steven-sheehy", "createdAt": "2020-07-10T21:07:23Z", "path": "docs/configuration.md", "diffHunk": "@@ -21,6 +19,7 @@ value, it is recommended to only populate overridden properties in the custom `a\n \n | Name                                                                 | Default                 | Description                                                                                    |\n | -------------------------------------------------------------------- | ----------------------- | ---------------------------------------------------------------------------------------------- |\n+| `hedera.mirror.importer.bucketName`                                  | \"\"                      | The cloud storage bucket name to download streamed files. Must be set if `hedera.mirror.importer.network` is 'OTHER'|", "originalCommit": "91f079bae7bac2431c0a497026219f8b75fe41db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5NDU5Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453094597", "bodyText": "Can actually remove this since default in code is empty and it now uses network", "author": "steven-sheehy", "createdAt": "2020-07-10T21:56:04Z", "path": "charts/marketplace/gcp/schema-test.yaml", "diffHunk": "@@ -1,9 +1,9 @@\n properties:\n-  importer.config.hedera.mirror.importer.downloader.accessKey:\n+  importer.config.hedera.mirror.importer.bucketName:", "originalCommit": "91f079bae7bac2431c0a497026219f8b75fe41db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5NTU3OA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453095578", "bodyText": "I assume you moved it here just because network was here and it made it a little easier to have it consolidated. But as mentioned previously we should keep it where it makes better sense and to not break clients. Recommend keeping network here and moving bucketName back to CommonDownloaderProperties. Then you can inject MirrorProperties into CommonDownloaderProperties to consolidate logic.", "author": "steven-sheehy", "createdAt": "2020-07-10T21:59:10Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/MirrorProperties.java", "diffHunk": "@@ -63,4 +64,21 @@ public void setDataPath(Path dataPath) {\n         Utility.ensureDirectory(dataPath);\n         this.dataPath = dataPath;\n     }\n+\n+    private String bucketName = \"\";\n+\n+    public String getBucketName() {\n+        return network == HederaNetwork.OTHER ? bucketName : network.getBucketName();", "originalCommit": "91f079bae7bac2431c0a497026219f8b75fe41db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI0Mjc1NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453242755", "bodyText": "Yep that was my reasoning. Also figured since it was tied to the bucket it should exist on the same level.\nDoes make sense to leave as is and not cause a visible change", "author": "Nana-EC", "createdAt": "2020-07-11T22:47:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5NTU3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5NTgzMg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453095832", "bodyText": "Revert", "author": "steven-sheehy", "createdAt": "2020-07-10T22:00:00Z", "path": "charts/marketplace/gcp/schema.yaml", "diffHunk": "@@ -103,6 +103,10 @@ properties:\n               - apiGroups: ['']\n                 resources: ['pods']\n                 verbs: ['get']\n+  importer.config.hedera.mirror.importer.downloader.bucketName:", "originalCommit": "91f079bae7bac2431c0a497026219f8b75fe41db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "db57e54442630ee91c771803d63fd5d854737053", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/db57e54442630ee91c771803d63fd5d854737053", "message": "Revert moving bucketName porperty out\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-07-11T22:39:55Z", "type": "commit"}, {"oid": "4b1807de298c640af328d389c05c436b797ea72e", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4b1807de298c640af328d389c05c436b797ea72e", "message": "Pull commonDownloaderProperties and mirrorProperties from injected downloaderProperties\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-07-11T22:57:32Z", "type": "commit"}, {"oid": "b4156d182ec80b760bc3d8299a4f2ae0e9ab494b", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b4156d182ec80b760bc3d8299a4f2ae0e9ab494b", "message": "Increaseoffset between historic and incoming messages\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-07-11T23:31:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI1OTU3NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453259574", "bodyText": "I think the bucket name should act as an override for all environments, not just for OTHER. When testnet gets reset again and gets a new bucket we don't want to be blocked on a new build to correct the enum. Update docs in other areas as appropriate.", "author": "steven-sheehy", "createdAt": "2020-07-12T02:58:55Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/downloader/CommonDownloaderProperties.java", "diffHunk": "@@ -21,23 +21,30 @@\n  */\n \n import javax.validation.constraints.Min;\n-import javax.validation.constraints.NotBlank;\n import javax.validation.constraints.NotNull;\n import lombok.Data;\n import lombok.Getter;\n import lombok.RequiredArgsConstructor;\n import org.springframework.boot.context.properties.ConfigurationProperties;\n import org.springframework.validation.annotation.Validated;\n \n+import com.hedera.mirror.importer.MirrorProperties;\n+\n @Data\n @Validated\n @ConfigurationProperties(\"hedera.mirror.importer.downloader\")\n public class CommonDownloaderProperties {\n \n+    private final MirrorProperties mirrorProperties;\n+\n     private String accessKey;\n \n-    @NotBlank\n-    private String bucketName = \"hedera-demo-streams\";\n+    private String bucketName = \"\";\n+\n+    public String getBucketName() {\n+        return mirrorProperties.getNetwork() == MirrorProperties.HederaNetwork.OTHER ? bucketName :", "originalCommit": "b4156d182ec80b760bc3d8299a4f2ae0e9ab494b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYxNjM1MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r454616350", "bodyText": "Good point", "author": "Nana-EC", "createdAt": "2020-07-14T20:13:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI1OTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYzMTUzMA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r454631530", "bodyText": "please update docs as well as mentioned.", "author": "steven-sheehy", "createdAt": "2020-07-14T20:41:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI1OTU3NA=="}], "type": "inlineReview"}, {"oid": "02e89a017dbba6e4ec95a265d4c5dbbddf702494", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/02e89a017dbba6e4ec95a265d4c5dbbddf702494", "message": "Updated getBucketName to default to hedera.mirror.importer.downloader.bucketName if not null\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-07-14T20:12:56Z", "type": "commit"}, {"oid": "885e9ea874823055a09ae30192bb97c7cc31f825", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/885e9ea874823055a09ae30192bb97c7cc31f825", "message": "Updated docs and empty bucketname check\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-07-14T20:52:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY2MTEyMQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r454661121", "bodyText": "Please correct", "author": "steven-sheehy", "createdAt": "2020-07-14T21:38:39Z", "path": "charts/marketplace/gcp/schema.yaml", "diffHunk": "@@ -118,7 +118,7 @@ properties:\n     title: Importer GCP access key\n   importer.config.hedera.mirror.importer.downloader.bucketName:\n     type: string\n-    description: The Google Cloud Storage bucket name to download streamed files\n+    description: The Google Cloud Storage bucket name to download streamed files. Must be set when importer.config.hedera.mirror.importer.network is OTHER", "originalCommit": "885e9ea874823055a09ae30192bb97c7cc31f825", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc5MzIzNQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r454793235", "bodyText": "Updated.", "author": "Nana-EC", "createdAt": "2020-07-15T05:02:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY2MTEyMQ=="}], "type": "inlineReview"}, {"oid": "17a40c1b9290def942ec072cdb218536a5adfcdf", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/17a40c1b9290def942ec072cdb218536a5adfcdf", "message": "Updated schema documentaiton for bucket names\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-07-15T05:02:33Z", "type": "commit"}]}