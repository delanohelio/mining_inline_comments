{"pr_number": 1233, "pr_title": "Rosetta Individual Postgres User", "pr_createdAt": "2020-11-05T13:11:01Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/1233", "timeline": [{"oid": "7e48258ac37f0bff3abcd5d79be9ef5270a40488", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7e48258ac37f0bff3abcd5d79be9ef5270a40488", "message": "PG User add\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-27T10:53:51Z", "type": "commit"}, {"oid": "f0ec64c3a943baa5c8be19485cddeb06cfd1c5bd", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f0ec64c3a943baa5c8be19485cddeb06cfd1c5bd", "message": "Rosetta Dockerfile and main DockerCompose update\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-28T08:22:24Z", "type": "commit"}, {"oid": "0a10c7df8b14c151f146095b29003094fd7e43c9", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/0a10c7df8b14c151f146095b29003094fd7e43c9", "message": "yml rosetta user usage\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-28T08:41:35Z", "type": "commit"}, {"oid": "939430427772c4384e3c544e2326d40b720017cf", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/939430427772c4384e3c544e2326d40b720017cf", "message": "Configuration\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-28T10:29:43Z", "type": "commit"}, {"oid": "b6e94c38675ca642bae88fa89a75ea563c98d0a0", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b6e94c38675ca642bae88fa89a75ea563c98d0a0", "message": "Configuration\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-28T12:08:12Z", "type": "commit"}, {"oid": "03e0756cbe32e46dd3e07731931f05fea2c3b005", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/03e0756cbe32e46dd3e07731931f05fea2c3b005", "message": "Configuration\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-28T12:10:54Z", "type": "commit"}, {"oid": "b3b9b1ed7760f74ee86b5a791ded61607630e4a3", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b3b9b1ed7760f74ee86b5a791ded61607630e4a3", "message": "Proper configuration\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-29T08:20:39Z", "type": "commit"}, {"oid": "e3f6d5dd9d18506b49ad0250d3c072e79e222f4a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e3f6d5dd9d18506b49ad0250d3c072e79e222f4a", "message": "Comments\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-29T08:24:13Z", "type": "commit"}, {"oid": "9f045ca2a82b09547636486f08e9b4a51df0d4a5", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9f045ca2a82b09547636486f08e9b4a51df0d4a5", "message": "Path correction\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-29T08:48:18Z", "type": "commit"}, {"oid": "39c18240144a2a894b7692253bdf8eeeb436ecb5", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/39c18240144a2a894b7692253bdf8eeeb436ecb5", "message": "Merge remote-tracking branch 'limechain/feature/rosetta/pg-user' into rosetta-pguser-addition", "committedDate": "2020-10-29T08:48:27Z", "type": "commit"}, {"oid": "4e23154d79779377c991cc485fdf72807d8c62fd", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4e23154d79779377c991cc485fdf72807d8c62fd", "message": "Path correction\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-29T09:06:44Z", "type": "commit"}, {"oid": "f1f47a022bdc94057e6d3867fed362434ca95861", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f1f47a022bdc94057e6d3867fed362434ca95861", "message": "Script correction\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-29T09:43:55Z", "type": "commit"}, {"oid": "84c1f4d2fb1180643c73fcb15ee056c37b5e216c", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/84c1f4d2fb1180643c73fcb15ee056c37b5e216c", "message": "Script correction\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-29T10:01:00Z", "type": "commit"}, {"oid": "42a7c5fab28f1b9a76dc3455b58955c06aa6492d", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/42a7c5fab28f1b9a76dc3455b58955c06aa6492d", "message": "Dockerfile correction\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-10-29T10:04:19Z", "type": "commit"}, {"oid": "76ea1a59c479664b4c5ad694fe813ce27470d382", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/76ea1a59c479664b4c5ad694fe813ce27470d382", "message": "fix: docs + all-in-one latest execution\n\nSigned-off-by: failfmi <oscurocalma@gmail.com>", "committedDate": "2020-11-05T10:06:42Z", "type": "commit"}, {"oid": "f2ba92b5f98517083b973edee3ffc902cfcbe1a3", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f2ba92b5f98517083b973edee3ffc902cfcbe1a3", "message": "Merge pull request #162 from LimeChain/rosetta-pguser-addition\n\nRosetta pguser addition", "committedDate": "2020-11-05T13:04:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyNzE1Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1233#discussion_r518127152", "bodyText": "Would prefer this file at its original location. I'm guessing it was moved so you don't mount the other sql scripts into the docker volume. See my other comment.", "author": "steven-sheehy", "createdAt": "2020-11-05T15:14:19Z", "path": "hedera-mirror-importer/src/main/resources/db/scripts/init/init.sql", "diffHunk": "@@ -0,0 +1,39 @@\n+-- Change the values below if you are not installing via Docker", "originalCommit": "f2ba92b5f98517083b973edee3ffc902cfcbe1a3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE0OTE1MQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1233#discussion_r518149151", "bodyText": "Should just be able to mount a single file:\n- ./hedera-mirror-importer/src/main/resources/db/scripts/init.sql:/docker-entrypoint-initdb.d/init.sql\n\nOr if that doesn't work the long syntax might.", "author": "steven-sheehy", "createdAt": "2020-11-05T15:40:21Z", "path": "docker-compose.yml", "diffHunk": "@@ -12,7 +12,7 @@ services:\n       POSTGRES_USER: mirror_node\n     volumes:\n       - ./db:/var/lib/postgresql/data\n-      - ./hedera-mirror-grpc/scripts/db/:/docker-entrypoint-initdb.d/\n+      - ./hedera-mirror-importer/src/main/resources/db/scripts/init/:/docker-entrypoint-initdb.d/", "originalCommit": "f2ba92b5f98517083b973edee3ffc902cfcbe1a3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE1NTUzNw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1233#discussion_r518155537", "bodyText": "What's the purpose of creating the mirror_node user idempotently if you're not going to also create the grpc and rosetta users the same way?", "author": "steven-sheehy", "createdAt": "2020-11-05T15:48:34Z", "path": "hedera-mirror-importer/src/main/resources/db/scripts/init/init.sql", "diffHunk": "@@ -0,0 +1,39 @@\n+-- Change the values below if you are not installing via Docker\n+\n+\\set db_name 'mirror_node'\n+\\set db_user 'mirror_node'\n+\\set db_password 'mirror_node_pass'\n+\\set db_owner 'mirror_node'\n+\\set grpc_user 'mirror_grpc'\n+\\set grpc_password 'mirror_grpc_pass'\n+\\set rosetta_user 'mirror_rosetta'\n+\\set rosetta_password 'mirror_rosetta_pass'\n+\n+select 'create database mirror_node'\n+where not exists (select from pg_database where datname = :'db_name')\\gexec\n+\n+do $$\n+begin\n+  create user mirror_node with login createrole password 'mirror_node_pass';\n+  exception when duplicate_object then\n+  raise notice 'not creating user mirror_node -- it already exists';\n+end\n+$$;\n+\n+create user :grpc_user with login password :'grpc_password';", "originalCommit": "f2ba92b5f98517083b973edee3ffc902cfcbe1a3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "361949858ae11e38a8953e2e5a94cab528f1286a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/361949858ae11e38a8953e2e5a94cab528f1286a", "message": "PR Comments Resolution\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-11-06T07:52:02Z", "type": "commit"}, {"oid": "90808a0f92f7d295b2c917a52003a7c99af9bad3", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/90808a0f92f7d295b2c917a52003a7c99af9bad3", "message": "PR Comments Resolution\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-11-06T08:20:08Z", "type": "commit"}, {"oid": "17c15fcf62240df2d8cfeab4eb25d68887576093", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/17c15fcf62240df2d8cfeab4eb25d68887576093", "message": "Docs files correction\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-11-06T08:22:55Z", "type": "commit"}, {"oid": "d88a8ac8a48a29d6e61772a7017a509791f9f3db", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d88a8ac8a48a29d6e61772a7017a509791f9f3db", "message": "Unnecessary things removal\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-11-06T08:44:06Z", "type": "commit"}, {"oid": "10e5f7884ae1deb2c7d48a390e45c75d1ecfdd3d", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/10e5f7884ae1deb2c7d48a390e45c75d1ecfdd3d", "message": "Merge pull request #164 from LimeChain/feature/rosetta/pg-user-refactor\n\nPR Comments Resolution", "committedDate": "2020-11-06T08:57:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkzNzE1Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1233#discussion_r518937152", "bodyText": "This needs to use the rosetta_user and rosetta_password variables", "author": "steven-sheehy", "createdAt": "2020-11-06T18:43:32Z", "path": "hedera-mirror-importer/src/main/resources/db/scripts/init.sql", "diffHunk": "@@ -6,17 +6,46 @@\n \\set db_owner 'mirror_node'\n \\set grpc_user 'mirror_grpc'\n \\set grpc_password 'mirror_grpc_pass'\n+\\set rosetta_user 'mirror_rosetta'\n+\\set rosetta_password 'mirror_rosetta_pass'\n+\n+do $$\n+begin\n+  create user mirror_node with createrole password 'mirror_node_pass';\n+  exception when duplicate_object then\n+  raise notice 'not creating user mirror_node -- it already exists';\n+end\n+$$;\n+\n+select 'create database mirror_node'\n+where not exists (select from pg_database where datname = :'db_name')\\gexec\n+\n+do $$\n+begin\n+  create user mirror_grpc with login password 'mirror_grpc_pass';\n+  exception when duplicate_object then\n+  raise notice 'not creating user mirror_grpc -- it already exists';\n+end\n+$$;\n \n-create user :db_user with login createrole password :'db_password';\n-\n-create database :db_name with owner :db_owner;\n+grant connect on database :db_name to :grpc_user;\n \n-create user :grpc_user with login password :'grpc_password';\n+do $$\n+begin\n+  create user mirror_rosetta with login password 'mirror_rosetta_pass';", "originalCommit": "10e5f7884ae1deb2c7d48a390e45c75d1ecfdd3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkzNzM2Ng==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1233#discussion_r518937366", "bodyText": "This needs to use the grpc_user and grpc_password variables", "author": "steven-sheehy", "createdAt": "2020-11-06T18:44:03Z", "path": "hedera-mirror-importer/src/main/resources/db/scripts/init.sql", "diffHunk": "@@ -6,17 +6,46 @@\n \\set db_owner 'mirror_node'\n \\set grpc_user 'mirror_grpc'\n \\set grpc_password 'mirror_grpc_pass'\n+\\set rosetta_user 'mirror_rosetta'\n+\\set rosetta_password 'mirror_rosetta_pass'\n+\n+do $$\n+begin\n+  create user mirror_node with createrole password 'mirror_node_pass';\n+  exception when duplicate_object then\n+  raise notice 'not creating user mirror_node -- it already exists';\n+end\n+$$;\n+\n+select 'create database mirror_node'\n+where not exists (select from pg_database where datname = :'db_name')\\gexec\n+\n+do $$\n+begin\n+  create user mirror_grpc with login password 'mirror_grpc_pass';", "originalCommit": "10e5f7884ae1deb2c7d48a390e45c75d1ecfdd3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkzNzU3OA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1233#discussion_r518937578", "bodyText": "This needs to use the db_name variable", "author": "steven-sheehy", "createdAt": "2020-11-06T18:44:32Z", "path": "hedera-mirror-importer/src/main/resources/db/scripts/init.sql", "diffHunk": "@@ -6,17 +6,46 @@\n \\set db_owner 'mirror_node'\n \\set grpc_user 'mirror_grpc'\n \\set grpc_password 'mirror_grpc_pass'\n+\\set rosetta_user 'mirror_rosetta'\n+\\set rosetta_password 'mirror_rosetta_pass'\n+\n+do $$\n+begin\n+  create user mirror_node with createrole password 'mirror_node_pass';\n+  exception when duplicate_object then\n+  raise notice 'not creating user mirror_node -- it already exists';\n+end\n+$$;\n+\n+select 'create database mirror_node'", "originalCommit": "10e5f7884ae1deb2c7d48a390e45c75d1ecfdd3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkzNzY4MQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1233#discussion_r518937681", "bodyText": "This needs to use the variables", "author": "steven-sheehy", "createdAt": "2020-11-06T18:44:42Z", "path": "hedera-mirror-importer/src/main/resources/db/scripts/init.sql", "diffHunk": "@@ -6,17 +6,46 @@\n \\set db_owner 'mirror_node'\n \\set grpc_user 'mirror_grpc'\n \\set grpc_password 'mirror_grpc_pass'\n+\\set rosetta_user 'mirror_rosetta'\n+\\set rosetta_password 'mirror_rosetta_pass'\n+\n+do $$\n+begin\n+  create user mirror_node with createrole password 'mirror_node_pass';", "originalCommit": "10e5f7884ae1deb2c7d48a390e45c75d1ecfdd3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2d561238d8c979f3076721247c03e719d8c0cb75", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2d561238d8c979f3076721247c03e719d8c0cb75", "message": "Init script modification\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-11-09T11:48:38Z", "type": "commit"}, {"oid": "183b661f07951d6446e903dc4756447f224dd6d1", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/183b661f07951d6446e903dc4756447f224dd6d1", "message": "Parametrized functions\n\nSigned-off-by: Georgi Yazovaliyski <georgi.yazovaliiski@gmail.com>", "committedDate": "2020-11-09T12:51:50Z", "type": "commit"}, {"oid": "02ca6a75975e9bea13f669306fa84a8dd7306a97", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/02ca6a75975e9bea13f669306fa84a8dd7306a97", "message": "Merge pull request #165 from LimeChain/feature/rosetta/pg-user-refactor\n\nInit script modification", "committedDate": "2020-11-09T13:34:33Z", "type": "commit"}]}