{"pr_number": 1197, "pr_title": "HTS: Add HTS REST API tests to monitor", "pr_createdAt": "2020-10-26T15:54:36Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197", "timeline": [{"oid": "2479a154fe389f0db892e516bff7b0e82baf8cd0", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2479a154fe389f0db892e516bff7b0e82baf8cd0", "message": "add token tests to monitor_apis\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-10-23T22:38:51Z", "type": "commit"}, {"oid": "c22ccf906f4a3d92abf676efb0b6b815e5cbb9b8", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c22ccf906f4a3d92abf676efb0b6b815e5cbb9b8", "message": "Merge branch 'master' into monitor-tokens", "committedDate": "2020-10-26T15:03:19Z", "type": "commit"}, {"oid": "5c2959916c75f3238240442af900277af2da5856", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5c2959916c75f3238240442af900277af2da5856", "message": "rename function, update README\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-10-26T15:49:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA4OTc3Mw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512089773", "bodyText": "You should note in the description and file name that there's no matching result.", "author": "Nana-EC", "createdAt": "2020-10-26T16:19:47Z", "path": "hedera-mirror-rest/__tests__/specs/token-balances-13-timestamp-range.spec.json", "diffHunk": "@@ -0,0 +1,142 @@\n+{\n+  \"description\": \"Token balances api calls for all account balances referencing the latest snapshot in a timestamp range\",", "originalCommit": "5c2959916c75f3238240442af900277af2da5856", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5MDE1Ng==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512090156", "bodyText": "This is good, we should add another spec file with a valid response for greater coverage of the timestamp range filter", "author": "Nana-EC", "createdAt": "2020-10-26T16:20:21Z", "path": "hedera-mirror-rest/__tests__/specs/token-balances-13-timestamp-range.spec.json", "diffHunk": "@@ -0,0 +1,142 @@\n+{\n+  \"description\": \"Token balances api calls for all account balances referencing the latest snapshot in a timestamp range\",\n+  \"setup\": {\n+    \"accounts\": [\n+      {\n+        \"entity_num\": 4\n+      },\n+      {\n+        \"entity_num\": 5\n+      },\n+      {\n+        \"entity_num\": 6\n+      },\n+      {\n+        \"entity_num\": 7\n+      }\n+    ],\n+    \"tokens\": [\n+      {\n+        \"token_id\": \"0.20.1\",\n+        \"symbol\": \"TOKEN1\"\n+      },\n+      {\n+        \"token_id\": \"0.20.2\",\n+        \"symbol\": \"TOKEN2\"\n+      },\n+      {\n+        \"token_id\": \"0.20.3\",\n+        \"symbol\": \"TOKEN3\"\n+      },\n+      {\n+        \"token_id\": \"0.20.4\",\n+        \"symbol\": \"TOKEN4\"\n+      },\n+      {\n+        \"token_id\": \"0.20.5\",\n+        \"symbol\": \"TOKEN5\"\n+      }\n+    ],\n+    \"balances\": [\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 4,\n+        \"balance\": 40\n+      },\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 5,\n+        \"balance\": 50\n+      },\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 6,\n+        \"balance\": 60\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 4,\n+        \"balance\": 444,\n+        \"tokens\": [\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 1,\n+            \"balance\": 4\n+          },\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 2,\n+            \"balance\": 44\n+          }\n+        ]\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 5,\n+        \"balance\": 555,\n+        \"tokens\": [\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 1,\n+            \"balance\": 5\n+          },\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 2,\n+            \"balance\": 55\n+          }\n+        ]\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 6,\n+        \"balance\": 666,\n+        \"tokens\": [\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 1,\n+            \"balance\": 6\n+          },\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 2,\n+            \"balance\": 66\n+          }\n+        ]\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 7,\n+        \"balance\": 777\n+      },\n+      {\n+        \"timestamp\": 1566560007000000000,\n+        \"id\": 5,\n+        \"balance\": 5\n+      },\n+      {\n+        \"timestamp\": 1566560007000000000,\n+        \"id\": 6,\n+        \"balance\": 6,\n+        \"tokens\": [\n+          {\n+            \"token_realm\": 0,\n+            \"token_num\": 90000,\n+            \"balance\": 662\n+          }\n+        ]\n+      }\n+    ],\n+    \"transactions\": [],\n+    \"cryptotransfers\": []\n+  },\n+  \"url\": \"/api/v1/tokens/0.20.1/balances?timestamp=gt:1566560003.000000000&timestamp=lt:1566560004.000000000\",", "originalCommit": "5c2959916c75f3238240442af900277af2da5856", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5MTMxMg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512091312", "bodyText": "Should accounts be in this list?", "author": "Nana-EC", "createdAt": "2020-10-26T16:21:57Z", "path": "hedera-mirror-rest/monitoring/README.md", "diffHunk": "@@ -51,38 +51,56 @@ nano config/serverlist.json // Insert the mirror node deployments you want to mo\n \n To customize per-resource configuration:\n \n-- `freshnessThreshold` (in seconds) for `balance`, `transaction`, and `topic` can be adjusted independently if needed.\n-   Set to 0 to disable freshness check for a resource\n-- `intervalMultiplier` for all resources. The tests for a resource will run every `interval * intervalMultiplier` seconds.\n-   For `stateproof`, it defaults to 10, so the tests run at a lower frequency to reduce cost\n-- `limit` threshold for `account`, `balance`, `transatcion`, and `topic` can be adjusted independently if needed, e.g.,\n-  for environments with lower traffic volume\n+- set `enabled` to `true` or `false` to enable / disable tests for a resource\n+- `freshnessThreshold` (in seconds) for `balance`, `transaction`, `topic`, and `token` (balances of a token) can be", "originalCommit": "5c2959916c75f3238240442af900277af2da5856", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg1NTE5Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512855192", "bodyText": "nope, account doesn't have a freshness check", "author": "xin-hedera", "createdAt": "2020-10-27T16:44:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5MTMxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgxOTk0NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512819945", "bodyText": "transaction", "author": "steven-sheehy", "createdAt": "2020-10-27T16:00:08Z", "path": "hedera-mirror-rest/monitoring/README.md", "diffHunk": "@@ -51,38 +51,56 @@ nano config/serverlist.json // Insert the mirror node deployments you want to mo\n \n To customize per-resource configuration:\n \n-- `freshnessThreshold` (in seconds) for `balance`, `transaction`, and `topic` can be adjusted independently if needed.\n-   Set to 0 to disable freshness check for a resource\n-- `intervalMultiplier` for all resources. The tests for a resource will run every `interval * intervalMultiplier` seconds.\n-   For `stateproof`, it defaults to 10, so the tests run at a lower frequency to reduce cost\n-- `limit` threshold for `account`, `balance`, `transatcion`, and `topic` can be adjusted independently if needed, e.g.,\n-  for environments with lower traffic volume\n+- set `enabled` to `true` or `false` to enable / disable tests for a resource\n+- `freshnessThreshold` (in seconds) for `balance`, `transaction`, `topic`, and `token` (balances of a token) can be\n+   adjusted independently if needed. Set to 0 to disable freshness check for a resource\n+- `intervalMultiplier` for all resources. The tests for a resource will run every `interval * intervalMultiplier`\n+   seconds. For `stateproof`, it defaults to 10, so the tests run at a lower frequency to reduce cost\n+- `limit` threshold for `account`, `balance`, `transatcion`, `topic`, and `token` can be adjusted independently if", "originalCommit": "5c2959916c75f3238240442af900277af2da5856", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg0ODc1NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512848754", "bodyText": "Should check if enabled flag is present as well to not break existing configs.", "author": "steven-sheehy", "createdAt": "2020-10-27T16:36:07Z", "path": "hedera-mirror-rest/monitoring/monitor_apis/monitor_tests.js", "diffHunk": "@@ -46,7 +47,8 @@ const counters = {};\n const runTests = (name, address) => {\n   const counter = name in counters ? counters[name] : 0;\n   const skippedResource = [];\n-  const testModules = allTestModules.filter((testModule) => {\n+  const enabledTestModules = allTestModules.filter((testModule) => config[testModule.resource].enabled);", "originalCommit": "5c2959916c75f3238240442af900277af2da5856", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a6d717083f7fde1e3c1c0c6fa6d9471a25154f23", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a6d717083f7fde1e3c1c0c6fa6d9471a25154f23", "message": "address review feedback\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-10-27T17:23:30Z", "type": "commit"}]}