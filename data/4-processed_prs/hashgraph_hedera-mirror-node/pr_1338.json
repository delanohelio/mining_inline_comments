{"pr_number": 1338, "pr_title": "Port the second transaction query optimization from release/0.23", "pr_createdAt": "2020-12-09T01:21:48Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/1338", "timeline": [{"oid": "7d14baccb397273a80b3f5e3ec141c0bba849040", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7d14baccb397273a80b3f5e3ec141c0bba849040", "message": "Add timestamp conditions to the transaction table in the transactions inner query\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-12-09T01:05:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQzOTAyOA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1338#discussion_r539439028", "bodyText": "Is this intentional to have tsParams concatenated twice?", "author": "steven-sheehy", "createdAt": "2020-12-09T16:10:14Z", "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -218,11 +219,11 @@ const reqToSql = function (req) {\n   const parsedQueryParams = req.query;\n   const [creditDebitQuery] = utils.parseCreditDebitParams(parsedQueryParams, 'ctl.amount');\n   const [accountQuery, accountParams] = utils.parseAccountIdQueryParam(parsedQueryParams, 'ctl.entity_id');\n-  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 'ctl.consensus_timestamp');\n+  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 't.consensus_ns');\n   const resultTypeQuery = utils.parseResultParams(req, 't.result');\n   const transactionTypeQuery = utils.getTransactionTypeQuery(parsedQueryParams);\n   const {query, params, order, limit} = utils.parseLimitAndOrderParams(req);\n-  const sqlParams = accountParams.concat(tsParams).concat(params);\n+  const sqlParams = accountParams.concat(tsParams).concat(tsParams).concat(params);", "originalCommit": "7d14baccb397273a80b3f5e3ec141c0bba849040", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ1MjY3Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1338#discussion_r539452677", "bodyText": "yes. because the same timestamp conditions now apply to both crytpo_transfer.consensus_timestamp and transaction.consensus_ns and later the mysql style query & params are translated to postgres style. the translator has no idea that those timestamp param values are the same\nit's also why in the first attempt, I tested and thought putting timestamp conditions on transaction.consensus_ns is enough to avoid:\n\nconvert the condition column name in getTransactionsInnerQuery\nconcat tsParams twice\n\nI suggest we handle it in a bigger refactoring.", "author": "xin-hedera", "createdAt": "2020-12-09T16:26:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQzOTAyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTUzNjUyMA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1338#discussion_r539536520", "bodyText": "Ah, I was confused because I was thinking it was the query which included the column name, but it's just the timestamp itself passed twice. Makes sense.", "author": "steven-sheehy", "createdAt": "2020-12-09T18:15:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQzOTAyOA=="}], "type": "inlineReview"}]}