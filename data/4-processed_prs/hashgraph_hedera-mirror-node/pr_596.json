{"pr_number": 596, "pr_title": "Configuration to delete parsed files", "pr_createdAt": "2020-03-12T21:41:10Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/596", "timeline": [{"oid": "42875c07c680e23a2f61c46f04ade38e571808bd", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/42875c07c680e23a2f61c46f04ade38e571808bd", "message": "Configuration to delete parsed files\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-03-12T21:40:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTkzODg5OQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/596#discussion_r391938899", "bodyText": "Should this method be something that lives in Utility class. Taking in a boolean of whether to move or delete and the name\ne.g.\npublic void moveOrDeleteParsedFile(boolean move, String fileName) {\n        if (moved) {\n             Utility.moveFileToParsedDir(fileName, \"/parsedBalanceFiles/\");\n         } else {\n             Utility.deleteParsedFile(fileName);\n         }\n}\n\nThat way The FileParser classes only have to call\n\nUtility. moveOrDeleteParsedFile(parserProperties.isKeepFiles(), PARSED_DIR)", "author": "Nana-EC", "createdAt": "2020-03-12T22:26:48Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/balance/BalanceFileParser.java", "diffHunk": "@@ -97,23 +94,26 @@ private void processAllFilesForHistory() {\n \n     private void processLastBalanceFile() {\n         Stopwatch stopwatch = Stopwatch.createStarted();\n-\n         try {\n             File balanceFile = getLatestBalanceFile();\n-\n             if (balanceFile == null) {\n                 return;\n             }\n-\n             log.debug(\"Processing last balance file {}\", balanceFile);\n-\n             if (new AccountBalancesFileLoader((BalanceParserProperties) parserProperties, balanceFile.toPath())\n                     .loadAccountBalances()) {\n-                // move it\n-                Utility.moveFileToParsedDir(balanceFile.getCanonicalPath(), \"/parsedBalanceFiles/\");\n+                moveOrDeleteParsedFile(balanceFile.getCanonicalPath());\n             }\n         } catch (Exception e) {\n             log.error(\"Error processing balances files after {}\", stopwatch, e);\n         }\n     }\n+\n+    private void moveOrDeleteParsedFile(String fileName) {", "originalCommit": "42875c07c680e23a2f61c46f04ade38e571808bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTkzOTM4NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/596#discussion_r391939385", "bodyText": "The code defaults to true but this file says it's false. You should clarify which one is right. I think we're going for false by default now no?", "author": "Nana-EC", "createdAt": "2020-03-12T22:28:14Z", "path": "docs/configuration.md", "diffHunk": "@@ -114,10 +114,13 @@ value, it is recommended to only populate overridden properties in the custom `a\n | `hedera.mirror.parser.balance.batchSize`                   | 2000                    | The number of balances to insert before committing                                             |\n | `hedera.mirror.parser.balance.enabled`                     | true                    | Whether to enable balance file parsing                                                         |\n | `hedera.mirror.parser.balance.fileBufferSize`              | 200000                  | The size of the buffer to use when reading in the balance file                                 |\n+| `hedera.mirror.parser.balance.keepFiles`                   | false                   | Whether to keep parsed files after successful parsing. If false, files are deleted.            |", "originalCommit": "42875c07c680e23a2f61c46f04ade38e571808bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk0NDI5NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/596#discussion_r391944295", "bodyText": "oops, should be false everywhere. Changed. Thanks.", "author": "apeksharma", "createdAt": "2020-03-12T22:43:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTkzOTM4NQ=="}], "type": "inlineReview"}, {"oid": "e6fe9a91f3fbc375fb77a8c820994e93dc57080c", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e6fe9a91f3fbc375fb77a8c820994e93dc57080c", "message": "Configuration to delete parsed files\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-03-12T22:41:16Z", "type": "commit"}, {"oid": "fad5d48b06c80f6d1103625b127418292c4c4f19", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fad5d48b06c80f6d1103625b127418292c4c4f19", "message": "address reviews\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-03-12T23:36:20Z", "type": "commit"}, {"oid": "fad5d48b06c80f6d1103625b127418292c4c4f19", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fad5d48b06c80f6d1103625b127418292c4c4f19", "message": "address reviews\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-03-12T23:36:20Z", "type": "forcePushed"}]}