{"pr_number": 822, "pr_title": "Containerize acceptance tests", "pr_createdAt": "2020-06-11T16:03:46Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/822", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwMjg0Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r438902847", "bodyText": "There's a bug where newer version of NETTY don't seem to play nice with and this was the last supported version that doesn't block the tests from running\nException in thread \"grpc\n-default-executor-0\" java.lang.NoSuchFieldError: NETTY_SHADED\nat io.grpc.netty.shaded.io.grpc.netty.NettyClientStream.<clinit>(NettyClientStream.java:59)\nat io.grpc.netty.shaded.io.grpc.netty.NettyClientTransport.newStream(NettyClientTransport.java:177)\nat io.grpc.internal.CallCredentialsApplyingTransportFactory$CallCredentialsApplyingTransport.newStream(CallCredentialsApplyingTransportFactory.java:117)\n\nat io.grpc.internal.ForwardingConnectionClientTransport.newStream(ForwardingConnectionClientTransport.java:49)\nat io.grpc.internal.InternalSubchannel$CallTracingTransport.newStream(InternalSubchannel.java:635)\nat io.grpc.internal.DelayedClientTransport$PendingStream.createRealStream(DelayedClientTransport.java:353)\nat io.grpc.internal.DelayedClientTransport$PendingStream.access$300(DelayedClientTransport.java:341)\nat io.grpc.internal.DelayedClientTransport$5.run(DelayedClientTransport.java:300)\nat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\nat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\nat java.base/java.lang.Thread.run(Thread.java:834)", "author": "Nana-EC", "createdAt": "2020-06-11T16:06:49Z", "path": "hedera-mirror-test/pom.xml", "diffHunk": "@@ -32,7 +32,7 @@\n         <dependency>\n             <groupId>io.grpc</groupId>\n             <artifactId>grpc-netty-shaded</artifactId>\n-            <version>${grpc.version}</version>\n+            <version>1.27.2</version>", "originalCommit": "8da6ef4938e232f4543b65e2be28a8608d1ee81d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ1NzExMQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r439457111", "bodyText": "Should add a short comment to the pom otherwise this will just get changed later.", "author": "steven-sheehy", "createdAt": "2020-06-12T14:35:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwMjg0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNTY0Mw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441925643", "bodyText": "Done", "author": "Nana-EC", "createdAt": "2020-06-18T01:58:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwMjg0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwMzYyMg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r438903622", "bodyText": "One option to reduce image size and build time is to move this to the script and do it at container start when a test is run", "author": "Nana-EC", "createdAt": "2020-06-11T16:08:03Z", "path": "scripts/test-container/Dockerfile", "diffHunk": "@@ -0,0 +1,30 @@\n+# Containerizes hedera-mirror-node tests that can be run against various endpoints\n+# docker build -f scripts/test-container/Dockerfile . -t gcr.io/mirrornode/hedera-mirror-test:<project-version>\n+FROM adoptopenjdk:11-jdk-hotspot\n+\n+RUN mkdir /usr/etc\n+\n+WORKDIR /usr/etc\n+\n+RUN mkdir /usr/etc/hedera-mirror-node/\n+COPY . /usr/etc/hedera-mirror-node/\n+\n+WORKDIR /usr/etc/hedera-mirror-node\n+\n+ENV testProfile acceptance\n+ENV cucumberFlags \"@BalanceCheck\"\n+ENV subscribeThreadCount 30\n+ENV jmeterTestPlan E2E_Subscribe_Only.jmx\n+\n+# ensure all maven dependecies are placed ahead of test run\n+RUN ./mvnw install -DskipTests -Djib.skip -Ddocker.skip --no-transfer-progress \\", "originalCommit": "8da6ef4938e232f4543b65e2be28a8608d1ee81d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNDk2Ng==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440334966", "bodyText": "That would increase run time though, which is way worse.", "author": "steven-sheehy", "createdAt": "2020-06-15T17:31:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwMzYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM1NTE2Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440355162", "bodyText": "Agreed. As is is cool. May have to consider a different process to deploy this image only as it does take about 30 mins locally (might be quicker in CircleCI), but let's see how it affects our process", "author": "Nana-EC", "createdAt": "2020-06-15T18:08:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwMzYyMg=="}], "type": "inlineReview"}, {"oid": "d2c9dd3b4f64266d11e0604b05d0c9884e5ca2ca", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d2c9dd3b4f64266d11e0604b05d0c9884e5ca2ca", "message": "Add aggregate-third-party-report logic\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-11T21:24:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ1ODAwNg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r439458006", "bodyText": "This should be moved to BUILDING.md", "author": "steven-sheehy", "createdAt": "2020-06-12T14:36:31Z", "path": "charts/marketplace/gcp/README.md", "diffHunk": "@@ -358,6 +358,7 @@ kubectl scale -n \"${NAMESPACE}\" --replicas=1 \"statefulset/${APP_NAME}-importer\"\n ```\n \n # Upgrade\n+    ./mvnw clean deploy -N -Ddocker.skip.customfiles=false -Ddocker.tags.0=0.12 -Ddocker.tag.version=0.12.0-rc1", "originalCommit": "9b8952cb37276c62bda120a2320d03178fabb2b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNTUxNA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441925514", "bodyText": "Moved", "author": "Nana-EC", "createdAt": "2020-06-18T01:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ1ODAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyMzUyNg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440323526", "bodyText": "This should probably be removed. We don't need to produce a report every build as no one is looking at them. We just need to do it ad hoc.", "author": "steven-sheehy", "createdAt": "2020-06-15T17:10:17Z", "path": "pom.xml", "diffHunk": "@@ -276,6 +276,18 @@\n                                 <organizeLicensesByDependencies>true</organizeLicensesByDependencies>\n                             </configuration>\n                         </execution>\n+                        <execution>\n+                            <id>default-cli</id>\n+                            <phase>verify</phase>", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNjAxOQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441926019", "bodyText": "Removed", "author": "Nana-EC", "createdAt": "2020-06-18T01:59:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyMzUyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNTIwMA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440325200", "bodyText": "The docker build for the hedera-mirror-test module should be within the hedera-mirror-test module even if the contextDir is the root dir.", "author": "steven-sheehy", "createdAt": "2020-06-15T17:13:34Z", "path": "pom.xml", "diffHunk": "@@ -345,8 +357,18 @@\n                             </build>\n                             <name>${docker.push.repository}/hedera-mirror-node/deployer:${docker.tag.version}</name>\n                         </image>\n+                        <image>\n+                            <build>\n+                                <contextDir>${project.basedir}</contextDir>\n+                                <dockerFile>${project.basedir}/scripts/test-container/Dockerfile</dockerFile>\n+                                <args>\n+                                    <tag>${docker.tag.version}</tag>\n+                                </args>\n+                            </build>\n+                            <name>${docker.push.repository}/hedera-mirror-test:${docker.tag.version}</name>", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM2MDQ4Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440360487", "bodyText": "Agreed, I started that way (it is the right way) but was hitting docker-maven-plugin issues in maven because the temporary tar created was in the context and I couldn't get the ignores to ignore it.\nCan try again but this was my workaround", "author": "Nana-EC", "createdAt": "2020-06-15T18:18:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNTIwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNjI1Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441926257", "bodyText": "Fixed the docker ignore. It had to be where the context was and not where the Dockerfile necessarily was", "author": "Nana-EC", "createdAt": "2020-06-18T02:00:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNTIwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNTQxNQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440325415", "bodyText": "It's not clear from the name what this is for. Recommend reverting to deployer and moving test image to test module.", "author": "steven-sheehy", "createdAt": "2020-06-15T17:13:59Z", "path": "pom.xml", "diffHunk": "@@ -57,7 +57,7 @@\n         <docker-maven-plugin.version>0.33.0</docker-maven-plugin.version>\n         <docker.push.repository>gcr.io/mirrornode</docker.push.repository>\n         <docker.resources>${project.build.directory}/container</docker.resources>\n-        <docker.skip.deployer>true</docker.skip.deployer>\n+        <docker.skip.customfiles>true</docker.skip.customfiles>", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM2MDU5NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440360594", "bodyText": "Can do", "author": "Nana-EC", "createdAt": "2020-06-15T18:18:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNTQxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNTc1Ng==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441925756", "bodyText": "Reverted", "author": "Nana-EC", "createdAt": "2020-06-18T01:58:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNTQxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNzk4OA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440327988", "bodyText": "File can be removed as we don't need to produce the report in the build and logic should move to test module anyway. Instead, you should pass a <licensesConfigFile> to the top level config for license-maven-plugin that supplies the license for the oro dependency.", "author": "steven-sheehy", "createdAt": "2020-06-15T17:18:34Z", "path": "licenses/THIRD-PARTY.properties", "diffHunk": "@@ -0,0 +1 @@\n+oro--oro--2.0.8=Apache License, Version 1.1", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNTY5NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441925694", "bodyText": "Removed", "author": "Nana-EC", "createdAt": "2020-06-18T01:58:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNzk4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MzcwMg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r442483702", "bodyText": "I still see this file", "author": "steven-sheehy", "createdAt": "2020-06-18T20:27:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNzk4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyODYzMg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440328632", "bodyText": "Very hard to read. Please move rate calculation to variables for clarity.", "author": "steven-sheehy", "createdAt": "2020-06-15T17:19:49Z", "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/jmeter/sampler/result/HCSSamplerResult.java", "diffHunk": "@@ -74,10 +88,17 @@ public void onNext(T result) {\n \n     public void onComplete() {\n         String errorMessage = subscribeError == null ? \"\" : subscribeError.getMessage();\n-        log.info(\"Observed {} historic and {} incoming messages in {} ({}/s). Last message received {} ago. {}\",\n-                historicalMessageCount,\n-                incomingMessageCount, stopwatch, getMessageRate(), lastMessage, success ? \"Success\" :\n+        log.info(\"Observed {} total messages in {} ({}/s). Last message received {} ago. {}.\",\n+                getTotalMessageCount(), totalStopwatch, String\n+                        .format(\"%.02f\", getMessageRate(getTotalMessageCount(), totalStopwatch)), lastMessage,", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNTU3NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441925574", "bodyText": "Done", "author": "Nana-EC", "createdAt": "2020-06-18T01:57:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyODYzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMTY2Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440331667", "bodyText": "You need to fix the download-licenses for the new test module. You need to change excludedScope to include test only for the test module. Please verify contents of image contain the source code and licenses for all hedera-mirror-test dependencies.", "author": "steven-sheehy", "createdAt": "2020-06-15T17:25:12Z", "path": "pom.xml", "diffHunk": "@@ -276,6 +276,18 @@\n                                 <organizeLicensesByDependencies>true</organizeLicensesByDependencies>", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNTk4Mw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441925983", "bodyText": "Removed exclude from here and moved it to importer and grpc.\nLeaving it here wasn't working even after updating exclude or include for test in the test module", "author": "Nana-EC", "createdAt": "2020-06-18T01:59:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMTY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMTkzNg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440331936", "bodyText": "Move the contents of test-container folder to hedera-mirror-test module", "author": "steven-sheehy", "createdAt": "2020-06-15T17:25:40Z", "path": "scripts/test-container/.maven-dockerignore", "diffHunk": "@@ -0,0 +1,5 @@\n+target/", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNjMwNA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441926304", "bodyText": "Done", "author": "Nana-EC", "createdAt": "2020-06-18T02:00:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMTkzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMzg4MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440333880", "bodyText": "These 5 lines can be consolidated to:\nWORKDIR /usr/src/hedera-mirror-test\nCOPY . .", "author": "steven-sheehy", "createdAt": "2020-06-15T17:29:02Z", "path": "scripts/test-container/Dockerfile", "diffHunk": "@@ -0,0 +1,30 @@\n+# Containerizes hedera-mirror-node tests that can be run against various endpoints\n+# docker build -f scripts/test-container/Dockerfile . -t gcr.io/mirrornode/hedera-mirror-test:<project-version>\n+FROM adoptopenjdk:11-jdk-hotspot\n+\n+RUN mkdir /usr/etc", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNjM2MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441926360", "bodyText": "Thanks. Changed", "author": "Nana-EC", "createdAt": "2020-06-18T02:00:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMzg4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNTU1MQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440335551", "bodyText": "We use the following to download dependencies in CircleCI:\n./mvnw ${MAVEN_CLI_OPTS} de.qaware.maven:go-offline-maven-plugin:resolve-dependencies", "author": "steven-sheehy", "createdAt": "2020-06-15T17:32:10Z", "path": "scripts/test-container/Dockerfile", "diffHunk": "@@ -0,0 +1,30 @@\n+# Containerizes hedera-mirror-node tests that can be run against various endpoints\n+# docker build -f scripts/test-container/Dockerfile . -t gcr.io/mirrornode/hedera-mirror-test:<project-version>\n+FROM adoptopenjdk:11-jdk-hotspot\n+\n+RUN mkdir /usr/etc\n+\n+WORKDIR /usr/etc\n+\n+RUN mkdir /usr/etc/hedera-mirror-node/\n+COPY . /usr/etc/hedera-mirror-node/\n+\n+WORKDIR /usr/etc/hedera-mirror-node\n+\n+ENV testProfile acceptance\n+ENV cucumberFlags \"@BalanceCheck\"\n+ENV subscribeThreadCount 30\n+ENV jmeterTestPlan E2E_Subscribe_Only.jmx\n+\n+# ensure all maven dependecies are placed ahead of test run\n+RUN ./mvnw install -DskipTests -Djib.skip -Ddocker.skip --no-transfer-progress \\", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNjY2MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441926660", "bodyText": "Thanks but given the dependency of the grpc module the above doesn't cover that case.\nSticking with mvn install as we noted", "author": "Nana-EC", "createdAt": "2020-06-18T02:02:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNTU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNjA3Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r440336077", "bodyText": "This should be moved to the test README to document how to run the containerized acceptance tests", "author": "steven-sheehy", "createdAt": "2020-06-15T17:33:09Z", "path": "scripts/test-container/Dockerfile", "diffHunk": "@@ -0,0 +1,30 @@\n+# Containerizes hedera-mirror-node tests that can be run against various endpoints\n+# docker build -f scripts/test-container/Dockerfile . -t gcr.io/mirrornode/hedera-mirror-test:<project-version>\n+FROM adoptopenjdk:11-jdk-hotspot\n+\n+RUN mkdir /usr/etc\n+\n+WORKDIR /usr/etc\n+\n+RUN mkdir /usr/etc/hedera-mirror-node/\n+COPY . /usr/etc/hedera-mirror-node/\n+\n+WORKDIR /usr/etc/hedera-mirror-node\n+\n+ENV testProfile acceptance\n+ENV cucumberFlags \"@BalanceCheck\"\n+ENV subscribeThreadCount 30\n+ENV jmeterTestPlan E2E_Subscribe_Only.jmx\n+\n+# ensure all maven dependecies are placed ahead of test run\n+RUN ./mvnw install -DskipTests -Djib.skip -Ddocker.skip --no-transfer-progress \\\n+    --batch-mode -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn\n+\n+ENTRYPOINT scripts/test-container/run-tests.sh\n+\n+# docker run -d -e testProfile=acceptance -e cucumberFlags=\"@SubscribeOnly\" \\", "originalCommit": "386bc0cdde6000df3c500a0f291fc04c638a07b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNjY5MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r441926690", "bodyText": "Moved", "author": "Nana-EC", "createdAt": "2020-06-18T02:02:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNjA3Nw=="}], "type": "inlineReview"}, {"oid": "978e9b1695a622d8b4b9db98fabd7dc216237bd9", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/978e9b1695a622d8b4b9db98fabd7dc216237bd9", "message": "Added base docker file with account balancecheck entrypoint\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:41Z", "type": "commit"}, {"oid": "c81f11e6d1d40c9eca03f1dac5566d973fff5301", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c81f11e6d1d40c9eca03f1dac5566d973fff5301", "message": "Moved test run to bash script for more options\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:41Z", "type": "commit"}, {"oid": "80f9db70fb031bfdd0d95ee19b44aaf67e825c75", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/80f9db70fb031bfdd0d95ee19b44aaf67e825c75", "message": "Go with junit-platform-console-standalone and copy target with deps to DOcker Image\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:42Z", "type": "commit"}, {"oid": "0734d3f6949696cf1ea916a7321199c83383a1a6", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/0734d3f6949696cf1ea916a7321199c83383a1a6", "message": "cleaned up dependency generation\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:42Z", "type": "commit"}, {"oid": "50a0112694009a400289b259f8b30789174d9fdf", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/50a0112694009a400289b259f8b30789174d9fdf", "message": "Switched back to maven and github pull approach\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:42Z", "type": "commit"}, {"oid": "c44b0e8e1632ea678e29db94e684696d5c0aae00", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c44b0e8e1632ea678e29db94e684696d5c0aae00", "message": "Moved Dockerfile to base dir and added to maven flow\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:42Z", "type": "commit"}, {"oid": "7dc12de698780a2d83b495b9ff281af9e4bfa825", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7dc12de698780a2d83b495b9ff281af9e4bfa825", "message": "Added 3rd party license report\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:42Z", "type": "commit"}, {"oid": "d96a4ddf9bb24161602d68c527156fb4122ea5a0", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d96a4ddf9bb24161602d68c527156fb4122ea5a0", "message": "Remove thrid party report\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:42Z", "type": "commit"}, {"oid": "e2882d5a169f40708fa8b3c7007b198f9f69a925", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e2882d5a169f40708fa8b3c7007b198f9f69a925", "message": "Add aggregate-third-party-report logic\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:43Z", "type": "commit"}, {"oid": "ed53e3144a41f4e48574a5440d5c40b201149010", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ed53e3144a41f4e48574a5440d5c40b201149010", "message": "Add image cleanup logic for test images\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:43Z", "type": "commit"}, {"oid": "07f5911ae710b26e87cc56724532eaa8ee4072d7", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/07f5911ae710b26e87cc56724532eaa8ee4072d7", "message": "Set bacth mode\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:43Z", "type": "commit"}, {"oid": "1ed84e5aa1919781cab8e777e2c2522f5305957e", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/1ed84e5aa1919781cab8e777e2c2522f5305957e", "message": "Added support for subscribe x seconds ago for  historic and incoming subscribe\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:43Z", "type": "commit"}, {"oid": "5ede725f806c74e94cdadafd388b637e22886c40", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5ede725f806c74e94cdadafd388b637e22886c40", "message": "Improves logging for subscribe perf scenario and avoids jmeter report folder issue when no clean is done\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:43Z", "type": "commit"}, {"oid": "6d33f7305f841cee88f442181fd427a4ad0712e1", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6d33f7305f841cee88f442181fd427a4ad0712e1", "message": " Fix subscribe logic failure due to stopwatch\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:43Z", "type": "commit"}, {"oid": "c530ceda1e3ac69b7a34aa5515574eb1527e121f", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c530ceda1e3ac69b7a34aa5515574eb1527e121f", "message": "Wrap stopwatch stops to prevent errors\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:43Z", "type": "commit"}, {"oid": "4072f7135409716cf0515b71b4f5cee913136d85", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4072f7135409716cf0515b71b4f5cee913136d85", "message": "Improved rate accuracy calculation\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:43Z", "type": "commit"}, {"oid": "44c9461d858661dd3ff185530c20ae49fd8a011b", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/44c9461d858661dd3ff185530c20ae49fd8a011b", "message": "Added comment for netty downgrade\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:03:43Z", "type": "commit"}, {"oid": "8336f9555d32983211ebe96e40e2ab6a2ecbe8cd", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8336f9555d32983211ebe96e40e2ab6a2ecbe8cd", "message": "Added base docker file with account balancecheck entrypoint\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:04:17Z", "type": "commit"}, {"oid": "1e866b0e61fb366906311d688b3efaa4b3c760a6", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/1e866b0e61fb366906311d688b3efaa4b3c760a6", "message": "Moved test run to bash script for more options\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:04:17Z", "type": "commit"}, {"oid": "26a1a9d704f52ae68476921972e14ba0eceb6b94", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/26a1a9d704f52ae68476921972e14ba0eceb6b94", "message": "Go with junit-platform-console-standalone and copy target with deps to DOcker Image\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:04:17Z", "type": "commit"}, {"oid": "432e126ff7a1a007e9fcc29b267c28273da5da33", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/432e126ff7a1a007e9fcc29b267c28273da5da33", "message": "cleaned up dependency generation\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:04:17Z", "type": "commit"}, {"oid": "dee058ffe3e5b9ee72428d683389e381def9ff13", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/dee058ffe3e5b9ee72428d683389e381def9ff13", "message": "Switched back to maven and github pull approach\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:04:17Z", "type": "commit"}, {"oid": "b3f7a4fc138f38861b957ecba55787b6b29df0f7", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b3f7a4fc138f38861b957ecba55787b6b29df0f7", "message": "Moved Dockerfile to base dir and added to maven flow\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:05:36Z", "type": "commit"}, {"oid": "3120aabc9ea76af394ea38a520d02bbda18a01c2", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3120aabc9ea76af394ea38a520d02bbda18a01c2", "message": "Added 3rd party license report\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:05:36Z", "type": "commit"}, {"oid": "1ad438c603e8d59daf6e717e8a9a92de753a8908", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/1ad438c603e8d59daf6e717e8a9a92de753a8908", "message": "Remove thrid party report\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:05:36Z", "type": "commit"}, {"oid": "76a24f3729ba0f3cba9fdbeb89d3a3808390e30a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/76a24f3729ba0f3cba9fdbeb89d3a3808390e30a", "message": "Set bacth mode\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:05:53Z", "type": "commit"}, {"oid": "931932aa1088743a02b50149dbd19dcece76b145", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/931932aa1088743a02b50149dbd19dcece76b145", "message": "Improves logging for subscribe perf scenario and avoids jmeter report folder issue when no clean is done\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:08:33Z", "type": "commit"}, {"oid": "f7d5debaa7546d11c75dd6753e79e7e66f2062e7", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f7d5debaa7546d11c75dd6753e79e7e66f2062e7", "message": "Move license logic to test module\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:08:33Z", "type": "commit"}, {"oid": "dcc858aa6722734cacc118b27fbd6af878fa57c9", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/dcc858aa6722734cacc118b27fbd6af878fa57c9", "message": "Moved docker containerization to test module\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:08:33Z", "type": "commit"}, {"oid": "8e29b630398e7b8bd490ef5a4e7024b1d10dc359", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8e29b630398e7b8bd490ef5a4e7024b1d10dc359", "message": "Added logic to print status every 1 min in perf tests\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:08:33Z", "type": "commit"}, {"oid": "33c98d447482c6a83755bcc9f3a3997776fdcaca", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/33c98d447482c6a83755bcc9f3a3997776fdcaca", "message": " Correct grc tag\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:08:33Z", "type": "commit"}, {"oid": "33c98d447482c6a83755bcc9f3a3997776fdcaca", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/33c98d447482c6a83755bcc9f3a3997776fdcaca", "message": " Correct grc tag\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:08:33Z", "type": "forcePushed"}, {"oid": "c4e23bcd295086f5d576482a24f74f94a33422c3", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c4e23bcd295086f5d576482a24f74f94a33422c3", "message": "Fix rebase conflict\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T02:21:39Z", "type": "commit"}, {"oid": "3c9e5cdfdf4d1137c532fa5f85e237ebba877365", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3c9e5cdfdf4d1137c532fa5f85e237ebba877365", "message": "Resolve license download issues\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T17:39:42Z", "type": "commit"}, {"oid": "8f369bd32b1d438c1796325cac2da61ced153ade", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8f369bd32b1d438c1796325cac2da61ced153ade", "message": "Fixed dependency naming for xpp3\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-18T17:43:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ3Njk5OA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r442476998", "bodyText": "Please put this back and remove from BUILDING.md. This is a user guide for customers. I only meant that any instructions on building images should be in BUILDING.md. But looks like those instructions have now moved to hedera-mirror-test/README instead", "author": "steven-sheehy", "createdAt": "2020-06-18T20:13:04Z", "path": "charts/marketplace/gcp/README.md", "diffHunk": "@@ -357,26 +357,6 @@ Scale the importer back up\n kubectl scale -n \"${NAMESPACE}\" --replicas=1 \"statefulset/${APP_NAME}-importer\"\n ```\n \n-# Upgrade", "originalCommit": "8f369bd32b1d438c1796325cac2da61ced153ade", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUyMzc4Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r442523787", "bodyText": "Will revert", "author": "Nana-EC", "createdAt": "2020-06-18T21:55:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ3Njk5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MDIzNQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r442480235", "bodyText": "Would prefer Dockerfile in default location of src/main/docker so we don't have to configure plugin and use non-standard scripts folder", "author": "steven-sheehy", "createdAt": "2020-06-18T20:19:59Z", "path": "hedera-mirror-test/pom.xml", "diffHunk": "@@ -103,8 +105,74 @@\n             <artifactId>spring-boot-starter-aop</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <!-- Manually added for license and dependency reference in deployed containers-->\n+        <dependency>\n+            <groupId>org.apache.jmeter</groupId>\n+            <artifactId>ApacheJMeter_core</artifactId>\n+            <version>${jmeter.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.jmeter</groupId>\n+            <artifactId>ApacheJMeter_java</artifactId>\n+            <version>${jmeter.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n     </dependencies>\n \n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-dependency-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <configuration>\n+                            <includeScope>test</includeScope>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.codehaus.mojo</groupId>\n+                <artifactId>license-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>download-licenses-for-container</id>\n+                        <configuration>\n+                            <licenseUrlReplacements>\n+                                <licenseUrlReplacement>\n+                                    <regexp>\\Qhttps://github.com/mockito/mockito/blob/master/LICENSE\\E</regexp>\n+                                    <replacement>https://github.com/mockito/mockito/blob/release/3.x/LICENSE\n+                                    </replacement>\n+                                </licenseUrlReplacement>\n+                            </licenseUrlReplacements>\n+                            <licensesConfigFile>${project.basedir}/src/license/licenses.xml</licensesConfigFile>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>io.fabric8</groupId>\n+                <artifactId>docker-maven-plugin</artifactId>\n+                <inherited>false</inherited>\n+                <configuration>\n+                    <images>\n+                        <image>\n+                            <build>\n+                                <contextDir>${maven.multiModuleProjectDirectory}</contextDir>\n+                                <dockerFile>${project.basedir}/scripts/Dockerfile</dockerFile>", "originalCommit": "8f369bd32b1d438c1796325cac2da61ced153ade", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUzMTQ2NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r442531464", "bodyText": "Thought the default was under the project root?\nI can move it to src/main/docker\nSince I'm changing the context you still have to configure the plugin otherwise it'll look for the Dockerfile at 'hedera-mirror-node/Dockerfile'", "author": "Nana-EC", "createdAt": "2020-06-18T22:15:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MDIzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxMzU5MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r443313590", "bodyText": "Moved to src/main/docker as requested but as noted given the build context change I do have to state the Dockerfile location", "author": "Nana-EC", "createdAt": "2020-06-22T04:39:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MDIzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MjkwOA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r442482908", "bodyText": "scheduler is null at this point resulting in a NPE, right?", "author": "steven-sheehy", "createdAt": "2020-06-18T20:25:43Z", "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/jmeter/sampler/HCSDirectStubTopicSampler.java", "diffHunk": "@@ -109,19 +110,20 @@ public void onCompleted() {\n                 result.onComplete();\n             }\n         };\n+        ScheduledExecutorService scheduler = null;\n \n         try {\n             asyncStub.subscribeTopic(request, responseObserver);\n+            scheduler.scheduleAtFixedRate(() -> {", "originalCommit": "8f369bd32b1d438c1796325cac2da61ced153ade", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxMzY2OA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r443313668", "bodyText": "Fixed", "author": "Nana-EC", "createdAt": "2020-06-22T04:40:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MjkwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5MTg3Ng==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r442491876", "bodyText": "Would prefer file either at hedera-mirror-test root or src/main/resources", "author": "steven-sheehy", "createdAt": "2020-06-18T20:44:33Z", "path": "hedera-mirror-test/pom.xml", "diffHunk": "@@ -103,8 +105,74 @@\n             <artifactId>spring-boot-starter-aop</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <!-- Manually added for license and dependency reference in deployed containers-->\n+        <dependency>\n+            <groupId>org.apache.jmeter</groupId>\n+            <artifactId>ApacheJMeter_core</artifactId>\n+            <version>${jmeter.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.jmeter</groupId>\n+            <artifactId>ApacheJMeter_java</artifactId>\n+            <version>${jmeter.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n     </dependencies>\n \n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-dependency-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <configuration>\n+                            <includeScope>test</includeScope>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.codehaus.mojo</groupId>\n+                <artifactId>license-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>download-licenses-for-container</id>\n+                        <configuration>\n+                            <licenseUrlReplacements>\n+                                <licenseUrlReplacement>\n+                                    <regexp>\\Qhttps://github.com/mockito/mockito/blob/master/LICENSE\\E</regexp>\n+                                    <replacement>https://github.com/mockito/mockito/blob/release/3.x/LICENSE\n+                                    </replacement>\n+                                </licenseUrlReplacement>\n+                            </licenseUrlReplacements>\n+                            <licensesConfigFile>${project.basedir}/src/license/licenses.xml</licensesConfigFile>", "originalCommit": "8f369bd32b1d438c1796325cac2da61ced153ade", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUyMjU5Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r442522592", "bodyText": "This is the default location for the plugin. I only added this line to make the  reference obvious", "author": "Nana-EC", "createdAt": "2020-06-18T21:52:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5MTg3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxMzc2MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r443313760", "bodyText": "Moved under src/main/resources", "author": "Nana-EC", "createdAt": "2020-06-22T04:40:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5MTg3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5NDAwNA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r442494004", "bodyText": "Do we need to specify all this information for all these dependencies when a URL replacement in the pom.xml would suffice (besides oro, who has no URL to replace)?", "author": "steven-sheehy", "createdAt": "2020-06-18T20:48:44Z", "path": "hedera-mirror-test/src/license/licenses.xml", "diffHunk": "@@ -0,0 +1,78 @@\n+<?xml version=\"1.0\"?>\n+\n+<licenseSummary xmlns=\"http://mojo.codehaus.org/\"\n+                xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+                xsi:schemaLocation=\"http://mojo.codehaus.org/ licenses.xsd\">\n+    <dependencies>\n+        <dependency>\n+            <groupId>oro</groupId>\n+            <artifactId>oro</artifactId>\n+            <licenses>\n+                <license>\n+                    <name>Apache License, Version 1.1</name>\n+                    <url>https://www.apache.org/licenses/LICENSE-1.1</url>\n+                </license>\n+            </licenses>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.mockito</groupId>\n+            <artifactId>mockito-core</artifactId>\n+            <licenses>\n+                <license>\n+                    <name>MIT License</name>\n+                    <url>https://github.com/mockito/mockito/blob/release/3.x/LICENSE</url>", "originalCommit": "8f369bd32b1d438c1796325cac2da61ced153ade", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxNDg2NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r443314865", "bodyText": "URL replace is sufficient for some but not all.\nNamely\n\ncommons-logging package has a bad url (/LICENSE.html), to me this isn't unique enough to justify a regex replace in case any other package somehow missed the host part of the url\nxpp3_min seems to require 2 licenses and I believe licenseUrlReplacement is designed for a single replacement\n\nI moved the rest to URL replacement but let the above 2.\nIn the days between my last push seems the org.mockito url got fixed and the org.ow2.asm broke so I updated those also.", "author": "Nana-EC", "createdAt": "2020-06-22T04:46:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5NDAwNA=="}], "type": "inlineReview"}, {"oid": "2af763d6e83283609d2ba967e40c6f00367688d5", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2af763d6e83283609d2ba967e40c6f00367688d5", "message": "Addressed feedback on files locations and license replace logic\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-22T04:38:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU5OTY2NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r443599664", "bodyText": "This should still be removed from this file.", "author": "steven-sheehy", "createdAt": "2020-06-22T14:28:26Z", "path": "charts/marketplace/gcp/README.md", "diffHunk": "@@ -358,6 +358,7 @@ kubectl scale -n \"${NAMESPACE}\" --replicas=1 \"statefulset/${APP_NAME}-importer\"\n ```\n \n # Upgrade\n+    ./mvnw clean deploy -N -Ddocker.skip.deployer=false -Ddocker.tags.0=0.12 -Ddocker.tag.version=0.12.0-rc1", "originalCommit": "2af763d6e83283609d2ba967e40c6f00367688d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYzMDc2MQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r443630761", "bodyText": "Removed", "author": "Nana-EC", "createdAt": "2020-06-22T15:09:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU5OTY2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYwMTQyNw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r443601427", "bodyText": "Dockerfile should be in same folder as run-tests.sh. Since run-tests.sh is in src/main/resources can just move this there.", "author": "steven-sheehy", "createdAt": "2020-06-22T14:30:42Z", "path": "hedera-mirror-test/pom.xml", "diffHunk": "@@ -103,8 +105,83 @@\n             <artifactId>spring-boot-starter-aop</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <!-- Manually added for license and dependency reference in deployed containers-->\n+        <dependency>\n+            <groupId>org.apache.jmeter</groupId>\n+            <artifactId>ApacheJMeter_core</artifactId>\n+            <version>${jmeter.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.jmeter</groupId>\n+            <artifactId>ApacheJMeter_java</artifactId>\n+            <version>${jmeter.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n     </dependencies>\n \n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-dependency-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <configuration>\n+                            <includeScope>test</includeScope>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.codehaus.mojo</groupId>\n+                <artifactId>license-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>download-licenses-for-container</id>\n+                        <configuration>\n+                            <licenseUrlReplacements>\n+                                <licenseUrlReplacement>\n+                                    <regexp>\\Qhttps://github.com/mockito/mockito/blob/master/LICENSE\\E</regexp>\n+                                    <replacement>https://github.com/mockito/mockito/blob/release/3.x/LICENSE\n+                                    </replacement>\n+                                </licenseUrlReplacement>\n+                                <licenseUrlReplacement>\n+                                    <regexp>\\Qhttp://asm.objectweb.org/license.html\\E</regexp>\n+                                    <replacement>https://asm.ow2.io/license.html</replacement>\n+                                </licenseUrlReplacement>\n+                                <licenseUrlReplacement>\n+                                    <regexp>\\Qhttp://jtidy.svn.sourceforge.net/viewvc/jtidy/trunk/jtidy/LICENSE.txt?revision=95\\E</regexp>\n+                                    <replacement>http://jtidy.sourceforge.net/license.html</replacement>\n+                                </licenseUrlReplacement>\n+                            </licenseUrlReplacements>\n+                            <licensesConfigFile>${project.basedir}/src/test/resources/license/licenses.xml\n+                            </licensesConfigFile>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>io.fabric8</groupId>\n+                <artifactId>docker-maven-plugin</artifactId>\n+                <inherited>false</inherited>\n+                <configuration>\n+                    <images>\n+                        <image>\n+                            <build>\n+                                <contextDir>${maven.multiModuleProjectDirectory}</contextDir>\n+                                <dockerFile>${project.basedir}/src/main/Dockerfile</dockerFile>", "originalCommit": "2af763d6e83283609d2ba967e40c6f00367688d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYzMDgxOQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/822#discussion_r443630819", "bodyText": "Moved", "author": "Nana-EC", "createdAt": "2020-06-22T15:09:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYwMTQyNw=="}], "type": "inlineReview"}, {"oid": "a32622b80b64cacbfd18c1c88ca7b84f3dc8cfdd", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a32622b80b64cacbfd18c1c88ca7b84f3dc8cfdd", "message": "Moved docker file and updated documentation\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>", "committedDate": "2020-06-22T15:06:11Z", "type": "commit"}]}