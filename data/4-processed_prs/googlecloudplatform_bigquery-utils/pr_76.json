{"pr_number": 76, "pr_title": "SQL Crawler: Implemented generic extraction", "pr_createdAt": "2020-06-29T21:59:55Z", "pr_url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76", "timeline": [{"oid": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd", "message": "Implemented generic extraction", "committedDate": "2020-06-29T21:57:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgxMDc4Ng==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#discussion_r447810786", "bodyText": "Maybe define this as a separate const string. I think this can be longer in the future when you cover insert, update, merge, etc.", "author": "yzhvictor", "createdAt": "2020-06-30T16:19:01Z", "path": "tools/unsupervised_dataset/sql_crawler/extraction_modules/generic_extraction_module.py", "diffHunk": "@@ -1,8 +1,32 @@\n-class GenericExtractionModule(object):\n+\"\"\" Collects SQL queries from any website \"\"\"\n+import html\n+import re\n+\n+class GenericExtractionModule():\n     \"\"\" A module to extract SQL queries from any website without knowing the HTML\n         format of a site.\n     \"\"\"\n \n-    def find_queries(html):\n-        #TODO(Noah): Implement generic module\n-        return []\n+    def find_queries(html_response):\n+        \"\"\" Finds queries and extracts them from any website, without using HTML\n+        tags to locate them.\n+\n+        Args:\n+            html: HTML response which contains HTML text\n+\n+        Returns\n+            A list of queries in the form of strings.\n+        \"\"\"\n+        # Remove HTML tags and special characters\n+        content = html_response.text\n+        converted = html.unescape(content)\n+        tags_removed = re.sub('<[^<]+?>', '', converted)\n+\n+        # Look for text that matches common SQL queries\n+        matches = re.findall(r\"(?:SELECT|WITH|CREATE)[^;]*;\", tags_removed)", "originalCommit": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkzNDcyNA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#discussion_r447934724", "bodyText": "+1", "author": "kikkyo", "createdAt": "2020-06-30T19:41:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgxMDc4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgxMTI0OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#discussion_r447811248", "bodyText": "Let's always have some test coverage for new code added, thanks.", "author": "yzhvictor", "createdAt": "2020-06-30T16:19:45Z", "path": "tools/unsupervised_dataset/sql_crawler/extraction_modules/generic_extraction_module.py", "diffHunk": "@@ -1,8 +1,32 @@\n-class GenericExtractionModule(object):\n+\"\"\" Collects SQL queries from any website \"\"\"\n+import html\n+import re\n+\n+class GenericExtractionModule():\n     \"\"\" A module to extract SQL queries from any website without knowing the HTML\n         format of a site.\n     \"\"\"\n \n-    def find_queries(html):\n-        #TODO(Noah): Implement generic module\n-        return []\n+    def find_queries(html_response):", "originalCommit": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "390e391a0dc8646651b107eb7f18029d6b3e6edb", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/390e391a0dc8646651b107eb7f18029d6b3e6edb", "message": "Added tests", "committedDate": "2020-06-30T19:07:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkzNDYwMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#discussion_r447934603", "bodyText": "Use const string too?", "author": "kikkyo", "createdAt": "2020-06-30T19:41:07Z", "path": "tools/unsupervised_dataset/sql_crawler/extractor.py", "diffHunk": "@@ -64,5 +64,4 @@ def retrieve_module(url):\n     if \"cloud.google.com\" in url:", "originalCommit": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e211c41cdb1b6d88925d6fbfe69f95ebd543fcdc", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e211c41cdb1b6d88925d6fbfe69f95ebd543fcdc", "message": "Changed urls to constants", "committedDate": "2020-06-30T20:00:37Z", "type": "commit"}, {"oid": "17d8d259fde115fddce1c1183add69c8477fd04a", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/17d8d259fde115fddce1c1183add69c8477fd04a", "message": "Merge branch 'master' into generic_extraction", "committedDate": "2020-06-30T20:01:21Z", "type": "commit"}, {"oid": "878384afa3ff257f7bb60a1c176559116555ad2d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/878384afa3ff257f7bb60a1c176559116555ad2d", "message": "Merge branch 'master' into generic_extraction", "committedDate": "2020-07-06T21:31:01Z", "type": "commit"}]}