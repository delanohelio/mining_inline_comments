{"pr_number": 161, "pr_title": "Query_Breakdown: New Query Breaking Down Logic Implemented, Multi-line deletion implemented, Replacement Logic randomized", "pr_createdAt": "2020-08-22T02:26:38Z", "pr_url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161", "timeline": [{"oid": "47fb2dd731d8c71e8c4b13f68013144a7649ccae", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/47fb2dd731d8c71e8c4b13f68013144a7649ccae", "message": "query_breakdown locationtracker now works with replacement", "committedDate": "2020-08-06T18:13:55Z", "type": "commit"}, {"oid": "2a6891f58d9a0a03b8b9eaecaa5327f9c7d4eec3", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2a6891f58d9a0a03b8b9eaecaa5327f9c7d4eec3", "message": "stack now works to rearrange output order", "committedDate": "2020-08-06T18:38:48Z", "type": "commit"}, {"oid": "c0d19792754f5177368bacf2c55a75a5d4596678", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c0d19792754f5177368bacf2c55a75a5d4596678", "message": "test case for deletion and replacement at the same time added", "committedDate": "2020-08-06T18:57:59Z", "type": "commit"}, {"oid": "9b61ddfd58872dfa15216cc9081d4b13625b407f", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/9b61ddfd58872dfa15216cc9081d4b13625b407f", "message": "json flag added as well as variable programmed", "committedDate": "2020-08-07T19:57:40Z", "type": "commit"}, {"oid": "23d74ba6069588f7872edf9aaccf5554752120c6", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/23d74ba6069588f7872edf9aaccf5554752120c6", "message": "added json support", "committedDate": "2020-08-08T00:02:06Z", "type": "commit"}, {"oid": "e2b01b2974c41063a72be65ce740109e8e9081a6", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e2b01b2974c41063a72be65ce740109e8e9081a6", "message": "works as a stand-alone jar file now", "committedDate": "2020-08-08T00:21:26Z", "type": "commit"}, {"oid": "01553a8c80f0d1534bf127d41acda6be31637325", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/01553a8c80f0d1534bf127d41acda6be31637325", "message": "Merge branch 'master' into milestone3_1", "committedDate": "2020-08-08T01:40:59Z", "type": "commit"}, {"oid": "feb8a2f20f36a6807706d4e5c4e6614547439ded", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/feb8a2f20f36a6807706d4e5c4e6614547439ded", "message": "created query_breakdown_runner.ts", "committedDate": "2020-08-10T20:43:20Z", "type": "commit"}, {"oid": "1b2f48263a2a9a2e4e19cc73847b4395f2c3ad2a", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/1b2f48263a2a9a2e4e19cc73847b4395f2c3ad2a", "message": "query breakdown runner sketched", "committedDate": "2020-08-10T22:35:27Z", "type": "commit"}, {"oid": "acb043fc61f541bd846e645df84c4219a4f0c215", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/acb043fc61f541bd846e645df84c4219a4f0c215", "message": "methods sketched", "committedDate": "2020-08-11T19:18:38Z", "type": "commit"}, {"oid": "b1cde39f3c6d666cf44dc64f6a2f5187ed423db5", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/b1cde39f3c6d666cf44dc64f6a2f5187ed423db5", "message": "result json file sketched", "committedDate": "2020-08-11T19:19:07Z", "type": "commit"}, {"oid": "a6dbb8ea4a81643af8785045b849a843a226d61e", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a6dbb8ea4a81643af8785045b849a843a226d61e", "message": "resultJson integrated", "committedDate": "2020-08-11T19:51:35Z", "type": "commit"}, {"oid": "88a811d7eae4a15eea543fb24ddfadbc7b242d81", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/88a811d7eae4a15eea543fb24ddfadbc7b242d81", "message": "debugging-1", "committedDate": "2020-08-11T21:55:44Z", "type": "commit"}, {"oid": "306b21633cbc6fac9e794ab763a66b63c3628114", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/306b21633cbc6fac9e794ab763a66b63c3628114", "message": "integration is now finished and working!", "committedDate": "2020-08-12T00:17:53Z", "type": "commit"}, {"oid": "25c92eae4bed225450b0878bcb243d1a512a5bf2", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/25c92eae4bed225450b0878bcb243d1a512a5bf2", "message": "merge conflicts resolved", "committedDate": "2020-08-12T18:51:15Z", "type": "commit"}, {"oid": "751716ca54416ef54ba970e83eb373ecb62b7dd0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/751716ca54416ef54ba970e83eb373ecb62b7dd0", "message": "code cleaned up for pull request", "committedDate": "2020-08-12T20:51:15Z", "type": "commit"}, {"oid": "39fc0a035d3b1089dedf006e1af3c68d5d907cf9", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/39fc0a035d3b1089dedf006e1af3c68d5d907cf9", "message": "new line EOF bug fixed", "committedDate": "2020-08-13T20:52:27Z", "type": "commit"}, {"oid": "f3c7985b8879cbf92434c4511fe1947d3b32c4ff", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/f3c7985b8879cbf92434c4511fe1947d3b32c4ff", "message": "empty and singleton files EOF are now supported", "committedDate": "2020-08-14T21:50:49Z", "type": "commit"}, {"oid": "67dd0008879a5cb5945fd8d9ee219c08d79dc80d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/67dd0008879a5cb5945fd8d9ee219c08d79dc80d", "message": "fixed bugs for EOF, no options, bracket options", "committedDate": "2020-08-17T22:16:07Z", "type": "commit"}, {"oid": "94b44f3581380c0fa3084a6b07c5abc30bd80d31", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/94b44f3581380c0fa3084a6b07c5abc30bd80d31", "message": "multiple line deletion finished", "committedDate": "2020-08-18T19:43:24Z", "type": "commit"}, {"oid": "dd4478cda33204cff4d79450fd0d24f76eaa7aa1", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/dd4478cda33204cff4d79450fd0d24f76eaa7aa1", "message": "added pair class, began changing locationtracker to pair", "committedDate": "2020-08-19T17:52:35Z", "type": "commit"}, {"oid": "aa52a7f2b3bddcdcd35eb498786040702d1f5f98", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/aa52a7f2b3bddcdcd35eb498786040702d1f5f98", "message": "location tracking now works with multi-line deletion", "committedDate": "2020-08-19T19:07:49Z", "type": "commit"}, {"oid": "0b4ec37b878e492b3bc4cdbc2ec3fe9776135249", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/0b4ec37b878e492b3bc4cdbc2ec3fe9776135249", "message": "input reader new design sketched", "committedDate": "2020-08-20T03:04:16Z", "type": "commit"}, {"oid": "87b46ec71ca4e7f66a828657a6262aa499d291a6", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/87b46ec71ca4e7f66a828657a6262aa499d291a6", "message": "Revert \"input reader new design sketched\"\n\nThis reverts commit 0b4ec37b878e492b3bc4cdbc2ec3fe9776135249.", "committedDate": "2020-08-20T03:27:00Z", "type": "commit"}, {"oid": "4f51d8dff2cf2e65ef955fb1e4ff68dcab571447", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4f51d8dff2cf2e65ef955fb1e4ff68dcab571447", "message": "revert merge conflict resolved", "committedDate": "2020-08-20T04:21:56Z", "type": "commit"}, {"oid": "1810442a1c66be16f9be5340dac3ede4b171f492", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/1810442a1c66be16f9be5340dac3ede4b171f492", "message": "input reader location tracking design complete", "committedDate": "2020-08-21T03:05:13Z", "type": "commit"}, {"oid": "9ae7661086f959c942b21b5bf17de400a0a7afb1", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/9ae7661086f959c942b21b5bf17de400a0a7afb1", "message": "location tracker draft", "committedDate": "2020-08-21T05:07:53Z", "type": "commit"}, {"oid": "a5cdeff39dbf92b7466f83fce636314ff4e82ca3", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a5cdeff39dbf92b7466f83fce636314ff4e82ca3", "message": "location tracking tests pass", "committedDate": "2020-08-21T19:14:08Z", "type": "commit"}, {"oid": "308a238861d32e013b50dc7f0a21f2e75d705e0b", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/308a238861d32e013b50dc7f0a21f2e75d705e0b", "message": "output redesign sketched", "committedDate": "2020-08-21T20:53:03Z", "type": "commit"}, {"oid": "c91455cec54e2e12c0c99c510e65e7535668c442", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c91455cec54e2e12c0c99c510e65e7535668c442", "message": "merge conflicts fixed", "committedDate": "2020-08-21T20:58:10Z", "type": "commit"}, {"oid": "22ecca1684d4b15f4fd9f10850b788886977e603", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/22ecca1684d4b15f4fd9f10850b788886977e603", "message": "query breakdown tests now all pass", "committedDate": "2020-08-22T00:47:52Z", "type": "commit"}, {"oid": "6a96ab4e20c67af1adb791ba3c791e05505f725d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/6a96ab4e20c67af1adb791ba3c791e05505f725d", "message": "code cleaned-up and documentation added for PR", "committedDate": "2020-08-22T02:08:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzODc3NA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161#discussion_r475938774", "bodyText": "Please add a comment to explain what's the purpose of n.", "author": "feiling", "createdAt": "2020-08-24T22:55:42Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/ReplacementLogic.java", "diffHunk": "@@ -9,23 +10,50 @@\n \n   /**\n    * Given a component, provides a recommendation as to which component the input should be\n-   * replaced with. Returns a list of components that it recommends.\n+   * replaced with. Returns a list of components that it recommends. The default method of\n+   * choosing recommendations is through randomization.\n    *\n    * We choose ArrayLists as the data structure because we want to impose a certain ordering\n    * with the recommendations: certain recommendations should be \"better\" than others\n+   *\n+   * n is an integer that controls the number of replacement options\n    */\n   public static ArrayList<String> replace (String component, ArrayList<String> options) {\n-    // simply returns the first n options", "originalCommit": "6a96ab4e20c67af1adb791ba3c791e05505f725d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyNjkxNw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161#discussion_r476026917", "bodyText": "addressed in the next PR!", "author": "subinbean", "createdAt": "2020-08-25T01:10:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzODc3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk0MDI0Nw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161#discussion_r475940247", "bodyText": "You should use Random.nextInt() (https://docs.oracle.com/javase/8/docs/api/java/util/Random.html#nextInt--)", "author": "feiling", "createdAt": "2020-08-24T22:59:58Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/ReplacementLogic.java", "diffHunk": "@@ -9,23 +10,50 @@\n \n   /**\n    * Given a component, provides a recommendation as to which component the input should be\n-   * replaced with. Returns a list of components that it recommends.\n+   * replaced with. Returns a list of components that it recommends. The default method of\n+   * choosing recommendations is through randomization.\n    *\n    * We choose ArrayLists as the data structure because we want to impose a certain ordering\n    * with the recommendations: certain recommendations should be \"better\" than others\n+   *\n+   * n is an integer that controls the number of replacement options\n    */\n   public static ArrayList<String> replace (String component, ArrayList<String> options) {\n-    // simply returns the first n options\n     int n = 3;\n \n+    ArrayList<String> result = new ArrayList<>();\n+\n     if (options.size() <= n) {\n-      return new ArrayList<>(options);\n+      for (int i = 0; i < options.size(); i++) {\n+        // gets rid of cases such as <QUOTED_STRING>\n+        if (options.get(i).charAt(0) != '<' || options.get(i).length() <= 1) {\n+          result.add(options.get(i));\n+        }\n+      }\n+      return result;\n     }\n \n-    ArrayList<String> result = new ArrayList<>();\n-    for (int i = 0; i < n; i++) {\n-      result.add(options.get(i));\n+    HashSet<Integer> seen = new HashSet<>();\n+    // randomly populate result until full\n+    while (result.size() < n && seen.size() < options.size()) {\n+      int random = randomNumber(options.size() - 1);\n+      if (seen.contains(random)) {\n+        continue;\n+      }\n+      else if (options.get(random).charAt(0) == '<' && options.get(random).length() > 1) {\n+        seen.add(random);\n+        continue;\n+      }\n+      else {\n+        result.add(options.get(random));\n+        seen.add(random);\n+      }\n     }\n     return result;\n   }\n+\n+  // helper function that returns a random integer between 0 - n\n+  private static int randomNumber(int n) {", "originalCommit": "6a96ab4e20c67af1adb791ba3c791e05505f725d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAzNzgyMg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161#discussion_r476037822", "bodyText": "yup! Resolved", "author": "subinbean", "createdAt": "2020-08-25T01:26:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk0MDI0Nw=="}], "type": "inlineReview"}, {"oid": "2965a46fa52aa096a081129f89c2a7d3e337caa9", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2965a46fa52aa096a081129f89c2a7d3e337caa9", "message": "random generator added", "committedDate": "2020-08-25T01:26:05Z", "type": "commit"}]}