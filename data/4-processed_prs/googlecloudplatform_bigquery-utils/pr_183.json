{"pr_number": 183, "pr_title": "Adding statslib to bigquery-utils", "pr_createdAt": "2020-10-27T15:41:40Z", "pr_url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183", "timeline": [{"oid": "288897fef908e05d3e70366f3a3d948319382723", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/288897fef908e05d3e70366f3a3d948319382723", "message": "First pass at adding Statslib", "committedDate": "2020-08-04T18:10:03Z", "type": "commit"}, {"oid": "a2b6348b8cb36ebbb52ca9fe58460f891e4445b0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a2b6348b8cb36ebbb52ca9fe58460f891e4445b0", "message": "Merge branch 'master' of https://github.com/jrossthomson/bigquery-utils into master", "committedDate": "2020-08-04T18:12:01Z", "type": "commit"}, {"oid": "2705f30efc89d84673d845aa2f5f909176707374", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2705f30efc89d84673d845aa2f5f909176707374", "message": "Interim update.", "committedDate": "2020-08-05T20:41:04Z", "type": "commit"}, {"oid": "3321b42dbf7b431941b7fe44a4a26c43818ef165", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/3321b42dbf7b431941b7fe44a4a26c43818ef165", "message": "Fixed KW test cases.", "committedDate": "2020-08-06T15:58:04Z", "type": "commit"}, {"oid": "23c84912603754d5a5badc24d4499dee346cfdbe", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/23c84912603754d5a5badc24d4499dee346cfdbe", "message": "Merge branch 'statslib'", "committedDate": "2020-08-06T15:58:38Z", "type": "commit"}, {"oid": "757d08bce888afe57369de54d615a0f8d8f2c3f2", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/757d08bce888afe57369de54d615a0f8d8f2c3f2", "message": "Fixed kw.", "committedDate": "2020-09-01T16:38:14Z", "type": "commit"}, {"oid": "2625f1546d4c1f48b854e1bfdc6cbd1f79353742", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2625f1546d4c1f48b854e1bfdc6cbd1f79353742", "message": "Added Linear Regression", "committedDate": "2020-09-16T19:06:09Z", "type": "commit"}, {"oid": "727081021999d5dcfb43b8f1b9388be83c305218", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/727081021999d5dcfb43b8f1b9388be83c305218", "message": "Merge branch 'statslib'", "committedDate": "2020-09-16T19:19:19Z", "type": "commit"}, {"oid": "d9b33a85e390c9ad4071c5a97c19907410702dbc", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/d9b33a85e390c9ad4071c5a97c19907410702dbc", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-09-16T19:38:56Z", "type": "commit"}, {"oid": "4be0d71a09c224208eac267ee01611ab5e79c578", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4be0d71a09c224208eac267ee01611ab5e79c578", "message": "Merge branch 'master' into master", "committedDate": "2020-10-27T15:51:55Z", "type": "commit"}, {"oid": "c6ad383b05b7b352a5bbca7c03c61dc756e1c1fe", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c6ad383b05b7b352a5bbca7c03c61dc756e1c1fe", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2021-02-02T22:52:28Z", "type": "commit"}, {"oid": "aa18c1375083cddb44230c368a504e8eba93c0dc", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/aa18c1375083cddb44230c368a504e8eba93c0dc", "message": "Use jstat from bq_js_libs", "committedDate": "2021-02-02T22:58:26Z", "type": "commit"}, {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/9a63ff29bb4aa9d88dd950a0eacc40c1ee570408", "message": "fix typo", "committedDate": "2021-02-02T23:52:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4MjM2OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569482368", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                library=[\"gs://bqutil-lib/bq_js_libs/jstat-v1.9.4.min.js\"]\n          \n          \n            \n                library=[\"${JS_BUCKET}/jstat-v1.9.4.min.js\"]", "author": "danieldeleo", "createdAt": "2021-02-03T14:57:44Z", "path": "udfs/statslib/pvalue.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+#standardSQL\n+\n+CREATE OR REPLACE FUNCTION st.pvalue(H FLOAT64, dof INT64) \n+RETURNS FLOAT64 \n+LANGUAGE js AS \"\"\"\n+  return 1.0 - jStat['chisquare'].cdf(H, dof)\n+\"\"\"\n+OPTIONS ( \n+    library=[\"gs://bqutil-lib/bq_js_libs/jstat-v1.9.4.min.js\"]", "originalCommit": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI1NTQyNw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572255427", "bodyText": "changes still pending", "author": "danieldeleo", "createdAt": "2021-02-08T18:01:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4MjM2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4NjEzNQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569486135", "bodyText": "Please remove this change. Will keep PR focused on addition of UDF", "author": "danieldeleo", "createdAt": "2021-02-03T15:02:15Z", "path": "udfs/tests/udf_test_utils.py", "diffHunk": "@@ -25,7 +25,6 @@\n \n from google.cloud import bigquery\n \n-", "originalCommit": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI1NTUzOQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572255539", "bodyText": "changes still pending", "author": "danieldeleo", "createdAt": "2021-02-08T18:01:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4NjEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjM4ODM3NA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572388374", "bodyText": "@danieldeleo can you help me out with how to make this fix? I don't see where I made a change? Or perhaps you can suggest the git command to remove this frome the commit?", "author": "jrossthomson", "createdAt": "2021-02-08T21:32:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4NjEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQwMjQ3Nw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572402477", "bodyText": "This is the log output.\njrossthomson@drjay:~/bigquery-utils/udfs/tests$ git log -- test_run_udfs.py\ncommit 1e0bd0d42779114d1f5e475cd91d43d2fc049a62\nAuthor: Daniel De Leo <danieldeleo@users.noreply.github.com>\nDate:   Wed Jan 20 10:41:54 2021 -0500\n\n    Adding CI/CD process for hosting minified javascript libraries (#187)\n\ncommit 1b6fc90eb0a434e36fdc7957fe030b7e622ddb6c\nAuthor: Daniel De Leo <danieldeleo@users.noreply.github.com>\nDate:   Tue Apr 7 10:27:43 2020 -0400\n\n    Adding UDF Testing Framework (#36)\n    \n    * Adding UDF Unit Testing Framework\n    \n    Co-authored-by: tslr <tslr@google.com>\n[hi on] jrossthomson@drjay:~/bigquery-utils/udfs/tests$", "author": "jrossthomson", "createdAt": "2021-02-08T21:56:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4NjEzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4Njc2OQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569486769", "bodyText": "Remove this file from PR", "author": "danieldeleo", "createdAt": "2021-02-03T15:03:03Z", "path": ".init", "diffHunk": "@@ -0,0 +1,15 @@\n+\n+# if lsst virutalenv exists, use it.\n+\n+if [ -f ~/.bigquery/bin/activate ]; then\n+   . ~/.bigquery/bin/activate\n+fi\n+\n+if [ -f key.json ]; then\n+   export GOOGLE_APPLICATION_CREDENTIALS=\"key.json\"\n+fi\n+\n+gcloud config set project nih-bq\n+gcloud config set compute/zone us-central1-f\n+gcloud config set compute/region us-central1\n+", "originalCommit": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI1NTI0OQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572255249", "bodyText": "changes still pending", "author": "danieldeleo", "createdAt": "2021-02-08T18:01:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4Njc2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4ODI5OQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569488299", "bodyText": "please remove all changes to this file from PR", "author": "danieldeleo", "createdAt": "2021-02-03T15:04:57Z", "path": ".gitignore", "diffHunk": "@@ -1,5 +1,6 @@\n # Compiled class file\n *.class\n+*.pyc", "originalCommit": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI1NTEyMg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572255122", "bodyText": "changes still pending", "author": "danieldeleo", "createdAt": "2021-02-08T18:01:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4ODI5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4OTYzMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569489633", "bodyText": "Upper case all SQL key words (WITH, SELECT, FROM, etc)", "author": "danieldeleo", "createdAt": "2021-02-03T15:06:37Z", "path": "udfs/statslib/kruskal_wallis.sql", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE FUNCTION st.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((\n+    with H_raw AS(\n+        with sums AS \n+        (\n+            with rank_data AS \n+            (\n+                select d.factor AS f, d.val AS v, rank() over(order by d.val) AS r\n+                from unnest(data) AS d \n+            ) #rank_data\n+            select     \n+                SUM(r) * (SUM(r) / COUNT(*)) AS sumranks, COUNT(*) AS n\n+            from rank_data\n+            GROUP BY f\n+        ) # sums\n+        SELECT 12.00 /(SUM(n) *(SUM(n) + 1)) * SUM(sumranks) -(3.00 *(SUM(n) + 1)) AS H, \n+                      count(n) -1 AS DoF\n+        FROM sums\n+    ) # H_raw\n+    SELECT struct(H AS H, st.pvalue(H, DoF) AS p, DoF AS DoF) from H_raw\n+));", "originalCommit": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4OTkxMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569489913", "bodyText": "Upper case all SQL key words (WITH, SELECT, FROM, etc)", "author": "danieldeleo", "createdAt": "2021-02-03T15:06:58Z", "path": "udfs/statslib/linear_regression.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+\n+\n+CREATE OR REPLACE FUNCTION st.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) \n+AS ((\n+     WITH results AS (\n+       WITH sums AS (\n+         with d as (\n+              select * from unnest(data)\n+         )\n+         select \n+            SUM(d.X) as Sx,\n+            SUM(d.Y) as Sy,\n+            SUM(d.X * d.Y) as Sxy,\n+            SUM(d.X * d.X) as Sxx,\n+            SUM(d.Y * d.Y) as Syy,\n+            COUNT(*) as N\n+         from d\n+       )\n+       SELECT \n+        ((Sy * Sxx) - (Sx * Sxy)) / ((N * (Sxx)) - (Sx * Sx)) AS a,\n+        ((N * Sxy) - (Sx * Sy))  / ((N * Sxx) - (Sx * Sx)) AS b,\n+        ((N * Sxy) - (Sx * Sy))/ SQRT(\n+            (((N * Sxx) - (Sx * Sx))* ((N * Syy - (Sy * Sy))))) AS r \n+        from sums\n+      )\n+      select STRUCT(a, b, r) from results\n+));", "originalCommit": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "65279b57454d7fd3ebf880d8b85f7e3734cce86d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/65279b57454d7fd3ebf880d8b85f7e3734cce86d", "message": "Update kruskal_wallis.sql", "committedDate": "2021-02-08T13:59:55Z", "type": "commit"}, {"oid": "8cc1879680216000b9c22a7d1d4203c984b66bbb", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/8cc1879680216000b9c22a7d1d4203c984b66bbb", "message": "Update linear_regression.sql", "committedDate": "2021-02-08T14:01:24Z", "type": "commit"}, {"oid": "ddd43ad4a85c8e9d47bc89392f0d0993daec3ba5", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/ddd43ad4a85c8e9d47bc89392f0d0993daec3ba5", "message": "Merge branch 'master' into master", "committedDate": "2021-02-08T14:03:04Z", "type": "commit"}, {"oid": "21ced845aeea14a59ca1770bde51fc0c5f3d610f", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/21ced845aeea14a59ca1770bde51fc0c5f3d610f", "message": "Update udfs/statslib/pvalue.sql\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-08T21:21:32Z", "type": "commit"}, {"oid": "04acaa40108987f685b0e642d68de4cf78cdf8a2", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/04acaa40108987f685b0e642d68de4cf78cdf8a2", "message": "Delete .init", "committedDate": "2021-02-08T21:24:15Z", "type": "commit"}, {"oid": "568cb96d84cf0e323e9dab18e9bbe6d8e013eaa6", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/568cb96d84cf0e323e9dab18e9bbe6d8e013eaa6", "message": "Update .gitignore", "committedDate": "2021-02-08T21:25:09Z", "type": "commit"}, {"oid": "d18cd99e7b414f14ba1701f4a4366056369c7d6c", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/d18cd99e7b414f14ba1701f4a4366056369c7d6c", "message": "Merge branch 'master' of https://github.com/jrossthomson/bigquery-utils", "committedDate": "2021-02-08T21:49:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQxNzU3NA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572417574", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            CREATE OR REPLACE FUNCTION st.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((\n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((", "author": "danieldeleo", "createdAt": "2021-02-08T22:19:42Z", "path": "udfs/statslib/kruskal_wallis.sql", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE FUNCTION st.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((", "originalCommit": "568cb96d84cf0e323e9dab18e9bbe6d8e013eaa6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQxNzY5OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572417698", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            CREATE OR REPLACE FUNCTION st.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) \n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>)", "author": "danieldeleo", "createdAt": "2021-02-08T22:19:53Z", "path": "udfs/statslib/linear_regression.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+\n+\n+CREATE OR REPLACE FUNCTION st.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) ", "originalCommit": "568cb96d84cf0e323e9dab18e9bbe6d8e013eaa6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQxNzgwMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572417803", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            CREATE OR REPLACE FUNCTION st.pvalue(H FLOAT64, dof INT64) \n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.pvalue(H FLOAT64, dof INT64)", "author": "danieldeleo", "createdAt": "2021-02-08T22:20:03Z", "path": "udfs/statslib/pvalue.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+#standardSQL\n+\n+CREATE OR REPLACE FUNCTION st.pvalue(H FLOAT64, dof INT64) ", "originalCommit": "568cb96d84cf0e323e9dab18e9bbe6d8e013eaa6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9570dcbec9a46fac30fa83426a807115b4318f1b", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/9570dcbec9a46fac30fa83426a807115b4318f1b", "message": "Update udfs/statslib/kruskal_wallis.sql\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-09T14:40:26Z", "type": "commit"}, {"oid": "14cad124ca885c5419866958b758d9ea96eec608", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/14cad124ca885c5419866958b758d9ea96eec608", "message": "Update udfs/statslib/pvalue.sql\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-09T14:40:33Z", "type": "commit"}, {"oid": "2470574dca4ccd2d2d59e11818a6fde5330b652a", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2470574dca4ccd2d2d59e11818a6fde5330b652a", "message": "Update udfs/statslib/linear_regression.sql\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-09T14:40:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzAzMjQ4Mw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r573032483", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                SELECT struct(H AS H, st.pvalue(H, DoF) AS p, DoF AS DoF) FROM H_raw\n          \n          \n            \n                SELECT struct(H AS H, fn.pvalue(H, DoF) AS p, DoF AS DoF) FROM H_raw", "author": "danieldeleo", "createdAt": "2021-02-09T16:26:29Z", "path": "udfs/statslib/kruskal_wallis.sql", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE FUNCTION fn.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((\n+    WITH H_raw AS(\n+        WITH sums AS \n+        (\n+            WITH rank_data AS \n+            (\n+                SELECT d.factor AS f, d.val AS v, RANK() OVER(ORDER BY d.val) AS r\n+                FROM UNNEST(data) AS d \n+            ) #rank_data\n+            SELECT     \n+                SUM(r) * (SUM(r) / COUNT(*)) AS sumranks, COUNT(*) AS n\n+            FROM rank_data\n+            GROUP BY f\n+        ) # sums\n+        SELECT 12.00 /(SUM(n) *(SUM(n) + 1)) * SUM(sumranks) -(3.00 *(SUM(n) + 1)) AS H, \n+                      COUNT(n) -1 AS DoF\n+        FROM sums\n+    ) # H_raw\n+    SELECT struct(H AS H, st.pvalue(H, DoF) AS p, DoF AS DoF) FROM H_raw", "originalCommit": "2470574dca4ccd2d2d59e11818a6fde5330b652a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "076d9a3c77f6407658cfac7facf07b235ab65ac3", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/076d9a3c77f6407658cfac7facf07b235ab65ac3", "message": "Update udfs/statslib/kruskal_wallis.sql\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-09T19:49:51Z", "type": "commit"}, {"oid": "43f066d6a0a6c726628e614424daef9ca568e7a0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/43f066d6a0a6c726628e614424daef9ca568e7a0", "message": "Update udf_test_utils.py", "committedDate": "2021-02-09T20:18:30Z", "type": "commit"}, {"oid": "c73814529793b0788284a5b131ba281bbbba4fc7", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c73814529793b0788284a5b131ba281bbbba4fc7", "message": "reverted file", "committedDate": "2021-02-09T20:23:41Z", "type": "commit"}, {"oid": "0229cf089e0364c1688dfd9c22a648f453495ad1", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/0229cf089e0364c1688dfd9c22a648f453495ad1", "message": "Merge branch 'master' of https://github.com/jrossthomson/bigquery-utils", "committedDate": "2021-02-09T20:34:21Z", "type": "commit"}, {"oid": "8457323c9411caab3b6a2f82f1a10bdf8eaf5933", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/8457323c9411caab3b6a2f82f1a10bdf8eaf5933", "message": "Delete key.json", "committedDate": "2021-02-09T21:12:11Z", "type": "commit"}, {"oid": "bbc53a8c7f858565ac1d3ba8bbb711229a8e3d5a", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/bbc53a8c7f858565ac1d3ba8bbb711229a8e3d5a", "message": "Moved statslib to community", "committedDate": "2021-02-09T21:31:54Z", "type": "commit"}, {"oid": "b6d337dc77ed78351e5887b4fa22b61b6c0ac740", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/b6d337dc77ed78351e5887b4fa22b61b6c0ac740", "message": "Merge branch 'master' of https://github.com/jrossthomson/bigquery-utils", "committedDate": "2021-02-09T21:32:11Z", "type": "commit"}, {"oid": "f7c6d773205909255171cceca0855984be8e4331", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/f7c6d773205909255171cceca0855984be8e4331", "message": "trying to revert again", "committedDate": "2021-02-12T21:11:55Z", "type": "commit"}, {"oid": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/d4cc03912c5bf0607a6a26b15b408cb8f7d36efb", "message": "fixed newline", "committedDate": "2021-02-12T21:13:26Z", "type": "commit"}, {"oid": "6705fc55974dc26c42d1d3c51a910adb6d07f02f", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/6705fc55974dc26c42d1d3c51a910adb6d07f02f", "message": "Delete BigQueryUtils.code-workspace", "committedDate": "2021-02-22T14:59:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyMDgzOA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580320838", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              return 1.0 - jStat['chisquare'].cdf(H, dof)\n          \n          \n            \n              return 1.0 - jstat.jStat['chisquare'].cdf(H, dof)", "author": "danieldeleo", "createdAt": "2021-02-22T15:04:25Z", "path": "udfs/community/pvalue.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+#standardSQL\n+\n+CREATE OR REPLACE FUNCTION fn.pvalue(H FLOAT64, dof INT64) \n+RETURNS FLOAT64 \n+LANGUAGE js AS \"\"\"\n+  return 1.0 - jStat['chisquare'].cdf(H, dof)", "originalCommit": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyMzI2Mg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580323262", "bodyText": "This is the last change and then all tests should pass.", "author": "danieldeleo", "createdAt": "2021-02-22T15:07:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyMDgzOA=="}], "type": "inlineReview"}, {"oid": "c668b7fa13cf5eaffea1788eb94aca75551fa20b", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c668b7fa13cf5eaffea1788eb94aca75551fa20b", "message": "Update udfs/community/pvalue.sql\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-22T15:05:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNDAxMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580324013", "bodyText": "remove this file from PR", "author": "danieldeleo", "createdAt": "2021-02-22T15:08:14Z", "path": "BigQueryUtils.code-workspace", "diffHunk": "@@ -0,0 +1,7 @@\n+{", "originalCommit": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNDUxOA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580324518", "bodyText": "Yes, already done, or at least I tried.", "author": "jrossthomson", "createdAt": "2021-02-22T15:08:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNDAxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNTAyNQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580325025", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2019 Google LLC\n          \n          \n            \n             * Copyright 2021 Google LLC", "author": "danieldeleo", "createdAt": "2021-02-22T15:09:04Z", "path": "udfs/community/kruskal_wallis.sql", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2019 Google LLC", "originalCommit": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNTE4Mg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580325182", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2019 Google LLC\n          \n          \n            \n             * Copyright 2021 Google LLC", "author": "danieldeleo", "createdAt": "2021-02-22T15:09:16Z", "path": "udfs/community/linear_regression.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Google LLC", "originalCommit": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNjA2Nw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580326067", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             */\n          \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) \n          \n          \n            \n             */\n          \n          \n            \n            \n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>)", "author": "danieldeleo", "createdAt": "2021-02-22T15:10:19Z", "path": "udfs/community/linear_regression.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+\n+\n+CREATE OR REPLACE FUNCTION fn.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) ", "originalCommit": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "befd86432b982d363b6e3c9690c35fe412a50388", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/befd86432b982d363b6e3c9690c35fe412a50388", "message": "Update udfs/community/linear_regression.sql\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-22T15:11:07Z", "type": "commit"}, {"oid": "ad2accc99e7d08d34ce6f12fad64cf3c82d6bc76", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/ad2accc99e7d08d34ce6f12fad64cf3c82d6bc76", "message": "Update udfs/community/linear_regression.sql\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-22T15:22:15Z", "type": "commit"}, {"oid": "00690a984718dd6771142fac258571c32c733a3f", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/00690a984718dd6771142fac258571c32c733a3f", "message": "Update udfs/community/kruskal_wallis.sql\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-22T15:22:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMzNjI4MA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580336280", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n          \n          \n            \n            to extend BigQuery for more specialized usage patterns. Each UDF within this\n          \n          \n            \n            directory will be automatically synchronized to the `bqutil` project within the\n          \n          \n            \n            `fn` dataset for reference in queries.\n          \n          \n            \n            This section details the subset of community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) \n          \n          \n            \n            that extend BigQuery and enable more specialized Statistical Analysis usage patterns. \n          \n          \n            \n            Each UDF detailed below will be automatically synchronized to the `fn` dataset\n          \n          \n            \n            within the `bqutil` project for reference in your queries.", "author": "danieldeleo", "createdAt": "2021-02-22T15:22:32Z", "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n+to extend BigQuery for more specialized usage patterns. Each UDF within this\n+directory will be automatically synchronized to the `bqutil` project within the\n+`fn` dataset for reference in queries.", "originalCommit": "befd86432b982d363b6e3c9690c35fe412a50388", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4b54467cad03b93a33b9dfe882a9cddcdf2b003d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4b54467cad03b93a33b9dfe882a9cddcdf2b003d", "message": "Update udfs/community/README.md\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-22T15:23:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMzNzEwMg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580337102", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ### [kruskal_wallis(arr(struct(factor STRING, val FLOAT64))](kruskal_wallis.sql)\n          \n          \n            \n            ### [kruskal_wallis(ARRAY(STRUCT(factor STRING, val FLOAT64))](kruskal_wallis.sql)", "author": "danieldeleo", "createdAt": "2021-02-22T15:23:33Z", "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n+to extend BigQuery for more specialized usage patterns. Each UDF within this\n+directory will be automatically synchronized to the `bqutil` project within the\n+`fn` dataset for reference in queries.\n+\n+For example, if you'd like to reference the `int` function within your query,\n+you can reference it like the following:\n+```sql\n+SELECT bqutil.fn.int(1.684)\n+```\n+\n+## UDFs\n+\n+* [kruskal_wallis](#kruskal_wallisarrstructfactor-string-val-float64)\n+\n+## Documentation\n+\n+### [kruskal_wallis(arr(struct(factor STRING, val FLOAT64))](kruskal_wallis.sql)", "originalCommit": "befd86432b982d363b6e3c9690c35fe412a50388", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMzNzM5Ng==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580337396", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            set data = [\n          \n          \n            \n            SET data = [", "author": "danieldeleo", "createdAt": "2021-02-22T15:23:54Z", "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n+to extend BigQuery for more specialized usage patterns. Each UDF within this\n+directory will be automatically synchronized to the `bqutil` project within the\n+`fn` dataset for reference in queries.\n+\n+For example, if you'd like to reference the `int` function within your query,\n+you can reference it like the following:\n+```sql\n+SELECT bqutil.fn.int(1.684)\n+```\n+\n+## UDFs\n+\n+* [kruskal_wallis](#kruskal_wallisarrstructfactor-string-val-float64)\n+\n+## Documentation\n+\n+### [kruskal_wallis(arr(struct(factor STRING, val FLOAT64))](kruskal_wallis.sql)\n+Takes an array of struct where each struct (point) represents a measurement, with a group label and a measurement value\n+\n+The [Kruskal\u2013Wallis test by ranks](https://en.wikipedia.org/wiki/Kruskal%E2%80%93Wallis_one-way_analysis_of_variance), Kruskal\u2013Wallis H test (named after William Kruskal and W. Allen Wallis), or one-way ANOVA on ranks is a non-parametric method for testing whether samples originate from the same distribution. It is used for comparing two or more independent samples of equal or different sample sizes. It extends the Mann\u2013Whitney U test, which is used for comparing only two groups. The parametric equivalent of the Kruskal\u2013Wallis test is the one-way analysis of variance (ANOVA).\n+\n+* Input: array: struct <factor STRING, val FLOAT64>\n+* Output: struct<H FLOAT64, p-value FLOAT64, DOF FLOAT64>\n+```sql\n+DECLARE data ARRAY<STRUCT<factor STRING, val FLOAT64>>;\n+\n+set data = [", "originalCommit": "befd86432b982d363b6e3c9690c35fe412a50388", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b22b52e5ac28b3f4db3041f8455f115663068fd6", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/b22b52e5ac28b3f4db3041f8455f115663068fd6", "message": "Update udfs/community/README.md\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-22T15:23:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMzNzU5NQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580337595", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            SELECT `lib_stats.kruskal_wallis`(data) as results;\n          \n          \n            \n            SELECT `lib_stats.kruskal_wallis`(data) AS results;", "author": "danieldeleo", "createdAt": "2021-02-22T15:24:08Z", "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n+to extend BigQuery for more specialized usage patterns. Each UDF within this\n+directory will be automatically synchronized to the `bqutil` project within the\n+`fn` dataset for reference in queries.\n+\n+For example, if you'd like to reference the `int` function within your query,\n+you can reference it like the following:\n+```sql\n+SELECT bqutil.fn.int(1.684)\n+```\n+\n+## UDFs\n+\n+* [kruskal_wallis](#kruskal_wallisarrstructfactor-string-val-float64)\n+\n+## Documentation\n+\n+### [kruskal_wallis(arr(struct(factor STRING, val FLOAT64))](kruskal_wallis.sql)\n+Takes an array of struct where each struct (point) represents a measurement, with a group label and a measurement value\n+\n+The [Kruskal\u2013Wallis test by ranks](https://en.wikipedia.org/wiki/Kruskal%E2%80%93Wallis_one-way_analysis_of_variance), Kruskal\u2013Wallis H test (named after William Kruskal and W. Allen Wallis), or one-way ANOVA on ranks is a non-parametric method for testing whether samples originate from the same distribution. It is used for comparing two or more independent samples of equal or different sample sizes. It extends the Mann\u2013Whitney U test, which is used for comparing only two groups. The parametric equivalent of the Kruskal\u2013Wallis test is the one-way analysis of variance (ANOVA).\n+\n+* Input: array: struct <factor STRING, val FLOAT64>\n+* Output: struct<H FLOAT64, p-value FLOAT64, DOF FLOAT64>\n+```sql\n+DECLARE data ARRAY<STRUCT<factor STRING, val FLOAT64>>;\n+\n+set data = [\n+('a',1.0),\n+('b',2.0),\n+('c',2.3),\n+('a',1.4),\n+('b',2.2),\n+('c',5.5),\n+('a',1.0),\n+('b',2.3),\n+('c',2.3),\n+('a',1.1),\n+('b',7.2),\n+('c',2.8)\n+];\n+\n+\n+SELECT `lib_stats.kruskal_wallis`(data) as results;", "originalCommit": "befd86432b982d363b6e3c9690c35fe412a50388", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bd0c6dd1d9442b1cd73b8fb3300ac2cd8b74a094", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/bd0c6dd1d9442b1cd73b8fb3300ac2cd8b74a094", "message": "Update udfs/community/README.md\n\nCo-authored-by: Daniel De Leo <danieldeleo@users.noreply.github.com>", "committedDate": "2021-02-22T15:24:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDM0MjE2Nw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580342167", "bodyText": "linear_regression and pvalue UDFs must also be added to README.\nPlease add all new UDFs to the top UDFs list as well, but have them link down to their descriptions in the new statslib section you created.", "author": "danieldeleo", "createdAt": "2021-02-22T15:29:23Z", "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This section details the subset of community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) \n+that extend BigQuery and enable more specialized Statistical Analysis usage patterns. \n+Each UDF detailed below will be automatically synchronized to the `fn` dataset\n+within the `bqutil` project for reference in your queries.\n+\n+For example, if you'd like to reference the `int` function within your query,\n+you can reference it like the following:\n+```sql\n+SELECT bqutil.fn.int(1.684)\n+```\n+\n+## UDFs\n+\n+* [kruskal_wallis](#kruskal_wallisarrstructfactor-string-val-float64)", "originalCommit": "bd0c6dd1d9442b1cd73b8fb3300ac2cd8b74a094", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mjk2MTg4OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r582961888", "bodyText": "Done.", "author": "jrossthomson", "createdAt": "2021-02-25T16:08:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDM0MjE2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MTk5MDc4Mg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r581990782", "bodyText": "Add trailing newline", "author": "danieldeleo", "createdAt": "2021-02-24T14:12:24Z", "path": "udfs/community/test_cases.yaml", "diffHunk": "@@ -389,3 +389,18 @@ nlp_compromise_people:\n   - test:\n     input: CAST(\"Randal Kieth Orton and Dwayne 'the rock' Johnson had a really funny fight.\" AS STRING)\n     expected_output: CAST(['randal kieth orton', 'dwayne the rock johnson'] AS ARRAY<STRING>)\n+#\n+# Below targets StatsLib work\n+#\n+pvalue:\n+  - test:\n+    input: CAST(0.3 AS FLOAT64), CAST(2 AS INT64)\n+    expected_output: CAST(0.8607079764250578 AS FLOAT64)\n+kruskal_wallis:\n+  - test:\n+    input: (SELECT [('a',1.0), ('b',2.0), ('c',2.3), ('a',1.4), ('b',2.2), ('c',5.5), ('a',1.0), ('b',2.3), ('c',2.3), ('a',1.1), ('b',7.2), ('c',2.8)])\n+    expected_output: STRUCT(CAST(3.423076923076927 AS FLOAT64) AS H, CAST( 0.1805877514841956 AS FLOAT64) AS p, CAST(2 AS INT64) AS DoF)\n+linear_regression:\n+  - test:\n+    input: (SELECT [ (5.1,2.5), (5.0,2.0), (5.7,2.6), (6.0,2.2), (5.8,2.6), (5.5,2.3), (6.1,2.8), (5.5,2.5), (6.4,3.2), (5.6,3.0)])\n+    expected_output: STRUCT(CAST(-0.4353361094588436 AS FLOAT64) AS a, CAST( 0.5300416418798544 AS FLOAT64) AS b, CAST(0.632366563565354 AS FLOAT64) AS r)", "originalCommit": "bd0c6dd1d9442b1cd73b8fb3300ac2cd8b74a094", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6095ed26943eb9c7a9e7fa838cf0ac3a45025914", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/6095ed26943eb9c7a9e7fa838cf0ac3a45025914", "message": "Update README.md", "committedDate": "2021-02-25T15:08:43Z", "type": "commit"}, {"oid": "67d21f13ce5040aca8a2f721f2ea3efb29aa29b5", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/67d21f13ce5040aca8a2f721f2ea3efb29aa29b5", "message": "Update README.md", "committedDate": "2021-02-25T15:16:29Z", "type": "commit"}, {"oid": "d294925da39cc092b4dd6a5e9b59a6860e546967", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/d294925da39cc092b4dd6a5e9b59a6860e546967", "message": "Update README.md", "committedDate": "2021-02-25T15:34:24Z", "type": "commit"}, {"oid": "dbac294e8b7b0c8c0ad15823b4bf1bd6136c5abd", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/dbac294e8b7b0c8c0ad15823b4bf1bd6136c5abd", "message": "Update test_cases.yaml", "committedDate": "2021-02-25T16:08:49Z", "type": "commit"}, {"oid": "c4f90edc9a730f3e1c44cc6e3370aa802534040b", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c4f90edc9a730f3e1c44cc6e3370aa802534040b", "message": "Merge branch 'master' into master", "committedDate": "2021-02-26T19:50:24Z", "type": "commit"}]}