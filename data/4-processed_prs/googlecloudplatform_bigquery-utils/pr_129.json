{"pr_number": 129, "pr_title": "SQL Extraction: python analyzer", "pr_createdAt": "2020-07-31T19:29:54Z", "pr_url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/129", "timeline": [{"oid": "3236747b9aa6d4c01ef564886e34bf892b6c1438", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/3236747b9aa6d4c01ef564886e34bf892b6c1438", "message": "SQL Extraction: python analyzer", "committedDate": "2020-07-31T19:25:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIyNjUxMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/129#discussion_r467226513", "bodyText": "How come the result is \"(helloworld)\" and not \"helloworld\"?", "author": "feiling", "createdAt": "2020-08-07T19:20:47Z", "path": "tools/sql_extraction/src/test/kotlin/PythonAnalysisTest.kt", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.google.cloud.sqlecosystem.sqlextraction\n+\n+import com.google.cloud.sqlecosystem.sqlextraction.output.QueryUsages\n+import org.antlr.v4.runtime.CharStreams\n+import kotlin.test.Test\n+import kotlin.test.assertEquals\n+\n+class PythonAnalysisTest {\n+    @Test\n+    fun `simple string return`() {\n+        val program = \"\"\"\n+def test():\n+    return \"test\"\n+\"\"\"\n+\n+        val result = analyze(program)\n+\n+        assertCorrect(result, \"test\")\n+    }\n+\n+    @Test\n+    fun `simple method argument`() {\n+        val program = \"\"\"\n+import something\n+something.some_method(\"test\")\n+\"\"\"\n+\n+        val result = analyze(program)\n+\n+        assertCorrect(result, \"test\")\n+    }\n+\n+    @Test\n+    fun `literal concatenation`() {\n+        val program = \"\"\"\n+import something\n+something.some_method(\"hello\" + \"world\")\n+\"\"\"\n+\n+        val result = analyze(program)\n+\n+        assertCorrect(result, \"(helloworld)\")", "originalCommit": "3236747b9aa6d4c01ef564886e34bf892b6c1438", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIzNTI0OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/129#discussion_r467235248", "bodyText": "For any complex query fragments, I added parentheses around the internal fragments (https://github.com/GoogleCloudPlatform/bigquery-utils/blob/master/tools/sql_extraction/src/main/kotlin/output/QueryFragment.kt#L74-L78).\nWould it be a good idea to trim them off at the end of the recursion?", "author": "creativitRy", "createdAt": "2020-08-07T19:41:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIyNjUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIzODM4Mw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/129#discussion_r467238383", "bodyText": "I see. That's fine. You can keep it.", "author": "feiling", "createdAt": "2020-08-07T19:49:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIyNjUxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIyNjk0OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/129#discussion_r467226948", "bodyText": "Does the analyzer support multi-line strings?  If so, please add a unit test. If not, pls add support in another PR.", "author": "feiling", "createdAt": "2020-08-07T19:21:48Z", "path": "tools/sql_extraction/src/test/kotlin/PythonAnalysisTest.kt", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.google.cloud.sqlecosystem.sqlextraction\n+\n+import com.google.cloud.sqlecosystem.sqlextraction.output.QueryUsages\n+import org.antlr.v4.runtime.CharStreams\n+import kotlin.test.Test\n+import kotlin.test.assertEquals\n+\n+class PythonAnalysisTest {\n+    @Test\n+    fun `simple string return`() {\n+        val program = \"\"\"\n+def test():\n+    return \"test\"\n+\"\"\"\n+\n+        val result = analyze(program)\n+\n+        assertCorrect(result, \"test\")\n+    }\n+\n+    @Test\n+    fun `simple method argument`() {\n+        val program = \"\"\"\n+import something\n+something.some_method(\"test\")\n+\"\"\"\n+\n+        val result = analyze(program)\n+\n+        assertCorrect(result, \"test\")\n+    }\n+\n+    @Test\n+    fun `literal concatenation`() {\n+        val program = \"\"\"\n+import something\n+something.some_method(\"hello\" + \"world\")\n+\"\"\"\n+\n+        val result = analyze(program)\n+\n+        assertCorrect(result, \"(helloworld)\")\n+    }\n+\n+    @Test\n+    fun `variable assignment and usage`() {\n+        val program = \"\"\"\n+import something\n+a = \"test\"\n+something.some_method(a)\n+\"\"\"\n+\n+        val result = analyze(program)\n+\n+        assertCorrect(result, \"test\")\n+    }\n+", "originalCommit": "3236747b9aa6d4c01ef564886e34bf892b6c1438", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0NzMyNw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/129#discussion_r467247327", "bodyText": "Good idea! I'll add tests for them", "author": "creativitRy", "createdAt": "2020-08-07T20:11:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIyNjk0OA=="}], "type": "inlineReview"}, {"oid": "ec5bb64957f89e15680b960f132f59614634896d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/ec5bb64957f89e15680b960f132f59614634896d", "message": "Test multiline strings for python", "committedDate": "2020-08-07T20:11:59Z", "type": "commit"}, {"oid": "ebec37506d7e2737a0e31359b3a785d6d980c79e", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/ebec37506d7e2737a0e31359b3a785d6d980c79e", "message": "Merge branch 'master' into master", "committedDate": "2020-08-07T20:20:07Z", "type": "commit"}]}