{"pr_number": 2527, "pr_title": "[Feature] [Exam-Mode] Automatically assess text and modeling exercises for unsubmitted student exams", "pr_createdAt": "2020-12-09T15:31:01Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2527", "timeline": [{"oid": "83f34d0ab4e23d68407dd51d9ea5f450c229e5b2", "url": "https://github.com/ls1intum/Artemis/commit/83f34d0ab4e23d68407dd51d9ea5f450c229e5b2", "message": "add rest call to automatically grade submissions with 0 points", "committedDate": "2020-11-23T16:26:21Z", "type": "commit"}, {"oid": "a04c03c6d9d378b3240121cd62ab23537fb22f3f", "url": "https://github.com/ls1intum/Artemis/commit/a04c03c6d9d378b3240121cd62ab23537fb22f3f", "message": "Merge branch 'develop' into feature/automatically-assess-unsubmitted-student-exams", "committedDate": "2020-12-08T10:57:19Z", "type": "commit"}, {"oid": "81edad565b5fb20d8cb570a2e5418047e631cdde", "url": "https://github.com/ls1intum/Artemis/commit/81edad565b5fb20d8cb570a2e5418047e631cdde", "message": "refactor setNewResult and saveOrderedResultForSubmission to be more closely related and descriptive", "committedDate": "2020-12-08T15:35:12Z", "type": "commit"}, {"oid": "6f439bc2c7070b1064ddd188d6fcb3c50cc0ee10", "url": "https://github.com/ls1intum/Artemis/commit/6f439bc2c7070b1064ddd188d6fcb3c50cc0ee10", "message": "add API endpoint to automatically grade unsubmitted student exam modeling and text exercises", "committedDate": "2020-12-08T15:42:56Z", "type": "commit"}, {"oid": "947fa3f6cffba1c16c062a76f4d6665f26eb0964", "url": "https://github.com/ls1intum/Artemis/commit/947fa3f6cffba1c16c062a76f4d6665f26eb0964", "message": "complete the implementation on the server", "committedDate": "2020-12-09T14:18:03Z", "type": "commit"}, {"oid": "500e632e1374a51e7fb4f07b2e5ea538c073ab79", "url": "https://github.com/ls1intum/Artemis/commit/500e632e1374a51e7fb4f07b2e5ea538c073ab79", "message": "add integration tests for unsubmitted exams grading", "committedDate": "2020-12-09T14:19:28Z", "type": "commit"}, {"oid": "52a1f5ff341a32ab8b7b32a5285accaba5add47d", "url": "https://github.com/ls1intum/Artemis/commit/52a1f5ff341a32ab8b7b32a5285accaba5add47d", "message": "add button in studentExam page", "committedDate": "2020-12-09T15:27:42Z", "type": "commit"}, {"oid": "56088208c17d3a16e3917891ac8bc2f4ec876f0b", "url": "https://github.com/ls1intum/Artemis/commit/56088208c17d3a16e3917891ac8bc2f4ec876f0b", "message": "Merge branch 'develop' into feature/automatically-assess-unsubmitted-student-exams", "committedDate": "2020-12-09T15:32:45Z", "type": "commit"}, {"oid": "c39ca05ea00c107bd5aeeed33dd5c0515ff439fc", "url": "https://github.com/ls1intum/Artemis/commit/c39ca05ea00c107bd5aeeed33dd5c0515ff439fc", "message": "Merge branch 'develop' into feature/automatically-assess-unsubmitted-student-exams", "committedDate": "2020-12-09T15:56:40Z", "type": "commit"}, {"oid": "d8cfe2beb5dbe79123ef23145b01c828dec42610", "url": "https://github.com/ls1intum/Artemis/commit/d8cfe2beb5dbe79123ef23145b01c828dec42610", "message": "Merge branch 'develop' into feature/automatically-assess-unsubmitted-student-exams", "committedDate": "2020-12-10T15:44:00Z", "type": "commit"}, {"oid": "1dde4da477320ce5b35b9f858552ce43d579565a", "url": "https://github.com/ls1intum/Artemis/commit/1dde4da477320ce5b35b9f858552ce43d579565a", "message": "Merge branch 'develop' into feature/automatically-assess-unsubmitted-student-exams", "committedDate": "2020-12-10T20:55:36Z", "type": "commit"}, {"oid": "3d3bcb5ae8c55133f471bb99621bcd65b16a94af", "url": "https://github.com/ls1intum/Artemis/commit/3d3bcb5ae8c55133f471bb99621bcd65b16a94af", "message": "merge branch develop", "committedDate": "2020-12-14T10:42:43Z", "type": "commit"}, {"oid": "b7c58d1dbe97f70a45fa3aab3a0e63413278c2fe", "url": "https://github.com/ls1intum/Artemis/commit/b7c58d1dbe97f70a45fa3aab3a0e63413278c2fe", "message": "change getResult() to getLatestResult()\n- method name refactored after merge", "committedDate": "2020-12-14T10:50:25Z", "type": "commit"}, {"oid": "991309f58c9ed0fda3d2f8752af128987ba4c092", "url": "https://github.com/ls1intum/Artemis/commit/991309f58c9ed0fda3d2f8752af128987ba4c092", "message": "improve test", "committedDate": "2020-12-14T11:01:29Z", "type": "commit"}, {"oid": "cae45e8b0df7c98fd199c17b3cc60d55f243470b", "url": "https://github.com/ls1intum/Artemis/commit/cae45e8b0df7c98fd199c17b3cc60d55f243470b", "message": "fix documentation", "committedDate": "2020-12-14T12:25:18Z", "type": "commit"}, {"oid": "858459f1956bbcc2e40deebf4baadd6c5b36d6aa", "url": "https://github.com/ls1intum/Artemis/commit/858459f1956bbcc2e40deebf4baadd6c5b36d6aa", "message": "Basic Test Setup", "committedDate": "2020-12-14T14:32:27Z", "type": "commit"}, {"oid": "8fd8472e218e8bcc9ff5f6ce264bbc04efea5a8c", "url": "https://github.com/ls1intum/Artemis/commit/8fd8472e218e8bcc9ff5f6ce264bbc04efea5a8c", "message": "Merge branch 'feature/automatically-assess-unsubmitted-student-exams' of github.com:ls1intum/Artemis into feature/automatically-assess-unsubmitted-student-exams", "committedDate": "2020-12-14T14:34:19Z", "type": "commit"}, {"oid": "c0b3cf117c5e84988f97eb0dd5dcb5f936972c57", "url": "https://github.com/ls1intum/Artemis/commit/c0b3cf117c5e84988f97eb0dd5dcb5f936972c57", "message": "update structure", "committedDate": "2020-12-14T14:56:31Z", "type": "commit"}, {"oid": "a8dc19d6cb928c7bb46aaa485ef74a3bb0f562cb", "url": "https://github.com/ls1intum/Artemis/commit/a8dc19d6cb928c7bb46aaa485ef74a3bb0f562cb", "message": "add more asserts to test", "committedDate": "2020-12-14T15:20:16Z", "type": "commit"}, {"oid": "cefd0006b7a330bdf071b5c9a2cfa36eac31bcc5", "url": "https://github.com/ls1intum/Artemis/commit/cefd0006b7a330bdf071b5c9a2cfa36eac31bcc5", "message": "add client tests", "committedDate": "2020-12-14T20:32:49Z", "type": "commit"}, {"oid": "f0bd79c0ad987cb6ff4867035a17f09946f051c2", "url": "https://github.com/ls1intum/Artemis/commit/f0bd79c0ad987cb6ff4867035a17f09946f051c2", "message": "Merge branch 'develop' into feature/automatically-assess-unsubmitted-student-exams", "committedDate": "2020-12-14T20:37:05Z", "type": "commit"}, {"oid": "af22e1e712fd2582c74e9675c74ab4f86b4fd2f4", "url": "https://github.com/ls1intum/Artemis/commit/af22e1e712fd2582c74e9675c74ab4f86b4fd2f4", "message": "set rated flag to true so that it appears correctly in the dashboard progress status", "committedDate": "2020-12-14T22:44:06Z", "type": "commit"}, {"oid": "959f9d3e3d73157876efa15d2751b87aa8546c02", "url": "https://github.com/ls1intum/Artemis/commit/959f9d3e3d73157876efa15d2751b87aa8546c02", "message": "fix error message display and count grace period to exam end", "committedDate": "2020-12-14T22:46:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzOTk1Mg==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543139952", "bodyText": "Should we rather add an abstract method to Exercise or something that returns whether an exercise needs manual assessment? I think we keep adding these is Modeling/Text(/File) checks all over the place and we are actually interested in the assessment type.", "author": "jpbernius", "createdAt": "2020-12-15T08:26:51Z", "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -248,6 +252,43 @@ else if (exercise instanceof ModelingExercise) {\n         }\n     }\n \n+    /**\n+     * Automatically assess the modeling- and programming exercises of student exams of an exam which are not submitted with 0 points.\n+     * The assessment is counted as {@link AssessmentType#SEMI_AUTOMATIC} to make sure it is not considered for manual assessment,\n+     * see {@link StudentParticipationRepository#findByExerciseIdWithLatestSubmissionWithoutManualResultsAndNoTestRunParticipation}.\n+     * The assessor is current instructor who made the request.\n+     *\n+     * @param examId the exam id\n+     * @return returns the number of assessedSubmissions\n+     */\n+    public int automaticallyAssessUnsubmittedExams(final Long examId) {\n+        int numberOfAssessedSubmissions = 0;\n+        User instructor = userService.getUser();\n+        Set<StudentExam> unsubmittedStudentExams = findAllUnsubmittedStudentExams(examId);\n+        Map<User, List<Exercise>> exercisesOfUser = unsubmittedStudentExams.stream().collect(Collectors.toMap(StudentExam::getUser, studentExam -> studentExam.getExercises()\n+                .stream().filter(exercise -> exercise instanceof ModelingExercise || exercise instanceof TextExercise).collect(Collectors.toList())));", "originalCommit": "959f9d3e3d73157876efa15d2751b87aa8546c02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIwNTg0Mg==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543205842", "bodyText": "@jpbernius Thats a good point, but should we then include programming exercises configured with SEMI_AUTOMIC assessment type? In this feature for example we don't grade those, and there are other parts in the code where we specifically target modeling and text exercises.", "author": "anditurdiu", "createdAt": "2020-12-15T10:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzOTk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyMjI5NA==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543222294", "bodyText": "Ok, I understand. Wouldn't we want to exclude programming submissions as well in this situation. So they might be relevant as well? (I guess out of scope here though.)\nWe can keep this as is if you want.", "author": "jpbernius", "createdAt": "2020-12-15T10:24:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEzOTk1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MDQ1Mg==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543140452", "bodyText": "Anything going against\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                result.setAssessmentType(AssessmentType.SEMI_AUTOMATIC);\n          \n          \n            \n                                result.setAssessmentType(AssessmentType.AUTOMATIC);\n          \n      \n    \n    \n  \n\n?", "author": "jpbernius", "createdAt": "2020-12-15T08:27:31Z", "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -248,6 +252,43 @@ else if (exercise instanceof ModelingExercise) {\n         }\n     }\n \n+    /**\n+     * Automatically assess the modeling- and programming exercises of student exams of an exam which are not submitted with 0 points.\n+     * The assessment is counted as {@link AssessmentType#SEMI_AUTOMATIC} to make sure it is not considered for manual assessment,\n+     * see {@link StudentParticipationRepository#findByExerciseIdWithLatestSubmissionWithoutManualResultsAndNoTestRunParticipation}.\n+     * The assessor is current instructor who made the request.\n+     *\n+     * @param examId the exam id\n+     * @return returns the number of assessedSubmissions\n+     */\n+    public int automaticallyAssessUnsubmittedExams(final Long examId) {\n+        int numberOfAssessedSubmissions = 0;\n+        User instructor = userService.getUser();\n+        Set<StudentExam> unsubmittedStudentExams = findAllUnsubmittedStudentExams(examId);\n+        Map<User, List<Exercise>> exercisesOfUser = unsubmittedStudentExams.stream().collect(Collectors.toMap(StudentExam::getUser, studentExam -> studentExam.getExercises()\n+                .stream().filter(exercise -> exercise instanceof ModelingExercise || exercise instanceof TextExercise).collect(Collectors.toList())));\n+        for (final var user : exercisesOfUser.keySet()) {\n+            final var studentParticipations = participationService.findByStudentIdAndIndividualExercisesWithEagerSubmissionsResult(user.getId(), exercisesOfUser.get(user));\n+            for (final var studentParticipation : studentParticipations) {\n+                if (studentParticipation.findLatestSubmission().isPresent() && studentParticipation.findLatestSubmission().get().getLatestResult() == null) {\n+                    // get last submission\n+                    final var latestSubmission = studentParticipation.findLatestSubmission().get();\n+                    // create result with 0 points\n+                    Result result = new Result();\n+                    result.setParticipation(studentParticipation);\n+                    result.setAssessor(instructor);\n+                    result.setCompletionDate(ZonedDateTime.now());\n+                    result.setScore(0L);\n+                    result.rated(true);\n+                    result.setAssessmentType(AssessmentType.SEMI_AUTOMATIC);", "originalCommit": "959f9d3e3d73157876efa15d2751b87aa8546c02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIwODg4OA==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543208888", "bodyText": "We specifically exclude SEMI_AUTOMATIC and MANUAL assessments from eligible submissions for new manual assessment. If we mark it as AUTOMATIC, it would appear to the tutors for assessment.", "author": "anditurdiu", "createdAt": "2020-12-15T10:05:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MDQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyMDIxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543220211", "bodyText": "Wait, why?\nI'd assume that AssessmentType.AUTOMATIC would represent results that have not been seen by a human. E.g. Quizzes and most programming results.\nMANUAL is only assessed by humans and SEMI_AUTOMATIC is that there is an automatic assessment already there (e.g. programming tests, Compass, or Athene) which is reviewed and possibly adjusted by humans.\nAs the empty submissions are not supposed to be seen by a human at all, I'd argue that it should be in fact AUTOMATIC. I'd think of such a submission not showing up for assessment in the dashboard as it is already assessed before. (Compare with another tutor, only that it is a bot in this case.)", "author": "jpbernius", "createdAt": "2020-12-15T10:21:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MDQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTAxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543569011", "bodyText": "@jpbernius As we discussed in private I set the assessor to be the artemis_admin user and left the assessment type currently to SEMI_AUTOMATIC. Maybe we can have a look at the assessment types and their usages in another PR to unify their meaning for different exercise types and decouple the rated functionality from them.", "author": "anditurdiu", "createdAt": "2020-12-15T18:05:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MDQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzMjY0NA==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r544232644", "bodyText": "I think we can live with the choice of SEMI_AUTOMATIC here. But please add very detailed comments into code why this decision was made and why AUTOMATIC is not possible here. It is very important that future developers immediately understand this when looking at the code", "author": "krusche", "createdAt": "2020-12-16T11:45:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MDQ1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MTE3OA==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543141178", "bodyText": "Looks like we fetch the exam twice here?", "author": "jpbernius", "createdAt": "2020-12-15T08:28:41Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/StudentExamResource.java", "diffHunk": "@@ -367,6 +372,37 @@ public StudentExamResource(ExamAccessService examAccessService, StudentExamServi\n         return ResponseEntity.ok(testRun);\n     }\n \n+    /**\n+     * POST /courses/{courseId}/exams/{examId}/student-exams/automatically-assess-unsubmitted-student-exams : Automatically assess unsubmitted student exams.\n+     *\n+     * Finds student exams which the students did not submit on time i.e {@link StudentExam#isSubmitted()} is false.\n+     * Automatically grade all modeling- and text exercises with 0 points in {@link StudentExamService#automaticallyAssessUnsubmittedExams}.\n+     *\n+     * @param courseId the id of the course\n+     * @param examId the id of the exam\n+     * @return {@link HttpStatus#BAD_REQUEST} if the exam is not over yet | {@link HttpStatus#FORBIDDEN} if the user is not an instructor\n+     */\n+    @PostMapping(\"/courses/{courseId}/exams/{examId}/student-exams/automatically-assess-unsubmitted-student-exams\")\n+    @PreAuthorize(\"hasAnyRole('INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Integer> automaticallyAssessUnsubmittedStudentExams(@PathVariable Long courseId, @PathVariable Long examId) {\n+        log.info(\"REST request to automatically assess the not submitted student exams of the exam with id {}\", examId);\n+\n+        Optional<ResponseEntity<Void>> courseAndExamAccessFailure = examAccessService.checkCourseAndExamAccessForInstructor(courseId, examId);\n+        if (courseAndExamAccessFailure.isPresent()) {\n+            return forbidden();\n+        }\n+\n+        if (!this.examService.isExamOver(examId)) {\n+            // you can only grade not submitted exams if the exam is over\n+            return badRequest();\n+        }", "originalCommit": "959f9d3e3d73157876efa15d2751b87aa8546c02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIxNjYwNg==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543216606", "bodyText": "@jpbernius Yeah, this is the case in most methods in the ExamResource & StudentExamResource because the public methods of the ExamAccessService only take the examId as a parameter and fetch the exam in the body. To my knowledge there is no way to only fetch the exam once if we want to reuse the checks of the ExamAccessService.", "author": "anditurdiu", "createdAt": "2020-12-15T10:16:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyMDc5Ng==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543220796", "bodyText": "We have a similar situation with the user object for permission checks. In this instance, we fetch the user before the checks and pass it as a reference to a second version of the check methods.", "author": "jpbernius", "createdAt": "2020-12-15T10:22:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM1MDAwNg==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r543350006", "bodyText": "I added methods which take the prefetched exam in the ExamAccessService and am using those now in 135dbb8", "author": "anditurdiu", "createdAt": "2020-12-15T13:42:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MTE3OA=="}], "type": "inlineReview"}, {"oid": "1c88d41ff8d6cd843da766b3b20088a096baf6b3", "url": "https://github.com/ls1intum/Artemis/commit/1c88d41ff8d6cd843da766b3b20088a096baf6b3", "message": "change findByExamId from List to Set", "committedDate": "2020-12-15T10:36:48Z", "type": "commit"}, {"oid": "135dbb812d0c8afbd8cb6f60491facf58e9eae8d", "url": "https://github.com/ls1intum/Artemis/commit/135dbb812d0c8afbd8cb6f60491facf58e9eae8d", "message": "add methods to examAccessService which use the pre fetched exam to not fetch the exam twice", "committedDate": "2020-12-15T13:29:10Z", "type": "commit"}, {"oid": "de3c71859c65520aa7bbf95e039e0fc69f316f3c", "url": "https://github.com/ls1intum/Artemis/commit/de3c71859c65520aa7bbf95e039e0fc69f316f3c", "message": "set the assessor fixed as artemis_admin\nAdd feedback to result: You did not submit your exam", "committedDate": "2020-12-15T18:02:15Z", "type": "commit"}, {"oid": "b2236cfee811fda74ea55895f2b4c773be359c88", "url": "https://github.com/ls1intum/Artemis/commit/b2236cfee811fda74ea55895f2b4c773be359c88", "message": "set to semi automatic", "committedDate": "2020-12-15T18:35:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIwOTY3NA==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r544209674", "bodyText": "Should it be better to define artemis_admin as a constant so that it's easier to modify in the future?", "author": "ivanchimeno", "createdAt": "2020-12-16T11:07:51Z", "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -248,6 +260,62 @@ else if (exercise instanceof ModelingExercise) {\n         }\n     }\n \n+    /**\n+     * Automatically assess the modeling- and programming exercises of student exams of an exam which are not submitted with 0 points.\n+     * The assessment is counted as {@link AssessmentType#SEMI_AUTOMATIC} to make sure it is not considered for manual assessment,\n+     * see {@link StudentParticipationRepository#findByExerciseIdWithLatestSubmissionWithoutManualResultsAndNoTestRunParticipation}.\n+     * The assessor is artemis_admin.\n+     *\n+     * @param examId the exam id\n+     * @return returns the number of assessedSubmissions\n+     */\n+    public int assessUnsubmittedStudentExams(final Long examId) {\n+        int numberOfAssessedSubmissions = 0;\n+        User artemisAdmin = userService.getUserWithGroupsAndAuthorities(\"artemis_admin\");", "originalCommit": "b2236cfee811fda74ea55895f2b4c773be359c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzMDU1MQ==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r544230551", "bodyText": "This is a bad choice in my opinion. We cannot assume that this user exists and it also does not make sense to set it as assessor. Please change it to the currently logged in user, i.e. the user who clicks the button.", "author": "krusche", "createdAt": "2020-12-16T11:41:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIwOTY3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ4ODU1MQ==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r544488551", "bodyText": "I reverted to using the assessor who clicks on the button", "author": "anditurdiu", "createdAt": "2020-12-16T17:31:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIwOTY3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIxMjkwOQ==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r544212909", "bodyText": "What's the point of this method? It fetches an instructor and student exams but it doesn't really use them right?", "author": "ivanchimeno", "createdAt": "2020-12-16T11:12:35Z", "path": "src/main/java/de/tum/in/www1/artemis/service/StudentExamService.java", "diffHunk": "@@ -248,6 +260,62 @@ else if (exercise instanceof ModelingExercise) {\n         }\n     }\n \n+    /**\n+     * Automatically assess the modeling- and programming exercises of student exams of an exam which are not submitted with 0 points.\n+     * The assessment is counted as {@link AssessmentType#SEMI_AUTOMATIC} to make sure it is not considered for manual assessment,\n+     * see {@link StudentParticipationRepository#findByExerciseIdWithLatestSubmissionWithoutManualResultsAndNoTestRunParticipation}.\n+     * The assessor is artemis_admin.\n+     *\n+     * @param examId the exam id\n+     * @return returns the number of assessedSubmissions\n+     */\n+    public int assessUnsubmittedStudentExams(final Long examId) {\n+        int numberOfAssessedSubmissions = 0;\n+        User artemisAdmin = userService.getUserWithGroupsAndAuthorities(\"artemis_admin\");\n+        Set<StudentExam> unsubmittedStudentExams = findAllUnsubmittedStudentExams(examId);\n+        Map<User, List<Exercise>> exercisesOfUser = unsubmittedStudentExams.stream().collect(Collectors.toMap(StudentExam::getUser, studentExam -> studentExam.getExercises()\n+                .stream().filter(exercise -> exercise instanceof ModelingExercise || exercise instanceof TextExercise).collect(Collectors.toList())));\n+        for (final var user : exercisesOfUser.keySet()) {\n+            final var studentParticipations = participationService.findByStudentIdAndIndividualExercisesWithEagerSubmissionsResult(user.getId(), exercisesOfUser.get(user));\n+            for (final var studentParticipation : studentParticipations) {\n+                if (studentParticipation.findLatestSubmission().isPresent() && studentParticipation.findLatestSubmission().get().getLatestResult() == null) {\n+                    // get last submission\n+                    final var latestSubmission = studentParticipation.findLatestSubmission().get();\n+\n+                    // create result with 0 points\n+                    Result result = new Result();\n+                    result.setParticipation(studentParticipation);\n+                    result.setAssessor(artemisAdmin);\n+                    result.setCompletionDate(ZonedDateTime.now());\n+                    result.setScore(0L);\n+                    result.rated(true);\n+                    result.setAssessmentType(AssessmentType.SEMI_AUTOMATIC);\n+                    result = submissionService.saveNewResult(latestSubmission, result);\n+\n+                    var feedback = new Feedback();\n+                    feedback.setCredits(0.0);\n+                    feedback.setDetailText(\"You did not submit your exam\");\n+                    feedback.setPositive(false);\n+                    feedback.setText(\"You did not submit your exam\");\n+                    feedback.setType(FeedbackType.AUTOMATIC);\n+                    feedback = feedbackRepository.save(feedback);\n+                    feedback.setResult(result);\n+                    result.setFeedbacks(List.of(feedback));\n+                    resultRepository.save(result);\n+                    numberOfAssessedSubmissions++;\n+                }\n+            }\n+        }\n+        return numberOfAssessedSubmissions;\n+    }\n+\n+    public int assessEmptySubmissions(final Long examId) {", "originalCommit": "b2236cfee811fda74ea55895f2b4c773be359c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzMTM2NQ==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r544231365", "bodyText": "I guess the implementation is not finished yet", "author": "krusche", "createdAt": "2020-12-16T11:42:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIxMjkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ4ODI0Ng==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r544488246", "bodyText": "Yeah I had forgotten to remove the ready for review tag. I pushed the implementation now", "author": "anditurdiu", "createdAt": "2020-12-16T17:31:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIxMjkwOQ=="}], "type": "inlineReview"}, {"oid": "b900399ac08bae2aa3856c74ec5222f4231ee198", "url": "https://github.com/ls1intum/Artemis/commit/b900399ac08bae2aa3856c74ec5222f4231ee198", "message": "Add assess empty submissions\nAnd refactor method to reuse code\nRemove admin from assessor and set instructor", "committedDate": "2020-12-16T17:26:00Z", "type": "commit"}, {"oid": "750e90028bdb993f4576175a35737c6edd55dd8c", "url": "https://github.com/ls1intum/Artemis/commit/750e90028bdb993f4576175a35737c6edd55dd8c", "message": "Merge branch 'develop' into feature/automatically-assess-unsubmitted-student-exams", "committedDate": "2020-12-16T17:28:19Z", "type": "commit"}, {"oid": "bec3d8332b1f28119b21b436bb61857900d9a426", "url": "https://github.com/ls1intum/Artemis/commit/bec3d8332b1f28119b21b436bb61857900d9a426", "message": "hide these automatic assessments from the assessment dashboard", "committedDate": "2020-12-16T18:24:52Z", "type": "commit"}, {"oid": "23264e9f8caa55baaf4afa19605042ccbf1b3353", "url": "https://github.com/ls1intum/Artemis/commit/23264e9f8caa55baaf4afa19605042ccbf1b3353", "message": "fix client message", "committedDate": "2020-12-16T18:29:52Z", "type": "commit"}, {"oid": "34dc0860e8a5b1862e95b1822aa8053107c93196", "url": "https://github.com/ls1intum/Artemis/commit/34dc0860e8a5b1862e95b1822aa8053107c93196", "message": "Merge branch 'develop' into feature/automatically-assess-unsubmitted-student-exams", "committedDate": "2020-12-17T12:28:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA1MTk1Mg==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r545051952", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns calculates if the exam is over by checking if the latest individual exam end date plus grace period has passed.\n          \n          \n            \n                 * Returns if the exam is over by checking if the latest individual exam end date plus grace period has passed.", "author": "FuchsDominik", "createdAt": "2020-12-17T12:27:41Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ExamService.java", "diffHunk": "@@ -804,6 +804,33 @@ public Integer lockAllRepositories(Long examId) {\n         return programmingExercises.size();\n     }\n \n+    /**\n+     * Returns calculates if the exam is over by checking if the latest individual exam end date plus grace period has passed.", "originalCommit": "23264e9f8caa55baaf4afa19605042ccbf1b3353", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA1MjEwNw==", "url": "https://github.com/ls1intum/Artemis/pull/2527#discussion_r545052107", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns calculates if the exam is over by checking if the latest individual exam end date plus grace period has passed.\n          \n          \n            \n                 * Returns if the exam is over by checking if the latest individual exam end date plus grace period has passed.", "author": "FuchsDominik", "createdAt": "2020-12-17T12:27:59Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ExamService.java", "diffHunk": "@@ -804,6 +804,33 @@ public Integer lockAllRepositories(Long examId) {\n         return programmingExercises.size();\n     }\n \n+    /**\n+     * Returns calculates if the exam is over by checking if the latest individual exam end date plus grace period has passed.\n+     * See {@link ExamService#getLatestIndiviudalExamEndDate}\n+     * <p>\n+     *\n+     * @param examId the id of the exam\n+     * @return true if the exam is over and the students cannot submit anymore\n+     * @throws EntityNotFoundException if no exam with the given examId can be found\n+     */\n+    public boolean isExamOver(Long examId) {\n+        return isExamOver(findOne(examId));\n+    }\n+\n+    /**\n+     * Returns calculates if the exam is over by checking if the latest individual exam end date plus grace period has passed.", "originalCommit": "23264e9f8caa55baaf4afa19605042ccbf1b3353", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "10a3635dcb3c76381d44ae0abd6a2f811c79be9a", "url": "https://github.com/ls1intum/Artemis/commit/10a3635dcb3c76381d44ae0abd6a2f811c79be9a", "message": "set submitted to true manually\nThis ensures that the submissions are correctly counted in the assessment dashboard", "committedDate": "2020-12-17T12:48:44Z", "type": "commit"}, {"oid": "c5a4f48b1fe0fee0cfc6d5213d6531d53fd6aad4", "url": "https://github.com/ls1intum/Artemis/commit/c5a4f48b1fe0fee0cfc6d5213d6531d53fd6aad4", "message": "Apply suggestions from code review\n\nCo-authored-by: Dominik Fuchs <44401560+FuchsDominik@users.noreply.github.com>", "committedDate": "2020-12-17T12:56:08Z", "type": "commit"}]}