{"pr_number": 2432, "pr_title": "Add Option to Disable More Feedback Requests", "pr_createdAt": "2020-11-19T16:33:20Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2432", "timeline": [{"oid": "ba55aa75ad8b708098e4d38931b37d66e2ce3d73", "url": "https://github.com/ls1intum/Artemis/commit/ba55aa75ad8b708098e4d38931b37d66e2ce3d73", "message": "Add requestMoreFeedback attribute to Course domain class and database", "committedDate": "2020-10-17T00:50:09Z", "type": "commit"}, {"oid": "44659b3274c9ecaf14ef9a96394817fcad6b441e", "url": "https://github.com/ls1intum/Artemis/commit/44659b3274c9ecaf14ef9a96394817fcad6b441e", "message": "Adjust Course validation and the way we decide if complaints are enabled", "committedDate": "2020-10-17T00:53:30Z", "type": "commit"}, {"oid": "006e9c987663c5865fc89eccad456683064babcc", "url": "https://github.com/ls1intum/Artemis/commit/006e9c987663c5865fc89eccad456683064babcc", "message": "Don't allow creating more feedback requests if the course disabled them", "committedDate": "2020-10-17T00:56:08Z", "type": "commit"}, {"oid": "e2d96343f41d2c02639b20b8b0f9d416a2466836", "url": "https://github.com/ls1intum/Artemis/commit/e2d96343f41d2c02639b20b8b0f9d416a2466836", "message": "Add requestMoreFeedbackEnabled for the client Course with default 'true'", "committedDate": "2020-10-17T00:57:50Z", "type": "commit"}, {"oid": "62fbac3b0270dbd4b2e3ec8e71103760026c7e27", "url": "https://github.com/ls1intum/Artemis/commit/62fbac3b0270dbd4b2e3ec8e71103760026c7e27", "message": "Add a check box for requestMoreFeedbackEnabled to the edit course page", "committedDate": "2020-10-17T01:02:57Z", "type": "commit"}, {"oid": "0c68aed8980be60f596c51de6de38d79cad03944", "url": "https://github.com/ls1intum/Artemis/commit/0c68aed8980be60f596c51de6de38d79cad03944", "message": "Change complain interaction component to respect the new settings", "committedDate": "2020-10-17T01:02:58Z", "type": "commit"}, {"oid": "56d347f75251204cf7ac4669d558995b4067b7b9", "url": "https://github.com/ls1intum/Artemis/commit/56d347f75251204cf7ac4669d558995b4067b7b9", "message": "Adjust server tests to requestMoreFeedbackEnabled and add some tests", "committedDate": "2020-10-17T01:27:24Z", "type": "commit"}, {"oid": "19a714e15281deb7fa7a387e65e873b94f2d7dc5", "url": "https://github.com/ls1intum/Artemis/commit/19a714e15281deb7fa7a387e65e873b94f2d7dc5", "message": "Adjust client tests to new course update form", "committedDate": "2020-10-17T02:12:36Z", "type": "commit"}, {"oid": "c5014b75efb06d5ad46407fca4fc0d7e00170103", "url": "https://github.com/ls1intum/Artemis/commit/c5014b75efb06d5ad46407fca4fc0d7e00170103", "message": "Merge branch 'develop' into feature/course/request-more-feedback-toggle", "committedDate": "2020-10-17T02:14:13Z", "type": "commit"}, {"oid": "052d25685fb7736d1546077841bd85239a06a00d", "url": "https://github.com/ls1intum/Artemis/commit/052d25685fb7736d1546077841bd85239a06a00d", "message": "Simplify the code a bit", "committedDate": "2020-10-17T02:20:38Z", "type": "commit"}, {"oid": "9f8b41bff3050f59b25563530b12dd4aca8f18de", "url": "https://github.com/ls1intum/Artemis/commit/9f8b41bff3050f59b25563530b12dd4aca8f18de", "message": "Merge branch 'develop' into feature/course/request-more-feedback-toggle", "committedDate": "2020-11-19T16:34:25Z", "type": "commit"}, {"oid": "60c5512015227f3400f2884a1a0996e4cb6ab09a", "url": "https://github.com/ls1intum/Artemis/commit/60c5512015227f3400f2884a1a0996e4cb6ab09a", "message": "Change liquibase changelog id", "committedDate": "2020-11-19T16:50:42Z", "type": "commit"}, {"oid": "bc5f8c492ede50e4e0e941ad8b809c400ae7e28f", "url": "https://github.com/ls1intum/Artemis/commit/bc5f8c492ede50e4e0e941ad8b809c400ae7e28f", "message": "Make request more feedback a separate option", "committedDate": "2020-11-19T21:25:23Z", "type": "commit"}, {"oid": "bc5f8c492ede50e4e0e941ad8b809c400ae7e28f", "url": "https://github.com/ls1intum/Artemis/commit/bc5f8c492ede50e4e0e941ad8b809c400ae7e28f", "message": "Make request more feedback a separate option", "committedDate": "2020-11-19T21:25:23Z", "type": "forcePushed"}, {"oid": "d5e0c3bc0b179ba02e6df1903e81153510ea8cda", "url": "https://github.com/ls1intum/Artemis/commit/d5e0c3bc0b179ba02e6df1903e81153510ea8cda", "message": "Fix formatting", "committedDate": "2020-11-19T21:52:11Z", "type": "commit"}, {"oid": "c81646ac9f4a663384aadbd7a5c42018fccacfff", "url": "https://github.com/ls1intum/Artemis/commit/c81646ac9f4a663384aadbd7a5c42018fccacfff", "message": "Fix bug in more feedback request validation", "committedDate": "2020-11-19T22:40:08Z", "type": "commit"}, {"oid": "25dee3bfb7ecec68682ba6499b8ba26a4874ecda", "url": "https://github.com/ls1intum/Artemis/commit/25dee3bfb7ecec68682ba6499b8ba26a4874ecda", "message": "Merge branch 'develop' into feature/course/request-more-feedback-toggle", "committedDate": "2020-11-19T22:40:19Z", "type": "commit"}, {"oid": "9fd28cef523182f616c5c42baaa4239dc7d41639", "url": "https://github.com/ls1intum/Artemis/commit/9fd28cef523182f616c5c42baaa4239dc7d41639", "message": "Fix additional whitespace", "committedDate": "2020-11-19T22:46:48Z", "type": "commit"}, {"oid": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677", "url": "https://github.com/ls1intum/Artemis/commit/6e5bcb4fee851e5c294a367a67285dcc0f8d8677", "message": "Merge branch 'develop' into feature/course/request-more-feedback-toggle", "committedDate": "2020-11-20T11:53:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY4NzA3Mw==", "url": "https://github.com/ls1intum/Artemis/pull/2432#discussion_r527687073", "bodyText": "If maxDays is 14 this will result in \"14 weeks\" right?", "author": "kloessst", "createdAt": "2020-11-20T13:23:36Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java", "diffHunk": "@@ -224,22 +226,44 @@ public Integer getMaxComplaintsPerParticipant(Course course, Participant partici\n     }\n \n     /**\n-     * This function checks whether the student is allowed to submit a complaint or not. Submitting a complaint is allowed within one week after the student received the result. If\n-     * the result was submitted after the assessment due date or the assessment due date is not set, the completion date of the result is checked. If the result was submitted\n-     * before the assessment due date, the assessment due date is checked, as the student can only see the result after the assessment due date.\n+     * This function checks whether the student is allowed to submit a complaint / more feedback request or not.\n+     * This is allowed within the corresponding number of days set in the course after the student received the result.\n+     * If the result was submitted after the assessment due date or the assessment due date is not set, the completion date of the result is checked.\n+     * If the result was submitted before the assessment due date, the assessment due date is checked, as the student can only see the result after the assessment due date.\n      */\n-    private boolean isTimeOfComplaintValid(Result result, Exercise exercise, Course course) {\n+    private static void validateTimeOfComplaintOrRequestMoreFeedback(Result result, Exercise exercise, Course course, ComplaintType type) {\n+        int maxDays = switch (type) {\n+            case COMPLAINT -> course.getMaxComplaintTimeDays();\n+            case MORE_FEEDBACK -> course.getMaxRequestMoreFeedbackTimeDays();\n+        };\n+\n+        boolean isTimeValid;\n         if (exercise.getAssessmentDueDate() == null || result.getCompletionDate().isAfter(exercise.getAssessmentDueDate())) {\n-            return result.getCompletionDate().isAfter(ZonedDateTime.now().minusDays(course.getMaxComplaintTimeDays()));\n+            isTimeValid = result.getCompletionDate().isAfter(ZonedDateTime.now().minusDays(maxDays));\n+        }\n+        else {\n+            isTimeValid = exercise.getAssessmentDueDate().isAfter(ZonedDateTime.now().minusDays(maxDays));\n+        }\n+\n+        if (!isTimeValid) {\n+            StringBuilder message = new StringBuilder(\"You cannot \");\n+            message.append(type == ComplaintType.COMPLAINT ? \"submit a complaint\" : \"request more feedback\");\n+            message.append(\" for a result that is older than \");\n+            message.append(switch (maxDays) {\n+                case 1 -> \"one day\";\n+                case 7 -> \"one week\";\n+                default -> maxDays + (maxDays % 7 == 0 ? \" weeks\" : \" days\");", "originalCommit": "6e5bcb4fee851e5c294a367a67285dcc0f8d8677", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY5OTQ2NA==", "url": "https://github.com/ls1intum/Artemis/pull/2432#discussion_r527699464", "bodyText": "Yes, you are right, good catch. I will fix this.", "author": "MaisiKoleni", "createdAt": "2020-11-20T13:45:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY4NzA3Mw=="}], "type": "inlineReview"}, {"oid": "61eb1403279dc2f4eb6459e3ebfc8941569e36ae", "url": "https://github.com/ls1intum/Artemis/commit/61eb1403279dc2f4eb6459e3ebfc8941569e36ae", "message": "Fix number of weeks in error message generation", "committedDate": "2020-11-20T15:05:55Z", "type": "commit"}, {"oid": "54022ca06dc2cdb737454fe95cea55f7b5a9cd47", "url": "https://github.com/ls1intum/Artemis/commit/54022ca06dc2cdb737454fe95cea55f7b5a9cd47", "message": "Fix parentheses", "committedDate": "2020-11-20T15:38:36Z", "type": "commit"}]}