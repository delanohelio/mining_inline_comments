{"pr_number": 1235, "pr_title": "Chore: Add tests for Submission Resource", "pr_createdAt": "2020-02-10T13:37:43Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1235", "timeline": [{"oid": "d01d67220c83af4f1e9af7baacdd8997a971d8f1", "url": "https://github.com/ls1intum/Artemis/commit/d01d67220c83af4f1e9af7baacdd8997a971d8f1", "message": "Add tests for Submission Resource", "committedDate": "2020-02-10T12:50:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTUwMw==", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r377069503", "bodyText": "I didn't find any usage of the endpoints except the delete one. They didn't have any authorization checks and in my opinion can cause security issues. I would suggest to remove them. Should I do that @krusche ?", "author": "maxr96", "createdAt": "2020-02-10T13:44:10Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/SubmissionResource.java", "diffHunk": "@@ -65,6 +65,7 @@ public SubmissionResource(SubmissionRepository submissionRepository, ResultServi\n      * @throws URISyntaxException if the Location URI syntax is incorrect\n      */\n     @PostMapping(\"/submissions\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")", "originalCommit": "d01d67220c83af4f1e9af7baacdd8997a971d8f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk5NzE1NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r378997155", "bodyText": "yes, please remove the unused endpoints, but double check that they are really unused", "author": "krusche", "createdAt": "2020-02-13T17:06:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTUwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NDI4OA==", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r377074288", "bodyText": "Could you change an attribute and then verify that it has actually changed?", "author": "HanyaElhashemy", "createdAt": "2020-02-10T13:52:49Z", "path": "src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java", "diffHunk": "@@ -83,4 +94,49 @@ public void deleteParticipation_forbidden_tutor() throws Exception {\n     public void deleteParticipation_notFound() throws Exception {\n         request.delete(\"/api/submissions/\" + 1, HttpStatus.NOT_FOUND);\n     }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission() throws Exception {\n+        request.postWithResponseBody(\"/api/submissions\", new TextSubmission(), Submission.class, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission_withId() throws Exception {\n+        var submission = new TextSubmission();\n+        submission.setId(1L);\n+        request.postWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void updateSubmission() throws Exception {", "originalCommit": "d01d67220c83af4f1e9af7baacdd8997a971d8f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NTQ4Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r377075487", "bodyText": "could you assert that the properties of the received submission have the expected values?", "author": "HanyaElhashemy", "createdAt": "2020-02-10T13:55:00Z", "path": "src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java", "diffHunk": "@@ -83,4 +94,49 @@ public void deleteParticipation_forbidden_tutor() throws Exception {\n     public void deleteParticipation_notFound() throws Exception {\n         request.delete(\"/api/submissions/\" + 1, HttpStatus.NOT_FOUND);\n     }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission() throws Exception {\n+        request.postWithResponseBody(\"/api/submissions\", new TextSubmission(), Submission.class, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission_withId() throws Exception {\n+        var submission = new TextSubmission();\n+        submission.setId(1L);\n+        request.postWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void updateSubmission() throws Exception {\n+        var submission = new TextSubmission();\n+        submissionRepository.save(submission);\n+        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void updateSubmission_noId() throws Exception {\n+        var submission = new TextSubmission();\n+        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void getAllSubmissions() throws Exception {\n+        submissionRepository.save(new TextSubmission());\n+        submissionRepository.save(new ModelingSubmission());\n+        List<Submission> submissions = request.getList(\"/api/submissions\", HttpStatus.OK, Submission.class);\n+        assertThat(submissions.size()).isEqualTo(2);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void getSubmission() throws Exception {\n+        var submission = submissionRepository.save(new TextSubmission());", "originalCommit": "d01d67220c83af4f1e9af7baacdd8997a971d8f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e9cb357434e724a96d67c54c3517ae7702537683", "url": "https://github.com/ls1intum/Artemis/commit/e9cb357434e724a96d67c54c3517ae7702537683", "message": "Removed unused code", "committedDate": "2020-02-15T22:23:47Z", "type": "commit"}]}