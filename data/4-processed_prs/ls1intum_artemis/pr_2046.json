{"pr_number": 2046, "pr_title": "[Enhancement] Only fetch build logs if the build failed", "pr_createdAt": "2020-08-22T12:26:07Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2046", "timeline": [{"oid": "235506a4d678d467a1d883f2d74a2a344d904a02", "url": "https://github.com/ls1intum/Artemis/commit/235506a4d678d467a1d883f2d74a2a344d904a02", "message": "Do not return build logs if the build hasn't failed", "committedDate": "2020-08-22T12:25:09Z", "type": "commit"}, {"oid": "4815f00ad20eac0c384120d99081eb2abc0335b5", "url": "https://github.com/ls1intum/Artemis/commit/4815f00ad20eac0c384120d99081eb2abc0335b5", "message": "Return forbidden if build hasn't failed", "committedDate": "2020-08-24T11:37:57Z", "type": "commit"}, {"oid": "3196b1e732353a64f1ffa339074c0da2d9bdb653", "url": "https://github.com/ls1intum/Artemis/commit/3196b1e732353a64f1ffa339074c0da2d9bdb653", "message": "Add equals for BuildLogEntry", "committedDate": "2020-08-24T13:40:16Z", "type": "commit"}, {"oid": "984abeb1bdde3b607a1eb1d8a4ae7397905be334", "url": "https://github.com/ls1intum/Artemis/commit/984abeb1bdde3b607a1eb1d8a4ae7397905be334", "message": "Fix query to always return a participation even if no submission exists for it", "committedDate": "2020-08-24T13:41:27Z", "type": "commit"}, {"oid": "8f15cce3b140b0d22b7528f0f6b16afca7974acd", "url": "https://github.com/ls1intum/Artemis/commit/8f15cce3b140b0d22b7528f0f6b16afca7974acd", "message": "Add integration tests", "committedDate": "2020-08-24T13:41:59Z", "type": "commit"}, {"oid": "4a84889d01f406a48aa7fc0d84b08eea23f75932", "url": "https://github.com/ls1intum/Artemis/commit/4a84889d01f406a48aa7fc0d84b08eea23f75932", "message": "Remove unused service", "committedDate": "2020-08-24T13:48:19Z", "type": "commit"}, {"oid": "f7fdb4f2ea8def597f3444c5417e88171542d997", "url": "https://github.com/ls1intum/Artemis/commit/f7fdb4f2ea8def597f3444c5417e88171542d997", "message": "Suppress 403 when fetching build logs and remove duplicated build logs REST call", "committedDate": "2020-08-24T14:24:21Z", "type": "commit"}, {"oid": "ad4e7a145967a2ac0998717a8525d060e04dffb3", "url": "https://github.com/ls1intum/Artemis/commit/ad4e7a145967a2ac0998717a8525d060e04dffb3", "message": "Fix codacy findings", "committedDate": "2020-08-24T14:27:41Z", "type": "commit"}, {"oid": "4b45febbd2afe0d1b345d0f35163334391fedb2c", "url": "https://github.com/ls1intum/Artemis/commit/4b45febbd2afe0d1b345d0f35163334391fedb2c", "message": "Fix var name", "committedDate": "2020-08-24T14:48:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTczMzI3MQ==", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r475733271", "bodyText": "not sure why you change this here, but this would mean the feedback is not included any more, right?", "author": "krusche", "createdAt": "2020-08-24T16:18:27Z", "path": "src/main/java/de/tum/in/www1/artemis/repository/ParticipationRepository.java", "diffHunk": "@@ -18,8 +18,8 @@\n     @Query(\"select distinct p from Participation p left join fetch p.submissions left join fetch p.results where p.id = :#{#participationId}\")\n     Participation getOneWithEagerSubmissionsAndResults(@Param(\"participationId\") Long participationId);\n \n-    @Query(\"select p from Participation p left join fetch p.results pr left join fetch pr.feedbacks prf where p.id = :participationId and (pr.id = (select max(id) from p.results) or pr.id = null)\")\n-    Optional<Participation> findByIdWithLatestResultAndFeedbacks(@Param(\"participationId\") Long participationId);\n+    @Query(\"select p from Participation p left join fetch p.submissions s left join fetch s.result r where p.id = :participationId and (s.id = (select max(id) from p.submissions) or s.id = null)\")", "originalCommit": "4b45febbd2afe0d1b345d0f35163334391fedb2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc2MzY3NQ==", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r475763675", "bodyText": "This query was only used by the Resource method for fetching the build logs. The feedback was never used.", "author": "kloessst", "createdAt": "2020-08-24T17:04:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTczMzI3MQ=="}], "type": "inlineReview"}, {"oid": "f6c7c3537dcb13dece50c0a52f3ff03d58bf712b", "url": "https://github.com/ls1intum/Artemis/commit/f6c7c3537dcb13dece50c0a52f3ff03d58bf712b", "message": "Fetch build logs only if the submission was marked as failed", "committedDate": "2020-08-24T19:03:36Z", "type": "commit"}, {"oid": "733aefae9d2eca47ebaf74bc95a0ba67490fe5c4", "url": "https://github.com/ls1intum/Artemis/commit/733aefae9d2eca47ebaf74bc95a0ba67490fe5c4", "message": "Orion only receives build logs if the submission failed to build", "committedDate": "2020-08-24T19:11:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwODI1Nw==", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r476308257", "bodyText": "is this logic not necessary any more?", "author": "krusche", "createdAt": "2020-08-25T09:24:15Z", "path": "src/main/webapp/app/exercises/programming/shared/code-editor/build-output/code-editor-build-output.component.ts", "diffHunk": "@@ -182,15 +183,14 @@ export class CodeEditorBuildOutputComponent implements AfterViewInit, OnInit, On\n \n     /**\n      * Decides if the build log should be shown.\n-     * If All tests were successful or there is test feedback -> don't show build logs.\n-     * Else -> show build logs.\n+     * Fetch the build logs only if the submission could not be build\n      * @param result\n      */\n     fetchBuildResults(result: Result | null): Observable<BuildLogEntry[] | null> {\n-        if ((result && result.successful) || (result && !result.successful && result.feedbacks && result.feedbacks.length)) {", "originalCommit": "733aefae9d2eca47ebaf74bc95a0ba67490fe5c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUxMTk4Ng==", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r476511986", "bodyText": "The whole feedback available logic is what caused the problems in the first place. I also think submission.isBuildFailed is a stronger check than result.successful. Added a check for the result. If no result is available we don't need to check for build logs.", "author": "kloessst", "createdAt": "2020-08-25T14:52:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwODI1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwOTA5Nw==", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r476309097", "bodyText": "should we handle the (edge) case that result?.submission is not available and then try to get the build logs anyway? In such a case it would be fine if the server throws a 403, because it should not happen. And in case the submission is not available (for whatever reason) and the build has failed, the user experience would be better", "author": "krusche", "createdAt": "2020-08-25T09:25:37Z", "path": "src/main/webapp/app/exercises/programming/shared/code-editor/build-output/code-editor-build-output.component.ts", "diffHunk": "@@ -182,15 +183,14 @@ export class CodeEditorBuildOutputComponent implements AfterViewInit, OnInit, On\n \n     /**\n      * Decides if the build log should be shown.\n-     * If All tests were successful or there is test feedback -> don't show build logs.\n-     * Else -> show build logs.\n+     * Fetch the build logs only if the submission could not be build\n      * @param result\n      */\n     fetchBuildResults(result: Result | null): Observable<BuildLogEntry[] | null> {\n-        if ((result && result.successful) || (result && !result.successful && result.feedbacks && result.feedbacks.length)) {\n-            return of([]);\n-        } else {\n+        if ((result?.submission as ProgrammingSubmission).buildFailed) {", "originalCommit": "733aefae9d2eca47ebaf74bc95a0ba67490fe5c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0NTc3NQ==", "url": "https://github.com/ls1intum/Artemis/pull/2046#discussion_r476445775", "bodyText": "Sounds good to me", "author": "kloessst", "createdAt": "2020-08-25T13:25:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwOTA5Nw=="}], "type": "inlineReview"}, {"oid": "0a6df8a05044a15d7634c05ece1539b9914d58b3", "url": "https://github.com/ls1intum/Artemis/commit/0a6df8a05044a15d7634c05ece1539b9914d58b3", "message": "Provide unique services for each code editor instance in the exam", "committedDate": "2020-08-25T13:44:49Z", "type": "commit"}, {"oid": "c984c8ca4039a1387f1f7f4008c76aa6db639c2f", "url": "https://github.com/ls1intum/Artemis/commit/c984c8ca4039a1387f1f7f4008c76aa6db639c2f", "message": "Check if the submission is available", "committedDate": "2020-08-25T14:04:37Z", "type": "commit"}, {"oid": "481ecc3d47717cdf339fa6634592210392a463e3", "url": "https://github.com/ls1intum/Artemis/commit/481ecc3d47717cdf339fa6634592210392a463e3", "message": "Add fallback to check", "committedDate": "2020-08-25T14:13:21Z", "type": "commit"}, {"oid": "cd009d0902d3dce1a580dab4baf117bcbc84d985", "url": "https://github.com/ls1intum/Artemis/commit/cd009d0902d3dce1a580dab4baf117bcbc84d985", "message": "Improve check", "committedDate": "2020-08-25T14:26:51Z", "type": "commit"}, {"oid": "a8b4c66779bba4c4828b39356f1940abe3c5a74c", "url": "https://github.com/ls1intum/Artemis/commit/a8b4c66779bba4c4828b39356f1940abe3c5a74c", "message": "Improve comment", "committedDate": "2020-08-25T14:41:46Z", "type": "commit"}, {"oid": "b4537e30d19bb4862059f9684cb6abb8c148d779", "url": "https://github.com/ls1intum/Artemis/commit/b4537e30d19bb4862059f9684cb6abb8c148d779", "message": "Improve check for orion", "committedDate": "2020-08-25T14:42:55Z", "type": "commit"}, {"oid": "32f2814a4108501c6d7d75a6d2044026baa3fe13", "url": "https://github.com/ls1intum/Artemis/commit/32f2814a4108501c6d7d75a6d2044026baa3fe13", "message": "Merge branch 'develop' into enhancement/build-logs-with-hidden-tests", "committedDate": "2020-08-25T14:52:54Z", "type": "commit"}, {"oid": "f4d489103e5749279d76cd1e42dfa38190e16d59", "url": "https://github.com/ls1intum/Artemis/commit/f4d489103e5749279d76cd1e42dfa38190e16d59", "message": "Fix orion build log tests", "committedDate": "2020-08-25T16:16:12Z", "type": "commit"}, {"oid": "791bf5a27ad112ce82e32de574a72e08a4e29ba0", "url": "https://github.com/ls1intum/Artemis/commit/791bf5a27ad112ce82e32de574a72e08a4e29ba0", "message": "Add missing imports", "committedDate": "2020-08-25T16:17:06Z", "type": "commit"}, {"oid": "01e70f0d1d9663d020a7788203e4b8c9be650620", "url": "https://github.com/ls1intum/Artemis/commit/01e70f0d1d9663d020a7788203e4b8c9be650620", "message": "Restructure orion test and build log tests", "committedDate": "2020-08-25T16:58:04Z", "type": "commit"}, {"oid": "9943391b4a847cfd05d5bf05baf2010b454c3ef5", "url": "https://github.com/ls1intum/Artemis/commit/9943391b4a847cfd05d5bf05baf2010b454c3ef5", "message": "Merge branch 'enhancement/build-logs-with-hidden-tests' of https://github.com/ls1intum/Artemis into enhancement/build-logs-with-hidden-tests", "committedDate": "2020-08-25T16:58:58Z", "type": "commit"}, {"oid": "ad387a7cdec5ac56e890b18b4ea6ce879a787982", "url": "https://github.com/ls1intum/Artemis/commit/ad387a7cdec5ac56e890b18b4ea6ce879a787982", "message": "Tests for result details", "committedDate": "2020-08-25T18:24:36Z", "type": "commit"}, {"oid": "0ae979bf26c6e47684a2f21ab199ee1e438aedd1", "url": "https://github.com/ls1intum/Artemis/commit/0ae979bf26c6e47684a2f21ab199ee1e438aedd1", "message": "Merge branch 'develop' into enhancement/build-logs-with-hidden-tests", "committedDate": "2020-08-25T18:27:29Z", "type": "commit"}, {"oid": "09a1e6a1663fe594bce0dd8c6ae70f73d071b182", "url": "https://github.com/ls1intum/Artemis/commit/09a1e6a1663fe594bce0dd8c6ae70f73d071b182", "message": "Add missing providers and testModule", "committedDate": "2020-08-25T22:50:42Z", "type": "commit"}, {"oid": "96941b8d6d51723edc0cee05873b4073d10b127e", "url": "https://github.com/ls1intum/Artemis/commit/96941b8d6d51723edc0cee05873b4073d10b127e", "message": "Merge branch 'develop' into enhancement/build-logs-with-hidden-tests", "committedDate": "2020-08-25T22:55:14Z", "type": "commit"}, {"oid": "d24a99ec7d88162f1658364f8783828c33522128", "url": "https://github.com/ls1intum/Artemis/commit/d24a99ec7d88162f1658364f8783828c33522128", "message": "Merge branch 'develop' into enhancement/build-logs-with-hidden-tests", "committedDate": "2020-08-26T09:23:55Z", "type": "commit"}, {"oid": "36b449cea0b2f7ab7db54de54f4d3f241bc5ae09", "url": "https://github.com/ls1intum/Artemis/commit/36b449cea0b2f7ab7db54de54f4d3f241bc5ae09", "message": "Fix/add code editor output tests", "committedDate": "2020-08-26T10:03:06Z", "type": "commit"}, {"oid": "4829e8f95c36f4a982df6cb3f4cba942944a3824", "url": "https://github.com/ls1intum/Artemis/commit/4829e8f95c36f4a982df6cb3f4cba942944a3824", "message": "Fix test", "committedDate": "2020-08-26T10:09:35Z", "type": "commit"}, {"oid": "853cba82ea5cf785d593e16ab1ace25852cc267b", "url": "https://github.com/ls1intum/Artemis/commit/853cba82ea5cf785d593e16ab1ace25852cc267b", "message": "Fix tests", "committedDate": "2020-08-26T10:28:09Z", "type": "commit"}, {"oid": "12ad7c9bb662f43801631a094be04aea9227e2f2", "url": "https://github.com/ls1intum/Artemis/commit/12ad7c9bb662f43801631a094be04aea9227e2f2", "message": "Remove unused import", "committedDate": "2020-08-26T10:30:41Z", "type": "commit"}, {"oid": "6865772f3c796759e435ba053802fda464f42ab2", "url": "https://github.com/ls1intum/Artemis/commit/6865772f3c796759e435ba053802fda464f42ab2", "message": "Remove unused import", "committedDate": "2020-08-26T12:28:51Z", "type": "commit"}, {"oid": "cb435290a22f2e5f4d56b2a2e04b84827c0c1a9e", "url": "https://github.com/ls1intum/Artemis/commit/cb435290a22f2e5f4d56b2a2e04b84827c0c1a9e", "message": "Merge branch 'develop' into enhancement/build-logs-with-hidden-tests", "committedDate": "2020-08-26T12:35:08Z", "type": "commit"}]}