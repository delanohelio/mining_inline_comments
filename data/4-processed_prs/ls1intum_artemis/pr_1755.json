{"pr_number": 1755, "pr_title": "[Exam] Hide unnecessary navbar elements in exam mode", "pr_createdAt": "2020-06-29T20:24:47Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1755", "timeline": [{"oid": "46964577272b0ed97c26a46469cb7da28c2ec0c1", "url": "https://github.com/ls1intum/Artemis/commit/46964577272b0ed97c26a46469cb7da28c2ec0c1", "message": "hide unnecessary navbar elements", "committedDate": "2020-06-29T20:17:17Z", "type": "commit"}, {"oid": "cd29b6c802bc8dad0907d8bb2813205a7028dd31", "url": "https://github.com/ls1intum/Artemis/commit/cd29b6c802bc8dad0907d8bb2813205a7028dd31", "message": "Merge branch 'develop' into exam-mode/client/hide-unnecessary-navbar-elements", "committedDate": "2020-06-29T20:40:50Z", "type": "commit"}, {"oid": "b96b972e8c9ae18e42707385680f5d78f83626a4", "url": "https://github.com/ls1intum/Artemis/commit/b96b972e8c9ae18e42707385680f5d78f83626a4", "message": "add check for management route", "committedDate": "2020-06-29T20:54:03Z", "type": "commit"}, {"oid": "1c5907e4d664c120344f0a9c407f506aea6c2441", "url": "https://github.com/ls1intum/Artemis/commit/1c5907e4d664c120344f0a9c407f506aea6c2441", "message": "add exam active check", "committedDate": "2020-06-29T21:57:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI4MDgwMw==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447280803", "bodyText": "you could also check if it is already over so that its only between start and due date.", "author": "filip-gregurevic", "createdAt": "2020-06-29T22:05:03Z", "path": "src/main/webapp/app/shared/layouts/navbar/navbar.component.ts", "diffHunk": "@@ -126,4 +158,11 @@ export class NavbarComponent implements OnInit, OnDestroy {\n             }\n         }\n     }\n+\n+    /**\n+     * check if exam already started\n+     */\n+    examHasStarted(exam: Exam): boolean {", "originalCommit": "1c5907e4d664c120344f0a9c407f506aea6c2441", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU1OTQ2OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447559469", "bodyText": "makes total sense, thanks \ud83d\udc4d", "author": "balazs-czopf", "createdAt": "2020-06-30T09:52:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI4MDgwMw=="}], "type": "inlineReview"}, {"oid": "136f3c4c1a916b7747177162fec729cd8b4a5396", "url": "https://github.com/ls1intum/Artemis/commit/136f3c4c1a916b7747177162fec729cd8b4a5396", "message": "fix undefined params issue", "committedDate": "2020-06-30T09:54:10Z", "type": "commit"}, {"oid": "93ec4ee5e4c3963800338d46490f69dae1807a89", "url": "https://github.com/ls1intum/Artemis/commit/93ec4ee5e4c3963800338d46490f69dae1807a89", "message": "Merge branch 'develop' into exam-mode/client/hide-unnecessary-navbar-elements", "committedDate": "2020-06-30T09:55:09Z", "type": "commit"}, {"oid": "04222cde93742a5082bd6d64fca9f5f6c9936c0c", "url": "https://github.com/ls1intum/Artemis/commit/04222cde93742a5082bd6d64fca9f5f6c9936c0c", "message": "a little bit of refactoring in my life", "committedDate": "2020-06-30T10:42:29Z", "type": "commit"}, {"oid": "f06c21d3d70052f0e3abc2a7154426f2e53b16d7", "url": "https://github.com/ls1intum/Artemis/commit/f06c21d3d70052f0e3abc2a7154426f2e53b16d7", "message": "a little bit of refactoring by my side", "committedDate": "2020-06-30T10:43:01Z", "type": "commit"}, {"oid": "65e4024587e46b2db1e7c162242f91cbe4d2553f", "url": "https://github.com/ls1intum/Artemis/commit/65e4024587e46b2db1e7c162242f91cbe4d2553f", "message": "Merge branch 'exam-mode/client/hide-unnecessary-navbar-elements' of https://github.com/ls1intum/Artemis into exam-mode/client/hide-unnecessary-navbar-elements", "committedDate": "2020-06-30T10:43:08Z", "type": "commit"}, {"oid": "c753ae6b91d8689ce97c9a2fe02bf70d62bae82f", "url": "https://github.com/ls1intum/Artemis/commit/c753ae6b91d8689ce97c9a2fe02bf70d62bae82f", "message": "a little bit of refactoring is all i need", "committedDate": "2020-06-30T10:50:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYxNzkzMg==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447617932", "bodyText": "Instead of passing it to each method you could just check this.exam since it is the object which you pass to them, otherwise the code looks good to me \ud83d\udc4d", "author": "filip-gregurevic", "createdAt": "2020-06-30T11:42:01Z", "path": "src/main/webapp/app/shared/layouts/navbar/navbar.component.ts", "diffHunk": "@@ -126,4 +154,25 @@ export class NavbarComponent implements OnInit, OnDestroy {\n             }\n         }\n     }\n+\n+    /**\n+     * check if exam already started\n+     */\n+    examHasStarted(exam?: Exam): boolean {\n+        return exam?.startDate ? exam.startDate.isBefore(this.serverDateService.now()) : false;\n+    }\n+\n+    /**\n+     * check if exam is over\n+     */\n+    examIsOver(exam?: Exam): boolean {\n+        return exam?.endDate ? exam.endDate.isBefore(this.serverDateService.now()) : true;\n+    }\n+\n+    /**\n+     * check if exam mode is active\n+     */\n+    examModeActive(exam?: Exam): boolean {", "originalCommit": "c753ae6b91d8689ce97c9a2fe02bf70d62bae82f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYyNTQ1Mg==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447625452", "bodyText": "done \ud83d\ude0a", "author": "balazs-czopf", "createdAt": "2020-06-30T11:56:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYxNzkzMg=="}], "type": "inlineReview"}, {"oid": "92e227db2a426b988588242406f977894227bb55", "url": "https://github.com/ls1intum/Artemis/commit/92e227db2a426b988588242406f977894227bb55", "message": "a little bit of refactoring is all i see", "committedDate": "2020-06-30T11:55:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcwMzY4Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447703683", "bodyText": "Just out of interest. Why do you put it on the a element and not on the li element?", "author": "stefanwaldhauser", "createdAt": "2020-06-30T13:57:43Z", "path": "src/main/webapp/app/shared/layouts/navbar/navbar.component.html", "diffHunk": "@@ -37,7 +37,7 @@\n                 routerLinkActive=\"active\"\n                 [routerLinkActiveOptions]=\"{ exact: true }\"\n             >\n-                <a class=\"guided-tour-course-admin nav-link\" routerLink=\"course-management\" (click)=\"collapseNavbar()\" id=\"course-admin-menu\">\n+                <a *ngIf=\"!examModeActive()\" class=\"guided-tour-course-admin nav-link\" routerLink=\"course-management\" (click)=\"collapseNavbar()\" id=\"course-admin-menu\">", "originalCommit": "92e227db2a426b988588242406f977894227bb55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcxNTk1MA==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447715950", "bodyText": "because Angular doesn\u00b4t like two *-attributes on the same element \ud83d\ude04", "author": "balazs-czopf", "createdAt": "2020-06-30T14:13:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcwMzY4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcwODA5Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447708096", "bodyText": "I am not an Angular Expert but this whole part seems extremely brittle. Anybody got an idea how to do this whole part in a more robust way than regexing and splitting?", "author": "stefanwaldhauser", "createdAt": "2020-06-30T14:03:20Z", "path": "src/main/webapp/app/shared/layouts/navbar/navbar.component.ts", "diffHunk": "@@ -64,12 +73,31 @@ export class NavbarComponent implements OnInit, OnDestroy {\n             .getAuthenticationState()\n             .pipe(tap((user: User) => (this.currAccount = user)))\n             .subscribe();\n+\n+        this.routerEventSubscription = this.router.events.subscribe((event) => {\n+            if (event instanceof NavigationEnd) {\n+                this.exam = undefined;\n+                const examRoute = new RegExp('exams/[0-9]');\n+                if (examRoute.test(event.url) && !event.url.includes('management')) {", "originalCommit": "92e227db2a426b988588242406f977894227bb55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcxOTk1MA==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447719950", "bodyText": "usually you can access the parameters by using\nthis.route.params.subscribe((params) => { courseId = params['courseId']); examId = params['examId']); });\nbut that didn\u00b4t work for me, this way both IDs remained undefined, no matter what..\npossibly due to being inside the router event subscription, idk..", "author": "balazs-czopf", "createdAt": "2020-06-30T14:18:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcwODA5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgxNTEzMw==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447815133", "bodyText": "Following this Article How To Get Route Path Parameters In Non-Routed Angular Components \ud83e\udd80. this should be possible in a slightly nicer way.", "author": "jpbernius", "createdAt": "2020-06-30T16:24:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcwODA5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE3NzU1Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r448177556", "bodyText": "this works, thanks \ud83d\ude01", "author": "balazs-czopf", "createdAt": "2020-07-01T07:43:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcwODA5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcwOTU2OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447709569", "bodyText": "Activated Route is defined but never used", "author": "stefanwaldhauser", "createdAt": "2020-06-30T14:05:19Z", "path": "src/main/webapp/app/shared/layouts/navbar/navbar.component.ts", "diffHunk": "@@ -15,6 +15,10 @@ import { ParticipationWebsocketService } from 'app/overview/participation-websoc\n import { AccountService } from 'app/core/auth/account.service';\n import { ProfileService } from 'app/shared/layouts/profiles/profile.service';\n import { LoginService } from 'app/core/login/login.service';\n+import { Router, NavigationEnd, ActivatedRoute } from '@angular/router';", "originalCommit": "92e227db2a426b988588242406f977894227bb55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcxNzA0NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447717045", "bodyText": "good catch, thanks \ud83d\udc4d", "author": "balazs-czopf", "createdAt": "2020-06-30T14:15:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzcwOTU2OQ=="}], "type": "inlineReview"}, {"oid": "80bf4f974e6a81896a376c06780d8220de1f8997", "url": "https://github.com/ls1intum/Artemis/commit/80bf4f974e6a81896a376c06780d8220de1f8997", "message": "remove unused import", "committedDate": "2020-06-30T14:21:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgwODg2NA==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r447808864", "bodyText": "Can this be done in one check? (something like this?)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * check if exam already started\n          \n          \n            \n                 */\n          \n          \n            \n                examHasStarted(): boolean {\n          \n          \n            \n                    return this.exam?.startDate ? this.exam.startDate.isBefore(this.serverDateService.now()) : false;\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * check if exam is over\n          \n          \n            \n                 */\n          \n          \n            \n                examIsOver(): boolean {\n          \n          \n            \n                    return this.exam?.endDate ? this.exam.endDate.isBefore(this.serverDateService.now()) : true;\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * check if exam mode is active\n          \n          \n            \n                 */\n          \n          \n            \n                examModeActive(): boolean {\n          \n          \n            \n                    return this.examHasStarted() && !this.examIsOver();\n          \n          \n            \n                /**\n          \n          \n            \n                 * check if exam mode is active\n          \n          \n            \n                 */\n          \n          \n            \n                get examModeActive(): boolean {\n          \n          \n            \n                    if (this.exam && this.exam.startDate && this.exam.endDate) {\n          \n          \n            \n                        return this.serverDateService.now().isBetween(this.exam.startDate, this.exam.endDate);\n          \n          \n            \n                    }\n          \n          \n            \n                    return false;\n          \n          \n            \n                }\n          \n      \n    \n    \n  \n\n(Also, this could maybe be a getter.)", "author": "jpbernius", "createdAt": "2020-06-30T16:16:41Z", "path": "src/main/webapp/app/shared/layouts/navbar/navbar.component.ts", "diffHunk": "@@ -126,4 +154,25 @@ export class NavbarComponent implements OnInit, OnDestroy {\n             }\n         }\n     }\n+\n+    /**\n+     * check if exam already started\n+     */\n+    examHasStarted(): boolean {\n+        return this.exam?.startDate ? this.exam.startDate.isBefore(this.serverDateService.now()) : false;\n+    }\n+\n+    /**\n+     * check if exam is over\n+     */\n+    examIsOver(): boolean {\n+        return this.exam?.endDate ? this.exam.endDate.isBefore(this.serverDateService.now()) : true;\n+    }\n+\n+    /**\n+     * check if exam mode is active\n+     */\n+    examModeActive(): boolean {\n+        return this.examHasStarted() && !this.examIsOver();", "originalCommit": "80bf4f974e6a81896a376c06780d8220de1f8997", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE4MDA0MA==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r448180040", "bodyText": "yeah sure, this seems really good, thanks :)", "author": "balazs-czopf", "createdAt": "2020-07-01T07:48:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgwODg2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE4ODY2Mg==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r448188662", "bodyText": "the getter part didn\u00b4t work though", "author": "balazs-czopf", "createdAt": "2020-07-01T08:04:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgwODg2NA=="}], "type": "inlineReview"}, {"oid": "66304534093453077cd5184300629232f4529ea2", "url": "https://github.com/ls1intum/Artemis/commit/66304534093453077cd5184300629232f4529ea2", "message": "Merge branch 'develop' into exam-mode/client/hide-unnecessary-navbar-elements", "committedDate": "2020-07-01T06:55:04Z", "type": "commit"}, {"oid": "67d9bac9fe71323983902c896758fa310f6d4abb", "url": "https://github.com/ls1intum/Artemis/commit/67d9bac9fe71323983902c896758fa310f6d4abb", "message": "refactor methods", "committedDate": "2020-07-01T08:58:08Z", "type": "commit"}, {"oid": "f5ddeffd45dd401afd318315e763649ce08e4572", "url": "https://github.com/ls1intum/Artemis/commit/f5ddeffd45dd401afd318315e763649ce08e4572", "message": "fix elements not being hidden on reload", "committedDate": "2020-07-01T09:35:01Z", "type": "commit"}, {"oid": "b6b2566811948e91c1d651958f949c65f2626cbe", "url": "https://github.com/ls1intum/Artemis/commit/b6b2566811948e91c1d651958f949c65f2626cbe", "message": "Merge branch 'develop' into exam-mode/client/hide-unnecessary-navbar-elements", "committedDate": "2020-07-01T09:36:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU5Mjc2Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r448592767", "bodyText": "Please do not load the exam from the server in the navbar! This is a really bad idea!!!\nAlso the method name is confusing, because the outer method only subscribes for router changes.\nOnly the inner one actually loads the exam, so I suggest to extract the inner method and rename the outer one!\nI would suggest that we add some kind of examService that holds the currently visible exams (they are e.g. loaded by the courses for dashboard REST call or when students navigate into the exam. This could then notify the navbar, when an exam is available. The navbar then does not need to load it from the server!", "author": "krusche", "createdAt": "2020-07-01T20:14:33Z", "path": "src/main/webapp/app/shared/layouts/navbar/navbar.component.ts", "diffHunk": "@@ -126,4 +141,40 @@ export class NavbarComponent implements OnInit, OnDestroy {\n             }\n         }\n     }\n+\n+    loadExamIfAvailable() {\n+        this.routerEventSubscription = this.router.events.pipe(filter((event: RouterEvent) => event instanceof NavigationEnd)).subscribe((event) => {\n+            this.exam = undefined;\n+            if (event.url.includes('exams') && !event.url.includes('management')) {\n+                const routePathParams = of(event).pipe(\n+                    map(() => this.route.root),\n+                    map((root) => root.firstChild),\n+                    switchMap((firstChild) => {\n+                        if (firstChild) {\n+                            return firstChild?.paramMap.pipe(map((paramMap) => [paramMap.get('courseId'), paramMap.get('examId')]));\n+                        } else {\n+                            return of(null);\n+                        }\n+                    }),\n+                );\n+                routePathParams.subscribe((param) => {\n+                    if (param !== null) {\n+                        if (param[0] !== null && param[1] !== null) {\n+                            this.examParticipationService.loadExam(+param[0], +param[1]).subscribe((loadedExam) => (this.exam = loadedExam));", "originalCommit": "b6b2566811948e91c1d651958f949c65f2626cbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwOTA2OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1755#discussion_r449209069", "bodyText": "Refactored the code according to your suggestions \ud83d\ude0a\nPlease let me know whether the changes meet your expectations", "author": "balazs-czopf", "createdAt": "2020-07-02T18:52:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU5Mjc2Nw=="}], "type": "inlineReview"}, {"oid": "3e264fbbc0ef43e6eec4ff21ca8fc22f34967429", "url": "https://github.com/ls1intum/Artemis/commit/3e264fbbc0ef43e6eec4ff21ca8fc22f34967429", "message": "refactoring once again", "committedDate": "2020-07-02T18:40:46Z", "type": "commit"}, {"oid": "473bb64d92d393d03ed58e8a8a3bb50287479605", "url": "https://github.com/ls1intum/Artemis/commit/473bb64d92d393d03ed58e8a8a3bb50287479605", "message": "Merge branch 'develop' into exam-mode/client/hide-unnecessary-navbar-elements", "committedDate": "2020-07-02T18:44:39Z", "type": "commit"}, {"oid": "cd66756a6261342102144d5f6d6e46d1c93b56c4", "url": "https://github.com/ls1intum/Artemis/commit/cd66756a6261342102144d5f6d6e46d1c93b56c4", "message": "Merge branch 'develop' into exam-mode/client/hide-unnecessary-navbar-elements", "committedDate": "2020-07-02T21:18:13Z", "type": "commit"}]}