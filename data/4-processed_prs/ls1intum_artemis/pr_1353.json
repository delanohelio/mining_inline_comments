{"pr_number": 1353, "pr_title": "Integration test/test repository resource", "pr_createdAt": "2020-04-26T17:26:04Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1353", "timeline": [{"oid": "3b9629d8002cd4dc99e5a6e6645721e66444522b", "url": "https://github.com/ls1intum/Artemis/commit/3b9629d8002cd4dc99e5a6e6645721e66444522b", "message": "added testcases for getFile, getFiles and createFile", "committedDate": "2020-04-24T20:28:55Z", "type": "commit"}, {"oid": "8421ceddd2ee476056f434deb8709d1fb1c7e037", "url": "https://github.com/ls1intum/Artemis/commit/8421ceddd2ee476056f434deb8709d1fb1c7e037", "message": "added testcases for deleteFile and createFolder", "committedDate": "2020-04-25T10:31:59Z", "type": "commit"}, {"oid": "c465eb1c4b205c236f6ff5706f6f5f6aab2d3e4c", "url": "https://github.com/ls1intum/Artemis/commit/c465eb1c4b205c236f6ff5706f6f5f6aab2d3e4c", "message": "added testcase for getStatus", "committedDate": "2020-04-25T10:50:29Z", "type": "commit"}, {"oid": "731530966ca82487da3223a17e46317ae90db7b5", "url": "https://github.com/ls1intum/Artemis/commit/731530966ca82487da3223a17e46317ae90db7b5", "message": "added testcase for commitChanges", "committedDate": "2020-04-25T11:35:51Z", "type": "commit"}, {"oid": "3fdf54aa0b223613b73e2e4f22fb9f875df8d0ab", "url": "https://github.com/ls1intum/Artemis/commit/3fdf54aa0b223613b73e2e4f22fb9f875df8d0ab", "message": "added testcase for renameFile and pullChanges", "committedDate": "2020-04-25T17:15:20Z", "type": "commit"}, {"oid": "4a59d54775b08f5246ba7e4b8ba3db9ddd061b79", "url": "https://github.com/ls1intum/Artemis/commit/4a59d54775b08f5246ba7e4b8ba3db9ddd061b79", "message": "code refactoring and class extraction", "committedDate": "2020-04-26T11:01:34Z", "type": "commit"}, {"oid": "02c27fb44ef3555c1faad9f189b48069a6e66bc0", "url": "https://github.com/ls1intum/Artemis/commit/02c27fb44ef3555c1faad9f189b48069a6e66bc0", "message": "added comments", "committedDate": "2020-04-26T14:47:46Z", "type": "commit"}, {"oid": "7e38651b55c4cd6b1bb9562d073726e046a133ae", "url": "https://github.com/ls1intum/Artemis/commit/7e38651b55c4cd6b1bb9562d073726e046a133ae", "message": "Merge branch 'develop' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-04-26T14:50:08Z", "type": "commit"}, {"oid": "4f3cc70b5fd0b3278d5bcabee01166a5f746ef16", "url": "https://github.com/ls1intum/Artemis/commit/4f3cc70b5fd0b3278d5bcabee01166a5f746ef16", "message": "refactored code(renaming and extract variable)", "committedDate": "2020-04-27T12:20:14Z", "type": "commit"}, {"oid": "2f1f728ef7fc66c5bf8f666de64b5cea051b4cc9", "url": "https://github.com/ls1intum/Artemis/commit/2f1f728ef7fc66c5bf8f666de64b5cea051b4cc9", "message": "removed not needed variable", "committedDate": "2020-04-27T12:34:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0ODkxNw==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r415948917", "bodyText": "Maybe use File.separator instead of /.", "author": "sleiss", "createdAt": "2020-04-27T16:10:50Z", "path": "src/test/java/de/tum/in/www1/artemis/TestRepositoryResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,171 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.reset;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.time.ZonedDateTime;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.util.LinkedMultiValueMap;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.FileType;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+import de.tum.in.www1.artemis.repository.ProgrammingExerciseRepository;\n+import de.tum.in.www1.artemis.util.*;\n+import de.tum.in.www1.artemis.web.rest.dto.FileMove;\n+import de.tum.in.www1.artemis.web.rest.dto.RepositoryStatusDTO;\n+\n+public class TestRepositoryResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    private final String testRepoBaseUrl = \"/api/test-repository/\";\n+\n+    @Autowired\n+    private DatabaseUtilService database;\n+\n+    @Autowired\n+    private RequestUtilService request;\n+\n+    @Autowired\n+    ProgrammingExerciseRepository programmingExerciseRepository;\n+\n+    private Course course;\n+\n+    private ProgrammingExercise exercise;\n+\n+    private String currentLocalFileName = \"currentFileName\";\n+\n+    private String currentLocalFileContent = \"testContent\";\n+\n+    private String newLocalFileName = \"newFileName\";\n+\n+    LocalRepository testRepo = new LocalRepository();\n+\n+    @BeforeEach\n+    public void setup() throws Exception {\n+        database.addUsers(0, 0, 1);\n+        course = database.addEmptyCourse();\n+        exercise = ModelFactory.generateProgrammingExercise(ZonedDateTime.now().minusDays(1), ZonedDateTime.now().plusDays(7), course);\n+        testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n+\n+        // add file to the repository folder\n+        Path filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName);\n+        var file = Files.createFile(filePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(file, currentLocalFileContent);\n+\n+        var testRepoUrl = new GitUtilService.MockFileRepositoryUrl(testRepo.originRepoFile);\n+        exercise.setTestRepositoryUrl(testRepoUrl.toString());\n+        doReturn(gitService.getRepositoryByLocalPath(testRepo.localRepoFile.toPath())).when(gitService).getOrCheckoutRepository(testRepoUrl.getURL(), true);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() throws IOException {\n+        database.resetDatabase();\n+        reset(gitService);\n+        LocalRepository.resetLocalRepo(testRepo);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFiles() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        var files = request.getMap(testRepoBaseUrl + exercise.getId() + \"/files\", HttpStatus.OK, String.class, FileType.class);\n+        assertThat(files).isNotEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        params.add(\"file\", currentLocalFileName);\n+        var file = request.get(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, byte[].class, params);\n+        assertThat(file).isNotEmpty();\n+        assertThat(new String(file)).isEqualTo(currentLocalFileContent);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isFalse();\n+        params.add(\"file\", \"newFile\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isTrue();", "originalCommit": "2f1f728ef7fc66c5bf8f666de64b5cea051b4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA3ODkyMA==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r416078920", "bodyText": "I tested it with the File.separator, it worked but I think the readability decreases with the usage of the File.separator. Therefore, i would keep the current implementation.", "author": "F4lka", "createdAt": "2020-04-27T19:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0ODkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0OTMwOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r415949309", "bodyText": "Please check that newFile is a file and not a folder.", "author": "sleiss", "createdAt": "2020-04-27T16:11:18Z", "path": "src/test/java/de/tum/in/www1/artemis/TestRepositoryResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,171 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.reset;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.time.ZonedDateTime;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.util.LinkedMultiValueMap;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.FileType;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+import de.tum.in.www1.artemis.repository.ProgrammingExerciseRepository;\n+import de.tum.in.www1.artemis.util.*;\n+import de.tum.in.www1.artemis.web.rest.dto.FileMove;\n+import de.tum.in.www1.artemis.web.rest.dto.RepositoryStatusDTO;\n+\n+public class TestRepositoryResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    private final String testRepoBaseUrl = \"/api/test-repository/\";\n+\n+    @Autowired\n+    private DatabaseUtilService database;\n+\n+    @Autowired\n+    private RequestUtilService request;\n+\n+    @Autowired\n+    ProgrammingExerciseRepository programmingExerciseRepository;\n+\n+    private Course course;\n+\n+    private ProgrammingExercise exercise;\n+\n+    private String currentLocalFileName = \"currentFileName\";\n+\n+    private String currentLocalFileContent = \"testContent\";\n+\n+    private String newLocalFileName = \"newFileName\";\n+\n+    LocalRepository testRepo = new LocalRepository();\n+\n+    @BeforeEach\n+    public void setup() throws Exception {\n+        database.addUsers(0, 0, 1);\n+        course = database.addEmptyCourse();\n+        exercise = ModelFactory.generateProgrammingExercise(ZonedDateTime.now().minusDays(1), ZonedDateTime.now().plusDays(7), course);\n+        testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n+\n+        // add file to the repository folder\n+        Path filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName);\n+        var file = Files.createFile(filePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(file, currentLocalFileContent);\n+\n+        var testRepoUrl = new GitUtilService.MockFileRepositoryUrl(testRepo.originRepoFile);\n+        exercise.setTestRepositoryUrl(testRepoUrl.toString());\n+        doReturn(gitService.getRepositoryByLocalPath(testRepo.localRepoFile.toPath())).when(gitService).getOrCheckoutRepository(testRepoUrl.getURL(), true);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() throws IOException {\n+        database.resetDatabase();\n+        reset(gitService);\n+        LocalRepository.resetLocalRepo(testRepo);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFiles() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        var files = request.getMap(testRepoBaseUrl + exercise.getId() + \"/files\", HttpStatus.OK, String.class, FileType.class);\n+        assertThat(files).isNotEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        params.add(\"file\", currentLocalFileName);\n+        var file = request.get(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, byte[].class, params);\n+        assertThat(file).isNotEmpty();\n+        assertThat(new String(file)).isEqualTo(currentLocalFileContent);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isFalse();\n+        params.add(\"file\", \"newFile\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isTrue();", "originalCommit": "2f1f728ef7fc66c5bf8f666de64b5cea051b4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA3NjU4OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r416076589", "bodyText": "i added a check for that", "author": "F4lka", "createdAt": "2020-04-27T19:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0OTMwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0OTU3OA==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r415949578", "bodyText": "Please check that newFolder is a folder and not a file.", "author": "sleiss", "createdAt": "2020-04-27T16:11:31Z", "path": "src/test/java/de/tum/in/www1/artemis/TestRepositoryResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,171 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.reset;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.time.ZonedDateTime;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.util.LinkedMultiValueMap;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.FileType;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+import de.tum.in.www1.artemis.repository.ProgrammingExerciseRepository;\n+import de.tum.in.www1.artemis.util.*;\n+import de.tum.in.www1.artemis.web.rest.dto.FileMove;\n+import de.tum.in.www1.artemis.web.rest.dto.RepositoryStatusDTO;\n+\n+public class TestRepositoryResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    private final String testRepoBaseUrl = \"/api/test-repository/\";\n+\n+    @Autowired\n+    private DatabaseUtilService database;\n+\n+    @Autowired\n+    private RequestUtilService request;\n+\n+    @Autowired\n+    ProgrammingExerciseRepository programmingExerciseRepository;\n+\n+    private Course course;\n+\n+    private ProgrammingExercise exercise;\n+\n+    private String currentLocalFileName = \"currentFileName\";\n+\n+    private String currentLocalFileContent = \"testContent\";\n+\n+    private String newLocalFileName = \"newFileName\";\n+\n+    LocalRepository testRepo = new LocalRepository();\n+\n+    @BeforeEach\n+    public void setup() throws Exception {\n+        database.addUsers(0, 0, 1);\n+        course = database.addEmptyCourse();\n+        exercise = ModelFactory.generateProgrammingExercise(ZonedDateTime.now().minusDays(1), ZonedDateTime.now().plusDays(7), course);\n+        testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n+\n+        // add file to the repository folder\n+        Path filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName);\n+        var file = Files.createFile(filePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(file, currentLocalFileContent);\n+\n+        var testRepoUrl = new GitUtilService.MockFileRepositoryUrl(testRepo.originRepoFile);\n+        exercise.setTestRepositoryUrl(testRepoUrl.toString());\n+        doReturn(gitService.getRepositoryByLocalPath(testRepo.localRepoFile.toPath())).when(gitService).getOrCheckoutRepository(testRepoUrl.getURL(), true);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() throws IOException {\n+        database.resetDatabase();\n+        reset(gitService);\n+        LocalRepository.resetLocalRepo(testRepo);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFiles() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        var files = request.getMap(testRepoBaseUrl + exercise.getId() + \"/files\", HttpStatus.OK, String.class, FileType.class);\n+        assertThat(files).isNotEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        params.add(\"file\", currentLocalFileName);\n+        var file = request.get(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, byte[].class, params);\n+        assertThat(file).isNotEmpty();\n+        assertThat(new String(file)).isEqualTo(currentLocalFileContent);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isFalse();\n+        params.add(\"file\", \"newFile\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFolder() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isFalse();\n+        params.add(\"folder\", \"newFolder\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/folder\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isTrue();", "originalCommit": "2f1f728ef7fc66c5bf8f666de64b5cea051b4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA3NjY1NA==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r416076654", "bodyText": "i added a check for that", "author": "F4lka", "createdAt": "2020-04-27T19:08:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0OTU3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk1MDczOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r415950739", "bodyText": "Maybe also test renaming a folder.", "author": "sleiss", "createdAt": "2020-04-27T16:13:04Z", "path": "src/test/java/de/tum/in/www1/artemis/TestRepositoryResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,171 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.reset;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.time.ZonedDateTime;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.util.LinkedMultiValueMap;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.FileType;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+import de.tum.in.www1.artemis.repository.ProgrammingExerciseRepository;\n+import de.tum.in.www1.artemis.util.*;\n+import de.tum.in.www1.artemis.web.rest.dto.FileMove;\n+import de.tum.in.www1.artemis.web.rest.dto.RepositoryStatusDTO;\n+\n+public class TestRepositoryResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    private final String testRepoBaseUrl = \"/api/test-repository/\";\n+\n+    @Autowired\n+    private DatabaseUtilService database;\n+\n+    @Autowired\n+    private RequestUtilService request;\n+\n+    @Autowired\n+    ProgrammingExerciseRepository programmingExerciseRepository;\n+\n+    private Course course;\n+\n+    private ProgrammingExercise exercise;\n+\n+    private String currentLocalFileName = \"currentFileName\";\n+\n+    private String currentLocalFileContent = \"testContent\";\n+\n+    private String newLocalFileName = \"newFileName\";\n+\n+    LocalRepository testRepo = new LocalRepository();\n+\n+    @BeforeEach\n+    public void setup() throws Exception {\n+        database.addUsers(0, 0, 1);\n+        course = database.addEmptyCourse();\n+        exercise = ModelFactory.generateProgrammingExercise(ZonedDateTime.now().minusDays(1), ZonedDateTime.now().plusDays(7), course);\n+        testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n+\n+        // add file to the repository folder\n+        Path filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName);\n+        var file = Files.createFile(filePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(file, currentLocalFileContent);\n+\n+        var testRepoUrl = new GitUtilService.MockFileRepositoryUrl(testRepo.originRepoFile);\n+        exercise.setTestRepositoryUrl(testRepoUrl.toString());\n+        doReturn(gitService.getRepositoryByLocalPath(testRepo.localRepoFile.toPath())).when(gitService).getOrCheckoutRepository(testRepoUrl.getURL(), true);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() throws IOException {\n+        database.resetDatabase();\n+        reset(gitService);\n+        LocalRepository.resetLocalRepo(testRepo);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFiles() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        var files = request.getMap(testRepoBaseUrl + exercise.getId() + \"/files\", HttpStatus.OK, String.class, FileType.class);\n+        assertThat(files).isNotEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        params.add(\"file\", currentLocalFileName);\n+        var file = request.get(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, byte[].class, params);\n+        assertThat(file).isNotEmpty();\n+        assertThat(new String(file)).isEqualTo(currentLocalFileContent);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isFalse();\n+        params.add(\"file\", \"newFile\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFolder() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isFalse();\n+        params.add(\"folder\", \"newFolder\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/folder\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldRenameFile() throws Exception {", "originalCommit": "2f1f728ef7fc66c5bf8f666de64b5cea051b4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA3MjA2Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r416072067", "bodyText": "i added a test case for renaming a folder", "author": "F4lka", "createdAt": "2020-04-27T19:01:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk1MDczOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk1MTk5NA==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r415951994", "bodyText": "There is no assert here, is this correct?", "author": "sleiss", "createdAt": "2020-04-27T16:14:43Z", "path": "src/test/java/de/tum/in/www1/artemis/TestRepositoryResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,171 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.reset;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.time.ZonedDateTime;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.util.LinkedMultiValueMap;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.FileType;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+import de.tum.in.www1.artemis.repository.ProgrammingExerciseRepository;\n+import de.tum.in.www1.artemis.util.*;\n+import de.tum.in.www1.artemis.web.rest.dto.FileMove;\n+import de.tum.in.www1.artemis.web.rest.dto.RepositoryStatusDTO;\n+\n+public class TestRepositoryResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    private final String testRepoBaseUrl = \"/api/test-repository/\";\n+\n+    @Autowired\n+    private DatabaseUtilService database;\n+\n+    @Autowired\n+    private RequestUtilService request;\n+\n+    @Autowired\n+    ProgrammingExerciseRepository programmingExerciseRepository;\n+\n+    private Course course;\n+\n+    private ProgrammingExercise exercise;\n+\n+    private String currentLocalFileName = \"currentFileName\";\n+\n+    private String currentLocalFileContent = \"testContent\";\n+\n+    private String newLocalFileName = \"newFileName\";\n+\n+    LocalRepository testRepo = new LocalRepository();\n+\n+    @BeforeEach\n+    public void setup() throws Exception {\n+        database.addUsers(0, 0, 1);\n+        course = database.addEmptyCourse();\n+        exercise = ModelFactory.generateProgrammingExercise(ZonedDateTime.now().minusDays(1), ZonedDateTime.now().plusDays(7), course);\n+        testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n+\n+        // add file to the repository folder\n+        Path filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName);\n+        var file = Files.createFile(filePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(file, currentLocalFileContent);\n+\n+        var testRepoUrl = new GitUtilService.MockFileRepositoryUrl(testRepo.originRepoFile);\n+        exercise.setTestRepositoryUrl(testRepoUrl.toString());\n+        doReturn(gitService.getRepositoryByLocalPath(testRepo.localRepoFile.toPath())).when(gitService).getOrCheckoutRepository(testRepoUrl.getURL(), true);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() throws IOException {\n+        database.resetDatabase();\n+        reset(gitService);\n+        LocalRepository.resetLocalRepo(testRepo);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFiles() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        var files = request.getMap(testRepoBaseUrl + exercise.getId() + \"/files\", HttpStatus.OK, String.class, FileType.class);\n+        assertThat(files).isNotEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        params.add(\"file\", currentLocalFileName);\n+        var file = request.get(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, byte[].class, params);\n+        assertThat(file).isNotEmpty();\n+        assertThat(new String(file)).isEqualTo(currentLocalFileContent);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isFalse();\n+        params.add(\"file\", \"newFile\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFolder() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isFalse();\n+        params.add(\"folder\", \"newFolder\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/folder\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldRenameFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isTrue();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFileName))).isFalse();\n+        FileMove fileMove = new FileMove();\n+        fileMove.setCurrentFilePath(currentLocalFileName);\n+        fileMove.setNewFilename(newLocalFileName);\n+        request.postWithoutLocation(testRepoBaseUrl + exercise.getId() + \"/rename-file\", fileMove, HttpStatus.OK, null);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isFalse();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFileName))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldDeleteFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isTrue();\n+        params.add(\"file\", currentLocalFileName);\n+        request.delete(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isFalse();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCommitChanges() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        var receivedStatusBeforeCommit = request.get(testRepoBaseUrl + exercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatusBeforeCommit.repositoryStatus.toString()).isEqualTo(\"UNCOMMITTED_CHANGES\");\n+        request.postWithoutLocation(testRepoBaseUrl + exercise.getId() + \"/commit\", null, HttpStatus.OK, null);\n+        var receivedStatusAfterCommit = request.get(testRepoBaseUrl + exercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatusAfterCommit.repositoryStatus.toString()).isEqualTo(\"CLEAN\");\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldPullChanges() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        request.get(testRepoBaseUrl + exercise.getId() + \"/pull\", HttpStatus.OK, Void.class);", "originalCommit": "2f1f728ef7fc66c5bf8f666de64b5cea051b4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxMDI0OA==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r419710248", "bodyText": "i added an assert to this method", "author": "F4lka", "createdAt": "2020-05-04T20:32:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk1MTk5NA=="}], "type": "inlineReview"}, {"oid": "d0c67adc74d4a6731c2bfa65b0393dfcf3d11bf6", "url": "https://github.com/ls1intum/Artemis/commit/d0c67adc74d4a6731c2bfa65b0393dfcf3d11bf6", "message": "Merge branch 'develop' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-04-27T17:04:04Z", "type": "commit"}, {"oid": "effb05bd56e945a1b4f7e36f2b79ebb52c699cc7", "url": "https://github.com/ls1intum/Artemis/commit/effb05bd56e945a1b4f7e36f2b79ebb52c699cc7", "message": "added testcase for renamefolder", "committedDate": "2020-04-27T18:58:10Z", "type": "commit"}, {"oid": "ffa1d77d88de2371f41db4028725529772665a04", "url": "https://github.com/ls1intum/Artemis/commit/ffa1d77d88de2371f41db4028725529772665a04", "message": "Merge remote-tracking branch 'origin/IntegrationTest/TestRepositoryResource' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-04-27T18:58:38Z", "type": "commit"}, {"oid": "19256b6faa4a5bca01a93ddd92974d62584015a2", "url": "https://github.com/ls1intum/Artemis/commit/19256b6faa4a5bca01a93ddd92974d62584015a2", "message": "added checks, to check if the new created file or directory is actually the expected file type", "committedDate": "2020-04-27T19:07:43Z", "type": "commit"}, {"oid": "71f104e30fe8f8f4af33e19d0ed3004eeeabf878", "url": "https://github.com/ls1intum/Artemis/commit/71f104e30fe8f8f4af33e19d0ed3004eeeabf878", "message": "added test case resetToLastCommit", "committedDate": "2020-04-27T19:31:09Z", "type": "commit"}, {"oid": "573875e51c34b9ec9bef49948ac6d282e708c960", "url": "https://github.com/ls1intum/Artemis/commit/573875e51c34b9ec9bef49948ac6d282e708c960", "message": "adapted comments", "committedDate": "2020-04-28T11:52:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYzOTg4Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r416639883", "bodyText": "first create some \"local\" changes without committing them (in the best case, use the online code editor to add and modify files). If this is not possible, then directly manipulate the local git\nThen create a merge conflict by changing the same files in the originGit\nTODO: check if the Artemis server detects the conflict\nThen invoke reset\nThen check, that all local changes are removed and there is no conflict any more", "author": "krusche", "createdAt": "2020-04-28T14:03:53Z", "path": "src/test/java/de/tum/in/www1/artemis/TestRepositoryResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,200 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.reset;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.time.ZonedDateTime;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.util.LinkedMultiValueMap;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.FileType;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+import de.tum.in.www1.artemis.repository.ProgrammingExerciseRepository;\n+import de.tum.in.www1.artemis.util.*;\n+import de.tum.in.www1.artemis.web.rest.dto.FileMove;\n+import de.tum.in.www1.artemis.web.rest.dto.RepositoryStatusDTO;\n+\n+public class TestRepositoryResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    private final String testRepoBaseUrl = \"/api/test-repository/\";\n+\n+    @Autowired\n+    private DatabaseUtilService database;\n+\n+    @Autowired\n+    private RequestUtilService request;\n+\n+    @Autowired\n+    ProgrammingExerciseRepository programmingExerciseRepository;\n+\n+    private Course course;\n+\n+    private ProgrammingExercise exercise;\n+\n+    private String currentLocalFileName = \"currentFileName\";\n+\n+    private String currentLocalFileContent = \"testContent\";\n+\n+    private String currentLocalFolderName = \"currentFolderName\";\n+\n+    private String newLocalFileName = \"newFileName\";\n+\n+    private String newLocalFolderName = \"newFolderName\";\n+\n+    LocalRepository testRepo = new LocalRepository();\n+\n+    @BeforeEach\n+    public void setup() throws Exception {\n+        database.addUsers(0, 0, 1);\n+        course = database.addEmptyCourse();\n+        exercise = ModelFactory.generateProgrammingExercise(ZonedDateTime.now().minusDays(1), ZonedDateTime.now().plusDays(7), course);\n+        testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n+\n+        // add file to the repository folder\n+        Path filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName);\n+        var file = Files.createFile(filePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(file, currentLocalFileContent);\n+\n+        // add folder to the repository folder\n+        filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFolderName);\n+        var folder = Files.createDirectory(filePath).toFile();\n+\n+        var testRepoUrl = new GitUtilService.MockFileRepositoryUrl(testRepo.originRepoFile);\n+        exercise.setTestRepositoryUrl(testRepoUrl.toString());\n+        doReturn(gitService.getRepositoryByLocalPath(testRepo.localRepoFile.toPath())).when(gitService).getOrCheckoutRepository(testRepoUrl.getURL(), true);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() throws IOException {\n+        database.resetDatabase();\n+        reset(gitService);\n+        LocalRepository.resetLocalRepo(testRepo);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFiles() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        var files = request.getMap(testRepoBaseUrl + exercise.getId() + \"/files\", HttpStatus.OK, String.class, FileType.class);\n+        assertThat(files).isNotEmpty();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        params.add(\"file\", currentLocalFileName);\n+        var file = request.get(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, byte[].class, params);\n+        assertThat(file).isNotEmpty();\n+        assertThat(new String(file)).isEqualTo(currentLocalFileContent);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isFalse();\n+        params.add(\"file\", \"newFile\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.isRegularFile(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFolder() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isFalse();\n+        params.add(\"folder\", \"newFolder\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + exercise.getId() + \"/folder\", HttpStatus.OK, params);\n+        assertThat(Files.isDirectory(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldRenameFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isTrue();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFileName))).isFalse();\n+        FileMove fileMove = new FileMove();\n+        fileMove.setCurrentFilePath(currentLocalFileName);\n+        fileMove.setNewFilename(newLocalFileName);\n+        request.postWithoutLocation(testRepoBaseUrl + exercise.getId() + \"/rename-file\", fileMove, HttpStatus.OK, null);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isFalse();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFileName))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldRenameFolder() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFolderName))).isTrue();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFolderName))).isFalse();\n+        FileMove fileMove = new FileMove();\n+        fileMove.setCurrentFilePath(currentLocalFolderName);\n+        fileMove.setNewFilename(newLocalFolderName);\n+        request.postWithoutLocation(testRepoBaseUrl + exercise.getId() + \"/rename-file\", fileMove, HttpStatus.OK, null);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFolderName))).isFalse();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFolderName))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldDeleteFile() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isTrue();\n+        params.add(\"file\", currentLocalFileName);\n+        request.delete(testRepoBaseUrl + exercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isFalse();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCommitChanges() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        var receivedStatusBeforeCommit = request.get(testRepoBaseUrl + exercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatusBeforeCommit.repositoryStatus.toString()).isEqualTo(\"UNCOMMITTED_CHANGES\");\n+        request.postWithoutLocation(testRepoBaseUrl + exercise.getId() + \"/commit\", null, HttpStatus.OK, null);\n+        var receivedStatusAfterCommit = request.get(testRepoBaseUrl + exercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatusAfterCommit.repositoryStatus.toString()).isEqualTo(\"CLEAN\");\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldPullChanges() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        request.get(testRepoBaseUrl + exercise.getId() + \"/pull\", HttpStatus.OK, Void.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldResetToLastCommit() throws Exception {\n+        programmingExerciseRepository.save(exercise);", "originalCommit": "573875e51c34b9ec9bef49948ac6d282e708c960", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2MTMyNA==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r420061324", "bodyText": "i adapted the method", "author": "F4lka", "createdAt": "2020-05-05T12:12:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYzOTg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY0MDc0Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r416640747", "bodyText": "check that the files actually exists, some of them might get filtered by the way?", "author": "krusche", "createdAt": "2020-04-28T14:05:00Z", "path": "src/test/java/de/tum/in/www1/artemis/TestRepositoryResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,200 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.reset;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.time.ZonedDateTime;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.util.LinkedMultiValueMap;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.FileType;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+import de.tum.in.www1.artemis.repository.ProgrammingExerciseRepository;\n+import de.tum.in.www1.artemis.util.*;\n+import de.tum.in.www1.artemis.web.rest.dto.FileMove;\n+import de.tum.in.www1.artemis.web.rest.dto.RepositoryStatusDTO;\n+\n+public class TestRepositoryResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    private final String testRepoBaseUrl = \"/api/test-repository/\";\n+\n+    @Autowired\n+    private DatabaseUtilService database;\n+\n+    @Autowired\n+    private RequestUtilService request;\n+\n+    @Autowired\n+    ProgrammingExerciseRepository programmingExerciseRepository;\n+\n+    private Course course;\n+\n+    private ProgrammingExercise exercise;\n+\n+    private String currentLocalFileName = \"currentFileName\";\n+\n+    private String currentLocalFileContent = \"testContent\";\n+\n+    private String currentLocalFolderName = \"currentFolderName\";\n+\n+    private String newLocalFileName = \"newFileName\";\n+\n+    private String newLocalFolderName = \"newFolderName\";\n+\n+    LocalRepository testRepo = new LocalRepository();\n+\n+    @BeforeEach\n+    public void setup() throws Exception {\n+        database.addUsers(0, 0, 1);\n+        course = database.addEmptyCourse();\n+        exercise = ModelFactory.generateProgrammingExercise(ZonedDateTime.now().minusDays(1), ZonedDateTime.now().plusDays(7), course);\n+        testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n+\n+        // add file to the repository folder\n+        Path filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName);\n+        var file = Files.createFile(filePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(file, currentLocalFileContent);\n+\n+        // add folder to the repository folder\n+        filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFolderName);\n+        var folder = Files.createDirectory(filePath).toFile();\n+\n+        var testRepoUrl = new GitUtilService.MockFileRepositoryUrl(testRepo.originRepoFile);\n+        exercise.setTestRepositoryUrl(testRepoUrl.toString());\n+        doReturn(gitService.getRepositoryByLocalPath(testRepo.localRepoFile.toPath())).when(gitService).getOrCheckoutRepository(testRepoUrl.getURL(), true);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() throws IOException {\n+        database.resetDatabase();\n+        reset(gitService);\n+        LocalRepository.resetLocalRepo(testRepo);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFiles() throws Exception {\n+        programmingExerciseRepository.save(exercise);\n+        var files = request.getMap(testRepoBaseUrl + exercise.getId() + \"/files\", HttpStatus.OK, String.class, FileType.class);", "originalCommit": "573875e51c34b9ec9bef49948ac6d282e708c960", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxMDk2OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r419710969", "bodyText": "i added a check, which checks if the files actually exist", "author": "F4lka", "createdAt": "2020-05-04T20:34:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY0MDc0Nw=="}], "type": "inlineReview"}, {"oid": "85a2637b6a9987eda6ef84add9f3decc0a9733c5", "url": "https://github.com/ls1intum/Artemis/commit/85a2637b6a9987eda6ef84add9f3decc0a9733c5", "message": "added additional check, checks if the files actually exit", "committedDate": "2020-05-01T11:26:37Z", "type": "commit"}, {"oid": "3f6b7b6316e458013980fa8906e27c6ee0b54455", "url": "https://github.com/ls1intum/Artemis/commit/3f6b7b6316e458013980fa8906e27c6ee0b54455", "message": "Merge branch 'develop' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-05-01T16:03:30Z", "type": "commit"}, {"oid": "611b4fd20583999a283cb3667e4465ca81d6d2ef", "url": "https://github.com/ls1intum/Artemis/commit/611b4fd20583999a283cb3667e4465ca81d6d2ef", "message": "moved method getAllCommits to LocalRepository and adapted shouldCommitChanges()", "committedDate": "2020-05-02T09:29:57Z", "type": "commit"}, {"oid": "83478816b8a1de9533293dc12fca82f1b21f4fbd", "url": "https://github.com/ls1intum/Artemis/commit/83478816b8a1de9533293dc12fca82f1b21f4fbd", "message": "Merge branch 'develop' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-05-03T12:18:52Z", "type": "commit"}, {"oid": "41bb85cac098dda0c777cb98237fa9f28eca787f", "url": "https://github.com/ls1intum/Artemis/commit/41bb85cac098dda0c777cb98237fa9f28eca787f", "message": "added documentation for programming-exercise-update.component.ts", "committedDate": "2020-05-03T18:13:23Z", "type": "commit"}, {"oid": "d98ba712cbed2904fd46570c094e38804c485a1c", "url": "https://github.com/ls1intum/Artemis/commit/d98ba712cbed2904fd46570c094e38804c485a1c", "message": "added missing import", "committedDate": "2020-05-03T18:18:01Z", "type": "commit"}, {"oid": "fe5238ef739ee75822ba0d08694db670692599b2", "url": "https://github.com/ls1intum/Artemis/commit/fe5238ef739ee75822ba0d08694db670692599b2", "message": "updated the testcase shouldPullChanges", "committedDate": "2020-05-04T13:45:39Z", "type": "commit"}, {"oid": "af8ea1c371f24be92e099e47fa098e040e395900", "url": "https://github.com/ls1intum/Artemis/commit/af8ea1c371f24be92e099e47fa098e040e395900", "message": "Merge branch 'develop' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-05-04T13:47:35Z", "type": "commit"}, {"oid": "10e0d356d91be0ec3e29f0e327ba7e1874ee6c32", "url": "https://github.com/ls1intum/Artemis/commit/10e0d356d91be0ec3e29f0e327ba7e1874ee6c32", "message": "Merge branch 'develop' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-05-04T17:10:46Z", "type": "commit"}, {"oid": "115a3f71820b8d222cecd773e15df908e5c17012", "url": "https://github.com/ls1intum/Artemis/commit/115a3f71820b8d222cecd773e15df908e5c17012", "message": "updated the shouldResetToLastCommit and renamed exercise to programmingexercise", "committedDate": "2020-05-04T20:30:12Z", "type": "commit"}, {"oid": "f84cd431566760114438fa436c76a04ee839000e", "url": "https://github.com/ls1intum/Artemis/commit/f84cd431566760114438fa436c76a04ee839000e", "message": "Merge remote-tracking branch 'origin/IntegrationTest/TestRepositoryResource' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-05-04T20:30:41Z", "type": "commit"}, {"oid": "aebd153b0faa21d9e2d00fea661c7fec17c8d665", "url": "https://github.com/ls1intum/Artemis/commit/aebd153b0faa21d9e2d00fea661c7fec17c8d665", "message": "Merge branch 'develop' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-05-04T20:32:03Z", "type": "commit"}, {"oid": "14e3ec07d468f3237b4fdc5be4c07cfaba35fff8", "url": "https://github.com/ls1intum/Artemis/commit/14e3ec07d468f3237b4fdc5be4c07cfaba35fff8", "message": "Merge branch 'develop' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-05-04T21:48:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxMjkxNw==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r420012917", "bodyText": "please convert this into a non static method that is invoked on itself.", "author": "krusche", "createdAt": "2020-05-05T10:35:09Z", "path": "src/test/java/de/tum/in/www1/artemis/util/LocalRepository.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package de.tum.in.www1.artemis.util;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.eclipse.jgit.api.Git;\n+import org.eclipse.jgit.revwalk.RevCommit;\n+import org.eclipse.jgit.transport.URIish;\n+\n+public class LocalRepository {\n+\n+    public File localRepoFile;\n+\n+    public File originRepoFile;\n+\n+    public Git localGit;\n+\n+    public Git originGit;\n+\n+    public void configureRepos(String localRepoFileName, String originRepoFileName) throws Exception {\n+\n+        this.localRepoFile = Files.createTempDirectory(localRepoFileName).toFile();\n+        this.localGit = Git.init().setDirectory(localRepoFile).call();\n+\n+        this.originRepoFile = Files.createTempDirectory(originRepoFileName).toFile();\n+        this.originGit = Git.init().setDirectory(originRepoFile).call();\n+\n+        this.localGit.remoteAdd().setName(\"origin\").setUri(new URIish(String.valueOf(this.originRepoFile))).call();\n+    }\n+\n+    public static void resetLocalRepo(LocalRepository localRepo) throws IOException {", "originalCommit": "14e3ec07d468f3237b4fdc5be4c07cfaba35fff8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxMzA5MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r420013091", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static void resetLocalRepo(LocalRepository localRepo) throws IOException {\n          \n          \n            \n                public void resetLocalRepo() throws IOException {", "author": "krusche", "createdAt": "2020-05-05T10:35:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxMjkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxMzE0NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r420013145", "bodyText": "localRepo --> this", "author": "krusche", "createdAt": "2020-05-05T10:35:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxMjkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAyODk4Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r420028987", "bodyText": "i adapted the method", "author": "F4lka", "createdAt": "2020-05-05T11:07:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxMjkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxMzY2Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r420013663", "bodyText": "I would also prefer non static methods here. You could distinguish between\npublic List<RevCommit> getAllLocalCommits()\nand\npublic List<RevCommit> getAllOriginCommits()\nand use the corresponding variable then", "author": "krusche", "createdAt": "2020-05-05T10:36:42Z", "path": "src/test/java/de/tum/in/www1/artemis/util/LocalRepository.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package de.tum.in.www1.artemis.util;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.eclipse.jgit.api.Git;\n+import org.eclipse.jgit.revwalk.RevCommit;\n+import org.eclipse.jgit.transport.URIish;\n+\n+public class LocalRepository {\n+\n+    public File localRepoFile;\n+\n+    public File originRepoFile;\n+\n+    public Git localGit;\n+\n+    public Git originGit;\n+\n+    public void configureRepos(String localRepoFileName, String originRepoFileName) throws Exception {\n+\n+        this.localRepoFile = Files.createTempDirectory(localRepoFileName).toFile();\n+        this.localGit = Git.init().setDirectory(localRepoFile).call();\n+\n+        this.originRepoFile = Files.createTempDirectory(originRepoFileName).toFile();\n+        this.originGit = Git.init().setDirectory(originRepoFile).call();\n+\n+        this.localGit.remoteAdd().setName(\"origin\").setUri(new URIish(String.valueOf(this.originRepoFile))).call();\n+    }\n+\n+    public static void resetLocalRepo(LocalRepository localRepo) throws IOException {\n+        if (localRepo.localRepoFile != null && localRepo.localRepoFile.exists()) {\n+            FileUtils.deleteDirectory(localRepo.localRepoFile);\n+        }\n+        if (localRepo.localGit != null) {\n+            localRepo.localGit.close();\n+        }\n+\n+        if (localRepo.originRepoFile != null && localRepo.originRepoFile.exists()) {\n+            FileUtils.deleteDirectory(localRepo.originRepoFile);\n+        }\n+        if (localRepo.originGit != null) {\n+            localRepo.originGit.close();\n+        }\n+    }\n+\n+    public static List<RevCommit> getAllCommits(Git gitRepo) throws Exception {", "originalCommit": "14e3ec07d468f3237b4fdc5be4c07cfaba35fff8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAzMDA5Mg==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r420030092", "bodyText": "I adapted the method and divided it into two methods -> getAllLocalCommits & getAllOriginCommits", "author": "F4lka", "createdAt": "2020-05-05T11:09:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxMzY2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxNDIwOA==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r420014208", "bodyText": "can you be a bit more specific here when testing for the correct status?", "author": "krusche", "createdAt": "2020-05-05T10:37:54Z", "path": "src/test/java/de/tum/in/www1/artemis/TestRepositoryResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,289 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.reset;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.time.ZonedDateTime;\n+import java.util.List;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.eclipse.jgit.api.ListBranchCommand;\n+import org.eclipse.jgit.api.MergeResult;\n+import org.eclipse.jgit.lib.Ref;\n+import org.eclipse.jgit.merge.MergeStrategy;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.context.TestPropertySource;\n+import org.springframework.util.LinkedMultiValueMap;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.FileType;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+import de.tum.in.www1.artemis.repository.ProgrammingExerciseRepository;\n+import de.tum.in.www1.artemis.util.*;\n+import de.tum.in.www1.artemis.web.rest.dto.FileMove;\n+import de.tum.in.www1.artemis.web.rest.dto.RepositoryStatusDTO;\n+\n+@TestPropertySource(properties = \"artemis.repo-clone-path=\")\n+public class TestRepositoryResourceIntegrationTest extends AbstractSpringIntegrationBambooBitbucketJiraTest {\n+\n+    private final String testRepoBaseUrl = \"/api/test-repository/\";\n+\n+    @Autowired\n+    private DatabaseUtilService database;\n+\n+    @Autowired\n+    private RequestUtilService request;\n+\n+    @Autowired\n+    ProgrammingExerciseRepository programmingExerciseRepository;\n+\n+    private Course course;\n+\n+    private ProgrammingExercise programmingExercise;\n+\n+    private String currentLocalFileName = \"currentFileName\";\n+\n+    private String currentLocalFileContent = \"testContent\";\n+\n+    private String currentLocalFolderName = \"currentFolderName\";\n+\n+    private String newLocalFileName = \"newFileName\";\n+\n+    private String newLocalFolderName = \"newFolderName\";\n+\n+    LocalRepository testRepo = new LocalRepository();\n+\n+    @BeforeEach\n+    public void setup() throws Exception {\n+        database.addUsers(0, 0, 1);\n+        course = database.addEmptyCourse();\n+        programmingExercise = ModelFactory.generateProgrammingExercise(ZonedDateTime.now().minusDays(1), ZonedDateTime.now().plusDays(7), course);\n+        testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n+\n+        // add file to the repository folder\n+        Path filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName);\n+        var file = Files.createFile(filePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(file, currentLocalFileContent);\n+\n+        // add folder to the repository folder\n+        filePath = Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFolderName);\n+        var folder = Files.createDirectory(filePath).toFile();\n+\n+        var testRepoUrl = new GitUtilService.MockFileRepositoryUrl(testRepo.localRepoFile);\n+        programmingExercise.setTestRepositoryUrl(testRepoUrl.toString());\n+        doReturn(gitService.getRepositoryByLocalPath(testRepo.localRepoFile.toPath())).when(gitService).getOrCheckoutRepository(testRepoUrl.getURL(), true);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() throws IOException {\n+        database.resetDatabase();\n+        reset(gitService);\n+        LocalRepository.resetLocalRepo(testRepo);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFiles() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        var files = request.getMap(testRepoBaseUrl + programmingExercise.getId() + \"/files\", HttpStatus.OK, String.class, FileType.class);\n+        assertThat(files).isNotEmpty();\n+\n+        // Check if all files exist\n+        for (String key : files.keySet()) {\n+            assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + key))).isTrue();\n+        }\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetFile() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        params.add(\"file\", currentLocalFileName);\n+        var file = request.get(testRepoBaseUrl + programmingExercise.getId() + \"/file\", HttpStatus.OK, byte[].class, params);\n+        assertThat(file).isNotEmpty();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isTrue();\n+        assertThat(new String(file)).isEqualTo(currentLocalFileContent);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFile() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isFalse();\n+        params.add(\"file\", \"newFile\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + programmingExercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.isRegularFile(Paths.get(testRepo.localRepoFile + \"/newFile\"))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCreateFolder() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isFalse();\n+        params.add(\"folder\", \"newFolder\");\n+        request.postWithoutResponseBody(testRepoBaseUrl + programmingExercise.getId() + \"/folder\", HttpStatus.OK, params);\n+        assertThat(Files.isDirectory(Paths.get(testRepo.localRepoFile + \"/newFolder\"))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldRenameFile() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isTrue();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFileName))).isFalse();\n+        FileMove fileMove = new FileMove();\n+        fileMove.setCurrentFilePath(currentLocalFileName);\n+        fileMove.setNewFilename(newLocalFileName);\n+        request.postWithoutLocation(testRepoBaseUrl + programmingExercise.getId() + \"/rename-file\", fileMove, HttpStatus.OK, null);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isFalse();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFileName))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldRenameFolder() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFolderName))).isTrue();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFolderName))).isFalse();\n+        FileMove fileMove = new FileMove();\n+        fileMove.setCurrentFilePath(currentLocalFolderName);\n+        fileMove.setNewFilename(newLocalFolderName);\n+        request.postWithoutLocation(testRepoBaseUrl + programmingExercise.getId() + \"/rename-file\", fileMove, HttpStatus.OK, null);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFolderName))).isFalse();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + newLocalFolderName))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldDeleteFile() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        LinkedMultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isTrue();\n+        params.add(\"file\", currentLocalFileName);\n+        request.delete(testRepoBaseUrl + programmingExercise.getId() + \"/file\", HttpStatus.OK, params);\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + currentLocalFileName))).isFalse();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldCommitChanges() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        var receivedStatusBeforeCommit = request.get(testRepoBaseUrl + programmingExercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatusBeforeCommit.repositoryStatus.toString()).isEqualTo(\"UNCOMMITTED_CHANGES\");\n+        request.postWithoutLocation(testRepoBaseUrl + programmingExercise.getId() + \"/commit\", null, HttpStatus.OK, null);\n+        var receivedStatusAfterCommit = request.get(testRepoBaseUrl + programmingExercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatusAfterCommit.repositoryStatus.toString()).isEqualTo(\"CLEAN\");\n+        var testRepoCommits = LocalRepository.getAllCommits(testRepo.localGit);\n+        assertThat(testRepoCommits.size() == 1).isTrue();\n+        assertThat(database.getUserByLogin(\"instructor1\").getName()).isEqualTo(testRepoCommits.get(0).getAuthorIdent().getName());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldPullChanges() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        String fileName = \"remoteFile\";\n+\n+        // Create a commit for the local and the remote repository\n+        request.postWithoutLocation(testRepoBaseUrl + programmingExercise.getId() + \"/commit\", null, HttpStatus.OK, null);\n+        var remote = gitService.getRepositoryByLocalPath(testRepo.originRepoFile.toPath());\n+\n+        // Create file in the remote repository\n+        Path filePath = Paths.get(testRepo.originRepoFile + \"/\" + fileName);\n+        Files.createFile(filePath).toFile();\n+\n+        // Check if the file exists in the remote repository and that it doesn't yet exists in the local repository\n+        assertThat(Files.exists(Paths.get(testRepo.originRepoFile + \"/\" + fileName))).isTrue();\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + fileName))).isFalse();\n+\n+        // Stage all changes and make a second commit in the remote repository\n+        gitService.stageAllChanges(remote);\n+        testRepo.originGit.commit().setMessage(\"TestCommit\").setAllowEmpty(true).setCommitter(\"testname\", \"test@email\").call();\n+\n+        // Checks if the current commit is not equal on the local and the remote repository\n+        assertThat(LocalRepository.getAllCommits(testRepo.localGit).get(0)).isNotEqualTo(LocalRepository.getAllCommits(testRepo.originGit).get(0));\n+\n+        // Execute the Rest call\n+        request.get(testRepoBaseUrl + programmingExercise.getId() + \"/pull\", HttpStatus.OK, Void.class);\n+\n+        // Check if the current commit is the same on the local and the remote repository and if the file exists on the local repository\n+        assertThat(LocalRepository.getAllCommits(testRepo.localGit).get(0)).isEqualTo(LocalRepository.getAllCommits(testRepo.originGit).get(0));\n+        assertThat(Files.exists(Paths.get(testRepo.localRepoFile + \"/\" + fileName))).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldResetToLastCommit() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        String fileName = \"testFile\";\n+        var localRepo = gitService.getRepositoryByLocalPath(testRepo.localRepoFile.toPath());\n+        var remoteRepo = gitService.getRepositoryByLocalPath(testRepo.originRepoFile.toPath());\n+\n+        // Check status of git before the commit\n+        var receivedStatusBeforeCommit = request.get(testRepoBaseUrl + programmingExercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatusBeforeCommit.repositoryStatus.toString()).isEqualTo(\"UNCOMMITTED_CHANGES\");\n+\n+        // Create a commit for the local and the remote repository\n+        request.postWithoutLocation(testRepoBaseUrl + programmingExercise.getId() + \"/commit\", null, HttpStatus.OK, null);\n+\n+        // Check status of git after the commit\n+        var receivedStatusAfterCommit = request.get(testRepoBaseUrl + programmingExercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatusAfterCommit.repositoryStatus.toString()).isEqualTo(\"CLEAN\");\n+\n+        // Create file in the local repository and commit it\n+        Path localFilePath = Paths.get(testRepo.localRepoFile + \"/\" + fileName);\n+        var localFile = Files.createFile(localFilePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(localFile, \"local\");\n+        gitService.stageAllChanges(localRepo);\n+        testRepo.localGit.commit().setMessage(\"local\").call();\n+\n+        // Create file in the remote repository and commit it\n+        Path remoteFilePath = Paths.get(testRepo.originRepoFile + \"/\" + fileName);\n+        var remoteFile = Files.createFile(remoteFilePath).toFile();\n+        // write content to the created file\n+        FileUtils.write(remoteFile, \"remote\");\n+        gitService.stageAllChanges(remoteRepo);\n+        testRepo.originGit.commit().setMessage(\"remote\").call();\n+\n+        // Merge the two and a conflict will occur\n+        testRepo.localGit.fetch().setRemote(\"origin\").call();\n+        List<Ref> refs = testRepo.localGit.branchList().setListMode(ListBranchCommand.ListMode.REMOTE).call();\n+        var result = testRepo.localGit.merge().include(refs.get(0).getObjectId()).setStrategy(MergeStrategy.RESOLVE).call();\n+        var status = testRepo.localGit.status().call();\n+        assertThat(status.getConflicting().size() > 0).isTrue();\n+        assertThat(MergeResult.MergeStatus.CONFLICTING).isEqualTo(result.getMergeStatus());\n+\n+        // Execute the reset Rest call\n+        request.postWithoutLocation(testRepoBaseUrl + programmingExercise.getId() + \"/reset\", null, HttpStatus.OK, null);\n+\n+        // Check the git status after the reset\n+        status = testRepo.localGit.status().call();\n+        assertThat(status.getConflicting().size() == 0).isTrue();\n+        assertThat(LocalRepository.getAllCommits(testRepo.localGit).get(0)).isEqualTo(LocalRepository.getAllCommits(testRepo.originGit).get(0));\n+        var receivedStatusAfterReset = request.get(testRepoBaseUrl + programmingExercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatusAfterReset.repositoryStatus.toString()).isEqualTo(\"CLEAN\");\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void shouldGetStatus() throws Exception {\n+        programmingExerciseRepository.save(programmingExercise);\n+        var receivedStatus = request.get(testRepoBaseUrl + programmingExercise.getId(), HttpStatus.OK, RepositoryStatusDTO.class);\n+        assertThat(receivedStatus).isNotNull();", "originalCommit": "14e3ec07d468f3237b4fdc5be4c07cfaba35fff8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA0MjY1Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1353#discussion_r420042653", "bodyText": "i adapted the testcase", "author": "F4lka", "createdAt": "2020-05-05T11:36:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxNDIwOA=="}], "type": "inlineReview"}, {"oid": "6937e6837d722048b0e67bbe113505eb4d4bf7c4", "url": "https://github.com/ls1intum/Artemis/commit/6937e6837d722048b0e67bbe113505eb4d4bf7c4", "message": "updated method resetLocalRepo(now not static) and getAllCommits(now not static and two methods local and origin)", "committedDate": "2020-05-05T11:04:31Z", "type": "commit"}, {"oid": "e29b8bcd70b7a3edbab31ec217d195274a2ca280", "url": "https://github.com/ls1intum/Artemis/commit/e29b8bcd70b7a3edbab31ec217d195274a2ca280", "message": "Merge remote-tracking branch 'origin/IntegrationTest/TestRepositoryResource' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-05-05T11:05:08Z", "type": "commit"}, {"oid": "80236cd8bea8f578725cd4192db6e328ea6fa458", "url": "https://github.com/ls1intum/Artemis/commit/80236cd8bea8f578725cd4192db6e328ea6fa458", "message": "adapted the naming scheme of the test cases and adapted the testGetStatus method", "committedDate": "2020-05-05T11:30:18Z", "type": "commit"}, {"oid": "86112712d6603052edd1e82e401dfbda6bce56c8", "url": "https://github.com/ls1intum/Artemis/commit/86112712d6603052edd1e82e401dfbda6bce56c8", "message": "Merge branch 'develop' into IntegrationTest/TestRepositoryResource", "committedDate": "2020-05-05T11:36:31Z", "type": "commit"}]}