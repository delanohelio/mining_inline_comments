{"pr_number": 1177, "pr_title": "Enhancement: Guided Tour update orientation", "pr_createdAt": "2020-01-07T16:20:17Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1177", "timeline": [{"oid": "8fa4a2b5569a85cc7eddcc60b28179593b3821ce", "url": "https://github.com/ls1intum/Artemis/commit/8fa4a2b5569a85cc7eddcc60b28179593b3821ce", "message": "Implement orientation update for tour step", "committedDate": "2020-01-07T01:19:15Z", "type": "commit"}, {"oid": "0d3b5bb82eeade8dc233cc30e7808ffb1a6c09a1", "url": "https://github.com/ls1intum/Artemis/commit/0d3b5bb82eeade8dc233cc30e7808ffb1a6c09a1", "message": "Improve calculation in getTopScrollingPosition() method", "committedDate": "2020-01-07T01:43:54Z", "type": "commit"}, {"oid": "f747568581aac46b02d6715722d7e82bdf05c94d", "url": "https://github.com/ls1intum/Artemis/commit/f747568581aac46b02d6715722d7e82bdf05c94d", "message": "Improve calculation in getTopScrollingPosition() method", "committedDate": "2020-01-07T01:57:26Z", "type": "commit"}, {"oid": "73a5bf98974899e58691c5598a3c1dfd016c2f6a", "url": "https://github.com/ls1intum/Artemis/commit/73a5bf98974899e58691c5598a3c1dfd016c2f6a", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-07T16:10:31Z", "type": "commit"}, {"oid": "0dd5be9d2b8969110b6fc5da60e521be9d9b273d", "url": "https://github.com/ls1intum/Artemis/commit/0dd5be9d2b8969110b6fc5da60e521be9d9b273d", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-09T01:21:03Z", "type": "commit"}, {"oid": "3346c1f9eb44b3f1147c8f799b099ba8f121e0c8", "url": "https://github.com/ls1intum/Artemis/commit/3346c1f9eb44b3f1147c8f799b099ba8f121e0c8", "message": "Change accessibility of some public methods of the guided-tour.component.ts", "committedDate": "2020-01-09T21:45:25Z", "type": "commit"}, {"oid": "33caea10f06d2897b41e035161f535e7cc6f3571", "url": "https://github.com/ls1intum/Artemis/commit/33caea10f06d2897b41e035161f535e7cc6f3571", "message": "Fix build error", "committedDate": "2020-01-09T22:00:36Z", "type": "commit"}, {"oid": "f52ced607ac38f854323dd91d3412003c77a937c", "url": "https://github.com/ls1intum/Artemis/commit/f52ced607ac38f854323dd91d3412003c77a937c", "message": "Fix client tests", "committedDate": "2020-01-09T22:43:48Z", "type": "commit"}, {"oid": "646682bff1e566a33e2b4f83b232537792b11258", "url": "https://github.com/ls1intum/Artemis/commit/646682bff1e566a33e2b4f83b232537792b11258", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-10T17:14:24Z", "type": "commit"}, {"oid": "0cbe9d5ebf1faafadc2068d74faba2c01b4cb1b0", "url": "https://github.com/ls1intum/Artemis/commit/0cbe9d5ebf1faafadc2068d74faba2c01b4cb1b0", "message": "Add and update client tests", "committedDate": "2020-01-10T20:25:54Z", "type": "commit"}, {"oid": "bef377f578dcdf247335ce792986343a6d60baef", "url": "https://github.com/ls1intum/Artemis/commit/bef377f578dcdf247335ce792986343a6d60baef", "message": "Run prettier", "committedDate": "2020-01-10T20:32:04Z", "type": "commit"}, {"oid": "b6258a9a969e391e53337213272faa23ec4c9583", "url": "https://github.com/ls1intum/Artemis/commit/b6258a9a969e391e53337213272faa23ec4c9583", "message": "Fix offset calculation", "committedDate": "2020-01-10T21:46:05Z", "type": "commit"}, {"oid": "d596751dee9c8d0059a9183122dd2d32387beb1b", "url": "https://github.com/ls1intum/Artemis/commit/d596751dee9c8d0059a9183122dd2d32387beb1b", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-12T17:56:10Z", "type": "commit"}, {"oid": "50abc3002707fa1a713930ad9dd6772e7a9035c2", "url": "https://github.com/ls1intum/Artemis/commit/50abc3002707fa1a713930ad9dd6772e7a9035c2", "message": "Refactor elementInViewport method", "committedDate": "2020-01-13T03:26:25Z", "type": "commit"}, {"oid": "a442e18e1880a95b879c6bedf6dcb25fbf2a5aca", "url": "https://github.com/ls1intum/Artemis/commit/a442e18e1880a95b879c6bedf6dcb25fbf2a5aca", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-13T03:29:16Z", "type": "commit"}, {"oid": "a44a39e8baafd80837c13255af30b5748e6eae6b", "url": "https://github.com/ls1intum/Artemis/commit/a44a39e8baafd80837c13255af30b5748e6eae6b", "message": "Run prettier", "committedDate": "2020-01-13T03:50:42Z", "type": "commit"}, {"oid": "55501e520727a9aaa8de722613ffb2ac55bd1c44", "url": "https://github.com/ls1intum/Artemis/commit/55501e520727a9aaa8de722613ffb2ac55bd1c44", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-16T02:37:10Z", "type": "commit"}, {"oid": "db7062aa2219874dae3bf21b2d6fa3df79c05bfc", "url": "https://github.com/ls1intum/Artemis/commit/db7062aa2219874dae3bf21b2d6fa3df79c05bfc", "message": "Adjust implementation", "committedDate": "2020-01-17T12:56:26Z", "type": "commit"}, {"oid": "9fed06eb5621ec50b8d218540ef2a99724726083", "url": "https://github.com/ls1intum/Artemis/commit/9fed06eb5621ec50b8d218540ef2a99724726083", "message": "Run prettier", "committedDate": "2020-01-17T13:15:49Z", "type": "commit"}, {"oid": "1d9e3e8cbd80680b1a5bcae7d565c359e08752a3", "url": "https://github.com/ls1intum/Artemis/commit/1d9e3e8cbd80680b1a5bcae7d565c359e08752a3", "message": "Revert refactoring and fix client tests", "committedDate": "2020-01-17T13:35:07Z", "type": "commit"}, {"oid": "60764b50b4a5e1a214107f57800755ac3ec8ea07", "url": "https://github.com/ls1intum/Artemis/commit/60764b50b4a5e1a214107f57800755ac3ec8ea07", "message": "Fix helper methods", "committedDate": "2020-01-17T20:03:42Z", "type": "commit"}, {"oid": "614a932692b67dd1fc1559f5e1d41138a6eccad5", "url": "https://github.com/ls1intum/Artemis/commit/614a932692b67dd1fc1559f5e1d41138a6eccad5", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-17T20:17:22Z", "type": "commit"}, {"oid": "175921648f169ab6a11c1153e5f3f0aabb024559", "url": "https://github.com/ls1intum/Artemis/commit/175921648f169ab6a11c1153e5f3f0aabb024559", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-21T00:19:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxNTA5MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r369015091", "bodyText": "Would be nice to wrap the subtract and add operations with closures. It is quite hard to follow, when you add another statement with &&", "author": "maxr96", "createdAt": "2020-01-21T13:58:55Z", "path": "src/main/webapp/app/guided-tour/guided-tour.component.ts", "diffHunk": "@@ -173,68 +178,191 @@ export class GuidedTourComponent implements AfterViewInit, OnDestroy {\n     /**\n      * Scroll to and set highlighted element\n      */\n-    public scrollToAndSetElement(): void {\n+    private scrollToAndSetElement(): void {\n         this.selectedElementRect = this.updateStepLocation(this.getSelectedElement(), false);\n         this.observeSelectedRectPosition();\n \n         // Set timeout to allow things to render in order to scroll to the correct location\n         setTimeout(() => {\n-            if (this.isTourOnScreen()) {\n+            if (this.isTourOnScreen(Direction.VERTICAL) && this.isTourOnScreen(Direction.HORIZONTAL)) {\n                 return;\n             }\n-            const topPosition = this.getTopScrollingPosition();\n-            try {\n-                window.scrollTo({\n-                    left: 0,\n-                    top: topPosition,\n-                    behavior: 'smooth',\n-                });\n-            } catch (err) {\n-                if (err instanceof TypeError) {\n-                    window.scroll(0, topPosition);\n-                } else {\n-                    throw err;\n+            if (!this.isTourOnScreen(Direction.VERTICAL)) {\n+                const topPosition = this.getTopScrollingPosition();\n+                try {\n+                    window.scrollTo({ left: 0, top: topPosition, behavior: 'smooth' });\n+                } catch (err) {\n+                    if (err instanceof TypeError) {\n+                        window.scroll(0, topPosition);\n+                    } else {\n+                        throw err;\n+                    }\n                 }\n             }\n+            setTimeout(() => {\n+                if (!this.isTourOnScreen(Direction.HORIZONTAL)) {\n+                    this.flipOrientation();\n+                }\n+            }, 300);\n         }, 0);\n     }\n \n+    /**\n+     * Check if the current tour step has a bottom orientation\n+     * @return true if the current tour step orientation is bottom, otherwise false\n+     */\n+    private isBottom(): boolean {\n+        if (this.currentTourStep && this.currentTourStep.orientation) {\n+            return (\n+                this.currentTourStep.orientation === Orientation.BOTTOM ||\n+                this.currentTourStep.orientation === Orientation.BOTTOMLEFT ||\n+                this.currentTourStep.orientation === Orientation.BOTTOMRIGHT\n+            );\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check if the current tour step has a top orientation\n+     * @return true if the current tour step orientation is bottom, otherwise false\n+     */\n+    private isTop(): boolean {\n+        if (this.currentTourStep && this.currentTourStep.orientation) {\n+            return (\n+                this.currentTourStep.orientation === Orientation.TOP ||\n+                this.currentTourStep.orientation === Orientation.TOPLEFT ||\n+                this.currentTourStep.orientation === Orientation.TOPRIGHT\n+            );\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check if the current tour step has a left orientation\n+     * @return true if the current tour step orientation is left, otherwise false\n+     */\n+    private isLeft(): boolean {\n+        if (this.currentTourStep && this.currentTourStep.orientation) {\n+            return (\n+                this.currentTourStep.orientation === Orientation.LEFT ||\n+                this.currentTourStep.orientation === Orientation.TOPLEFT ||\n+                this.currentTourStep.orientation === Orientation.BOTTOMLEFT\n+            );\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check if the current tour step has a right orientation\n+     * @return true if the current tour step orientation is right, otherwise false\n+     */\n+    private isRight(): boolean {\n+        if (this.currentTourStep && this.currentTourStep.orientation) {\n+            return (\n+                this.currentTourStep.orientation === Orientation.RIGHT ||\n+                this.currentTourStep.orientation === Orientation.TOPRIGHT ||\n+                this.currentTourStep.orientation === Orientation.BOTTOMRIGHT\n+            );\n+        }\n+        return false;\n+    }\n+\n     /**\n      * Check if the tour step element would be visible on screen\n      * @return true if tour step is visible on screen, otherwise false\n      */\n-    public isTourOnScreen(): boolean {\n+    private isTourOnScreen(direction: Direction): boolean {\n         if (!this.currentTourStep) {\n             return false;\n         }\n-        return !this.currentTourStep.highlightSelector || (this.elementInViewport(this.getSelectedElement()) && this.elementInViewport(this.tourStep.nativeElement));\n+        switch (direction) {\n+            case Direction.HORIZONTAL: {\n+                return !this.currentTourStep.highlightSelector || this.elementInViewport(this.getSelectedElement(), direction);\n+            }\n+            case Direction.VERTICAL: {\n+                return (\n+                    !this.currentTourStep.highlightSelector ||\n+                    (this.elementInViewport(this.getSelectedElement(), direction) && this.elementInViewport(this.tourStep.nativeElement, direction))\n+                );\n+            }\n+        }\n     }\n \n     /**\n      * Define if HTMLElement is visible in current viewport\n      * Modified from https://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport\n      * @param element that should be checked\n+     * @param direction it should be checked if the tour step is horizontally or vertically in the viewport\n      * @return true if element is in viewport, otherwise false\n      */\n-    public elementInViewport(element: HTMLElement | null): boolean {\n+    private elementInViewport(element: HTMLElement | null, direction: Direction): boolean {\n         if (!element) {\n             return false;\n         }\n-        let top = element.offsetTop;\n-        const height = element.offsetHeight;\n \n-        while (element.offsetParent) {\n-            element = element.offsetParent as HTMLElement;\n-            top += element.offsetTop;\n-        }\n+        let elementInViewPort = true;\n \n-        const scrollAdjustment = this.currentTourStep && this.currentTourStep.scrollAdjustment ? this.currentTourStep.scrollAdjustment : 0;\n-        const stepScreenAdjustment = this.getStepScreenAdjustment();\n+        switch (direction) {\n+            case Direction.HORIZONTAL: {\n+                const width = element.offsetWidth;\n+                const left = calculateLeftOffset(element);\n+                const tourStepWidth = this.tourStep.nativeElement.offsetWidth;\n+                elementInViewPort = isElementInViewPortHorizontally(this.currentTourStep.orientation, left, width, tourStepWidth);\n+                break;\n+            }\n+            case Direction.VERTICAL: {\n+                const scrollAdjustment = this.currentTourStep && this.currentTourStep.scrollAdjustment ? this.currentTourStep.scrollAdjustment : 0;\n+                const stepScreenAdjustment = this.getStepScreenAdjustment();\n+                const top = calculateTopOffset(element);\n+                const height = element.offsetHeight;\n+\n+                if (this.isBottom()) {\n+                    elementInViewPort =\n+                        top >= window.pageYOffset + this.topOfPageAdjustment + scrollAdjustment + stepScreenAdjustment && top + height <= window.innerHeight + window.pageYOffset;", "originalCommit": "175921648f169ab6a11c1153e5f3f0aabb024559", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI5Nzk0MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r371297941", "bodyText": "Unfortunately this is not possible because of the typescript formatting guideline given by the prettier config. I received an error for the formatting and after running prettier the closures are removed.", "author": "lovaiible", "createdAt": "2020-01-27T15:14:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxNTA5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxODk1NA==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r369018954", "bodyText": "Hm here you are accessing orientation directly on the class and below you do it on currentTourStep. If I understand correctly it should be only accessed with the first approach.", "author": "maxr96", "createdAt": "2020-01-21T14:05:57Z", "path": "src/main/webapp/app/guided-tour/guided-tour.component.ts", "diffHunk": "@@ -173,68 +178,191 @@ export class GuidedTourComponent implements AfterViewInit, OnDestroy {\n     /**\n      * Scroll to and set highlighted element\n      */\n-    public scrollToAndSetElement(): void {\n+    private scrollToAndSetElement(): void {\n         this.selectedElementRect = this.updateStepLocation(this.getSelectedElement(), false);\n         this.observeSelectedRectPosition();\n \n         // Set timeout to allow things to render in order to scroll to the correct location\n         setTimeout(() => {\n-            if (this.isTourOnScreen()) {\n+            if (this.isTourOnScreen(Direction.VERTICAL) && this.isTourOnScreen(Direction.HORIZONTAL)) {\n                 return;\n             }\n-            const topPosition = this.getTopScrollingPosition();\n-            try {\n-                window.scrollTo({\n-                    left: 0,\n-                    top: topPosition,\n-                    behavior: 'smooth',\n-                });\n-            } catch (err) {\n-                if (err instanceof TypeError) {\n-                    window.scroll(0, topPosition);\n-                } else {\n-                    throw err;\n+            if (!this.isTourOnScreen(Direction.VERTICAL)) {\n+                const topPosition = this.getTopScrollingPosition();\n+                try {\n+                    window.scrollTo({ left: 0, top: topPosition, behavior: 'smooth' });\n+                } catch (err) {\n+                    if (err instanceof TypeError) {\n+                        window.scroll(0, topPosition);\n+                    } else {\n+                        throw err;\n+                    }\n                 }\n             }\n+            setTimeout(() => {\n+                if (!this.isTourOnScreen(Direction.HORIZONTAL)) {\n+                    this.flipOrientation();\n+                }\n+            }, 300);\n         }, 0);\n     }\n \n+    /**\n+     * Check if the current tour step has a bottom orientation\n+     * @return true if the current tour step orientation is bottom, otherwise false\n+     */\n+    private isBottom(): boolean {\n+        if (this.currentTourStep && this.currentTourStep.orientation) {\n+            return (\n+                this.currentTourStep.orientation === Orientation.BOTTOM ||\n+                this.currentTourStep.orientation === Orientation.BOTTOMLEFT ||\n+                this.currentTourStep.orientation === Orientation.BOTTOMRIGHT\n+            );\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check if the current tour step has a top orientation\n+     * @return true if the current tour step orientation is bottom, otherwise false\n+     */\n+    private isTop(): boolean {\n+        if (this.currentTourStep && this.currentTourStep.orientation) {\n+            return (\n+                this.currentTourStep.orientation === Orientation.TOP ||\n+                this.currentTourStep.orientation === Orientation.TOPLEFT ||\n+                this.currentTourStep.orientation === Orientation.TOPRIGHT\n+            );\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check if the current tour step has a left orientation\n+     * @return true if the current tour step orientation is left, otherwise false\n+     */\n+    private isLeft(): boolean {\n+        if (this.currentTourStep && this.currentTourStep.orientation) {\n+            return (\n+                this.currentTourStep.orientation === Orientation.LEFT ||\n+                this.currentTourStep.orientation === Orientation.TOPLEFT ||\n+                this.currentTourStep.orientation === Orientation.BOTTOMLEFT\n+            );\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check if the current tour step has a right orientation\n+     * @return true if the current tour step orientation is right, otherwise false\n+     */\n+    private isRight(): boolean {\n+        if (this.currentTourStep && this.currentTourStep.orientation) {\n+            return (\n+                this.currentTourStep.orientation === Orientation.RIGHT ||\n+                this.currentTourStep.orientation === Orientation.TOPRIGHT ||\n+                this.currentTourStep.orientation === Orientation.BOTTOMRIGHT\n+            );\n+        }\n+        return false;\n+    }\n+\n     /**\n      * Check if the tour step element would be visible on screen\n      * @return true if tour step is visible on screen, otherwise false\n      */\n-    public isTourOnScreen(): boolean {\n+    private isTourOnScreen(direction: Direction): boolean {\n         if (!this.currentTourStep) {\n             return false;\n         }\n-        return !this.currentTourStep.highlightSelector || (this.elementInViewport(this.getSelectedElement()) && this.elementInViewport(this.tourStep.nativeElement));\n+        switch (direction) {\n+            case Direction.HORIZONTAL: {\n+                return !this.currentTourStep.highlightSelector || this.elementInViewport(this.getSelectedElement(), direction);\n+            }\n+            case Direction.VERTICAL: {\n+                return (\n+                    !this.currentTourStep.highlightSelector ||\n+                    (this.elementInViewport(this.getSelectedElement(), direction) && this.elementInViewport(this.tourStep.nativeElement, direction))\n+                );\n+            }\n+        }\n     }\n \n     /**\n      * Define if HTMLElement is visible in current viewport\n      * Modified from https://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport\n      * @param element that should be checked\n+     * @param direction it should be checked if the tour step is horizontally or vertically in the viewport\n      * @return true if element is in viewport, otherwise false\n      */\n-    public elementInViewport(element: HTMLElement | null): boolean {\n+    private elementInViewport(element: HTMLElement | null, direction: Direction): boolean {\n         if (!element) {\n             return false;\n         }\n-        let top = element.offsetTop;\n-        const height = element.offsetHeight;\n \n-        while (element.offsetParent) {\n-            element = element.offsetParent as HTMLElement;\n-            top += element.offsetTop;\n-        }\n+        let elementInViewPort = true;\n \n-        const scrollAdjustment = this.currentTourStep && this.currentTourStep.scrollAdjustment ? this.currentTourStep.scrollAdjustment : 0;\n-        const stepScreenAdjustment = this.getStepScreenAdjustment();\n+        switch (direction) {\n+            case Direction.HORIZONTAL: {\n+                const width = element.offsetWidth;\n+                const left = calculateLeftOffset(element);\n+                const tourStepWidth = this.tourStep.nativeElement.offsetWidth;\n+                elementInViewPort = isElementInViewPortHorizontally(this.currentTourStep.orientation, left, width, tourStepWidth);\n+                break;\n+            }\n+            case Direction.VERTICAL: {\n+                const scrollAdjustment = this.currentTourStep && this.currentTourStep.scrollAdjustment ? this.currentTourStep.scrollAdjustment : 0;\n+                const stepScreenAdjustment = this.getStepScreenAdjustment();\n+                const top = calculateTopOffset(element);\n+                const height = element.offsetHeight;\n+\n+                if (this.isBottom()) {\n+                    elementInViewPort =\n+                        top >= window.pageYOffset + this.topOfPageAdjustment + scrollAdjustment + stepScreenAdjustment && top + height <= window.innerHeight + window.pageYOffset;\n+                } else {\n+                    elementInViewPort =\n+                        top >= window.pageYOffset + this.topOfPageAdjustment - stepScreenAdjustment && top + height + scrollAdjustment <= window.innerHeight + window.pageYOffset;\n+                }\n+                break;\n+            }\n+        }\n+        return elementInViewPort;\n+    }\n \n-        if (this.isBottom()) {\n-            return top >= window.pageYOffset + this.topOfPageAdjustment + scrollAdjustment + stepScreenAdjustment && top + height <= window.innerHeight;\n-        } else {\n-            return top >= window.pageYOffset + this.topOfPageAdjustment - stepScreenAdjustment && top + height + scrollAdjustment <= window.innerHeight;\n+    /**\n+     * Flips the orientation of the current tour step horizontally\n+     */\n+    private flipOrientation(): void {\n+        if (this.isLeft()) {\n+            switch (this.orientation) {", "originalCommit": "175921648f169ab6a11c1153e5f3f0aabb024559", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMwMDczNQ==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r371300735", "bodyText": "You are right, I missed that part. I changed the code to switch (this.currentTourStep.orientation) now", "author": "lovaiible", "createdAt": "2020-01-27T15:18:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxODk1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyMDAxNg==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r369020016", "bodyText": "You should be able to use just this.orientation here since you already assign it in the beginning", "author": "maxr96", "createdAt": "2020-01-21T14:08:01Z", "path": "src/main/webapp/app/guided-tour/guided-tour.component.ts", "diffHunk": "@@ -173,68 +178,191 @@ export class GuidedTourComponent implements AfterViewInit, OnDestroy {\n     /**\n      * Scroll to and set highlighted element\n      */\n-    public scrollToAndSetElement(): void {\n+    private scrollToAndSetElement(): void {\n         this.selectedElementRect = this.updateStepLocation(this.getSelectedElement(), false);\n         this.observeSelectedRectPosition();\n \n         // Set timeout to allow things to render in order to scroll to the correct location\n         setTimeout(() => {\n-            if (this.isTourOnScreen()) {\n+            if (this.isTourOnScreen(Direction.VERTICAL) && this.isTourOnScreen(Direction.HORIZONTAL)) {\n                 return;\n             }\n-            const topPosition = this.getTopScrollingPosition();\n-            try {\n-                window.scrollTo({\n-                    left: 0,\n-                    top: topPosition,\n-                    behavior: 'smooth',\n-                });\n-            } catch (err) {\n-                if (err instanceof TypeError) {\n-                    window.scroll(0, topPosition);\n-                } else {\n-                    throw err;\n+            if (!this.isTourOnScreen(Direction.VERTICAL)) {\n+                const topPosition = this.getTopScrollingPosition();\n+                try {\n+                    window.scrollTo({ left: 0, top: topPosition, behavior: 'smooth' });\n+                } catch (err) {\n+                    if (err instanceof TypeError) {\n+                        window.scroll(0, topPosition);\n+                    } else {\n+                        throw err;\n+                    }\n                 }\n             }\n+            setTimeout(() => {\n+                if (!this.isTourOnScreen(Direction.HORIZONTAL)) {\n+                    this.flipOrientation();\n+                }\n+            }, 300);\n         }, 0);\n     }\n \n+    /**\n+     * Check if the current tour step has a bottom orientation\n+     * @return true if the current tour step orientation is bottom, otherwise false\n+     */\n+    private isBottom(): boolean {\n+        if (this.currentTourStep && this.currentTourStep.orientation) {\n+            return (\n+                this.currentTourStep.orientation === Orientation.BOTTOM ||", "originalCommit": "175921648f169ab6a11c1153e5f3f0aabb024559", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI5OTA4OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r371299089", "bodyText": "Yes, but it refers to the orientation of the step, therefore it should refer to this.currentTourStep.orientation", "author": "lovaiible", "createdAt": "2020-01-27T15:16:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyMDAxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyMjI3Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r369022273", "bodyText": "Why do you need @ts-ignore here?", "author": "maxr96", "createdAt": "2020-01-21T14:12:01Z", "path": "src/main/webapp/app/guided-tour/guided-tour.constants.ts", "diffHunk": "@@ -38,8 +31,17 @@ export enum OverlayPosition {\n }\n \n export enum UserInteractionEvent {\n+    // @ts-ignore", "originalCommit": "175921648f169ab6a11c1153e5f3f0aabb024559", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI5OTMwMA==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r371299300", "bodyText": "I removed it :)", "author": "lovaiible", "createdAt": "2020-01-27T15:16:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyMjI3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTExNjkwNQ==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r369116905", "bodyText": "this. should be redundant here.", "author": "madwau", "createdAt": "2020-01-21T16:46:05Z", "path": "src/main/webapp/app/guided-tour/guided-tour.component.html", "diffHunk": "@@ -7,7 +7,7 @@\n     <div\n         #tourStep\n         *ngIf=\"currentTourStep\"\n-        class=\"tour-step tour-{{ currentTourStep.orientation }}\"\n+        class=\"tour-step tour-{{ this.orientation }}\"", "originalCommit": "175921648f169ab6a11c1153e5f3f0aabb024559", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMwMDg3Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r371300873", "bodyText": "Changed that :)", "author": "lovaiible", "createdAt": "2020-01-27T15:18:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTExNjkwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTEyNTMzNA==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r369125334", "bodyText": "I assume this timeout is needed to let the previously triggered scrolling finish? Is it not possible to move the flip orientation before the scrolling without timeout since the scrolling should not affect whether the tour is in the viewport horizontally?\nCurrently, the 300ms are noticeable and the user can see the popup jumping into the flipped orientation. Not super serious but if this could be avoided, even better.", "author": "madwau", "createdAt": "2020-01-21T17:00:06Z", "path": "src/main/webapp/app/guided-tour/guided-tour.component.ts", "diffHunk": "@@ -173,68 +178,191 @@ export class GuidedTourComponent implements AfterViewInit, OnDestroy {\n     /**\n      * Scroll to and set highlighted element\n      */\n-    public scrollToAndSetElement(): void {\n+    private scrollToAndSetElement(): void {\n         this.selectedElementRect = this.updateStepLocation(this.getSelectedElement(), false);\n         this.observeSelectedRectPosition();\n \n         // Set timeout to allow things to render in order to scroll to the correct location\n         setTimeout(() => {\n-            if (this.isTourOnScreen()) {\n+            if (this.isTourOnScreen(Direction.VERTICAL) && this.isTourOnScreen(Direction.HORIZONTAL)) {\n                 return;\n             }\n-            const topPosition = this.getTopScrollingPosition();\n-            try {\n-                window.scrollTo({\n-                    left: 0,\n-                    top: topPosition,\n-                    behavior: 'smooth',\n-                });\n-            } catch (err) {\n-                if (err instanceof TypeError) {\n-                    window.scroll(0, topPosition);\n-                } else {\n-                    throw err;\n+            if (!this.isTourOnScreen(Direction.VERTICAL)) {\n+                const topPosition = this.getTopScrollingPosition();\n+                try {\n+                    window.scrollTo({ left: 0, top: topPosition, behavior: 'smooth' });\n+                } catch (err) {\n+                    if (err instanceof TypeError) {\n+                        window.scroll(0, topPosition);\n+                    } else {\n+                        throw err;\n+                    }\n                 }\n             }\n+            setTimeout(() => {", "originalCommit": "175921648f169ab6a11c1153e5f3f0aabb024559", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMwMTIzNw==", "url": "https://github.com/ls1intum/Artemis/pull/1177#discussion_r371301237", "bodyText": "I changed the logic a little bit and now it's possible without the delay of 300ms :)", "author": "lovaiible", "createdAt": "2020-01-27T15:19:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTEyNTMzNA=="}], "type": "inlineReview"}, {"oid": "d310783a0c86b13996dabff6a905c3b8c9c1798d", "url": "https://github.com/ls1intum/Artemis/commit/d310783a0c86b13996dabff6a905c3b8c9c1798d", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-22T16:33:41Z", "type": "commit"}, {"oid": "13733f9afef0cafa64790d5f92242024c7607ff6", "url": "https://github.com/ls1intum/Artemis/commit/13733f9afef0cafa64790d5f92242024c7607ff6", "message": "Address feedback", "committedDate": "2020-01-23T01:37:41Z", "type": "commit"}, {"oid": "2060990b1d5f2c86f29152eaa6d215e8305d2029", "url": "https://github.com/ls1intum/Artemis/commit/2060990b1d5f2c86f29152eaa6d215e8305d2029", "message": "Adjust scrolling calculation", "committedDate": "2020-01-27T01:53:53Z", "type": "commit"}, {"oid": "4f9a0e53faf88955be2c20c58d85a750d6a9896e", "url": "https://github.com/ls1intum/Artemis/commit/4f9a0e53faf88955be2c20c58d85a750d6a9896e", "message": "Apply feedback and fix calculation", "committedDate": "2020-01-27T02:10:45Z", "type": "commit"}, {"oid": "6b73512862e1e84a700bf71a8c8e42cd877ad04a", "url": "https://github.com/ls1intum/Artemis/commit/6b73512862e1e84a700bf71a8c8e42cd877ad04a", "message": "Fix flipOrientation method", "committedDate": "2020-01-27T02:18:55Z", "type": "commit"}, {"oid": "02e7b90a6e3eb3faae39f948bca7a17ade53aebb", "url": "https://github.com/ls1intum/Artemis/commit/02e7b90a6e3eb3faae39f948bca7a17ade53aebb", "message": "Apply prettier", "committedDate": "2020-01-27T02:30:40Z", "type": "commit"}, {"oid": "d3fd3eceb49861bbeb5ac2986a171b1d8016d66d", "url": "https://github.com/ls1intum/Artemis/commit/d3fd3eceb49861bbeb5ac2986a171b1d8016d66d", "message": "Remove timeout when flipping orientation", "committedDate": "2020-01-27T02:37:05Z", "type": "commit"}, {"oid": "a487fbe23938b2ca59fa632fd81c47fe5557834f", "url": "https://github.com/ls1intum/Artemis/commit/a487fbe23938b2ca59fa632fd81c47fe5557834f", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-27T02:37:14Z", "type": "commit"}, {"oid": "0018275918e2bfc8aecc465a146bf06957414157", "url": "https://github.com/ls1intum/Artemis/commit/0018275918e2bfc8aecc465a146bf06957414157", "message": "Merge branch 'develop' into enhancement/guided-tour/update-orientation", "committedDate": "2020-01-27T15:21:14Z", "type": "commit"}]}