{"pr_number": 2189, "pr_title": "Add missing plagiarism tests", "pr_createdAt": "2020-10-12T21:49:29Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2189", "timeline": [{"oid": "1832d2e9d4f923e511cd478b211b61246a8a02a3", "url": "https://github.com/ls1intum/Artemis/commit/1832d2e9d4f923e511cd478b211b61246a8a02a3", "message": "Add tests for PlagiarismHeaderComponent", "committedDate": "2020-10-12T08:56:15Z", "type": "commit"}, {"oid": "c15d5e673258ecdec9d16c68a2defa48c2eab847", "url": "https://github.com/ls1intum/Artemis/commit/c15d5e673258ecdec9d16c68a2defa48c2eab847", "message": "Add tests for PlagiarismInspectorComponent", "committedDate": "2020-10-12T17:23:09Z", "type": "commit"}, {"oid": "3a8800bb4d04623cfeae9c941a4a99692d4eb007", "url": "https://github.com/ls1intum/Artemis/commit/3a8800bb4d04623cfeae9c941a4a99692d4eb007", "message": "Merge branch 'develop' into chore/add-missing-plagiarism-tests", "committedDate": "2020-10-14T19:59:26Z", "type": "commit"}, {"oid": "324f886619885aaa1a797206d4249ed382f5f584", "url": "https://github.com/ls1intum/Artemis/commit/324f886619885aaa1a797206d4249ed382f5f584", "message": "Add more tests for PlagiarismInspectorComponent", "committedDate": "2020-10-14T20:50:06Z", "type": "commit"}, {"oid": "166b04d1fd640e3e38c0ed0bae98d8daa554c320", "url": "https://github.com/ls1intum/Artemis/commit/166b04d1fd640e3e38c0ed0bae98d8daa554c320", "message": "Add test for the CSV export of plagiarism results", "committedDate": "2020-10-14T21:03:52Z", "type": "commit"}, {"oid": "1b37699c495ee88a4fb8eb6736b3d78ab6fb0fd9", "url": "https://github.com/ls1intum/Artemis/commit/1b37699c495ee88a4fb8eb6736b3d78ab6fb0fd9", "message": "Fix PlagiarismInspectorComponent tests", "committedDate": "2020-10-15T11:44:00Z", "type": "commit"}, {"oid": "056183861958ee2eea181f57b6abfaada4bd6391", "url": "https://github.com/ls1intum/Artemis/commit/056183861958ee2eea181f57b6abfaada4bd6391", "message": "Merge branch 'develop' into chore/add-missing-plagiarism-tests", "committedDate": "2020-10-15T12:25:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcxMDE3MQ==", "url": "https://github.com/ls1intum/Artemis/pull/2189#discussion_r505710171", "bodyText": "We usually have networking code in a service class. I'd argue that would also improve the structure here.", "author": "jpbernius", "createdAt": "2020-10-15T17:17:51Z", "path": "src/main/webapp/app/exercises/shared/plagiarism/plagiarism-inspector/plagiarism-inspector.component.ts", "diffHunk": "@@ -13,35 +13,97 @@ import { ExportToCsv } from 'export-to-csv';\n     templateUrl: './plagiarism-inspector.component.html',\n })\n export class PlagiarismInspectorComponent implements OnInit {\n-    selectedComparisonIndex: number;\n-    plagiarismCheckInProgress: boolean;\n+    /**\n+     * The modeling exercise for which plagiarism is to be detected.\n+     */\n     modelingExercise: ModelingExercise;\n+\n+    /**\n+     * Results of the plagiarism detection.\n+     */\n     modelingSubmissionComparisons: Array<ModelingSubmissionComparisonDTO>;\n-    splitControlSubject: Subject<string> = new Subject<string>();\n \n-    private subscription: Subscription;\n+    /**\n+     * Flag to indicate whether the plagiarism detection is currently in progress.\n+     */\n+    plagiarismDetectionInProgress: boolean;\n+\n+    /**\n+     * Index of the currently selected plagiarism.\n+     */\n+    selectedPlagiarismIndex: number;\n+\n+    /**\n+     * Subject to be passed into PlagiarismSplitViewComponent to control the split view.\n+     */\n+    splitControlSubject: Subject<string> = new Subject<string>();\n \n     constructor(private route: ActivatedRoute, private router: Router, private modelingExerciseService: ModelingExerciseService) {}\n \n     ngOnInit() {\n-        this.subscription = this.route.params.subscribe((params) => {\n-            this.modelingExerciseService.find(params['exerciseId']).subscribe((response: HttpResponse<ModelingExercise>) => {\n-                this.modelingExercise = response.body!;\n-            });\n+        this.route.params.subscribe((params) => {\n+            this.fetchModelingExercise(params['exerciseId']);\n+        });\n+    }\n+\n+    /**\n+     * Fetch the modeling exercise with the given id.\n+     *\n+     * @param modelingExerciseId\n+     */\n+    fetchModelingExercise(modelingExerciseId: number) {\n+        this.modelingExerciseService.find(modelingExerciseId).subscribe((response: HttpResponse<ModelingExercise>) => {\n+            this.modelingExercise = response.body!;\n         });\n     }\n \n-    handleTagPlagiarism(confirmed: boolean) {\n-        this.modelingSubmissionComparisons[this.selectedComparisonIndex].confirmed = confirmed;\n+    /**\n+     * Handle the 'plagiarismStatusChange' event emitted by PlagiarismHeaderComponent.\n+     *\n+     * @param confirmed\n+     */\n+    handlePlagiarismStatusChange(confirmed: boolean) {\n+        this.modelingSubmissionComparisons[this.selectedPlagiarismIndex].confirmed = confirmed;\n+    }\n+\n+    /**\n+     * Handle the 'splitViewChange' event emitted by PlagiarismHeaderComponent.\n+     *\n+     * @param pane\n+     */\n+    handleSplitViewChange(pane: string) {\n+        this.splitControlSubject.next(pane);\n+    }\n+\n+    /**\n+     * Trigger the server-side plagiarism detection and fetch its result.\n+     */\n+    checkPlagiarism() {\n+        this.plagiarismDetectionInProgress = true;\n+\n+        this.modelingExerciseService.checkPlagiarism(this.modelingExercise.id!).subscribe(\n+            (response: HttpResponse<Array<ModelingSubmissionComparisonDTO>>) => {\n+                this.plagiarismDetectionInProgress = false;\n+                this.modelingSubmissionComparisons = response.body!.sort((c1, c2) => c2.similarity - c1.similarity);\n+            },\n+            () => (this.plagiarismDetectionInProgress = false),\n+        );", "originalCommit": "056183861958ee2eea181f57b6abfaada4bd6391", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjE4NTUwMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2189#discussion_r506185501", "bodyText": "Mapped the response to its body attribute in modelingExerciseService.checkPlagiarism(...) now, so I can work with the comparison results in the component directly.", "author": "philippbauch", "createdAt": "2020-10-16T08:51:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcxMDE3MQ=="}], "type": "inlineReview"}, {"oid": "51a18475dd6d7167ae4fc01e9b1942ede1b81ac2", "url": "https://github.com/ls1intum/Artemis/commit/51a18475dd6d7167ae4fc01e9b1942ede1b81ac2", "message": "Move checkPlagiarism() network code in PlagiarismInspectorComponent to service class", "committedDate": "2020-10-16T08:49:14Z", "type": "commit"}, {"oid": "a0806aa1712a92116fb261d38fb28463e0acefde", "url": "https://github.com/ls1intum/Artemis/commit/a0806aa1712a92116fb261d38fb28463e0acefde", "message": "Fix PlagiarismInspectorComponent tests", "committedDate": "2020-10-16T08:49:14Z", "type": "commit"}]}