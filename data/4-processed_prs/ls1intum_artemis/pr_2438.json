{"pr_number": 2438, "pr_title": "Remove duplicated code in assessment service", "pr_createdAt": "2020-11-20T16:25:47Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2438", "timeline": [{"oid": "496d5e9b46b73b14586e85b07a52fd6bede36400", "url": "https://github.com/ls1intum/Artemis/commit/496d5e9b46b73b14586e85b07a52fd6bede36400", "message": "remove duplicated code and transactional in assessment service(s)", "committedDate": "2020-11-18T18:19:06Z", "type": "commit"}, {"oid": "a9aa29a59f247ac9e301ea72e382fb3fb1bcea9d", "url": "https://github.com/ls1intum/Artemis/commit/a9aa29a59f247ac9e301ea72e382fb3fb1bcea9d", "message": "Merge branch 'develop' into chore/remove-duplicated-assessment-service\n\n# Conflicts:\n#\tsrc/main/java/de/tum/in/www1/artemis/service/AssessmentService.java", "committedDate": "2020-11-18T22:19:42Z", "type": "commit"}, {"oid": "e0c00203f85f34d82a21940a361abda7d4bd70d2", "url": "https://github.com/ls1intum/Artemis/commit/e0c00203f85f34d82a21940a361abda7d4bd70d2", "message": "fix after merge", "committedDate": "2020-11-18T22:40:31Z", "type": "commit"}, {"oid": "d62df6b21d2f36f3584bf6083449d3c9de9affbe", "url": "https://github.com/ls1intum/Artemis/commit/d62df6b21d2f36f3584bf6083449d3c9de9affbe", "message": "Merge branch 'develop' into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-19T08:01:22Z", "type": "commit"}, {"oid": "aeffbfe7d93e7291b1b9b87b66ee7d13d9dd6829", "url": "https://github.com/ls1intum/Artemis/commit/aeffbfe7d93e7291b1b9b87b66ee7d13d9dd6829", "message": "Merge branch 'develop' into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-20T16:22:20Z", "type": "commit"}, {"oid": "77924579b253a60a25e5a5e921b4d9839e5c9df7", "url": "https://github.com/ls1intum/Artemis/commit/77924579b253a60a25e5a5e921b4d9839e5c9df7", "message": "Merge branch 'develop' into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-20T20:04:06Z", "type": "commit"}, {"oid": "60c36ede4db48c2a4d9c40fc6cab2ec2267d715c", "url": "https://github.com/ls1intum/Artemis/commit/60c36ede4db48c2a4d9c40fc6cab2ec2267d715c", "message": "remove unused code, remove duplicated code", "committedDate": "2020-11-20T20:54:23Z", "type": "commit"}, {"oid": "bb81064e16f666e89e8efd03fb15ae18e58e40d4", "url": "https://github.com/ls1intum/Artemis/commit/bb81064e16f666e89e8efd03fb15ae18e58e40d4", "message": "remove more @Transactional", "committedDate": "2020-11-21T07:15:59Z", "type": "commit"}, {"oid": "0b0ae9d0616e8f2f6df792e0e6e6b8e72ff7415e", "url": "https://github.com/ls1intum/Artemis/commit/0b0ae9d0616e8f2f6df792e0e6e6b8e72ff7415e", "message": "fix file upload tests", "committedDate": "2020-11-21T08:38:16Z", "type": "commit"}, {"oid": "e9b3311c09775c181a6e700dafc745a9ebc0e119", "url": "https://github.com/ls1intum/Artemis/commit/e9b3311c09775c181a6e700dafc745a9ebc0e119", "message": "fix modeling test", "committedDate": "2020-11-21T08:40:16Z", "type": "commit"}, {"oid": "12f36b4d7cef91995c411f35651d0d11db96f4d6", "url": "https://github.com/ls1intum/Artemis/commit/12f36b4d7cef91995c411f35651d0d11db96f4d6", "message": "fix test", "committedDate": "2020-11-21T09:07:13Z", "type": "commit"}, {"oid": "fb68d73a229b390c94100b010314d7fa8555dfb4", "url": "https://github.com/ls1intum/Artemis/commit/fb68d73a229b390c94100b010314d7fa8555dfb4", "message": "refactor saveAssessment", "committedDate": "2020-11-21T09:50:37Z", "type": "commit"}, {"oid": "bccf9241ec11a06573235ca56364fe3db4567a64", "url": "https://github.com/ls1intum/Artemis/commit/bccf9241ec11a06573235ca56364fe3db4567a64", "message": "Merge branch 'develop' into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-21T09:56:06Z", "type": "commit"}, {"oid": "d23172889059ef804c5b49658502023dfe0fb2ad", "url": "https://github.com/ls1intum/Artemis/commit/d23172889059ef804c5b49658502023dfe0fb2ad", "message": "fix documentation", "committedDate": "2020-11-21T10:07:52Z", "type": "commit"}, {"oid": "a4e78ffc633c2b4008ed4dfd285513ad92175cd5", "url": "https://github.com/ls1intum/Artemis/commit/a4e78ffc633c2b4008ed4dfd285513ad92175cd5", "message": "Merge branch 'chore/remove-duplicated-assessment-service' of github.com:ls1intum/Artemis into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-21T10:08:21Z", "type": "commit"}, {"oid": "6238d759b11108a7a1ecbf85237c4e97c4491584", "url": "https://github.com/ls1intum/Artemis/commit/6238d759b11108a7a1ecbf85237c4e97c4491584", "message": "fix documentation", "committedDate": "2020-11-21T10:12:20Z", "type": "commit"}, {"oid": "77f80f19f9eba29862175a26457e18468463f1a7", "url": "https://github.com/ls1intum/Artemis/commit/77f80f19f9eba29862175a26457e18468463f1a7", "message": "fix tests", "committedDate": "2020-11-21T10:38:53Z", "type": "commit"}, {"oid": "4cefc1e42a973f8fe6ed4b5a8f5eb1982ada2973", "url": "https://github.com/ls1intum/Artemis/commit/4cefc1e42a973f8fe6ed4b5a8f5eb1982ada2973", "message": "fix relevant codacy issues", "committedDate": "2020-11-21T11:06:02Z", "type": "commit"}, {"oid": "7e84b6b1172e416f615234ba102a098ec88b25e3", "url": "https://github.com/ls1intum/Artemis/commit/7e84b6b1172e416f615234ba102a098ec88b25e3", "message": "fix issue when saving text and modeling assessment", "committedDate": "2020-11-22T00:07:52Z", "type": "commit"}, {"oid": "791216c1382893f6bd6136bdafceddfab589eacf", "url": "https://github.com/ls1intum/Artemis/commit/791216c1382893f6bd6136bdafceddfab589eacf", "message": "fix issue with participationId in url of undefined when trying to evaluate a complaint", "committedDate": "2020-11-22T00:47:26Z", "type": "commit"}, {"oid": "07b6def1735f61057385916c59b23cb9adc2c6eb", "url": "https://github.com/ls1intum/Artemis/commit/07b6def1735f61057385916c59b23cb9adc2c6eb", "message": "fix that participationId is undefined when routing for programming exercises", "committedDate": "2020-11-22T07:15:52Z", "type": "commit"}, {"oid": "644841d0c424f4ee7f42de2fff2c207c187fa5ae", "url": "https://github.com/ls1intum/Artemis/commit/644841d0c424f4ee7f42de2fff2c207c187fa5ae", "message": "Merge branch 'bugfix/programming-assessment/routing-complaints' of https://github.com/ls1intum/Artemis into chore/remove-duplicated-assessment-service\n\n# Conflicts:\n#\tsrc/main/webapp/app/exercises/shared/dashboards/tutor/exercise-assessment-dashboard.component.ts", "committedDate": "2020-11-22T07:23:11Z", "type": "commit"}, {"oid": "17e60a4e3e33c7ca9e3d0c896b2891cd1d607007", "url": "https://github.com/ls1intum/Artemis/commit/17e60a4e3e33c7ca9e3d0c896b2891cd1d607007", "message": "increase submissionresource test coverage", "committedDate": "2020-11-22T09:31:16Z", "type": "commit"}, {"oid": "93cac35d8fbdabc31e85ef47b212698df807cca5", "url": "https://github.com/ls1intum/Artemis/commit/93cac35d8fbdabc31e85ef47b212698df807cca5", "message": "Merge branch 'chore/remove-duplicated-assessment-service' of github.com:ls1intum/Artemis into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-22T09:32:18Z", "type": "commit"}, {"oid": "5397b53203a59e5b36b4e7473a553782f0c6117c", "url": "https://github.com/ls1intum/Artemis/commit/5397b53203a59e5b36b4e7473a553782f0c6117c", "message": "increase submissionResource test coverage", "committedDate": "2020-11-22T09:47:23Z", "type": "commit"}, {"oid": "9ed0fa0a184ca77827cfd0cc1a3587d9e416d765", "url": "https://github.com/ls1intum/Artemis/commit/9ed0fa0a184ca77827cfd0cc1a3587d9e416d765", "message": "Merge branch 'develop' into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-22T09:58:26Z", "type": "commit"}, {"oid": "ca9d31d49b5f761b2e1b54b7294b40095747c5fc", "url": "https://github.com/ls1intum/Artemis/commit/ca9d31d49b5f761b2e1b54b7294b40095747c5fc", "message": "increase FileUploadSubmission service test coverage", "committedDate": "2020-11-22T10:24:47Z", "type": "commit"}, {"oid": "fe46a46c600a806d61b88e5b423f85e2e87aa243", "url": "https://github.com/ls1intum/Artemis/commit/fe46a46c600a806d61b88e5b423f85e2e87aa243", "message": "Merge branch 'chore/remove-duplicated-assessment-service' of github.com:ls1intum/Artemis into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-22T10:25:11Z", "type": "commit"}, {"oid": "552d922739a6bbc9be4be279459fc14f47acfa52", "url": "https://github.com/ls1intum/Artemis/commit/552d922739a6bbc9be4be279459fc14f47acfa52", "message": "increase ParticipationService coverage", "committedDate": "2020-11-22T10:44:15Z", "type": "commit"}, {"oid": "3756425f689dd24023339587c984beba5a441f07", "url": "https://github.com/ls1intum/Artemis/commit/3756425f689dd24023339587c984beba5a441f07", "message": "remove unreachable code", "committedDate": "2020-11-22T11:52:25Z", "type": "commit"}, {"oid": "a1c944e27ee0b6b013ef906b465caab3be4c9202", "url": "https://github.com/ls1intum/Artemis/commit/a1c944e27ee0b6b013ef906b465caab3be4c9202", "message": "Merge branch 'develop' into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-22T12:08:01Z", "type": "commit"}, {"oid": "7df5f48935baf1459aecc93f7991e951a2d0ac80", "url": "https://github.com/ls1intum/Artemis/commit/7df5f48935baf1459aecc93f7991e951a2d0ac80", "message": "Merge branch 'develop' into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-23T10:40:40Z", "type": "commit"}, {"oid": "ca7804eea76223ee13e41dbbc0c26b3529e74016", "url": "https://github.com/ls1intum/Artemis/commit/ca7804eea76223ee13e41dbbc0c26b3529e74016", "message": "rename method to avoid confusion with differentiation of referenced and unreferend feedback", "committedDate": "2020-11-23T10:51:00Z", "type": "commit"}, {"oid": "09a6290172acec93113b5415a79e4284a9907ae7", "url": "https://github.com/ls1intum/Artemis/commit/09a6290172acec93113b5415a79e4284a9907ae7", "message": "add docu that assessmentService methods are not used for programming and we use different approach there", "committedDate": "2020-11-23T11:04:53Z", "type": "commit"}, {"oid": "461f9b6a6cd7c90ced428a7b768cf6e8925c324c", "url": "https://github.com/ls1intum/Artemis/commit/461f9b6a6cd7c90ced428a7b768cf6e8925c324c", "message": "Merge branch 'chore/remove-duplicated-assessment-service' of https://github.com/ls1intum/Artemis into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-23T12:31:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk1NzM5Mg==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r528957392", "bodyText": "shouldn't we use text blocks for new queries from now on?", "author": "TobiasPr", "createdAt": "2020-11-23T19:51:25Z", "path": "src/main/java/de/tum/in/www1/artemis/repository/ResultRepository.java", "diffHunk": "@@ -56,6 +56,9 @@\n     @Query(\"select r from Result r left join fetch r.feedbacks where r.id = :resultId\")\n     Optional<Result> findByIdWithEagerFeedbacks(@Param(\"resultId\") Long id);\n \n+    @Query(\"select r from Result r left join fetch r.submission left join fetch r.feedbacks where r.id = :resultId\")", "originalCommit": "461f9b6a6cd7c90ced428a7b768cf6e8925c324c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2MjU0OA==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r528962548", "bodyText": "I think we decided to use them only for large queries so that they are more readable. Maybe I got this wrong?", "author": "anditurdiu", "createdAt": "2020-11-23T20:01:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk1NzM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk4NzQ1MA==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r528987450", "bodyText": "Okay, I though @MaisiKoleni wanted to exchange them bit by bit. But I am also not sure if we defined a formatting schema", "author": "TobiasPr", "createdAt": "2020-11-23T20:50:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk1NzM5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk4NTY3Ng==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r528985676", "bodyText": "please remove if not needed", "author": "TobiasPr", "createdAt": "2020-11-23T20:46:35Z", "path": "src/test/java/de/tum/in/www1/artemis/StudentExamIntegrationTest.java", "diffHunk": "@@ -331,6 +332,61 @@ public void testFindAllTestRunsForExam() throws Exception {\n         assertThat(response.size()).isEqualTo(2);\n     }\n \n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetAllTestRunSubmissionsForExercise() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");\n+        course2 = database.addEmptyCourse();\n+        var examVisibleDate = ZonedDateTime.now().minusMinutes(5);\n+        var examStartDate = ZonedDateTime.now().plusMinutes(4);\n+        var examEndDate = ZonedDateTime.now().plusMinutes(3);\n+        exam2 = database.addExam(course2, examVisibleDate, examStartDate, examEndDate);\n+        var exam = database.addTextModelingProgrammingExercisesToExam(exam2, false);\n+        var testRun = database.setupTestRunForExamWithExerciseGroupsForInstructor(exam, instructor, exam.getExerciseGroups());\n+        List<Submission> response = request.getList(\"/api/exercises/\" + testRun.getExercises().get(0).getId() + \"/test-run-submissions\", HttpStatus.OK, Submission.class);\n+        response.get(0).getParticipation().setSubmissions(new HashSet<>(response));\n+        assertThat(((StudentParticipation) response.get(0).getParticipation()).isTestRunParticipation()).isTrue();\n+        assertThat(response.get(0).getResult().getAssessor()).isEqualTo(instructor);\n+        assertThat(response.get(0).getResult().getAssessor()).isEqualTo(((StudentParticipation) response.get(0).getParticipation()).getStudent().get());\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetAllTestRunSubmissionsForExercise_notExamExercise() throws Exception {\n+        var instructor = database.getUserByLogin(\"instructor1\");", "originalCommit": "461f9b6a6cd7c90ced428a7b768cf6e8925c324c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NDA3Ng==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r528994076", "bodyText": "done in 54f2e40", "author": "fde312", "createdAt": "2020-11-23T21:03:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk4NTY3Ng=="}], "type": "inlineReview"}, {"oid": "54f2e403cdf87725d2a7a0708a86a568c24f75a0", "url": "https://github.com/ls1intum/Artemis/commit/54f2e403cdf87725d2a7a0708a86a568c24f75a0", "message": "fix some codacy issues", "committedDate": "2020-11-23T21:02:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NTgwNg==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r528965806", "bodyText": "I would add Submissions to the name of the methods to clarify that the methods also loads submissions.", "author": "kloessst", "createdAt": "2020-11-23T20:07:20Z", "path": "src/main/java/de/tum/in/www1/artemis/repository/StudentParticipationRepository.java", "diffHunk": "@@ -36,8 +36,10 @@\n     @Query(\"select distinct participation from StudentParticipation participation where participation.exercise.course.id = :#{#courseId} and participation.team.shortName = :#{#teamShortName}\")\n     List<StudentParticipation> findAllByCourseIdAndTeamShortName(@Param(\"courseId\") Long courseId, @Param(\"teamShortName\") String teamShortName);\n \n+    @EntityGraph(type = LOAD, attributePaths = \"submissions\")\n     Optional<StudentParticipation> findByExerciseIdAndStudentLogin(Long exerciseId, String username);\n \n+    @EntityGraph(type = LOAD, attributePaths = \"submissions\")\n     Optional<StudentParticipation> findByExerciseIdAndTeamId(Long exerciseId, Long teamId);", "originalCommit": "461f9b6a6cd7c90ced428a7b768cf6e8925c324c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU3NzgyMw==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529577823", "bodyText": "This was actually a very nice catch because we had other functions that did the same thing but under the complete name :D\nSee 4efa077", "author": "anditurdiu", "createdAt": "2020-11-24T14:17:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NTgwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwODc2MA==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529008760", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * get all the submissions for an exercise. It is possible to filter, to receive only the one that have been already submitted, or only the one assessed by the tutor who is\n          \n          \n            \n                 * Get all the submissions for an exercise. It is possible to filter, to receive only the ones that have already been submitted, or only the ones assessed by the tutor who is", "author": "kloessst", "createdAt": "2020-11-23T21:30:14Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/AbstractSubmissionResource.java", "diffHunk": "@@ -0,0 +1,90 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import java.util.List;\n+\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.*;\n+\n+import de.tum.in.www1.artemis.domain.*;\n+import de.tum.in.www1.artemis.repository.SubmissionRepository;\n+import de.tum.in.www1.artemis.service.*;\n+import de.tum.in.www1.artemis.web.rest.errors.AccessForbiddenException;\n+\n+/**\n+ * REST controller for managing Submission.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class AbstractSubmissionResource {\n+\n+    protected final SubmissionRepository submissionRepository;\n+\n+    protected final ResultService resultService;\n+\n+    protected final ParticipationService participationService;\n+\n+    protected final AuthorizationCheckService authCheckService;\n+\n+    protected final UserService userService;\n+\n+    protected final ExerciseService exerciseService;\n+\n+    protected final SubmissionService submissionService;\n+\n+    public AbstractSubmissionResource(SubmissionRepository submissionRepository, ResultService resultService, ParticipationService participationService,\n+            AuthorizationCheckService authCheckService, UserService userService, ExerciseService exerciseService, SubmissionService submissionService) {\n+        this.submissionRepository = submissionRepository;\n+        this.resultService = resultService;\n+        this.exerciseService = exerciseService;\n+        this.participationService = participationService;\n+        this.authCheckService = authCheckService;\n+        this.userService = userService;\n+        this.submissionService = submissionService;\n+    }\n+\n+    /**\n+     * get all the submissions for an exercise. It is possible to filter, to receive only the one that have been already submitted, or only the one assessed by the tutor who is", "originalCommit": "54f2e403cdf87725d2a7a0708a86a568c24f75a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU3Nzg5Mw==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529577893", "bodyText": "See 4efa077", "author": "anditurdiu", "createdAt": "2020-11-24T14:17:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwODc2MA=="}], "type": "inlineReview"}, {"oid": "a3982afbb500333b5d805c7eda35d8b976a23ea8", "url": "https://github.com/ls1intum/Artemis/commit/a3982afbb500333b5d805c7eda35d8b976a23ea8", "message": "Merge branch 'develop' into chore/remove-duplicated-assessment-service", "committedDate": "2020-11-24T08:29:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMwNTI5Nw==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529305297", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * <br><br>", "author": "jpbernius", "createdAt": "2020-11-24T08:56:34Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AssessmentService.java", "diffHunk": "@@ -262,4 +271,93 @@ public Double calculateTotalScore(List<Feedback> assessments) {\n         }\n         return totalScore;\n     }\n+\n+    /**\n+     * Gets an example submission with the given submissionId and returns the result of the submission.\n+     *\n+     * @param submissionId the id of the example modeling submission\n+     * @return the result of the submission\n+     * @throws EntityNotFoundException when no submission can be found for the given id\n+     */\n+    public Result getExampleAssessment(long submissionId) {\n+        Optional<Submission> optionalSubmission = submissionRepository.findExampleSubmissionByIdWithEagerResult(submissionId);\n+        Submission submission = optionalSubmission.orElseThrow(() -> new EntityNotFoundException(\"Example Submission with id \\\"\" + submissionId + \"\\\" does not exist\"));\n+        return submission.getResult();\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * <br><br>\n+     * For programming exercises we use a different approach see {@link ProgrammingAssessmentService#submitManualAssessment(long)})}\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @param exercise the exercise the assessment belongs to\n+     * @param submissionDate the date manual assessment was submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    public Result submitManualAssessment(long resultId, Exercise exercise, ZonedDateTime submissionDate) {\n+        Result result = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(resultId)\n+                .orElseThrow(() -> new EntityNotFoundException(\"No result for the given resultId could be found\"));\n+        result.setRatedIfNotExceeded(exercise.getDueDate(), submissionDate);\n+        result.setCompletionDate(ZonedDateTime.now());\n+        Double calculatedScore = calculateTotalScore(result.getFeedbacks());\n+        return submitResult(result, exercise, calculatedScore);\n+    }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     * <br><br>", "originalCommit": "a3982afbb500333b5d805c7eda35d8b976a23ea8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMwNTU1Mg==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529305552", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * <br><br>", "author": "jpbernius", "createdAt": "2020-11-24T08:56:56Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AssessmentService.java", "diffHunk": "@@ -262,4 +271,93 @@ public Double calculateTotalScore(List<Feedback> assessments) {\n         }\n         return totalScore;\n     }\n+\n+    /**\n+     * Gets an example submission with the given submissionId and returns the result of the submission.\n+     *\n+     * @param submissionId the id of the example modeling submission\n+     * @return the result of the submission\n+     * @throws EntityNotFoundException when no submission can be found for the given id\n+     */\n+    public Result getExampleAssessment(long submissionId) {\n+        Optional<Submission> optionalSubmission = submissionRepository.findExampleSubmissionByIdWithEagerResult(submissionId);\n+        Submission submission = optionalSubmission.orElseThrow(() -> new EntityNotFoundException(\"Example Submission with id \\\"\" + submissionId + \"\\\" does not exist\"));\n+        return submission.getResult();\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * <br><br>", "originalCommit": "a3982afbb500333b5d805c7eda35d8b976a23ea8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMxMjk1OQ==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529312959", "bodyText": "Should be abstract.", "author": "jpbernius", "createdAt": "2020-11-24T09:03:19Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/AbstractSubmissionResource.java", "diffHunk": "@@ -0,0 +1,90 @@\n+package de.tum.in.www1.artemis.web.rest;\n+\n+import java.util.List;\n+\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.*;\n+\n+import de.tum.in.www1.artemis.domain.*;\n+import de.tum.in.www1.artemis.repository.SubmissionRepository;\n+import de.tum.in.www1.artemis.service.*;\n+import de.tum.in.www1.artemis.web.rest.errors.AccessForbiddenException;\n+\n+/**\n+ * REST controller for managing Submission.\n+ */\n+@RestController\n+@RequestMapping(\"/api\")\n+public class AbstractSubmissionResource {", "originalCommit": "a3982afbb500333b5d805c7eda35d8b976a23ea8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMxNjI3Ng==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529316276", "bodyText": "Also, I would rename this to SubmissionResource and remove @Annotations to be consistent with the AssessmentResource class.", "author": "jpbernius", "createdAt": "2020-11-24T09:06:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMxMjk1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM4NjM3NQ==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529386375", "bodyText": "Good point. I made it abstract. The issue is that there is already a generic SubmissionResource with API endpoints and it was not possible to apply inheritance here, otherwise those API endpoints would be inherited by the subclasses and would be available twice. There we now have a generic SubmissionResource (offers generic API endpoints for REST calls that are independent of the exercise type) and an abstract AbstractSubmissionResource which is used as superclass to avoid duplicated code.\nI am not really happy with this solution, but I think we should improve this structure further in a follow-up PR.", "author": "krusche", "createdAt": "2020-11-24T10:01:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMxMjk1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM3NTczNw==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529375737", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (textBlocks != null) {\n          \n          \n            \n                    if (textBlocks == null) {\n          \n          \n            \n                            return null;\n          \n          \n            \n                    }", "author": "jpbernius", "createdAt": "2020-11-24T09:53:12Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextAssessmentResource.java", "diffHunk": "@@ -409,14 +379,15 @@ private void checkTextExerciseForRequest(@Nullable TextExercise textExercise, Us\n      * Save TextBlocks received from Client (if present). We need to reference them to the submission first.\n      * @param textBlocks received from Client\n      * @param textSubmission to associate blocks with\n+     * @return the saved textBlocks\n      */\n-    private void saveTextBlocks(final Set<TextBlock> textBlocks, final TextSubmission textSubmission) {\n+    private Set<TextBlock> saveTextBlocks(Set<TextBlock> textBlocks, final TextSubmission textSubmission) {\n         if (textBlocks != null) {", "originalCommit": "a3982afbb500333b5d805c7eda35d8b976a23ea8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2NTIxMw==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529565213", "bodyText": "See a1a0ee9", "author": "anditurdiu", "createdAt": "2020-11-24T13:59:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM3NTczNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM3NjU1MQ==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529376551", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        textBlocks = new HashSet<>(textBlockRepository.saveAll(updatedTextBlocks));\n          \n          \n            \n                        return new HashSet<>(textBlockRepository.saveAll(updatedTextBlocks));", "author": "jpbernius", "createdAt": "2020-11-24T09:53:51Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextAssessmentResource.java", "diffHunk": "@@ -409,14 +379,15 @@ private void checkTextExerciseForRequest(@Nullable TextExercise textExercise, Us\n      * Save TextBlocks received from Client (if present). We need to reference them to the submission first.\n      * @param textBlocks received from Client\n      * @param textSubmission to associate blocks with\n+     * @return the saved textBlocks\n      */\n-    private void saveTextBlocks(final Set<TextBlock> textBlocks, final TextSubmission textSubmission) {\n+    private Set<TextBlock> saveTextBlocks(Set<TextBlock> textBlocks, final TextSubmission textSubmission) {\n         if (textBlocks != null) {\n             final Set<String> existingTextBlockIds = textSubmission.getBlocks().stream().map(TextBlock::getId).collect(toSet());\n-            final var updatedTextBlocks = textBlocks.stream().filter(tb -> !existingTextBlockIds.contains(tb.getId())).peek(tb -> {\n-                tb.setSubmission(textSubmission);\n-            }).collect(toSet());\n-            textBlockRepository.saveAll(updatedTextBlocks);\n+            final var updatedTextBlocks = textBlocks.stream().filter(tb -> !existingTextBlockIds.contains(tb.getId())).peek(tb -> tb.setSubmission(textSubmission))\n+                    .collect(toSet());\n+            textBlocks = new HashSet<>(textBlockRepository.saveAll(updatedTextBlocks));", "originalCommit": "a3982afbb500333b5d805c7eda35d8b976a23ea8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2NTE0MA==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529565140", "bodyText": "See a1a0ee9", "author": "anditurdiu", "createdAt": "2020-11-24T13:59:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM3NjU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM3Njg5NQ==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529376895", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    }\n          \n          \n            \n                    return textBlocks;", "author": "jpbernius", "createdAt": "2020-11-24T09:54:06Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextAssessmentResource.java", "diffHunk": "@@ -409,14 +379,15 @@ private void checkTextExerciseForRequest(@Nullable TextExercise textExercise, Us\n      * Save TextBlocks received from Client (if present). We need to reference them to the submission first.\n      * @param textBlocks received from Client\n      * @param textSubmission to associate blocks with\n+     * @return the saved textBlocks\n      */\n-    private void saveTextBlocks(final Set<TextBlock> textBlocks, final TextSubmission textSubmission) {\n+    private Set<TextBlock> saveTextBlocks(Set<TextBlock> textBlocks, final TextSubmission textSubmission) {\n         if (textBlocks != null) {\n             final Set<String> existingTextBlockIds = textSubmission.getBlocks().stream().map(TextBlock::getId).collect(toSet());\n-            final var updatedTextBlocks = textBlocks.stream().filter(tb -> !existingTextBlockIds.contains(tb.getId())).peek(tb -> {\n-                tb.setSubmission(textSubmission);\n-            }).collect(toSet());\n-            textBlockRepository.saveAll(updatedTextBlocks);\n+            final var updatedTextBlocks = textBlocks.stream().filter(tb -> !existingTextBlockIds.contains(tb.getId())).peek(tb -> tb.setSubmission(textSubmission))\n+                    .collect(toSet());\n+            textBlocks = new HashSet<>(textBlockRepository.saveAll(updatedTextBlocks));\n         }\n+        return textBlocks;", "originalCommit": "a3982afbb500333b5d805c7eda35d8b976a23ea8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2NTAzNQ==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529565035", "bodyText": "See a1a0ee9", "author": "anditurdiu", "createdAt": "2020-11-24T13:59:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM3Njg5NQ=="}], "type": "inlineReview"}, {"oid": "5b0b843c51b4c8fdd0e2bbb311712f341e8d452b", "url": "https://github.com/ls1intum/Artemis/commit/5b0b843c51b4c8fdd0e2bbb311712f341e8d452b", "message": "remove annotations", "committedDate": "2020-11-24T09:58:28Z", "type": "commit"}, {"oid": "8af4eded7ec7849d752774f9b99036e25d7e70cb", "url": "https://github.com/ls1intum/Artemis/commit/8af4eded7ec7849d752774f9b99036e25d7e70cb", "message": "Update src/main/java/de/tum/in/www1/artemis/service/AssessmentService.java\r\n\r\nadd\n\nCo-authored-by: Jan Philip Bernius <janphilip.bernius@tum.de>", "committedDate": "2020-11-24T13:24:57Z", "type": "commit"}, {"oid": "a1a0ee9651530ee2700f2cb241e856365b210795", "url": "https://github.com/ls1intum/Artemis/commit/a1a0ee9651530ee2700f2cb241e856365b210795", "message": "add feedback from code review", "committedDate": "2020-11-24T13:41:44Z", "type": "commit"}, {"oid": "4efa07733fe19b2ecaa415f4e836910340d22b47", "url": "https://github.com/ls1intum/Artemis/commit/4efa07733fe19b2ecaa415f4e836910340d22b47", "message": "add feedback from code review\nRemove duplicate repository functions under different names", "committedDate": "2020-11-24T14:14:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU4NjI3Mw==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529586273", "bodyText": "Seeing the comment above explaining why we use @Transactional here, does it make much sense to additionally add // ok (which doesn't explain much in itself)?", "author": "FrankeLukas", "createdAt": "2020-11-24T14:28:21Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AssessmentService.java", "diffHunk": "@@ -86,7 +95,7 @@ Result submitResult(Result result, Exercise exercise, Double calculatedScore) {\n      * @return the updated Result\n      */\n     // NOTE: transactional makes sense here because we change multiple objects in the database and the changes might be invalid in case, one save operation fails\n-    @Transactional\n+    @Transactional // ok", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU4NzUxNQ==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529587515", "bodyText": "I think this is missing the @throws annotation we use in the other method descriptions.", "author": "FrankeLukas", "createdAt": "2020-11-24T14:29:59Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AssessmentService.java", "diffHunk": "@@ -262,4 +271,91 @@ public Double calculateTotalScore(List<Feedback> assessments) {\n         }\n         return totalScore;\n     }\n+\n+    /**\n+     * Gets an example submission with the given submissionId and returns the result of the submission.\n+     *\n+     * @param submissionId the id of the example modeling submission\n+     * @return the result of the submission\n+     * @throws EntityNotFoundException when no submission can be found for the given id\n+     */\n+    public Result getExampleAssessment(long submissionId) {\n+        Optional<Submission> optionalSubmission = submissionRepository.findExampleSubmissionByIdWithEagerResult(submissionId);\n+        Submission submission = optionalSubmission.orElseThrow(() -> new EntityNotFoundException(\"Example Submission with id \\\"\" + submissionId + \"\\\" does not exist\"));\n+        return submission.getResult();\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * For programming exercises we use a different approach see {@link ProgrammingAssessmentService#submitManualAssessment(long)})}\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @param exercise the exercise the assessment belongs to\n+     * @param submissionDate the date manual assessment was submitted\n+     * @return the ResponseEntity with result as body", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5MTA0MA==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529591040", "bodyText": "Missing fullstop.", "author": "FrankeLukas", "createdAt": "2020-11-24T14:34:48Z", "path": "src/main/java/de/tum/in/www1/artemis/service/SubmissionService.java", "diffHunk": "@@ -379,4 +390,29 @@ public boolean checkIfExerciseDueDateIsReached(Exercise exercise) {\n         }\n         return true;\n     }\n+\n+    /**\n+     * Given an exerciseId, returns all the submissions for that exercise, including their results. Submissions can be filtered to include only already submitted\n+     * submissions", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5MTc4Nw==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529591787", "bodyText": "Codacy Production: Useless parentheses.", "author": "FrankeLukas", "createdAt": "2020-11-24T14:35:49Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/AssessmentResource.java", "diffHunk": "@@ -34,19 +35,90 @@\n \n     protected final ExamService examService;\n \n+    protected final WebsocketMessagingService messagingService;\n+\n     public AssessmentResource(AuthorizationCheckService authCheckService, UserService userService, ExerciseService exerciseService, SubmissionService submissionService,\n-            AssessmentService assessmentService, ResultRepository resultRepository, ExamService examService) {\n+            AssessmentService assessmentService, ResultRepository resultRepository, ExamService examService, WebsocketMessagingService messagingService) {\n         this.authCheckService = authCheckService;\n         this.userService = userService;\n         this.exerciseService = exerciseService;\n         this.submissionService = submissionService;\n         this.assessmentService = assessmentService;\n         this.resultRepository = resultRepository;\n         this.examService = examService;\n+        this.messagingService = messagingService;\n     }\n \n     abstract String getEntityName();\n \n+    /**\n+     * Get the result of the submission with the given id. Returns a 403 Forbidden response if the user is not allowed to retrieve the assessment. The user is not allowed\n+     * to retrieve the assessment if he is not a student of the corresponding course, the submission is not his submission, the result is not finished or the assessment due date of\n+     * the corresponding exercise is in the future (or not set).\n+     *\n+     * @param submissionId the id of the submission that should be sent to the client\n+     * @return the assessment of the given id\n+     */\n+    ResponseEntity<Result> getAssessmentBySubmissionId(Long submissionId) {\n+        log.debug(\"REST request to get assessment for submission with id {}\", submissionId);\n+        Submission submission = submissionService.findOneWithEagerResultAndFeedback(submissionId);\n+        StudentParticipation participation = (StudentParticipation) submission.getParticipation();\n+        Exercise exercise = participation.getExercise();\n+\n+        Result result = submission.getResult();\n+        if (result == null) {\n+            return notFound();\n+        }\n+\n+        if (!authCheckService.isUserAllowedToGetResult(exercise, participation, result)) {\n+            return forbidden();\n+        }\n+\n+        // remove sensitive information for students\n+        if (!authCheckService.isAtLeastTeachingAssistantForExercise(exercise)) {\n+            exercise.filterSensitiveInformation();\n+            result.setAssessor(null);\n+        }\n+\n+        return ResponseEntity.ok(result);\n+    }\n+\n+    /**\n+     * Save or submit manual assessment depending on the submit flag.\n+     *\n+     * @param submission the submission containing the assessment\n+     * @param feedbackList list of feedbacks\n+     * @param submit if true the assessment is submitted, else only saved\n+     * @return result after saving/submitting modeling assessment\n+     */\n+    ResponseEntity<Result> saveAssessment(Submission submission, boolean submit, List<Feedback> feedbackList) {\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        StudentParticipation studentParticipation = (StudentParticipation) submission.getParticipation();\n+        long exerciseId = studentParticipation.getExercise().getId();\n+        Exercise exercise = exerciseService.findOne(exerciseId);\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(submission.getResult(), exercise, studentParticipation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the submission \" + submission.getId());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        Result result = assessmentService.saveManualAssessment(submission, feedbackList);\n+        if (submit) {\n+            result = assessmentService.submitManualAssessment(result.getId(), exercise, submission.getSubmissionDate());\n+        }\n+        // remove information about the student for tutors to ensure double-blind assessment\n+        if (!isAtLeastInstructor) {\n+            ((StudentParticipation) result.getParticipation()).filterSensitiveInformation();\n+        }\n+        if (submit && ((result.getParticipation()).getExercise().getAssessmentDueDate() == null\n+                || (result.getParticipation()).getExercise().getAssessmentDueDate().isBefore(ZonedDateTime.now()))) {", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5MjE2OQ==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529592169", "bodyText": "Codacy Production: Avoid long parameter lists.", "author": "FrankeLukas", "createdAt": "2020-11-24T14:36:19Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileUploadSubmissionResource.java", "diffHunk": "@@ -42,44 +42,34 @@\n \n     private final FileUploadExerciseService fileUploadExerciseService;\n \n-    private final AuthorizationCheckService authCheckService;\n-\n-    private final ExerciseService exerciseService;\n-\n-    private final UserService userService;\n-\n-    private final ParticipationService participationService;\n-\n     private final GradingCriterionService gradingCriterionService;\n \n     private final ExamSubmissionService examSubmissionService;\n \n-    public FileUploadSubmissionResource(FileUploadSubmissionService fileUploadSubmissionService, FileUploadExerciseService fileUploadExerciseService,\n-            AuthorizationCheckService authCheckService, UserService userService, ExerciseService exerciseService, ParticipationService participationService,\n-            GradingCriterionService gradingCriterionService, ExamSubmissionService examSubmissionService) {\n-        this.userService = userService;\n-        this.exerciseService = exerciseService;\n+    public FileUploadSubmissionResource(SubmissionRepository submissionRepository, ResultService resultService, FileUploadSubmissionService fileUploadSubmissionService,", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5MjMyOA==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529592328", "bodyText": "Codacy Production: Avoid long parameter lists.", "author": "FrankeLukas", "createdAt": "2020-11-24T14:36:32Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ModelingSubmissionResource.java", "diffHunk": "@@ -53,39 +53,25 @@\n \n     private final ModelingExerciseService modelingExerciseService;\n \n-    private final ParticipationService participationService;\n-\n-    private final CourseService courseService;\n-\n-    private final AuthorizationCheckService authCheckService;\n-\n     private final CompassService compassService;\n \n-    private final ExerciseService exerciseService;\n-\n-    private final UserService userService;\n-\n     private final GradingCriterionService gradingCriterionService;\n \n     private final ExamSubmissionService examSubmissionService;\n \n-    public ModelingSubmissionResource(ModelingSubmissionService modelingSubmissionService, ModelingExerciseService modelingExerciseService,\n-            ParticipationService participationService, CourseService courseService, AuthorizationCheckService authCheckService, CompassService compassService,\n+    public ModelingSubmissionResource(SubmissionRepository submissionRepository, ResultService resultService, ModelingSubmissionService modelingSubmissionService,", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5MzA3Ng==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529593076", "bodyText": "Maybe I'm missing something, but this does not appear to call result.setAssessmentType(AssessmentType.MANUAL);?", "author": "FrankeLukas", "createdAt": "2020-11-24T14:37:31Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AssessmentService.java", "diffHunk": "@@ -262,4 +271,91 @@ public Double calculateTotalScore(List<Feedback> assessments) {\n         }\n         return totalScore;\n     }\n+\n+    /**\n+     * Gets an example submission with the given submissionId and returns the result of the submission.\n+     *\n+     * @param submissionId the id of the example modeling submission\n+     * @return the result of the submission\n+     * @throws EntityNotFoundException when no submission can be found for the given id\n+     */\n+    public Result getExampleAssessment(long submissionId) {\n+        Optional<Submission> optionalSubmission = submissionRepository.findExampleSubmissionByIdWithEagerResult(submissionId);\n+        Submission submission = optionalSubmission.orElseThrow(() -> new EntityNotFoundException(\"Example Submission with id \\\"\" + submissionId + \"\\\" does not exist\"));\n+        return submission.getResult();\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5NTA3MA==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529595070", "bodyText": "Fwiw, submitResult already does this, so doing it here looks redundant.", "author": "FrankeLukas", "createdAt": "2020-11-24T14:40:13Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AssessmentService.java", "diffHunk": "@@ -262,4 +271,91 @@ public Double calculateTotalScore(List<Feedback> assessments) {\n         }\n         return totalScore;\n     }\n+\n+    /**\n+     * Gets an example submission with the given submissionId and returns the result of the submission.\n+     *\n+     * @param submissionId the id of the example modeling submission\n+     * @return the result of the submission\n+     * @throws EntityNotFoundException when no submission can be found for the given id\n+     */\n+    public Result getExampleAssessment(long submissionId) {\n+        Optional<Submission> optionalSubmission = submissionRepository.findExampleSubmissionByIdWithEagerResult(submissionId);\n+        Submission submission = optionalSubmission.orElseThrow(() -> new EntityNotFoundException(\"Example Submission with id \\\"\" + submissionId + \"\\\" does not exist\"));\n+        return submission.getResult();\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * For programming exercises we use a different approach see {@link ProgrammingAssessmentService#submitManualAssessment(long)})}\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @param exercise the exercise the assessment belongs to\n+     * @param submissionDate the date manual assessment was submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    public Result submitManualAssessment(long resultId, Exercise exercise, ZonedDateTime submissionDate) {\n+        Result result = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(resultId)\n+                .orElseThrow(() -> new EntityNotFoundException(\"No result for the given resultId could be found\"));\n+        result.setRatedIfNotExceeded(exercise.getDueDate(), submissionDate);\n+        result.setCompletionDate(ZonedDateTime.now());", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5NTY0MA==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529595640", "bodyText": "submitResult might overwrite this with another submissionDate. Are we sure this is not a problem here?", "author": "FrankeLukas", "createdAt": "2020-11-24T14:40:59Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AssessmentService.java", "diffHunk": "@@ -262,4 +271,91 @@ public Double calculateTotalScore(List<Feedback> assessments) {\n         }\n         return totalScore;\n     }\n+\n+    /**\n+     * Gets an example submission with the given submissionId and returns the result of the submission.\n+     *\n+     * @param submissionId the id of the example modeling submission\n+     * @return the result of the submission\n+     * @throws EntityNotFoundException when no submission can be found for the given id\n+     */\n+    public Result getExampleAssessment(long submissionId) {\n+        Optional<Submission> optionalSubmission = submissionRepository.findExampleSubmissionByIdWithEagerResult(submissionId);\n+        Submission submission = optionalSubmission.orElseThrow(() -> new EntityNotFoundException(\"Example Submission with id \\\"\" + submissionId + \"\\\" does not exist\"));\n+        return submission.getResult();\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * For programming exercises we use a different approach see {@link ProgrammingAssessmentService#submitManualAssessment(long)})}\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @param exercise the exercise the assessment belongs to\n+     * @param submissionDate the date manual assessment was submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    public Result submitManualAssessment(long resultId, Exercise exercise, ZonedDateTime submissionDate) {\n+        Result result = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(resultId)\n+                .orElseThrow(() -> new EntityNotFoundException(\"No result for the given resultId could be found\"));\n+        result.setRatedIfNotExceeded(exercise.getDueDate(), submissionDate);", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5NzkwMg==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529597902", "bodyText": "Hm, I just saw we are copying this over line by line, so I guess this is not a problem (for this PR).", "author": "FrankeLukas", "createdAt": "2020-11-24T14:43:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5NTY0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5ODgzNw==", "url": "https://github.com/ls1intum/Artemis/pull/2438#discussion_r529598837", "bodyText": "This can be converted to an @throws annotation.", "author": "FrankeLukas", "createdAt": "2020-11-24T14:45:06Z", "path": "src/main/java/de/tum/in/www1/artemis/service/SubmissionService.java", "diffHunk": "@@ -202,6 +201,18 @@ public Submission findOneWithEagerResult(long submissionId) {\n                 .orElseThrow(() -> new EntityNotFoundException(\"Submission with id \\\"\" + submissionId + \"\\\" does not exist\"));\n     }\n \n+    /**\n+     * Get the submission with the given id from the database. The submission is loaded together with its result, the feedback of the result and the assessor of the\n+     * result. Throws an EntityNotFoundException if no submission could be found for the given id.", "originalCommit": "4efa07733fe19b2ecaa415f4e836910340d22b47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}