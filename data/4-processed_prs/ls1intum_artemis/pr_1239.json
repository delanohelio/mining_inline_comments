{"pr_number": 1239, "pr_title": "Chore/test coverage/management resource", "pr_createdAt": "2020-02-11T08:36:19Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1239", "timeline": [{"oid": "78ca8ac71054aeeb910db00fabab890ac91f5474", "url": "https://github.com/ls1intum/Artemis/commit/78ca8ac71054aeeb910db00fabab890ac91f5474", "message": "Add tests for management resource", "committedDate": "2020-02-10T19:42:33Z", "type": "commit"}, {"oid": "472e3ad731dab9445b9b9ed10629978d5af65762", "url": "https://github.com/ls1intum/Artemis/commit/472e3ad731dab9445b9b9ed10629978d5af65762", "message": "Add test case to get all audit events", "committedDate": "2020-02-11T07:42:08Z", "type": "commit"}, {"oid": "e259a83f97c031eeba4bcc66857601f6b10d28e7", "url": "https://github.com/ls1intum/Artemis/commit/e259a83f97c031eeba4bcc66857601f6b10d28e7", "message": "Add test cases for getting all audit events by date", "committedDate": "2020-02-11T08:30:44Z", "type": "commit"}, {"oid": "2ea804e2dcacadd42054594fa0e0c4ba6cf9c135", "url": "https://github.com/ls1intum/Artemis/commit/2ea804e2dcacadd42054594fa0e0c4ba6cf9c135", "message": "Merge branch 'develop' into chore/test-coverage/management-resource", "committedDate": "2020-02-11T08:44:41Z", "type": "commit"}, {"oid": "9b04c55b084cbc44affd8a88c38ed409df14b6df", "url": "https://github.com/ls1intum/Artemis/commit/9b04c55b084cbc44affd8a88c38ed409df14b6df", "message": "Merge branch 'develop' into chore/test-coverage/management-resource", "committedDate": "2020-02-17T00:54:52Z", "type": "commit"}, {"oid": "8720fa5ba347731e348a4afd5b131fe361b1877e", "url": "https://github.com/ls1intum/Artemis/commit/8720fa5ba347731e348a4afd5b131fe361b1877e", "message": "Load data for findAll and extended test case", "committedDate": "2020-02-17T09:34:06Z", "type": "commit"}, {"oid": "63584844c4993019cd534dc29e33ac52337f277d", "url": "https://github.com/ls1intum/Artemis/commit/63584844c4993019cd534dc29e33ac52337f277d", "message": "Merge branch 'develop' into chore/test-coverage/management-resource", "committedDate": "2020-02-17T19:14:12Z", "type": "commit"}, {"oid": "6c36cb086fce74a27488d127c042b351087cfacf", "url": "https://github.com/ls1intum/Artemis/commit/6c36cb086fce74a27488d127c042b351087cfacf", "message": "Add database reset to the tests", "committedDate": "2020-02-17T21:28:30Z", "type": "commit"}, {"oid": "bd0753c0187efa2a14b8b3c39348424ea77589d6", "url": "https://github.com/ls1intum/Artemis/commit/bd0753c0187efa2a14b8b3c39348424ea77589d6", "message": "Merge remote-tracking branch 'origin/chore/test-coverage/management-resource' into chore/test-coverage/management-resource", "committedDate": "2020-02-17T21:28:37Z", "type": "commit"}, {"oid": "e0cd4c9a602ed802c4689f9a405ba05e5d58f1d5", "url": "https://github.com/ls1intum/Artemis/commit/e0cd4c9a602ed802c4689f9a405ba05e5d58f1d5", "message": "Add last test case", "committedDate": "2020-02-18T06:34:10Z", "type": "commit"}, {"oid": "56808d641ce8f5cd97d98bc7b4e4fac6ee660a7f", "url": "https://github.com/ls1intum/Artemis/commit/56808d641ce8f5cd97d98bc7b4e4fac6ee660a7f", "message": "Fixed tests", "committedDate": "2020-02-18T13:34:57Z", "type": "commit"}, {"oid": "b4a50270153595a1888408ad9d5fd029376d0d1e", "url": "https://github.com/ls1intum/Artemis/commit/b4a50270153595a1888408ad9d5fd029376d0d1e", "message": "Extended test checks", "committedDate": "2020-02-18T13:51:13Z", "type": "commit"}, {"oid": "1d58c6f658bc108b8ac113219f0a4964706dfe40", "url": "https://github.com/ls1intum/Artemis/commit/1d58c6f658bc108b8ac113219f0a4964706dfe40", "message": "Remove unnecessary users", "committedDate": "2020-02-18T13:53:23Z", "type": "commit"}, {"oid": "21993a723047152388ff57d644e1c427d644acbd", "url": "https://github.com/ls1intum/Artemis/commit/21993a723047152388ff57d644e1c427d644acbd", "message": "Add missing import", "committedDate": "2020-02-18T14:41:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk5NDIzNw==", "url": "https://github.com/ls1intum/Artemis/pull/1239#discussion_r380994237", "bodyText": "please do not use a SpyBean here. This significantly increases test execution costs and we absolutely want to avoid it for simple cases in which we can easily avoid this!", "author": "krusche", "createdAt": "2020-02-18T23:21:23Z", "path": "src/test/java/de/tum/in/www1/artemis/ManagementResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.verify;\n+\n+import java.time.Instant;\n+import java.time.LocalDate;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.mock.mockito.SpyBean;\n+import org.springframework.data.domain.PageImpl;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.config.audit.AuditEventConverter;\n+import de.tum.in.www1.artemis.domain.PersistentAuditEvent;\n+import de.tum.in.www1.artemis.service.AuditEventService;\n+import de.tum.in.www1.artemis.service.feature.Feature;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class ManagementResourceIntegrationTest extends AbstractSpringIntegrationTest {\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @SpyBean\n+    AuditEventService auditEventService;", "originalCommit": "08520f49eb2a222710eb2ea096ac14ab6ee1db94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "21993a723047152388ff57d644e1c427d644acbd", "url": "https://github.com/ls1intum/Artemis/commit/21993a723047152388ff57d644e1c427d644acbd", "message": "Add missing import", "committedDate": "2020-02-18T14:41:47Z", "type": "forcePushed"}, {"oid": "0a0098bebf9a6668f8c4612d870ec978de2d14af", "url": "https://github.com/ls1intum/Artemis/commit/0a0098bebf9a6668f8c4612d870ec978de2d14af", "message": "Merge branch 'develop' into chore/test-coverage/management-resource", "committedDate": "2020-02-23T20:33:25Z", "type": "commit"}, {"oid": "d13fbdf58f7a838ce62516b9ac92fae62d902fb7", "url": "https://github.com/ls1intum/Artemis/commit/d13fbdf58f7a838ce62516b9ac92fae62d902fb7", "message": "Don't remove persistent audit events", "committedDate": "2020-02-23T20:40:27Z", "type": "commit"}, {"oid": "368d7845c50274694b8b3db68e2cec3d31d6773f", "url": "https://github.com/ls1intum/Artemis/commit/368d7845c50274694b8b3db68e2cec3d31d6773f", "message": "Merge remote-tracking branch 'origin/chore/test-coverage/management-resource' into chore/test-coverage/management-resource", "committedDate": "2020-02-23T20:40:50Z", "type": "commit"}, {"oid": "2477751048ddc98d93e0048ecc1513866048292c", "url": "https://github.com/ls1intum/Artemis/commit/2477751048ddc98d93e0048ecc1513866048292c", "message": "Updated tests to pass checks", "committedDate": "2020-02-23T20:57:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2NTk2Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1239#discussion_r383765966", "bodyText": "reset the status of the FeatureToggle", "author": "krusche", "createdAt": "2020-02-25T09:45:58Z", "path": "src/test/java/de/tum/in/www1/artemis/ManagementResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,110 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+\n+import java.time.Instant;\n+import java.time.LocalDate;\n+import java.time.temporal.ChronoUnit;\n+import java.util.HashMap;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.config.audit.AuditEventConverter;\n+import de.tum.in.www1.artemis.domain.PersistentAuditEvent;\n+import de.tum.in.www1.artemis.repository.PersistenceAuditEventRepository;\n+import de.tum.in.www1.artemis.service.AuditEventService;\n+import de.tum.in.www1.artemis.service.feature.Feature;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class ManagementResourceIntegrationTest extends AbstractSpringIntegrationTest {\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    AuditEventService auditEventService;\n+\n+    @Autowired\n+    PersistenceAuditEventRepository persistenceAuditEventRepository;\n+\n+    @Autowired\n+    AuditEventConverter auditEventConverter;\n+\n+    private PersistentAuditEvent persAuditEvent;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        database.addUsers(0, 0, 0);\n+        persAuditEvent = new PersistentAuditEvent();\n+        persAuditEvent.setPrincipal(\"student1\");\n+        persAuditEvent.setAuditEventDate(Instant.now());\n+        persAuditEvent.setAuditEventType(\"type\");\n+        var data = new HashMap<String, String>();\n+        data.put(\"1\", \"2\");\n+        persAuditEvent.setData(data);\n+        persistenceAuditEventRepository.deleteAll();\n+        persAuditEvent = persistenceAuditEventRepository.save(persAuditEvent);\n+\n+        var persAuditEvent2 = new PersistentAuditEvent();\n+        persAuditEvent2.setPrincipal(\"student2\");\n+        persAuditEvent2.setAuditEventDate(Instant.now().minus(5, ChronoUnit.DAYS));\n+        persAuditEvent2.setAuditEventType(\"tt\");\n+        persAuditEvent2.setData(data);\n+        persistenceAuditEventRepository.save(persAuditEvent2);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() {\n+        database.resetDatabase();", "originalCommit": "2477751048ddc98d93e0048ecc1513866048292c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgxOTgzMg==", "url": "https://github.com/ls1intum/Artemis/pull/1239#discussion_r384819832", "bodyText": "Done", "author": "maxr96", "createdAt": "2020-02-26T23:00:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2NTk2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2NjY0NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1239#discussion_r383766645", "bodyText": "Please test that at least 5 secured REST calls for the Feature Toggles work when the feature is enabled, and do not work (return FORBIDDEN), when the feature is disabled", "author": "krusche", "createdAt": "2020-02-25T09:47:06Z", "path": "src/test/java/de/tum/in/www1/artemis/ManagementResourceIntegrationTest.java", "diffHunk": "@@ -0,0 +1,110 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+\n+import java.time.Instant;\n+import java.time.LocalDate;\n+import java.time.temporal.ChronoUnit;\n+import java.util.HashMap;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.config.audit.AuditEventConverter;\n+import de.tum.in.www1.artemis.domain.PersistentAuditEvent;\n+import de.tum.in.www1.artemis.repository.PersistenceAuditEventRepository;\n+import de.tum.in.www1.artemis.service.AuditEventService;\n+import de.tum.in.www1.artemis.service.feature.Feature;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class ManagementResourceIntegrationTest extends AbstractSpringIntegrationTest {\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    AuditEventService auditEventService;\n+\n+    @Autowired\n+    PersistenceAuditEventRepository persistenceAuditEventRepository;\n+\n+    @Autowired\n+    AuditEventConverter auditEventConverter;\n+\n+    private PersistentAuditEvent persAuditEvent;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        database.addUsers(0, 0, 0);\n+        persAuditEvent = new PersistentAuditEvent();\n+        persAuditEvent.setPrincipal(\"student1\");\n+        persAuditEvent.setAuditEventDate(Instant.now());\n+        persAuditEvent.setAuditEventType(\"type\");\n+        var data = new HashMap<String, String>();\n+        data.put(\"1\", \"2\");\n+        persAuditEvent.setData(data);\n+        persistenceAuditEventRepository.deleteAll();\n+        persAuditEvent = persistenceAuditEventRepository.save(persAuditEvent);\n+\n+        var persAuditEvent2 = new PersistentAuditEvent();\n+        persAuditEvent2.setPrincipal(\"student2\");\n+        persAuditEvent2.setAuditEventDate(Instant.now().minus(5, ChronoUnit.DAYS));\n+        persAuditEvent2.setAuditEventType(\"tt\");\n+        persAuditEvent2.setData(data);\n+        persistenceAuditEventRepository.save(persAuditEvent2);\n+    }\n+\n+    @AfterEach\n+    public void tearDown() {\n+        database.resetDatabase();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"admin\", roles = \"ADMIN\")\n+    public void toggleFeatures() throws Exception {\n+        var features = new HashMap<Feature, Boolean>();", "originalCommit": "2477751048ddc98d93e0048ecc1513866048292c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgxOTgwMg==", "url": "https://github.com/ls1intum/Artemis/pull/1239#discussion_r384819802", "bodyText": "Added 5 calls from different resources", "author": "maxr96", "createdAt": "2020-02-26T23:00:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2NjY0NQ=="}], "type": "inlineReview"}, {"oid": "1068c977a61885e91c81b4132228bb7067750707", "url": "https://github.com/ls1intum/Artemis/commit/1068c977a61885e91c81b4132228bb7067750707", "message": "Add 2 cases for checking calls to programming exercise with feature toggle", "committedDate": "2020-02-26T07:13:00Z", "type": "commit"}, {"oid": "39bbb3003d3b33f9cf1891770bb85fe25a4f2915", "url": "https://github.com/ls1intum/Artemis/commit/39bbb3003d3b33f9cf1891770bb85fe25a4f2915", "message": "Reach 5 rest endpoints triggered", "committedDate": "2020-02-26T22:38:05Z", "type": "commit"}, {"oid": "d8ba90da521f89f83426834ebf3475c46ea64587", "url": "https://github.com/ls1intum/Artemis/commit/d8ba90da521f89f83426834ebf3475c46ea64587", "message": "Merge branch 'develop' into chore/test-coverage/management-resource", "committedDate": "2020-02-26T22:41:02Z", "type": "commit"}, {"oid": "eba989385667663cacea2e5d74ab66fd86843b56", "url": "https://github.com/ls1intum/Artemis/commit/eba989385667663cacea2e5d74ab66fd86843b56", "message": "Merge branch 'develop' into chore/test-coverage/management-resource", "committedDate": "2020-02-29T15:12:48Z", "type": "commit"}]}