{"pr_number": 1224, "pr_title": "Chore/test coverage/complaint resource lecture resource", "pr_createdAt": "2020-02-03T23:34:08Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1224", "timeline": [{"oid": "a8e2398346a3b29ef388837d9b9db5acdc9a146c", "url": "https://github.com/ls1intum/Artemis/commit/a8e2398346a3b29ef388837d9b9db5acdc9a146c", "message": "add test for rest call getComplaintsById", "committedDate": "2020-02-03T18:30:15Z", "type": "commit"}, {"oid": "ef38807c17ba6a34a5d68ad1189f42573c0fd54d", "url": "https://github.com/ls1intum/Artemis/commit/ef38807c17ba6a34a5d68ad1189f42573c0fd54d", "message": "add tests for lectureResource", "committedDate": "2020-02-03T22:32:04Z", "type": "commit"}, {"oid": "55f001cb2a76e2e8b57f6a8ff74b2ece353a09c9", "url": "https://github.com/ls1intum/Artemis/commit/55f001cb2a76e2e8b57f6a8ff74b2ece353a09c9", "message": "Merge branch 'develop' into chore/test-coverage/ComplaintResource", "committedDate": "2020-02-03T22:34:21Z", "type": "commit"}, {"oid": "730e85fcac6effabccb889998d6b321da3028cd8", "url": "https://github.com/ls1intum/Artemis/commit/730e85fcac6effabccb889998d6b321da3028cd8", "message": "add tests for LectureResource", "committedDate": "2020-02-03T23:24:32Z", "type": "commit"}, {"oid": "721e9ec12bc4f79727cb006d14287a4623be21e1", "url": "https://github.com/ls1intum/Artemis/commit/721e9ec12bc4f79727cb006d14287a4623be21e1", "message": "add test case to get lectured by courseId", "committedDate": "2020-02-04T08:50:23Z", "type": "commit"}, {"oid": "ab9800a0b46fe40cc9659bdce7cc21a23b768938", "url": "https://github.com/ls1intum/Artemis/commit/ab9800a0b46fe40cc9659bdce7cc21a23b768938", "message": "fix java code style", "committedDate": "2020-02-04T08:59:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4NjQwNA==", "url": "https://github.com/ls1intum/Artemis/pull/1224#discussion_r374586404", "bodyText": "Shouldn't the exercise be taken from the passed in receivedComplaint that is the result of a REST call? As far as I can see, modelingExercise is simply taken from the database and could thus contain very different information than exericse in the lines above. I think something along those lines would make more sense (I didn't test it but you get the idea):\nif (exercise instanceof ModelingExercise) {\n  ModelingExercise modelingExercise = (ModelingExercise) exercise;\n  assertThat(modelingExercise.getSampleSolutionModel()).as(\"Exercise only contains title and ID\").isNull();\n}", "author": "madwau", "createdAt": "2020-02-04T10:22:39Z", "path": "src/test/java/de/tum/in/www1/artemis/AssessmentComplaintIntegrationTest.java", "diffHunk": "@@ -429,6 +440,8 @@ private void checkIfNoSensitiveExerciseDataPresent(Complaint receivedComplaint)\n             assertThat(exercise.getStudentParticipations()).as(\"Exercise only contains title and ID\").isNullOrEmpty();\n             assertThat(exercise.getTutorParticipations()).as(\"Exercise only contains title and ID\").isNullOrEmpty();\n             // TODO check exercise type specific sensitive attributes\n+            assertThat(modelingExercise.getSampleSolutionModel()).as(\"Exercise only contains title and ID\").isNull();", "originalCommit": "ab9800a0b46fe40cc9659bdce7cc21a23b768938", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4ODE5NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1224#discussion_r374588195", "bodyText": "The method name would suggest that the lecture itself also gets saved. I also saw that in most use cases, the lecture is saved after this method is called. Maybe it makes sense to have a boolean flag for this where the default is that the lecture also gets saved?", "author": "madwau", "createdAt": "2020-02-04T10:26:20Z", "path": "src/test/java/de/tum/in/www1/artemis/util/DatabaseUtilService.java", "diffHunk": "@@ -268,6 +268,17 @@ public void addTeachingAssistant(final String taGroup, final String taName) {\n         assertThat(ta.getId()).as(\"Teaching assistant has been created\").isNotNull();\n     }\n \n+    public Lecture createCourseWithLecture() {\n+        Course course = ModelFactory.generateCourse(null, pastTimestamp, futureFutureTimestamp, new HashSet<>(), \"tumuser\", \"tutor\", \"instructor\");\n+\n+        Lecture lecture = new Lecture();\n+        lecture.setDescription(\"Test Lecture\");\n+        lecture.setCourse(course);\n+        courseRepo.save(course);\n+        // lectureRepo.save(lecture);", "originalCommit": "ab9800a0b46fe40cc9659bdce7cc21a23b768938", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4OTM4Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1224#discussion_r374589383", "bodyText": "This is not actually testing if an update has been performed. Could you change an attribute and then verify that it has actually changed?", "author": "madwau", "createdAt": "2020-02-04T10:28:36Z", "path": "src/test/java/de/tum/in/www1/artemis/LectureIntegrationTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.Lecture;\n+import de.tum.in.www1.artemis.repository.LectureRepository;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class LectureIntegrationTest extends AbstractSpringIntegrationTest {\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    LectureRepository lectureRepo;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        database.addUsers(1, 1, 1);\n+\n+    }\n+\n+    @AfterEach\n+    public void resetDatabase() {\n+        database.resetDatabase();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void getLectureWithPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        lectureRepo.save(lecture);\n+        Lecture savedLecture = lectureRepo.findAll().get(0);\n+\n+        Lecture receivedLecture = request.get(\"/api/lectures/\" + lecture.getId(), HttpStatus.OK, Lecture.class);\n+\n+        assertThat(savedLecture.getId()).isEqualTo(receivedLecture.getId());\n+        assertThat(savedLecture).isEqualTo(receivedLecture);\n+\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = \"USER\")\n+    public void getLectureForCourseNoPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        lectureRepo.save(lecture);\n+        Course course = lectureRepo.findAll().get(0).getCourse();\n+        request.get(\"/api/courses/\" + course.getId() + \"/lectures\", HttpStatus.FORBIDDEN, Lecture.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = \"USER\")\n+    public void createLectureNoPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        request.postWithResponseBody(\"/api/lectures\", lecture, Lecture.class, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void createLectureWithPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        Lecture receivedLecture = request.postWithResponseBody(\"/api/lectures\", lecture, Lecture.class);\n+\n+        assertThat(receivedLecture).isNotNull();\n+        assertThat(receivedLecture.getId()).isNotNull();\n+        assertThat(receivedLecture.getDescription()).isEqualTo(\"Test Lecture\");\n+\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void updateLectureWithPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        lectureRepo.save(lecture);\n+        request.putWithResponseBody(\"/api/lectures\", lecture, Lecture.class, HttpStatus.OK);", "originalCommit": "ab9800a0b46fe40cc9659bdce7cc21a23b768938", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU5MDA5OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1224#discussion_r374590099", "bodyText": "Can tutors delete a lecture? If not, maybe add another test or change the role.", "author": "madwau", "createdAt": "2020-02-04T10:30:01Z", "path": "src/test/java/de/tum/in/www1/artemis/LectureIntegrationTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package de.tum.in.www1.artemis;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.security.test.context.support.WithMockUser;\n+\n+import de.tum.in.www1.artemis.domain.Course;\n+import de.tum.in.www1.artemis.domain.Lecture;\n+import de.tum.in.www1.artemis.repository.LectureRepository;\n+import de.tum.in.www1.artemis.util.DatabaseUtilService;\n+import de.tum.in.www1.artemis.util.RequestUtilService;\n+\n+public class LectureIntegrationTest extends AbstractSpringIntegrationTest {\n+\n+    @Autowired\n+    DatabaseUtilService database;\n+\n+    @Autowired\n+    RequestUtilService request;\n+\n+    @Autowired\n+    LectureRepository lectureRepo;\n+\n+    @BeforeEach\n+    public void initTestCase() {\n+        database.addUsers(1, 1, 1);\n+\n+    }\n+\n+    @AfterEach\n+    public void resetDatabase() {\n+        database.resetDatabase();\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void getLectureWithPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        lectureRepo.save(lecture);\n+        Lecture savedLecture = lectureRepo.findAll().get(0);\n+\n+        Lecture receivedLecture = request.get(\"/api/lectures/\" + lecture.getId(), HttpStatus.OK, Lecture.class);\n+\n+        assertThat(savedLecture.getId()).isEqualTo(receivedLecture.getId());\n+        assertThat(savedLecture).isEqualTo(receivedLecture);\n+\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = \"USER\")\n+    public void getLectureForCourseNoPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        lectureRepo.save(lecture);\n+        Course course = lectureRepo.findAll().get(0).getCourse();\n+        request.get(\"/api/courses/\" + course.getId() + \"/lectures\", HttpStatus.FORBIDDEN, Lecture.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = \"USER\")\n+    public void createLectureNoPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        request.postWithResponseBody(\"/api/lectures\", lecture, Lecture.class, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void createLectureWithPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        Lecture receivedLecture = request.postWithResponseBody(\"/api/lectures\", lecture, Lecture.class);\n+\n+        assertThat(receivedLecture).isNotNull();\n+        assertThat(receivedLecture.getId()).isNotNull();\n+        assertThat(receivedLecture.getDescription()).isEqualTo(\"Test Lecture\");\n+\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void updateLectureWithPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        lectureRepo.save(lecture);\n+        request.putWithResponseBody(\"/api/lectures\", lecture, Lecture.class, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = \"USER\")\n+    public void updateLectureNoPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        lectureRepo.save(lecture);\n+        request.putWithResponseBody(\"/api/lectures\", lecture, Lecture.class, HttpStatus.FORBIDDEN);\n+\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void deleteLectureWithPermission() throws Exception {\n+        Lecture lecture = database.createCourseWithLecture();\n+        lectureRepo.save(lecture);\n+        request.delete(\"/api/lectures/\" + lecture.getId(), HttpStatus.OK);\n+        assertThat(lectureRepo.findAll().isEmpty()).isTrue();\n+\n+    }\n+\n+    @Test\n+    @WithMockUser(roles = \"USER\")", "originalCommit": "ab9800a0b46fe40cc9659bdce7cc21a23b768938", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwMTA3MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1224#discussion_r374601071", "bodyText": "Yes, they do not have permission to delete a lecture. However, since TA is a subset of USER I would argue that it should be covered by this test case. I could still add a separate test tho as it has no bad effect :)", "author": "HanyaElhashemy", "createdAt": "2020-02-04T10:52:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU5MDA5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczNjIzOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1224#discussion_r374736239", "bodyText": "I don't think it's covered: It could both be true that the test succeeds and that a tutor is able to delete a lecture since a regular user might be denied but a tutor not.", "author": "madwau", "createdAt": "2020-02-04T15:21:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU5MDA5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwNDUwNQ==", "url": "https://github.com/ls1intum/Artemis/pull/1224#discussion_r375404505", "bodyText": "I don't think tutors should be able to delete lectures. If this is possible, we should change it so that only instructors can delete it.", "author": "krusche", "createdAt": "2020-02-05T17:37:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU5MDA5OQ=="}], "type": "inlineReview"}, {"oid": "b97c5a832fc734e5c65e2b8716873761d755941d", "url": "https://github.com/ls1intum/Artemis/commit/b97c5a832fc734e5c65e2b8716873761d755941d", "message": "Apply PR review feedback on LectureIntegrationTest", "committedDate": "2020-02-04T11:02:15Z", "type": "commit"}, {"oid": "25fe673b1a17455994d6ab18d171fe7584f0fa40", "url": "https://github.com/ls1intum/Artemis/commit/25fe673b1a17455994d6ab18d171fe7584f0fa40", "message": "fix tests", "committedDate": "2020-02-04T13:09:04Z", "type": "commit"}, {"oid": "8459040e16ea09997e4c3826f46f9d6960ff4767", "url": "https://github.com/ls1intum/Artemis/commit/8459040e16ea09997e4c3826f46f9d6960ff4767", "message": "add test for getLectureByCourse", "committedDate": "2020-02-04T14:51:24Z", "type": "commit"}, {"oid": "b21e4a88c7908d2f3562b048089dfabd652d4a48", "url": "https://github.com/ls1intum/Artemis/commit/b21e4a88c7908d2f3562b048089dfabd652d4a48", "message": "add test coverage for ComplaintResource", "committedDate": "2020-02-05T17:07:55Z", "type": "commit"}]}