{"pr_number": 2439, "pr_title": "Enhancement/tests modeling assessment dashboard", "pr_createdAt": "2020-11-20T21:51:06Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2439", "timeline": [{"oid": "5fa30b7782cc48c706ec7fc114b5bf83f41d7b04", "url": "https://github.com/ls1intum/Artemis/commit/5fa30b7782cc48c706ec7fc114b5bf83f41d7b04", "message": "Added Tests for QuizExercise Statistics", "committedDate": "2020-10-19T20:18:49Z", "type": "commit"}, {"oid": "5bf4d2b3e93911f0c6928c24accdc595e95b882a", "url": "https://github.com/ls1intum/Artemis/commit/5bf4d2b3e93911f0c6928c24accdc595e95b882a", "message": "Added Tests for QuizExercise Statistics", "committedDate": "2020-10-24T12:19:33Z", "type": "commit"}, {"oid": "a89e586a02d72f45b6cd9518a52a6a99156401cd", "url": "https://github.com/ls1intum/Artemis/commit/a89e586a02d72f45b6cd9518a52a6a99156401cd", "message": "Merge branch 'develop' of https://github.com/nicolasruscher/Artemis into develop\n\n* 'develop' of https://github.com/nicolasruscher/Artemis:\n  Added Tests for QuizExercise Statistics", "committedDate": "2020-10-24T12:28:54Z", "type": "commit"}, {"oid": "45fe01db97d56d92fc8941b9e9d9cbc127147cc5", "url": "https://github.com/ls1intum/Artemis/commit/45fe01db97d56d92fc8941b9e9d9cbc127147cc5", "message": "Merge remote-tracking branch 'upstream/develop' into develop", "committedDate": "2020-10-25T12:31:52Z", "type": "commit"}, {"oid": "4a1c3329804094fb387b2e4d5d8a860dd9b190f6", "url": "https://github.com/ls1intum/Artemis/commit/4a1c3329804094fb387b2e4d5d8a860dd9b190f6", "message": "Renamed and reformated quiz-statistics-footer.spec.ts file", "committedDate": "2020-10-25T12:39:06Z", "type": "commit"}, {"oid": "04033ee1f97e1fc47fd3f3327114de0164acdbd8", "url": "https://github.com/ls1intum/Artemis/commit/04033ee1f97e1fc47fd3f3327114de0164acdbd8", "message": "Added additional tests for Quiz Components", "committedDate": "2020-10-26T15:32:30Z", "type": "commit"}, {"oid": "ea25cde0c79dc53833447ecacec81d9f7d8f14c6", "url": "https://github.com/ls1intum/Artemis/commit/ea25cde0c79dc53833447ecacec81d9f7d8f14c6", "message": "Added first tests for QuizStatistic component", "committedDate": "2020-10-27T12:55:52Z", "type": "commit"}, {"oid": "87bf4fee2efb8362fd4d04437bbdacd124d53346", "url": "https://github.com/ls1intum/Artemis/commit/87bf4fee2efb8362fd4d04437bbdacd124d53346", "message": "Reworked some of the code to remove duplicates, added tests", "committedDate": "2020-10-27T16:14:33Z", "type": "commit"}, {"oid": "20d0b25fd690913dcb4c7a04bcd5f8f6e1d89d75", "url": "https://github.com/ls1intum/Artemis/commit/20d0b25fd690913dcb4c7a04bcd5f8f6e1d89d75", "message": "updated tests", "committedDate": "2020-10-29T19:03:41Z", "type": "commit"}, {"oid": "46ef81f52d9845fac649a5bc80b720ccdb35b384", "url": "https://github.com/ls1intum/Artemis/commit/46ef81f52d9845fac649a5bc80b720ccdb35b384", "message": "Merge remote-tracking branch 'upstream/develop' into enhancement/tests-grading-instructions-details", "committedDate": "2020-11-16T15:35:11Z", "type": "commit"}, {"oid": "1e078f12ef6113f06b66dace6fd8f17f590353cb", "url": "https://github.com/ls1intum/Artemis/commit/1e078f12ef6113f06b66dace6fd8f17f590353cb", "message": "init branch and added first tests", "committedDate": "2020-11-17T08:03:39Z", "type": "commit"}, {"oid": "6f76026df75bfe9d9d42dbc24d6ddb11bfe0e0fe", "url": "https://github.com/ls1intum/Artemis/commit/6f76026df75bfe9d9d42dbc24d6ddb11bfe0e0fe", "message": "Merge remote-tracking branch 'origin/develop' into enhancement/tests-modeling-assessment-dashboard", "committedDate": "2020-11-20T18:41:10Z", "type": "commit"}, {"oid": "bf020c69920c5c530b16a71b84b4befadb8a8ca5", "url": "https://github.com/ls1intum/Artemis/commit/bf020c69920c5c530b16a71b84b4befadb8a8ca5", "message": "Added all missing tests", "committedDate": "2020-11-20T21:35:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE4OTYyMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2439#discussion_r528189621", "bodyText": "I suppose dead code should be removed?", "author": "FrankeLukas", "createdAt": "2020-11-21T12:15:14Z", "path": "src/test/javascript/spec/component/modeling-assessment-dashboard/modeling-assessment-dashboard.component.spec.ts", "diffHunk": "@@ -0,0 +1,328 @@\n+import { async, ComponentFixture, fakeAsync, TestBed, tick } from '@angular/core/testing';\n+import { TranslateModule, TranslateService } from '@ngx-translate/core';\n+import { ArtemisTestModule } from '../../test.module';\n+import { Router } from '@angular/router';\n+import { of, Subscription } from 'rxjs';\n+import { RouterTestingModule } from '@angular/router/testing';\n+import { JhiLanguageHelper } from 'app/core/language/language.helper';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { MockAccountService } from '../../helpers/mocks/service/mock-account.service';\n+import { ModelingAssessmentDashboardComponent } from 'app/exercises/modeling/assess/modeling-assessment-editor/modeling-assessment-dashboard.component';\n+import { MockRouter } from '../../helpers/mocks/mock-router';\n+import { MockSyncStorage } from '../../helpers/mocks/service/mock-sync-storage.service';\n+import { MockTranslateService } from '../../helpers/mocks/service/mock-translate.service';\n+import { LocalStorageService, SessionStorageService } from 'ngx-webstorage';\n+import { ExerciseType } from 'app/entities/exercise.model';\n+import { ExerciseService } from 'app/exercises/shared/exercise/exercise.service';\n+import { CourseManagementService } from 'app/course/manage/course-management.service';\n+import { HttpResponse } from '@angular/common/http';\n+import { ModelingSubmissionService } from 'app/exercises/modeling/participate/modeling-submission.service';\n+import { ModelingExercise } from 'app/entities/modeling-exercise.model';\n+import { AssessmentType } from 'app/entities/assessment-type.model';\n+import { ModelingAssessmentService } from 'app/exercises/modeling/assess/modeling-assessment.service';\n+import { SortService } from 'app/shared/service/sort.service';\n+\n+const route = { params: of({ courseId: 3, exerciseId: 22 }) };\n+const course = { id: 1 };\n+const modelingExercise = { id: 22, course_id: course.id, type: ExerciseType.MODELING, studentAssignedTeamIdComputed: true, assessmentType: AssessmentType.SEMI_AUTOMATIC };\n+const modelingSubmission = { id: 1, submitted: true, result: { id: 10, assessor: { id: 20, guidedTourSettings: [] } } };\n+const modelingSubmission2 = { id: 2, submitted: true, result: { id: 20, assessor: { id: 30, guidedTourSettings: [] } } };\n+const userId = 30;\n+\n+describe('ModelingAssessmentDashboardComponent', () => {\n+    let component: ModelingAssessmentDashboardComponent;\n+    let fixture: ComponentFixture<ModelingAssessmentDashboardComponent>;\n+    let exerciseService: ExerciseService;\n+    let courseService: CourseManagementService;\n+    let modelingSubmissionService: ModelingSubmissionService;\n+    let modelingAssessmentService: ModelingAssessmentService;\n+    let sortService: SortService;\n+    let router: Router;\n+    let exerciseFindSpy: jasmine.Spy;\n+    let courseFindSpy: jasmine.Spy;\n+\n+    beforeEach(async(() => {\n+        TestBed.configureTestingModule({\n+            imports: [RouterTestingModule, TranslateModule.forRoot(), ArtemisTestModule],\n+            declarations: [ModelingAssessmentDashboardComponent],\n+            providers: [\n+                JhiLanguageHelper,\n+                { provide: Router, useClass: route },\n+                { provide: LocalStorageService, useClass: MockSyncStorage },\n+                { provide: SessionStorageService, useClass: MockSyncStorage },\n+                { provide: TranslateService, useClass: MockTranslateService },\n+                { provide: Router, useClass: MockRouter },\n+                { provide: AccountService, useClass: MockAccountService },\n+            ],\n+        })\n+            .overrideTemplate(ModelingAssessmentDashboardComponent, '')\n+            .compileComponents()\n+            .then(() => {\n+                fixture = TestBed.createComponent(ModelingAssessmentDashboardComponent);\n+                component = fixture.componentInstance;\n+                router = fixture.debugElement.injector.get(Router);\n+                exerciseService = fixture.debugElement.injector.get(ExerciseService);\n+                courseService = fixture.debugElement.injector.get(CourseManagementService);\n+                modelingSubmissionService = fixture.debugElement.injector.get(ModelingSubmissionService);\n+                modelingAssessmentService = fixture.debugElement.injector.get(ModelingAssessmentService);\n+                sortService = fixture.debugElement.injector.get(SortService);\n+                exerciseFindSpy = spyOn(exerciseService, 'find').and.returnValue(of(new HttpResponse({ body: modelingExercise })));\n+                courseFindSpy = spyOn(courseService, 'find').and.returnValue(of(new HttpResponse({ body: course })));\n+                fixture.detectChanges();\n+            });\n+    }));\n+\n+    afterEach(() => {\n+        component.ngOnDestroy();\n+    });\n+\n+    it('should set parameters and call functions on init', fakeAsync(() => {\n+        // setup\n+        const getSubmissionsSpy = spyOn(component, 'getSubmissions');\n+        const registerChangeInResultsSpy = spyOn(component, 'registerChangeInResults');\n+\n+        // test for init values\n+        expect(component).toBeTruthy();\n+        expect(component.submissions).toEqual([]);\n+        expect(component.reverse).toEqual(false);\n+        expect(component.predicate).toEqual('id');\n+        expect(component.filteredSubmissions).toEqual([]);\n+        expect(component.optimalSubmissions).toEqual([]);\n+        expect(component.otherSubmissions).toEqual([]);\n+\n+        // call\n+        component.ngOnInit();\n+        tick();\n+\n+        // check\n+        expect(getSubmissionsSpy).toHaveBeenCalledWith(true);\n+        expect(registerChangeInResultsSpy).toHaveBeenCalled();\n+        expect(courseFindSpy).toHaveBeenCalled();\n+        expect(exerciseFindSpy).toHaveBeenCalled();\n+        expect(component.course).toEqual(course);\n+        expect(component.modelingExercise).toEqual(modelingExercise as ModelingExercise);\n+    }));\n+\n+    it('should get Submissions', () => {\n+        // test getSubmissions\n+        const filterSubmissionsSpy = spyOn(component, 'filterSubmissions');\n+        const modelingSubmissionServiceSpy = spyOn(modelingSubmissionService, 'getModelingSubmissionsForExercise').and.returnValue(\n+            of(new HttpResponse({ body: [modelingSubmission] })),\n+        );\n+\n+        // call\n+        component.ngOnInit();\n+\n+        // check\n+        expect(modelingSubmissionServiceSpy).toHaveBeenCalledWith(modelingExercise.id, { submittedOnly: true });\n+        expect(component.submissions).toEqual([modelingSubmission]);\n+        expect(component.filteredSubmissions).toEqual([modelingSubmission]);\n+        expect(filterSubmissionsSpy).toHaveBeenCalled();\n+    });\n+\n+    it('should update filtered submissions', () => {\n+        // test updateFilteredSubmissions\n+        const applyFilter = spyOn(component, 'applyFilter');\n+\n+        // setup\n+        component.ngOnInit();\n+        component.updateFilteredSubmissions([modelingSubmission]);\n+\n+        // check\n+        expect(component.filteredSubmissions).toEqual([modelingSubmission]);\n+        expect(applyFilter).toHaveBeenCalled();\n+    });\n+\n+    it('should refresh', () => {\n+        // test refresh\n+        const getSubmissionsSpy = spyOn(component, 'getSubmissions');\n+\n+        component.refresh();\n+\n+        expect(getSubmissionsSpy).toHaveBeenCalledWith(true);\n+    });\n+\n+    describe('filter Submissions', () => {\n+        it('should filter Submissions', () => {\n+            // test filterSubmissions\n+            // setup\n+            const applyFilter = spyOn(component, 'applyFilter');\n+            const getOptimalSubmissionsSpy = spyOn(modelingAssessmentService, 'getOptimalSubmissions').and.returnValue(of([1]));\n+            // component.ngOnInit();", "originalCommit": "bf020c69920c5c530b16a71b84b4befadb8a8ca5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE4OTYzNw==", "url": "https://github.com/ls1intum/Artemis/pull/2439#discussion_r528189637", "bodyText": "Same here.", "author": "FrankeLukas", "createdAt": "2020-11-21T12:15:19Z", "path": "src/test/javascript/spec/component/modeling-assessment-dashboard/modeling-assessment-dashboard.component.spec.ts", "diffHunk": "@@ -0,0 +1,328 @@\n+import { async, ComponentFixture, fakeAsync, TestBed, tick } from '@angular/core/testing';\n+import { TranslateModule, TranslateService } from '@ngx-translate/core';\n+import { ArtemisTestModule } from '../../test.module';\n+import { Router } from '@angular/router';\n+import { of, Subscription } from 'rxjs';\n+import { RouterTestingModule } from '@angular/router/testing';\n+import { JhiLanguageHelper } from 'app/core/language/language.helper';\n+import { AccountService } from 'app/core/auth/account.service';\n+import { MockAccountService } from '../../helpers/mocks/service/mock-account.service';\n+import { ModelingAssessmentDashboardComponent } from 'app/exercises/modeling/assess/modeling-assessment-editor/modeling-assessment-dashboard.component';\n+import { MockRouter } from '../../helpers/mocks/mock-router';\n+import { MockSyncStorage } from '../../helpers/mocks/service/mock-sync-storage.service';\n+import { MockTranslateService } from '../../helpers/mocks/service/mock-translate.service';\n+import { LocalStorageService, SessionStorageService } from 'ngx-webstorage';\n+import { ExerciseType } from 'app/entities/exercise.model';\n+import { ExerciseService } from 'app/exercises/shared/exercise/exercise.service';\n+import { CourseManagementService } from 'app/course/manage/course-management.service';\n+import { HttpResponse } from '@angular/common/http';\n+import { ModelingSubmissionService } from 'app/exercises/modeling/participate/modeling-submission.service';\n+import { ModelingExercise } from 'app/entities/modeling-exercise.model';\n+import { AssessmentType } from 'app/entities/assessment-type.model';\n+import { ModelingAssessmentService } from 'app/exercises/modeling/assess/modeling-assessment.service';\n+import { SortService } from 'app/shared/service/sort.service';\n+\n+const route = { params: of({ courseId: 3, exerciseId: 22 }) };\n+const course = { id: 1 };\n+const modelingExercise = { id: 22, course_id: course.id, type: ExerciseType.MODELING, studentAssignedTeamIdComputed: true, assessmentType: AssessmentType.SEMI_AUTOMATIC };\n+const modelingSubmission = { id: 1, submitted: true, result: { id: 10, assessor: { id: 20, guidedTourSettings: [] } } };\n+const modelingSubmission2 = { id: 2, submitted: true, result: { id: 20, assessor: { id: 30, guidedTourSettings: [] } } };\n+const userId = 30;\n+\n+describe('ModelingAssessmentDashboardComponent', () => {\n+    let component: ModelingAssessmentDashboardComponent;\n+    let fixture: ComponentFixture<ModelingAssessmentDashboardComponent>;\n+    let exerciseService: ExerciseService;\n+    let courseService: CourseManagementService;\n+    let modelingSubmissionService: ModelingSubmissionService;\n+    let modelingAssessmentService: ModelingAssessmentService;\n+    let sortService: SortService;\n+    let router: Router;\n+    let exerciseFindSpy: jasmine.Spy;\n+    let courseFindSpy: jasmine.Spy;\n+\n+    beforeEach(async(() => {\n+        TestBed.configureTestingModule({\n+            imports: [RouterTestingModule, TranslateModule.forRoot(), ArtemisTestModule],\n+            declarations: [ModelingAssessmentDashboardComponent],\n+            providers: [\n+                JhiLanguageHelper,\n+                { provide: Router, useClass: route },\n+                { provide: LocalStorageService, useClass: MockSyncStorage },\n+                { provide: SessionStorageService, useClass: MockSyncStorage },\n+                { provide: TranslateService, useClass: MockTranslateService },\n+                { provide: Router, useClass: MockRouter },\n+                { provide: AccountService, useClass: MockAccountService },\n+            ],\n+        })\n+            .overrideTemplate(ModelingAssessmentDashboardComponent, '')\n+            .compileComponents()\n+            .then(() => {\n+                fixture = TestBed.createComponent(ModelingAssessmentDashboardComponent);\n+                component = fixture.componentInstance;\n+                router = fixture.debugElement.injector.get(Router);\n+                exerciseService = fixture.debugElement.injector.get(ExerciseService);\n+                courseService = fixture.debugElement.injector.get(CourseManagementService);\n+                modelingSubmissionService = fixture.debugElement.injector.get(ModelingSubmissionService);\n+                modelingAssessmentService = fixture.debugElement.injector.get(ModelingAssessmentService);\n+                sortService = fixture.debugElement.injector.get(SortService);\n+                exerciseFindSpy = spyOn(exerciseService, 'find').and.returnValue(of(new HttpResponse({ body: modelingExercise })));\n+                courseFindSpy = spyOn(courseService, 'find').and.returnValue(of(new HttpResponse({ body: course })));\n+                fixture.detectChanges();\n+            });\n+    }));\n+\n+    afterEach(() => {\n+        component.ngOnDestroy();\n+    });\n+\n+    it('should set parameters and call functions on init', fakeAsync(() => {\n+        // setup\n+        const getSubmissionsSpy = spyOn(component, 'getSubmissions');\n+        const registerChangeInResultsSpy = spyOn(component, 'registerChangeInResults');\n+\n+        // test for init values\n+        expect(component).toBeTruthy();\n+        expect(component.submissions).toEqual([]);\n+        expect(component.reverse).toEqual(false);\n+        expect(component.predicate).toEqual('id');\n+        expect(component.filteredSubmissions).toEqual([]);\n+        expect(component.optimalSubmissions).toEqual([]);\n+        expect(component.otherSubmissions).toEqual([]);\n+\n+        // call\n+        component.ngOnInit();\n+        tick();\n+\n+        // check\n+        expect(getSubmissionsSpy).toHaveBeenCalledWith(true);\n+        expect(registerChangeInResultsSpy).toHaveBeenCalled();\n+        expect(courseFindSpy).toHaveBeenCalled();\n+        expect(exerciseFindSpy).toHaveBeenCalled();\n+        expect(component.course).toEqual(course);\n+        expect(component.modelingExercise).toEqual(modelingExercise as ModelingExercise);\n+    }));\n+\n+    it('should get Submissions', () => {\n+        // test getSubmissions\n+        const filterSubmissionsSpy = spyOn(component, 'filterSubmissions');\n+        const modelingSubmissionServiceSpy = spyOn(modelingSubmissionService, 'getModelingSubmissionsForExercise').and.returnValue(\n+            of(new HttpResponse({ body: [modelingSubmission] })),\n+        );\n+\n+        // call\n+        component.ngOnInit();\n+\n+        // check\n+        expect(modelingSubmissionServiceSpy).toHaveBeenCalledWith(modelingExercise.id, { submittedOnly: true });\n+        expect(component.submissions).toEqual([modelingSubmission]);\n+        expect(component.filteredSubmissions).toEqual([modelingSubmission]);\n+        expect(filterSubmissionsSpy).toHaveBeenCalled();\n+    });\n+\n+    it('should update filtered submissions', () => {\n+        // test updateFilteredSubmissions\n+        const applyFilter = spyOn(component, 'applyFilter');\n+\n+        // setup\n+        component.ngOnInit();\n+        component.updateFilteredSubmissions([modelingSubmission]);\n+\n+        // check\n+        expect(component.filteredSubmissions).toEqual([modelingSubmission]);\n+        expect(applyFilter).toHaveBeenCalled();\n+    });\n+\n+    it('should refresh', () => {\n+        // test refresh\n+        const getSubmissionsSpy = spyOn(component, 'getSubmissions');\n+\n+        component.refresh();\n+\n+        expect(getSubmissionsSpy).toHaveBeenCalledWith(true);\n+    });\n+\n+    describe('filter Submissions', () => {\n+        it('should filter Submissions', () => {\n+            // test filterSubmissions\n+            // setup\n+            const applyFilter = spyOn(component, 'applyFilter');\n+            const getOptimalSubmissionsSpy = spyOn(modelingAssessmentService, 'getOptimalSubmissions').and.returnValue(of([1]));\n+            // component.ngOnInit();\n+            component.modelingExercise = modelingExercise;\n+            component.nextOptimalSubmissionIds = [];\n+\n+            // call\n+            component.filterSubmissions(true);\n+\n+            // check\n+            expect(getOptimalSubmissionsSpy).toHaveBeenCalled();\n+            expect(component.nextOptimalSubmissionIds).toEqual([1]);\n+            expect(applyFilter).toHaveBeenCalled();\n+        });\n+        it('should not filter Submissions', () => {\n+            // test filterSubmissions\n+            // setup\n+            const applyFilter = spyOn(component, 'applyFilter');\n+            const getOptimalSubmissionsSpy = spyOn(modelingAssessmentService, 'getOptimalSubmissions').and.returnValue(of([1]));\n+            // component.ngOnInit();", "originalCommit": "bf020c69920c5c530b16a71b84b4befadb8a8ca5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7b24c1632a3284a356ca06b677ab12dd56ca2bb5", "url": "https://github.com/ls1intum/Artemis/commit/7b24c1632a3284a356ca06b677ab12dd56ca2bb5", "message": "fixed dead code", "committedDate": "2020-11-22T10:45:09Z", "type": "commit"}]}