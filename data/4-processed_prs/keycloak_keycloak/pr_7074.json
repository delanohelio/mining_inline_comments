{"pr_number": 7074, "pr_title": "KEYCLOAK-14178 Avoid erroneous HTML escaping in KeycloakServer", "pr_createdAt": "2020-05-14T19:51:44Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7074", "timeline": [{"oid": "103fad32e4a8143d33a13d2561fd98613a45be55", "url": "https://github.com/keycloak/keycloak/commit/103fad32e4a8143d33a13d2561fd98613a45be55", "message": "KEYCLOAK-14178 Avoid erroneous HTML escaping in KeycloakServer\n\nThis PR disables the Resteasy HTML Sanitizer in KeycloakServer.\nPreviously KeycloakTest server erroneously escapes html in error pages.\n\nSee the linked JIRA issue for details.", "committedDate": "2020-05-15T15:52:59Z", "type": "commit"}, {"oid": "992f3ac5b51bd6769fcc21c59975a672f11e5f90", "url": "https://github.com/keycloak/keycloak/commit/992f3ac5b51bd6769fcc21c59975a672f11e5f90", "message": "KEYCLOAK-14178 Disable HTML errournous escaping in ResteasyServlet configuration in KeycloakServer\n\n- Removed duplicate servlet configuration: the HttpServlet30Dispatcher servlet is already configured by server.undertowDeployment(deployment, \"\");\n- Disabled the  HTML escaping in the ResteasyDeployment", "committedDate": "2020-05-15T16:35:04Z", "type": "forcePushed"}, {"oid": "cacb5f580f7a481207d37586c3bfcd950819f8b3", "url": "https://github.com/keycloak/keycloak/commit/cacb5f580f7a481207d37586c3bfcd950819f8b3", "message": "KEYCLOAK-14178 Disable erroneous HTML escaping in ResteasyServlet configuration in KeycloakServer\n\n- Removed duplicate servlet configuration: the HttpServlet30Dispatcher servlet is already configured by server.undertowDeployment(deployment, \"\");\n- Disabled the  HTML escaping in the ResteasyDeployment", "committedDate": "2020-05-15T16:36:24Z", "type": "forcePushed"}, {"oid": "cb5b29652b894136e0dbba93d7f0bbde8978ef03", "url": "https://github.com/keycloak/keycloak/commit/cb5b29652b894136e0dbba93d7f0bbde8978ef03", "message": "KEYCLOAK-14178 Disable erroneous HTML escaping in ResteasyServlet configuration in KeycloakServer\n\n- Removed duplicate servlet configuration: the HttpServlet30Dispatcher servlet is already configured by server.undertowDeployment(deployment, \"\");\n- Disabled the  HTML escaping in the ResteasyDeployment", "committedDate": "2020-05-15T16:37:25Z", "type": "forcePushed"}, {"oid": "435a9067c4fc7baaa561c6b21dc3da5b63998c16", "url": "https://github.com/keycloak/keycloak/commit/435a9067c4fc7baaa561c6b21dc3da5b63998c16", "message": "KEYCLOAK-14178 Disable erroneous HTML escaping in ResteasyServlet configuration in KeycloakServer\n\n- Removed duplicate servlet configuration: the HttpServlet30Dispatcher servlet is already configured by server.undertowDeployment(deployment, \"\");\n- Disabled the  HTML escaping in the ResteasyDeployment", "committedDate": "2020-05-15T16:41:48Z", "type": "forcePushed"}, {"oid": "b089a3ca41702c82d60c30228dbba247a2e2e2c3", "url": "https://github.com/keycloak/keycloak/commit/b089a3ca41702c82d60c30228dbba247a2e2e2c3", "message": "KEYCLOAK-14178 Disable erroneous HTML escaping in ResteasyServlet configuration in KeycloakServer\n\n- Removed duplicate servlet configuration: the HttpServlet30Dispatcher servlet is already configured by server.undertowDeployment(deployment, \"\");\n- Disabled the  HTML escaping in the ResteasyDeployment", "committedDate": "2020-05-15T16:43:23Z", "type": "commit"}, {"oid": "b089a3ca41702c82d60c30228dbba247a2e2e2c3", "url": "https://github.com/keycloak/keycloak/commit/b089a3ca41702c82d60c30228dbba247a2e2e2c3", "message": "KEYCLOAK-14178 Disable erroneous HTML escaping in ResteasyServlet configuration in KeycloakServer\n\n- Removed duplicate servlet configuration: the HttpServlet30Dispatcher servlet is already configured by server.undertowDeployment(deployment, \"\");\n- Disabled the  HTML escaping in the ResteasyDeployment", "committedDate": "2020-05-15T16:43:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxOTcyNg==", "url": "https://github.com/keycloak/keycloak/pull/7074#discussion_r426419726", "bodyText": "@thomasdarimont Are asyncSupported and resteasy.servlet.mapping.prefix parameter maintained? Perhaps they need to be added similarly as a property of the deployment?", "author": "hmlnarik", "createdAt": "2020-05-18T07:29:00Z", "path": "testsuite/utils/src/main/java/org/keycloak/testsuite/KeycloakServer.java", "diffHunk": "@@ -400,15 +401,11 @@ public void start() throws Throwable {\n \n             di.setDefaultServletConfig(new DefaultServletConfig(true));\n \n-            ServletInfo restEasyDispatcher = Servlets.servlet(\"Keycloak REST Interface\", HttpServlet30Dispatcher.class);\n-\n-            restEasyDispatcher.addInitParam(\"resteasy.servlet.mapping.prefix\", \"/\");\n-            restEasyDispatcher.setAsyncSupported(true);\n-\n-            di.addServlet(restEasyDispatcher);\n+            // Note that the ResteasyServlet is configured via server.undertowDeployment(...);", "originalCommit": "b089a3ca41702c82d60c30228dbba247a2e2e2c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzMjAwNA==", "url": "https://github.com/keycloak/keycloak/pull/7074#discussion_r426432004", "bodyText": "IMHO yes: https://github.com/resteasy/Resteasy/blob/master/server-adapters/resteasy-undertow/src/main/java/org/jboss/resteasy/plugins/server/undertow/UndertowJaxrsServer.java#L184", "author": "thomasdarimont", "createdAt": "2020-05-18T07:52:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxOTcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYwNjcwNQ==", "url": "https://github.com/keycloak/keycloak/pull/7074#discussion_r426606705", "bodyText": "Perfect, thanks for checking!", "author": "hmlnarik", "createdAt": "2020-05-18T12:59:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxOTcyNg=="}], "type": "inlineReview"}]}