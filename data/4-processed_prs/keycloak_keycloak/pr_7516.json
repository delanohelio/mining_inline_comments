{"pr_number": 7516, "pr_title": "KEYCLOAK-14138 Upgrade OTP login screen", "pr_createdAt": "2020-10-20T00:43:07Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7516", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA0MDQ1Ng==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r509040456", "bodyText": "I have some issues with margin and padding. If you add the css file in this order, like below, it should resolve that.\nbase.css, app.css, patternfly.min.css, patternfly-additions.min.css tile.css", "author": "mabartos", "createdAt": "2020-10-21T07:13:08Z", "path": "themes/src/main/resources/theme/keycloak/login/theme.properties", "diffHunk": "@@ -2,7 +2,7 @@ parent=base\n import=common/keycloak\n \n styles=css/login.css\n-stylesCommon=node_modules/patternfly/dist/css/patternfly.min.css node_modules/patternfly/dist/css/patternfly-additions.min.css lib/zocial/zocial.css\n+stylesCommon=node_modules/patternfly/dist/css/patternfly.min.css web_modules/@patternfly/react-core/dist/styles/app.css web_modules/@patternfly/react-core/dist/styles/base.css node_modules/patternfly/dist/css/patternfly-additions.min.css lib/patternfly4/tile.css", "originalCommit": "a53bcd4813ab2167956cd42679663586304ab4a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3ODAyNA==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r510278024", "bodyText": "@mabartos What do you mean? I haven't noticed any issues. :)", "author": "vmuzikar", "createdAt": "2020-10-22T15:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA0MDQ1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk2NzI2Nw==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r512967267", "bodyText": "@vmuzikar (cc: @mabartos) me neither, anyway I change the order as suggested.", "author": "Pepo48", "createdAt": "2020-10-27T19:25:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA0MDQ1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA0NjExNQ==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r509046115", "bodyText": "@Pepo48 Have you tried this on IE? IE doesn't support var() function. The basic screens should be available even in IE, as it was discussed here. So, there should be, at least, some similar appearance like with PF4.", "author": "mabartos", "createdAt": "2020-10-21T07:23:33Z", "path": "themes/src/main/resources/theme/keycloak/common/resources/lib/patternfly4/tile.css", "diffHunk": "@@ -0,0 +1,100 @@\n+.pf-c-tile {", "originalCommit": "a53bcd4813ab2167956cd42679663586304ab4a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk2OTkzMg==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r512969932", "bodyText": "@mabartos (cc: @vmuzikar ) I completely revamped the css styles of the tile component. Now the screen is IE11 compatible:", "author": "Pepo48", "createdAt": "2020-10-27T19:28:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA0NjExNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA0ODMyOQ==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r509048329", "bodyText": "I think, it'd be better use property for the icon instead of hardcoded value. Then, customer can easily change the icon in theme.properties. WDYT @Pepo48 ?", "author": "mabartos", "createdAt": "2020-10-21T07:27:13Z", "path": "themes/src/main/resources/theme/base/login/login-otp.ftl", "diffHunk": "@@ -9,13 +9,13 @@\n                         <div class=\"${properties.kcFormGroupClass!}\">\n                             <div class=\"${properties.kcInputWrapperClass!}\">\n                                 <#list otpLogin.userOtpCredentials as otpCredential>\n-                                    <div class=\"${properties.kcSelectOTPListClass!}\">\n+                                    <div class=\"${properties.kcLoginOTPListClass!}\" tabindex=\"${otpCredential?index}\">\n                                     <input type=\"hidden\" value=\"${otpCredential.id}\">\n-                                        <div class=\"${properties.kcSelectOTPListItemClass!}\">\n-                                            <span class=\"${properties.kcAuthenticatorOtpCircleClass!}\"></span>\n-                                            <h2 class=\"${properties.kcSelectOTPItemHeadingClass!}\">\n-                                                ${otpCredential.userLabel}\n-                                            </h2>\n+                                        <div class=\"${properties.kcLoginOTPListItemHeaderClass!}\">\n+                                            <div class=\"${properties.kcLoginOTPListItemIconClass!}\">\n+                                              <i class=\"fa fa-mobile\" aria-hidden=\"true\"></i>", "originalCommit": "a53bcd4813ab2167956cd42679663586304ab4a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk3MDM2Mg==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r512970362", "bodyText": "@mabartos (cc: @vmuzikar ) fixed", "author": "Pepo48", "createdAt": "2020-10-27T19:29:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA0ODMyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA1MDk2NQ==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r509050965", "bodyText": "Is it possible to add any margin-bottom? If user have defined f.e. 3 OTP credentials with longer name, there are two rows, but there are no space between them.", "author": "mabartos", "createdAt": "2020-10-21T07:31:40Z", "path": "themes/src/main/resources/theme/keycloak/login/resources/css/login.css", "diffHunk": "@@ -515,8 +515,12 @@ a.zocial  {\n     width: 100%;\n }\n \n-.login-pf-page .card-pf{\n-  margin-bottom: 10px;\n+.otp-tile {\n+    padding: 1.5rem;", "originalCommit": "a53bcd4813ab2167956cd42679663586304ab4a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk3MTM5OQ==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r512971399", "bodyText": "@mabartos (cc: @vmuzikar ) fixed for IE (see the screenshot above) and other browsers:", "author": "Pepo48", "createdAt": "2020-10-27T19:31:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA1MDk2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NDg0MA==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r510274840", "bodyText": "This is a bit off topic for this PR as we used JS here as well (but I just noticed it now :)). Didn't we have some policy not to use any JS on login pages if possible (of course e.g. webauthn wouldn't work without JS)? @ssilvert?", "author": "vmuzikar", "createdAt": "2020-10-22T15:54:52Z", "path": "themes/src/main/resources/theme/base/login/login-otp.ftl", "diffHunk": "@@ -51,16 +51,16 @@\n             <script type=\"text/javascript\">\n             $(document).ready(function() {\n                 // Card Single Select\n-                $('.card-pf-view-single-select').click(function() {\n-                  if ($(this).hasClass('active'))\n-                  { $(this).removeClass('active'); $(this).children().removeAttr('name'); }\n+                $('.otp-tile').click(function() {", "originalCommit": "a53bcd4813ab2167956cd42679663586304ab4a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDc0NTA0Mw==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r510745043", "bodyText": "As you pointed, we have JS already, so no regression of this PR :-) But we have follow-up JIRA for remove JS from login pages.", "author": "mposolda", "createdAt": "2020-10-23T09:09:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NDg0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDc1NDY2Nw==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r510754667", "bodyText": "Ah, sorry \u2013 I forgot about KEYCLOAK-12823 (even though I was the one who created it :)). On the other hand, that JIRA covers the authenticator selector page, not OTP page. Or did you mean some other JIRA.", "author": "vmuzikar", "createdAt": "2020-10-23T09:25:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NDg0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDc3MjMzMw==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r510772333", "bodyText": "Nope, I meant this one and forgot that it is specific only to authenticator selector page :-) Maybe we can slightly rename the existing JIRA and/or update it's description to cover both screens? Or create new JIRA?", "author": "mposolda", "createdAt": "2020-10-23T09:56:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NDg0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDc3NDM0Nw==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r510774347", "bodyText": "I've updated KEYCLOAK-12823.", "author": "vmuzikar", "createdAt": "2020-10-23T09:59:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NDg0MA=="}], "type": "inlineReview"}, {"oid": "527c986a8f0a57980e45fd6fb1d48e2ead72dfc9", "url": "https://github.com/keycloak/keycloak/commit/527c986a8f0a57980e45fd6fb1d48e2ead72dfc9", "message": "KEYCLOAK-14138 Upgrade OTP login screen\n\n* edited related css and ftl theme resources\n* fixed affected tests\n\nSigned-off-by: Peter Zaoral <pzaoral@redhat.com>", "committedDate": "2020-10-26T08:56:12Z", "type": "forcePushed"}, {"oid": "5ada5132d216aa1a15fa16847f3093e460ec1d8f", "url": "https://github.com/keycloak/keycloak/commit/5ada5132d216aa1a15fa16847f3093e460ec1d8f", "message": "KEYCLOAK-14138 Upgrade OTP login screen\n\n* edited related css and ftl theme resources\n* added tile component\n* fixed IE11 compatibility\n* fixed affected tests\n\nSigned-off-by: Peter Zaoral <pzaoral@redhat.com>", "committedDate": "2020-10-27T19:20:26Z", "type": "forcePushed"}, {"oid": "6b584a0d6920154236e65e567c62c153e563bf6c", "url": "https://github.com/keycloak/keycloak/commit/6b584a0d6920154236e65e567c62c153e563bf6c", "message": "KEYCLOAK-14138 Upgrade OTP login screen\n\n* edited related css and ftl theme resources\n* added tile component\n* fixed IE11 compatibility\n* fixed affected tests\n\nSigned-off-by: Peter Zaoral <pzaoral@redhat.com>", "committedDate": "2020-10-29T16:33:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc4NDUyOA==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r516784528", "bodyText": "If I understand it correctly, this directory is meant for 3rd party libraries. I'm not sure we should be adding custom files in there. It might even get deleted on some dependencies update. Or am I missing something? @ssilvert", "author": "vmuzikar", "createdAt": "2020-11-03T16:10:57Z", "path": "themes/src/main/resources/theme/keycloak/common/resources/lib/patternfly4/tile.css", "diffHunk": "@@ -0,0 +1,202 @@\n+/*Internet Explorer 11 compatibility workaround - IE does not support CSS variables */", "originalCommit": "6b584a0d6920154236e65e567c62c153e563bf6c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgxNDQxMw==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r516814413", "bodyText": "edit: sry @vmuzikar, I misunderstood your input at first, to clarify that - it's just partially custom, the vast majority of the code comes from PF4 [1] and the IE optimization part is actually the only custom piece of code. In other words, we could eventually move just the IE workaround part from there (e.g. to login.css). But just a suggestion ;).\n[1] https://github.com/patternfly/patternfly/blob/84ae888cf912693b209ac0cf8f63b3ab3ddf59c2/src/patternfly/components/Tile/tile.scss", "author": "Pepo48", "createdAt": "2020-11-03T16:53:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc4NDUyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE2ODM4Mg==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r517168382", "bodyText": "Thanks for the clarification. I still see it as a custom CSS file (manually added, edited, not managed by NPM, etc.) which as such shouldn't be placed among other (managed) dependencies. But let's wait for @ssilvert, maybe I'm wrong.", "author": "vmuzikar", "createdAt": "2020-11-04T08:26:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc4NDUyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM3OTk0NQ==", "url": "https://github.com/keycloak/keycloak/pull/7516#discussion_r517379945", "bodyText": "Btw, why not to put these changes into login.css alongside other IE hacks?", "author": "vmuzikar", "createdAt": "2020-11-04T14:24:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc4NDUyOA=="}], "type": "inlineReview"}, {"oid": "496f5babae922ba64ea0799bf62ce278bb1890fb", "url": "https://github.com/keycloak/keycloak/commit/496f5babae922ba64ea0799bf62ce278bb1890fb", "message": "KEYCLOAK-14138 Upgrade OTP login screen\n\n* edited related css and ftl theme resources\n* added tile component\n* fixed IE11 compatibility\n* fixed affected tests\n\nSigned-off-by: Peter Zaoral <pzaoral@redhat.com>", "committedDate": "2020-11-03T17:49:24Z", "type": "forcePushed"}, {"oid": "509024a706dafe8e71ea296dacd59b55f68625b6", "url": "https://github.com/keycloak/keycloak/commit/509024a706dafe8e71ea296dacd59b55f68625b6", "message": "KEYCLOAK-14138 Upgrade OTP login screen\n\n* edited related css and ftl theme resources\n* added tile component\n* fixed IE11 compatibility\n* fixed affected tests\n\nSigned-off-by: Peter Zaoral <pzaoral@redhat.com>", "committedDate": "2020-11-23T17:40:03Z", "type": "forcePushed"}, {"oid": "a9e35cd156c5e40e88b80e54be795f7835871b23", "url": "https://github.com/keycloak/keycloak/commit/a9e35cd156c5e40e88b80e54be795f7835871b23", "message": "KEYCLOAK-14138 Upgrade OTP login screen\n\n* edited related css and ftl theme resources\n* added tile component\n* fixed IE11 compatibility\n* fixed affected tests\n\nSigned-off-by: Peter Zaoral <pzaoral@redhat.com>", "committedDate": "2020-11-24T16:10:50Z", "type": "commit"}, {"oid": "a9e35cd156c5e40e88b80e54be795f7835871b23", "url": "https://github.com/keycloak/keycloak/commit/a9e35cd156c5e40e88b80e54be795f7835871b23", "message": "KEYCLOAK-14138 Upgrade OTP login screen\n\n* edited related css and ftl theme resources\n* added tile component\n* fixed IE11 compatibility\n* fixed affected tests\n\nSigned-off-by: Peter Zaoral <pzaoral@redhat.com>", "committedDate": "2020-11-24T16:10:50Z", "type": "forcePushed"}]}