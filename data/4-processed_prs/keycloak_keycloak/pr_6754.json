{"pr_number": 6754, "pr_title": "[KEYCLOAK-11345] - Test basic features of Keycloak.X with current testsuite", "pr_createdAt": "2020-02-07T16:20:32Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6754", "timeline": [{"oid": "b1deadbe416d4cc15bcd620334e1f9dde02b99bf", "url": "https://github.com/keycloak/keycloak/commit/b1deadbe416d4cc15bcd620334e1f9dde02b99bf", "message": "[KEYCLOAK-11345] - Test basic features of Keycloak.X with current testsuite\n\nCo-authored-by: mhajas <mhajas@redhat.com>", "committedDate": "2020-02-10T14:02:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MDg3MQ==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r384960871", "bodyText": "There shouldn't be an exclude here for things in the themes jar. If there is anything in the themes jar that shouldn't be there it should be fixed in themes module, not here", "author": "stianst", "createdAt": "2020-02-27T07:53:43Z", "path": "distribution/server-x/pom.xml", "diffHunk": "@@ -71,6 +71,7 @@\n                                     <groupId>org.keycloak</groupId>\n                                     <artifactId>keycloak-themes</artifactId>\n                                     <outputDirectory>target/unpacked-themes</outputDirectory>\n+                                    <excludes>**/node_modules/**,**/node/**</excludes>", "originalCommit": "b1deadbe416d4cc15bcd620334e1f9dde02b99bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTExOTg2OA==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r385119868", "bodyText": "I did not want to touch the main distribution so I thought to remove this from here. I think that centralize changes in Quarkus dist (even though they may not be the best) will help us in the future when reviewing what we have done.", "author": "pedroigor", "createdAt": "2020-02-27T13:19:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MDg3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI3ODIzMg==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r388278232", "bodyText": "Not sure why \"node\" is there in themes jar. That is a bug if it is.\nThere's node_modules that should be in the dist, and without it things won't actually work.", "author": "stianst", "createdAt": "2020-03-05T13:01:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MDg3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI4NjUzOQ==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r388286539", "bodyText": "Just tried building from master, and I don't have any \"node\" directories within the server-x distro, and I only have the expected node_modules directories:\nfind -name node_modules\n./keycloak-preview/account/resources/node_modules\n./keycloak/common/resources/node_modules", "author": "stianst", "createdAt": "2020-03-05T13:18:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MDg3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMwODg5NQ==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r388308895", "bodyText": "Maybe something that was fixed. I'm going to remove.", "author": "pedroigor", "createdAt": "2020-03-05T13:58:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MDg3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MDk4Ng==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r384960986", "bodyText": "Why is this being added? Looks like it's not used?", "author": "stianst", "createdAt": "2020-02-27T07:54:00Z", "path": "distribution/server-x/src/main/content/bin/kc.sh", "diffHunk": "@@ -20,6 +20,7 @@ if [ \"x$RESOLVED_NAME\" = \"x\" ]; then\n     RESOLVED_NAME=\"$0\"\n fi\n \n+GREP=\"grep\"", "originalCommit": "b1deadbe416d4cc15bcd620334e1f9dde02b99bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTExNTA2NQ==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r385115065", "bodyText": "Yes, it is. See line #62.", "author": "pedroigor", "createdAt": "2020-02-27T13:09:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MDk4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTExNjY3MQ==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r385116671", "bodyText": "I see. So it was missing ;)", "author": "stianst", "createdAt": "2020-02-27T13:13:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MDk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MjgyMA==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r384962820", "bodyText": "Added https://issues.redhat.com/browse/KEYCLOAK-13108 to change this back when we can", "author": "stianst", "createdAt": "2020-02-27T07:58:47Z", "path": "quarkus/server/src/main/resources/application.properties", "diffHunk": "@@ -1,6 +1,6 @@\n #quarkus.log.level = DEBUG\n \n quarkus.application.name=Keycloak\n-quarkus.servlet.context-path = /\n+quarkus.http.root-path = /auth", "originalCommit": "b1deadbe416d4cc15bcd620334e1f9dde02b99bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MzExMg==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r384963112", "bodyText": "We should create a bug report for this and handle in a separate PR", "author": "stianst", "createdAt": "2020-02-27T07:59:35Z", "path": "services/src/main/java/org/keycloak/authentication/authenticators/challenge/NoCookieFlowRedirectAuthenticator.java", "diffHunk": "@@ -45,7 +46,8 @@ public void authenticate(AuthenticationFlowContext context) {\n \n         // only do redirects for GET requests\n         if (HttpMethod.GET.equalsIgnoreCase(httpRequest.getHttpMethod())) {\n-            if (!httpRequest.getUri().getQueryParameters().containsKey(LoginActionsService.AUTH_SESSION_ID)) {\n+            KeycloakUriInfo uriInfo = context.getSession().getContext().getUri();", "originalCommit": "b1deadbe416d4cc15bcd620334e1f9dde02b99bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTExODMxNQ==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r385118315", "bodyText": "I can send a separate PR, I thought that this change was too simple to deserve one.\nBasically, we get some errors when calling getUri on the httpRequest when running Quarkus. I did not investigate further the reasons but I suspect some mismatch in resteasy versions.", "author": "pedroigor", "createdAt": "2020-02-27T13:16:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MzExMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI4MTM0Ng==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r388281346", "bodyText": "OK", "author": "stianst", "createdAt": "2020-03-05T13:08:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2MzExMg=="}], "type": "inlineReview"}, {"oid": "ac122b9c4094e6130abcf193d0b3ca9e93c05898", "url": "https://github.com/keycloak/keycloak/commit/ac122b9c4094e6130abcf193d0b3ca9e93c05898", "message": "[KEYCLOAK-11345] - Test basic features of Keycloak.X with current testsuite\n\nCo-authored-by: mhajas <mhajas@redhat.com>", "committedDate": "2020-03-04T15:41:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM2OTA1Ng==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r388369056", "bodyText": "we have this one in the POM already (see line 204)", "author": "dteleguin", "createdAt": "2020-03-05T15:29:59Z", "path": "quarkus/server/pom.xml", "diffHunk": "@@ -402,6 +402,30 @@\n                 </exclusion>\n             </exclusions>\n         </dependency>\n+        <dependency>\n+            <groupId>com.sun.mail</groupId>\n+            <artifactId>jakarta.mail</artifactId>\n+            <version>${jakarta.mail.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.jboss.logging</groupId>\n+            <artifactId>commons-logging-jboss-logging</artifactId>", "originalCommit": "ac122b9c4094e6130abcf193d0b3ca9e93c05898", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM2OTI4OQ==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r388369289", "bodyText": "same here (line 200)", "author": "dteleguin", "createdAt": "2020-03-05T15:30:19Z", "path": "quarkus/server/pom.xml", "diffHunk": "@@ -402,6 +402,30 @@\n                 </exclusion>\n             </exclusions>\n         </dependency>\n+        <dependency>\n+            <groupId>com.sun.mail</groupId>\n+            <artifactId>jakarta.mail</artifactId>\n+            <version>${jakarta.mail.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.jboss.logging</groupId>\n+            <artifactId>commons-logging-jboss-logging</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.jboss.resteasy</groupId>\n+            <artifactId>resteasy-multipart-provider</artifactId>", "originalCommit": "ac122b9c4094e6130abcf193d0b3ca9e93c05898", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM3MzM3NQ==", "url": "https://github.com/keycloak/keycloak/pull/6754#discussion_r388373375", "bodyText": "need to bump version after rebase?", "author": "dteleguin", "createdAt": "2020-03-05T15:36:20Z", "path": "testsuite/integration-arquillian/servers/auth-server/quarkus/pom.xml", "diffHunk": "@@ -0,0 +1,106 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>integration-arquillian-servers-auth-server</artifactId>\n+        <groupId>org.keycloak.testsuite</groupId>\n+        <version>9.0.0-SNAPSHOT</version>", "originalCommit": "ac122b9c4094e6130abcf193d0b3ca9e93c05898", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f11bde3540c02d555fca04d97086231a580562ef", "url": "https://github.com/keycloak/keycloak/commit/f11bde3540c02d555fca04d97086231a580562ef", "message": "[KEYCLOAK-11345] - Test basic features of Keycloak.X with current tetsuite", "committedDate": "2020-03-06T13:29:55Z", "type": "commit"}, {"oid": "f11bde3540c02d555fca04d97086231a580562ef", "url": "https://github.com/keycloak/keycloak/commit/f11bde3540c02d555fca04d97086231a580562ef", "message": "[KEYCLOAK-11345] - Test basic features of Keycloak.X with current tetsuite", "committedDate": "2020-03-06T13:29:55Z", "type": "forcePushed"}]}