{"pr_number": 7400, "pr_title": "KEYCLOAK-15270 Account REST API doesn't verify audience", "pr_createdAt": "2020-09-08T13:33:13Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7400", "timeline": [{"oid": "2c6fd3701b57a0e010bd89c1987e56935d6f6056", "url": "https://github.com/keycloak/keycloak/commit/2c6fd3701b57a0e010bd89c1987e56935d6f6056", "message": "KEYCLOAK-15270 Account REST API doesn't verify audience", "committedDate": "2020-09-08T07:16:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkyOTE5Nw==", "url": "https://github.com/keycloak/keycloak/pull/7400#discussion_r484929197", "bodyText": "The hardcoded audiences have to be here to properly test permissions. Without this, the client has only \"audience resolve\" mapper which adds audience only when user has a role from given client. E.g. if we want to test that user cannot access some endpoint without some role, we need the hardcoded audience because without it the aud claim would be completely missing and the access would be denied not because of the lack of required role but because of the missing aud claim.", "author": "vmuzikar", "createdAt": "2020-09-08T13:41:03Z", "path": "testsuite/integration-arquillian/tests/base/src/test/resources/testrealm.json", "diffHunk": "@@ -414,7 +414,77 @@\n       \"enabled\": true,\n       \"directAccessGrantsEnabled\": true,\n       \"secret\": \"password\",\n-      \"webOrigins\": [ \"http://localtest.me:8180\" ]\n+      \"webOrigins\": [ \"http://localtest.me:8180\" ],\n+      \"protocolMappers\": [\n+        {\n+          \"name\": \"aud-account\",\n+          \"protocol\": \"openid-connect\",\n+          \"protocolMapper\": \"oidc-audience-mapper\",\n+          \"config\": {\n+            \"included.client.audience\": \"account\",\n+            \"id.token.claim\": \"true\",\n+            \"access.token.claim\": \"true\"\n+          }\n+        },\n+        {\n+          \"name\": \"aud-admin\",\n+          \"protocol\": \"openid-connect\",\n+          \"protocolMapper\": \"oidc-audience-mapper\",\n+          \"config\": {\n+            \"included.client.audience\": \"security-admin-console\",\n+            \"id.token.claim\": \"true\",\n+            \"access.token.claim\": \"true\"\n+          }", "originalCommit": "2c6fd3701b57a0e010bd89c1987e56935d6f6056", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}