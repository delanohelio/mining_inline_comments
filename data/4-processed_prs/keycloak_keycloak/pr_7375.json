{"pr_number": 7375, "pr_title": "[KEYCLOAK-14953] Added Galleon feature pack to enable Galleon provisioning of the adaptors to WildFly.", "pr_createdAt": "2020-08-27T12:18:27Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7375", "timeline": [{"oid": "033a9fb7d9180fa5b5e2aaa678e44bb8bdeff215", "url": "https://github.com/keycloak/keycloak/commit/033a9fb7d9180fa5b5e2aaa678e44bb8bdeff215", "message": "[KEYCLOAK-14953] keycloak oidc/elytron adapter galleon-pack prototype", "committedDate": "2020-08-27T11:45:45Z", "type": "commit"}, {"oid": "3264a20f0441164654f543401f05771019d3a724", "url": "https://github.com/keycloak/keycloak/commit/3264a20f0441164654f543401f05771019d3a724", "message": "[KEYCLOAK-14953] Additional updates to the new Galleon feature pack:\n - Adjust feature pack to depend on \"wildfly-galleon-pack\".\n - Declare dependency from \"keycloak-client-oidc\" on \"undertow\" and \"ee\" layers.\n - Update name of layer to \"keycloak-client-oidc\".\n - Update the producer to match the group and artifact ID of the maven artifact.", "committedDate": "2020-08-27T11:46:40Z", "type": "commit"}, {"oid": "c6922a2ce8e275c00a43bd478f37b4d1ff1f7bf1", "url": "https://github.com/keycloak/keycloak/commit/c6922a2ce8e275c00a43bd478f37b4d1ff1f7bf1", "message": "[KEYCLOAK-14953] Make repository.jboss.org available for building the Galleon feature pack.\n\nUpdate the EAP versions to match the most recent release.", "committedDate": "2020-08-27T16:22:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ4NDI0NA==", "url": "https://github.com/keycloak/keycloak/pull/7375#discussion_r485484244", "bodyText": "Version properties here should be aligned with already used properties in keycloak-parent pom.xml.\nI have sent PR to your product repo fork.", "author": "pskopek", "createdAt": "2020-09-09T09:48:16Z", "path": "distribution/galleon-feature-packs/adapter-galleon-pack/pom.xml", "diffHunk": "@@ -0,0 +1,318 @@\n+<!--\n+~ Copyright 2016 Red Hat, Inc. and/or its affiliates\n+~ and other contributors as indicated by the @author tags.\n+~\n+~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+~ you may not use this file except in compliance with the License.\n+~ You may obtain a copy of the License at\n+~\n+~ http://www.apache.org/licenses/LICENSE-2.0\n+~\n+~ Unless required by applicable law or agreed to in writing, software\n+~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+~ See the License for the specific language governing permissions and\n+~ limitations under the License.\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n+    <parent>\n+        <groupId>org.keycloak</groupId>\n+        <artifactId>galleon-feature-packs-parent</artifactId>\n+        <version>12.0.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <modelVersion>4.0.0</modelVersion>\n+    \n+    <groupId>${galleon-adapter-group-id}</groupId>\n+    <artifactId>keycloak-adapter-galleon-pack</artifactId>\n+\n+    <name>Keycloak Galleon Feature Pack: Adapter</name>\n+    <packaging>pom</packaging>\n+    \n+    <properties>\n+        <feature-pack.resources.directory>${basedir}/../../feature-packs/adapter-feature-pack/src/main/resources</feature-pack.resources.directory>\n+        <version.org.wildfly.galleon-plugins>4.2.6.Final</version.org.wildfly.galleon-plugins>\n+        <xmlFileSource>${feature-pack.resources.directory}/licenses/${product.slot}/licenses.xml</xmlFileSource>\n+        <outputDirectory>${basedir}/target/resources/packages/licenses/content/docs/licenses-${product.slot}</outputDirectory>\n+    </properties>\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-core</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-common</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-adapter-core</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-jboss-adapter-core</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-wildfly-subsystem</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-wildfly-adapter</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-wildfly-elytron-oidc-adapter</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-adapter-spi</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-undertow-adapter-spi</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-undertow-adapter</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <!-- Authorization -->\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-authz-client</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+    </dependencies>\n+\n+\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-resources-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>copy-resources</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>copy-resources</goal>\n+                        </goals>\n+                        <configuration>\n+                            <outputDirectory>${basedir}/target/resources</outputDirectory>\n+                            <resources>\n+                                <resource>\n+                                    <directory>${basedir}/src/main/resources</directory>\n+                                </resource>\n+                            </resources>\n+                        </configuration>\n+                    </execution>\n+                    <execution>\n+                        <id>copy-feature-pack-resources</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>copy-resources</goal>\n+                        </goals>\n+                        <configuration>\n+                            <outputDirectory>${basedir}/target/resources</outputDirectory>\n+                            <resources>\n+                                <resource>\n+                                    <directory>${feature-pack.resources.directory}</directory>\n+                                    <includes>\n+                                        <include>content/**</include>\n+                                        <include>modules/**</include>\n+                                    </includes>\n+                                </resource>\n+                            </resources>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.wildfly.galleon-plugins</groupId>\n+                <artifactId>wildfly-galleon-maven-plugin</artifactId>\n+                <version>${version.org.wildfly.galleon-plugins}</version>\n+                <dependencies>\n+                    <!--\n+                        feature-spec-gen uses wildfly-embedded to generate the feature specs, hence the designated\n+                        wildfly-embedded version must match the pack one\n+                    -->\n+                    <dependency>\n+                        <groupId>org.wildfly.core</groupId>\n+                        <artifactId>wildfly-embedded</artifactId>\n+                        <version>${version.org.wildfly.core}</version>\n+                    </dependency>\n+                    <!-- If you add a dependency on wildfly-embedded you need to bring your own transitives -->\n+                    <dependency>\n+                        <groupId>org.wildfly.common</groupId>\n+                        <artifactId>wildfly-common</artifactId>\n+                        <version>${version.org.wildfly.common}</version>\n+                    </dependency>\n+                </dependencies>\n+                <executions>\n+                    <execution>\n+                        <id>keycloak-adapter-galleon-pack-build</id>\n+                        <goals>\n+                            <goal>build-feature-pack</goal>\n+                        </goals>\n+                        <phase>compile</phase>\n+                        <configuration>\n+                            <fork-embedded>false</fork-embedded>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.keycloak</groupId>\n+                <artifactId>keycloak-distribution-licenses-maven-plugin</artifactId>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <profiles>\n+        <profile>\n+            <id>community</id>\n+            <activation>\n+                <property>\n+                    <name>!product</name>\n+                </property>\n+            </activation>\n+            <properties>\n+                <galleon-adapter-group-id>org.keycloak</galleon-adapter-group-id>\n+                <version.org.wildfly>20.0.0.Final</version.org.wildfly>\n+                <version.org.wildfly.core>12.0.1.Final</version.org.wildfly.core>\n+                <version.org.wildfly.common>1.5.4.Final</version.org.wildfly.common>", "originalCommit": "c6922a2ce8e275c00a43bd478f37b4d1ff1f7bf1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ4NDUwOQ==", "url": "https://github.com/keycloak/keycloak/pull/7375#discussion_r485484509", "bodyText": "The same applies here.", "author": "pskopek", "createdAt": "2020-09-09T09:48:41Z", "path": "distribution/galleon-feature-packs/adapter-galleon-pack/pom.xml", "diffHunk": "@@ -0,0 +1,318 @@\n+<!--\n+~ Copyright 2016 Red Hat, Inc. and/or its affiliates\n+~ and other contributors as indicated by the @author tags.\n+~\n+~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+~ you may not use this file except in compliance with the License.\n+~ You may obtain a copy of the License at\n+~\n+~ http://www.apache.org/licenses/LICENSE-2.0\n+~\n+~ Unless required by applicable law or agreed to in writing, software\n+~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+~ See the License for the specific language governing permissions and\n+~ limitations under the License.\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n+    <parent>\n+        <groupId>org.keycloak</groupId>\n+        <artifactId>galleon-feature-packs-parent</artifactId>\n+        <version>12.0.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <modelVersion>4.0.0</modelVersion>\n+    \n+    <groupId>${galleon-adapter-group-id}</groupId>\n+    <artifactId>keycloak-adapter-galleon-pack</artifactId>\n+\n+    <name>Keycloak Galleon Feature Pack: Adapter</name>\n+    <packaging>pom</packaging>\n+    \n+    <properties>\n+        <feature-pack.resources.directory>${basedir}/../../feature-packs/adapter-feature-pack/src/main/resources</feature-pack.resources.directory>\n+        <version.org.wildfly.galleon-plugins>4.2.6.Final</version.org.wildfly.galleon-plugins>\n+        <xmlFileSource>${feature-pack.resources.directory}/licenses/${product.slot}/licenses.xml</xmlFileSource>\n+        <outputDirectory>${basedir}/target/resources/packages/licenses/content/docs/licenses-${product.slot}</outputDirectory>\n+    </properties>\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-core</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-common</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-adapter-core</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-jboss-adapter-core</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-wildfly-subsystem</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-wildfly-adapter</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-wildfly-elytron-oidc-adapter</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-adapter-spi</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-undertow-adapter-spi</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-undertow-adapter</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <!-- Authorization -->\n+        <dependency>\n+            <groupId>org.keycloak</groupId>\n+            <artifactId>keycloak-authz-client</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>*</groupId>\n+                    <artifactId>*</artifactId>\n+                </exclusion>\n+            </exclusions>\n+            <scope>provided</scope>\n+        </dependency>\n+    </dependencies>\n+\n+\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-resources-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>copy-resources</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>copy-resources</goal>\n+                        </goals>\n+                        <configuration>\n+                            <outputDirectory>${basedir}/target/resources</outputDirectory>\n+                            <resources>\n+                                <resource>\n+                                    <directory>${basedir}/src/main/resources</directory>\n+                                </resource>\n+                            </resources>\n+                        </configuration>\n+                    </execution>\n+                    <execution>\n+                        <id>copy-feature-pack-resources</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>copy-resources</goal>\n+                        </goals>\n+                        <configuration>\n+                            <outputDirectory>${basedir}/target/resources</outputDirectory>\n+                            <resources>\n+                                <resource>\n+                                    <directory>${feature-pack.resources.directory}</directory>\n+                                    <includes>\n+                                        <include>content/**</include>\n+                                        <include>modules/**</include>\n+                                    </includes>\n+                                </resource>\n+                            </resources>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.wildfly.galleon-plugins</groupId>\n+                <artifactId>wildfly-galleon-maven-plugin</artifactId>\n+                <version>${version.org.wildfly.galleon-plugins}</version>\n+                <dependencies>\n+                    <!--\n+                        feature-spec-gen uses wildfly-embedded to generate the feature specs, hence the designated\n+                        wildfly-embedded version must match the pack one\n+                    -->\n+                    <dependency>\n+                        <groupId>org.wildfly.core</groupId>\n+                        <artifactId>wildfly-embedded</artifactId>\n+                        <version>${version.org.wildfly.core}</version>\n+                    </dependency>\n+                    <!-- If you add a dependency on wildfly-embedded you need to bring your own transitives -->\n+                    <dependency>\n+                        <groupId>org.wildfly.common</groupId>\n+                        <artifactId>wildfly-common</artifactId>\n+                        <version>${version.org.wildfly.common}</version>\n+                    </dependency>\n+                </dependencies>\n+                <executions>\n+                    <execution>\n+                        <id>keycloak-adapter-galleon-pack-build</id>\n+                        <goals>\n+                            <goal>build-feature-pack</goal>\n+                        </goals>\n+                        <phase>compile</phase>\n+                        <configuration>\n+                            <fork-embedded>false</fork-embedded>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.keycloak</groupId>\n+                <artifactId>keycloak-distribution-licenses-maven-plugin</artifactId>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <profiles>\n+        <profile>\n+            <id>community</id>\n+            <activation>\n+                <property>\n+                    <name>!product</name>\n+                </property>\n+            </activation>\n+            <properties>\n+                <galleon-adapter-group-id>org.keycloak</galleon-adapter-group-id>\n+                <version.org.wildfly>20.0.0.Final</version.org.wildfly>\n+                <version.org.wildfly.core>12.0.1.Final</version.org.wildfly.core>\n+                <version.org.wildfly.common>1.5.4.Final</version.org.wildfly.common>\n+            </properties>\n+            <repositories>\n+                <repository>\n+                    <id>jboss</id>\n+                    <url>https://repository.jboss.org/nexus/content/groups/public/</url>\n+                    <snapshots>\n+                        <enabled>false</enabled>\n+                    </snapshots>\n+                </repository>\n+            </repositories>\n+            <dependencies>\n+                <dependency>\n+                    <groupId>org.wildfly</groupId>\n+                    <artifactId>wildfly-galleon-pack</artifactId>\n+                    <version>${version.org.wildfly}</version>\n+                    <type>zip</type>\n+                    <scope>provided</scope>\n+                </dependency>\n+            </dependencies>\n+        </profile>\n+        <profile>\n+            <id>product</id>\n+            <activation>\n+                <property>\n+                    <name>product</name>\n+                </property>\n+            </activation>\n+            <properties>\n+                <galleon-adapter-group-id>org.jboss.sso</galleon-adapter-group-id>\n+                <version.org.jboss.eap>7.3.2.GA-redhat-00002</version.org.jboss.eap>\n+                <version.org.wildfly.core>10.1.11.Final-redhat-00001</version.org.wildfly.core>\n+                <version.org.wildfly.common>1.5.2.Final-redhat-00002</version.org.wildfly.common>\n+            </properties>", "originalCommit": "c6922a2ce8e275c00a43bd478f37b4d1ff1f7bf1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "930db4ed2dfb55f94c38fa100fa675d0268b30ab", "url": "https://github.com/keycloak/keycloak/commit/930db4ed2dfb55f94c38fa100fa675d0268b30ab", "message": "KEYCLOAK-14953 Unify wildfly component versions related properties already used in keycloak.", "committedDate": "2020-09-09T16:14:36Z", "type": "commit"}]}