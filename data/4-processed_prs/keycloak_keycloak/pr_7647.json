{"pr_number": 7647, "pr_title": "KEYCLOAK-16489 Add ability to run model tests with LDAP", "pr_createdAt": "2020-11-30T07:58:22Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7647", "timeline": [{"oid": "bda5e20f63aa82ee3c822e922b6c7ebdf339f131", "url": "https://github.com/keycloak/keycloak/commit/bda5e20f63aa82ee3c822e922b6c7ebdf339f131", "message": "KEYCLOAK-16489 Add ability to run model tests with LDAP", "committedDate": "2020-11-30T10:06:04Z", "type": "forcePushed"}, {"oid": "ab15a9271a5e9f16870e88a96c782c5d7b5f7c26", "url": "https://github.com/keycloak/keycloak/commit/ab15a9271a5e9f16870e88a96c782c5d7b5f7c26", "message": "KEYCLOAK-16489 Add ability to run model tests with LDAP", "committedDate": "2020-11-30T11:46:07Z", "type": "commit"}, {"oid": "ab15a9271a5e9f16870e88a96c782c5d7b5f7c26", "url": "https://github.com/keycloak/keycloak/commit/ab15a9271a5e9f16870e88a96c782c5d7b5f7c26", "message": "KEYCLOAK-16489 Add ability to run model tests with LDAP", "committedDate": "2020-11-30T11:46:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA3NTc5Mw==", "url": "https://github.com/keycloak/keycloak/pull/7647#discussion_r535075793", "bodyText": "When I run this combination locally I get\nCaused by: org.hibernate.HibernateException: The internal connection pool has reached its maximum size and no connection is currently available!\n\tat org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl$PooledConnections.poll(DriverManagerConnectionProviderImpl.java:322)\n\tat org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl.getConnection(DriverManagerConnectionProviderImpl.java:189)\n\tat org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:35)\n\tat org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:106)\n\tat org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:136)\n\tat org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getConnectionForTransactionManagement(LogicalConnectionManagedImpl.java:254)\n\tat org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.begin(LogicalConnectionManagedImpl.java:262)\n\tat org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.begin(JdbcResourceLocalTransactionCoordinatorImpl.java:236)\n\tat org.hibernate.engine.transaction.internal.TransactionImpl.begin(TransactionImpl.java:86)\n\tat org.keycloak.connections.jpa.JpaKeycloakTransaction.begin(JpaKeycloakTransaction.java:42)\n\tat org.keycloak.services.DefaultKeycloakTransactionManager.enlist(DefaultKeycloakTransactionManager.java:54)\n\tat org.keycloak.connections.jpa.DefaultJpaConnectionProviderFactory.create(DefaultJpaConnectionProviderFactory.java:92)\n\tat org.keycloak.connections.jpa.DefaultJpaConnectionProviderFactory.create(DefaultJpaConnectionProviderFactory.java:59)\n\tat org.keycloak.services.DefaultKeycloakSession.getProvider(DefaultKeycloakSession.java:274)\n\tat org.keycloak.models.jpa.JpaUserProviderFactory.create(JpaUserProviderFactory.java:51)\n\tat org.keycloak.models.jpa.JpaUserProviderFactory.create(JpaUserProviderFactory.java:33)\n\tat org.keycloak.services.DefaultKeycloakSession.getProvider(DefaultKeycloakSession.java:274)\n\tat org.keycloak.services.DefaultKeycloakSession.userLocalStorage(DefaultKeycloakSession.java:194)\n\tat org.keycloak.storage.UserStorageManager.localStorage(UserStorageManager.java:78)\n\tat org.keycloak.storage.UserStorageManager.lambda$addUser$4(UserStorageManager.java:193)\n\nI need to investigate it further to know what is going on and if it's only env issue on my end.", "author": "vramik", "createdAt": "2020-12-03T10:34:24Z", "path": "testsuite/model/pom.xml", "diffHunk": "@@ -127,14 +132,28 @@\n         <profile>\n             <id>jpa-federation+infinispan</id>", "originalCommit": "ab15a9271a5e9f16870e88a96c782c5d7b5f7c26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQwNjQ1NQ==", "url": "https://github.com/keycloak/keycloak/pull/7647#discussion_r535406455", "bodyText": "Right, this happens sometimes in this settings. I cannot reproduce it reliably and is not caused by this PR. However I agree we should understand the cause. It has never occurred to me without the infinispan profile which is making it even more tricky", "author": "hmlnarik", "createdAt": "2020-12-03T16:52:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA3NTc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAzMDE3Ng==", "url": "https://github.com/keycloak/keycloak/pull/7647#discussion_r536030176", "bodyText": "https://issues.redhat.com/browse/KEYCLOAK-16545", "author": "vramik", "createdAt": "2020-12-04T11:25:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA3NTc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5ODkzNg==", "url": "https://github.com/keycloak/keycloak/pull/7647#discussion_r536198936", "bodyText": "Thanks @vramik !", "author": "hmlnarik", "createdAt": "2020-12-04T15:54:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA3NTc5Mw=="}], "type": "inlineReview"}]}