{"pr_number": 6897, "pr_title": "KEYCLOAK-12916 add name or username in toolbar", "pr_createdAt": "2020-03-16T11:10:31Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6897", "timeline": [{"oid": "35f6209ec6a4370953b4c98cd86f85cec778b5f8", "url": "https://github.com/keycloak/keycloak/commit/35f6209ec6a4370953b4c98cd86f85cec778b5f8", "message": "KEYCLOAK-12916 add name or username in toolbar", "committedDate": "2020-03-19T15:24:10Z", "type": "forcePushed"}, {"oid": "f2715025b344d37411701efec2df07376836979e", "url": "https://github.com/keycloak/keycloak/commit/f2715025b344d37411701efec2df07376836979e", "message": "KEYCLOAK-12916 add name or username in toolbar", "committedDate": "2020-03-20T11:20:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NDYwNQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404054605", "bodyText": "I don't think we necessarily need to make a separate test for this. It could \"piggyback\" on some other test class, e.g. PersonalInfoTest. (I think you had it like that at some point.)\nBut if you decide it should have its own test class (which is also ok), please don't base it on BaseAccountPageTest as it contains some features specific for a page test (like a navigation test, e.g.). You can use AbstractAccountTest instead as a much more suitable option.", "author": "vmuzikar", "createdAt": "2020-04-06T12:33:38Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/LoggedInPageHeaderTest.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2018 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.testsuite.ui.account2;\n+\n+import org.jboss.arquillian.graphene.page.Page;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.keycloak.representations.idm.RealmRepresentation;\n+import org.keycloak.representations.idm.UserRepresentation;\n+import org.keycloak.testsuite.admin.ApiUtil;\n+import org.keycloak.testsuite.ui.account2.page.AbstractLoggedInPage;\n+import org.keycloak.testsuite.ui.account2.page.LoggedInPageHeaderPage;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+public class LoggedInPageHeaderTest extends BaseAccountPageTest {", "originalCommit": "f2715025b344d37411701efec2df07376836979e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzNDU3Mg==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404634572", "bodyText": "@edewit Thanks for adding the test. I haven't yet tested it but all the changes in PersonalInfoPage should be moved to LoggedInPageHeader.\n\nSo you changed your mind again. I'll change the code again", "author": "edewit", "createdAt": "2020-04-07T08:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NDYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzNzgyNQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404637825", "bodyText": "@edewit How did I change my mind? :) The citation you're mentioning is specifically about the page object whereas this thread is about the test class. If something's not clear please let me know \u2013 we could e.g. schedule a call and talk about it.", "author": "vmuzikar", "createdAt": "2020-04-07T08:41:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NDYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY2MzQ4Nw==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404663487", "bodyText": "Okay now I'm totally confused, based on you comment I moved all the stuff to separate classes. Then you comment that I shouldn't do that so I revert. I might have misinterpreted that, because you only mend the stuff from PersonalInfoPage, but here in this PR you also say that I shouldn't have a LoggedInPageHeader", "author": "edewit", "createdAt": "2020-04-07T09:21:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NDYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3MTQyNQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404671425", "bodyText": "But I think I know what you meant now. Changed it.", "author": "edewit", "createdAt": "2020-04-07T09:33:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NDYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NTUzMw==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404675533", "bodyText": "Thank you. My whole point was to simply follow the pattern we have in the tests to keep the code consistent and clean.", "author": "vmuzikar", "createdAt": "2020-04-07T09:40:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NDYwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NjU1Ng==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404056556", "bodyText": "Please don't make a separate Page Class for this. It's not a page, it's part of a page header. Please move its content to AbstractHeader (if the username will be displayed on Welcome Screen as well) or LoggedInPageHeader.", "author": "vmuzikar", "createdAt": "2020-04-06T12:37:05Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/LoggedInPageHeaderPage.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.testsuite.ui.account2.page;\n+\n+import org.keycloak.representations.idm.UserRepresentation;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.FindBy;\n+\n+import static org.keycloak.testsuite.util.UIAssert.assertElementDisabled;\n+import static org.keycloak.testsuite.util.UIAssert.assertInputElementValid;\n+import static org.keycloak.testsuite.util.UIUtils.getTextInputValue;\n+import static org.keycloak.testsuite.util.UIUtils.setTextInputValue;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+public class LoggedInPageHeaderPage extends AbstractLoggedInPage {", "originalCommit": "f2715025b344d37411701efec2df07376836979e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NzMwMg==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404057302", "bodyText": "I think we should display the logged in user on Welcome Screen as well. This way it's not consistent.", "author": "vmuzikar", "createdAt": "2020-04-06T12:38:21Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/App.tsx", "diffHunk": "@@ -63,11 +63,17 @@ export class App extends React.Component<AppProps> {\n         // globally set up locale for date formatting\n         moment.locale(locale);\n \n+        const avatar = (\n+            <div className=\"pf-l-toolbar__group\" style={{marginLeft: '10px'}}>\n+                <span id=\"loggedInUser\">{this.kcSvc.userName}</span>", "originalCommit": "f2715025b344d37411701efec2df07376836979e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0MDM4OQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404640389", "bodyText": "It's already not consistent as it's also missing the avatar image on the welcome screen.", "author": "edewit", "createdAt": "2020-04-07T08:45:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NzMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0MzYzOA==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404643638", "bodyText": "Good catch with the avatar image. Strictly speaking it should be present there as well but it might be out of scope of this PR \u2013\u00a0it's up to you.\nSince the Welcome Screen allows user to log in (without redirecting to a React page), there should be at least the logged in user present there, at the very least.", "author": "vmuzikar", "createdAt": "2020-04-07T08:50:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NzMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgxOTk3NA==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404819974", "bodyText": "I'm not sure we need the avatar image.  The image is only cosmetic.  It doesn't add any functionality and it does take up valuable space.\n@vmuzikar @edewit WDYT?", "author": "ssilvert", "createdAt": "2020-04-07T13:44:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NzMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMDQzMA==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404820430", "bodyText": "And I could go either way.  Aesthetics are important too.", "author": "ssilvert", "createdAt": "2020-04-07T13:45:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NzMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ0MDU3MA==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r405440570", "bodyText": "@ssilvert I believe there are currently no plans for actually supporting avatar images, right? In that case +1 for removing the fake one as it might be confusing for the user \u2013 it implies there's some avatar but user can't change it.", "author": "vmuzikar", "createdAt": "2020-04-08T11:02:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NzMwMg=="}], "type": "inlineReview"}, {"oid": "a35350af9cba5c9140e52c553ad3b0e82df6480a", "url": "https://github.com/keycloak/keycloak/commit/a35350af9cba5c9140e52c553ad3b0e82df6480a", "message": "KEYCLOAK-12916 add name or username in toolbar", "committedDate": "2020-04-07T09:11:50Z", "type": "forcePushed"}, {"oid": "f90c756aa22fc78304d2ffac7b9143fd2bb39728", "url": "https://github.com/keycloak/keycloak/commit/f90c756aa22fc78304d2ffac7b9143fd2bb39728", "message": "KEYCLOAK-12916 add name or username in toolbar", "committedDate": "2020-04-07T09:32:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NzM3MQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404677371", "bodyText": "Please make sure the test is thorough enough and possibly covers all the possibilities (user doesn't have first and last name, user has only first or last name, user has preferred username, ...).\nAnd possibly add a test for Welcome Screen as well.", "author": "vmuzikar", "createdAt": "2020-04-07T09:43:38Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/PersonalInfoTest.java", "diffHunk": "@@ -154,6 +155,11 @@ public void disabledEditUsername() {\n         personalInfoPage.valuesEqual(testUser2);\n     }\n \n+    @Test\n+    public void testNameInToolbar() {\n+        assertEquals(\"test user\", personalInfoPage.header().getToolbarLoggedInUser().getText());", "originalCommit": "f90c756aa22fc78304d2ffac7b9143fd2bb39728", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc5NjEzMQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404796131", "bodyText": "added more cases", "author": "edewit", "createdAt": "2020-04-07T13:11:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NzM3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQzNDk4MQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r405434981", "bodyText": "Looks good, thanks. Could you please add something similar for welcome screen as well? It doesn't share the implementation with React pages, so it's worth to have a separate test for that too.\nAlso, on welcome screen please test that the user is not displayed at all if not logged in. We have to make sure we don't have gaps in test coverage. :)", "author": "vmuzikar", "createdAt": "2020-04-08T10:52:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NzM3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3Nzc4MA==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404677780", "bodyText": "Does this mean Welcome Page doesn't display first and last name of a user?", "author": "vmuzikar", "createdAt": "2020-04-07T09:44:14Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/index.ftl", "diffHunk": "@@ -109,6 +109,7 @@\n                 } else {\n                     document.getElementById(\"landingSignOutButton\").style.display='inline';\n                     document.getElementById(\"landingSignOutLink\").style.display='inline';\n+                    document.getElementById(\"loggedInUser\").innerHTML = keycloak.tokenParsed.preferred_username;", "originalCommit": "f90c756aa22fc78304d2ffac7b9143fd2bb39728", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc5NTk5Nw==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404795997", "bodyText": "done", "author": "edewit", "createdAt": "2020-04-07T13:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3Nzc4MA=="}], "type": "inlineReview"}, {"oid": "923ce8502482ba0af4b44abcbc5a8ed1cca7e41b", "url": "https://github.com/keycloak/keycloak/commit/923ce8502482ba0af4b44abcbc5a8ed1cca7e41b", "message": "KEYCLOAK-12916 add name or username in toolbar", "committedDate": "2020-04-07T13:10:31Z", "type": "forcePushed"}, {"oid": "897d2394e4ed5d807e6d113b7ec508721f916105", "url": "https://github.com/keycloak/keycloak/commit/897d2394e4ed5d807e6d113b7ec508721f916105", "message": "KEYCLOAK-12916 add name or username in toolbar", "committedDate": "2020-04-07T14:39:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQzNzQwMg==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r405437402", "bodyText": "Please return String from this element using getTextFromElement as it includes some hacks (and more might be added in the future).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public WebElement getToolbarLoggedInUser() {\n          \n          \n            \n                    return toolbarLoggedInUser;\n          \n          \n            \n                public String getToolbarLoggedInUser() {\n          \n          \n            \n                    return getTextFromElement(toolbarLoggedInUser);", "author": "vmuzikar", "createdAt": "2020-04-08T10:56:44Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java", "diffHunk": "@@ -73,4 +76,8 @@ protected WebElement getLogoutBtn() {\n     protected WebElement getReferrerLink() {\n         return isMobileLayout() ? referrerLinkMobile : referrerLink;\n     }\n+\n+    public WebElement getToolbarLoggedInUser() {\n+        return toolbarLoggedInUser;", "originalCommit": "897d2394e4ed5d807e6d113b7ec508721f916105", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "60702df6066330c5f0dce3a5d7bc751580ce0ece", "url": "https://github.com/keycloak/keycloak/commit/60702df6066330c5f0dce3a5d7bc751580ce0ece", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>", "committedDate": "2020-04-08T12:59:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYzNTQ3Nw==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r407635477", "bodyText": "@edewit This needs to be localized.", "author": "ssilvert", "createdAt": "2020-04-13T18:25:22Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/keycloak-service/keycloak.service.ts", "diffHunk": "@@ -84,6 +84,21 @@ export class KeycloakService {\n         return KeycloakService.keycloakAuth.realm;\n     }\n \n+    public get userName(): string {\n+        let userName = 'Anonymous';", "originalCommit": "60702df6066330c5f0dce3a5d7bc751580ce0ece", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzkzMzI5OA==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r407933298", "bodyText": "I think we don't actually need to localize this. If I got it right, this won't be never displayed because KC always includes at least preferred_username in tokens, am I right? I understood this is just a failsafe of sorts.", "author": "vmuzikar", "createdAt": "2020-04-14T07:48:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYzNTQ3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODA4MDgyNw==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r408080827", "bodyText": "I don't know enough to say with 100% certainty.  It's not a big deal to localize just in case.", "author": "ssilvert", "createdAt": "2020-04-14T12:00:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYzNTQ3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYzNzcwNQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r407637705", "bodyText": "This needs to be localized as well.  Many cultures don't do givenName + ' ' + familyName.  So these should be passed in as params to a message bundle instead.", "author": "ssilvert", "createdAt": "2020-04-13T18:29:24Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/keycloak-service/keycloak.service.ts", "diffHunk": "@@ -84,6 +84,21 @@ export class KeycloakService {\n         return KeycloakService.keycloakAuth.realm;\n     }\n \n+    public get userName(): string {\n+        let userName = 'Anonymous';\n+        if (KeycloakService.keycloakAuth.tokenParsed) {\n+            const givenName = (KeycloakService.keycloakAuth.tokenParsed as {given_name: string}).given_name;\n+            const familyName = (KeycloakService.keycloakAuth.tokenParsed as {family_name: string}).family_name;\n+            const preferredUsername = (KeycloakService.keycloakAuth.tokenParsed as {preferred_username: string}).preferred_username;\n+            if (givenName && familyName) {\n+                userName = givenName + ' ' + familyName;", "originalCommit": "60702df6066330c5f0dce3a5d7bc751580ce0ece", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzkyMTAyMQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r407921021", "bodyText": "givenName (given_name) and familyName (family_name) are the properties in tokenParsed so what do you want me to localize? The way we concatenate the name? Are there more properties in tokenParsed that contain the parts of the name?", "author": "edewit", "createdAt": "2020-04-14T07:26:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYzNzcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODA3ODkxOA==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r408078918", "bodyText": "Yes, the way we concatenate the name should be localized.  I think all you need to do is pass the params into Msg.  Then the message bundle concatenates based on locale.  So English bundle looks something like:\nfullName={0} {1}\nSouth Korea bundle might look like:\nfullName={1} {0}", "author": "ssilvert", "createdAt": "2020-04-14T11:57:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYzNzcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODEwOTA3Nw==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r408109077", "bodyText": "okay done", "author": "edewit", "createdAt": "2020-04-14T12:49:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYzNzcwNQ=="}], "type": "inlineReview"}, {"oid": "2f32c06ca10b75781d68700532bb14c8e2288fa7", "url": "https://github.com/keycloak/keycloak/commit/2f32c06ca10b75781d68700532bb14c8e2288fa7", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>", "committedDate": "2020-04-14T07:49:51Z", "type": "forcePushed"}, {"oid": "39b49b903cce6ce9e4f3863811a6b072a5704710", "url": "https://github.com/keycloak/keycloak/commit/39b49b903cce6ce9e4f3863811a6b072a5704710", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>", "committedDate": "2020-04-14T08:56:17Z", "type": "forcePushed"}, {"oid": "85d32ccf3240f0df8f98d340c3dd966cfdb1c090", "url": "https://github.com/keycloak/keycloak/commit/85d32ccf3240f0df8f98d340c3dd966cfdb1c090", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>", "committedDate": "2020-04-14T08:59:42Z", "type": "forcePushed"}, {"oid": "a2ba89c0a905152f06b0ab414259cf6a2558dc80", "url": "https://github.com/keycloak/keycloak/commit/a2ba89c0a905152f06b0ab414259cf6a2558dc80", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>", "committedDate": "2020-04-14T11:08:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc1MDY4Mg==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r408750682", "bodyText": "I've noticed we use the same ID both at Welcome Screen and at React pages. The Welcome Screen is technically always present in the DOM, just hidden when a React page is loaded. I'm no HTML expert, so correct me if I'm wrong, but I think it's not valid to have duplicit IDs in HTML and it could theoretically cause some problems. One thing I can think of is testing \u2013\u00a0it could be a bit nondeterministic as we don't know which of the elements with this ID was selected.\nAt the Welcome Screen we usually use landing prefix for IDs to prevent this kind of issues.", "author": "vmuzikar", "createdAt": "2020-04-15T10:47:59Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/index.ftl", "diffHunk": "@@ -160,6 +178,10 @@\n               <button id=\"landingSignOutButton\" tabindex=\"0\" style=\"display:none\" onclick=\"keycloak.logout();\" class=\"pf-c-button pf-m-primary\" type=\"button\">${msg(\"doSignOut\")}</button>\n             </div>\n \n+            <div class=\"pf-l-toolbar__group\" style=\"margin-left: 10px;\">\n+                <span id=\"loggedInUser\"></span>", "originalCommit": "0e3d01ec0a5dadb62154dc9d0cedd7a5b438328c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NDUzNA==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r409054534", "bodyText": "At the Welcome Screen we usually use landing prefix for IDs to prevent this kind of issues.\n\nI think that's a good idea.  We should make sure to do that from now on.", "author": "ssilvert", "createdAt": "2020-04-15T18:40:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc1MDY4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAzOTYwNQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r413039605", "bodyText": "This change is not necessary.", "author": "vmuzikar", "createdAt": "2020-04-22T14:37:11Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/PersonalInfoPage.java", "diffHunk": "@@ -26,6 +26,8 @@\n import static org.keycloak.testsuite.util.UIUtils.getTextInputValue;\n import static org.keycloak.testsuite.util.UIUtils.setTextInputValue;\n \n+import static org.junit.Assert.assertEquals;\n+", "originalCommit": "b92ae05ae890b058a5bae667bc5a1ae9d0e0d4e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA5NDg3NQ==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r414094875", "bodyText": "@edewit Can you move this function to WelcomePageScripts.js?  index.ftl is too big and hard to manage already.", "author": "ssilvert", "createdAt": "2020-04-23T20:17:04Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/index.ftl", "diffHunk": "@@ -121,6 +122,23 @@\n             }).error(function() {\n                 alert('failed to initialize keycloak');\n             });\n+\n+            function loggedInUserName() {\n+                let userName = '${msg(\"unknownUser\")}';\n+                if (keycloak.tokenParsed) {\n+                    const givenName = keycloak.tokenParsed.given_name;\n+                    const familyName = keycloak.tokenParsed.family_name;\n+                    const preferredUsername = keycloak.tokenParsed.preferred_username;\n+                    if (givenName && familyName) {\n+                        userName = [givenName, familyName].reduce((acc, value, index) =>\n+                            acc.replace('{'+ index + '}', value), '${msg(\"fullName\")}'\n+                        );\n+                    } else {\n+                        userName = (givenName || familyName) || preferredUsername || userName;\n+                    }\n+                }\n+                return userName;\n+            }", "originalCommit": "b92ae05ae890b058a5bae667bc5a1ae9d0e0d4e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM0NDE4Mg==", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r414344182", "bodyText": "It can't move as it needs freemarker to have the \"fullName = {0} {1}\" template", "author": "edewit", "createdAt": "2020-04-24T07:05:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA5NDg3NQ=="}], "type": "inlineReview"}, {"oid": "09d2977c4818a41ffad15d4fa2a7686cf4b0528c", "url": "https://github.com/keycloak/keycloak/commit/09d2977c4818a41ffad15d4fa2a7686cf4b0528c", "message": "moved `loggedInUserName` to WelcomePageScrips", "committedDate": "2020-04-27T13:18:11Z", "type": "forcePushed"}, {"oid": "817f21f0682b9d1fc5ffff86999ba02a86b48369", "url": "https://github.com/keycloak/keycloak/commit/817f21f0682b9d1fc5ffff86999ba02a86b48369", "message": "moved `loggedInUserName` to WelcomePageScrips", "committedDate": "2020-04-28T06:40:19Z", "type": "forcePushed"}, {"oid": "91e4e9668419e10f12184a205db3279dd136051f", "url": "https://github.com/keycloak/keycloak/commit/91e4e9668419e10f12184a205db3279dd136051f", "message": "moved `loggedInUserName` to WelcomePageScrips", "committedDate": "2020-05-04T06:32:32Z", "type": "forcePushed"}, {"oid": "c86c27c88fbe45b93cf199b8c19354a4f3d89f25", "url": "https://github.com/keycloak/keycloak/commit/c86c27c88fbe45b93cf199b8c19354a4f3d89f25", "message": "KEYCLOAK-12916 add name or username in toolbar\n\nUpdate testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>\n\nMoved concatenation to messages_en.properties\n\nfix: renamed loggedInUser to landingLoggedInUser\n\nfor the welcome page\n\nmoved `loggedInUserName` to WelcomePageScrips", "committedDate": "2020-05-04T11:39:49Z", "type": "commit"}, {"oid": "c86c27c88fbe45b93cf199b8c19354a4f3d89f25", "url": "https://github.com/keycloak/keycloak/commit/c86c27c88fbe45b93cf199b8c19354a4f3d89f25", "message": "KEYCLOAK-12916 add name or username in toolbar\n\nUpdate testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>\n\nMoved concatenation to messages_en.properties\n\nfix: renamed loggedInUser to landingLoggedInUser\n\nfor the welcome page\n\nmoved `loggedInUserName` to WelcomePageScrips", "committedDate": "2020-05-04T11:39:49Z", "type": "forcePushed"}]}