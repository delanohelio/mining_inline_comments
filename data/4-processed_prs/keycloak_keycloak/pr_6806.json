{"pr_number": 6806, "pr_title": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials", "pr_createdAt": "2020-02-19T13:27:03Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6806", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI4ODM0Mg==", "url": "https://github.com/keycloak/keycloak/pull/6806#discussion_r381288342", "bodyText": "It may look weird a 409 response here. But I didn't want to change the scope of this PR and review how the endpoint is mapping errors to the proper status.", "author": "pedroigor", "createdAt": "2020-02-19T13:28:28Z", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/oauth/ServiceAccountTest.java", "diffHunk": "@@ -281,6 +291,25 @@ public void clientCredentialsAuthRequest_ClientES256_RealmPS256() throws Excepti\n     \tconductClientCredentialsAuthRequest(Algorithm.HS256, Algorithm.ES256, Algorithm.PS256);\n     }\n \n+    @Test\n+    public void failManagePassword() {\n+        UserResource serviceAccount = adminClient.realm(\"test\").users().get(userId);\n+        UserRepresentation representation = serviceAccount.toRepresentation();\n+\n+        CredentialRepresentation password = new CredentialRepresentation();\n+        password.setValue(\"password\");\n+        password.setType(CredentialRepresentation.PASSWORD);\n+        password.setTemporary(false);\n+\n+        representation.setCredentials(Arrays.asList(password));\n+\n+        this.expectedException.expect(Matchers.allOf(Matchers.instanceOf(ClientErrorException.class), \n+                Matchers.hasProperty(\"response\", Matchers.hasProperty(\"status\", Matchers.is(409)))));", "originalCommit": "56d336cdb2b8f1ef7323207256b53ae3c45486fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQyNzg3Mg==", "url": "https://github.com/keycloak/keycloak/pull/6806#discussion_r381427872", "bodyText": "Is it really necessary to add this check here? Doesn't the AuthenticationProcessor prevent the login request from reaching this point?", "author": "sguilhen", "createdAt": "2020-02-19T17:27:18Z", "path": "services/src/main/java/org/keycloak/authentication/authenticators/browser/AbstractUsernameFormAuthenticator.java", "diffHunk": "@@ -101,7 +101,7 @@ protected void dummyHash(AuthenticationFlowContext context) {\n     }\n \n     public void testInvalidUser(AuthenticationFlowContext context, UserModel user) {\n-        if (user == null) {\n+        if (user == null || user.getServiceAccountClientLink() != null) {", "originalCommit": "56d336cdb2b8f1ef7323207256b53ae3c45486fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "63ccd3b6fd4c2796f48ce49ba8a54ed663d7ff15", "url": "https://github.com/keycloak/keycloak/commit/63ccd3b6fd4c2796f48ce49ba8a54ed663d7ff15", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials", "committedDate": "2020-02-19T17:27:15Z", "type": "forcePushed"}, {"oid": "97e345fca29fc4615622ebeaaf9478aa61037a56", "url": "https://github.com/keycloak/keycloak/commit/97e345fca29fc4615622ebeaaf9478aa61037a56", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials", "committedDate": "2020-02-27T22:02:55Z", "type": "forcePushed"}, {"oid": "0bd58ca258bc10a604031b621b83343d2b78ed3a", "url": "https://github.com/keycloak/keycloak/commit/0bd58ca258bc10a604031b621b83343d2b78ed3a", "message": "[KEYCLOAK-12612][KEYCLOAK-12944] Fix validation of SAML destination URLs\n - no longer compare them to the server absolutePath; instead use the base URI to build the validation URL", "committedDate": "2020-02-27T22:05:45Z", "type": "commit"}, {"oid": "8c3fcd68c43521d90ea77ac75108f251d0229024", "url": "https://github.com/keycloak/keycloak/commit/8c3fcd68c43521d90ea77ac75108f251d0229024", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials", "committedDate": "2020-02-27T22:07:03Z", "type": "commit"}, {"oid": "8c3fcd68c43521d90ea77ac75108f251d0229024", "url": "https://github.com/keycloak/keycloak/commit/8c3fcd68c43521d90ea77ac75108f251d0229024", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials", "committedDate": "2020-02-27T22:07:03Z", "type": "forcePushed"}]}