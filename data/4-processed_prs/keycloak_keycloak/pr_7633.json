{"pr_number": 7633, "pr_title": "KEYCLOAK-16426 add attributes to keycloak.d.ts", "pr_createdAt": "2020-11-20T14:00:01Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7633", "timeline": [{"oid": "f8fbc4a42266daaba609f6f81ee885f02226886b", "url": "https://github.com/keycloak/keycloak/commit/f8fbc4a42266daaba609f6f81ee885f02226886b", "message": "KEYCLOAK-16426 add attributes to keycloak.d.ts", "committedDate": "2020-11-20T13:54:14Z", "type": "commit"}, {"id": "PRRC_kwDOAKnDVc4q4BE4", "url": "https://github.com/keycloak/keycloak/pull/7633#discussion_r719327544", "bodyText": "As a token can contain custom claims would it not be better to just define this as a map?", "author": "stianst", "createdAt": "2021-09-30T11:50:34Z", "path": "adapters/oidc/js/src/main/resources/keycloak.d.ts", "diffHunk": "@@ -292,13 +292,23 @@ declare namespace Keycloak {\n \t}\r\n \r\n \tinterface KeycloakTokenParsed {\r\n+\t\tacr?: string;\r\n+\t\taud?: string;\r\n+\t\tauth_time?: number;\r\n+\t\tazp?: string;\r\n+\t\temail_varified?: boolean;\r\n \t\texp?: number;\r\n \t\tiat?: number;\r\n+\t\tiss?: string;\r\n+\t\tjti?: string;\r\n \t\tnonce?: string;\r\n-\t\tsub?: string;\r\n-\t\tsession_state?: string;\r\n+\t\tpreferred_username?: string;\r\n \t\trealm_access?: KeycloakRoles;\r\n \t\tresource_access?: KeycloakResourceAccess;\r\n+\t\tscope?: string;\r\n+\t\tsession_state?: string;\r\n+\t\tsub?: string;\r\n+\t\ttyp?: string;\r", "originalCommit": "f8fbc4a42266daaba609f6f81ee885f02226886b", "replyToReviewId": null, "replies": [{"id": "PRRC_kwDOAKnDVc4q4Yuq", "url": "https://github.com/keycloak/keycloak/pull/7633#discussion_r719424426", "bodyText": "Yeah, ideally this would be a thing the user can provide using a generic. For example:\ninterface MyTokenFields {\n  foo: string;\n}\n\nconst tokenParsed = keycloak.getParsedToken<MyTokenFields>();\n\ntokenParsed.foo; // TypeScipt knows this property through the generic\nBut since we have none of these methods exist, and these properties are exposed publicly this not a feasible solution. So instead we can specify only the properties here that are guaranteed to be present at all time (@stianst any idea what those might be?).\nNext to that we can specify an index signature so that TypeScript users can themselves determine what is inside of the token. So the interface would look a bit like this:\nexport interface KeycloakTokenParsed {\n  alwaysPresent: string;\n  [key: string]: any;\n}\nNow if someone wants to get a value from the token it should be fine for TypeScript:\nkeycloak.tokenParsed.foo // This property will be of type 'any' \nNow if someone wants to narrow this down they can use type predicate.\nif (typeof keycloak.tokenParsed.foo === 'string') {\n  keycloak.tokenParsed.foo // This property will be of type 'string'\n}", "author": "jonkoops", "createdAt": "2021-09-30T13:46:48Z", "replyToReviewId": "PRRC_kwDOAKnDVc4q4BE4"}, {"id": "PRRC_kwDOAKnDVc4q5JOQ", "url": "https://github.com/keycloak/keycloak/pull/7633#discussion_r719623056", "bodyText": "The last example you gave looks like the way to go for now. That's what I had in mind when I said \"map\". There's some built-in claims, but probably always will be custom ones as well.", "author": "stianst", "createdAt": "2021-09-30T17:37:09Z", "replyToReviewId": "PRRC_kwDOAKnDVc4q4BE4"}], "type": "inlineReview"}, {"oid": "60ac42c71b1fdd1eafb59a281f2e40b884a2ce75", "url": "https://github.com/keycloak/keycloak/commit/60ac42c71b1fdd1eafb59a281f2e40b884a2ce75", "message": "KEYCLOAK-16426 adapt signature to official spec", "committedDate": "2021-10-02T04:52:12Z", "type": "forcePushed"}, {"oid": "3fc8661b62cb5a0cfa7c91157215607f6eb0cfa4", "url": "https://github.com/keycloak/keycloak/commit/3fc8661b62cb5a0cfa7c91157215607f6eb0cfa4", "message": "KEYCLOAK-16426 adapt signature to official spec", "committedDate": "2021-10-02T04:53:41Z", "type": "commit"}, {"oid": "3fc8661b62cb5a0cfa7c91157215607f6eb0cfa4", "url": "https://github.com/keycloak/keycloak/commit/3fc8661b62cb5a0cfa7c91157215607f6eb0cfa4", "message": "KEYCLOAK-16426 adapt signature to official spec", "committedDate": "2021-10-02T04:53:41Z", "type": "forcePushed"}, {"id": "PRRC_kwDOAKnDVc4rNCG_", "url": "https://github.com/keycloak/keycloak/pull/7633#discussion_r724836799", "bodyText": "Can you add the index signature for this interface?\ninterface KeycloakTokenParsed {\n  // Other fields go above.\n  [key: string]: any;\n}", "author": "jonkoops", "createdAt": "2021-10-08T09:06:13Z", "path": "adapters/oidc/js/src/main/resources/keycloak.d.ts", "diffHunk": "@@ -292,10 +292,16 @@ declare namespace Keycloak {\n \t}\r\n \r\n \tinterface KeycloakTokenParsed {\r", "originalCommit": "3fc8661b62cb5a0cfa7c91157215607f6eb0cfa4", "replyToReviewId": null, "replies": [{"id": "PRRC_kwDOAKnDVc4rNNEd", "url": "https://github.com/keycloak/keycloak/pull/7633#discussion_r724881693", "bodyText": "@jonkoops\nThank you, sorry for forgetting to reflect your great suggestion.\nI think it  is good idea and  want to add  [key: string]: any;\n@abstractj @stianst\nPlease wait for a minutes.", "author": "maito1201", "createdAt": "2021-10-08T10:08:14Z", "replyToReviewId": "PRRC_kwDOAKnDVc4rNCG_"}], "type": "inlineReview"}, {"oid": "3f309e93c8b962efb59d22ab3a6f3323b805b7c3", "url": "https://github.com/keycloak/keycloak/commit/3f309e93c8b962efb59d22ab3a6f3323b805b7c3", "message": "KEYCLOAK-16426 add optional field to token parsed", "committedDate": "2021-10-08T10:17:36Z", "type": "commit"}]}