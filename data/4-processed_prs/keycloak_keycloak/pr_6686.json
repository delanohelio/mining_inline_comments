{"pr_number": 6686, "pr_title": "KEYCLOAK-11550: Single page to manage credentials", "pr_createdAt": "2020-01-21T18:38:44Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6686", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNDc3NQ==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369404775", "bodyText": "This will throw an exception in case that user doesn't have password? Also in case he doesn't have password and has 1 OTP credential, it can happen that \"models.get(0)\" won't return the password.\nI know we're going to rewrite this stuff and it is just \"dummy\" endpoint for now. So leaving to you whether to change this or not. I am fine with accept PR even without fixing it we all agree that some temporary \"bugs\" in this dummy endpoints are ok.", "author": "mposolda", "createdAt": "2020-01-22T07:33:53Z", "path": "services/src/main/java/org/keycloak/services/resources/account/AccountCredentialResource.java", "diffHunk": "@@ -57,6 +57,139 @@ public AccountCredentialResource(KeycloakSession session, EventBuilder event, Us\n //        models.forEach(c -> c.setSecretData(null));\n //        return models.stream().map(ModelToRepresentation::toRepresentation).collect(Collectors.toList());\n //    }\n+    \n+    private static class CredentialContainer {\n+        private String category;\n+        private String type;\n+        private String tooltip;\n+        private boolean enabled;\n+        private String createAction;\n+        private String updateAction;\n+        private boolean removeable;\n+        private List<CredentialModel> userCredentials;\n+        \n+        public CredentialContainer(String category, String type, String tooltip, boolean enabled, String createAction, String updateAction, boolean removeable,List<CredentialModel> userCredentials) {\n+            this.category = category;\n+            this.type = type;\n+            this.tooltip = tooltip;\n+            this.enabled = enabled;\n+            this.createAction = createAction;\n+            this.updateAction = updateAction;\n+            this.removeable = removeable;\n+            this.userCredentials = userCredentials;\n+        }\n+\n+        public String getCategory() {\n+            return category;\n+        }\n+        \n+        public String getType() {\n+            return type;\n+        }\n+\n+        public String getTooltip() {\n+            return tooltip;\n+        }\n+\n+        public boolean isEnabled() {\n+            return enabled;\n+        }\n+\n+        public String getCreateAction() {\n+            return createAction;\n+        }\n+\n+        public String getUpdateAction() {\n+            return updateAction;\n+        }\n+\n+        public boolean isRemoveable() {\n+            return removeable;\n+        }\n+\n+        public List<CredentialModel> getUserCredentials() {\n+            return userCredentials;\n+        }\n+        \n+    }\n+    \n+    @GET\n+    @NoCache\n+    @Produces(javax.ws.rs.core.MediaType.APPLICATION_JSON)\n+    public List<CredentialContainer> dummyCredentialTypes(){\n+        auth.requireOneOf(AccountRoles.MANAGE_ACCOUNT, AccountRoles.VIEW_PROFILE);\n+        List<CredentialModel> models = session.userCredentialManager().getStoredCredentials(realm, user);\n+        \n+        List<CredentialModel> passwordUserCreds = new java.util.ArrayList<>();\n+        passwordUserCreds.add(models.get(0));", "originalCommit": "4ec5b50d3f18b2c87440e95f2a11fd38ff770f73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU0MzE4Mw==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369543183", "bodyText": "@mposolda I am assuming that you will take care of those things when there is live data.  As long as the data you send is in the format I expect, the UI will be able to handle it.\nI am only assuming that there will be at least one credential sent to me.  It doesn't matter what category or type it is.", "author": "ssilvert", "createdAt": "2020-01-22T12:56:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYwNDc5OA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369604798", "bodyText": "I just realized the tooltips are missing.\n\nActually need to discuss this a bit. Right now, tooltips are sent for each credential type. Should they also appear for each credential category?\n\n@mposolda @abstractj I think I will rename \"tooltip\" to \"helptext\".  It will be shown as plain text after the type name instead of as a tooltip.\nConcerning help text at the category level, with the current structure we can not have help text that belongs to the category.  This is because you can have more than one type for each category and they are sent as a category/type combo.  We would need another level of abstraction to send an attribute that belongs specifically to the category.", "author": "ssilvert", "createdAt": "2020-01-22T14:50:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYwNjAxOA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369606018", "bodyText": "@ssilvert whatever you and @mposolda are in agreement, that's perfectly fine from me. Apicurio was great to be used as a starting point, but you guys doing the implementation know best what has to be done.", "author": "abstractj", "createdAt": "2020-01-22T14:52:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk3NDAyMA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369974020", "bodyText": "@ssilvert The UI with added helpText for each credentialType looks nice to me. Thanks for adding it!\nRegarding the helpText for the category, I think it will makes sense to have helpText which will be specific to each category. I just don't know where exactly to show it in the UI, so that it looks nice and user-friendly...\nRegarding your question for helpText on categories, there will be always just 3 categories. Those 3 categories are \"hardcoded\" (with the exception that they should be localized, but otherwise it is pretty much hardcoded text) and their helpTexts can be hardcoded as well. There is no need to return anything from the REST API regarding helpText for the categories (which I am not sure if it is something you meant in your last paragraph).", "author": "mposolda", "createdAt": "2020-01-23T08:02:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3NDQwMg==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r370074402", "bodyText": "@mposolda OK.  I'll hard-code some text then.  I think I'll post to the dev list to get feedback on all the help text.", "author": "ssilvert", "createdAt": "2020-01-23T11:51:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNDc3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNTY5Ng==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369405696", "bodyText": "The credential will be named \"Webauthn Passwordless\" instead of \"WebAuthn Strong\" . For more details, see the keycloak-dev thread \"Strong WebAuthn for passwordless authentication\" and the PR #6649 .", "author": "mposolda", "createdAt": "2020-01-22T07:37:17Z", "path": "services/src/main/java/org/keycloak/services/resources/account/AccountCredentialResource.java", "diffHunk": "@@ -57,6 +57,139 @@ public AccountCredentialResource(KeycloakSession session, EventBuilder event, Us\n //        models.forEach(c -> c.setSecretData(null));\n //        return models.stream().map(ModelToRepresentation::toRepresentation).collect(Collectors.toList());\n //    }\n+    \n+    private static class CredentialContainer {\n+        private String category;\n+        private String type;\n+        private String tooltip;\n+        private boolean enabled;\n+        private String createAction;\n+        private String updateAction;\n+        private boolean removeable;\n+        private List<CredentialModel> userCredentials;\n+        \n+        public CredentialContainer(String category, String type, String tooltip, boolean enabled, String createAction, String updateAction, boolean removeable,List<CredentialModel> userCredentials) {\n+            this.category = category;\n+            this.type = type;\n+            this.tooltip = tooltip;\n+            this.enabled = enabled;\n+            this.createAction = createAction;\n+            this.updateAction = updateAction;\n+            this.removeable = removeable;\n+            this.userCredentials = userCredentials;\n+        }\n+\n+        public String getCategory() {\n+            return category;\n+        }\n+        \n+        public String getType() {\n+            return type;\n+        }\n+\n+        public String getTooltip() {\n+            return tooltip;\n+        }\n+\n+        public boolean isEnabled() {\n+            return enabled;\n+        }\n+\n+        public String getCreateAction() {\n+            return createAction;\n+        }\n+\n+        public String getUpdateAction() {\n+            return updateAction;\n+        }\n+\n+        public boolean isRemoveable() {\n+            return removeable;\n+        }\n+\n+        public List<CredentialModel> getUserCredentials() {\n+            return userCredentials;\n+        }\n+        \n+    }\n+    \n+    @GET\n+    @NoCache\n+    @Produces(javax.ws.rs.core.MediaType.APPLICATION_JSON)\n+    public List<CredentialContainer> dummyCredentialTypes(){\n+        auth.requireOneOf(AccountRoles.MANAGE_ACCOUNT, AccountRoles.VIEW_PROFILE);\n+        List<CredentialModel> models = session.userCredentialManager().getStoredCredentials(realm, user);\n+        \n+        List<CredentialModel> passwordUserCreds = new java.util.ArrayList<>();\n+        passwordUserCreds.add(models.get(0));\n+        \n+        List<CredentialModel> otpUserCreds = new java.util.ArrayList<>();\n+        if (models.size() > 1) otpUserCreds.add(models.get(1));\n+        if (models.size() > 2) otpUserCreds.add(models.get(2));\n+        \n+        List<CredentialModel> webauthnUserCreds = new java.util.ArrayList<>();\n+        CredentialModel webauthnCred = new CredentialModel();\n+        webauthnCred.setId(\"bogus-id\");\n+        webauthnCred.setUserLabel(\"yubikey key\");\n+        webauthnCred.setCreatedDate(1579122652382L);\n+        webauthnUserCreds.add(webauthnCred);\n+        \n+        List<CredentialModel> webauthnStrongUserCreds = new java.util.ArrayList<>();\n+        CredentialModel webauthnStrongCred = new CredentialModel();\n+        webauthnStrongCred.setId(\"bogus-id-for-webauthnStrong\");\n+        webauthnStrongCred.setUserLabel(\"My very strong key with required PIN\");\n+        webauthnStrongCred.setCreatedDate(1579122652382L);\n+        webauthnUserCreds.add(webauthnStrongCred);\n+        \n+        CredentialContainer password = new CredentialContainer(\n+                                        \"password\",\n+                                        \"password\",\n+                                        \"passwordTooltip\",\n+                                        true,\n+                                        null, // no create action\n+                                        \"UPDATE_PASSWORD\",\n+                                        false,\n+                                        passwordUserCreds\n+                                        );\n+        CredentialContainer otp = new CredentialContainer(\n+                                        \"two-factor\",\n+                                        \"otp\",\n+                                        \"otpTooltip\",\n+                                        true,\n+                                        \"CONFIGURE_TOTP\", \n+                                        null, // no update action\n+                                        true,\n+                                        otpUserCreds\n+                                        );\n+        CredentialContainer webAuthn = new CredentialContainer(\n+                                        \"two-factor\",\n+                                        \"webauthn\",\n+                                        \"webauthntooltip\",\n+                                        true,\n+                                        \"CONFIGURE_WEBAUTHN\", \n+                                        null, // no update action\n+                                        true,\n+                                        webauthnUserCreds\n+                                        );\n+        CredentialContainer passwordless = new CredentialContainer(\n+                                        \"passwordless\",\n+                                        \"webauthn-strong\",", "originalCommit": "4ec5b50d3f18b2c87440e95f2a11fd38ff770f73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU4MTc2NQ==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369581765", "bodyText": "Right now, the UI just uses \"webauthn-strong\" as a localization key.  So it passes \"webauthn-strong\" and gets \"WebAuthn Strong\" as a result in English.\nPerhaps you just want to change this so that the REST API returns \"webauthn-passwordless\" and it shows \"Webauthn Passwordless\" in the UI?", "author": "ssilvert", "createdAt": "2020-01-22T14:13:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNTY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgyNDExMA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369824110", "bodyText": "Updated the UI.  See new pic above.", "author": "ssilvert", "createdAt": "2020-01-22T21:52:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNTY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk3NDIzNw==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369974237", "bodyText": "Thanks!", "author": "mposolda", "createdAt": "2020-01-23T08:03:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwNTY5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU5NDgzNw==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369594837", "bodyText": "Just a question. Why are we making this change? It's not related to the Credentials page, correct? This results in links no longer being opened in new browser tab.", "author": "vmuzikar", "createdAt": "2020-01-22T14:34:24Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/content/applications-page/ApplicationsPage.tsx", "diffHunk": "@@ -132,7 +134,10 @@ export class ApplicationsPage extends React.Component<ApplicationsPageProps, App\n                         {application.inUse ? Msg.localize('inUse') : Msg.localize('notInUse')}\n                       </DataListCell>,\n                       <DataListCell width={4} key={'baseUrl-' + appIndex}>\n-                        <a href={application.userConsentRequired ? application.baseUrl : '/auth' + application.baseUrl} target=\"_blank\"><LinkIcon /> {application.baseUrl}</a>\n+                        <button className=\"pf-c-button pf-m-link\" type=\"button\" onClick={() => window.location.href = appUrl}>\n+                          <span className=\"pf-c-button__icon\">\n+                            <i className=\"fas fa-link\" aria-hidden=\"true\"></i>\n+                          </span>{application.baseUrl}</button>", "originalCommit": "4ec5b50d3f18b2c87440e95f2a11fd38ff770f73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcxMTcyOA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369711728", "bodyText": "I changed that to fix a linting error.  Didn't know about the tab thing.  I'll look into it.", "author": "ssilvert", "createdAt": "2020-01-22T17:53:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU5NDgzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgxOTk4MQ==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369819981", "bodyText": "Fixed.", "author": "ssilvert", "createdAt": "2020-01-22T21:43:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU5NDgzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU5NjIyNQ==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369596225", "bodyText": "Typo: removable", "author": "vmuzikar", "createdAt": "2020-01-22T14:36:48Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/content/signingin-page/SigningInPage.tsx", "diffHunk": "@@ -47,15 +47,39 @@ interface PasswordDetails {\n     registered: boolean;\n     lastUpdate: number;\n }\n+\n+type CredCategory = 'password' | 'two-factor' | 'passwordless';\n+type CredType = string;\n+type CredTypeMap = Map<CredType, CredentialContainer>;\n+type CredContainerMap = Map<CredCategory, CredTypeMap>;\n+\n+interface UserCredential {\n+    id: string;\n+    type: string;\n+    userLabel: string;\n+    createdDate: number;\n+    strCreatedDate?: string;\n+}\n+\n+// A CredentialContainer is unique by combo of credential type and credential category\n+interface CredentialContainer {\n+    category: CredCategory;\n+    type: CredType;\n+    tooltip: string;\n+    createAction: string;\n+    updateAction: string;\n+    removeable: boolean;", "originalCommit": "4ec5b50d3f18b2c87440e95f2a11fd38ff770f73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcxMjczNg==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369712736", "bodyText": "Either spelling is correct.", "author": "ssilvert", "createdAt": "2020-01-22T17:55:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU5NjIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzODIyMA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r370038220", "bodyText": "I blindly trusted my IDE (and Google) which complained about that. But I'm not the native speaker here. :)", "author": "vmuzikar", "createdAt": "2020-01-23T10:26:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU5NjIyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY4NjY2MA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369686660", "bodyText": "Just a suggestion. The two-factor authentication looks like it's an independent credential type. If I understand it correctly, it works only with password. Couldn't we somehow visually hint the user that it's not independent? E.g. somehow place it in the same box as password?\nOf course, for the tech preview it's ok as it is.", "author": "vmuzikar", "createdAt": "2020-01-22T17:04:33Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/content/signingin-page/SigningInPage.tsx", "diffHunk": "@@ -68,116 +92,202 @@ class SigningInPage extends React.Component<SigningInPageProps, SigningInPageSta\n     public constructor(props: SigningInPageProps) {\n         super(props);\n         this.state = {\n-            twoFactorEnabled: true,\n-            twoFactorEnabledText: Msg.localize('twoFactorEnabled'),\n-            isTotpConfigured: features.isTotpConfigured,\n+            credentialContainers: new Map()\n         }\n-        this.setLastPwdUpdate();\n+\n+        this.getCredentialContainers();\n     }\n \n-    private setLastPwdUpdate(): void {\n-        AccountServiceClient.Instance.doGet(\"/credentials/password\")\n-            .then((response: AxiosResponse<PasswordDetails>) => {\n-                if (response.data.lastUpdate) {\n-                    const lastUpdate: number = response.data.lastUpdate;\n-                    this.setState({lastPasswordUpdate: lastUpdate});\n-                }\n+    private getCredentialContainers(): void {\n+        AccountServiceClient.Instance.doGet(\"/credentials\")\n+            .then((response: AxiosResponse<CredentialContainer[]>) => {\n+\n+                const allContainers: CredContainerMap = new Map();\n+                response.data.forEach(container => {\n+                    let categoryMap = allContainers.get(container.category);\n+                    if (!categoryMap) {\n+                        categoryMap = new Map();\n+                        allContainers.set(container.category, categoryMap);\n+                    }\n+                    categoryMap.set(container.type, container);\n+                });\n+\n+                this.setState({credentialContainers: allContainers});\n             });\n     }\n     \n-    private handleTwoFactorSwitch = () => {\n-        if (this.state.twoFactorEnabled) {\n-            this.setState({twoFactorEnabled: false, twoFactorEnabledText: Msg.localize('twoFactorDisabled')})\n-        } else {\n-            this.setState({twoFactorEnabled: true, twoFactorEnabledText:  Msg.localize('twoFactorEnabled')})\n-        }\n-    }\n-\n-    private handleRemoveTOTP = () => {\n-      AccountServiceClient.Instance.doDelete(\"/totp/remove\")\n+    private handleRemove = (credentialId: string, userLabel: string) => {\n+      AccountServiceClient.Instance.doDelete(\"/credentials/\" + credentialId)\n         .then(() => {\n-            this.setState({isTotpConfigured: false});\n-            ContentAlert.success('successTotpRemovedMessage');\n+            this.getCredentialContainers();\n+            ContentAlert.success('successRemovedMessage', [userLabel]);\n         });\n     }\n \n     public render(): React.ReactNode {", "originalCommit": "4ec5b50d3f18b2c87440e95f2a11fd38ff770f73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcxMzY4Mw==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369713683", "bodyText": "Just a suggestion. The two-factor authentication looks like it's an independent credential type. If I understand it correctly, it works only with password. Couldn't we somehow visually hint the user that it's not independent? E.g. somehow place it in the same box as password?\nOf course, for the tech preview it's ok as it is.\n\n@mposolda Do you have any feedback on this?", "author": "ssilvert", "createdAt": "2020-01-22T17:57:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY4NjY2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MDI3NA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369690274", "bodyText": "It looks a bit weird, or maybe too technical, that there are two \"passwords\" on top of each other. Again, IMHO ok for tech preview.", "author": "vmuzikar", "createdAt": "2020-01-22T17:11:21Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/content/signingin-page/SigningInPage.tsx", "diffHunk": "@@ -68,116 +92,202 @@ class SigningInPage extends React.Component<SigningInPageProps, SigningInPageSta\n     public constructor(props: SigningInPageProps) {\n         super(props);\n         this.state = {\n-            twoFactorEnabled: true,\n-            twoFactorEnabledText: Msg.localize('twoFactorEnabled'),\n-            isTotpConfigured: features.isTotpConfigured,\n+            credentialContainers: new Map()\n         }\n-        this.setLastPwdUpdate();\n+\n+        this.getCredentialContainers();\n     }\n \n-    private setLastPwdUpdate(): void {\n-        AccountServiceClient.Instance.doGet(\"/credentials/password\")\n-            .then((response: AxiosResponse<PasswordDetails>) => {\n-                if (response.data.lastUpdate) {\n-                    const lastUpdate: number = response.data.lastUpdate;\n-                    this.setState({lastPasswordUpdate: lastUpdate});\n-                }\n+    private getCredentialContainers(): void {\n+        AccountServiceClient.Instance.doGet(\"/credentials\")\n+            .then((response: AxiosResponse<CredentialContainer[]>) => {\n+\n+                const allContainers: CredContainerMap = new Map();\n+                response.data.forEach(container => {\n+                    let categoryMap = allContainers.get(container.category);\n+                    if (!categoryMap) {\n+                        categoryMap = new Map();\n+                        allContainers.set(container.category, categoryMap);\n+                    }\n+                    categoryMap.set(container.type, container);\n+                });\n+\n+                this.setState({credentialContainers: allContainers});\n             });\n     }\n     \n-    private handleTwoFactorSwitch = () => {\n-        if (this.state.twoFactorEnabled) {\n-            this.setState({twoFactorEnabled: false, twoFactorEnabledText: Msg.localize('twoFactorDisabled')})\n-        } else {\n-            this.setState({twoFactorEnabled: true, twoFactorEnabledText:  Msg.localize('twoFactorEnabled')})\n-        }\n-    }\n-\n-    private handleRemoveTOTP = () => {\n-      AccountServiceClient.Instance.doDelete(\"/totp/remove\")\n+    private handleRemove = (credentialId: string, userLabel: string) => {\n+      AccountServiceClient.Instance.doDelete(\"/credentials/\" + credentialId)\n         .then(() => {\n-            this.setState({isTotpConfigured: false});\n-            ContentAlert.success('successTotpRemovedMessage');\n+            this.getCredentialContainers();\n+            ContentAlert.success('successRemovedMessage', [userLabel]);\n         });\n     }\n \n     public render(): React.ReactNode {", "originalCommit": "4ec5b50d3f18b2c87440e95f2a11fd38ff770f73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcxNDYzOA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369714638", "bodyText": "I wasn't totally comfortable with that either.  Right now that's just a placeholder so that it's consistent with the other types.  I'm open to suggestions.", "author": "ssilvert", "createdAt": "2020-01-22T17:59:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MDI3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk3ODE0OA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369978148", "bodyText": "I suggest to keep it like this and possibly revisit later based on the feedback from users...\nFor the future, I wonder if we may have 2 categories instead of 3. Instead of \"Password, \"Two-Factor Authentication\" and \"Passwordless\", we may have just something like \"1st factor authentication\" and \"Two-factor authentication\" . From the built-in credentials, the \"Password\" and \"WebAuthn Passwordless\" will be 1st-factor Category. And \"OTP\" and \"WebAuthn\" will be two-factor category. We may probably wait for the feedback from users and customers whether to do something like this...", "author": "mposolda", "createdAt": "2020-01-23T08:15:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MDI3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzODE2Mw==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r370038163", "bodyText": "I suggest to keep it like this and possibly revisit later based on the feedback from users...\n\nI'm not sure we can expect this kind of feedback (\"Hey, it looks weird!\"). :) IMHO it is about the \"look and feel\", about the impression from the admin console and most importantly how easy-to-use and intuitive it is for an end user that doesn't have any technical background. And I don't think those kind of users will file a JIRA. :) But I'm no UX expert, so it's just how I feel it. ;)\n\nFor the future, I wonder if we may have 2 categories instead of 3. Instead of \"Password, \"Two-Factor Authentication\" and \"Passwordless\", we may have just something like \"1st factor authentication\" and \"Two-factor authentication\" . From the built-in credentials, the \"Password\" and \"WebAuthn Passwordless\" will be 1st-factor Category. And \"OTP\" and \"WebAuthn\" will be two-factor category. We may probably wait for the feedback from users and customers whether to do something like this...\n\nThis would even more strongly imply that 2FA is an independent credential type which it isn't.", "author": "vmuzikar", "createdAt": "2020-01-23T10:26:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MDI3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3MzYwMw==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r370073603", "bodyText": "@vmuzikar Please file a JIRA about this and reference this discussion.  I think it's worth taking another look and I wouldn't want us to forget about it after tech preview.", "author": "ssilvert", "createdAt": "2020-01-23T11:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MDI3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE5MDE3Ng==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r371190176", "bodyText": "Created https://issues.redhat.com/browse/KEYCLOAK-12781", "author": "vmuzikar", "createdAt": "2020-01-27T11:32:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MDI3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MTI1NQ==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369691255", "bodyText": "When a credential is not set up, the info text is not vertically aligned.", "author": "vmuzikar", "createdAt": "2020-01-22T17:13:15Z", "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/content/signingin-page/SigningInPage.tsx", "diffHunk": "@@ -68,116 +92,202 @@ class SigningInPage extends React.Component<SigningInPageProps, SigningInPageSta\n     public constructor(props: SigningInPageProps) {\n         super(props);\n         this.state = {\n-            twoFactorEnabled: true,\n-            twoFactorEnabledText: Msg.localize('twoFactorEnabled'),\n-            isTotpConfigured: features.isTotpConfigured,\n+            credentialContainers: new Map()\n         }\n-        this.setLastPwdUpdate();\n+\n+        this.getCredentialContainers();\n     }\n \n-    private setLastPwdUpdate(): void {\n-        AccountServiceClient.Instance.doGet(\"/credentials/password\")\n-            .then((response: AxiosResponse<PasswordDetails>) => {\n-                if (response.data.lastUpdate) {\n-                    const lastUpdate: number = response.data.lastUpdate;\n-                    this.setState({lastPasswordUpdate: lastUpdate});\n-                }\n+    private getCredentialContainers(): void {\n+        AccountServiceClient.Instance.doGet(\"/credentials\")\n+            .then((response: AxiosResponse<CredentialContainer[]>) => {\n+\n+                const allContainers: CredContainerMap = new Map();\n+                response.data.forEach(container => {\n+                    let categoryMap = allContainers.get(container.category);\n+                    if (!categoryMap) {\n+                        categoryMap = new Map();\n+                        allContainers.set(container.category, categoryMap);\n+                    }\n+                    categoryMap.set(container.type, container);\n+                });\n+\n+                this.setState({credentialContainers: allContainers});\n             });\n     }\n     \n-    private handleTwoFactorSwitch = () => {\n-        if (this.state.twoFactorEnabled) {\n-            this.setState({twoFactorEnabled: false, twoFactorEnabledText: Msg.localize('twoFactorDisabled')})\n-        } else {\n-            this.setState({twoFactorEnabled: true, twoFactorEnabledText:  Msg.localize('twoFactorEnabled')})\n-        }\n-    }\n-\n-    private handleRemoveTOTP = () => {\n-      AccountServiceClient.Instance.doDelete(\"/totp/remove\")\n+    private handleRemove = (credentialId: string, userLabel: string) => {\n+      AccountServiceClient.Instance.doDelete(\"/credentials/\" + credentialId)\n         .then(() => {\n-            this.setState({isTotpConfigured: false});\n-            ContentAlert.success('successTotpRemovedMessage');\n+            this.getCredentialContainers();\n+            ContentAlert.success('successRemovedMessage', [userLabel]);\n         });\n     }\n \n     public render(): React.ReactNode {", "originalCommit": "4ec5b50d3f18b2c87440e95f2a11fd38ff770f73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcxNjU5OA==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r369716598", "bodyText": "I'm not sure that it needs to be aligned.  It is centered instead, which is standard for Empty State.\nI considered using the EmptyState component for this, which makes it a little fancier.  With that, it becomes much more obvious that it needs to be centered.", "author": "ssilvert", "createdAt": "2020-01-22T18:03:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MTI1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzOTc3NQ==", "url": "https://github.com/keycloak/keycloak/pull/6686#discussion_r370039775", "bodyText": "What I meant was that e.g. \"Created: {date}\" is vertically aligned and it looks great whereas \"Credential is not set up.\" is not. But thinking about this more, I think it can be either way (centered or not centered).", "author": "vmuzikar", "createdAt": "2020-01-23T10:29:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5MTI1NQ=="}], "type": "inlineReview"}, {"oid": "7a700105c1e289c3bbfc95a455614e4eeff6ebfd", "url": "https://github.com/keycloak/keycloak/commit/7a700105c1e289c3bbfc95a455614e4eeff6ebfd", "message": "KEYCLOAK-11550: Signing In page", "committedDate": "2020-01-22T21:41:41Z", "type": "commit"}, {"oid": "7a700105c1e289c3bbfc95a455614e4eeff6ebfd", "url": "https://github.com/keycloak/keycloak/commit/7a700105c1e289c3bbfc95a455614e4eeff6ebfd", "message": "KEYCLOAK-11550: Signing In page", "committedDate": "2020-01-22T21:41:41Z", "type": "forcePushed"}]}