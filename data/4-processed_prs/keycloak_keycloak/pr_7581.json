{"pr_number": 7581, "pr_title": "KEYCLOAK-16156 Optimize maven repo handling", "pr_createdAt": "2020-11-05T10:59:54Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7581", "timeline": [{"oid": "b2f7dfdc8eeca9dd3daab54b2cf606d3383799e5", "url": "https://github.com/keycloak/keycloak/commit/b2f7dfdc8eeca9dd3daab54b2cf606d3383799e5", "message": "KEYCLOAK-16156 Optimize maven repo handling", "committedDate": "2020-11-05T11:16:38Z", "type": "forcePushed"}, {"oid": "0a3ac0e4cd4b52232ffa9afcd2f419f6b31189d9", "url": "https://github.com/keycloak/keycloak/commit/0a3ac0e4cd4b52232ffa9afcd2f419f6b31189d9", "message": "KEYCLOAK-16156 Optimize maven repo handling", "committedDate": "2020-11-05T11:21:31Z", "type": "forcePushed"}, {"oid": "32f5246a2fdf4156c9577247acceaae69c5ff93b", "url": "https://github.com/keycloak/keycloak/commit/32f5246a2fdf4156c9577247acceaae69c5ff93b", "message": "KEYCLOAK-16156 Optimize maven repo handling", "committedDate": "2020-11-05T11:35:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2NzE4Ng==", "url": "https://github.com/keycloak/keycloak/pull/7581#discussion_r518067186", "bodyText": "Just cosmetic change to be consistent, somewhere the exit ${PIPESTATUS[0]} is on separate line and somewhere not\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      mvn clean install -B -Pquarkus,auth-server-quarkus -f testsuite/integration-arquillian/tests/base/pom.xml -Dtest='!org.keycloak.testsuite.adapter.**,!**.crossdc.**,!**.cluster.**' | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n          \n          \n            \n                      mvn clean install -B -Pquarkus,auth-server-quarkus -f testsuite/integration-arquillian/tests/base/pom.xml -Dtest='!org.keycloak.testsuite.adapter.**,!**.crossdc.**,!**.cluster.**' | misc/log/trimmer.sh\n          \n          \n            \n                      exit ${PIPESTATUS[0]}", "author": "martin-kanis", "createdAt": "2020-11-05T13:54:34Z", "path": ".github/workflows/ci-x.yml", "diffHunk": "@@ -36,23 +34,26 @@ jobs:\n       MAVEN_OPTS: -Xmx2048m\n     steps:\n       - uses: actions/checkout@v2\n+\n+      - name: Cache Maven packages\n+        uses: actions/cache@v2\n+        with:\n+          path: |\n+            ~/.m2/repository\n+            !~/.m2/repository/org/keycloak\n+          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: ${{ runner.os }}-m2\n+\n       - uses: actions/setup-java@v1\n         with:\n           java-version: 1.8\n-      - name: Download Maven Repo\n-        uses: actions/download-artifact@v1\n-        with:\n-          name: maven-repo\n-          path: .\n-      - name: Extract Maven Repo\n-        shell: bash\n-        run: tar -xzvf maven-repo.tgz -C ~\n+\n       - name: Run Quarkus unit tests\n-        run: mvn clean install -B -Pquarkus -f quarkus/pom.xml\n-      - name: Build testsuite\n-        run: mvn clean install -B -Pquarkus,auth-server-quarkus -DskipTests -f testsuite/pom.xml\n-      - name: Run base tests\n-        run: mvn clean install -B -Pquarkus,auth-server-quarkus -f testsuite/integration-arquillian/tests/base/pom.xml -Dtest='!org.keycloak.testsuite.adapter.**,!**.crossdc.**,!**.cluster.**' | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n+        run: |\n+          mvn clean install -B -Pquarkus -f quarkus/pom.xml\n+          mvn clean install -B -Pquarkus,auth-server-quarkus -DskipTests -f testsuite/pom.xml\n+          mvn clean install -B -Pquarkus,auth-server-quarkus -f testsuite/integration-arquillian/tests/base/pom.xml -Dtest='!org.keycloak.testsuite.adapter.**,!**.crossdc.**,!**.cluster.**' | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}", "originalCommit": "32f5246a2fdf4156c9577247acceaae69c5ff93b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2ODUyNA==", "url": "https://github.com/keycloak/keycloak/pull/7581#discussion_r518068524", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  - name: Build\n          \n          \n            \n                  - name: Build cache", "author": "martin-kanis", "createdAt": "2020-11-05T13:56:23Z", "path": ".github/workflows/ci.yml", "diffHunk": "@@ -12,25 +12,24 @@ jobs:\n         with:\n           java-version: 1.8\n       - name: Cache Maven packages\n+        id: cache\n         uses: actions/cache@v2\n         with:\n-          path: ~/.m2/repository\n+          path: |\n+            ~/.m2/repository\n+            !~/.m2/repository/org/keycloak\n           key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}\n           restore-keys: ${{ runner.os }}-m2\n       - name: Build", "originalCommit": "32f5246a2fdf4156c9577247acceaae69c5ff93b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2OTM3Nw==", "url": "https://github.com/keycloak/keycloak/pull/7581#discussion_r518069377", "bodyText": "Also to be consistent with Quarkus yaml\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      mvn install -nsu -B -DskipTests -Pdistribution\n          \n          \n            \n                      mvn clean install -nsu -B -DskipTests -Pdistribution", "author": "martin-kanis", "createdAt": "2020-11-05T13:57:30Z", "path": ".github/workflows/ci.yml", "diffHunk": "@@ -12,25 +12,24 @@ jobs:\n         with:\n           java-version: 1.8\n       - name: Cache Maven packages\n+        id: cache\n         uses: actions/cache@v2\n         with:\n-          path: ~/.m2/repository\n+          path: |\n+            ~/.m2/repository\n+            !~/.m2/repository/org/keycloak\n           key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}\n           restore-keys: ${{ runner.os }}-m2\n       - name: Build\n-        run: mvn install -B -DskipTests -Pdistribution\n-      - name: Tar Maven Repo\n-        shell: bash\n-        run: tar -czvf maven-repo.tgz -C ~ .m2/repository\n-      - name: Persist Maven Repo\n-        uses: actions/upload-artifact@v1\n-        with:\n-          name: maven-repo\n-          path: maven-repo.tgz\n+        if: steps.cache.outputs.cache-hit != 'true'\n+        run: |\n+          mvn clean install -B -e -DskipTests -Pquarkus,distribution\n+          mvn install -nsu -B -DskipTests -Pdistribution", "originalCommit": "32f5246a2fdf4156c9577247acceaae69c5ff93b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "081ed1ff2e192cd124ffb666cc7c9baa6e1d35af", "url": "https://github.com/keycloak/keycloak/commit/081ed1ff2e192cd124ffb666cc7c9baa6e1d35af", "message": "KEYCLOAK-16156 Optimize maven repo handling", "committedDate": "2020-11-05T14:06:28Z", "type": "forcePushed"}, {"oid": "208f5e3805bf2a6c3119b7db000e64257c3a7aae", "url": "https://github.com/keycloak/keycloak/commit/208f5e3805bf2a6c3119b7db000e64257c3a7aae", "message": "KEYCLOAK-16156 Optimize maven repo handling", "committedDate": "2020-11-05T15:23:15Z", "type": "commit"}, {"oid": "208f5e3805bf2a6c3119b7db000e64257c3a7aae", "url": "https://github.com/keycloak/keycloak/commit/208f5e3805bf2a6c3119b7db000e64257c3a7aae", "message": "KEYCLOAK-16156 Optimize maven repo handling", "committedDate": "2020-11-05T15:23:15Z", "type": "forcePushed"}]}