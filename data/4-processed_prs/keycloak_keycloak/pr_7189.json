{"pr_number": 7189, "pr_title": "KEYCLOAK-14520 NPE when deploying SpringBoot as WAR", "pr_createdAt": "2020-06-19T10:48:22Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7189", "timeline": [{"oid": "bb4bc01ceeb219dc1ddb09a8b2542a22123269e3", "url": "https://github.com/keycloak/keycloak/commit/bb4bc01ceeb219dc1ddb09a8b2542a22123269e3", "message": "Fixing issue https://issues.redhat.com/browse/KEYCLOAK-14520", "committedDate": "2020-06-19T10:46:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkwMzAxNA==", "url": "https://github.com/keycloak/keycloak/pull/7189#discussion_r447903014", "bodyText": "Can we set required=false so that we still keep the current behavior where the adapter config is set directly?", "author": "pedroigor", "createdAt": "2020-06-30T18:44:20Z", "path": "adapters/oidc/spring-boot-adapter-core/src/main/java/org/keycloak/adapters/springboot/KeycloakSpringBootConfigResolver.java", "diffHunk": "@@ -21,13 +21,15 @@\n import org.keycloak.adapters.KeycloakDeploymentBuilder;\n import org.keycloak.adapters.OIDCHttpFacade;\n import org.keycloak.representations.adapters.config.AdapterConfig;\n+import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.context.annotation.Configuration;\n \n @Configuration\n public class KeycloakSpringBootConfigResolver implements org.keycloak.adapters.KeycloakConfigResolver {\n \n     private KeycloakDeployment keycloakDeployment;\n \n+    @Autowired", "originalCommit": "bb4bc01ceeb219dc1ddb09a8b2542a22123269e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEyMjU0OA==", "url": "https://github.com/keycloak/keycloak/pull/7189#discussion_r448122548", "bodyText": "Another - maybe better solution would be to replace the Autowired annotation with a constructor and an argument AdapterConfig, like this:\npublic KeycloakSpringBootConfigResolver(AdapterConfig config) {\n  this.adapterConfig = config;\n}\n\nBecause then, Spring will also identify, that AdapterConfig must be initialized before initializing KeycloakSpringBootConfigResolver. Because I'm not sure, if required=false really helps. But constructor injection would be fine too.\nIf you think, that would be better, let me know and I change the PR.", "author": "trickert76", "createdAt": "2020-07-01T05:25:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkwMzAxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0NDg4MQ==", "url": "https://github.com/keycloak/keycloak/pull/7189#discussion_r448344881", "bodyText": "You probably know Spring better than me :) The only reason I did that comment is that we have a previous fix that was about  making the auto-configuration work across both SB and Spring Security.\nBy using required=false, I would assume that we would still support cases where the adapter config is set directly as it stands today. Thus, without impact (again and again) people using Spring with Keycloak.", "author": "pedroigor", "createdAt": "2020-07-01T12:58:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkwMzAxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU2NjUxOQ==", "url": "https://github.com/keycloak/keycloak/pull/7189#discussion_r449566519", "bodyText": "Ah, sorry for my late response. Good point. I'd like to try that. Because of my vacation for two weeks, I need to postpone that til mid of July. Is that okay? Also I say, that field injection with AutoWired is not best practice but constructor injection is better. But in that case, the class signature changes, what I would like to avoid.\nAlso - another point - we could create a public setAdapterConfig() or replace the private field with a protected field. In both cases the Spring application which is WAR-deployment-aware can set the AdapterConfig explicitly.\nBut first, I'll try required=false", "author": "trickert76", "createdAt": "2020-07-03T12:49:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkwMzAxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYyNjkyOA==", "url": "https://github.com/keycloak/keycloak/pull/7189#discussion_r449626928", "bodyText": "I've tested required=false in my workspace and there it works for JAR an WAR deployment. In both cases the PR works for me.", "author": "trickert76", "createdAt": "2020-07-03T15:07:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkwMzAxNA=="}], "type": "inlineReview"}, {"oid": "4f4eec4d1e6a99f292b07cbfe69d7ecff34535ca", "url": "https://github.com/keycloak/keycloak/commit/4f4eec4d1e6a99f292b07cbfe69d7ecff34535ca", "message": "switching to required=false", "committedDate": "2020-07-03T14:03:32Z", "type": "commit"}]}