{"pr_number": 7579, "pr_title": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions", "pr_createdAt": "2020-11-04T16:33:29Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7579", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU4NjIyMw==", "url": "https://github.com/keycloak/keycloak/pull/7579#discussion_r517586223", "bodyText": "I believe the two stages can be put together:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  - name: Run crossdc-server tests\n          \n          \n            \n                    if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n          \n          \n            \n                    run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n          \n          \n            \n                  - name: Run crossdc-adapter tests\n          \n          \n            \n                    if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n          \n          \n            \n                    run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly,app-server-wildfly \"-Dtest=org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n          \n          \n            \n                  - name: Run crossdc-server tests\n          \n          \n            \n                    if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n          \n          \n            \n                    run: mvn install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly,app-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*,org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}", "author": "hmlnarik", "createdAt": "2020-11-04T19:38:55Z", "path": ".github/workflows/ci.yml", "diffHunk": "@@ -67,6 +67,38 @@ jobs:\n       - name: Run base tests\n         run: mvn install -B -Pauth-server-wildfly -f testsuite/integration-arquillian/tests/base/pom.xml | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n \n+  test-crossdc:\n+    name: Crossdc Tests\n+    needs: build\n+    runs-on: ubuntu-latest\n+    env:\n+      MAVEN_OPTS: -Xmx1024m\n+    steps:\n+      - uses: actions/checkout@v2\n+        with:\n+          fetch-depth: 2\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - name: Download Maven Repo\n+        uses: actions/download-artifact@v1\n+        with:\n+          name: maven-repo\n+          path: .\n+      - name: Extract Maven Repo\n+        shell: bash\n+        run: tar -xzvf maven-repo.tgz -C ~\n+      - name: Build testsuite\n+        run: mvn clean install -B -nsu -Pauth-servers-crossdc-jboss,auth-server-wildfly,cache-server-infinispan,app-server-wildfly -DskipTests\n+      - name: Run git diff\n+        run: echo \"GIT_DIFF=$( git diff --name-only HEAD^ | egrep -ic 'crossdc|infinispan' )\" >> $GITHUB_ENV;\n+      - name: Run crossdc-server tests\n+        if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n+        run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n+      - name: Run crossdc-adapter tests\n+        if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n+        run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly,app-server-wildfly \"-Dtest=org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n+", "originalCommit": "3f6e54680fa82a8f1fa810c31c48b074cb210048", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "09acb88246472d1bc1e21768baaed353ee84f0a1", "url": "https://github.com/keycloak/keycloak/commit/09acb88246472d1bc1e21768baaed353ee84f0a1", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions", "committedDate": "2020-11-04T19:44:40Z", "type": "forcePushed"}, {"oid": "f1573afff1043b0dfdf0baa17d2e26d45404d761", "url": "https://github.com/keycloak/keycloak/commit/f1573afff1043b0dfdf0baa17d2e26d45404d761", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions", "committedDate": "2020-11-04T19:46:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgxNTAxOQ==", "url": "https://github.com/keycloak/keycloak/pull/7579#discussion_r517815019", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*,org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n          \n          \n            \n                    run: mvn clean install -B -f testsuite/integration-arquillian/tests/base/pom.xml -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*,org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n          \n      \n    \n    \n  \n\nOtherwise it would fail: https://github.com/hmlnarik/keycloak/runs/1356728122?check_suite_focus=true", "author": "hmlnarik", "createdAt": "2020-11-05T06:19:36Z", "path": ".github/workflows/ci.yml", "diffHunk": "@@ -67,6 +67,35 @@ jobs:\n       - name: Run base tests\n         run: mvn install -B -Pauth-server-wildfly -f testsuite/integration-arquillian/tests/base/pom.xml | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n \n+  test-crossdc:\n+    name: CrossDC Tests\n+    needs: build\n+    runs-on: ubuntu-latest\n+    env:\n+      MAVEN_OPTS: -Xmx1024m\n+    steps:\n+      - uses: actions/checkout@v2\n+        with:\n+          fetch-depth: 2\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - name: Download Maven Repo\n+        uses: actions/download-artifact@v1\n+        with:\n+          name: maven-repo\n+          path: .\n+      - name: Extract Maven Repo\n+        shell: bash\n+        run: tar -xzvf maven-repo.tgz -C ~\n+      - name: Build testsuite\n+        run: mvn clean install -B -nsu -Pauth-servers-crossdc-jboss,auth-server-wildfly,cache-server-infinispan,app-server-wildfly -DskipTests\n+      - name: Run git diff\n+        run: echo \"GIT_DIFF=$( git diff --name-only HEAD^ | egrep -ic 'crossdc|infinispan' )\" >> $GITHUB_ENV;\n+      - name: Run crossdc-server and crossdc-adapter tests\n+        if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n+        run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*,org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}", "originalCommit": "f1573afff1043b0dfdf0baa17d2e26d45404d761", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0ba9b276705b355042504ed0031dde4383fd4a4a", "url": "https://github.com/keycloak/keycloak/commit/0ba9b276705b355042504ed0031dde4383fd4a4a", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions", "committedDate": "2020-11-05T06:29:13Z", "type": "commit"}, {"oid": "0ba9b276705b355042504ed0031dde4383fd4a4a", "url": "https://github.com/keycloak/keycloak/commit/0ba9b276705b355042504ed0031dde4383fd4a4a", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions", "committedDate": "2020-11-05T06:29:13Z", "type": "forcePushed"}]}