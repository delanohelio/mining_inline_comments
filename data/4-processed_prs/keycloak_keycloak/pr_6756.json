{"pr_number": 6756, "pr_title": "KEYCLOAK-12579: LDAP groups duplicated during UI listing of user groups", "pr_createdAt": "2020-02-07T18:24:26Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6756", "timeline": [{"oid": "f0bc0a594b8cf567628730845a0287249470783f", "url": "https://github.com/keycloak/keycloak/commit/f0bc0a594b8cf567628730845a0287249470783f", "message": "KEYCLOAK-12579: LDAP groups duplicated during UI listing of user groups", "committedDate": "2020-02-11T16:56:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3ODA2Mg==", "url": "https://github.com/keycloak/keycloak/pull/6756#discussion_r388978062", "bodyText": "Yes, as you pointed, this may need to be added into separate file though as keycloak 9.0.0 is already released.", "author": "mposolda", "createdAt": "2020-03-06T15:44:03Z", "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-9.0.0.xml", "diffHunk": "@@ -64,4 +64,10 @@\n         <addPrimaryKey columnNames=\"USER_SESSION_ID, CLIENT_ID, CLIENT_STORAGE_PROVIDER, EXTERNAL_CLIENT_ID, OFFLINE_FLAG\" constraintName=\"CONSTRAINT_OFFL_CL_SES_PK3\" tableName=\"OFFLINE_CLIENT_SESSION\"/>\n     </changeSet>\n \n+    <changeSet author=\"keycloak\" id=\"9.0.0-KEYCLOAK-12579\">", "originalCommit": "f0bc0a594b8cf567628730845a0287249470783f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMwNDUxMA==", "url": "https://github.com/keycloak/keycloak/pull/6756#discussion_r390304510", "bodyText": "Moved to 9.0.1.", "author": "rmartinc", "createdAt": "2020-03-10T13:17:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3ODA2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3OTQ2Mw==", "url": "https://github.com/keycloak/keycloak/pull/6756#discussion_r388979463", "bodyText": "I have some fear of the Oracle DB with this constraint. Oracle doesn't know the difference between null and empty strings, so my guess is, that it won't work with \"\" as default empty string. Maybe \" \" will work better...\nI will try to run DB tests and will let you know.", "author": "mposolda", "createdAt": "2020-03-06T15:46:32Z", "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-9.0.0.xml", "diffHunk": "@@ -64,4 +64,10 @@\n         <addPrimaryKey columnNames=\"USER_SESSION_ID, CLIENT_ID, CLIENT_STORAGE_PROVIDER, EXTERNAL_CLIENT_ID, OFFLINE_FLAG\" constraintName=\"CONSTRAINT_OFFL_CL_SES_PK3\" tableName=\"OFFLINE_CLIENT_SESSION\"/>\n     </changeSet>\n \n+    <changeSet author=\"keycloak\" id=\"9.0.0-KEYCLOAK-12579\">\n+        <!-- Now the parent group cannot be NULL to make SIBLING_NAMES unique constraint work -->\n+        <!-- Top level groups are now marked with the empty string -->\n+        <addNotNullConstraint tableName=\"KEYCLOAK_GROUP\" columnName=\"PARENT_GROUP\" columnDataType=\"VARCHAR(36)\" defaultNullValue=\"\"/>", "originalCommit": "f0bc0a594b8cf567628730845a0287249470783f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAxMjA3NA==", "url": "https://github.com/keycloak/keycloak/pull/6756#discussion_r389012074", "bodyText": "Ah! I didn't know that oracle behavior, I think that it won't work in Oracle for sure. You can just test the GroupTest and tell me, because I think a lot of tests are going to fail. The code is more or less prepared to change the top name to anything, I'll use \" \" as you suggest.", "author": "rmartinc", "createdAt": "2020-03-06T16:40:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3OTQ2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc1NTU2Nw==", "url": "https://github.com/keycloak/keycloak/pull/6756#discussion_r389755567", "bodyText": "Sent you an email with some details about the results of DB run. The PR will need some work...", "author": "mposolda", "createdAt": "2020-03-09T15:12:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3OTQ2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc1NzE5NA==", "url": "https://github.com/keycloak/keycloak/pull/6756#discussion_r389757194", "bodyText": "Buf! OK, I'll rebase and test again.", "author": "rmartinc", "createdAt": "2020-03-09T15:14:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3OTQ2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMwNjc5Ng==", "url": "https://github.com/keycloak/keycloak/pull/6756#discussion_r390306796", "bodyText": "OK! Rebased and the top id is changed to \" \". The issue with sql server is that in order to add a NOT NULL constraint the previous SIBLING_NAMES constraint should be dropped before and re-created after (I've realized that it's done this way in other XML files for other table changes). Let's see how the tests go.", "author": "rmartinc", "createdAt": "2020-03-10T13:21:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3OTQ2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NDI3NQ==", "url": "https://github.com/keycloak/keycloak/pull/6756#discussion_r390344275", "bodyText": "@rmartinc Travis failed in cross-dc tests, but it is unrelated to this PR. I re-run the pipeline tests for this. I hope to let you know around tomorrow. Thanks!", "author": "mposolda", "createdAt": "2020-03-10T14:15:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3OTQ2Mw=="}], "type": "inlineReview"}, {"oid": "0b371564bc0be835695724df1e6c05ebd837127e", "url": "https://github.com/keycloak/keycloak/commit/0b371564bc0be835695724df1e6c05ebd837127e", "message": "KEYCLOAK-12579: LDAP groups duplicated during UI listing of user groups", "committedDate": "2020-03-10T08:13:19Z", "type": "commit"}, {"oid": "0b371564bc0be835695724df1e6c05ebd837127e", "url": "https://github.com/keycloak/keycloak/commit/0b371564bc0be835695724df1e6c05ebd837127e", "message": "KEYCLOAK-12579: LDAP groups duplicated during UI listing of user groups", "committedDate": "2020-03-10T08:13:19Z", "type": "forcePushed"}]}