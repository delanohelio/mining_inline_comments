{"pr_number": 3242, "pr_title": "STORM-3614 switch SystemBolt metrics to V2 API", "pr_createdAt": "2020-04-01T20:02:07Z", "pr_url": "https://github.com/apache/storm/pull/3242", "timeline": [{"oid": "6f58af7fa88571e5ce41f17029cfd08d96a8074b", "url": "https://github.com/apache/storm/commit/6f58af7fa88571e5ce41f17029cfd08d96a8074b", "message": "STORM-3614 switch SystemBolt metrics to V2 API", "committedDate": "2020-04-02T16:18:18Z", "type": "forcePushed"}, {"oid": "e0494db16dbce7626802f650e1163f776f09fda1", "url": "https://github.com/apache/storm/commit/e0494db16dbce7626802f650e1163f776f09fda1", "message": "STORM-3614 switch SystemBolt metrics to V2 API", "committedDate": "2020-04-02T19:10:51Z", "type": "forcePushed"}, {"oid": "7a59a901595f8146fa85e94330bc33c24b655608", "url": "https://github.com/apache/storm/commit/7a59a901595f8146fa85e94330bc33c24b655608", "message": "STORM-3614 switch SystemBolt metrics to V2 API", "committedDate": "2020-04-02T19:41:54Z", "type": "forcePushed"}, {"oid": "7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc", "url": "https://github.com/apache/storm/commit/7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc", "message": "STORM-3614 switch SystemBolt metrics to V2 API", "committedDate": "2020-04-02T20:09:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU5ODM2OA==", "url": "https://github.com/apache/storm/pull/3242#discussion_r402598368", "bodyText": "Will there be any possible conflicts since it's pulling in two different major versions of dropwizard.metrics?\nEven though they are for different artifacts, I am worried about transitive dependencies", "author": "Ethanlm", "createdAt": "2020-04-02T21:10:50Z", "path": "pom.xml", "diffHunk": "@@ -295,6 +295,7 @@\n         <log4j.version>2.11.2</log4j.version>\n         <slf4j.version>1.7.26</slf4j.version>\n         <metrics.version>3.2.6</metrics.version>\n+        <metrics.jvm.version>4.0.7</metrics.jvm.version>", "originalCommit": "7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMxNzU0MA==", "url": "https://github.com/apache/storm/pull/3242#discussion_r404317540", "bodyText": "I didn't see any problems when running a mvn dependency tree.\n[INFO] +- io.dropwizard.metrics:metrics-jvm:jar:4.0.7:compile\n[INFO] |  +- (io.dropwizard.metrics:metrics-core:jar:3.2.6:compile - version managed from 4.0.7; omitted for duplicate)", "author": "agresch", "createdAt": "2020-04-06T18:57:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU5ODM2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgxODI2Ng==", "url": "https://github.com/apache/storm/pull/3242#discussion_r404818266", "bodyText": "So there are two metrics-core in the dependencies, one is 4.0.7 and the other one is 3.2.6. I am afraid they could conflict each other at runtime since they are different at major version level.", "author": "Ethanlm", "createdAt": "2020-04-07T13:42:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU5ODM2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg3MTU3NA==", "url": "https://github.com/apache/storm/pull/3242#discussion_r404871574", "bodyText": "I'll change the version.", "author": "agresch", "createdAt": "2020-04-07T14:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU5ODM2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYwODAzNQ==", "url": "https://github.com/apache/storm/pull/3242#discussion_r402608035", "bodyText": "Do we want to add some unit tests in java code?", "author": "Ethanlm", "createdAt": "2020-04-02T21:31:31Z", "path": "storm-core/test/clj/org/apache/storm/metrics_test.clj", "diffHunk": "@@ -376,26 +376,5 @@\n       (assert-metric-running-sum! \"mybolt\" \"__ack-count/myspout:default\" 2 4 cluster)\n       (assert-metric-running-sum! \"mybolt\" \"__execute-count/myspout:default\" 3 4 cluster))))\n \n-(deftest test-system-bolt", "originalCommit": "7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMxODgxMA==", "url": "https://github.com/apache/storm/pull/3242#discussion_r404318810", "bodyText": "I don't think it's worth the effort for getting this in.  If you feel replacing this test is important enough, I would suggest opening a new JIRA.", "author": "agresch", "createdAt": "2020-04-06T18:59:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYwODAzNQ=="}], "type": "inlineReview"}, {"oid": "6d8052e5f5442147716f8b6c2b783c7f58481fc8", "url": "https://github.com/apache/storm/commit/6d8052e5f5442147716f8b6c2b783c7f58481fc8", "message": "STORM-3614 switch SystemBolt metrics to V2 API", "committedDate": "2020-04-06T20:24:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMzAyNA==", "url": "https://github.com/apache/storm/pull/3242#discussion_r404823024", "bodyText": "These metrics are no longer from ManagementFactory right?", "author": "Ethanlm", "createdAt": "2020-04-07T13:48:34Z", "path": "docs/Metrics.md", "diffHunk": "@@ -299,29 +299,28 @@ The value is a map where the key is a NodeInfo class for the downstream worker i\n \n ##### JVM Memory\n \n-JVM memory usage is reported through `memory/nonHeap` for off heap memory and `memory/heap` for on heap memory.  These values come from the [MemoryUsage](https://docs.oracle.com/javase/8/docs/api/index.html?java/lang/management/MemoryUsage.html) mxbean.  Each of the metrics are reported as a map with the following keys, and values returned by the corresponding java code.\n+JVM memory usage is reported through `memory.non-heap` for off heap memory, `memory.heap` for on heap memory and `memory.total` for combined values.  These values come from the [MemoryUsage](https://docs.oracle.com/javase/8/docs/api/index.html?java/lang/management/MemoryUsage.html) mxbean.  Each of the metrics are reported as a map with the following keys, and values returned by the corresponding java code.\n \n | Key | Corresponding Code |\n |--------|--------------------|\n-| `maxBytes` | `memUsage.getMax()` |\n-| `committedBytes` | `memUsage.getCommitted()` |\n-| `initBytes` | `memUsage.getInit()` |\n-| `usedBytes` | `memUsage.getUsed()` |\n-| `virtualFreeBytes` | `memUsage.getMax() - memUsage.getUsed()` |\n-| `unusedBytes` | `memUsage.getCommitted() - memUsage.getUsed()` |\n+| `max` | `memUsage.getMax()` |\n+| `committed` | `memUsage.getCommitted()` |\n+| `init` | `memUsage.getInit()` |\n+| `used` | `memUsage.getUsed()` |\n+| `usage` | `Ratio.of(memUsage.getUsed(), memUsage.getMax())` |\n \n ##### JVM Garbage Collection\n \n-The exact GC metric name depends on the garbage collector that your worker uses.  The data is all collected from `ManagementFactory.getGarbageCollectorMXBeans()` and the name of the metrics is `\"GC/\"` followed by the name of the returned bean with white space removed.  The reported metrics are just\n+The exact GC metric name depends on the garbage collector that your worker uses.  The data is all collected from `ManagementFactory.getGarbageCollectorMXBeans()` and the name of the metrics is `\"GC\"` followed by the name of the returned bean with white space removed.  The reported metrics are just", "originalCommit": "6d8052e5f5442147716f8b6c2b783c7f58481fc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg3MzQ5MQ==", "url": "https://github.com/apache/storm/pull/3242#discussion_r404873491", "bodyText": "They still do indirectly - https://github.com/infusionsoft/yammer-metrics/blob/master/metrics-jvm/src/main/java/com/codahale/metrics/jvm/GarbageCollectorMetricSet.java#L26", "author": "agresch", "createdAt": "2020-04-07T14:53:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMzAyNA=="}], "type": "inlineReview"}, {"oid": "444df67ab5a1fd801d2c043bedcd08ae735ebb48", "url": "https://github.com/apache/storm/commit/444df67ab5a1fd801d2c043bedcd08ae735ebb48", "message": "STORM-3614 switch SystemBolt metrics to V2 API", "committedDate": "2020-04-07T16:48:52Z", "type": "forcePushed"}, {"oid": "a34e0cb54f4712a8f10fd2c082ee105c38f24ca7", "url": "https://github.com/apache/storm/commit/a34e0cb54f4712a8f10fd2c082ee105c38f24ca7", "message": "STORM-3614 switch SystemBolt metrics to V2 API", "committedDate": "2020-04-07T21:04:40Z", "type": "commit"}, {"oid": "a34e0cb54f4712a8f10fd2c082ee105c38f24ca7", "url": "https://github.com/apache/storm/commit/a34e0cb54f4712a8f10fd2c082ee105c38f24ca7", "message": "STORM-3614 switch SystemBolt metrics to V2 API", "committedDate": "2020-04-07T21:04:40Z", "type": "forcePushed"}]}