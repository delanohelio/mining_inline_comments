{"pr_number": 2526, "pr_title": "(3.13) Adding support for running test suite against bootable JAR", "pr_createdAt": "2020-09-15T17:40:40Z", "pr_url": "https://github.com/resteasy/resteasy/pull/2526", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0MTA5Nw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492041097", "bodyText": "This additional space is not necessary ...", "author": "marekkopecky", "createdAt": "2020-09-21T13:24:20Z", "path": "resteasy-dependencies-bom/pom.xml", "diffHunk": "@@ -15,8 +15,8 @@\n     <name>RESTEasy dependencies BOM</name>\n     <description>RESTEasy dependencies BOM</description>\n     <properties>\n-        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n-        <dep.arquillian-bom.version>1.1.15.Final</dep.arquillian-bom.version>\n+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>        ", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0MTI5NA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492041294", "bodyText": "This additional space is not necessary ...", "author": "marekkopecky", "createdAt": "2020-09-21T13:24:36Z", "path": "resteasy-dependencies-bom/pom.xml", "diffHunk": "@@ -80,8 +80,8 @@\n         <version.org.wildfly.core.wildfly-cli>7.0.0.Final</version.org.wildfly.core.wildfly-cli>\n         <version.org.wildfly.extras.creaper>1.6.1</version.org.wildfly.extras.creaper>\n         <version.org.wildfly.wildfly-arquillian-container-managed>2.2.0.Final</version.org.wildfly.wildfly-arquillian-container-managed>\n-        <version.org.wildfly.wildfly-arquillian-container-remote>2.1.1.Final</version.org.wildfly.wildfly-arquillian-container-remote>\n-        <version.org.yaml.snakeyaml>1.26</version.org.yaml.snakeyaml>\n+         <version.org.wildfly.wildfly-arquillian-container-bootable>3.0.0.Beta3</version.org.wildfly.wildfly-arquillian-container-bootable>\n+         <version.org.yaml.snakeyaml>1.26</version.org.yaml.snakeyaml>", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0MTg5NA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492041894", "bodyText": "Same here (many spaces at the end of a line)", "author": "marekkopecky", "createdAt": "2020-09-21T13:25:22Z", "path": "testsuite/arquillian-utils/pom.xml", "diffHunk": "@@ -30,14 +30,36 @@\n                 </dependency>\n             </dependencies>\n         </profile>\n+        <profile>\n+            <id>bootablejar.profile</id>\n+            <activation>\n+                <property>\n+                    <name>ts.bootable</name>\n+                </property>\n+            </activation>\n+            <dependencies>\n+                <dependency>\n+                    <groupId>org.wildfly.arquillian</groupId>\n+                    <artifactId>wildfly-arquillian-container-bootable</artifactId>\n+                </dependency>\n+            </dependencies>\n+        </profile>\n     </profiles>\n \n     <dependencies>\n         <!-- arquillian general -->\n         <dependency>\n             <groupId>org.jboss.shrinkwrap.resolver</groupId>\n             <artifactId>shrinkwrap-resolver-depchain</artifactId>\n-            <type>pom</type>\n+            <type>pom</type>            ", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492044836", "bodyText": "Is it possible to use standalone-full for bootable-jar testing here?", "author": "marekkopecky", "createdAt": "2020-09-21T13:29:42Z", "path": "testsuite/integration-tests/src/test/java/org/jboss/resteasy/test/cdi/injection/InjectionTest.java", "diffHunk": "@@ -74,7 +75,8 @@\n @RunWith(Arquillian.class)\n @RunAsClient\n @Category({\n-    ExpectedFailingWithStandaloneMicroprofileConfiguration.class // MP is missing jboss.naming.context.java.jboss.exported.jms.RemoteConnectionFactory\n+    ExpectedFailingWithStandaloneMicroprofileConfiguration.class, // MP is missing jboss.naming.context.java.jboss.exported.jms.RemoteConnectionFactory\n+    NotForBootableJar.class // needs ejb + standalone-full", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4NTQyOA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492185428", "bodyText": "I don't think so. The supported layers combinations never bring up a standalone-full. I discussed this with @jfdenise who could add more input, in case it is needed.", "author": "fabiobrz", "createdAt": "2020-09-21T16:17:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ4OTE3Mw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492489173", "bodyText": "Right, sorry, standalone profiles probably doesn't make sense in this context. So what layer is missing for correct execution of this test (from standalone-full)? Messaging?", "author": "marekkopecky", "createdAt": "2020-09-22T05:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjUxMjgyMg==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492512822", "bodyText": "IIRC was messaging but there were several more things missing. In fact I tried and added the new messaging layer but it didin't work.", "author": "fabiobrz", "createdAt": "2020-09-22T07:01:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjUxOTQzOA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492519438", "bodyText": "It would be great to describe more details about reason for ignoring this testcase to java comment ...", "author": "marekkopecky", "createdAt": "2020-09-22T07:16:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MzIyMA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492663220", "bodyText": "Ok, adding more detail about the fact that a 250 MB bootable JAR is basically useless.", "author": "fabiobrz", "createdAt": "2020-09-22T11:34:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIwODkyNw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r493208927", "bodyText": "which is useless\n\nHmm, ok, but what is missing in bootable jar to have this working?", "author": "marekkopecky", "createdAt": "2020-09-23T05:38:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIyNDE1MQ==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r493224151", "bodyText": "Messaging was missing for sure, and I added it. Then it failed again, and I discussed the thing with the feature developer, who made his experiments as well and he got to the conclusion that a full server was needed to make this work.\nMaybe @jfdenise can elaborate a bit if what you need to know is the full list of subsystems that should in place.", "author": "fabiobrz", "createdAt": "2020-09-23T06:21:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzOTQ0Nw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r493239447", "bodyText": "I don't think that this blocks this PR. But I'm wondering whether this is some issue that could affects users. @jfdenise can you please provide more details on this?", "author": "marekkopecky", "createdAt": "2020-09-23T06:55:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI0OTM1Mg==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r493249352", "bodyText": "I don't have the list of needed subsystems, I realized that a standalone-full.xml was used in the test (embedded broker for example). I made the bootable JAR to provision a full config and the test passed. BTW, I also noticed that I had to remove one of the 2 executions in the arquilian-bootable.xml. We are starting 2 server that unzip there content in the same location (install-dir). This breaks messaging journal that doesn't seem to like the WildFly directory to be re-written.", "author": "jfdenise", "createdAt": "2020-09-23T07:15:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2MTQ5OA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r493261498", "bodyText": "We are starting 2 server that unzip there content in the same location (install-dir)\n\n+1, this looks like a TS bug. @fabiobrz we can for example add some suffix to the second arquillian container", "author": "marekkopecky", "createdAt": "2020-09-23T07:35:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY0NzM0Nw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r493647347", "bodyText": "Thanks @marekkopecky and @jfdenise, done.", "author": "fabiobrz", "createdAt": "2020-09-23T14:38:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NDgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0NTYyMw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492045623", "bodyText": "Some description with reason would be useful (eg add // no log check support for bootable-jar in RESTEasy TS so far)", "author": "marekkopecky", "createdAt": "2020-09-21T13:30:47Z", "path": "testsuite/integration-tests/src/test/java/org/jboss/resteasy/test/core/basic/DuplicateDeploymentTest.java", "diffHunk": "@@ -27,6 +28,7 @@\n  */\n @RunWith(Arquillian.class)\n @RunAsClient\n+@Category(NotForBootableJar.class)", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Njk3OA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492046978", "bodyText": "no RX layer so far\n\nWhere is RX classes used here?", "author": "marekkopecky", "createdAt": "2020-09-21T13:32:33Z", "path": "testsuite/integration-tests/src/test/java/org/jboss/resteasy/test/microprofile/restclient/RestClientProviderPriorityTest.java", "diffHunk": "@@ -31,6 +33,7 @@\n \n @RunWith(Arquillian.class)\n @RunAsClient\n+@Category(NotForBootableJar.class) // no RX layer so far", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4MzU1NA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492183554", "bodyText": "You're right. There's no use of rx classes, but I added the annotation because I noticed a rx related error. Maybe I was too quick, I am pushing changes that remove it and we'll see what happens, although this should not be considered at all when running ts.bootable profile since I noticed that you always used -Dts.disable.microprofile... right?", "author": "fabiobrz", "createdAt": "2020-09-21T16:14:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Njk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ4ODI5OQ==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492488299", "bodyText": "this should not be considered at all when running ts.bootable profile since I noticed that you always used -Dts.disable.microprofile... right?\n\nThere is no ts.disable.microprofile. There is disable.microprofile.tests, but it affects tests with MicroProfileDependent. But this RestClientProviderPriorityTest class is not annotated by MicroProfileDependent, so it's not related.", "author": "marekkopecky", "createdAt": "2020-09-22T05:55:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Njk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjUxMzYzMw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492513633", "bodyText": "There is no ts.disable.microprofile. There is disable.microprofile.tests\n\nYeah, I was typing quickly and didn't go look for the name but I see you got it.\n\nBut this RestClientProviderPriorityTest class is not annotated by MicroProfileDependent, so it's not related.\n\nGood to know. Annotations were removed, let's see what CI checks say.", "author": "fabiobrz", "createdAt": "2020-09-22T07:03:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Njk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4MTU1OQ==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r493681559", "bodyText": "@marekkopecky this test is passing now, can we resolve this conversation?", "author": "fabiobrz", "createdAt": "2020-09-23T15:21:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Njk3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0OTE4NA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492049184", "bodyText": "Why is this annotation added here?", "author": "marekkopecky", "createdAt": "2020-09-21T13:35:28Z", "path": "testsuite/integration-tests/src/test/java/org/jboss/resteasy/test/microprofile/restclient/RestClientProxyTest.java", "diffHunk": "@@ -63,6 +64,7 @@\n       war.addClass(PortProviderUtil.class);\n       war.addClass(Category.class);\n       war.addClass(MicroProfileDependent.class);\n+      war.addClass(NotForBootableJar.class);", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4MjE2Mw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492182163", "bodyText": "@ronsigal added this. I don't have it in my branch. I think it was because he noticed failures in different profiles execution (e.g.: MicroProfile). I am pushing a version that does not have the annotation, so we can see what the CI checks will report.", "author": "fabiobrz", "createdAt": "2020-09-21T16:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0OTE4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4MjAwNA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r493682004", "bodyText": "@marekkopecky this test is passing now, can we resolve this conversation?", "author": "fabiobrz", "createdAt": "2020-09-23T15:22:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0OTE4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0OTYyMQ==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492049621", "bodyText": "typo, s/fa/far/g", "author": "marekkopecky", "createdAt": "2020-09-21T13:36:04Z", "path": "testsuite/integration-tests/src/test/java/org/jboss/resteasy/test/providers/jsonb/basic/JsonBindingDebugLoggingTest.java", "diffHunk": "@@ -48,6 +50,7 @@\n  */\r\n @RunWith(Arquillian.class)\r\n @ServerSetup({DebugLoggingServerSetup.class}) // TBD: remove debug logging activation?\r\n+@Category(NotForBootableJar.class) // no log check support for bootable-jar in RESTEasy TS so fa\r", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA1MzA5OA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492053098", "bodyText": "Additional spaces at the end of this line ...", "author": "marekkopecky", "createdAt": "2020-09-21T13:40:38Z", "path": "pom.xml", "diffHunk": "@@ -226,6 +227,11 @@\n                     <groupId>org.jacoco</groupId>\r\n                     <artifactId>jacoco-maven-plugin</artifactId>\r\n                     <version>${version.org.jacoco.plugin}</version>\r\n+                </plugin>                \r", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA1MzUwNg==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492053506", "bodyText": "Beta7?", "author": "marekkopecky", "createdAt": "2020-09-21T13:41:11Z", "path": "pom.xml", "diffHunk": "@@ -30,6 +30,7 @@\n         <surefire.system.args>-Xms512m -Xmx512m ${modular.jdk.args}</surefire.system.args>\r\n         <!-- Plugins versions -->\r\n         <version.org.jacoco.plugin>0.7.9</version.org.jacoco.plugin>\r\n+        <version.org.wildfly.jar.plugin>2.0.0.Beta6</version.org.wildfly.jar.plugin>\r", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA1Nzc3Mw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492057773", "bodyText": "Can jboss.home and jboss.server.config.file.name be removed here?", "author": "marekkopecky", "createdAt": "2020-09-21T13:46:49Z", "path": "testsuite/integration-tests/pom.xml", "diffHunk": "@@ -203,6 +203,169 @@\n                 <microprofile.excluded.groups>org.jboss.resteasy.category.ExpectedFailingWithStandaloneMicroprofileConfiguration,org.jboss.resteasy.category.ExpectedFailingBecauseOfSmallRyeMicroprofileOpenApi11</microprofile.excluded.groups>\n             </properties>\n         </profile>\n+        \n+        <profile>\n+            <id>bootablejar.profile</id>\n+            <activation>\n+                <property>\n+                    <name>ts.bootable</name>\n+                </property>\n+            </activation>\n+            <build>\n+                <plugins>\n+                    <plugin>\n+                        <artifactId>maven-dependency-plugin</artifactId>\n+                        <executions>\n+                            <execution>\n+                                <id>unpack</id>\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>unpack</goal>\n+                                </goals>\n+                            </execution>\n+                        </executions>\n+                    </plugin>                    \n+                    <!-- Disable the standard copy-based provisioning -->\n+                    <plugin>\n+                        <groupId>org.apache.maven.plugins</groupId>\n+                        <artifactId>maven-antrun-plugin</artifactId>\n+                        <executions>\n+                            <execution>\n+                                <id>initialize-basedirs</id>\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>run</goal>\n+                                </goals>\n+                            </execution>                            \n+                            <execution>\n+                                <id>unpack-resteasy</id>\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>run</goal>\n+                                </goals>\n+                            </execution>\n+                        </executions>\n+                    </plugin>\n+                    <plugin>\n+                        <groupId>org.wildfly.plugins</groupId>\n+                        <artifactId>wildfly-jar-maven-plugin</artifactId>\n+                        <executions>\n+                            <!-- Package a jaxrs-server layer with a few other layers -->\n+                            <execution>\n+                                <id>bootable-jar-observability-packaging</id>\n+                                <goals>\n+                                    <goal>package</goal>\n+                                </goals>\n+                                <phase>process-test-resources</phase>\n+                                <configuration>\n+                                    <output-file-name>jaxrs-server.jar</output-file-name>\n+                                    <hollowJar>true</hollowJar>\n+                                    <record-state>false</record-state>\n+                                    <log-time>true</log-time>\n+                                    <offline>true</offline>\n+                                    <plugin-options>\n+                                        <jboss-fork-embedded>true</jboss-fork-embedded>\n+                                    </plugin-options>\n+                                    <feature-packs>\n+                                        <feature-pack>\n+                                            <groupId>org.wildfly</groupId>\n+                                            <artifactId>wildfly-galleon-pack</artifactId>\n+                                            <version>${server.version}</version>\n+                                        </feature-pack>\n+                                    </feature-packs>\n+                                    <layers>\n+                                        <layer>jaxrs-server</layer>\n+                                        <layer>microprofile-config</layer>\n+                                        <layer>datasources</layer>\n+                                        <layer>h2-default-datasource</layer>\n+                                        <layer>undertow-legacy-https</layer>\n+                                        <layer>ejb</layer>\n+                                    </layers>\n+                                </configuration>\n+                            </execution>\n+                        </executions>\n+                    </plugin>\n+\n+                    <plugin>\n+                        <artifactId>maven-surefire-plugin</artifactId>\n+                        <configuration>\n+                            <systemPropertyVariables>\n+                                <install.dir>${project.build.directory}/wildfly</install.dir>\n+                                <bootable.jar>${project.build.directory}/jaxrs-server.jar</bootable.jar>\n+                                <arquillian.xml>arquillian-bootable.xml</arquillian.xml>\n+                                <container.management.port.managed>${container.management.port.managed}</container.management.port.managed>\n+                                <securityManagerArg>${securityManagerArg}</securityManagerArg>\n+                                <additionalJvmArgs>${additionalJvmArgs}</additionalJvmArgs>\n+                                <ipv6>false</ipv6>\n+                                <ipv6ArquillianSettings></ipv6ArquillianSettings>\n+                                <node>127.0.0.1</node>\n+                                <!--<jboss.home>${jboss.home}</jboss.home>-->", "originalCommit": "c233fed6f4f5338d9be3fcba8286f0913fcfc402", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "84dfa0f44b23771d6522fcf720046952b30e2eff", "url": "https://github.com/resteasy/resteasy/commit/84dfa0f44b23771d6522fcf720046952b30e2eff", "message": "(3.13) Adding support for running test suite against bootable JAR", "committedDate": "2020-09-21T16:21:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MjMyOA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492492328", "bodyText": "I'm thinking about unpack and unpack-resteasy executions. Why are they needed? According to the Readme file, -Dserver.home=not-needed-for-bootable.jar should be used. In that case, download profile won't be activated, so there is no need to replace unpack and unpack-resteasy executions.\nIf -Dserver.home=not-needed-for-bootable.jar won't be used, download profile will be activated together with bootablejar.profile. In this case, there are two active profiles with the executions of the same names. And AFAIR there is no guarantee from maven side which profile will be executed.", "author": "marekkopecky", "createdAt": "2020-09-22T06:09:30Z", "path": "testsuite/integration-tests/pom.xml", "diffHunk": "@@ -203,6 +203,167 @@\n                 <microprofile.excluded.groups>org.jboss.resteasy.category.ExpectedFailingWithStandaloneMicroprofileConfiguration,org.jboss.resteasy.category.ExpectedFailingBecauseOfSmallRyeMicroprofileOpenApi11</microprofile.excluded.groups>\n             </properties>\n         </profile>\n+        \n+        <profile>\n+            <id>bootablejar.profile</id>\n+            <activation>\n+                <property>\n+                    <name>ts.bootable</name>\n+                </property>\n+            </activation>\n+            <build>\n+                <plugins>\n+                    <plugin>\n+                        <artifactId>maven-dependency-plugin</artifactId>\n+                        <executions>\n+                            <execution>", "originalCommit": "84dfa0f44b23771d6522fcf720046952b30e2eff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjUyNTYyMA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492525620", "bodyText": "Thanks for this comment, this is interesting. So there's no guarantee that - when explicitly using -Dts.bootable the executions here will be used instead of those defined in the download profile?\nWhat would you suggest then? Following up on your reasoning, then we know for sure that those in the download profile will be executed if -Dserver.home=not-needed-for-bootable.ja is passed, once these are removed.\nAnd being the precondition the same I think this last one is a worse scenario. WDYT?\nAnyway, I agree with you and I'd like to have a clean solution here.", "author": "fabiobrz", "createdAt": "2020-09-22T07:28:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MjMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU2NDMwMg==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492564302", "bodyText": "So there's no guarantee that - when explicitly using -Dts.bootable the executions here will be used instead of those defined in the download profile?\n\nAFAIK you can define execution in default <build> once at most. And you can override it in one profile at most. There is nothing like profile orders in maven AFAIK. So if you don't define execution in default <build>, but you define it two times differently in two different active profiles, you don't have any guarantee, which definition will be used (@asoldano @ronsigal feel free to correct me, if I'm wrong).\n\nthose in the download profile will be executed if -Dserver.home=not-needed-for-bootable.jar is passed\n\nActually, download profile is activated like this:\n          <activation>\n            <property>\n              <name>!server.home</name>\n            </property>\n          </activation>\n\nSo if -Dserver.home=not-needed-for-bootable.jar is passed, download profile is not activated (see ! in name element), which is something that we want here.\n\nI'd like to have a clean solution here.\n\n-Dserver.home=not-needed-for-bootable.jar is obviously not super-clean solution. But it is a solution and it is deterministic. I don't see any other simple solution without completely changing the way how maven profiles are constructed now in this repo. @asoldano / @ronsigal Let us know if you have some better idea here ...", "author": "marekkopecky", "createdAt": "2020-09-22T08:36:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MjMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MTAxMw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492661013", "bodyText": "Thanks @marekkopecky - at the moment I am focusing on the fact that the we need those executions to be skipped.\nAs you say, the current implementation only executes those when !server.home, i.e. when the download profile is activated.\nAnd this is deterministic, so I agree with you that this could be the most robust solution.\nI am going to push changes, let's see how CI checks go.", "author": "fabiobrz", "createdAt": "2020-09-22T11:30:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MjMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcwOTU0Ng==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r492709546", "bodyText": "Can we resolve this now, @marekkopecky? WDYT?", "author": "fabiobrz", "createdAt": "2020-09-22T12:55:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MjMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIwOTY5Nw==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r493209697", "bodyText": "Yes, thanks!", "author": "marekkopecky", "createdAt": "2020-09-23T05:40:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MjMyOA=="}], "type": "inlineReview"}, {"oid": "dd9f2eab7751484bc7b98f919be00f17845ce2b1", "url": "https://github.com/resteasy/resteasy/commit/dd9f2eab7751484bc7b98f919be00f17845ce2b1", "message": "(3.13) Adding support for running test suite against bootable JAR", "committedDate": "2020-09-22T11:36:20Z", "type": "forcePushed"}, {"oid": "13bdae64b5344424598c2f00b7f2411f1c28ea2b", "url": "https://github.com/resteasy/resteasy/commit/13bdae64b5344424598c2f00b7f2411f1c28ea2b", "message": "(3.13) Adding support for running test suite against bootable JAR", "committedDate": "2020-09-23T14:37:42Z", "type": "forcePushed"}, {"oid": "f176fff6b1960ca45ad7321cfe3b641f6ceb980c", "url": "https://github.com/resteasy/resteasy/commit/f176fff6b1960ca45ad7321cfe3b641f6ceb980c", "message": "(3.13) Adding support for running test suite against bootable JAR", "committedDate": "2020-09-23T15:32:28Z", "type": "forcePushed"}, {"oid": "3923eb2813b21565ddeee092146b83d96301925a", "url": "https://github.com/resteasy/resteasy/commit/3923eb2813b21565ddeee092146b83d96301925a", "message": "(3.13) Adding support for running test suite against bootable JAR", "committedDate": "2020-09-23T15:40:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxNjA1OQ==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r494216059", "bodyText": "As discussed on google chat, this offline element needs to be removed ...", "author": "marekkopecky", "createdAt": "2020-09-24T10:46:04Z", "path": "testsuite/integration-tests/pom.xml", "diffHunk": "@@ -203,6 +203,148 @@\n                 <microprofile.excluded.groups>org.jboss.resteasy.category.ExpectedFailingWithStandaloneMicroprofileConfiguration,org.jboss.resteasy.category.ExpectedFailingBecauseOfSmallRyeMicroprofileOpenApi11</microprofile.excluded.groups>\n             </properties>\n         </profile>\n+        \n+        <profile>\n+            <id>bootablejar.profile</id>\n+            <activation>\n+                <property>\n+                    <name>ts.bootable</name>\n+                </property>\n+            </activation>\n+            <build>\n+                <plugins>\n+                    <!-- Disable the standard copy-based provisioning -->\n+                    <plugin>\n+                        <groupId>org.apache.maven.plugins</groupId>\n+                        <artifactId>maven-antrun-plugin</artifactId>\n+                        <executions>\n+                            <execution>\n+                                <id>initialize-basedirs</id>\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>run</goal>\n+                                </goals>\n+                            </execution>\n+                        </executions>\n+                    </plugin>\n+                    <plugin>\n+                        <groupId>org.wildfly.plugins</groupId>\n+                        <artifactId>wildfly-jar-maven-plugin</artifactId>\n+                        <executions>\n+                            <!-- Package a jaxrs-server layer with a few other layers -->\n+                            <execution>\n+                                <id>bootable-jar-observability-packaging</id>\n+                                <goals>\n+                                    <goal>package</goal>\n+                                </goals>\n+                                <phase>process-test-resources</phase>\n+                                <configuration>\n+                                    <output-file-name>jaxrs-server.jar</output-file-name>\n+                                    <hollowJar>true</hollowJar>\n+                                    <record-state>false</record-state>\n+                                    <log-time>true</log-time>\n+                                    <offline>true</offline>", "originalCommit": "3923eb2813b21565ddeee092146b83d96301925a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxNjQ2NA==", "url": "https://github.com/resteasy/resteasy/pull/2526#discussion_r494216464", "bodyText": "+1 many thanks.", "author": "fabiobrz", "createdAt": "2020-09-24T10:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxNjA1OQ=="}], "type": "inlineReview"}, {"oid": "33f8555e29e19fe65b8a2ba0412f7c54125cb4de", "url": "https://github.com/resteasy/resteasy/commit/33f8555e29e19fe65b8a2ba0412f7c54125cb4de", "message": "(3.13) Adding support for running test suite against bootable JAR", "committedDate": "2020-09-24T10:51:07Z", "type": "forcePushed"}, {"oid": "4221e0b99343cd9fdc49dd34c23b8ac6f52fa6f3", "url": "https://github.com/resteasy/resteasy/commit/4221e0b99343cd9fdc49dd34c23b8ac6f52fa6f3", "message": "(3.13) Adding support for running test suite against bootable JAR", "committedDate": "2020-09-28T08:32:56Z", "type": "forcePushed"}, {"oid": "baca2e50304d524fc612c3e63257598a2059c545", "url": "https://github.com/resteasy/resteasy/commit/baca2e50304d524fc612c3e63257598a2059c545", "message": "(3.13) Adding support for running test suite against bootable JAR", "committedDate": "2020-09-30T09:55:21Z", "type": "commit"}, {"oid": "baca2e50304d524fc612c3e63257598a2059c545", "url": "https://github.com/resteasy/resteasy/commit/baca2e50304d524fc612c3e63257598a2059c545", "message": "(3.13) Adding support for running test suite against bootable JAR", "committedDate": "2020-09-30T09:55:21Z", "type": "forcePushed"}]}