{"pr_number": 2615, "pr_title": "Only show the database login fields when necessary", "pr_createdAt": "2020-05-11T04:36:28Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/2615", "timeline": [{"oid": "1242c7cab35548304e39cfa2b01b1836168a90ef", "url": "https://github.com/OpenRefine/OpenRefine/commit/1242c7cab35548304e39cfa2b01b1836168a90ef", "message": "DB login fields visibility controled by CSS\n\nThe database login field\u2019s visibility is now controled by CSS styling.", "committedDate": "2020-05-11T04:22:27Z", "type": "commit"}, {"oid": "ba491cad55db0e361013fe6c761ce5519ec4f751", "url": "https://github.com/OpenRefine/OpenRefine/commit/ba491cad55db0e361013fe6c761ce5519ec4f751", "message": "Change field name from Database to Database file.\n\nChange field name from Database to Database file.", "committedDate": "2020-05-11T04:54:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIwODY2OA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r423208668", "bodyText": "Is there a particular reason not to reuse the type directly as class (perhaps with a prefix, to be on the safe side)? That would simplify the code a bit. You would just have one line databaseClass = \"dbtype\" + type.", "author": "wetneb", "createdAt": "2020-05-11T17:40:45Z", "path": "extensions/database/module/scripts/index/database-source-ui.js", "diffHunk": "@@ -91,24 +91,44 @@ Refine.DatabaseSourceUI.prototype.attachUI = function(body) {\n   \n   \n   this._elmts.databaseTypeSelect.change(function(event) {\n-      var type = $( \"#databaseTypeSelect\" ).val(); \n-      if(type === \"postgresql\"){ \n-          $( \"#databaseUser\" ).val(\"postgres\");\n-          $( \"#databasePort\" ).val(\"5432\");\t  \n-      }else if(type === \"mysql\"){\t  \n-          $( \"#databaseUser\" ).val(\"root\");\n-          $( \"#databasePort\" ).val(\"3306\");\t  \n-      }else if(type === \"mariadb\"){\n-          $( \"#databaseUser\" ).val(\"root\");\n-          $( \"#databasePort\" ).val(\"3306\");\n-      }else if(type === \"sqlite\"){\n-          $( \"#databaseUser\" ).val(\"na\");\n-          $( \"#databasePort\" ).val(\"0\");\n-          $( \"#databaseHost\" ).val(\"na\");\n-      }else{\n-          $( \"#databaseUser\" ).val(\"root\");\n-          $( \"#databasePort\" ).val(\"3306\");\n-      }\n+    var type = $( \"#databaseTypeSelect\" ).val();\n+    var databaseClass = \"\";\n+  \n+    if(type === \"postgresql\") { \n+        $( \"#databaseUser\" ).val(\"postgres\");\n+        $( \"#databasePort\" ).val(\"5432\");\n+        databaseClass = \"psgsq\"\n+      \n+    } else if(type === \"mysql\") {\t  \n+        $( \"#databaseUser\" ).val(\"root\");\n+        $( \"#databasePort\" ).val(\"3306\");\t  \n+        databaseClass = \"mysql\"\n+      \n+    } else if(type === \"mariadb\") {\n+        $( \"#databaseUser\" ).val(\"root\");\n+        $( \"#databasePort\" ).val(\"3306\");\n+        databaseClass = \"mardb\"\n+      \n+    } else if(type === \"sqlite\") {\n+        $( \"#databaseUser\" ).val(\"na\");\n+        $( \"#databasePort\" ).val(\"0\");\n+        $( \"#databaseHost\" ).val(\"na\");\n+        databaseClass = \"sqlit\"", "originalCommit": "ba491cad55db0e361013fe6c761ce5519ec4f751", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIxMzg1NQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r423213855", "bodyText": "Is there a particular reason not to reuse the type directly as class (perhaps with a prefix, to be on the safe side)? That would simplify the code a bit. You would just have one line databaseClass = \"dbtype\" + type.\n\nYes. The full name would be fine, just 2x longer. I also though of just have TWO classes network_db and file_db. It would even more simply the code, but wouldn't permit to have specific fields per database, just between database types.\nSo @wetneb, I go for the full name?\nRegards,\nAntoine", "author": "antoine2711", "createdAt": "2020-05-11T17:49:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIwODY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDgwOQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r423294809", "bodyText": "Is there a particular reason not to reuse the type directly as class (perhaps with a prefix, to be on the safe side)? That would simplify the code a bit. You would just have one line databaseClass = \"dbtype\" + type.\n\n@wetneb: It's done. You can review it again.\nRegards, A.", "author": "antoine2711", "createdAt": "2020-05-11T20:19:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIwODY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczMDA2Ng==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r424730066", "bodyText": "Is there a particular reason not to reuse the type directly as class (perhaps with a prefix, to be on the safe side)? That would simplify the code a bit. You would just have one line databaseClass = \"dbtype\" + type.\n\nHi @wetneb I wrote too fast when I said I did what you asked. I forgot half of what you asked! ;-) So here's the other half. For the class name options, I changed it to: dbtype-options. For the name of the db, I took the full name like you asked, but only prefixed it with dbt-. Some names are long, and imagine a user with 10 databases type (core-OR + extensions), it would make a long class attribute value\u2026 Anyway, it drastically reduce the risk of collisions.\nRegards, A.", "author": "antoine2711", "createdAt": "2020-05-13T21:04:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIwODY2OA=="}], "type": "inlineReview"}, {"oid": "35ec479b0b8e15f1be570a2e82273a584f90482f", "url": "https://github.com/OpenRefine/OpenRefine/commit/35ec479b0b8e15f1be570a2e82273a584f90482f", "message": "Use full db name as CSS classes\n\nUse full db name instead of diminutives for the CSS classes.", "committedDate": "2020-05-11T20:18:36Z", "type": "commit"}, {"oid": "a5d66df231c76a75441d25c24cccbd14676c6725", "url": "https://github.com/OpenRefine/OpenRefine/commit/a5d66df231c76a75441d25c24cccbd14676c6725", "message": "Added translation to placeholders\n\nAdded translation to the Input placeholders.", "committedDate": "2020-05-13T03:43:45Z", "type": "commit"}, {"oid": "2333e410cd31505567d345b507b274e7d91e6b00", "url": "https://github.com/OpenRefine/OpenRefine/commit/2333e410cd31505567d345b507b274e7d91e6b00", "message": "Undo a change, remerge Database field & File\n\nremerge Database field and DatabaseFile Field like before.", "committedDate": "2020-05-13T04:36:41Z", "type": "commit"}, {"oid": "a07769843ca2b5b0d36d566b16157f6e320253a9", "url": "https://github.com/OpenRefine/OpenRefine/commit/a07769843ca2b5b0d36d566b16157f6e320253a9", "message": "Created DatabaseSourceUI._updateDatabaseType(dbType)\n\nCreated Refine.DatabaseSourceUI.prototype._updateDatabaseType(databaseType)", "committedDate": "2020-05-13T06:08:50Z", "type": "commit"}, {"oid": "ecb85a2858daae91ebd46eaac2ada156c5e03b8d", "url": "https://github.com/OpenRefine/OpenRefine/commit/ecb85a2858daae91ebd46eaac2ada156c5e03b8d", "message": "Make MySQL the default database\n\n<option value=\"mysql\" selected=\"selected\"\">MySQL</option>", "committedDate": "2020-05-13T06:10:22Z", "type": "commit"}, {"oid": "8447a16e70ad69e27bfb7438b0980c354e967f8c", "url": "https://github.com/OpenRefine/OpenRefine/commit/8447a16e70ad69e27bfb7438b0980c354e967f8c", "message": "Update database-import-form.html\n\nFixed typo. (<option value=\"mysql\" selected=\"selected\">MySQL</option>)", "committedDate": "2020-05-13T06:11:45Z", "type": "commit"}, {"oid": "2eaa1e48a238c91b46c809a5681d86a09d781406", "url": "https://github.com/OpenRefine/OpenRefine/commit/2eaa1e48a238c91b46c809a5681d86a09d781406", "message": "New default connection name value\n\nNew default connection name value, translation of it, changing cssClassName from options to dbtype-options, adding the prefix \"dbt-\" to the db types and fix the changing of placeholder databaseName/databaseFileName when neccessary.", "committedDate": "2020-05-13T21:13:07Z", "type": "commit"}, {"oid": "83433a6ce92d273f1cda18605bc923ba7ef78028", "url": "https://github.com/OpenRefine/OpenRefine/commit/83433a6ce92d273f1cda18605bc923ba7ef78028", "message": "Fix issue with \u00ab saved connections \u00bb\n\nFix issue with \u00ab saved connections \u00bb and added 2 defaults values for dbHost and dbType.", "committedDate": "2020-05-14T00:15:20Z", "type": "commit"}, {"oid": "868b6bfb541bec54428b64d8ba5194231a9cba80", "url": "https://github.com/OpenRefine/OpenRefine/commit/868b6bfb541bec54428b64d8ba5194231a9cba80", "message": "Default DB back to MySQL.\n\n<option value=\"mysql\" selected=\"selected\">MySQL</option>", "committedDate": "2020-05-14T00:44:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0MDQ5MQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r427440491", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                \"database-source/databaseSchemaPlaceholder\": \"Enter Initial Schema\",\n          \n          \n            \n                \"database-source/databaseSchemaPlaceholder\": \"Enter initial schema\",", "author": "thadguidry", "createdAt": "2020-05-19T16:34:04Z", "path": "extensions/database/module/langs/translation-en.json", "diffHunk": "@@ -21,7 +21,17 @@\n     \"database-source/databaseUserLabel\": \"User:\",\n     \"database-source/databasePasswordLabel\": \"Password:\",\n     \"database-source/databaseNameLabel\": \"Database:\",\n+    \"database-source/databaseFileNameLabel\": \"Database file:\",\n     \"database-source/databaseSchemaLabel\": \"Schema:\",\n+    \"database-source/connectionNamePlaceholder\": \"Enter a new Connection Name\",\n+    \"database-source/databaseHostPlaceholder\": \"Enter Database Host Address\",\n+    \"database-source/databasePortPlaceholder\": \"Enter Database Port e.g. 3306\",\n+    \"database-source/databaseUserPlaceholder\": \"Enter Database User\",\n+    \"database-source/databasePasswordPlaceholder\": \"Enter Database Password\",\n+    \"database-source/databaseNamePlaceholder\": \"Enter Database\",\n+    \"database-source/databaseFileNamePlaceholder\": \"Enter the full path to the Database file\",\n+    \"database-source/databaseSchemaPlaceholder\": \"Enter Initial Schema\",", "originalCommit": "868b6bfb541bec54428b64d8ba5194231a9cba80", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0MTcyMQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r427441721", "bodyText": "I guess I'm OK with a default selection here.", "author": "thadguidry", "createdAt": "2020-05-19T16:35:57Z", "path": "extensions/database/module/scripts/index/database-import-form.html", "diffHunk": "@@ -29,44 +29,43 @@\n                                   \n                                       <div class=\"pure-control-group\">\n                                            <label id=\"connectionNameLabel\" for=\"name\">Name:</label>\n-                                           <input bind=\"connectionNameInput\" id=\"connectionName\" type=\"text\" placeholder=\"Enter Connection Name\" value=\"127.0.0.1\" class=\"pure-input-1-3\" required>\n+                                           <input bind=\"connectionNameInput\" id=\"connectionName\" type=\"text\" placeholder=\"\" value=\"\" class=\"pure-input-1-3\" required>\n                                        </div>\n                                \n                                        <div class=\"pure-control-group\">\n                                            <label id=\"databaseTypeLabel\" for=\"databaseType\">Database Type:</label>\n                                             <select name=\"selection\" id=\"databaseTypeSelect\" bind=\"databaseTypeSelect\" class=\"pure-input-1-3\" required>\n                                             \t  <option value=\"postgresql\">PostgreSQL</option>  \n-                                               <option value=\"mysql\">MySQL</option>\n+                                               <option value=\"mysql\" selected=\"selected\">MySQL</option>", "originalCommit": "868b6bfb541bec54428b64d8ba5194231a9cba80", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0NDI4Nw==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r427444287", "bodyText": "In which scenario would the defaultDatabaseType be empty?  On a brand new installation of OpenRefine?", "author": "thadguidry", "createdAt": "2020-05-19T16:40:07Z", "path": "extensions/database/module/scripts/index/database-source-ui.js", "diffHunk": "@@ -64,6 +64,10 @@ Refine.DatabaseSourceUI.prototype.attachUI = function(body) {\n   this._elmts = DOM.bind(this._body);\n   var self = this;\n   \n+  self._defaultDatabaseHost = \"localhost\";\n+  self._defaultDatabaseType = $( \"select#databaseTypeSelect\" ).val();\n+  if (self._defaultDatabaseType == \"\") { self._defaultDatabaseType = \"mariadb\"; }", "originalCommit": "868b6bfb541bec54428b64d8ba5194231a9cba80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ2MjA5MA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r427462090", "bodyText": "@thadguidry: The only scenario where it would be empty is if a coder changes the HTML code.\nGranted, it\u2019s a rare scenario, but, since it can happen, I check it. What I would really want to do here, is add a preference, for both the IP (host) and DB-type. But that feature is not yet merged in master.\nRegards,\nAntoine", "author": "antoine2711", "createdAt": "2020-05-19T17:08:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0NDI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ3MzkzOA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r427473938", "bodyText": "OK, understood.", "author": "thadguidry", "createdAt": "2020-05-19T17:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0NDI4Nw=="}], "type": "inlineReview"}, {"oid": "597dedaa0b75baefd450ad60d0c47afbeedfb4d7", "url": "https://github.com/OpenRefine/OpenRefine/commit/597dedaa0b75baefd450ad60d0c47afbeedfb4d7", "message": "Update extensions/database/module/langs/translation-en.json\n\nCo-authored-by: Thad Guidry <thadguidry@gmail.com>", "committedDate": "2020-05-19T18:14:41Z", "type": "commit"}, {"oid": "3ce9aef0ca15fbff409ae0ff50bbeb51186bf597", "url": "https://github.com/OpenRefine/OpenRefine/commit/3ce9aef0ca15fbff409ae0ff50bbeb51186bf597", "message": "Better default with \u00ab\u00a0mysql\u00a0\u00bb", "committedDate": "2020-05-22T08:07:31Z", "type": "commit"}, {"oid": "f1f2b8a0bb9d60e783de63aa5c02ee643bd81356", "url": "https://github.com/OpenRefine/OpenRefine/commit/f1f2b8a0bb9d60e783de63aa5c02ee643bd81356", "message": "Fix sqlite #databaseHost before calling self._updateDatabaseType()\n\nFix $( \"#databaseHost\" ).val(self._defaultDatabaseHost) to be set before calling self._updateDatabaseType(self._defaultDatabaseType) that may change it.", "committedDate": "2020-05-22T08:35:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzODk1MQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r429138951", "bodyText": "How about we remove this text from the HTML file, since it is overwritten by i18n in Javascript anyway?", "author": "wetneb", "createdAt": "2020-05-22T09:22:29Z", "path": "extensions/database/module/scripts/index/database-import-form.html", "diffHunk": "@@ -29,44 +29,43 @@\n                                   \n                                       <div class=\"pure-control-group\">\n                                            <label id=\"connectionNameLabel\" for=\"name\">Name:</label>\n-                                           <input bind=\"connectionNameInput\" id=\"connectionName\" type=\"text\" placeholder=\"Enter Connection Name\" value=\"127.0.0.1\" class=\"pure-input-1-3\" required>\n+                                           <input bind=\"connectionNameInput\" id=\"connectionName\" type=\"text\" placeholder=\"\" value=\"\" class=\"pure-input-1-3\" required>\n                                        </div>\n                                \n                                        <div class=\"pure-control-group\">\n                                            <label id=\"databaseTypeLabel\" for=\"databaseType\">Database Type:</label>\n                                             <select name=\"selection\" id=\"databaseTypeSelect\" bind=\"databaseTypeSelect\" class=\"pure-input-1-3\" required>\n                                             \t  <option value=\"postgresql\">PostgreSQL</option>  \n-                                               <option value=\"mysql\">MySQL</option>\n+                                               <option value=\"mysql\" selected=\"selected\">MySQL</option>\n                                                <option value=\"mariadb\">MariaDB</option>\n                                                 <option value=\"sqlite\">SQLite</option>\n                                             </select>\n                                        </div>\n-                               \n-                                       <div class=\"pure-control-group\">\n-                                           <label id=\"databaseHostLabel\" for=\"databaseHost\">Database Host:</label>\n-                                           <input bind=\"databaseHostInput\" id=\"databaseHost\" type=\"text\" placeholder=\"Enter Database Host Address\" value=\"localhost\" class=\"pure-input-1-3\" required>\n-                                       </div>\n-                               \n-                                       <div class=\"pure-control-group\">\n-                                           <label id=\"databasePortLabel\" for=\"databasePort\">Database Port:</label>\n-                                           <input bind=\"databasePortInput\" id=\"databasePort\" type=\"text\" placeholder=\"Enter Database Port e.g. 3306\" value=\"5432\" class=\"pure-input-1-3\" required>\n-                                       </div>\n-                                        <div class=\"pure-control-group\">\n-                                           <label id=\"databaseUserLabel\" for=\"databaseUser\">Database User:</label>\n-                                           <input bind=\"databaseUserInput\" id=\"databaseUser\" type=\"text\" placeholder=\"Enter Database User\" value=\"postgres\" class=\"pure-input-1-3\" required>\n-                                       </div>\n-                                        <div class=\"pure-control-group\">\n-                                           <label id=\"databasePasswordLabel\" for=\"databasePassword\">Database Password:</label>\n-                                           <input bind=\"databasePasswordInput\" id=\"databasePassword\" type=\"password\" placeholder=\"Enter Database Password\" class=\"pure-input-1-3\" required>\n-                                       </div>\n-                                        <div class=\"pure-control-group\">\n-                                           <label id=\"databaseNameLabel\" for=\"initialDatabase\">Database Name:</label>\n-                                           <input bind=\"initialDatabaseInput\" id=\"initialDatabase\" type=\"text\" placeholder=\"Enter Database\" class=\"pure-input-1-3\" required>\n-                                       </div>\n-                                       <div class=\"pure-control-group\" style=\"display:none;\">\n-                                           <label id=\"databaseSchemaLabel\" for=\"initialSchema\">Schema Name:</label>\n-                                           <input bind=\"initialSchemaInput\" id=\"initialSchema\" type=\"text\" placeholder=\"Enter Initial Schema\" class=\"pure-input-1-3\" required>\n-                                       </div>\n+\n+                                        <div class=\"pure-control-group dbtype-options dbt-postgresql dbt-mysql dbt-mariadb\">\n+                                          <label id=\"databaseHostLabel\" for=\"databaseHost\">Database Host:</label> \n+                                          <input bind=\"databaseHostInput\" id=\"databaseHost\" type=\"text\" placeholder=\"\" value=\"localhost\" class=\"pure-input-1-3\" required>\n+                                        </div>\n+                                        <div class=\"pure-control-group dbtype-options dbt-postgresql dbt-mysql dbt-mariadb\">\n+                                          <label id=\"databasePortLabel\" for=\"databasePort\">Database Port:</label> \n+                                          <input bind=\"databasePortInput\" id=\"databasePort\" type=\"text\" placeholder=\"\" value=\"5432\" class=\"pure-input-1-3\" required>\n+                                        </div>\n+                                        <div class=\"pure-control-group dbtype-options dbt-postgresql dbt-mysql dbt-mariadb\">\n+                                          <label id=\"databaseUserLabel\" for=\"databaseUser\">Database User:</label> \n+                                          <input bind=\"databaseUserInput\" id=\"databaseUser\" type=\"text\" placeholder=\"\" value=\"postgres\" class=\"pure-input-1-3\" required>\n+                                        </div>\n+                                        <div class=\"pure-control-group dbtype-options dbt-postgresql dbt-mysql dbt-mariadb\">\n+                                          <label id=\"databasePasswordLabel\" for=\"databasePassword\">Database Password:</label> ", "originalCommit": "f1f2b8a0bb9d60e783de63aa5c02ee643bd81356", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxNTY0MA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2615#discussion_r429515640", "bodyText": "Done.", "author": "antoine2711", "createdAt": "2020-05-23T05:17:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzODk1MQ=="}], "type": "inlineReview"}, {"oid": "9e7b2515d4063e9398de3ae45585d15545ede97c", "url": "https://github.com/OpenRefine/OpenRefine/commit/9e7b2515d4063e9398de3ae45585d15545ede97c", "message": "Removed field name & fixed default connection name\n\nRemoved field name text since it's populated from i18n and fixed the default connection name so that it has no space in it.", "committedDate": "2020-05-23T05:22:04Z", "type": "commit"}, {"oid": "a45225b45df02af9994eb7bdad56673131e9be51", "url": "https://github.com/OpenRefine/OpenRefine/commit/a45225b45df02af9994eb7bdad56673131e9be51", "message": "Little update to placeholder text", "committedDate": "2020-05-24T03:03:11Z", "type": "commit"}]}