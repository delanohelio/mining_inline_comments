{"pr_number": 3212, "pr_title": "Validate Host header of incoming HTTP requests", "pr_createdAt": "2020-09-24T12:05:20Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/3212", "timeline": [{"oid": "400b95b69db0c6d565f95bd79bc636c45e49abd4", "url": "https://github.com/OpenRefine/OpenRefine/commit/400b95b69db0c6d565f95bd79bc636c45e49abd4", "message": "Validate Host header of incoming HTTP requests", "committedDate": "2020-10-26T15:21:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTUzMjkyMg==", "url": "https://github.com/OpenRefine/OpenRefine/pull/3212#discussion_r515532922", "bodyText": "I wonder if it would make sense to write one or two simple tests to show which hosts are allowed.\nYou would probably need to move this class to its own file or making it a nested class of Refine.\n(I have to admit I wasn't aware of the fact that we had multiple top-level classes in Refine.java, it looks a bit confusing to me, and does not seem to be a widely recommended practice.)", "author": "wetneb", "createdAt": "2020-10-31T19:54:16Z", "path": "server/src/com/google/refine/Refine.java", "diffHunk": "@@ -435,32 +447,92 @@ static private String fixWindowsUnicodePath(String path) {\n             return path;\n         }\n         int pathSep = path.indexOf(File.separatorChar, q);\n-        \n+\n         String goodPath = System.getenv(\"APPDATA\");\n         if (goodPath == null || goodPath.length() == 0) {\n             goodPath = System.getenv(\"USERPROFILE\");\n             if (!goodPath.endsWith(File.separator)) {\n                 goodPath = goodPath + File.separator;\n             }\n         }\n-        \n+\n         int goodPathSep = goodPath.indexOf(File.separatorChar, q);\n-        \n+\n         return path.substring(0, q) + goodPath.substring(q, goodPathSep) + path.substring(pathSep);\n     }\n-    \n+\n+}\n+\n+/**\n+ * Validate the Host header of the HTTP request to see if it matches either a loopback IP\n+ * address, localhost or an explicitly specified hostname. This is required to avoid DNS\n+ * rebinding attacks against users running OpenRefine on their desktop computers.\n+ */\n+class ValidateHostHandler extends HandlerWrapper {", "originalCommit": "046862e92e8981f87fd473bdbd47fddc4aa84466", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c39798bb6a1eb9d5d41d3eebac258c959f47a4fa", "url": "https://github.com/OpenRefine/OpenRefine/commit/c39798bb6a1eb9d5d41d3eebac258c959f47a4fa", "message": "Validate Host header of incoming HTTP requests", "committedDate": "2020-12-02T09:23:05Z", "type": "commit"}, {"oid": "6895caf4ab5a452dd7b2a786750c6ab6f0589cff", "url": "https://github.com/OpenRefine/OpenRefine/commit/6895caf4ab5a452dd7b2a786750c6ab6f0589cff", "message": "Always allow requests with loopback IP addresses and localhost", "committedDate": "2020-12-02T09:23:05Z", "type": "commit"}, {"oid": "1c66774851bc7e384e79f729e4e710cf272ab691", "url": "https://github.com/OpenRefine/OpenRefine/commit/1c66774851bc7e384e79f729e4e710cf272ab691", "message": "Split off ValidateHostHandler to a separate file", "committedDate": "2020-12-02T10:09:56Z", "type": "commit"}, {"oid": "1c66774851bc7e384e79f729e4e710cf272ab691", "url": "https://github.com/OpenRefine/OpenRefine/commit/1c66774851bc7e384e79f729e4e710cf272ab691", "message": "Split off ValidateHostHandler to a separate file", "committedDate": "2020-12-02T10:09:56Z", "type": "forcePushed"}, {"oid": "e546766a0cf1ab647f1fdd917d2f94a97d424a74", "url": "https://github.com/OpenRefine/OpenRefine/commit/e546766a0cf1ab647f1fdd917d2f94a97d424a74", "message": "Allow IPv4-mapped loopback addresses in ValidateHostHandler", "committedDate": "2020-12-04T09:40:17Z", "type": "commit"}, {"oid": "e0d432c3d413b8323df8fa202ec07b1d2de8cca1", "url": "https://github.com/OpenRefine/OpenRefine/commit/e0d432c3d413b8323df8fa202ec07b1d2de8cca1", "message": "Add error description to 404 error returned by ValidateHostHandler", "committedDate": "2020-12-04T09:51:39Z", "type": "commit"}, {"oid": "4dbdca4ac3693a95bbc32f4cb97c1c008701171e", "url": "https://github.com/OpenRefine/OpenRefine/commit/4dbdca4ac3693a95bbc32f4cb97c1c008701171e", "message": "Add refine.interface parameter to override interface and host separately", "committedDate": "2021-02-19T16:35:34Z", "type": "commit"}, {"oid": "d9937e2915b5337634c360a8b47ef580174dd322", "url": "https://github.com/OpenRefine/OpenRefine/commit/d9937e2915b5337634c360a8b47ef580174dd322", "message": "Fix some whitespace inconsistencies", "committedDate": "2021-02-19T16:49:40Z", "type": "commit"}, {"oid": "1fa6fc5e3d63054a9b8be6c50bcf5d2fd0222c30", "url": "https://github.com/OpenRefine/OpenRefine/commit/1fa6fc5e3d63054a9b8be6c50bcf5d2fd0222c30", "message": "Merge branch 'master' into master", "committedDate": "2021-02-20T08:25:56Z", "type": "commit"}, {"oid": "187c007363052e0a5ffe17c0d005f83ecd5e9e18", "url": "https://github.com/OpenRefine/OpenRefine/commit/187c007363052e0a5ffe17c0d005f83ecd5e9e18", "message": "Merge branch 'master' into master", "committedDate": "2021-02-20T10:40:16Z", "type": "commit"}, {"oid": "3af6a59570ec5075e1f609d6a6f68f1f7ad71982", "url": "https://github.com/OpenRefine/OpenRefine/commit/3af6a59570ec5075e1f609d6a6f68f1f7ad71982", "message": "Update refine and refine.bat with separate host and interface arguments", "committedDate": "2021-02-22T16:43:21Z", "type": "commit"}, {"oid": "1c900740ff0a8962592c02386b7d0a246d84cadb", "url": "https://github.com/OpenRefine/OpenRefine/commit/1c900740ff0a8962592c02386b7d0a246d84cadb", "message": "Add -h switch to usage message", "committedDate": "2021-02-22T16:55:43Z", "type": "commit"}, {"oid": "dec6b0f86b530f5f5aeab1858bbca2e7844ba8eb", "url": "https://github.com/OpenRefine/OpenRefine/commit/dec6b0f86b530f5f5aeab1858bbca2e7844ba8eb", "message": "Use -H instead of -h for the host argument", "committedDate": "2021-02-24T23:37:29Z", "type": "commit"}, {"oid": "69f277d4b9ba31bd3a3874a1c522d25c9f51664a", "url": "https://github.com/OpenRefine/OpenRefine/commit/69f277d4b9ba31bd3a3874a1c522d25c9f51664a", "message": "Merge branch 'master' into master", "committedDate": "2021-03-02T09:49:11Z", "type": "commit"}, {"oid": "988ea5b80311ac844d8501215f1daecb64a181a4", "url": "https://github.com/OpenRefine/OpenRefine/commit/988ea5b80311ac844d8501215f1daecb64a181a4", "message": "Merge branch 'master' of github.com:OpenRefine/OpenRefine", "committedDate": "2021-03-22T10:01:37Z", "type": "commit"}, {"oid": "fc759597392cf9167af65f323cb9540d7fd46c99", "url": "https://github.com/OpenRefine/OpenRefine/commit/fc759597392cf9167af65f323cb9540d7fd46c99", "message": "Bring changes in line with new Jetty version", "committedDate": "2021-03-22T10:12:59Z", "type": "commit"}, {"oid": "8553f8f9bb4f1d89afe74f811f3f1e9f7ce125c5", "url": "https://github.com/OpenRefine/OpenRefine/commit/8553f8f9bb4f1d89afe74f811f3f1e9f7ce125c5", "message": "Merge branch 'master' of github.com:dzsibi/OpenRefine", "committedDate": "2021-03-22T10:14:03Z", "type": "commit"}]}