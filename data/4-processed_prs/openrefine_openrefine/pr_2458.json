{"pr_number": 2458, "pr_title": "Added google sheet feature and moved features to the export drop-down", "pr_createdAt": "2020-03-22T17:20:53Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/2458", "timeline": [{"oid": "9af429b6e0c21f75c28b64df463b1588a54bfc70", "url": "https://github.com/OpenRefine/OpenRefine/commit/9af429b6e0c21f75c28b64df463b1588a54bfc70", "message": "fixed minor typos", "committedDate": "2020-03-12T11:45:08Z", "type": "commit"}, {"oid": "69ff6cdd8e5b014f6c97ea4e460e489335f3dec0", "url": "https://github.com/OpenRefine/OpenRefine/commit/69ff6cdd8e5b014f6c97ea4e460e489335f3dec0", "message": "Added google sheet feature and moved features to the export drop-down menu", "committedDate": "2020-03-22T14:12:11Z", "type": "commit"}, {"oid": "6fcb552e04dc362a2fa80e948ab38244d3413412", "url": "https://github.com/OpenRefine/OpenRefine/commit/6fcb552e04dc362a2fa80e948ab38244d3413412", "message": "Merge branch 'master' of https://github.com/OpenRefine/OpenRefine", "committedDate": "2020-03-22T14:58:39Z", "type": "commit"}, {"oid": "c3b0ff3f0012e4be1caf743c7cd333ed7d0cd9b5", "url": "https://github.com/OpenRefine/OpenRefine/commit/c3b0ff3f0012e4be1caf743c7cd333ed7d0cd9b5", "message": "added google sheet feature and moved export features to export menu", "committedDate": "2020-03-22T15:31:49Z", "type": "commit"}, {"oid": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f", "url": "https://github.com/OpenRefine/OpenRefine/commit/136d4b68292bb57c8f6fca8df42d72075cc7bb3f", "message": "minor change", "committedDate": "2020-03-22T17:06:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMDk2MA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396120960", "bodyText": "Is it really worth adding \"file\" at the end of all these labels? For instance, \"ODF spreadsheet file\" sounds quite redundant for me. I would keep these labels as they were.", "author": "wetneb", "createdAt": "2020-03-22T17:42:53Z", "path": "main/webapp/modules/core/langs/translation-en.json", "diffHunk": "@@ -343,12 +344,12 @@\n     \"core-project/remove-all\": \"Remove all facets\",\n     \"core-project/export-project\": \"Export project\",\n     \"core-project/project-data-package\": \"Project data package\",\n-    \"core-project/tab-value\": \"Tab-separated value\",\n-    \"core-project/comma-sep\": \"Comma-separated value\",\n-    \"core-project/html-table\": \"HTML table\",\n-    \"core-project/excel\": \"Excel (.xls)\",\n-    \"core-project/excel-xml\": \"Excel 2007+ (.xlsx)\",\n-    \"core-project/odf\": \"ODF spreadsheet\",\n+    \"core-project/tab-value\": \"Tab-separated value file\",\n+    \"core-project/comma-sep\": \"Comma-separated value file\",\n+    \"core-project/html-table\": \"HTML table file\",\n+    \"core-project/excel\": \"Excel (.xls) file\",\n+    \"core-project/excel-xml\": \"Excel 2007+ (.xlsx) file\",\n+    \"core-project/odf\": \"ODF spreadsheet file\",", "originalCommit": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyOTkxNA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396129914", "bodyText": "Is it really worth adding \"file\" at the end of all these labels? For instance, \"ODF spreadsheet file\" sounds quite redundant for me. I would keep these labels as they were.\n\nAlso, spreadsheet file is not redundant: the spreadsheet can be saved to the cloud or elsewhere. But in my proposition, the menu item is precise, it tells you when you will generate files.", "author": "antoine2711", "createdAt": "2020-03-22T19:12:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMDk2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMTEwMw==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396121103", "bodyText": "Menu items related to Google services should be added in the gdata extension. It is possible to add menu items to common menus in extensions (see for instance how it is done in the Wikidata extension).", "author": "wetneb", "createdAt": "2020-03-22T17:44:19Z", "path": "main/webapp/modules/core/scripts/project/exporters.js", "diffHunk": "@@ -150,90 +160,95 @@ ExporterManager.prepareExportRowsForm = function(format, includeEngine, ext) {\n     .attr(\"value\", JSON.stringify(ui.browsingEngine.getJSON()))\n     .appendTo(form);\n   }\n-  \n+\n   return form;\n };\n \n-ExporterManager.handlers.exportProject = function() {\n+ExporterManager.handlers.exportProjectToLocal = function() {\n   var name = ExporterManager.stripNonFileChars(theProject.metadata.name);\n-  // dialog\n-  var dialog = $(DOM.loadHTML(\"core\", \"scripts/dialogs/export-project-dialog.html\"));\n-  var _elmts = DOM.bind(dialog);\n-  \n-  _elmts.dialogHeader.html($.i18n('core-dialogs/choose-export-destination'));\n-  _elmts.toLocalRadio.html($.i18n('core-dialogs/export-to-local'));\n-  _elmts.toGoogleDriveRadio.html($.i18n('core-dialogs/export-to-google-drive'));\n-  _elmts.exportButton.html($.i18n('core-buttons/export'));\n-  _elmts.cancelButton.html($.i18n('core-buttons/cancel'));\n-  \n-  _elmts.exportButton.click(function() { \n-      if ($(\"input[name='export-destination']\")[0].checked) {\n-          exportToLocal(name);\n-      } else {\n-          exportToGoogleDrive(name);\n-      }\n-      \n-      DialogSystem.dismissAll(); \n-  });\n-  \n-  _elmts.cancelButton.click(function() { DialogSystem.dismissAll(); });\n-  \n-  DialogSystem.showDialog(dialog);\n-  \n-  // save to google drive\n-  var doExportToGoogleDrive = function() {\n-      var name = window.prompt($.i18n('gdata-exporter/enter-filename'), theProject.metadata.name);\n-      if (name) {\n-        var dismiss = DialogSystem.showBusy($.i18n('gdata-exporter/uploading'));\n-        Refine.postCSRF(\n-          \"command/gdata/upload\",\n-          {\n-            \"project\" : theProject.id,\n-            \"name\" : name,\n-            \"format\" : \"raw/openrefine-project\"\n-          },\n-          function(o) {\n-            dismiss();\n-\n-            if (o.url) {\n-                alert($.i18n('gdata-exporter/upload-success'));\n-            } else {\n-                alert($.i18n('gdata-exporter/upload-error') + o.message)\n-            }\n-            onDone();\n-          },\n-          \"json\"\n-        );\n-      }\n-    };\n-\n-  function exportToGoogleDrive(name) {\n-    if (GdataExtension.isAuthorized()) {\n-        doExportToGoogleDrive();\n-    } else {\n-        GdataExtension.showAuthorizationDialog(doExportToGoogleDrive);\n+  var form = document.createElement(\"form\");\n+  $(form)\n+  .css(\"display\", \"none\")\n+  .attr(\"method\", \"post\")\n+  .attr(\"action\", \"command/core/export-project/\" + name + \".openrefine.tar.gz\")\n+  .attr(\"target\", \"refine-export\");\n+  $('<input />')\n+  .attr(\"name\", \"project\")\n+  .attr(\"value\", theProject.id)\n+  .appendTo(form);\n+\n+  document.body.appendChild(form);\n+\n+  window.open(\" \", \"refine-export\");\n+  form.submit();\n+\n+  document.body.removeChild(form);\n+};\n+\n+ExporterManager.handlers.exportProjectToGoogleDrive = function () {", "originalCommit": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMTIyNQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396121225", "bodyText": "The Google Sheets option should be in the second section and should not be named \"OpenRefine project archive to Google Sheets\", since it does not export the project archive, it just exports the current state of the table like the other exporters. I think we could just use \"Google Sheets\" as label for that item.\nAlso these translations should be in the gdata extension (since the menu items should be added in the gdata extension, see below).", "author": "wetneb", "createdAt": "2020-03-22T17:45:33Z", "path": "main/webapp/modules/core/langs/translation-en.json", "diffHunk": "@@ -284,8 +284,9 @@\n     \"core-dialogs/for-include-if-exist-drop-stmt-checkbox\": \"Include 'IF EXISTS' in DROP statement\",\n     \"core-dialogs/for-null-cell-value-to-empty-str-label\": \"Convert null value to NULL in INSERT\",\n     \"core-dialogs/choose-export-destination\": \"Please choose the destination for project export\",\n-    \"core-dialogs/export-to-local\": \"Export to local\",\n-    \"core-dialogs/export-to-google-drive\": \"Export to Google Drive\",\n+    \"core-dialogs/export-to-local\": \"OpenRefine project archive to file\",\n+    \"core-dialogs/export-to-google-drive\": \"OpenRefine project archive to Google Drive...\",\n+    \"core-dialogs/export-to-google-sheets\": \"OpenRefine project archive to Google Sheets...\",", "originalCommit": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMTU0NQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396121545", "bodyText": "This label is also used in the Wikidata extension menu, and in that context we do need to keep \"Export\" in the label because the menu contains all sorts of actions, not just export ones. So I would keep this existing string and add a new one without \"export\" (and without adding \"to file\" either, see below).", "author": "wetneb", "createdAt": "2020-03-22T17:48:42Z", "path": "extensions/wikidata/module/langs/translation-en.json", "diffHunk": "@@ -3,10 +3,10 @@\n     \"wikidata-extension/edit-wikidata-schema\": \"Edit Wikidata schema\",\n     \"wikidata-extension/import-wikidata-schema\": \"Import schema\",\n     \"wikidata-extension/manage-wikidata-account\": \"Manage Wikidata account\",\n-    \"wikidata-extension/perform-edits-on-wikidata\": \"Upload edits to Wikidata\",\n-    \"wikidata-extension/export-to-qs\": \"Export to QuickStatements\",\n+    \"wikidata-extension/perform-edits-on-wikidata\": \"Wikidata edits...\",\n+    \"wikidata-extension/export-to-qs\": \"QuickStatements file...\",\n     \"wikidata-extension/export-schema\": \"Export schema\",\n-    \"wikidata-extension/export-wikidata-schema\": \"Export Wikidata schema\",\n+    \"wikidata-extension/export-wikidata-schema\": \"Wikidata schema to file\",", "originalCommit": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzMDkwNA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396130904", "bodyText": "This label is also used in the Wikidata extension menu, and in that context we do need to keep \"Export\" in the label because the menu contains all sorts of actions, not just export ones. So I would keep this existing string and add a new one without \"export\" (and without adding \"to file\" either, see below).\n\nThe menu where \u00ab Wikidata schema to file \u00bb is located, is called \u00ab Export\u00a0\u00bb. So, it's not necessary to repeat it, as you do not do with all the export above that also export (though not the same thing, that why I did put in my proposition this item in a section by itself.", "author": "antoine2711", "createdAt": "2020-03-22T19:21:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMTU0NQ=="}], "type": "inlineReview"}, {"oid": "ee45260536e5930e6c33096f0e5c9d63eadf1bf1", "url": "https://github.com/OpenRefine/OpenRefine/commit/ee45260536e5930e6c33096f0e5c9d63eadf1bf1", "message": "removed redundant text and moved code and translations into their respective extensions", "committedDate": "2020-03-22T21:59:56Z", "type": "commit"}]}