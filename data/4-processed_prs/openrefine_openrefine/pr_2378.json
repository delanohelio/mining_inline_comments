{"pr_number": 2378, "pr_title": "Added feature to create column containing Q values", "pr_createdAt": "2020-03-09T06:31:30Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/2378", "timeline": [{"oid": "d53af5566c292a7b7150ddf90053ab0b13ba7c7f", "url": "https://github.com/OpenRefine/OpenRefine/commit/d53af5566c292a7b7150ddf90053ab0b13ba7c7f", "message": "Added feature to create column containing Q values", "committedDate": "2020-03-09T06:16:45Z", "type": "commit"}, {"oid": "c18ee6e0b79d227c005aba7d3b2703854c828825", "url": "https://github.com/OpenRefine/OpenRefine/commit/c18ee6e0b79d227c005aba7d3b2703854c828825", "message": "Defined better language for adding IDs column", "committedDate": "2020-03-10T12:26:05Z", "type": "commit"}, {"oid": "014bba9cd7e5e7ef079fa00cf071687b3e3a375a", "url": "https://github.com/OpenRefine/OpenRefine/commit/014bba9cd7e5e7ef079fa00cf071687b3e3a375a", "message": "Fixed notations", "committedDate": "2020-03-10T13:11:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NDA2NQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390344065", "bodyText": "Localizing text in this way makes it impossible for translators to reorder the column name to a different position in the message. I am really not blaming you since there are loads of places where we do that in the UI at the moment - I'll open an issue to clean these up.\nBecause we are introducing a new message here, let's try to get this right. We use the Wikimedia jQuery i18n plugin, which lets you define templates like this:\nhttps://github.com/wikimedia/jquery.i18n#jqueryi18n-plugin\nSo you should be able to pass column.name as an extra argument to the function and insert it with $1 in the message text.", "author": "wetneb", "createdAt": "2020-03-10T14:15:25Z", "path": "main/webapp/modules/core/scripts/views/data-table/menu-reconcile.js", "diffHunk": "@@ -188,6 +189,49 @@ DataTableColumnHeaderUI.extendMenu(function(column, columnHeaderUI, menu) {\n     var level = DialogSystem.showDialog(frame);\n   };\n \n+  var doAddIdcolumn = function() {\n+    var frame = $(\n+      DOM.loadHTML(\"core\", \"scripts/views/data-table/add-q-column-dialog.html\"));\n+\n+    var elmts = DOM.bind(frame);\n+    elmts.dialogHeader.text($.i18n('core-views/add-id-col')+\" \" + column.name);", "originalCommit": "014bba9cd7e5e7ef079fa00cf071687b3e3a375a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM2OTU1MQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390369551", "bodyText": "Got it!", "author": "madham32", "createdAt": "2020-03-10T14:47:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NDA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM3MzIyNg==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390373226", "bodyText": "Not sure if I was supposed to click Resolve on my own xD Sent a final pull request!", "author": "madham32", "createdAt": "2020-03-10T14:52:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NDA2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NDEyNg==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390344126", "bodyText": "I think onError is meant to determine what to store when evaluating the expression gives an error, so I don't think you can have an expression here? According to the \"Add column\" dialog it can be one of set-to-blank, store-error or keep-original (which probably only makes sense when editing an existing column). I would intuitively go for set-to-blank here.", "author": "wetneb", "createdAt": "2020-03-10T14:15:29Z", "path": "main/webapp/modules/core/scripts/views/data-table/menu-reconcile.js", "diffHunk": "@@ -188,6 +189,49 @@ DataTableColumnHeaderUI.extendMenu(function(column, columnHeaderUI, menu) {\n     var level = DialogSystem.showDialog(frame);\n   };\n \n+  var doAddIdcolumn = function() {\n+    var frame = $(\n+      DOM.loadHTML(\"core\", \"scripts/views/data-table/add-q-column-dialog.html\"));\n+\n+    var elmts = DOM.bind(frame);\n+    elmts.dialogHeader.text($.i18n('core-views/add-id-col')+\" \" + column.name);\n+    \n+    elmts.or_views_newCol.text($.i18n('core-views/new-col-name'));\n+    elmts.okButton.html($.i18n('core-buttons/ok'));\n+    elmts.cancelButton.text($.i18n('core-buttons/cancel'));\n+\n+    var level = DialogSystem.showDialog(frame);\n+    var dismiss = function() { DialogSystem.dismissUntil(level - 1); };\n+\n+    var o = DataTableView.sampleVisibleRows(column);\n+    \n+    elmts.cancelButton.click(dismiss);\n+    elmts.okButton.click(function() {\n+      var columnName = $.trim(elmts.columnNameInput[0].value);\n+      if (!columnName.length) {\n+        alert($.i18n('core-views/warning-col-name'));\n+        return;\n+      }\n+\n+      Refine.postCoreProcess(\n+        \"add-column\", \n+        {\n+          baseColumnName: column.name,  \n+          newColumnName: columnName, \n+          columnInsertIndex: columnIndex + 1,\n+          onError: \"cell.recon.match.id\"", "originalCommit": "014bba9cd7e5e7ef079fa00cf071687b3e3a375a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM2OTkxMw==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390369913", "bodyText": "Oh sorry my bad. Fixed!", "author": "madham32", "createdAt": "2020-03-10T14:48:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NDEyNg=="}], "type": "inlineReview"}, {"oid": "6484f085b4e60b384f4ddcd825565e40ffb88f60", "url": "https://github.com/OpenRefine/OpenRefine/commit/6484f085b4e60b384f4ddcd825565e40ffb88f60", "message": "Add id column final fix", "committedDate": "2020-03-10T14:49:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MTA5NQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390381095", "bodyText": "Why use {{plural}} here? Isn't plural intended to be used for numbers? $1 represents a string, not a number here.", "author": "wetneb", "createdAt": "2020-03-10T15:02:14Z", "path": "main/webapp/modules/core/langs/translation-en.json", "diffHunk": "@@ -518,7 +518,7 @@\n     \"core-views/word-facet\": \"Word facet\",\n     \"core-views/add-id-column\": \"Add entity identifiers column\",\n     \"core-views/add-id-column2\": \"Add a column containing entity identifiers from items\",\n-    \"core-views/add-id-col\": \"Add column containing entity identifiers on column\",\n+    \"core-views/add-id-col\": \"Add column containing entity identifiers on $1 {{plural:$1|column}}\",", "originalCommit": "6484f085b4e60b384f4ddcd825565e40ffb88f60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4NDM2MQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390384361", "bodyText": "I see. I thought that was a i18n parameter, my bad. Should I remove it all and keep just $1?", "author": "madham32", "createdAt": "2020-03-10T15:06:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MTA5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4NjE0Ng==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390386146", "bodyText": "Add column containing entity identifiers on column $1 should do: $1 will just be replaced by the column name.", "author": "wetneb", "createdAt": "2020-03-10T15:08:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MTA5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4NzQ2NA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390387464", "bodyText": "Yep that's what I meant \ud83d\udc4d", "author": "madham32", "createdAt": "2020-03-10T15:10:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MTA5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4ODI2NA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390388264", "bodyText": "Fixed :)", "author": "madham32", "createdAt": "2020-03-10T15:11:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MTA5NQ=="}], "type": "inlineReview"}, {"oid": "ecefd688f0e0ec2017d8d855707d6f70ce5a61ba", "url": "https://github.com/OpenRefine/OpenRefine/commit/ecefd688f0e0ec2017d8d855707d6f70ce5a61ba", "message": "Add id column final fix", "committedDate": "2020-03-10T15:07:39Z", "type": "commit"}]}