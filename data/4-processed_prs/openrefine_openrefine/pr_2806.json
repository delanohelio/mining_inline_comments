{"pr_number": 2806, "pr_title": "Create Project import improvements", "pr_createdAt": "2020-06-24T18:09:50Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/2806", "timeline": [{"oid": "9a27a85d50a5d5fe1c7377904da962d340acd5df", "url": "https://github.com/OpenRefine/OpenRefine/commit/9a27a85d50a5d5fe1c7377904da962d340acd5df", "message": "Fix charset encoding & MIME type handling\n\nCharacter set (ie what we call \"encoding\") is part of the Content-Type,\n*not* the Content-Encoding, which specifies compression (e.g. gzip).\n\nThis correctly sets the character set encoding as well as cleaning\nthe MIME type so that additional parsing doesn't need to be done\ndownstream (and removes that code).", "committedDate": "2020-06-24T17:21:41Z", "type": "commit"}, {"oid": "9b6199b2ceb0c1ec95299541c598b23dbac2b9c2", "url": "https://github.com/OpenRefine/OpenRefine/commit/9b6199b2ceb0c1ec95299541c598b23dbac2b9c2", "message": "Use \"text\" instead of \"text/line-based\" as default fallback format\n\nThe TextLineBasedGuesser only tries a limited number of\nformats (CSV, TSV, fixed), so we can't get out of that hole to\nfind JSON, XML, etc.\n\nStart with a more general format instead to improve our\nguessing odds.", "committedDate": "2020-06-24T17:22:14Z", "type": "commit"}, {"oid": "c8abfc3d52fc3e4d1d2c8006f1144e2e0c394e2b", "url": "https://github.com/OpenRefine/OpenRefine/commit/c8abfc3d52fc3e4d1d2c8006f1144e2e0c394e2b", "message": "Support content type Structured Name Syntax Suffixes (+json +xml)\n\nIf we can't find a fully specified content type in our lookup,\nfall back to just the suffix (which is registered with a leading +)\nFixes #2800 Fixes #2805", "committedDate": "2020-06-24T17:44:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEwOTc2MQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2806#discussion_r445109761", "bodyText": "Is it never useful to read the encoding from entity.getContentEncoding()? Is the getCharset() call you replaced it with always preferable (or should there be a fallback mechanism)?", "author": "wetneb", "createdAt": "2020-06-24T19:06:01Z", "path": "main/src/com/google/refine/importing/ImportingUtilities.java", "diffHunk": "@@ -313,17 +315,20 @@ public void update(long bytesRead, long contentLength, int itemCount) {\n                                 throw new Exception(\"No content found in \" + url.toString());\n                             }\n                             InputStream stream2 = entity.getContent();\n-                            String encoding = null;\n-                            if (entity.getContentEncoding() != null) {\n-                                encoding = entity.getContentEncoding().getValue();\n-                            }\n-                            JSONUtilities.safePut(fileRecord, \"declaredEncoding\", encoding);", "originalCommit": "c8abfc3d52fc3e4d1d2c8006f1144e2e0c394e2b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyOTM3OQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2806#discussion_r445129379", "bodyText": "Never useful and not relevant. Content-Encoding specifies compression. In the case of your example, it will be gzip, but then get written to null when the request handler decompresses the content.", "author": "tfmorris", "createdAt": "2020-06-24T19:43:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEwOTc2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MDQyMg==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2806#discussion_r445140422", "bodyText": "@tfmorris that's useful as a 1 line code comment there I would say. Disambiguating the Encoding term on the spot.", "author": "thadguidry", "createdAt": "2020-06-24T20:04:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEwOTc2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0NDkyMQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2806#discussion_r445144921", "bodyText": "This conversation is about deleted code. That's why it's highlighted in red.", "author": "tfmorris", "createdAt": "2020-06-24T20:13:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEwOTc2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0ODQ4Mg==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2806#discussion_r445148482", "bodyText": "Oops, overlooked. Ok, well then not there", "author": "thadguidry", "createdAt": "2020-06-24T20:20:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEwOTc2MQ=="}], "type": "inlineReview"}]}