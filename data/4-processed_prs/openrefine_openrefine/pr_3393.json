{"pr_number": 3393, "pr_title": "Run UI tests in continuous integration", "pr_createdAt": "2020-12-08T13:43:42Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/3393", "timeline": [{"oid": "ca5ba5a6c39dec18e830b1a23ee27eecd3ef6a1f", "url": "https://github.com/OpenRefine/OpenRefine/commit/ca5ba5a6c39dec18e830b1a23ee27eecd3ef6a1f", "message": "Fixed flaky tests", "committedDate": "2020-12-08T13:03:14Z", "type": "commit"}, {"oid": "ca7bb99a74fb88f3cb47dbbfe519f0b75b87a0c5", "url": "https://github.com/OpenRefine/OpenRefine/commit/ca7bb99a74fb88f3cb47dbbfe519f0b75b87a0c5", "message": "Refactored ui_test commans-line, added documentation", "committedDate": "2020-12-08T13:18:57Z", "type": "commit"}, {"oid": "4c954705301443f6cecc44e1e3946e3566aec663", "url": "https://github.com/OpenRefine/OpenRefine/commit/4c954705301443f6cecc44e1e3946e3566aec663", "message": "Attempt to build a workflow with cypress", "committedDate": "2020-12-08T13:42:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI4MjkxMg==", "url": "https://github.com/OpenRefine/OpenRefine/pull/3393#discussion_r540282912", "bodyText": "what is this for or does?", "author": "thadguidry", "createdAt": "2020-12-10T15:54:21Z", "path": "refine", "diffHunk": "@@ -498,23 +514,37 @@ ui_test() {\n     fi\n     echo \"... proceed with the tests.\"\n     echo \"\"\n-    \n-    load_data \"$REFINE_TEST_DIR/data/food.csv\" \"Food\"\n-    sleep 3\n-    echo \"\"\n-    \n-    echo \"Starting Windmill...\"\n-    if [ -z \"$INTERACTIVE\" ] ; then\n-        \"$WINDMILL\" firefox firebug loglevel=WARN http://${REFINE_HOST}:${REFINE_PORT}/ jsdir=$REFINE_TEST_DIR/client/src exit\n+\n+    echo \"Starting Cypress...\"\n+    CYPRESS_RUN_CMD=\"yarn --cwd ./main/tests/cypress run cypress run --browser $BROWSER --headless --quiet --reporter list --env OPENREFINE_URL=http://$REFINE_HOST:$REFINE_PORT\"\n+    if [ \"$CYPRESS_RECORD\" = \"1\" ] ; then\n+        # if tests are recorded, project id is added to env vars, and --record flag is added to the cmd-line\n+        export CYPRESS_PROJECT_ID=$CYPRESS_PROJECT_ID\n+        CYPRESS_RUN_CMD=\"$CYPRESS_RUN_CMD --record --key $CYPRESS_RECORD_KEY --tag $BROWSER,$REVISION\"\n+    fi\n+    export MOZ_FORCE_DISABLE_E10S=1", "originalCommit": "4c954705301443f6cecc44e1e3946e3566aec663", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "10151b252fe089fe11926d5b278f84e48710a104", "url": "https://github.com/OpenRefine/OpenRefine/commit/10151b252fe089fe11926d5b278f84e48710a104", "message": "Fixed CI UX tests build", "committedDate": "2020-12-11T07:26:24Z", "type": "commit"}, {"oid": "ac7fed5182365d0480b70194c74a5b6190e98955", "url": "https://github.com/OpenRefine/OpenRefine/commit/ac7fed5182365d0480b70194c74a5b6190e98955", "message": "Changed cyprss actions for pull-request", "committedDate": "2020-12-11T16:25:15Z", "type": "commit"}, {"oid": "650a7bb4c476da21507ce17efecc69a320fd2067", "url": "https://github.com/OpenRefine/OpenRefine/commit/650a7bb4c476da21507ce17efecc69a320fd2067", "message": "Merged Cypress workflow into the regular PR target workflow", "committedDate": "2020-12-14T11:05:13Z", "type": "commit"}, {"oid": "2a3f039e44b4fec826cdb83f19ae6fc70151c476", "url": "https://github.com/OpenRefine/OpenRefine/commit/2a3f039e44b4fec826cdb83f19ae6fc70151c476", "message": "Refactored Github workflows to include Cypress Tests", "committedDate": "2020-12-14T11:14:03Z", "type": "commit"}, {"oid": "fc8316e0347014c0396353a615bd0c53077088b9", "url": "https://github.com/OpenRefine/OpenRefine/commit/fc8316e0347014c0396353a615bd0c53077088b9", "message": "Revert Ci build to pull_request_target", "committedDate": "2020-12-15T09:16:02Z", "type": "commit"}]}