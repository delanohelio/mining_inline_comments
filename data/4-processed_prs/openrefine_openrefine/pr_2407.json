{"pr_number": 2407, "pr_title": "Fixes no selected record element error", "pr_createdAt": "2020-03-13T19:20:37Z", "pr_url": "https://github.com/OpenRefine/OpenRefine/pull/2407", "timeline": [{"oid": "d01309f40f63f5fb3ed8f5cef8bb98c0976b6a77", "url": "https://github.com/OpenRefine/OpenRefine/commit/d01309f40f63f5fb3ed8f5cef8bb98c0976b6a77", "message": "fixes no record element error", "committedDate": "2020-03-13T19:17:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MTEzMQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392571131", "bodyText": "I think it'd be cleaner if this was not a global variable, I would store it as an attribute of the importer.", "author": "wetneb", "createdAt": "2020-03-14T09:25:16Z", "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -31,6 +31,8 @@ OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n \n  */\n \n+var recordElementSelected = false;", "originalCommit": "d01309f40f63f5fb3ed8f5cef8bb98c0976b6a77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "45a4d1a2fc9fcd8d953e4ba8985f31478d995ab9", "url": "https://github.com/OpenRefine/OpenRefine/commit/45a4d1a2fc9fcd8d953e4ba8985f31478d995ab9", "message": "made relevant changes", "committedDate": "2020-03-14T09:35:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjE5NA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392572194", "bodyText": "Oh, and that's clearly something we want to localize using i18n. And perhaps avoid the exclamation mark in the message.", "author": "wetneb", "createdAt": "2020-03-14T09:43:48Z", "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -257,6 +260,11 @@ Refine.XmlParserUI.prototype._setRecordPath = function(path) {\n \n Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n+  \n+  if(!self._recordElementSelected) {\n+    alert(\"No record element selected! Please select one first.\");", "originalCommit": "45a4d1a2fc9fcd8d953e4ba8985f31478d995ab9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjM2Nw==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392572367", "bodyText": "Hang on, we already have this message: core-index-import/warning-record-path.", "author": "wetneb", "createdAt": "2020-03-14T09:46:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjQxNA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392572414", "bodyText": "This seems to duplicate the error message above.", "author": "wetneb", "createdAt": "2020-03-14T09:47:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjE5NA=="}], "type": "inlineReview"}, {"oid": "47f9968af4e7b314e7715493aa9d8526301ca20e", "url": "https://github.com/OpenRefine/OpenRefine/commit/47f9968af4e7b314e7715493aa9d8526301ca20e", "message": "alert message from i18n instead", "committedDate": "2020-03-14T10:26:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392574890", "bodyText": "It's still not clear to me why we have to duplicate the existing check, where the same message is used?", "author": "wetneb", "createdAt": "2020-03-14T10:30:56Z", "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -262,7 +262,7 @@ Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n   \n   if(!self._recordElementSelected) {\n-    alert(\"No record element selected! Please select one first.\");\n+    window.alert($.i18n('core-index-import/warning-record-path'));", "originalCommit": "47f9968af4e7b314e7715493aa9d8526301ca20e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NTI4MQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392575281", "bodyText": "The existing check works only when the user clicks the Create Project button. The Update Preview gets stuck if the user does not select one and clicks on any other configuration option. Once that happens, the user cannot do anything (and this happens before Create Project), there isn't any check for this right now. Maybe we can remove the one in Create Project because the check in Update Preview will make sure that a Record Element is always selected?", "author": "lisa761", "createdAt": "2020-03-14T10:37:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NTk2NQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392575965", "bodyText": "I think this happens because once _updatePreview calls ._getOptions, the recordPath is set to a defualt value (because it is 0 currently), which in this case is an empty array. Once the flow of control reaches XMLImportUtilities, an error ArrayIndexOutOfBoundsException is generated in findRecord method because recordPath is empty and we cannot access its 0th index.", "author": "lisa761", "createdAt": "2020-03-14T10:50:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NzUzMQ==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392577531", "bodyText": "It looks like we could potentially remove the boolean you introduce and do the same check as for the other window.alert, no?", "author": "wetneb", "createdAt": "2020-03-14T11:17:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4NzA0MA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392587040", "bodyText": "Yes okay, I wll do that then. Should I also remove the check from confirmCreateProject then?", "author": "lisa761", "createdAt": "2020-03-14T13:04:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4Nzc1Mw==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392587753", "bodyText": "If that is redundant, sure.", "author": "wetneb", "createdAt": "2020-03-14T13:17:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}], "type": "inlineReview"}, {"oid": "18277ef4e692257b4c3eb0b126540853350fe815", "url": "https://github.com/OpenRefine/OpenRefine/commit/18277ef4e692257b4c3eb0b126540853350fe815", "message": "removed the boolean variable", "committedDate": "2020-03-14T14:05:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MTI4OA==", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392591288", "bodyText": "I did this because if I did setRecordPath, the flow reaches updatePreview first and then the same thing happened. Also I let the check in confirmCreateProject be beacuse that would be required when someone directly clicks that button.", "author": "lisa761", "createdAt": "2020-03-14T14:11:46Z", "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -131,6 +131,7 @@ Refine.XmlParserUI.prototype._initialize = function() {\n     this._optionContainerElmts.includeFileSourcesCheckbox.prop(\"checked\", true);\n   }\n   this._optionContainerElmts.pickRecordElementsButton.click(function() {\n+    self._config.recordPath = undefined;", "originalCommit": "18277ef4e692257b4c3eb0b126540853350fe815", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}