{"pr_number": 4522, "pr_title": "[JENKINS-61300] Update search box size on page resize, max width", "pr_createdAt": "2020-02-24T19:16:24Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4522", "timeline": [{"oid": "294d011dec0763ef60c26e86cb8aca5a294066bc", "url": "https://github.com/jenkinsci/jenkins/commit/294d011dec0763ef60c26e86cb8aca5a294066bc", "message": "Update search box size on page resize, simplify code", "committedDate": "2020-02-24T07:51:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM0NjE4OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4522#discussion_r384346189", "bodyText": "In general, I'm very wary of resize listeners, as they can have devastating effects on performance. Have you explored other options?\nIf a resize listener is the way to go, I'd say we need to throttle it. One option could be using window.requestAnimationFrame. That would sort of ensure we can keep 60fps. It's present on all  the supported browsers, and we could just not set this listener on <IE9, as it's not essential.\nWe can also set the listeners just on desktop screens. We can use window.matchMedia for that (https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/addListener).", "author": "fqueiruga", "createdAt": "2020-02-26T08:50:55Z", "path": "war/src/main/webapp/scripts/hudson-behavior.js", "diffHunk": "@@ -2408,25 +2407,24 @@ function createSearchBox(searchURL) {\n         }\n \n         copyFontStyle(box,sizer);\n-        copyFontStyle(box,minW);\n     });\n \n     // update positions and sizes of the components relevant to search\n     function updatePos() {\n-        function max(a,b) { if(a>b) return a; else return b; }\n-\n         sizer.innerHTML = box.value.escapeHTML();\n-        var w = max(sizer.offsetWidth,minW.offsetWidth);\n+        var w = sizer.offsetWidth;\n         box.style.width =\n-        comp.style.width = \n-        comp.firstChild.style.width = (w+60)+\"px\";\n+        comp.style.width =\n+        comp.firstChild.style.minWidth = (w+60)+\"px\";\n \n         var pos = YAHOO.util.Dom.getXY(box);\n         pos[1] += YAHOO.util.Dom.get(box).offsetHeight + 2;\n         YAHOO.util.Dom.setXY(comp, pos);\n     }\n \n     updatePos();\n+    // on small screens offsetWith is 0, update when screen gets bigger\n+    window.addEventListener(\"resize\", updatePos);", "originalCommit": "294d011dec0763ef60c26e86cb8aca5a294066bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM2ODgyNA==", "url": "https://github.com/jenkinsci/jenkins/pull/4522#discussion_r384368824", "bodyText": "I just tried this and I think we can skip the listener altogether if we remove the first invocation of updatePos(). Wonder if that can have any consequence. Having min-width already seems to do the trick.", "author": "fqueiruga", "createdAt": "2020-02-26T09:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM0NjE4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM0NjY2Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4522#discussion_r384346666", "bodyText": "I'd suggest we only run the contents of the updatePos function only when the window width changes. We should avoid running this function on vertical resizes.", "author": "fqueiruga", "createdAt": "2020-02-26T08:51:52Z", "path": "war/src/main/webapp/scripts/hudson-behavior.js", "diffHunk": "@@ -2408,25 +2407,24 @@ function createSearchBox(searchURL) {\n         }\n \n         copyFontStyle(box,sizer);\n-        copyFontStyle(box,minW);\n     });\n \n     // update positions and sizes of the components relevant to search\n     function updatePos() {\n-        function max(a,b) { if(a>b) return a; else return b; }\n-\n         sizer.innerHTML = box.value.escapeHTML();", "originalCommit": "294d011dec0763ef60c26e86cb8aca5a294066bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIyMTc1NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4522#discussion_r385221755", "bodyText": "Disregard the above comment, that would only be the case if it runs on the window resize event, not on keyup", "author": "fqueiruga", "createdAt": "2020-02-27T16:28:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM0NjY2Ng=="}], "type": "inlineReview"}, {"oid": "e8b54a7242eaa8c97c46e0e4e91bb07de278ccdc", "url": "https://github.com/jenkinsci/jenkins/commit/e8b54a7242eaa8c97c46e0e4e91bb07de278ccdc", "message": "Use min-width instead of listener, add max-width", "committedDate": "2020-02-28T00:14:39Z", "type": "commit"}]}