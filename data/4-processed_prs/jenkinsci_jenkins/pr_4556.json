{"pr_number": 4556, "pr_title": "Fix: Jelly 'enum' tag 'default' attribute not working", "pr_createdAt": "2020-03-08T16:10:49Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4556", "timeline": [{"oid": "7938b0c8164dad1c5568356f68907bf529c7e06d", "url": "https://github.com/jenkinsci/jenkins/commit/7938b0c8164dad1c5568356f68907bf529c7e06d", "message": "Fix Jelly form not setting default value for enum when field is empty", "committedDate": "2020-03-06T20:21:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg1NDQzMA==", "url": "https://github.com/jenkinsci/jenkins/pull/4556#discussion_r390854430", "bodyText": "It would be better to introduce a new local variable. Overriding attribute fields might be working now, but I was unable to find Jelly documentation about whether it is a supported behavior. It may stop working eventually.", "author": "oleg-nenashev", "createdAt": "2020-03-11T09:52:25Z", "path": "core/src/main/resources/lib/form/enum.jelly", "diffHunk": "@@ -36,9 +36,14 @@ THE SOFTWARE.\n       The name of the enum to set as default value for the first configuration.\n     </st:attribute>\n   </st:documentation>\n-  <select class=\"setting-input\" name=\"${field}\">\n-    <j:forEach var=\"it\" items=\"${descriptor.getPropertyType(instance,field).enumConstants}\">\n-      <f:option value=\"${it.name()}\" selected=\"${instance != null ? it==instance[field] : it.name()==default}\">\n+\n+  <j:if test=\"${attrs.field==null}\">\n+    <j:set target=\"${attrs}\" property=\"field\" value=\"${entry.field}\" />", "originalCommit": "7938b0c8164dad1c5568356f68907bf529c7e06d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE0MDk4Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4556#discussion_r391140986", "bodyText": "This is the same code what is used in core/src/main/resources/lib/form/descriptorList.jelly or prepareDatabinding.jelly. The descriptorList.jelly is there for years so I treated it as a trusted example.\nAlso Jelly developments seems dead (no single commit for almost 3 years) so I don't think there is a risk of stopping to work.\nOf course If you think that using local variable is more wise then please modify the code how you fell is the best. You are the top contributor so I trust your judgement :)", "author": "knapsu", "createdAt": "2020-03-11T17:28:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg1NDQzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg1NTI4NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4556#discussion_r390855285", "bodyText": "${entry.field} always puts null here. As designed, right?", "author": "oleg-nenashev", "createdAt": "2020-03-11T09:53:50Z", "path": "core/src/main/resources/lib/form/enum.jelly", "diffHunk": "@@ -36,9 +36,14 @@ THE SOFTWARE.\n       The name of the enum to set as default value for the first configuration.\n     </st:attribute>\n   </st:documentation>\n-  <select class=\"setting-input\" name=\"${field}\">\n-    <j:forEach var=\"it\" items=\"${descriptor.getPropertyType(instance,field).enumConstants}\">\n-      <f:option value=\"${it.name()}\" selected=\"${instance != null ? it==instance[field] : it.name()==default}\">\n+\n+  <j:if test=\"${attrs.field==null}\">\n+    <j:set target=\"${attrs}\" property=\"field\" value=\"${entry.field}\" />", "originalCommit": "7938b0c8164dad1c5568356f68907bf529c7e06d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE0Njk5Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/4556#discussion_r391146993", "bodyText": "This fragment is also in core/src/main/resources/lib/form/descriptorList.jelly.\nIt looks up the ancestor <entry> set by entry.jelly.\nattrs.field is not the same as entry.field which most probably will not be null.\nIf enum field and parent entry field are both null then the form is just incorrectly written.\nPlease look at the following examples\n  <f:entry field=\"updateStrategy\">\n    <f:enum>${it.label}}</f:enum>\n  </f:entry>\n\n  <f:enum field=\"updateStrategy\">${it.label}}</f:enum>", "author": "knapsu", "createdAt": "2020-03-11T17:37:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg1NTI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ4NTIyOA==", "url": "https://github.com/jenkinsci/jenkins/pull/4556#discussion_r391485228", "bodyText": "NVM. I misread the code. Thanks for clarification!", "author": "oleg-nenashev", "createdAt": "2020-03-12T09:12:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg1NTI4NQ=="}], "type": "inlineReview"}]}