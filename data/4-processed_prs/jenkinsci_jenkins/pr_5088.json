{"pr_number": 5088, "pr_title": "Automate uploading artifacts to GitHub releases", "pr_createdAt": "2020-11-28T12:46:44Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/5088", "timeline": [{"oid": "44227828c03fc442d852fc8a4333283d5b07e7a6", "url": "https://github.com/jenkinsci/jenkins/commit/44227828c03fc442d852fc8a4333283d5b07e7a6", "message": "Automate uploading artifacts to GitHub releases", "committedDate": "2020-11-28T12:45:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjE5MDY1OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5088#discussion_r532190659", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            on:\n          \n          \n            \n            on:\n          \n          \n            \n              workflow_dispatch:", "author": "olblak", "createdAt": "2020-11-29T10:42:25Z", "path": ".github/workflows/publish-release-artifact.yml", "diffHunk": "@@ -0,0 +1,205 @@\n+name: Publish artifact\n+\n+on:", "originalCommit": "44227828c03fc442d852fc8a4333283d5b07e7a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjE5MDc3OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5088#discussion_r532190779", "bodyText": "If assets are not available from get.jenkins.io when the github action is trigger, this would allow us to force build", "author": "olblak", "createdAt": "2020-11-29T10:43:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjE5MDY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjE5MjcwNw==", "url": "https://github.com/jenkinsci/jenkins/pull/5088#discussion_r532192707", "bodyText": "IMHO the most important thing is to be able to force a job", "author": "olblak", "createdAt": "2020-11-29T11:00:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjE5MDY1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjczODM3Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/5088#discussion_r532738376", "bodyText": "Recommend moving this sort of thing to separate *.sh files for legibility. (You have already run actions/checkout.)", "author": "jglick", "createdAt": "2020-11-30T16:42:46Z", "path": ".github/workflows/publish-release-artifact.yml", "diffHunk": "@@ -0,0 +1,205 @@\n+name: Publish artifact\n+\n+on:\n+  release:\n+    types: [published]\n+\n+jobs:\n+  determine-version:\n+    runs-on: ubuntu-latest\n+    outputs:\n+      project-version: ${{ steps.set-version.outputs.project-version }}\n+      is-lts: ${{ steps.set-version.outputs.is-lts }}\n+    steps:\n+      - uses: actions/checkout@v2\n+      - name: Set up JDK 1.8\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - name: Set version\n+        id: set-version\n+        run: |\n+          version=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)\n+\n+          dot_count=$(echo $version | sed 's/[^.]//g' | awk '{ print length }')\n+          if [ \"${dot_count}\" = '2' ]\n+          then\n+            is_lts=true\n+          else\n+            is_lts=false\n+          fi\n+\n+          echo \"Version is $version, is_lts: $is_lts\"\n+\n+          echo \"::set-output name=is-lts::${is_lts}\"\n+          echo \"::set-output name=project-version::$version\"", "originalCommit": "44227828c03fc442d852fc8a4333283d5b07e7a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5MDQ1NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5088#discussion_r532890455", "bodyText": "this blocking? i.e. some more work would be required to test this...", "author": "timja", "createdAt": "2020-11-30T20:42:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjczODM3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkwOTI3NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5088#discussion_r532909275", "bodyText": "No, just a suggestion.", "author": "jglick", "createdAt": "2020-11-30T21:17:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjczODM3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0MDM3MQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5088#discussion_r532740371", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      wget -q https://get.jenkins.io/${REPO}/${PROJECT_VERSION}/jenkins.war\n          \n          \n            \n                      wget -O $FILE_NAME -q https://get.jenkins.io/${REPO}/${PROJECT_VERSION}/jenkins.war\n          \n      \n    \n    \n  \n\nfor robustness/clarity?", "author": "jglick", "createdAt": "2020-11-30T16:45:28Z", "path": ".github/workflows/publish-release-artifact.yml", "diffHunk": "@@ -0,0 +1,205 @@\n+name: Publish artifact\n+\n+on:\n+  release:\n+    types: [published]\n+\n+jobs:\n+  determine-version:\n+    runs-on: ubuntu-latest\n+    outputs:\n+      project-version: ${{ steps.set-version.outputs.project-version }}\n+      is-lts: ${{ steps.set-version.outputs.is-lts }}\n+    steps:\n+      - uses: actions/checkout@v2\n+      - name: Set up JDK 1.8\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - name: Set version\n+        id: set-version\n+        run: |\n+          version=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)\n+\n+          dot_count=$(echo $version | sed 's/[^.]//g' | awk '{ print length }')\n+          if [ \"${dot_count}\" = '2' ]\n+          then\n+            is_lts=true\n+          else\n+            is_lts=false\n+          fi\n+\n+          echo \"Version is $version, is_lts: $is_lts\"\n+\n+          echo \"::set-output name=is-lts::${is_lts}\"\n+          echo \"::set-output name=project-version::$version\"\n+  war:\n+    runs-on: ubuntu-latest\n+    needs: determine-version\n+    steps:\n+      - name: Fetch war\n+        id: fetch-war\n+        run: |\n+          FILE_NAME=jenkins.war\n+          PROJECT_VERSION=${{ needs.determine-version.outputs.project-version }}\n+          IS_LTS=${{ needs.determine-version.outputs.is-lts }}\n+          echo $PROJECT_VERSION\n+          echo \"::set-output name=file-name::$FILE_NAME\"\n+\n+          REPO=war\n+          if [ ${IS_LTS} = 'true' ]\n+          then\n+            REPO=war-stable\n+          fi\n+\n+          echo $REPO\n+\n+          wget -q https://get.jenkins.io/${REPO}/${PROJECT_VERSION}/jenkins.war", "originalCommit": "44227828c03fc442d852fc8a4333283d5b07e7a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0NzIxOQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5088#discussion_r532747219", "bodyText": "wget will always use the file name, not sure it makes much different", "author": "timja", "createdAt": "2020-11-30T16:54:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0MDM3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc1MjIyNg==", "url": "https://github.com/jenkinsci/jenkins/pull/5088#discussion_r532752226", "bodyText": "Alternately,\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      wget -q https://get.jenkins.io/${REPO}/${PROJECT_VERSION}/jenkins.war\n          \n          \n            \n                      wget -q https://get.jenkins.io/${REPO}/${PROJECT_VERSION}/${FILE_NAME}", "author": "jglick", "createdAt": "2020-11-30T17:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc0MDM3MQ=="}], "type": "inlineReview"}, {"oid": "ed28c265f808c26cdc57969a0d33720681cc5022", "url": "https://github.com/jenkinsci/jenkins/commit/ed28c265f808c26cdc57969a0d33720681cc5022", "message": "Add file name", "committedDate": "2020-11-30T20:41:47Z", "type": "commit"}]}