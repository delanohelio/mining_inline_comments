{"pr_number": 5015, "pr_title": "[JENKINS-63977] Separate security / non-security admin monitors", "pr_createdAt": "2020-10-18T20:27:53Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/5015", "timeline": [{"oid": "8b37e6c71b351e3ec6a54514665acea821479de5", "url": "https://github.com/jenkinsci/jenkins/commit/8b37e6c71b351e3ec6a54514665acea821479de5", "message": "[JENKINS-63977] Separate security / non-security admin monitors\n\n+ improve performance by calling them only once per page (instead of 4)", "committedDate": "2020-10-18T20:23:55Z", "type": "commit"}, {"oid": "8bc8f042da0ba4fce9b629530931e255eab80c71", "url": "https://github.com/jenkinsci/jenkins/commit/8bc8f042da0ba4fce9b629530931e255eab80c71", "message": "Merge branch 'master' into security-admin-monitor-separation", "committedDate": "2020-10-18T20:29:03Z", "type": "commit"}, {"oid": "e3860fd0d29890f102a5266e589a3f2fcfec9f42", "url": "https://github.com/jenkinsci/jenkins/commit/e3860fd0d29890f102a5266e589a3f2fcfec9f42", "message": "Adjust the wrong conflict resolution", "committedDate": "2020-10-19T07:16:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2NDM1OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5015#discussion_r508264359", "bodyText": "thoughts on?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            tooltipSec=There are {0} active security administrative monitors.\n          \n          \n            \n            tooltipSec={0} active security issue(s).", "author": "timja", "createdAt": "2020-10-20T07:19:46Z", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/footer.properties", "diffHunk": "@@ -1 +1,2 @@\n tooltip=There are {0} active administrative monitors.\n+tooltipSec=There are {0} active security administrative monitors.", "originalCommit": "e3860fd0d29890f102a5266e589a3f2fcfec9f42", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQzODIzMw==", "url": "https://github.com/jenkinsci/jenkins/pull/5015#discussion_r508438233", "bodyText": "Seems misleading.", "author": "daniel-beck", "createdAt": "2020-10-20T11:55:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2NDM1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg5OTMyMw==", "url": "https://github.com/jenkinsci/jenkins/pull/5015#discussion_r509899323", "bodyText": "Less information and open to interpretation", "author": "sladyn98", "createdAt": "2020-10-22T06:03:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2NDM1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI0MDM4OA==", "url": "https://github.com/jenkinsci/jenkins/pull/5015#discussion_r509240388", "bodyText": "I think a fallback bg color is needed here", "author": "fqueiruga", "createdAt": "2020-10-21T12:35:58Z", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.css", "diffHunk": "@@ -40,12 +44,16 @@\n     opacity: 0;\n     transform: scale(0);\n }\n-#visible-am-container.visible div#visible-am-list {\n+.am-container.visible div.am-list {\n     opacity: 1;\n     transform: scale(1);\n     z-index: 1000;\n }\n-#visible-am-container #visible-am-button:after {\n+.am-container.visible .am-button {\n+    background-color: var(--header-link-bg-classic-active);", "originalCommit": "e3860fd0d29890f102a5266e589a3f2fcfec9f42", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7cdecd2e1a92503ed7209ad605d867a293ee8c0c", "url": "https://github.com/jenkinsci/jenkins/commit/7cdecd2e1a92503ed7209ad605d867a293ee8c0c", "message": "Add fallback background", "committedDate": "2020-10-24T14:58:40Z", "type": "commit"}, {"oid": "0584b75c12afd5aadb0717b15209c0e8304cebf9", "url": "https://github.com/jenkinsci/jenkins/commit/0584b75c12afd5aadb0717b15209c0e8304cebf9", "message": "Merge remote-tracking branch 'origin/security-admin-monitor-separation' into security-admin-monitor-separation", "committedDate": "2020-10-24T14:58:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNjIzMg==", "url": "https://github.com/jenkinsci/jenkins/pull/5015#discussion_r522026232", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                <span class=\"am-monitor__count\">\n          \n          \n            \n                                <div class=\"am-monitor__indicator-mobile\" />\n          \n          \n            \n                                <span class=\"am-monitor__count\">", "author": "fqueiruga", "createdAt": "2020-11-12T11:11:49Z", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/footer.jelly", "diffHunk": "@@ -22,26 +22,56 @@ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n -->\n <?jelly escape-by-default='true'?>\n-<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\">\n-    <j:if test=\"${it.shouldDisplay()}\">\n+<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:l=\"/lib/layout\">\n+    <j:set var=\"activeMonitors\" value=\"${it.getMonitorsToDisplay()}\" />\n+    \n+    <j:if test=\"${activeMonitors != null and activeMonitors.size() > 0}\">\n         <st:adjunct includes=\"jenkins.management.AdministrativeMonitorsDecorator.resources\"/>\n-        <div id=\"visible-am-container\">\n-            <a id=\"visible-am-button\" href=\"#\" onclick=\"toggleVisibleAmList(event)\" title=\"${%tooltip(it.activeAdministrativeMonitorsCount)}\">\n-                <l:svgIcon href=\"${resURL}/images/material-icons/svg-sprite-social-symbol.svg#ic_notifications_24px\" />\n-                <span class=\"am-monitor__count\">\n-                    ${it.activeAdministrativeMonitorsCount}\n-                </span>\n-            </a>\n-            <div id=\"visible-am-list\">\n-                <j:forEach var=\"am\" items=\"${it.activeAdministrativeMonitors}\">\n-                    <div class=\"am-message\">\n-                    <st:include page=\"message.jelly\" it=\"${am}\" />\n-                    </div>\n-                </j:forEach>\n-                <p style=\"text-align: center; margin: 10px 0 0 0;\">\n-                    <a href=\"${rootURL}/manage\" onclick=\"document.location.href='${rootURL}/manage';\">${%Manage Jenkins}</a>\n-                </p>\n-            </div>\n+\n+        <j:set var=\"activeNonSecurityAM\" value=\"${it.filterNonSecurityAdministrativeMonitors(activeMonitors)}\" />\n+        <j:set var=\"activeNonSecurityAMCount\" value=\"${activeNonSecurityAM.size()}\" />\n+        <j:set var=\"activeSecurityAM\" value=\"${it.filterSecurityAdministrativeMonitors(activeMonitors)}\" />\n+        <j:set var=\"activeSecurityAMCount\" value=\"${activeSecurityAM.size()}\" />\n+\n+        <div id=\"visible-am-container\" class=\"am-container\">\n+            <j:if test=\"${activeNonSecurityAMCount > 0}\">\n+                <a id=\"visible-am-button\" class=\"am-button\" href=\"#\" onclick=\"toggleVisibleAmList(event)\" title=\"${%tooltip(activeNonSecurityAMCount)}\">\n+                    <l:svgIcon href=\"${resURL}/images/material-icons/svg-sprite-social-symbol.svg#ic_notifications_24px\" />\n+                    <span class=\"am-monitor__count\">", "originalCommit": "0584b75c12afd5aadb0717b15209c0e8304cebf9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNjUzNw==", "url": "https://github.com/jenkinsci/jenkins/pull/5015#discussion_r522026537", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                <span class=\"am-monitor__count\">\n          \n          \n            \n                                <div class=\"am-monitor__indicator-mobile\" />\n          \n          \n            \n                                <span class=\"am-monitor__count\">", "author": "fqueiruga", "createdAt": "2020-11-12T11:12:18Z", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/footer.jelly", "diffHunk": "@@ -22,26 +22,56 @@ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n -->\n <?jelly escape-by-default='true'?>\n-<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\">\n-    <j:if test=\"${it.shouldDisplay()}\">\n+<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:l=\"/lib/layout\">\n+    <j:set var=\"activeMonitors\" value=\"${it.getMonitorsToDisplay()}\" />\n+    \n+    <j:if test=\"${activeMonitors != null and activeMonitors.size() > 0}\">\n         <st:adjunct includes=\"jenkins.management.AdministrativeMonitorsDecorator.resources\"/>\n-        <div id=\"visible-am-container\">\n-            <a id=\"visible-am-button\" href=\"#\" onclick=\"toggleVisibleAmList(event)\" title=\"${%tooltip(it.activeAdministrativeMonitorsCount)}\">\n-                <l:svgIcon href=\"${resURL}/images/material-icons/svg-sprite-social-symbol.svg#ic_notifications_24px\" />\n-                <span class=\"am-monitor__count\">\n-                    ${it.activeAdministrativeMonitorsCount}\n-                </span>\n-            </a>\n-            <div id=\"visible-am-list\">\n-                <j:forEach var=\"am\" items=\"${it.activeAdministrativeMonitors}\">\n-                    <div class=\"am-message\">\n-                    <st:include page=\"message.jelly\" it=\"${am}\" />\n-                    </div>\n-                </j:forEach>\n-                <p style=\"text-align: center; margin: 10px 0 0 0;\">\n-                    <a href=\"${rootURL}/manage\" onclick=\"document.location.href='${rootURL}/manage';\">${%Manage Jenkins}</a>\n-                </p>\n-            </div>\n+\n+        <j:set var=\"activeNonSecurityAM\" value=\"${it.filterNonSecurityAdministrativeMonitors(activeMonitors)}\" />\n+        <j:set var=\"activeNonSecurityAMCount\" value=\"${activeNonSecurityAM.size()}\" />\n+        <j:set var=\"activeSecurityAM\" value=\"${it.filterSecurityAdministrativeMonitors(activeMonitors)}\" />\n+        <j:set var=\"activeSecurityAMCount\" value=\"${activeSecurityAM.size()}\" />\n+\n+        <div id=\"visible-am-container\" class=\"am-container\">\n+            <j:if test=\"${activeNonSecurityAMCount > 0}\">\n+                <a id=\"visible-am-button\" class=\"am-button\" href=\"#\" onclick=\"toggleVisibleAmList(event)\" title=\"${%tooltip(activeNonSecurityAMCount)}\">\n+                    <l:svgIcon href=\"${resURL}/images/material-icons/svg-sprite-social-symbol.svg#ic_notifications_24px\" />\n+                    <span class=\"am-monitor__count\">\n+                        ${activeNonSecurityAMCount}\n+                    </span>\n+                </a>\n+                <div id=\"visible-am-list\" class=\"am-list\">\n+                    <j:forEach var=\"am\" items=\"${activeNonSecurityAM}\">\n+                        <div class=\"am-message\">\n+                            <st:include page=\"message.jelly\" it=\"${am}\" />\n+                        </div>\n+                    </j:forEach>\n+                    <p style=\"text-align: center; margin: 10px 0 0 0;\">\n+                        <a href=\"${rootURL}/manage\" onclick=\"document.location.href='${rootURL}/manage';\">${%Manage Jenkins}</a>\n+                    </p>\n+                </div>\n+            </j:if>\n+        </div>\n+        <div id=\"visible-sec-am-container\" class=\"am-container\">\n+            <j:if test=\"${activeSecurityAMCount > 0}\">\n+                <a id=\"visible-sec-am-button\" class=\"am-button security-am\" href=\"#\" onclick=\"toggleVisibleSecAmList(event)\" title=\"${%tooltipSec(activeSecurityAMCount)}\">\n+                    <l:svgIcon href=\"${resURL}/images/material-icons/svg-sprite-action-symbol.svg#ic_warning_shield_24px\" />\n+                    <span class=\"am-monitor__count\">", "originalCommit": "0584b75c12afd5aadb0717b15209c0e8304cebf9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNzAzOA==", "url": "https://github.com/jenkinsci/jenkins/pull/5015#discussion_r522027038", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .am-button .am-monitor__count {\n          \n          \n            \n            .am-button .am-monitor__indicator-mobile {\n          \n          \n            \n                display: none;\n          \n          \n            \n                position: absolute;\n          \n          \n            \n                top: .25rem;\n          \n          \n            \n                right: .25rem;\n          \n          \n            \n                border-radius: 50%;\n          \n          \n            \n                width: .65rem;\n          \n          \n            \n                height: .65rem;\n          \n          \n            \n                background-color: #ff9800;\n          \n          \n            \n            }\n          \n          \n            \n            .security-am .am-monitor__indicator-mobile {\n          \n          \n            \n                background-color: #dc3545;\n          \n          \n            \n            }\n          \n          \n            \n            \n          \n          \n            \n            .am-button .am-monitor__count {", "author": "fqueiruga", "createdAt": "2020-11-12T11:13:16Z", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.css", "diffHunk": "@@ -1,12 +1,12 @@\n-#visible-am-container {\n+.am-container {\n     height: 100%;\n }\n \n-#visible-am-button {\n+.am-button {\n     position: relative;\n }\n \n-#visible-am-button .am-monitor__count {\n+.am-button .am-monitor__count {", "originalCommit": "0584b75c12afd5aadb0717b15209c0e8304cebf9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNzc2NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5015#discussion_r522027765", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }\n          \n          \n            \n            \n          \n          \n            \n            @media screen and (max-width: 768px) {\n          \n          \n            \n                .am-button .am-monitor__indicator-mobile {\n          \n          \n            \n                    display: block;\n          \n          \n            \n                }\n          \n          \n            \n                .am-button .am-monitor__count {\n          \n          \n            \n                    display: none;\n          \n          \n            \n                }\n          \n          \n            \n            }", "author": "fqueiruga", "createdAt": "2020-11-12T11:14:19Z", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.css", "diffHunk": "@@ -100,37 +109,37 @@\n     font-weight: 600;\n     font-weight: var(--link-font-weight);\n }\n-#visible-am-container #visible-am-list a:visited {\n+.am-container .am-list a:visited {\n     color: #5c3566;\n     color: var(--link-color);\n }\n-#visible-am-container #visible-am-list a:hover,\n-#visible-am-container #visible-am-list a:focus,\n-#visible-am-container #visible-am-list a:active {\n+.am-container .am-list a:hover,\n+.am-container .am-list a:focus,\n+.am-container .am-list a:active {\n     color: #5c3566;\n     color: var(--link-color);\n     background-color: transparent;\n     text-decoration: underline;\n     text-decoration: var(--link-text-decoration--hover);\n }\n \n-#visible-am-container #visible-am-list .alert-success a {\n+.am-container .am-list .alert-success a {\n     color: #155724;\n     color: var(--alert-success-text-color);\n }\n \n \n-#visible-am-container #visible-am-list .alert-info a {\n+.am-container .am-list .alert-info a {\n     color: #31708f;\n     color: var(--alert-info-text-color);\n }\n \n-#visible-am-container #visible-am-list .alert-warning a {\n+.am-container .am-list .alert-warning a {\n     color: #8a6d3b;\n     color: var(--alert-warning-text-color);\n }\n \n-#visible-am-container #visible-am-list .alert-danger a {\n+.am-container .am-list .alert-danger a {\n     color: #a94442;\n     color: var(--alert-danger-text-color);\n }", "originalCommit": "0584b75c12afd5aadb0717b15209c0e8304cebf9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1278a471f423e972163b7fd43b04fe7d6a5bd8aa", "url": "https://github.com/jenkinsci/jenkins/commit/1278a471f423e972163b7fd43b04fe7d6a5bd8aa", "message": "Apply suggestions from code review\n\nCo-authored-by: F\u00e9lix Queiruga <felix.queiruga@gmail.com>", "committedDate": "2020-11-12T12:17:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI1ODU4Mg==", "url": "https://github.com/jenkinsci/jenkins/pull/5015#discussion_r522258582", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @media screen and (max-width: 768px) {\n          \n          \n            \n            @media screen and (max-width: 576px) {\n          \n          \n            \n                /* Hide non-security monitors on mobile view to avoid messing up the heading */\n          \n          \n            \n                #visible-am-container {\n          \n          \n            \n                   display: none;\n          \n          \n            \n                }\n          \n          \n            \n            }\n          \n          \n            \n            \n          \n          \n            \n            @media screen and (max-width: 768px) {", "author": "fqueiruga", "createdAt": "2020-11-12T16:52:55Z", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.css", "diffHunk": "@@ -100,37 +123,46 @@\n     font-weight: 600;\n     font-weight: var(--link-font-weight);\n }\n-#visible-am-container #visible-am-list a:visited {\n+.am-container .am-list a:visited {\n     color: #5c3566;\n     color: var(--link-color);\n }\n-#visible-am-container #visible-am-list a:hover,\n-#visible-am-container #visible-am-list a:focus,\n-#visible-am-container #visible-am-list a:active {\n+.am-container .am-list a:hover,\n+.am-container .am-list a:focus,\n+.am-container .am-list a:active {\n     color: #5c3566;\n     color: var(--link-color);\n     background-color: transparent;\n     text-decoration: underline;\n     text-decoration: var(--link-text-decoration--hover);\n }\n \n-#visible-am-container #visible-am-list .alert-success a {\n+.am-container .am-list .alert-success a {\n     color: #155724;\n     color: var(--alert-success-text-color);\n }\n \n \n-#visible-am-container #visible-am-list .alert-info a {\n+.am-container .am-list .alert-info a {\n     color: #31708f;\n     color: var(--alert-info-text-color);\n }\n \n-#visible-am-container #visible-am-list .alert-warning a {\n+.am-container .am-list .alert-warning a {\n     color: #8a6d3b;\n     color: var(--alert-warning-text-color);\n }\n \n-#visible-am-container #visible-am-list .alert-danger a {\n+.am-container .am-list .alert-danger a {\n     color: #a94442;\n     color: var(--alert-danger-text-color);\n }\n+\n+@media screen and (max-width: 768px) {", "originalCommit": "1278a471f423e972163b7fd43b04fe7d6a5bd8aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "297cdf0455a6dc918d45c8262fa8ffa217ab470b", "url": "https://github.com/jenkinsci/jenkins/commit/297cdf0455a6dc918d45c8262fa8ffa217ab470b", "message": "Update core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.css\n\nCo-authored-by: F\u00e9lix Queiruga <felix.queiruga@gmail.com>", "committedDate": "2020-11-12T17:11:49Z", "type": "commit"}]}