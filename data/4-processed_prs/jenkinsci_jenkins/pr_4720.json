{"pr_number": 4720, "pr_title": "System read code simplification", "pr_createdAt": "2020-05-11T20:02:49Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4720", "timeline": [{"oid": "d17e55943da52e19c4a34d345cb56b0671a82d45", "url": "https://github.com/jenkinsci/jenkins/commit/d17e55943da52e19c4a34d345cb56b0671a82d45", "message": "System read cleanup", "committedDate": "2020-05-11T19:36:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4OTQyNA==", "url": "https://github.com/jenkinsci/jenkins/pull/4720#discussion_r423289424", "bodyText": "Seems like an oversight to use Functions without need.", "author": "daniel-beck", "createdAt": "2020-05-11T20:09:21Z", "path": "core/src/main/resources/hudson/security/GlobalSecurityConfiguration/index.groovy", "diffHunk": "@@ -17,9 +17,7 @@ l.layout(permission:app.SYSTEM_READ, title:my.displayName, cssclass:request.getP\n             l.icon(class: 'icon-secure icon-xlg')\n             text(my.displayName)\n         }\n-        if (!h.hasPermission(app.ADMINISTER)) {\n-            set(\"readOnlyMode\", \"true\")\n-        }\n+        set(\"readOnlyMode\", !h.hasPermission(app.ADMINISTER))", "originalCommit": "d17e55943da52e19c4a34d345cb56b0671a82d45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5MjUyMA==", "url": "https://github.com/jenkinsci/jenkins/pull/4720#discussion_r423292520", "bodyText": "are you saying Functions should be used here or h?", "author": "timja", "createdAt": "2020-05-11T20:15:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4OTQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDQ0MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4720#discussion_r423294440", "bodyText": "app.hasPermission as in some other of these changes.", "author": "daniel-beck", "createdAt": "2020-05-11T20:18:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4OTQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMwMjgyOQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4720#discussion_r423302829", "bodyText": "done", "author": "timja", "createdAt": "2020-05-11T20:34:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4OTQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM0OTU3MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4720#discussion_r423349570", "bodyText": "(Or Jenkins.get() which is the nicer, type-safer variant for Groovy views, but really the improvement is marginal. Not worth redoing, just a recommendation for the future.)", "author": "daniel-beck", "createdAt": "2020-05-11T22:11:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4OTQyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4OTYwMw==", "url": "https://github.com/jenkinsci/jenkins/pull/4720#discussion_r423289603", "bodyText": "As above.", "author": "daniel-beck", "createdAt": "2020-05-11T20:09:41Z", "path": "core/src/main/resources/jenkins/tools/GlobalToolConfiguration/index.groovy", "diffHunk": "@@ -7,18 +7,14 @@ def f=namespace(lib.FormTagLib)\n def l=namespace(lib.LayoutTagLib)\n def st=namespace(\"jelly:stapler\")\n \n-\n-if (!Functions.hasPermission(app.ADMINISTER)) {\n-    set(\"readOnlyMode\", \"true\")\n-}\n-\n l.layout(permission:app.SYSTEM_READ, title:my.displayName) {\n     l.side_panel {\n         l.tasks {\n             l.task(icon:\"icon-up icon-md\", href:rootURL+'/', title:_(\"Back to Dashboard\"))\n             l.task(icon:\"icon-gear2 icon-md\", href:\"${rootURL}/manage\", title:_(\"Manage Jenkins\"))\n         }\n     }\n+    set(\"readOnlyMode\", !h.hasPermission(app.ADMINISTER))", "originalCommit": "d17e55943da52e19c4a34d345cb56b0671a82d45", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1ecf191f32d8383661ecf9442a3117047dbd1acf", "url": "https://github.com/jenkinsci/jenkins/commit/1ecf191f32d8383661ecf9442a3117047dbd1acf", "message": "Use app.hasPermission", "committedDate": "2020-05-11T20:33:15Z", "type": "commit"}]}