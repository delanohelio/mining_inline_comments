{"pr_number": 4745, "pr_title": "[JENKINS-62433] Read-only system message", "pr_createdAt": "2020-05-26T13:28:15Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4745", "timeline": [{"oid": "7595df0a21e124cc3eaf2880efd7915f5a82265f", "url": "https://github.com/jenkinsci/jenkins/commit/7595df0a21e124cc3eaf2880efd7915f5a82265f", "message": "Read-only system message", "committedDate": "2020-05-26T13:22:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQxNjg1NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4745#discussion_r430416855", "bodyText": "This seems like a really brittle way to get the node to me. Isn't there any other way, maybe using a class or an ID?", "author": "fqueiruga", "createdAt": "2020-05-26T13:35:55Z", "path": "core/src/main/resources/lib/form/textarea/textarea.js", "diffHunk": "@@ -48,7 +48,14 @@ Behaviour.specify(\"DIV.textarea-preview-container\", 'textarea', 100, function (e\n         showPreview.onclick = function() {\n             // Several TEXTAREAs may exist if CodeMirror is enabled. The first one has reference to the CodeMirror object.\n             var textarea = e.parentNode.getElementsByTagName(\"TEXTAREA\")[0];\n-            var text = textarea.codemirrorObject ? textarea.codemirrorObject.getValue() : textarea.value;\n+            var text = \"\";\n+            //Textarea object will be null if the text area is disabled.\n+            if (textarea == null) {\n+                textarea = e.parentNode.getElementsByTagName(\"pre\")[0];", "originalCommit": "7595df0a21e124cc3eaf2880efd7915f5a82265f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzNzY0Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4745#discussion_r430437647", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            textarea = e.parentNode.getElementsByTagName(\"pre\")[0];\n          \n          \n            \n                            textarea = e.parentNode.getElementsByClassName(\"jenkins-readonly\")[0];\n          \n      \n    \n    \n  \n\nI can do this. Because of l:possibleReadOnlyField I don't have too much to go on", "author": "res0nance", "createdAt": "2020-05-26T14:04:25Z", "path": "core/src/main/resources/lib/form/textarea/textarea.js", "diffHunk": "@@ -48,7 +48,14 @@ Behaviour.specify(\"DIV.textarea-preview-container\", 'textarea', 100, function (e\n         showPreview.onclick = function() {\n             // Several TEXTAREAs may exist if CodeMirror is enabled. The first one has reference to the CodeMirror object.\n             var textarea = e.parentNode.getElementsByTagName(\"TEXTAREA\")[0];\n-            var text = textarea.codemirrorObject ? textarea.codemirrorObject.getValue() : textarea.value;\n+            var text = \"\";\n+            //Textarea object will be null if the text area is disabled.\n+            if (textarea == null) {\n+                textarea = e.parentNode.getElementsByTagName(\"pre\")[0];", "originalCommit": "7595df0a21e124cc3eaf2880efd7915f5a82265f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0MTAxOA==", "url": "https://github.com/jenkinsci/jenkins/pull/4745#discussion_r430441018", "bodyText": "This is much better IMO and more robust. I suggest adding a check to verify that textarea is not undefined", "author": "fqueiruga", "createdAt": "2020-05-26T14:08:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzNzY0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0NDU5MQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4745#discussion_r430444591", "bodyText": "Addressed in 4467b36", "author": "res0nance", "createdAt": "2020-05-26T14:13:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzNzY0Nw=="}], "type": "inlineReview"}, {"oid": "4467b36410ce0414df47a8ba6d0772136de47704", "url": "https://github.com/jenkinsci/jenkins/commit/4467b36410ce0414df47a8ba6d0772136de47704", "message": "More robust js", "committedDate": "2020-05-26T14:12:16Z", "type": "commit"}]}