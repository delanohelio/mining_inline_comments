{"pr_number": 4841, "pr_title": "[JENKINS-61806] Form validation for TimeZoneProperty.timeZoneName", "pr_createdAt": "2020-07-10T15:31:37Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4841", "timeline": [{"oid": "6d6129d6984ea8f6f90a5ecf037f7a7910213665", "url": "https://github.com/jenkinsci/jenkins/commit/6d6129d6984ea8f6f90a5ecf037f7a7910213665", "message": "[JENKINS-61806] Form validation for TimeZoneProperty.timeZoneName", "committedDate": "2020-07-10T15:28:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkxNzM0Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4841#discussion_r452917346", "bodyText": "Was not displayed anywhere that I could see, so moving to inline help.", "author": "jglick", "createdAt": "2020-07-10T15:31:58Z", "path": "core/src/main/resources/hudson/model/TimeZoneProperty/config.properties", "diffHunk": "@@ -18,4 +18,3 @@\n # OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n # THE SOFTWARE.\n title=Time Zone\n-description=Specify user defined time zone for displaying time rather than system default.", "originalCommit": "6d6129d6984ea8f6f90a5ecf037f7a7910213665", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4MzcxMg==", "url": "https://github.com/jenkinsci/jenkins/pull/4841#discussion_r453183712", "bodyText": "what's di referring to here? 'proposed_di'", "author": "timja", "createdAt": "2020-07-11T11:00:37Z", "path": "core/src/main/resources/hudson/model/Messages.properties", "diffHunk": "@@ -403,6 +403,8 @@ User.IllegalFullname=\"{0}\" is prohibited as a full name for security reasons.\n \n TimeZoneProperty.DisplayName=User Defined Time Zone \n TimeZoneProperty.DisplayDefaultTimeZone=Default\n+TimeZoneProperty.current_time_in_=Current time in {0}: {1}\n+TimeZoneProperty.current_time_on_server_in_in_proposed_di=Current time on server in {0}: {1}; in proposed display zone: {2}", "originalCommit": "6d6129d6984ea8f6f90a5ecf037f7a7910213665", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwMzI4OA==", "url": "https://github.com/jenkinsci/jenkins/pull/4841#discussion_r453203288", "bodyText": "It says in here twice, as well as in the code", "author": "res0nance", "createdAt": "2020-07-11T15:02:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4MzcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwODIxMw==", "url": "https://github.com/jenkinsci/jenkins/pull/4841#discussion_r453208213", "bodyText": "Just abbreviations of the English text, generated with an IDE plugin.", "author": "jglick", "createdAt": "2020-07-11T15:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4MzcxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1NTQ4NA==", "url": "https://github.com/jenkinsci/jenkins/pull/4841#discussion_r453355484", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            TimeZoneProperty.current_time_on_server_in_in_proposed_di=Current time on server in {0}: {1}; in proposed display zone: {2}\n          \n          \n            \n            TimeZoneProperty.current_time_on_server_in_proposed_di=Current time on server in {0}: {1}; in proposed display zone: {2}", "author": "oleg-nenashev", "createdAt": "2020-07-12T19:42:36Z", "path": "core/src/main/resources/hudson/model/Messages.properties", "diffHunk": "@@ -403,6 +403,8 @@ User.IllegalFullname=\"{0}\" is prohibited as a full name for security reasons.\n \n TimeZoneProperty.DisplayName=User Defined Time Zone \n TimeZoneProperty.DisplayDefaultTimeZone=Default\n+TimeZoneProperty.current_time_in_=Current time in {0}: {1}\n+TimeZoneProperty.current_time_on_server_in_in_proposed_di=Current time on server in {0}: {1}; in proposed display zone: {2}", "originalCommit": "6d6129d6984ea8f6f90a5ecf037f7a7910213665", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM3MjI2MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4841#discussion_r453372260", "bodyText": "(not a typo, as noted above)", "author": "jglick", "createdAt": "2020-07-12T22:43:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1NTQ4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1NTUwMg==", "url": "https://github.com/jenkinsci/jenkins/pull/4841#discussion_r453355502", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            return FormValidation.ok(Messages.TimeZoneProperty_current_time_on_server_in_in_proposed_di(TimeZone.getDefault().getDisplayName(), DateFormat.getDateTimeInstance().format(now), localTime.format(now)));\n          \n          \n            \n                            return FormValidation.ok(Messages.TimeZoneProperty_current_time_on_server_in_proposed_di(TimeZone.getDefault().getDisplayName(), DateFormat.getDateTimeInstance().format(now), localTime.format(now)));", "author": "oleg-nenashev", "createdAt": "2020-07-12T19:42:50Z", "path": "core/src/main/java/hudson/model/TimeZoneProperty.java", "diffHunk": "@@ -85,6 +90,18 @@ public ListBoxModel doFillTimeZoneNameItems() {\n             }\n             return items;\n         }\n+\n+        public FormValidation doCheckTimeZoneName(@QueryParameter String timeZoneName) {\n+            Date now = new Date();\n+            if (Util.fixEmpty(timeZoneName) == null) {\n+                return FormValidation.ok(Messages.TimeZoneProperty_current_time_in_(TimeZone.getDefault().getDisplayName(), DateFormat.getDateTimeInstance().format(now)));\n+            } else {\n+                DateFormat localTime = DateFormat.getDateTimeInstance();\n+                localTime.setTimeZone(TimeZone.getTimeZone(timeZoneName));\n+                return FormValidation.ok(Messages.TimeZoneProperty_current_time_on_server_in_in_proposed_di(TimeZone.getDefault().getDisplayName(), DateFormat.getDateTimeInstance().format(now), localTime.format(now)));", "originalCommit": "6d6129d6984ea8f6f90a5ecf037f7a7910213665", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}