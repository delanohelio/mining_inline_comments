{"pr_number": 4518, "pr_title": "[JENKINS-61203] - Allow users with system read permission to view the Manage Plugins configuration", "pr_createdAt": "2020-02-23T08:49:24Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4518", "timeline": [{"oid": "9c21870ee829d364bf3d5cc3f424a0c993426870", "url": "https://github.com/jenkinsci/jenkins/commit/9c21870ee829d364bf3d5cc3f424a0c993426870", "message": "JEP-224 System reader - Plugin Manager", "committedDate": "2020-02-23T08:42:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk4NDYwMg==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r382984602", "bodyText": "I can't see any reason for a permission check here, (and manage can't see this view anyway)", "author": "timja", "createdAt": "2020-02-23T08:50:24Z", "path": "core/src/main/resources/hudson/PluginManager/sidepanel.groovy", "diffHunk": "@@ -28,7 +28,7 @@ l.header()\n l.side_panel {\n     l.tasks {\n         l.task(icon:\"icon-up icon-md\", href:rootURL+'/', title:_(\"Back to Dashboard\"))\n-        l.task(icon:\"icon-gear2 icon-md\", href:\"${rootURL}/manage\", title:_(\"Manage Jenkins\"), permission:app.MANAGE, it:app)\n+        l.task(icon:\"icon-gear2 icon-md\", href:\"${rootURL}/manage\", title:_(\"Manage Jenkins\"))", "originalCommit": "9c21870ee829d364bf3d5cc3f424a0c993426870", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUyNjI2NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385526265", "bodyText": "The only issue is that it will become available to any user, and hence it will pollute UI for non-admin users", "author": "oleg-nenashev", "createdAt": "2020-02-28T06:27:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk4NDYwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUzNzE0OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385537149", "bodyText": "But non admin users can\u2019t get here, this is under plugin manager?", "author": "timja", "createdAt": "2020-02-28T07:05:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk4NDYwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA3NjI1MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r405076250", "bodyText": "This is a view fragment which won't be accessible thanks to JEP-220.", "author": "jvz", "createdAt": "2020-04-07T20:00:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk4NDYwMg=="}], "type": "inlineReview"}, {"oid": "7b6bb8fe1094f1e3e8c81ce84c9ab4ddc46336dc", "url": "https://github.com/jenkinsci/jenkins/commit/7b6bb8fe1094f1e3e8c81ce84c9ab4ddc46336dc", "message": "Merge branch 'master' into system-read-pluginManager", "committedDate": "2020-02-24T16:44:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU2MzY2NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r383563665", "bodyText": "I think this one deserves an lts-candidate maybe?", "author": "daniel-beck", "createdAt": "2020-02-24T22:55:28Z", "path": "core/src/main/resources/lib/form/textarea.jelly", "diffHunk": "@@ -98,12 +98,12 @@ THE SOFTWARE.\n         <j:if test=\"${value != null &amp;&amp; !empty(value.toString()) &amp;&amp; (value.toString().codePointAt(0) == 10 || value.toString().codePointAt(0) == 13)}\"><j:whitespace>&#10;</j:whitespace></j:if>\n         <st:out value=\"${value}\" />\n       </textarea>\n+    <j:if test=\"${customizedFields != null and attrs.field != null and value != default}\">\n+      <j:mute>${customizedFields.add(name)}</j:mute>\n+    </j:if>\n+    <!-- resize handle -->\n+    <div class=\"textarea-handle\"/>\n   </f:possibleReadOnlyField>\n-  <j:if test=\"${customizedFields != null and attrs.field != null and value != default}\">\n-    <j:mute>${customizedFields.add(name)}</j:mute>\n-  </j:if>\n-  <!-- resize handle -->\n-  <div class=\"textarea-handle\"/>", "originalCommit": "7b6bb8fe1094f1e3e8c81ce84c9ab4ddc46336dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUyNjM5NA==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385526394", "bodyText": "Separate PR/bug please, then", "author": "oleg-nenashev", "createdAt": "2020-02-28T06:28:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU2MzY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY0NDMwMA==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385644300", "bodyText": "it's a minor fix that looked especially bad here without the fix, can create another PR if needed but not sure if worth it.", "author": "timja", "createdAt": "2020-02-28T11:24:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU2MzY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA3OTAzNA==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r386079034", "bodyText": "Just look at any ExtendedRead job configuration with a shell build step.", "author": "daniel-beck", "createdAt": "2020-03-01T05:40:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU2MzY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA5MTAzMg==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r386091032", "bodyText": "#4536", "author": "timja", "createdAt": "2020-03-01T09:17:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU2MzY2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzMzYwNw==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385033607", "bodyText": "Why not allowing the previous version? Do you think it's a risk?", "author": "varyvol", "createdAt": "2020-02-27T10:19:32Z", "path": "core/src/main/resources/hudson/PluginManager/installed.jelly", "diffHunk": "@@ -66,15 +74,18 @@ THE SOFTWARE.\n                 <th width=\"32\" tooltip=\"${%Uncheck to disable the plugin}\">${%Enabled}</th>\n                 <th initialSortDir=\"down\">${%Name}</th>\n                 <th width=\"1\">${%Version}</th>\n-                <th width=\"1\">${%Previously installed version}</th>\n-                <th width=\"1\">${%Uninstall}</th>\n+                <l:isAdmin>\n+                  <th width=\"1\">${%Previously installed version}</th>", "originalCommit": "7b6bb8fe1094f1e3e8c81ce84c9ab4ddc46336dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA2MjY5MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385062690", "bodyText": "it's just a button that says 'Downgrade to previous version', not useful to read only users", "author": "timja", "createdAt": "2020-02-27T11:14:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzMzYwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA2Mzk3Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385063973", "bodyText": "The only UI element shown there is the \"Downgrade\" button, and the permission doesn't allow taking action, so there wouldn't be a UI.\nAn argument can be made to show it in text, but the question is how useful that would be \u2013 it's not really part of configuration, after all.", "author": "daniel-beck", "createdAt": "2020-02-27T11:17:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzMzYwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA4MjQzMQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385082431", "bodyText": "I had in my mind this was only text. Fair enough!", "author": "varyvol", "createdAt": "2020-02-27T11:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzMzYwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzOTU4Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385039586", "bodyText": "I'm curious: why the change to the less? Something functionality related or you just considered it's a better place?", "author": "varyvol", "createdAt": "2020-02-27T10:30:11Z", "path": "war/src/main/less/base/style.less", "diffHunk": "@@ -392,6 +392,11 @@ pre.console {\n   font-size: 12pt;\n }\n \n+.jenkins-not-applicable {", "originalCommit": "7b6bb8fe1094f1e3e8c81ce84c9ab4ddc46336dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA2MjUzNg==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385062536", "bodyText": "It didn't seem to work without moving it. Possibly to do with the dev-mode setup locally but it wasn't getting loaded", "author": "timja", "createdAt": "2020-02-27T11:14:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzOTU4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUyNTY2OA==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385525668", "bodyText": "Not sure about that. It is not a read-only operation", "author": "oleg-nenashev", "createdAt": "2020-02-28T06:24:56Z", "path": "core/src/main/java/hudson/PluginManager.java", "diffHunk": "@@ -1703,7 +1703,7 @@ public HttpResponse doUploadPlugin(StaplerRequest req) throws IOException, Servl\n \n     @Restricted(NoExternalUse.class)\n     @RequirePOST public HttpResponse doCheckUpdatesServer() throws IOException {\n-        Jenkins.get().checkPermission(Jenkins.ADMINISTER);\n+        Jenkins.get().checkPermission(Jenkins.SYSTEM_READ);", "originalCommit": "7b6bb8fe1094f1e3e8c81ce84c9ab4ddc46336dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUzNjg5OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385536899", "bodyText": "This was called out in the previous PR and dB was fine with it, it\u2019s updating a cache, not updating configuration or installing something", "author": "timja", "createdAt": "2020-02-28T07:04:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUyNTY2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTczNzI5MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385737290", "bodyText": "Pretty sure this is only used during the setup wizard, so doesn't need the permission check changed.", "author": "daniel-beck", "createdAt": "2020-02-28T14:51:46Z", "path": "core/src/main/java/hudson/PluginManager.java", "diffHunk": "@@ -1347,7 +1347,7 @@ public void stop() {\n      */\n     @Restricted(DoNotUse.class) // WebOnly\n     public HttpResponse doPlugins() {\n-        Jenkins.get().checkPermission(Jenkins.ADMINISTER);\n+        Jenkins.get().checkPermission(Jenkins.SYSTEM_READ);", "originalCommit": "7b6bb8fe1094f1e3e8c81ce84c9ab4ddc46336dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTczODc3NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385738775", "bodyText": "I think so too\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Jenkins.get().checkPermission(Jenkins.SYSTEM_READ);\n          \n          \n            \n                    Jenkins.get().checkPermission(Jenkins.ADMINISTER);", "author": "timja", "createdAt": "2020-02-28T14:54:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTczNzI5MA=="}], "type": "inlineReview"}, {"oid": "98fabe42c12a6a42a67e3d66ece17c5fa62a50fd", "url": "https://github.com/jenkinsci/jenkins/commit/98fabe42c12a6a42a67e3d66ece17c5fa62a50fd", "message": "Update core/src/main/java/hudson/PluginManager.java", "committedDate": "2020-02-28T14:54:39Z", "type": "commit"}, {"oid": "bf1a6de01847a92ce629d02672fad466184f2f73", "url": "https://github.com/jenkinsci/jenkins/commit/bf1a6de01847a92ce629d02672fad466184f2f73", "message": "Add required permissions to the docs", "committedDate": "2020-02-28T16:45:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg0NjgwMA==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385846800", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <p>Permission required: <code>Jenkins.ADMINISTER</code></p>\n          \n          \n            \n              <p>Permission required: <code>Overall/Administer</code></p>", "author": "daniel-beck", "createdAt": "2020-02-28T18:15:37Z", "path": "core/src/main/resources/hudson/PluginManager/_api.jelly", "diffHunk": "@@ -25,11 +25,13 @@ THE SOFTWARE.\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n   <h2>Uploading a plugin</h2>\n+  <p>Permission required: <code>Jenkins.ADMINISTER</code></p>", "originalCommit": "bf1a6de01847a92ce629d02672fad466184f2f73", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg0Njg0MQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r385846841", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <p>Permission required: <code>Jenkins.ADMINISTER</code></p>\n          \n          \n            \n              <p>Permission required: <code>Overall/Administer</code></p>", "author": "daniel-beck", "createdAt": "2020-02-28T18:15:43Z", "path": "core/src/main/resources/hudson/PluginManager/_api.jelly", "diffHunk": "@@ -25,11 +25,13 @@ THE SOFTWARE.\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n   <h2>Uploading a plugin</h2>\n+  <p>Permission required: <code>Jenkins.ADMINISTER</code></p>\n   <p>\n     You can upload a plugin from HTTP client by POST to <a href=\"../uploadPlugin\">this URL</a> with <a href=\"http://tools.ietf.org/html/rfc2388\">multipart/form-data</a> MIME type.\n   </p>\n \n   <h2>Making sure all the needed plugins are installed</h2>\n+  <p>Permission required: <code>Jenkins.ADMINISTER</code></p>", "originalCommit": "bf1a6de01847a92ce629d02672fad466184f2f73", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "83a7160d7636c821eb43199f7dbeb431d13db1d0", "url": "https://github.com/jenkinsci/jenkins/commit/83a7160d7636c821eb43199f7dbeb431d13db1d0", "message": "Apply suggestions from code review\n\nCo-Authored-By: Daniel Beck <1831569+daniel-beck@users.noreply.github.com>", "committedDate": "2020-02-28T18:23:36Z", "type": "commit"}, {"oid": "56cbe9765b3554092f29433baad90598312fea0b", "url": "https://github.com/jenkinsci/jenkins/commit/56cbe9765b3554092f29433baad90598312fea0b", "message": "Merge branch 'master' into system-read-pluginManager", "committedDate": "2020-03-11T08:17:24Z", "type": "commit"}, {"oid": "007a47cf718127b872447d180b9bc14036e2986c", "url": "https://github.com/jenkinsci/jenkins/commit/007a47cf718127b872447d180b9bc14036e2986c", "message": "Merge branch 'master' into system-read-pluginManager", "committedDate": "2020-03-14T11:13:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYyOTMwNg==", "url": "https://github.com/jenkinsci/jenkins/pull/4518#discussion_r392629306", "bodyText": "This link will be displayed, but fail.\n(It would make sense for updateCenter to be made available with this change, so that SystemReaders can see the status of plugin installation jobs. Otherwise they get shaded cells but have no access to details.)", "author": "daniel-beck", "createdAt": "2020-03-15T00:06:00Z", "path": "core/src/main/resources/hudson/PluginManager/sidepanel.groovy", "diffHunk": "@@ -28,7 +28,7 @@ l.header()\n l.side_panel {\n     l.tasks {\n         l.task(icon:\"icon-up icon-md\", href:rootURL+'/', title:_(\"Back to Dashboard\"))\n-        l.task(icon:\"icon-gear2 icon-md\", href:\"${rootURL}/manage\", title:_(\"Manage Jenkins\"), permission:app.MANAGE, it:app)\n+        l.task(icon:\"icon-gear2 icon-md\", href:\"${rootURL}/manage\", title:_(\"Manage Jenkins\"))\n         if (!app.updateCenter.jobs.isEmpty()) {\n             l.task(icon:\"icon-plugin icon-md\", href:\"${rootURL}/updateCenter/\", title:_(\"Update Center\"))", "originalCommit": "007a47cf718127b872447d180b9bc14036e2986c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2c06f83100a36ed267121737b1389b15d8b9129b", "url": "https://github.com/jenkinsci/jenkins/commit/2c06f83100a36ed267121737b1389b15d8b9129b", "message": "Merge branch 'master' into system-read-pluginManager", "committedDate": "2020-03-15T09:15:23Z", "type": "commit"}, {"oid": "cdfd805b19cca9e3cf94488bf98447b835cd4cb0", "url": "https://github.com/jenkinsci/jenkins/commit/cdfd805b19cca9e3cf94488bf98447b835cd4cb0", "message": "Allow SYSTEM_READ access to update center", "committedDate": "2020-03-15T10:20:17Z", "type": "commit"}, {"oid": "dc7d2e00f2d298b108461a229a4305f2cd61296e", "url": "https://github.com/jenkinsci/jenkins/commit/dc7d2e00f2d298b108461a229a4305f2cd61296e", "message": "Merge branch 'master' into system-read-pluginManager", "committedDate": "2020-03-21T09:55:32Z", "type": "commit"}, {"oid": "0374e0b4a93c4c65a0b11789a4ed9b2a703ae152", "url": "https://github.com/jenkinsci/jenkins/commit/0374e0b4a93c4c65a0b11789a4ed9b2a703ae152", "message": "Merge branch 'master' into system-read-pluginManager", "committedDate": "2020-03-31T06:45:35Z", "type": "commit"}, {"oid": "37c84300017778ca6b52f176d62091ab8f81874e", "url": "https://github.com/jenkinsci/jenkins/commit/37c84300017778ca6b52f176d62091ab8f81874e", "message": "Add permission check", "committedDate": "2020-03-31T06:48:53Z", "type": "commit"}, {"oid": "ed347a7b188113b5bc7a054c58c9969082719d09", "url": "https://github.com/jenkinsci/jenkins/commit/ed347a7b188113b5bc7a054c58c9969082719d09", "message": "Merge branch 'master' into system-read-pluginManager", "committedDate": "2020-04-07T21:01:15Z", "type": "commit"}, {"oid": "d609a44b48b12f79fa96c3dbbfc7b1f4e35472fb", "url": "https://github.com/jenkinsci/jenkins/commit/d609a44b48b12f79fa96c3dbbfc7b1f4e35472fb", "message": "Fix non null annotation", "committedDate": "2020-04-07T21:01:59Z", "type": "commit"}, {"oid": "70be258725d5ee4a8b6db9b1b1ee4f4eba2ea2db", "url": "https://github.com/jenkinsci/jenkins/commit/70be258725d5ee4a8b6db9b1b1ee4f4eba2ea2db", "message": "Use correct annotation", "committedDate": "2020-04-08T07:34:41Z", "type": "commit"}]}