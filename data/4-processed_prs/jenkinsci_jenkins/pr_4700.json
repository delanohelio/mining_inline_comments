{"pr_number": 4700, "pr_title": "[JENKINS-61973] Restyle sidebar tasks", "pr_createdAt": "2020-04-30T11:16:39Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4700", "timeline": [{"oid": "101268901767de83f6c41c335c2e698922472169", "url": "https://github.com/jenkinsci/jenkins/commit/101268901767de83f6c41c335c2e698922472169", "message": "Refactor sidebar tasks and change sidebar links", "committedDate": "2020-04-30T09:29:43Z", "type": "commit"}, {"oid": "88600a1a2df55b709a95b7d07ba0c0677869ffc5", "url": "https://github.com/jenkinsci/jenkins/commit/88600a1a2df55b709a95b7d07ba0c0677869ffc5", "message": "Revamp sidebar tasks\n\n- Refactored and simplified the <l:task> tag. No tasks have only 1 hyperlink that contains both labels and icon\n    - Link icons now have null alt text because they will always have a label with them\n- Interactive states and current page indicator now have a better and more noticeable style", "committedDate": "2020-04-30T11:03:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMjc1MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r418432750", "bodyText": "what's this newDomain check for?", "author": "timja", "createdAt": "2020-05-01T06:22:16Z", "path": "core/src/main/resources/lib/layout/task.jelly", "diffHunk": "@@ -79,19 +79,20 @@ THE SOFTWARE.\n     The semantics is that when one of the nested <task> matches, the parent is also considered as a match\n     and thus gets a highlight.\n   -->\n-  <j:set var=\"match\" value=\"${h.hyperlinkMatchesCurrentPage(href)}\" />\n+  <j:set var=\"isCurrent\" value=\"${h.hyperlinkMatchesCurrentPage(href)}\" />\n   <j:scope>\n-    <j:set var=\"taskMatching\" value=\"${context.parent}\"/>\n+    <j:set var=\"parentTagContext\" value=\"${context.parent}\"/>\n     <d:invokeBody />\n   </j:scope>\n \n-  <j:if test=\"${attrs.permission==null or h.hasPermission(it,attrs.permission)}\">\n+  <j:if test=\"${href != 'newDomain' and attrs.permission==null or h.hasPermission(it,attrs.permission)}\">", "originalCommit": "88600a1a2df55b709a95b7d07ba0c0677869ffc5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ2NDc2MQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r418464761", "bodyText": "oops I think that's dev code that I forgot to remove, it should be fixed now", "author": "fqueiruga", "createdAt": "2020-05-01T08:43:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMjc1MA=="}], "type": "inlineReview"}, {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5", "url": "https://github.com/jenkinsci/jenkins/commit/604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5", "message": "Remove debug code", "committedDate": "2020-05-01T08:42:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NDYxMA==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r418494610", "bodyText": "It is unclear what this comment means, could you rephrase? How is Git involved in removing something?", "author": "daniel-beck", "createdAt": "2020-05-01T10:36:55Z", "path": "war/src/main/less/modules/sidebar-tasks.less", "diffHunk": "@@ -0,0 +1,128 @@\n+@import '../abstracts/colors.less';\n+@import '../abstracts/font.less';\n+\n+#tasks {\n+  margin-bottom: 20px;\n+  display: inline-block;\n+\n+  // TODO: investigate this on the git history to see if removing it will\n+  // cause a problem", "originalCommit": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5ODI0Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419298247", "bodyText": "That was more of a reminder that I forgot to remove. The max task width is limited to 325px and I'm not sure what caused that limitation.", "author": "fqueiruga", "createdAt": "2020-05-04T08:59:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NDYxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NDY4MQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r418494681", "bodyText": "It's called sidepanel in the rest of Jenkins, should be renamed for consistency.", "author": "daniel-beck", "createdAt": "2020-05-01T10:37:22Z", "path": "war/src/main/less/base-styles-v2.less", "diffHunk": "@@ -26,4 +26,5 @@ html {\n @import './modules/buttons.less';\n @import './modules/page-header.less';\n @import './modules/page-footer.less';\n+@import './modules/sidebar-tasks.less';", "originalCommit": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5ODM0Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419298343", "bodyText": "Makes sense, done", "author": "fqueiruga", "createdAt": "2020-05-04T08:59:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NDY4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NDgxNw==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r418494817", "bodyText": "Can this be un-inlined so Wadeck doesn't have to followup here? (Assuming it's straightforward enough to do.)", "author": "daniel-beck", "createdAt": "2020-05-01T10:37:54Z", "path": "core/src/main/resources/lib/layout/task.jelly", "diffHunk": "@@ -119,106 +120,60 @@ THE SOFTWARE.\n       <j:set var=\"icon\" value=\"${rootURL}${icon.startsWith('/images/') || icon.startsWith('/plugin/') ? h.resourcePath : ''}${icon}\"/>\n       <j:when test=\"${enabled==false}\">\n         <div class=\"task disabled\">\n-          <span>\n+          <span class=\"task-link-wrapper\">\n+            <span class=\"task-disabled-link\">\n+              <span class=\"task-icon-link\">\n+                <l:icon alt=\"\" class=\"${iconMetadata != null ? iconMetadata.classSpec : ''}\" src=\"${iconMetadata ?: icon}\" />\n+              </span>\n+              <span class=\"task-link-text\">${title}</span>\n+            </span>\n+          </span>\n+        </div>\n+      </j:when>\n+\n+      <j:otherwise>\n+        <div class=\"task \">\n+          <span class=\"task-link-wrapper ${watch ? 'task--active' : ''}\">\n             <j:choose>\n               <j:when test=\"${iconMetadata != null}\">\n-                <l:icon class=\"${iconMetadata.classSpec}\" style=\"width: 24px; height: 24px; margin: 2px;\" />\n+                ${taskTags!=null and attrs.contextMenu!='false' ? taskTags.add(href, iconMetadata.getQualifiedUrl(context), title, post == 'true', requiresConfirmation == 'true') : null}\n               </j:when>\n               <j:otherwise>\n-                <l:icon alt=\"\" src=\"${icon}\" style=\"width: 24px; height: 24px; margin: 2px;\" />\n+                ${taskTags!=null and attrs.contextMenu!='false' ? taskTags.add(href, icon, title, post == 'true', requiresConfirmation == 'true') : null}\n               </j:otherwise>\n             </j:choose>\n-          </span>\n-          <st:nbsp />\n \n-          <span>\n+            <j:set var=\"id\" value=\"${h.generateId()}\"/>\n+            <j:if test=\"${attrs.onclick == null and post and not requiresConfirmation}\">\n+                <script>\n+                    function postRequest_${id}(a) {\n+                        new Ajax.Request(a.href);\n+                        hoverNotification('${%Done.}', a.parentNode);\n+                        return false;\n+                    }\n+                </script>", "originalCommit": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5Njc0Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419296743", "bodyText": "I'd rather keep this PR just to UI improvements. If you think it's needed maybe @Wadeck can advise how to go about it.", "author": "fqueiruga", "createdAt": "2020-05-04T08:56:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NDgxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5MjY1NA==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419292654", "bodyText": "Shouldn't this be in the colors file?", "author": "varyvol", "createdAt": "2020-05-04T08:48:43Z", "path": "war/src/main/less/modules/sidebar-tasks.less", "diffHunk": "@@ -0,0 +1,128 @@\n+@import '../abstracts/colors.less';\n+@import '../abstracts/font.less';\n+\n+#tasks {\n+  margin-bottom: 20px;\n+  display: inline-block;\n+\n+  // TODO: investigate this on the git history to see if removing it will\n+  // cause a problem\n+  max-width: 325px;\n+\n+  // The task list is touching the side of the screen. This should be removed\n+  // once .side-panel loses it's padding.\n+  width: calc(100% + 15px);\n+  margin-left: -15px;\n+}\n+\n+#tasks .task {\n+  display: flex;\n+  align-items: center;\n+  flex-wrap: wrap;\n+  overflow: hidden;\n+  white-space: nowrap;\n+  text-overflow: ellipsis;\n+  position: relative;\n+  font-size: @font-size-sm;\n+  font-weight: 500;\n+}\n+.task.disabled {\n+  opacity: 0.5;\n+  background-color: transparent;\n+}\n+\n+.task-link-wrapper {\n+  display: flex;\n+  align-items: center;\n+  width: 100%;\n+  padding: 2px 0;\n+}\n+\n+.task-link,\n+.task-disabled-link {\n+  display: inline-flex;\n+  flex: 1;\n+  align-items: center;\n+  padding: 0.5rem 0 0.5rem 1.25rem;\n+  max-width: 100%;\n+}\n+.task-link:link,\n+.task-link:visited {\n+  color: @text-color;\n+  text-decoration: none;\n+\n+  &:hover,\n+  &:focus {\n+    background-color: #F8F8F8;", "originalCommit": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5NjA4Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419296087", "bodyText": "TBH yes, but I have yet to figure out how all greys fill in the colour palette. I'm waiting until I have a better idea of the greyscale before extracting them to variables. I can extract them now if you think it's needed.", "author": "fqueiruga", "createdAt": "2020-05-04T08:55:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5MjY1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5NzExNw==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419297117", "bodyText": "No problem, extract them when you have the full idea.", "author": "varyvol", "createdAt": "2020-05-04T08:57:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5MjY1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5MzE3Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419293176", "bodyText": "Ditto.", "author": "varyvol", "createdAt": "2020-05-04T08:49:31Z", "path": "war/src/main/less/modules/sidebar-tasks.less", "diffHunk": "@@ -0,0 +1,128 @@\n+@import '../abstracts/colors.less';\n+@import '../abstracts/font.less';\n+\n+#tasks {\n+  margin-bottom: 20px;\n+  display: inline-block;\n+\n+  // TODO: investigate this on the git history to see if removing it will\n+  // cause a problem\n+  max-width: 325px;\n+\n+  // The task list is touching the side of the screen. This should be removed\n+  // once .side-panel loses it's padding.\n+  width: calc(100% + 15px);\n+  margin-left: -15px;\n+}\n+\n+#tasks .task {\n+  display: flex;\n+  align-items: center;\n+  flex-wrap: wrap;\n+  overflow: hidden;\n+  white-space: nowrap;\n+  text-overflow: ellipsis;\n+  position: relative;\n+  font-size: @font-size-sm;\n+  font-weight: 500;\n+}\n+.task.disabled {\n+  opacity: 0.5;\n+  background-color: transparent;\n+}\n+\n+.task-link-wrapper {\n+  display: flex;\n+  align-items: center;\n+  width: 100%;\n+  padding: 2px 0;\n+}\n+\n+.task-link,\n+.task-disabled-link {\n+  display: inline-flex;\n+  flex: 1;\n+  align-items: center;\n+  padding: 0.5rem 0 0.5rem 1.25rem;\n+  max-width: 100%;\n+}\n+.task-link:link,\n+.task-link:visited {\n+  color: @text-color;\n+  text-decoration: none;\n+\n+  &:hover,\n+  &:focus {\n+    background-color: #F8F8F8;\n+  }\n+\n+  &:active {\n+    background-color: #EAEFF2;\n+  }\n+\n+  &:focus {\n+    outline: 0;\n+    // Use a box-shadow instead of an outline or a border because the alternatives\n+    // are hidden behind the parent container\n+    box-shadow: inset 0 0 0 3px @focus;\n+  }\n+}\n+.task-link--active {\n+  background-color: #EAEFF2;\n+  position: relative;\n+\n+  &:before {\n+    position: absolute;\n+    left: 0;\n+    height: 100%;\n+    content: '';\n+    border-left: 4px solid @primary;\n+  }\n+}\n+.task-link--active:link,\n+.task-link--active:visited {\n+  &:hover,\n+  &:focus {\n+    background-color: #EAEFF2;\n+  }\n+}\n+\n+// Target only icons withink task link in order to keep backwards compatibility\n+.task .task-icon-link {\n+  display: inline-block;\n+  margin: 0;\n+  margin-right: 0.5rem;\n+}\n+// Reset the margin for the icon links\n+.task .task-icon-link img,\n+.task img.task-icon-link {\n+  margin: 0;\n+  // Dimensions have !important to override inline styles set by <l:icon>\n+  height: 1.5rem !important;\n+  width: 1.5rem !important;\n+}\n+\n+.task-link-text {\n+  overflow: hidden;\n+  white-space: nowrap;\n+  text-overflow: ellipsis;\n+  display: inline-block;\n+}\n+\n+.subtasks {\n+  padding-left: 1.25rem;\n+  width: 100%;\n+}\n+.subtasks .task {\n+  &:first-of-type {\n+    border-top: 2px solid #EAEFF2;", "originalCommit": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5NjExNw==", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419296117", "bodyText": "See above", "author": "fqueiruga", "createdAt": "2020-05-04T08:55:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5MzE3Ng=="}], "type": "inlineReview"}, {"oid": "413bb8a98d9e61fbc050ebe40f242ba38c920cd2", "url": "https://github.com/jenkinsci/jenkins/commit/413bb8a98d9e61fbc050ebe40f242ba38c920cd2", "message": "Rename css module", "committedDate": "2020-05-04T08:58:09Z", "type": "commit"}, {"oid": "9421db250e97351e3b6585aa3f06dd9c65b1c35b", "url": "https://github.com/jenkinsci/jenkins/commit/9421db250e97351e3b6585aa3f06dd9c65b1c35b", "message": "Rework layout so that body is a flex container\n\n- This enables both sidepanel and main panel to stretch vertically till the bottom of the page\n- The footer is properly positioned and now longer uses a position: absolute hack", "committedDate": "2020-05-05T15:05:37Z", "type": "commit"}, {"oid": "c019594097f81e94146c4a0e11e9690d95ac0ff3", "url": "https://github.com/jenkinsci/jenkins/commit/c019594097f81e94146c4a0e11e9690d95ac0ff3", "message": "Adds a border to the side panel", "committedDate": "2020-05-05T15:11:20Z", "type": "commit"}, {"oid": "ba3e274c684049cce410ad8141d17f9a0a39e14a", "url": "https://github.com/jenkinsci/jenkins/commit/ba3e274c684049cce410ad8141d17f9a0a39e14a", "message": "Merge branch 'master' into jenkins-61973_restyle-sidebar-tasks", "committedDate": "2020-05-05T15:21:43Z", "type": "commit"}]}