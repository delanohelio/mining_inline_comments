{"pr_number": 4824, "pr_title": "JENKINS-41805 Cleanup workspace suffixes", "pr_createdAt": "2020-06-29T09:46:09Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4824", "timeline": [{"oid": "28daa7f9a34a7e20dcfa20236071bcfcdb120449", "url": "https://github.com/jenkinsci/jenkins/commit/28daa7f9a34a7e20dcfa20236071bcfcdb120449", "message": "JENKINS-41805 Cleanup workspace suffixes", "committedDate": "2020-06-29T09:26:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4MTQ0OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4824#discussion_r446881449", "bodyText": "this change is covered by https://github.com/jenkinsci/jenkins/blob/master/test/src/test/java/hudson/model/WorkspaceCleanupThreadTest.java#L181", "author": "timja", "createdAt": "2020-06-29T09:48:02Z", "path": "core/src/main/java/hudson/model/WorkspaceCleanupThread.java", "diffHunk": "@@ -89,11 +89,8 @@ public static void invoke() {\n                 if (check) {\n                     listener.getLogger().println(\"Deleting \" + ws + \" on \" + node.getDisplayName());\n                     try {\n+                        ws.deleteSuffixesRecursive();", "originalCommit": "28daa7f9a34a7e20dcfa20236071bcfcdb120449", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI5MjIyOQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4824#discussion_r447292229", "bodyText": "Should the main folder be deleted first? This changes the behaviour ever so slightly", "author": "res0nance", "createdAt": "2020-06-29T22:22:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4MTQ0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzNzMyMw==", "url": "https://github.com/jenkinsci/jenkins/pull/4824#discussion_r447437323", "bodyText": "I don\u2019t think so, the main folder is used to resolve the suffixed folders, if the task was interrupted part way through and the main folder was deleted but not the suffixes the suffixes would never get deleted\nBut it doesn\u2019t really matter much", "author": "timja", "createdAt": "2020-06-30T06:23:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4MTQ0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4MTc1OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4824#discussion_r446881759", "bodyText": "no longer needed as it's a suffix and will be automatically deleted, test proves it still works https://github.com/jenkinsci/jenkins/blob/master/test/src/test/java/hudson/model/WorkspaceCleanupThreadTest.java#L181", "author": "timja", "createdAt": "2020-06-29T09:48:43Z", "path": "core/src/main/java/hudson/model/WorkspaceCleanupThread.java", "diffHunk": "@@ -89,11 +89,8 @@ public static void invoke() {\n                 if (check) {\n                     listener.getLogger().println(\"Deleting \" + ws + \" on \" + node.getDisplayName());\n                     try {\n+                        ws.deleteSuffixesRecursive();\n                         ws.deleteRecursive();\n-                        FilePath tempDir = WorkspaceList.tempDir(ws);", "originalCommit": "28daa7f9a34a7e20dcfa20236071bcfcdb120449", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4NTQyMA==", "url": "https://github.com/jenkinsci/jenkins/pull/4824#discussion_r446885420", "bodyText": "used here: https://github.com/jenkinsci/workflow-cps-global-lib-plugin/blob/3e5a08f079fc371119fcf1b76a60369724c2eb70/src/main/java/org/jenkinsci/plugins/workflow/libs/SCMSourceRetriever.java#L173, would be nice if it's an API so that everything uses the same separator.", "author": "timja", "createdAt": "2020-06-29T11:01:46Z", "path": "core/src/main/java/hudson/slaves/WorkspaceList.java", "diffHunk": "@@ -312,6 +312,7 @@ public static FilePath tempDir(FilePath ws) {\n \n     /**\n      * The token that combines the project name and unique number to create unique workspace directory.\n+     * @since TODO\n      */\n-    private static final String COMBINATOR = SystemProperties.getString(WorkspaceList.class.getName(),\"@\");\n+    public static final String COMBINATOR = SystemProperties.getString(WorkspaceList.class.getName(),\"@\");", "originalCommit": "28daa7f9a34a7e20dcfa20236071bcfcdb120449", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4NDgyNQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4824#discussion_r446984825", "bodyText": "Also used here in durable-task and here in workflow-cps (this is where the @script directories come from), and probably a few other places as well.", "author": "dwnusbaum", "createdAt": "2020-06-29T13:47:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4NTQyMA=="}], "type": "inlineReview"}, {"oid": "fa59039c383d5376586ed0d3050a282b30ea1ace", "url": "https://github.com/jenkinsci/jenkins/commit/fa59039c383d5376586ed0d3050a282b30ea1ace", "message": "Fix syntax", "committedDate": "2020-07-01T07:30:05Z", "type": "commit"}, {"oid": "b79b7f30387f491e4bbce958b77207b6857e1118", "url": "https://github.com/jenkinsci/jenkins/commit/b79b7f30387f491e4bbce958b77207b6857e1118", "message": "Fix whitespace", "committedDate": "2020-07-01T08:28:38Z", "type": "commit"}]}