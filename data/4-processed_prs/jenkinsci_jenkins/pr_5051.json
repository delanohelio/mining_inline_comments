{"pr_number": 5051, "pr_title": "JENKINS-64196 Move PluginManager available page to client side", "pr_createdAt": "2020-11-09T19:46:30Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/5051", "timeline": [{"oid": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "url": "https://github.com/jenkinsci/jenkins/commit/8e217db996c3504e23e6f0ccdffa3f16012ed2be", "message": "Move PluginManager available to client side", "committedDate": "2020-11-09T19:33:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA3ODcxOA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r520078718", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Restricted(Beta.class)\n          \n          \n            \n                @Restricted(NoExternalUse.class)", "author": "timja", "createdAt": "2020-11-09T19:50:20Z", "path": "core/src/main/java/hudson/model/UpdateCenter.java", "diffHunk": "@@ -971,6 +976,119 @@ private XmlFile getConfigFile() {\n                                     UpdateCenter.class.getName()+\".xml\"));\n     }\n \n+    @Restricted(NoExternalUse.class)\n+    public static boolean isNonMetaLabel(String label) {\n+        return !(\"adopt-this-plugin\".equals(label) || \"deprecated\".equals(label));\n+    }\n+\n+    @Restricted(NoExternalUse.class)\n+    public static boolean hasAdoptThisPluginLabel(UpdateSite.Plugin plugin) {\n+        final String[] categories = plugin.categories;\n+        if (categories == null) {\n+            return false;\n+        }\n+        return Arrays.asList(categories).contains(\"adopt-this-plugin\");\n+    }\n+\n+    @Restricted(NoExternalUse.class)\n+    public static boolean hasLatestVersionNewerThanOffered(UpdateSite.Plugin plugin) {\n+        if (plugin.latest == null) {\n+            return false;\n+        }\n+        return !plugin.latest.equalsIgnoreCase(plugin.version); // we can assume that any defined 'latest' will be newer than the actual offered version\n+    }\n+    \n+    @JavaScriptMethod\n+    @Restricted(Beta.class)", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MDUwNg==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r520080506", "bodyText": "I think I got all of the relevant warnings, some of them are only on the updates page", "author": "timja", "createdAt": "2020-11-09T19:53:36Z", "path": "core/src/main/resources/hudson/PluginManager/_table.js", "diffHunk": "@@ -10,46 +10,214 @@ function checkPluginsWithoutWarnings() {\n \n Behaviour.specify(\"#filter-box\", '_table', 0, function(e) {\n     function applyFilter() {\n-        var filter = e.value.toLowerCase().trim();\n-        var filterParts = filter.split(/ +/).filter (function(word) { return word.length > 0; });\n-        var items = document.getElementsBySelector(\"TR.plugin\");\n-        var anyVisible = false;\n-        for (var i=0; i<items.length; i++) {\n-            if ((filterParts.length < 1 || filter.length < 2) && items[i].hasClassName(\"hidden-by-default\")) {\n-                items[i].addClassName(\"hidden\");\n-                continue;\n-            }\n-            var makeVisible = true;\n-\n-            var content = items[i].innerHTML.toLowerCase();\n-            for (var j = 0; j < filterParts.length; j++) {\n-                var part = filterParts[j];\n-                if (content.indexOf(part) < 0) {\n-                    makeVisible = false;\n-                    break;\n-                }\n-            }\n-            if (makeVisible) {\n-                items[i].removeClassName(\"hidden\");\n-                anyVisible = true;\n+        clearTimeout(debounce);\n+        // debounce reduces number of server side calls while typing\n+        debounce = setTimeout(function() {\n+            var pluginsTable = document.getElementById('plugins');\n+\n+            // only on available tab\n+            if (pluginsTable.dataset.page === 'available') {\n+                view.availablePlugins(e.value.toLowerCase().trim(), 20, function (plugins) {\n+                    var availablePlugins = JSON.parse(plugins.responseObject());\n+\n+                    var tbody = pluginsTable.querySelector('tbody');\n+\n+                    function clearOldResults() {\n+                        if (pluginsTable.dataset.hasadmin !== 'true') {\n+                            tbody.innerHTML = '';\n+                        } else {\n+                            var rows = tbody.querySelectorAll('tr');\n+                            if (rows) {\n+                                rows.forEach(function (row) {\n+                                    var input = row.firstChild.firstChild;\n+                                    if (input.checked !== true) {\n+                                        row.remove();\n+                                    }\n+                                })\n+                            }\n+                        }\n+                    }\n+\n+                    clearOldResults();\n+\n+                    availablePlugins.forEach(function (plugin) {\n+                        var htmlTableRowElement = document.createElement('tr');\n+                        htmlTableRowElement.classList.add('plugin');\n+\n+                        function createCheckBox() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlInputElement = document.createElement('input');\n+                            htmlInputElement.type = 'checkbox';\n+                            htmlInputElement.name = 'plugin.' + plugin.name + '.' + plugin.sourceId;\n+                            htmlTableDataCellElement.append(htmlInputElement);\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                        }\n+\n+                        function createNameEntry() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlDivElement = document.createElement('div');\n+                            var htmlAnchorElement = document.createElement('a');\n+                            htmlAnchorElement.href = plugin.wiki\n+                            htmlAnchorElement.text = plugin.displayName\n+                            htmlAnchorElement.target = '_blank'\n+                            htmlAnchorElement.rel = 'noopener noreferrer'\n+                            htmlDivElement.append(htmlAnchorElement)\n+                            htmlTableDataCellElement.append(htmlDivElement)\n+\n+                            if (plugin.categories) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('plugin-manager__categories');\n+                                plugin.categories.forEach(function (category) {\n+                                    var htmlAnchorElement = document.createElement('a');\n+                                    htmlAnchorElement.href = '?filter=' + category;\n+                                    htmlAnchorElement.classList.add('plugin-manager__category-label')\n+                                    htmlAnchorElement.text = category\n+                                    htmlDivElement.append(htmlAnchorElement)\n+                                })\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                            if (plugin.excerpt) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('excerpt');\n+                                htmlDivElement.innerHTML = plugin.excerpt\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                            \n+                            if (plugin.newerCoreRequired) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.newerCoreRequired\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.newerJavaRequired) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.newerJavaRequired\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.dependenciesNewerJava) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.dependenciesNewerJava\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.unresolvedSecurityWarnings) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerText = plugin.unresolvedSecurityWarnings.text\n+                                var listElement = document.createElement('ul');\n+                                plugin.unresolvedSecurityWarnings.warnings.forEach(function(warning) {\n+                                    var li = document.createElement('li');\n+                                    var htmlAnchorElement = document.createElement('a');\n+                                    htmlAnchorElement.href = warning.url\n+                                    htmlAnchorElement.text = warning.message\n+                                    htmlAnchorElement.target = '_blank'\n+                                    htmlAnchorElement.rel = 'noopener noreferrer'\n+                                    li.append(htmlAnchorElement)\n+                                    listElement.append(li)\n+                                })\n+                                htmlDivElement.append(listElement)\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.deprecated) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-warning');\n+                                htmlDivElement.innerHTML = plugin.deprecated\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.adoptMe) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-warning');\n+                                htmlDivElement.innerHTML = plugin.adoptMe\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.newerVersionAvailableNotOffered) {", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MDg2NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r520080865", "bodyText": "shout if any one knows a more Jenkins' way to do this.\nIt's not very nice, but huge performance gain", "author": "timja", "createdAt": "2020-11-09T19:54:16Z", "path": "core/src/main/resources/hudson/PluginManager/_table.js", "diffHunk": "@@ -10,46 +10,214 @@ function checkPluginsWithoutWarnings() {\n \n Behaviour.specify(\"#filter-box\", '_table', 0, function(e) {\n     function applyFilter() {\n-        var filter = e.value.toLowerCase().trim();\n-        var filterParts = filter.split(/ +/).filter (function(word) { return word.length > 0; });\n-        var items = document.getElementsBySelector(\"TR.plugin\");\n-        var anyVisible = false;\n-        for (var i=0; i<items.length; i++) {\n-            if ((filterParts.length < 1 || filter.length < 2) && items[i].hasClassName(\"hidden-by-default\")) {\n-                items[i].addClassName(\"hidden\");\n-                continue;\n-            }\n-            var makeVisible = true;\n-\n-            var content = items[i].innerHTML.toLowerCase();\n-            for (var j = 0; j < filterParts.length; j++) {\n-                var part = filterParts[j];\n-                if (content.indexOf(part) < 0) {\n-                    makeVisible = false;\n-                    break;\n-                }\n-            }\n-            if (makeVisible) {\n-                items[i].removeClassName(\"hidden\");\n-                anyVisible = true;\n+        clearTimeout(debounce);\n+        // debounce reduces number of server side calls while typing\n+        debounce = setTimeout(function() {\n+            var pluginsTable = document.getElementById('plugins');\n+\n+            // only on available tab\n+            if (pluginsTable.dataset.page === 'available') {\n+                view.availablePlugins(e.value.toLowerCase().trim(), 20, function (plugins) {\n+                    var availablePlugins = JSON.parse(plugins.responseObject());\n+\n+                    var tbody = pluginsTable.querySelector('tbody');\n+\n+                    function clearOldResults() {\n+                        if (pluginsTable.dataset.hasadmin !== 'true') {\n+                            tbody.innerHTML = '';\n+                        } else {\n+                            var rows = tbody.querySelectorAll('tr');\n+                            if (rows) {\n+                                rows.forEach(function (row) {\n+                                    var input = row.firstChild.firstChild;\n+                                    if (input.checked !== true) {\n+                                        row.remove();\n+                                    }\n+                                })\n+                            }\n+                        }\n+                    }\n+\n+                    clearOldResults();\n+\n+                    availablePlugins.forEach(function (plugin) {\n+                        var htmlTableRowElement = document.createElement('tr');\n+                        htmlTableRowElement.classList.add('plugin');\n+\n+                        function createCheckBox() {", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MjE2MA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r520082160", "bodyText": "this code is just moved and not used on the available page", "author": "timja", "createdAt": "2020-11-09T19:56:15Z", "path": "core/src/main/resources/hudson/PluginManager/_table.js", "diffHunk": "@@ -10,46 +10,214 @@ function checkPluginsWithoutWarnings() {\n \n Behaviour.specify(\"#filter-box\", '_table', 0, function(e) {\n     function applyFilter() {\n-        var filter = e.value.toLowerCase().trim();\n-        var filterParts = filter.split(/ +/).filter (function(word) { return word.length > 0; });\n-        var items = document.getElementsBySelector(\"TR.plugin\");\n-        var anyVisible = false;\n-        for (var i=0; i<items.length; i++) {\n-            if ((filterParts.length < 1 || filter.length < 2) && items[i].hasClassName(\"hidden-by-default\")) {\n-                items[i].addClassName(\"hidden\");\n-                continue;\n-            }\n-            var makeVisible = true;\n-\n-            var content = items[i].innerHTML.toLowerCase();\n-            for (var j = 0; j < filterParts.length; j++) {\n-                var part = filterParts[j];\n-                if (content.indexOf(part) < 0) {\n-                    makeVisible = false;\n-                    break;\n-                }\n-            }\n-            if (makeVisible) {\n-                items[i].removeClassName(\"hidden\");\n-                anyVisible = true;\n+        clearTimeout(debounce);\n+        // debounce reduces number of server side calls while typing\n+        debounce = setTimeout(function() {\n+            var pluginsTable = document.getElementById('plugins');\n+\n+            // only on available tab\n+            if (pluginsTable.dataset.page === 'available') {\n+                view.availablePlugins(e.value.toLowerCase().trim(), 20, function (plugins) {\n+                    var availablePlugins = JSON.parse(plugins.responseObject());\n+\n+                    var tbody = pluginsTable.querySelector('tbody');\n+\n+                    function clearOldResults() {\n+                        if (pluginsTable.dataset.hasadmin !== 'true') {\n+                            tbody.innerHTML = '';\n+                        } else {\n+                            var rows = tbody.querySelectorAll('tr');\n+                            if (rows) {\n+                                rows.forEach(function (row) {\n+                                    var input = row.firstChild.firstChild;\n+                                    if (input.checked !== true) {\n+                                        row.remove();\n+                                    }\n+                                })\n+                            }\n+                        }\n+                    }\n+\n+                    clearOldResults();\n+\n+                    availablePlugins.forEach(function (plugin) {\n+                        var htmlTableRowElement = document.createElement('tr');\n+                        htmlTableRowElement.classList.add('plugin');\n+\n+                        function createCheckBox() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlInputElement = document.createElement('input');\n+                            htmlInputElement.type = 'checkbox';\n+                            htmlInputElement.name = 'plugin.' + plugin.name + '.' + plugin.sourceId;\n+                            htmlTableDataCellElement.append(htmlInputElement);\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                        }\n+\n+                        function createNameEntry() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlDivElement = document.createElement('div');\n+                            var htmlAnchorElement = document.createElement('a');\n+                            htmlAnchorElement.href = plugin.wiki\n+                            htmlAnchorElement.text = plugin.displayName\n+                            htmlAnchorElement.target = '_blank'\n+                            htmlAnchorElement.rel = 'noopener noreferrer'\n+                            htmlDivElement.append(htmlAnchorElement)\n+                            htmlTableDataCellElement.append(htmlDivElement)\n+\n+                            if (plugin.categories) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('plugin-manager__categories');\n+                                plugin.categories.forEach(function (category) {\n+                                    var htmlAnchorElement = document.createElement('a');\n+                                    htmlAnchorElement.href = '?filter=' + category;\n+                                    htmlAnchorElement.classList.add('plugin-manager__category-label')\n+                                    htmlAnchorElement.text = category\n+                                    htmlDivElement.append(htmlAnchorElement)\n+                                })\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                            if (plugin.excerpt) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('excerpt');\n+                                htmlDivElement.innerHTML = plugin.excerpt\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                            \n+                            if (plugin.newerCoreRequired) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.newerCoreRequired\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.newerJavaRequired) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.newerJavaRequired\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.dependenciesNewerJava) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.dependenciesNewerJava\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.unresolvedSecurityWarnings) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerText = plugin.unresolvedSecurityWarnings.text\n+                                var listElement = document.createElement('ul');\n+                                plugin.unresolvedSecurityWarnings.warnings.forEach(function(warning) {\n+                                    var li = document.createElement('li');\n+                                    var htmlAnchorElement = document.createElement('a');\n+                                    htmlAnchorElement.href = warning.url\n+                                    htmlAnchorElement.text = warning.message\n+                                    htmlAnchorElement.target = '_blank'\n+                                    htmlAnchorElement.rel = 'noopener noreferrer'\n+                                    li.append(htmlAnchorElement)\n+                                    listElement.append(li)\n+                                })\n+                                htmlDivElement.append(listElement)\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.deprecated) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-warning');\n+                                htmlDivElement.innerHTML = plugin.deprecated\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.adoptMe) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-warning');\n+                                htmlDivElement.innerHTML = plugin.adoptMe\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.newerVersionAvailableNotOffered) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-info');\n+                                htmlDivElement.innerHTML = plugin.newerVersionAvailableNotOffered\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                        }\n+\n+                        function createVersionEntry() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            htmlTableDataCellElement.append(document.createTextNode(plugin.version));\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                        }\n+\n+                        function createReleasedAgo() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            if (plugin.releaseTimestamp) {\n+                                var htmlTimeElement = document.createElement('time');\n+                                htmlTimeElement.dateTime = plugin.releaseTimestamp.iso8601;\n+                                htmlTimeElement.textContent = plugin.releaseTimestamp.displayValue;\n+                                htmlTableDataCellElement.append(htmlTimeElement);\n+                            }\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                        }\n+\n+                        if (pluginsTable.dataset.hasadmin === 'true') {\n+                            createCheckBox();\n+                        }\n+                        createNameEntry();\n+                        createVersionEntry();\n+                        createReleasedAgo();\n+\n+                        tbody.append(htmlTableRowElement);\n+                    })\n+                })\n             } else {\n-                items[i].addClassName(\"hidden\");\n+                var filter = e.value.toLowerCase().trim();", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MjYzNQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r520082635", "bodyText": "these are all duplicated with table.properties so that I can access them in java. \ud83d\ude22", "author": "timja", "createdAt": "2020-11-09T19:57:04Z", "path": "core/src/main/resources/hudson/model/Messages.properties", "diffHunk": "@@ -333,6 +333,49 @@ UpdateCenter.PluginCategory.view=Views\n UpdateCenter.PluginCategory.must-be-labeled=Uncategorized\n UpdateCenter.PluginCategory.unrecognized=Misc ({0})\n \n+UpdateCenter.compatWarning=\\", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4Mjg0MQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r520082841", "bodyText": "there's more to copy / move if the approach is validated", "author": "timja", "createdAt": "2020-11-09T19:57:22Z", "path": "core/src/main/resources/hudson/model/Messages_bg.properties", "diffHunk": "@@ -700,6 +700,10 @@ Hudson.NoParamsSpecified=\\\n # Update Center\n UpdateCenter.DisplayName=\\\n  \\u0426\\u0435\\u043d\\u0442\\u044a\\u0440 \\u0437\\u0430 \\u043e\\u0431\\u043d\\u043e\\u0432\\u044f\\u0432\\u0430\\u043d\\u0435\n+# Warning: This plugin version may not be safe to use. Please review the following security notices:\n+UpdateCenter.securityWarning=\\", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MzIzOA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r520083238", "bodyText": "haven't tested the functionality in IE 11, but this would be needed at least", "author": "timja", "createdAt": "2020-11-09T19:58:03Z", "path": "war/src/main/webapp/scripts/polyfills.js", "diffHunk": "@@ -18,3 +18,13 @@ if (!Element.prototype.closest) {\n }\n \n // end closest / matches polyfill\n+\n+// https://developer.mozilla.org/en-US/docs/Web/API/NodeList/forEach#Polyfill\n+if (window.NodeList && !NodeList.prototype.forEach) {", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA4ODU3NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521088575", "bodyText": "saucelabs will surely give you an open source account if your request it though it looks pretty good, so I can't imagine it failing.", "author": "halkeye", "createdAt": "2020-11-11T03:37:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MzIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0MDc2NA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521240764", "bodyText": "Just tested it out on a IE11 developer machine and it breaks on calls .append on nodes. It's not supported on IE11 https://caniuse.com/mdn-api_parentnode_append and .appendChild should be used instead.", "author": "fqueiruga", "createdAt": "2020-11-11T09:52:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MzIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0MzI1Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521243257", "bodyText": "pushed (untested though)", "author": "timja", "createdAt": "2020-11-11T09:56:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MzIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI3NTMyMQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521275321", "bodyText": "Now it works. No other outstanding console errors on IE11", "author": "fqueiruga", "createdAt": "2020-11-11T10:53:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MzIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI3NTk2OA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521275968", "bodyText": "thanks!", "author": "timja", "createdAt": "2020-11-11T10:55:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4MzIzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5MjYyNQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521092625", "bodyText": "hasClassName and addClassName seem to be prototypejs funcitons.\nclassList is the official one - https://developer.mozilla.org/en-US/docs/Web/API/Element/classList\nitems[i].classList.contains('hidden-by-default')\nitems[i].classList.add('hidden')\n(or even use toggle)", "author": "halkeye", "createdAt": "2020-11-11T03:44:10Z", "path": "core/src/main/resources/hudson/PluginManager/_table.js", "diffHunk": "@@ -10,46 +10,214 @@ function checkPluginsWithoutWarnings() {\n \n Behaviour.specify(\"#filter-box\", '_table', 0, function(e) {\n     function applyFilter() {\n-        var filter = e.value.toLowerCase().trim();\n-        var filterParts = filter.split(/ +/).filter (function(word) { return word.length > 0; });\n-        var items = document.getElementsBySelector(\"TR.plugin\");\n-        var anyVisible = false;\n-        for (var i=0; i<items.length; i++) {\n-            if ((filterParts.length < 1 || filter.length < 2) && items[i].hasClassName(\"hidden-by-default\")) {\n-                items[i].addClassName(\"hidden\");\n-                continue;\n-            }\n-            var makeVisible = true;\n-\n-            var content = items[i].innerHTML.toLowerCase();\n-            for (var j = 0; j < filterParts.length; j++) {\n-                var part = filterParts[j];\n-                if (content.indexOf(part) < 0) {\n-                    makeVisible = false;\n-                    break;\n-                }\n-            }\n-            if (makeVisible) {\n-                items[i].removeClassName(\"hidden\");\n-                anyVisible = true;\n+        clearTimeout(debounce);\n+        // debounce reduces number of server side calls while typing\n+        debounce = setTimeout(function() {\n+            var pluginsTable = document.getElementById('plugins');\n+\n+            // only on available tab\n+            if (pluginsTable.dataset.page === 'available') {\n+                view.availablePlugins(e.value.toLowerCase().trim(), 20, function (plugins) {\n+                    var availablePlugins = JSON.parse(plugins.responseObject());\n+\n+                    var tbody = pluginsTable.querySelector('tbody');\n+\n+                    function clearOldResults() {\n+                        if (pluginsTable.dataset.hasadmin !== 'true') {\n+                            tbody.innerHTML = '';\n+                        } else {\n+                            var rows = tbody.querySelectorAll('tr');\n+                            if (rows) {\n+                                rows.forEach(function (row) {\n+                                    var input = row.firstChild.firstChild;\n+                                    if (input.checked !== true) {\n+                                        row.remove();\n+                                    }\n+                                })\n+                            }\n+                        }\n+                    }\n+\n+                    clearOldResults();\n+\n+                    availablePlugins.forEach(function (plugin) {\n+                        var htmlTableRowElement = document.createElement('tr');\n+                        htmlTableRowElement.classList.add('plugin');\n+\n+                        function createCheckBox() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlInputElement = document.createElement('input');\n+                            htmlInputElement.type = 'checkbox';\n+                            htmlInputElement.name = 'plugin.' + plugin.name + '.' + plugin.sourceId;\n+                            htmlTableDataCellElement.append(htmlInputElement);\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                        }\n+\n+                        function createNameEntry() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlDivElement = document.createElement('div');\n+                            var htmlAnchorElement = document.createElement('a');\n+                            htmlAnchorElement.href = plugin.wiki\n+                            htmlAnchorElement.text = plugin.displayName\n+                            htmlAnchorElement.target = '_blank'\n+                            htmlAnchorElement.rel = 'noopener noreferrer'\n+                            htmlDivElement.append(htmlAnchorElement)\n+                            htmlTableDataCellElement.append(htmlDivElement)\n+\n+                            if (plugin.categories) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('plugin-manager__categories');\n+                                plugin.categories.forEach(function (category) {\n+                                    var htmlAnchorElement = document.createElement('a');\n+                                    htmlAnchorElement.href = '?filter=' + category;\n+                                    htmlAnchorElement.classList.add('plugin-manager__category-label')\n+                                    htmlAnchorElement.text = category\n+                                    htmlDivElement.append(htmlAnchorElement)\n+                                })\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                            if (plugin.excerpt) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('excerpt');\n+                                htmlDivElement.innerHTML = plugin.excerpt\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                            \n+                            if (plugin.newerCoreRequired) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.newerCoreRequired\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.newerJavaRequired) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.newerJavaRequired\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.dependenciesNewerJava) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.dependenciesNewerJava\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.unresolvedSecurityWarnings) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerText = plugin.unresolvedSecurityWarnings.text\n+                                var listElement = document.createElement('ul');\n+                                plugin.unresolvedSecurityWarnings.warnings.forEach(function(warning) {\n+                                    var li = document.createElement('li');\n+                                    var htmlAnchorElement = document.createElement('a');\n+                                    htmlAnchorElement.href = warning.url\n+                                    htmlAnchorElement.text = warning.message\n+                                    htmlAnchorElement.target = '_blank'\n+                                    htmlAnchorElement.rel = 'noopener noreferrer'\n+                                    li.append(htmlAnchorElement)\n+                                    listElement.append(li)\n+                                })\n+                                htmlDivElement.append(listElement)\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.deprecated) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-warning');\n+                                htmlDivElement.innerHTML = plugin.deprecated\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.adoptMe) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-warning');\n+                                htmlDivElement.innerHTML = plugin.adoptMe\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.newerVersionAvailableNotOffered) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-info');\n+                                htmlDivElement.innerHTML = plugin.newerVersionAvailableNotOffered\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                        }\n+\n+                        function createVersionEntry() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            htmlTableDataCellElement.append(document.createTextNode(plugin.version));\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                        }\n+\n+                        function createReleasedAgo() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            if (plugin.releaseTimestamp) {\n+                                var htmlTimeElement = document.createElement('time');\n+                                htmlTimeElement.dateTime = plugin.releaseTimestamp.iso8601;\n+                                htmlTimeElement.textContent = plugin.releaseTimestamp.displayValue;\n+                                htmlTableDataCellElement.append(htmlTimeElement);\n+                            }\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                        }\n+\n+                        if (pluginsTable.dataset.hasadmin === 'true') {\n+                            createCheckBox();\n+                        }\n+                        createNameEntry();\n+                        createVersionEntry();\n+                        createReleasedAgo();\n+\n+                        tbody.append(htmlTableRowElement);\n+                    })\n+                })\n             } else {\n-                items[i].addClassName(\"hidden\");\n+                var filter = e.value.toLowerCase().trim();\n+                var filterParts = filter.split(/ +/).filter(function (word) {\n+                    return word.length > 0;\n+                });\n+                var items = document.getElementsBySelector(\"TR.plugin\");\n+                var anyVisible = false;\n+                for (var i = 0; i < items.length; i++) {\n+                    if ((filterParts.length < 1 || filter.length < 2) && items[i].hasClassName(\"hidden-by-default\")) {", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5MzIwMQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521093201", "bodyText": "Looks like you use classList higher up. Any chance to nix any prototypejs is super high priority to me", "author": "halkeye", "createdAt": "2020-11-11T03:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5MjYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3MDIzOQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521170239", "bodyText": "This is the moved code (in the else block) I haven\u2019t touched it other than disabling it on the available page.\nBut yes can clean this up", "author": "timja", "createdAt": "2020-11-11T07:38:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5MjYyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5NDkwMA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521094900", "bodyText": "Its probably fine, but i think textContent is safer, and from reading online, faster - https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent", "author": "halkeye", "createdAt": "2020-11-11T03:47:53Z", "path": "core/src/main/resources/hudson/PluginManager/_table.js", "diffHunk": "@@ -10,46 +10,214 @@ function checkPluginsWithoutWarnings() {\n \n Behaviour.specify(\"#filter-box\", '_table', 0, function(e) {\n     function applyFilter() {\n-        var filter = e.value.toLowerCase().trim();\n-        var filterParts = filter.split(/ +/).filter (function(word) { return word.length > 0; });\n-        var items = document.getElementsBySelector(\"TR.plugin\");\n-        var anyVisible = false;\n-        for (var i=0; i<items.length; i++) {\n-            if ((filterParts.length < 1 || filter.length < 2) && items[i].hasClassName(\"hidden-by-default\")) {\n-                items[i].addClassName(\"hidden\");\n-                continue;\n-            }\n-            var makeVisible = true;\n-\n-            var content = items[i].innerHTML.toLowerCase();\n-            for (var j = 0; j < filterParts.length; j++) {\n-                var part = filterParts[j];\n-                if (content.indexOf(part) < 0) {\n-                    makeVisible = false;\n-                    break;\n-                }\n-            }\n-            if (makeVisible) {\n-                items[i].removeClassName(\"hidden\");\n-                anyVisible = true;\n+        clearTimeout(debounce);\n+        // debounce reduces number of server side calls while typing\n+        debounce = setTimeout(function() {\n+            var pluginsTable = document.getElementById('plugins');\n+\n+            // only on available tab\n+            if (pluginsTable.dataset.page === 'available') {\n+                view.availablePlugins(e.value.toLowerCase().trim(), 20, function (plugins) {\n+                    var availablePlugins = JSON.parse(plugins.responseObject());\n+\n+                    var tbody = pluginsTable.querySelector('tbody');\n+\n+                    function clearOldResults() {\n+                        if (pluginsTable.dataset.hasadmin !== 'true') {\n+                            tbody.innerHTML = '';\n+                        } else {\n+                            var rows = tbody.querySelectorAll('tr');\n+                            if (rows) {\n+                                rows.forEach(function (row) {\n+                                    var input = row.firstChild.firstChild;\n+                                    if (input.checked !== true) {\n+                                        row.remove();\n+                                    }\n+                                })\n+                            }\n+                        }\n+                    }\n+\n+                    clearOldResults();\n+\n+                    availablePlugins.forEach(function (plugin) {\n+                        var htmlTableRowElement = document.createElement('tr');\n+                        htmlTableRowElement.classList.add('plugin');\n+\n+                        function createCheckBox() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlInputElement = document.createElement('input');\n+                            htmlInputElement.type = 'checkbox';\n+                            htmlInputElement.name = 'plugin.' + plugin.name + '.' + plugin.sourceId;\n+                            htmlTableDataCellElement.append(htmlInputElement);\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                        }\n+\n+                        function createNameEntry() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlDivElement = document.createElement('div');\n+                            var htmlAnchorElement = document.createElement('a');\n+                            htmlAnchorElement.href = plugin.wiki\n+                            htmlAnchorElement.text = plugin.displayName\n+                            htmlAnchorElement.target = '_blank'\n+                            htmlAnchorElement.rel = 'noopener noreferrer'\n+                            htmlDivElement.append(htmlAnchorElement)\n+                            htmlTableDataCellElement.append(htmlDivElement)\n+\n+                            if (plugin.categories) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('plugin-manager__categories');\n+                                plugin.categories.forEach(function (category) {\n+                                    var htmlAnchorElement = document.createElement('a');\n+                                    htmlAnchorElement.href = '?filter=' + category;\n+                                    htmlAnchorElement.classList.add('plugin-manager__category-label')\n+                                    htmlAnchorElement.text = category\n+                                    htmlDivElement.append(htmlAnchorElement)\n+                                })\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                            if (plugin.excerpt) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('excerpt');\n+                                htmlDivElement.innerHTML = plugin.excerpt\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                            \n+                            if (plugin.newerCoreRequired) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.newerCoreRequired\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.newerJavaRequired) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.newerJavaRequired\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.dependenciesNewerJava) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerHTML = plugin.dependenciesNewerJava\n+                                htmlTableDataCellElement.append(htmlDivElement)\n+                            }\n+\n+                            if (plugin.unresolvedSecurityWarnings) {\n+                                htmlDivElement = document.createElement('div');\n+                                htmlDivElement.classList.add('alert', 'alert-danger');\n+                                htmlDivElement.innerText = plugin.unresolvedSecurityWarnings.text", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3MTM4Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521171387", "bodyText": "From a quick read it seems all those differences are when reading it not setting the value but sure can change", "author": "timja", "createdAt": "2020-11-11T07:41:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5NDkwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5NTIwOQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521095209", "bodyText": "so technically this is controlled by the pom right? so technically they could have a wiki link of javascript:alert(\"foo\")? do we need to sanitize this at all? make sure its a parsed url in the backend?", "author": "halkeye", "createdAt": "2020-11-11T03:49:18Z", "path": "core/src/main/resources/hudson/PluginManager/_table.js", "diffHunk": "@@ -10,46 +10,214 @@ function checkPluginsWithoutWarnings() {\n \n Behaviour.specify(\"#filter-box\", '_table', 0, function(e) {\n     function applyFilter() {\n-        var filter = e.value.toLowerCase().trim();\n-        var filterParts = filter.split(/ +/).filter (function(word) { return word.length > 0; });\n-        var items = document.getElementsBySelector(\"TR.plugin\");\n-        var anyVisible = false;\n-        for (var i=0; i<items.length; i++) {\n-            if ((filterParts.length < 1 || filter.length < 2) && items[i].hasClassName(\"hidden-by-default\")) {\n-                items[i].addClassName(\"hidden\");\n-                continue;\n-            }\n-            var makeVisible = true;\n-\n-            var content = items[i].innerHTML.toLowerCase();\n-            for (var j = 0; j < filterParts.length; j++) {\n-                var part = filterParts[j];\n-                if (content.indexOf(part) < 0) {\n-                    makeVisible = false;\n-                    break;\n-                }\n-            }\n-            if (makeVisible) {\n-                items[i].removeClassName(\"hidden\");\n-                anyVisible = true;\n+        clearTimeout(debounce);\n+        // debounce reduces number of server side calls while typing\n+        debounce = setTimeout(function() {\n+            var pluginsTable = document.getElementById('plugins');\n+\n+            // only on available tab\n+            if (pluginsTable.dataset.page === 'available') {\n+                view.availablePlugins(e.value.toLowerCase().trim(), 20, function (plugins) {\n+                    var availablePlugins = JSON.parse(plugins.responseObject());\n+\n+                    var tbody = pluginsTable.querySelector('tbody');\n+\n+                    function clearOldResults() {\n+                        if (pluginsTable.dataset.hasadmin !== 'true') {\n+                            tbody.innerHTML = '';\n+                        } else {\n+                            var rows = tbody.querySelectorAll('tr');\n+                            if (rows) {\n+                                rows.forEach(function (row) {\n+                                    var input = row.firstChild.firstChild;\n+                                    if (input.checked !== true) {\n+                                        row.remove();\n+                                    }\n+                                })\n+                            }\n+                        }\n+                    }\n+\n+                    clearOldResults();\n+\n+                    availablePlugins.forEach(function (plugin) {\n+                        var htmlTableRowElement = document.createElement('tr');\n+                        htmlTableRowElement.classList.add('plugin');\n+\n+                        function createCheckBox() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlInputElement = document.createElement('input');\n+                            htmlInputElement.type = 'checkbox';\n+                            htmlInputElement.name = 'plugin.' + plugin.name + '.' + plugin.sourceId;\n+                            htmlTableDataCellElement.append(htmlInputElement);\n+                            htmlTableRowElement.append(htmlTableDataCellElement);\n+                        }\n+\n+                        function createNameEntry() {\n+                            var htmlTableDataCellElement = document.createElement('td');\n+                            htmlTableDataCellElement.classList.add('pane')\n+                            var htmlDivElement = document.createElement('div');\n+                            var htmlAnchorElement = document.createElement('a');\n+                            htmlAnchorElement.href = plugin.wiki", "originalCommit": "8e217db996c3504e23e6f0ccdffa3f16012ed2be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3MTYzOA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521171638", "bodyText": "Isn\u2019t that done in update center? This is just a port of the code from the jelly files", "author": "timja", "createdAt": "2020-11-11T07:41:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5NTIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3MjA5Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521172097", "bodyText": "I have no idea. I'm not super familiar with core, its a common javascript issue so I just wanted to point it out just in case.", "author": "halkeye", "createdAt": "2020-11-11T07:42:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5NTIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE4MzI1MA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521183250", "bodyText": "@daniel-beck ?", "author": "timja", "createdAt": "2020-11-11T08:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5NTIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI5OTI0Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521299243", "bodyText": "Maybe setAttribute is better?", "author": "fqueiruga", "createdAt": "2020-11-11T11:40:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5NTIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU0MDc5NA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r521540794", "bodyText": "Not really..any time you use user values it has the potential to inject/XSS. I think the attack vector is pretty small. The best solution is to use new Uri in java and confirm the scheme is http or HTTPS. Then after that no concern.", "author": "halkeye", "createdAt": "2020-11-11T17:59:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5NTIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE4NjkzOQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r522186939", "bodyText": "it's hardcoded in update center to plugin site: https://github.com/jenkins-infra/update-center2/blob/4c19fc6ca406abb5dc37adf7aa311d58b98d2963/src/main/java/io/jenkins/update_center/PluginUpdateCenterEntry.java#L92", "author": "timja", "createdAt": "2020-11-12T15:20:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA5NTIwOQ=="}], "type": "inlineReview"}, {"oid": "ce9da0cd85c832df6f693d6b51ea3da3de9b4498", "url": "https://github.com/jenkinsci/jenkins/commit/ce9da0cd85c832df6f693d6b51ea3da3de9b4498", "message": "Fix in IE", "committedDate": "2020-11-11T09:56:29Z", "type": "commit"}, {"oid": "1965b837d92b6d0c4c459ed674d554d1a0add172", "url": "https://github.com/jenkinsci/jenkins/commit/1965b837d92b6d0c4c459ed674d554d1a0add172", "message": "Merge branch 'master' into plugin-manager", "committedDate": "2020-11-12T12:03:06Z", "type": "commit"}, {"oid": "1c91e9b13fc24efab7e3f6a68f72e3ff31792e24", "url": "https://github.com/jenkinsci/jenkins/commit/1c91e9b13fc24efab7e3f6a68f72e3ff31792e24", "message": "Address feedback from ux-sig demo", "committedDate": "2020-11-12T14:59:26Z", "type": "commit"}, {"oid": "5418f7e856011b94a77a41d65b2ec51c4e95dc8a", "url": "https://github.com/jenkinsci/jenkins/commit/5418f7e856011b94a77a41d65b2ec51c4e95dc8a", "message": "Add handlebars module", "committedDate": "2020-11-12T16:36:31Z", "type": "commit"}, {"oid": "ab3c1bcfd9b54f1f934af574d00811e56fc142e3", "url": "https://github.com/jenkinsci/jenkins/commit/ab3c1bcfd9b54f1f934af574d00811e56fc142e3", "message": "Handlebars plugin manager", "committedDate": "2020-11-13T14:14:44Z", "type": "commit"}, {"oid": "11ee569e0ab05e53e3b0ff654477c4aedc90073f", "url": "https://github.com/jenkinsci/jenkins/commit/11ee569e0ab05e53e3b0ff654477c4aedc90073f", "message": "Update core/src/main/java/hudson/model/UpdateCenter.java", "committedDate": "2020-11-13T14:15:48Z", "type": "commit"}, {"oid": "5ef60f235038569785669659cbff8cf50660baf9", "url": "https://github.com/jenkinsci/jenkins/commit/5ef60f235038569785669659cbff8cf50660baf9", "message": "Remove import", "committedDate": "2020-11-13T14:16:34Z", "type": "commit"}, {"oid": "a93dec0d1d772a77d01399992431fb77c805dc37", "url": "https://github.com/jenkinsci/jenkins/commit/a93dec0d1d772a77d01399992431fb77c805dc37", "message": "Fix input", "committedDate": "2020-11-13T14:26:26Z", "type": "commit"}, {"oid": "54a6b84512ab7c471cda81f981ceb2fb94f44891", "url": "https://github.com/jenkinsci/jenkins/commit/54a6b84512ab7c471cda81f981ceb2fb94f44891", "message": "Remove debug", "committedDate": "2020-11-13T14:27:11Z", "type": "commit"}, {"oid": "b4ce1357a47eb84cae41faa192d3f52034f41de4", "url": "https://github.com/jenkinsci/jenkins/commit/b4ce1357a47eb84cae41faa192d3f52034f41de4", "message": "Use rest client", "committedDate": "2020-11-13T15:29:45Z", "type": "commit"}, {"oid": "8d0b1198ba0a9c33fe9970535c98ea77b35231fb", "url": "https://github.com/jenkinsci/jenkins/commit/8d0b1198ba0a9c33fe9970535c98ea77b35231fb", "message": "Fix bug", "committedDate": "2020-11-13T15:34:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEzNjEwMQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r523136101", "bodyText": "you can bring in lodash.debounce and use it here", "author": "fqueiruga", "createdAt": "2020-11-13T18:14:04Z", "path": "war/src/main/js/plugin-manager-ui.js", "diffHunk": "@@ -0,0 +1,59 @@\n+import pluginManagerAvailable from './templates/plugin-manager/available.hbs'\n+import pluginManager from './api/pluginManager';\n+\n+var debounce = null;\n+\n+function applyFilter(searchQuery) {\n+    clearTimeout(debounce);\n+    // debounce reduces number of server side calls while typing\n+    debounce = setTimeout(function () {", "originalCommit": "8d0b1198ba0a9c33fe9970535c98ea77b35231fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIwMjQ3NA==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r523202474", "bodyText": "thanks, done", "author": "timja", "createdAt": "2020-11-13T20:21:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEzNjEwMQ=="}], "type": "inlineReview"}, {"oid": "bef659de081308754f63824c1c1b6044fcd6683d", "url": "https://github.com/jenkinsci/jenkins/commit/bef659de081308754f63824c1c1b6044fcd6683d", "message": "Move properties to right location", "committedDate": "2020-11-13T19:51:09Z", "type": "commit"}, {"oid": "553ddd714b77aeae2014d66ac4dfeaf255b4ffe2", "url": "https://github.com/jenkinsci/jenkins/commit/553ddd714b77aeae2014d66ac4dfeaf255b4ffe2", "message": "Cleanup", "committedDate": "2020-11-13T19:51:35Z", "type": "commit"}, {"oid": "a01bd001b3dc2c88e8f75684476d9bcd10fc3724", "url": "https://github.com/jenkinsci/jenkins/commit/a01bd001b3dc2c88e8f75684476d9bcd10fc3724", "message": "Use lodash debounce", "committedDate": "2020-11-13T20:20:56Z", "type": "commit"}, {"oid": "ea475b74f2c5e27631a17047e7d4463f61ac538f", "url": "https://github.com/jenkinsci/jenkins/commit/ea475b74f2c5e27631a17047e7d4463f61ac538f", "message": "Revert properties change", "committedDate": "2020-11-13T20:22:02Z", "type": "commit"}, {"oid": "7c7d27d2b2d1e843b5cce53df64a4a347d2cc53f", "url": "https://github.com/jenkinsci/jenkins/commit/7c7d27d2b2d1e843b5cce53df64a4a347d2cc53f", "message": "Fmt", "committedDate": "2020-11-13T20:23:27Z", "type": "commit"}, {"oid": "bf635cc57aaabe67c76cf2c2e14f034e556543f0", "url": "https://github.com/jenkinsci/jenkins/commit/bf635cc57aaabe67c76cf2c2e14f034e556543f0", "message": "Rank exact matches at the top", "committedDate": "2020-11-20T12:29:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY3NTI5NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r527675295", "bodyText": "So what's the Turkish locale situation in JS?\nAre they going to search for GIT and not find git because it's not g\u0131t?", "author": "daniel-beck", "createdAt": "2020-11-20T13:00:24Z", "path": "core/src/main/java/hudson/PluginManager.java", "diffHunk": "@@ -1344,6 +1346,121 @@ public void stop() {\n         LogFactory.release(uberClassLoader);\n     }\n \n+    @Restricted(NoExternalUse.class)\n+    public static boolean isNonMetaLabel(String label) {\n+        return !(\"adopt-this-plugin\".equals(label) || \"deprecated\".equals(label));\n+    }\n+    \n+    @Restricted(NoExternalUse.class)\n+    public HttpResponse doPluginsSearch(@QueryParameter String query, @QueryParameter Integer limit) {\n+        String lowerSearchQuery = query != null ? query.toLowerCase() : null;\n+        List<JSONObject> plugins = new ArrayList<>();\n+        for (UpdateSite site : Jenkins.get().getUpdateCenter().getSiteList()) {\n+            plugins = site.getAvailables().stream()\n+                .filter(plugin -> {\n+                    if (StringUtils.isBlank(query)) {\n+                        return true;\n+                    }\n+                    return plugin.name.toLowerCase().contains(lowerSearchQuery) ||\n+                        plugin.title.toLowerCase().contains(lowerSearchQuery) ||\n+                        plugin.excerpt.toLowerCase().contains(lowerSearchQuery) ||\n+                        Arrays.asList(plugin.categories).contains(query) ||\n+                        Arrays.stream(plugin.categories)\n+                            .map(UpdateCenter::getCategoryDisplayName)\n+                            .anyMatch(category -> category.toLowerCase().contains(query)) ||\n+                        plugin.hasWarnings() && lowerSearchQuery.equals(\"warning:\");\n+                })\n+                .limit(limit)\n+                .map(plugin -> {\n+                    JSONObject jsonObject = new JSONObject();\n+                    jsonObject.put(\"name\", plugin.name);\n+                    jsonObject.put(\"sourceId\", plugin.sourceId);\n+                    jsonObject.put(\"title\", plugin.title);\n+                    jsonObject.put(\"displayName\", plugin.getDisplayName());\n+                    jsonObject.put(\"wiki\", plugin.wiki);\n+                    jsonObject.put(\"categories\", Arrays.stream(plugin.categories)\n+                        .filter(PluginManager::isNonMetaLabel)\n+                        .map(UpdateCenter::getCategoryDisplayName)\n+                        .collect(toList())\n+                    );\n+\n+                    if (hasAdoptThisPluginLabel(plugin)) {\n+                        jsonObject.put(\"adoptMe\", Messages.PluginManager_adoptThisPlugin());\n+                    }\n+                    if (plugin.isDeprecated()) {\n+                        jsonObject.put(\"deprecated\", Messages.PluginManager_deprecationWarning(plugin.getDeprecation().url));\n+                    }\n+                    jsonObject.put(\"excerpt\", plugin.excerpt);\n+                    jsonObject.put(\"version\", plugin.version);\n+                    jsonObject.put(\"popularity\", plugin.popularity);\n+                    if (plugin.isForNewerHudson()) {\n+                        jsonObject.put(\"newerCoreRequired\", Messages.PluginManager_coreWarning(plugin.requiredCore));\n+                    }\n+                    if (plugin.isForNewerJava()) {\n+                        jsonObject.put(\"newerJavaRequired\", Messages.PluginManager_javaWarning(plugin.minimumJavaVersion));\n+                    }\n+                    if (plugin.isNeededDependenciesForNewerJava()) {\n+                        VersionNumber javaVersion = plugin.getNeededDependenciesMinimumJavaVersion();\n+                        if (javaVersion == null) {\n+                            throw new IllegalStateException(\"java version cannot be null here\");\n+                        }\n+                        jsonObject.put(\"dependenciesNewerJava\", Messages.PluginManager_depJavaWarning(javaVersion.toString()));\n+                    }\n+                    if (plugin.hasWarnings()) {\n+                        JSONObject unresolvedSecurityWarnings = new JSONObject();\n+                        unresolvedSecurityWarnings.put(\"text\", Messages.PluginManager_securityWarning());\n+                        Set<UpdateSite.Warning> pluginWarnings = plugin.getWarnings();\n+                        if (pluginWarnings == null) {\n+                            throw new IllegalStateException(\"warnings cannot be null here\");\n+                        }\n+                        List<JSONObject> warnings = pluginWarnings.stream()\n+                            .map(warning -> {\n+                                JSONObject jsonWarning = new JSONObject();\n+                                jsonWarning.put(\"url\", warning.url);\n+                                jsonWarning.put(\"message\", warning.message);\n+                                return jsonWarning;\n+                            }).collect(toList());\n+                        unresolvedSecurityWarnings.put(\"warnings\", warnings);\n+                        jsonObject.put(\"unresolvedSecurityWarnings\", unresolvedSecurityWarnings);\n+                    }\n+                    if (plugin.releaseTimestamp != null) {\n+                        JSONObject releaseTimestamp = new JSONObject();\n+                        releaseTimestamp.put(\"iso8601\", Functions.iso8601DateTime(plugin.releaseTimestamp));\n+                        releaseTimestamp.put(\"displayValue\", Messages.PluginManager_ago(Functions.getTimeSpanString(plugin.releaseTimestamp)));\n+                        jsonObject.put(\"releaseTimestamp\", releaseTimestamp);\n+                    }\n+                    if (hasLatestVersionNewerThanOffered(plugin)) {\n+                        jsonObject.put(\"newerVersionAvailableNotOffered\", Messages.PluginManager_newerVersionExists(plugin.latest));\n+                    }\n+                    return jsonObject;\n+                })\n+                .sorted((o1, o2) -> {\n+                    String o1DisplayName = o1.getString(\"displayName\");\n+                    if (o1.getString(\"name\").toLowerCase().equals(lowerSearchQuery) || o1DisplayName.toLowerCase().equals(lowerSearchQuery)) {", "originalCommit": "bf635cc57aaabe67c76cf2c2e14f034e556543f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY3ODYzMg==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r527678632", "bodyText": "is this what you meant? 492a24a\nthere's no JS searching done here, it's all server side", "author": "timja", "createdAt": "2020-11-20T13:07:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY3NTI5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY4Nzk5NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r527687995", "bodyText": "Oops. Yes, then Turkish people might be unhappy.\nAlso there's String#equalsIgnoreCase which does this for us.", "author": "daniel-beck", "createdAt": "2020-11-20T13:25:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY3NTI5NQ=="}], "type": "inlineReview"}, {"oid": "492a24a98c119f6ff4989119618d9e6f43eaea0a", "url": "https://github.com/jenkinsci/jenkins/commit/492a24a98c119f6ff4989119618d9e6f43eaea0a", "message": "Set locale", "committedDate": "2020-11-20T13:06:06Z", "type": "commit"}, {"oid": "9ad75d1bbaceb3538187656dbee275f938a31654", "url": "https://github.com/jenkinsci/jenkins/commit/9ad75d1bbaceb3538187656dbee275f938a31654", "message": "Spotbugs", "committedDate": "2020-11-20T13:43:32Z", "type": "commit"}, {"oid": "c996c91e86f01614203d34ec3caf5c7ba2e10178", "url": "https://github.com/jenkinsci/jenkins/commit/c996c91e86f01614203d34ec3caf5c7ba2e10178", "message": "ignore case in nicer way", "committedDate": "2020-11-20T13:48:48Z", "type": "commit"}, {"oid": "a4640102086f7c8524347f0b32432e985467772c", "url": "https://github.com/jenkinsci/jenkins/commit/a4640102086f7c8524347f0b32432e985467772c", "message": "Merge branch 'master' into plugin-manager", "committedDate": "2020-11-23T21:33:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyMDg0OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r530520849", "bodyText": "does this not need to be reflective also?  if o2 is direct match for the search term then return +1?", "author": "jtnord", "createdAt": "2020-11-25T16:58:47Z", "path": "core/src/main/java/hudson/PluginManager.java", "diffHunk": "@@ -1344,6 +1346,120 @@ public void stop() {\n         LogFactory.release(uberClassLoader);\n     }\n \n+    @Restricted(NoExternalUse.class)\n+    public static boolean isNonMetaLabel(String label) {\n+        return !(\"adopt-this-plugin\".equals(label) || \"deprecated\".equals(label));\n+    }\n+    \n+    @Restricted(NoExternalUse.class)\n+    public HttpResponse doPluginsSearch(@QueryParameter String query, @QueryParameter Integer limit) {\n+        List<JSONObject> plugins = new ArrayList<>();\n+        for (UpdateSite site : Jenkins.get().getUpdateCenter().getSiteList()) {\n+            plugins = site.getAvailables().stream()\n+                .filter(plugin -> {\n+                    if (StringUtils.isBlank(query)) {\n+                        return true;\n+                    }\n+                    return StringUtils.containsIgnoreCase(plugin.name, query) ||\n+                        StringUtils.containsIgnoreCase(plugin.title, query) ||\n+                        StringUtils.containsIgnoreCase(plugin.excerpt, query) ||\n+                        Arrays.asList(plugin.categories).contains(query) ||\n+                        Arrays.stream(plugin.categories)\n+                            .map(UpdateCenter::getCategoryDisplayName)\n+                            .anyMatch(category -> StringUtils.containsIgnoreCase(category, query)) ||\n+                        plugin.hasWarnings() && query.equalsIgnoreCase(\"warning:\");\n+                })\n+                .limit(limit)\n+                .map(plugin -> {\n+                    JSONObject jsonObject = new JSONObject();\n+                    jsonObject.put(\"name\", plugin.name);\n+                    jsonObject.put(\"sourceId\", plugin.sourceId);\n+                    jsonObject.put(\"title\", plugin.title);\n+                    jsonObject.put(\"displayName\", plugin.getDisplayName());\n+                    jsonObject.put(\"wiki\", plugin.wiki);\n+                    jsonObject.put(\"categories\", Arrays.stream(plugin.categories)\n+                        .filter(PluginManager::isNonMetaLabel)\n+                        .map(UpdateCenter::getCategoryDisplayName)\n+                        .collect(toList())\n+                    );\n+\n+                    if (hasAdoptThisPluginLabel(plugin)) {\n+                        jsonObject.put(\"adoptMe\", Messages.PluginManager_adoptThisPlugin());\n+                    }\n+                    if (plugin.isDeprecated()) {\n+                        jsonObject.put(\"deprecated\", Messages.PluginManager_deprecationWarning(plugin.getDeprecation().url));\n+                    }\n+                    jsonObject.put(\"excerpt\", plugin.excerpt);\n+                    jsonObject.put(\"version\", plugin.version);\n+                    jsonObject.put(\"popularity\", plugin.popularity);\n+                    if (plugin.isForNewerHudson()) {\n+                        jsonObject.put(\"newerCoreRequired\", Messages.PluginManager_coreWarning(plugin.requiredCore));\n+                    }\n+                    if (plugin.isForNewerJava()) {\n+                        jsonObject.put(\"newerJavaRequired\", Messages.PluginManager_javaWarning(plugin.minimumJavaVersion));\n+                    }\n+                    if (plugin.isNeededDependenciesForNewerJava()) {\n+                        VersionNumber javaVersion = plugin.getNeededDependenciesMinimumJavaVersion();\n+                        if (javaVersion == null) {\n+                            throw new IllegalStateException(\"java version cannot be null here\");\n+                        }\n+                        jsonObject.put(\"dependenciesNewerJava\", Messages.PluginManager_depJavaWarning(javaVersion.toString()));\n+                    }\n+                    if (plugin.hasWarnings()) {\n+                        JSONObject unresolvedSecurityWarnings = new JSONObject();\n+                        unresolvedSecurityWarnings.put(\"text\", Messages.PluginManager_securityWarning());\n+                        Set<UpdateSite.Warning> pluginWarnings = plugin.getWarnings();\n+                        if (pluginWarnings == null) {\n+                            throw new IllegalStateException(\"warnings cannot be null here\");\n+                        }\n+                        List<JSONObject> warnings = pluginWarnings.stream()\n+                            .map(warning -> {\n+                                JSONObject jsonWarning = new JSONObject();\n+                                jsonWarning.put(\"url\", warning.url);\n+                                jsonWarning.put(\"message\", warning.message);\n+                                return jsonWarning;\n+                            }).collect(toList());\n+                        unresolvedSecurityWarnings.put(\"warnings\", warnings);\n+                        jsonObject.put(\"unresolvedSecurityWarnings\", unresolvedSecurityWarnings);\n+                    }\n+                    if (plugin.releaseTimestamp != null) {\n+                        JSONObject releaseTimestamp = new JSONObject();\n+                        releaseTimestamp.put(\"iso8601\", Functions.iso8601DateTime(plugin.releaseTimestamp));\n+                        releaseTimestamp.put(\"displayValue\", Messages.PluginManager_ago(Functions.getTimeSpanString(plugin.releaseTimestamp)));\n+                        jsonObject.put(\"releaseTimestamp\", releaseTimestamp);\n+                    }\n+                    if (hasLatestVersionNewerThanOffered(plugin)) {\n+                        jsonObject.put(\"newerVersionAvailableNotOffered\", Messages.PluginManager_newerVersionExists(plugin.latest));\n+                    }\n+                    return jsonObject;\n+                })\n+                .sorted((o1, o2) -> {\n+                    String o1DisplayName = o1.getString(\"displayName\");", "originalCommit": "a4640102086f7c8524347f0b32432e985467772c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg5Nzg2Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r534897863", "bodyText": "done", "author": "timja", "createdAt": "2020-12-03T08:21:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyMDg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyNTgwNQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r530525805", "bodyText": "missing permission check?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<JSONObject> plugins = new ArrayList<>();\n          \n          \n            \n                    Jenkins.get().checkPermission(Jenkins.SYSTEM_READ);\n          \n          \n            \n                    List<JSONObject> plugins = new ArrayList<>();", "author": "jtnord", "createdAt": "2020-11-25T17:06:46Z", "path": "core/src/main/java/hudson/PluginManager.java", "diffHunk": "@@ -1344,6 +1346,120 @@ public void stop() {\n         LogFactory.release(uberClassLoader);\n     }\n \n+    @Restricted(NoExternalUse.class)\n+    public static boolean isNonMetaLabel(String label) {\n+        return !(\"adopt-this-plugin\".equals(label) || \"deprecated\".equals(label));\n+    }\n+    \n+    @Restricted(NoExternalUse.class)\n+    public HttpResponse doPluginsSearch(@QueryParameter String query, @QueryParameter Integer limit) {\n+        List<JSONObject> plugins = new ArrayList<>();", "originalCommit": "a4640102086f7c8524347f0b32432e985467772c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYwNjUzMw==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r530606533", "bodyText": "I think already covered here:\nhttps://github.com/timja/jenkins/blob/plugin-manager/core/src/main/java/hudson/PluginManager.java#L2393\nthe other permission checks are for tightening it to ADMINISTER mostly", "author": "timja", "createdAt": "2020-11-25T19:44:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyNTgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQ1MTA4Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/5051#discussion_r531451083", "bodyText": "Tested, reader is missing the Overall/SystemRead permission", "author": "timja", "createdAt": "2020-11-27T08:34:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUyNTgwNQ=="}], "type": "inlineReview"}, {"oid": "fab36afa58c43c18f462dbab6312dee4a0dff5a9", "url": "https://github.com/jenkinsci/jenkins/commit/fab36afa58c43c18f462dbab6312dee4a0dff5a9", "message": "Merge branch 'master' into plugin-manager", "committedDate": "2020-12-03T07:59:06Z", "type": "commit"}, {"oid": "d1a76dbd2df823aa8c4ab442b4b3121014c7dba2", "url": "https://github.com/jenkinsci/jenkins/commit/d1a76dbd2df823aa8c4ab442b4b3121014c7dba2", "message": "Sorting improvements", "committedDate": "2020-12-03T08:18:29Z", "type": "commit"}]}