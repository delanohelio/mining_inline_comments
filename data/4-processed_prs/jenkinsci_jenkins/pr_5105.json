{"pr_number": 5105, "pr_title": "[JENKINS-64390] make FieldUtils behave as it used to", "pr_createdAt": "2020-12-09T18:05:29Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/5105", "timeline": [{"oid": "a0a1739f95bbfa41a098c563fe9895b24ca07634", "url": "https://github.com/jenkinsci/jenkins/commit/a0a1739f95bbfa41a098c563fe9895b24ca07634", "message": "[JENKINS-64390] make FieldUtils behave as it used to", "committedDate": "2020-12-09T18:00:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTUzMTA5OA==", "url": "https://github.com/jenkinsci/jenkins/pull/5105#discussion_r539531098", "bodyText": "this behaved differently with the initial acegi-rewrite if it was public", "author": "jtnord", "createdAt": "2020-12-09T18:07:11Z", "path": "core/src/test/java/org/acegisecurity/util/FieldUtilsTest.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.acegisecurity.util;\n+\n+import org.junit.jupiter.api.Test;\n+import org.jvnet.hudson.test.Issue;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+class FieldUtilsTest {\n+\n+    @Issue(\"JENKINS-64390\")\n+    @Test\n+    public void setProtectedFieldValue_Should_fail_silently_to_set_public_final_fields_in_InnerClass() throws Exception {\n+        InnerClassWithPublicFinalField sut = new InnerClassWithPublicFinalField();\n+        FieldUtils.setProtectedFieldValue(\"myField\", sut, \"test\");\n+        assertEquals(sut.getMyField(), \"original\");\n+    }\n+\n+    @Test\n+    @Issue(\"JENKINS-64390\")\n+    public void setProtectedFieldValue_Should_fail_silently_to_set_public_final_fields_in_OuterClass() throws Exception {\n+        OuterClassWithPublicFinalField sut = new OuterClassWithPublicFinalField();\n+        FieldUtils.setProtectedFieldValue(\"myField\", sut, \"test\");\n+        assertEquals(sut.getMyField(), \"original\");\n+    }\n+\n+    @Test\n+    public void setProtectedFieldValue_Should_Succeed() throws Exception {\n+        InnerClassWithProtectedField sut = new InnerClassWithProtectedField();\n+        FieldUtils.setProtectedFieldValue(\"myProtectedField\", sut, \"test\");\n+        assertEquals(sut.getMyNonFinalField(), \"test\");\n+    }\n+\n+    @Test\n+    public void setNonExistingField_Should_Fail() throws Exception {\n+        InnerClassWithProtectedField sut = new InnerClassWithProtectedField();\n+        assertThrows(Exception.class, () -> FieldUtils.setProtectedFieldValue(\"bogus\", sut, \"whatever\"));\n+    }\n+\n+    class InnerClassWithPublicFinalField {", "originalCommit": "a0a1739f95bbfa41a098c563fe9895b24ca07634", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU0MjA5Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/5105#discussion_r539542096", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            class FieldUtilsTest {\n          \n          \n            \n            @SuppressWarnings(\"deprecation\")\n          \n          \n            \n            public class FieldUtilsTest {", "author": "jglick", "createdAt": "2020-12-09T18:23:48Z", "path": "core/src/test/java/org/acegisecurity/util/FieldUtilsTest.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.acegisecurity.util;\n+\n+import org.junit.jupiter.api.Test;\n+import org.jvnet.hudson.test.Issue;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+class FieldUtilsTest {", "originalCommit": "a0a1739f95bbfa41a098c563fe9895b24ca07634", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d729fa790dbc95e3a1cc97ffca18cb7774301840", "url": "https://github.com/jenkinsci/jenkins/commit/d729fa790dbc95e3a1cc97ffca18cb7774301840", "message": "Update core/src/test/java/org/acegisecurity/util/FieldUtilsTest.java\n\nCo-authored-by: Jesse Glick <jglick@cloudbees.com>", "committedDate": "2020-12-09T19:09:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQyMzI4MQ==", "url": "https://github.com/jenkinsci/jenkins/pull/5105#discussion_r540423281", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // acgegi would silently fail to write to final fields\n          \n          \n            \n                        // acegi would silently fail to write to final fields", "author": "oleg-nenashev", "createdAt": "2020-12-10T19:04:38Z", "path": "core/src/main/java/org/acegisecurity/util/FieldUtils.java", "diffHunk": "@@ -40,8 +42,14 @@ public static Object getProtectedFieldValue(String protectedField, Object object\n \n     public static void setProtectedFieldValue(String protectedField, Object object, Object newValue) {\n         try {\n-            org.apache.commons.lang.reflect.FieldUtils.writeField(object, protectedField, newValue, true);\n-        } catch (IllegalAccessException x) {\n+            // acgegi would silently fail to write to final fields", "originalCommit": "d729fa790dbc95e3a1cc97ffca18cb7774301840", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}