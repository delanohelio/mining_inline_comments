{"pr_number": 19367, "pr_title": "#19362 now submitter can be configured by code", "pr_createdAt": "2020-10-01T05:48:18Z", "pr_url": "https://github.com/dotCMS/core/pull/19367", "timeline": [{"oid": "12a4902f7631d282e477902a60816cbbff34b120", "url": "https://github.com/dotCMS/core/commit/12a4902f7631d282e477902a60816cbbff34b120", "message": "#19362 now submitter can be configured by code", "committedDate": "2020-10-01T05:47:13Z", "type": "commit"}, {"oid": "0c523f0ca434202476e0bdea7cdad2fad90f4b2e", "url": "https://github.com/dotCMS/core/commit/0c523f0ca434202476e0bdea7cdad2fad90f4b2e", "message": "#19362 now submitter can be configured by code", "committedDate": "2020-10-01T06:07:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4MTk2MA==", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498381960", "bodyText": "I would rename SubmitterConfigCreator to SubmitterConfig and SubmitterConfigCreatorBuilder to SubmitterConfigBuilder", "author": "wezell", "createdAt": "2020-10-01T16:44:31Z", "path": "dotCMS/src/main/java/com/dotcms/concurrent/DotConcurrentFactory.java", "diffHunk": "@@ -269,6 +275,28 @@ public DotSubmitter getSubmitter () {\n         return this.getSubmitter(DOT_SYSTEM_THREAD_POOL);\n     } // getSubmitter.\n \n+    /**\n+     * Register a submitter creator and gets the submitter\n+     * @param name    {@link String}\n+     * @param creator {@link SubmitterConfigCreator}\n+     * @return DotSubmitter\n+     */\n+    public DotSubmitter getSubmitter (final String name, final SubmitterConfigCreator creator) {", "originalCommit": "0c523f0ca434202476e0bdea7cdad2fad90f4b2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4MjQ4Ng==", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498382486", "bodyText": "why not use the primitives and avoid a possible npe?", "author": "wezell", "createdAt": "2020-10-01T16:45:30Z", "path": "dotCMS/src/main/java/com/dotcms/concurrent/DotConcurrentFactory.java", "diffHunk": "@@ -342,6 +379,156 @@ public IdentifierStripedLock getIdentifierStripedLock(){\n        return this.identifierStripedLock;\n     }\n \n+    /**\n+     * {@link SubmitterConfigCreator} builder\n+     */\n+    public static class SubmitterConfigCreatorBuilder {\n+\n+        private ThreadFactory            threadFactory;\n+        private RejectedExecutionHandler rejectedExecutionHandler;\n+        private Boolean allowCoreThreadTimeOut;\n+        private Integer poolSize;\n+        private Integer maxPoolSize;", "originalCommit": "0c523f0ca434202476e0bdea7cdad2fad90f4b2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "534f7f36a30c82813a980123cf47b8cbbd7828db", "url": "https://github.com/dotCMS/core/commit/534f7f36a30c82813a980123cf47b8cbbd7828db", "message": "#19362 rename class", "committedDate": "2020-10-01T17:23:15Z", "type": "commit"}, {"oid": "b46cb6a9022c38f9ad79369fa17eb0218e74c63e", "url": "https://github.com/dotCMS/core/commit/b46cb6a9022c38f9ad79369fa17eb0218e74c63e", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-19362-make-dotsubmitter-configurable", "committedDate": "2020-10-01T17:23:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwNjk2OA==", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498406968", "bodyText": "nitpick but why not instantiator or even factory instead of creator", "author": "fabrizzio-dotCMS", "createdAt": "2020-10-01T17:30:12Z", "path": "dotCMS/src/main/java/com/dotcms/concurrent/DotConcurrentFactory.java", "diffHunk": "@@ -269,6 +275,28 @@ public DotSubmitter getSubmitter () {\n         return this.getSubmitter(DOT_SYSTEM_THREAD_POOL);\n     } // getSubmitter.\n \n+    /**\n+     * Register a submitter creator and gets the submitter", "originalCommit": "b46cb6a9022c38f9ad79369fa17eb0218e74c63e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5NjE0MQ==", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498496141", "bodyText": "done", "author": "erickgonzalez", "createdAt": "2020-10-01T20:29:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwNjk2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwODY3NA==", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498408674", "bodyText": "why ignored?", "author": "fabrizzio-dotCMS", "createdAt": "2020-10-01T17:33:27Z", "path": "dotCMS/src/integration-test/java/com/dotcms/concurrent/DotConcurrentFactoryTest.java", "diffHunk": "@@ -10,6 +12,163 @@\n \n public class DotConcurrentFactoryTest {\n \n+    @Ignore\n+    @Test\n+    public void testDefaultOne_Submitter_Config() throws JSONException{\n+\n+        final String submitterName = \"testsubmitter\";\n+        final DotConcurrentFactory dotConcurrentFactory =\n+                DotConcurrentFactory.getInstance();\n+\n+        final DotSubmitter submitter =\n+                dotConcurrentFactory.getSubmitter(submitterName,\n+                        new SubmitterConfigBuilder().poolSize(2)\n+                        .maxPoolSize(4).queueCapacity(500).build()\n+                );\n+\n+        System.out.println(submitter);\n+\n+        IntStream.range(0, 40).forEach(\n+                n -> {\n+\n+                    if (n % 10 == 0) {\n+\n+                        System.out.println(submitter);\n+                    }\n+                    submitter.execute(new PrintTask(\"Thread\" + n));\n+                }\n+        );\n+\n+        //check active thread, if zero then shut down the thread pool\n+        for (;;) {\n+            int count = submitter.getActiveCount();\n+            System.out.println(\"Active Threads : \" + count);\n+            try {\n+                Thread.sleep(1000);\n+            } catch (InterruptedException e) {\n+                e.printStackTrace();\n+            }\n+            if (count == 0) {\n+                //submitter.shutdown();\n+                break;\n+            }\n+        }\n+\n+        System.out.print(\"Staring a new one submitter\");\n+\n+        final DotSubmitter submitter2 =\n+                dotConcurrentFactory.getSubmitter(submitterName);\n+\n+        System.out.println(submitter2);\n+\n+        assertTrue(submitter == submitter2);\n+\n+        IntStream.range(0, 20).forEach(\n+                n -> {\n+                    submitter2.execute(new PrintTask(\"Thread\" + n));\n+                }\n+        );\n+\n+        //check active thread, if zero then shut down the thread pool\n+        for (;;) {\n+            int count = submitter2.getActiveCount();\n+            System.out.println(\"Active Threads : \" + count);\n+            try {\n+                Thread.sleep(1000);\n+            } catch (InterruptedException e) {\n+                e.printStackTrace();\n+            }\n+            if (count == 0) {\n+                submitter2.shutdown();\n+                break;\n+            }\n+        }\n+\n+    }\n+\n+    @Ignore", "originalCommit": "b46cb6a9022c38f9ad79369fa17eb0218e74c63e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5NjI0NA==", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498496244", "bodyText": "removed", "author": "erickgonzalez", "createdAt": "2020-10-01T20:29:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwODY3NA=="}], "type": "inlineReview"}, {"oid": "3e78a8e9959e3b8a4d984ae9f648f16a2a76fb12", "url": "https://github.com/dotCMS/core/commit/3e78a8e9959e3b8a4d984ae9f648f16a2a76fb12", "message": "#19362 feedback", "committedDate": "2020-10-01T20:22:08Z", "type": "commit"}, {"oid": "a1983e6dc62107cbd2b29637b8939bbc10665863", "url": "https://github.com/dotCMS/core/commit/a1983e6dc62107cbd2b29637b8939bbc10665863", "message": "#19362 feedback", "committedDate": "2020-10-01T20:28:38Z", "type": "commit"}]}