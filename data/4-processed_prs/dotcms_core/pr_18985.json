{"pr_number": 18985, "pr_title": "Issue 18962", "pr_createdAt": "2020-07-28T14:50:52Z", "pr_url": "https://github.com/dotCMS/core/pull/18985", "timeline": [{"oid": "439e212b2a68c0bc776417a5041d18baf0ccb35c", "url": "https://github.com/dotCMS/core/commit/439e212b2a68c0bc776417a5041d18baf0ccb35c", "message": "#18962 EMA plugin code", "committedDate": "2020-07-24T00:17:16Z", "type": "commit"}, {"oid": "4d59d3bf735a9fc75b64963f552b14bd70a6ef88", "url": "https://github.com/dotCMS/core/commit/4d59d3bf735a9fc75b64963f552b14bd70a6ef88", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18962", "committedDate": "2020-07-27T15:51:34Z", "type": "commit"}, {"oid": "7295c1f1111e91fc303de5b9cf92819a768e433c", "url": "https://github.com/dotCMS/core/commit/7295c1f1111e91fc303de5b9cf92819a768e433c", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18962", "committedDate": "2020-07-28T14:41:09Z", "type": "commit"}, {"oid": "3c741416b451f804a317e3d254b40debe521d904", "url": "https://github.com/dotCMS/core/commit/3c741416b451f804a317e3d254b40debe521d904", "message": "#18962 make EMA works with apps", "committedDate": "2020-07-28T14:43:46Z", "type": "commit"}, {"oid": "19c34d9637447586ecdd20c68065aed03a42800d", "url": "https://github.com/dotCMS/core/commit/19c34d9637447586ecdd20c68065aed03a42800d", "message": "#18962 IT", "committedDate": "2020-07-28T14:44:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY1NTc0Mw==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r461655743", "bodyText": "Can't we just use com.dotmarketing.business.web.HostWebAPI#getCurrentHost(javax.servlet.http.HttpServletRequest, com.liferay.portal.model.User) ?", "author": "dsilvam", "createdAt": "2020-07-28T15:05:31Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,208 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+\n+import org.apache.http.Header;\n+\n+import com.dotcms.business.CloseDBIfOpened;\n+import com.dotcms.ema.proxy.MockHttpCaptureResponse;\n+import com.dotcms.ema.proxy.ProxyResponse;\n+import com.dotcms.ema.proxy.ProxyTool;\n+import com.dotcms.filters.interceptor.Result;\n+import com.dotcms.filters.interceptor.WebInterceptor;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.UserWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.dotmarketing.util.json.JSONObject;\n+import com.google.common.collect.ImmutableMap;\n+import com.liferay.portal.model.User;\n+\n+public class EMAWebInterceptor  implements WebInterceptor{\n+\n+    public  static final String      PROXY_EDIT_MODE_URL_VAR = \"proxyEditModeURL\";\n+    private static final String      API_CALL                = \"/api/v1/page/render\";\n+    public static final String EMA_APP_CONFIG_KEY = \"dotema-config\";\n+    private static final ProxyTool   proxy                   = new ProxyTool();\n+\n+\n+    @Override\n+    public String[] getFilters() {\n+        return new String[] {\n+                API_CALL + \"*\"\n+        };\n+    }\n+\n+    @Override\n+    public Result intercept(final HttpServletRequest request, final HttpServletResponse response) throws IOException {\n+\n+        final Host currentHost = getCurrentHost(request);\n+\n+        if (!this.existsConfiguration(currentHost.getIdentifier())) {\n+            return Result.NEXT;\n+        }\n+\n+        final Optional<String> proxyUrl = proxyUrl(currentHost);\n+        final PageMode mode             = PageMode.get(request);\n+\n+        if (!proxyUrl.isPresent() || mode == PageMode.LIVE) {\n+            return Result.NEXT;\n+        }\n+\n+        Logger.info(this.getClass(), \"GOT AN EMA Call --> \" + request.getRequestURI());\n+\n+        return new Result.Builder().wrap(new MockHttpCaptureResponse(response)).next().build();\n+    }\n+\n+\n+    @Override\n+    public boolean afterIntercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        try {\n+\n+            if (response instanceof MockHttpCaptureResponse) {\n+\n+                final Host currentHost = getCurrentHost(request);\n+                final Optional<String> proxyUrl            = proxyUrl(currentHost);\n+                final MockHttpCaptureResponse mockResponse = (MockHttpCaptureResponse)response;\n+                final String postJson                      = new String(mockResponse.getBytes());\n+                final JSONObject json                      = new JSONObject(postJson);\n+                final Map<String, String> params           = ImmutableMap.of(\"dotPageData\", postJson);\n+                \n+                Logger.info(this.getClass(), \"Proxying Request --> \" + proxyUrl.get());\n+                \n+                String responseStr = new String();\n+                final ProxyResponse pResponse = proxy.sendPost(proxyUrl.get(), params);\n+\n+                if (pResponse.getResponseCode() == 200) {\n+                    responseStr = new String(pResponse.getResponse());\n+                }else {\n+                    responseStr+=\"<html><body>\";\n+                    responseStr+=\"<h3>Unable to connect with the rendering engine</h3>\";\n+                    responseStr+=\"<br><div style='display:inline-block;width:80px'>Trying: </div><b>\" + proxyUrl.get()  + \"</b>\";\n+                    responseStr+=\"<br><div style='display:inline-block;width:80px'>Got:</div><b>\" + pResponse.getStatus() + \"</b>\";\n+                    responseStr+=\"<hr>\";\n+                    responseStr+=\"<h4>Headers</h4>\";\n+                    responseStr+=\"<table border=1 style='min-width:500px'>\";\n+\n+                    for(Header header : pResponse.getHeaders()) {\n+                      responseStr+=\"<tr><td style='font-weight:bold;padding:5px;'><pre>\" + header.getName() + \"</pre></td><td><pre>\" + header.getValue() + \"</td></tr>\";\n+                    }\n+                    responseStr+=\"</table>\";\n+                    \n+                    responseStr+=\"<p>The Json Payload, POSTing as Content-Type:'application/x-www-form-urlencoded' with form param <b>dotPageData</b>, has been printed in the logs.</p>\";\n+                    responseStr+=\"</body></html>\";\n+\n+                }\n+\n+                json.getJSONObject(\"entity\").getJSONObject(\"page\").put(\"rendered\", responseStr);\n+                json.getJSONObject(\"entity\").getJSONObject(\"page\").put(\"remoteRendered\", true);\n+                response.setContentType(\"application/json\");\n+\n+                response.getWriter().write(json.toString());\n+            }\n+        } catch (Exception e) {\n+            Logger.error(this, e.getMessage());\n+        }\n+\n+        return true;\n+    }\n+\n+\n+    /**\n+     * Gets the proxyUrl for the given host\n+     * @param currentHost current Host to get the proxyUrl value\n+     * @return Optional String of the proxyUrl, if there is not found or an error is thrown returns an empty\n+     */\n+    private Optional<String> proxyUrl(final Host currentHost) {\n+        AppSecrets appSecrets = null;\n+\n+        try{\n+            appSecrets = APILocator.getAppsAPI().getSecrets(EMA_APP_CONFIG_KEY,\n+                    true, currentHost, APILocator.systemUser()).get();\n+            return appSecrets.getSecrets().containsKey(PROXY_EDIT_MODE_URL_VAR)?\n+                    Optional.ofNullable(appSecrets.getSecrets().get(PROXY_EDIT_MODE_URL_VAR).getString()) : Optional.empty();\n+\n+        } catch (DotSecurityException | DotDataException e) {\n+            Logger.error(this, e.getMessage());\n+            return Optional.empty();\n+        } finally {\n+            if(UtilMethods.isSet(appSecrets)){\n+                appSecrets.destroy();\n+            }\n+        }\n+    }\n+\n+\n+    @CloseDBIfOpened\n+    private Host getCurrentHost(HttpServletRequest request) {", "originalCommit": "19c34d9637447586ecdd20c68065aed03a42800d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkwMTYyOQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r461901629", "bodyText": "done", "author": "erickgonzalez", "createdAt": "2020-07-28T21:47:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY1NTc0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY3ODgyMg==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r461678822", "bodyText": "Doc", "author": "jdotcms", "createdAt": "2020-07-28T15:37:36Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,208 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+\n+import org.apache.http.Header;\n+\n+import com.dotcms.business.CloseDBIfOpened;\n+import com.dotcms.ema.proxy.MockHttpCaptureResponse;\n+import com.dotcms.ema.proxy.ProxyResponse;\n+import com.dotcms.ema.proxy.ProxyTool;\n+import com.dotcms.filters.interceptor.Result;\n+import com.dotcms.filters.interceptor.WebInterceptor;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.UserWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.dotmarketing.util.json.JSONObject;\n+import com.google.common.collect.ImmutableMap;\n+import com.liferay.portal.model.User;\n+\n+public class EMAWebInterceptor  implements WebInterceptor{", "originalCommit": "19c34d9637447586ecdd20c68065aed03a42800d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MDYzNw==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r461790637", "bodyText": "done", "author": "erickgonzalez", "createdAt": "2020-07-28T18:36:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY3ODgyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY4MDE2OA==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r461680168", "bodyText": "set to final", "author": "jdotcms", "createdAt": "2020-07-28T15:39:31Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,208 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+\n+import org.apache.http.Header;\n+\n+import com.dotcms.business.CloseDBIfOpened;\n+import com.dotcms.ema.proxy.MockHttpCaptureResponse;\n+import com.dotcms.ema.proxy.ProxyResponse;\n+import com.dotcms.ema.proxy.ProxyTool;\n+import com.dotcms.filters.interceptor.Result;\n+import com.dotcms.filters.interceptor.WebInterceptor;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.UserWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.dotmarketing.util.json.JSONObject;\n+import com.google.common.collect.ImmutableMap;\n+import com.liferay.portal.model.User;\n+\n+public class EMAWebInterceptor  implements WebInterceptor{\n+\n+    public  static final String      PROXY_EDIT_MODE_URL_VAR = \"proxyEditModeURL\";\n+    private static final String      API_CALL                = \"/api/v1/page/render\";\n+    public static final String EMA_APP_CONFIG_KEY = \"dotema-config\";\n+    private static final ProxyTool   proxy                   = new ProxyTool();\n+\n+\n+    @Override\n+    public String[] getFilters() {\n+        return new String[] {\n+                API_CALL + \"*\"\n+        };\n+    }\n+\n+    @Override\n+    public Result intercept(final HttpServletRequest request, final HttpServletResponse response) throws IOException {\n+\n+        final Host currentHost = getCurrentHost(request);\n+\n+        if (!this.existsConfiguration(currentHost.getIdentifier())) {\n+            return Result.NEXT;\n+        }\n+\n+        final Optional<String> proxyUrl = proxyUrl(currentHost);\n+        final PageMode mode             = PageMode.get(request);\n+\n+        if (!proxyUrl.isPresent() || mode == PageMode.LIVE) {\n+            return Result.NEXT;\n+        }\n+\n+        Logger.info(this.getClass(), \"GOT AN EMA Call --> \" + request.getRequestURI());\n+\n+        return new Result.Builder().wrap(new MockHttpCaptureResponse(response)).next().build();\n+    }\n+\n+\n+    @Override\n+    public boolean afterIntercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        try {\n+\n+            if (response instanceof MockHttpCaptureResponse) {\n+\n+                final Host currentHost = getCurrentHost(request);\n+                final Optional<String> proxyUrl            = proxyUrl(currentHost);\n+                final MockHttpCaptureResponse mockResponse = (MockHttpCaptureResponse)response;\n+                final String postJson                      = new String(mockResponse.getBytes());\n+                final JSONObject json                      = new JSONObject(postJson);\n+                final Map<String, String> params           = ImmutableMap.of(\"dotPageData\", postJson);\n+                \n+                Logger.info(this.getClass(), \"Proxying Request --> \" + proxyUrl.get());\n+                \n+                String responseStr = new String();\n+                final ProxyResponse pResponse = proxy.sendPost(proxyUrl.get(), params);\n+\n+                if (pResponse.getResponseCode() == 200) {\n+                    responseStr = new String(pResponse.getResponse());\n+                }else {\n+                    responseStr+=\"<html><body>\";\n+                    responseStr+=\"<h3>Unable to connect with the rendering engine</h3>\";\n+                    responseStr+=\"<br><div style='display:inline-block;width:80px'>Trying: </div><b>\" + proxyUrl.get()  + \"</b>\";\n+                    responseStr+=\"<br><div style='display:inline-block;width:80px'>Got:</div><b>\" + pResponse.getStatus() + \"</b>\";\n+                    responseStr+=\"<hr>\";\n+                    responseStr+=\"<h4>Headers</h4>\";\n+                    responseStr+=\"<table border=1 style='min-width:500px'>\";\n+\n+                    for(Header header : pResponse.getHeaders()) {", "originalCommit": "19c34d9637447586ecdd20c68065aed03a42800d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5Nzc0MQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r461797741", "bodyText": "done", "author": "erickgonzalez", "createdAt": "2020-07-28T18:49:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY4MDE2OA=="}], "type": "inlineReview"}, {"oid": "2efefd5dd5785fe527f5a7ca169841d5b0462acb", "url": "https://github.com/dotCMS/core/commit/2efefd5dd5785fe527f5a7ca169841d5b0462acb", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18962", "committedDate": "2020-07-28T21:35:10Z", "type": "commit"}, {"oid": "43d59011e9a8bbc7e9e94bf2637e9ffaaf52090e", "url": "https://github.com/dotCMS/core/commit/43d59011e9a8bbc7e9e94bf2637e9ffaaf52090e", "message": "#18962 feedback changes", "committedDate": "2020-07-28T21:46:45Z", "type": "commit"}, {"oid": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "url": "https://github.com/dotCMS/core/commit/ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18962", "committedDate": "2020-07-31T15:42:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDg4MQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690881", "bodyText": "Codacy found an issue: StringBuffer (or StringBuilder).append is called 4 consecutive times with literals. Use a single append with a single combined String.", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:04Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+\n+import org.apache.http.Header;\n+\n+import com.dotcms.business.CloseDBIfOpened;\n+import com.dotcms.ema.proxy.MockHttpCaptureResponse;\n+import com.dotcms.ema.proxy.ProxyResponse;\n+import com.dotcms.ema.proxy.ProxyTool;\n+import com.dotcms.filters.interceptor.Result;\n+import com.dotcms.filters.interceptor.WebInterceptor;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.UserWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.dotmarketing.util.json.JSONObject;\n+import com.google.common.collect.ImmutableMap;\n+import com.liferay.portal.model.User;\n+\n+/**\n+ * Intercepts a content managers's request to dotCMS EDIT_MODE in the admin of dotCMS,\n+ * transparently POSTs the dotCMS page API data to the remote site/server (hosted elsewhere) and\n+ * then proxies the remote response back to the dotCMS admin, which allows dotCMS\n+ * to render the EDIT_MODE request in context.\n+ *\n+ * More info on how EMA works https://github.com/dotcms-plugins/com.dotcms.ema#dotcms-edit-mode-anywhere---ema\n+ */\n+public class EMAWebInterceptor  implements WebInterceptor{\n+\n+    public  static final String      PROXY_EDIT_MODE_URL_VAR = \"proxyEditModeURL\";\n+    private static final String      API_CALL                = \"/api/v1/page/render\";\n+    public static final String EMA_APP_CONFIG_KEY = \"dotema-config\";\n+    private static final ProxyTool   proxy                   = new ProxyTool();\n+\n+\n+    @Override\n+    public String[] getFilters() {\n+        return new String[] {\n+                API_CALL + \"*\"\n+        };\n+    }\n+\n+    @Override\n+    public Result intercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        final Host currentHost = WebAPILocator.getHostWebAPI().getCurrentHostNoThrow(request);\n+\n+        if (!this.existsConfiguration(currentHost.getIdentifier())) {\n+            return Result.NEXT;\n+        }\n+\n+        final Optional<String> proxyUrl = proxyUrl(currentHost);\n+        final PageMode mode             = PageMode.get(request);\n+\n+        if (!proxyUrl.isPresent() || mode == PageMode.LIVE) {\n+            return Result.NEXT;\n+        }\n+\n+        Logger.info(this.getClass(), \"GOT AN EMA Call --> \" + request.getRequestURI());\n+\n+        return new Result.Builder().wrap(new MockHttpCaptureResponse(response)).next().build();\n+    }\n+\n+\n+    @Override\n+    public boolean afterIntercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        try {\n+\n+            if (response instanceof MockHttpCaptureResponse) {\n+\n+                final Host currentHost = WebAPILocator.getHostWebAPI().getCurrentHostNoThrow(request);\n+                final Optional<String> proxyUrl            = proxyUrl(currentHost);\n+                final MockHttpCaptureResponse mockResponse = (MockHttpCaptureResponse)response;\n+                final String postJson                      = new String(mockResponse.getBytes());\n+                final JSONObject json                      = new JSONObject(postJson);\n+                final Map<String, String> params           = ImmutableMap.of(\"dotPageData\", postJson);\n+                \n+                Logger.info(this.getClass(), \"Proxying Request --> \" + proxyUrl.get());\n+\n+                final StringBuilder responseStringBuilder = new StringBuilder();\n+                final ProxyResponse pResponse = proxy.sendPost(proxyUrl.get(), params);\n+\n+                if (pResponse.getResponseCode() == 200) {\n+                    responseStringBuilder.append(pResponse.getResponse());\n+                }else {\n+                    responseStringBuilder.append(\"<html><body>\")\n+                    .append(\"<h3>Unable to connect with the rendering engine</h3>\")\n+                    .append(\"<br><div style='display:inline-block;width:80px'>Trying: </div><b>\" + proxyUrl.get()  + \"</b>\")\n+                    .append(\"<br><div style='display:inline-block;width:80px'>Got:</div><b>\" + pResponse.getStatus() + \"</b>\")", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDg5Ng==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690896", "bodyText": "Codacy found an issue: Avoid variables with short names like os", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:05Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/MockServletOutputStream.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.OutputStream;\n+\n+import javax.servlet.ServletOutputStream;\n+import javax.servlet.WriteListener;\n+\n+/**\n+ * A mock Outputstream that will write the output of a servlet to a outputstream\n+ * \n+ * @author will\n+ *\n+ */\n+class MockServletOutputStream extends ServletOutputStream {\n+    final OutputStream os;", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDkwNw==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690907", "bodyText": "Codacy found an issue: Avoid unused imports such as 'java.io.IOException'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:06Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDkyMA==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690920", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'url'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:07Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");\n+                try {\n+                    queryPairs.put(URLDecoder.decode(pair.substring(0, idx), \"UTF-8\"), URLDecoder.decode(pair.substring(idx + 1), \"UTF-8\"));\n+                } catch (UnsupportedEncodingException e) {\n+                    throw new DotRuntimeException(e);\n+                }\n+            }\n+        }\n+        return send(url, queryPairs, method, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     * @param creds - A credentials object for authenticated requests. @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDkzNA==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690934", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'url'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:08Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");\n+                try {\n+                    queryPairs.put(URLDecoder.decode(pair.substring(0, idx), \"UTF-8\"), URLDecoder.decode(pair.substring(idx + 1), \"UTF-8\"));\n+                } catch (UnsupportedEncodingException e) {\n+                    throw new DotRuntimeException(e);\n+                }\n+            }\n+        }\n+        return send(url, queryPairs, method, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     * @param creds - A credentials object for authenticated requests. @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, String contentType) {\n+        return send(url, params, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params, String contentType) {\n+        return send(url, params, METHOD_HEAD, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_HEAD, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDk0Mg==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690942", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'url'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:09Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");\n+                try {\n+                    queryPairs.put(URLDecoder.decode(pair.substring(0, idx), \"UTF-8\"), URLDecoder.decode(pair.substring(idx + 1), \"UTF-8\"));\n+                } catch (UnsupportedEncodingException e) {\n+                    throw new DotRuntimeException(e);\n+                }\n+            }\n+        }\n+        return send(url, queryPairs, method, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     * @param creds - A credentials object for authenticated requests. @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Credentials creds) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDk0OQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690949", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'url'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:10Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");\n+                try {\n+                    queryPairs.put(URLDecoder.decode(pair.substring(0, idx), \"UTF-8\"), URLDecoder.decode(pair.substring(idx + 1), \"UTF-8\"));\n+                } catch (UnsupportedEncodingException e) {\n+                    throw new DotRuntimeException(e);\n+                }\n+            }\n+        }\n+        return send(url, queryPairs, method, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     * @param creds - A credentials object for authenticated requests. @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, String contentType) {\n+        return send(url, params, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params, String contentType) {\n+        return send(url, params, METHOD_HEAD, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_HEAD, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_DELETE, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, String params, String contentType) {\n+        return send(url, params, METHOD_DELETE, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendDelete(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_DELETE, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendDelete(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_DELETE, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_DELETE, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, String params) {\n+        return send(url, params, METHOD_DELETE, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendDelete(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_DELETE, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendDelete(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_DELETE, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, Credentials creds) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDk2NA==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690964", "bodyText": "Codacy found an issue: Avoid variables with short names like m", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:12Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDk3Ng==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690976", "bodyText": "Codacy found an issue: Avoid using redundant field initializer for 'out'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:13Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/MockHttpCaptureResponse.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.PrintWriter;\n+\n+import javax.servlet.ServletOutputStream;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpServletResponseWrapper;\n+\n+import com.dotcms.mock.response.MockResponse;\n+\n+\n+/**\n+ * Proxy for HTTPServletResponse\n+ *\n+ */\n+public class MockHttpCaptureResponse extends HttpServletResponseWrapper implements MockResponse {\n+\n+\n+    ByteArrayOutputStream bout = new ByteArrayOutputStream(4096);\n+    ServletOutputStream out = null;", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDk4NQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690985", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'url'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:14Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");\n+                try {\n+                    queryPairs.put(URLDecoder.decode(pair.substring(0, idx), \"UTF-8\"), URLDecoder.decode(pair.substring(idx + 1), \"UTF-8\"));\n+                } catch (UnsupportedEncodingException e) {\n+                    throw new DotRuntimeException(e);\n+                }\n+            }\n+        }\n+        return send(url, queryPairs, method, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     * @param creds - A credentials object for authenticated requests. @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, String contentType) {\n+        return send(url, params, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params, String contentType) {\n+        return send(url, params, METHOD_HEAD, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_HEAD, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, String params) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendHead(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a head request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendHead(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_HEAD, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_DELETE, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, String params, String contentType) {\n+        return send(url, params, METHOD_DELETE, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendDelete(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_DELETE, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendDelete(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_DELETE, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_DELETE, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, String params) {\n+        return send(url, params, METHOD_DELETE, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendDelete(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_DELETE, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendDelete(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_DELETE, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendDelete(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_DELETE, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a delete request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendDelete(String url) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MDk5Mg==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463690992", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'url'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:15Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");\n+                try {\n+                    queryPairs.put(URLDecoder.decode(pair.substring(0, idx), \"UTF-8\"), URLDecoder.decode(pair.substring(idx + 1), \"UTF-8\"));\n+                } catch (UnsupportedEncodingException e) {\n+                    throw new DotRuntimeException(e);\n+                }\n+            }\n+        }\n+        return send(url, queryPairs, method, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     * @param creds - A credentials object for authenticated requests. @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, Credentials creds) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTAwNQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691005", "bodyText": "Codacy found an issue: Avoid variables with short names like m", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:16Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTAxNQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691015", "bodyText": "Codacy found an issue: Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:17Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+\n+import org.apache.http.Header;\n+\n+import com.dotcms.business.CloseDBIfOpened;\n+import com.dotcms.ema.proxy.MockHttpCaptureResponse;\n+import com.dotcms.ema.proxy.ProxyResponse;\n+import com.dotcms.ema.proxy.ProxyTool;\n+import com.dotcms.filters.interceptor.Result;\n+import com.dotcms.filters.interceptor.WebInterceptor;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.UserWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.dotmarketing.util.json.JSONObject;\n+import com.google.common.collect.ImmutableMap;\n+import com.liferay.portal.model.User;\n+\n+/**\n+ * Intercepts a content managers's request to dotCMS EDIT_MODE in the admin of dotCMS,\n+ * transparently POSTs the dotCMS page API data to the remote site/server (hosted elsewhere) and\n+ * then proxies the remote response back to the dotCMS admin, which allows dotCMS\n+ * to render the EDIT_MODE request in context.\n+ *\n+ * More info on how EMA works https://github.com/dotcms-plugins/com.dotcms.ema#dotcms-edit-mode-anywhere---ema\n+ */\n+public class EMAWebInterceptor  implements WebInterceptor{\n+\n+    public  static final String      PROXY_EDIT_MODE_URL_VAR = \"proxyEditModeURL\";\n+    private static final String      API_CALL                = \"/api/v1/page/render\";\n+    public static final String EMA_APP_CONFIG_KEY = \"dotema-config\";\n+    private static final ProxyTool   proxy                   = new ProxyTool();\n+\n+\n+    @Override\n+    public String[] getFilters() {\n+        return new String[] {\n+                API_CALL + \"*\"\n+        };\n+    }\n+\n+    @Override\n+    public Result intercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        final Host currentHost = WebAPILocator.getHostWebAPI().getCurrentHostNoThrow(request);\n+\n+        if (!this.existsConfiguration(currentHost.getIdentifier())) {\n+            return Result.NEXT;\n+        }\n+\n+        final Optional<String> proxyUrl = proxyUrl(currentHost);\n+        final PageMode mode             = PageMode.get(request);\n+\n+        if (!proxyUrl.isPresent() || mode == PageMode.LIVE) {\n+            return Result.NEXT;\n+        }\n+\n+        Logger.info(this.getClass(), \"GOT AN EMA Call --> \" + request.getRequestURI());\n+\n+        return new Result.Builder().wrap(new MockHttpCaptureResponse(response)).next().build();\n+    }\n+\n+\n+    @Override\n+    public boolean afterIntercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        try {\n+\n+            if (response instanceof MockHttpCaptureResponse) {\n+\n+                final Host currentHost = WebAPILocator.getHostWebAPI().getCurrentHostNoThrow(request);\n+                final Optional<String> proxyUrl            = proxyUrl(currentHost);\n+                final MockHttpCaptureResponse mockResponse = (MockHttpCaptureResponse)response;\n+                final String postJson                      = new String(mockResponse.getBytes());\n+                final JSONObject json                      = new JSONObject(postJson);\n+                final Map<String, String> params           = ImmutableMap.of(\"dotPageData\", postJson);\n+                \n+                Logger.info(this.getClass(), \"Proxying Request --> \" + proxyUrl.get());\n+\n+                final StringBuilder responseStringBuilder = new StringBuilder();\n+                final ProxyResponse pResponse = proxy.sendPost(proxyUrl.get(), params);\n+\n+                if (pResponse.getResponseCode() == 200) {\n+                    responseStringBuilder.append(pResponse.getResponse());\n+                }else {\n+                    responseStringBuilder.append(\"<html><body>\")\n+                    .append(\"<h3>Unable to connect with the rendering engine</h3>\")\n+                    .append(\"<br><div style='display:inline-block;width:80px'>Trying: </div><b>\" + proxyUrl.get()  + \"</b>\")\n+                    .append(\"<br><div style='display:inline-block;width:80px'>Got:</div><b>\" + pResponse.getStatus() + \"</b>\")\n+                    .append(\"<hr>\")\n+                    .append(\"<h4>Headers</h4>\")\n+                    .append(\"<table border=1 style='min-width:500px'>\");\n+\n+                    for(final Header header : pResponse.getHeaders()) {\n+                        responseStringBuilder.append(\"<tr><td style='font-weight:bold;padding:5px;'><pre>\" + header.getName() + \"</pre></td><td><pre>\" + header.getValue() + \"</td></tr>\");\n+                    }\n+                    responseStringBuilder.append(\"</table>\")\n+                    .append(\"<p>The Json Payload, POSTing as Content-Type:'application/x-www-form-urlencoded' with form param <b>dotPageData</b>, has been printed in the logs.</p>\")\n+                    .append(\"</body></html>\");\n+\n+                }\n+\n+                json.getJSONObject(\"entity\").getJSONObject(\"page\").put(\"rendered\", responseStringBuilder.toString());\n+                json.getJSONObject(\"entity\").getJSONObject(\"page\").put(\"remoteRendered\", true);\n+                response.setContentType(\"application/json\");\n+\n+                response.getWriter().write(json.toString());\n+            }\n+        } catch (Exception e) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTAyMg==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691022", "bodyText": "Codacy found an issue: Consider using varargs for methods or constructors which take an array the last parameter.", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:18Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyResponse.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package com.dotcms.ema.proxy;\n+\n+import org.apache.http.Header;\n+import org.apache.http.ProtocolVersion;\n+import org.apache.http.StatusLine;\n+\n+public class ProxyResponse {\n+\n+  /**\n+   * The Response.\n+   */\n+  final private byte[] response;\n+  final private StatusLine status;\n+  final private int responseCode;\n+  final private Header[] headers;\n+\n+  public ProxyResponse(StatusLine status, byte[] out, Header[] headers) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTAzMA==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691030", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'url'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:19Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");\n+                try {\n+                    queryPairs.put(URLDecoder.decode(pair.substring(0, idx), \"UTF-8\"), URLDecoder.decode(pair.substring(idx + 1), \"UTF-8\"));\n+                } catch (UnsupportedEncodingException e) {\n+                    throw new DotRuntimeException(e);\n+                }\n+            }\n+        }\n+        return send(url, queryPairs, method, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     * @param creds - A credentials object for authenticated requests. @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Put a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse putStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, String contentType) {\n+        return send(url, params, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_PUT, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_PUT, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, String params) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPut(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_PUT, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a put request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPut(String url, Credentials creds) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTAzOA==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691038", "bodyText": "Codacy found an issue: StringBuffer (or StringBuilder).append is called 3 consecutive times with literals. Use a single append with a single combined String.", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:21Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+\n+import org.apache.http.Header;\n+\n+import com.dotcms.business.CloseDBIfOpened;\n+import com.dotcms.ema.proxy.MockHttpCaptureResponse;\n+import com.dotcms.ema.proxy.ProxyResponse;\n+import com.dotcms.ema.proxy.ProxyTool;\n+import com.dotcms.filters.interceptor.Result;\n+import com.dotcms.filters.interceptor.WebInterceptor;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.UserWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.dotmarketing.util.json.JSONObject;\n+import com.google.common.collect.ImmutableMap;\n+import com.liferay.portal.model.User;\n+\n+/**\n+ * Intercepts a content managers's request to dotCMS EDIT_MODE in the admin of dotCMS,\n+ * transparently POSTs the dotCMS page API data to the remote site/server (hosted elsewhere) and\n+ * then proxies the remote response back to the dotCMS admin, which allows dotCMS\n+ * to render the EDIT_MODE request in context.\n+ *\n+ * More info on how EMA works https://github.com/dotcms-plugins/com.dotcms.ema#dotcms-edit-mode-anywhere---ema\n+ */\n+public class EMAWebInterceptor  implements WebInterceptor{\n+\n+    public  static final String      PROXY_EDIT_MODE_URL_VAR = \"proxyEditModeURL\";\n+    private static final String      API_CALL                = \"/api/v1/page/render\";\n+    public static final String EMA_APP_CONFIG_KEY = \"dotema-config\";\n+    private static final ProxyTool   proxy                   = new ProxyTool();\n+\n+\n+    @Override\n+    public String[] getFilters() {\n+        return new String[] {\n+                API_CALL + \"*\"\n+        };\n+    }\n+\n+    @Override\n+    public Result intercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        final Host currentHost = WebAPILocator.getHostWebAPI().getCurrentHostNoThrow(request);\n+\n+        if (!this.existsConfiguration(currentHost.getIdentifier())) {\n+            return Result.NEXT;\n+        }\n+\n+        final Optional<String> proxyUrl = proxyUrl(currentHost);\n+        final PageMode mode             = PageMode.get(request);\n+\n+        if (!proxyUrl.isPresent() || mode == PageMode.LIVE) {\n+            return Result.NEXT;\n+        }\n+\n+        Logger.info(this.getClass(), \"GOT AN EMA Call --> \" + request.getRequestURI());\n+\n+        return new Result.Builder().wrap(new MockHttpCaptureResponse(response)).next().build();\n+    }\n+\n+\n+    @Override\n+    public boolean afterIntercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        try {\n+\n+            if (response instanceof MockHttpCaptureResponse) {\n+\n+                final Host currentHost = WebAPILocator.getHostWebAPI().getCurrentHostNoThrow(request);\n+                final Optional<String> proxyUrl            = proxyUrl(currentHost);\n+                final MockHttpCaptureResponse mockResponse = (MockHttpCaptureResponse)response;\n+                final String postJson                      = new String(mockResponse.getBytes());\n+                final JSONObject json                      = new JSONObject(postJson);\n+                final Map<String, String> params           = ImmutableMap.of(\"dotPageData\", postJson);\n+                \n+                Logger.info(this.getClass(), \"Proxying Request --> \" + proxyUrl.get());\n+\n+                final StringBuilder responseStringBuilder = new StringBuilder();\n+                final ProxyResponse pResponse = proxy.sendPost(proxyUrl.get(), params);\n+\n+                if (pResponse.getResponseCode() == 200) {\n+                    responseStringBuilder.append(pResponse.getResponse());\n+                }else {\n+                    responseStringBuilder.append(\"<html><body>\")", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTA0OA==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691048", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotcms.business.CloseDBIfOpened'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:22Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+\n+import org.apache.http.Header;\n+\n+import com.dotcms.business.CloseDBIfOpened;", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTA2MA==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691060", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.util.WebKeys'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:24Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+\n+import org.apache.http.Header;\n+\n+import com.dotcms.business.CloseDBIfOpened;\n+import com.dotcms.ema.proxy.MockHttpCaptureResponse;\n+import com.dotcms.ema.proxy.ProxyResponse;\n+import com.dotcms.ema.proxy.ProxyTool;\n+import com.dotcms.filters.interceptor.Result;\n+import com.dotcms.filters.interceptor.WebInterceptor;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.UserWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTA3Mw==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691073", "bodyText": "Codacy found an issue: Returning 'response' may expose an internal array.", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:25Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyResponse.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package com.dotcms.ema.proxy;\n+\n+import org.apache.http.Header;\n+import org.apache.http.ProtocolVersion;\n+import org.apache.http.StatusLine;\n+\n+public class ProxyResponse {\n+\n+  /**\n+   * The Response.\n+   */\n+  final private byte[] response;\n+  final private StatusLine status;\n+  final private int responseCode;\n+  final private Header[] headers;\n+\n+  public ProxyResponse(StatusLine status, byte[] out, Header[] headers) {\n+    this.response = out;\n+    this.status = status;\n+    this.responseCode = status.getStatusCode();\n+    this.headers = headers;\n+  }\n+\n+  public ProxyResponse(final int responseCode, byte[] out, Header[] headers) {\n+    this(new StatusLine() {\n+      @Override\n+      public int getStatusCode() {\n+        return responseCode;\n+      }\n+\n+      @Override\n+      public String getReasonPhrase() {\n+        return \"unknown error\";\n+      }\n+\n+      @Override\n+      public ProtocolVersion getProtocolVersion() {\n+        return null;\n+      }\n+    }, out, headers);\n+\n+  }\n+\n+  public byte[] getResponse() {\n+    return this.response;", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTA4MQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691081", "bodyText": "Codacy found an issue: Avoid variables with short names like m", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:25Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTA5MA==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691090", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'url'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:26Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");\n+                try {\n+                    queryPairs.put(URLDecoder.decode(pair.substring(0, idx), \"UTF-8\"), URLDecoder.decode(pair.substring(idx + 1), \"UTF-8\"));\n+                } catch (UnsupportedEncodingException e) {\n+                    throw new DotRuntimeException(e);\n+                }\n+            }\n+        }\n+        return send(url, queryPairs, method, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     * @param creds - A credentials object for authenticated requests. @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     * @param contentType - The content type for this request @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_GET, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_GET, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendGet(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendGet(String url) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, String contentType) {\n+        return sendStringData(url, data, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Post a Single String payload to a url. Used to send json or xml data.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse postStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType, Credentials creds) {\n+        return send(url, params, METHOD_POST, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendPost(String url, Map<String, String> params, String contentType) {\n+        return send(url, params, METHOD_POST, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, String params) {\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url, Credentials creds) {\n+        String params = \"\";\n+        if (url.contains(\"?\")) {\n+            int idx = url.indexOf(\"?\");\n+            params = url.substring(idx + 1);\n+            url = url.substring(0, idx);\n+        }\n+        return send(url, params, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a post request to a url.\n+     *\n+     * @param url - The URL\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse sendPost(String url) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTEwMQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691101", "bodyText": "Codacy found an issue: The user-supplied array 'headers' is stored directly.", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:27Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyResponse.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package com.dotcms.ema.proxy;\n+\n+import org.apache.http.Header;\n+import org.apache.http.ProtocolVersion;\n+import org.apache.http.StatusLine;\n+\n+public class ProxyResponse {\n+\n+  /**\n+   * The Response.\n+   */\n+  final private byte[] response;\n+  final private StatusLine status;\n+  final private int responseCode;\n+  final private Header[] headers;\n+\n+  public ProxyResponse(StatusLine status, byte[] out, Header[] headers) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTEwOQ==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691109", "bodyText": "Codacy found an issue: Avoid reassigning parameters such as 'url'", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:28Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");\n+                try {\n+                    queryPairs.put(URLDecoder.decode(pair.substring(0, idx), \"UTF-8\"), URLDecoder.decode(pair.substring(idx + 1), \"UTF-8\"));\n+                } catch (UnsupportedEncodingException e) {\n+                    throw new DotRuntimeException(e);\n+                }\n+            }\n+        }\n+        return send(url, queryPairs, method, contentType, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object\n+     * @param creds - A credentials object for authenticated requests. @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method, Credentials creds) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, String method) {\n+        return send(url, params, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params, Credentials creds) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, String params) {\n+        return send(url, params, METHOD_GET, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a get request to a url.\n+     *\n+     * @param url - The URL\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from send\n+     */\n+    public ProxyResponse send(String url, Credentials creds) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTEyNw==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691127", "bodyText": "Codacy found an issue: String.indexOf(char) is faster than String.indexOf(String).", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:30Z", "path": "dotCMS/src/main/java/com/dotcms/ema/proxy/ProxyTool.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+package com.dotcms.ema.proxy;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import java.nio.charset.Charset;\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.apache.http.Header;\n+import org.apache.http.NameValuePair;\n+import org.apache.http.StatusLine;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.Credentials;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.client.entity.UrlEncodedFormEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpDelete;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.client.methods.HttpHead;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.client.methods.HttpPut;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.message.BasicNameValuePair;\n+import org.apache.http.util.EntityUtils;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+\n+/**\n+ * This viewtool provides a method to make a simple post request and get the value.\n+ * \n+ * @author Aquent, LLC. (cfalzone@aquent.com)\n+ */\n+public class ProxyTool {\n+\n+\n+\n+    private static final String DEFAULT_CONTENT_TYPE = \"application/x-www-form-urlencoded\";\n+\n+    public static final int ERR_CODE_UNKNOWN_ERR = 888;\n+    public static final int ERR_CODE_UNIMPLEMENTED_METHOD = 777;\n+\n+    public static final String METHOD_PUT = \"PUT\";\n+    public static final String METHOD_POST = \"POST\";\n+    public static final String METHOD_GET = \"GET\";\n+    public static final String METHOD_HEAD = \"HEAD\";\n+    public static final String METHOD_DELETE = \"DELETE\";\n+\n+\n+\n+    /**\n+     * Get a credentials object to send to authenticated requests.\n+     *\n+     * @param user - The username\n+     * @param pass - The password\n+     * @return A Credentials object that can be used in authenticated requests.\n+     */\n+    public Credentials createCreds(String user, String pass) {\n+        return new UsernamePasswordCredentials(user, pass);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"sendStringData called with url=\" + url + \", data=\" + data + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        StringEntity entity;\n+        try {\n+            entity = new StringEntity(data, ContentType.create(contentType, \"UTF-8\"));\n+        } catch (Exception e) {\n+            Logger.error(this, \"Exception creating RequestEntity for: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+        CloseableHttpClient client;\n+\n+        // Authentication if passed in\n+        if (creds != null) {\n+            CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+            credsProvider.setCredentials(AuthScope.ANY, creds);\n+            client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+        } else {\n+            client = HttpClients.createDefault();\n+        }\n+\n+        if (method.equalsIgnoreCase(METHOD_POST)) {\n+            HttpPost m = new HttpPost(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+            HttpPut m = new HttpPut(url);\n+            m.setEntity(entity);\n+            try {\n+                CloseableHttpResponse r = client.execute(m);\n+                return new ProxyResponse(r.getStatusLine().getStatusCode(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+            } catch (Exception e) {\n+                Logger.error(this, \"Exception posting to url: \" + url, e);\n+                return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, null);\n+            } finally {\n+                if (method != null) {\n+                    m.releaseConnection();\n+                }\n+            }\n+        } else {\n+            Logger.error(this, \"Unimplemented Method: \" + method);\n+            return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, null);\n+        }\n+\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only Supports POST and PUT methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, String contentType) {\n+        return sendStringData(url, data, method, contentType, null);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method, Credentials creds) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to send a single string payload to a url. Can be used to send JSON or XML to a url.\n+     * Only supports PUT and POST Methods.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param method - The Method (POST/PUT)\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, String method) {\n+        return sendStringData(url, data, method, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data, Credentials creds) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, creds);\n+    }\n+\n+    /**\n+     * This is used to post a single string payload to a url. Can be used to send JSON or XML to a url.\n+     *\n+     * @param url - The URL\n+     * @param data - The String Data\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse sendStringData(String url, String data) {\n+        return sendStringData(url, data, METHOD_POST, DEFAULT_CONTENT_TYPE, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(Map) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+\n+        try {\n+            List<NameValuePair> data = new ArrayList<NameValuePair>();\n+            StringBuilder urlParamsSB = new StringBuilder();\n+            String appender = \"?\";\n+            if (url.contains(\"?\")) {\n+                appender = \"&\";\n+            }\n+            for (Entry<String, String> e : params.entrySet()) {\n+                data.add(new BasicNameValuePair(e.getKey(), e.getValue()));\n+                urlParamsSB.append(appender + e.getKey() + \"=\" + e.getValue());\n+                appender = \"&\";\n+            }\n+            UrlEncodedFormEntity entity = new UrlEncodedFormEntity(data, Charset.forName(\"UTF-8\"));\n+\n+\n+            CloseableHttpClient client = HttpClients.createDefault();\n+            \n+\n+            // Authentication if passed in\n+            if (creds != null) {\n+                CredentialsProvider credsProvider = new BasicCredentialsProvider();\n+                credsProvider.setCredentials(AuthScope.ANY, creds);\n+                client = HttpClients.custom().setDefaultCredentialsProvider(credsProvider).build();\n+            } \n+        \n+            \n+            Logger.debug(this, method  + \" \" + url);\n+            \n+            if (method.equalsIgnoreCase(METHOD_POST)) {\n+                HttpPost m = new HttpPost(url);\n+\n+                \n+\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    StatusLine status =r.getStatusLine();\n+                    return new ProxyResponse(status, EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_PUT)) {\n+                HttpPut m = new HttpPut(url);\n+                m.setEntity(entity);\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_HEAD)) {\n+                HttpHead m = new HttpHead(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_DELETE)) {\n+                HttpDelete m = new HttpDelete(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else if (method.equalsIgnoreCase(METHOD_GET)) {\n+                HttpGet m = new HttpGet(url + urlParamsSB.toString());\n+                try(CloseableHttpResponse r = client.execute(m)){\n+                    return new ProxyResponse(r.getStatusLine(), EntityUtils.toByteArray(r.getEntity()), r.getAllHeaders());\n+                }\n+            } else {\n+                Logger.error(this, \"Unimplemented Method: \" + method);\n+                return new ProxyResponse(ERR_CODE_UNIMPLEMENTED_METHOD, null, new Header[0]);\n+            }\n+\n+        } catch (Exception e) {\n+            Logger.warn(this, \"Exception posting to url: \" + url, e);\n+            return new ProxyResponse(ERR_CODE_UNKNOWN_ERR, null, new Header[0]);\n+        }\n+\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @return A ProxyResponse Object\n+     */\n+    public ProxyResponse send(String url, Map<String, String> params, String method, String contentType) {\n+        return send(url, params, method, contentType, null);\n+    }\n+\n+    /**\n+     * Sends a request to a url.\n+     *\n+     * @param url - The URL\n+     * @param params - The Query String\n+     * @param method - The Method (POST/GET/PUT/HEAD/DELETE)\n+     * @param contentType - The content type for this request\n+     * @param creds - A credentials object for authenticated requests.\n+     * @return A ProxyResponse Object @ from URLDecoder.decode\n+     */\n+    public ProxyResponse send(String url, String params, String method, String contentType, Credentials creds) {\n+        Logger.debug(this, \"send(String) called with url=\" + url + \", params=\" + params + \", and method=\" + method + \", contentType = \"\n+                + contentType + \", creds=\" + UtilMethods.isSet(creds));\n+\n+        Map<String, String> queryPairs = new LinkedHashMap<String, String>();\n+        if (params.length() > 0) {\n+            String[] pairs = params.split(\"&\");\n+            for (String pair : pairs) {\n+                int idx = pair.indexOf(\"=\");", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5MTEzNw==", "url": "https://github.com/dotCMS/core/pull/18985#discussion_r463691137", "bodyText": "Codacy found an issue: Avoid using Literals in Conditional Statements", "author": "dev-dotcms", "createdAt": "2020-07-31T15:51:31Z", "path": "dotCMS/src/main/java/com/dotcms/ema/EMAWebInterceptor.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package com.dotcms.ema;\n+\n+import com.dotcms.security.apps.AppSecrets;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+\n+import org.apache.http.Header;\n+\n+import com.dotcms.business.CloseDBIfOpened;\n+import com.dotcms.ema.proxy.MockHttpCaptureResponse;\n+import com.dotcms.ema.proxy.ProxyResponse;\n+import com.dotcms.ema.proxy.ProxyTool;\n+import com.dotcms.filters.interceptor.Result;\n+import com.dotcms.filters.interceptor.WebInterceptor;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.UserWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.dotmarketing.util.json.JSONObject;\n+import com.google.common.collect.ImmutableMap;\n+import com.liferay.portal.model.User;\n+\n+/**\n+ * Intercepts a content managers's request to dotCMS EDIT_MODE in the admin of dotCMS,\n+ * transparently POSTs the dotCMS page API data to the remote site/server (hosted elsewhere) and\n+ * then proxies the remote response back to the dotCMS admin, which allows dotCMS\n+ * to render the EDIT_MODE request in context.\n+ *\n+ * More info on how EMA works https://github.com/dotcms-plugins/com.dotcms.ema#dotcms-edit-mode-anywhere---ema\n+ */\n+public class EMAWebInterceptor  implements WebInterceptor{\n+\n+    public  static final String      PROXY_EDIT_MODE_URL_VAR = \"proxyEditModeURL\";\n+    private static final String      API_CALL                = \"/api/v1/page/render\";\n+    public static final String EMA_APP_CONFIG_KEY = \"dotema-config\";\n+    private static final ProxyTool   proxy                   = new ProxyTool();\n+\n+\n+    @Override\n+    public String[] getFilters() {\n+        return new String[] {\n+                API_CALL + \"*\"\n+        };\n+    }\n+\n+    @Override\n+    public Result intercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        final Host currentHost = WebAPILocator.getHostWebAPI().getCurrentHostNoThrow(request);\n+\n+        if (!this.existsConfiguration(currentHost.getIdentifier())) {\n+            return Result.NEXT;\n+        }\n+\n+        final Optional<String> proxyUrl = proxyUrl(currentHost);\n+        final PageMode mode             = PageMode.get(request);\n+\n+        if (!proxyUrl.isPresent() || mode == PageMode.LIVE) {\n+            return Result.NEXT;\n+        }\n+\n+        Logger.info(this.getClass(), \"GOT AN EMA Call --> \" + request.getRequestURI());\n+\n+        return new Result.Builder().wrap(new MockHttpCaptureResponse(response)).next().build();\n+    }\n+\n+\n+    @Override\n+    public boolean afterIntercept(final HttpServletRequest request, final HttpServletResponse response) {\n+\n+        try {\n+\n+            if (response instanceof MockHttpCaptureResponse) {\n+\n+                final Host currentHost = WebAPILocator.getHostWebAPI().getCurrentHostNoThrow(request);\n+                final Optional<String> proxyUrl            = proxyUrl(currentHost);\n+                final MockHttpCaptureResponse mockResponse = (MockHttpCaptureResponse)response;\n+                final String postJson                      = new String(mockResponse.getBytes());\n+                final JSONObject json                      = new JSONObject(postJson);\n+                final Map<String, String> params           = ImmutableMap.of(\"dotPageData\", postJson);\n+                \n+                Logger.info(this.getClass(), \"Proxying Request --> \" + proxyUrl.get());\n+\n+                final StringBuilder responseStringBuilder = new StringBuilder();\n+                final ProxyResponse pResponse = proxy.sendPost(proxyUrl.get(), params);\n+\n+                if (pResponse.getResponseCode() == 200) {", "originalCommit": "ac87fe4b05a8c4fa8c6a51758b682f9ac79b4539", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}