{"pr_number": 19698, "pr_title": "#19275 Fixing", "pr_createdAt": "2020-12-11T22:11:40Z", "pr_url": "https://github.com/dotCMS/core/pull/19698", "timeline": [{"oid": "33f75fd71d273606a90fb0a21275ba6c4d3c2a23", "url": "https://github.com/dotCMS/core/commit/33f75fd71d273606a90fb0a21275ba6c4d3c2a23", "message": "#19275 Fixing", "committedDate": "2020-12-11T22:10:23Z", "type": "commit"}, {"oid": "580bf7483e1b994d91ca4713795d8d01a29bd94e", "url": "https://github.com/dotCMS/core/commit/580bf7483e1b994d91ca4713795d8d01a29bd94e", "message": "removing console.log", "committedDate": "2020-12-11T22:17:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM2MTk1OQ==", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r541361959", "bodyText": "Shouldn't this be the first evaluation?", "author": "victoralfaro-dotcms", "createdAt": "2020-12-11T22:25:13Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "diffHunk": "@@ -166,19 +160,27 @@ public final Response deleteApiToken(@Context final HttpServletRequest request,\n     @NoCache\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n-    public final Response issueApiToken(@Context final HttpServletRequest request,\n-                                   @Context final HttpServletResponse response,\n-                                   final ApiTokenForm formData) {\n+    public final Response issueApiToken(\n+            @Context final HttpServletRequest request,\n+            @Context final HttpServletResponse response,\n+            final ApiTokenForm formData) throws DotDataException, DotSecurityException {\n         \n         final InitDataObject initDataObject = this.webResource.init(null, true, request, true, null);\n         final User requestingUser = initDataObject.getUser();\n-        final User forUser = Try.of(()->APILocator.getUserAPI().loadUserById(formData.userId,requestingUser, false )).getOrNull();\n-        \n-        if(forUser == null) {\n+        final User forUser = formData.userId != null ? getUserById(formData, requestingUser) : requestingUser;\n+\n+        if (requestingUser != forUser && !requestingUser.isAdmin()) {\n+            throw new DotDataException(\"Just Admin user can request a Token for another user\");\n+        }\n \n+        if(forUser == null) {", "originalCommit": "580bf7483e1b994d91ca4713795d8d01a29bd94e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM4NzMyOA==", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r541387328", "bodyText": "done 95a2812", "author": "freddyucv", "createdAt": "2020-12-11T23:02:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM2MTk1OQ=="}], "type": "inlineReview"}, {"oid": "95a2812fa9c6ac8f3ec611d7223a4716794ad726", "url": "https://github.com/dotCMS/core/commit/95a2812fa9c6ac8f3ec611d7223a4716794ad726", "message": "Refactoring", "committedDate": "2020-12-11T23:02:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQzMTkzMw==", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r542431933", "bodyText": "update doc of the endpoint with new params of the form", "author": "erickgonzalez", "createdAt": "2020-12-14T14:35:45Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "diffHunk": "@@ -166,18 +160,26 @@ public final Response deleteApiToken(@Context final HttpServletRequest request,\n     @NoCache\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n-    public final Response issueApiToken(@Context final HttpServletRequest request,\n-                                   @Context final HttpServletResponse response,\n-                                   final ApiTokenForm formData) {\n+    public final Response issueApiToken(", "originalCommit": "95a2812fa9c6ac8f3ec611d7223a4716794ad726", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU0MjEwNw==", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r542542107", "bodyText": "done 047eca1", "author": "freddyucv", "createdAt": "2020-12-14T16:53:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQzMTkzMw=="}], "type": "inlineReview"}, {"oid": "047eca133554e37b9db8a424b1bf434249c6826a", "url": "https://github.com/dotCMS/core/commit/047eca133554e37b9db8a424b1bf434249c6826a", "message": "Adding doc", "committedDate": "2020-12-14T16:53:19Z", "type": "commit"}]}