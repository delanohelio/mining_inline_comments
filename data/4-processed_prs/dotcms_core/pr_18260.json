{"pr_number": 18260, "pr_title": "#18256 : In previous versions of dotCMS, the system allow users to de\u2026", "pr_createdAt": "2020-04-02T18:58:33Z", "pr_url": "https://github.com/dotCMS/core/pull/18260", "timeline": [{"oid": "860e229baae542c585ab0254777b3f0ee58f1fc4", "url": "https://github.com/dotCMS/core/commit/860e229baae542c585ab0254777b3f0ee58f1fc4", "message": "#18256 : In previous versions of dotCMS, the system allow users to delete other users. But, it would not require users to replace the data referenced by the user to delete with the ID of another user. This caused a problem when displaying Site Variables that still reference User IDs that no longer exist.\n\n This PR includes the respective code improvements, code refactoring, and Javadoc.", "committedDate": "2020-04-02T18:58:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAzMjUwMQ==", "url": "https://github.com/dotCMS/core/pull/18260#discussion_r403032501", "bodyText": "this methos should not return a String, it should return void and throw a exception with the error message", "author": "freddyucv", "createdAt": "2020-04-03T14:09:44Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/hostvariable/ajax/HostVariableAjax.java", "diffHunk": "@@ -1,129 +1,192 @@\n package com.dotmarketing.portlets.hostvariable.ajax;\n \n-import java.util.Date;\n-import java.util.LinkedList;\n-import java.util.List;\n-import java.util.Map;\n-\n-import javax.servlet.http.HttpServletRequest;\n-\n import com.dotcms.repackage.org.directwebremoting.WebContext;\n import com.dotcms.repackage.org.directwebremoting.WebContextFactory;\n-\n import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.NoSuchUserException;\n import com.dotmarketing.business.web.UserWebAPI;\n import com.dotmarketing.business.web.WebAPILocator;\n import com.dotmarketing.exception.DotDataException;\n import com.dotmarketing.exception.DotRuntimeException;\n import com.dotmarketing.exception.DotSecurityException;\n-import com.dotmarketing.portlets.contentlet.business.HostAPI;\n import com.dotmarketing.portlets.hostvariable.bussiness.HostVariableAPI;\n import com.dotmarketing.portlets.hostvariable.model.HostVariable;\n+import com.dotmarketing.util.Logger;\n import com.dotmarketing.util.RegEX;\n import com.dotmarketing.util.UtilMethods;\n import com.liferay.portal.PortalException;\n import com.liferay.portal.SystemException;\n import com.liferay.portal.language.LanguageUtil;\n import com.liferay.portal.model.User;\n \n-public class HostVariableAjax {\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.Date;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n \n-\tprotected HostAPI hostAPI = APILocator.getHostAPI();\n+/**\n+ * This class allows the interaction with Site Variables in dotCMS. The methods exposed here are referenced via DWR by\n+ * the UI layer to allow users to perform CRUD operations on them.\n+ *\n+ * @author root\n+ * @since Mar 22, 2012\n+ */\n+public class HostVariableAjax {\n \n-\tpublic String saveHostVariable(String id, String hostId, String name, String key, String value) throws DotRuntimeException, PortalException, \n-\t\tSystemException, DotDataException, DotSecurityException {\n+\tprotected final UserWebAPI userWebAPI = WebAPILocator.getUserWebAPI();\n+\tprotected final HostVariableAPI hostVariableAPI = APILocator.getHostVariableAPI();\n+\n+\t/**\n+\t * Saves a Site Variable in the specified Site.\n+\t *\n+\t * @param id     The ID of the Site Variable.\n+\t * @param siteId The ID of the Site that the variable will be assigned to.\n+\t * @param name   The human-readable name of the Site Variable.\n+\t * @param key    The unique key assigned to the Site Variable.\n+\t * @param value  The value of the Site Variable.\n+\t *\n+\t * @return If the Site Variable was saved correctly, returns {@code null}. Otherwise, an error message is returned.\n+\t *\n+\t * @throws DotRuntimeException  An error occurred when executing this request.\n+\t * @throws PortalException      An error occurred when executing this request.\n+\t * @throws SystemException      An error occurred when executing this request.\n+\t * @throws DotDataException     The logged-in user does not have the required permissions to perform this action.\n+\t * @throws DotSecurityException The logged-in user does not have the required permissions to perform this action.\n+\t */\n+\tpublic String saveHostVariable(final String id, final String siteId, String name, String key, String value) throws DotRuntimeException, PortalException,", "originalCommit": "860e229baae542c585ab0254777b3f0ee58f1fc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA0MjY0NA==", "url": "https://github.com/dotCMS/core/pull/18260#discussion_r403042644", "bodyText": "This is a legacy class, the method signature must remain. Otherwise, a lot of code changes are required.", "author": "jcastro-dotcms", "createdAt": "2020-04-03T14:24:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAzMjUwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAzMzgxMA==", "url": "https://github.com/dotCMS/core/pull/18260#discussion_r403033810", "bodyText": "why not use a Rest end point?", "author": "freddyucv", "createdAt": "2020-04-03T14:11:43Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/hostvariable/ajax/HostVariableAjax.java", "diffHunk": "@@ -1,129 +1,192 @@\n package com.dotmarketing.portlets.hostvariable.ajax;\n \n-import java.util.Date;\n-import java.util.LinkedList;\n-import java.util.List;\n-import java.util.Map;\n-\n-import javax.servlet.http.HttpServletRequest;\n-\n import com.dotcms.repackage.org.directwebremoting.WebContext;\n import com.dotcms.repackage.org.directwebremoting.WebContextFactory;\n-\n import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.NoSuchUserException;\n import com.dotmarketing.business.web.UserWebAPI;\n import com.dotmarketing.business.web.WebAPILocator;\n import com.dotmarketing.exception.DotDataException;\n import com.dotmarketing.exception.DotRuntimeException;\n import com.dotmarketing.exception.DotSecurityException;\n-import com.dotmarketing.portlets.contentlet.business.HostAPI;\n import com.dotmarketing.portlets.hostvariable.bussiness.HostVariableAPI;\n import com.dotmarketing.portlets.hostvariable.model.HostVariable;\n+import com.dotmarketing.util.Logger;\n import com.dotmarketing.util.RegEX;\n import com.dotmarketing.util.UtilMethods;\n import com.liferay.portal.PortalException;\n import com.liferay.portal.SystemException;\n import com.liferay.portal.language.LanguageUtil;\n import com.liferay.portal.model.User;\n \n-public class HostVariableAjax {\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.Date;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n \n-\tprotected HostAPI hostAPI = APILocator.getHostAPI();\n+/**\n+ * This class allows the interaction with Site Variables in dotCMS. The methods exposed here are referenced via DWR by\n+ * the UI layer to allow users to perform CRUD operations on them.", "originalCommit": "860e229baae542c585ab0254777b3f0ee58f1fc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA0MzAxOQ==", "url": "https://github.com/dotCMS/core/pull/18260#discussion_r403043019", "bodyText": "This is a legacy class, the core of its code must remain. Otherwise, a lot of code changes are required.", "author": "jcastro-dotcms", "createdAt": "2020-04-03T14:25:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAzMzgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4NDQwNg==", "url": "https://github.com/dotCMS/core/pull/18260#discussion_r403084406", "bodyText": "I do understand it is a DWR and it is ok, however some of us (R&D) should be in charge about it a migrate the service to an endpoint as Freddy said, we should get far away from DWR as possible", "author": "jdotcms", "createdAt": "2020-04-03T15:25:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAzMzgxMA=="}], "type": "inlineReview"}]}