{"pr_number": 18976, "pr_title": "#18964 : Adding rest endpoint to get a folder structure recursively", "pr_createdAt": "2020-07-27T15:25:13Z", "pr_url": "https://github.com/dotCMS/core/pull/18976", "timeline": [{"oid": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "url": "https://github.com/dotCMS/core/commit/3b8d1a19fc7651a5574f093604e4ed932bd3504f", "message": "#18964 : Adding rest endpoint to get a folder structure recursively", "committedDate": "2020-07-27T15:19:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk3ODg4MQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460978881", "bodyText": "you can throw DoesNotExistException, in order to translate this to 404", "author": "jdotcms", "createdAt": "2020-07-27T15:32:50Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+        final User user = initData.getUser();\n+        try{\n+            final String uriParam = !uri.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(uri) : uri;\n+            Host host = APILocator.getHostAPI().findByName(siteName, user, false);\n+            //final Folder folder = folderHelper.loadFolderByURI(siteName,user,uriParam);\n+            Folder folder = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);\n+            if(host==null || folder==null) {\n+                throw new Exception(\"No folder found for \"+uri+\" on site \"+siteName);", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk3OTY0OQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460979649", "bodyText": "you can use the InitBuilder", "author": "jdotcms", "createdAt": "2020-07-27T15:33:57Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MTcwOA==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460981708", "bodyText": "I am using the same code that is in the method loadFolderByURI above this one.", "author": "luisbacca", "createdAt": "2020-07-27T15:36:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk3OTY0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MDcwOA==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460980708", "bodyText": "you do not need to catch anything here, jersey will take care for you", "author": "jdotcms", "createdAt": "2020-07-27T15:35:26Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+        final User user = initData.getUser();\n+        try{\n+            final String uriParam = !uri.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(uri) : uri;\n+            Host host = APILocator.getHostAPI().findByName(siteName, user, false);\n+            //final Folder folder = folderHelper.loadFolderByURI(siteName,user,uriParam);\n+            Folder folder = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);\n+            if(host==null || folder==null) {\n+                throw new Exception(\"No folder found for \"+uri+\" on site \"+siteName);\n+            }\n+            CustomFolder root = getFolderStructure(folder, user);\n+            response = Response.ok( new ResponseEntityView(root) ).build();\n+        } catch (Exception e) { // this is an unknown error, so we report as a 500.", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NTAzMg==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460985032", "bodyText": "I am using the same code that is in the method loadFolderByURI above this one.", "author": "luisbacca", "createdAt": "2020-07-27T15:41:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MDcwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MDg1MQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460980851", "bodyText": "set to final", "author": "jdotcms", "createdAt": "2020-07-27T15:35:41Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+        final User user = initData.getUser();\n+        try{\n+            final String uriParam = !uri.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(uri) : uri;\n+            Host host = APILocator.getHostAPI().findByName(siteName, user, false);", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MDkxNQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460980915", "bodyText": "set to final", "author": "jdotcms", "createdAt": "2020-07-27T15:35:46Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+        final User user = initData.getUser();\n+        try{\n+            final String uriParam = !uri.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(uri) : uri;\n+            Host host = APILocator.getHostAPI().findByName(siteName, user, false);\n+            //final Folder folder = folderHelper.loadFolderByURI(siteName,user,uriParam);\n+            Folder folder = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MTExMw==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460981113", "bodyText": "set to final", "author": "jdotcms", "createdAt": "2020-07-27T15:36:01Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+        final User user = initData.getUser();\n+        try{\n+            final String uriParam = !uri.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(uri) : uri;\n+            Host host = APILocator.getHostAPI().findByName(siteName, user, false);\n+            //final Folder folder = folderHelper.loadFolderByURI(siteName,user,uriParam);\n+            Folder folder = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);\n+            if(host==null || folder==null) {\n+                throw new Exception(\"No folder found for \"+uri+\" on site \"+siteName);\n+            }\n+            CustomFolder root = getFolderStructure(folder, user);\n+            response = Response.ok( new ResponseEntityView(root) ).build();\n+        } catch (Exception e) { // this is an unknown error, so we report as a 500.\n+            Logger.error(this, \"Error gettign folder for URI\", e);\n+            if (ExceptionUtil.causedBy(e, DotSecurityException.class)) {\n+                throw new ForbiddenException(e);\n+            }\n+            response = ExceptionMapperUtil.createResponse(e, Response.Status.INTERNAL_SERVER_ERROR);\n+        }\n+        return response;\n+    }\n+\n+    private CustomFolder getFolderStructure(Folder folder, User user){", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MTUyMA==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460981520", "bodyText": "Probably log it", "author": "jdotcms", "createdAt": "2020-07-27T15:36:39Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+        final User user = initData.getUser();\n+        try{\n+            final String uriParam = !uri.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(uri) : uri;\n+            Host host = APILocator.getHostAPI().findByName(siteName, user, false);\n+            //final Folder folder = folderHelper.loadFolderByURI(siteName,user,uriParam);\n+            Folder folder = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);\n+            if(host==null || folder==null) {\n+                throw new Exception(\"No folder found for \"+uri+\" on site \"+siteName);\n+            }\n+            CustomFolder root = getFolderStructure(folder, user);\n+            response = Response.ok( new ResponseEntityView(root) ).build();\n+        } catch (Exception e) { // this is an unknown error, so we report as a 500.\n+            Logger.error(this, \"Error gettign folder for URI\", e);\n+            if (ExceptionUtil.causedBy(e, DotSecurityException.class)) {\n+                throw new ForbiddenException(e);\n+            }\n+            response = ExceptionMapperUtil.createResponse(e, Response.Status.INTERNAL_SERVER_ERROR);\n+        }\n+        return response;\n+    }\n+\n+    private CustomFolder getFolderStructure(Folder folder, User user){\n+\n+        CustomFolder customFolder = convertFrom(folder);\n+\n+        List<CustomFolder> foldersChildCustoms = new LinkedList<>();\n+        List<Folder> children = null;\n+        try {\n+            children = APILocator.getFolderAPI().findSubFolders(folder, user, false);\n+        } catch (Exception e) {\n+            Logger.error(this, \"Error getting findSubFolders for folder \"+folder.getPath(), e);\n+        }\n+\n+        if(children != null && children.size() != 0){\n+            for(Folder child : children){\n+                CustomFolder recursiveFolder = getFolderStructure(child, user);\n+                foldersChildCustoms.add(recursiveFolder);\n+            }\n+        }\n+\n+        customFolder.setCustomFolders(foldersChildCustoms);\n+\n+        return customFolder;\n+    }\n+\n+    private CustomFolder convertFrom(Folder folder){\n+        CustomFolder customFolder = new CustomFolder();\n+        try {\n+            BeanUtils.copyProperties(folder, customFolder);\n+            //TODO Research why for some reason path is not being copied on jostens dev\n+            customFolder.setPath(folder.getPath());\n+        }catch (Exception exception){\n+            exception.printStackTrace();", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MjMxOA==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460982318", "bodyText": "I might be wrong, but shouldn't this be something like: /site/${siteName}/folder/{folder : .+}", "author": "victoralfaro-dotcms", "createdAt": "2020-07-27T15:37:53Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4ODI5Mg==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460988292", "bodyText": "I agree but I tried to keep the same parameter name than we had in a previous endpoint.", "author": "luisbacca", "createdAt": "2020-07-27T15:46:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MjMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA3ODczMg==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r461078732", "bodyText": "ok nvm", "author": "victoralfaro-dotcms", "createdAt": "2020-07-27T18:15:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MjMxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MjY1Nw==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460982657", "bodyText": "set to final", "author": "jdotcms", "createdAt": "2020-07-27T15:38:26Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+        final User user = initData.getUser();\n+        try{\n+            final String uriParam = !uri.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(uri) : uri;\n+            Host host = APILocator.getHostAPI().findByName(siteName, user, false);\n+            //final Folder folder = folderHelper.loadFolderByURI(siteName,user,uriParam);\n+            Folder folder = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);\n+            if(host==null || folder==null) {\n+                throw new Exception(\"No folder found for \"+uri+\" on site \"+siteName);\n+            }\n+            CustomFolder root = getFolderStructure(folder, user);\n+            response = Response.ok( new ResponseEntityView(root) ).build();\n+        } catch (Exception e) { // this is an unknown error, so we report as a 500.\n+            Logger.error(this, \"Error gettign folder for URI\", e);\n+            if (ExceptionUtil.causedBy(e, DotSecurityException.class)) {\n+                throw new ForbiddenException(e);\n+            }\n+            response = ExceptionMapperUtil.createResponse(e, Response.Status.INTERNAL_SERVER_ERROR);\n+        }\n+        return response;\n+    }\n+\n+    private CustomFolder getFolderStructure(Folder folder, User user){\n+\n+        CustomFolder customFolder = convertFrom(folder);\n+\n+        List<CustomFolder> foldersChildCustoms = new LinkedList<>();\n+        List<Folder> children = null;\n+        try {\n+            children = APILocator.getFolderAPI().findSubFolders(folder, user, false);\n+        } catch (Exception e) {\n+            Logger.error(this, \"Error getting findSubFolders for folder \"+folder.getPath(), e);\n+        }\n+\n+        if(children != null && children.size() != 0){\n+            for(Folder child : children){", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NjcxNQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460986715", "bodyText": "this could be an immutable", "author": "jdotcms", "createdAt": "2020-07-27T15:44:35Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +116,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+        final User user = initData.getUser();\n+        try{\n+            final String uriParam = !uri.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(uri) : uri;\n+            Host host = APILocator.getHostAPI().findByName(siteName, user, false);\n+            //final Folder folder = folderHelper.loadFolderByURI(siteName,user,uriParam);\n+            Folder folder = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);\n+            if(host==null || folder==null) {\n+                throw new Exception(\"No folder found for \"+uri+\" on site \"+siteName);\n+            }\n+            CustomFolder root = getFolderStructure(folder, user);\n+            response = Response.ok( new ResponseEntityView(root) ).build();\n+        } catch (Exception e) { // this is an unknown error, so we report as a 500.\n+            Logger.error(this, \"Error gettign folder for URI\", e);\n+            if (ExceptionUtil.causedBy(e, DotSecurityException.class)) {\n+                throw new ForbiddenException(e);\n+            }\n+            response = ExceptionMapperUtil.createResponse(e, Response.Status.INTERNAL_SERVER_ERROR);\n+        }\n+        return response;\n+    }\n+\n+    private CustomFolder getFolderStructure(Folder folder, User user){\n+\n+        CustomFolder customFolder = convertFrom(folder);\n+\n+        List<CustomFolder> foldersChildCustoms = new LinkedList<>();\n+        List<Folder> children = null;\n+        try {\n+            children = APILocator.getFolderAPI().findSubFolders(folder, user, false);\n+        } catch (Exception e) {\n+            Logger.error(this, \"Error getting findSubFolders for folder \"+folder.getPath(), e);\n+        }\n+\n+        if(children != null && children.size() != 0){\n+            for(Folder child : children){\n+                CustomFolder recursiveFolder = getFolderStructure(child, user);\n+                foldersChildCustoms.add(recursiveFolder);\n+            }\n+        }\n+\n+        customFolder.setCustomFolders(foldersChildCustoms);\n+\n+        return customFolder;\n+    }\n+\n+    private CustomFolder convertFrom(Folder folder){\n+        CustomFolder customFolder = new CustomFolder();\n+        try {\n+            BeanUtils.copyProperties(folder, customFolder);\n+            //TODO Research why for some reason path is not being copied on jostens dev\n+            customFolder.setPath(folder.getPath());\n+        }catch (Exception exception){\n+            exception.printStackTrace();\n+        }\n+        return customFolder;\n+    }\n+\n+    @JsonPropertyOrder({ \"path\", \"customFolders\" })\n+    @JsonRootName(\"folder\")\n+    class CustomFolder {\n+\n+        private String path;", "originalCommit": "3b8d1a19fc7651a5574f093604e4ed932bd3504f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxMzM3MQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r461013371", "bodyText": "yeah. set everything to final. remove all the setters so you can only make an unmodifiable instance once.", "author": "fabrizzio-dotCMS", "createdAt": "2020-07-27T16:25:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NjcxNQ=="}], "type": "inlineReview"}, {"oid": "04a70e34e5dac7c4d397ecc29cc3a11be1b1409f", "url": "https://github.com/dotCMS/core/commit/04a70e34e5dac7c4d397ecc29cc3a11be1b1409f", "message": "#18964 : Adding changes per Jonathan review", "committedDate": "2020-07-27T15:50:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5OTcxNw==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r460999717", "bodyText": "I would extract this class to another file", "author": "nollymar", "createdAt": "2020-07-27T16:03:48Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -106,4 +117,216 @@ public final Response loadFolderByURI(@Context final HttpServletRequest httpServ\n         return response;\n     }\n \n+    @GET\n+    @Path (\"/sitename/{siteName}/folder/{folder : .+}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response loadFolderChildrenByURIPath(@Context final HttpServletRequest httpServletRequest,\n+                                                      @Context final HttpServletResponse httpServletResponse,\n+                                                      @PathParam(\"siteName\") final String siteName,\n+                                                      @PathParam(\"folder\") final String uri){\n+        Response response = null;\n+        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+        final User user = initData.getUser();\n+        try{\n+            final String uriParam = !uri.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(uri) : uri;\n+            final Host host = APILocator.getHostAPI().findByName(siteName, user, false);\n+            //final Folder folder = folderHelper.loadFolderByURI(siteName,user,uriParam);\n+            final Folder folder = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);\n+            if(host==null || folder==null) {\n+                throw new DoesNotExistException(\"No folder found for \"+uri+\" on site \"+siteName);\n+            }\n+            CustomFolder root = getFolderStructure(folder, user);\n+            response = Response.ok( new ResponseEntityView(root) ).build();\n+        } catch (Exception e) { // this is an unknown error, so we report as a 500.\n+            Logger.error(this, \"Error gettign folder for URI\", e);\n+            if (ExceptionUtil.causedBy(e, DotSecurityException.class)) {\n+                throw new ForbiddenException(e);\n+            }\n+            response = ExceptionMapperUtil.createResponse(e, Response.Status.INTERNAL_SERVER_ERROR);\n+        }\n+        return response;\n+    }\n+\n+    private final CustomFolder getFolderStructure(Folder folder, User user){\n+\n+        CustomFolder customFolder = convertFrom(folder);\n+\n+        List<CustomFolder> foldersChildCustoms = new LinkedList<>();\n+        List<Folder> children = null;\n+        try {\n+            children = APILocator.getFolderAPI().findSubFolders(folder, user, false);\n+        } catch (Exception e) {\n+            Logger.error(this, \"Error getting findSubFolders for folder \"+folder.getPath(), e);\n+        }\n+\n+        if(children != null && children.size() != 0){\n+            for(final Folder child : children){\n+                CustomFolder recursiveFolder = getFolderStructure(child, user);\n+                foldersChildCustoms.add(recursiveFolder);\n+            }\n+        }\n+\n+        customFolder.setCustomFolders(foldersChildCustoms);\n+\n+        return customFolder;\n+    }\n+\n+    private CustomFolder convertFrom(Folder folder){\n+        CustomFolder customFolder = new CustomFolder();\n+        try {\n+            BeanUtils.copyProperties(folder, customFolder);\n+            //TODO Research why for some reason path is not being copied on jostens dev\n+            customFolder.setPath(folder.getPath());\n+        }catch (Exception exception){\n+            Logger.error(this, \"Error copying properties\");\n+        }\n+        return customFolder;\n+    }\n+\n+    @JsonPropertyOrder({ \"path\", \"customFolders\" })\n+    @JsonRootName(\"folder\")\n+    class CustomFolder {", "originalCommit": "04a70e34e5dac7c4d397ecc29cc3a11be1b1409f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAwMDgwNA==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r461000804", "bodyText": "agree a view", "author": "jdotcms", "createdAt": "2020-07-27T16:05:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5OTcxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAwMDg4MA==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r461000880", "bodyText": "I totally agree. I did it here because I am know sure what package should I use for this kind of class. What package do you suggest to use ?", "author": "luisbacca", "createdAt": "2020-07-27T16:05:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5OTcxNw=="}], "type": "inlineReview"}, {"oid": "f918a82deb60e1caadbd7200d6e9d1669df40b3d", "url": "https://github.com/dotCMS/core/commit/f918a82deb60e1caadbd7200d6e9d1669df40b3d", "message": "#18964 : Adding removing catch", "committedDate": "2020-07-27T16:21:18Z", "type": "commit"}, {"oid": "a562296e1d1784505b1a3be486ab3e9788e284c3", "url": "https://github.com/dotCMS/core/commit/a562296e1d1784505b1a3be486ab3e9788e284c3", "message": "#18964 : Removing catch, adding immutable, placing the CustomFolder class in its own view", "committedDate": "2020-07-27T16:51:59Z", "type": "commit"}, {"oid": "a60847ac33ce5bc34b960c556c8a886e6fe06b25", "url": "https://github.com/dotCMS/core/commit/a60847ac33ce5bc34b960c556c8a886e6fe06b25", "message": "#18964 : Adding CustomFolderView", "committedDate": "2020-07-27T17:01:33Z", "type": "commit"}, {"oid": "c7407b72c4ed581653c7f3917ac68019e059785e", "url": "https://github.com/dotCMS/core/commit/c7407b72c4ed581653c7f3917ac68019e059785e", "message": "#18964 : Ading javadoc per Jose\\'s review", "committedDate": "2020-07-27T18:32:06Z", "type": "commit"}, {"oid": "f9f4620eb1af9cc6464b178a74458c4570dd8d9a", "url": "https://github.com/dotCMS/core/commit/f9f4620eb1af9cc6464b178a74458c4570dd8d9a", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18964-missing-endpoint-retrieving-folder-tree", "committedDate": "2020-08-24T16:23:13Z", "type": "commit"}, {"oid": "45dc384b8a8146dcbef9ba84011dd9295900743d", "url": "https://github.com/dotCMS/core/commit/45dc384b8a8146dcbef9ba84011dd9295900743d", "message": "#18964 folderview", "committedDate": "2020-08-26T21:36:22Z", "type": "commit"}, {"oid": "377722c11c1bbe5c6136406d99bb257424a0f29a", "url": "https://github.com/dotCMS/core/commit/377722c11c1bbe5c6136406d99bb257424a0f29a", "message": "#18964 refactor", "committedDate": "2020-08-26T22:33:19Z", "type": "commit"}, {"oid": "fb3d0b86d9b18b24fb97a6c53dfd5ea79a2ff455", "url": "https://github.com/dotCMS/core/commit/fb3d0b86d9b18b24fb97a6c53dfd5ea79a2ff455", "message": "#18964 validate permissions", "committedDate": "2020-08-26T22:33:55Z", "type": "commit"}, {"oid": "ec4146f533f77bf2ad08e9e18abd1134a28ef61c", "url": "https://github.com/dotCMS/core/commit/ec4146f533f77bf2ad08e9e18abd1134a28ef61c", "message": "#18964 feedback", "committedDate": "2020-08-27T15:05:57Z", "type": "commit"}, {"oid": "53645cd7783612b4abb7f725d57746fa44cd2890", "url": "https://github.com/dotCMS/core/commit/53645cd7783612b4abb7f725d57746fa44cd2890", "message": "#18964 postman", "committedDate": "2020-08-27T16:29:28Z", "type": "commit"}, {"oid": "2d9b0ac5c299959164afbbc51e50925c85687403", "url": "https://github.com/dotCMS/core/commit/2d9b0ac5c299959164afbbc51e50925c85687403", "message": "#18964 change path", "committedDate": "2020-08-27T16:34:51Z", "type": "commit"}, {"oid": "2a86a4974f5540e9669859871c5421e9ab768b73", "url": "https://github.com/dotCMS/core/commit/2a86a4974f5540e9669859871c5421e9ab768b73", "message": "#18964 fix postman", "committedDate": "2020-08-27T17:34:00Z", "type": "commit"}, {"oid": "916c664fe4b19c7492aad05993510150448c1170", "url": "https://github.com/dotCMS/core/commit/916c664fe4b19c7492aad05993510150448c1170", "message": "#18964 change hostid to siteid", "committedDate": "2020-08-27T17:49:09Z", "type": "commit"}, {"oid": "ffe225b7536e10fea3b2878735f14b1bf3a4caf5", "url": "https://github.com/dotCMS/core/commit/ffe225b7536e10fea3b2878735f14b1bf3a4caf5", "message": "#18964 log", "committedDate": "2020-08-27T19:08:56Z", "type": "commit"}, {"oid": "ed11de697acbe02e1af26d6d52130eb30cc1ba27", "url": "https://github.com/dotCMS/core/commit/ed11de697acbe02e1af26d6d52130eb30cc1ba27", "message": "#18964 tests over the resource", "committedDate": "2020-08-27T19:09:27Z", "type": "commit"}, {"oid": "ded0a485f57e25138747e36594be5d1944a024e7", "url": "https://github.com/dotCMS/core/commit/ded0a485f57e25138747e36594be5d1944a024e7", "message": "#18964 tests change folderapiimpl", "committedDate": "2020-08-27T22:19:12Z", "type": "commit"}, {"oid": "dfa1ce9260f2fd402339aa1004b4290e0c84a5a9", "url": "https://github.com/dotCMS/core/commit/dfa1ce9260f2fd402339aa1004b4290e0c84a5a9", "message": "#18964 doc", "committedDate": "2020-08-27T22:34:04Z", "type": "commit"}, {"oid": "1779aaba0aa424d7cee923a9447b8d46d2c7c432", "url": "https://github.com/dotCMS/core/commit/1779aaba0aa424d7cee923a9447b8d46d2c7c432", "message": "#18964 fix tests", "committedDate": "2020-08-28T03:38:01Z", "type": "commit"}, {"oid": "cd89a2568f85d33fa471d8f960510569a2002a5e", "url": "https://github.com/dotCMS/core/commit/cd89a2568f85d33fa471d8f960510569a2002a5e", "message": "#18964 if user has permissions over the host and is system folder", "committedDate": "2020-08-28T04:44:15Z", "type": "commit"}, {"oid": "8f4fd194557d3177b954b309efddad0878b2ee6d", "url": "https://github.com/dotCMS/core/commit/8f4fd194557d3177b954b309efddad0878b2ee6d", "message": "#18964 fix tests", "committedDate": "2020-08-28T17:26:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzUyMQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r479443521", "bodyText": "Codacy found an issue: Useless parentheses.", "author": "dev-dotcms", "createdAt": "2020-08-28T17:32:34Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/api/v1/folder/FolderResourceTest.java", "diffHunk": "@@ -132,11 +135,211 @@ public void test_createFolders_siteNameNotExists_return400() throws DotDataExcep\n     @Test (expected = InvalidFolderNameException.class)\n     public void test_createFolders_restrictedFolderName_return400() throws DotDataException, DotSecurityException {\n         final Host newHost = new SiteDataGen().nextPersisted();\n-        final User adminUser = TestUserUtils.getAdminUser();\n         final List<String> foldersToCreate = Arrays.asList(\"dotcms\");\n \n         resource.createFolders(getHttpRequest(adminUser.getEmailAddress(),\"admin\"),response,foldersToCreate,newHost.getHostname());\n \n     }\n \n+    /**\n+     * Method to test: loadFolderAndSubFoldersByPath in the FolderResource\n+     * Given Scenario: Create a few folders/subfolders and get them using the admin as the user\n+     * ExpectedResult: All the folders/subfolders of the requested folder path, 200 code.\n+     *\n+     */\n+    @Test\n+    public void test_loadFolderAndSubFoldersByPath_Admin_success() throws DotDataException, DotSecurityException {\n+        final long currentTime = System.currentTimeMillis();\n+        final List<String> foldersToCreate = Arrays.asList(\"test_\"+currentTime+\"/folder_\"+currentTime);\n+        final Host newHost = new SiteDataGen().nextPersisted();\n+\n+        //Create Folders and SubFolders\n+        Response responseResource = resource.createFolders(getHttpRequest(adminUser.getEmailAddress(),\"admin\"),response,foldersToCreate,newHost.getHostname());\n+\n+        //Check that the response is 200, OK\n+        Assert.assertEquals(Status.OK.getStatusCode(),responseResource.getStatus());\n+\n+        //Get all the folders and subfolders\n+        responseResource = resource.loadFolderAndSubFoldersByPath(getHttpRequest(adminUser.getEmailAddress(),\"admin\"),response,newHost.getIdentifier(),\"test_\"+currentTime);\n+        //Check that the response is 200, OK\n+        Assert.assertEquals(Status.OK.getStatusCode(),responseResource.getStatus());\n+\n+        //Check Results\n+        final ResponseEntityView responseEntityView = ResponseEntityView.class.cast(responseResource.getEntity());\n+        final FolderView responseFolderView = FolderView.class.cast(responseEntityView.getEntity());\n+        Assert.assertNotNull(\"Title is null\",responseFolderView.getTitle());\n+        Assert.assertEquals(\"Title is not the same as the one requested\",responseFolderView.getTitle(),\"test_\"+currentTime);\n+        Assert.assertEquals(\"There is more than one subfolder\",1,responseFolderView.getSubFolders().size());\n+    }\n+\n+    /**\n+     * Method to test: loadFolderAndSubFoldersByPath in the FolderResource\n+     * Given Scenario: Create a few folders/subfolders and get them using the admin as the user, but the hostId sent is not valid\n+     * ExpectedResult: The endpoint should return IllegalArgumentException that jersey will map to a 400 code\n+     *\n+     */\n+    @Test (expected = IllegalArgumentException.class)\n+    public void test_loadFolderAndSubFoldersByPath_Admin_InvalidHostId_return400() throws DotDataException, DotSecurityException {\n+\n+        final long currentTime = System.currentTimeMillis();\n+        final List<String> foldersToCreate = Arrays.asList(\"test_\"+currentTime+\"/folder_\"+currentTime);\n+        final Host newHost = new SiteDataGen().nextPersisted();\n+\n+        //Create Folders and SubFolders\n+        Response responseResource = resource.createFolders(getHttpRequest(adminUser.getEmailAddress(),\"admin\"),response,foldersToCreate,newHost.getHostname());\n+\n+        //Check that the response is 200, OK\n+        Assert.assertEquals(Status.OK.getStatusCode(),responseResource.getStatus());\n+\n+        //Get all the folders and subfolders\n+        resource.loadFolderAndSubFoldersByPath(getHttpRequest(adminUser.getEmailAddress(),\"admin\"),response,\n+                UUIDGenerator.uuid(),\"test_\"+currentTime);\n+    }\n+\n+    /**\n+     * Method to test: loadFolderAndSubFoldersByPath in the FolderResource\n+     * Given Scenario: Create a few folders/subfolders and get them using the admin as the user, but the path sent is not valid\n+     * ExpectedResult: The endpoint should return IllegalArgumentException that jersey will map to a 400 code\n+     *\n+     */\n+    @Test (expected = IllegalArgumentException.class)\n+    public void test_loadFolderAndSubFoldersByPath_Admin_InvalidPath_return400() throws DotDataException, DotSecurityException {\n+\n+        final long currentTime = System.currentTimeMillis();\n+        final List<String> foldersToCreate = Arrays.asList(\"test_\"+currentTime+\"/folder_\"+currentTime);\n+        final Host newHost = new SiteDataGen().nextPersisted();\n+\n+        //Create Folders and SubFolders\n+        Response responseResource = resource.createFolders(getHttpRequest(adminUser.getEmailAddress(),\"admin\"),response,foldersToCreate,newHost.getHostname());\n+\n+        //Check that the response is 200, OK\n+        Assert.assertEquals(Status.OK.getStatusCode(),responseResource.getStatus());\n+\n+        //Get all the folders and subfolders\n+        resource.loadFolderAndSubFoldersByPath(getHttpRequest(adminUser.getEmailAddress(),\"admin\"),response,\n+                newHost.getIdentifier(),\"folderpathnotexist\");\n+    }\n+\n+    /**\n+     * Method to test: loadFolderAndSubFoldersByPath in the FolderResource\n+     * Given Scenario: Create a few folders/subfolders using the admin user, try to get the created Folders/subFolders\n+     *                  using a limited user with no permissions over the requested folder.\n+     * ExpectedResult: The endpoint should return DotSecurityException that jersey will map to a 403 code\n+     *\n+     */\n+    @Test (expected = DotSecurityException.class)\n+    public void test_loadFolderAndSubFoldersByPath_UserNoPermissionsOverFolder_return403() throws DotDataException, DotSecurityException {\n+\n+        final long currentTime = System.currentTimeMillis();\n+        final List<String> foldersToCreate = Arrays.asList(\"test_\"+currentTime+\"/folder_\"+currentTime);\n+        final Host newHost = new SiteDataGen().nextPersisted();\n+\n+        //Create Folders and SubFolders\n+        Response responseResource = resource.createFolders(getHttpRequest(adminUser.getEmailAddress(),\"admin\"),response,foldersToCreate,newHost.getHostname());\n+\n+        //Check that the response is 200, OK\n+        Assert.assertEquals(Status.OK.getStatusCode(),responseResource.getStatus());\n+\n+        //Give Permissions Over the Host\n+        final Permission permissions = new Permission(PermissionAPI.INDIVIDUAL_PERMISSION_TYPE,\n+                newHost.getPermissionId(),\n+                TestUserUtils.getOrCreatePublisherRole(newHost).getId(),\n+                (PermissionAPI.PERMISSION_READ | PermissionAPI.PERMISSION_WRITE | PermissionAPI.PERMISSION_CAN_ADD_CHILDREN | PermissionAPI.PERMISSION_EDIT_PERMISSIONS), true);", "originalCommit": "8f4fd194557d3177b954b309efddad0878b2ee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzUzMA==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r479443530", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.util.UUIDGenerator'", "author": "dev-dotcms", "createdAt": "2020-08-28T17:32:35Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/folders/business/FolderAPITest.java", "diffHunk": "@@ -45,6 +49,7 @@\n import com.dotmarketing.portlets.templates.business.TemplateAPI;\n import com.dotmarketing.portlets.templates.model.Template;\n import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.UUIDGenerator;", "originalCommit": "8f4fd194557d3177b954b309efddad0878b2ee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzUzOQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r479443539", "bodyText": "Codacy found an issue: Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block", "author": "dev-dotcms", "createdAt": "2020-08-28T17:32:36Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderHelper.java", "diffHunk": "@@ -98,4 +100,56 @@ public Folder loadFolderByURI(String siteName, User user, String uri) throws Dot\n         return ret;\n     }\n \n+    /**\n+     *\n+     * @param hostId hostId where the folder lives\n+     * @param folder parent folder to find\n+     * @param user user making the request\n+     * @return FolderView with the info of the folder requested and the subFolders\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    public FolderView loadFolderAndSubFoldersByPath(final String hostId, final String folder, final User user)\n+            throws DotSecurityException, DotDataException {\n+        final String uriParam = !folder.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(folder) : folder;\n+        final Host host = APILocator.getHostAPI().find(hostId,user,false);\n+        final Folder folderByPath = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);\n+        if(!UtilMethods.isSet(host)) {\n+            throw new IllegalArgumentException(String.format(\" Couldn't find any host with id `%s` \",hostId));\n+        }\n+        if(!UtilMethods.isSet(folderByPath) || !UtilMethods.isSet(folderByPath.getInode())) {\n+            throw new IllegalArgumentException(String.format(\" Couldn't find any folder with name `%s` in the host `%s`\",folder,hostId));\n+        }\n+\n+        return getFolders(folderByPath,user);\n+    }\n+\n+    /**\n+     * This method returns a folder structure with their children recursively based on\n+     * the folder returned by findFolderByPath\n+     *\n+     * @param folder  parent folder to  find\n+     * @param user user\n+     * @return FolderView a folder structure with their children recursively\n+     */\n+    private final FolderView getFolders(final Folder folder, final User user){\n+\n+        final List<FolderView> foldersChildCustoms = new LinkedList<>();\n+        List<Folder> children = null;\n+        try {\n+            children = APILocator.getFolderAPI().findSubFolders(folder, user, false);\n+        } catch (Exception e) {", "originalCommit": "8f4fd194557d3177b954b309efddad0878b2ee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzU0NQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r479443545", "bodyText": "Codacy found an issue: The String literal \"/folder\" appears 6 times in this file; the first occurrence is on line 834", "author": "dev-dotcms", "createdAt": "2020-08-28T17:32:37Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/folders/business/FolderAPITest.java", "diffHunk": "@@ -844,15 +832,31 @@ public void testFindSubFolders() throws DotDataException, DotSecurityException {\n \n \t@Test\n \tpublic void testFindSubFoldersByHost() throws DotDataException, DotSecurityException {\n-\t\tfinal List<Folder> folders = folderAPI.findSubFolders(host, false);\n+\t\tfinal Host newHost = new SiteDataGen().nextPersisted();\n+\t\tfinal String folderPath = \"/folder\"+System.currentTimeMillis();", "originalCommit": "8f4fd194557d3177b954b309efddad0878b2ee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzU1MQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r479443551", "bodyText": "Codacy found an issue: Avoid declaring a variable if it is unreferenced before a possible exit point.", "author": "dev-dotcms", "createdAt": "2020-08-28T17:32:38Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderHelper.java", "diffHunk": "@@ -98,4 +100,56 @@ public Folder loadFolderByURI(String siteName, User user, String uri) throws Dot\n         return ret;\n     }\n \n+    /**\n+     *\n+     * @param hostId hostId where the folder lives\n+     * @param folder parent folder to find\n+     * @param user user making the request\n+     * @return FolderView with the info of the folder requested and the subFolders\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    public FolderView loadFolderAndSubFoldersByPath(final String hostId, final String folder, final User user)\n+            throws DotSecurityException, DotDataException {\n+        final String uriParam = !folder.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(folder) : folder;\n+        final Host host = APILocator.getHostAPI().find(hostId,user,false);\n+        final Folder folderByPath = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);", "originalCommit": "8f4fd194557d3177b954b309efddad0878b2ee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzU2MQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r479443561", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotcms.datagen.TestUserUtils'", "author": "dev-dotcms", "createdAt": "2020-08-28T17:32:39Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/folders/business/FolderAPITest.java", "diffHunk": "@@ -9,14 +9,18 @@\n import com.dotcms.datagen.SiteDataGen;\n import com.dotcms.datagen.TemplateDataGen;\n import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;", "originalCommit": "8f4fd194557d3177b954b309efddad0878b2ee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzU3MQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r479443571", "bodyText": "Codacy found an issue: Unnecessary modifier 'final' on method 'getFolders': private methods cannot be overridden", "author": "dev-dotcms", "createdAt": "2020-08-28T17:32:40Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderHelper.java", "diffHunk": "@@ -98,4 +100,56 @@ public Folder loadFolderByURI(String siteName, User user, String uri) throws Dot\n         return ret;\n     }\n \n+    /**\n+     *\n+     * @param hostId hostId where the folder lives\n+     * @param folder parent folder to find\n+     * @param user user making the request\n+     * @return FolderView with the info of the folder requested and the subFolders\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    public FolderView loadFolderAndSubFoldersByPath(final String hostId, final String folder, final User user)\n+            throws DotSecurityException, DotDataException {\n+        final String uriParam = !folder.startsWith(StringPool.FORWARD_SLASH) ? StringPool.FORWARD_SLASH.concat(folder) : folder;\n+        final Host host = APILocator.getHostAPI().find(hostId,user,false);\n+        final Folder folderByPath = APILocator.getFolderAPI().findFolderByPath(uriParam, host, user, false);\n+        if(!UtilMethods.isSet(host)) {\n+            throw new IllegalArgumentException(String.format(\" Couldn't find any host with id `%s` \",hostId));\n+        }\n+        if(!UtilMethods.isSet(folderByPath) || !UtilMethods.isSet(folderByPath.getInode())) {\n+            throw new IllegalArgumentException(String.format(\" Couldn't find any folder with name `%s` in the host `%s`\",folder,hostId));\n+        }\n+\n+        return getFolders(folderByPath,user);\n+    }\n+\n+    /**\n+     * This method returns a folder structure with their children recursively based on\n+     * the folder returned by findFolderByPath\n+     *\n+     * @param folder  parent folder to  find\n+     * @param user user\n+     * @return FolderView a folder structure with their children recursively\n+     */\n+    private final FolderView getFolders(final Folder folder, final User user){", "originalCommit": "8f4fd194557d3177b954b309efddad0878b2ee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzU4NA==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r479443584", "bodyText": "Codacy found an issue: The String literal \"User \" appears 33 times in this file; the first occurrence is on line 110", "author": "dev-dotcms", "createdAt": "2020-08-28T17:32:41Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/folders/business/FolderAPIImpl.java", "diffHunk": "@@ -84,38 +84,38 @@\n \tprivate final ContentletAPI contentletAPI = APILocator.getContentletAPI();\n \n \t/**\n-\t * Will get a folder for you on a given path for a particular host\n+\t * Will get a folder on a given path for a particular host.\n \t *\n-\t * @param path\n-\t * @param hostId\n-\t * @return\n-\t * @throws DotHibernateException\n+\t * If the folder does not exists will return a folder with null values.\n+\t * If the user does not have permissions over the folder a DotSecurityException will be thrown.\n+\t *\n+\t * @param path path of the requested folder\n+\t * @param host host where the folder should live\n+\t * @return the requested folder if the user has permissions, if not an exception.\n+\t * @throws DotSecurityException\n \t */\n+\n \tprivate final FolderFactory folderFactory = FactoryLocator.getFolderFactory();\n \tprivate final PermissionAPI permissionAPI = getPermissionAPI();\n \n \t@CloseDBIfOpened\n \tpublic Folder findFolderByPath(final String path, final Host host,\n-\t\t\t\t\t\t\t\t   final User user, final boolean respectFrontEndPermissions) throws DotStateException,\n+\t\t\tfinal User user, final boolean respectFrontEndPermissions) throws DotStateException,\n \t\t\tDotDataException, DotSecurityException {\n-\n \t\tfinal Folder folder = folderFactory.findFolderByPath(path, host);\n+\t\tif (folder == null || UtilMethods.isEmpty(folder.getInode()) ||\n+\t\t\t\tpermissionAPI.doesUserHavePermission(folder, PermissionAPI.PERMISSION_READ, user, respectFrontEndPermissions)){\n+\t\t\treturn folder;\n+\t\t}\n \n-\t\tif (folder != null && InodeUtils.isSet(folder.getInode()) &&\n-\t\t\t\t!permissionAPI.doesUserHavePermission(folder, PermissionAPI.PERMISSION_READ, user, respectFrontEndPermissions)) {\n-\n-\t\t\t// SYSTEM_FOLDER means if the user has permissions to the host, then they can see host.com/\n-\t\t\tif(FolderAPI.SYSTEM_FOLDER.equals(folder.getInode())) {\n-\t\t\t\tif(!Host.SYSTEM_HOST.equals(host.getIdentifier())){\n-\t\t\t\t\tif(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_READ, user, respectFrontEndPermissions)) {\n-\t\t\t\t\t\tthrow new DotSecurityException(\"User \" + (user.getUserId() != null ? user.getUserId() : BLANK) + \" does not have permission to read folder \" + folder.getPath());\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n+\t\tif(FolderAPI.SYSTEM_FOLDER.equals(folder.getInode()) &&\n+\t\t\t\t(permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_READ, user, respectFrontEndPermissions) || host.isSystemHost())){\n+\t\t\t\t\treturn findSystemFolder();\n \t\t}\n \n-\t\treturn folder;\n+\t\tfinal String errorMsg = \"User \" + (user.getUserId() != null ? user.getUserId() : BLANK) + \" does not have permission to read folder \" + folder.getPath()+ \" on host \" + host.getHostname();", "originalCommit": "8f4fd194557d3177b954b309efddad0878b2ee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzU5MQ==", "url": "https://github.com/dotCMS/core/pull/18976#discussion_r479443591", "bodyText": "Codacy found an issue: The String literal \"folder's owner\" appears 6 times in this file; the first occurrence is on line 837", "author": "dev-dotcms", "createdAt": "2020-08-28T17:32:42Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/folders/business/FolderAPITest.java", "diffHunk": "@@ -844,15 +832,31 @@ public void testFindSubFolders() throws DotDataException, DotSecurityException {\n \n \t@Test\n \tpublic void testFindSubFoldersByHost() throws DotDataException, DotSecurityException {\n-\t\tfinal List<Folder> folders = folderAPI.findSubFolders(host, false);\n+\t\tfinal Host newHost = new SiteDataGen().nextPersisted();\n+\t\tfinal String folderPath = \"/folder\"+System.currentTimeMillis();\n+\n+\t\tfinal Folder folder = folderAPI.createFolders(folderPath, newHost, user, false);\n+\t\tfolder.setOwner(\"folder's owner\");", "originalCommit": "8f4fd194557d3177b954b309efddad0878b2ee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}