{"pr_number": 19456, "pr_title": "#19080 system container", "pr_createdAt": "2020-10-15T18:34:30Z", "pr_url": "https://github.com/dotCMS/core/pull/19456", "timeline": [{"oid": "e640fb2be96a90402ace3a054230595577c4d62c", "url": "https://github.com/dotCMS/core/commit/e640fb2be96a90402ace3a054230595577c4d62c", "message": "#19080 adding first draft of a headless container", "committedDate": "2020-10-15T18:33:11Z", "type": "commit"}, {"oid": "241b8d46371cffe9b712a27553543e582c57f3e2", "url": "https://github.com/dotCMS/core/commit/241b8d46371cffe9b712a27553543e582c57f3e2", "message": "Merge branch 'master' into issue-19080-default-layout-for-file-container", "committedDate": "2020-10-16T18:58:54Z", "type": "commit"}, {"oid": "3927fd4ccb3e1fd765bc434d09395a3ec3d18e48", "url": "https://github.com/dotCMS/core/commit/3927fd4ccb3e1fd765bc434d09395a3ec3d18e48", "message": "core#19086 fix", "committedDate": "2020-10-16T19:01:26Z", "type": "commit"}, {"oid": "4ae4d43c8682a18afd0b30558ab3624c28e87ada", "url": "https://github.com/dotCMS/core/commit/4ae4d43c8682a18afd0b30558ab3624c28e87ada", "message": "#19080 adding more changes", "committedDate": "2020-10-16T19:27:24Z", "type": "commit"}, {"oid": "1600f5bdf75a3e2166ac0adc2c9dc21f4d557a7e", "url": "https://github.com/dotCMS/core/commit/1600f5bdf75a3e2166ac0adc2c9dc21f4d557a7e", "message": "#19080 adding the ability to use a default layout for a headless container", "committedDate": "2020-10-19T18:39:49Z", "type": "commit"}, {"oid": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "url": "https://github.com/dotCMS/core/commit/116cf22bed9da6f8f2213f0d70b57ca441b1c555", "message": "Merge branch 'issue-19080-default-layout-for-file-container' of github.com:dotCMS/core into issue-19080-default-layout-for-file-container", "committedDate": "2020-10-19T18:40:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTM1Ng==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985356", "bodyText": "Codacy found an issue: Avoid unused local variables such as 'assets'.", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:10Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/ContainerStructureFinderStrategyResolverTest.java", "diffHunk": "@@ -56,4 +72,81 @@ public void get_container_structure_from_file_name_() throws Exception {\n         assertEquals(longNamedStrategy.getVelocityVarName(fileAsset), fileName);\n     }\n \n+    /**\n+     * Method to test: {@link FileAssetContainerUtil#fromAssets(Host, Folder, List, boolean, boolean)}\n+     * Given Scenario: Creates a container with a default layout\n+     * ExpectedResult: Expected result that the result should contains the default container layout\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_default_layout() throws Exception {\n+\n+        //Getting the current default host\n+        final String pathRoot             = \"/application/containers/test\"+System.currentTimeMillis();\n+        final Host currentDefaultHost     = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n+        final Folder containerFolder      = this.createAppContainerTest(currentDefaultHost, pathRoot);\n+        final String contentTypeVariable  = \"testfa\"+System.currentTimeMillis();\n+        ContentType fileAssetContentType  = ImmutableFileAssetContentType.builder()\n+                .name(\"FileAssetTestContentType\").variable(contentTypeVariable).build();\n+        fileAssetContentType              = APILocator.getContentTypeAPI(APILocator.systemUser()).save(fileAssetContentType);\n+        final List<FileAsset> assets      = Arrays.asList(", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTM2NQ==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985365", "bodyText": "Codacy found an issue: Consider simply returning the value vs storing it in local variable 'rootFolder'", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:11Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtilTest.java", "diffHunk": "@@ -116,6 +135,70 @@ public void test_getHost_demo_default_demo() throws Exception {\n         }\n     }\n \n+    /**\n+     * Method to test: {@link FileAssetContainerUtil#fromAssets(Host, Folder, List, boolean, boolean)}\n+     * Given Scenario: Creates a container with a default layout\n+     * ExpectedResult: Expected result that the result should contains the default container layout\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_fromAssets_default_layout() throws Exception {\n+\n+        //Getting the current default host\n+        final Host currentDefaultHost     = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n+        final Folder containerFolder      = this.createAppContainerTest(currentDefaultHost);\n+        final String contentTypeVariable  = \"testfa\"+System.currentTimeMillis();\n+        ContentType fileAssetContentType  = ImmutableFileAssetContentType.builder()\n+                .name(\"FileAssetTestContentType\").variable(contentTypeVariable).build();\n+        fileAssetContentType              = contentTypeAPI.save(fileAssetContentType);\n+        final List<FileAsset> assets      = Arrays.asList(\n+                this.createFileAsset(\"container\", \".vtl\",\n+                        \"$dotJSON.put(\\\"title\\\", \\\"Test VTL and Valid and Invalid Content Types\\\")\\n\" +\n+                        \"$dotJSON.put(\\\"max_contentlets\\\", 25)\\n\" +\n+                        \"$dotJSON.put(\\\"useDefaultLayout\\\",\\\"*\\\")\", containerFolder, fileAssetContentType),\n+                this.createFileAsset(\"default_container\", \".vtl\", \"$title\", containerFolder, fileAssetContentType));\n+        final boolean showLive            = false;\n+        final boolean includeHostOnPath   = false;\n+\n+        final Container container = FileAssetContainerUtil.getInstance().fromAssets(currentDefaultHost,\n+                containerFolder, assets, showLive, includeHostOnPath);\n+\n+        Assert.assertNotNull(container);\n+        Assert.assertTrue(container instanceof FileAssetContainer);\n+        Assert.assertEquals(1   , FileAssetContainer.class.cast(container).getContainerStructuresAssets().size());\n+        Assert.assertNotNull(FileAssetContainer.class.cast(container).getDefaultContainerLayoutAsset());\n+        Assert.assertEquals(\"default_container.vtl\",FileAssetContainer.class.cast(container).getDefaultContainerLayoutAsset().getFileName());\n+    }\n+\n+    private FileAsset createFileAsset (final String fileName1,\n+                                       final String fileExtension,\n+                                       final String fileContent,\n+                                       final Folder root1,\n+                                       final ContentType fileAssetContentType) throws Exception {\n+\n+        final FileAsset fileAsset = new FileAsset();\n+        final File tempFile1      = File.createTempFile(fileName1, fileExtension);\n+        FileUtil.write(tempFile1, fileContent);\n+        final String fileNameField1 = fileName1 + fileExtension;\n+\n+        fileAsset.setContentType(fileAssetContentType);\n+        fileAsset.setFolder(root1.getInode());\n+        fileAsset.setBinary(FileAssetAPI.BINARY_FIELD, tempFile1);\n+        fileAsset.setStringProperty(FileAssetAPI.HOST_FOLDER_FIELD, root1.getInode());\n+        fileAsset.setStringProperty(FileAssetAPI.TITLE_FIELD, fileNameField1);\n+        fileAsset.setStringProperty(FileAssetAPI.FILE_NAME_FIELD, fileNameField1);\n+        fileAsset.setIndexPolicy(IndexPolicy.FORCE);\n+\n+        // Create a piece of content for the default host\n+        return APILocator.getFileAssetAPI().fromContentlet(\n+                APILocator.getContentletAPI().checkin(fileAsset, user, false));\n+    }\n+\n+    private Folder createAppContainerTest(final Host currentDefaultHost) throws DotDataException, DotSecurityException {\n \n+        final String pathRoot   = \"/application/containers/test\"+System.currentTimeMillis();\n+        final Folder rootFolder = APILocator.getFolderAPI().createFolders(pathRoot, currentDefaultHost, APILocator.systemUser(), false);\n+        return rootFolder;", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTM3OA==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985378", "bodyText": "Codacy found an issue: A method/constructor should not explicitly throw java.lang.Exception", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:12Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/ContainerStructureFinderStrategyResolverTest.java", "diffHunk": "@@ -56,4 +72,81 @@ public void get_container_structure_from_file_name_() throws Exception {\n         assertEquals(longNamedStrategy.getVelocityVarName(fileAsset), fileName);\n     }\n \n+    /**\n+     * Method to test: {@link FileAssetContainerUtil#fromAssets(Host, Folder, List, boolean, boolean)}\n+     * Given Scenario: Creates a container with a default layout\n+     * ExpectedResult: Expected result that the result should contains the default container layout\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_default_layout() throws Exception {\n+\n+        //Getting the current default host\n+        final String pathRoot             = \"/application/containers/test\"+System.currentTimeMillis();\n+        final Host currentDefaultHost     = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n+        final Folder containerFolder      = this.createAppContainerTest(currentDefaultHost, pathRoot);\n+        final String contentTypeVariable  = \"testfa\"+System.currentTimeMillis();\n+        ContentType fileAssetContentType  = ImmutableFileAssetContentType.builder()\n+                .name(\"FileAssetTestContentType\").variable(contentTypeVariable).build();\n+        fileAssetContentType              = APILocator.getContentTypeAPI(APILocator.systemUser()).save(fileAssetContentType);\n+        final List<FileAsset> assets      = Arrays.asList(\n+                this.createFileAsset(\"container\", \".vtl\",\n+                        \"$dotJSON.put(\\\"title\\\", \\\"Test No VTL and All Content Types\\\")\\n\" +\n+                                \"$dotJSON.put(\\\"max_contentlets\\\", 25)\\n\" +\n+                                \"$dotJSON.put(\\\"useDefaultLayout\\\",\\\"*\\\")\", containerFolder, fileAssetContentType),\n+                this.createFileAsset(\"default_container\", \".vtl\", \"$title\", containerFolder, fileAssetContentType));\n+\n+        final ContainerStructureFinderStrategyResolver containerStructureFinderStrategyResolver =\n+                new ContainerStructureFinderStrategyResolver();\n+\n+        final Container container = APILocator.getContainerAPI()\n+                .getWorkingContainerByFolderPath(pathRoot, currentDefaultHost, APILocator.systemUser(), false);\n+        final Optional<ContainerStructureFinderStrategy> containerStructureFinderStrategy =\n+                containerStructureFinderStrategyResolver.get(container);\n+\n+        Assert.assertTrue(containerStructureFinderStrategy.isPresent());\n+\n+        final  List<ContainerStructure> containerStructures = containerStructureFinderStrategy.get().apply(container);\n+\n+        Assert.assertNotNull(containerStructures);\n+        Assert.assertFalse(containerStructures.isEmpty());\n+\n+        final List<ContentType> contentTypes = APILocator.getContentTypeAPI(APILocator.systemUser()).findAll();\n+        for (final ContentType contentType : contentTypes) {\n+\n+            Assert.assertTrue(\"Content Type: \" + contentType.variable() + \" does not included on the container\",\n+                    containerStructures.stream().anyMatch(containerStructure -> containerStructure.getStructureId().equals(contentType.id())));\n+        }\n+    }\n+\n+    private FileAsset createFileAsset (final String fileName1,\n+                                       final String fileExtension,\n+                                       final String fileContent,\n+                                       final Folder root1,\n+                                       final ContentType fileAssetContentType) throws Exception {", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTM4OQ==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985389", "bodyText": "Codacy found an issue: Avoid using redundant field initializer for 'defaultContainerLayoutAsset'", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:13Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/model/FileAssetContainer.java", "diffHunk": "@@ -42,15 +42,28 @@ public FileAssetContainer() {\n     @JsonIgnore\n     private transient FileAsset postLoopAsset = null;\n \n+    @JsonIgnore\n+    private transient FileAsset defaultContainerLayoutAsset = null;", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTM5OA==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985398", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotcms.rendering.velocity.viewtools.content.FileAssetMap'", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:14Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtilTest.java", "diffHunk": "@@ -1,14 +1,33 @@\n package com.dotmarketing.portlets.containers.business;\n \n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ImmutableFileAssetContentType;\n import com.dotcms.datagen.ContainerAsFileDataGen;\n+import com.dotcms.datagen.FolderDataGen;\n import com.dotcms.datagen.SiteDataGen;\n+import com.dotcms.rendering.velocity.viewtools.content.FileAssetMap;", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTQxMQ==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985411", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotcms.datagen.FolderDataGen'", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:15Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtilTest.java", "diffHunk": "@@ -1,14 +1,33 @@\n package com.dotmarketing.portlets.containers.business;\n \n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ImmutableFileAssetContentType;\n import com.dotcms.datagen.ContainerAsFileDataGen;\n+import com.dotcms.datagen.FolderDataGen;", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTQyMw==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985423", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.portlets.containers.model.FileAssetContainer'", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:16Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/ContainerStructureFinderStrategyResolverTest.java", "diffHunk": "@@ -1,6 +1,18 @@\n package com.dotmarketing.portlets.containers.business;\n \n import static org.junit.Assert.assertEquals;\n+\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ImmutableFileAssetContentType;\n+import com.dotmarketing.beans.ContainerStructure;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.containers.model.Container;\n+import com.dotmarketing.portlets.containers.model.FileAssetContainer;", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTQzNg==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985436", "bodyText": "Codacy found an issue: Consider simply returning the value vs storing it in local variable 'rootFolder'", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:18Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/ContainerStructureFinderStrategyResolverTest.java", "diffHunk": "@@ -56,4 +72,81 @@ public void get_container_structure_from_file_name_() throws Exception {\n         assertEquals(longNamedStrategy.getVelocityVarName(fileAsset), fileName);\n     }\n \n+    /**\n+     * Method to test: {@link FileAssetContainerUtil#fromAssets(Host, Folder, List, boolean, boolean)}\n+     * Given Scenario: Creates a container with a default layout\n+     * ExpectedResult: Expected result that the result should contains the default container layout\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_default_layout() throws Exception {\n+\n+        //Getting the current default host\n+        final String pathRoot             = \"/application/containers/test\"+System.currentTimeMillis();\n+        final Host currentDefaultHost     = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n+        final Folder containerFolder      = this.createAppContainerTest(currentDefaultHost, pathRoot);\n+        final String contentTypeVariable  = \"testfa\"+System.currentTimeMillis();\n+        ContentType fileAssetContentType  = ImmutableFileAssetContentType.builder()\n+                .name(\"FileAssetTestContentType\").variable(contentTypeVariable).build();\n+        fileAssetContentType              = APILocator.getContentTypeAPI(APILocator.systemUser()).save(fileAssetContentType);\n+        final List<FileAsset> assets      = Arrays.asList(\n+                this.createFileAsset(\"container\", \".vtl\",\n+                        \"$dotJSON.put(\\\"title\\\", \\\"Test No VTL and All Content Types\\\")\\n\" +\n+                                \"$dotJSON.put(\\\"max_contentlets\\\", 25)\\n\" +\n+                                \"$dotJSON.put(\\\"useDefaultLayout\\\",\\\"*\\\")\", containerFolder, fileAssetContentType),\n+                this.createFileAsset(\"default_container\", \".vtl\", \"$title\", containerFolder, fileAssetContentType));\n+\n+        final ContainerStructureFinderStrategyResolver containerStructureFinderStrategyResolver =\n+                new ContainerStructureFinderStrategyResolver();\n+\n+        final Container container = APILocator.getContainerAPI()\n+                .getWorkingContainerByFolderPath(pathRoot, currentDefaultHost, APILocator.systemUser(), false);\n+        final Optional<ContainerStructureFinderStrategy> containerStructureFinderStrategy =\n+                containerStructureFinderStrategyResolver.get(container);\n+\n+        Assert.assertTrue(containerStructureFinderStrategy.isPresent());\n+\n+        final  List<ContainerStructure> containerStructures = containerStructureFinderStrategy.get().apply(container);\n+\n+        Assert.assertNotNull(containerStructures);\n+        Assert.assertFalse(containerStructures.isEmpty());\n+\n+        final List<ContentType> contentTypes = APILocator.getContentTypeAPI(APILocator.systemUser()).findAll();\n+        for (final ContentType contentType : contentTypes) {\n+\n+            Assert.assertTrue(\"Content Type: \" + contentType.variable() + \" does not included on the container\",\n+                    containerStructures.stream().anyMatch(containerStructure -> containerStructure.getStructureId().equals(contentType.id())));\n+        }\n+    }\n+\n+    private FileAsset createFileAsset (final String fileName1,\n+                                       final String fileExtension,\n+                                       final String fileContent,\n+                                       final Folder root1,\n+                                       final ContentType fileAssetContentType) throws Exception {\n+\n+        final FileAsset fileAsset = new FileAsset();\n+        final File tempFile1      = File.createTempFile(fileName1, fileExtension);\n+        FileUtil.write(tempFile1, fileContent);\n+        final String fileNameField1 = fileName1 + fileExtension;\n+\n+        fileAsset.setContentType(fileAssetContentType);\n+        fileAsset.setFolder(root1.getInode());\n+        fileAsset.setBinary(FileAssetAPI.BINARY_FIELD, tempFile1);\n+        fileAsset.setStringProperty(FileAssetAPI.HOST_FOLDER_FIELD, root1.getInode());\n+        fileAsset.setStringProperty(FileAssetAPI.TITLE_FIELD, fileNameField1);\n+        fileAsset.setStringProperty(FileAssetAPI.FILE_NAME_FIELD, fileNameField1);\n+        fileAsset.setIndexPolicy(IndexPolicy.FORCE);\n+\n+        // Create a piece of content for the default host\n+        return APILocator.getFileAssetAPI().fromContentlet(\n+                APILocator.getContentletAPI().checkin(fileAsset, APILocator.systemUser(), false));\n+    }\n+\n+    private Folder createAppContainerTest(final Host currentDefaultHost, final String pathRoot) throws DotDataException, DotSecurityException {\n+\n+        final Folder rootFolder = APILocator.getFolderAPI().createFolders(pathRoot, currentDefaultHost, APILocator.systemUser(), false);\n+        return rootFolder;", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTQ0Mw==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985443", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.liferay.portal.model.User'", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:19Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtilTest.java", "diffHunk": "@@ -1,14 +1,33 @@\n package com.dotmarketing.portlets.containers.business;\n \n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ImmutableFileAssetContentType;\n import com.dotcms.datagen.ContainerAsFileDataGen;\n+import com.dotcms.datagen.FolderDataGen;\n import com.dotcms.datagen.SiteDataGen;\n+import com.dotcms.rendering.velocity.viewtools.content.FileAssetMap;\n import com.dotmarketing.beans.Host;\n import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n import com.dotmarketing.portlets.ContentletBaseTest;\n+import com.dotmarketing.portlets.containers.model.Container;\n import com.dotmarketing.portlets.containers.model.FileAssetContainer;\n+import com.dotmarketing.portlets.contentlet.model.IndexPolicy;\n+import com.dotmarketing.portlets.fileassets.business.FileAsset;\n+import com.dotmarketing.portlets.fileassets.business.FileAssetAPI;\n+import com.dotmarketing.portlets.folders.model.Folder;\n+import com.liferay.portal.model.User;", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTQ1Mw==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985453", "bodyText": "Codacy found an issue: A method/constructor should not explicitly throw java.lang.Exception", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:19Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtilTest.java", "diffHunk": "@@ -116,6 +135,70 @@ public void test_getHost_demo_default_demo() throws Exception {\n         }\n     }\n \n+    /**\n+     * Method to test: {@link FileAssetContainerUtil#fromAssets(Host, Folder, List, boolean, boolean)}\n+     * Given Scenario: Creates a container with a default layout\n+     * ExpectedResult: Expected result that the result should contains the default container layout\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_fromAssets_default_layout() throws Exception {\n+\n+        //Getting the current default host\n+        final Host currentDefaultHost     = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n+        final Folder containerFolder      = this.createAppContainerTest(currentDefaultHost);\n+        final String contentTypeVariable  = \"testfa\"+System.currentTimeMillis();\n+        ContentType fileAssetContentType  = ImmutableFileAssetContentType.builder()\n+                .name(\"FileAssetTestContentType\").variable(contentTypeVariable).build();\n+        fileAssetContentType              = contentTypeAPI.save(fileAssetContentType);\n+        final List<FileAsset> assets      = Arrays.asList(\n+                this.createFileAsset(\"container\", \".vtl\",\n+                        \"$dotJSON.put(\\\"title\\\", \\\"Test VTL and Valid and Invalid Content Types\\\")\\n\" +\n+                        \"$dotJSON.put(\\\"max_contentlets\\\", 25)\\n\" +\n+                        \"$dotJSON.put(\\\"useDefaultLayout\\\",\\\"*\\\")\", containerFolder, fileAssetContentType),\n+                this.createFileAsset(\"default_container\", \".vtl\", \"$title\", containerFolder, fileAssetContentType));\n+        final boolean showLive            = false;\n+        final boolean includeHostOnPath   = false;\n+\n+        final Container container = FileAssetContainerUtil.getInstance().fromAssets(currentDefaultHost,\n+                containerFolder, assets, showLive, includeHostOnPath);\n+\n+        Assert.assertNotNull(container);\n+        Assert.assertTrue(container instanceof FileAssetContainer);\n+        Assert.assertEquals(1   , FileAssetContainer.class.cast(container).getContainerStructuresAssets().size());\n+        Assert.assertNotNull(FileAssetContainer.class.cast(container).getDefaultContainerLayoutAsset());\n+        Assert.assertEquals(\"default_container.vtl\",FileAssetContainer.class.cast(container).getDefaultContainerLayoutAsset().getFileName());\n+    }\n+\n+    private FileAsset createFileAsset (final String fileName1,\n+                                       final String fileExtension,\n+                                       final String fileContent,\n+                                       final Folder root1,\n+                                       final ContentType fileAssetContentType) throws Exception {", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTQ2NQ==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985465", "bodyText": "Codacy found an issue: Avoid unused imports such as 'java.io.IOException'", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:20Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtilTest.java", "diffHunk": "@@ -1,14 +1,33 @@\n package com.dotmarketing.portlets.containers.business;\n \n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ImmutableFileAssetContentType;\n import com.dotcms.datagen.ContainerAsFileDataGen;\n+import com.dotcms.datagen.FolderDataGen;\n import com.dotcms.datagen.SiteDataGen;\n+import com.dotcms.rendering.velocity.viewtools.content.FileAssetMap;\n import com.dotmarketing.beans.Host;\n import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n import com.dotmarketing.portlets.ContentletBaseTest;\n+import com.dotmarketing.portlets.containers.model.Container;\n import com.dotmarketing.portlets.containers.model.FileAssetContainer;\n+import com.dotmarketing.portlets.contentlet.model.IndexPolicy;\n+import com.dotmarketing.portlets.fileassets.business.FileAsset;\n+import com.dotmarketing.portlets.fileassets.business.FileAssetAPI;\n+import com.dotmarketing.portlets.folders.model.Folder;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.FileUtil;\n import org.junit.Assert;\n import org.junit.Test;\n \n+import java.io.File;\n+import java.io.IOException;", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NTQ3NA==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r507985474", "bodyText": "Codacy found an issue: Avoid unused imports such as 'java.util.Map'", "author": "dev-dotcms", "createdAt": "2020-10-19T18:48:21Z", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtilTest.java", "diffHunk": "@@ -1,14 +1,33 @@\n package com.dotmarketing.portlets.containers.business;\n \n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ImmutableFileAssetContentType;\n import com.dotcms.datagen.ContainerAsFileDataGen;\n+import com.dotcms.datagen.FolderDataGen;\n import com.dotcms.datagen.SiteDataGen;\n+import com.dotcms.rendering.velocity.viewtools.content.FileAssetMap;\n import com.dotmarketing.beans.Host;\n import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n import com.dotmarketing.portlets.ContentletBaseTest;\n+import com.dotmarketing.portlets.containers.model.Container;\n import com.dotmarketing.portlets.containers.model.FileAssetContainer;\n+import com.dotmarketing.portlets.contentlet.model.IndexPolicy;\n+import com.dotmarketing.portlets.fileassets.business.FileAsset;\n+import com.dotmarketing.portlets.fileassets.business.FileAssetAPI;\n+import com.dotmarketing.portlets.folders.model.Folder;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.FileUtil;\n import org.junit.Assert;\n import org.junit.Test;\n \n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;", "originalCommit": "116cf22bed9da6f8f2213f0d70b57ca441b1c555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "79a24607b7142c863bde89292a4da59b23f19810", "url": "https://github.com/dotCMS/core/commit/79a24607b7142c863bde89292a4da59b23f19810", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-19080-default-layout-for-file-container", "committedDate": "2021-03-02T18:59:01Z", "type": "commit"}, {"oid": "e11c0da7379fde8a147bcf91a639df51c77a42f4", "url": "https://github.com/dotCMS/core/commit/e11c0da7379fde8a147bcf91a639df51c77a42f4", "message": "feedback codacy", "committedDate": "2021-03-04T14:57:13Z", "type": "commit"}, {"oid": "fa2aacc5889a301b2552b8ce62545f6e6a8b1058", "url": "https://github.com/dotCMS/core/commit/fa2aacc5889a301b2552b8ce62545f6e6a8b1058", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-19080-default-layout-for-file-container", "committedDate": "2021-03-04T14:57:48Z", "type": "commit"}, {"oid": "1e667cb9e92ea983cf839f4c5ce47ab34222b942", "url": "https://github.com/dotCMS/core/commit/1e667cb9e92ea983cf839f4c5ce47ab34222b942", "message": "#19080 update empty starter with system container files", "committedDate": "2021-03-04T16:37:37Z", "type": "commit"}, {"oid": "3ec4a88401010f9702504c8cb6f58d1e6ecdd953", "url": "https://github.com/dotCMS/core/commit/3ec4a88401010f9702504c8cb6f58d1e6ecdd953", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-19080-default-layout-for-file-container", "committedDate": "2021-03-10T20:45:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTg5Nzk4NA==", "url": "https://github.com/dotCMS/core/pull/19456#discussion_r591897984", "bodyText": "here are you flushing all the cache?", "author": "freddyucv", "createdAt": "2021-03-10T21:50:35Z", "path": "dotCMS/src/main/java/com/dotcms/contenttype/business/ContentTypeCache2Impl.java", "diffHunk": "@@ -103,4 +104,9 @@ public ContentType byVarOrInode(String varOrInode) {\n     \t}\n \n \t}\n+\n+    public void clearContainerStructures() {\n+\n+        cache.flushGroup(containerStructureGroup);", "originalCommit": "3ec4a88401010f9702504c8cb6f58d1e6ecdd953", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6f4e9b6f0990d9fc6b534a29ae1f4bff9ee3cd54", "url": "https://github.com/dotCMS/core/commit/6f4e9b6f0990d9fc6b534a29ae1f4bff9ee3cd54", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-19080-default-layout-for-file-container", "committedDate": "2021-03-11T18:35:49Z", "type": "commit"}, {"oid": "80a8fdce91cee22dfa4c95658f409f7c7b5392b2", "url": "https://github.com/dotCMS/core/commit/80a8fdce91cee22dfa4c95658f409f7c7b5392b2", "message": "#19080 update starter", "committedDate": "2021-03-11T18:54:40Z", "type": "commit"}]}