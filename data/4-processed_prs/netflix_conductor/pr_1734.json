{"pr_number": 1734, "pr_title": "fix BETWEEN operator; ensure task cancellation when terminating workflow", "pr_createdAt": "2020-06-09T20:08:37Z", "pr_url": "https://github.com/Netflix/conductor/pull/1734", "timeline": [{"oid": "be7b86478ca22fd547053d50e37c166d93f9ba6b", "url": "https://github.com/Netflix/conductor/commit/be7b86478ca22fd547053d50e37c166d93f9ba6b", "message": "fix BETWEEN operator; ensure task cancellation when terminating workflow", "committedDate": "2020-06-10T01:04:58Z", "type": "forcePushed"}, {"oid": "22a7821069cd05ff155f078bea4a5ca09270cf89", "url": "https://github.com/Netflix/conductor/commit/22a7821069cd05ff155f078bea4a5ca09270cf89", "message": "fix BETWEEN operator; ensure task cancellation when terminating workflow", "committedDate": "2020-06-10T01:36:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgxNzIzOQ==", "url": "https://github.com/Netflix/conductor/pull/1734#discussion_r437817239", "bodyText": "Couple of things:\n\nNow that we're not checking length of peeked, could it possibly throw ArrayIndexOutOfBounds exception?\nGiven that STARTS_WITH below still checks with String equals, what was the case for checking each character by element?", "author": "kishorebanala", "createdAt": "2020-06-10T01:58:56Z", "path": "es5-persistence/src/main/java/com/netflix/conductor/elasticsearch/query/parser/ComparisonOp.java", "diffHunk": "@@ -70,7 +62,7 @@ protected void _parse() throws Exception {\n \t\t\tthis.value = \"IS\";\n \t\t}else if(peeked[0] == '!' && peeked[1] == '='){\n \t\t\tthis.value = \"!=\";\n-\t\t}else if(peeked.length == betwnLen && new String(peeked).equals(Operators.BETWEEN.value())) {\n+\t\t}else if(peeked[0] == 'B' && peeked[1] == 'E' && peeked[2] == 'T' && peeked[3] == 'W' && peeked[4] == 'E' && peeked[5] == 'E' && peeked[6] == 'N'){", "originalCommit": "22a7821069cd05ff155f078bea4a5ca09270cf89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgyMDM4MQ==", "url": "https://github.com/Netflix/conductor/pull/1734#discussion_r437820381", "bodyText": "Ahh good catch on the ArrayIndexOutOfBounds exception. Pushed out a fix for this.", "author": "apanicker-nflx", "createdAt": "2020-06-10T02:11:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgxNzIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgyMTY3NA==", "url": "https://github.com/Netflix/conductor/pull/1734#discussion_r437821674", "bodyText": "The parse method always peeks the maxOperatorLength number of characters. After the STARTS_WITH operator was added, the length of this operator is now the max length (11). Now consider the search query excerpt startTime BETWEEN 100 AND 200. In this case, the parse method would now parse the following string BETWEEN 100 which is of length 11. This would fail the String equals comparison and the BETWEEN operator is now non-functional.", "author": "apanicker-nflx", "createdAt": "2020-06-10T02:16:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgxNzIzOQ=="}], "type": "inlineReview"}, {"oid": "c627e2fd1487965e639840ee9b12a993783d1ff6", "url": "https://github.com/Netflix/conductor/commit/c627e2fd1487965e639840ee9b12a993783d1ff6", "message": "fix BETWEEN operator; ensure task cancellation when terminating workflow", "committedDate": "2020-06-10T02:10:42Z", "type": "forcePushed"}, {"oid": "9df9e2bf6b78bff53d9d87ebddbf8f9597e5597e", "url": "https://github.com/Netflix/conductor/commit/9df9e2bf6b78bff53d9d87ebddbf8f9597e5597e", "message": "fix BETWEEN operator; ensure task cancellation when terminating workflow", "committedDate": "2020-06-10T20:21:12Z", "type": "commit"}, {"oid": "9df9e2bf6b78bff53d9d87ebddbf8f9597e5597e", "url": "https://github.com/Netflix/conductor/commit/9df9e2bf6b78bff53d9d87ebddbf8f9597e5597e", "message": "fix BETWEEN operator; ensure task cancellation when terminating workflow", "committedDate": "2020-06-10T20:21:12Z", "type": "forcePushed"}]}