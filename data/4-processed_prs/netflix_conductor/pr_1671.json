{"pr_number": 1671, "pr_title": "Fix the issue with ParametersUtils where input map is mutated", "pr_createdAt": "2020-05-06T05:18:22Z", "pr_url": "https://github.com/Netflix/conductor/pull/1671", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU1MDkzMw==", "url": "https://github.com/Netflix/conductor/pull/1671#discussion_r420550933", "bodyText": "This block of code is where the previous fix falls apart, the new test I added fails without the new fix.", "author": "cyzhao", "createdAt": "2020-05-06T05:21:57Z", "path": "core/src/main/java/com/netflix/conductor/core/execution/ParametersUtils.java", "diffHunk": "@@ -161,23 +161,23 @@ public Object replace(String paramString) {\n \n     @SuppressWarnings(\"unchecked\")\n     private Map<String, Object> replace(Map<String, Object> input, DocumentContext documentContext, String taskId) {\n+        Map<String, Object> result = new HashMap<>();\n         for (Entry<String, Object> e : input.entrySet()) {\n+            Object newValue;\n             Object value = e.getValue();\n             if (value instanceof String) {\n-                Object replaced = replaceVariables(value.toString(), documentContext, taskId);\n-                e.setValue(replaced);\n+                newValue = replaceVariables(value.toString(), documentContext, taskId);\n             } else if (value instanceof Map) {", "originalCommit": "abad6dcb72cbec6d0cd263ab23977ba63a05696c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "96f2bf6c70662d52601b80e3312949a8e249769b", "url": "https://github.com/Netflix/conductor/commit/96f2bf6c70662d52601b80e3312949a8e249769b", "message": "Fix the issue with ParametersUtils where input map is mutated", "committedDate": "2020-05-06T06:35:28Z", "type": "forcePushed"}, {"oid": "ae08202af5783b937e0f9a1efff9a0a3ea83b343", "url": "https://github.com/Netflix/conductor/commit/ae08202af5783b937e0f9a1efff9a0a3ea83b343", "message": "Fix the issue with ParametersUtils where input map is mutated", "committedDate": "2020-05-06T07:59:36Z", "type": "commit"}, {"oid": "ae08202af5783b937e0f9a1efff9a0a3ea83b343", "url": "https://github.com/Netflix/conductor/commit/ae08202af5783b937e0f9a1efff9a0a3ea83b343", "message": "Fix the issue with ParametersUtils where input map is mutated", "committedDate": "2020-05-06T07:59:36Z", "type": "forcePushed"}]}