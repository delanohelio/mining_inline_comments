{"pr_number": 8476, "pr_title": "Add Shared Scope Support and Support for Multiple Scopes Per Resource", "pr_createdAt": "2020-05-08T20:00:57Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8476", "timeline": [{"oid": "c49316d9b784658786dbf48eb5f2e47c40deb2b0", "url": "https://github.com/wso2/carbon-apimgt/commit/c49316d9b784658786dbf48eb5f2e47c40deb2b0", "message": "remove initialAutoCommit static variable access.", "committedDate": "2020-05-19T08:04:25Z", "type": "commit"}, {"oid": "eef0d0f63f5d9737b403ed81e52cde34df016ad4", "url": "https://github.com/wso2/carbon-apimgt/commit/eef0d0f63f5d9737b403ed81e52cde34df016ad4", "message": "Remove null check as statement.executeQuery never returns null.", "committedDate": "2020-05-19T08:04:25Z", "type": "commit"}, {"oid": "3b0ef7a0f0ba9b38e0e0354afab54843ef625308", "url": "https://github.com/wso2/carbon-apimgt/commit/3b0ef7a0f0ba9b38e0e0354afab54843ef625308", "message": "Pass scope name to delete global scope.", "committedDate": "2020-05-19T08:04:26Z", "type": "commit"}, {"oid": "1932877e34a83c7fb2c993b61dc558867180d3ba", "url": "https://github.com/wso2/carbon-apimgt/commit/1932877e34a83c7fb2c993b61dc558867180d3ba", "message": "Rename /global-scopes to /scopes", "committedDate": "2020-05-19T08:04:26Z", "type": "commit"}, {"oid": "6058cef01b3179731d6aab1fa2587a7d2af93153", "url": "https://github.com/wso2/carbon-apimgt/commit/6058cef01b3179731d6aab1fa2587a7d2af93153", "message": "rename global to shared scopes.", "committedDate": "2020-05-19T08:04:26Z", "type": "commit"}, {"oid": "e82ed32fb70aef32d5391ff6a917abc7c200a536", "url": "https://github.com/wso2/carbon-apimgt/commit/e82ed32fb70aef32d5391ff6a917abc7c200a536", "message": "Rename Global Scope -> Shared Scope", "committedDate": "2020-05-19T08:04:27Z", "type": "commit"}, {"oid": "891d8b0df9afe4101d767bfa0bc5751075bdf384", "url": "https://github.com/wso2/carbon-apimgt/commit/891d8b0df9afe4101d767bfa0bc5751075bdf384", "message": "Add pagination to /scopes REST API.", "committedDate": "2020-05-19T08:04:27Z", "type": "commit"}, {"oid": "9ea91a96ce6ddce216fffeae112191ef5bf8d650", "url": "https://github.com/wso2/carbon-apimgt/commit/9ea91a96ce6ddce216fffeae112191ef5bf8d650", "message": "Remove bindings object from ScopeDTO and add bindings array for roles.\nRemove isShared from ScopeDTO and add it as an attribute for the APIDTO.scopes array.", "committedDate": "2020-05-19T08:04:28Z", "type": "commit"}, {"oid": "a219417caae79ab7819c6f2e096ae91782bd5805", "url": "https://github.com/wso2/carbon-apimgt/commit/a219417caae79ab7819c6f2e096ae91782bd5805", "message": "remove primary key temporarily.", "committedDate": "2020-05-19T08:04:28Z", "type": "commit"}, {"oid": "39487016553cd7d3b53b7d65a847b6009ee8fab5", "url": "https://github.com/wso2/carbon-apimgt/commit/39487016553cd7d3b53b7d65a847b6009ee8fab5", "message": "update scope detachment by passing context seperately", "committedDate": "2020-05-19T08:04:29Z", "type": "commit"}, {"oid": "175df0ead4bb8db2053ee3e0bfaa55085bf87610", "url": "https://github.com/wso2/carbon-apimgt/commit/175df0ead4bb8db2053ee3e0bfaa55085bf87610", "message": "relfect isShared field changes in APIDTO", "committedDate": "2020-05-19T08:04:29Z", "type": "commit"}, {"oid": "3be5065406c6f50aec8cab8c00236692b5cd8c5a", "url": "https://github.com/wso2/carbon-apimgt/commit/3be5065406c6f50aec8cab8c00236692b5cd8c5a", "message": "Fix eslint issues", "committedDate": "2020-05-19T08:04:29Z", "type": "commit"}, {"oid": "8cd6517e9510f0655c5dde49fcf49111a32b4456", "url": "https://github.com/wso2/carbon-apimgt/commit/8cd6517e9510f0655c5dde49fcf49111a32b4456", "message": "detach resource scope using resourse path", "committedDate": "2020-05-19T08:04:29Z", "type": "commit"}, {"oid": "7d7bdc9882bf6ca6a7df61d2b0a9174a29f37410", "url": "https://github.com/wso2/carbon-apimgt/commit/7d7bdc9882bf6ca6a7df61d2b0a9174a29f37410", "message": "add support for multiple scopes per resource.", "committedDate": "2020-05-19T08:04:30Z", "type": "commit"}, {"oid": "0d54893d22a4b43b3fa0943a598c9a65b65120b9", "url": "https://github.com/wso2/carbon-apimgt/commit/0d54893d22a4b43b3fa0943a598c9a65b65120b9", "message": "fix scope.id null issue when checking equality of two scope objects.", "committedDate": "2020-05-19T08:04:31Z", "type": "commit"}, {"oid": "e9af1eb01e8bc9c5de1aad0da17cddede7cddd06", "url": "https://github.com/wso2/carbon-apimgt/commit/e9af1eb01e8bc9c5de1aad0da17cddede7cddd06", "message": "fix issue of not deleting local scopes during API delete if the same scope name is available in a different tenant.", "committedDate": "2020-05-19T08:04:31Z", "type": "commit"}, {"oid": "9c30406bdabe8d80a7818a60ef7de9908d2fa698", "url": "https://github.com/wso2/carbon-apimgt/commit/9c30406bdabe8d80a7818a60ef7de9908d2fa698", "message": "support multiple scopes per resource when legacy scope extenation x-scope (preserveLegacyExtension) is supported.", "committedDate": "2020-05-19T08:04:31Z", "type": "commit"}, {"oid": "75eb176b3c5d3d38cd0ec28421c9e2a41c924f7b", "url": "https://github.com/wso2/carbon-apimgt/commit/75eb176b3c5d3d38cd0ec28421c9e2a41c924f7b", "message": "Return boolean primitive type for isScopeExists()", "committedDate": "2020-05-19T08:04:31Z", "type": "commit"}, {"oid": "a7ad5b6345c0c870925fb454e8c56992a6554b8e", "url": "https://github.com/wso2/carbon-apimgt/commit/a7ad5b6345c0c870925fb454e8c56992a6554b8e", "message": "fix keymanager impl wrapper test class issues.", "committedDate": "2020-05-19T08:04:32Z", "type": "commit"}, {"oid": "287df96df7106d79febc41d3e165b995148bf2d1", "url": "https://github.com/wso2/carbon-apimgt/commit/287df96df7106d79febc41d3e165b995148bf2d1", "message": "fix formatting.", "committedDate": "2020-05-19T08:04:32Z", "type": "commit"}, {"oid": "1561a0605fc6a7c0279ea456a9bb87083422b0de", "url": "https://github.com/wso2/carbon-apimgt/commit/1561a0605fc6a7c0279ea456a9bb87083422b0de", "message": "Remove only unversioned scopes during API update.\nVersioned scopes cannot change during API update.", "committedDate": "2020-05-19T08:04:32Z", "type": "commit"}, {"oid": "015251434743b92c2e5b9b0750a379a7f456cd9c", "url": "https://github.com/wso2/carbon-apimgt/commit/015251434743b92c2e5b9b0750a379a7f456cd9c", "message": "Fix review comment. Revert APIManager API change.", "committedDate": "2020-05-19T08:04:33Z", "type": "commit"}, {"oid": "65ac78cfd1e3dc23af30d4b4fde7c42c7bdaf43e", "url": "https://github.com/wso2/carbon-apimgt/commit/65ac78cfd1e3dc23af30d4b4fde7c42c7bdaf43e", "message": "Revert API change.", "committedDate": "2020-05-19T08:04:33Z", "type": "commit"}, {"oid": "ab41bcba39bd95728a541baf44fbe53ffb651e96", "url": "https://github.com/wso2/carbon-apimgt/commit/ab41bcba39bd95728a541baf44fbe53ffb651e96", "message": "Fix isScopeExits testcase", "committedDate": "2020-05-19T08:04:33Z", "type": "commit"}, {"oid": "f7ce547371ae052d7a91e06cf72420bdf3788175", "url": "https://github.com/wso2/carbon-apimgt/commit/f7ce547371ae052d7a91e06cf72420bdf3788175", "message": "Fix impl test failures.", "committedDate": "2020-05-19T08:04:33Z", "type": "commit"}, {"oid": "07e50be732028f557389615063ab9b3c4b8b87d5", "url": "https://github.com/wso2/carbon-apimgt/commit/07e50be732028f557389615063ab9b3c4b8b87d5", "message": "Handle null in connection rollbacks.\nMove AddLocalScopes to updateScope transaction.\nMove getAPIContext to deleteAPI transaction.", "committedDate": "2020-05-19T08:04:34Z", "type": "commit"}, {"oid": "febeff054b32db48239473a00bae7f01e73232ab", "url": "https://github.com/wso2/carbon-apimgt/commit/febeff054b32db48239473a00bae7f01e73232ab", "message": "Fix checkstyle issues.", "committedDate": "2020-05-19T08:04:34Z", "type": "commit"}, {"oid": "4c7c7bd1666f8f7c624ed446b4ab26c3182a6a00", "url": "https://github.com/wso2/carbon-apimgt/commit/4c7c7bd1666f8f7c624ed446b4ab26c3182a6a00", "message": "fix return value isSharedScopeNameExists", "committedDate": "2020-05-19T08:04:34Z", "type": "commit"}, {"oid": "5ab4238c276ab03ed79ec9513f1e4bf1e6571e6b", "url": "https://github.com/wso2/carbon-apimgt/commit/5ab4238c276ab03ed79ec9513f1e4bf1e6571e6b", "message": "fix checkstyle issues.", "committedDate": "2020-05-19T08:04:34Z", "type": "commit"}, {"oid": "8d13a06f147681320184a0a0d1f9a411d6effd7e", "url": "https://github.com/wso2/carbon-apimgt/commit/8d13a06f147681320184a0a0d1f9a411d6effd7e", "message": "Fix publisher swagger issue of having similar paths /scopes/{scopeId} GET and /scopes/{scopeName} HEAD.", "committedDate": "2020-05-19T08:04:35Z", "type": "commit"}, {"oid": "27e0dd98329e30df58d8935806803bb3a09cc2f3", "url": "https://github.com/wso2/carbon-apimgt/commit/27e0dd98329e30df58d8935806803bb3a09cc2f3", "message": "remove unnecessary null checks for resultset. Add notes to methods for removing in future.", "committedDate": "2020-05-19T08:04:35Z", "type": "commit"}, {"oid": "74c74124f5f92646b5de102b52e344d507043854", "url": "https://github.com/wso2/carbon-apimgt/commit/74c74124f5f92646b5de102b52e344d507043854", "message": "Fix publisher REST API /scopes/{scopeId} HEAD", "committedDate": "2020-05-19T08:04:35Z", "type": "commit"}, {"oid": "3c50230f87137ab86f34f93ada33e9e5fb45c470", "url": "https://github.com/wso2/carbon-apimgt/commit/3c50230f87137ab86f34f93ada33e9e5fb45c470", "message": "handle connection rollback for URItemplate removal in update.", "committedDate": "2020-05-19T08:04:36Z", "type": "commit"}, {"oid": "3a431f5a1a659d1581b98a703c7a292a2d2c48f2", "url": "https://github.com/wso2/carbon-apimgt/commit/3a431f5a1a659d1581b98a703c7a292a2d2c48f2", "message": "fix api delete issue.", "committedDate": "2020-05-19T08:04:36Z", "type": "commit"}, {"oid": "920bd213a92d767c03670b7026559ccaf389df20", "url": "https://github.com/wso2/carbon-apimgt/commit/920bd213a92d767c03670b7026559ccaf389df20", "message": "rename isShared -> shared", "committedDate": "2020-05-19T08:04:36Z", "type": "commit"}, {"oid": "b57fa9583980600f5b001a88c083304de163977a", "url": "https://github.com/wso2/carbon-apimgt/commit/b57fa9583980600f5b001a88c083304de163977a", "message": "Add KM extension to validate global scopes while attaching them to APIs.", "committedDate": "2020-05-19T08:04:37Z", "type": "commit"}, {"oid": "a49e4ccaa16d9fae8b1c3434b79ae0ecfc8b0146", "url": "https://github.com/wso2/carbon-apimgt/commit/a49e4ccaa16d9fae8b1c3434b79ae0ecfc8b0146", "message": "seperate local scope existence validation and registration logic.", "committedDate": "2020-05-19T08:04:37Z", "type": "commit"}, {"oid": "2cc6b18e4e11f54d06563a025f31dd6d328520c6", "url": "https://github.com/wso2/carbon-apimgt/commit/2cc6b18e4e11f54d06563a025f31dd6d328520c6", "message": "Add resource scope attach, detach and update extension points to KM interface.", "committedDate": "2020-05-19T08:04:37Z", "type": "commit"}, {"oid": "63918de03a7259108def95489931272448f3a948", "url": "https://github.com/wso2/carbon-apimgt/commit/63918de03a7259108def95489931272448f3a948", "message": "Seperate KM service calls from ApiMgtDAO layer.", "committedDate": "2020-05-19T08:04:38Z", "type": "commit"}, {"oid": "b8b887553f0f4eb5f76106f3ff76ad12d2e1222d", "url": "https://github.com/wso2/carbon-apimgt/commit/b8b887553f0f4eb5f76106f3ff76ad12d2e1222d", "message": "Fix review comments.\n1.During API deletion, separately delete the resource scope mappings from API-M before deleting the URI templates.\n2. Use the same DB connection when retrieving the API Id during API update and delete.\n3. Provide default implementation for attachResourceScopes, deatachResourceScopes, and updateResourceScopes in KeyManager interface.\n4. Let updating the local scopes (during API update) which are shared across versioned APIs.\n5. Explicitly handle the resource scope operations from default KM implementation to make sure current usecases work.", "committedDate": "2020-05-19T08:04:38Z", "type": "commit"}, {"oid": "dd5a0d352c0a08ec3eb294310d7138d93d0d86c5", "url": "https://github.com/wso2/carbon-apimgt/commit/dd5a0d352c0a08ec3eb294310d7138d93d0d86c5", "message": "Move getAPIScopes to APIUtil so that KM call will not be done from DAO layer.", "committedDate": "2020-05-19T08:04:39Z", "type": "commit"}, {"oid": "ccc6347fee87f491c1816c40eab8408220d40aa6", "url": "https://github.com/wso2/carbon-apimgt/commit/ccc6347fee87f491c1816c40eab8408220d40aa6", "message": "Remove preserveLegacyScope property. Make legacy scope migration mandatory.", "committedDate": "2020-05-19T08:04:39Z", "type": "commit"}, {"oid": "a55ebea01654d30c7dfe4b2dd182c349867a309c", "url": "https://github.com/wso2/carbon-apimgt/commit/a55ebea01654d30c7dfe4b2dd182c349867a309c", "message": "Remove getAllSharedScopes DAO.", "committedDate": "2020-05-19T08:04:39Z", "type": "commit"}, {"oid": "2ad3149d95037f3e27647a79e01f3dd51f7282a1", "url": "https://github.com/wso2/carbon-apimgt/commit/2ad3149d95037f3e27647a79e01f3dd51f7282a1", "message": "Add DisplayName to ScopeDTO in publisher REST API. Keep display name in Scope.name and scope key in Scope.key.", "committedDate": "2020-05-19T08:04:40Z", "type": "commit"}, {"oid": "9fffcbe024e53f7ff042a9a5926781c4d77330a6", "url": "https://github.com/wso2/carbon-apimgt/commit/9fffcbe024e53f7ff042a9a5926781c4d77330a6", "message": "Add TODO for multiple scope per resource support in Basic Auth Gateway.", "committedDate": "2020-05-19T08:04:40Z", "type": "commit"}, {"oid": "0ba360ebdd44a77a7c204ea69fdcdf4c9d01844d", "url": "https://github.com/wso2/carbon-apimgt/commit/0ba360ebdd44a77a7c204ea69fdcdf4c9d01844d", "message": "Fix review comments. Add specific field names to SELECT queries.", "committedDate": "2020-05-19T08:04:40Z", "type": "commit"}, {"oid": "7c87c1c9cee1aaf32e1ccaa17e8dea5aa30c5726", "url": "https://github.com/wso2/carbon-apimgt/commit/7c87c1c9cee1aaf32e1ccaa17e8dea5aa30c5726", "message": "Fix get scope id using scope name.", "committedDate": "2020-05-19T08:04:40Z", "type": "commit"}, {"oid": "db2f4f02e6a9695d1914443b5d272f444109932a", "url": "https://github.com/wso2/carbon-apimgt/commit/db2f4f02e6a9695d1914443b5d272f444109932a", "message": "remove tenantId parameter for api update.", "committedDate": "2020-05-19T08:04:40Z", "type": "commit"}, {"oid": "45292dca5cb55b2dee5b10f8584f3dc1cb655cc3", "url": "https://github.com/wso2/carbon-apimgt/commit/45292dca5cb55b2dee5b10f8584f3dc1cb655cc3", "message": "remove preserve legacy extension.", "committedDate": "2020-05-19T08:04:41Z", "type": "commit"}, {"oid": "95d4c7ade4c39c5a065ab8d017005d1d09dbf741", "url": "https://github.com/wso2/carbon-apimgt/commit/95d4c7ade4c39c5a065ab8d017005d1d09dbf741", "message": "Fix tests.", "committedDate": "2020-05-19T08:04:41Z", "type": "commit"}, {"oid": "780e160cce3a17b51ed3ce5790da595024c86efd", "url": "https://github.com/wso2/carbon-apimgt/commit/780e160cce3a17b51ed3ce5790da595024c86efd", "message": "add validation for scope display name. When display is not provided, add the scope name as the display name. Refer the same objects in api.scopes to URI templates.", "committedDate": "2020-05-19T08:04:41Z", "type": "commit"}, {"oid": "758ce6ee37df4e72ad38d1cde37ba3bd8b9f1179", "url": "https://github.com/wso2/carbon-apimgt/commit/758ce6ee37df4e72ad38d1cde37ba3bd8b9f1179", "message": "fix tests.\nremove unused methods and sql queries.", "committedDate": "2020-05-19T08:13:08Z", "type": "commit"}, {"oid": "555eeaf8ae8575b91f3ae38042ee16d4a03ee206", "url": "https://github.com/wso2/carbon-apimgt/commit/555eeaf8ae8575b91f3ae38042ee16d4a03ee206", "message": "Fix issues when retrieving shared scopes and searching paginated apis.", "committedDate": "2020-05-19T08:13:09Z", "type": "commit"}, {"oid": "b069abd1a212ec8fc2c0e15d1a10e255aefe59f9", "url": "https://github.com/wso2/carbon-apimgt/commit/b069abd1a212ec8fc2c0e15d1a10e255aefe59f9", "message": "Get versioned local scopes and remove them from the old local scope set sending to KM, during API update.", "committedDate": "2020-05-19T08:13:09Z", "type": "commit"}, {"oid": "a88af8ff5b37b95cece2fcfd0137772bf58feb08", "url": "https://github.com/wso2/carbon-apimgt/commit/a88af8ff5b37b95cece2fcfd0137772bf58feb08", "message": "Add resource scope to URITemplate.scopes array.", "committedDate": "2020-05-19T08:13:09Z", "type": "commit"}, {"oid": "c8785598cb17c97a073ef8f0bacf23bae340f370", "url": "https://github.com/wso2/carbon-apimgt/commit/c8785598cb17c97a073ef8f0bacf23bae340f370", "message": "Add APIScopeDTO to APIProductDTO.", "committedDate": "2020-05-19T08:13:09Z", "type": "commit"}, {"oid": "b7b044468de089ae86ca1d74e7c5dfe949f99f71", "url": "https://github.com/wso2/carbon-apimgt/commit/b7b044468de089ae86ca1d74e7c5dfe949f99f71", "message": "Fix issue of returning scopes in uri templates for creation new version flow.\nFix graphql oauth token invocation issue.", "committedDate": "2020-05-19T08:13:10Z", "type": "commit"}, {"oid": "8e8a0c08c902e5afd3394ba0d322e529200c7bbe", "url": "https://github.com/wso2/carbon-apimgt/commit/8e8a0c08c902e5afd3394ba0d322e529200c7bbe", "message": "fix issue when loading scopes for Operations in GraphQL.", "committedDate": "2020-05-19T08:13:10Z", "type": "commit"}, {"oid": "8e53bc297668e49d326691d8a066812d3496e0f1", "url": "https://github.com/wso2/carbon-apimgt/commit/8e53bc297668e49d326691d8a066812d3496e0f1", "message": "remove AM_API_SCOPES table.", "committedDate": "2020-05-19T08:13:10Z", "type": "commit"}, {"oid": "7c4ba918af45151ef98071bd642b82a4778f9bf6", "url": "https://github.com/wso2/carbon-apimgt/commit/7c4ba918af45151ef98071bd642b82a4778f9bf6", "message": "remove AM_API_SCOPES table and add shared scope tables for test cases.", "committedDate": "2020-05-19T08:13:10Z", "type": "commit"}, {"oid": "c0d84266dfd1e9c3669c6c376a4ee4a8893a0cf9", "url": "https://github.com/wso2/carbon-apimgt/commit/c0d84266dfd1e9c3669c6c376a4ee4a8893a0cf9", "message": "remove oauth2 scope resource path primary key constraint.", "committedDate": "2020-05-19T08:13:10Z", "type": "commit"}, {"oid": "fd8dae6daa25f2d63878343750a5c37e0dbd5681", "url": "https://github.com/wso2/carbon-apimgt/commit/fd8dae6daa25f2d63878343750a5c37e0dbd5681", "message": "fix review comment : remove initializeHttpClient from KeyManager Interface. Add it to DefaultImplementation only.", "committedDate": "2020-05-19T08:13:10Z", "type": "commit"}, {"oid": "4a387df8f37a3b86545ca128377067bd8dfd9dcb", "url": "https://github.com/wso2/carbon-apimgt/commit/4a387df8f37a3b86545ca128377067bd8dfd9dcb", "message": "Fix comments and javadoc comments.", "committedDate": "2020-05-19T08:13:10Z", "type": "commit"}, {"oid": "0a6855cb34212f282011205f1ac8d7db6643a41d", "url": "https://github.com/wso2/carbon-apimgt/commit/0a6855cb34212f282011205f1ac8d7db6643a41d", "message": "fix bug, remove shared scope by tenantId.", "committedDate": "2020-05-19T08:13:10Z", "type": "commit"}, {"oid": "c227ae14823523d58397d0190219fada595fd382", "url": "https://github.com/wso2/carbon-apimgt/commit/c227ae14823523d58397d0190219fada595fd382", "message": "rename scopeName -> name", "committedDate": "2020-05-19T08:13:10Z", "type": "commit"}, {"oid": "99c8da528391eede8b3d4adfab83a003c5c4ce7b", "url": "https://github.com/wso2/carbon-apimgt/commit/99c8da528391eede8b3d4adfab83a003c5c4ce7b", "message": "remove isScopeKeyAssigned deprecated method.", "committedDate": "2020-05-19T08:13:11Z", "type": "commit"}, {"oid": "99c8da528391eede8b3d4adfab83a003c5c4ce7b", "url": "https://github.com/wso2/carbon-apimgt/commit/99c8da528391eede8b3d4adfab83a003c5c4ce7b", "message": "remove isScopeKeyAssigned deprecated method.", "committedDate": "2020-05-19T08:13:11Z", "type": "forcePushed"}, {"oid": "f079ddf297e42cf20060c13b9c921fdabb9b6f5f", "url": "https://github.com/wso2/carbon-apimgt/commit/f079ddf297e42cf20060c13b9c921fdabb9b6f5f", "message": "Fix comments and javadoc comments.", "committedDate": "2020-05-11T16:02:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYxNjIxNA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8476#discussion_r426616214", "bodyText": "can we remove it", "author": "tharindu1st", "createdAt": "2020-05-18T13:14:22Z", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/APIManager.java", "diffHunk": "@@ -453,9 +453,34 @@ String addResourceFile(Identifier identifier, String resourcePath, ResourceFile\n      * @param tenantid   tenant id\n      * @return true if the scope key is already available\n      * @throws APIManagementException if failed to check the context availability\n+     * @deprecated Use isScopeKeyAssignedLocally() instead.\n      */\n+    @Deprecated\n     boolean isScopeKeyAssigned(APIIdentifier identifier, String scopeKey, int tenantid) throws APIManagementException;", "originalCommit": "4474710cbddf77aa43df55d16896f759bccd78df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYyODc1NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8476#discussion_r426628754", "bodyText": "This was added back as deprecated as\nit seemed not a good practice to remove an API #8409 (comment)", "author": "dushaniw", "createdAt": "2020-05-18T13:33:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYxNjIxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzExMzIxNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8476#discussion_r427113215", "bodyText": "As the method is not used by any implementation other than internal carbon-apimgt methods, removed the method from interface. 99c8da5", "author": "dushaniw", "createdAt": "2020-05-19T08:15:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYxNjIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYyMDg1OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8476#discussion_r426620859", "bodyText": "scopeName -> name", "author": "tharindu1st", "createdAt": "2020-05-18T13:21:16Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/AMDefaultKeyManagerImpl.java", "diffHunk": "@@ -706,14 +762,553 @@ public AccessTokenInfo getAccessTokenByConsumerKey(String consumerKey) throws AP\n     }\n \n     @Override\n-    public Map<String, Set<Scope>> getScopesForAPIS(String apiIdsString) throws APIManagementException {\n+    public Map<String, Set<Scope>> getScopesForAPIS(String apiIdsString, String tenantDomain)\n+            throws APIManagementException {\n+\n+        Map<String, Set<Scope>> apiToScopeMapping = new HashMap<>();\n         ApiMgtDAO apiMgtDAO = ApiMgtDAO.getInstance();\n-        Map<String, Set<Scope>> scopes = apiMgtDAO.getScopesForAPIS(apiIdsString);\n-        return scopes;\n+        Map<String, Set<String>> apiToScopeKeyMapping = apiMgtDAO.getScopesForAPIS(apiIdsString);\n+        for (String apiId : apiToScopeKeyMapping.keySet()) {\n+            Set<Scope> apiScopes = new LinkedHashSet<>();\n+            Set<String> scopeKeys = apiToScopeKeyMapping.get(apiId);\n+            for (String scopeKey : scopeKeys) {\n+                Scope scope = getScopeByName(scopeKey, tenantDomain);\n+                apiScopes.add(scope);\n+            }\n+            apiToScopeMapping.put(apiId, apiScopes);\n+        }\n+        return apiToScopeMapping;\n+    }\n+\n+    /**\n+     * Get scope management service tenant URL for given KM endpoint.\n+     *\n+     * @return Scope Management Service host URL (Eg:https://localhost:9444/api/identity/oauth2/v1.0/scopes)\n+     * @throws APIManagementException If a malformed km endpoint is provided\n+     */\n+    private String getScopeManagementServiceEndpoint(String tenantDomain) throws APIManagementException {\n+\n+        String authServerURL = configuration.getParameter(APIConstants.AUTHSERVER_URL);\n+        if (StringUtils.isEmpty(authServerURL)) {\n+            throw new APIManagementException(\"API Key Validator Server URL cannot be empty or null\");\n+        }\n+        String scopeMgtTenantEndpoint = authServerURL.split(\"/\" + APIConstants.SERVICES_URL_RELATIVE_PATH)[0];\n+        if (StringUtils.isNoneEmpty(tenantDomain)) {\n+            scopeMgtTenantEndpoint += \"/t/\" + tenantDomain;\n+        }\n+        scopeMgtTenantEndpoint += APIConstants.KEY_MANAGER_OAUTH2_SCOPES_REST_API_BASE_PATH;\n+        return scopeMgtTenantEndpoint;\n+    }\n+\n+    /**\n+     * This method will be used to register a Scope in the authorization server.\n+     *\n+     * @param scope        Scope to register\n+     * @param tenantDomain tenant domain to add scope\n+     * @throws APIManagementException if there is an error while registering a new scope.\n+     */\n+    @Override\n+    public void registerScope(Scope scope, String tenantDomain) throws APIManagementException {\n+\n+        AccessTokenInfo accessToken = getAccessTokenForScopeMgt(tenantDomain);\n+        String scopeEndpoint = getScopeManagementServiceEndpoint(tenantDomain);\n+        String scopeKey = scope.getKey();\n+        try {\n+            HttpPost httpPost = new HttpPost(scopeEndpoint);\n+            httpPost.setHeader(HttpHeaders.AUTHORIZATION, getBearerAuthorizationHeader(accessToken));\n+            httpPost.setHeader(HttpHeaders.CONTENT_TYPE, APIConstants.APPLICATION_JSON_MEDIA_TYPE);\n+            ScopeDTO scopeDTO = new ScopeDTO();\n+            scopeDTO.setName(scopeKey);\n+            scopeDTO.setDisplayName(scope.getName());\n+            scopeDTO.setDescription(scope.getDescription());\n+            if (scope.getRoles() != null) {\n+                scopeDTO.setBindings(Arrays.asList(scope.getRoles().split(\",\")));\n+            }\n+            StringEntity payload = new StringEntity(new Gson().toJson(scopeDTO));\n+            httpPost.setEntity(payload);\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Invoking Scope Management REST API of KM: \" + scopeEndpoint + \" to register scope \"\n+                        + scopeKey);\n+            }\n+            try (CloseableHttpResponse httpResponse = kmHttpClient.execute(httpPost)) {\n+                int statusCode = httpResponse.getStatusLine().getStatusCode();\n+                if (statusCode != HttpStatus.SC_CREATED) {\n+                    String responseString = readHttpResponseAsString(httpResponse);\n+                    throw new APIManagementException(\"Error occurred while registering scope: \" + scopeKey + \" via \"\n+                            + scopeEndpoint + \". Error Status: \" + statusCode + \" . Error Response: \" + responseString);\n+                }\n+            }\n+        } catch (IOException e) {\n+            String errorMessage = \"Error occurred while registering scope: \" + scopeKey + \" via \" + scopeEndpoint;\n+            throw new APIManagementException(errorMessage, e);\n+        }\n+    }\n+\n+    /**\n+     * Read response body for HTTPResponse as a string.\n+     *\n+     * @param httpResponse HTTPResponse\n+     * @return Response Body String\n+     * @throws APIManagementException If an error occurs while reading the response\n+     */\n+    protected String readHttpResponseAsString(CloseableHttpResponse httpResponse) throws APIManagementException {\n+\n+        try {\n+            HttpEntity entity = httpResponse.getEntity();\n+            String responseString = entity != null ? EntityUtils.toString(entity, StandardCharsets.UTF_8) : null;\n+            //release all resources held by the responseHttpEntity\n+            EntityUtils.consume(entity);\n+            return responseString;\n+        } catch (IOException e) {\n+            String errorMessage = \"Error occurred while reading response body as string\";\n+            throw new APIManagementException(errorMessage, e);\n+        }\n+    }\n+\n+    /**\n+     * Get Basic Authorization header for KM admin credentials.\n+     *\n+     * @return Base64 encoded Basic Authorization header\n+     */\n+    protected String getBasicAuthorizationHeader() {\n+\n+        //Set Authorization Header of external store admin\n+        byte[] encodedAuth = Base64\n+                .encodeBase64((configuration.getParameter(APIConstants.KEY_MANAGER_USERNAME) + \":\"\n+                        + configuration.getParameter(APIConstants.KEY_MANAGER_PASSWORD))\n+                        .getBytes(StandardCharsets.ISO_8859_1));\n+        return APIConstants.AUTHORIZATION_HEADER_BASIC + StringUtils.SPACE + new String(encodedAuth);\n+    }\n+\n+    /**\n+     * Get access token with scope management scopes for the tenant using the KM Mgt OAuth Application.\n+     *\n+     * @param tenantDomain Tenant Domain\n+     * @return Access Token\n+     */\n+    private AccessTokenInfo getAccessTokenForScopeMgt(String tenantDomain) throws APIManagementException {\n+\n+        OAuthApplicationInfo oAuthApplication = getKeyManagerMgtApplication(tenantDomain);\n+        // Set scope management resource scopes\n+        oAuthApplication.addParameter(APIConstants.AccessTokenConstants.TOKEN_SCOPES,\n+                APIConstants.KEY_MANAGER_OAUTH2_SCOPES_REST_API_MGT_SCOPES);\n+        // Create access token request for the application\n+        AccessTokenRequest tokenRequest = ApplicationUtils.createAccessTokenRequest(oAuthApplication, null);\n+        // Get access token\n+        return getNewApplicationAccessToken(tokenRequest);\n+    }\n+\n+    /**\n+     * Construct Bearer Authorization header for AccessTokenInfo.\n+     *\n+     * @param accessTokenInfo Access Token\n+     * @return Bearer Authorization header\n+     */\n+    private String getBearerAuthorizationHeader(AccessTokenInfo accessTokenInfo) {\n+\n+        return APIConstants.AUTHORIZATION_BEARER + accessTokenInfo.getAccessToken();\n+    }\n+\n+    /**\n+     * This method will be used to retrieve details of a Scope in the authorization server.\n+     *\n+     * @param scopeName    Scope Name to retrieve\n+     * @param tenantDomain tenant domain to retrieve scope from\n+     * @return Scope object\n+     * @throws APIManagementException if an error while retrieving scope\n+     */\n+    @Override\n+    public Scope getScopeByName(String scopeName, String tenantDomain) throws APIManagementException {", "originalCommit": "4474710cbddf77aa43df55d16896f759bccd78df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzExMzQ1Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8476#discussion_r427113457", "bodyText": "fixed c227ae1", "author": "dushaniw", "createdAt": "2020-05-19T08:15:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYyMDg1OQ=="}], "type": "inlineReview"}, {"oid": "093c7553932df02f127382fac2b6f7846feb97b6", "url": "https://github.com/wso2/carbon-apimgt/commit/093c7553932df02f127382fac2b6f7846feb97b6", "message": "generate rest api for global scopes", "committedDate": "2020-05-19T08:04:03Z", "type": "commit"}, {"oid": "03888d14fb9594e3d84bbead1e329224a22f7e7d", "url": "https://github.com/wso2/carbon-apimgt/commit/03888d14fb9594e3d84bbead1e329224a22f7e7d", "message": "generate rest api for global scopes", "committedDate": "2020-05-19T08:04:03Z", "type": "commit"}, {"oid": "e968cab479b04605a9a166fedfdb0ffa0df3592d", "url": "https://github.com/wso2/carbon-apimgt/commit/e968cab479b04605a9a166fedfdb0ffa0df3592d", "message": "Change scope ID to String to support Global Scope UUID.", "committedDate": "2020-05-19T08:04:04Z", "type": "commit"}, {"oid": "c263e54fcf44386751c9539805c98444490266ae", "url": "https://github.com/wso2/carbon-apimgt/commit/c263e54fcf44386751c9539805c98444490266ae", "message": "Change scope ID to String to support Global Scope UUID.", "committedDate": "2020-05-19T08:04:04Z", "type": "commit"}, {"oid": "f3a3c37090fcc354fd0b3466f8901a9fe4b0dd1a", "url": "https://github.com/wso2/carbon-apimgt/commit/f3a3c37090fcc354fd0b3466f8901a9fe4b0dd1a", "message": "add feign client", "committedDate": "2020-05-19T08:04:04Z", "type": "commit"}, {"oid": "12ab76301fe5a80727a6523a377f533233eaa208", "url": "https://github.com/wso2/carbon-apimgt/commit/12ab76301fe5a80727a6523a377f533233eaa208", "message": "Implement global scope REST API service", "committedDate": "2020-05-19T08:04:04Z", "type": "commit"}, {"oid": "be73547b855460aee62b0ef6dd58d7a09035b39e", "url": "https://github.com/wso2/carbon-apimgt/commit/be73547b855460aee62b0ef6dd58d7a09035b39e", "message": "Add scope management IS service client", "committedDate": "2020-05-19T08:04:04Z", "type": "commit"}, {"oid": "6c5345d803df4dc6ad8012e10bcc8014ed7c1bf9", "url": "https://github.com/wso2/carbon-apimgt/commit/6c5345d803df4dc6ad8012e10bcc8014ed7c1bf9", "message": "Add global scope management implementation", "committedDate": "2020-05-19T08:04:04Z", "type": "commit"}, {"oid": "347af0142e3212840f9b4c2d1b5a80e26f698e8d", "url": "https://github.com/wso2/carbon-apimgt/commit/347af0142e3212840f9b4c2d1b5a80e26f698e8d", "message": "Add global scope db scripts", "committedDate": "2020-05-19T08:04:04Z", "type": "commit"}, {"oid": "b0a9ba222e1a3936ed177db97bb5881de4d8037d", "url": "https://github.com/wso2/carbon-apimgt/commit/b0a9ba222e1a3936ed177db97bb5881de4d8037d", "message": "Add global scope db support", "committedDate": "2020-05-19T08:04:04Z", "type": "commit"}, {"oid": "a49089ede9ff893763bfe77b94a96a08a9f114ec", "url": "https://github.com/wso2/carbon-apimgt/commit/a49089ede9ff893763bfe77b94a96a08a9f114ec", "message": "Add error decoder", "committedDate": "2020-05-19T08:04:05Z", "type": "commit"}, {"oid": "aeda1749ce0da00e927975c1893e5075943be5de", "url": "https://github.com/wso2/carbon-apimgt/commit/aeda1749ce0da00e927975c1893e5075943be5de", "message": "Add register scope implementation", "committedDate": "2020-05-19T08:04:05Z", "type": "commit"}, {"oid": "68adeaad1440fbca63c3d826b123b46c3c75b395", "url": "https://github.com/wso2/carbon-apimgt/commit/68adeaad1440fbca63c3d826b123b46c3c75b395", "message": "update binding type example value", "committedDate": "2020-05-19T08:04:05Z", "type": "commit"}, {"oid": "a6445db8a911b5ef95ce7f5919eab5f46992e6c7", "url": "https://github.com/wso2/carbon-apimgt/commit/a6445db8a911b5ef95ce7f5919eab5f46992e6c7", "message": "Add Global Scope REST API", "committedDate": "2020-05-19T08:04:05Z", "type": "commit"}, {"oid": "2f64da9b9ff6ef7ce78d670f9fbe4b99914d936c", "url": "https://github.com/wso2/carbon-apimgt/commit/2f64da9b9ff6ef7ce78d670f9fbe4b99914d936c", "message": "Add Primary Key AM_GLOBAL_SCOPE", "committedDate": "2020-05-19T08:04:05Z", "type": "commit"}, {"oid": "1aa4d1119131daf8edde66baabc9bd2c8a7897d4", "url": "https://github.com/wso2/carbon-apimgt/commit/1aa4d1119131daf8edde66baabc9bd2c8a7897d4", "message": "Remove openfeign", "committedDate": "2020-05-19T08:04:05Z", "type": "commit"}, {"oid": "e480fd9f39c254ec7a808d27fbb17095516ff4f5", "url": "https://github.com/wso2/carbon-apimgt/commit/e480fd9f39c254ec7a808d27fbb17095516ff4f5", "message": "Add global scope manage REST API Scope", "committedDate": "2020-05-19T08:04:05Z", "type": "commit"}, {"oid": "f141cecf3ffa320d8ff9d27d45c29dd35d1389b3", "url": "https://github.com/wso2/carbon-apimgt/commit/f141cecf3ffa320d8ff9d27d45c29dd35d1389b3", "message": "Remove fiegn client for scopemanagement\nAdd Http Client for KeyManager\nImplement scopemanagement methods\nFormat code", "committedDate": "2020-05-19T08:04:05Z", "type": "commit"}, {"oid": "4ec49aed080d9064588e0c83caac6b3600764cdb", "url": "https://github.com/wso2/carbon-apimgt/commit/4ec49aed080d9064588e0c83caac6b3600764cdb", "message": "Add scope management methods", "committedDate": "2020-05-19T08:04:06Z", "type": "commit"}, {"oid": "a0736111f6b9e8514fb21dadbd3de152ad72d38d", "url": "https://github.com/wso2/carbon-apimgt/commit/a0736111f6b9e8514fb21dadbd3de152ad72d38d", "message": "Initialize HttpClient for KM", "committedDate": "2020-05-19T08:04:06Z", "type": "commit"}, {"oid": "6ab994199326c1c59c93ce3eb1fb257f964e0504", "url": "https://github.com/wso2/carbon-apimgt/commit/6ab994199326c1c59c93ce3eb1fb257f964e0504", "message": "remove scopebindings dto", "committedDate": "2020-05-19T08:04:06Z", "type": "commit"}, {"oid": "aa4ace75f5b0caa3d1bda0e48acb4d62b7431498", "url": "https://github.com/wso2/carbon-apimgt/commit/aa4ace75f5b0caa3d1bda0e48acb4d62b7431498", "message": "Add scope management dao", "committedDate": "2020-05-19T08:04:06Z", "type": "commit"}, {"oid": "15fa69678b37051ba703d7ac32c48ad184adb5cd", "url": "https://github.com/wso2/carbon-apimgt/commit/15fa69678b37051ba703d7ac32c48ad184adb5cd", "message": "Add scope management implementation layer", "committedDate": "2020-05-19T08:04:06Z", "type": "commit"}, {"oid": "a3c8af0ac34ff10e70ce89d60e9b410ad822712d", "url": "https://github.com/wso2/carbon-apimgt/commit/a3c8af0ac34ff10e70ce89d60e9b410ad822712d", "message": "Update GlobalScope REST API layer", "committedDate": "2020-05-19T08:04:06Z", "type": "commit"}, {"oid": "8d57c60334b30d3dd7566335cdf50b5f674787db", "url": "https://github.com/wso2/carbon-apimgt/commit/8d57c60334b30d3dd7566335cdf50b5f674787db", "message": "handle 404 in isScopeExists usecase", "committedDate": "2020-05-19T08:04:07Z", "type": "commit"}, {"oid": "c27fe62648343de7bda5956efd2ed4379b5c76cb", "url": "https://github.com/wso2/carbon-apimgt/commit/c27fe62648343de7bda5956efd2ed4379b5c76cb", "message": "update binding type example", "committedDate": "2020-05-19T08:04:07Z", "type": "commit"}, {"oid": "33a767da602c175f4212956b082d2b05a00b91a6", "url": "https://github.com/wso2/carbon-apimgt/commit/33a767da602c175f4212956b082d2b05a00b91a6", "message": "attach scope to resource", "committedDate": "2020-05-19T08:04:07Z", "type": "commit"}, {"oid": "236223454dfc3731c51bb0881f092a0f3224edad", "url": "https://github.com/wso2/carbon-apimgt/commit/236223454dfc3731c51bb0881f092a0f3224edad", "message": "Add Scope Mgt DAO", "committedDate": "2020-05-19T08:04:07Z", "type": "commit"}, {"oid": "0fdf8425d1a5a32e351e430132b204f82fc8fc98", "url": "https://github.com/wso2/carbon-apimgt/commit/0fdf8425d1a5a32e351e430132b204f82fc8fc98", "message": "Remove feign dependencies", "committedDate": "2020-05-19T08:04:07Z", "type": "commit"}, {"oid": "dbf3a16ce994e2b604f16aa6e2fc45ed59aa163c", "url": "https://github.com/wso2/carbon-apimgt/commit/dbf3a16ce994e2b604f16aa6e2fc45ed59aa163c", "message": "Add SCOPE_NAME to RESOURCE_SCOPE_MAPPING table.\nAdd IS_SCOPE_ATTACHED_LOCALLY query.", "committedDate": "2020-05-19T08:04:07Z", "type": "commit"}, {"oid": "8902f7f30b68284a4810999b21a01d2bf90f4a4f", "url": "https://github.com/wso2/carbon-apimgt/commit/8902f7f30b68284a4810999b21a01d2bf90f4a4f", "message": "Add SCOPE_NAME, TENANT_ID to RESOURCE_SCOPE_MAPPING table.", "committedDate": "2020-05-19T08:04:08Z", "type": "commit"}, {"oid": "6e3bf0774b85fb988fa669a17d4f7c5537f5f27b", "url": "https://github.com/wso2/carbon-apimgt/commit/6e3bf0774b85fb988fa669a17d4f7c5537f5f27b", "message": "Update scope existence validation logic.", "committedDate": "2020-05-19T08:04:08Z", "type": "commit"}, {"oid": "16c55e8f53251e46587206c1e3ddbcc9ed6e60a4", "url": "https://github.com/wso2/carbon-apimgt/commit/16c55e8f53251e46587206c1e3ddbcc9ed6e60a4", "message": "Fix unit test failures", "committedDate": "2020-05-19T08:04:08Z", "type": "commit"}, {"oid": "acf63462044017c7060d76f43e480f1af9b10d0e", "url": "https://github.com/wso2/carbon-apimgt/commit/acf63462044017c7060d76f43e480f1af9b10d0e", "message": "fix IDN_OAUTH2_RESOURCE_SCOPE table", "committedDate": "2020-05-19T08:04:08Z", "type": "commit"}, {"oid": "b2e1102d27e7350e4d14694c0a1a765af04dccc3", "url": "https://github.com/wso2/carbon-apimgt/commit/b2e1102d27e7350e4d14694c0a1a765af04dccc3", "message": "add detachScopeFromKM extension point to KM implementation", "committedDate": "2020-05-19T08:04:09Z", "type": "commit"}, {"oid": "f2eb03adfbc6d0d56d92d241f9c31c9b8a8bcc93", "url": "https://github.com/wso2/carbon-apimgt/commit/f2eb03adfbc6d0d56d92d241f9c31c9b8a8bcc93", "message": "Update Scopes SQL Queries", "committedDate": "2020-05-19T08:04:09Z", "type": "commit"}, {"oid": "29929fa83ab61ef6c54bf4ed2d57ecf3063a3c9e", "url": "https://github.com/wso2/carbon-apimgt/commit/29929fa83ab61ef6c54bf4ed2d57ecf3063a3c9e", "message": "Update Scopes SQL Queries", "committedDate": "2020-05-19T08:04:09Z", "type": "commit"}, {"oid": "c8e355ffea8041d78bfec66e833b454c6af728f3", "url": "https://github.com/wso2/carbon-apimgt/commit/c8e355ffea8041d78bfec66e833b454c6af728f3", "message": "Add detach scope implementation", "committedDate": "2020-05-19T08:04:09Z", "type": "commit"}, {"oid": "de52b11ff358ee76a2e08c33feee88374a44dfdf", "url": "https://github.com/wso2/carbon-apimgt/commit/de52b11ff358ee76a2e08c33feee88374a44dfdf", "message": "update isScopeExists method changes", "committedDate": "2020-05-19T08:04:09Z", "type": "commit"}, {"oid": "58f0bc529385679827500d06e1c40c70e346a6f3", "url": "https://github.com/wso2/carbon-apimgt/commit/58f0bc529385679827500d06e1c40c70e346a6f3", "message": "add km management application table to keep the OAuth App info for each tenant.\nremove foreign key constraint in IDN_OAUTH2_RESOURCE_SCOPE. This would temporary as the table will be removed in future.", "committedDate": "2020-05-19T08:04:10Z", "type": "commit"}, {"oid": "8709d48ac80a3c776ca4c030fd79608400864057", "url": "https://github.com/wso2/carbon-apimgt/commit/8709d48ac80a3c776ca4c030fd79608400864057", "message": "Add isGlobal field to ScopeDTO to identify the scope as a global scope. This will be useful when showing only local scopes in API specific UI. Local scopes are taken from the API.Scopes. Since global scopes can also be in the same list, there should be way to differenciate them when showing in the API specific scopes UI.  This will not be honered when updating or creating APIs/GlobalScopes.", "committedDate": "2020-05-19T08:04:10Z", "type": "commit"}, {"oid": "2c23ad9ff6676ef754dd6405b16240e2e4545adc", "url": "https://github.com/wso2/carbon-apimgt/commit/2c23ad9ff6676ef754dd6405b16240e2e4545adc", "message": "Only show the local scopes by filtering from API.Scopes[x].isGlobal.", "committedDate": "2020-05-19T08:04:10Z", "type": "commit"}, {"oid": "99147bfc0933a2c121b9f670d7097c0ee871e40c", "url": "https://github.com/wso2/carbon-apimgt/commit/99147bfc0933a2c121b9f670d7097c0ee871e40c", "message": "set isGlobal value when retrieving global scopes and APIs", "committedDate": "2020-05-19T08:04:10Z", "type": "commit"}, {"oid": "5bc4088cdc64a9bca6a7f225381679f93a9cd786", "url": "https://github.com/wso2/carbon-apimgt/commit/5bc4088cdc64a9bca6a7f225381679f93a9cd786", "message": "check if scope attachments present when deleting global scopes", "committedDate": "2020-05-19T08:04:10Z", "type": "commit"}, {"oid": "89bf157dc5780bd27e276cfa6700080d9a0d6657", "url": "https://github.com/wso2/carbon-apimgt/commit/89bf157dc5780bd27e276cfa6700080d9a0d6657", "message": "Check if scope key in request payload is an already defined global scope, if so replace the scope bindings and description with existing values. If not, there would be mismatch in the swagger vs database API scope data.", "committedDate": "2020-05-19T08:04:11Z", "type": "commit"}, {"oid": "8aa51dd2923e56c7c7ce2404fae6eeeb29bf809f", "url": "https://github.com/wso2/carbon-apimgt/commit/8aa51dd2923e56c7c7ce2404fae6eeeb29bf809f", "message": "Add WSO2ISKeyManagerImpl for usecases when WSO2 IS is used as the authorization server.", "committedDate": "2020-05-19T08:04:12Z", "type": "commit"}, {"oid": "88fb2bcd7a381afe21e7db2deb41245a134ee3f6", "url": "https://github.com/wso2/carbon-apimgt/commit/88fb2bcd7a381afe21e7db2deb41245a134ee3f6", "message": "Add KMConfigDeployer to provision OAuth app when each tenant is loading.", "committedDate": "2020-05-19T08:04:12Z", "type": "commit"}, {"oid": "b87e2e073fe63816d2ca4c1f1b7cee66c349d4af", "url": "https://github.com/wso2/carbon-apimgt/commit/b87e2e073fe63816d2ca4c1f1b7cee66c349d4af", "message": "Provision OAuth in KeyManager for super tenant.", "committedDate": "2020-05-19T08:04:12Z", "type": "commit"}, {"oid": "f570a9e2f812471d4dc21f524a66c02ec75da1d4", "url": "https://github.com/wso2/carbon-apimgt/commit/f570a9e2f812471d4dc21f524a66c02ec75da1d4", "message": "Register KMConfigDeployer to bundle context", "committedDate": "2020-05-19T08:04:12Z", "type": "commit"}, {"oid": "85c2d5579cd0db77e71c4042a6d121bc1058c567", "url": "https://github.com/wso2/carbon-apimgt/commit/85c2d5579cd0db77e71c4042a6d121bc1058c567", "message": "Register OAuth Application by calling DCR endpoint when APIM is used as the KM.\nGenerate token each time calling scope management REST APIS. TODO:// Add the tokens to cache/hashmap for better performance.", "committedDate": "2020-05-19T08:04:12Z", "type": "commit"}, {"oid": "2a046edf4ce5d7982e74f778f01b04e696f3e409", "url": "https://github.com/wso2/carbon-apimgt/commit/2a046edf4ce5d7982e74f778f01b04e696f3e409", "message": "Add KM constants.", "committedDate": "2020-05-19T08:04:13Z", "type": "commit"}, {"oid": "45785a8a4c806dd49611260460f9daa26ce0d069", "url": "https://github.com/wso2/carbon-apimgt/commit/45785a8a4c806dd49611260460f9daa26ce0d069", "message": "Add KMRegisterProfileDTO to exchange payload info for DCR request.", "committedDate": "2020-05-19T08:04:13Z", "type": "commit"}, {"oid": "ce0e99c48b970775de78704f97cc9ef627373367", "url": "https://github.com/wso2/carbon-apimgt/commit/ce0e99c48b970775de78704f97cc9ef627373367", "message": "Add KM Application DAO methods.", "committedDate": "2020-05-19T08:04:13Z", "type": "commit"}, {"oid": "9ff5b35bec203a7d65da629de8fe4d4ac0847f83", "url": "https://github.com/wso2/carbon-apimgt/commit/9ff5b35bec203a7d65da629de8fe4d4ac0847f83", "message": "Add KMApplicationDAO changes", "committedDate": "2020-05-19T08:04:13Z", "type": "commit"}, {"oid": "82a9a452a58ce92e951ca17d405646624370f887", "url": "https://github.com/wso2/carbon-apimgt/commit/82a9a452a58ce92e951ca17d405646624370f887", "message": "Add register KM Application method interface.", "committedDate": "2020-05-19T08:04:14Z", "type": "commit"}, {"oid": "9ddbee7c473a05f801d652c6ecdaa1f49cc8b010", "url": "https://github.com/wso2/carbon-apimgt/commit/9ddbee7c473a05f801d652c6ecdaa1f49cc8b010", "message": "remove unused import", "committedDate": "2020-05-19T08:04:14Z", "type": "commit"}, {"oid": "aa89a6cdd99d264a9c2ce76b881195b30885af98", "url": "https://github.com/wso2/carbon-apimgt/commit/aa89a6cdd99d264a9c2ce76b881195b30885af98", "message": "Add isScopeKeyAssignedToAPI method to check whether the scope key assigned to any of the API in the tenant.", "committedDate": "2020-05-19T08:04:14Z", "type": "commit"}, {"oid": "0483c62fefd7fe0ccb148657ff72f21c93cdda22", "url": "https://github.com/wso2/carbon-apimgt/commit/0483c62fefd7fe0ccb148657ff72f21c93cdda22", "message": "Add GetGlobalScopeByName and GetAllGlobalScopeKeys for tenant methods.", "committedDate": "2020-05-19T08:04:14Z", "type": "commit"}, {"oid": "9e0e5d9fa5f4b2a4c6e9e5d939f49420201125ab", "url": "https://github.com/wso2/carbon-apimgt/commit/9e0e5d9fa5f4b2a4c6e9e5d939f49420201125ab", "message": "Add isScopeAssignedToAPI Implementation.", "committedDate": "2020-05-19T08:04:15Z", "type": "commit"}, {"oid": "063ce0e480d1ca3aa3014e807b94fc62b4628c3a", "url": "https://github.com/wso2/carbon-apimgt/commit/063ce0e480d1ca3aa3014e807b94fc62b4628c3a", "message": "Remove duplicate scope check.\n\nTODO://Check if duplicate scope config is needed. https://github.com/wso2/carbon-apimgt/commit/6ddfe74879ecffa38ecd4367bfea8eb456fd033a", "committedDate": "2020-05-19T08:04:15Z", "type": "commit"}, {"oid": "4c0fdc8b6ef8f62f66774e7eead0517ce86d10ba", "url": "https://github.com/wso2/carbon-apimgt/commit/4c0fdc8b6ef8f62f66774e7eead0517ce86d10ba", "message": "Fix scopes issue in creating new version of API.", "committedDate": "2020-05-19T08:04:15Z", "type": "commit"}, {"oid": "124bbb5f5989767af47de660178c0f02ebeed308", "url": "https://github.com/wso2/carbon-apimgt/commit/124bbb5f5989767af47de660178c0f02ebeed308", "message": "Add GetAllGlobalScopeKeys and GetGlobalScopeByName implementations.", "committedDate": "2020-05-19T08:04:15Z", "type": "commit"}, {"oid": "d5aaf212ce4f4f7c5f0b42b12ec6cf26780767b2", "url": "https://github.com/wso2/carbon-apimgt/commit/d5aaf212ce4f4f7c5f0b42b12ec6cf26780767b2", "message": "Fix formatting issues.", "committedDate": "2020-05-19T08:04:15Z", "type": "commit"}, {"oid": "cc029c9118df8914f2bde00fbe60dcb1494cf2a8", "url": "https://github.com/wso2/carbon-apimgt/commit/cc029c9118df8914f2bde00fbe60dcb1494cf2a8", "message": "Add DAO Changes related to scope management.", "committedDate": "2020-05-19T08:04:17Z", "type": "commit"}, {"oid": "692bd75795c79ef08240388e79b7eb9906ba19ac", "url": "https://github.com/wso2/carbon-apimgt/commit/692bd75795c79ef08240388e79b7eb9906ba19ac", "message": "Add Scope management related SQL queries.", "committedDate": "2020-05-19T08:04:17Z", "type": "commit"}, {"oid": "aeb830d4f4cd037a2943751f6b3ab86e686edb7c", "url": "https://github.com/wso2/carbon-apimgt/commit/aeb830d4f4cd037a2943751f6b3ab86e686edb7c", "message": "Fix formatting and minor issues.", "committedDate": "2020-05-19T08:04:18Z", "type": "commit"}, {"oid": "61e9b647967e38950e2c29f5843c489a96946420", "url": "https://github.com/wso2/carbon-apimgt/commit/61e9b647967e38950e2c29f5843c489a96946420", "message": "Fix formatting.", "committedDate": "2020-05-19T08:04:18Z", "type": "commit"}, {"oid": "91d38faa2b2c99d38a561581e5d8b1c289f08be1", "url": "https://github.com/wso2/carbon-apimgt/commit/91d38faa2b2c99d38a561581e5d8b1c289f08be1", "message": "Fix code formatting.", "committedDate": "2020-05-19T08:04:18Z", "type": "commit"}, {"oid": "a990c187a2e90bec69ddcd61c00ba213001cfafb", "url": "https://github.com/wso2/carbon-apimgt/commit/a990c187a2e90bec69ddcd61c00ba213001cfafb", "message": "remove feign import", "committedDate": "2020-05-19T08:04:18Z", "type": "commit"}, {"oid": "6e43f4fed2f0a48c3493f43e8c594d8f9d42c2a0", "url": "https://github.com/wso2/carbon-apimgt/commit/6e43f4fed2f0a48c3493f43e8c594d8f9d42c2a0", "message": "string Ids are compared using .equals()", "committedDate": "2020-05-19T08:04:18Z", "type": "commit"}, {"oid": "1557488c2fb7d964dbff8ed6d0ed09e971593567", "url": "https://github.com/wso2/carbon-apimgt/commit/1557488c2fb7d964dbff8ed6d0ed09e971593567", "message": "minor formatting", "committedDate": "2020-05-19T08:04:19Z", "type": "commit"}, {"oid": "23db2b28efaa6d750e6eaadb558f1d25edff3903", "url": "https://github.com/wso2/carbon-apimgt/commit/23db2b28efaa6d750e6eaadb558f1d25edff3903", "message": "Move Scope DTO to impl.dto package and rename to ScopeDTO.", "committedDate": "2020-05-19T08:04:19Z", "type": "commit"}, {"oid": "95e3e9b43d6903168e517155a368ab21189be1fa", "url": "https://github.com/wso2/carbon-apimgt/commit/95e3e9b43d6903168e517155a368ab21189be1fa", "message": "Remove unused class", "committedDate": "2020-05-19T08:04:20Z", "type": "commit"}, {"oid": "3848d96cba6b6f69713b975d0daddd01376b5044", "url": "https://github.com/wso2/carbon-apimgt/commit/3848d96cba6b6f69713b975d0daddd01376b5044", "message": "add serial version uid", "committedDate": "2020-05-19T08:04:20Z", "type": "commit"}, {"oid": "a9aa1bc48ee578855f225b8ea9d4ad05de471bba", "url": "https://github.com/wso2/carbon-apimgt/commit/a9aa1bc48ee578855f225b8ea9d4ad05de471bba", "message": "add private constructor", "committedDate": "2020-05-19T08:04:20Z", "type": "commit"}, {"oid": "aa6460bccd85b1313c67e5e616b73fd5af4687f2", "url": "https://github.com/wso2/carbon-apimgt/commit/aa6460bccd85b1313c67e5e616b73fd5af4687f2", "message": "fix formatting", "committedDate": "2020-05-19T08:04:20Z", "type": "commit"}, {"oid": "a6f43dc8127c02282264b844de848eb239558c27", "url": "https://github.com/wso2/carbon-apimgt/commit/a6f43dc8127c02282264b844de848eb239558c27", "message": "Fix minor formatting.", "committedDate": "2020-05-19T08:04:20Z", "type": "commit"}, {"oid": "e802b5a034437174602e2525ec54900e0c95e821", "url": "https://github.com/wso2/carbon-apimgt/commit/e802b5a034437174602e2525ec54900e0c95e821", "message": "Add java doc @Override annotation", "committedDate": "2020-05-19T08:04:21Z", "type": "commit"}, {"oid": "fe0e0a1dc4e834473c9e294ea6bf00e4139d4939", "url": "https://github.com/wso2/carbon-apimgt/commit/fe0e0a1dc4e834473c9e294ea6bf00e4139d4939", "message": "Fix formatting", "committedDate": "2020-05-19T08:04:21Z", "type": "commit"}, {"oid": "f1f47be65f7d5a488b5482ff5a483382dc1efad1", "url": "https://github.com/wso2/carbon-apimgt/commit/f1f47be65f7d5a488b5482ff5a483382dc1efad1", "message": "Fix minor formatting.", "committedDate": "2020-05-19T08:04:21Z", "type": "commit"}, {"oid": "452feb5ed6811213dbd93c137646fe52d3bc39a9", "url": "https://github.com/wso2/carbon-apimgt/commit/452feb5ed6811213dbd93c137646fe52d3bc39a9", "message": "Fix minor formatting and add missing java docs.", "committedDate": "2020-05-19T08:04:21Z", "type": "commit"}, {"oid": "93cc8accf711bc6e0b91393ee9bc41cacb9681f7", "url": "https://github.com/wso2/carbon-apimgt/commit/93cc8accf711bc6e0b91393ee9bc41cacb9681f7", "message": "Fix FakeKeyManagerForTest", "committedDate": "2020-05-19T08:04:22Z", "type": "commit"}, {"oid": "cdd0f36b10741694fdd67fcb3eb622065924e010", "url": "https://github.com/wso2/carbon-apimgt/commit/cdd0f36b10741694fdd67fcb3eb622065924e010", "message": "Fix formatting.", "committedDate": "2020-05-19T08:04:22Z", "type": "commit"}, {"oid": "324f6c67b88919979c74e5c83571f099a16637e3", "url": "https://github.com/wso2/carbon-apimgt/commit/324f6c67b88919979c74e5c83571f099a16637e3", "message": "Add debug logs before getting all global scopes.", "committedDate": "2020-05-19T08:04:22Z", "type": "commit"}, {"oid": "9cc712fa42bb9634bc38134f6a8c32836ecc12d0", "url": "https://github.com/wso2/carbon-apimgt/commit/9cc712fa42bb9634bc38134f6a8c32836ecc12d0", "message": "Handle errors for global scopes.", "committedDate": "2020-05-19T08:04:22Z", "type": "commit"}, {"oid": "d2924774d66de6e602f6a6fc432f9e0f40ce0a7d", "url": "https://github.com/wso2/carbon-apimgt/commit/d2924774d66de6e602f6a6fc432f9e0f40ce0a7d", "message": "Adding debug logs", "committedDate": "2020-05-19T08:04:23Z", "type": "commit"}, {"oid": "ae7a8d0dec92a5aec68f781ec1fa8e843cf3fc1a", "url": "https://github.com/wso2/carbon-apimgt/commit/ae7a8d0dec92a5aec68f781ec1fa8e843cf3fc1a", "message": "Add logs for KM OAuth app registration.", "committedDate": "2020-05-19T08:04:23Z", "type": "commit"}, {"oid": "709a27e02c2048e203de0aa4b5e8eccc850bfc1e", "url": "https://github.com/wso2/carbon-apimgt/commit/709a27e02c2048e203de0aa4b5e8eccc850bfc1e", "message": "Change isScopeExists method to first check global scope table and if not exists, call KM.\nChange isGlobalScopeNameExists to directly check the global scope table only.", "committedDate": "2020-05-19T08:04:23Z", "type": "commit"}, {"oid": "f2df8f8e47c91bcc4504a5368bb106bcc20a69b5", "url": "https://github.com/wso2/carbon-apimgt/commit/f2df8f8e47c91bcc4504a5368bb106bcc20a69b5", "message": "update local scope adding logic.", "committedDate": "2020-05-19T08:04:23Z", "type": "commit"}, {"oid": "5ec55b053da380b091eeed3950c939aadaba8dbc", "url": "https://github.com/wso2/carbon-apimgt/commit/5ec55b053da380b091eeed3950c939aadaba8dbc", "message": "skip throwing error when scope already exists in KM when creating new API versions.", "committedDate": "2020-05-19T08:04:23Z", "type": "commit"}, {"oid": "838c897460c1f6585a630cb56d4a9c3366e2ecd6", "url": "https://github.com/wso2/carbon-apimgt/commit/838c897460c1f6585a630cb56d4a9c3366e2ecd6", "message": "Change isScope exists and isScopeAttached queries.", "committedDate": "2020-05-19T08:04:23Z", "type": "commit"}, {"oid": "3055d34568fcc65d37f93a11e482f255e2645711", "url": "https://github.com/wso2/carbon-apimgt/commit/3055d34568fcc65d37f93a11e482f255e2645711", "message": "Move super tenant name and id to constant.", "committedDate": "2020-05-19T08:04:24Z", "type": "commit"}, {"oid": "89f9e7b8fb589cb53d9f02e4b4c22848f48f0159", "url": "https://github.com/wso2/carbon-apimgt/commit/89f9e7b8fb589cb53d9f02e4b4c22848f48f0159", "message": "Rename KMApplicationDAO -> KeyMgtDAO.addApplication\nRemove initialAutoCommit static variable.\nImprove exception handling.", "committedDate": "2020-05-19T08:04:24Z", "type": "commit"}, {"oid": "5438aa6cf67290c7b75f5470bda0455b03e18a2c", "url": "https://github.com/wso2/carbon-apimgt/commit/5438aa6cf67290c7b75f5470bda0455b03e18a2c", "message": "Fix ServerStartupListener with proper naming conventions.\nTODO://Only register when KM profile is used as the KeyManager.", "committedDate": "2020-05-19T08:04:24Z", "type": "commit"}, {"oid": "6a35a013c103ebc33e6a6c5770aff46b8c0dd96a", "url": "https://github.com/wso2/carbon-apimgt/commit/6a35a013c103ebc33e6a6c5770aff46b8c0dd96a", "message": "Add proper naming convensions.", "committedDate": "2020-05-19T08:04:24Z", "type": "commit"}, {"oid": "737756339f2d4de2cc80d5aa41b5cba73a5e017a", "url": "https://github.com/wso2/carbon-apimgt/commit/737756339f2d4de2cc80d5aa41b5cba73a5e017a", "message": "Remove registerOAuthApp extension.", "committedDate": "2020-05-19T08:04:24Z", "type": "commit"}, {"oid": "f4e1e06092efee6b6d0ba494045b4ed77aa1f5bd", "url": "https://github.com/wso2/carbon-apimgt/commit/f4e1e06092efee6b6d0ba494045b4ed77aa1f5bd", "message": "Move the duplicate logic to seperate keymgt service class.", "committedDate": "2020-05-19T08:04:24Z", "type": "commit"}, {"oid": "a221880cb2f986a05c977bd11e2f9ceba267a38e", "url": "https://github.com/wso2/carbon-apimgt/commit/a221880cb2f986a05c977bd11e2f9ceba267a38e", "message": "Rename class names and methods according to convention.", "committedDate": "2020-05-19T08:04:25Z", "type": "commit"}]}