{"pr_number": 8514, "pr_title": "Add implementation of the resource to download Endpoint Definition and adds serviceCategory to RegistryEntry", "pr_createdAt": "2020-05-15T12:21:27Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8514", "timeline": [{"oid": "cf2e021b7e8d8dc51df697bae5068699b7d2e7ba", "url": "https://github.com/wso2/carbon-apimgt/commit/cf2e021b7e8d8dc51df697bae5068699b7d2e7ba", "message": "Add initial impl of the resource to retrieve definition file", "committedDate": "2020-05-15T07:51:49Z", "type": "commit"}, {"oid": "446c750e4f5c046972b884a16ea49aa804344594", "url": "https://github.com/wso2/carbon-apimgt/commit/446c750e4f5c046972b884a16ea49aa804344594", "message": "Resolved conflicts", "committedDate": "2020-05-15T07:59:57Z", "type": "commit"}, {"oid": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc", "url": "https://github.com/wso2/carbon-apimgt/commit/695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc", "message": "Add resource to download endpoint definition", "committedDate": "2020-05-15T12:19:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4MTc5OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r425781798", "bodyText": "Shall we add this to a method so that can be reused in the updateRegistryEntry method", "author": "ChamodDamitha", "createdAt": "2020-05-15T12:55:32Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -197,15 +200,24 @@ public Response createRegistryEntry(String registryId, RegistryEntryDTO registry\n                             \"definition url: \" + registryEntry.getDefinitionUrl() + \" given for the new \" +\n                             \"Endpoint Registry with Registry Id: \" + registryId, e, log);\n                 }\n-                definitionFile = new ResourceFile(null, null);\n             } else {\n                 if (!isValidEndpointDefinition(null, definitionFileInputStream,\n                         registryEntry.getDefinitionType().toString())) {\n                     RestApiUtil.handleBadRequest(\"Error while validating the endpoint definition of \" +\n                             \"the new registry entry with registry id: \" + registryId, log);\n                 }\n-                definitionFile = new ResourceFile(definitionFileInputStream, definitionFileDetail\n-                        .getContentType().getType());\n+                if (RegistryEntryDTO.DefinitionTypeEnum.OAS.equals(registryEntry.getDefinitionType())) {", "originalCommit": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM1NzU2Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r426357563", "bodyText": "Yes. fixed in 247029c", "author": "vithu30", "createdAt": "2020-05-18T03:56:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4MTc5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4NDczMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r425784732", "bodyText": "when endpointDefinition == null, need to throw an error response right?", "author": "ChamodDamitha", "createdAt": "2020-05-15T13:00:37Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -456,4 +481,39 @@ private boolean isValidEndpointDefinition(URL definitionURL, InputStream definit\n         return isValid;\n     }\n \n+    @Override\n+    public Response getEndpointDefinition(String registryId, String entryId, MessageContext messageContext) {\n+        String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+        String contentType = StringUtils.EMPTY;\n+        EndpointRegistry registryProvider = new EndpointRegistryImpl();\n+        InputStream endpointDefinition = null;\n+        try {\n+            EndpointRegistryInfo endpointRegistry = registryProvider.getEndpointRegistryByUUID(registryId, tenantDomain);\n+            if (endpointRegistry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry with the id: \" + registryId +\n+                        \" is not found\", log);\n+            }\n+            EndpointRegistryEntry registryEntry = registryProvider.getEndpointRegistryEntryByUUID(registryId, entryId);\n+            if (registryEntry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry entry with the id: \" + entryId +\n+                        \" is not found\", log);\n+            }\n+            String type = registryEntry.getDefinitionType();\n+            if (RegistryEntryDTO.DefinitionTypeEnum.OAS.equals(RegistryEntryDTO.DefinitionTypeEnum.fromValue(type))\n+                    || RegistryEntryDTO.DefinitionTypeEnum.GQL_SDL.equals(RegistryEntryDTO.DefinitionTypeEnum\n+                    .fromValue(type))) {\n+                contentType = MediaType.APPLICATION_JSON;\n+            } else if (RegistryEntryDTO.DefinitionTypeEnum.WSDL1.equals(RegistryEntryDTO.DefinitionTypeEnum\n+                    .fromValue(type)) || RegistryEntryDTO.DefinitionTypeEnum.WSDL2.equals(RegistryEntryDTO\n+                    .DefinitionTypeEnum.fromValue(type))) {\n+                contentType = MediaType.TEXT_XML;\n+            }\n+            endpointDefinition = registryEntry.getEndpointDefinition();\n+        } catch (APIManagementException e) {\n+            RestApiUtil.handleInternalServerError(\"Error while retrieving the endpoint definition of registry \" +\n+                    \"entry with id: \" + entryId, e, log);\n+        }\n+        return Response.ok(endpointDefinition).type(contentType).build();", "originalCommit": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM1NzUyNg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r426357526", "bodyText": "Fixed in 247029c", "author": "vithu30", "createdAt": "2020-05-18T03:56:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4NDczMg=="}], "type": "inlineReview"}, {"oid": "247029ce354e3351348a849aef6a5a7a3bcec2be", "url": "https://github.com/wso2/carbon-apimgt/commit/247029ce354e3351348a849aef6a5a7a3bcec2be", "message": "Resolve review comments", "committedDate": "2020-05-16T03:55:39Z", "type": "commit"}]}