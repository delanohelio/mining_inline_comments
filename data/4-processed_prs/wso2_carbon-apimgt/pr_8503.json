{"pr_number": 8503, "pr_title": "Get tenant aware username when the EnableEmailUserName", "pr_createdAt": "2020-05-14T04:29:13Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8503", "timeline": [{"oid": "f0a7fb0affc5a2bf06e39aa1001d0baa8747885d", "url": "https://github.com/wso2/carbon-apimgt/commit/f0a7fb0affc5a2bf06e39aa1001d0baa8747885d", "message": "Get tenant aware username when the EnableEmailUserName", "committedDate": "2020-05-14T04:28:40Z", "type": "commit"}, {"oid": "6a2a1b95e65e75c7c2d0dd99405d2a3394b16f7a", "url": "https://github.com/wso2/carbon-apimgt/commit/6a2a1b95e65e75c7c2d0dd99405d2a3394b16f7a", "message": "Get tenant aware username when the EnableEmailUserName", "committedDate": "2020-05-19T09:29:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE4ODQzNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8503#discussion_r427188435", "bodyText": "We shouldn't remove \"carbon.super\" if EnableEmailUserName settings is disabled but username is an email.\nEx1:\nsay username is amalka@gmail.com@carbon.super, then\n\nif isEnableEmailUserName is true => returned username is amalka@gmail.com\nif isEnableEmailUserName is false => return amalka@gmail.com@carbon.super\n\nEx2:\nsay username is malintha@carbon.super, then\n\nif isEnableEmailUserName is true => returned username is malintha\nif isEnableEmailUserName is false => return malintha (same)\n\nBasically you need to move the same logic in AuthManager.jsx with additional check for EnableEmailUserName.\nconst count = (data.username.match(/@/g) || []).length;\nif (isEnableEmailUserName || (data.username.endsWith('@carbon.super') && count <= 1)) {\n    introspectResult.data.username = introspectResult.data.username.replace('@carbon.super', '');\n}", "author": "malinthaprasan", "createdAt": "2020-05-19T10:13:05Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/introspect.jag", "diffHunk": "@@ -46,6 +46,10 @@\n     // For more info about response.xhr object refer http://jaggeryjs.org/documentation.jag?api=xhr\n     \n     if (introspectResult.xhr.status === 200) {\n+        var isEnableEmailUserName = appUtils.isEnableEmailUserName();\n+        if (isEnableEmailUserName || introspectResult.data.username.endsWith('@carbon.super')) {\n+            introspectResult.data.username = introspectResult.data.username.replace('@carbon.super', '');\n+        }", "originalCommit": "6a2a1b95e65e75c7c2d0dd99405d2a3394b16f7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "93f4ac2ed6b03a749e024d972e3b8eab892f0ce4", "url": "https://github.com/wso2/carbon-apimgt/commit/93f4ac2ed6b03a749e024d972e3b8eab892f0ce4", "message": "Get tenant aware username when the EnableEmailUserName", "committedDate": "2020-05-19T12:44:04Z", "type": "commit"}]}