{"pr_number": 8547, "pr_title": "Simplifying Complex Customizations of DTOs related to Application and Subscription Throtttling Policy admin REST APIs", "pr_createdAt": "2020-05-21T07:04:34Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8547", "timeline": [{"oid": "2ab509bcb4779c4cf5a251075a3b24ab2df44940", "url": "https://github.com/wso2/carbon-apimgt/commit/2ab509bcb4779c4cf5a251075a3b24ab2df44940", "message": "Introduce ThrottleLimitType DTO for throttling policies", "committedDate": "2020-05-21T06:20:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUwMjc1MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8547#discussion_r428502750", "bodyText": "We shouldn't do both log and throw.. Let's remove logging here.", "author": "malinthaprasan", "createdAt": "2020-05-21T07:56:15Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/throttling/CommonThrottleMappingUtil.java", "diffHunk": "@@ -205,33 +205,65 @@ public static ThrottleConditionDTO fromConditionToDTO(Condition condition)   //.\n      * @return Derived Quota policy object from DTO\n      * @throws UnsupportedThrottleLimitTypeException\n      */\n-    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitDTO dto) throws UnsupportedThrottleLimitTypeException {\n+    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        ThrottleLimitDTO throttleLimit = getThrottleLimitType(dto);\n         QuotaPolicy quotaPolicy = new QuotaPolicy();\n-        quotaPolicy.setLimit(fromDTOToLimit(dto));\n-        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(dto.getType()));\n+        quotaPolicy.setLimit(fromDTOToLimit(throttleLimit));\n+        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(throttleLimit.getType()));\n         return quotaPolicy;\n     }\n \n     /**\n-     * Converts a Quota Policy object into a Throttle Limit DTO object\n+     * Obtain Throttle Limit DTO object from Throttle Limit Type object\n+     *\n+     * @param dto Throttle Policy Default limit DTO object\n+     * @return Throttle Limit DTO object\n+     * @throws UnsupportedThrottleLimitTypeException\n+     */\n+    public static ThrottleLimitDTO getThrottleLimitType(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        if (dto.getBandwidth() != null && dto.getRequestCount() != null) {\n+            String msg = \"Throttle limit types \" + dto.getBandwidth().getClass().getName() + \" and \" +\n+                    dto.getRequestCount().getClass().getName() + \" cannot be specified at once\";\n+            log.error(msg);", "originalCommit": "2ab509bcb4779c4cf5a251075a3b24ab2df44940", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUwMjc5OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8547#discussion_r428502798", "bodyText": "same here", "author": "malinthaprasan", "createdAt": "2020-05-21T07:56:23Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/throttling/CommonThrottleMappingUtil.java", "diffHunk": "@@ -205,33 +205,65 @@ public static ThrottleConditionDTO fromConditionToDTO(Condition condition)   //.\n      * @return Derived Quota policy object from DTO\n      * @throws UnsupportedThrottleLimitTypeException\n      */\n-    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitDTO dto) throws UnsupportedThrottleLimitTypeException {\n+    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        ThrottleLimitDTO throttleLimit = getThrottleLimitType(dto);\n         QuotaPolicy quotaPolicy = new QuotaPolicy();\n-        quotaPolicy.setLimit(fromDTOToLimit(dto));\n-        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(dto.getType()));\n+        quotaPolicy.setLimit(fromDTOToLimit(throttleLimit));\n+        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(throttleLimit.getType()));\n         return quotaPolicy;\n     }\n \n     /**\n-     * Converts a Quota Policy object into a Throttle Limit DTO object\n+     * Obtain Throttle Limit DTO object from Throttle Limit Type object\n+     *\n+     * @param dto Throttle Policy Default limit DTO object\n+     * @return Throttle Limit DTO object\n+     * @throws UnsupportedThrottleLimitTypeException\n+     */\n+    public static ThrottleLimitDTO getThrottleLimitType(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        if (dto.getBandwidth() != null && dto.getRequestCount() != null) {\n+            String msg = \"Throttle limit types \" + dto.getBandwidth().getClass().getName() + \" and \" +\n+                    dto.getRequestCount().getClass().getName() + \" cannot be specified at once\";\n+            log.error(msg);\n+            throw new UnsupportedThrottleLimitTypeException(msg);\n+        } else if (dto.getBandwidth() != null) {\n+            return dto.getBandwidth();\n+        } else if (dto.getRequestCount() != null) {\n+            return dto.getRequestCount();\n+        } else {\n+            String msg = \"A Throttle limit type has not been specified\";\n+            log.error(msg);", "originalCommit": "2ab509bcb4779c4cf5a251075a3b24ab2df44940", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUwMzYyNw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8547#discussion_r428503627", "bodyText": "throw new UnsupportedThrottleLimitTypeException(\"A Throttle limit type has not been specified\");", "author": "malinthaprasan", "createdAt": "2020-05-21T07:58:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUwMjc5OA=="}], "type": "inlineReview"}, {"oid": "64691a3e9c34c8a8d29932b1002bb81469cb6954", "url": "https://github.com/wso2/carbon-apimgt/commit/64691a3e9c34c8a8d29932b1002bb81469cb6954", "message": "Remove error logs", "committedDate": "2020-05-21T08:28:49Z", "type": "commit"}, {"oid": "64691a3e9c34c8a8d29932b1002bb81469cb6954", "url": "https://github.com/wso2/carbon-apimgt/commit/64691a3e9c34c8a8d29932b1002bb81469cb6954", "message": "Remove error logs", "committedDate": "2020-05-21T08:28:49Z", "type": "forcePushed"}]}