{"pr_number": 9362, "pr_title": "Provide Markdown Editor to Add/Edit Description", "pr_createdAt": "2020-11-03T06:16:01Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/9362", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzMjk0Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/9362#discussion_r524432942", "bodyText": "@hisanhunais It seems like this is a copy of this component\nCan't we reuse it here ?", "author": "tmkasun", "createdAt": "2020-11-16T17:10:44Z", "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/source/src/app/components/Apis/Details/Configuration/components/MarkdownEditor.jsx", "diffHunk": "@@ -0,0 +1,184 @@\n+/*", "originalCommit": "bdd1281c32ff8622ecde54e45df5f446b522ceb5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNDU2Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/9362#discussion_r524434562", "bodyText": "You might have taken this from an existing component, but this injects and higher-order components are a bit old with newer react hooks, Shall we replace injectIntl and withRouter , withStyles with their respective hooks", "author": "tmkasun", "createdAt": "2020-11-16T17:12:20Z", "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/source/src/app/components/Apis/Details/Configuration/components/MarkdownEditor.jsx", "diffHunk": "@@ -0,0 +1,184 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import React, { useState, Suspense, lazy } from 'react';\n+import { withRouter } from 'react-router-dom';\n+import Link from '@material-ui/core/Link';\n+import { FormattedMessage, injectIntl } from 'react-intl';\n+import PropTypes from 'prop-types';\n+import { withStyles } from '@material-ui/core/styles';\n+import Button from '@material-ui/core/Button';\n+import Dialog from '@material-ui/core/Dialog';\n+import IconButton from '@material-ui/core/IconButton';\n+import Typography from '@material-ui/core/Typography';\n+import Slide from '@material-ui/core/Slide';\n+import Icon from '@material-ui/core/Icon';\n+import Paper from '@material-ui/core/Paper';\n+import Grid from '@material-ui/core/Grid';\n+import CircularProgress from '@material-ui/core/CircularProgress';\n+import { isRestricted } from 'AppData/AuthManager';\n+import { useAPI } from 'AppComponents/Apis/Details/components/ApiContext';\n+\n+const MonacoEditor = lazy(() => import('react-monaco-editor' /* webpackChunkName: \"MDMonacoEditor\" */));\n+const ReactMarkdown = lazy(() => import('react-markdown' /* webpackChunkName: \"MDReactMarkdown\" */));\n+\n+const styles = {\n+    flex: {\n+        flex: 1,\n+    },\n+    popupHeader: {\n+        display: 'flex',\n+        flexDirection: 'row',\n+        alignItems: 'center',\n+    },\n+    splitWrapper: {\n+        padding: 0,\n+    },\n+    description: {\n+        alignItems: 'center',\n+        display: 'flex',\n+    },\n+    markdownViewWrapper: {\n+        height: '100vh',\n+        overflowY: 'auto',\n+    },\n+    button: {\n+        height: 30,\n+        marginLeft: 30,\n+    },\n+};\n+\n+function Transition(props) {\n+    return <Slide direction='up' {...props} />;\n+}\n+\n+function MarkdownEditor(props) {\n+    const { api, configDispatcher } = props;\n+    const [open, setOpen] = useState(false);\n+    const [description, setDescription] = useState(null);\n+    const [apiFromContext] = useAPI();\n+    const [isUpdating, setIsUpdating] = useState(false);\n+\n+    const toggleOpen = () => {\n+        if (!open) setDescription(description || api.description);\n+        setOpen(!open);\n+    };\n+    const changeDescription = (newDescription) => {\n+        setDescription(newDescription);\n+    };\n+    const updateDescription = () => {\n+        setIsUpdating(true);\n+        configDispatcher({ action: 'description', value: description });\n+        toggleOpen();\n+        setIsUpdating(false);\n+    };\n+    const editorDidMount = (editor) => {\n+        editor.focus();\n+    };\n+\n+    const { classes } = props;\n+    return (\n+        <div>\n+            <Link onClick={toggleOpen}>\n+                <Button\n+                    color='primary'\n+                    disabled={isRestricted(['apim:api_create'], apiFromContext)}\n+                >\n+                    {api.description ? (\n+                        <FormattedMessage\n+                            id='Apis.Details.Configuration.components.MarkdownEditor.edit.description.button'\n+                            defaultMessage='Edit Description'\n+                        />\n+                    ) : (\n+                        <FormattedMessage\n+                            id='Apis.Details.Configuration.components.MarkdownEditor.add.description.button'\n+                            defaultMessage='Add Description'\n+                        />\n+                    )}\n+                </Button>\n+            </Link>\n+            <Dialog fullScreen open={open} onClose={toggleOpen} TransitionComponent={Transition}>\n+                <Paper square className={classes.popupHeader}>\n+                    <IconButton color='inherit' onClick={toggleOpen} aria-label='Close'>\n+                        <Icon>close</Icon>\n+                    </IconButton>\n+                    <Typography variant='h4' className={classes.description}>\n+                        <FormattedMessage\n+                            id='Apis.Details.Documents.MarkdownEditor.edit.content.of'\n+                            defaultMessage='Edit Description of '\n+                        />\n+                        {api.name}\n+                    </Typography>\n+                    <Button\n+                        className={classes.button}\n+                        variant='contained'\n+                        disabled={isUpdating}\n+                        color='primary'\n+                        onClick={updateDescription}\n+                    >\n+                        <FormattedMessage\n+                            id='Apis.Details.Documents.MarkdownEditor.update.content.button'\n+                            defaultMessage='Update Description'\n+                        />\n+                        {isUpdating && <CircularProgress size={24} />}\n+                    </Button>\n+                    <Button className={classes.button} onClick={toggleOpen}>\n+                        <FormattedMessage\n+                            id='Apis.Details.Documents.MarkdownEditor.cancel.button'\n+                            defaultMessage='Cancel'\n+                        />\n+                    </Button>\n+                </Paper>\n+                <div className={classes.splitWrapper}>\n+                    <Grid container spacing={7}>\n+                        <Grid item xs={6}>\n+                            <Suspense fallback={<CircularProgress />}>\n+                                <MonacoEditor\n+                                    width='100%'\n+                                    height='100vh'\n+                                    language='markdown'\n+                                    theme='vs-dark'\n+                                    value={description}\n+                                    options={{ selectOnLineNumbers: true }}\n+                                    onChange={changeDescription}\n+                                    editorDidMount={editorDidMount}\n+                                />\n+                            </Suspense>\n+                        </Grid>\n+                        <Grid item xs={6}>\n+                            <div className={classes.markdownViewWrapper}>\n+                                <Suspense fallback={<CircularProgress />}>\n+                                    <ReactMarkdown escapeHtml={false} source={description} />\n+                                </Suspense>\n+                            </div>\n+                        </Grid>\n+                    </Grid>\n+                </div>\n+            </Dialog>\n+        </div>\n+    );\n+}\n+\n+MarkdownEditor.propTypes = {\n+    api: PropTypes.shape({}).isRequired,\n+    configDispatcher: PropTypes.func.isRequired,\n+    classes: PropTypes.shape({}).isRequired,\n+    intl: PropTypes.shape({}).isRequired,\n+};\n+\n+export default injectIntl(withRouter(withStyles(styles)(MarkdownEditor)));", "originalCommit": "bdd1281c32ff8622ecde54e45df5f446b522ceb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5ODgxMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/9362#discussion_r542198813", "bodyText": "example :\nwe can remove , injectIntl here,\nimport { makeStyles } from '@material-ui/core/styles';\n.\n.\n.\nconst useStyles = makeStyles()\nconst classes = useStyles();", "author": "tmkasun", "createdAt": "2020-12-14T08:35:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNDU2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5OTg5MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/9362#discussion_r542199891", "bodyText": "there is no usage of withRouter HOC , so I think we can remove that as well", "author": "tmkasun", "createdAt": "2020-12-14T08:36:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNDU2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTgyNDE0OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/9362#discussion_r571824149", "bodyText": "Fixed with f66e3a9", "author": "hisanhunais", "createdAt": "2021-02-08T07:20:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNDU2Mg=="}], "type": "inlineReview"}, {"oid": "d95857acbbfb01ec110788de6cd310a59b4d757b", "url": "https://github.com/wso2/carbon-apimgt/commit/d95857acbbfb01ec110788de6cd310a59b4d757b", "message": "Add markdown editor support for API description", "committedDate": "2021-01-04T06:42:08Z", "type": "commit"}, {"oid": "f66e3a9a634e8447abebfb0698f063af3abb7f6b", "url": "https://github.com/wso2/carbon-apimgt/commit/f66e3a9a634e8447abebfb0698f063af3abb7f6b", "message": "Replace withStyles with makeStyles react hook", "committedDate": "2021-01-05T06:44:32Z", "type": "commit"}, {"oid": "0f1638a6f4dc871c241019c8ab8db4e1eec0f900", "url": "https://github.com/wso2/carbon-apimgt/commit/0f1638a6f4dc871c241019c8ab8db4e1eec0f900", "message": "Add Markdown view for API description", "committedDate": "2021-01-05T08:53:43Z", "type": "commit"}, {"oid": "0f1638a6f4dc871c241019c8ab8db4e1eec0f900", "url": "https://github.com/wso2/carbon-apimgt/commit/0f1638a6f4dc871c241019c8ab8db4e1eec0f900", "message": "Add Markdown view for API description", "committedDate": "2021-01-05T08:53:43Z", "type": "forcePushed"}]}