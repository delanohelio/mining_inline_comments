{"pr_number": 8171, "pr_title": "Sample/Mock Payload Generation for API Inline Prototyping ", "pr_createdAt": "2020-02-11T12:52:51Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8171", "timeline": [{"oid": "baa7bfc4ac54276e9dcbad1ffde9409384ecf02b", "url": "https://github.com/wso2/carbon-apimgt/commit/baa7bfc4ac54276e9dcbad1ffde9409384ecf02b", "message": "Created REST API for generate mocks\nBuilt publisher v1\nAPI and API service had methods added\nmethod implemented in APISERVICEimpl class", "committedDate": "2019-12-20T09:28:05Z", "type": "commit"}, {"oid": "cedcb426621f436ac3625b02bf3820bf16b22d27", "url": "https://github.com/wso2/carbon-apimgt/commit/cedcb426621f436ac3625b02bf3820bf16b22d27", "message": "Changes made to OAS2Parser and OAS3Parser and OAS3Reader implementation added to APIserviceIMPL", "committedDate": "2020-01-08T02:51:02Z", "type": "commit"}, {"oid": "af3e89fbc2c91987dc6eee5270816c5960555ab8", "url": "https://github.com/wso2/carbon-apimgt/commit/af3e89fbc2c91987dc6eee5270816c5960555ab8", "message": "Changes made to OAS2Parser and OAS3Parser and OAS3Reader implementation added to APIserviceIMPL", "committedDate": "2020-01-08T02:53:08Z", "type": "commit"}, {"oid": "8e452c3aaf34122e1677801c24baf486a8cc049c", "url": "https://github.com/wso2/carbon-apimgt/commit/8e452c3aaf34122e1677801c24baf486a8cc049c", "message": "Changes made to OAS2Parser and OAS3Parser and OAS3Reader implementation added to APIserviceIMPL", "committedDate": "2020-01-08T08:53:09Z", "type": "commit"}, {"oid": "f481970297821213d9c858076948e3975b7f22c3", "url": "https://github.com/wso2/carbon-apimgt/commit/f481970297821213d9c858076948e3975b7f22c3", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-01-08T09:29:17Z", "type": "commit"}, {"oid": "456d8b4eaaf63709f8182e99aac22b215d094db1", "url": "https://github.com/wso2/carbon-apimgt/commit/456d8b4eaaf63709f8182e99aac22b215d094db1", "message": "all conflicts in publisher yaml resolved", "committedDate": "2020-01-08T10:00:42Z", "type": "commit"}, {"oid": "8d9c0213eb61261702dad735efad832645af8c28", "url": "https://github.com/wso2/carbon-apimgt/commit/8d9c0213eb61261702dad735efad832645af8c28", "message": "Sample Mock Payload Generation for JSON and XML as Comments along with Payload Variables", "committedDate": "2020-01-30T11:26:38Z", "type": "commit"}, {"oid": "50e84db7b50af95bfe934504a8ff9307ff97fef4", "url": "https://github.com/wso2/carbon-apimgt/commit/50e84db7b50af95bfe934504a8ff9307ff97fef4", "message": "inline prototyping for beta release", "committedDate": "2020-02-11T05:34:49Z", "type": "commit"}, {"oid": "426070bb7230485d4478a3b46a19ccd12ce2f86e", "url": "https://github.com/wso2/carbon-apimgt/commit/426070bb7230485d4478a3b46a19ccd12ce2f86e", "message": "conflicts resolved for inline prototyping beta release", "committedDate": "2020-02-11T06:15:41Z", "type": "commit"}, {"oid": "c4904c3409699ea6894a80d7d42269eba9fa7f1e", "url": "https://github.com/wso2/carbon-apimgt/commit/c4904c3409699ea6894a80d7d42269eba9fa7f1e", "message": "2nd (u)conflicts of Apisapiserviceimpl", "committedDate": "2020-02-11T08:53:01Z", "type": "commit"}, {"oid": "51985f50e39e0db1fee26ad5b3a9088813b19f74", "url": "https://github.com/wso2/carbon-apimgt/commit/51985f50e39e0db1fee26ad5b3a9088813b19f74", "message": "conflicts from rejected push fixed", "committedDate": "2020-02-11T09:05:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5ODk4NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8171#discussion_r377998985", "bodyText": "provide the version in the root pom and don't use the version here. Check how this is done for other dependencies.", "author": "malinthaprasan", "createdAt": "2020-02-12T01:42:02Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/pom.xml", "diffHunk": "@@ -284,6 +284,12 @@\n             <groupId>org.wso2.orbit.io.swagger</groupId>\n             <artifactId>swagger-parser</artifactId>\n         </dependency>\n+        <!-- https://mvnrepository.com/artifact/io.swagger/swagger-inflector -->\n+        <dependency>\n+            <groupId>io.swagger</groupId>\n+            <artifactId>swagger-inflector</artifactId>\n+            <version>2.0.5</version>", "originalCommit": "51985f50e39e0db1fee26ad5b3a9088813b19f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5OTI0NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8171#discussion_r377999245", "bodyText": "Don't use * imports. Use each import individually. You can get help from the IDE to expand this.", "author": "malinthaprasan", "createdAt": "2020-02-12T01:43:11Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS2Parser.java", "diffHunk": "@@ -19,23 +19,17 @@\n \n package org.wso2.carbon.apimgt.impl.definitions;\n \n+\n import com.fasterxml.jackson.annotation.JsonInclude;\n import com.fasterxml.jackson.core.JsonProcessingException;\n import com.fasterxml.jackson.databind.JsonNode;\n import com.fasterxml.jackson.databind.ObjectMapper;\n import com.fasterxml.jackson.databind.SerializationFeature;\n-import io.swagger.models.Contact;\n-import io.swagger.models.HttpMethod;\n-import io.swagger.models.Info;\n-import io.swagger.models.Operation;\n-import io.swagger.models.Path;\n-import io.swagger.models.RefModel;\n-import io.swagger.models.RefPath;\n-import io.swagger.models.RefResponse;\n-import io.swagger.models.Response;\n-import io.swagger.models.Scheme;\n-import io.swagger.models.SecurityRequirement;\n-import io.swagger.models.Swagger;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import io.swagger.inflector.examples.ExampleBuilder;\n+import io.swagger.inflector.examples.models.Example;\n+import io.swagger.inflector.processors.JsonNodeExampleSerializer;\n+import io.swagger.models.*;", "originalCommit": "51985f50e39e0db1fee26ad5b3a9088813b19f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5OTUxNA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8171#discussion_r377999514", "bodyText": "Remove if this is not required.", "author": "malinthaprasan", "createdAt": "2020-02-12T01:44:17Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/pom.xml", "diffHunk": "@@ -116,6 +116,12 @@\n             <groupId>org.wso2.carbon.apimgt</groupId>\n             <artifactId>org.wso2.carbon.apimgt.impl</artifactId>\n             <scope>provided</scope>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>org.wso2.orbit.io.swagger</groupId>\n+                    <artifactId>swagger-inflector</artifactId>\n+                </exclusion>\n+            </exclusions>", "originalCommit": "51985f50e39e0db1fee26ad5b3a9088813b19f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5OTU5MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8171#discussion_r377999590", "bodyText": "Remove unnecessary dependencies.", "author": "malinthaprasan", "createdAt": "2020-02-12T01:44:41Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/pom.xml", "diffHunk": "@@ -127,6 +133,11 @@\n                 </exclusion>\n             </exclusions>\n         </dependency>\n+        <dependency>\n+            <groupId>io.swagger</groupId>\n+            <artifactId>swagger-inflector</artifactId>\n+            <version>2.0.0-rc3</version>\n+        </dependency>", "originalCommit": "51985f50e39e0db1fee26ad5b3a9088813b19f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5OTg0MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8171#discussion_r377999841", "bodyText": "Add parameter descriptions. Have a look at the other methods.", "author": "malinthaprasan", "createdAt": "2020-02-12T01:45:42Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/publisher/v1/impl/ApisApiServiceImpl.java", "diffHunk": "@@ -3893,6 +3912,29 @@ public Response apisValidateGraphqlSchemaPost(InputStream fileInputStream, Attac\n         return Response.ok().entity(validationResponse).build();\n     }\n \n+    /**\n+     * Generates Mock response examples for Inline prototyping\n+     * of a swagger\n+     *\n+     * @param apiId\n+     * @param ifNoneMatch\n+     * @param messageContext\n+     * @return\n+     * @throws APIManagementException", "originalCommit": "51985f50e39e0db1fee26ad5b3a9088813b19f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwMDE4OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8171#discussion_r378000188", "bodyText": "Correct the description.", "author": "malinthaprasan", "createdAt": "2020-02-12T01:46:58Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/src/main/resources/publisher-api.yaml", "diffHunk": "@@ -607,6 +609,67 @@ paths:\n           schema:\n             $ref: '#/definitions/Error'\n \n+  ################################################################\n+  # The swagger resource of \"Individual API\" resource APIs\n+  ################################################################\n+\n+  /apis/{apiId}/generate-mock-responses:\n+    #-----------------------------------------------------\n+    # Generate Mock responses from Swagger/OAS Definition\n+    #-----------------------------------------------------\n+    post:\n+      operationId: generateMockResponses\n+      summary: Get swagger definition\n+      description: |\n+        This operation can be used to retrieve the swagger definition of an API.", "originalCommit": "51985f50e39e0db1fee26ad5b3a9088813b19f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwMDI5Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8171#discussion_r378000296", "bodyText": "Scope is wrong. Use apim:api_create", "author": "malinthaprasan", "createdAt": "2020-02-12T01:47:26Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/src/main/resources/publisher-api.yaml", "diffHunk": "@@ -607,6 +609,67 @@ paths:\n           schema:\n             $ref: '#/definitions/Error'\n \n+  ################################################################\n+  # The swagger resource of \"Individual API\" resource APIs\n+  ################################################################\n+\n+  /apis/{apiId}/generate-mock-responses:\n+    #-----------------------------------------------------\n+    # Generate Mock responses from Swagger/OAS Definition\n+    #-----------------------------------------------------\n+    post:\n+      operationId: generateMockResponses\n+      summary: Get swagger definition\n+      description: |\n+        This operation can be used to retrieve the swagger definition of an API.\n+      security:\n+        - OAuth2Security:\n+            - apim:api_view", "originalCommit": "51985f50e39e0db1fee26ad5b3a9088813b19f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwMDcyMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8171#discussion_r378000720", "bodyText": "Format the code. Having this will fail the build also.\nMake sure to do a full build \"mvn clean install\" before sending the final PR.\nWhy do we need to pass a null?", "author": "malinthaprasan", "createdAt": "2020-02-12T01:48:55Z", "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/source/src/app/components/Apis/Details/APIDefinition/APIDefinition.jsx", "diffHunk": "@@ -307,6 +307,10 @@ class APIDefinition extends React.Component {\n         const promise = api.updateSwagger(parsedContent);\n         promise\n             .then((response) => {\n+                const {endpointImplementationType } = api;\n+                if(endpointImplementationType === \"INLINE\"){\n+                    api.generateMockResponses(api.id,null);\n+                }", "originalCommit": "51985f50e39e0db1fee26ad5b3a9088813b19f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6602569c91f4a732918fb13c0fdb97a920526d93", "url": "https://github.com/wso2/carbon-apimgt/commit/6602569c91f4a732918fb13c0fdb97a920526d93", "message": "API inline prototyping mock/sample payload after tests", "committedDate": "2020-02-12T11:40:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIwMzI2NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8171#discussion_r378203265", "bodyText": "extra spaces", "author": "malinthaprasan", "createdAt": "2020-02-12T11:49:28Z", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/APIDefinition.java", "diffHunk": "@@ -42,6 +42,15 @@\n     private static final Pattern CURLY_BRACES_PATTERN = Pattern.compile(\"(?<=\\\\{)(?!\\\\s*\\\\{)[^{}]+\");\n     public static final String KEEP_LEGACY_EXTENSION_PROP = \"preserveLegacyExtensions\";\n \n+    /**\n+     * This method generates Mock/Sample payloads for API prototyping\n+     *\n+     * @param apiDefinition\n+     * @return\n+     */\n+", "originalCommit": "6602569c91f4a732918fb13c0fdb97a920526d93", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "26682f3ad3febb087e9f5994f5fb2cb409e721ab", "url": "https://github.com/wso2/carbon-apimgt/commit/26682f3ad3febb087e9f5994f5fb2cb409e721ab", "message": "spacing and exclusion issues resolved", "committedDate": "2020-02-12T12:43:20Z", "type": "commit"}, {"oid": "a9bafeb79f5c51dce0e8cb9f9be3497581360a03", "url": "https://github.com/wso2/carbon-apimgt/commit/a9bafeb79f5c51dce0e8cb9f9be3497581360a03", "message": "pom commented exclusion deleted", "committedDate": "2020-02-12T12:47:25Z", "type": "commit"}]}