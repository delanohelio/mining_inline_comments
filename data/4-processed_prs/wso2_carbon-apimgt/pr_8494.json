{"pr_number": 8494, "pr_title": "Update endpoint registry", "pr_createdAt": "2020-05-12T15:38:35Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8494", "timeline": [{"oid": "e1d64fc7bd4323dbcc752da4129e17deb33ea05b", "url": "https://github.com/wso2/carbon-apimgt/commit/e1d64fc7bd4323dbcc752da4129e17deb33ea05b", "message": "Update wendpoint registry", "committedDate": "2020-05-12T15:35:25Z", "type": "commit"}, {"oid": "ffc5529b3748a9b92f7f719e1496b69e59e98002", "url": "https://github.com/wso2/carbon-apimgt/commit/ffc5529b3748a9b92f7f719e1496b69e59e98002", "message": "fix javadoc", "committedDate": "2020-05-12T15:38:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MTcxNA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8494#discussion_r424171714", "bodyText": "Shall we return the updated Registry object in response.", "author": "vithu30", "createdAt": "2020-05-13T04:54:46Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -164,7 +164,23 @@ public Response createRegistryEntry(String registryId, RegistryEntryDTO registry\n     @Override\n     public Response updateRegistry(String registryId, RegistryDTO body, MessageContext messageContext) {\n \n-        return Response.ok().entity(body).build();\n+        String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+        String user = RestApiUtil.getLoggedInUsername();\n+        EndpointRegistry registryProvider = new EndpointRegistryImpl();\n+        EndpointRegistryInfo registryToUpdate = EndpointRegistryMappingUtils.fromDTOtoEndpointRegistry(body, user);\n+        try {\n+            EndpointRegistryInfo endpointRegistry =\n+                    registryProvider.getEndpointRegistryByUUID(registryId, tenantDomain);\n+            if (endpointRegistry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry with the id: \" + registryId +\n+                        \" is not found\", log);\n+            }\n+            registryProvider.updateEndpointRegistry(registryId, registryToUpdate);\n+        } catch (APIManagementException e) {\n+            RestApiUtil.handleInternalServerError(\"Error while updating the endpoint registry \" +\n+                    \"with id: \" + registryId, e, log);\n+        }\n+        return Response.ok().entity(\"Successfully updated the endpoint registry\").build();", "originalCommit": "ffc5529b3748a9b92f7f719e1496b69e59e98002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MjY3MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8494#discussion_r424172671", "bodyText": "ack. missed it", "author": "fazlan-nazeem", "createdAt": "2020-05-13T04:58:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MTcxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MjI2OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8494#discussion_r424172269", "bodyText": "We don't need to generate uuid when updating the Registry. Shall we remove it?", "author": "vithu30", "createdAt": "2020-05-13T04:57:03Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14757,6 +14757,37 @@ public String addEndpointRegistry(EndpointRegistryInfo endpointRegistry, int ten\n         return uuid;\n     }\n \n+    /**\n+     * Update an existing endpoint registry.\n+     *\n+     * @param registryId uuid of the endpoint registry\n+     * @param endpointRegistry EndpointRegistryInfo object with updated details\n+     * @return uuid of the updated endpoint registry\n+     * @throws APIManagementException if unable to update the endpoint registry\n+     */\n+    public String updateEndpointRegistry(String registryId, EndpointRegistryInfo endpointRegistry) throws\n+            APIManagementException {\n+\n+        String query = SQLConstants.UPDATE_ENDPOINT_REGISTRY_SQL;\n+        String uuid = UUID.randomUUID().toString();", "originalCommit": "ffc5529b3748a9b92f7f719e1496b69e59e98002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MjgzOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8494#discussion_r424172838", "bodyText": "ack", "author": "fazlan-nazeem", "createdAt": "2020-05-13T04:59:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MjI2OQ=="}], "type": "inlineReview"}, {"oid": "673eb96a79ebfb16d2e70071939589967e47c699", "url": "https://github.com/wso2/carbon-apimgt/commit/673eb96a79ebfb16d2e70071939589967e47c699", "message": "Fix signature of update method", "committedDate": "2020-05-13T05:13:05Z", "type": "commit"}, {"oid": "32b5faf1684c62a4478cbdfeed5ecbbc36ab152d", "url": "https://github.com/wso2/carbon-apimgt/commit/32b5faf1684c62a4478cbdfeed5ecbbc36ab152d", "message": "reomve unused field", "committedDate": "2020-05-13T05:44:58Z", "type": "commit"}]}