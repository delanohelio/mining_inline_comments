{"pr_number": 8516, "pr_title": "[Admin Portal Revamp] Microgateway Labels", "pr_createdAt": "2020-05-15T12:42:27Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8516", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc3NzA4NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r425777085", "bodyText": "Why we need to define a variable here ?", "author": "tmkasun", "createdAt": "2020-05-15T12:47:03Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/admin_new/source/src/app/components/AdminPages/Addons/InputListBase.jsx", "diffHunk": "@@ -0,0 +1,106 @@\n+import React, { useEffect, useState } from 'react';\n+import PropTypes from 'prop-types';\n+import { createMuiTheme } from '@material-ui/core/styles';\n+import Grid from '@material-ui/core/Grid';\n+import TextField from '@material-ui/core/TextField';\n+import Button from '@material-ui/core/Button';\n+import Box from '@material-ui/core/Box';\n+\n+let id;", "originalCommit": "64581005799a1c61e0df02c8afde0d7dfe79dc37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM4Mzk5MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r426383991", "bodyText": "Fixed with commit: c285a00", "author": "chathuranga95", "createdAt": "2020-05-18T05:55:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc3NzA4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc3NzYwMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r425777603", "bodyText": "Please destructure the event values before use", "author": "tmkasun", "createdAt": "2020-05-15T12:47:56Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/admin_new/source/src/app/components/AdminPages/Addons/InputListBase.jsx", "diffHunk": "@@ -0,0 +1,106 @@\n+import React, { useEffect, useState } from 'react';\n+import PropTypes from 'prop-types';\n+import { createMuiTheme } from '@material-ui/core/styles';\n+import Grid from '@material-ui/core/Grid';\n+import TextField from '@material-ui/core/TextField';\n+import Button from '@material-ui/core/Button';\n+import Box from '@material-ui/core/Box';\n+\n+let id;\n+\n+const theme = createMuiTheme();\n+theme.spacing(2);\n+\n+const InputList = (props) => {\n+    const {\n+        onInputListChange, initialList, inputLabelPrefix, helperText, addButtonLabel,\n+    } = props;\n+    const [userInputItems, setUserInputItems] = useState([]);\n+\n+    const handleInput = (e) => {\n+        let tempItems = userInputItems.filter((item) => item.key !== e.target.name);", "originalCommit": "64581005799a1c61e0df02c8afde0d7dfe79dc37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM4NDEyNA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r426384124", "bodyText": "Fixed with commit: c285a00", "author": "chathuranga95", "createdAt": "2020-05-18T05:56:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc3NzYwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc3ODU5MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r425778591", "bodyText": "Have we ignored eslint check in this file ? , AFAIR this is an eslint rule violation", "author": "tmkasun", "createdAt": "2020-05-15T12:49:45Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/admin_new/source/src/app/components/AdminPages/Addons/InputListBase.jsx", "diffHunk": "@@ -0,0 +1,106 @@\n+import React, { useEffect, useState } from 'react';\n+import PropTypes from 'prop-types';\n+import { createMuiTheme } from '@material-ui/core/styles';\n+import Grid from '@material-ui/core/Grid';\n+import TextField from '@material-ui/core/TextField';\n+import Button from '@material-ui/core/Button';\n+import Box from '@material-ui/core/Box';\n+\n+let id;\n+\n+const theme = createMuiTheme();\n+theme.spacing(2);\n+\n+const InputList = (props) => {\n+    const {\n+        onInputListChange, initialList, inputLabelPrefix, helperText, addButtonLabel,\n+    } = props;\n+    const [userInputItems, setUserInputItems] = useState([]);\n+\n+    const handleInput = (e) => {\n+        let tempItems = userInputItems.filter((item) => item.key !== e.target.name);\n+        tempItems = [...tempItems, { key: '' + e.target.name, value: e.target.value }];\n+        tempItems.sort((a, b) => {\n+            return a.key - b.key;\n+        });\n+        setUserInputItems(tempItems);\n+    };\n+\n+    const handleDelete = (deletingKey) => {\n+        const tempItems = userInputItems.filter((item) => (item.key !== deletingKey));\n+        setUserInputItems(tempItems);\n+    };\n+\n+    useEffect(() => {\n+        const nonEmptyItems = [];\n+        for (let i = 0; i < userInputItems.length; i++) {\n+            if (userInputItems[i].value && userInputItems[i].value.trim() !== '') {\n+                nonEmptyItems.push(userInputItems[i].value.trim());\n+            }\n+        }\n+        onInputListChange(nonEmptyItems);\n+    }, [userInputItems]);\n+\n+    useEffect(() => {\n+        id = 1;", "originalCommit": "64581005799a1c61e0df02c8afde0d7dfe79dc37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM1MzgxMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r426353811", "bodyText": "eslint check is enabled for this file.", "author": "chathuranga95", "createdAt": "2020-05-18T03:36:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc3ODU5MQ=="}], "type": "inlineReview"}, {"oid": "e9926a12868decf1ce65d96c948279d3be67971d", "url": "https://github.com/wso2/carbon-apimgt/commit/e9926a12868decf1ce65d96c948279d3be67971d", "message": "Fix eslint issues", "committedDate": "2020-05-15T16:44:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM2MDc3OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r426360778", "bodyText": "Add i18n", "author": "menakaj", "createdAt": "2020-05-18T04:13:15Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/admin_new/source/src/app/components/AdminPages/Addons/InputListBase.jsx", "diffHunk": "@@ -0,0 +1,106 @@\n+import React, { useEffect, useState } from 'react';\n+import PropTypes from 'prop-types';\n+import { createMuiTheme } from '@material-ui/core/styles';\n+import Grid from '@material-ui/core/Grid';\n+import TextField from '@material-ui/core/TextField';\n+import Button from '@material-ui/core/Button';\n+import Box from '@material-ui/core/Box';\n+\n+let id;\n+\n+const theme = createMuiTheme();\n+theme.spacing(2);\n+\n+const InputList = (props) => {\n+    const {\n+        onInputListChange, initialList, inputLabelPrefix, helperText, addButtonLabel,\n+    } = props;\n+    const [userInputItems, setUserInputItems] = useState([]);\n+\n+    const handleInput = (e) => {\n+        let tempItems = userInputItems.filter((item) => item.key !== e.target.name);\n+        tempItems = [...tempItems, { key: '' + e.target.name, value: e.target.value }];\n+        tempItems.sort((a, b) => {\n+            return a.key - b.key;\n+        });\n+        setUserInputItems(tempItems);\n+    };\n+\n+    const handleDelete = (deletingKey) => {\n+        const tempItems = userInputItems.filter((item) => (item.key !== deletingKey));\n+        setUserInputItems(tempItems);\n+    };\n+\n+    useEffect(() => {\n+        const nonEmptyItems = [];\n+        for (let i = 0; i < userInputItems.length; i++) {\n+            if (userInputItems[i].value && userInputItems[i].value.trim() !== '') {\n+                nonEmptyItems.push(userInputItems[i].value.trim());\n+            }\n+        }\n+        onInputListChange(nonEmptyItems);\n+    }, [userInputItems]);\n+\n+    useEffect(() => {\n+        id = 1;\n+        if (initialList) {\n+            setUserInputItems(initialList.map((item) => {\n+                return { key: '' + id++, value: item };\n+            }));\n+        } else {\n+            setUserInputItems([{ key: '1', value: '' }]);\n+        }\n+    }, []);\n+\n+    const onAddInputField = () => {\n+        const newUserItemList = [...userInputItems, { key: '' + id++, value: '' }];\n+        setUserInputItems(newUserItemList);\n+    };\n+\n+    let labelCounter = 1;\n+    return (\n+        <div>\n+            {userInputItems.map((item) => {\n+                return (\n+                    <Grid container xs={12} direction='row' spacing={0}>\n+                        <TextField\n+                            margin='dense'\n+                            name={item.key}\n+                            onChange={handleInput}\n+                            label={inputLabelPrefix + ' ' + labelCounter++}\n+                            value={item.value}\n+                            helperText={helperText}\n+                            variant='outlined'\n+                        />\n+                        <Box mt={1}>\n+                            <Button\n+                                color='primary'\n+                                onClick={() => handleDelete(item.key)}\n+                            >\n+                                    Remove", "originalCommit": "e9926a12868decf1ce65d96c948279d3be67971d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM4NDM3Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r426384376", "bodyText": "Fixed with commit: b0610c2", "author": "chathuranga95", "createdAt": "2020-05-18T05:57:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM2MDc3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM2MDg5Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r426360897", "bodyText": "Remove unnecessary empty lines", "author": "menakaj", "createdAt": "2020-05-18T04:14:03Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/admin_new/source/src/app/components/MicrogatewayLabels/AddEditMGLabel.jsx", "diffHunk": "@@ -0,0 +1,283 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import React, { useReducer, useEffect } from 'react';\n+import API from 'AppData/api';\n+import PropTypes from 'prop-types';\n+import TextField from '@material-ui/core/TextField';\n+import DialogContentText from '@material-ui/core/DialogContentText';\n+import { FormattedMessage } from 'react-intl';\n+import FormControl from '@material-ui/core/FormControl';\n+import { makeStyles } from '@material-ui/core/styles';\n+import FormDialogBase from 'AppComponents/AdminPages/Addons/FormDialogBase';\n+import Alert from 'AppComponents/Shared/Alert';\n+import ListInput from 'AppComponents/AdminPages/Addons/InputListBase';\n+\n+const useStyles = makeStyles((theme) => ({\n+    error: {\n+        color: theme.palette.error.dark,\n+    },\n+    addEditFormControl: {\n+        minHeight: theme.spacing(40),\n+        maxHeight: theme.spacing(40),\n+        minWidth: theme.spacing(55),\n+    },\n+}));\n+\n+let initialState = {\n+    name: '',\n+    description: '',\n+    hosts: [],\n+};\n+\n+/**\n+ * Reducer\n+ * @param {JSON} state State\n+ * @returns {Promise}.\n+ */\n+function reducer(state, { field, value }) {\n+    return {\n+        ...state,\n+        [field]: value,\n+    };\n+}\n+\n+/**\n+ * Render a pop-up dialog to add/edit an Microgateway label\n+ * @param {JSON} props .\n+ * @returns {JSX}.\n+ */\n+function AddEditMGLabel(props) {\n+    const {\n+        updateList, dataRow, icon, triggerButtonText, title,\n+    } = props;\n+    const classes = useStyles();\n+    let id = null;\n+    // If the dataRow is there ( form is in edit mode ) else it's a new creation\n+    useEffect(() => {\n+        initialState = {\n+            name: '',\n+            description: '',\n+            hosts: [],\n+        };\n+    }, [title]);\n+\n+    if (dataRow) {\n+        // eslint-disable-next-line react/prop-types\n+        const { name: originalName, description: originalDescription, accessUrls: originalHosts } = dataRow;\n+        id = dataRow.id;\n+\n+        initialState = {\n+            name: originalName,\n+            description: originalDescription,\n+            hosts: originalHosts,\n+        };\n+    }\n+\n+    const [state, dispatch] = useReducer(reducer, initialState);\n+    const { name, description, hosts } = state;\n+\n+", "originalCommit": "e9926a12868decf1ce65d96c948279d3be67971d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM4NDIyMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r426384222", "bodyText": "Fixed with commit: c285a00", "author": "chathuranga95", "createdAt": "2020-05-18T05:56:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM2MDg5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM2MTA0NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r426361045", "bodyText": "Add i18n", "author": "menakaj", "createdAt": "2020-05-18T04:14:50Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/admin_new/source/src/app/components/MicrogatewayLabels/DeleteMGLabel.jsx", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import React from 'react';\n+import API from 'AppData/api';\n+import PropTypes from 'prop-types';\n+import { FormattedMessage } from 'react-intl';\n+import DialogContentText from '@material-ui/core/DialogContentText';\n+import DeleteForeverIcon from '@material-ui/icons/DeleteForever';\n+import FormDialogBase from 'AppComponents/AdminPages/Addons/FormDialogBase';\n+\n+/**\n+ * Render delete dialog box.\n+ * @param {JSON} props component props.\n+ * @returns {JSX} Loading animation.\n+ */\n+function Delete({ updateList, dataRow }) {\n+    const { id } = dataRow;\n+\n+    const formSaveCallback = () => {\n+        const promiseAPICall = new Promise((resolve, reject) => {\n+            const restApi = new API();\n+            restApi\n+                .deleteMicrogatewayLabel(id)\n+                .then(() => {\n+                    resolve(\n+                        <FormattedMessage\n+                            id='AdminPages.Microgateways.Delete.form.delete.successful'\n+                            defaultMessage='Microgateway Label deleted successfully'\n+                        />,\n+                    );\n+                })\n+                .catch((error) => {\n+                    reject(error.response.body.description);\n+                })\n+                .finally(() => {\n+                    updateList();\n+                });\n+        });\n+\n+        return promiseAPICall;\n+    };\n+\n+    return (\n+        <FormDialogBase\n+            title='Delete Microgateway Label?'\n+            saveButtonText='Delete'\n+            icon={<DeleteForeverIcon />}\n+            formSaveCallback={formSaveCallback}\n+        >\n+            <DialogContentText>Are you sure you want to delete this Microgateway Label?</DialogContentText>", "originalCommit": "e9926a12868decf1ce65d96c948279d3be67971d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM4NDMzNg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8516#discussion_r426384336", "bodyText": "Fixed with commit: b0610c2", "author": "chathuranga95", "createdAt": "2020-05-18T05:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM2MTA0NQ=="}], "type": "inlineReview"}, {"oid": "7a9ea7bba48759d8171b704dd33de0e55c103f94", "url": "https://github.com/wso2/carbon-apimgt/commit/7a9ea7bba48759d8171b704dd33de0e55c103f94", "message": "Add microgateway Listing", "committedDate": "2020-05-19T04:41:11Z", "type": "commit"}, {"oid": "7c63da589bb5b5149e5fb42e3b0054512e8d2e52", "url": "https://github.com/wso2/carbon-apimgt/commit/7c63da589bb5b5149e5fb42e3b0054512e8d2e52", "message": "Implement Delete Microgateway Label", "committedDate": "2020-05-19T04:41:11Z", "type": "commit"}, {"oid": "a6b2f39aec1d8b10e7638841dcdf40bb0dc4e92c", "url": "https://github.com/wso2/carbon-apimgt/commit/a6b2f39aec1d8b10e7638841dcdf40bb0dc4e92c", "message": "Implement ListInput", "committedDate": "2020-05-19T04:41:12Z", "type": "commit"}, {"oid": "8d0833adbb270feeaf5734c0f267bca25a0daa95", "url": "https://github.com/wso2/carbon-apimgt/commit/8d0833adbb270feeaf5734c0f267bca25a0daa95", "message": "Implement Add-Edit MG labels", "committedDate": "2020-05-19T04:41:12Z", "type": "commit"}, {"oid": "b825f36ebdd97c6ad332d57eb1cf3d6d1b94f5e6", "url": "https://github.com/wso2/carbon-apimgt/commit/b825f36ebdd97c6ad332d57eb1cf3d6d1b94f5e6", "message": "Improve List Input logic", "committedDate": "2020-05-19T04:41:12Z", "type": "commit"}, {"oid": "77dff8549e92c3c34534135a735c9315783d9132", "url": "https://github.com/wso2/carbon-apimgt/commit/77dff8549e92c3c34534135a735c9315783d9132", "message": "Generalize list input component", "committedDate": "2020-05-19T04:41:12Z", "type": "commit"}, {"oid": "b11855d75e009f31207cfbf44442ba595617d0ec", "url": "https://github.com/wso2/carbon-apimgt/commit/b11855d75e009f31207cfbf44442ba595617d0ec", "message": "Fix alignments", "committedDate": "2020-05-19T04:41:12Z", "type": "commit"}, {"oid": "c3fe63f36c2a4983716871d496c871dcd2c1f19d", "url": "https://github.com/wso2/carbon-apimgt/commit/c3fe63f36c2a4983716871d496c871dcd2c1f19d", "message": "Update locals", "committedDate": "2020-05-19T04:41:13Z", "type": "commit"}, {"oid": "4ee20e34fd6535de3f7d364089bf92ec6f247a4e", "url": "https://github.com/wso2/carbon-apimgt/commit/4ee20e34fd6535de3f7d364089bf92ec6f247a4e", "message": "Fix styling - AddEdit form control", "committedDate": "2020-05-19T04:41:13Z", "type": "commit"}, {"oid": "b1519d8216f322a2ad35eeb69c2241de49711baa", "url": "https://github.com/wso2/carbon-apimgt/commit/b1519d8216f322a2ad35eeb69c2241de49711baa", "message": "Fix Routes", "committedDate": "2020-05-19T04:41:13Z", "type": "commit"}, {"oid": "d31a4b9f65f8a07c252d32c93a48937982ff7792", "url": "https://github.com/wso2/carbon-apimgt/commit/d31a4b9f65f8a07c252d32c93a48937982ff7792", "message": "Fix eslint issues", "committedDate": "2020-05-19T04:41:55Z", "type": "commit"}, {"oid": "d8c9412483d7e99757a81bfd5a9efd13a1ab41f7", "url": "https://github.com/wso2/carbon-apimgt/commit/d8c9412483d7e99757a81bfd5a9efd13a1ab41f7", "message": "Restructure variables, Format code", "committedDate": "2020-05-19T04:41:55Z", "type": "commit"}, {"oid": "d5561df1a9c3e8d6ab6b877432354b6a21c3ac32", "url": "https://github.com/wso2/carbon-apimgt/commit/d5561df1a9c3e8d6ab6b877432354b6a21c3ac32", "message": "Update i18n", "committedDate": "2020-05-19T04:42:07Z", "type": "commit"}, {"oid": "a3095f09cb4830635a70ad1a2b4dd17b0d3f8699", "url": "https://github.com/wso2/carbon-apimgt/commit/a3095f09cb4830635a70ad1a2b4dd17b0d3f8699", "message": "Enhance UI", "committedDate": "2020-05-19T04:42:21Z", "type": "commit"}, {"oid": "a3095f09cb4830635a70ad1a2b4dd17b0d3f8699", "url": "https://github.com/wso2/carbon-apimgt/commit/a3095f09cb4830635a70ad1a2b4dd17b0d3f8699", "message": "Enhance UI", "committedDate": "2020-05-19T04:42:21Z", "type": "forcePushed"}]}