{"pr_number": 9012, "pr_title": "Fix migration issues with swagger security schemes", "pr_createdAt": "2020-07-21T10:51:09Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/9012", "timeline": [{"oid": "1028eaf0df9d1f6c902e9ad28d8dd7182f7824f7", "url": "https://github.com/wso2/carbon-apimgt/commit/1028eaf0df9d1f6c902e9ad28d8dd7182f7824f7", "message": "Fix issues with swagger security scheme after migrations", "committedDate": "2020-07-21T10:43:10Z", "type": "commit"}, {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604", "url": "https://github.com/wso2/carbon-apimgt/commit/acdee390f1f64cc3c1e893cbb19e961220e32604", "message": "Remove commented code", "committedDate": "2020-07-21T10:49:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUwOTM0Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458509342", "bodyText": "shouldn't processLegacyScopes execute before the processOtherSchemeScopes?", "author": "ruks", "createdAt": "2020-07-22T03:17:12Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OASParserUtil.java", "diffHunk": "@@ -1325,7 +1325,8 @@ static JsonNode getResponseCacheConfig(String responseCache, int cacheTimeout) {\n     public static String preProcess(String swaggerContent) throws APIManagementException {\n         //Load required properties from swagger to the API\n         APIDefinition apiDefinition = getOASParser(swaggerContent);\n-        return apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        swaggerContent = apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        return apiDefinition.processLegacyScopes(swaggerContent);", "originalCommit": "acdee390f1f64cc3c1e893cbb19e961220e32604", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyNjg5Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458526897", "bodyText": "fixed with b188ce5", "author": "msm1992", "createdAt": "2020-07-22T04:27:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUwOTM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyNzI4Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458527286", "bodyText": "Yes. Got it.", "author": "ruks", "createdAt": "2020-07-22T04:29:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUwOTM0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxMDE1NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458510154", "bodyText": "I think we should not expose processLegacyScopes via the interface because I think it is not required to execute directly.\nI think we can define same method in respective parsers as private and call inside the processOtherSchemeScopes method. Because processLegacyScopes is used by only processOtherSchemeScopes.", "author": "ruks", "createdAt": "2020-07-22T03:20:36Z", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/APIDefinition.java", "diffHunk": "@@ -205,4 +205,13 @@ public abstract String processOtherSchemeScopes(String resourceConfigsJSON)\n     public abstract API setExtensionsToAPI(String swaggerContent, API api)\n             throws APIManagementException;\n \n+    /**\n+     * This method will extract scopes from legacy x-wso2-security and add them to default scheme\n+     * @param swaggerContent swagger definition\n+     * @return\n+     * @throws APIManagementException\n+     */\n+    public abstract String processLegacyScopes(String swaggerContent)", "originalCommit": "acdee390f1f64cc3c1e893cbb19e961220e32604", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyNjg0Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458526847", "bodyText": "fixed with b188ce5", "author": "msm1992", "createdAt": "2020-07-22T04:27:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxMDE1NA=="}], "type": "inlineReview"}, {"oid": "b188ce5404a9c6d4634d3c3ad7d44eba254e4437", "url": "https://github.com/wso2/carbon-apimgt/commit/b188ce5404a9c6d4634d3c3ad7d44eba254e4437", "message": "Add review changes", "committedDate": "2020-07-22T04:24:26Z", "type": "commit"}]}