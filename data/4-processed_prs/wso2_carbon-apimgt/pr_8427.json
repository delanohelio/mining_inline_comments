{"pr_number": 8427, "pr_title": "Add IP and Referer restriction support to API Key authentication", "pr_createdAt": "2020-04-23T16:15:02Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8427", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4MjU0MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r413982540", "bodyText": "Shal we use !== here\nexample.\n12 != '12' // false\nThis evaluates to false", "author": "tmkasun", "createdAt": "2020-04-23T17:22:23Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,335 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+\n+// Styles for Grid and Paper elements\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": \"8px\",\n+    width: \"100%\",\n+    padding: \"0px 10px\",\n+  },\n+});\n+\n+/**\n+ * Used to display IP restrictions in generate api key UI\n+ */\n+const apiKeyRestrictions = (props) => {\n+  const [invalidIP, setInvalidIP] = useState(false);\n+  const [invalidReferer, setInvalidReferer] = useState(false);\n+\n+  const {\n+    classes,\n+    newIP,\n+    updateNewIp,\n+    ipList,\n+    updateIpList,\n+    restrictSchema,\n+    updateRestrictSchema,\n+    newReferer,\n+    updateNewReferer,\n+    refererList,\n+    updateRefererList,\n+  } = props;\n+\n+  const onRefererTextUpdate = (e) => {\n+    updateNewReferer(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidReferer(false);\n+    }\n+  };\n+\n+  const addRefererItem = () => {\n+    if (newReferer != null && newReferer != \"\") {\n+      setInvalidReferer(false);\n+      refererList.push(newReferer.trim());\n+      updateRefererList(refererList);\n+      updateNewReferer(\"\");\n+    } else {\n+      setInvalidReferer(true);\n+    }\n+  };\n+\n+  const deleteRefererItem = (refererItem) => {\n+    refererList.splice(refererList.indexOf(refererItem), 1);\n+    updateRefererList(refererList);\n+  };\n+\n+  const onIpTextUpdate = (e) => {\n+    updateNewIp(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidIP(false);\n+    }\n+  };\n+\n+  const addIpItem = () => {\n+    if (newIP != null && newIP != \"\") {", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxOTc5Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414519793", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:58:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4MjU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4NjM3NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r413986375", "bodyText": "We already have @hapi for validation requirements , Shall we use its ip validation function ?", "author": "tmkasun", "createdAt": "2020-04-23T17:27:53Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,335 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+\n+// Styles for Grid and Paper elements\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": \"8px\",\n+    width: \"100%\",\n+    padding: \"0px 10px\",\n+  },\n+});\n+\n+/**\n+ * Used to display IP restrictions in generate api key UI\n+ */\n+const apiKeyRestrictions = (props) => {\n+  const [invalidIP, setInvalidIP] = useState(false);\n+  const [invalidReferer, setInvalidReferer] = useState(false);\n+\n+  const {\n+    classes,\n+    newIP,\n+    updateNewIp,\n+    ipList,\n+    updateIpList,\n+    restrictSchema,\n+    updateRestrictSchema,\n+    newReferer,\n+    updateNewReferer,\n+    refererList,\n+    updateRefererList,\n+  } = props;\n+\n+  const onRefererTextUpdate = (e) => {\n+    updateNewReferer(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidReferer(false);\n+    }\n+  };\n+\n+  const addRefererItem = () => {\n+    if (newReferer != null && newReferer != \"\") {\n+      setInvalidReferer(false);\n+      refererList.push(newReferer.trim());\n+      updateRefererList(refererList);\n+      updateNewReferer(\"\");\n+    } else {\n+      setInvalidReferer(true);\n+    }\n+  };\n+\n+  const deleteRefererItem = (refererItem) => {\n+    refererList.splice(refererList.indexOf(refererItem), 1);\n+    updateRefererList(refererList);\n+  };\n+\n+  const onIpTextUpdate = (e) => {\n+    updateNewIp(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidIP(false);\n+    }\n+  };\n+\n+  const addIpItem = () => {\n+    if (newIP != null && newIP != \"\") {\n+      const ipv4RegExp = new RegExp(\n+        [\n+          \"^((25[0-5]|2[0-4][0-9]|[01]?\",\n+          \"[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\",\n+          \"(/(3[0-2]|2[0-9]|1[0-9]|[0-9]))?$\",\n+        ].join(\"\")\n+      );\n+\n+      const ipv6RegExp = new RegExp(\n+        [\n+          \"^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]\",\n+          \"{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:\",\n+          \"[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4})\",\n+          \"{1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|\",\n+          \"([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]\",", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxOTg1OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414519859", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:58:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4NjM3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4Njg4Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r413986887", "bodyText": "Please use material ui theme spacing", "author": "tmkasun", "createdAt": "2020-04-23T17:28:32Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,335 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+\n+// Styles for Grid and Paper elements\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": \"8px\",\n+    width: \"100%\",\n+    padding: \"0px 10px\",\n+  },\n+});\n+\n+/**\n+ * Used to display IP restrictions in generate api key UI\n+ */\n+const apiKeyRestrictions = (props) => {\n+  const [invalidIP, setInvalidIP] = useState(false);\n+  const [invalidReferer, setInvalidReferer] = useState(false);\n+\n+  const {\n+    classes,\n+    newIP,\n+    updateNewIp,\n+    ipList,\n+    updateIpList,\n+    restrictSchema,\n+    updateRestrictSchema,\n+    newReferer,\n+    updateNewReferer,\n+    refererList,\n+    updateRefererList,\n+  } = props;\n+\n+  const onRefererTextUpdate = (e) => {\n+    updateNewReferer(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidReferer(false);\n+    }\n+  };\n+\n+  const addRefererItem = () => {\n+    if (newReferer != null && newReferer != \"\") {\n+      setInvalidReferer(false);\n+      refererList.push(newReferer.trim());\n+      updateRefererList(refererList);\n+      updateNewReferer(\"\");\n+    } else {\n+      setInvalidReferer(true);\n+    }\n+  };\n+\n+  const deleteRefererItem = (refererItem) => {\n+    refererList.splice(refererList.indexOf(refererItem), 1);\n+    updateRefererList(refererList);\n+  };\n+\n+  const onIpTextUpdate = (e) => {\n+    updateNewIp(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidIP(false);\n+    }\n+  };\n+\n+  const addIpItem = () => {\n+    if (newIP != null && newIP != \"\") {\n+      const ipv4RegExp = new RegExp(\n+        [\n+          \"^((25[0-5]|2[0-4][0-9]|[01]?\",\n+          \"[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\",\n+          \"(/(3[0-2]|2[0-9]|1[0-9]|[0-9]))?$\",\n+        ].join(\"\")\n+      );\n+\n+      const ipv6RegExp = new RegExp(\n+        [\n+          \"^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]\",\n+          \"{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:\",\n+          \"[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4})\",\n+          \"{1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|\",\n+          \"([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]\",\n+          \"{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:\",\n+          \"[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:\",\n+          \"(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}\",\n+          \":){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]\",\n+          \"|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:\",\n+          \"((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|\",\n+          \"(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))(/((1(1[0-9]|2[0-8]))\",\n+          \"|([0-9][0-9])|([0-9])))?$\",\n+        ].join(\"\")\n+      );\n+\n+      const validIP = ipv4RegExp.test(newIP) || ipv6RegExp.test(newIP);\n+      setInvalidIP(!validIP);\n+      if (validIP) {\n+        ipList.push(newIP);\n+        updateIpList(ipList);\n+        updateNewIp(\"\");\n+      }\n+    }\n+  };\n+\n+  const deleteIpItem = (ipItem) => {\n+    ipList.splice(ipList.indexOf(ipItem), 1);\n+    updateIpList(ipList);\n+  };\n+\n+  const onRestrictSchemaChange = (e) => {\n+    updateRestrictSchema(e.target.value);\n+    updateIpList([]);\n+    updateRefererList([]);\n+    updateNewIp(\"\");\n+    updateNewReferer(\"\");\n+    setInvalidIP(false);\n+    setInvalidReferer(false);\n+  };\n+\n+  return (\n+    <React.Fragment>\n+      <Box\n+        border={1}\n+        borderRadius={5}\n+        style={{ margin: \"10px\" , padding: \"10px\"}}\n+        borderColor=\"grey.500\"\n+      >\n+        <FormControl component=\"fieldset\">\n+          <RadioGroup\n+            aria-label=\"API Key Restrictions\"\n+            value={restrictSchema}\n+            row\n+            onChange={onRestrictSchemaChange}\n+          >\n+            <FormControlLabel\n+              value=\"none\"\n+              control={<Radio color=\"primary\" />}\n+              label=\"None\"\n+              labelPlacement=\"end\"\n+            />\n+            <FormControlLabel\n+              value=\"ip\"\n+              control={<Radio color=\"primary\" />}\n+              label=\"IP Addresses\"\n+              labelPlacement=\"end\"\n+            />\n+            <FormControlLabel\n+              value=\"referer\"\n+              control={<Radio color=\"primary\" />}\n+              label=\"HTTP Referrers (Web Sites)\"\n+              labelPlacement=\"end\"\n+            />\n+          </RadioGroup>\n+        </FormControl>\n+\n+        {restrictSchema == \"ip\" && (\n+          <Box component=\"div\" id=\"ipPanel\">\n+            <Grid\n+              container\n+              direction=\"row\"\n+              spacing={0}\n+              justify=\"left\"\n+              alignItems=\"left\"\n+            >\n+              <Grid item md={10} xs={10}>\n+                <TextField\n+                  label=\"IP Address\"\n+                  value={newIP}\n+                  onChange={onIpTextUpdate}\n+                  className={classes.inputText}\n+                  helperText={invalidIP ? \"Invalid IP address\" : \"\"}\n+                  error={invalidIP}\n+                  margin=\"dense\"\n+                  variant=\"outlined\"\n+                  placeholder=\"Enter IP address\"\n+                  fullWidth\n+                />\n+              </Grid>\n+              <Grid item md={2} xs={2}>\n+                <span>\n+                  <Fab\n+                    style={{ marginLeft: \"20px\", marginRight: \"20px\" }}", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxOTkxMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414519912", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:59:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4Njg4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4NzQwOQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r413987409", "bodyText": "Same here, Please use https://material-ui.com/customization/spacing/", "author": "tmkasun", "createdAt": "2020-04-23T17:29:21Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,335 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+\n+// Styles for Grid and Paper elements\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": \"8px\",\n+    width: \"100%\",\n+    padding: \"0px 10px\",\n+  },\n+});\n+\n+/**\n+ * Used to display IP restrictions in generate api key UI\n+ */\n+const apiKeyRestrictions = (props) => {\n+  const [invalidIP, setInvalidIP] = useState(false);\n+  const [invalidReferer, setInvalidReferer] = useState(false);\n+\n+  const {\n+    classes,\n+    newIP,\n+    updateNewIp,\n+    ipList,\n+    updateIpList,\n+    restrictSchema,\n+    updateRestrictSchema,\n+    newReferer,\n+    updateNewReferer,\n+    refererList,\n+    updateRefererList,\n+  } = props;\n+\n+  const onRefererTextUpdate = (e) => {\n+    updateNewReferer(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidReferer(false);\n+    }\n+  };\n+\n+  const addRefererItem = () => {\n+    if (newReferer != null && newReferer != \"\") {\n+      setInvalidReferer(false);\n+      refererList.push(newReferer.trim());\n+      updateRefererList(refererList);\n+      updateNewReferer(\"\");\n+    } else {\n+      setInvalidReferer(true);\n+    }\n+  };\n+\n+  const deleteRefererItem = (refererItem) => {\n+    refererList.splice(refererList.indexOf(refererItem), 1);\n+    updateRefererList(refererList);\n+  };\n+\n+  const onIpTextUpdate = (e) => {\n+    updateNewIp(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidIP(false);\n+    }\n+  };\n+\n+  const addIpItem = () => {\n+    if (newIP != null && newIP != \"\") {\n+      const ipv4RegExp = new RegExp(\n+        [\n+          \"^((25[0-5]|2[0-4][0-9]|[01]?\",\n+          \"[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\",\n+          \"(/(3[0-2]|2[0-9]|1[0-9]|[0-9]))?$\",\n+        ].join(\"\")\n+      );\n+\n+      const ipv6RegExp = new RegExp(\n+        [\n+          \"^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]\",\n+          \"{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:\",\n+          \"[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4})\",\n+          \"{1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|\",\n+          \"([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]\",\n+          \"{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:\",\n+          \"[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:\",\n+          \"(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}\",\n+          \":){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]\",\n+          \"|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:\",\n+          \"((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|\",\n+          \"(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))(/((1(1[0-9]|2[0-8]))\",\n+          \"|([0-9][0-9])|([0-9])))?$\",\n+        ].join(\"\")\n+      );\n+\n+      const validIP = ipv4RegExp.test(newIP) || ipv6RegExp.test(newIP);\n+      setInvalidIP(!validIP);\n+      if (validIP) {\n+        ipList.push(newIP);\n+        updateIpList(ipList);\n+        updateNewIp(\"\");\n+      }\n+    }\n+  };\n+\n+  const deleteIpItem = (ipItem) => {\n+    ipList.splice(ipList.indexOf(ipItem), 1);\n+    updateIpList(ipList);\n+  };\n+\n+  const onRestrictSchemaChange = (e) => {\n+    updateRestrictSchema(e.target.value);\n+    updateIpList([]);\n+    updateRefererList([]);\n+    updateNewIp(\"\");\n+    updateNewReferer(\"\");\n+    setInvalidIP(false);\n+    setInvalidReferer(false);\n+  };\n+\n+  return (\n+    <React.Fragment>\n+      <Box\n+        border={1}\n+        borderRadius={5}\n+        style={{ margin: \"10px\" , padding: \"10px\"}}\n+        borderColor=\"grey.500\"\n+      >\n+        <FormControl component=\"fieldset\">\n+          <RadioGroup\n+            aria-label=\"API Key Restrictions\"\n+            value={restrictSchema}\n+            row\n+            onChange={onRestrictSchemaChange}\n+          >\n+            <FormControlLabel\n+              value=\"none\"\n+              control={<Radio color=\"primary\" />}\n+              label=\"None\"\n+              labelPlacement=\"end\"\n+            />\n+            <FormControlLabel\n+              value=\"ip\"\n+              control={<Radio color=\"primary\" />}\n+              label=\"IP Addresses\"\n+              labelPlacement=\"end\"\n+            />\n+            <FormControlLabel\n+              value=\"referer\"\n+              control={<Radio color=\"primary\" />}\n+              label=\"HTTP Referrers (Web Sites)\"\n+              labelPlacement=\"end\"\n+            />\n+          </RadioGroup>\n+        </FormControl>\n+\n+        {restrictSchema == \"ip\" && (\n+          <Box component=\"div\" id=\"ipPanel\">\n+            <Grid\n+              container\n+              direction=\"row\"\n+              spacing={0}\n+              justify=\"left\"\n+              alignItems=\"left\"\n+            >\n+              <Grid item md={10} xs={10}>\n+                <TextField\n+                  label=\"IP Address\"\n+                  value={newIP}\n+                  onChange={onIpTextUpdate}\n+                  className={classes.inputText}\n+                  helperText={invalidIP ? \"Invalid IP address\" : \"\"}\n+                  error={invalidIP}\n+                  margin=\"dense\"\n+                  variant=\"outlined\"\n+                  placeholder=\"Enter IP address\"\n+                  fullWidth\n+                />\n+              </Grid>\n+              <Grid item md={2} xs={2}>\n+                <span>\n+                  <Fab\n+                    style={{ marginLeft: \"20px\", marginRight: \"20px\" }}\n+                    size=\"small\"\n+                    color=\"primary\"\n+                    aria-label=\"add\"\n+                    onClick={addIpItem}\n+                  >\n+                    <AddIcon />\n+                  </Fab>\n+                </span>\n+              </Grid>\n+            </Grid>\n+            <Grid\n+              container\n+              direction=\"row\"\n+              spacing={0}\n+              justify=\"left\"\n+              alignItems=\"left\"\n+              md={10}\n+              xs={10}\n+            >\n+              {ipList.length > 0 && (\n+                <List>\n+                  {ipList.map((ip, index) => (\n+                    <ListItem>\n+                      <ListItemText primary={ip} />\n+                      <ListItemSecondaryAction>\n+                        <Tooltip title=\"Delete task\" placement=\"top\">\n+                          <IconButton\n+                            edge=\"end\"\n+                            aria-label=\"delete\"\n+                            onClick={() => deleteIpItem(ip)}\n+                          >\n+                            <DeleteIcon />\n+                          </IconButton>\n+                        </Tooltip>\n+                      </ListItemSecondaryAction>\n+                    </ListItem>\n+                  ))}\n+                </List>\n+              )}\n+            </Grid>\n+          </Box>\n+        )}\n+\n+        {restrictSchema == \"referer\" && (\n+          <Box component=\"div\" id=\"refererPanel\">\n+            <Grid\n+              container\n+              direction=\"row\"\n+              spacing={0}\n+              justify=\"left\"\n+              alignItems=\"left\"\n+            >\n+              <Grid item md={10} xs={10}>\n+                <TextField\n+                  label=\"Referer\"\n+                  value={newReferer}\n+                  onChange={onRefererTextUpdate}\n+                  className={classes.inputText}\n+                  helperText={invalidReferer ? \"Invalid referer\" : \"\"}\n+                  error={invalidReferer}\n+                  margin=\"dense\"\n+                  variant=\"outlined\"\n+                  placeholder=\"Enter Referer\"\n+                  fullWidth\n+                />\n+              </Grid>\n+              <Grid item md={2} xs={2}>\n+                <span>\n+                  <Fab\n+                    style={{ marginLeft: \"20px\", marginRight: \"20px\" }}", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxOTk0OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414519949", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:59:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4NzQwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4ODIyNw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r413988227", "bodyText": "This is an anti-pattern, We have created a lambda function and called a class instance method without using any event data ?", "author": "tmkasun", "createdAt": "2020-04-23T17:30:33Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/AppsAndKeys/ApiKeyManager.jsx", "diffHunk": "@@ -139,60 +178,141 @@ class ApiKeyManager extends React.Component {\n                         id='Shared.AppsAndKeys.TokenManager.ApiKey'\n                     />\n                 </Typography>\n-                <FormGroup row className={classes.formGroup}>\n+              <Grid container direction=\"row\" spacing={0} justify=\"left\" alignItems=\"left\">\n+                <Grid item md={5} xs={12}>\n+                  <ApiKeyRestriction\n+                    updateNewIp={this.updateNewIp}\n+                    newIP={newIP}\n+                    updateIpList={this.updateIpList}\n+                    ipList={ipList}\n+                    restrictSchema={restrictSchema}\n+                    updateRestrictSchema={this.updateRestrictSchema}\n+                    refererList={refererList}\n+                    newReferer={newReferer}\n+                    updateNewReferer={this.updateNewReferer}\n+                    updateRefererList={this.updateRefererList}\n+                  />\n+                  <FormGroup row className={classes.formGroup}>\n                     <Grid container spacing={3}>\n-                        <Grid item xs={12} className={classes.gridWrapper}>\n-                            <div>\n-                                <Button\n-                                    variant='contained'\n-                                    color='primary'\n-                                    onClick={this.handleClickOpen}\n-                                >\n-                                    {'Generate Key'}\n-                                </Button>\n-                            </div>\n-                            <Typography component='div' variant='body2' className={classes.formLabel}>\n-                                <FormattedMessage\n-                                    id='Shared.AppsAndKeys.ApiKeyManager.generate.key.help'\n-                                    defaultMessage='Use the Generate Key button to generate a self-contained JWT token.'\n-                                />\n-                            </Typography>\n-\n-                        </Grid>\n+                      <Grid item xs={12} className={classes.gridWrapper}>\n+                        <div>\n+                          <Button\n+                            variant=\"contained\"\n+                            color=\"primary\"\n+                            onClick={this.handleClickOpen}\n+                          >\n+                            {\"Generate Key\"}\n+                          </Button>\n+                        </div>\n+                        <Typography\n+                          component=\"div\"\n+                          variant=\"body2\"\n+                          className={classes.formLabel}\n+                        >\n+                          <FormattedMessage\n+                            id=\"Shared.AppsAndKeys.ApiKeyManager.generate.key.help\"\n+                            defaultMessage=\"Use the Generate Key button to generate a self-contained JWT token.\"\n+                          />\n+                        </Typography>\n+                      </Grid>\n                     </Grid>\n-                </FormGroup>\n-                <Dialog open={open} onClose={this.handleClose} aria-labelledby='form-dialog-title'>\n-                    <DialogTitle id='responsive-dialog-title' className={classes.dialogTitle}>\n-                        {'Generate API Key'}\n+                  </FormGroup>\n+                  <Dialog\n+                    open={open}\n+                    onClose={this.handleClose}\n+                    aria-labelledby=\"form-dialog-title\"\n+                  >\n+                    <DialogTitle id=\"responsive-dialog-title\" className={classes.dialogTitle}>\n+                      {\"Generate API Key\"}\n                     </DialogTitle>\n                     <DialogContent className={classes.dialogContent}>\n-                        <DialogContentText>\n-                            {!showToken && (\n-                                <ApiKey\n-                                    updateAccessTokenRequest={this.updateAccessTokenRequest}\n-                                    accessTokenRequest={accessTokenRequest}\n-                                />\n-                            )}\n-                            {showToken && <ViewToken token={apikey} />}\n-                        </DialogContentText>\n-                    </DialogContent>\n-                    <DialogActions>\n+                      <DialogContentText>\n                         {!showToken && (\n-                            <Button onClick={() => this.generateKeys(selectedApp, keyType)} disabled={!accessTokenRequest.timeout} color='primary'>\n-                                <FormattedMessage\n-                                    id='Shared.AppsAndKeys.ViewKeys.consumer.generate.btn'\n-                                    defaultMessage='Generate'\n-                                />\n-                            </Button>\n+                          <ApiKey\n+                            updateAccessTokenRequest={this.updateAccessTokenRequest}\n+                            accessTokenRequest={accessTokenRequest}\n+                          />\n                         )}\n-                        <Button onClick={this.handleClose} color='primary' autoFocus>\n-                            <FormattedMessage\n-                                id='Shared.AppsAndKeys.ViewKeys.consumer.close.btn'\n-                                defaultMessage='Close'\n-                            />\n+                        {showToken && <ViewToken token={apikey} />}\n+                      </DialogContentText>\n+                    </DialogContent>\n+                    <DialogActions>\n+                      {!showToken && (\n+                        <Button\n+                          onClick={() => this.generateKeys(selectedApp, keyType)}", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMDA2OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414520069", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:59:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4ODIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5MzcxMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r413993712", "bodyText": "Please add i18n support in this text and all the other places as well , For more info about wso2 i18n", "author": "tmkasun", "createdAt": "2020-04-23T17:38:48Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/AppsAndKeys/ApiKeyManager.jsx", "diffHunk": "@@ -139,60 +178,141 @@ class ApiKeyManager extends React.Component {\n                         id='Shared.AppsAndKeys.TokenManager.ApiKey'\n                     />\n                 </Typography>\n-                <FormGroup row className={classes.formGroup}>\n+              <Grid container direction=\"row\" spacing={0} justify=\"left\" alignItems=\"left\">\n+                <Grid item md={5} xs={12}>\n+                  <ApiKeyRestriction\n+                    updateNewIp={this.updateNewIp}\n+                    newIP={newIP}\n+                    updateIpList={this.updateIpList}\n+                    ipList={ipList}\n+                    restrictSchema={restrictSchema}\n+                    updateRestrictSchema={this.updateRestrictSchema}\n+                    refererList={refererList}\n+                    newReferer={newReferer}\n+                    updateNewReferer={this.updateNewReferer}\n+                    updateRefererList={this.updateRefererList}\n+                  />\n+                  <FormGroup row className={classes.formGroup}>\n                     <Grid container spacing={3}>\n-                        <Grid item xs={12} className={classes.gridWrapper}>\n-                            <div>\n-                                <Button\n-                                    variant='contained'\n-                                    color='primary'\n-                                    onClick={this.handleClickOpen}\n-                                >\n-                                    {'Generate Key'}\n-                                </Button>\n-                            </div>\n-                            <Typography component='div' variant='body2' className={classes.formLabel}>\n-                                <FormattedMessage\n-                                    id='Shared.AppsAndKeys.ApiKeyManager.generate.key.help'\n-                                    defaultMessage='Use the Generate Key button to generate a self-contained JWT token.'\n-                                />\n-                            </Typography>\n-\n-                        </Grid>\n+                      <Grid item xs={12} className={classes.gridWrapper}>\n+                        <div>\n+                          <Button\n+                            variant=\"contained\"\n+                            color=\"primary\"\n+                            onClick={this.handleClickOpen}\n+                          >\n+                            {\"Generate Key\"}\n+                          </Button>\n+                        </div>\n+                        <Typography\n+                          component=\"div\"\n+                          variant=\"body2\"\n+                          className={classes.formLabel}\n+                        >\n+                          <FormattedMessage\n+                            id=\"Shared.AppsAndKeys.ApiKeyManager.generate.key.help\"\n+                            defaultMessage=\"Use the Generate Key button to generate a self-contained JWT token.\"\n+                          />\n+                        </Typography>\n+                      </Grid>\n                     </Grid>\n-                </FormGroup>\n-                <Dialog open={open} onClose={this.handleClose} aria-labelledby='form-dialog-title'>\n-                    <DialogTitle id='responsive-dialog-title' className={classes.dialogTitle}>\n-                        {'Generate API Key'}\n+                  </FormGroup>\n+                  <Dialog\n+                    open={open}\n+                    onClose={this.handleClose}\n+                    aria-labelledby=\"form-dialog-title\"\n+                  >\n+                    <DialogTitle id=\"responsive-dialog-title\" className={classes.dialogTitle}>\n+                      {\"Generate API Key\"}\n                     </DialogTitle>\n                     <DialogContent className={classes.dialogContent}>\n-                        <DialogContentText>\n-                            {!showToken && (\n-                                <ApiKey\n-                                    updateAccessTokenRequest={this.updateAccessTokenRequest}\n-                                    accessTokenRequest={accessTokenRequest}\n-                                />\n-                            )}\n-                            {showToken && <ViewToken token={apikey} />}\n-                        </DialogContentText>\n-                    </DialogContent>\n-                    <DialogActions>\n+                      <DialogContentText>\n                         {!showToken && (\n-                            <Button onClick={() => this.generateKeys(selectedApp, keyType)} disabled={!accessTokenRequest.timeout} color='primary'>\n-                                <FormattedMessage\n-                                    id='Shared.AppsAndKeys.ViewKeys.consumer.generate.btn'\n-                                    defaultMessage='Generate'\n-                                />\n-                            </Button>\n+                          <ApiKey\n+                            updateAccessTokenRequest={this.updateAccessTokenRequest}\n+                            accessTokenRequest={accessTokenRequest}\n+                          />\n                         )}\n-                        <Button onClick={this.handleClose} color='primary' autoFocus>\n-                            <FormattedMessage\n-                                id='Shared.AppsAndKeys.ViewKeys.consumer.close.btn'\n-                                defaultMessage='Close'\n-                            />\n+                        {showToken && <ViewToken token={apikey} />}\n+                      </DialogContentText>\n+                    </DialogContent>\n+                    <DialogActions>\n+                      {!showToken && (\n+                        <Button\n+                          onClick={() => this.generateKeys(selectedApp, keyType)}\n+                          disabled={!accessTokenRequest.timeout}\n+                          color=\"primary\"\n+                        >\n+                          <FormattedMessage\n+                            id=\"Shared.AppsAndKeys.ViewKeys.consumer.generate.btn\"\n+                            defaultMessage=\"Generate\"\n+                          />\n                         </Button>\n+                      )}\n+                      <Button onClick={this.handleClose} color=\"primary\" autoFocus>\n+                        <FormattedMessage\n+                          id=\"Shared.AppsAndKeys.ViewKeys.consumer.close.btn\"\n+                          defaultMessage=\"Close\"\n+                        />\n+                      </Button>\n                     </DialogActions>\n-                </Dialog>\n+                  </Dialog>\n+                </Grid>\n+                {restrictSchema == \"ip\" && (\n+                  <Grid item md={5} xs={12} style={{ padding: \"20px\" }}>\n+                    <Card>\n+                      <CardContent>\n+                        <Typography variant=\"h5\" component=\"h2\">\n+                          Examples of IP Addresses allowed\n+                        </Typography>\n+                        <List>\n+                          <ListItem>\n+                            <Typography variant=\"body1\" component=\"p\">\n+                              Specify one IPv4 or IPv6 or a subnet using CIDR notation\n+                            </Typography>\n+                          </ListItem>\n+                          <ListItem>\n+                            <Typography variant=\"body1\" component=\"p\">\n+                              Examples: <b>192.168.1.2</b>, <b>152.12.0.0/13</b>,{\" \"}", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMDEyNw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414520127", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:59:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5MzcxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwNzY1Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414307652", "bodyText": "Shall we use theme.spacing here? e.g: theme.spacing(1)", "author": "kavishkafernando", "createdAt": "2020-04-24T05:40:17Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,335 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+\n+// Styles for Grid and Paper elements\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": \"8px\",", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMDE4Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414520182", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:59:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwNzY1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwNzg2OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414307869", "bodyText": "use theme.spacing(3)", "author": "kavishkafernando", "createdAt": "2020-04-24T05:40:50Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,335 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+\n+// Styles for Grid and Paper elements\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": \"8px\",\n+    width: \"100%\",\n+    padding: \"0px 10px\",", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMDIzNw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414520237", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:59:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwNzg2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwODc1Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414308752", "bodyText": "shall we use === ?", "author": "kavishkafernando", "createdAt": "2020-04-24T05:43:11Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,335 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+\n+// Styles for Grid and Paper elements\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": \"8px\",\n+    width: \"100%\",\n+    padding: \"0px 10px\",\n+  },\n+});\n+\n+/**\n+ * Used to display IP restrictions in generate api key UI\n+ */\n+const apiKeyRestrictions = (props) => {\n+  const [invalidIP, setInvalidIP] = useState(false);\n+  const [invalidReferer, setInvalidReferer] = useState(false);\n+\n+  const {\n+    classes,\n+    newIP,\n+    updateNewIp,\n+    ipList,\n+    updateIpList,\n+    restrictSchema,\n+    updateRestrictSchema,\n+    newReferer,\n+    updateNewReferer,\n+    refererList,\n+    updateRefererList,\n+  } = props;\n+\n+  const onRefererTextUpdate = (e) => {\n+    updateNewReferer(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidReferer(false);\n+    }\n+  };\n+\n+  const addRefererItem = () => {\n+    if (newReferer != null && newReferer != \"\") {\n+      setInvalidReferer(false);\n+      refererList.push(newReferer.trim());\n+      updateRefererList(refererList);\n+      updateNewReferer(\"\");\n+    } else {\n+      setInvalidReferer(true);\n+    }\n+  };\n+\n+  const deleteRefererItem = (refererItem) => {\n+    refererList.splice(refererList.indexOf(refererItem), 1);\n+    updateRefererList(refererList);\n+  };\n+\n+  const onIpTextUpdate = (e) => {\n+    updateNewIp(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMDMxMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414520311", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:59:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwODc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwOTIxMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414309212", "bodyText": "Don't use inline styling. Let's define styles at the top.", "author": "kavishkafernando", "createdAt": "2020-04-24T05:44:29Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,335 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+\n+// Styles for Grid and Paper elements\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": \"8px\",\n+    width: \"100%\",\n+    padding: \"0px 10px\",\n+  },\n+});\n+\n+/**\n+ * Used to display IP restrictions in generate api key UI\n+ */\n+const apiKeyRestrictions = (props) => {\n+  const [invalidIP, setInvalidIP] = useState(false);\n+  const [invalidReferer, setInvalidReferer] = useState(false);\n+\n+  const {\n+    classes,\n+    newIP,\n+    updateNewIp,\n+    ipList,\n+    updateIpList,\n+    restrictSchema,\n+    updateRestrictSchema,\n+    newReferer,\n+    updateNewReferer,\n+    refererList,\n+    updateRefererList,\n+  } = props;\n+\n+  const onRefererTextUpdate = (e) => {\n+    updateNewReferer(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidReferer(false);\n+    }\n+  };\n+\n+  const addRefererItem = () => {\n+    if (newReferer != null && newReferer != \"\") {\n+      setInvalidReferer(false);\n+      refererList.push(newReferer.trim());\n+      updateRefererList(refererList);\n+      updateNewReferer(\"\");\n+    } else {\n+      setInvalidReferer(true);\n+    }\n+  };\n+\n+  const deleteRefererItem = (refererItem) => {\n+    refererList.splice(refererList.indexOf(refererItem), 1);\n+    updateRefererList(refererList);\n+  };\n+\n+  const onIpTextUpdate = (e) => {\n+    updateNewIp(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidIP(false);\n+    }\n+  };\n+\n+  const addIpItem = () => {\n+    if (newIP != null && newIP != \"\") {\n+      const ipv4RegExp = new RegExp(\n+        [\n+          \"^((25[0-5]|2[0-4][0-9]|[01]?\",\n+          \"[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\",\n+          \"(/(3[0-2]|2[0-9]|1[0-9]|[0-9]))?$\",\n+        ].join(\"\")\n+      );\n+\n+      const ipv6RegExp = new RegExp(\n+        [\n+          \"^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]\",\n+          \"{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:\",\n+          \"[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4})\",\n+          \"{1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|\",\n+          \"([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]\",\n+          \"{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:\",\n+          \"[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:\",\n+          \"(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}\",\n+          \":){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]\",\n+          \"|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:\",\n+          \"((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|\",\n+          \"(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))(/((1(1[0-9]|2[0-8]))\",\n+          \"|([0-9][0-9])|([0-9])))?$\",\n+        ].join(\"\")\n+      );\n+\n+      const validIP = ipv4RegExp.test(newIP) || ipv6RegExp.test(newIP);\n+      setInvalidIP(!validIP);\n+      if (validIP) {\n+        ipList.push(newIP);\n+        updateIpList(ipList);\n+        updateNewIp(\"\");\n+      }\n+    }\n+  };\n+\n+  const deleteIpItem = (ipItem) => {\n+    ipList.splice(ipList.indexOf(ipItem), 1);\n+    updateIpList(ipList);\n+  };\n+\n+  const onRestrictSchemaChange = (e) => {\n+    updateRestrictSchema(e.target.value);\n+    updateIpList([]);\n+    updateRefererList([]);\n+    updateNewIp(\"\");\n+    updateNewReferer(\"\");\n+    setInvalidIP(false);\n+    setInvalidReferer(false);\n+  };\n+\n+  return (\n+    <React.Fragment>\n+      <Box\n+        border={1}\n+        borderRadius={5}\n+        style={{ margin: \"10px\" , padding: \"10px\"}}", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMDMzMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414520333", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:59:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwOTIxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwOTQ0MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414309440", "bodyText": "Don't use custom colors. The theme has pre-defined colors. Use them", "author": "kavishkafernando", "createdAt": "2020-04-24T05:45:08Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,335 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+\n+// Styles for Grid and Paper elements\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": \"8px\",\n+    width: \"100%\",\n+    padding: \"0px 10px\",\n+  },\n+});\n+\n+/**\n+ * Used to display IP restrictions in generate api key UI\n+ */\n+const apiKeyRestrictions = (props) => {\n+  const [invalidIP, setInvalidIP] = useState(false);\n+  const [invalidReferer, setInvalidReferer] = useState(false);\n+\n+  const {\n+    classes,\n+    newIP,\n+    updateNewIp,\n+    ipList,\n+    updateIpList,\n+    restrictSchema,\n+    updateRestrictSchema,\n+    newReferer,\n+    updateNewReferer,\n+    refererList,\n+    updateRefererList,\n+  } = props;\n+\n+  const onRefererTextUpdate = (e) => {\n+    updateNewReferer(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidReferer(false);\n+    }\n+  };\n+\n+  const addRefererItem = () => {\n+    if (newReferer != null && newReferer != \"\") {\n+      setInvalidReferer(false);\n+      refererList.push(newReferer.trim());\n+      updateRefererList(refererList);\n+      updateNewReferer(\"\");\n+    } else {\n+      setInvalidReferer(true);\n+    }\n+  };\n+\n+  const deleteRefererItem = (refererItem) => {\n+    refererList.splice(refererList.indexOf(refererItem), 1);\n+    updateRefererList(refererList);\n+  };\n+\n+  const onIpTextUpdate = (e) => {\n+    updateNewIp(e.target.value.trim());\n+    if (e.target.value.trim() == \"\") {\n+      setInvalidIP(false);\n+    }\n+  };\n+\n+  const addIpItem = () => {\n+    if (newIP != null && newIP != \"\") {\n+      const ipv4RegExp = new RegExp(\n+        [\n+          \"^((25[0-5]|2[0-4][0-9]|[01]?\",\n+          \"[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\",\n+          \"(/(3[0-2]|2[0-9]|1[0-9]|[0-9]))?$\",\n+        ].join(\"\")\n+      );\n+\n+      const ipv6RegExp = new RegExp(\n+        [\n+          \"^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]\",\n+          \"{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:\",\n+          \"[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4})\",\n+          \"{1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|\",\n+          \"([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]\",\n+          \"{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:\",\n+          \"[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:\",\n+          \"(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}\",\n+          \":){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]\",\n+          \"|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:\",\n+          \"((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|\",\n+          \"(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))(/((1(1[0-9]|2[0-8]))\",\n+          \"|([0-9][0-9])|([0-9])))?$\",\n+        ].join(\"\")\n+      );\n+\n+      const validIP = ipv4RegExp.test(newIP) || ipv6RegExp.test(newIP);\n+      setInvalidIP(!validIP);\n+      if (validIP) {\n+        ipList.push(newIP);\n+        updateIpList(ipList);\n+        updateNewIp(\"\");\n+      }\n+    }\n+  };\n+\n+  const deleteIpItem = (ipItem) => {\n+    ipList.splice(ipList.indexOf(ipItem), 1);\n+    updateIpList(ipList);\n+  };\n+\n+  const onRestrictSchemaChange = (e) => {\n+    updateRestrictSchema(e.target.value);\n+    updateIpList([]);\n+    updateRefererList([]);\n+    updateNewIp(\"\");\n+    updateNewReferer(\"\");\n+    setInvalidIP(false);\n+    setInvalidReferer(false);\n+  };\n+\n+  return (\n+    <React.Fragment>\n+      <Box\n+        border={1}\n+        borderRadius={5}\n+        style={{ margin: \"10px\" , padding: \"10px\"}}\n+        borderColor=\"grey.500\"", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMDM4MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414520380", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T11:59:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwOTQ0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMDIwNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414310205", "bodyText": "Add i18n support", "author": "kavishkafernando", "createdAt": "2020-04-24T05:47:09Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/AppsAndKeys/ApiKeyManager.jsx", "diffHunk": "@@ -139,60 +178,141 @@ class ApiKeyManager extends React.Component {\n                         id='Shared.AppsAndKeys.TokenManager.ApiKey'\n                     />\n                 </Typography>\n-                <FormGroup row className={classes.formGroup}>\n+              <Grid container direction=\"row\" spacing={0} justify=\"left\" alignItems=\"left\">\n+                <Grid item md={5} xs={12}>\n+                  <ApiKeyRestriction\n+                    updateNewIp={this.updateNewIp}\n+                    newIP={newIP}\n+                    updateIpList={this.updateIpList}\n+                    ipList={ipList}\n+                    restrictSchema={restrictSchema}\n+                    updateRestrictSchema={this.updateRestrictSchema}\n+                    refererList={refererList}\n+                    newReferer={newReferer}\n+                    updateNewReferer={this.updateNewReferer}\n+                    updateRefererList={this.updateRefererList}\n+                  />\n+                  <FormGroup row className={classes.formGroup}>\n                     <Grid container spacing={3}>\n-                        <Grid item xs={12} className={classes.gridWrapper}>\n-                            <div>\n-                                <Button\n-                                    variant='contained'\n-                                    color='primary'\n-                                    onClick={this.handleClickOpen}\n-                                >\n-                                    {'Generate Key'}\n-                                </Button>\n-                            </div>\n-                            <Typography component='div' variant='body2' className={classes.formLabel}>\n-                                <FormattedMessage\n-                                    id='Shared.AppsAndKeys.ApiKeyManager.generate.key.help'\n-                                    defaultMessage='Use the Generate Key button to generate a self-contained JWT token.'\n-                                />\n-                            </Typography>\n-\n-                        </Grid>\n+                      <Grid item xs={12} className={classes.gridWrapper}>\n+                        <div>\n+                          <Button\n+                            variant=\"contained\"\n+                            color=\"primary\"\n+                            onClick={this.handleClickOpen}\n+                          >\n+                            {\"Generate Key\"}\n+                          </Button>\n+                        </div>\n+                        <Typography\n+                          component=\"div\"\n+                          variant=\"body2\"\n+                          className={classes.formLabel}\n+                        >\n+                          <FormattedMessage\n+                            id=\"Shared.AppsAndKeys.ApiKeyManager.generate.key.help\"\n+                            defaultMessage=\"Use the Generate Key button to generate a self-contained JWT token.\"\n+                          />\n+                        </Typography>\n+                      </Grid>\n                     </Grid>\n-                </FormGroup>\n-                <Dialog open={open} onClose={this.handleClose} aria-labelledby='form-dialog-title'>\n-                    <DialogTitle id='responsive-dialog-title' className={classes.dialogTitle}>\n-                        {'Generate API Key'}\n+                  </FormGroup>\n+                  <Dialog\n+                    open={open}\n+                    onClose={this.handleClose}\n+                    aria-labelledby=\"form-dialog-title\"\n+                  >\n+                    <DialogTitle id=\"responsive-dialog-title\" className={classes.dialogTitle}>\n+                      {\"Generate API Key\"}\n                     </DialogTitle>\n                     <DialogContent className={classes.dialogContent}>\n-                        <DialogContentText>\n-                            {!showToken && (\n-                                <ApiKey\n-                                    updateAccessTokenRequest={this.updateAccessTokenRequest}\n-                                    accessTokenRequest={accessTokenRequest}\n-                                />\n-                            )}\n-                            {showToken && <ViewToken token={apikey} />}\n-                        </DialogContentText>\n-                    </DialogContent>\n-                    <DialogActions>\n+                      <DialogContentText>\n                         {!showToken && (\n-                            <Button onClick={() => this.generateKeys(selectedApp, keyType)} disabled={!accessTokenRequest.timeout} color='primary'>\n-                                <FormattedMessage\n-                                    id='Shared.AppsAndKeys.ViewKeys.consumer.generate.btn'\n-                                    defaultMessage='Generate'\n-                                />\n-                            </Button>\n+                          <ApiKey\n+                            updateAccessTokenRequest={this.updateAccessTokenRequest}\n+                            accessTokenRequest={accessTokenRequest}\n+                          />\n                         )}\n-                        <Button onClick={this.handleClose} color='primary' autoFocus>\n-                            <FormattedMessage\n-                                id='Shared.AppsAndKeys.ViewKeys.consumer.close.btn'\n-                                defaultMessage='Close'\n-                            />\n+                        {showToken && <ViewToken token={apikey} />}\n+                      </DialogContentText>\n+                    </DialogContent>\n+                    <DialogActions>\n+                      {!showToken && (\n+                        <Button\n+                          onClick={() => this.generateKeys(selectedApp, keyType)}\n+                          disabled={!accessTokenRequest.timeout}\n+                          color=\"primary\"\n+                        >\n+                          <FormattedMessage\n+                            id=\"Shared.AppsAndKeys.ViewKeys.consumer.generate.btn\"\n+                            defaultMessage=\"Generate\"\n+                          />\n                         </Button>\n+                      )}\n+                      <Button onClick={this.handleClose} color=\"primary\" autoFocus>\n+                        <FormattedMessage\n+                          id=\"Shared.AppsAndKeys.ViewKeys.consumer.close.btn\"\n+                          defaultMessage=\"Close\"\n+                        />\n+                      </Button>\n                     </DialogActions>\n-                </Dialog>\n+                  </Dialog>\n+                </Grid>\n+                {restrictSchema == \"ip\" && (\n+                  <Grid item md={5} xs={12} style={{ padding: \"20px\" }}>\n+                    <Card>\n+                      <CardContent>\n+                        <Typography variant=\"h5\" component=\"h2\">\n+                          Examples of IP Addresses allowed\n+                        </Typography>\n+                        <List>\n+                          <ListItem>\n+                            <Typography variant=\"body1\" component=\"p\">\n+                              Specify one IPv4 or IPv6 or a subnet using CIDR notation\n+                            </Typography>\n+                          </ListItem>\n+                          <ListItem>\n+                            <Typography variant=\"body1\" component=\"p\">\n+                              Examples: <b>192.168.1.2</b>, <b>152.12.0.0/13</b>,{\" \"}\n+                              <b>2002:eb8::2</b> or <b>1001:ab8::/44</b>\n+                            </Typography>\n+                          </ListItem>\n+                        </List>\n+                      </CardContent>\n+                    </Card>\n+                  </Grid>\n+                )}\n+                {restrictSchema == \"referer\" && (\n+                  <Grid item md={5} xs={12}>\n+                    <Card>\n+                      <CardContent>\n+                        <Typography variant=\"h5\" component=\"h2\">\n+                          Examples of URLs allowed to restrict websites", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMDQ0OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414520449", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T12:00:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMDIwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMDI2Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414310267", "bodyText": "Add i18n support", "author": "kavishkafernando", "createdAt": "2020-04-24T05:47:22Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/AppsAndKeys/ApiKeyManager.jsx", "diffHunk": "@@ -139,60 +178,141 @@ class ApiKeyManager extends React.Component {\n                         id='Shared.AppsAndKeys.TokenManager.ApiKey'\n                     />\n                 </Typography>\n-                <FormGroup row className={classes.formGroup}>\n+              <Grid container direction=\"row\" spacing={0} justify=\"left\" alignItems=\"left\">\n+                <Grid item md={5} xs={12}>\n+                  <ApiKeyRestriction\n+                    updateNewIp={this.updateNewIp}\n+                    newIP={newIP}\n+                    updateIpList={this.updateIpList}\n+                    ipList={ipList}\n+                    restrictSchema={restrictSchema}\n+                    updateRestrictSchema={this.updateRestrictSchema}\n+                    refererList={refererList}\n+                    newReferer={newReferer}\n+                    updateNewReferer={this.updateNewReferer}\n+                    updateRefererList={this.updateRefererList}\n+                  />\n+                  <FormGroup row className={classes.formGroup}>\n                     <Grid container spacing={3}>\n-                        <Grid item xs={12} className={classes.gridWrapper}>\n-                            <div>\n-                                <Button\n-                                    variant='contained'\n-                                    color='primary'\n-                                    onClick={this.handleClickOpen}\n-                                >\n-                                    {'Generate Key'}\n-                                </Button>\n-                            </div>\n-                            <Typography component='div' variant='body2' className={classes.formLabel}>\n-                                <FormattedMessage\n-                                    id='Shared.AppsAndKeys.ApiKeyManager.generate.key.help'\n-                                    defaultMessage='Use the Generate Key button to generate a self-contained JWT token.'\n-                                />\n-                            </Typography>\n-\n-                        </Grid>\n+                      <Grid item xs={12} className={classes.gridWrapper}>\n+                        <div>\n+                          <Button\n+                            variant=\"contained\"\n+                            color=\"primary\"\n+                            onClick={this.handleClickOpen}\n+                          >\n+                            {\"Generate Key\"}\n+                          </Button>\n+                        </div>\n+                        <Typography\n+                          component=\"div\"\n+                          variant=\"body2\"\n+                          className={classes.formLabel}\n+                        >\n+                          <FormattedMessage\n+                            id=\"Shared.AppsAndKeys.ApiKeyManager.generate.key.help\"\n+                            defaultMessage=\"Use the Generate Key button to generate a self-contained JWT token.\"\n+                          />\n+                        </Typography>\n+                      </Grid>\n                     </Grid>\n-                </FormGroup>\n-                <Dialog open={open} onClose={this.handleClose} aria-labelledby='form-dialog-title'>\n-                    <DialogTitle id='responsive-dialog-title' className={classes.dialogTitle}>\n-                        {'Generate API Key'}\n+                  </FormGroup>\n+                  <Dialog\n+                    open={open}\n+                    onClose={this.handleClose}\n+                    aria-labelledby=\"form-dialog-title\"\n+                  >\n+                    <DialogTitle id=\"responsive-dialog-title\" className={classes.dialogTitle}>\n+                      {\"Generate API Key\"}\n                     </DialogTitle>\n                     <DialogContent className={classes.dialogContent}>\n-                        <DialogContentText>\n-                            {!showToken && (\n-                                <ApiKey\n-                                    updateAccessTokenRequest={this.updateAccessTokenRequest}\n-                                    accessTokenRequest={accessTokenRequest}\n-                                />\n-                            )}\n-                            {showToken && <ViewToken token={apikey} />}\n-                        </DialogContentText>\n-                    </DialogContent>\n-                    <DialogActions>\n+                      <DialogContentText>\n                         {!showToken && (\n-                            <Button onClick={() => this.generateKeys(selectedApp, keyType)} disabled={!accessTokenRequest.timeout} color='primary'>\n-                                <FormattedMessage\n-                                    id='Shared.AppsAndKeys.ViewKeys.consumer.generate.btn'\n-                                    defaultMessage='Generate'\n-                                />\n-                            </Button>\n+                          <ApiKey\n+                            updateAccessTokenRequest={this.updateAccessTokenRequest}\n+                            accessTokenRequest={accessTokenRequest}\n+                          />\n                         )}\n-                        <Button onClick={this.handleClose} color='primary' autoFocus>\n-                            <FormattedMessage\n-                                id='Shared.AppsAndKeys.ViewKeys.consumer.close.btn'\n-                                defaultMessage='Close'\n-                            />\n+                        {showToken && <ViewToken token={apikey} />}\n+                      </DialogContentText>\n+                    </DialogContent>\n+                    <DialogActions>\n+                      {!showToken && (\n+                        <Button\n+                          onClick={() => this.generateKeys(selectedApp, keyType)}\n+                          disabled={!accessTokenRequest.timeout}\n+                          color=\"primary\"\n+                        >\n+                          <FormattedMessage\n+                            id=\"Shared.AppsAndKeys.ViewKeys.consumer.generate.btn\"\n+                            defaultMessage=\"Generate\"\n+                          />\n                         </Button>\n+                      )}\n+                      <Button onClick={this.handleClose} color=\"primary\" autoFocus>\n+                        <FormattedMessage\n+                          id=\"Shared.AppsAndKeys.ViewKeys.consumer.close.btn\"\n+                          defaultMessage=\"Close\"\n+                        />\n+                      </Button>\n                     </DialogActions>\n-                </Dialog>\n+                  </Dialog>\n+                </Grid>\n+                {restrictSchema == \"ip\" && (\n+                  <Grid item md={5} xs={12} style={{ padding: \"20px\" }}>\n+                    <Card>\n+                      <CardContent>\n+                        <Typography variant=\"h5\" component=\"h2\">\n+                          Examples of IP Addresses allowed\n+                        </Typography>\n+                        <List>\n+                          <ListItem>\n+                            <Typography variant=\"body1\" component=\"p\">\n+                              Specify one IPv4 or IPv6 or a subnet using CIDR notation\n+                            </Typography>\n+                          </ListItem>\n+                          <ListItem>\n+                            <Typography variant=\"body1\" component=\"p\">\n+                              Examples: <b>192.168.1.2</b>, <b>152.12.0.0/13</b>,{\" \"}\n+                              <b>2002:eb8::2</b> or <b>1001:ab8::/44</b>\n+                            </Typography>\n+                          </ListItem>\n+                        </List>\n+                      </CardContent>\n+                    </Card>\n+                  </Grid>\n+                )}\n+                {restrictSchema == \"referer\" && (\n+                  <Grid item md={5} xs={12}>\n+                    <Card>\n+                      <CardContent>\n+                        <Typography variant=\"h5\" component=\"h2\">\n+                          Examples of URLs allowed to restrict websites\n+                        </Typography>\n+                        <List>\n+                          <ListItem>\n+                            <Typography variant=\"body1\" component=\"p\">\n+                              A specific URL with an exact path: <b>www.example.com/path</b>\n+                            </Typography>\n+                          </ListItem>\n+                          <ListItem>\n+                            <Typography variant=\"body1\" component=\"p\">\n+                              Any URL in a single subdomain, using a wildcard asterisk (*):{\" \"}\n+                              <b>sub.example.com/*</b>\n+                            </Typography>\n+                          </ListItem>\n+                          <ListItem>\n+                            <Typography variant=\"body1\" component=\"p\">\n+                              Any subdomain or path URLs in a single domain, using wildcard", "originalCommit": "2ccb4987a206ddbd1e33baa000e62c80d9f5da44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMDUwMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r414520502", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-24T12:00:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMDI2Nw=="}], "type": "inlineReview"}, {"oid": "c6ac720f4df9c4a18e24c04bd9f29d6aedfeb436", "url": "https://github.com/wso2/carbon-apimgt/commit/c6ac720f4df9c4a18e24c04bd9f29d6aedfeb436", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-24T08:37:30Z", "type": "forcePushed"}, {"oid": "0283780be9a95596ec65e1d9cb7897191a892f9c", "url": "https://github.com/wso2/carbon-apimgt/commit/0283780be9a95596ec65e1d9cb7897191a892f9c", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-24T10:29:55Z", "type": "forcePushed"}, {"oid": "328ed034198222236f80c6f9617f27e01732e438", "url": "https://github.com/wso2/carbon-apimgt/commit/328ed034198222236f80c6f9617f27e01732e438", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-24T10:54:18Z", "type": "forcePushed"}, {"oid": "6438c95762ce3ba01720c9e750779635bbe13fb2", "url": "https://github.com/wso2/carbon-apimgt/commit/6438c95762ce3ba01720c9e750779635bbe13fb2", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-24T11:50:13Z", "type": "forcePushed"}, {"oid": "470a16b449baa928b3635fdaef6fbfb970408050", "url": "https://github.com/wso2/carbon-apimgt/commit/470a16b449baa928b3635fdaef6fbfb970408050", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-24T12:21:54Z", "type": "forcePushed"}, {"oid": "680565ddc3d9653584a94bd170f390ef1882606d", "url": "https://github.com/wso2/carbon-apimgt/commit/680565ddc3d9653584a94bd170f390ef1882606d", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-24T12:28:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3MDUxNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r415070515", "bodyText": "null check claim not available at none state", "author": "tharindu1st", "createdAt": "2020-04-25T14:10:49Z", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/handlers/security/apikey/ApiKeyAuthenticator.java", "diffHunk": "@@ -358,6 +361,71 @@ public AuthenticationResponse authenticate(MessageContext synCtx) {\n         }\n     }\n \n+    private void validateAPIKeyRestrictions(JWTClaimsSet payload, MessageContext synCtx) throws APISecurityException {\n+        org.apache.axis2.context.MessageContext axis2MessageContext = ((Axis2MessageContext) synCtx).\n+                getAxis2MessageContext();\n+\n+        String permittedIPList = (String) payload.getClaim(APIConstants.JwtTokenConstants.PERMITTED_IP);", "originalCommit": "680565ddc3d9653584a94bd170f390ef1882606d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4MTI1OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r415081258", "bodyText": "null can be type cast to String and it still will be null. So, do we need to check for null here?", "author": "ChamodDamitha", "createdAt": "2020-04-25T15:10:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3MDUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4ODI1Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r415088252", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-25T15:48:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3MDUxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3MDY4OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r415070689", "bodyText": "!= null and not empty", "author": "tharindu1st", "createdAt": "2020-04-25T14:11:35Z", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/handlers/security/apikey/ApiKeyAuthenticator.java", "diffHunk": "@@ -358,6 +361,71 @@ public AuthenticationResponse authenticate(MessageContext synCtx) {\n         }\n     }\n \n+    private void validateAPIKeyRestrictions(JWTClaimsSet payload, MessageContext synCtx) throws APISecurityException {\n+        org.apache.axis2.context.MessageContext axis2MessageContext = ((Axis2MessageContext) synCtx).\n+                getAxis2MessageContext();\n+\n+        String permittedIPList = (String) payload.getClaim(APIConstants.JwtTokenConstants.PERMITTED_IP);\n+\n+        if (StringUtils.isNotEmpty(permittedIPList)) {", "originalCommit": "680565ddc3d9653584a94bd170f390ef1882606d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3OTg0Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r415079847", "bodyText": "StringUtils.isNotEmpty() method already checks for null. So, why do we need to check again?", "author": "ChamodDamitha", "createdAt": "2020-04-25T15:02:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3MDY4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3MTI3MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r415071271", "bodyText": "null check and string", "author": "tharindu1st", "createdAt": "2020-04-25T14:14:55Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/impl/ApplicationsApiServiceImpl.java", "diffHunk": "@@ -339,7 +339,17 @@ public Response applicationsApplicationIdApiKeysKeyTypeGeneratePost(\n                     } else {\n                         validityPeriod = -1;\n                     }\n-                    String apiKey = apiConsumer.generateApiKey(application, userName, (long) validityPeriod);\n+\n+                    String restrictedIP = null;\n+                    String restrictedReferer = null;\n+\n+                    if (body.getAdditionalProperties() != null) {\n+                        Map additionalProperties = (HashMap) body.getAdditionalProperties();\n+                        restrictedIP = (String) additionalProperties.get(APIConstants.JwtTokenConstants.PERMITTED_IP);", "originalCommit": "680565ddc3d9653584a94bd170f390ef1882606d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4ODI1OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r415088258", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-25T15:48:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3MTI3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3MTQxMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r415071412", "bodyText": "null check and set", "author": "tharindu1st", "createdAt": "2020-04-25T14:15:44Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/token/ApiKeyGenerator.java", "diffHunk": "@@ -86,6 +86,9 @@ private static String buildBody(JwtTokenInfoDTO jwtTokenInfoDTO) {\n         jwtClaimsSetBuilder.claim(\"application\", jwtTokenInfoDTO.getApplication());\n         jwtClaimsSetBuilder.claim(\"keytype\", jwtTokenInfoDTO.getKeyType());\n \n+        jwtClaimsSetBuilder.claim(APIConstants.JwtTokenConstants.PERMITTED_IP, jwtTokenInfoDTO.getPermittedIP());", "originalCommit": "680565ddc3d9653584a94bd170f390ef1882606d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4ODI4MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r415088280", "bodyText": "fixed", "author": "ChamodDamitha", "createdAt": "2020-04-25T15:48:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA3MTQxMg=="}], "type": "inlineReview"}, {"oid": "e1d60cfb9868265f5cafdfdc3a78e3f1986953ad", "url": "https://github.com/wso2/carbon-apimgt/commit/e1d60cfb9868265f5cafdfdc3a78e3f1986953ad", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-25T15:17:06Z", "type": "forcePushed"}, {"oid": "ed1f682eaa62fc48637ef1fbaf1d8bb17b8fd6d2", "url": "https://github.com/wso2/carbon-apimgt/commit/ed1f682eaa62fc48637ef1fbaf1d8bb17b8fd6d2", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-25T15:47:23Z", "type": "forcePushed"}, {"oid": "f5b72784f785c13e1703ec24914690da2e8badb2", "url": "https://github.com/wso2/carbon-apimgt/commit/f5b72784f785c13e1703ec24914690da2e8badb2", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-26T18:36:33Z", "type": "commit"}, {"oid": "f5b72784f785c13e1703ec24914690da2e8badb2", "url": "https://github.com/wso2/carbon-apimgt/commit/f5b72784f785c13e1703ec24914690da2e8badb2", "message": "Add IP and Referer restriction support to API Key authentication", "committedDate": "2020-04-26T18:36:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyODUxMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r466128510", "bodyText": "Shall we remove this extra line?", "author": "Meruja", "createdAt": "2020-08-06T03:47:16Z", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/handlers/security/apikey/ApiKeyAuthenticator.java", "diffHunk": "@@ -358,6 +361,78 @@ public AuthenticationResponse authenticate(MessageContext synCtx) {\n         }\n     }\n \n+    private void validateAPIKeyRestrictions(JWTClaimsSet payload, MessageContext synCtx) throws APISecurityException {\n+        org.apache.axis2.context.MessageContext axis2MessageContext = ((Axis2MessageContext) synCtx).\n+                getAxis2MessageContext();\n+\n+        String permittedIPList = null;\n+        if (payload.getClaim(APIConstants.JwtTokenConstants.PERMITTED_IP) != null) {\n+            permittedIPList = (String) payload.getClaim(APIConstants.JwtTokenConstants.PERMITTED_IP);\n+        }\n+\n+        if (StringUtils.isNotEmpty(permittedIPList)) {\n+            // Validate client IP against permitted IPs\n+            String clientIP = GatewayUtils.getIp(axis2MessageContext);\n+\n+            if (StringUtils.isNotEmpty(clientIP)) {\n+                for (String restrictedIP : permittedIPList.split(\",\")) {\n+                    if (APIUtil.isIpInNetwork(clientIP, restrictedIP.trim())) {\n+                        // Client IP is allowed\n+                        return;\n+                    }\n+                }\n+                if (log.isDebugEnabled()) {\n+                    String apiContext = (String) synCtx.getProperty(RESTConstants.REST_API_CONTEXT);\n+                    String apiVersion = (String) synCtx.getProperty(RESTConstants.SYNAPSE_REST_API_VERSION);\n+\n+                    if (StringUtils.isNotEmpty(clientIP)) {\n+                        log.debug(\"Invocations to API: \" + apiContext + \":\" + apiVersion +\n+                                \" is not permitted for client with IP: \" + clientIP);\n+                    }\n+                }\n+                throw new APISecurityException(APISecurityConstants.API_AUTH_FORBIDDEN,\n+                        \"Access forbidden for the invocations\");\n+            }\n+", "originalCommit": "f5b72784f785c13e1703ec24914690da2e8badb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0OTM1OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r478949359", "bodyText": "Fixed in #9250", "author": "ChamodDamitha", "createdAt": "2020-08-28T08:38:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyODUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE4ODA2NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r466188064", "bodyText": "can't we move this to the previous line? does it exceed 120 line length?", "author": "ruwiniwj", "createdAt": "2020-08-06T07:03:15Z", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/handlers/security/apikey/ApiKeyAuthenticator.java", "diffHunk": "@@ -358,6 +361,78 @@ public AuthenticationResponse authenticate(MessageContext synCtx) {\n         }\n     }\n \n+    private void validateAPIKeyRestrictions(JWTClaimsSet payload, MessageContext synCtx) throws APISecurityException {\n+        org.apache.axis2.context.MessageContext axis2MessageContext = ((Axis2MessageContext) synCtx).\n+                getAxis2MessageContext();\n+\n+        String permittedIPList = null;\n+        if (payload.getClaim(APIConstants.JwtTokenConstants.PERMITTED_IP) != null) {\n+            permittedIPList = (String) payload.getClaim(APIConstants.JwtTokenConstants.PERMITTED_IP);\n+        }\n+\n+        if (StringUtils.isNotEmpty(permittedIPList)) {\n+            // Validate client IP against permitted IPs\n+            String clientIP = GatewayUtils.getIp(axis2MessageContext);\n+\n+            if (StringUtils.isNotEmpty(clientIP)) {\n+                for (String restrictedIP : permittedIPList.split(\",\")) {\n+                    if (APIUtil.isIpInNetwork(clientIP, restrictedIP.trim())) {\n+                        // Client IP is allowed\n+                        return;\n+                    }\n+                }\n+                if (log.isDebugEnabled()) {\n+                    String apiContext = (String) synCtx.getProperty(RESTConstants.REST_API_CONTEXT);\n+                    String apiVersion = (String) synCtx.getProperty(RESTConstants.SYNAPSE_REST_API_VERSION);\n+\n+                    if (StringUtils.isNotEmpty(clientIP)) {\n+                        log.debug(\"Invocations to API: \" + apiContext + \":\" + apiVersion +\n+                                \" is not permitted for client with IP: \" + clientIP);\n+                    }\n+                }\n+                throw new APISecurityException(APISecurityConstants.API_AUTH_FORBIDDEN,\n+                        \"Access forbidden for the invocations\");\n+            }\n+\n+        }\n+\n+        String permittedRefererList = null;\n+        if (payload.getClaim(APIConstants.JwtTokenConstants.PERMITTED_REFERER) != null) {\n+            permittedRefererList = (String) payload.getClaim(APIConstants.JwtTokenConstants.PERMITTED_REFERER);\n+        }\n+\n+        if (StringUtils.isNotEmpty(permittedRefererList)) {\n+            // Validate http referer against the permitted referrers\n+            TreeMap<String, String> transportHeaderMap = (TreeMap<String, String>)\n+                    axis2MessageContext.getProperty\n+                            (org.apache.axis2.context.MessageContext.TRANSPORT_HEADERS);\n+            if (transportHeaderMap != null) {\n+                String referer = transportHeaderMap.get(\"Referer\");\n+                if (StringUtils.isNotEmpty(referer)) {\n+                    for (String restrictedReferer : permittedRefererList.split(\",\")) {\n+                        String restrictedRefererRegExp = restrictedReferer.trim()\n+                                .replace(\"*\", \"[^ ]*\");", "originalCommit": "f5b72784f785c13e1703ec24914690da2e8badb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0OTQ3Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r478949472", "bodyText": "Fixed in #9250", "author": "ChamodDamitha", "createdAt": "2020-08-28T08:38:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE4ODA2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE4ODY0OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r466188648", "bodyText": "need to have a space before open curly and after close curly when writing conditions. Fix elsewhere as well.", "author": "ruwiniwj", "createdAt": "2020-08-06T07:04:29Z", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/components/Shared/ApiKeyRestriction.jsx", "diffHunk": "@@ -0,0 +1,340 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+import React, { useState } from \"react\";\n+import { injectIntl } from \"react-intl\";\n+import PropTypes from \"prop-types\";\n+import { withStyles } from \"@material-ui/core/styles\";\n+import TextField from \"@material-ui/core/TextField\";\n+import FormControlLabel from \"@material-ui/core/FormControlLabel\";\n+import IconButton from \"@material-ui/core/IconButton\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import Grid from \"@material-ui/core/Grid\";\n+import Fab from \"@material-ui/core/Fab\";\n+import AddIcon from \"@material-ui/icons/Add\";\n+import List from \"@material-ui/core/List\";\n+import ListItem from \"@material-ui/core/ListItem\";\n+import ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\n+import ListItemText from \"@material-ui/core/ListItemText\";\n+import Box from \"@material-ui/core/Box\";\n+import Radio from \"@material-ui/core/Radio\";\n+import RadioGroup from \"@material-ui/core/RadioGroup\";\n+import FormControl from \"@material-ui/core/FormControl\";\n+import Button from \"@material-ui/core/Button\";\n+import Typography from \"@material-ui/core/Typography\";\n+import Validation from 'AppData/Validation';\n+\n+const styles = (theme) => ({\n+  FormControl: {\n+    \"margin-bottom\": theme.spacing(1),\n+    width: \"100%\",\n+    padding: theme.spacing(0, 1),\n+  },\n+  outterBox: {\n+    margin: theme.spacing(1),\n+    padding: theme.spacing(1),\n+    borderColor: theme.palette.text.secondary,\n+  },\n+  Fab: {\n+    marginLeft: theme.spacing(2),\n+    marginRight: theme.spacing(2),\n+  },\n+});\n+\n+/**\n+ * Used to display IP address and Http Referer restrictions in generate api key UI\n+ */\n+const apiKeyRestrictions = (props) => {\n+  const [invalidIP, setInvalidIP] = useState(false);\n+  const [invalidReferer, setInvalidReferer] = useState(false);\n+\n+  const {\n+    intl,\n+    classes,\n+    newIP,\n+    updateNewIp,\n+    ipList,\n+    updateIpList,\n+    restrictSchema,\n+    updateRestrictSchema,\n+    newReferer,\n+    updateNewReferer,\n+    refererList,\n+    updateRefererList,\n+  } = props;\n+\n+  const onRefererTextUpdate = (e) => {\n+    updateNewReferer(e.target.value.trim());\n+    if (e.target.value.trim() === \"\") {\n+      setInvalidReferer(false);\n+    }\n+  };\n+\n+  const addRefererItem = () => {\n+    if (newReferer !== null && newReferer !== \"\") {\n+      setInvalidReferer(false);\n+      refererList.push(newReferer.trim());\n+      updateRefererList(refererList);\n+      updateNewReferer(\"\");\n+    } else {\n+      setInvalidReferer(true);\n+    }\n+  };\n+\n+  const deleteRefererItem = (refererItem) => {\n+    refererList.splice(refererList.indexOf(refererItem), 1);\n+    updateRefererList(refererList);\n+  };\n+\n+  const onIpTextUpdate = (e) => {\n+    updateNewIp(e.target.value.trim());\n+    if (e.target.value.trim() === \"\") {\n+      setInvalidIP(false);\n+    }\n+  };\n+\n+  const addIpItem = () => {\n+    if (newIP !== null && newIP !== \"\") {\n+      if (Validation.ipAddress.validate(newIP).error) {\n+        setInvalidIP(true);\n+      } else {\n+        setInvalidIP(false);\n+        ipList.push(newIP);\n+        updateIpList(ipList);\n+        updateNewIp(\"\");\n+      }\n+    }\n+  };\n+\n+  const deleteIpItem = (ipItem) => {\n+    ipList.splice(ipList.indexOf(ipItem), 1);\n+    updateIpList(ipList);\n+  };\n+\n+  const onRestrictSchemaChange = (e) => {\n+    updateRestrictSchema(e.target.value);\n+    updateIpList([]);\n+    updateRefererList([]);\n+    updateNewIp(\"\");\n+    updateNewReferer(\"\");\n+    setInvalidIP(false);\n+    setInvalidReferer(false);\n+  };\n+\n+  return (\n+    <React.Fragment>\n+      <Box border={1} borderRadius={5} className={classes.outterBox}>\n+        <Typography variant=\"h5\" component=\"h6\">\n+          Key Restrictions\n+        </Typography>\n+        <FormControl component=\"fieldset\">\n+          <RadioGroup\n+            aria-label=\"API Key Restrictions\"\n+            value={restrictSchema}\n+            row\n+            onChange={onRestrictSchemaChange}\n+          >\n+            <FormControlLabel\n+              value=\"none\"\n+              control={<Radio color=\"primary\" />}\n+              label=\"None\"\n+              labelPlacement=\"end\"\n+            />\n+            <FormControlLabel\n+              value=\"ip\"\n+              control={<Radio color=\"primary\" />}\n+              label=\"IP Addresses\"\n+              labelPlacement=\"end\"\n+            />\n+            <FormControlLabel\n+              value=\"referer\"\n+              control={<Radio color=\"primary\" />}\n+              label=\"HTTP Referrers (Web Sites)\"\n+              labelPlacement=\"end\"\n+            />\n+          </RadioGroup>\n+        </FormControl>\n+\n+        {restrictSchema === \"ip\" && (\n+          <Box component=\"div\" id=\"ipPanel\">\n+            <Grid\n+              container\n+              direction=\"row\"\n+              spacing={0}\n+              justify=\"left\"\n+              alignItems=\"left\"\n+            >\n+              <Grid item md={10} xs={10}>\n+                <TextField\n+                  label=\"IP Address\"\n+                  value={newIP}\n+                  onChange={onIpTextUpdate}\n+                  className={classes.inputText}\n+                  helperText={\n+                    invalidIP\n+                      ? intl.formatMessage({\n+                          defaultMessage: \"Invalid IP Address\",\n+                          id:\n+                            \"Shared.AppsAndKeys.Tokens.apiKeyRestriction.ip.validity.error\",\n+                        })\n+                      : \"\"\n+                  }\n+                  error={invalidIP}\n+                  margin=\"dense\"\n+                  variant=\"outlined\"\n+                  placeholder={intl.formatMessage({\n+                    defaultMessage: \"Enter IP Address\",\n+                    id: \"Shared.AppsAndKeys.Tokens.apiKeyRestriction.enter.ip\",\n+                  })}\n+                  fullWidth\n+                />\n+              </Grid>\n+              <Grid item md={2} xs={2}>\n+                <span>\n+                  <Fab\n+                    className={classes.Fab}\n+                    size=\"small\"\n+                    color=\"primary\"\n+                    aria-label=\"add\"\n+                    onClick={addIpItem}\n+                  >\n+                    <AddIcon />\n+                  </Fab>\n+                </span>\n+              </Grid>\n+            </Grid>\n+            <Grid\n+              container\n+              direction=\"row\"\n+              spacing={0}\n+              justify=\"left\"\n+              alignItems=\"left\"\n+              md={10}\n+              xs={10}\n+            >\n+              {ipList.length > 0 && (", "originalCommit": "f5b72784f785c13e1703ec24914690da2e8badb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0OTYwOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8427#discussion_r478949608", "bodyText": "Fixed in #9250", "author": "ChamodDamitha", "createdAt": "2020-08-28T08:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE4ODY0OA=="}], "type": "inlineReview"}]}