{"pr_number": 836, "pr_title": "Build fixes", "pr_createdAt": "2020-12-05T16:14:24Z", "pr_url": "https://github.com/pytorch/serve/pull/836", "timeline": [{"oid": "093e470b1410f7b372d47d9111e43e27bc30a7d2", "url": "https://github.com/pytorch/serve/commit/093e470b1410f7b372d47d9111e43e27bc30a7d2", "message": "fixed docker readme for cuda version", "committedDate": "2020-12-05T04:53:19Z", "type": "commit"}, {"oid": "547a7cb8db6f0d4eed260f0fe44c8466327549c2", "url": "https://github.com/pytorch/serve/commit/547a7cb8db6f0d4eed260f0fe44c8466327549c2", "message": "added cuda92 support for PT 16", "committedDate": "2020-12-05T05:35:34Z", "type": "commit"}, {"oid": "6ff67eba0775cb57c5d035553bdeca5b786e164e", "url": "https://github.com/pytorch/serve/commit/6ff67eba0775cb57c5d035553bdeca5b786e164e", "message": "excluded test package from installation", "committedDate": "2020-12-05T05:59:23Z", "type": "commit"}, {"oid": "96eeb20a070dcbde98f5b643941a5172583cbb2a", "url": "https://github.com/pytorch/serve/commit/96eeb20a070dcbde98f5b643941a5172583cbb2a", "message": "minor fix for cuda version", "committedDate": "2020-12-05T05:59:41Z", "type": "commit"}, {"oid": "bfd208638c545830cc5dce5e91738786bfc5b024", "url": "https://github.com/pytorch/serve/commit/bfd208638c545830cc5dce5e91738786bfc5b024", "message": "added header info in install from src", "committedDate": "2020-12-05T06:00:27Z", "type": "commit"}, {"oid": "6299947287dd07fe19807cd0225b2d01b3d3d8de", "url": "https://github.com/pytorch/serve/commit/6299947287dd07fe19807cd0225b2d01b3d3d8de", "message": "missed checkin", "committedDate": "2020-12-05T06:03:49Z", "type": "commit"}, {"oid": "fb638bce2b208dd6e25f87d154c0e379ec37c23b", "url": "https://github.com/pytorch/serve/commit/fb638bce2b208dd6e25f87d154c0e379ec37c23b", "message": "fixed import", "committedDate": "2020-12-05T09:04:51Z", "type": "commit"}, {"oid": "f1ab474663b242969c2ae82bc2dc7ac29eb2fb9e", "url": "https://github.com/pytorch/serve/commit/f1ab474663b242969c2ae82bc2dc7ac29eb2fb9e", "message": "added python version check", "committedDate": "2020-12-05T09:05:11Z", "type": "commit"}, {"oid": "7ea037bd6bfdc4091feef1cd1a50131839b8e253", "url": "https://github.com/pytorch/serve/commit/7ea037bd6bfdc4091feef1cd1a50131839b8e253", "message": "node fixes", "committedDate": "2020-12-05T09:07:29Z", "type": "commit"}, {"oid": "fcae405ebed0c439b0bda55062e15a25820ad7ae", "url": "https://github.com/pytorch/serve/commit/fcae405ebed0c439b0bda55062e15a25820ad7ae", "message": "update pip and setuptools", "committedDate": "2020-12-05T09:08:17Z", "type": "commit"}, {"oid": "8eeb1dea08a05b46d932eb598e2dd1c19830c26a", "url": "https://github.com/pytorch/serve/commit/8eeb1dea08a05b46d932eb598e2dd1c19830c26a", "message": "refactored functions to util module", "committedDate": "2020-12-05T12:00:38Z", "type": "commit"}, {"oid": "b42667308a8e87a82f025850b3030376c6f6a00c", "url": "https://github.com/pytorch/serve/commit/b42667308a8e87a82f025850b3030376c6f6a00c", "message": "updated README", "committedDate": "2020-12-05T16:13:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzOTQ1MA==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r536839450", "bodyText": "Can we also clarify that we need to specify the appropriate BASE_IMAGE= with the cuda version", "author": "maaquib", "createdAt": "2020-12-05T18:17:59Z", "path": "docker/README.md", "diffHunk": "@@ -38,7 +38,7 @@ For creating GPU based image with the latest CUDA version PyTorch supports (ex.\n DOCKER_BUILDKIT=1 docker build --file Dockerfile --build-arg BASE_IMAGE=nvidia/cuda:10.2-cudnn7-runtime-ubuntu18.04 -t torchserve:latest .\n ```\n \n-For creating GPU based image with older CUDA versions (ex. CUDA 10.1), make sure that the `--build-arg CUDA_VERSION=<version>` is specified. The version is in the format \"cuda92\", \"cuda101\":\n+For creating GPU based image with older CUDA versions (ex. CUDA 10.1), make sure that the `--build-arg CUDA_VERSION=<version>` is specified. The version is in the format \"cu92\", \"cu101\", \"cu102\":", "originalCommit": "b42667308a8e87a82f025850b3030376c6f6a00c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjkzOTY1Mw==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r536939653", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-12-06T02:46:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzOTQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA5MzEzMQ==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r537093131", "bodyText": "@harshbafna  @maaquib Is it not possible to derive the Base image name from just the Cuda version? It will simplify things for people building their own custom image of TorchServe if they can just set a single CUDA_VERSION variable", "author": "chauhang", "createdAt": "2020-12-06T18:09:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzOTQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM2MDkxNA==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r537360914", "bodyText": "@chauhang: Enhanced the build_image.sh script and updated the documentation. Could you please review?", "author": "harshbafna", "createdAt": "2020-12-07T09:39:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzOTQ1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg2MDI1Ng==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r536860256", "bodyText": "requirements_cu102.txt doesn't exist. Please add it\nI don't like the idea of having users install dependencies two different ways. We already have an install_dependencies.py script and this pip install should be part of it", "author": "maaquib", "createdAt": "2020-12-05T18:52:40Z", "path": "README.md", "diffHunk": "@@ -40,16 +40,29 @@ TorchServe is a flexible and easy to use tool for serving PyTorch models.\n \n 2. Install python pre-requisite packages\n \n- - For CPU or GPU-Cuda 10.2\n+ - For CPU or latest supported CUDA version for Torch 1.6\n \n     ```bash\n     pip install -U -r requirements.txt\n     ```\n+   \n+ - For GPU with Cuda 10.2\n+\n+    ```bash\n+    pip install -U -r requirements_cu102.txt -f https://download.pytorch.org/whl/torch_stable.html", "originalCommit": "b42667308a8e87a82f025850b3030376c6f6a00c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjkzODg4Ng==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r536938886", "bodyText": "@maaquib: install_dependencies script does a lot more things than just installing the python packages and java and is mainly targeted for developers.\nAdded the requirements file for CUDA 10.2", "author": "harshbafna", "createdAt": "2020-12-06T02:41:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg2MDI1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA5MjYwOQ==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r537092609", "bodyText": "@harshbafna So far the install from source was for people devs wanting to use latest TorchServe from master. We need to target two type of developers and have appropriate scripts / steps for both:\n\nData scientists and other devs who end to use TorchServe from master\nContributors to TorchServe who are adding new features/fixing bugs.\n\nThe main readmes are for #1 audience\nFor contributors we have the Contributing.md  page, please update the instructions there for people adding new features/fixes", "author": "chauhang", "createdAt": "2020-12-06T18:05:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg2MDI1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIwMzg1Mw==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r537203853", "bodyText": "@chauhang: Currently the install_dependency script is only for setting up the dev environment. We can add another flag in the install_dependency.py file to take the environment parameter (developer, production) as input. The production flag will only install the bare minimum dependencies of JDK11 and required python packages.", "author": "harshbafna", "createdAt": "2020-12-07T03:19:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg2MDI1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUzMjExNQ==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r537532115", "bodyText": "@chauhang: Could you please review #837 for these changes?", "author": "harshbafna", "createdAt": "2020-12-07T14:06:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg2MDI1Ng=="}], "type": "inlineReview"}, {"oid": "29bc917d169d75121ad924d56315eccadf87a3a7", "url": "https://github.com/pytorch/serve/commit/29bc917d169d75121ad924d56315eccadf87a3a7", "message": "Added requirements file for cuda 102", "committedDate": "2020-12-06T02:40:27Z", "type": "commit"}, {"oid": "2c7f3415ec8698d938a3c0d76f802e251e0d9c2c", "url": "https://github.com/pytorch/serve/commit/2c7f3415ec8698d938a3c0d76f802e251e0d9c2c", "message": "added base image", "committedDate": "2020-12-06T02:46:30Z", "type": "commit"}, {"oid": "0c639a8fde7761d7cad30470aae63ad265e5d593", "url": "https://github.com/pytorch/serve/commit/0c639a8fde7761d7cad30470aae63ad265e5d593", "message": "added strict check for python 3.6+", "committedDate": "2020-12-06T05:06:37Z", "type": "commit"}, {"oid": "f49cc2a4101f1ff18e6796dbeabda8be1ad28965", "url": "https://github.com/pytorch/serve/commit/f49cc2a4101f1ff18e6796dbeabda8be1ad28965", "message": "updated python path", "committedDate": "2020-12-06T05:07:07Z", "type": "commit"}, {"oid": "f2b724181bf204501eb3539518653d822d605450", "url": "https://github.com/pytorch/serve/commit/f2b724181bf204501eb3539518653d822d605450", "message": "added logger", "committedDate": "2020-12-06T05:14:41Z", "type": "commit"}, {"oid": "e24e78c5de8d94a2a1061ef0fdbd5eb22db97fde", "url": "https://github.com/pytorch/serve/commit/e24e78c5de8d94a2a1061ef0fdbd5eb22db97fde", "message": "fixed python version check", "committedDate": "2020-12-06T05:21:48Z", "type": "commit"}, {"oid": "1b1709c0c5162a5e59da18834431e0d3a0b05c96", "url": "https://github.com/pytorch/serve/commit/1b1709c0c5162a5e59da18834431e0d3a0b05c96", "message": "Fixes for windows native support", "committedDate": "2020-12-06T08:00:26Z", "type": "commit"}, {"oid": "0c56a686b6129ed904080cea5a8fb14da7b7bbac", "url": "https://github.com/pytorch/serve/commit/0c56a686b6129ed904080cea5a8fb14da7b7bbac", "message": "Merge branch 'build_fixes' of https://github.com/pytorch/serve into build_fixes", "committedDate": "2020-12-06T08:00:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA5NTAzMg==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r537095032", "bodyText": "@harshbafna @maaquib Why are we pinning to 3.6 version? We need support for python >= 3.6", "author": "chauhang", "createdAt": "2020-12-06T18:18:49Z", "path": "ts_scripts/utils.py", "diffHunk": "@@ -0,0 +1,20 @@\n+import os\n+import sys\n+\n+\n+def is_gpu_instance():\n+    return True if os.system(\"nvidia-smi\") == 0 else False\n+\n+\n+def is_conda_env():\n+    return True if os.system(\"conda\") == 0 else False\n+\n+\n+def check_python_version():\n+    req_version = (3, 6)", "originalCommit": "0c56a686b6129ed904080cea5a8fb14da7b7bbac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIwNDMyOQ==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r537204329", "bodyText": "@chauhang: The minor version check is for >=6 only in line no. #17. :-)", "author": "harshbafna", "createdAt": "2020-12-07T03:21:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA5NTAzMg=="}], "type": "inlineReview"}, {"oid": "15d8759f5f2b4b118641ac186103e93112f7aade", "url": "https://github.com/pytorch/serve/commit/15d8759f5f2b4b118641ac186103e93112f7aade", "message": "removed cuda 10.2 requirements file", "committedDate": "2020-12-07T04:41:10Z", "type": "commit"}, {"oid": "ce3c3e6f111db81b44058fab9ce68e539df5eda8", "url": "https://github.com/pytorch/serve/commit/ce3c3e6f111db81b44058fab9ce68e539df5eda8", "message": "Merge branch 'build_fixes' of https://github.com/pytorch/serve into build_fixes", "committedDate": "2020-12-07T04:42:40Z", "type": "commit"}, {"oid": "75d77f92ef7f9f0cc323c3655febc40caab3e03a", "url": "https://github.com/pytorch/serve/commit/75d77f92ef7f9f0cc323c3655febc40caab3e03a", "message": "froze pylint version", "committedDate": "2020-12-07T04:48:40Z", "type": "commit"}, {"oid": "6fe98696dd2c7a5e7d7f3daab619a0ea31c7d2e0", "url": "https://github.com/pytorch/serve/commit/6fe98696dd2c7a5e7d7f3daab619a0ea31c7d2e0", "message": "added cu92 as allowed cuda version", "committedDate": "2020-12-07T07:48:26Z", "type": "commit"}, {"oid": "362d3d67ce165f4da490707a25242f12fda44788", "url": "https://github.com/pytorch/serve/commit/362d3d67ce165f4da490707a25242f12fda44788", "message": "removed is gpu instance check", "committedDate": "2020-12-07T08:33:56Z", "type": "commit"}, {"oid": "3a8a0596944622ecfc7d34125ff2a3030e748ce1", "url": "https://github.com/pytorch/serve/commit/3a8a0596944622ecfc7d34125ff2a3030e748ce1", "message": "added check for latest", "committedDate": "2020-12-07T08:43:20Z", "type": "commit"}, {"oid": "30f7a642bb8d266fb2690b08d0a179e1e0c97f35", "url": "https://github.com/pytorch/serve/commit/30f7a642bb8d266fb2690b08d0a179e1e0c97f35", "message": "enhanced build image script to support production docker image as well", "committedDate": "2020-12-07T08:53:54Z", "type": "commit"}, {"oid": "540357572d05e03b43a4e47c1049bfa38dfcbd35", "url": "https://github.com/pytorch/serve/commit/540357572d05e03b43a4e47c1049bfa38dfcbd35", "message": "updated help section", "committedDate": "2020-12-07T09:17:10Z", "type": "commit"}, {"oid": "0665ad64c201e02322b809890491a2c1415bdea0", "url": "https://github.com/pytorch/serve/commit/0665ad64c201e02322b809890491a2c1415bdea0", "message": "updated docker readme", "committedDate": "2020-12-07T09:19:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg0ODkzMQ==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r537848931", "bodyText": "Add possible values for this option", "author": "maaquib", "createdAt": "2020-12-07T21:33:57Z", "path": "docker/build_image.sh", "diffHunk": "@@ -16,7 +17,8 @@ do\n           echo \"-h, --help  show brief help\"\n           echo \"-b, --branch_name=BRANCH_NAME specify a branch_name to use\"\n           echo \"-g, --gpu specify to use gpu\"\n-          echo \"-c, --codebuild specify to created image for codebuild\"\n+          echo \"-bt, --buildtype specify to created image for codebuild\"", "originalCommit": "0665ad64c201e02322b809890491a2c1415bdea0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA1MjkyMg==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r538052922", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-12-08T05:48:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg0ODkzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg1MDU4Mg==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r537850582", "bodyText": "This might have side affects if the user is running in a virtual env. Please verify.", "author": "maaquib", "createdAt": "2020-12-07T21:36:37Z", "path": "ts_scripts/install_dependencies.py", "diffHunk": "@@ -41,26 +49,30 @@ def install_jmeter(self):\n class Linux(Common):\n     def __init__(self):\n         super().__init__()\n+        os.system(f\"{self.sudo_cmd}apt-get update\")\n \n     def install_java(self):\n-        os.system(f\"{self.sudo_cmd}apt-get update\")\n         os.system(f\"{self.sudo_cmd}apt-get install -y openjdk-11-jdk\")\n \n-    def install_node_packages(self):\n-        os.system(f\"{self.sudo_cmd}apt-get update\")\n-        os.system(f\"{self.sudo_cmd}npm install -g newman newman-reporter-html markdown-link-check\")\n-\n     def install_nodejs(self):\n-        os.system(f\"{self.sudo_cmd}apt-get update\")\n+        python_path = Path(sys.executable).resolve()\n         os.system(f\"{self.sudo_cmd}curl -sL https://deb.nodesource.com/setup_14.x | {self.sudo_cmd}bash -\")\n         os.system(f\"{self.sudo_cmd}apt-get install -y nodejs\")\n+        os.system(f\"{self.sudo_cmd}ln -sf {python_path} /usr/bin/python\")\n+        os.system(f\"{self.sudo_cmd}ln -sf /usr/bin/pip3 /usr/bin/pip\")", "originalCommit": "0665ad64c201e02322b809890491a2c1415bdea0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA1MjA5OA==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r538052098", "bodyText": "@maaquib: The nodejs installation doesn't impact Conda or any virtual env's python. Validated on virtualenv as well.\n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ which python\n/home/ubuntu/pyenv/pytorchenv/bin/python\n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ which pip\n/home/ubuntu/pyenv/pytorchenv/bin/pip\n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ python --version\nPython 3.7.5\n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ git checkout build_fixes\nBranch 'build_fixes' set up to track remote branch 'build_fixes' from 'origin'.\nSwitched to a new branch 'build_fixes'\n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ python ts_scripts/install_dependencies.py \n<snip : install_dependencies_logs>\n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ \n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ \n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ \n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ which pip\n/home/ubuntu/pyenv/pytorchenv/bin/pip\n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ which python\n/home/ubuntu/pyenv/pytorchenv/bin/python\n(pytorchenv) ubuntu@ip-172-31-22-254:~/serve$ python --version\nPython 3.7.5", "author": "harshbafna", "createdAt": "2020-12-08T05:45:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg1MDU4Mg=="}], "type": "inlineReview"}, {"oid": "b82c56eb3a9c3f0cc32767a7d7804989773d1508", "url": "https://github.com/pytorch/serve/commit/b82c56eb3a9c3f0cc32767a7d7804989773d1508", "message": "Merge branch 'master' into build_fixes", "committedDate": "2020-12-08T03:59:30Z", "type": "commit"}, {"oid": "8c83dc38cf5d1af33fba4169175601b7be7502b4", "url": "https://github.com/pytorch/serve/commit/8c83dc38cf5d1af33fba4169175601b7be7502b4", "message": "updated help section", "committedDate": "2020-12-08T05:46:47Z", "type": "commit"}, {"oid": "a207396c91247e97d2c6b29d0e28a05e13f94cf7", "url": "https://github.com/pytorch/serve/commit/a207396c91247e97d2c6b29d0e28a05e13f94cf7", "message": "Merge branch 'build_fixes' of https://github.com/pytorch/serve into build_fixes", "committedDate": "2020-12-08T05:47:06Z", "type": "commit"}, {"oid": "dee3a147ae794a9c5674feef6fda2267c0892cce", "url": "https://github.com/pytorch/serve/commit/dee3a147ae794a9c5674feef6fda2267c0892cce", "message": "Merge branch 'master' into build_fixes", "committedDate": "2020-12-08T18:20:12Z", "type": "commit"}, {"oid": "df5fe4cd5ed4db1e4f21a040db4e029a7c454a60", "url": "https://github.com/pytorch/serve/commit/df5fe4cd5ed4db1e4f21a040db4e029a7c454a60", "message": "install dependencies dev and prod environment (#837)\n\n* production and dev env support\r\n\r\n* Merge branch 'build_fixes' of https://github.com/pytorch/serve into build_fixes1\r\n\r\n# Conflicts:\r\n#\tREADME.md\r\n#\tts_scripts/install_dependencies.py\r\n\r\n* add --environment=dev param\r\n\r\n* add environment param\r\n\r\n* add environment param\r\n\r\n* small fix\r\n\r\n* prod and dev commands separation\r\n\r\n* prod and dev commands separation", "committedDate": "2020-12-08T18:45:24Z", "type": "commit"}, {"oid": "a2a9d0d8d88637e25fbabb67b2d311635cba95c6", "url": "https://github.com/pytorch/serve/commit/a2a9d0d8d88637e25fbabb67b2d311635cba95c6", "message": "Merge branch 'master' into build_fixes", "committedDate": "2020-12-08T18:45:41Z", "type": "commit"}, {"oid": "fbb1ecd37bdb49df95464f0e8d17a04b870216b5", "url": "https://github.com/pytorch/serve/commit/fbb1ecd37bdb49df95464f0e8d17a04b870216b5", "message": "Merge branch 'master' into build_fixes", "committedDate": "2020-12-08T18:48:03Z", "type": "commit"}, {"oid": "4a0212146ae1e3ac7159ad21105713b83550149c", "url": "https://github.com/pytorch/serve/commit/4a0212146ae1e3ac7159ad21105713b83550149c", "message": "Merge branch 'master' into build_fixes", "committedDate": "2020-12-09T00:32:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkxNjgyOQ==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r538916829", "bodyText": "Please replace 1.0 with current latest version of another tag like \"dev-latest\"", "author": "chauhang", "createdAt": "2020-12-09T00:42:18Z", "path": "docker/README.md", "diffHunk": "@@ -26,143 +25,177 @@ git clone https://github.com/pytorch/serve.git\n \n # Create TorchServe docker image\n \n-For creating CPU based image :\n+Use `build_image.sh` script to build the docker images. The script builds the `production`, `dev` and `codebuild` docker images.\n \n-```bash\n-DOCKER_BUILDKIT=1 docker build --file Dockerfile -t torchserve:latest .\n-```\n+| Parameter | Desciption |\n+|------|------|\n+|-h, --help|Show script help|\n+|-b, --branch_name|Specify a branch name to use. Default: master |\n+|-g, --gpu|Build image with GPU based ubuntu base image|\n+|-bt, --buildtype|Which type of docker image to build. Can be one of : production, dev, codebuild|\n+|-t, --tag|Tag name for image. If not specified, script uses torchserv default tag names.|\n+|-cv, --cudaversion| Specify to cuda version to use. Supported values `cu92`, `cu101`, `cu102`. Default `cu102`|\n+\n+**PRODUCTION ENVIRONMENT IMAGES**\n+\n+Creates a docker image with publicly available `torchserve` and `torch-model-archiver` binaries installed.\n \n-For creating GPU based image with the latest CUDA version PyTorch supports (ex. CUDA 10.2 as of Oct 2020):\n+ - For creating CPU based image :\n \n ```bash\n-DOCKER_BUILDKIT=1 docker build --file Dockerfile --build-arg BASE_IMAGE=nvidia/cuda:10.2-cudnn7-runtime-ubuntu18.04 -t torchserve:latest .\n+./build_image.sh\n ```\n \n-For creating GPU based image with older CUDA versions (ex. CUDA 10.1), make sure that the `--build-arg CUDA_VERSION=<version>` is specified. The version is in the format \"cuda92\", \"cuda101\":\n+ - For creating GPU based image (Default cuda 10.2):\n \n ```bash\n-DOCKER_BUILDKIT=1 docker build --file Dockerfile --build-arg BASE_IMAGE=nvidia/cuda:10.1-cudnn7-runtime-ubuntu18.04 --build-arg CUDA_VERSION=cu101 -t torchserve:latest .\n+./build_image.sh -g\n ```\n \n-## Start a container with a TorchServe image\n-\n-The following examples will start the container with 8080/81 port exposed to outer-world/localhost.\n+ - For creating GPU based image with cuda version 10.1:\n \n-#### Start CPU container\n+```bash\n+./build_image.sh -g -cv cu101\n+```\n \n-For the latest version, you can use the `latest` tag:\n+ - For creating GPU based image with cuda version 9.2:\n \n ```bash\n-docker run --rm -it -p 8080:8080 -p 8081:8081 pytorch/torchserve:latest\n+./build_image.sh -g -cv cu92\n ```\n \n-For specific versions you can pass in the specific tag to use (ex: pytorch/torchserve:0.1.1-cpu):\n+ - For creating image with a custom tag:\n \n ```bash\n-docker run --rm -it -p 8080:8080 -p 8081:8081 pytorch/torchserve:0.1.1-cpu\n+./build_image.sh -t torchserve:1.0\n ```\n \n-#### Start GPU container\n+**DEVELOPER ENVIRONMENT IMAGES**\n \n-For GPU latest image with gpu devices 1 and 2:\n+Creates a docker image with `torchserve` and `torch-model-archiver` installed from source.\n+\n+- For creating CPU based image :\n \n ```bash\n-docker run --rm -it --gpus '\"device=1,2\"' -p 8080:8080 -p 8081:8081 pytorch/torchserve:latest-gpu\n+./build_image.sh -bt dev\n ```\n \n-For specific versions you can pass in the specific tag to use (ex: 0.1.1-cuda10.1-cudnn7-runtime):\n+- For creating CPU based image with a different branch:\n \n ```bash\n-docker run --rm -it --gpus all -p 8080:8080 -p 8081:8081 pytorch/torchserve:0.1.1-cuda10.1-cudnn7-runtime\n+./build_image.sh -bt dev -b my_branch\n ```\n \n-For the latest version, you can use the `latest-gpu` tag:\n+- For creating GPU based image (Default cuda 10.2):\n \n ```bash\n-docker run --rm -it --gpus all -p 8080:8080 -p 8081:8081 torchserve:gpu-latest\n+./build_image.sh -bt dev -g\n ```\n \n-#### Accessing TorchServe APIs inside container\n+- For creating GPU based image with a different branch:\n \n-The TorchServe's inference and management APIs can be accessed on localhost over 8080 and 8081 ports respectively. Example :\n+```bash\n+./build_image.sh -bt dev -g -b my_branch\n+```\n+\n+ - For creating GPU based image with cuda version 10.1:\n \n ```bash\n-curl http://localhost:8080/ping\n+./build_image.sh -bt dev -g -cv cu101\n ```\n \n-# Create TorchServe docker image from source\n+ - For creating GPU based image with cuda version 9.2:\n \n-The following are examples on how to use the `build_image.sh` script to build Docker images from source to support CPU or GPU inference.\n+```bash\n+./build_image.sh -bt dev -g -cv cu92\n+```\n \n-To build the TorchServe image for a CPU device using the `master` branch, use the following command:\n+ - For creating image with a custom tag:\n \n ```bash\n-./build_image.sh\n+./build_image.sh -bt dev -t torchserve-dev:1.0", "originalCommit": "4a0212146ae1e3ac7159ad21105713b83550149c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczMDUwMw==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r538730503", "bodyText": "@maheshambule  I had tested with Py37 on conda recently. Why are we adding Py38 as as a min?", "author": "maaquib", "createdAt": "2020-12-08T19:04:19Z", "path": "README.md", "diffHunk": "@@ -25,35 +25,37 @@ TorchServe is a flexible and easy to use tool for serving PyTorch models.\n \n ## Install TorchServe\n \n-1. Install Java 11\n+1. Install dependencies\n \n-    For Ubuntu\n-    ```bash\n-    sudo apt-get install openjdk-11-jdk\n-    ```\n-   \n-   For Mac\n-    ```bash\n-    brew tap AdoptOpenJDK/openjdk\n-    brew cask install adoptopenjdk11\n-    ```\n+Note: For Conda, Python 3.8 is required to run Torchserve.", "originalCommit": "fbb1ecd37bdb49df95464f0e8d17a04b870216b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk3NDk4Mg==", "url": "https://github.com/pytorch/serve/pull/836#discussion_r538974982", "bodyText": "@maaquib: This is because the currently published conda-binaries are only compatible with Py38. It was already there in the documentation, just moved to a different place.", "author": "harshbafna", "createdAt": "2020-12-09T03:19:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczMDUwMw=="}], "type": "inlineReview"}, {"oid": "cc924de3eeadb30e64c982d1b68a378ea02e2a75", "url": "https://github.com/pytorch/serve/commit/cc924de3eeadb30e64c982d1b68a378ea02e2a75", "message": "Merge branch 'master' into build_fixes", "committedDate": "2020-12-09T03:52:08Z", "type": "commit"}]}