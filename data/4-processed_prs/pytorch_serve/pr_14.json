{"pr_number": 14, "pr_title": "Default handler for text_classifier, object_detector, image segmentation", "pr_createdAt": "2020-01-02T07:25:42Z", "pr_url": "https://github.com/pytorch/serve/pull/14", "timeline": [{"oid": "aec932a4defe928f207004246f74121082497c91", "url": "https://github.com/pytorch/serve/commit/aec932a4defe928f207004246f74121082497c91", "message": "initial commit for text handlers", "committedDate": "2020-01-01T09:46:46Z", "type": "commit"}, {"oid": "3bb63761eb72d19af12e7f6789497f6072915e40", "url": "https://github.com/pytorch/serve/commit/3bb63761eb72d19af12e7f6789497f6072915e40", "message": "added new switches for model type in model-archiver", "committedDate": "2020-01-01T11:58:12Z", "type": "commit"}, {"oid": "24a67a9ed2c2d19767479a6e43dc37dcd889c5eb", "url": "https://github.com/pytorch/serve/commit/24a67a9ed2c2d19767479a6e43dc37dcd889c5eb", "message": "added switches for text based models", "committedDate": "2020-01-02T06:04:28Z", "type": "commit"}, {"oid": "5b700e2a7e5471018d912482fe18ac4e0357786d", "url": "https://github.com/pytorch/serve/commit/5b700e2a7e5471018d912482fe18ac4e0357786d", "message": "removed model-type and model-sub-type flag and modified handler working in model archiver", "committedDate": "2020-01-02T13:25:20Z", "type": "commit"}, {"oid": "fca41b46a2325e16fa640cebc5ff1fbae193e1e4", "url": "https://github.com/pytorch/serve/commit/fca41b46a2325e16fa640cebc5ff1fbae193e1e4", "message": "fixed test cases for model-archive", "committedDate": "2020-01-03T05:01:35Z", "type": "commit"}, {"oid": "1da211336aa542d15a6eac2774bf6c5502ab5e38", "url": "https://github.com/pytorch/serve/commit/1da211336aa542d15a6eac2774bf6c5502ab5e38", "message": "added UTs for model archiver and fixed issues found during testing", "committedDate": "2020-01-03T09:21:51Z", "type": "commit"}, {"oid": "b9974ffd7e9bfe5980a121e80513d9fb629e9af5", "url": "https://github.com/pytorch/serve/commit/b9974ffd7e9bfe5980a121e80513d9fb629e9af5", "message": "added negative test cases in model archiver", "committedDate": "2020-01-03T09:27:11Z", "type": "commit"}, {"oid": "0ff2f3acea0ddbea5a7a9ecb4c3eeeb48eb7565b", "url": "https://github.com/pytorch/serve/commit/0ff2f3acea0ddbea5a7a9ecb4c3eeeb48eb7565b", "message": "fixed issues found during end to end testing", "committedDate": "2020-01-03T12:27:12Z", "type": "commit"}, {"oid": "4a3593ad8478be2315d0191d6cd56765fe26d75c", "url": "https://github.com/pytorch/serve/commit/4a3593ad8478be2315d0191d6cd56765fe26d75c", "message": "updated examples and documentation", "committedDate": "2020-01-03T17:34:39Z", "type": "commit"}, {"oid": "246316fb1ea8ecfec9026c4517adac828a1492a8", "url": "https://github.com/pytorch/serve/commit/246316fb1ea8ecfec9026c4517adac828a1492a8", "message": "added missed file", "committedDate": "2020-01-03T17:43:44Z", "type": "commit"}, {"oid": "e8af3dee45dbb1c3606f2ac7d59d2be150bb6daa", "url": "https://github.com/pytorch/serve/commit/e8af3dee45dbb1c3606f2ac7d59d2be150bb6daa", "message": "Adding default handler for object detector", "committedDate": "2020-01-07T18:05:20Z", "type": "commit"}, {"oid": "f890c0969f110b300472872554bb29d28cc74438", "url": "https://github.com/pytorch/serve/commit/f890c0969f110b300472872554bb29d28cc74438", "message": "Fixed return format", "committedDate": "2020-01-08T09:48:10Z", "type": "commit"}, {"oid": "eca01e8dd0c0e54bd7948a35312fc1367d87dc4e", "url": "https://github.com/pytorch/serve/commit/eca01e8dd0c0e54bd7948a35312fc1367d87dc4e", "message": "removed spacy dependency, updated model archiver and related docs", "committedDate": "2020-01-10T07:11:00Z", "type": "commit"}, {"oid": "fb139dd89f2f52376a2cef4986530a3153f7716c", "url": "https://github.com/pytorch/serve/commit/fb139dd89f2f52376a2cef4986530a3153f7716c", "message": "updated examples and related documentation", "committedDate": "2020-01-10T11:09:37Z", "type": "commit"}, {"oid": "ebbd444013151232fb8f04c78333c060b4e5bcf7", "url": "https://github.com/pytorch/serve/commit/ebbd444013151232fb8f04c78333c060b4e5bcf7", "message": "updated handler definition", "committedDate": "2020-01-10T11:12:47Z", "type": "commit"}, {"oid": "2d94c4007c4430476a8ee514533869417e496cfd", "url": "https://github.com/pytorch/serve/commit/2d94c4007c4430476a8ee514533869417e496cfd", "message": "removed unused destination vocab parameter", "committedDate": "2020-01-10T12:39:09Z", "type": "commit"}, {"oid": "14b3eb67a4b3d6679780e6970e6c3e17a6ad60d5", "url": "https://github.com/pytorch/serve/commit/14b3eb67a4b3d6679780e6970e6c3e17a6ad60d5", "message": "added check for custom handler", "committedDate": "2020-01-14T08:48:12Z", "type": "commit"}, {"oid": "fb0d56be28e29ff74907eb024254367fd54608cb", "url": "https://github.com/pytorch/serve/commit/fb0d56be28e29ff74907eb024254367fd54608cb", "message": "Default handler for image segmentation", "committedDate": "2020-01-14T12:30:06Z", "type": "commit"}, {"oid": "fe562d0a91e8a7b4e9e95919870f2088bd2a18ec", "url": "https://github.com/pytorch/serve/commit/fe562d0a91e8a7b4e9e95919870f2088bd2a18ec", "message": "Merge branch 'text_classifier' of https://github.com/pytorch/serve into text_classifier", "committedDate": "2020-01-14T12:30:27Z", "type": "commit"}, {"oid": "ec0115b7216e5d7053e7c1a189dc95369d97e6e9", "url": "https://github.com/pytorch/serve/commit/ec0115b7216e5d7053e7c1a189dc95369d97e6e9", "message": "changed string formatting", "committedDate": "2020-01-14T12:42:56Z", "type": "commit"}, {"oid": "e1857d4229c143d11c65ea4ba231abf8fe46f0a5", "url": "https://github.com/pytorch/serve/commit/e1857d4229c143d11c65ea4ba231abf8fe46f0a5", "message": "added readme for image segmenter example", "committedDate": "2020-01-14T12:55:09Z", "type": "commit"}, {"oid": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "url": "https://github.com/pytorch/serve/commit/d326edd12bbc238aa74e3c95caa37def0abfa3be", "message": "updated steps", "committedDate": "2020-01-14T12:57:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwMzg2NQ==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366603865", "bodyText": "Remove line.", "author": "alexwong", "createdAt": "2020-01-14T22:21:24Z", "path": "examples/image_segmenter/fcn/model.py", "diffHunk": "@@ -0,0 +1,40 @@\n+from torchvision.models.segmentation.fcn import FCN\n+from torchvision.models import resnet\n+from intermediate_layer_getter import IntermediateLayerGetter\n+from fcn import FCNHead\n+\"\"\"\n+NN definition for fcn_resnet101 i.e. FCN with restnet 101 as backend\n+\"\"\"\n+\n+", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc4Nzg3NQ==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367787875", "bodyText": "Done. We have moved the comments inside the class definition itself as a part of standard practice. However, the double line space above class definition is as per the pep-8 standards.", "author": "harshbafna", "createdAt": "2020-01-17T06:38:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwMzg2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNDA2NQ==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366604065", "bodyText": "Remove line.", "author": "alexwong", "createdAt": "2020-01-14T22:21:55Z", "path": "examples/object_detector/README.md", "diffHunk": "@@ -0,0 +1,74 @@\n+# Object Detection using torchvision's pretrained fast-rcnn model.\n+\n+* Download the pre-trained fast-rcnn object detection model's state_dict from the following URL :\n+\n+https://download.pytorch.org/models/fasterrcnn_resnet50_fpn_coco-258fb6c6.pth\n+\n+    ```bash\n+    wget https://download.pytorch.org/models/fasterrcnn_resnet50_fpn_coco-258fb6c6.pth\n+    ```\n+\n+* Create a model archive file and serve the fastrcnn model in TorchServe using below commands\n+\n+", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc4Nzg5OQ==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367787899", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-01-17T06:38:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNDA2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNTIxNg==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366605216", "bodyText": "Extra line.", "author": "alexwong", "createdAt": "2020-01-14T22:24:49Z", "path": "examples/text_classification/model.py", "diffHunk": "@@ -0,0 +1,40 @@\n+import torch.nn as nn\n+\n+r\"\"\"\n+The model is composed of the embeddingbag layer and the linear layer.\n+\n+nn.EmbeddingBag computes the mean of 'bags' of embeddings. The text\n+entries here have different lengths. nn.EmbeddingBag requires no\n+padding because the lengths of sentences are saved in offsets.\n+Therefore, this method is much faster than the original one\n+with TorchText Iterator and Batch.\n+\n+Additionally, since it accumulates the average across the embeddings on the fly,\n+nn.EmbeddingBag can enhance the performance and memory efficiency\n+to process a sequence of tensors.\n+\n+\"\"\"\n+\n+\n+class TextSentiment(nn.Module):\n+    def __init__(self, vocab_size=1308844, embed_dim=32, num_class=4):\n+        super().__init__()\n+        self.embedding = nn.EmbeddingBag(vocab_size, embed_dim, sparse=True)\n+        self.fc = nn.Linear(embed_dim, num_class)\n+        self.init_weights()\n+\n+    def init_weights(self):\n+        initrange = 0.5\n+        self.embedding.weight.data.uniform_(-initrange, initrange)\n+        self.fc.weight.data.uniform_(-initrange, initrange)\n+        self.fc.bias.data.zero_()\n+\n+    def forward(self, text, offsets):\n+        r\"\"\"\n+        Arguments:\n+            text: 1-D tensor representing a bag of text tensors\n+            offsets: a list of offsets to delimit the 1-D text tensor\n+                into the individual sequences.\n+", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc4NzkxOA==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367787918", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-01-17T06:38:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNTIxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNTUwMg==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366605502", "bodyText": "Extra line.", "author": "alexwong", "createdAt": "2020-01-14T22:25:35Z", "path": "examples/text_classification/model.py", "diffHunk": "@@ -0,0 +1,40 @@\n+import torch.nn as nn\n+\n+r\"\"\"\n+The model is composed of the embeddingbag layer and the linear layer.\n+\n+nn.EmbeddingBag computes the mean of 'bags' of embeddings. The text\n+entries here have different lengths. nn.EmbeddingBag requires no\n+padding because the lengths of sentences are saved in offsets.\n+Therefore, this method is much faster than the original one\n+with TorchText Iterator and Batch.\n+\n+Additionally, since it accumulates the average across the embeddings on the fly,\n+nn.EmbeddingBag can enhance the performance and memory efficiency\n+to process a sequence of tensors.\n+", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc4NzkyOQ==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367787929", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-01-17T06:38:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNTUwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNTU0OA==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366605548", "bodyText": "Extra line.", "author": "alexwong", "createdAt": "2020-01-14T22:25:43Z", "path": "examples/text_classification/model.py", "diffHunk": "@@ -0,0 +1,40 @@\n+import torch.nn as nn\n+\n+r\"\"\"\n+The model is composed of the embeddingbag layer and the linear layer.\n+\n+nn.EmbeddingBag computes the mean of 'bags' of embeddings. The text\n+entries here have different lengths. nn.EmbeddingBag requires no\n+padding because the lengths of sentences are saved in offsets.\n+Therefore, this method is much faster than the original one\n+with TorchText Iterator and Batch.\n+\n+Additionally, since it accumulates the average across the embeddings on the fly,\n+nn.EmbeddingBag can enhance the performance and memory efficiency\n+to process a sequence of tensors.\n+\n+\"\"\"\n+\n+", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc4Nzk0Mw==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367787943", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-01-17T06:38:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNTU0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNTg5MA==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366605890", "bodyText": "I think there's some inconsistent spacing everywhere which we can fix (won't comment on others).", "author": "alexwong", "createdAt": "2020-01-14T22:26:35Z", "path": "examples/text_classification/train.py", "diffHunk": "@@ -0,0 +1,198 @@\n+import os\n+import logging\n+import argparse\n+\n+import torch\n+import sys\n+\n+from torchtext.datasets import text_classification\n+from torch.utils.data import DataLoader\n+\n+from model import TextSentiment\n+from torch.utils.data.dataset import random_split\n+\n+r\"\"\"\n+This file shows the training process of the text classification model.\n+\"\"\"\n+\n+", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc4Nzk1NQ==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367787955", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-01-17T06:38:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNTg5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNjEyOQ==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366606129", "bodyText": "Reminder to update.", "author": "alexwong", "createdAt": "2020-01-14T22:27:17Z", "path": "model-archiver/README.md", "diffHunk": "@@ -122,6 +128,13 @@ A model file should contain the model architecture. This file is mandatory in ca\n \n A serialized file (.pt or .pth) should be a checkpoint in case of torchscript and state_dict in case of eager mode.\n \n+### Handler\n+\n+Handler can be TorchServe's inbuilt handler name or path to a py to handle custom TS inference logic. TorchServe supports following handlers out or box:\n+1. image_classifier\n+2. object_detector\n+3. text_classifier\n+4. language_translator", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc2NzYyNQ==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367767625", "bodyText": "Done. Currently replaced language_translator with image_segmenter. We will add audio_classifer once the default handler is checked in.", "author": "harshbafna", "createdAt": "2020-01-17T04:46:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNjEyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwODc2Mg==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366608762", "bodyText": "What happens if the handler is in the directory they're calling from?", "author": "alexwong", "createdAt": "2020-01-14T22:34:31Z", "path": "model-archiver/model_archiver/manifest_components/model.py", "diffHunk": "@@ -10,14 +10,16 @@ class Model(object):\n     as the entry point into the service code through the handler property\n     \"\"\"\n \n-    def __init__(self, model_name, serialized_file, model_file=None, handler=None, description=None, model_version=None, extensions=None):\n+    def __init__(self, model_name, serialized_file, handler, model_file=None, description=None, model_version=None,\n+                 extensions=None, source_vocab=None):\n         self.model_name = model_name\n         self.serialized_file = serialized_file.split(\"/\")[-1]\n         self.model_file = model_file\n         self.description = description\n         self.model_version = model_version\n         self.extensions = extensions\n-        self.handler = handler\n+        self.handler = handler.split(\"/\")[-1]", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc2NzM3Mg==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367767372", "bodyText": "The above code will still work fine as the resulting array from split operation will have a single element (filename).", "author": "harshbafna", "createdAt": "2020-01-17T04:44:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwODc2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxMDAzNA==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366610034", "bodyText": "Is source_vocab needed if we want to just support some languages by default (namely english?)", "author": "alexwong", "createdAt": "2020-01-14T22:37:59Z", "path": "model-archiver/model_archiver/model_packaging.py", "diffHunk": "@@ -20,6 +20,7 @@ def package_model(args, manifest):\n     handler = args.handler\n     extra_files = args.extra_files\n     export_file_path = args.export_path\n+    source_vocab = args.source_vocab", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc2NzE0NA==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367767144", "bodyText": "Yes. The source vocab is required to convert the text to tensor, as the user might have used a custom domain specific vocab [twitter_sentiment, news category, spam detection etc.] at the time of model training.", "author": "harshbafna", "createdAt": "2020-01-17T04:43:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxMDAzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxMTg3MA==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366611870", "bodyText": "Not sure if this is in the description/readme for this handler but can we add what the handler needs to be able to support it? Ie: what the model should take as an input and output. Cause we can process more than FCN and DeepLab right? It just has to be the same \"type\" of model as those two.", "author": "alexwong", "createdAt": "2020-01-14T22:42:49Z", "path": "ts/torch_handler/image_segmenter.py", "diffHunk": "@@ -0,0 +1,67 @@\n+import io\n+from PIL import Image\n+import torch\n+from torchvision import transforms as T\n+\n+from .vision_handler import VisionHandler\n+\n+\n+class ImangeSegmenter(VisionHandler):\n+    \"\"\"\n+    ImangeSegmentor handler class. This handler takes an image\n+    and returns output shape as [CL H W], CL - number of classes, H - height and W - width\n+    This handler can process FCN and DeepLab Segmentation models", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc2NjY4Nw==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367766687", "bodyText": "Yes. it can support any image segmentation models. Removed the line from class description.", "author": "harshbafna", "createdAt": "2020-01-17T04:40:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxMTg3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxMzExMg==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r366613112", "bodyText": "Can we remove these inline comments and jsut have it as a description for the function?", "author": "alexwong", "createdAt": "2020-01-14T22:46:18Z", "path": "ts/torch_handler/text_classifier.py", "diffHunk": "@@ -0,0 +1,87 @@\n+import torch\n+from torch.autograd import Variable\n+from .text_handler import TextHandler\n+from torchtext.data.utils import ngrams_iterator\n+\n+\n+class TextClassifier(TextHandler):\n+    \"\"\"\n+    TextClassifier handler class. This handler takes a text (string) and\n+    as input and returns the classification text based on the model vocabulary.\n+    \"\"\"\n+\n+    def __init__(self):\n+        super(TextClassifier, self).__init__()\n+\n+    def preprocess(self, data):\n+        \"\"\"\n+         Normalizes the input text for PyTorch model,\n+         returns an Numpy array\n+        \"\"\"\n+        text = data[0].get(\"data\")\n+        if text is None:\n+            text = data[0].get(\"body\")\n+\n+        text = text.decode('utf-8')\n+\n+        ngrams = 2\n+\n+        # remove html tags", "originalCommit": "d326edd12bbc238aa74e3c95caa37def0abfa3be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc2NzI0Ng==", "url": "https://github.com/pytorch/serve/pull/14#discussion_r367767246", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-01-17T04:43:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxMzExMg=="}], "type": "inlineReview"}, {"oid": "5cdf94cad5bc8cb0d72db62fc6e3d8b478a1b8c0", "url": "https://github.com/pytorch/serve/commit/5cdf94cad5bc8cb0d72db62fc6e3d8b478a1b8c0", "message": "incorporated code review comments", "committedDate": "2020-01-17T04:56:06Z", "type": "commit"}, {"oid": "17459243376c00cab5ff0df84bbf218f554a90fc", "url": "https://github.com/pytorch/serve/commit/17459243376c00cab5ff0df84bbf218f554a90fc", "message": "incorporated code review comments", "committedDate": "2020-01-17T06:20:44Z", "type": "commit"}, {"oid": "bdd54479aa68d567501bb9c9b24fe210824ec38a", "url": "https://github.com/pytorch/serve/commit/bdd54479aa68d567501bb9c9b24fe210824ec38a", "message": "incorporated code review comments", "committedDate": "2020-01-18T14:17:17Z", "type": "commit"}, {"oid": "0da32b13ca376659f4be0bd595b7bfa67847fb59", "url": "https://github.com/pytorch/serve/commit/0da32b13ca376659f4be0bd595b7bfa67847fb59", "message": "Corrected sentences.", "committedDate": "2020-01-27T06:32:54Z", "type": "commit"}, {"oid": "1f27f5b683e92b504a88edaab50172d41294d866", "url": "https://github.com/pytorch/serve/commit/1f27f5b683e92b504a88edaab50172d41294d866", "message": "Added missing text for image segmenter default handler", "committedDate": "2020-01-27T09:51:57Z", "type": "commit"}, {"oid": "a70d1d05d4fc9bedf4167e1b3a55e58261a153bd", "url": "https://github.com/pytorch/serve/commit/a70d1d05d4fc9bedf4167e1b3a55e58261a153bd", "message": "resolve conflict", "committedDate": "2020-01-27T09:53:51Z", "type": "commit"}]}