{"pr_number": 152, "pr_title": "Removed snapshot dependency on model", "pr_createdAt": "2020-04-01T17:24:46Z", "pr_url": "https://github.com/pytorch/serve/pull/152", "timeline": [{"oid": "ecfd35aed3298dbf32e36c2c3d60909c63ea174b", "url": "https://github.com/pytorch/serve/commit/ecfd35aed3298dbf32e36c2c3d60909c63ea174b", "message": "Snapshot is now independent of model", "committedDate": "2020-03-30T11:52:55Z", "type": "commit"}, {"oid": "90e2a1ee5fa53a48ff8b38626e77c925e6b9fedc", "url": "https://github.com/pytorch/serve/commit/90e2a1ee5fa53a48ff8b38626e77c925e6b9fedc", "message": "merged snapshot latest", "committedDate": "2020-04-01T15:36:10Z", "type": "commit"}, {"oid": "c22dcd755c4af9469cade7757f9872e7c1695061", "url": "https://github.com/pytorch/serve/commit/c22dcd755c4af9469cade7757f9872e7c1695061", "message": "fixed checkstyle issue", "committedDate": "2020-04-01T16:27:41Z", "type": "commit"}, {"oid": "b10550fb19201c50711cfc58c548c89b5cd9f00a", "url": "https://github.com/pytorch/serve/commit/b10550fb19201c50711cfc58c548c89b5cd9f00a", "message": "fixed formatting", "committedDate": "2020-04-01T17:03:17Z", "type": "commit"}, {"oid": "3e450d207f80c5630c3f6c50c4776cb2172eade4", "url": "https://github.com/pytorch/serve/commit/3e450d207f80c5630c3f6c50c4776cb2172eade4", "message": "Merge branch 'stage_release' into issue_130", "committedDate": "2020-04-09T14:45:58Z", "type": "commit"}, {"oid": "c75ecd42746895fadf4b55f77c477b0a11a1cbd7", "url": "https://github.com/pytorch/serve/commit/c75ecd42746895fadf4b55f77c477b0a11a1cbd7", "message": "doc review: configuration and custom_service", "committedDate": "2020-04-09T18:38:26Z", "type": "commit"}, {"oid": "2bc2c094a3a68dede15f75f625096556c3573ab8", "url": "https://github.com/pytorch/serve/commit/2bc2c094a3a68dede15f75f625096556c3573ab8", "message": "addressed review comments", "committedDate": "2020-04-09T22:05:34Z", "type": "commit"}, {"oid": "b871ed67516908fe705accc015a3dc87761a1b84", "url": "https://github.com/pytorch/serve/commit/b871ed67516908fe705accc015a3dc87761a1b84", "message": "Merge pull request #173 from eslesar-aws/doc-review-config-custom\n\ndoc review: configuration.md and custom_service.md", "committedDate": "2020-04-09T22:53:32Z", "type": "commit"}, {"oid": "0c2fe49064c94fb7110cf640492ed2b41576ed80", "url": "https://github.com/pytorch/serve/commit/0c2fe49064c94fb7110cf640492ed2b41576ed80", "message": "Merge branch 'stage_release' into issue_130", "committedDate": "2020-04-10T05:37:56Z", "type": "commit"}, {"oid": "dbc281582215a3b9c8ad92c2d78deb660a429796", "url": "https://github.com/pytorch/serve/commit/dbc281582215a3b9c8ad92c2d78deb660a429796", "message": "fixed incorrect merge", "committedDate": "2020-04-10T13:01:57Z", "type": "commit"}, {"oid": "95808a31aefdb85a2264d3998c927cc874749814", "url": "https://github.com/pytorch/serve/commit/95808a31aefdb85a2264d3998c927cc874749814", "message": "Merge branch 'master' into issue_130", "committedDate": "2020-04-24T08:48:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMDA2Mg==", "url": "https://github.com/pytorch/serve/pull/152#discussion_r418220062", "bodyText": "move \"marName\" to a global name", "author": "mycpuorg", "createdAt": "2020-04-30T18:52:31Z", "path": "frontend/server/src/main/java/org/pytorch/serve/snapshot/SnapshotManager.java", "diffHunk": "@@ -170,12 +144,12 @@ private boolean validate(Snapshot snapshot) throws IOException, InvalidSnapshotE\n         logger.info(\"Validating snapshot {}\", snapshot.getName());\n         String modelStore = configManager.getModelStore();\n \n-        Map<String, Map<String, ModelSnapshot>> models = snapshot.getModels();\n-        for (Map.Entry<String, Map<String, ModelSnapshot>> modelMap : models.entrySet()) {\n+        Map<String, Map<String, JsonObject>> models = snapshot.getModels();\n+        for (Map.Entry<String, Map<String, JsonObject>> modelMap : models.entrySet()) {\n             String modelName = modelMap.getKey();\n-            for (Map.Entry<String, ModelSnapshot> versionModel : modelMap.getValue().entrySet()) {\n+            for (Map.Entry<String, JsonObject> versionModel : modelMap.getValue().entrySet()) {\n                 String versionId = versionModel.getKey();\n-                String marName = versionModel.getValue().getMarName();\n+                String marName = versionModel.getValue().get(\"marName\").getAsString();", "originalCommit": "95808a31aefdb85a2264d3998c927cc874749814", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMDU0NQ==", "url": "https://github.com/pytorch/serve/pull/152#discussion_r418220545", "bodyText": "In general, keep all these const string names to a global location.\nSame here. const strings / prop names to either global location or use getter methods.", "author": "mycpuorg", "createdAt": "2020-04-30T18:53:23Z", "path": "frontend/server/src/main/java/org/pytorch/serve/wlm/Model.java", "diffHunk": "@@ -48,6 +50,28 @@ public Model(ModelArchive modelArchive, int queueSize) {\n                         this.modelArchive.getModelName(), this.modelArchive.getModelVersion());\n     }\n \n+    public JsonObject getModelState(boolean isDefaultVersion) {\n+\n+        JsonObject modelInfo = new JsonObject();\n+        modelInfo.addProperty(\"defaultVersion\", isDefaultVersion);", "originalCommit": "95808a31aefdb85a2264d3998c927cc874749814", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMTA4OQ==", "url": "https://github.com/pytorch/serve/pull/152#discussion_r418221089", "bodyText": "Same here. const strings / prop names to either global location or use getter methods.", "author": "mycpuorg", "createdAt": "2020-04-30T18:54:23Z", "path": "frontend/server/src/main/java/org/pytorch/serve/wlm/ModelManager.java", "diffHunk": "@@ -71,6 +73,29 @@ public ModelArchive registerModel(String url, String defaultModelName)\n                 defaultModelName);\n     }\n \n+    public void registerAndUpdateModel(String modelName, JsonObject modelInfo)\n+            throws ModelException, IOException {\n+\n+        boolean defaultVersion = modelInfo.get(\"defaultVersion\").getAsBoolean();", "originalCommit": "95808a31aefdb85a2264d3998c927cc874749814", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMTUyNg==", "url": "https://github.com/pytorch/serve/pull/152#discussion_r418221526", "bodyText": "Same here. const strings / prop names to either global location or use getter methods.", "author": "mycpuorg", "createdAt": "2020-04-30T18:55:11Z", "path": "frontend/server/src/test/java/org/pytorch/serve/SnapshotTest.java", "diffHunk": "@@ -368,11 +368,11 @@ private void updateSnapshot(Properties prop) {\n         Snapshot snapshot = GSON.fromJson(prop.getProperty(\"model_snapshot\"), Snapshot.class);\n         snapshot.setName(\"snapshot\");\n         snapshot.setCreated(123456);\n-        for (Map.Entry<String, Map<String, ModelSnapshot>> modelMap :\n+        for (Map.Entry<String, Map<String, JsonObject>> modelMap :\n                 snapshot.getModels().entrySet()) {\n-            for (Map.Entry<String, ModelSnapshot> versionModel : modelMap.getValue().entrySet()) {\n-                versionModel.getValue().setMinWorkers(4);\n-                versionModel.getValue().setMaxWorkers(4);\n+            for (Map.Entry<String, JsonObject> versionModel : modelMap.getValue().entrySet()) {\n+                versionModel.getValue().addProperty(\"minWorkers\", 4);", "originalCommit": "95808a31aefdb85a2264d3998c927cc874749814", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ec2533fb4790a62981d02367bf96b31d907adeee", "url": "https://github.com/pytorch/serve/commit/ec2533fb4790a62981d02367bf96b31d907adeee", "message": "Merge branch 'staging_0_1_1' into issue_130", "committedDate": "2020-05-04T11:02:51Z", "type": "commit"}, {"oid": "da4c91be6a9c526ead54b844f3c65b2582606c47", "url": "https://github.com/pytorch/serve/commit/da4c91be6a9c526ead54b844f3c65b2582606c47", "message": "fixed review comments and corrected the error messages", "committedDate": "2020-05-04T18:32:10Z", "type": "commit"}, {"oid": "c6f163851e69c62c68ede486265bcd1d9164cb68", "url": "https://github.com/pytorch/serve/commit/c6f163851e69c62c68ede486265bcd1d9164cb68", "message": "Merge branch 'issue_130' of https://github.com/pytorch/serve into issue_130", "committedDate": "2020-05-04T18:32:49Z", "type": "commit"}, {"oid": "b3da7cdb168f1e1450da0f3386b892b7d54c3318", "url": "https://github.com/pytorch/serve/commit/b3da7cdb168f1e1450da0f3386b892b7d54c3318", "message": "adding remaining fixes for string constants", "committedDate": "2020-05-04T18:45:51Z", "type": "commit"}, {"oid": "5ffb9dd8de9dc5b30f7b9bf41604ac6d8a425a48", "url": "https://github.com/pytorch/serve/commit/5ffb9dd8de9dc5b30f7b9bf41604ac6d8a425a48", "message": "Merge branch 'staging_0_1_1' into issue_130", "committedDate": "2020-05-04T18:47:26Z", "type": "commit"}, {"oid": "0f0fb5e553bef09a62140b8772523de75cfa7fd7", "url": "https://github.com/pytorch/serve/commit/0f0fb5e553bef09a62140b8772523de75cfa7fd7", "message": "Merge branch 'staging_0_1_1' into issue_130", "committedDate": "2020-05-05T03:11:25Z", "type": "commit"}]}