{"pr_number": 265, "pr_title": "updated object detector handler to use only default cuda device for torchvision version less then 0.6", "pr_createdAt": "2020-04-24T07:19:28Z", "pr_url": "https://github.com/pytorch/serve/pull/265", "timeline": [{"oid": "3c4a43cd5bc0621a58c6c7ba288ebc29a7672d1a", "url": "https://github.com/pytorch/serve/commit/3c4a43cd5bc0621a58c6c7ba288ebc29a7672d1a", "message": "updated object detector handler to use default cuda device for torchvision version 0.5.0", "committedDate": "2020-04-24T07:08:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4NDMxNA==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r414884314", "bodyText": "My understanding is that this bug will also strike users on TorchVision 0.4. Could we change this condition to demand a version < 0.6?\nThoughts:\n\nWe don't want to do a string comparison, because that would fail if we get to version 0.10.0.\nI've done some digging, and PyTorch & TorchVision version strings are consistently three integers separated by periods. So if we were to split the version string on the periods, and treat the components like ints, that would look something like:\n\nif major_version <= 0 and minor_version < 6:\n    ...", "author": "fbbradheintz", "createdAt": "2020-04-24T21:52:17Z", "path": "ts/torch_handler/object_detector.py", "diffHunk": "@@ -17,11 +18,12 @@ def __init__(self):\n \n     def initialize(self, ctx):\n         super(VisionHandler, self).initialize(ctx)\n-        self.initialized = False\n-        self.device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")\n-        self.model.to(self.device)\n-        self.model.eval()\n-        self.initialized = True\n+        if torchvision_version == \"0.5.0\":", "originalCommit": "3c4a43cd5bc0621a58c6c7ba288ebc29a7672d1a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM5OTUyMg==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r415399522", "bodyText": "(NB: I don't encourage treating versions strings numerically in the general case, but this is a narrow, bounded case with low risk that serves our need here.)", "author": "fbbradheintz", "createdAt": "2020-04-26T20:58:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4NDMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY1Mjk3OQ==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r415652979", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-04-27T09:23:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4NDMxNA=="}], "type": "inlineReview"}, {"oid": "4fc84e4e614548eadf497260e01ea3ca27de5c73", "url": "https://github.com/pytorch/serve/commit/4fc84e4e614548eadf497260e01ea3ca27de5c73", "message": "updated version check logic", "committedDate": "2020-04-27T09:22:52Z", "type": "commit"}, {"oid": "1e07ca3a812bfd5969cb7cecaf729b9db959ddaf", "url": "https://github.com/pytorch/serve/commit/1e07ca3a812bfd5969cb7cecaf729b9db959ddaf", "message": "Merge branch 'staging_0_1_1' into issue_104", "committedDate": "2020-05-01T05:49:38Z", "type": "commit"}, {"oid": "d1dccf983786dbef39a2fbbe83b5afe8b55fd815", "url": "https://github.com/pytorch/serve/commit/d1dccf983786dbef39a2fbbe83b5afe8b55fd815", "message": "Updated documentation for torchvision version dependency", "committedDate": "2020-05-02T13:15:29Z", "type": "commit"}, {"oid": "00179a546014f89fc6efcdff05d3abed663fd89d", "url": "https://github.com/pytorch/serve/commit/00179a546014f89fc6efcdff05d3abed663fd89d", "message": "enhanced sanity script to validate all default handlers", "committedDate": "2020-05-02T13:17:45Z", "type": "commit"}, {"oid": "da19bc9e0ae3e663fa61954275da00524571fd6f", "url": "https://github.com/pytorch/serve/commit/da19bc9e0ae3e663fa61954275da00524571fd6f", "message": "fixed sanity script", "committedDate": "2020-05-02T14:05:24Z", "type": "commit"}, {"oid": "1371dcdffe4c11ff87d76dcab2eabde41cdcb33b", "url": "https://github.com/pytorch/serve/commit/1371dcdffe4c11ff87d76dcab2eabde41cdcb33b", "message": "Merge branch 'staging_0_1_1' into issue_104", "committedDate": "2020-05-02T14:07:25Z", "type": "commit"}, {"oid": "85ae7ebb9baa97951db4721628e4dcf6e849abaf", "url": "https://github.com/pytorch/serve/commit/85ae7ebb9baa97951db4721628e4dcf6e849abaf", "message": "added torchtext install step in sanity script", "committedDate": "2020-05-02T16:27:18Z", "type": "commit"}, {"oid": "43870c505fa82c29ec18e33ec916e86b35e0b1df", "url": "https://github.com/pytorch/serve/commit/43870c505fa82c29ec18e33ec916e86b35e0b1df", "message": "fixed issue related to inference after restart with snapshot.", "committedDate": "2020-05-02T16:38:46Z", "type": "commit"}, {"oid": "2887399ff26625c9a611c1888d8c79b0c0f644a4", "url": "https://github.com/pytorch/serve/commit/2887399ff26625c9a611c1888d8c79b0c0f644a4", "message": "moved torchtext to codebuild docker files", "committedDate": "2020-05-04T17:35:10Z", "type": "commit"}, {"oid": "1625a6c29beaf97afd0151c740e6e8cd2d2d7c2d", "url": "https://github.com/pytorch/serve/commit/1625a6c29beaf97afd0151c740e6e8cd2d2d7c2d", "message": "Merge branch 'staging_0_1_1' into issue_104", "committedDate": "2020-05-07T02:58:21Z", "type": "commit"}, {"oid": "f1d816d46c696149cb0be727edfe61628c2a40a5", "url": "https://github.com/pytorch/serve/commit/f1d816d46c696149cb0be727edfe61628c2a40a5", "message": "added more log statements", "committedDate": "2020-05-08T07:33:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NzgyMg==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r426787822", "bodyText": "curious, why is this change here?", "author": "mycpuorg", "createdAt": "2020-05-18T17:33:33Z", "path": "codebuild/Dockerfile.cpu", "diffHunk": "@@ -20,7 +20,7 @@\n   RUN update-alternatives --install /usr/bin/python python /usr/bin/python3 1\n   RUN update-alternatives --install /usr/local/bin/pip pip /usr/local/bin/pip3 1\n   \n-  RUN pip install torch torchvision -f https://download.pytorch.org/whl/torch_stable.html\n+  RUN pip install torch torchvision torchtext -f https://download.pytorch.org/whl/torch_stable.html", "originalCommit": "f1d816d46c696149cb0be727edfe61628c2a40a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0NjI0MQ==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r427246241", "bodyText": "As a part of this PR we added changes in the sanity script for validating the object_detector default handler. Later we thought of adding the changes to validate the remaining default handlers as well. For validating the text_classification default handler we needed torchtext installed in the codebuild docker image.", "author": "harshbafna", "createdAt": "2020-05-19T12:00:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0ODM2Mw==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r427248363", "bodyText": "@mycpuorg\nComing to think of it, the new regression suite also validates all the default handlers. This looks like a repetition of work and managing the same regression in two different places.", "author": "harshbafna", "createdAt": "2020-05-19T12:04:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NzgyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4ODAzNg==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r426788036", "bodyText": "Same comment. Docker file changes should not come with this.", "author": "mycpuorg", "createdAt": "2020-05-18T17:33:57Z", "path": "codebuild/Dockerfile.gpu", "diffHunk": "@@ -20,7 +20,7 @@\n   RUN update-alternatives --install /usr/bin/python python /usr/bin/python3 1\n   RUN update-alternatives --install /usr/local/bin/pip pip /usr/local/bin/pip3 1\n   \n-  RUN pip install torch torchvision \n+  RUN pip install torch torchvision torchtext", "originalCommit": "f1d816d46c696149cb0be727edfe61628c2a40a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MzY2NQ==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r426793665", "bodyText": "# models\nmodels=(\"fastrcnn\" \"vgg11\" \"resnet18\" \"waveglow\")\n\n# inputs - ensure length matches models\nmodel_inputs=(\"persons.jpg\" \"television.jpg\" \"kitten.jpg\" \"voice.wav\")\n\nfor i in ${!models[@]};\ndo\n  m=${models[$i]}\n  i=${model_inputs[$i]}\n  register_model \"$m\"\n  run_inference \"$m\" \"$i\"\n  unregister_model \"$m\"\ndone", "author": "mycpuorg", "createdAt": "2020-05-18T17:44:43Z", "path": "torchserve_sanity.sh", "diffHunk": "@@ -135,7 +154,43 @@ mkdir -p model_store\n \n start_torchserve\n \n-register_model\n+# run object detection example\n+\n+register_model \"fastrcnn\"", "originalCommit": "f1d816d46c696149cb0be727edfe61628c2a40a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMxNzg2NQ==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r427317865", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-05-19T13:50:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MzY2NQ=="}], "type": "inlineReview"}, {"oid": "8157973aac55dc69c444980a9915f65663998067", "url": "https://github.com/pytorch/serve/commit/8157973aac55dc69c444980a9915f65663998067", "message": "merged staging branch and resolved conflicts", "committedDate": "2020-05-19T03:48:51Z", "type": "commit"}, {"oid": "cfb38d8153034f525297de3bf06c95b56c4795ce", "url": "https://github.com/pytorch/serve/commit/cfb38d8153034f525297de3bf06c95b56c4795ce", "message": "enhanced run inference function", "committedDate": "2020-05-19T03:49:40Z", "type": "commit"}, {"oid": "47bc7241f3863d4066081b0813bd324efa2321bc", "url": "https://github.com/pytorch/serve/commit/47bc7241f3863d4066081b0813bd324efa2321bc", "message": "Merge branch 'staging_0_1_1' into issue_104", "committedDate": "2020-05-19T03:57:40Z", "type": "commit"}, {"oid": "005f395150d34546c07c9729d0d8bf27db26bc6a", "url": "https://github.com/pytorch/serve/commit/005f395150d34546c07c9729d0d8bf27db26bc6a", "message": "fixed register model function", "committedDate": "2020-05-19T04:00:09Z", "type": "commit"}, {"oid": "35405e9055548ea3d33179aa9f2314d9c7eea550", "url": "https://github.com/pytorch/serve/commit/35405e9055548ea3d33179aa9f2314d9c7eea550", "message": "Merge branch 'issue_104' of https://github.com/pytorch/serve into issue_104", "committedDate": "2020-05-19T04:04:05Z", "type": "commit"}, {"oid": "a90bc413880d77a7a9298caf526f37e1b38c87b9", "url": "https://github.com/pytorch/serve/commit/a90bc413880d77a7a9298caf526f37e1b38c87b9", "message": "added unregister model function", "committedDate": "2020-05-19T04:26:43Z", "type": "commit"}, {"oid": "71c950a215188e97124e61a6915bc906d33566fc", "url": "https://github.com/pytorch/serve/commit/71c950a215188e97124e61a6915bc906d33566fc", "message": "incorporated code review comments", "committedDate": "2020-05-19T13:40:04Z", "type": "commit"}, {"oid": "db723c331e9ee6c7b0254a9e9041c348fda5d110", "url": "https://github.com/pytorch/serve/commit/db723c331e9ee6c7b0254a9e9041c348fda5d110", "message": "Merge branch 'staging_0_1_1' into issue_104", "committedDate": "2020-05-20T05:27:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MzEyMA==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r428953120", "bodyText": "do you really want to remove this?\nWasn't this to verify snapshot resume? Noticed that you are not unregistering resnet for this specific reason, right?", "author": "mycpuorg", "createdAt": "2020-05-21T22:39:09Z", "path": "torchserve_sanity.sh", "diffHunk": "@@ -35,7 +53,7 @@ stop_torchserve\n \n start_torchserve\n \n-run_inference resnet-18 examples/image_classifier/kitten.jpg", "originalCommit": "db723c331e9ee6c7b0254a9e9041c348fda5d110", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAyNzAzOA==", "url": "https://github.com/pytorch/serve/pull/265#discussion_r429027038", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-05-22T03:41:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MzEyMA=="}], "type": "inlineReview"}, {"oid": "fb2bd2fd659fd4d5d639c169f48681b74840df01", "url": "https://github.com/pytorch/serve/commit/fb2bd2fd659fd4d5d639c169f48681b74840df01", "message": "Merge branch 'staging_0_1_1' into issue_104", "committedDate": "2020-05-22T03:08:57Z", "type": "commit"}, {"oid": "5c2e087f866995e655c62279b824689b0a11722d", "url": "https://github.com/pytorch/serve/commit/5c2e087f866995e655c62279b824689b0a11722d", "message": "added back inference call for snapshot test", "committedDate": "2020-05-22T03:41:35Z", "type": "commit"}, {"oid": "c945778e52916e3ed64aae1d9bdc49612466c407", "url": "https://github.com/pytorch/serve/commit/c945778e52916e3ed64aae1d9bdc49612466c407", "message": "fixed if block", "committedDate": "2020-05-22T04:22:39Z", "type": "commit"}, {"oid": "07247f7a855e5cd5757fc856261f2fbc31419c17", "url": "https://github.com/pytorch/serve/commit/07247f7a855e5cd5757fc856261f2fbc31419c17", "message": "Merge branch 'staging_0_1_1' into issue_104", "committedDate": "2020-05-22T18:38:30Z", "type": "commit"}]}