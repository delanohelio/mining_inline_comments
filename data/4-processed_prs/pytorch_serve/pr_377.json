{"pr_number": 377, "pr_title": "Added scripts to build torchserve and torch-model-archiver release wheels", "pr_createdAt": "2020-05-21T09:01:00Z", "pr_url": "https://github.com/pytorch/serve/pull/377", "timeline": [{"oid": "46f3d7dabd062f612eb6f2aa509f785bbd8f0a0e", "url": "https://github.com/pytorch/serve/commit/46f3d7dabd062f612eb6f2aa509f785bbd8f0a0e", "message": "added scripts to build torchserve and torch-model-archiver wheels", "committedDate": "2020-05-21T08:50:19Z", "type": "commit"}, {"oid": "155384646228b8e394e61735b3e09377b5d415ec", "url": "https://github.com/pytorch/serve/commit/155384646228b8e394e61735b3e09377b5d415ec", "message": "Merge branch 'staging_0_1_1' into issue_289", "committedDate": "2020-05-21T09:01:09Z", "type": "commit"}, {"oid": "a445dfb0b0f07ea499878b9834469c11a5de0fca", "url": "https://github.com/pytorch/serve/commit/a445dfb0b0f07ea499878b9834469c11a5de0fca", "message": "Merge branch 'staging_0_1_1' into issue_289", "committedDate": "2020-05-25T11:03:56Z", "type": "commit"}, {"oid": "59943ab1b91fd3adb0834404c67fc25862ced286", "url": "https://github.com/pytorch/serve/commit/59943ab1b91fd3adb0834404c67fc25862ced286", "message": "templatized conda meta.yaml for version", "committedDate": "2020-05-25T14:25:17Z", "type": "commit"}, {"oid": "0f7b0c268ca564e2ede19b2e44a5b806738ea37b", "url": "https://github.com/pytorch/serve/commit/0f7b0c268ca564e2ede19b2e44a5b806738ea37b", "message": "added steps to install dependencies for building wheels", "committedDate": "2020-05-26T12:08:46Z", "type": "commit"}, {"oid": "a195875ec7a4ed8cb6601a3c6c87a0c4885d4646", "url": "https://github.com/pytorch/serve/commit/a195875ec7a4ed8cb6601a3c6c87a0c4885d4646", "message": "updated readme", "committedDate": "2020-05-26T12:09:00Z", "type": "commit"}, {"oid": "880563789b0e3f01c93b9ec09a1529daaf396909", "url": "https://github.com/pytorch/serve/commit/880563789b0e3f01c93b9ec09a1529daaf396909", "message": "corrected path", "committedDate": "2020-05-26T12:13:22Z", "type": "commit"}, {"oid": "5fb5106744147cfa3186510f912b0afa60a359c2", "url": "https://github.com/pytorch/serve/commit/5fb5106744147cfa3186510f912b0afa60a359c2", "message": "generalised install java dep for macos and ubuntu", "committedDate": "2020-05-26T13:09:09Z", "type": "commit"}, {"oid": "729151670771dfbad09f534f023c4e40bca7ef03", "url": "https://github.com/pytorch/serve/commit/729151670771dfbad09f534f023c4e40bca7ef03", "message": "Merge branch 'staging_0_1_1' into issue_289", "committedDate": "2020-05-27T04:44:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI2ODk5Ng==", "url": "https://github.com/pytorch/serve/pull/377#discussion_r431268996", "bodyText": "It's worth adding these version files in this change to start with \"0.1.0\"", "author": "mycpuorg", "createdAt": "2020-05-27T16:14:43Z", "path": "binaries/conda/build_packages.sh", "diffHunk": "@@ -4,12 +4,18 @@ set -eou pipefail\n \n PYTHON_VERSIONS=\"3.6 3.7 3.8\"\n PKGS=\"torchserve torch-model-archiver\"\n+TORCHSERVE_VERSION=`cat ../../ts/version.txt`", "originalCommit": "729151670771dfbad09f534f023c4e40bca7ef03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI3NjYyOQ==", "url": "https://github.com/pytorch/serve/pull/377#discussion_r431276629", "bodyText": "@mycpuorg : version.txt file has already been added for both torchserve and torch-model-archiver as a part of #360 and thus utilizing them in conda's meta.yaml as well.", "author": "harshbafna", "createdAt": "2020-05-27T16:26:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI2ODk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI3NzIyMg==", "url": "https://github.com/pytorch/serve/pull/377#discussion_r431277222", "bodyText": "The version has been marked as 0.1.1 in stage_release branch considering the upcoming release label.\nhttps://github.com/pytorch/serve/blob/staging_0_1_1/model-archiver/model_archiver/version.txt\nhttps://github.com/pytorch/serve/blob/staging_0_1_1/ts/version.txt", "author": "harshbafna", "createdAt": "2020-05-27T16:27:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI2ODk5Ng=="}], "type": "inlineReview"}, {"oid": "2c6bf0d45d780ebd12bb97bc6802612d2feea3e1", "url": "https://github.com/pytorch/serve/commit/2c6bf0d45d780ebd12bb97bc6802612d2feea3e1", "message": "Merge branch 'staging_0_1_1' into issue_289", "committedDate": "2020-05-29T04:47:55Z", "type": "commit"}, {"oid": "5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5", "url": "https://github.com/pytorch/serve/commit/5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5", "message": "Merge branch 'staging_0_1_1' into issue_289", "committedDate": "2020-05-29T06:27:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MjMyMw==", "url": "https://github.com/pytorch/serve/pull/377#discussion_r432692323", "bodyText": "For our shell scripts we prefer to use the $() notation versus back-ticks for executing commands.\nJust to keep things consistent.", "author": "seemethere", "createdAt": "2020-05-29T19:32:45Z", "path": "binaries/conda/build_packages.sh", "diffHunk": "@@ -4,12 +4,18 @@ set -eou pipefail\n \n PYTHON_VERSIONS=\"3.6 3.7 3.8\"\n PKGS=\"torchserve torch-model-archiver\"\n+TORCHSERVE_VERSION=`cat ../../ts/version.txt`", "originalCommit": "5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEwNjk5Ng==", "url": "https://github.com/pytorch/serve/pull/377#discussion_r433106996", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-06-01T08:29:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MjMyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5Mjk2OA==", "url": "https://github.com/pytorch/serve/pull/377#discussion_r432692968", "bodyText": "For this we can actually for-go having to use a template at all and instead prefer to use environment variables here.\nFor reference, this is how we do it for our upstream pytorch conda packages:\npackage:\n  name: pytorch\n  version: \"{{ environ.get('PYTORCH_BUILD_VERSION') }}\"\nhttps://github.com/pytorch/builder/blob/191b23db356f04b7501cfc818c45a1a4db66d7db/conda/pytorch-nightly/meta.yaml#L1-L3", "author": "seemethere", "createdAt": "2020-05-29T19:34:17Z", "path": "binaries/conda/build_packages.sh", "diffHunk": "@@ -4,12 +4,18 @@ set -eou pipefail\n \n PYTHON_VERSIONS=\"3.6 3.7 3.8\"\n PKGS=\"torchserve torch-model-archiver\"\n+TORCHSERVE_VERSION=`cat ../../ts/version.txt`\n+TORCH_MODEL_ARCHIVER_VERSION=`cat ../../model-archiver/model_archiver/version.txt`\n \n for pkg in ${PKGS}; do\n+    PKG_VERSION=$(echo $pkg | tr 'a-z' 'A-Z' | tr '-' '_')_VERSION\n+    cat $pkg/meta.yaml.tmpl | sed -e \"s/{version}/$PKG_VERSION/\" >> $pkg/meta.yaml", "originalCommit": "5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEwNzA2Mw==", "url": "https://github.com/pytorch/serve/pull/377#discussion_r433107063", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-06-01T08:30:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5Mjk2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MzUyMQ==", "url": "https://github.com/pytorch/serve/pull/377#discussion_r432693521", "bodyText": "To make it so that cleanup is always run, regardless of where you exit in the script you can use a trap, see https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_12_02.html", "author": "seemethere", "createdAt": "2020-05-29T19:35:34Z", "path": "binaries/pip/build_wheels.sh", "diffHunk": "@@ -0,0 +1,50 @@\n+#!/usr/bin/env bash\n+\n+set -eou pipefail\n+\n+source ../../scripts/install_utils\n+\n+cleanup()\n+{\n+  rm -rf dist\n+  rm -rf build\n+  rm -rf *.egg-info\n+}\n+\n+create_torchserve_wheel()\n+{\n+  cd ../../\n+\n+  python setup.py bdist_wheel --release --universal\n+\n+  cp dist/*.whl binaries/pip/output/\n+\n+  cleanup\n+\n+  cd -\n+}\n+\n+create_model_archiver_wheel()\n+{\n+  cd ../../model-archiver\n+\n+  python setup.py bdist_wheel --release --universal\n+\n+  cp dist/*.whl ../binaries/pip/output/\n+\n+  cleanup", "originalCommit": "5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4NTg3NQ==", "url": "https://github.com/pytorch/serve/pull/377#discussion_r433285875", "bodyText": "Done.", "author": "harshbafna", "createdAt": "2020-06-01T14:58:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MzUyMQ=="}], "type": "inlineReview"}, {"oid": "10d6977dd687d188b53a1db385c6f59847987883", "url": "https://github.com/pytorch/serve/commit/10d6977dd687d188b53a1db385c6f59847987883", "message": "replaced template files with environment variables", "committedDate": "2020-06-01T06:05:48Z", "type": "commit"}, {"oid": "7c118ba26b7bc6e1286be36f9b65b101306590c6", "url": "https://github.com/pytorch/serve/commit/7c118ba26b7bc6e1286be36f9b65b101306590c6", "message": "Merge branch 'staging_0_1_1' into issue_289", "committedDate": "2020-06-01T08:34:16Z", "type": "commit"}, {"oid": "3447dcb8a48822b52fa5e896fbbfb2bad56b06ab", "url": "https://github.com/pytorch/serve/commit/3447dcb8a48822b52fa5e896fbbfb2bad56b06ab", "message": "added traps for cleanup", "committedDate": "2020-06-01T14:58:14Z", "type": "commit"}, {"oid": "1ced453d0e46e8eed7b8099a1871bc32c921c278", "url": "https://github.com/pytorch/serve/commit/1ced453d0e46e8eed7b8099a1871bc32c921c278", "message": "Merge branch 'issue_289' of https://github.com/pytorch/serve into issue_289", "committedDate": "2020-06-01T14:59:44Z", "type": "commit"}, {"oid": "1fef43d4859fb17ea72f51e8e4b6c888080ace06", "url": "https://github.com/pytorch/serve/commit/1fef43d4859fb17ea72f51e8e4b6c888080ace06", "message": "Merge branch 'staging_0_1_1' into issue_289", "committedDate": "2020-06-06T03:15:22Z", "type": "commit"}, {"oid": "437ac963ff6e38a4f3cacdf36e065e438682a2f7", "url": "https://github.com/pytorch/serve/commit/437ac963ff6e38a4f3cacdf36e065e438682a2f7", "message": "Merge branch 'staging_0_1_1' into issue_289", "committedDate": "2020-06-10T03:02:23Z", "type": "commit"}, {"oid": "e68d6b86cc9f7a49db758c2bc163df9e522b4488", "url": "https://github.com/pytorch/serve/commit/e68d6b86cc9f7a49db758c2bc163df9e522b4488", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-06-19T06:12:29Z", "type": "commit"}, {"oid": "5a6c2401eb7266263ede837d425221b12479b0ad", "url": "https://github.com/pytorch/serve/commit/5a6c2401eb7266263ede837d425221b12479b0ad", "message": "rebased to master", "committedDate": "2020-06-19T06:14:27Z", "type": "commit"}, {"oid": "208c18040bea247865f2f1a8bde90d453ef6b038", "url": "https://github.com/pytorch/serve/commit/208c18040bea247865f2f1a8bde90d453ef6b038", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-06-26T05:03:51Z", "type": "commit"}, {"oid": "f157f32eccc8ac4ecd97025a98a14e0656ca00d0", "url": "https://github.com/pytorch/serve/commit/f157f32eccc8ac4ecd97025a98a14e0656ca00d0", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-06-26T10:41:42Z", "type": "commit"}, {"oid": "df42a92d7f00ef2bf4ee9af3ed15a94fed627ce7", "url": "https://github.com/pytorch/serve/commit/df42a92d7f00ef2bf4ee9af3ed15a94fed627ce7", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-07-03T08:20:50Z", "type": "commit"}, {"oid": "6c61587a72559fca9ddf43d6eeea4fbe14e79707", "url": "https://github.com/pytorch/serve/commit/6c61587a72559fca9ddf43d6eeea4fbe14e79707", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-07-07T03:28:14Z", "type": "commit"}, {"oid": "f9264f7530914991927f746800ff5a1535ba8d10", "url": "https://github.com/pytorch/serve/commit/f9264f7530914991927f746800ff5a1535ba8d10", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-07-08T04:02:27Z", "type": "commit"}, {"oid": "ea35877bd35870f23647507f055f9e76002f422a", "url": "https://github.com/pytorch/serve/commit/ea35877bd35870f23647507f055f9e76002f422a", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-07-15T05:47:42Z", "type": "commit"}, {"oid": "058c6b952d93cc325ca48f3b2b3e0bd9a1aa2fc9", "url": "https://github.com/pytorch/serve/commit/058c6b952d93cc325ca48f3b2b3e0bd9a1aa2fc9", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-07-18T01:56:52Z", "type": "commit"}, {"oid": "c43c757a877b402d8ebbe543906664720e57d651", "url": "https://github.com/pytorch/serve/commit/c43c757a877b402d8ebbe543906664720e57d651", "message": "merged master and resolved conficts", "committedDate": "2020-07-22T13:05:21Z", "type": "commit"}, {"oid": "2e1f8f848e15fed2164f3194722ff2c68e2c32f9", "url": "https://github.com/pytorch/serve/commit/2e1f8f848e15fed2164f3194722ff2c68e2c32f9", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-07-22T15:07:01Z", "type": "commit"}, {"oid": "3fd03846b3445604d5726e90b4b6c1e1f18fbe61", "url": "https://github.com/pytorch/serve/commit/3fd03846b3445604d5726e90b4b6c1e1f18fbe61", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-07-23T16:20:14Z", "type": "commit"}, {"oid": "c4f106c2acf32f4bfcc629a9c1df1ac1ce9e975a", "url": "https://github.com/pytorch/serve/commit/c4f106c2acf32f4bfcc629a9c1df1ac1ce9e975a", "message": "Merge branch 'master' into issue_289", "committedDate": "2020-07-23T17:58:37Z", "type": "commit"}]}