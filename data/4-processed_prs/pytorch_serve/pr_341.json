{"pr_number": 341, "pr_title": "fixed code for build failure in python virtual environment", "pr_createdAt": "2020-05-13T07:38:34Z", "pr_url": "https://github.com/pytorch/serve/pull/341", "timeline": [{"oid": "53f686cca43a1640885db12b836d563f3152d618", "url": "https://github.com/pytorch/serve/commit/53f686cca43a1640885db12b836d563f3152d618", "message": "fixed code for build failure in python virtual environment", "committedDate": "2020-05-13T07:37:55Z", "type": "commit"}, {"oid": "a2958bc07a52018b57e9866dd1471b5ae1e342a8", "url": "https://github.com/pytorch/serve/commit/a2958bc07a52018b57e9866dd1471b5ae1e342a8", "message": "Merge branch 'staging_0_1_1' into issue_340", "committedDate": "2020-05-17T13:49:26Z", "type": "commit"}, {"oid": "11adf0e0d4ce8a4f681f6ff3152c596dcb74e250", "url": "https://github.com/pytorch/serve/commit/11adf0e0d4ce8a4f681f6ff3152c596dcb74e250", "message": "Merge branch 'staging_0_1_1' into issue_340", "committedDate": "2020-05-19T04:00:45Z", "type": "commit"}, {"oid": "b6a7b2593ac04239d3adce9f03a2ea2b148d1a44", "url": "https://github.com/pytorch/serve/commit/b6a7b2593ac04239d3adce9f03a2ea2b148d1a44", "message": "Merge branch 'staging_0_1_1' into issue_340", "committedDate": "2020-05-20T19:36:41Z", "type": "commit"}, {"oid": "095ebd482f1f1b7c8353ef1531ba75cddb909b1d", "url": "https://github.com/pytorch/serve/commit/095ebd482f1f1b7c8353ef1531ba75cddb909b1d", "message": "Merge branch 'staging_0_1_1' into issue_340", "committedDate": "2020-05-22T04:33:03Z", "type": "commit"}, {"oid": "41b1b58fa37aa6536b79fc6e4cd879dd843c9f36", "url": "https://github.com/pytorch/serve/commit/41b1b58fa37aa6536b79fc6e4cd879dd843c9f36", "message": "added exception missed on resolving conflicts", "committedDate": "2020-05-22T04:38:53Z", "type": "commit"}, {"oid": "60340d6340bc19e742d8c349de81f8df9c2b534a", "url": "https://github.com/pytorch/serve/commit/60340d6340bc19e742d8c349de81f8df9c2b534a", "message": "Merge branch 'issue_340' of https://github.com/pytorch/serve into issue_340", "committedDate": "2020-05-22T04:39:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3MDk0Nw==", "url": "https://github.com/pytorch/serve/pull/341#discussion_r429370947", "bodyText": "Seems like we are repeating this code. This logic exists in WorkerLifeCycle.java as well. We could probably pull this logic of pulling environtment variables and filtering out blacklisted environment variables into a util file and use the methods here and in workerlifecycle.", "author": "vdantu", "createdAt": "2020-05-22T17:30:55Z", "path": "frontend/server/src/main/java/org/pytorch/serve/metrics/MetricCollector.java", "diffHunk": "@@ -40,23 +42,37 @@ public void run() {\n             String pythonEnv;\n             if ((pythonPath == null || pythonPath.isEmpty())\n                     && (!workingDir.getAbsolutePath().contains(\"site-package\"))) {\n-                pythonEnv = \"PYTHONPATH=\" + workingDir.getAbsolutePath();\n+                pythonEnv = workingDir.getAbsolutePath();\n             } else {\n-                pythonEnv = \"PYTHONPATH=\" + pythonPath;\n+                pythonEnv = pythonPath;\n                 if (!workingDir.getAbsolutePath().contains(\"site-package\")) {\n                     pythonEnv += File.pathSeparatorChar + workingDir.getAbsolutePath(); // NOPMD\n                 }\n             }\n             // sbin added for macs for python sysctl pythonpath\n+            HashMap<String, String> environment = new HashMap<>(System.getenv());\n+            environment.put(\"PYTHONPATH\", pythonEnv);\n+\n             StringBuilder path = new StringBuilder();\n-            path.append(\"PATH=\").append(System.getenv(\"PATH\"));\n+            path.append(System.getenv(\"PATH\"));\n             String osName = System.getProperty(\"os.name\");\n             if (osName.startsWith(\"Mac OS X\")) {\n                 path.append(File.pathSeparatorChar).append(\"/sbin/\");\n             }\n-            String[] env = {pythonEnv, path.toString()};\n-            final Process p = Runtime.getRuntime().exec(args, env, workingDir);\n \n+            environment.put(\"PATH\", path.toString());\n+            ArrayList<String> envList = new ArrayList<>();\n+            Pattern blackList = configManager.getBlacklistPattern();\n+\n+            for (Map.Entry<String, String> entry : environment.entrySet()) {", "originalCommit": "60340d6340bc19e742d8c349de81f8df9c2b534a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQxNDI4NA==", "url": "https://github.com/pytorch/serve/pull/341#discussion_r429414284", "bodyText": "@harshbafna @vdantu Merging this for now. Created #386 to refactor this to a utils class", "author": "maaquib", "createdAt": "2020-05-22T19:12:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3MDk0Nw=="}], "type": "inlineReview"}, {"oid": "375ee197158338301eeeb117e1053076c440f818", "url": "https://github.com/pytorch/serve/commit/375ee197158338301eeeb117e1053076c440f818", "message": "Merge branch 'staging_0_1_1' into issue_340", "committedDate": "2020-05-22T17:54:36Z", "type": "commit"}]}