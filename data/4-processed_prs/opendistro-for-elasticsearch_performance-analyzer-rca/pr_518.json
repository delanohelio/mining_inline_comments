{"pr_number": 518, "pr_title": "Add a class that makes testing MetricsCollectors easier", "pr_createdAt": "2020-11-18T17:59:39Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/518", "timeline": [{"oid": "bb021d42646599860101c389f480de3d12064b30", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/bb021d42646599860101c389f480de3d12064b30", "message": "Add a class that makes testing MetricsCollectors easier\n\nThe AbstractCollectorTest class can be extended to validate the behavior\nof any PerformanceAnalyzerMetricsCollector.", "committedDate": "2020-11-18T17:56:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMyMTU1MA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/518#discussion_r526321550", "bodyText": "Is this comment relevant ?", "author": "yojs", "createdAt": "2020-11-18T18:22:23Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/collectors/AbstractCollectorTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.collectors;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.PerformanceAnalyzerMetrics;\n+import java.time.Instant;\n+import org.junit.Test;\n+\n+/**\n+ * A base class that others can extend to validate their Metrics Collectors behavior\n+ */\n+public abstract class AbstractCollectorTest {\n+  private PerformanceAnalyzerMetricsCollector uut;\n+\n+  // Implementors should call this in a setup() function to set their collector\n+  public void setUut(PerformanceAnalyzerMetricsCollector collector) {\n+    this.uut = collector;\n+  }\n+\n+  // This is the only line that implementors need to modify\n+  public abstract void validateMetric(String metric) throws Exception;\n+\n+  // This function does not need to be modified", "originalCommit": "bb021d42646599860101c389f480de3d12064b30", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMyNDY3NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/518#discussion_r526324675", "bodyText": "why not end == -1 ?", "author": "ktkrg", "createdAt": "2020-11-18T18:27:21Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/collectors/AbstractCollectorTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.collectors;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.metrics.PerformanceAnalyzerMetrics;\n+import java.time.Instant;\n+import org.junit.Test;\n+\n+/**\n+ * A base class that others can extend to validate their Metrics Collectors behavior\n+ */\n+public abstract class AbstractCollectorTest {\n+  private PerformanceAnalyzerMetricsCollector uut;\n+\n+  // Implementors should call this in a setup() function to set their collector\n+  public void setUut(PerformanceAnalyzerMetricsCollector collector) {\n+    this.uut = collector;\n+  }\n+\n+  // This is the only line that implementors need to modify\n+  public abstract void validateMetric(String metric) throws Exception;\n+\n+  // This function does not need to be modified\n+  @Test\n+  public void validateMetrics() throws Exception {\n+    uut.collectMetrics(Instant.now().toEpochMilli());\n+    String metricString = uut.getValue().toString();\n+    // chop off current time json\n+    int end = metricString.indexOf(PerformanceAnalyzerMetrics.sMetricNewLineDelimitor);\n+    metricString = metricString.substring(end+1);\n+    while (!metricString.isEmpty()) {\n+      end = metricString.indexOf(PerformanceAnalyzerMetrics.sMetricNewLineDelimitor);\n+      if (end < 0) {", "originalCommit": "bb021d42646599860101c389f480de3d12064b30", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "69b747dc4f1475632fdc6b18abfeeee5abbf4a3c", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/69b747dc4f1475632fdc6b18abfeeee5abbf4a3c", "message": "Fix checkstyle issues", "committedDate": "2020-11-20T15:03:54Z", "type": "commit"}, {"oid": "2a08361d8dcc5a85eed80502ff29c687dad18794", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/2a08361d8dcc5a85eed80502ff29c687dad18794", "message": "Address comments", "committedDate": "2020-11-20T17:07:24Z", "type": "commit"}, {"oid": "e835ea371e4f51aee73608375c4028f249a9d4fc", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/e835ea371e4f51aee73608375c4028f249a9d4fc", "message": "Slight modifications to collectors to make them more testable", "committedDate": "2020-11-20T17:09:38Z", "type": "commit"}, {"oid": "0403a01df3918847796aeeb601f2bea254b59237", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/0403a01df3918847796aeeb601f2bea254b59237", "message": "Add stub tests for several collectors", "committedDate": "2020-11-20T17:10:48Z", "type": "commit"}, {"oid": "9412b07d93b7e2461601c53359e444ebe7f41190", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/9412b07d93b7e2461601c53359e444ebe7f41190", "message": "Fix checkstyle issues", "committedDate": "2020-11-20T17:17:34Z", "type": "commit"}, {"oid": "e3b25a01491e242d94829464438cf3b6cef87904", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/e3b25a01491e242d94829464438cf3b6cef87904", "message": "Fix Jackaon serialization issues", "committedDate": "2020-12-11T18:14:49Z", "type": "commit"}, {"oid": "6f50381fd4adf364ecdddccc66afcca3f6c35da9", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/6f50381fd4adf364ecdddccc66afcca3f6c35da9", "message": "Fix method naming for Jackson serialization\n\n- Rename TCPStatus#getSSThresh to TCPStatus#getSsThresh to make Jackson\nserialization work out of the box", "committedDate": "2020-12-23T18:13:41Z", "type": "commit"}, {"oid": "2aa57d35b4c3402e6342b72d522f84089878486c", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/2aa57d35b4c3402e6342b72d522f84089878486c", "message": "Fixup NetworkE2ECollectorTest", "committedDate": "2021-01-13T18:07:38Z", "type": "commit"}, {"oid": "7b24a86ff41f659fc48ac5203ede37b59986a83a", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/7b24a86ff41f659fc48ac5203ede37b59986a83a", "message": "Fix one liner error", "committedDate": "2021-01-13T18:10:09Z", "type": "commit"}]}