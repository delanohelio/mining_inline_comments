{"pr_number": 183, "pr_title": "Reader UT coverage bumped to 80%", "pr_createdAt": "2020-05-05T07:00:22Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183", "timeline": [{"oid": "ee1baf9ce581f553204198df8af22967ff05d2b9", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/ee1baf9ce581f553204198df8af22967ff05d2b9", "message": "Reader UT coverage bumped to 80%\n\n* Enabled tests which were disabled and not flaky\n\n* Changed the file reading format in the MetricProcessor Tests\n\n* Refactored the class MetricsParser which is not used anymore.", "committedDate": "2020-05-05T06:15:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAyMzUyNA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183#discussion_r421023524", "bodyText": "Maybe instead of adding to the selected includes, we should remove the include list ? That will put the entire repo through coverage validation (modulo the excludes).", "author": "yojs", "createdAt": "2020-05-06T19:02:18Z", "path": "build.gradle", "diffHunk": "@@ -123,7 +123,8 @@ jacocoTestReport {\n         classDirectories.from = files(classDirectories.files.collect {\n             fileTree(dir: it,\n                     include: [\n-                            '**/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/**'\n+                            '**/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/**',\n+                            '**/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/**'", "originalCommit": "ee1baf9ce581f553204198df8af22967ff05d2b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk4NTA0Mw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183#discussion_r421985043", "bodyText": "I have updated it to generate test reports for the entire repo. But this wouldn't validate if the coverage is above 80%. We don't have the coverage of entire repo above 80%. It is currently at around 60%.", "author": "aditjind", "createdAt": "2020-05-08T07:18:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAyMzUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQxNDMzNQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183#discussion_r422414335", "bodyText": "Which repos lack UTs ? Can you create an issue to track this ?", "author": "yojs", "createdAt": "2020-05-08T23:09:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAyMzUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyMjE0MA==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183#discussion_r422422140", "bodyText": "#189", "author": "aditjind", "createdAt": "2020-05-08T23:48:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAyMzUyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE5MTg3NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183#discussion_r421191875", "bodyText": "Why are we not using MetricsParesr.extractEntryData ?", "author": "yojs", "createdAt": "2020-05-07T01:48:47Z", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ReaderMetricsProcessor.java", "diffHunk": "@@ -739,6 +737,29 @@ public void emitNodeMetrics(long currWindowStartTime, MetricsDB metricsDB) throw\n     }\n   }\n \n+  /**\n+   * An example value is this: current_time:1566413987194 StartTime:1566413987194 ItemCount:359\n+   * IndexName:nyc_taxis ShardID:25 Primary:true Each pair is separated by new line and the key and\n+   * value within each pair is separated by \":\" This function just parses the string and generates\n+   * the map as such.\n+   *\n+   * @param eventValue The value input to the helper function.\n+   * @return Returns a map of key value pairs\n+   */\n+  static Map<String, String> extractEntryData(String eventValue) {\n+    String[] lines = eventValue.split(System.lineSeparator());", "originalCommit": "ee1baf9ce581f553204198df8af22967ff05d2b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMwOTg1MQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183#discussion_r421309851", "bodyText": "I have removed the file MetricsParser.java altogether. None of the functions in it were being used and only this method was being used in a few places.", "author": "aditjind", "createdAt": "2020-05-07T07:54:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE5MTg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3NzE5NQ==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183#discussion_r421677195", "bodyText": "Awesome !", "author": "yojs", "createdAt": "2020-05-07T17:37:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE5MTg3NQ=="}], "type": "inlineReview"}, {"oid": "b6f4c99f36f67a9e34287b2f262a3e6de3c5d3f7", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/b6f4c99f36f67a9e34287b2f262a3e6de3c5d3f7", "message": "Updating to Generate UTs Coverage Report for all packages", "committedDate": "2020-05-08T07:14:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQxODY3Mg==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183#discussion_r422418672", "bodyText": "nit: Maybe make this an instance variable, or initialize this in before() so that you don't have to do this on every test case.", "author": "ktkrg", "createdAt": "2020-05-08T23:30:11Z", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ReaderMetricsProcessorTests.java", "diffHunk": "@@ -44,39 +44,52 @@ public ReaderMetricsProcessorTests() throws SQLException, ClassNotFoundException\n     super();\n   }\n \n-  // Disabled on purpose\n-  // @Test\n-  public void testReaderMetricsProcessor() throws Exception {\n-    String rootLocation = \"build/private/test_resources/dev/shm\";\n+  @Test\n+  public void testReaderMetricsProcessorFrequently() throws Exception {\n+    String rootLocation = \"build/resources/test/reader/\";", "originalCommit": "b6f4c99f36f67a9e34287b2f262a3e6de3c5d3f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk1MTU4Nw==", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/183#discussion_r422951587", "bodyText": "I have updated that in the latest version.", "author": "aditjind", "createdAt": "2020-05-11T10:46:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQxODY3Mg=="}], "type": "inlineReview"}, {"oid": "9ef3e9a990df58ed6fbea1ce1714f075a8388c57", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/9ef3e9a990df58ed6fbea1ce1714f075a8388c57", "message": "Addressing CR Comments", "committedDate": "2020-05-11T10:30:15Z", "type": "commit"}]}