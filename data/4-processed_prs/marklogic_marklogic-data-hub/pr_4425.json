{"pr_number": 4425, "pr_title": "DHFPROD-5372: Handle strings and null values correctly in mapping source", "pr_createdAt": "2020-08-18T05:12:18Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4425", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEwOTk3OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4425#discussion_r472109978", "bodyText": "This is fine, but the backend should really provide all of this data - for 5.4, we've gotta do a better job of shifting more of the burden to the backend so that life is as easy as possible for the UI.", "author": "rjrudin", "createdAt": "2020-08-18T11:33:56Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -203,8 +203,10 @@ const MappingCard: React.FC<Props> = (props) => {\n                 let parsedDoc: any;\n                 if(typeof(srcDocResp.data) === 'string'){\n                     parsedDoc = getParsedXMLDoc(srcDocResp);\n+                    setSourceFormat('xml');", "originalCommit": "a9de1b1b64346ae83712275e94818ba444baee9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM4ODU2MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4425#discussion_r472388560", "bodyText": "Agreed, it would be better to have the backend tell the front end the source format explicitly.", "author": "wooldridge", "createdAt": "2020-08-18T18:11:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEwOTk3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI5NzQyNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4425#discussion_r472297426", "bodyText": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray", "author": "jmakeig", "createdAt": "2020-08-18T15:46:08Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -368,7 +378,7 @@ const MappingCard: React.FC<Props> = (props) => {\n                     if(parentNamespace !== tempNS){\n                         parentNamespace = tempNS;\n                     }\n-                } else if (val.constructor.name === \"Array\") {\n+                } else if (val && val.constructor && val.constructor.name === \"Array\") {", "originalCommit": "a9de1b1b64346ae83712275e94818ba444baee9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQwNjE1OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4425#discussion_r472406158", "bodyText": "Thanks, updated with latest force-push.", "author": "wooldridge", "createdAt": "2020-08-18T18:44:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI5NzQyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI5ODQzNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4425#discussion_r472298435", "bodyText": "\ud83d\udc4d\ud83c\udffd", "author": "jmakeig", "createdAt": "2020-08-18T15:47:34Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.scss", "diffHunk": "@@ -7,3 +7,14 @@\n .ant-table-filter-icon.ant-dropdown-trigger.ant-table-filter-selected{\n     background: #394494; \n }\n+\n+.datatype-string::before {", "originalCommit": "a9de1b1b64346ae83712275e94818ba444baee9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM0MDQ3MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4425#discussion_r472340471", "bodyText": "@wooldridge can we pls also add a test for white space here.", "author": "bsrikan", "createdAt": "2020-08-18T16:52:23Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.test.tsx", "diffHunk": "@@ -29,14 +29,25 @@ describe('RTL Source-to-entity map tests', () => {\n     });\n \n     test('RTL tests with source data',  () => {\n-        const { getByTestId,  getByText, queryByText, rerender} = render(<SourceToEntityMap {...data.mapProps} mappingVisible={true}/>);\n+        const { getByTestId,  getByText, queryByText, rerender } = render(<SourceToEntityMap {...data.mapProps} mappingVisible={true}/>);\n         expect(getByText('Source Data')).toBeInTheDocument();\n         expect(getByText('proteinId')).toBeInTheDocument();\n+        expect(getByText('emptyString')).toBeInTheDocument();\n+        expect(getByText('nullValue')).toBeInTheDocument();\n+        expect(getByText('numberValue')).toBeInTheDocument();\n+        expect(getByText('booleanValue')).toBeInTheDocument();\n         expect(getByTestId(\"entityContainer\")).toBeInTheDocument();\n         expect(getByTestId(\"srcContainer\")).toBeInTheDocument();\n         expect(getByTestId(\"srcContainer\")).toHaveClass(\"sourceContainer\");\n         expect(getByText('Entity: Person')).toBeInTheDocument();\n         expect(getByText('Test')).toBeEnabled();\n+\n+        // Check datatype class names for source values\n+        expect(getByTestId(\"emptyString-srcValue\").children[0].className.includes('datatype-string')).toBe(true);\n+        expect(getByTestId(\"nullValue-srcValue\").children[0].className.includes('datatype-null')).toBe(true);\n+        expect(getByTestId(\"numberValue-srcValue\").children[0].className.includes('datatype-number')).toBe(true);\n+        expect(getByTestId(\"booleanValue-srcValue\").children[0].className.includes('datatype-boolean')).toBe(true);", "originalCommit": "a9de1b1b64346ae83712275e94818ba444baee9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQwNjM1NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4425#discussion_r472406355", "bodyText": "Thanks, added test for whitespace with latest force-push.", "author": "wooldridge", "createdAt": "2020-08-18T18:44:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM0MDQ3MQ=="}], "type": "inlineReview"}, {"oid": "ac1c1b061ebbba3632a9ef4c0233ba96c6fdba1b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/ac1c1b061ebbba3632a9ef4c0233ba96c6fdba1b", "message": "DHFPROD-5372: Handle strings and null values correctly in mapping source\n\n- Strings surrounded with double quotes\n- Properties equal to null or \"\" are displayed in source table\n- Properties equal to null or \"\" are displayed correctly in source dropdown in entity table", "committedDate": "2020-08-18T18:43:10Z", "type": "commit"}, {"oid": "ac1c1b061ebbba3632a9ef4c0233ba96c6fdba1b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/ac1c1b061ebbba3632a9ef4c0233ba96c6fdba1b", "message": "DHFPROD-5372: Handle strings and null values correctly in mapping source\n\n- Strings surrounded with double quotes\n- Properties equal to null or \"\" are displayed in source table\n- Properties equal to null or \"\" are displayed correctly in source dropdown in entity table", "committedDate": "2020-08-18T18:43:10Z", "type": "forcePushed"}]}