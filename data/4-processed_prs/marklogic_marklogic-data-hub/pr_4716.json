{"pr_number": 4716, "pr_title": "DHFPROD-4659: Visualize metadata of the document in card view.", "pr_createdAt": "2020-10-13T19:49:44Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4716", "timeline": [{"oid": "68085e390ba3e53549961e51b27d74e8f465ac35", "url": "https://github.com/marklogic/marklogic-data-hub/commit/68085e390ba3e53549961e51b27d74e8f465ac35", "message": "DHFPROD-4659: Visualize metadata of the document in card view", "committedDate": "2020-10-13T19:53:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI0ODU0NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#discussion_r504248545", "bodyText": "Can this be RecordCardView?", "author": "rahulvudutala", "createdAt": "2020-10-13T20:47:01Z", "path": "marklogic-data-hub-central/ui/src/components/record-view/record-view.test.tsx", "diffHunk": "@@ -1,13 +1,13 @@\n import React from 'react';\n import { render, fireEvent, waitForElement } from '@testing-library/react';\n-import { entitySearch } from \"../../../assets/mock-data/explore/entity-search\";\n+import { entitySearch } from \"../../assets/mock-data/explore/entity-search\";\n import { BrowserRouter as Router } from 'react-router-dom';\n-import RawDataCardView from './raw-data-card-view';\n+import RawDataCardView from './record-view';", "originalCommit": "68085e390ba3e53549961e51b27d74e8f465ac35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI0OTkxOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#discussion_r504249919", "bodyText": "Renamed. Thanks.", "author": "timur-isangulov", "createdAt": "2020-10-13T20:49:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI0ODU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1MTc5NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#discussion_r504251795", "bodyText": "Its still RawDataCardView", "author": "rahulvudutala", "createdAt": "2020-10-13T20:53:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI0ODU0NQ=="}], "type": "inlineReview"}, {"oid": "e814d8686534a3f8ee6b244d53d5590816df97d1", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e814d8686534a3f8ee6b244d53d5590816df97d1", "message": "DHFPROD-4659: Visualize metadata of the document in card view", "committedDate": "2020-10-13T20:49:11Z", "type": "forcePushed"}, {"oid": "a3ca5818bfd31ef80d8b0785f8a9fee9ba323ba5", "url": "https://github.com/marklogic/marklogic-data-hub/commit/a3ca5818bfd31ef80d8b0785f8a9fee9ba323ba5", "message": "DHFPROD-4659: Visualize metadata of the document in card view", "committedDate": "2020-10-13T20:51:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1MjY1MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#discussion_r504252651", "bodyText": "Can we rename it to RecordCardView?", "author": "rahulvudutala", "createdAt": "2020-10-13T20:54:48Z", "path": "marklogic-data-hub-central/ui/src/components/record-view/record-view.tsx", "diffHunk": "@@ -0,0 +1,147 @@\n+import React, { CSSProperties, useContext } from 'react';\n+import styles from './record-view.module.scss';\n+import { Card, Icon, Row, Col, Popover } from 'antd';\n+import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n+import { faExternalLinkAlt } from '@fortawesome/free-solid-svg-icons';\n+import { AuthoritiesContext } from \"../../util/authorities\";\n+import { formatCardUri } from '../../util/conversionFunctions';\n+import sourceFormatOptions from '../../config/formats.config';\n+import ReactHtmlParser from 'react-html-parser';\n+import { FileOutlined } from '@ant-design/icons';\n+import { OverflowTooltip } from '../overflow-tooltip/overflow-tooltip';\n+import { MLTooltip, MLPopover } from '@marklogic/design-system';\n+import { CardViewDateConverter } from '../../util/date-conversion';\n+\n+const RawDataCardView = (props) => {\n+  const authorityService = useContext(AuthoritiesContext);\n+\n+  const handleDetailViewNavigation = () => {\n+  }\n+\n+  // Custom CSS for source Format\n+  const sourceFormatStyle = (sourceFmt) => {\n+    let customStyles: CSSProperties = {\n+      display: 'inline-flex',\n+      alignItems: 'center',\n+      justifyContent: 'center',\n+      height: '20px',\n+      width: '20px',\n+      lineHeight: '20px',\n+      backgroundColor: sourceFormatOptions[sourceFmt].color,\n+      fontSize: sourceFmt === 'json' ? '8px' : '8.5px',\n+      borderRadius: '50%',\n+      textAlign: 'center',\n+      color: '#ffffff',\n+      verticalAlign: 'middle',\n+      marginRight: '8px'\n+    }\n+    return customStyles;\n+  }\n+\n+  const displayUri = (uri) => {\n+    return formatCardUri(uri);\n+  }\n+\n+  const displaySnippet = (item) => {\n+    if (['json', 'xml', 'text'].includes(item.format)) {\n+      let str = '';\n+      item.matches.forEach(item => {\n+        item['match-text'].forEach(element => {\n+          if (typeof element === 'object') {\n+            str = str.concat('<b>').concat(element.highlight).concat('</b>').concat('...');\n+          } else {\n+            str = str.concat(element);\n+          }\n+        });\n+      })\n+      return <p>{ReactHtmlParser(str)}</p>;\n+    } else if ('binary' === item.format) {\n+      return (\n+        <div className={styles.binaryCard} >\n+          <FileOutlined className={styles.binaryIcon} />\n+          <div className={styles.binaryText} data-testid={item.uri + '-noPreview'}> No preview available</div>\n+        </div>\n+      )\n+    }\n+  }\n+\n+  const displayRecordSources = (item) => {\n+    let sources = item.hubMetadata?.sources.map((record) => {\n+      return record.name;\n+    }).join(\", \");\n+    return sources;\n+  }\n+\n+  const emptyField = (\n+    <p className={styles.textDisabled}>none</p>\n+  )\n+\n+  const displayRecordMetadata = (item) => {\n+    return (\n+      <div className={styles.popover} data-testid={item.uri + '-popover'}>\n+        <div className={styles.colKey}>\n+          <p>Source:</p>\n+          <p>Flow:</p>\n+          <p>Step:</p>\n+          <p>Created On:</p>\n+        </div>\n+        <div className={styles.colValue}>\n+          {item.hubMetadata?.sources?.length > 0 ? <span className={styles.valText} data-testid={item.uri + '-sources'}>\n+            <OverflowTooltip title={displayRecordSources(item)} placement={\"bottom\"} content={displayRecordSources(item).substring(0, 28)} width={\"200px\"} />\n+          </span> : emptyField}\n+          {item.hubMetadata?.lastProcessedByFlow ? <span className={styles.valText} data-testid={item.uri + '-lastProcessedByFlow'}>\n+            <OverflowTooltip title={item.hubMetadata?.lastProcessedByFlow} placement={\"bottom\"} content={item.hubMetadata?.lastProcessedByFlow} width={\"200px\"} />\n+          </span> : emptyField}\n+          {item.hubMetadata?.lastProcessedByStep ? <span className={styles.valText} data-testid={item.uri + '-lastProcessedByStep'}>\n+            <OverflowTooltip title={item.hubMetadata.lastProcessedByStep} placement={\"bottom\"} content={item.hubMetadata.lastProcessedByStep} width={\"200px\"} />\n+          </span> : emptyField}\n+          {item.hubMetadata?.lastProcessedDateTime ? <span className={styles.valText} data-testid={item.uri + '-lastProcessedDateTime'}>\n+            {CardViewDateConverter(item.hubMetadata?.lastProcessedDateTime)}\n+          </span> : emptyField}\n+        </div>\n+      </div>\n+    );\n+  }\n+\n+  return (\n+    <div id=\"record-data-card\" aria-label=\"record-data-card\" className={styles.rawDataCard}>\n+      <Row gutter={24} type=\"flex\" >\n+        {props.data && props.data.length > 0 ? props.data.map((elem, index) => (\n+          <Col key={index}>\n+            <div >\n+              <Card\n+                className={styles.cardStyle}\n+                size=\"small\"\n+              >\n+                <div className={styles.cardMetadataContainer}>\n+                  <span className={styles.uriContainer} data-testid={elem.uri + '-URI'}>URI: <span className={styles.uri}>\n+                    <MLTooltip title={elem.uri} placement=\"bottom\">{displayUri(elem.uri)}</MLTooltip></span></span>\n+                  <span className={styles.cardIcons}>\n+                    <MLPopover getPopupContainer={trigger => trigger.parentElement} content={displayRecordMetadata(elem)} placement=\"bottomRight\" trigger=\"click\">\n+                      <span>\n+                        <MLTooltip title={\"View info\"} placement=\"bottom\">\n+                          <span className={styles.infoIcon}><Icon type=\"info-circle\" theme=\"filled\" data-testid={elem.uri + '-InfoIcon'} /></span>\n+                        </MLTooltip>\n+                      </span>\n+                    </MLPopover>\n+                    <span className={styles.sourceFormat}\n+                      style={sourceFormatStyle(elem.format)}\n+                      data-testid={elem.uri + '-sourceFormat'}\n+                    >{sourceFormatOptions[elem.format].label}</span>\n+                    <MLTooltip title={'Detail view'} placement=\"bottom\"\n+                    ><i role=\"detail-link icon\" data-testid={elem.uri + '-detailViewIcon'}><FontAwesomeIcon icon={faExternalLinkAlt} className={elem.format === 'binary' ? styles.detailLinkIconDisabled : styles.detailLinkIcon} size=\"lg\" /></i>\n+                    </MLTooltip>\n+                  </span>\n+                </div>\n+                <div className={styles.snippetContainer} data-testid={elem.uri + '-snippet'} >\n+                  {displaySnippet(elem)}\n+                </div>\n+              </Card>\n+            </div>\n+          </Col>)) : <span></span>}\n+      </Row>\n+    </div>\n+  );\n+}\n+\n+export default RawDataCardView;", "originalCommit": "a3ca5818bfd31ef80d8b0785f8a9fee9ba323ba5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NDkyNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#discussion_r504254926", "bodyText": "Oh was missing this change due to rebasing. Fixed. Thanks.", "author": "timur-isangulov", "createdAt": "2020-10-13T20:59:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1MjY1MQ=="}], "type": "inlineReview"}, {"oid": "6e27bf41dfedd4c4277c74ee42c92d0b610278bd", "url": "https://github.com/marklogic/marklogic-data-hub/commit/6e27bf41dfedd4c4277c74ee42c92d0b610278bd", "message": "DHFPROD-4659: Visualize metadata of the document in card view", "committedDate": "2020-10-13T20:57:35Z", "type": "forcePushed"}, {"oid": "c5e6ff519b2f47af0970e97a1eab451fa195731a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/c5e6ff519b2f47af0970e97a1eab451fa195731a", "message": "DHFPROD-4659: Visualize metadata of the document in card view", "committedDate": "2020-10-13T21:28:10Z", "type": "commit"}, {"oid": "c5e6ff519b2f47af0970e97a1eab451fa195731a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/c5e6ff519b2f47af0970e97a1eab451fa195731a", "message": "DHFPROD-4659: Visualize metadata of the document in card view", "committedDate": "2020-10-13T21:28:10Z", "type": "forcePushed"}]}