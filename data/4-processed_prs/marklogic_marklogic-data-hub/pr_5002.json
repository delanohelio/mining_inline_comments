{"pr_number": 5002, "pr_title": "DHFPROD-6359: Fix ML9 cluster regression in MasterTest", "pr_createdAt": "2020-12-14T23:51:55Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/5002", "timeline": [{"oid": "16f20ead552fe0afb8aa418dfe5ae19505b1dcca", "url": "https://github.com/marklogic/marklogic-data-hub/commit/16f20ead552fe0afb8aa418dfe5ae19505b1dcca", "message": "DHFPROD-6359: Fix ML9 cluster regression in MasterTest", "committedDate": "2020-12-14T23:45:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM0Mjk0MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/5002#discussion_r543342940", "bodyText": "Is this removed because it was not having any impact? I looked at the surrounding code - since \"$key\" comes from map:keys($all-matches), it looks like this would never resolve to true and thus never call lock-for-update - right?", "author": "rjrudin", "createdAt": "2020-12-15T13:32:01Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/com.marklogic.smart-mastering/impl/process.xqy", "diffHunk": "@@ -325,7 +325,6 @@ declare function proc-impl:consolidate-notifies($all-matches as map:map, $merged\n     let $updated-notification-uris :=\n       for $key-notification in $key-notifications[@threshold = $key-threshold]\n       let $key-uri as xs:string := $key-notification/@uri\n-      let $_lock-on-uri := if (fn:not(map:contains($all-matches, $key))) then merge-impl:lock-for-update($key-uri) else ()", "originalCommit": "16f20ead552fe0afb8aa418dfe5ae19505b1dcca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUzNTc2Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/5002#discussion_r543535762", "bodyText": "Yes, if it was going to do anything it should have been $key-uri, but it doesn't really make sense to lock for a URI in the notification document anyway since it doesn't write to those URIs.", "author": "ryanjdew", "createdAt": "2020-12-15T17:20:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM0Mjk0MA=="}], "type": "inlineReview"}]}