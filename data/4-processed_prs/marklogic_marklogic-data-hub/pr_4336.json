{"pr_number": 4336, "pr_title": "DHFPROD-5512: Save and delete entity type", "pr_createdAt": "2020-08-04T20:49:20Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4336", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NDQ2OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r465994469", "bodyText": "I recommend changing these from id to aria-label. I made change this in my PR for DHFPROD-5371 so I can use 'findByLabelText' in the RTL tests.", "author": "brucean52", "createdAt": "2020-08-05T20:47:52Z", "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.tsx", "diffHunk": "@@ -101,6 +101,47 @@ const ConfirmationModal: React.FC<Props> = (props) => {\n         </>\n       )}\n \n+      {props.type === ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn && (\n+        <>\n+          <MLAlert\n+            className={styles.alert}\n+            closable={false}\n+            description={\"There are existing entity type relationships, and outstanding edits that need to be saved.\"}\n+            showIcon\n+            type=\"warning\"\n+          />\n+          <p id=\"delete-relationship-edit-text\">The <b>{props.boldTextArray[0]}</b> entity type is related to one or", "originalCommit": "7445218052df50150d401701b5c6e5711ccb0a5f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4OTQxNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466589416", "bodyText": "Okay, I'll update the PR once your PR gets merged.", "author": "akshaysonvane", "createdAt": "2020-08-06T17:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NDQ2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NTU3Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r465995577", "bodyText": "FYI, the 'title' for the confirmation modal has been removed in my PR for DHFPROD-5371", "author": "brucean52", "createdAt": "2020-08-05T20:50:07Z", "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.test.tsx", "diffHunk": "@@ -165,6 +165,86 @@ describe('Confirmation Modal Component', () => {\n     expect(toggleModal).toBeCalledTimes(1);\n   });\n \n+  test('can render delete type entity relation with outstanding edit warn confirmation', () => {\n+    let entityName = 'PersonXML';\n+    let arrayValues = ['Person-Mapping-XML']\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByText, getByText, getAllByText, rerender } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn}\n+        boldTextArray={[entityName]}\n+        arrayValues={arrayValues}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByText('Confirmation')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn}\n+      boldTextArray={[entityName]}\n+      arrayValues={arrayValues}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Confirmation')).toBeInTheDocument();\n+    expect(getAllByText(entityName)).toHaveLength(4);\n+    expect(getByText('There are existing entity type relationships, and outstanding edits that need to be saved.')).toBeInTheDocument();\n+    expect(getByText(arrayValues[0])).toBeInTheDocument();\n+\n+    userEvent.click(getByText('No'));\n+    expect(toggleModal).toBeCalledTimes(1);\n+\n+    userEvent.click(getByText('Yes'));\n+    expect(confirmAction).toBeCalledTimes(1);\n+  });\n+\n+  test('can render delete type outstanding edit warn confirmation', () => {\n+    let entityName = 'PersonXML';\n+    let arrayValues = ['Person-Mapping-XML']\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByText, getByText, getAllByText, rerender } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.DeleteEntityNoRelationshipOutstandingEditWarn}\n+        boldTextArray={[entityName]}\n+        arrayValues={arrayValues}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByText('Confirmation')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.DeleteEntityNoRelationshipOutstandingEditWarn}\n+      boldTextArray={[entityName]}\n+      arrayValues={arrayValues}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Confirmation')).toBeInTheDocument();", "originalCommit": "7445218052df50150d401701b5c6e5711ccb0a5f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4OTg0OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466589848", "bodyText": "Thanks for the heads-up. I'll update once your PR gets merged.", "author": "akshaysonvane", "createdAt": "2020-08-06T17:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NTU3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466001311", "bodyText": "I don't think this needs to be it's own state variable. You should use 'modelingOptions.isModified' directly and use the context functions to do mutations", "author": "brucean52", "createdAt": "2020-08-05T21:01:34Z", "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-table/entity-type-table.tsx", "diffHunk": "@@ -37,7 +37,7 @@ const EntityTypeTable: React.FC<Props> = (props) => {\n \n   const [showConfirmModal, toggleConfirmModal] = useState(false);\n   const [confirmBoldTextArray, setConfirmBoldTextArray] = useState<string[]>([]);\n-  const [stepValuesArray, setStepValuesArray] = useState<string[]>([]);\n+  const [arrayValues, setArrayValues] = useState<string[]>([]);\n   const [confirmType, setConfirmType] = useState<ConfirmationType>(ConfirmationType.DeleteEntity);\n   const [isAnyEntityModified, toggleAnyEntityModified] = useState(modelingOptions.isModified);", "originalCommit": "7445218052df50150d401701b5c6e5711ccb0a5f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU5MTgzNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466591835", "bodyText": "This isn't introducing a new state variable. It's just renaming the existing one from stepValuesArray to arrayValues since we are using that to pass both steps and model names.", "author": "akshaysonvane", "createdAt": "2020-08-06T18:02:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU5NDc2NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466594764", "bodyText": "Sorry, I was actually referring to \"isAnyEntityModified\". You can use \"modelingOptions.isModified\" directly instead. See \"pages/Modeling.tsx\" if you need an example", "author": "brucean52", "createdAt": "2020-08-06T18:07:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwMDE2MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466600161", "bodyText": "I had to add isAnyEntityModified as a state variable so that react would update the save and revert icons based on the operations performed on both the parent and the current component.\nSo when we revert all / save all from the parent component then the state change makes React to rerender the save/revert icons on the entity-type-table page.\nclassName={(!props.canWriteEntityModel && props.canReadEntityModel) || !isAnyEntityModified || !isEntityModified(text) ? styles.iconSaveReadOnly : styles.iconSave}", "author": "akshaysonvane", "createdAt": "2020-08-06T18:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwNDYzMw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466604633", "bodyText": "Ok got it. That makes sense.", "author": "brucean52", "createdAt": "2020-08-06T18:25:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ=="}], "type": "inlineReview"}, {"oid": "5bf63f99b231541a5af965c3a0c17eca9fd6c727", "url": "https://github.com/marklogic/marklogic-data-hub/commit/5bf63f99b231541a5af965c3a0c17eca9fd6c727", "message": "DHFPROD-5512: Save and delete entity type", "committedDate": "2020-08-10T22:26:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0MzQxNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r468243416", "bodyText": "Seeing failures running this on my local system. Please try increasing this.", "author": "brucean52", "createdAt": "2020-08-10T23:38:09Z", "path": "marklogic-data-hub-central/ui/e2e/cypress/support/components/common/confirmation-modal.tsx", "diffHunk": "@@ -33,6 +33,15 @@ class ConfirmationModal {\n   getDeleteEntityRelationshipText() {\n     return cy.findByLabelText('delete-relationship-text', {timeout: 15000});\n   }\n+\n+  getDeleteEntityRelationshipEditText() {\n+    return cy.findByLabelText('delete-relationship-edit-text', {timeout: 15000});", "originalCommit": "5bf63f99b231541a5af965c3a0c17eca9fd6c727", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1MDY2MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r468250660", "bodyText": "Increased the timeout value to 25000", "author": "akshaysonvane", "createdAt": "2020-08-11T00:01:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0MzQxNg=="}], "type": "inlineReview"}, {"oid": "b6205912fc6ca14924f9053d381a57c0052146a5", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b6205912fc6ca14924f9053d381a57c0052146a5", "message": "DHFPROD-5512: Save and delete entity type", "committedDate": "2020-08-11T00:00:12Z", "type": "commit"}, {"oid": "b6205912fc6ca14924f9053d381a57c0052146a5", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b6205912fc6ca14924f9053d381a57c0052146a5", "message": "DHFPROD-5512: Save and delete entity type", "committedDate": "2020-08-11T00:00:12Z", "type": "forcePushed"}]}