{"pr_number": 4540, "pr_title": "DHFPROD-5882: Adding connector code in a new directory.", "pr_createdAt": "2020-09-09T02:27:10Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4540", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY3OTQ2Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4540#discussion_r485679467", "bodyText": "This code should all be in a new subproject of this repository - e.g. ./marklogic-data-hub-glue-connector. That allows us to have a build.gradle file just for that subproject. We don't want the code and dependencies in here as we don't want to include a bunch of spark jars in every DHF product.", "author": "rjrudin", "createdAt": "2020-09-09T14:56:49Z", "path": "marklogic-data-hub/build.gradle", "diffHunk": "@@ -73,6 +73,12 @@ dependencies {\n     // For installer program\n     compile \"com.beust:jcommander:1.72\"\n \n+    compile group: 'org.apache.spark', name:'spark-sql_2.11',version: '2.4.5'", "originalCommit": "6bdf554f85c6eae927c8ee016b4fcfecfcbff857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY3OTkzOA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4540#discussion_r485679938", "bodyText": "I think this is only used for tests, so it's fine to include for now. It'll likely be replaced though based on the test plumbing we have in the core project - I will help out with that.", "author": "rjrudin", "createdAt": "2020-09-09T14:57:26Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/connector/IOTestUtil.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*", "originalCommit": "6bdf554f85c6eae927c8ee016b4fcfecfcbff857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4MjE4Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4540#discussion_r485682187", "bodyText": "For the package, let's do com.marklogic.hub.cloud.aws.glue - I know that's long, but it's consistent with an existing package we have in the Hub Central project. \"com.marklogic.hub\" has to be there, and \"cloud\" is the parent package for the eventual \"azure\" subpackage. And then \"glue\" because we may have additional things specific to AWS that don't involve glue. I am guessing we do not need an additional \"connector\" subpackage, as anything in the \"glue\" package would necessarily be associated with the connector. Does that seem right?", "author": "rjrudin", "createdAt": "2020-09-09T15:00:17Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/connector/Writer/MarkLogicDataWriter.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 MarkLogic Corporation\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.marklogic.hub.connector.Writer;", "originalCommit": "6bdf554f85c6eae927c8ee016b4fcfecfcbff857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4MjYwNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4540#discussion_r485682607", "bodyText": "This is fine for now, but we'll eventually want to replace the use of System.out with some logging framework that is friendly with Glue.", "author": "rjrudin", "createdAt": "2020-09-09T15:00:48Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/connector/Writer/MarkLogicDataWriterFactory.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 MarkLogic Corporation\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.marklogic.hub.connector.Writer;\n+\n+import org.apache.spark.sql.catalyst.InternalRow;\n+import org.apache.spark.sql.sources.v2.writer.DataWriter;\n+import org.apache.spark.sql.sources.v2.writer.DataWriterFactory;\n+import org.apache.spark.sql.types.StructType;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class MarkLogicDataWriterFactory implements DataWriterFactory<InternalRow> {\n+    private Map<String, String> map;\n+    private StructType schema;\n+    public MarkLogicDataWriterFactory(Map<String, String> map, StructType schema) {\n+        this.map = map;\n+        this.schema = schema;\n+    }\n+\n+    @Override\n+    public DataWriter<InternalRow> createDataWriter(int partitionId, long taskId, long epochId) {\n+        System.out.println(\"************** task id ************** \"+ taskId);", "originalCommit": "6bdf554f85c6eae927c8ee016b4fcfecfcbff857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f1e06db49977182924055f4dffdbd11d3ed98e47", "url": "https://github.com/marklogic/marklogic-data-hub/commit/f1e06db49977182924055f4dffdbd11d3ed98e47", "message": "Refactoring connector code as per the suggestions (Story - https://project.marklogic.com/jira/browse/DHFPROD-5882)", "committedDate": "2020-09-09T21:14:26Z", "type": "forcePushed"}, {"oid": "23c4a218e568096fbbf530fcdf1bf16998139360", "url": "https://github.com/marklogic/marklogic-data-hub/commit/23c4a218e568096fbbf530fcdf1bf16998139360", "message": "DHFPROD-5882 : Add Spark connector as new subproject in DHF repository (https://project.marklogic.com/jira/browse/DHFPROD-5882)", "committedDate": "2020-09-10T18:09:46Z", "type": "forcePushed"}, {"oid": "e169b7233a9850f219cbf359146901140fe13cc7", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e169b7233a9850f219cbf359146901140fe13cc7", "message": "DHFPROD-5882 : Add Spark connector as new subproject in DHF repository (https://project.marklogic.com/jira/browse/DHFPROD-5882)", "committedDate": "2020-09-10T20:50:05Z", "type": "commit"}, {"oid": "e169b7233a9850f219cbf359146901140fe13cc7", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e169b7233a9850f219cbf359146901140fe13cc7", "message": "DHFPROD-5882 : Add Spark connector as new subproject in DHF repository (https://project.marklogic.com/jira/browse/DHFPROD-5882)", "committedDate": "2020-09-10T20:50:05Z", "type": "forcePushed"}]}