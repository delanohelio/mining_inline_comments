{"pr_number": 4095, "pr_title": "DHFPROD-5157: Don't process audit and notification docs through match", "pr_createdAt": "2020-06-15T17:46:49Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4095", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM2MTk4NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4095#discussion_r440361984", "bodyText": "Couple small typos on auditing and notification here, along with notification below on line 31.", "author": "rjrudin", "createdAt": "2020-06-15T18:21:18Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/builtins/steps/mastering/default/matching.sjs", "diffHunk": "@@ -20,28 +20,37 @@ const masteringStepLib = require(\"/data-hub/5/builtins/steps/mastering/default/l\n const requiredOptionProperties = ['matchOptions'];\n const emptySequence = Sequence.from([]);\n \n-function filterContentAlreadyProcessed(content, summaryCollection) {\n+function filterContentAlreadyProcessed(content, summaryCollection, collectionInfo) {\n   const jobID = datahub.flow.globalContext.jobId;\n   const filteredContent = [];\n   const collectionQuery = cts.collectionQuery(summaryCollection);\n   const jobIdQuery = cts.fieldWordQuery('datahubCreatedByJob', jobID);\n+  let auditiingNotifiactionsInSourceQuery = false;", "originalCommit": "4940782788ff93c1f84a0ac97181d826f950cc96", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM2MzE5Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4095#discussion_r440363192", "bodyText": "I looked at checkOptions in lib.sjs, and I think it'd be worth documenting here that \"collectionInfo\" is expected to be produced by checkOptions. Otherwise it's difficult to know what this contains - gotta find the client who's calling this and where collectionInfo is coming from.\nIn Intellij, when I asked it to auto-generate comments for the checkOptions function, it produced this, which may be useful to add as well so it's clear what's coming out of that function (as the name to me implies that it will either throw an error if there's a problem with the options or return nothing):\n/**\n * \n * @param content\n * @param options\n * @param filteredContent\n * @param reqOptProperties\n * @returns {{contentCollection: *, mergedCollection: *, notificationCollection: *, archivedCollection: *, auditingCollection: *}}\n */", "author": "rjrudin", "createdAt": "2020-06-15T18:23:45Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/builtins/steps/mastering/default/matching.sjs", "diffHunk": "@@ -20,28 +20,37 @@ const masteringStepLib = require(\"/data-hub/5/builtins/steps/mastering/default/l\n const requiredOptionProperties = ['matchOptions'];\n const emptySequence = Sequence.from([]);\n \n-function filterContentAlreadyProcessed(content, summaryCollection) {\n+function filterContentAlreadyProcessed(content, summaryCollection, collectionInfo) {", "originalCommit": "4940782788ff93c1f84a0ac97181d826f950cc96", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0ca2c60e4ad5bc676fcdf06f6bf9bc84adc3a462", "url": "https://github.com/marklogic/marklogic-data-hub/commit/0ca2c60e4ad5bc676fcdf06f6bf9bc84adc3a462", "message": "DHFPROD-5157: Don't process audit and notification docs through match", "committedDate": "2020-06-15T20:02:02Z", "type": "forcePushed"}, {"oid": "b869ed5ff4837547490bb57ec006327697a3bd8e", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b869ed5ff4837547490bb57ec006327697a3bd8e", "message": "DHFPROD-5157: Don't process audit and notification docs through match", "committedDate": "2020-06-15T20:17:07Z", "type": "forcePushed"}, {"oid": "7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8", "message": "DHFPROD-5157: Don't process audit and notification docs through match", "committedDate": "2020-06-15T22:46:36Z", "type": "commit"}, {"oid": "7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8", "message": "DHFPROD-5157: Don't process audit and notification docs through match", "committedDate": "2020-06-15T22:46:36Z", "type": "forcePushed"}]}