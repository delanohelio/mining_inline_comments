{"pr_number": 4440, "pr_title": "DHFPROD-5735:Enable writing temporal documents", "pr_createdAt": "2020-08-19T08:22:26Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4440", "timeline": [{"oid": "60fbe99a13f457d8dd985dd927475e80d1e4ffbf", "url": "https://github.com/marklogic/marklogic-data-hub/commit/60fbe99a13f457d8dd985dd927475e80d1e4ffbf", "message": "DHFPROD-5735:Enable writing temporal documents", "committedDate": "2020-08-19T08:35:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk5NTE0Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4440#discussion_r472995147", "bodyText": "I think it'd be better for this to just call temporal.collections(). Returning an object with each collection as the key and a value of \"true\" is very specific to what invoke-queue-write wants. invoke-queue-write should be responsible for doing that; this should just call temporal.collections() and return the result.", "author": "rjrudin", "createdAt": "2020-08-19T12:36:44Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/temporal/hub-temporal.sjs", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright 2020 MarkLogic Corporation\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+'use strict';\n+const temporal = require(\"/MarkLogic/temporal.xqy\");\n+\n+module.exports.getTemporalCollections = module.amp(\n+  function getTemporalCollections() {", "originalCommit": "60fbe99a13f457d8dd985dd927475e80d1e4ffbf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk5NjA3Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4440#discussion_r472996076", "bodyText": "Can you move the new project files to test-projects/temporal-test? I'd eventually like for all of the test projects to be in that folder so that we don't have so many folders directly under src/test/resources.", "author": "rjrudin", "createdAt": "2020-08-19T12:38:15Z", "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/flow/TemporalWriteTest.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package com.marklogic.hub.flow;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.marklogic.appdeployer.command.temporal.DeployTemporalAxesCommand;\n+import com.marklogic.appdeployer.command.temporal.DeployTemporalCollectionsCommand;\n+import com.marklogic.appdeployer.impl.SimpleAppDeployer;\n+import com.marklogic.client.io.DocumentMetadataHandle;\n+import com.marklogic.client.io.JacksonHandle;\n+import com.marklogic.hub.AbstractHubCoreTest;\n+import com.marklogic.hub.HubConfig;\n+import com.marklogic.mgmt.resource.databases.DatabaseManager;\n+import com.marklogic.mgmt.util.ObjectMapperFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+import static com.marklogic.client.io.DocumentMetadataHandle.Capability.*;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class TemporalWriteTest extends AbstractHubCoreTest {\n+\n+    @BeforeEach\n+    void setUp() {\n+        runAsDataHubDeveloper();\n+        installProjectInFolder(\"temporal-test\");", "originalCommit": "60fbe99a13f457d8dd985dd927475e80d1e4ffbf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk5OTE4Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4440#discussion_r472999182", "bodyText": "This is not related, but pinging @fsnow and @ryanjdew and @bsrikan about this - I've wondered if step definitions should go away. They certainly seem like unnecessary work when making a custom step. The only thing of interest here is the modulePath, and if I'm making a custom step, it's easier to make one new file - the custom step with a modulePath in it - vs making two new files.\nPerhaps step definitions don't need to go away, but should just become optional. They are a useful way to refer to OOTB step modules... though arguably, just using the OOTB step modulePath would be just as easy. The indirection added by having a step definition name and type just doesn't seem to buy much. The odds of the module path changing seem as low as the odds of the step definition name/type changing, so tossing the OOTB module path into a step seems fine.", "author": "rjrudin", "createdAt": "2020-08-19T12:43:24Z", "path": "marklogic-data-hub/src/test/resources/temporal-test/step-definitions/custom/temporal-test/temporal-test.step.json", "diffHunk": "@@ -0,0 +1,9 @@\n+{\n+  \"lang\": \"zxx\",\n+  \"name\": \"temporal-test\",\n+  \"type\": \"CUSTOM\",\n+  \"options\": {\n+    \"outputFormat\": \"json\"\n+  },\n+  \"modulePath\": \"/custom-modules/custom/temporal-step/main.sjs\"", "originalCommit": "60fbe99a13f457d8dd985dd927475e80d1e4ffbf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8bb0c4a2f02571f7210e324296a830db80e958a5", "url": "https://github.com/marklogic/marklogic-data-hub/commit/8bb0c4a2f02571f7210e324296a830db80e958a5", "message": "DHFPROD-5735:Enable writing temporal documents", "committedDate": "2020-08-19T16:30:51Z", "type": "forcePushed"}, {"oid": "ad48f24eec9ca5d403387ae1bcb5d777a1cbf25c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/ad48f24eec9ca5d403387ae1bcb5d777a1cbf25c", "message": "DHFPROD-5735:Enable writing temporal documents", "committedDate": "2020-08-20T03:24:07Z", "type": "commit"}, {"oid": "ad48f24eec9ca5d403387ae1bcb5d777a1cbf25c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/ad48f24eec9ca5d403387ae1bcb5d777a1cbf25c", "message": "DHFPROD-5735:Enable writing temporal documents", "committedDate": "2020-08-20T03:24:07Z", "type": "forcePushed"}]}