{"pr_number": 3446, "pr_title": "DHFPROD-4046:Ensure that watcher service is disabled after user logs out", "pr_createdAt": "2020-01-09T19:44:25Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3446", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk1MTI0Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3446#discussion_r364951247", "bodyText": "One way to make this a little nicer is to verify that \"dir\" is not null, and that dir.exists() as well. If either is not true, no need to unwatch.", "author": "rjrudin", "createdAt": "2020-01-09T20:44:15Z", "path": "web/src/main/java/com/marklogic/hub/web/web/CurrentProjectController.java", "diffHunk": "@@ -301,13 +301,22 @@ private void clearAuthenticationAttributes(HttpServletRequest request) {\n     @Override\n     public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n         request.getSession().invalidate();\n-        if (watcherService.hasListener(this)) {\n-            watcherService.unwatch(hubConfig.getStepDefinitionsDir().toString());\n-            watcherService.unwatch(hubConfig.getHubEntitiesDir().toString());\n-            watcherService.unwatch(hubConfig.getHubMappingsDir().toString());\n-            watcherService.unwatch(hubConfig.getFlowsDir().toString());\n-            watcherService.removeListener(this);\n-        }\n+        disableWatcherService(hubConfig.getStepDefinitionsDir().toFile());\n+        disableWatcherService(hubConfig.getHubEntitiesDir().toFile());\n+        disableWatcherService(hubConfig.getHubMappingsDir().toFile());\n+        disableWatcherService(hubConfig.getFlowsDir().toFile());\n+        disableWatcherService(hubConfig.getStepDefinitionsDir().toFile());\n+        disableWatcherService(hubProject.getCustomModulesDir().toFile());\n+        watcherService.removeListener(this);\n         mappingManagerService.unsetMappingValidators();\n     }\n+\n+    private void disableWatcherService(File dir) {\n+        try{\n+            watcherService.unwatch(dir.toString());", "originalCommit": "648a95a4f7412addf51ec549f30e75f2ddf3624c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6fde9d67442ef5e4912e8c413d0dd1b3b819106d", "url": "https://github.com/marklogic/marklogic-data-hub/commit/6fde9d67442ef5e4912e8c413d0dd1b3b819106d", "message": "DHFPROD-4046:Ensure that watcher service is disabled after user logs out", "committedDate": "2020-01-10T02:02:37Z", "type": "commit"}, {"oid": "6fde9d67442ef5e4912e8c413d0dd1b3b819106d", "url": "https://github.com/marklogic/marklogic-data-hub/commit/6fde9d67442ef5e4912e8c413d0dd1b3b819106d", "message": "DHFPROD-4046:Ensure that watcher service is disabled after user logs out", "committedDate": "2020-01-10T02:02:37Z", "type": "forcePushed"}]}