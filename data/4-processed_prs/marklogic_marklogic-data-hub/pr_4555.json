{"pr_number": 4555, "pr_title": "DHFPROD-5691: Fix outstanding issues found by coverity static scan", "pr_createdAt": "2020-09-11T18:28:20Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4555", "timeline": [{"oid": "1a9d37c565965013364e15cf5b41dff6c1e57ddf", "url": "https://github.com/marklogic/marklogic-data-hub/commit/1a9d37c565965013364e15cf5b41dff6c1e57ddf", "message": "DHFPROD-5691: Fix outstanding issues found by coverity static scan", "committedDate": "2020-09-11T18:24:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1NDc4NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4555#discussion_r487254785", "bodyText": "What was the issue with \"synchronized\"? I don't know if it's actually needed, but I also don't know the impact of removing it.", "author": "rjrudin", "createdAt": "2020-09-11T19:45:07Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/flow/impl/FlowRunnerImpl.java", "diffHunk": "@@ -254,18 +228,17 @@ private void initializeFlow(String jobId) {\n     }\n \n     public void stopJob(String jobId) {\n-        synchronized (stepsMap) {\n-            if(stepsMap.get(jobId) != null){\n-                stepsMap.get(jobId).clear();\n-                stepsMap.remove(jobId);\n-                isJobCancelled.set(true);\n-            }\n-            else {\n-                throw new RuntimeException(\"Job not running\");\n-            }\n+        if (stepsMap.get(jobId) != null) {", "originalCommit": "1a9d37c565965013364e15cf5b41dff6c1e57ddf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI4MzU2MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4555#discussion_r487283561", "bodyText": "Coverity had raised a concurrency issue earlier which is why @ryanjdew added this in. Right now it's raising an issue that we are synchronizing over an object of java.util.concurrent package.\nI checked and also conformed with Ryan that its safe to remove the synchronized block since both stepsMap and isJobCancelled are part of java.util.concurrent package.\nRyan and I decided to remove the synchronized block for now and see if the Coverity scan raises the earlier issue again.", "author": "akshaysonvane", "createdAt": "2020-09-11T20:48:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1NDc4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1NTYyNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4555#discussion_r487255624", "bodyText": "I think the fileOut declaration needs to be moved into the \"if\" block - otherwise, it never gets closed. Could just do:\nFileCopyUtils.copy(buffer, new FileOutputStream(outputFile));", "author": "rjrudin", "createdAt": "2020-09-11T19:46:46Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/HubCentralManager.java", "diffHunk": "@@ -160,9 +160,10 @@ protected void extractZipToProject(HubProject hubProject, File zipFile) {\n                 outputFile.getParentFile().mkdirs();\n                 try (InputStream inputStream = zip.getInputStream(entry);\n                      FileOutputStream fileOut = new FileOutputStream(outputFile)) {\n-                    inputStream.read(buffer, 0, entrySize);\n-                    logger.info(\"Writing file: \" + outputFile);\n-                    FileCopyUtils.copy(buffer, fileOut);\n+                    if (inputStream.read(buffer, 0, entrySize) > 0) {", "originalCommit": "1a9d37c565965013364e15cf5b41dff6c1e57ddf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI4MzU4Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4555#discussion_r487283582", "bodyText": "In the event when FileCopyUtils.copy(buffer, fileOut) does not run the fileOut stream should be closed via the try-with-resources block.", "author": "akshaysonvane", "createdAt": "2020-09-11T20:48:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1NTYyNA=="}], "type": "inlineReview"}]}