{"pr_number": 4058, "pr_title": "DHFPROD-4969: Update Advanced Settings with JSON fields", "pr_createdAt": "2020-06-05T21:24:04Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4058", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNzAwNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r436227005", "bodyText": "RTL commands are all internally wrapped in act.\nconst renderResults = await render(.......) will help get rid of the \"wrap in act... \" warning when running the test.\nWe wouldnt need to wrap a fireEvent in act.", "author": "bsrikan", "createdAt": "2020-06-06T01:52:35Z", "path": "marklogic-data-hub-central/ui/src/pages/Load.test.tsx", "diffHunk": "@@ -27,7 +25,19 @@ describe('Load component', () => {\n         const authorityService = new AuthoritiesService();\n         authorityService.setAuthorities(['readIngestion']);\n \n-        const { getByText, getByTitle, getByLabelText, getByTestId, queryByTestId, queryByText, queryByTitle } = render(<AuthoritiesContext.Provider value={authorityService}><Load/></AuthoritiesContext.Provider>);\n+        let getByText, getByTitle, getByLabelText, getByTestId, queryByTestId, queryByText, queryByTitle;\n+        await act(async () => {\n+          const renderResults = render(", "originalCommit": "a0c286c6e927364637c056a536f19e25062c02e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMyMjI5MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r436322290", "bodyText": "@wooldridge pushed small changes.\n\nwrapping the component in act was sufficient to get rid of the warnings.\nfixed unmount warning", "author": "bsrikan", "createdAt": "2020-06-07T04:01:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNzAwNQ=="}], "type": "inlineReview"}, {"oid": "759c89fac1f2f8975d8c844c4db89f898b8fd669", "url": "https://github.com/marklogic/marklogic-data-hub/commit/759c89fac1f2f8975d8c844c4db89f898b8fd669", "message": "DHFPROD-4969: Fix \"unmounted component\" warning and cleanup wrapping\nwith act", "committedDate": "2020-06-07T03:55:53Z", "type": "forcePushed"}, {"oid": "ae7d4734a716cffee4c9d7661df31034d502895b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/ae7d4734a716cffee4c9d7661df31034d502895b", "message": "DHFPROD-4969: Update Advanced Settings with JSON fields\n\nFields: Header Content, Processors, Custom Hook\nFor Load and Mapping steps.\n\nDHFPROD-4969: Fix \"unmounted component\" warning and cleanup wrapping\nwith act", "committedDate": "2020-06-07T03:59:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY2OTYxMw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r436669613", "bodyText": "I didn't see a reference for these; if that's true, I'd like to use the following descriptions instead:\n\nProcessors = Custom modules that can process content before it is persisted.\nCustom hook = Custom module that can perform updates in a separate transaction.\n\nDescribing how a custom hook behaves is very difficult since its behavior varies based on the step being used. So I think the less said here, the better. I really don't think that Pari - the typical user of a custom hook - is ever going to use this interface to configure processors/custom hook. The complexity in trying to describe what these are is one of the reasons I don't think these should be exposed here either. But since we are exposing them, I think we want brief descriptions that encourage a non-Pari persona to not bother trying to figure out what these are.", "author": "rjrudin", "createdAt": "2020-06-08T12:53:49Z", "path": "marklogic-data-hub-central/ui/src/config/tooltips.config.js", "diffHunk": "@@ -5,11 +5,11 @@ const AdvancedSettings = {\n     'targetFormat': 'The format of the documents in the target database.',\n     'additionalCollections': 'The collection tags to add to the default tags assigned to the processed document.',\n     'targetPermissions': 'The comma-separated permissions required to access the processed document.',\n-    'module': 'The path to your custom hook module.',\n-    'cHParameters': 'Parameters, as key-value pairs, to pass to your custom hook module.',\n-    'user': 'The user account to use to run the module. The default is the user running the flow; e.g., data-hub-operator.',\n-    'runBefore': 'Choose whether to run the module before or after the core processes of the step.',\n-    /* The following are for *Custom*Tooltips. */\n+    'headers': 'A JSON object that represents additional metadata to add to the header section of the envelope of each document.',\n+    'provGranularity': 'The level of detail logged for provenance. Choose *coarse* for the default level or *off* for no provenance logging.',\n+    'processors': 'Custom modules that perform additional processes after the core step processes are completed and before the results are saved.',", "originalCommit": "ae7d4734a716cffee4c9d7661df31034d502895b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "url": "https://github.com/marklogic/marklogic-data-hub/commit/aca4d2c8782aaa6c85a64d91547eba14d712f428", "message": "DHFPROD-4969: Update Advanced Settings with JSON fields\n\nFields: Header Content, Processors, Custom Hook\nFor Load and Mapping steps.\nFix \"unmounted component\" warning and cleanup wrapping\nwith act.", "committedDate": "2020-06-09T00:44:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2NjQ5OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437166498", "bodyText": "Its ok to replace PUT tests with POST here. But we need to add a test for PUT; one each in Load and Curate test files(comments further down) and reuse loadSettings and mappingSettings in load.config and run.config for the same.", "author": "bsrikan", "createdAt": "2020-06-09T06:30:19Z", "path": "marklogic-data-hub-central/ui/src/components/advanced-settings/advanced-settings-dialog.test.tsx", "diffHunk": "@@ -128,83 +169,147 @@ describe('Update data load settings component', () => {\n     const testFormatOptions = getAllByTestId('targetFormatOptions').map(li => li);\n     expect(testFormatOptions.map(li => li.textContent).toString()).toEqual('JSON,XML');\n     fireEvent.select(testFormatOptions[1]);\n-    expect(getByText('XML')).toBeInTheDocument();\n \n-    //Verifying provenance options select field\n-    fireEvent.click(getByText('Coarse-grained'));\n-    const provOptions = getAllByTestId('provOptions').map(li => li);\n-    expect(provOptions.map(li => li.textContent).toString()).toEqual('Coarse-grained,Off');\n-    fireEvent.select(provOptions[1]);\n-    expect(getByText('Off')).toBeInTheDocument();\n+    fireEvent.click(getByText('Processors'));\n+    fireEvent.change(getByLabelText('processors-textarea'), { target: { value: 'processors-changed' }});\n+    expect(getByLabelText('processors-textarea')).toHaveValue('processors-changed');\n+\n+    fireEvent.click(getByText('Custom Hook'));\n+    fireEvent.change(getByLabelText('customHook-textarea'), { target: { value: 'hook-changed' }});\n+    expect(getByLabelText('customHook-textarea')).toHaveValue('hook-changed');\n+\n+  });\n+\n+  test('Verify no/invalid/valid JSON is recognized correctly in JSON fields', async () => {\n+    let getByText, getByLabelText, queryAllByText;\n+    await act(async () => {\n+      const renderResults = render(\n+        <AdvancedSettingsDialog {...data.advancedMapping} />\n+      );\n+      getByText = renderResults.getByText;\n+      getByLabelText = renderResults.getByLabelText;\n+      queryAllByText = renderResults.queryAllByText;\n+    });\n \n+    // Expand all textarea inputs\n+    fireEvent.click(getByText('Processors'));\n     fireEvent.click(getByText('Custom Hook'));\n-    fireEvent.change(getByPlaceholderText('Please enter module'), { target: { value: 'test-module' }});\n-    expect(getByPlaceholderText('Please enter module')).toHaveValue('test-module');\n-    fireEvent.change(getByPlaceholderText('Please enter parameters'), { target: { value: '{}' }});\n-    expect(getByPlaceholderText('Please enter parameters')).toHaveValue('{}');\n-    fireEvent.change(getByPlaceholderText('Please enter user information'), { target: { value: 'test-user' }});\n-    expect(getByPlaceholderText('Please enter user information')).toHaveValue('test-user');\n-    fireEvent.click(getByRole('switch'));\n-    expect(getByText('ON')).toBeInTheDocument();\n+\n+    // No errors at start\n+    expect(queryAllByText('Invalid JSON').length === 0);\n+\n+    // No JSON (empty field)\n+    fireEvent.change(getByLabelText('headers-textarea'), { target: { value: '' }});\n+    expect(queryAllByText('Invalid JSON').length === 0);\n+    fireEvent.change(getByLabelText('processors-textarea'), { target: { value: '' }});\n+    expect(queryAllByText('Invalid JSON').length === 0);\n+    fireEvent.change(getByLabelText('processors-textarea'), { target: { value: '' }});\n+    expect(queryAllByText('Invalid JSON').length === 0);\n+\n+    // Invalid JSON\n+    fireEvent.change(getByLabelText('headers-textarea'), { target: { value: '{\"badJSON\": \"noClosingBracket\"' }});\n+    expect(queryAllByText('Invalid JSON').length === 1);\n+    fireEvent.change(getByLabelText('processors-textarea'), { target: { value: '{\"badJSON\": \"noClosingBracket\"' }});\n+    expect(queryAllByText('Invalid JSON').length === 2);\n+    fireEvent.change(getByLabelText('processors-textarea'), { target: { value: '{\"badJSON\": \"noClosingBracket\"' }});\n+    expect(queryAllByText('Invalid JSON').length === 3);\n+\n+    // Valid JSON\n+    fireEvent.change(getByLabelText('headers-textarea'), { target: { value: '{\"goodJSON\": true}' }});\n+    expect(queryAllByText('Invalid JSON').length === 2);\n+    fireEvent.change(getByLabelText('processors-textarea'), { target: { value: '{\"goodJSON\": true}' }});\n+    expect(queryAllByText('Invalid JSON').length === 1);\n+    fireEvent.change(getByLabelText('processors-textarea'), { target: { value: '{\"goodJSON\": true}' }});\n+    expect(queryAllByText('Invalid JSON').length === 0);\n+\n   });\n \n-  test('Verify read only users cannot edit settings', () => {\n-    const { getByText, getByPlaceholderText, getByRole } = render(<AdvancedSettingsDialog {...data.advancedSettings} canWrite={false} />);\n+  test('Verify read only users cannot edit settings', async () => {\n+    let getByText, getByPlaceholderText;\n+    await act(async () => {\n+      const renderResults = render(\n+        <AdvancedSettingsDialog {...data.advancedMapping} canWrite={false} />\n+      );\n+      getByText = renderResults.getByText;\n+      getByPlaceholderText = renderResults.getByPlaceholderText;\n+    });\n+\n     expect(document.querySelector('#sourceDatabase')).toHaveClass('ant-select-disabled');\n     expect(document.querySelector('#targetDatabase')).toHaveClass('ant-select-disabled');\n     expect(document.querySelector('#additionalColl')).toHaveClass('ant-select-disabled');\n     expect(getByPlaceholderText('Please enter target permissions')).toBeDisabled();\n     expect(getByPlaceholderText('Please enter batch size')).toBeDisabled();\n+    expect(document.querySelector('#headers')).toHaveClass('ant-input-disabled');\n+    expect(document.querySelector('#targetFormat')).toHaveClass('ant-select-disabled');\n     expect(document.querySelector('#provGranularity')).toHaveClass('ant-select-disabled');\n \n+    fireEvent.click(getByText('Processors'));\n+    expect(document.querySelector('#processors')).toHaveClass('ant-input-disabled');\n+\n     fireEvent.click(getByText('Custom Hook'));\n-    expect(getByPlaceholderText('Please enter module')).toBeDisabled();\n-    expect(getByPlaceholderText('Please enter parameters')).toBeDisabled();\n-    expect(getByPlaceholderText('Please enter user information')).toBeDisabled();\n-    expect(getByRole('switch')).toBeDisabled();\n+    expect(document.querySelector('#customHook')).toHaveClass('ant-input-disabled');\n   });\n \n-  test('Verify put is called when Mapping configuration is saved', async () => {\n-    //Enhance this test once DHFPROD-4712 is fixed\n-    axiosMock.put.mockImplementationOnce(jest.fn(() => Promise.resolve({ status: 200, data: {} })));\n-    const { getByText } = render(<AdvancedSettingsDialog {...data.advancedSettings} />);\n+  test('Verify post is called when Mapping settings are saved', async () => {", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUwNTMyNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437505327", "bodyText": "I switched to POST from PUT here because PUT no longer worked for updating the new JSON fields. We should discuss with @ryanjdew and update Advanced Settings (and possibly other) CRUD across app if necessary so we aren't testing verbs unnecessarily.", "author": "wooldridge", "createdAt": "2020-06-09T15:14:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2NjQ5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2ODIxMA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437168210", "bodyText": "Can we remove this.", "author": "bsrikan", "createdAt": "2020-06-09T06:34:40Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.test.tsx", "diffHunk": "@@ -131,16 +131,18 @@ describe(\"Entity Tiles component\", () => {\n       await wait(() => {\n           fireEvent.click(saveButton);\n       });\n-      expect(axiosMock.put).toHaveBeenCalledTimes(1);\n+      expect(axiosMock.post).toHaveBeenCalledTimes(1);\n \n       //Open settings again\n       await wait(() => {\n           fireEvent.click(getByRole(\"settings-mapping\"));\n       })\n-      expect(getByText('Batch Size:')).toBeInTheDocument();\n+\n+      expect(getByText('Batch Size')).toBeInTheDocument();\n       expect(getByPlaceholderText('Please enter batch size')).toHaveValue('50');\n \n       targetPermissions = getByPlaceholderText(\"Please enter target permissions\");\n+      debug();", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2ODQ4NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437168484", "bodyText": "This should be PUT. We have a test using POST in advanced-settings component already.", "author": "bsrikan", "createdAt": "2020-06-09T06:35:15Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.test.tsx", "diffHunk": "@@ -131,16 +131,18 @@ describe(\"Entity Tiles component\", () => {\n       await wait(() => {\n           fireEvent.click(saveButton);\n       });\n-      expect(axiosMock.put).toHaveBeenCalledTimes(1);\n+      expect(axiosMock.post).toHaveBeenCalledTimes(1);", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxMDkxMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437510911", "bodyText": "The advanced-settings component now uses POST, not PUT:\nhttps://github.com/marklogic/marklogic-data-hub/blob/feature/DHFPROD-4969-advanced-settings/marklogic-data-hub-central/ui/src/components/advanced-settings/advanced-settings-dialog.tsx#L148\nFYI: @ryanjdew", "author": "wooldridge", "createdAt": "2020-06-09T15:18:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2ODQ4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2OTE1Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437169153", "bodyText": "This should be PUT. We have a test using POST in advanced-settings component already.", "author": "bsrikan", "createdAt": "2020-06-09T06:37:01Z", "path": "marklogic-data-hub-central/ui/src/components/load/load-list.test.tsx", "diffHunk": "@@ -62,25 +63,25 @@ describe('Load data component', () => {\n     await wait(() => {\n         fireEvent.click(saveButton);\n     });\n-    expect(axiosMock.put).toHaveBeenCalledTimes(1);\n+    expect(axiosMock.post).toHaveBeenCalledTimes(1);", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxMTM0NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437511344", "bodyText": "See above.", "author": "wooldridge", "createdAt": "2020-06-09T15:18:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2OTE1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2OTk5Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437169997", "bodyText": "GET call to /settings should be restored.", "author": "bsrikan", "createdAt": "2020-06-09T06:39:09Z", "path": "marklogic-data-hub-central/ui/src/components/load/load-list.test.tsx", "diffHunk": "@@ -62,25 +63,25 @@ describe('Load data component', () => {\n     await wait(() => {\n         fireEvent.click(saveButton);\n     });\n-    expect(axiosMock.put).toHaveBeenCalledTimes(1);\n+    expect(axiosMock.post).toHaveBeenCalledTimes(1);\n \n     //open settings again\n \n     await wait(() => {\n         fireEvent.click(getByTestId(data.loadData.data[0].name+'-settings'));\n     })\n-    let targetCollection = getByTitle('customerCollection'); // Additional target collection (Added by user)\n+    let targetCollection = getByTitle('addedCollection'); // Additional target collection (Added by user)\n \n     expect(getByText('Advanced Settings')).toBeInTheDocument();\n     // Check if the settings API is being called.\n-    expect(axiosMock.get).toBeCalledWith('/api/steps/ingestion/' + data.loadData.data[0].name + '/settings');\n-    expect(getByText('Target Collections:')).toBeInTheDocument();\n+    expect(axiosMock.get).toBeCalledWith('/api/steps/ingestion/' + data.loadData.data[0].name);", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxNDQ5OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437514499", "bodyText": "This appropriately mocks the (updated) GET endpoint being used in the component:\nhttps://github.com/marklogic/marklogic-data-hub/blob/feature/DHFPROD-4969-advanced-settings/marklogic-data-hub-central/ui/src/components/advanced-settings/advanced-settings-dialog.tsx#L166", "author": "wooldridge", "createdAt": "2020-06-09T15:21:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2OTk5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzODg2NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437638864", "bodyText": "hmm.. Swagger UI shows PUT request. Are we missing something. Everytime we try to update a POST request would overwrite as opposed to update.", "author": "bsrikan", "createdAt": "2020-06-09T18:37:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2OTk5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY1NTc5MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437655791", "bodyText": "I believe the Swagger is not up to date, I think @ryanjdew can describe the change (using POST without the \"/settings\" suffix for Advanced Settings updates). I'm hoping we can update the Swagger (if necessary) as part of this PR.", "author": "wooldridge", "createdAt": "2020-06-09T19:07:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2OTk5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcxMjA5Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437712097", "bodyText": "The POST doesn't wipe out properties that aren't included, so it works for these updates.", "author": "wooldridge", "createdAt": "2020-06-09T20:51:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2OTk5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3MDY2Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437170663", "bodyText": "we need the collection name to be same as the step name since this is a default collection. Must restore.", "author": "bsrikan", "createdAt": "2020-06-09T06:40:48Z", "path": "marklogic-data-hub-central/ui/src/config/load.config.ts", "diffHunk": "@@ -49,10 +55,19 @@ const loadSettings = {\"data\" :\n         \"targetFormat\": \"json\",\n         \"targetDatabase\": \"data-hub-STAGING\",\n         \"collections\": [\n-          \"testLoad\"\n+          \"testCollection\"", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3MTQyOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437171429", "bodyText": "Must restore PUT. We need Delete, Put, Post and Get.", "author": "bsrikan", "createdAt": "2020-06-09T06:42:36Z", "path": "marklogic-data-hub-central/ui/src/config/mocks.config.ts", "diffHunk": "@@ -1,156 +1,220 @@\n import loadData from \"./load.config\";\n import curateData from \"./run.config\";\n-import axiosMock from \"axios\";\n+import advancedData from \"./advanced-settings.config\";\n \n const loadAPI = (axiosMock) => {\n-    axiosMock.delete['mockImplementation']((url) => {\n+  axiosMock.delete['mockImplementation']((url) => {\n+    switch (url) {\n+      case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+        return Promise.resolve(loadData.genericSuccess);\n+      default:\n+        return Promise.reject(new Error('not found'))\n+    }\n+  });\n+  axiosMock.post['mockImplementation']((url) => {", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNDcwNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437534704", "bodyText": "See above and below.", "author": "wooldridge", "createdAt": "2020-06-09T15:46:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3MTQyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3MTg4Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437171887", "bodyText": "Must restore PUT. We need Delete, Put, Post and Get.", "author": "bsrikan", "createdAt": "2020-06-09T06:43:39Z", "path": "marklogic-data-hub-central/ui/src/config/mocks.config.ts", "diffHunk": "@@ -1,156 +1,220 @@\n import loadData from \"./load.config\";\n import curateData from \"./run.config\";\n-import axiosMock from \"axios\";\n+import advancedData from \"./advanced-settings.config\";\n \n const loadAPI = (axiosMock) => {\n-    axiosMock.delete['mockImplementation']((url) => {\n+  axiosMock.delete['mockImplementation']((url) => {\n+    switch (url) {\n+      case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+        return Promise.resolve(loadData.genericSuccess);\n+      default:\n+        return Promise.reject(new Error('not found'))\n+    }\n+  });\n+  axiosMock.post['mockImplementation']((url) => {\n       switch (url) {\n-        case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n-          return Promise.resolve(loadData.genericSuccess);\n-        default:\n-          return Promise.reject(new Error('not found'))\n+          case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+              return Promise.resolve({\n+                  \"data\": {},\n+                  \"status\": 200\n+              });\n+          default:\n+              return Promise.reject(new Error('not found'));\n       }\n-    });\n-    axiosMock.put['mockImplementation']((url) => {\n-        switch (url) {\n-            case '/api/steps/ingestion/' + loadData.loads.data[0].name + '/settings':\n-                return Promise.resolve({\n-                    \"data\": {},\n-                    \"status\": 200\n-                });\n-            default:\n-                return Promise.reject(new Error('not found'));\n-        }\n-    })\n-    return axiosMock.get['mockImplementation']((url) => {\n-      switch (url) {\n-        case '/api/flows':\n-          return Promise.resolve(loadData.flows);\n-        case '/api/steps/ingestion':\n-          return Promise.resolve(loadData.loads);\n-        case '/api/steps/ingestion/' + loadData.loads.data[0].name + '/settings':\n-          return Promise.resolve(loadData.loadSettings);\n-        default:\n-          return Promise.reject(new Error('not found'));\n-      }\n-    })\n-  };\n+  })\n+  return axiosMock.get['mockImplementation']((url) => {\n+    switch (url) {\n+      case '/api/flows':\n+        return Promise.resolve(loadData.flows);\n+      case '/api/steps/ingestion':\n+        return Promise.resolve(loadData.loads);\n+      case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+        return Promise.resolve(loadData.loadSettings);\n+      default:\n+        return Promise.reject(new Error('not found'));\n+    }\n+  })\n+};\n \n-  const curateAPI = (axiosMock) => {\n-    axiosMock.delete['mockImplementation']((url) => {\n-        switch (url) {\n-            case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name:\n-                return Promise.resolve(loadData.genericSuccess);\n-            default:\n-                return Promise.reject(new Error('not found'))\n-        }\n-    });\n-    axiosMock.put['mockImplementation']((url) => {\n-        switch (url) {\n-            case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name + '/settings':\n-                return Promise.resolve({\n-                    \"data\": {},\n-                    \"status\": 200\n-                });\n-            default:\n-                return Promise.reject(new Error('not found'));\n-        }\n-    });\n-    return axiosMock.get['mockImplementation']((url) => {\n-      switch (url) {\n-        case '/api/flows':\n-          return Promise.resolve(curateData.flows)\n-        case '/api/models/primaryEntityTypes':\n-          return Promise.resolve(curateData.primaryEntityTypes);\n-        case '/api/steps/ingestion':\n-          return Promise.resolve(curateData.loads);\n-        case '/api/steps/ingestion/' + loadData.loads.data[0].name + '/settings':\n-          return Promise.resolve(curateData.loadSettings);\n-        case '/api/steps/mapping':\n-          return Promise.resolve(curateData.mappings);\n-        case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name + '/settings':\n-          return Promise.resolve(curateData.mappingSettings);\n-        case '/api/artifacts/matching':\n-          return Promise.resolve(curateData.matchings);\n+const curateAPI = (axiosMock) => {\n+  axiosMock.delete['mockImplementation']((url) => {\n+    switch (url) {\n+      case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+        return Promise.resolve(loadData.genericSuccess);\n+      case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name:\n+        return Promise.resolve(loadData.genericSuccess);\n+      default:\n+        return Promise.reject(new Error('not found'))\n+    }\n+  });\n+  axiosMock.post['mockImplementation']((url) => {", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxNjYzNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437516635", "bodyText": "See above, we don't use PUT now, we use POST:\nhttps://github.com/marklogic/marklogic-data-hub/blob/feature/DHFPROD-4969-advanced-settings/marklogic-data-hub-central/ui/src/components/advanced-settings/advanced-settings-dialog.tsx", "author": "wooldridge", "createdAt": "2020-06-09T15:22:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3MTg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY1ODM1Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437658352", "bodyText": "The /settings endpoints have become redundant with these recent updates to the settings page. The majority of the properties now appear there and @rjrudin made changes to the steps endpoints to only update the properties sent. The middle-tier settings endpoint was calling the same code as the regular step endpoint.", "author": "ryanjdew", "createdAt": "2020-06-09T19:12:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3MTg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY2NjQ5OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437666499", "bodyText": "I am not sure what is the source of truth now to compare the PR against. The JIRA ticket here has all the endpoints.\nhttps://project.marklogic.com/jira/browse/DHFPROD-4951\n@ryanjdew is there a JIRA ticket for the recent updates to settings page you are referring to.", "author": "bsrikan", "createdAt": "2020-06-09T19:27:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3MTg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY2Nzc0OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437667748", "bodyText": "I can still see PUT request when settings are saved:", "author": "bsrikan", "createdAt": "2020-06-09T19:29:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3MTg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc1NjUzOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437756539", "bodyText": "@bsrikan The changes came in this PR: #3936\nThe PUT for /settings was working exactly like the POST \"/api/steps/{stepType}/{stepName}\". The GET for /settings was slightly different because it only contained a subset of properties of the step.", "author": "ryanjdew", "createdAt": "2020-06-09T22:26:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3MTg4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3NDA2Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437174062", "bodyText": "Can delete this block 87-127", "author": "bsrikan", "createdAt": "2020-06-09T06:48:57Z", "path": "marklogic-data-hub-central/ui/src/config/mocks.config.ts", "diffHunk": "@@ -1,156 +1,220 @@\n import loadData from \"./load.config\";\n import curateData from \"./run.config\";\n-import axiosMock from \"axios\";\n+import advancedData from \"./advanced-settings.config\";\n \n const loadAPI = (axiosMock) => {\n-    axiosMock.delete['mockImplementation']((url) => {\n+  axiosMock.delete['mockImplementation']((url) => {\n+    switch (url) {\n+      case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+        return Promise.resolve(loadData.genericSuccess);\n+      default:\n+        return Promise.reject(new Error('not found'))\n+    }\n+  });\n+  axiosMock.post['mockImplementation']((url) => {\n       switch (url) {\n-        case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n-          return Promise.resolve(loadData.genericSuccess);\n-        default:\n-          return Promise.reject(new Error('not found'))\n+          case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+              return Promise.resolve({\n+                  \"data\": {},\n+                  \"status\": 200\n+              });\n+          default:\n+              return Promise.reject(new Error('not found'));\n       }\n-    });\n-    axiosMock.put['mockImplementation']((url) => {\n-        switch (url) {\n-            case '/api/steps/ingestion/' + loadData.loads.data[0].name + '/settings':\n-                return Promise.resolve({\n-                    \"data\": {},\n-                    \"status\": 200\n-                });\n-            default:\n-                return Promise.reject(new Error('not found'));\n-        }\n-    })\n-    return axiosMock.get['mockImplementation']((url) => {\n-      switch (url) {\n-        case '/api/flows':\n-          return Promise.resolve(loadData.flows);\n-        case '/api/steps/ingestion':\n-          return Promise.resolve(loadData.loads);\n-        case '/api/steps/ingestion/' + loadData.loads.data[0].name + '/settings':\n-          return Promise.resolve(loadData.loadSettings);\n-        default:\n-          return Promise.reject(new Error('not found'));\n-      }\n-    })\n-  };\n+  })\n+  return axiosMock.get['mockImplementation']((url) => {\n+    switch (url) {\n+      case '/api/flows':\n+        return Promise.resolve(loadData.flows);\n+      case '/api/steps/ingestion':\n+        return Promise.resolve(loadData.loads);\n+      case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+        return Promise.resolve(loadData.loadSettings);\n+      default:\n+        return Promise.reject(new Error('not found'));\n+    }\n+  })\n+};\n \n-  const curateAPI = (axiosMock) => {\n-    axiosMock.delete['mockImplementation']((url) => {\n-        switch (url) {\n-            case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name:\n-                return Promise.resolve(loadData.genericSuccess);\n-            default:\n-                return Promise.reject(new Error('not found'))\n-        }\n-    });\n-    axiosMock.put['mockImplementation']((url) => {\n-        switch (url) {\n-            case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name + '/settings':\n-                return Promise.resolve({\n-                    \"data\": {},\n-                    \"status\": 200\n-                });\n-            default:\n-                return Promise.reject(new Error('not found'));\n-        }\n-    });\n-    return axiosMock.get['mockImplementation']((url) => {\n-      switch (url) {\n-        case '/api/flows':\n-          return Promise.resolve(curateData.flows)\n-        case '/api/models/primaryEntityTypes':\n-          return Promise.resolve(curateData.primaryEntityTypes);\n-        case '/api/steps/ingestion':\n-          return Promise.resolve(curateData.loads);\n-        case '/api/steps/ingestion/' + loadData.loads.data[0].name + '/settings':\n-          return Promise.resolve(curateData.loadSettings);\n-        case '/api/steps/mapping':\n-          return Promise.resolve(curateData.mappings);\n-        case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name + '/settings':\n-          return Promise.resolve(curateData.mappingSettings);\n-        case '/api/artifacts/matching':\n-          return Promise.resolve(curateData.matchings);\n+const curateAPI = (axiosMock) => {\n+  axiosMock.delete['mockImplementation']((url) => {\n+    switch (url) {\n+      case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+        return Promise.resolve(loadData.genericSuccess);\n+      case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name:\n+        return Promise.resolve(loadData.genericSuccess);\n+      default:\n+        return Promise.reject(new Error('not found'))\n+    }\n+  });\n+  axiosMock.post['mockImplementation']((url) => {\n+    switch (url) {\n+        case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name:\n+            return Promise.resolve({\n+                \"data\": {},\n+                \"status\": 200\n+            });\n         default:\n-          return Promise.reject(new Error('not found'));\n-      }\n-    })\n-  };\n+            return Promise.reject(new Error('not found'));\n+    }\n+  });\n+  return axiosMock.get['mockImplementation']((url) => {\n+    switch (url) {\n+      case '/api/flows':\n+        return Promise.resolve(loadData.flows);\n+      case '/api/models/primaryEntityTypes':\n+        return Promise.resolve(curateData.primaryEntityTypes);\n+      case '/api/steps/ingestion':\n+        return Promise.resolve(loadData.loads);\n+      // case '/api/steps/ingestion/' + loadData.loads.data[0].name + '/settings':\n+      //   return Promise.resolve(loadData.loadSettings);\n+      case '/api/steps/ingestion/' + loadData.loads.data[0].name:\n+        return Promise.resolve(loadData.loadSettings);    \n+      case '/api/steps/mapping':\n+        return Promise.resolve(curateData.mappings);\n+      // case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name + '/settings':\n+      //   return Promise.resolve(curateData.mappingSettings);\n+      case '/api/steps/mapping/' + curateData.mappings.data[0].artifacts[0].name:\n+        return Promise.resolve(curateData.mappingSettings);\n+      case '/api/artifacts/matching':\n+        return Promise.resolve(curateData.matchings);\n+      default:\n+        return Promise.reject(new Error('not found'));\n+    }\n+  })\n+};\n \n-  const runAPI = (axiosMock) => {\n-    return axiosMock.get['mockImplementation']((url) => {\n-      switch (url) {\n-        case '/api/flows':\n-          return Promise.resolve(curateData.flowsWithMapping)\n-        case '/api/steps/ingestion':\n-          return Promise.resolve(curateData.loads);\n-        case '/api/steps/mapping':\n-          return Promise.resolve(curateData.mappings);\n-        case '/api/jobs/e4590649-8c4b-419c-b6a1-473069186592':\n-          return Promise.resolve(curateData.jobRespSuccess)\n-        default:\n-          return Promise.reject(new Error('not found'));\n-      }\n-    })\n-  };\n+// const curateAPI = (axiosMock) => {", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3NDY3Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437174676", "bodyText": "Need tests asserting tooltip text for headers, processors and customHook.", "author": "bsrikan", "createdAt": "2020-06-09T06:50:24Z", "path": "marklogic-data-hub-central/ui/src/config/tooltips.config.js", "diffHunk": "@@ -5,12 +5,12 @@ const AdvancedSettings = {\n     'targetFormat': 'The format of the documents in the target database.',\n     'additionalCollections': 'The collection tags to add to the default tags assigned to the processed document.',\n     'targetPermissions': 'A comma-delimited string that defines permissions required to access the processed document. ' +\n-      'The string must be in the format role,capability,role,capability,..., where capability can be read, insert, update, or execute.',\n-    'module': 'The path to your custom hook module.',\n-    'cHParameters': 'Parameters, as key-value pairs, to pass to your custom hook module.',\n-    'user': 'The user account to use to run the module. The default is the user running the flow; e.g., data-hub-operator.',\n-    'runBefore': 'Choose whether to run the module before or after the core processes of the step.',\n-    /* The following are for *Custom*Tooltips. */\n+    'The string must be in the format role,capability,role,capability,..., where capability can be read, insert, update, or execute.',\n+    'headers': 'A JSON object that represents additional metadata to add to the header section of the envelope of each document.',\n+    'provGranularity': 'The level of detail logged for provenance. Choose *coarse* for the default level or *off* for no provenance logging.',\n+    'processors': 'Custom modules that perform additional processes after the core step processes are completed and before the results are saved.',\n+    'customHook': 'A custom module that performs additional processes in its own transaction before or after the core step transaction. Results are saved within a transaction.',", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyMTU4OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437521589", "bodyText": "Are we testing every tooltip in the app? I think a representative one in a view is sufficient as testing all of them increases the development and maintenance burden for something that's trivial and identically implemented.", "author": "wooldridge", "createdAt": "2020-06-09T15:28:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3NDY3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3NzAwOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437177009", "bodyText": "Need to wrap 28-30 in await act. All other changes to this test must be restored. Edit test shouldnt be removed.", "author": "bsrikan", "createdAt": "2020-06-09T06:55:38Z", "path": "marklogic-data-hub-central/ui/src/pages/Load.test.tsx", "diffHunk": "@@ -25,7 +25,9 @@ describe('Load component', () => {\n         const authorityService = new AuthoritiesService();\n         authorityService.setAuthorities(['readIngestion']);\n \n-        const { getByText, getAllByText, getByLabelText, getByTestId, queryByTestId, queryByText, queryByTitle } = await render(<AuthoritiesContext.Provider value={authorityService}><Load/></AuthoritiesContext.Provider>);\n+        const { getByText, getByTitle, getByLabelText, getByTestId, queryByTestId, queryByText, queryByTitle } = render(", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3Nzc1Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437177757", "bodyText": "Can we pls remove debug.", "author": "bsrikan", "createdAt": "2020-06-09T06:57:16Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.test.tsx", "diffHunk": "@@ -106,7 +106,7 @@ describe(\"Entity Tiles component\", () => {\n       let mapping = data.mappings.data[0].artifacts;\n       const noopFun = () => {};\n       const deleteMappingArtifact = jest.fn(() => {});\n-      const {getByText,getByRole, getByPlaceholderText} = render(\n+      const {getByText,getByRole, getByPlaceholderText, debug} = render(", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3Nzc5Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437477793", "bodyText": "Its better to use variable than string literal for test value.", "author": "bsrikan", "createdAt": "2020-06-09T14:42:22Z", "path": "marklogic-data-hub-central/ui/src/components/load/load-list.test.tsx", "diffHunk": "@@ -62,25 +63,25 @@ describe('Load data component', () => {\n     await wait(() => {\n         fireEvent.click(saveButton);\n     });\n-    expect(axiosMock.put).toHaveBeenCalledTimes(1);\n+    expect(axiosMock.post).toHaveBeenCalledTimes(1);\n \n     //open settings again\n \n     await wait(() => {\n         fireEvent.click(getByTestId(data.loadData.data[0].name+'-settings'));\n     })\n-    let targetCollection = getByTitle('customerCollection'); // Additional target collection (Added by user)\n+    let targetCollection = getByTitle('addedCollection'); // Additional target collection (Added by user)\n \n     expect(getByText('Advanced Settings')).toBeInTheDocument();\n     // Check if the settings API is being called.\n-    expect(axiosMock.get).toBeCalledWith('/api/steps/ingestion/' + data.loadData.data[0].name + '/settings');\n-    expect(getByText('Target Collections:')).toBeInTheDocument();\n+    expect(axiosMock.get).toBeCalledWith('/api/steps/ingestion/' + data.loadData.data[0].name);\n+    expect(getByText('Target Collections')).toBeInTheDocument();\n     expect(targetCollection).toBeInTheDocument(); //Should be available in the document\n-    expect(targetCollection).not.toBe(data.loadData.data[0].name); //Should not be same as the default collection\n-    expect(getByText('Default Collections:')).toBeInTheDocument();\n-    expect(getByTestId(`defaultCollections-${data.loadData.data[0].name}`)).toBeInTheDocument();\n-    expect(queryByTitle(data.loadData.data[0].name)).not.toBeInTheDocument();  // The default collection should not be a part of the Target Collection list\n-    expect(getByText('Batch Size:')).toBeInTheDocument();\n+    expect(targetCollection).not.toBe('testCollection'); //Should not be same as the default collection", "originalCommit": "aca4d2c8782aaa6c85a64d91547eba14d712f428", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxNzc4Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437617782", "bodyText": "This is data received from the mock endpoint and integrated into the DOM. How do I reference that without it being circular test logic?", "author": "wooldridge", "createdAt": "2020-06-09T18:00:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3Nzc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzMzY4OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437633688", "bodyText": "Right. It is a mock data and so we are trying to include a dataset that matches what we will get back from the server. Hence we had collection name matching the step name. Any collection name would work, but to keep with the response server would return we kept it likewise.", "author": "bsrikan", "createdAt": "2020-06-09T18:27:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3Nzc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzNjA4NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437636084", "bodyText": "But how do I put data retrieved from the mock endpoint into a variable for testing as you are asking?", "author": "wooldridge", "createdAt": "2020-06-09T18:32:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3Nzc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzNzMxNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437637315", "bodyText": "Ok. I was referring to \"data.loadData.data[0].name)\" as compared to \"testCollection\".\nThat way the changes will only be in the test data(in one place) and we wont have to touch the test, if test data changes.", "author": "bsrikan", "createdAt": "2020-06-09T18:34:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3Nzc5Mw=="}], "type": "inlineReview"}, {"oid": "af983acf25809ebfbd9236eb1c9860ac32217cb1", "url": "https://github.com/marklogic/marklogic-data-hub/commit/af983acf25809ebfbd9236eb1c9860ac32217cb1", "message": "DHFPROD-4969: Update Advanced Settings with JSON fields\n\nFields: Header Content, Processors, Custom Hook\nFor Load and Mapping steps.\nFix \"unmounted component\" warning and cleanup wrapping\nwith act.", "committedDate": "2020-06-09T18:01:33Z", "type": "forcePushed"}, {"oid": "03cc46d30695e581a896c7b2847fa68c8b586822", "url": "https://github.com/marklogic/marklogic-data-hub/commit/03cc46d30695e581a896c7b2847fa68c8b586822", "message": "DHFPROD-4969: Update Advanced Settings with JSON fields\n\nFields: Header Content, Processors, Custom Hook\nFor Load and Mapping steps.\nFix \"unmounted component\" warning and cleanup wrapping\nwith act.", "committedDate": "2020-06-09T18:25:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0Mjg3Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437642876", "bodyText": "test for edit seems to have been removed.", "author": "bsrikan", "createdAt": "2020-06-09T18:44:17Z", "path": "marklogic-data-hub-central/ui/src/pages/Load.test.tsx", "diffHunk": "@@ -38,38 +40,40 @@ describe('Load component', () => {\n         // test 'Add New' button\n         expect(queryByText('Add New')).not.toBeInTheDocument();\n \n-        //test settings\n-        fireEvent.click(getByTestId('testLoad-settings'));\n-        expect(await(waitForElement(() => getByText('Target Database:')))).toBeInTheDocument();\n-        expect(getAllByText('Save')[0]).toBeDisabled();\n-        fireEvent.click(getAllByText('Cancel')[0]);\n+        // test settings\n+        await act(async () => {\n+            await fireEvent.click(getByTestId('testLoad-settings'));\n+        });\n+        expect(await(waitForElement(() => getByText('Target Database')))).toBeInTheDocument();\n+\n+        expect(getByText('Save')).toBeDisabled();\n+        await act(async () => {\n+            await fireEvent.click(getByText('Cancel'));\n+        });\n+        // test delete\n+        expect(queryByTestId('testLoad-delete')).not.toBeInTheDocument();\n \n         //test edit\n         fireEvent.click(getAllByText('testLoad')[0]);\n-        expect(await(waitForElement(() => getByText('Edit Data Load')))).toBeInTheDocument();\n+        expect(getByText('Edit Data Load')).toBeInTheDocument();\n         expect(getAllByText('Save')[0]).toBeDisabled();\n         fireEvent.click(getAllByText('Cancel')[0]);\n \n-        // test delete\n-        expect(queryByTestId('testLoad-delete')).not.toBeInTheDocument();\n-\n         // Check card layout\n         fireEvent.click(getByLabelText('switch-view-card'));\n \n         // test 'Add New' button\n         expect(queryByText('Add New')).not.toBeInTheDocument();\n \n         // test settings\n-        fireEvent.click(getByLabelText('icon: setting'));\n-        expect(await(waitForElement(() => getByText('Target Database:')))).toBeInTheDocument();\n-        expect(getAllByText('Save')[0]).toBeDisabled();\n-        fireEvent.click(getAllByText('Cancel')[0]);\n-\n-        //test edit\n-        fireEvent.click(getByTestId('testLoad-edit'));\n-        expect(await(waitForElement(() => getByText('Edit Data Load')))).toBeInTheDocument();\n-        expect(getAllByText('Save')[0]).toBeDisabled();\n-        fireEvent.click(getAllByText('Cancel')[0]);\n+        await act(async () => {\n+            await fireEvent.click(getByLabelText('icon: setting'));\n+        });\n+        expect(await(waitForElement(() => getByText('Target Database')))).toBeInTheDocument();\n+        expect(getByText('Save')).toBeDisabled();\n+        await act(async () => {\n+            await fireEvent.click(getByText('Cancel'));\n+        });", "originalCommit": "03cc46d30695e581a896c7b2847fa68c8b586822", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY1NDcxMw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437654713", "bodyText": "Do you mean this?\nhttps://github.com/marklogic/marklogic-data-hub/pull/4058/files#diff-96cd2afde423c81c4d73a3bd147090c4R56", "author": "wooldridge", "createdAt": "2020-06-09T19:05:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0Mjg3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY2MzY3OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4058#discussion_r437663678", "bodyText": "I am viewing the diffs in split view. Maybe that will help.", "author": "bsrikan", "createdAt": "2020-06-09T19:22:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0Mjg3Ng=="}], "type": "inlineReview"}, {"oid": "d7647ee86cbef8f93895b533e37be6e9a776d994", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d7647ee86cbef8f93895b533e37be6e9a776d994", "message": "DHFPROD-4969: Update Advanced Settings with JSON fields\n\nFields: Header Content, Processors, Custom Hook\nFor Load and Mapping steps.\nFix \"unmounted component\" warning and cleanup wrapping\nwith act.", "committedDate": "2020-06-09T21:31:54Z", "type": "forcePushed"}, {"oid": "d90296310f50d36638790a73b264d9a79fab85c7", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d90296310f50d36638790a73b264d9a79fab85c7", "message": "DHFPROD-4969: Update Advanced Settings with JSON fields\n\nFields: Header Content, Processors, Custom Hook\nFor Load and Mapping steps.\nFix \"unmounted component\" warning and cleanup wrapping\nwith act.", "committedDate": "2020-06-09T22:42:14Z", "type": "forcePushed"}, {"oid": "53ed19763b347a22cfeb00807f65ffaaba6eb0b0", "url": "https://github.com/marklogic/marklogic-data-hub/commit/53ed19763b347a22cfeb00807f65ffaaba6eb0b0", "message": "DHFPROD-4969: Update Advanced Settings with JSON fields\n\nFields: Header Content, Processors, Custom Hook\nFor Load and Mapping steps.\nFix \"unmounted component\" warning and cleanup wrapping\nwith act.", "committedDate": "2020-06-09T23:07:49Z", "type": "forcePushed"}, {"oid": "73929fc9bfd9b59516ddc1b6b7a17edda171cdb1", "url": "https://github.com/marklogic/marklogic-data-hub/commit/73929fc9bfd9b59516ddc1b6b7a17edda171cdb1", "message": "DHFPROD-4969: Update Advanced Settings with JSON fields\n\nFields: Header Content, Processors, Custom Hook\nFor Load and Mapping steps.\nFix \"unmounted component\" warning and cleanup wrapping\nwith act.\nCleanup obsolete step settings endpoints", "committedDate": "2020-06-10T00:55:50Z", "type": "commit"}, {"oid": "73929fc9bfd9b59516ddc1b6b7a17edda171cdb1", "url": "https://github.com/marklogic/marklogic-data-hub/commit/73929fc9bfd9b59516ddc1b6b7a17edda171cdb1", "message": "DHFPROD-4969: Update Advanced Settings with JSON fields\n\nFields: Header Content, Processors, Custom Hook\nFor Load and Mapping steps.\nFix \"unmounted component\" warning and cleanup wrapping\nwith act.\nCleanup obsolete step settings endpoints", "committedDate": "2020-06-10T00:55:50Z", "type": "forcePushed"}]}