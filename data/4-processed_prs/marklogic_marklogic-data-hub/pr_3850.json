{"pr_number": 3850, "pr_title": "DHFPROD-4802: Adding authorities to saved-queries artifact", "pr_createdAt": "2020-04-21T01:21:41Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3850", "timeline": [{"oid": "2d66c5914aeee5b571ccb15e2d1e95b9609c5a73", "url": "https://github.com/marklogic/marklogic-data-hub/commit/2d66c5914aeee5b571ccb15e2d1e95b9609c5a73", "message": "DHFPROD-4802: Adding authorities to saved-queries artifact", "committedDate": "2020-04-21T21:29:08Z", "type": "forcePushed"}, {"oid": "3a7c60b3ffc62ad7dff191d20c085d4d272479b7", "url": "https://github.com/marklogic/marklogic-data-hub/commit/3a7c60b3ffc62ad7dff191d20c085d4d272479b7", "message": "DHFPROD-4802: Adding authorities to saved-queries artifact", "committedDate": "2020-04-21T22:03:57Z", "type": "forcePushed"}, {"oid": "fe3a85c8bd6ffaf90cd7e4197bfe55ae7a70e773", "url": "https://github.com/marklogic/marklogic-data-hub/commit/fe3a85c8bd6ffaf90cd7e4197bfe55ae7a70e773", "message": "DHFPROD-4802: Adding authorities to saved-queries artifact", "committedDate": "2020-04-21T22:04:21Z", "type": "commit"}, {"oid": "fe3a85c8bd6ffaf90cd7e4197bfe55ae7a70e773", "url": "https://github.com/marklogic/marklogic-data-hub/commit/fe3a85c8bd6ffaf90cd7e4197bfe55ae7a70e773", "message": "DHFPROD-4802: Adding authorities to saved-queries artifact", "committedDate": "2020-04-21T22:04:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjU2NDY1NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3850#discussion_r412564655", "bodyText": "Pinging @ryanjdew - this is doing what xdmp.securityAssert does, but that needs a privilege. I'll get a PR together that has an example of this.", "author": "rjrudin", "createdAt": "2020-04-21T23:39:01Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/entitySearch/saveSavedQuery.sjs", "diffHunk": "@@ -18,11 +18,18 @@\n declareUpdate();\n \n const ds = require(\"/data-hub/5/data-services/ds-utils.sjs\");\n+const Security = require(\"/data-hub/5/impl/security.sjs\");\n \n var saveQuery;\n var userCollections = [\"http://marklogic.com/data-hub/saved-query\"];\n var queryDocument = JSON.parse(saveQuery);\n \n+let authorized = new Security().getRolesAndAuthorities().authorities.includes(\"canManageSavedQuery\");", "originalCommit": "fe3a85c8bd6ffaf90cd7e4197bfe55ae7a70e773", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIxMzE2MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3850#discussion_r413213161", "bodyText": "One small note, and no need to change (I'm going to approve) - for variables that aren't going to change, prefer \"const\" over \"let\". It makes for more readable code too, as I can see this and know it's never going to change.", "author": "rjrudin", "createdAt": "2020-04-22T18:19:34Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/entitySearch/saveSavedQuery.sjs", "diffHunk": "@@ -18,11 +18,18 @@\n declareUpdate();\n \n const ds = require(\"/data-hub/5/data-services/ds-utils.sjs\");\n+const Security = require(\"/data-hub/5/impl/security.sjs\");\n \n var saveQuery;\n var userCollections = [\"http://marklogic.com/data-hub/saved-query\"];\n var queryDocument = JSON.parse(saveQuery);\n \n+let authorized = new Security().getRolesAndAuthorities().authorities.includes(\"canManageSavedQuery\");", "originalCommit": "fe3a85c8bd6ffaf90cd7e4197bfe55ae7a70e773", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}