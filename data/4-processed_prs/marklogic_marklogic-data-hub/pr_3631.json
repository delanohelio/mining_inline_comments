{"pr_number": 3631, "pr_title": "DHFPROD-4169: Map JSON source data to entity type", "pr_createdAt": "2020-03-02T19:02:19Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3631", "timeline": [{"oid": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e8280a4809b609258a8cfd4347d48e3e5c27c60e", "message": "DHFPROD-4169: Few changes suggested by Julia and added unit test for source to entity map", "committedDate": "2020-03-02T19:40:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxNzkzMg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386617932", "bodyText": "I recommend naming this \"EntityTypes\", assuming that this page will show entity types vs entity instances. I think this is an area where it's not clear which one is meant.", "author": "rjrudin", "createdAt": "2020-03-02T19:59:34Z", "path": "one-ui/ui/src/App.tsx", "diffHunk": "@@ -103,7 +104,7 @@ const App: React.FC<Props> = ({history, location}) => {\n           <LoadData/>\n         </PrivateRoute>\n         <PrivateRoute path=\"/entity-tiles\" exact>\n-          <EntityTiles/>\n+          <Entities/>", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxODA3Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386618077", "bodyText": "Should use \"entityTypeTitle\"", "author": "rjrudin", "createdAt": "2020-03-02T19:59:51Z", "path": "one-ui/ui/src/components/entities/entity-tiles.tsx", "diffHunk": "@@ -47,7 +41,25 @@ const EntityTiles: React.FC = () => {\n           } catch (error) {\n               let message = error;\n               console.log('Error while fetching mapping artifacts', message);\n-              //handleError(error);\n+          }\n+    }\n+\n+    const getMappingArtifactByMapName = async (entityName,mapName) => {", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxODIzNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386718236", "bodyText": "Done.", "author": "xnikhil08", "createdAt": "2020-03-02T23:42:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxODA3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxODYzOA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386618638", "bodyText": "This is a \"mapping\", right? \"entArt\" implies it's an entity model artifact, but the URL indicates it's a mapping.", "author": "rjrudin", "createdAt": "2020-03-02T20:00:52Z", "path": "one-ui/ui/src/components/entities/entity-tiles.tsx", "diffHunk": "@@ -47,7 +41,25 @@ const EntityTiles: React.FC = () => {\n           } catch (error) {\n               let message = error;\n               console.log('Error while fetching mapping artifacts', message);\n-              //handleError(error);\n+          }\n+    }\n+\n+    const getMappingArtifactByMapName = async (entityName,mapName) => {\n+        try {\n+            let response = await axios.get(`/api/artifacts/mapping/${mapName}`);\n+            \n+            if (response.status === 200) {\n+                let entArt = response.data;", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxODI4Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386718282", "bodyText": "Done.", "author": "xnikhil08", "createdAt": "2020-03-02T23:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxODYzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyMTUyMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386621521", "bodyText": "If these console.log messages are going to be retained, I recommend some consistency in them - there's \"Mapping Artifacts\", \"MappingArtifact\", \"Mapping artifact\", and \"mapping artifact\". I believe the term \"artifact\" is redundant here and doesn't need to be used - \"mapping\" should suffice, just like \"step definition\" and \"flow\".", "author": "rjrudin", "createdAt": "2020-03-02T20:07:06Z", "path": "one-ui/ui/src/components/entities/entity-tiles.tsx", "diffHunk": "@@ -63,28 +75,47 @@ const EntityTiles: React.FC = () => {\n             } \n           } catch (error) {\n               let message = error.response.data.message;\n-              console.log('Error while deleting load data artifact.', message);\n+              console.log('Error while deleting mapping artifact.', message);\n               setIsLoading(false);\n-              //handleError(error);\n           }\n     }\n \n     const createMappingArtifact = async (mapObj) => {\n-        console.log('Create API Called!')\n         try {\n             setIsLoading(true);\n       \n             let response = await axios.post(`/api/artifacts/mapping/${mapObj.name}`, mapObj);\n             if (response.status === 200) {\n-              console.log('Create/Update LoadDataArtifact API Called successfully!')\n+              console.log('Create MappingArtifact API Called successfully!')\n               setIsLoading(false);\n+              return true;\n+            } else {\n+                return false;\n             }\n           }\n           catch (error) {\n-            let message = error.response.data.message;\n-            console.log('Error While creating the Load Data artifact!', message)\n+            let message = error;\n+            console.log('Error While creating the Mapping artifact!', message)", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxODM0Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386718347", "bodyText": "Done.", "author": "xnikhil08", "createdAt": "2020-03-02T23:42:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyMTUyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyMjAyOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386622029", "bodyText": "Can this be \"mapping\" instead of \"mapObj\"? \"mapObj\" makes me think it's different from a \"mapping\" in terms of what data it holds. If they're the same, let's only use one term, that's simpler.", "author": "rjrudin", "createdAt": "2020-03-02T20:08:09Z", "path": "one-ui/ui/src/components/entities/entity-tiles.tsx", "diffHunk": "@@ -63,28 +75,47 @@ const EntityTiles: React.FC = () => {\n             } \n           } catch (error) {\n               let message = error.response.data.message;\n-              console.log('Error while deleting load data artifact.', message);\n+              console.log('Error while deleting mapping artifact.', message);\n               setIsLoading(false);\n-              //handleError(error);\n           }\n     }\n \n     const createMappingArtifact = async (mapObj) => {\n-        console.log('Create API Called!')\n         try {\n             setIsLoading(true);\n       \n             let response = await axios.post(`/api/artifacts/mapping/${mapObj.name}`, mapObj);\n             if (response.status === 200) {\n-              console.log('Create/Update LoadDataArtifact API Called successfully!')\n+              console.log('Create MappingArtifact API Called successfully!')\n               setIsLoading(false);\n+              return true;\n+            } else {\n+                return false;\n             }\n           }\n           catch (error) {\n-            let message = error.response.data.message;\n-            console.log('Error While creating the Load Data artifact!', message)\n+            let message = error;\n+            console.log('Error While creating the Mapping artifact!', message)\n             setIsLoading(false);\n-            //handleError(error);\n+            return false;\n+          }\n+    }\n+\n+    const updateMappingArtifact = async (mapObj) => {", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyMzM1OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386623358", "bodyText": "What does \"entities info\" refer to? I'm guessing it's the entityType? If so, then I think this should be \"entityType={props.entityTypes[entMaps.entityType]}\".\nBut I think \"entMaps\" should be renamed as well to something that's more clear. Based on its usage - it has \"entityType\" and \"artifacts\" as properties - I'm guessing it's a collection of things pertaining to an entityType. Perhaps \"entityCardData\" would be better here, as it seems specific to the data needed to display an entity-specific card?", "author": "rjrudin", "createdAt": "2020-03-02T20:11:03Z", "path": "one-ui/ui/src/components/entities/entity-tiles.tsx", "diffHunk": "@@ -95,10 +126,13 @@ const EntityTiles: React.FC = () => {\n             output = <div className={styles.cardView}>\n                 <MappingCard data={entMaps.artifacts}\n                     entityName={entMaps.entityType}\n+                    getMappingArtifactByMapName={getMappingArtifactByMapName}\n                     deleteMappingArtifact={deleteMappingArtifact}\n                     createMappingArtifact={createMappingArtifact}\n-                    canReadWrite={canReadWrite}\n-                    canReadOnly={canReadOnly} />\n+                    updateMappingArtifact={updateMappingArtifact}\n+                    canReadWrite={props.canReadWrite}\n+                    canReadOnly={props.canReadOnly}\n+                    entitiesInfo={props.entitiesInfo[entMaps.entityType]} />", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxMDg2OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386710869", "bodyText": "Done.", "author": "xnikhil08", "createdAt": "2020-03-02T23:21:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyMzM1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNDM1Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386624352", "bodyText": "The user is really constructing a mapping artifact, not an entity. Can we instead say there's a \"source table\" and a \"mapping table\"?", "author": "rjrudin", "createdAt": "2020-03-02T20:13:04Z", "path": "one-ui/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -1,30 +1,47 @@\n-import React, { CSSProperties, useState } from 'react';\n+import React, { CSSProperties, useState, useEffect } from 'react';\n import styles from './mapping-card.module.scss';\n import {Card, Icon, Tooltip, Row, Col, Modal} from 'antd';\n import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n import {faTrashAlt} from '@fortawesome/free-regular-svg-icons';\n import sourceFormatOptions from '../../../config/formats.config';\n-import { convertDateFromISO } from '../../../util/conversionFunctions';\n+import { convertDateFromISO, getInitialChars } from '../../../util/conversionFunctions';\n import CreateEditMappingDialog from './create-edit-mapping-dialog/create-edit-mapping-dialog';\n+import SourceToEntityMap from './source-entity-map/source-to-entity-map';\n+import {getResultsByQuery, getDoc} from '../../../util/search-service'\n \n interface Props {\n     data: any;\n     entityName: any;\n+    getMappingArtifactByMapName: any;\n     deleteMappingArtifact: any;\n     createMappingArtifact: any;\n+    updateMappingArtifact: any;\n     canReadOnly: any;\n     canReadWrite: any;\n+    entitiesInfo: any;\n   }\n \n const MappingCard: React.FC<Props> = (props) => {\n     const [newMap, setNewMap] = useState(false);\n     const [title, setTitle] = useState('');\n     const [mapData, setMapData] = useState({});\n+    const [mapName, setMapName] = useState({});\n     const [dialogVisible, setDialogVisible] = useState(false);\n     const [loadArtifactName, setLoadArtifactName] = useState('');\n+    const [mappingVisible, setMappingVisible] = useState(false);\n+    const [sourceData, setSourceData] = useState<any[]>([]);\n+    const [sourceURI,setSourceURI] = useState('');\n+    const [docNotFound, setDocNotFound] = useState(false);\n+\n+    //For Entity table\n+    const [entityData, setEntityData] = useState<any[]>([]);", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5MTMxMA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386691310", "bodyText": "@rjrudin - I used the name 'EntityData' here because it seems consistent with the UI as we have been calling the right-hand side table in mapping UI as Entity table only.", "author": "xnikhil08", "createdAt": "2020-03-02T22:31:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNDM1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjA1MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386626051", "bodyText": "This seems like implementation details that the GUI shouldn't have to worry about. Could the GUI instead say - Hey middle tier, get me a source document for this step?", "author": "rjrudin", "createdAt": "2020-03-02T20:16:36Z", "path": "one-ui/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -103,6 +110,142 @@ const MappingCard: React.FC<Props> = (props) => {\n         <span style={{fontSize: '16px'}}>Are you sure you want to delete this?</span>\n         </Modal>;\n \n+\n+    const getSourceData = async (index) => {\n+\n+        let database = props.data[index].sourceDatabase || 'data-hub-STAGING';", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcwMTgwMA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386701800", "bodyText": "@rjrudin - This is how it works in the current QS as well. We pass the source database name and Source Query to the middle-tier via the API '/search/sjsSearch' to get the list of URIs and then supply one of those URIs to the endpoint '/search/doc' to get the required Doc.\nIf we want to send only the step number then we will have to redesign this process but the hurdle here is that a mapping artifact will not have a step number unless its added to a flow. Either ways should we take that up in this story itself?", "author": "xnikhil08", "createdAt": "2020-03-02T22:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjA1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzAzMDUyMA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r387030520", "bodyText": "Yes we can revisit later, I may open a ticket to rework this.", "author": "rjrudin", "createdAt": "2020-03-03T13:50:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjA1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNzIzNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386627236", "bodyText": "I recommend \"entityModel\" instead of \"entitiesInfo\" (though why are there two levels of \"definitions\" here?) and then \"entityTypeTitle\" instead of \"entityName\".", "author": "rjrudin", "createdAt": "2020-03-02T20:19:12Z", "path": "one-ui/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -103,6 +110,142 @@ const MappingCard: React.FC<Props> = (props) => {\n         <span style={{fontSize: '16px'}}>Are you sure you want to delete this?</span>\n         </Modal>;\n \n+\n+    const getSourceData = async (index) => {\n+\n+        let database = props.data[index].sourceDatabase || 'data-hub-STAGING';\n+        let sQuery = props.data[index].sourceQuery;\n+        \n+        try{\n+        let response = await getResultsByQuery(database,sQuery,10, true);\n+          if (response.status === 200) {\n+           setSourceURI(response.data[0].uri);\n+           \n+           fetchSrcDocFromUri(response.data[0].uri);\n+        \n+          }\n+        }\n+        catch(error)  {\n+            let message = error;//.response.data.message;\n+            console.log('Error While loading the source data!', message);\n+            setDocNotFound(true);\n+        }\n+           \n+       \n+    }\n+\n+    const fetchSrcDocFromUri = async (uri) => {\n+        try{\n+            let srcDocResp = await getDoc('STAGING', uri);\n+            if (srcDocResp.status === 200) {\n+                let nestedDoc: any = [];\n+                let docRoot = srcDocResp.data['envelope'] ? srcDocResp.data['envelope']['instance'] : srcDocResp.data;\n+                let sDta = generateNestedDataSource(docRoot,nestedDoc);\n+                //setSourceData(prevState => ([ ...prevState, ...sDta]));\n+                setSourceData([...sDta]);\n+            }\n+            } catch(error)  {\n+                let message = error.response.data.message;\n+                console.log('Error While loading the Doc from URI!', message)\n+                setDocNotFound(true);\n+            }\n+    }\n+\n+\n+    // construct infinitely nested source Data\n+    const generateNestedDataSource = (respData, nestedDoc: Array<any>) => {\n+        \n+        Object.keys(respData).map(key => {\n+            let val = respData[key];\n+            if (val != null && val!= \"\") {\n+   \n+                if (val.constructor.name === \"Object\") {\n+     \n+                    let propty = {\n+                        key: key,\n+                        'children': []\n+                    }\n+\n+                    generateNestedDataSource(val, propty.children);\n+                    nestedDoc.push(propty);\n+\n+                } else if (val.constructor.name === \"Array\") {\n+                    //srcData.push({key : key, val: respData[key]})\n+                    \n+                    val.forEach(obj => {\n+                        if(obj.constructor.name == \"String\"){\n+                          let propty = {\n+                            key: key,\n+                            val: obj\n+                          };\n+                          nestedDoc.push(propty);\n+                        } else {\n+                            let propty = {\n+                                key: key,\n+                                children: []\n+                              };\n+                              \n+                          generateNestedDataSource(obj, propty.children);\n+                          nestedDoc.push(propty);\n+                        }\n+                      });\n+\n+                } else {\n+\n+                    let propty = {\n+                        key: key,\n+                        val: String(val)\n+                      };\n+                    nestedDoc.push(propty);\n+                }\n+\n+            } else {\n+\n+                let propty = {\n+                    key: key,\n+                    val: \"\"\n+                  };\n+                nestedDoc.push(propty);\n+            }\n+        });\n+\n+        return nestedDoc;\n+        \n+        \n+        \n+    }\n+    \n+    \n+    const extractEntityInfoForTable = () => {\n+        let entProps = props.entitiesInfo.definitions.definitions[props.entityName].properties;", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxMDcwNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386710704", "bodyText": "Done.", "author": "xnikhil08", "createdAt": "2020-03-02T23:20:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNzIzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNzU1MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386627551", "bodyText": "\"EntityData\" sounds like property values from entity instances. But this is really an array of entity type properties, right? So I'd call it \"setEntityTypeProperties\".", "author": "rjrudin", "createdAt": "2020-03-02T20:19:50Z", "path": "one-ui/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -103,6 +110,142 @@ const MappingCard: React.FC<Props> = (props) => {\n         <span style={{fontSize: '16px'}}>Are you sure you want to delete this?</span>\n         </Modal>;\n \n+\n+    const getSourceData = async (index) => {\n+\n+        let database = props.data[index].sourceDatabase || 'data-hub-STAGING';\n+        let sQuery = props.data[index].sourceQuery;\n+        \n+        try{\n+        let response = await getResultsByQuery(database,sQuery,10, true);\n+          if (response.status === 200) {\n+           setSourceURI(response.data[0].uri);\n+           \n+           fetchSrcDocFromUri(response.data[0].uri);\n+        \n+          }\n+        }\n+        catch(error)  {\n+            let message = error;//.response.data.message;\n+            console.log('Error While loading the source data!', message);\n+            setDocNotFound(true);\n+        }\n+           \n+       \n+    }\n+\n+    const fetchSrcDocFromUri = async (uri) => {\n+        try{\n+            let srcDocResp = await getDoc('STAGING', uri);\n+            if (srcDocResp.status === 200) {\n+                let nestedDoc: any = [];\n+                let docRoot = srcDocResp.data['envelope'] ? srcDocResp.data['envelope']['instance'] : srcDocResp.data;\n+                let sDta = generateNestedDataSource(docRoot,nestedDoc);\n+                //setSourceData(prevState => ([ ...prevState, ...sDta]));\n+                setSourceData([...sDta]);\n+            }\n+            } catch(error)  {\n+                let message = error.response.data.message;\n+                console.log('Error While loading the Doc from URI!', message)\n+                setDocNotFound(true);\n+            }\n+    }\n+\n+\n+    // construct infinitely nested source Data\n+    const generateNestedDataSource = (respData, nestedDoc: Array<any>) => {\n+        \n+        Object.keys(respData).map(key => {\n+            let val = respData[key];\n+            if (val != null && val!= \"\") {\n+   \n+                if (val.constructor.name === \"Object\") {\n+     \n+                    let propty = {\n+                        key: key,\n+                        'children': []\n+                    }\n+\n+                    generateNestedDataSource(val, propty.children);\n+                    nestedDoc.push(propty);\n+\n+                } else if (val.constructor.name === \"Array\") {\n+                    //srcData.push({key : key, val: respData[key]})\n+                    \n+                    val.forEach(obj => {\n+                        if(obj.constructor.name == \"String\"){\n+                          let propty = {\n+                            key: key,\n+                            val: obj\n+                          };\n+                          nestedDoc.push(propty);\n+                        } else {\n+                            let propty = {\n+                                key: key,\n+                                children: []\n+                              };\n+                              \n+                          generateNestedDataSource(obj, propty.children);\n+                          nestedDoc.push(propty);\n+                        }\n+                      });\n+\n+                } else {\n+\n+                    let propty = {\n+                        key: key,\n+                        val: String(val)\n+                      };\n+                    nestedDoc.push(propty);\n+                }\n+\n+            } else {\n+\n+                let propty = {\n+                    key: key,\n+                    val: \"\"\n+                  };\n+                nestedDoc.push(propty);\n+            }\n+        });\n+\n+        return nestedDoc;\n+        \n+        \n+        \n+    }\n+    \n+    \n+    const extractEntityInfoForTable = () => {\n+        let entProps = props.entitiesInfo.definitions.definitions[props.entityName].properties;\n+        let entTableTempData: any = [];\n+        entProps.map(prop => {\n+            let propty = {\n+                name : prop.name,\n+                type : prop.datatype\n+            }\n+            entTableTempData.push(propty)\n+        })\n+        setEntityData([...entTableTempData]);", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxMDU3Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386710577", "bodyText": "Done", "author": "xnikhil08", "createdAt": "2020-03-02T23:20:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNzU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyOTM0Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386629343", "bodyText": "Is \"Exp\" short for \"Expression\" here? If so, I think since \"mapExpression\" is used below, use \"mapExpression\" here too.", "author": "rjrudin", "createdAt": "2020-03-02T20:23:33Z", "path": "one-ui/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.module.scss", "diffHunk": "@@ -0,0 +1,214 @@\n+\n+.mapContainer{\n+    //padding: 40px 200px 100px 40px;\n+    //margin-bottom: 100px;\n+    height: 100%;\n+    top: 8vh;\n+    //box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);\n+}\n+.header{\n+    display:inline-flex;\n+}\n+.headerTitle{\n+    font-size: 1.5em;\n+    width: fit-content;\n+    //border: 1px solid red;\n+}\n+\n+.saveMessage{\n+    //width: fit-content;\n+    border: 1px solid #ff0000;\n+    margin-left: 30em;\n+}\n+.noMessage{\n+    padding: 2.25vh 0vh;\n+}\n+.parentContainer{\n+    display: flex;\n+    flex-direction: row;\n+    padding-bottom: 2vh;\n+    padding-top: 1vh;\n+}\n+\n+.sourceContainer{\n+    width: auto;\n+    height: auto;\n+    flex: 4;\n+    display: flex;\n+    flex-direction: column;\n+    padding-right: 20px;\n+    word-break: break-all;\n+}\n+\n+.sourceTable {\n+    & thead > tr > th {\n+        background-color: #fafafa;\n+        line-height: 2px;\n+      };\n+    & tbody > tr > td {\n+        line-height: 2px;\n+    }\n+}\n+.srcTableRows{\n+    line-height: 1px;\n+}\n+\n+.entityContainer{\n+    width: auto;\n+    flex: 9;\n+    display: flex;\n+    flex-direction: column;\n+    padding-right: 20px;\n+    word-break: break-all;\n+}\n+\n+.entityTable {\n+    & thead > tr > th {\n+        background-color: #fafafa;\n+        line-height: 2px;\n+      };\n+    & tbody > tr > td {\n+        line-height: 2px;\n+        vertical-align: top;\n+    }\n+}\n+\n+.mapExpContainer {", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxMzUzOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386713539", "bodyText": "Done.", "author": "xnikhil08", "createdAt": "2020-03-02T23:28:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyOTM0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyOTU4MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386629581", "bodyText": "Since \"source\" is used above, use \"source\" instead of \"src\" for consistency here. I don't think there's ever going to be a reason to abbreviate \"source\" or \"entity\".", "author": "rjrudin", "createdAt": "2020-03-02T20:24:03Z", "path": "one-ui/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.module.scss", "diffHunk": "@@ -0,0 +1,214 @@\n+\n+.mapContainer{\n+    //padding: 40px 200px 100px 40px;\n+    //margin-bottom: 100px;\n+    height: 100%;\n+    top: 8vh;\n+    //box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);\n+}\n+.header{\n+    display:inline-flex;\n+}\n+.headerTitle{\n+    font-size: 1.5em;\n+    width: fit-content;\n+    //border: 1px solid red;\n+}\n+\n+.saveMessage{\n+    //width: fit-content;\n+    border: 1px solid #ff0000;\n+    margin-left: 30em;\n+}\n+.noMessage{\n+    padding: 2.25vh 0vh;\n+}\n+.parentContainer{\n+    display: flex;\n+    flex-direction: row;\n+    padding-bottom: 2vh;\n+    padding-top: 1vh;\n+}\n+\n+.sourceContainer{\n+    width: auto;\n+    height: auto;\n+    flex: 4;\n+    display: flex;\n+    flex-direction: column;\n+    padding-right: 20px;\n+    word-break: break-all;\n+}\n+\n+.sourceTable {\n+    & thead > tr > th {\n+        background-color: #fafafa;\n+        line-height: 2px;\n+      };\n+    & tbody > tr > td {\n+        line-height: 2px;\n+    }\n+}\n+.srcTableRows{", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxNDE4NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386714185", "bodyText": "Done", "author": "xnikhil08", "createdAt": "2020-03-02T23:30:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyOTU4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYzMTY3MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386631671", "bodyText": "I recommend renaming \"/api/entities\" to \"/api/entityTypes\" and then using \"entityTypes\" here instead of \"entData\" and \"entitiesInfo\".", "author": "rjrudin", "createdAt": "2020-03-02T20:28:10Z", "path": "one-ui/ui/src/pages/Entities.tsx", "diffHunk": "@@ -0,0 +1,55 @@\n+import React, { useState, useContext, useEffect } from 'react';\n+import { Collapse, Menu } from 'antd';\n+import styles from './Entities.module.scss';\n+import { RolesContext } from '../util/roles';\n+import axios from 'axios'\n+import EntityTiles from '../components/entities/entity-tiles';\n+\n+const Entities: React.FC = () => {\n+\n+    useEffect(() => {\n+        getEntityInfo();\n+    },[]);\n+\n+    const [entitiesInfo, setEntitiesInfo] = useState<any[]>([]);\n+    \n+    //Role based access\n+    const roleService = useContext(RolesContext);\n+    const canReadOnly = roleService.canReadMappings();\n+    const canReadWrite = roleService.canWriteMappings();\n+\n+    const getEntityInfo = async () => {\n+        try {\n+        let response = await axios.get(`/api/entities`);\n+        if(response.status === 200) {\n+            let entData:any = {};", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxNjYwOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386716609", "bodyText": "i renamed entityInfo to entityModel and also changed the corresponding temporary variables to maintain consistency. And since we have been using the api '/api/entities' in current QS as well so we may want to use the same naming conventions here as well right?", "author": "xnikhil08", "createdAt": "2020-03-02T23:37:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYzMTY3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYzMjM5OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386632398", "bodyText": "Can this be reworked to accept a flow name and step number? I'd be happy to make the DS endpoint to implement this, as this seems like too much implementation detail in the GUI.", "author": "rjrudin", "createdAt": "2020-03-02T20:29:34Z", "path": "one-ui/ui/src/util/search-service.tsx", "diffHunk": "@@ -0,0 +1,32 @@\n+import axios from 'axios'\n+\n+const getResultsByQuery = async (database: string, ctsQuery: string, count: number, urisOnly: boolean) => {", "originalCommit": "e8280a4809b609258a8cfd4347d48e3e5c27c60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxODExNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3631#discussion_r386718117", "bodyText": "@rjrudin - We can definitely create an endpoint later which accepts only flow name and step number and returns the documents but in this case the mapping artifact is not part of any particular flow unless its added to it, as per the new one-ui design. So we might need to think about it in detail in another story.", "author": "xnikhil08", "createdAt": "2020-03-02T23:41:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYzMjM5OA=="}], "type": "inlineReview"}, {"oid": "a93b6166c99f788dfb92b6a09ffc6a1284c04a34", "url": "https://github.com/marklogic/marklogic-data-hub/commit/a93b6166c99f788dfb92b6a09ffc6a1284c04a34", "message": "DHFPROD-4169: Standardizing naming conventions based on new entity model and Rob's comments", "committedDate": "2020-03-02T23:51:22Z", "type": "forcePushed"}, {"oid": "d7c3faa6830ce5aaec7e2a31b594a378ca2b9350", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d7c3faa6830ce5aaec7e2a31b594a378ca2b9350", "message": "DHFPROD-4169: Initial layout of Source to Entity Mapping", "committedDate": "2020-03-04T17:57:30Z", "type": "commit"}, {"oid": "2ffccc7d98992dadbfb7c890326ba05c801f544a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/2ffccc7d98992dadbfb7c890326ba05c801f544a", "message": "DHFPROD-4169: More progress on source to Entity mapping", "committedDate": "2020-03-04T17:57:30Z", "type": "commit"}, {"oid": "895618bce8a5097f7abc2167709c22ff47a10d68", "url": "https://github.com/marklogic/marklogic-data-hub/commit/895618bce8a5097f7abc2167709c22ff47a10d68", "message": "DHFPROD-4169: Adding more changes for the Source Table and Entity Table", "committedDate": "2020-03-04T17:57:30Z", "type": "commit"}, {"oid": "d0cf5be1e7055de76cf1b7bbc30e5831db4903cd", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d0cf5be1e7055de76cf1b7bbc30e5831db4903cd", "message": "DHFPROD-4169: More changes for Entity table component.", "committedDate": "2020-03-04T17:57:30Z", "type": "commit"}, {"oid": "a299ed090f34564660d535bf05c241f807227554", "url": "https://github.com/marklogic/marklogic-data-hub/commit/a299ed090f34564660d535bf05c241f807227554", "message": "DHFPROD-4169: Nested JSON properties support - WIP", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "94a531b360493ca49ae20af8b8b318b241b003a6", "url": "https://github.com/marklogic/marklogic-data-hub/commit/94a531b360493ca49ae20af8b8b318b241b003a6", "message": "DHFPROD-4169: Implement support for deeply nested source data", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "baf1bc4f4ca47a06d100f4cd9393c43a80a98e09", "url": "https://github.com/marklogic/marklogic-data-hub/commit/baf1bc4f4ca47a06d100f4cd9393c43a80a98e09", "message": "DHFPROD-4169: Finalizing the nested source data related changes", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "0dba0037886675f76d7bd85a5650e46191b53fc5", "url": "https://github.com/marklogic/marklogic-data-hub/commit/0dba0037886675f76d7bd85a5650e46191b53fc5", "message": "DHFPROD-4311: UI: Develop Entity table component", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "a6a4bbd7479f33dac9eba7f63e542993c972d10a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/a6a4bbd7479f33dac9eba7f63e542993c972d10a", "message": "DHFPROD-4169: fixing some bugs", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "0b775917652eefecb091a3a281b9699aa61e368b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/0b775917652eefecb091a3a281b9699aa61e368b", "message": "DHFPROD-4169: Refractoring UI code for entities to better split the components", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "4b14160c56316ffe535814736cb1e1dc6899c1f1", "url": "https://github.com/marklogic/marklogic-data-hub/commit/4b14160c56316ffe535814736cb1e1dc6899c1f1", "message": "DHFPROD-4169: Changes for the sub-task DHFPROD-4312", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "80ed8ca0078803246335927307565c91167a5e02", "url": "https://github.com/marklogic/marklogic-data-hub/commit/80ed8ca0078803246335927307565c91167a5e02", "message": "DHFPROD-4169: Removing package-lock.json", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "f098022450d68b73243b51c521318c0f3ef143e7", "url": "https://github.com/marklogic/marklogic-data-hub/commit/f098022450d68b73243b51c521318c0f3ef143e7", "message": "DHFPROD-4169: Few changes suggested by Julia and added unit test for source to entity map", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "b93899dc4e2b3aa486d0eebab6d74b9afe1c71ef", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b93899dc4e2b3aa486d0eebab6d74b9afe1c71ef", "message": "DHFPROD-4169: Standardizing naming conventions based on new entity model and Rob's comments", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "c6309bfbbad355db62486239e2f8c69934eb8129", "url": "https://github.com/marklogic/marklogic-data-hub/commit/c6309bfbbad355db62486239e2f8c69934eb8129", "message": "DHFPROD-4169: Remove extra layer of definitions", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "aa996e88e32f39fec29cd3ef98a9e0dfe1a860e0", "url": "https://github.com/marklogic/marklogic-data-hub/commit/aa996e88e32f39fec29cd3ef98a9e0dfe1a860e0", "message": "DHFPROD-4169: Fixing the UI code after middle tier change", "committedDate": "2020-03-04T17:57:31Z", "type": "commit"}, {"oid": "aa996e88e32f39fec29cd3ef98a9e0dfe1a860e0", "url": "https://github.com/marklogic/marklogic-data-hub/commit/aa996e88e32f39fec29cd3ef98a9e0dfe1a860e0", "message": "DHFPROD-4169: Fixing the UI code after middle tier change", "committedDate": "2020-03-04T17:57:31Z", "type": "forcePushed"}, {"oid": "7b5d57ff1a86bf9dc137de42c1a0bae721cacef7", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7b5d57ff1a86bf9dc137de42c1a0bae721cacef7", "message": "DHFPROD-4169: Fix type-checking issues", "committedDate": "2020-03-04T22:29:41Z", "type": "commit"}]}