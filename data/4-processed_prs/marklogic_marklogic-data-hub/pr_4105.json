{"pr_number": 4105, "pr_title": "DHFPROD-4970: add validate entity field to mapping step", "pr_createdAt": "2020-06-16T22:34:32Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4105", "timeline": [{"oid": "65b5461817b40cc28022fde94bbb0e28e00f8a41", "url": "https://github.com/marklogic/marklogic-data-hub/commit/65b5461817b40cc28022fde94bbb0e28e00f8a41", "message": "DHFPROD-4970: Add Validate entity field to Mapping step", "committedDate": "2020-06-16T22:49:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5MDkzOA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4105#discussion_r441190938", "bodyText": "Can't we get the default value for 'validateEntity' from backend only, instead of UI figuring it out based on its value in the API response. We can set it in UI as well but we need to be sure that its value will be 'false' in the response only the first time when the step is created.\nIt will be a bit cleaner to just set its default value in backend where the settings object is created for any step. Then UI will only care about the its value in the GET response.", "author": "xnikhil08", "createdAt": "2020-06-16T23:08:15Z", "path": "marklogic-data-hub-central/ui/src/components/advanced-settings/advanced-settings-dialog.tsx", "diffHunk": "@@ -179,6 +185,7 @@ const AdvancedSettingsDialog = (props) => {\n           setTargetPermissions(response.data.permissions);\n           setTargetFormat(response.data.targetFormat);\n           setProvGranularity(response.data.provenanceGranularityLevel);\n+          response.data.validateEntity === false ? setValidateEntity(defaultValidateEntity):setValidateEntity(response.data.validateEntity) ;", "originalCommit": "65b5461817b40cc28022fde94bbb0e28e00f8a41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5NTE1Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4105#discussion_r441195153", "bodyText": "@AkshayBajajML You can set default values for the mapping step here: \n  \n    \n      marklogic-data-hub/marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/mapping.sjs\n    \n    \n         Line 84\n      in\n      c2e7097\n    \n    \n    \n    \n\n        \n          \n           function defaultArtifact(artifactName, entityTypeId) {", "author": "ryanjdew", "createdAt": "2020-06-16T23:21:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5MDkzOA=="}], "type": "inlineReview"}, {"oid": "75ab8f04a461d3d8e4ff3a2f95777de0d9ae3e9c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/75ab8f04a461d3d8e4ff3a2f95777de0d9ae3e9c", "message": "DHFPROD-4970: Add Validate entity field to Mapping step", "committedDate": "2020-06-17T22:28:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM2Mjc3MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4105#discussion_r442362770", "bodyText": "You shouldn't change these files. These are generated by running generateJsonSchema2Pojo gradle task . If you want this changed, you will have to update schema and run this task.", "author": "srinathgit", "createdAt": "2020-06-18T16:43:30Z", "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/schemas/StepSchema.java", "diffHunk": "@@ -81,32 +81,32 @@\n     private String stepDefinitionName;\n     /**\n      * Optional description fo the step\n-     * \n+     *\n      */\n     @JsonProperty(\"description\")\n     @JsonPropertyDescription(\"Optional description fo the step\")\n     private String description;\n     /**\n      * This is generated on the server-side\n-     * \n+     *\n      */\n     @JsonProperty(\"stepId\")\n     @JsonPropertyDescription(\"This is generated on the server-side\")\n     private String stepId;\n     /**\n      * Any properties in this object will be copied into the headers of each document processed by the step\n-     * \n+     *\n      */\n     @JsonProperty(\"headers\")\n     @JsonPropertyDescription(\"Any properties in this object will be copied into the headers of each document processed by the step\")\n     private Headers headers;\n     /**\n      * Applicable to mapping steps only\n-     * \n+     *\n      */\n     @JsonProperty(\"validateEntity\")\n     @JsonPropertyDescription(\"Applicable to mapping steps only\")\n-    private Boolean validateEntity;\n+    private String validateEntity;", "originalCommit": "75ab8f04a461d3d8e4ff3a2f95777de0d9ae3e9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM2MzIzMw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4105#discussion_r442363233", "bodyText": "same comment as earlier for all the edits made in this file", "author": "srinathgit", "createdAt": "2020-06-18T16:44:17Z", "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/schemas/StepSchema.java", "diffHunk": "@@ -332,19 +332,19 @@ public void setHeaders(Headers headers) {\n \n     /**\n      * Applicable to mapping steps only\n-     * \n+     *\n      */\n     @JsonProperty(\"validateEntity\")\n-    public Boolean getValidateEntity() {\n+    public String getValidateEntity() {\n         return validateEntity;\n     }\n \n     /**\n      * Applicable to mapping steps only\n-     * \n+     *\n      */\n     @JsonProperty(\"validateEntity\")\n-    public void setValidateEntity(Boolean validateEntity) {\n+    public void setValidateEntity(String validateEntity) {", "originalCommit": "75ab8f04a461d3d8e4ff3a2f95777de0d9ae3e9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM3MTU3Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4105#discussion_r442371577", "bodyText": "Can you add a test to ensure that tooltip shows up fine in the UI ?", "author": "srinathgit", "createdAt": "2020-06-18T16:58:16Z", "path": "marklogic-data-hub-central/ui/src/components/advanced-settings/advanced-settings-dialog.test.tsx", "diffHunk": "@@ -137,6 +142,13 @@ describe('Advanced Step Settings dialog', () => {\n     fireEvent.select(provOptions[1]);\n     expect(getByText('Off')).toBeInTheDocument();\n \n+    //Verifying entity validation options select field\n+    fireEvent.click(getByText('Do not validate'));\n+    const entValOptions = getAllByTestId('entityValOpts').map(li => li);\n+    expect(entValOptions.map(li => li.textContent).toString()).toEqual('Do not validate,Store validation errors in entity headers,Skip documents with validation  errors');\n+    fireEvent.select(provOptions[1]);\n+    expect(getByText('Store validation errors in entity headers')).toBeInTheDocument();\n+", "originalCommit": "75ab8f04a461d3d8e4ff3a2f95777de0d9ae3e9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM3MzQ5OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4105#discussion_r442373499", "bodyText": "I am not sure if \"notValidate\" sounds good for the value of this property.\n@ryanjdew , @rjrudin,\nIs this value good ? , if not, any suggestions for the value for this property ? How does \"none\" sound like ?", "author": "srinathgit", "createdAt": "2020-06-18T17:01:43Z", "path": "marklogic-data-hub/src/main/resources/hub-internal-artifacts/step-definitions/mapping/marklogic/entity-services-mapping.step.json", "diffHunk": "@@ -15,7 +15,7 @@\n       \"default-mapping\",\n       \"mdm-content\"\n     ],\n-    \"validateEntity\": false,\n+    \"validateEntity\": \"notValidate\",", "originalCommit": "75ab8f04a461d3d8e4ff3a2f95777de0d9ae3e9c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM4ODEyOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4105#discussion_r442388129", "bodyText": "\"doNotValidate\" would be more closely aligned with UI", "author": "ryanjdew", "createdAt": "2020-06-18T17:27:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM3MzQ5OQ=="}], "type": "inlineReview"}, {"oid": "3dba38f20e3a27778e9713dbf7903a0fc9a346a6", "url": "https://github.com/marklogic/marklogic-data-hub/commit/3dba38f20e3a27778e9713dbf7903a0fc9a346a6", "message": "DHFPROD-4970: Add Validate entity field to Mapping step", "committedDate": "2020-06-18T20:05:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUyOTQzMw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4105#discussion_r442529433", "bodyText": "You will have to update the data type in schema json file and the run 'generateJsonSchema2Pojo' task , so that it's updated from Boolean to String", "author": "srinathgit", "createdAt": "2020-06-18T22:09:56Z", "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/schemas/StepSchema.java", "diffHunk": "@@ -332,7 +332,7 @@ public void setHeaders(Headers headers) {\n \n     /**\n      * Applicable to mapping steps only\n-     * \n+     *\n      */\n     @JsonProperty(\"validateEntity\")\n     public Boolean getValidateEntity() {", "originalCommit": "3dba38f20e3a27778e9713dbf7903a0fc9a346a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "becd28be5530a8602e18d904f3f6444a86496797", "url": "https://github.com/marklogic/marklogic-data-hub/commit/becd28be5530a8602e18d904f3f6444a86496797", "message": "DHFPROD-4970: Add Validate entity field to Mapping step", "committedDate": "2020-06-18T23:43:41Z", "type": "forcePushed"}, {"oid": "78380b1a3f4f3b77149040f3e8fbc744e4cd547f", "url": "https://github.com/marklogic/marklogic-data-hub/commit/78380b1a3f4f3b77149040f3e8fbc744e4cd547f", "message": "DHFPROD-4970: Add Validate entity field to Mapping step", "committedDate": "2020-06-19T22:54:20Z", "type": "commit"}, {"oid": "78380b1a3f4f3b77149040f3e8fbc744e4cd547f", "url": "https://github.com/marklogic/marklogic-data-hub/commit/78380b1a3f4f3b77149040f3e8fbc744e4cd547f", "message": "DHFPROD-4970: Add Validate entity field to Mapping step", "committedDate": "2020-06-19T22:54:20Z", "type": "forcePushed"}]}