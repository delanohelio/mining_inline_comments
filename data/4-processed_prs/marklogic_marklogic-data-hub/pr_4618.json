{"pr_number": 4618, "pr_title": "DHFPROD-5665: Run match step with new schema", "pr_createdAt": "2020-09-24T22:49:05Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4618", "timeline": [{"oid": "5c94b01d7f5fcdd5b2b880117982432c7c786443", "url": "https://github.com/marklogic/marklogic-data-hub/commit/5c94b01d7f5fcdd5b2b880117982432c7c786443", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-09-25T16:54:50Z", "type": "forcePushed"}, {"oid": "bc29d8396d210a67dff969c91f9c154d4f871463", "url": "https://github.com/marklogic/marklogic-data-hub/commit/bc29d8396d210a67dff969c91f9c154d4f871463", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-01T23:26:05Z", "type": "forcePushed"}, {"oid": "576e3e4b3e65e817aad69b619ae2b45bcab562cf", "url": "https://github.com/marklogic/marklogic-data-hub/commit/576e3e4b3e65e817aad69b619ae2b45bcab562cf", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-02T17:42:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxMjYzNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#discussion_r499612637", "bodyText": "I highly recommend slimming down the test data to the bare minimum needed. For example, only include properties used for matching - anything else is just noise that makes the test more difficult to understand. Same thing goes for test data - only insert the documents you need to verify that e.g. 2 docs match, but a 3rd doc does not match.", "author": "rjrudin", "createdAt": "2020-10-05T13:49:15Z", "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/smart-mastering/entity-driven/test-data/entities/Customer.entity.json", "diffHunk": "@@ -0,0 +1,98 @@\n+{", "originalCommit": "576e3e4b3e65e817aad69b619ae2b45bcab562cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxMzUzOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#discussion_r499613539", "bodyText": "Is inserting data via a match action something we'd encourage? I ask because I'm wondering if we can eventually shift to a model where everything to be written gets stored in-memory first and then is written after all step processing has finished.", "author": "rjrudin", "createdAt": "2020-10-05T13:50:28Z", "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/smart-mastering/entity-driven/test-data/householdAction.sjs", "diffHunk": "@@ -0,0 +1,15 @@\n+'use strict';\n+\n+const sem = require(\"/MarkLogic/semantics.xqy\");\n+const householdPredicateIRI = sem.iri('http://marklogic.com/datahub/test/household#memberOf');\n+\n+function householdAction(uri, matches, options) {\n+    declareUpdate();\n+    const allURIs = [uri].concat(matches.map((match) => match.uri)).sort();\n+    const householdIRI = sem.iri(`http://marklogic.com/datahub/test/household/${xdmp.md5(allURIs)}`);\n+    sem.rdfInsert(allURIs.map((uri) => sem.triple(sem.iri(uri), householdPredicateIRI, householdIRI)));", "originalCommit": "576e3e4b3e65e817aad69b619ae2b45bcab562cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxNTAyNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#discussion_r499615025", "bodyText": "If this test fails, it'll be very helpful to know why 8 matches are expected, and which 8 they are. Otherwise, a developer has to figure out themselves what should match and what should not.", "author": "rjrudin", "createdAt": "2020-10-05T13:52:27Z", "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/smart-mastering/matching/include-matches.xqy", "diffHunk": "@@ -19,7 +19,7 @@ return (\n     test:assert-equal(1, fn:count($def-match/@threshold[. = \"Definitive Match\"])),\n     test:assert-equal(1, fn:count($def-match/@action[. = $constants:MERGE-ACTION])),\n     test:assert-exists($def-match/matches),\n-    test:assert-equal(7, fn:count($def-match/matches/match))\n+    test:assert-equal(8, fn:count($def-match/matches/match), \"Wrong count of matches: \" || xdmp:describe($def-match, (), ()) )", "originalCommit": "576e3e4b3e65e817aad69b619ae2b45bcab562cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNDU1Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#discussion_r499914556", "bodyText": "Added tests for the individual matches as well that makes it more clear.", "author": "ryanjdew", "createdAt": "2020-10-05T22:52:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxNTAyNQ=="}], "type": "inlineReview"}, {"oid": "183da17c35ca8244fbd33a5f7d312ba3bfec4d0a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/183da17c35ca8244fbd33a5f7d312ba3bfec4d0a", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-05T22:49:29Z", "type": "forcePushed"}, {"oid": "70bd0a6b919af5eb735547d84c58a5b3963a96d2", "url": "https://github.com/marklogic/marklogic-data-hub/commit/70bd0a6b919af5eb735547d84c58a5b3963a96d2", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-05T23:02:43Z", "type": "forcePushed"}, {"oid": "22bb6413a501071f50911618482d44aaa1258b14", "url": "https://github.com/marklogic/marklogic-data-hub/commit/22bb6413a501071f50911618482d44aaa1258b14", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-05T23:03:39Z", "type": "forcePushed"}, {"oid": "2f93545f05de551d67b010517dfd92b85e259427", "url": "https://github.com/marklogic/marklogic-data-hub/commit/2f93545f05de551d67b010517dfd92b85e259427", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-06T16:46:02Z", "type": "forcePushed"}, {"oid": "6f9d89429070d828d579a065a349c186f4ef6018", "url": "https://github.com/marklogic/marklogic-data-hub/commit/6f9d89429070d828d579a065a349c186f4ef6018", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-07T15:22:00Z", "type": "forcePushed"}, {"oid": "53028044b758d36204f8fdd8aab776f01fe9012b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/53028044b758d36204f8fdd8aab776f01fe9012b", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-07T20:19:44Z", "type": "forcePushed"}, {"oid": "517531814d251bd6df0fdcdcdfaa7e6b44c33dee", "url": "https://github.com/marklogic/marklogic-data-hub/commit/517531814d251bd6df0fdcdcdfaa7e6b44c33dee", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-08T15:52:06Z", "type": "commit"}, {"oid": "517531814d251bd6df0fdcdcdfaa7e6b44c33dee", "url": "https://github.com/marklogic/marklogic-data-hub/commit/517531814d251bd6df0fdcdcdfaa7e6b44c33dee", "message": "DHFPROD-5665: Run match step with new schema", "committedDate": "2020-10-08T15:52:06Z", "type": "forcePushed"}]}