{"pr_number": 3530, "pr_title": "DHFPROD-4255: Fix example projects to run in pipeline", "pr_createdAt": "2020-01-30T19:34:34Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3530", "timeline": [{"oid": "7577ac66e62f65fad18cb3e45c81b6147b1d208e", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7577ac66e62f65fad18cb3e45c81b6147b1d208e", "message": "DHFPROD-4255: Fix example projects to run in pipeline\n\nAdded gradlew to the project\n\nFixing errors to run mapping-example project\n\nFixing errors with custom-hook example\n\nFixing errors with dh-5-example project\n\nUpdated the input path\n\nRemoving mlhost", "committedDate": "2020-01-30T20:20:33Z", "type": "commit"}, {"oid": "7577ac66e62f65fad18cb3e45c81b6147b1d208e", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7577ac66e62f65fad18cb3e45c81b6147b1d208e", "message": "DHFPROD-4255: Fix example projects to run in pipeline\n\nAdded gradlew to the project\n\nFixing errors to run mapping-example project\n\nFixing errors with custom-hook example\n\nFixing errors with dh-5-example project\n\nUpdated the input path\n\nRemoving mlhost", "committedDate": "2020-01-30T20:20:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIwOTQ0Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3530#discussion_r373209443", "bodyText": "Can we use anything other than admin/admin to run the flow.", "author": "bsrikan", "createdAt": "2020-01-30T21:43:45Z", "path": "Jenkinsfile", "diffHunk": "@@ -534,11 +534,25 @@ pipeline{\n             stage('dh5-example'){\n                  agent { label 'dhfLinuxAgent'}\n                 steps{\n+                     sh 'cd $WORKSPACE/data-hub/examples/dh-5-example;repo=\"    maven {url \\'http://distro.marklogic.com/nexus/repository/maven-snapshots/\\'}\";sed -i \"/repositories {/a$repo\" build.gradle; '\n                      copyRPM 'Release','10.0-3'\n                      script{\n                         props = readProperties file:'data-hub/pipeline.properties';\n                         def dockerhost=setupMLDockerCluster 3\n-                        sh 'docker exec -u builder -i '+dockerhost+' /bin/sh -c \"export JAVA_HOME=`eval echo \"$JAVA_HOME_DIR\"`;export GRADLE_USER_HOME=$WORKSPACE$GRADLE_DIR;export M2_HOME=$MAVEN_HOME/bin;export PATH=$GRADLE_USER_HOME:$PATH:$MAVEN_HOME/bin;cd $WORKSPACE/data-hub/examples/dh-5-example;rm -rf $GRADLE_USER_HOME/caches;./gradlew clean;set +e;./gradlew -i hubInit -Ptesting=true;./gradlew -i mlDeploy -Ptesting=true;./gradlew hubRunFlow -PflowName=ingestion_only-flow -Ptesting=true;./gradlew hubRunFlow -PflowName=ingestion_mapping-flow -Ptesting=true;./gradlew hubRunFlow -PflowName=ingestion_mapping_mastering-flow -Ptesting=true;\"'\n+                        sh '''\n+                            docker exec -u builder -i '''+dockerhost+''' /bin/sh -c \"export JAVA_HOME=`eval echo \"$JAVA_HOME_DIR\"`;\\\n+                            export GRADLE_USER_HOME=$WORKSPACE$GRADLE_DIR; \\\n+                            export M2_HOME=$MAVEN_HOME/bin; \\\n+                            export PATH=$GRADLE_USER_HOME:$PATH:$MAVEN_HOME/bin; \\\n+                            cd $WORKSPACE/data-hub/examples/dh-5-example; \\\n+                            rm -rf $GRADLE_USER_HOME/caches; \\\n+                            ./gradlew -i hubInit -Ptesting=true; \\\n+                            ./gradlew -i mlDeploy -Ptesting=true -PmlUsername=admin -PmlPassword=admin; \\\n+                            ./gradlew hubRunFlow -PflowName=ingestion_only-flow -Ptesting=true -PmlUsername=admin -PmlPassword=admin; \\\n+                            ./gradlew hubRunFlow -PflowName=ingestion_mapping-flow -Ptesting=true -PmlUsername=admin -PmlPassword=admin; \\\n+                            ./gradlew hubRunFlow -PflowName=ingestion_mapping_mastering-flow -Ptesting=true -PmlUsername=admin -PmlPassword=admin;\n+                            \"", "originalCommit": "7577ac66e62f65fad18cb3e45c81b6147b1d208e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIxNDE2NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3530#discussion_r373214165", "bodyText": "how can I do that? Instead of editing the gradle properties file. I'm passing the params.", "author": "SameeraPriyathamTadikonda", "createdAt": "2020-01-30T21:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIwOTQ0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIzODUxMA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3530#discussion_r373238510", "bodyText": "We can maintain a copy of gradle.properties to be used across examples. Paste that over to the project directory after hubinit, then mlDeploy as admin by passing credentials via params and run the flow, so mlUsername credentials in the gradle props file will be used.", "author": "bsrikan", "createdAt": "2020-01-30T22:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIwOTQ0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI3MDkzMA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3530#discussion_r373270930", "bodyText": "Copying gradle.properties file from marklogic-datahub and running the flows as flow developer.", "author": "SameeraPriyathamTadikonda", "createdAt": "2020-01-31T00:53:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIwOTQ0Mw=="}], "type": "inlineReview"}, {"oid": "a1810c191e3512824d6875a64f2406e6e9c669c6", "url": "https://github.com/marklogic/marklogic-data-hub/commit/a1810c191e3512824d6875a64f2406e6e9c669c6", "message": "DHFPROD-4255: Run flows as flow developer", "committedDate": "2020-01-31T00:51:17Z", "type": "commit"}]}