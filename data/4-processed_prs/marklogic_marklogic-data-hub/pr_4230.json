{"pr_number": 4230, "pr_title": "DHFPROD-5017: Enable sorting for entity properties marked sortable via modeling", "pr_createdAt": "2020-07-17T18:30:06Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4230", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYyNDMwMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4230#discussion_r456624301", "bodyText": "For this, you can do $search-range-node/*[local-name(.) != \"facet\"] instead of a for loop", "author": "rjrudin", "createdAt": "2020-07-17T19:05:43Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/impl/hub-entities.xqy", "diffHunk": "@@ -192,22 +192,42 @@ declare %private function hent:fix-options-exp($nodes as node()*)\n               <search:facet-option>descending</search:facet-option>\n             </search:range>\n           </search:constraint>,\n-          hent:fix-options-exp($n/node())\n+          hent:fix-options-exp($n/node(), $sortable-properties)\n+        }\n+      case element(search:constraint) return\n+        element { fn:node-name($n) } {\n+          $n/@*,\n+          let $constraint-name :=\n+            for $attribute in $n/attribute()\n+              where $attribute/name() = \"name\"\n+              return $attribute\n+          let $search-range-node := $n/search:range\n+          return if (fn:empty($search-range-node) or fn:not(map:contains($sortable-properties, xs:string($constraint-name)))) then\n+            hent:fix-options-exp($n/node(), $sortable-properties)\n+            else\n+              element {fn:node-name($search-range-node)} {\n+                for $attribute in $search-range-node/attribute()\n+                  let $name := $attribute/name()", "originalCommit": "5aa4f3154049324963026c3907dc6fdba776571b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc1MTkwMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4230#discussion_r456751901", "bodyText": "$search-range-node/*[local-name(.) != \"facet\"] is returning the child elements. But, $search-range-node/attribute()[not(name()='facet')] is returning the attributes of the element search-range-node. Replaced for loop with this xpath", "author": "rahulvudutala", "createdAt": "2020-07-18T05:26:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYyNDMwMQ=="}], "type": "inlineReview"}, {"oid": "c85e46ca1fc3b9526907ad1429a55aeb7a27b814", "url": "https://github.com/marklogic/marklogic-data-hub/commit/c85e46ca1fc3b9526907ad1429a55aeb7a27b814", "message": "DHFPROD-5017: Enable sorting for entity properties marked sortable via modeling\n\nDHFPROD-5017: removing src/main/entity-config/databases reference from gitignore in reference-entity-model\n\nDHFPROD-5017: Adding sortable properties to Customer entity model", "committedDate": "2020-07-18T05:16:20Z", "type": "commit"}, {"oid": "c85e46ca1fc3b9526907ad1429a55aeb7a27b814", "url": "https://github.com/marklogic/marklogic-data-hub/commit/c85e46ca1fc3b9526907ad1429a55aeb7a27b814", "message": "DHFPROD-5017: Enable sorting for entity properties marked sortable via modeling\n\nDHFPROD-5017: removing src/main/entity-config/databases reference from gitignore in reference-entity-model\n\nDHFPROD-5017: Adding sortable properties to Customer entity model", "committedDate": "2020-07-18T05:16:20Z", "type": "forcePushed"}]}