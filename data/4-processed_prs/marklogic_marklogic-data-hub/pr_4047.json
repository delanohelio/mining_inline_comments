{"pr_number": 4047, "pr_title": "DHFPROD-4671: Test updates", "pr_createdAt": "2020-06-03T16:22:09Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4047", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcxMzE5MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#discussion_r434713191", "bodyText": "@xnikhil08 if you get a chance, please try this test out with getByText('Save') and getByText('Cancel') by replacing ByAll.\nFor some reason when I fireEvent.click on 'Save'/'Cancel' with edit alongwith settings it fails with \"found multiple\"", "author": "bsrikan", "createdAt": "2020-06-03T16:50:04Z", "path": "marklogic-data-hub-central/ui/src/pages/Curate.test.tsx", "diffHunk": "@@ -1,9 +1,98 @@\n-import React from 'react';\n-import { shallow } from 'enzyme';\n-import Curate from './Curate';\n-\n-describe('Install component', () => {\n-  it('should render correctly', () => {\n-    shallow(<Curate />);\n-  });\n-});\n\\ No newline at end of file\n+import React, {useContext} from 'react';\n+import {render, fireEvent, waitForElement, cleanup} from '@testing-library/react'\n+import '@testing-library/jest-dom/extend-expect'\n+import {AuthoritiesContext, AuthoritiesService} from '../util/authorities';\n+import axiosMock from 'axios';\n+import mocks from '../config/mocks.config';\n+import Curate from \"./Curate\";\n+\n+jest.mock('axios');\n+\n+describe('Curate component', () => {\n+\n+    beforeEach(() => {\n+        mocks.curateAPI(axiosMock);\n+    });\n+\n+    afterEach(() => {\n+        jest.clearAllMocks();\n+        cleanup();\n+    })\n+\n+    test('Verify readMapping authority can only view mapping configs and settings', async () => {\n+        const authorityService = new AuthoritiesService();\n+        authorityService.setAuthorities(['readMapping']);\n+\n+        const { getByText, getAllByText, queryByText, getByTestId, queryByTestId, debug } = await render(<AuthoritiesContext.Provider value={authorityService}><Curate/></AuthoritiesContext.Provider>);\n+\n+        expect(await(waitForElement(() => getByText('Customer')))).toBeInTheDocument();\n+\n+        // Check for steps to be populated\n+        expect(axiosMock.get).toBeCalledWith('/api/steps/mapping');\n+        fireEvent.click(getByText('Customer'));\n+        //Mapping tab should show. Match/Merge should not\n+        expect(getByText('Mapping')).toBeInTheDocument();\n+        expect(queryByText('Match')).not.toBeInTheDocument();\n+        expect(queryByText('Merge')).not.toBeInTheDocument();\n+\n+        expect(getByText('Mapping1')).toBeInTheDocument();\n+\n+        // test 'Add New' button\n+        expect(queryByText('Add New')).not.toBeInTheDocument();\n+\n+        // test settings\n+        fireEvent.click(getByTestId('Mapping1-settings'));\n+        expect(await(waitForElement(() => getByText('Target Database:')))).toBeInTheDocument();\n+        expect(getAllByText('Save')[0]).toBeDisabled();", "originalCommit": "a8b2e43313f3a5e6db076e23ccf26aa4279a07c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUyMTI4MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#discussion_r435521281", "bodyText": "@bsrikan - Fixed this issue in the PR (bsrikan#5) against your branch.", "author": "xnikhil08", "createdAt": "2020-06-04T20:11:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcxMzE5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU4NTMyNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#discussion_r435585324", "bodyText": "Thanks @xnikhil08 for the changes.\nAs described by Nikhil: \"Once you open the settings or edit modal, then it will remain open and when you click on cancel or Save then the parent modal gets a property display: none,\nbut the component remains in the document\"\nHence we have updated the tests to use data-testid.", "author": "bsrikan", "createdAt": "2020-06-04T22:23:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcxMzE5MQ=="}], "type": "inlineReview"}, {"oid": "6188ab337c5c69fb4427fb1b4f6a32e36ac17ffc", "url": "https://github.com/marklogic/marklogic-data-hub/commit/6188ab337c5c69fb4427fb1b4f6a32e36ac17ffc", "message": "DHFPROD-4673: More tests for mapping-reader", "committedDate": "2020-06-05T19:59:17Z", "type": "commit"}, {"oid": "c98d72ac0b4ffddf59aaf8214457fcd0ffaf1c2f", "url": "https://github.com/marklogic/marklogic-data-hub/commit/c98d72ac0b4ffddf59aaf8214457fcd0ffaf1c2f", "message": "DHFPROD-4671,DHFPROD-4672,DHFPROD-4673 and DHFPROD-4674: Test fixes and updates to load and curate", "committedDate": "2020-06-05T20:22:09Z", "type": "commit"}, {"oid": "41ff62c4e0642e06a806648c3232946dca6250ab", "url": "https://github.com/marklogic/marklogic-data-hub/commit/41ff62c4e0642e06a806648c3232946dca6250ab", "message": "test/mapping: Fixing the curation tests (#5)", "committedDate": "2020-06-05T20:22:09Z", "type": "commit"}, {"oid": "41ff62c4e0642e06a806648c3232946dca6250ab", "url": "https://github.com/marklogic/marklogic-data-hub/commit/41ff62c4e0642e06a806648c3232946dca6250ab", "message": "test/mapping: Fixing the curation tests (#5)", "committedDate": "2020-06-05T20:22:09Z", "type": "forcePushed"}]}