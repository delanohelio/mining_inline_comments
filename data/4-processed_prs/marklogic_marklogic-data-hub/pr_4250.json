{"pr_number": 4250, "pr_title": "DHFPROD-5018: Tests to check generation of index config and search options for already existing indexes", "pr_createdAt": "2020-07-21T00:12:00Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4250", "timeline": [{"oid": "2f41f3e14398491ec4cd21e1b8b09b60fb684175", "url": "https://github.com/marklogic/marklogic-data-hub/commit/2f41f3e14398491ec4cd21e1b8b09b60fb684175", "message": "DHFPROD-5017: Tests to check generation of index config and search options for already existing indexes", "committedDate": "2020-07-21T00:04:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA2OTkwMg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4250#discussion_r458069902", "bodyText": "I know this line was already here, but why should it matter if the property is facetable or not? If the property is marked facetable=true and sortable=true, it looks like it won't be added to the map, right? But the two don't have anything to do with one another.", "author": "rjrudin", "createdAt": "2020-07-21T12:50:00Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/impl/hub-entities.xqy", "diffHunk": "@@ -590,9 +590,9 @@ declare %private function hent:add-indexes-for-entity-properties($entities as js\n                   fn:not(fn:starts-with(map:get($items, \"$ref\"), \"#\")) and\n                   map:get($entity-type-properties, $entity-type-property)=>map:get(\"sortable\")\n             let $_ :=\n-                let $title-property := fn:concat($entity-title, \".\", $entity-type-property)\n+                let $title-property-path := fn:concat(\"//es:instance\", \"/\", $entity-title, \"/\", $entity-type-property)\n                 where $is-sortable and fn:not($is-facetable)\n-                return map:put($sortable-properties, $title-property, \"\")\n+                return map:put($sortable-properties, $title-property-path, \"\")", "originalCommit": "2f41f3e14398491ec4cd21e1b8b09b60fb684175", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyNTM1OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4250#discussion_r458225359", "bodyText": "We have by default facet values set to true in the search options. So it returns search options for all indexes unless the facet=false is set for the range constraint.\n<search:return-facets>true</search:return-facets>\nAs per DHFPROD-5017 and DHFPROD-5018, facets should be enabled only for facetable properties and indexes from structured entityType properties and disabled for sortable properties.\nSo the map contains the values that are sortable and not facetable, so that when a node is reached in the fix-exp-options and a path exists in the map, the facet=false attribute is set on the range constraint", "author": "rahulvudutala", "createdAt": "2020-07-21T16:21:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA2OTkwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyNzUzNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4250#discussion_r458227537", "bodyText": "I believe this statement from 5017 - \"If a property has been marked as \"sortable\" but not \"facetable\", then the user should be able to sort on the property but not be able to use it as a facet.\" - only means that it's possible for a property to be sortable but not facetable. But it's not required that a property be not facetable in order for it to be facetable. That is - if a property is sortable=true and facetable=true, we should see both a facet for it and the ability to sort it.", "author": "rjrudin", "createdAt": "2020-07-21T16:24:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA2OTkwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIzMjM5OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4250#discussion_r458232399", "bodyText": "Yes. The following happens now. There are tests included for this scenario. The title entityProperty is both sortable and facetable and facet=true attribute is set on the range constraint and it will also have the ability to sort.\n\nThat is - if a property is sortable=true and facetable=true, we should see both a facet for it and the ability to sort it.", "author": "rahulvudutala", "createdAt": "2020-07-21T16:32:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA2OTkwMg=="}], "type": "inlineReview"}]}