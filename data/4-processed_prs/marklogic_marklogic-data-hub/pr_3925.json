{"pr_number": 3925, "pr_title": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component", "pr_createdAt": "2020-05-07T23:30:14Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3925", "timeline": [{"oid": "311326f13ffb964afc92e60f99747efec0da15ab", "url": "https://github.com/marklogic/marklogic-data-hub/commit/311326f13ffb964afc92e60f99747efec0da15ab", "message": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Rearranging the comments and code in the test case for Function dropdown (+1 squashed commit)\nSquashed commits:\n[c752dc86a] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Fixing the failing test (+1 squashed commit)\nSquashed commits:\n[2f9a9abee] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\nDHFPROD-4185: Test for Function dropdown (+1 squashed commit)\nSquashed commits:\n[72115fb02] DHFPROD-4185: Fixing the event bubbling issue in dropdown component", "committedDate": "2020-05-08T19:49:07Z", "type": "forcePushed"}, {"oid": "18a9931edad821bdb04834dc0cbf578c7a5e7591", "url": "https://github.com/marklogic/marklogic-data-hub/commit/18a9931edad821bdb04834dc0cbf578c7a5e7591", "message": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Rearranging the comments and code in the test case for Function dropdown (+1 squashed commit)\nSquashed commits:\n[c752dc86a] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Fixing the failing test (+1 squashed commit)\nSquashed commits:\n[2f9a9abee] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\nDHFPROD-4185: Test for Function dropdown (+1 squashed commit)\nSquashed commits:\n[72115fb02] DHFPROD-4185: Fixing the event bubbling issue in dropdown component", "committedDate": "2020-05-08T19:49:53Z", "type": "commit"}, {"oid": "18a9931edad821bdb04834dc0cbf578c7a5e7591", "url": "https://github.com/marklogic/marklogic-data-hub/commit/18a9931edad821bdb04834dc0cbf578c7a5e7591", "message": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Rearranging the comments and code in the test case for Function dropdown (+1 squashed commit)\nSquashed commits:\n[c752dc86a] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Fixing the failing test (+1 squashed commit)\nSquashed commits:\n[2f9a9abee] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\nDHFPROD-4185: Test for Function dropdown (+1 squashed commit)\nSquashed commits:\n[72115fb02] DHFPROD-4185: Fixing the event bubbling issue in dropdown component", "committedDate": "2020-05-08T19:49:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3NzM1MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3925#discussion_r421977351", "bodyText": "concat is already available in the expression. So lets look for some other function which isnt in the document already", "author": "bsrikan", "createdAt": "2020-05-08T06:59:17Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.test.tsx", "diffHunk": "@@ -482,6 +482,74 @@ describe('RTL Source-to-entity map tests', () => {\n         expect(onClosestTableRow(firstName)?.style.display).toBe('none');\n         expect(onClosestTableRow(lastName)?.style.display).toBe('none');\n     });\n+    \n+    test('Function selector dropdown in entity table', async () => {\n+\n+        axiosMock.post['mockImplementation'](jest.fn(() => Promise.resolve({ status: 200, data: data.testJSONResponseWithFunctions })));\n+        const { getByText, getByTestId, getAllByRole, debug, queryByText } = render(<SourceToEntityMap {...data.mapProps} mappingVisible={true} />);\n+\n+        //Prepare the map expression field for function signature later\n+        let propAttributeExpression = getByTestId('propAttribute-mapexpression')\n+        fireEvent.change(propAttributeExpression, { target: { value: \"\" } });\n+        fireEvent.blur(propAttributeExpression);\n+\n+        //Grab and click on the function (fx) button\n+        let functionSelector = getByTestId(\"propAttribute-3-functionIcon\");\n+        fireEvent.click(functionSelector);\n+\n+        await (waitForElement(() => getAllByRole(\"option\"), { \"timeout\": 200 }))\n+        let concat = getByText(\"concat\");\n+        let documentLookup = getByText('documentLookup');\n+        //Both of the functions below should be visible\n+        expect(concat).toBeInTheDocument();\n+        expect(documentLookup).toBeInTheDocument();\n+\n+        //Search input box to look for functions\n+        let inputBox = getByText(\n+            (_content, element) =>\n+                element.className != null &&\n+                element.className === \"ant-select-search__field\"\n+        );\n+\n+        fireEvent.click(inputBox) // focus on the search box\n+\n+        // Filter out the funcitons list to get to concat function\n+        fireEvent.change(inputBox, { target: { value: \"conc\" } }); \n+\n+        expect(concat).toBeInTheDocument(); // Still should be visible\n+        expect(queryByText('documentLookup')).not.toBeInTheDocument(); // Should not be visible since we filtered only concat\n+\n+        //Choose the concat function\n+        fireEvent.keyDown(inputBox, { key: 'Enter', code: 'Enter', keyCode: 13, charCode: 13 })\n+\n+        //Map Expression is populated with function signature\n+        expect(propAttributeExpression).toHaveTextContent(\"concat(xs:anyAtomicType?)\");\n+\n+         //Click again on the same function button to verify if it opens up again with the list of functions\n+         fireEvent.click(functionSelector);\n+         await (waitForElement(() => getAllByRole(\"option\"), { \"timeout\": 200 }));\n+         //Function should be visible again\n+         expect(concat).toBeInTheDocument();", "originalCommit": "c752dc86a740290fdde0f03bf10bc06a8d784dcf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM3MzgwNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3925#discussion_r422373806", "bodyText": "Done", "author": "xnikhil08", "createdAt": "2020-05-08T21:04:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3NzM1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwOTM3Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3925#discussion_r422209377", "bodyText": "Can we change this to \"Lookup\" to verify multiple matches are returned", "author": "bsrikan", "createdAt": "2020-05-08T15:28:54Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.test.tsx", "diffHunk": "@@ -482,6 +482,74 @@ describe('RTL Source-to-entity map tests', () => {\n         expect(onClosestTableRow(firstName)?.style.display).toBe('none');\n         expect(onClosestTableRow(lastName)?.style.display).toBe('none');\n     });\n+    \n+    test('Function selector dropdown in entity table', async () => {\n+\n+        axiosMock.post['mockImplementation'](jest.fn(() => Promise.resolve({ status: 200, data: data.testJSONResponseWithFunctions })));\n+        const { getByText, getByTestId, getAllByRole, debug, queryByText } = render(<SourceToEntityMap {...data.mapProps} mappingVisible={true} />);\n+\n+        //Prepare the map expression field for function signature later\n+        let propAttributeExpression = getByTestId('propAttribute-mapexpression')\n+        fireEvent.change(propAttributeExpression, { target: { value: \"\" } });\n+        fireEvent.blur(propAttributeExpression);\n+\n+        //Grab and click on the function (fx) button\n+        let functionSelector = getByTestId(\"propAttribute-3-functionIcon\");\n+        fireEvent.click(functionSelector);\n+\n+        await (waitForElement(() => getAllByRole(\"option\"), { \"timeout\": 200 }))\n+        let concat = getByText(\"concat\");\n+        let documentLookup = getByText('documentLookup');\n+        //Both of the functions below should be visible\n+        expect(concat).toBeInTheDocument();\n+        expect(documentLookup).toBeInTheDocument();\n+\n+        //Search input box to look for functions\n+        let inputBox = getByText(\n+            (_content, element) =>\n+                element.className != null &&\n+                element.className === \"ant-select-search__field\"\n+        );\n+\n+        fireEvent.click(inputBox) // focus on the search box\n+\n+        // Filter out the funcitons list to get to concat function\n+        fireEvent.change(inputBox, { target: { value: \"conc\" } }); ", "originalCommit": "c752dc86a740290fdde0f03bf10bc06a8d784dcf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM3Mzg3MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3925#discussion_r422373870", "bodyText": "Done", "author": "xnikhil08", "createdAt": "2020-05-08T21:04:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwOTM3Nw=="}], "type": "inlineReview"}]}