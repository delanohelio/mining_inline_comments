{"pr_number": 4017, "pr_title": "DHFPROD-4452: Add editing capability for entity type description", "pr_createdAt": "2020-05-28T17:46:52Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4017", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1MDQ3OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4017#discussion_r432050479", "bodyText": "I keep seeing this code repeated in the UI - couldn't this be in some sort of \"common\" library and reused, perhaps as a callback/promise so that if hasOwnProperty('message') is true, then the caller determines what to do, with the common function providing the value of error['response']['data']['message']?", "author": "rjrudin", "createdAt": "2020-05-28T18:52:54Z", "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-modal/entity-type-modal.tsx", "diffHunk": "@@ -47,51 +57,74 @@ const EntityTypeModal: React.FC<Props> = (props) => {\n     if (event.target.id === 'description') {\n       setDescription(event.target.value);\n     }\n-  }\n+  };\n \n   const onOk = (event) => {\n     event.preventDefault();\n-    if (!NAME_REGEX.test(name)) {\n-      setErrorMessage(ModelingTooltips.addEntityName)\n+    if (props.isEditModal) {\n+      updateEntityDescription(name, description);\n     } else {\n-      createEntityType(name, description);\n+      if (!NAME_REGEX.test(name)) {\n+        setErrorMessage(ModelingTooltips.addEntityName)\n+      } else {\n+        createEntityType(name, description);\n+      }\n+    }\n+  };\n+\n+  const updateEntityDescription = async (name: string, description: string) => {\n+    try {\n+      const response = await updateModelInfo(name, description);\n+      if (response['status'] === 200) {\n+        props.updateEntityTypesAndHideModal();\n+      }\n+    } catch (error) {\n+      if (error.response.status === 400) {", "originalCommit": "ea964753f9acca47c16d3a0cefa903269d089b7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA3MTY1Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4017#discussion_r432071656", "bodyText": "Good point.\n@rjrudin, @brucean52, what do you think about this?\n  const sendAndHandle = (requestFunction, errorFunction) => {\n    try {\n      requestFunction();\n    } catch (error) {\n      if (error.response.status === 400) {\n        if (error.response.data.hasOwnProperty('message')) {\n          errorFunction(error['response']['data']['message']);\n        }\n      } else {\n        handleError(error);\n      }\n    } finally {\n      resetSessionTime();\n    }\n  };\n\nWe can then use the requestFunction to make the request, open/close modal, etc. Similary we can also use errorFunction to set error message, open/close modal, etc.", "author": "akshaysonvane", "createdAt": "2020-05-28T19:32:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1MDQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1ODQ2NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4017#discussion_r432158465", "bodyText": "I think this could work, but make the errorFunction conditional more generic to support more customization", "author": "brucean52", "createdAt": "2020-05-28T22:26:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1MDQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYyNjk0MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4017#discussion_r432626940", "bodyText": "After a couple of discussions, @brucean52  and I came down with the following function:\nfunction sendAndHandle(requestFunction, errorFunction, resetSessionTime) {\n  try {\n    requestFunction();\n  } catch (error) {\n    errorFunction(error);\n  } finally {\n    resetSessionTime();\n  }\n}\nexport default sendAndHandle;\n\nThe entire catch block is replaced with errorFunction(error); in order to support more customization and we need to pass in the resetSessionTime function since useContext hook for resetSessionTime only works in react components and this isn't one.\nAt this point, this just seems to be a try/catch handler and it doesn't seem worth adding it to a common library.", "author": "akshaysonvane", "createdAt": "2020-05-29T17:17:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1MDQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1NDAyOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4017#discussion_r432654029", "bodyText": "This seems like it could be part of that facade library we've discussed - i.e. where ideally, every HTTP call goes through a very narrow chunk of code that can handle generic concerns for every HTTP call.", "author": "rjrudin", "createdAt": "2020-05-29T18:10:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1MDQ3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1OTQwNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4017#discussion_r432159407", "bodyText": "Going by the wireframe, Edit is supposed to have the Entity Type name as text, not as a disabled input", "author": "brucean52", "createdAt": "2020-05-28T22:29:28Z", "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-modal/entity-type-modal.tsx", "diffHunk": "@@ -102,7 +135,7 @@ const EntityTypeModal: React.FC<Props> = (props) => {\n         <Form.Item\n           className={styles.formItem}\n           label={<span>\n-            Name:&nbsp;<span className={styles.asterisk}>*</span>\n+            Name:&nbsp;{props.isEditModal ? null : <span className={styles.asterisk}>*</span>}", "originalCommit": "ea964753f9acca47c16d3a0cefa903269d089b7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYzMDE1NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4017#discussion_r432630154", "bodyText": "Good catch. Updated in here: 66a106c", "author": "akshaysonvane", "createdAt": "2020-05-29T17:23:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1OTQwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE2MDUzNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4017#discussion_r432160535", "bodyText": "Please add CSS to make this look similar to the instance link. ( color change, cursor: pointer )", "author": "brucean52", "createdAt": "2020-05-28T22:32:51Z", "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-table/entity-type-table.tsx", "diffHunk": "@@ -23,15 +24,24 @@ const EntityTypeTable: React.FC<Props> = (props) => {\n       title: 'Name',\n       dataIndex: 'name',\n       width: 400,\n-      // TODO - Edit Entity DHFPROD-4452\n       render: text => {\n+        let parseText = text.split(',');\n+        let entityName = parseText[0];\n+        let entityDescription = parseText[1];\n+\n         return (\n           <Tooltip title={ModelingTooltips.entityTypeName}>\n-            <span data-testid={text + '-span'}>{text}</span>\n+            <span data-testid={text + '-span'}", "originalCommit": "ea964753f9acca47c16d3a0cefa903269d089b7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYzMDE3OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4017#discussion_r432630179", "bodyText": "Updated in here: 66a106c", "author": "akshaysonvane", "createdAt": "2020-05-29T17:23:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE2MDUzNQ=="}], "type": "inlineReview"}, {"oid": "e8d869cc937370f183c2574b9e61293edd943442", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e8d869cc937370f183c2574b9e61293edd943442", "message": "DHFPROD-4452: Add editing capability for entity type description", "committedDate": "2020-05-29T17:19:06Z", "type": "forcePushed"}, {"oid": "66a106c21259f8686b11ba8c3079afb1c111e184", "url": "https://github.com/marklogic/marklogic-data-hub/commit/66a106c21259f8686b11ba8c3079afb1c111e184", "message": "DHFPROD-4452: Add editing capability for entity type description", "committedDate": "2020-05-29T17:41:13Z", "type": "commit"}, {"oid": "66a106c21259f8686b11ba8c3079afb1c111e184", "url": "https://github.com/marklogic/marklogic-data-hub/commit/66a106c21259f8686b11ba8c3079afb1c111e184", "message": "DHFPROD-4452: Add editing capability for entity type description", "committedDate": "2020-05-29T17:41:13Z", "type": "forcePushed"}]}