{"pr_number": 4798, "pr_title": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "pr_createdAt": "2020-10-30T00:46:05Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4798", "timeline": [{"oid": "9fa09072144959fb65c04349e17e9359cd6fc061", "url": "https://github.com/marklogic/marklogic-data-hub/commit/9fa09072144959fb65c04349e17e9359cd6fc061", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-10-30T16:40:24Z", "type": "forcePushed"}, {"oid": "8d1ea9fe34658c21668be7d5143ceb12ed67962c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/8d1ea9fe34658c21668be7d5143ceb12ed67962c", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-10-30T18:38:46Z", "type": "forcePushed"}, {"oid": "85b76d8f23b9eac8204ce558f35d73f2ceec6779", "url": "https://github.com/marklogic/marklogic-data-hub/commit/85b76d8f23b9eac8204ce558f35d73f2ceec6779", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-10-30T19:47:10Z", "type": "forcePushed"}, {"oid": "477fd873bc1c4b7b6e58a3f53b8e8841d6be785d", "url": "https://github.com/marklogic/marklogic-data-hub/commit/477fd873bc1c4b7b6e58a3f53b8e8841d6be785d", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-10-30T19:48:30Z", "type": "forcePushed"}, {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588", "url": "https://github.com/marklogic/marklogic-data-hub/commit/ac964bb1465df761406a4a1c13aba153c4cb8588", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-10-30T20:58:38Z", "type": "forcePushed"}, {"oid": "521157046f5e00b0801a914f2ed6c5fb9ab351a6", "url": "https://github.com/marklogic/marklogic-data-hub/commit/521157046f5e00b0801a914f2ed6c5fb9ab351a6", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-10-31T02:55:44Z", "type": "forcePushed"}, {"oid": "a1cb2a35782b7c7933353d7ac5a76fa513114e02", "url": "https://github.com/marklogic/marklogic-data-hub/commit/a1cb2a35782b7c7933353d7ac5a76fa513114e02", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-10-31T07:36:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NjgzNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#discussion_r515386834", "bodyText": "Can we fix the CSS code styling here so we have a space between the selector and the curly brace, e.g.: .stepLink {", "author": "wooldridge", "createdAt": "2020-10-30T21:16:50Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.module.scss", "diffHunk": "@@ -114,3 +119,16 @@\n     margin-top: 7px;\n     margin-bottom: 10px;\n }\n+\n+.stepLink{", "originalCommit": "ac964bb1465df761406a4a1c13aba153c4cb8588", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NzIyOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#discussion_r515387229", "bodyText": "Can we fix the code styling here so we have a space after the if and before the curly brace, e.g.: if (addRun) {", "author": "wooldridge", "createdAt": "2020-10-30T21:17:51Z", "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -602,17 +612,63 @@ const MappingCard: React.FC<Props> = (props) => {\n     const onAddOk = async (lName, fName) => {\n         await props.addStepToFlow(lName, fName, 'mapping')\n         setAddDialogVisible(false);\n-\n-        history.push({\n-            pathname: '/tiles/run/add',\n-            state: {\n-                flowName: fName,\n-                flowsDefaultKey: [props.flows.findIndex(el => el.name === fName)],\n-                existingFlow: true\n-            }\n-        })\n+        \n+        if(addRun){", "originalCommit": "ac964bb1465df761406a4a1c13aba153c4cb8588", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NzM5MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#discussion_r515387390", "bodyText": "Add spaces, see above comment?", "author": "wooldridge", "createdAt": "2020-10-30T21:18:25Z", "path": "marklogic-data-hub-central/ui/src/components/flows/flows.tsx", "diffHunk": "@@ -73,18 +74,50 @@ const Flows: React.FC<Props> = (props) => {\n     const [openNewFlow, setOpenNewFlow] = useState(props.newStepToFlowOptions?.addingStepToFlow && !props.newStepToFlowOptions?.existingFlow);\n     const [activeKeys, setActiveKeys] = useState(JSON.stringify(props.newStepToFlowOptions?.flowsDefaultKey) !== JSON.stringify([\"-1\"]) ? props.newStepToFlowOptions?.flowsDefaultKey : ['-1']);\n     const [showLinks, setShowLinks] = useState('');\n+    const [startRun, setStartRun] = useState(false);\n     const [latestJobData, setLatestJobData] = useState<any>({});\n     const [createAdd, setCreateAdd] = useState(true);\n \n \n     useEffect(() => {\n-        if (JSON.stringify(props.flowsDefaultActiveKey) !== JSON.stringify([])) {\n+        if (JSON.stringify(props.flowsDefaultActiveKey) !== JSON.stringify([]) && props.flowsDefaultActiveKey.length >= activeKeys.length) {\n             setActiveKeys([...props.flowsDefaultActiveKey]);\n         }\n         // Get the latest job info when a step is added to an existing flow from Curate or Load Tile\n         if(JSON.stringify(props.flows) !== JSON.stringify([])){\n-            if(props.newStepToFlowOptions && props.newStepToFlowOptions.flowsDefaultKey && props.newStepToFlowOptions.flowsDefaultKey != -1){\n+            if(props.newStepToFlowOptions && props.newStepToFlowOptions.addingStepToFlow && props.newStepToFlowOptions.flowsDefaultKey && props.newStepToFlowOptions.flowsDefaultKey != -1){", "originalCommit": "ac964bb1465df761406a4a1c13aba153c4cb8588", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NzUwOA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#discussion_r515387508", "bodyText": "Add spaces?", "author": "wooldridge", "createdAt": "2020-10-30T21:18:43Z", "path": "marklogic-data-hub-central/ui/src/components/flows/flows.tsx", "diffHunk": "@@ -73,18 +74,50 @@ const Flows: React.FC<Props> = (props) => {\n     const [openNewFlow, setOpenNewFlow] = useState(props.newStepToFlowOptions?.addingStepToFlow && !props.newStepToFlowOptions?.existingFlow);\n     const [activeKeys, setActiveKeys] = useState(JSON.stringify(props.newStepToFlowOptions?.flowsDefaultKey) !== JSON.stringify([\"-1\"]) ? props.newStepToFlowOptions?.flowsDefaultKey : ['-1']);\n     const [showLinks, setShowLinks] = useState('');\n+    const [startRun, setStartRun] = useState(false);\n     const [latestJobData, setLatestJobData] = useState<any>({});\n     const [createAdd, setCreateAdd] = useState(true);\n \n \n     useEffect(() => {\n-        if (JSON.stringify(props.flowsDefaultActiveKey) !== JSON.stringify([])) {\n+        if (JSON.stringify(props.flowsDefaultActiveKey) !== JSON.stringify([]) && props.flowsDefaultActiveKey.length >= activeKeys.length) {\n             setActiveKeys([...props.flowsDefaultActiveKey]);\n         }\n         // Get the latest job info when a step is added to an existing flow from Curate or Load Tile\n         if(JSON.stringify(props.flows) !== JSON.stringify([])){\n-            if(props.newStepToFlowOptions && props.newStepToFlowOptions.flowsDefaultKey && props.newStepToFlowOptions.flowsDefaultKey != -1){\n+            if(props.newStepToFlowOptions && props.newStepToFlowOptions.addingStepToFlow && props.newStepToFlowOptions.flowsDefaultKey && props.newStepToFlowOptions.flowsDefaultKey != -1){\n                 getFlowWithJobInfo(props.newStepToFlowOptions.flowsDefaultKey);\n+                if(startRun && props.newStepToFlowOptions.existingFlow){\n+                        //run step after step is added to an existing flow\n+                        if(props.newStepToFlowOptions.stepDefinitionType === 'ingestion'){\n+                            setShowUploadError(false);\n+                            setRunningStep(props.flows[props.newStepToFlowOptions.flowsDefaultKey].steps[props.flows[props.newStepToFlowOptions.flowsDefaultKey].steps.length - 1]);\n+                            setRunningFlow(props.newStepToFlowOptions?.flowName);\n+                            openFilePicker();\n+                            setStartRun(false);\n+                        }else{", "originalCommit": "ac964bb1465df761406a4a1c13aba153c4cb8588", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "397039104b27ed5df00ed5dc21e236bf807b1ad3", "url": "https://github.com/marklogic/marklogic-data-hub/commit/397039104b27ed5df00ed5dc21e236bf807b1ad3", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-11-01T18:01:26Z", "type": "forcePushed"}, {"oid": "b5002d16331293a0c63c20af574c11702a9ac735", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b5002d16331293a0c63c20af574c11702a9ac735", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-11-02T06:53:21Z", "type": "forcePushed"}, {"oid": "01df895fc558dca4da775d6c4d7992af64ffaac3", "url": "https://github.com/marklogic/marklogic-data-hub/commit/01df895fc558dca4da775d6c4d7992af64ffaac3", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-11-02T18:22:40Z", "type": "commit"}, {"oid": "01df895fc558dca4da775d6c4d7992af64ffaac3", "url": "https://github.com/marklogic/marklogic-data-hub/commit/01df895fc558dca4da775d6c4d7992af64ffaac3", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "committedDate": "2020-11-02T18:22:40Z", "type": "forcePushed"}]}