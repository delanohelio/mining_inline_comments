{"pr_number": 4326, "pr_title": "DHFPROD-5371: Navigate away prompt for modeling", "pr_createdAt": "2020-07-31T17:46:13Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4326", "timeline": [{"oid": "977c635a8ba2b04f90cde942baca6af64ba990d3", "url": "https://github.com/marklogic/marklogic-data-hub/commit/977c635a8ba2b04f90cde942baca6af64ba990d3", "message": "DHFPROD-5371: Navigate away with Modeling edits", "committedDate": "2020-08-05T17:08:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNzI1Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#discussion_r466017253", "bodyText": "wondering why you had to use force: true option.", "author": "bsrikan", "createdAt": "2020-08-05T21:34:16Z", "path": "marklogic-data-hub-central/ui/e2e/cypress/integration/modeling/reader.spec.tsx", "diffHunk": "@@ -0,0 +1,93 @@\n+/// <reference types=\"cypress\"/>\n+\n+import modelPage from '../../support/pages/model';\n+import {\n+  entityTypeModal,\n+  entityTypeTable,\n+  propertyModal,\n+  propertyTable,\n+} from '../../support/components/model/index';\n+import { confirmationModal, toolbar, tiles } from '../../support/components/common/index';\n+import { Application } from '../../support/application.config';\n+import browsePage from '../../support/pages/browse'\n+import 'cypress-wait-until';\n+\n+describe('Entity Modeling: Reader Role', () => {\n+\n+  //login with valid account\n+  beforeEach(() => {\n+    cy.visit('/');\n+    cy.contains(Application.title);\n+    console.log(Cypress.env('mlHost'));\n+    cy.loginAsTestUserWithRoles(\"hub-central-entity-model-reader\").withRequest()\n+    cy.waitUntil(() => toolbar.getModelToolbarIcon()).click();\n+    entityTypeTable.waitForTableToLoad();\n+  });\n+\n+  after(() => {\n+      //resetting the test user back to only have 'hub-central-user' role\n+      cy.resetTestUser();\n+  });\n+\n+  it('can navigate by clicking instance count and last processed, can not create, edit, or delete entity models', () => {\n+    cy.waitUntil(() => entityTypeTable.getEntityLastProcessed('Person')).click();\n+    cy.url().should('include', '/tiles/explore');\n+    tiles.getExploreTile().should('exist');\n+    cy.waitUntil(() => browsePage.getSelectedEntity()).should('eq', 'Person');\n+    browsePage.getClearAllButton().should('exist');\n+    \n+    toolbar.getModelToolbarIcon().click();\n+    cy.url().should('include', '/tiles/model');\n+    tiles.getModelTile().should('exist');\n+\n+    cy.waitUntil(() => entityTypeTable.getEntityInstanceCount('Order')).click();\n+    cy.url().should('include', '/tiles/explore');\n+    tiles.getExploreTile().should('exist');\n+    cy.waitUntil(() => browsePage.getSelectedEntity().should('eq', 'Order'));\n+    browsePage.getClearAllButton().should('not.exist');\n+\n+    cy.go('back');\n+    cy.url().should('include', '/tiles/model');\n+    tiles.getModelTile().should('exist');\n+\n+    modelPage.getAddEntityButton().click({ force: true });", "originalCommit": "977c635a8ba2b04f90cde942baca6af64ba990d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUzNDAyNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#discussion_r466534025", "bodyText": "The test will fail if I don't because they aren't actionable items. Even though the button is disabled, I'm forcing clicks to see if the functionality is there. For edit Entity/Property names in the table, model-reader role displays text instead of links (with the same selector). So for reader tests, I'm clicking the same selectors as writer role, but I don't expect any edit/ add modals to show up.\nRunning the test without force: true", "author": "brucean52", "createdAt": "2020-08-06T16:25:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNzI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU2NTM4Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#discussion_r466565383", "bodyText": "Okay. interesting way to test a reader role. So you are forcing a click action to verify that the user is able to read?", "author": "bsrikan", "createdAt": "2020-08-06T17:19:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNzI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU2NzQwNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#discussion_r466567404", "bodyText": "I'm testing that the reader role doesn't have any of the writer role privileges in the UI. If you add the \"model writer\" role to the reader test, the test will fail.", "author": "brucean52", "createdAt": "2020-08-06T17:21:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNzI1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyODQ1MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#discussion_r466028450", "bodyText": "can we verify the actual message here?", "author": "bsrikan", "createdAt": "2020-08-05T21:59:46Z", "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.test.tsx", "diffHunk": "@@ -304,5 +296,39 @@ describe('Confirmation Modal Component', () => {\n     userEvent.click(getByText('Yes'));\n     expect(confirmAction).toBeCalledTimes(1);\n   });\n+\n+  test('can render navigation away confirmation', () => {\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByLabelText, getByText, rerender, getByLabelText } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.NavigationWarn}\n+        boldTextArray={[]}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByLabelText('navigation-warn-text')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.NavigationWarn}\n+      boldTextArray={[]}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Unsaved Changes')).toBeInTheDocument();\n+    expect(getByLabelText('navigation-warn-text')).toBeInTheDocument();", "originalCommit": "977c635a8ba2b04f90cde942baca6af64ba990d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUzNDU4OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#discussion_r466534588", "bodyText": "Yeah, I can change it.", "author": "brucean52", "createdAt": "2020-08-06T16:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyODQ1MA=="}], "type": "inlineReview"}, {"oid": "e1dff8a927e8dfa73fb8999ccfc7c10b58f24497", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e1dff8a927e8dfa73fb8999ccfc7c10b58f24497", "message": "DHFPROD-5371: Navigate away prompt for modeling", "committedDate": "2020-08-06T16:59:00Z", "type": "forcePushed"}, {"oid": "d9656a7519495f454f79ac0a328c9bd81893bb19", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d9656a7519495f454f79ac0a328c9bd81893bb19", "message": "DHFPROD-5371: Navigate away prompt for modeling", "committedDate": "2020-08-07T18:16:02Z", "type": "forcePushed"}, {"oid": "102131518621fce24759d3f22ef66b48a6e2562e", "url": "https://github.com/marklogic/marklogic-data-hub/commit/102131518621fce24759d3f22ef66b48a6e2562e", "message": "DHFPROD-5371: Navigate away prompt for modeling", "committedDate": "2020-08-10T17:01:19Z", "type": "commit"}, {"oid": "102131518621fce24759d3f22ef66b48a6e2562e", "url": "https://github.com/marklogic/marklogic-data-hub/commit/102131518621fce24759d3f22ef66b48a6e2562e", "message": "DHFPROD-5371: Navigate away prompt for modeling", "committedDate": "2020-08-10T17:01:19Z", "type": "forcePushed"}]}