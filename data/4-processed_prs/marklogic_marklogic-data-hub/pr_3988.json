{"pr_number": 3988, "pr_title": "DHFPROD-4953: Downloaded project files are now pretty printed", "pr_createdAt": "2020-05-22T14:58:58Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3988", "timeline": [{"oid": "40a14e3f31dc21b14c20dea745ada9acfdf70bc6", "url": "https://github.com/marklogic/marklogic-data-hub/commit/40a14e3f31dc21b14c20dea745ada9acfdf70bc6", "message": "DHFPROD-4953: Downloaded project files are now pretty printed\n\nAlso did some renaming from \"configuration-files\" to \"project-files\", as \"project\" is a much more meaningful term than \"configuration\".", "committedDate": "2020-05-22T15:34:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3OTE0OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3988#discussion_r429379148", "bodyText": "We probably need to remove this.", "author": "akshaysonvane", "createdAt": "2020-05-22T17:49:50Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/ArtifactManagerImpl.java", "diffHunk": "@@ -90,12 +97,70 @@ protected ArtifactService getArtifactService() {\n \n     public ArtifactTypeInfo getArtifactTypeInfo(String artifactType) {\n         ArtifactTypeInfo artifactTypeInfo = null;\n-        for (ArtifactTypeInfo typeInfo: getArtifactTypeInfoList()) {\n+        for (ArtifactTypeInfo typeInfo : getArtifactTypeInfoList()) {\n             if (typeInfo.getType().equals(artifactType)) {\n                 artifactTypeInfo = typeInfo;\n                 break;\n             }\n         }\n         return artifactTypeInfo;\n     }\n+\n+    public void writeProjectArtifactsAsZip(OutputStream outputStream) {\n+        ArrayNode artifacts = (ArrayNode) ArtifactService.on(hubClient.getStagingClient()).getArtifactsWithProjectPaths();\n+\n+        final ZipOutputStream zipOutputStream = new ZipOutputStream(outputStream);\n+        final ObjectWriter prettyWriter = buildPrettyWriter();\n+\n+        try {\n+            artifacts.forEach(artifact -> {\n+                ZipEntry entry = new ZipEntry(artifact.get(\"path\").asText());\n+                try {\n+                    zipOutputStream.putNextEntry(entry);\n+                    if (artifact.has(\"xml\")) {\n+                        byte[] bytes = artifact.get(\"xml\").asText().getBytes();\n+                        zipOutputStream.write(bytes, 0, bytes.length);\n+                    } else {\n+                        byte[] bytes = prettyWriter.writeValueAsString(artifact.get(\"json\")).getBytes();\n+                        System.out.println(\"JSON: \" + new String(bytes));", "originalCommit": "40a14e3f31dc21b14c20dea745ada9acfdf70bc6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1c025739776b65d32c19031e12b9d9b59c0de540", "url": "https://github.com/marklogic/marklogic-data-hub/commit/1c025739776b65d32c19031e12b9d9b59c0de540", "message": "DHFPROD-4953: Downloaded project files are now pretty printed\n\nAlso did some renaming from \"configuration-files\" to \"project-files\", as \"project\" is a much more meaningful term than \"configuration\".", "committedDate": "2020-05-22T19:17:35Z", "type": "commit"}, {"oid": "1c025739776b65d32c19031e12b9d9b59c0de540", "url": "https://github.com/marklogic/marklogic-data-hub/commit/1c025739776b65d32c19031e12b9d9b59c0de540", "message": "DHFPROD-4953: Downloaded project files are now pretty printed\n\nAlso did some renaming from \"configuration-files\" to \"project-files\", as \"project\" is a much more meaningful term than \"configuration\".", "committedDate": "2020-05-22T19:17:35Z", "type": "forcePushed"}]}