{"pr_number": 3772, "pr_title": "DHFPROD-4186: Map from XML source data", "pr_createdAt": "2020-03-30T23:21:19Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3772", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3MDAzMg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r400570032", "bodyText": "Can we get rid of these console.logs completely? Logging errors is still ok, and maybe we should try console.lerror for those.", "author": "bsrikan", "createdAt": "2020-03-31T00:17:52Z", "path": "one-ui/ui/src/components/entities/entity-tiles.tsx", "diffHunk": "@@ -55,7 +55,7 @@ const EntityTiles = (props) => {\n                 return mapArtifacts;\n                }\n \n-              console.log('GET Mapping Artifacts API Called successfully!',response);\n+              console.log('GET Mapping Artifacts API Called successfully!');\n             }", "originalCommit": "b79b67329d24f092e684ff288c430e58d486b411", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4MjQxMg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r400582412", "bodyText": "@bsrikan - Yes, we can definitely remove these console logs completely and keep only the error logs. Updated the PR with the same. Please review now.", "author": "xnikhil08", "createdAt": "2020-03-31T01:01:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3MDAzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3MDg4MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r400570880", "bodyText": "hope this doesnt break any other tests which requires mappingVisible to be false. We can always render with props overridden from this config file.. Like below so we can keep data.config generic:\nrender(<SourceToEntityMap {...data.mapProps} mappingVisible={true}/>)", "author": "bsrikan", "createdAt": "2020-03-31T00:20:37Z", "path": "one-ui/ui/src/config/data.config.js", "diffHunk": "@@ -52,10 +61,14 @@ const mapProps = {\n       name: { sourcedFrom: 'name' }\n     }\n   },\n+  namespaces: {\n+    nutFree: 'http://namespaces/nutfree',\n+    withNuts: 'http://namespaces/withNuts'\n+  },\n   mapName: 'testMap',\n   getMappingArtifactByMapName: jest.fn(),\n   updateMappingArtifact: jest.fn(),\n-  mappingVisible:  false,\n+  mappingVisible:  true,", "originalCommit": "b79b67329d24f092e684ff288c430e58d486b411", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4MTUwNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r400581505", "bodyText": "@bsrikan - Updated the data.config file and the test as well. It's working fine at my end. Please review now.", "author": "xnikhil08", "createdAt": "2020-03-31T00:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3MDg4MA=="}], "type": "inlineReview"}, {"oid": "81c222c2b55b5e540b17e4d128d74f2f81edfee1", "url": "https://github.com/marklogic/marklogic-data-hub/commit/81c222c2b55b5e540b17e4d128d74f2f81edfee1", "message": "DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Updating test/code with review comments (+1 squashed commit)\nSquashed commits:\n[b79b67329] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Adding unit test for source data (+2 squashed commits)\nSquashed commits:\n[4eced1dd4] DHFPROD-4186: Additional changes covering few edge cases in XML data\n[48304639b] DHFPROD-4186: Added support for XML data in Mapping source table", "committedDate": "2020-03-31T00:56:53Z", "type": "forcePushed"}, {"oid": "8cdb10c8f440a727444e7db0911910cf8ae536cf", "url": "https://github.com/marklogic/marklogic-data-hub/commit/8cdb10c8f440a727444e7db0911910cf8ae536cf", "message": "DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Updating test/code with review comments (+1 squashed commit)\nSquashed commits:\n[b79b67329] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Adding unit test for source data (+2 squashed commits)\nSquashed commits:\n[4eced1dd4] DHFPROD-4186: Additional changes covering few edge cases in XML data\n[48304639b] DHFPROD-4186: Added support for XML data in Mapping source table", "committedDate": "2020-03-31T01:24:53Z", "type": "forcePushed"}, {"oid": "c622b406476a75c14315813425f7072ad6a3665a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/c622b406476a75c14315813425f7072ad6a3665a", "message": "DHFPROD-4186: Support for XML source data in Mapping and few bug fixes\nDHFPROD-4186: Fixing few bugs in rendering XML data (+1 squashed commit)\nSquashed commits:\n[bfee0ee3a] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Updating test/code with review comments (+1 squashed commit)\nSquashed commits:\n[b79b67329] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Adding unit test for source data (+2 squashed commits)\nSquashed commits:\n[4eced1dd4] DHFPROD-4186: Additional changes covering few edge cases in XML data\n[48304639b] DHFPROD-4186: Added support for XML data in Mapping source table", "committedDate": "2020-04-03T08:07:17Z", "type": "forcePushed"}, {"oid": "d05a230d4d1a0e9418b2b5262177b08326b69cac", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d05a230d4d1a0e9418b2b5262177b08326b69cac", "message": "DHFPROD-4186: Support for XML source data in Mapping and bug fixes\nDHFPROD-4186: Fixed namespace issue for array of nodes in an XML parentNode (+1 squashed commit)\nSquashed commits:\n[c622b4064] DHFPROD-4186: Support for XML source data in Mapping and few bug fixes\nDHFPROD-4186: Fixing few bugs in rendering XML data (+1 squashed commit)\nSquashed commits:\n[bfee0ee3a] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Updating test/code with review comments (+1 squashed commit)\nSquashed commits:\n[b79b67329] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Adding unit test for source data (+2 squashed commits)\nSquashed commits:\n[4eced1dd4] DHFPROD-4186: Additional changes covering few edge cases in XML data\n[48304639b] DHFPROD-4186: Added support for XML data in Mapping source table", "committedDate": "2020-04-03T20:30:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA4MjYyMA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404082620", "bodyText": "Trying to understand what these variables mean and how they are different from each other-- namespaces, nmspaces and namespaceString. Can you pls explain.\nWith all of us trying to write unit test, I feel its important we use standard naming conventions so its easy to read and understand the code. nmspc, nmspaces, namespaces, ind, sDta, mData, mapArt and propty are some examples.", "author": "bsrikan", "createdAt": "2020-04-06T13:18:13Z", "path": "one-ui/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -57,6 +58,13 @@ const MappingCard: React.FC<Props> = (props) => {\n     //For storing  mapping functions\n     const [mapFunctions,setMapFunctions] = useState({});\n \n+    //For storing namespaces\n+    const [namespaces, setNamespaces] = useState({});\n+    let nmspaces: any = {};\n+    let mapIndexLocal: number = -1;\n+    const [mapIndex, setMapIndex] = useState(-1);\n+    let namespaceString = '';", "originalCommit": "d05a230d4d1a0e9418b2b5262177b08326b69cac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM0NDA0NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404344044", "bodyText": "nmspaces - Local variable to store namespaces when iterating over  xml source doc. This will be used locally at other places as well.\nnamespaces - This is a state variable and will be passed on to the child component and have state management properties.\nnamespaceString - Just a string local variable to store the most recent namespace at a given time for any xml node. This is only a local temporary variable and has no significance for child component.\nAny variable which is not part of the react state is a local variable for that component and has no relation with the child component.", "author": "xnikhil08", "createdAt": "2020-04-06T19:45:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA4MjYyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1ODkxNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404358914", "bodyText": "Thanks. Regarding naming conventions, we need to come up with and follow some guidelines for the future. ind, sDta, mData, mapArt and propty seem half baked to me.", "author": "bsrikan", "createdAt": "2020-04-06T20:12:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA4MjYyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwNzc0MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404107740", "bodyText": "Could we have just used namespaceString = nmspcURI.slice(ind);?\nAlso looks like we are trying to get a namespace string in 4 to 5 different places similar to line 201 to 205. Can we pls create a function and reuse that to return the namespace string.", "author": "bsrikan", "createdAt": "2020-04-06T13:53:11Z", "path": "one-ui/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -177,83 +185,233 @@ const MappingCard: React.FC<Props> = (props) => {\n \n     }\n \n-    const fetchSrcDocFromUri = async (uri) => {\n+    const fetchSrcDocFromUri = async (uri, index = mapIndexLocal) => {\n         try{\n             let srcDocResp = await getDoc('STAGING', uri);\n             if (srcDocResp.status === 200) {\n+                let parsedDoc: any;\n+                if(typeof(srcDocResp.data) === 'string'){\n+                    parsedDoc = getParsedXMLDoc(srcDocResp);\n+                } else {\n+                    parsedDoc = srcDocResp.data;\n+                }\n+                if(parsedDoc['envelope']){\n+                    if(parsedDoc['envelope'].hasOwnProperty('@xmlns')){\n+                        \n+                        let nmspcURI = parsedDoc['envelope']['@xmlns']\n+                        let indCheck = nmspcURI.lastIndexOf('/');\n+                        let ind = indCheck !== -1 ? indCheck + 1 : 0;\n+                        let nmspcString = nmspcURI.slice(ind);\n+                        namespaceString = nmspcString;\n+                        nmspaces = { ...nmspaces, [namespaceString]: nmspcURI};\n+                        setNamespaces({ ...namespaces, [namespaceString]: nmspcURI})", "originalCommit": "d05a230d4d1a0e9418b2b5262177b08326b69cac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM0NjA0Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404346046", "bodyText": "This logic to set namespaceString is used only at this very place so seems an overkill to create a function for only one instance.", "author": "xnikhil08", "createdAt": "2020-04-06T19:48:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwNzc0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM2MDk5Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404360997", "bodyText": "I found 4 or 5 places where you get the lastIndexOf('/'), get the index, slice the namespace URI with index and assign it to nmspcString", "author": "bsrikan", "createdAt": "2020-04-06T20:16:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwNzc0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQwNDA1Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404404052", "bodyText": "nmspcString is extracted only at two places, one is inside the function updateParentNamespace() (already being called at multiple places) and other at line 204-205. The reason why that function is not called at these lines is that the concept of \"parentNamespace\" didn't made sense at this point earlier but only once you enter into the nested source logic. If still however we want to replace that code with a function call, then I will have to rename the function to something else which fits both the scenarios.", "author": "xnikhil08", "createdAt": "2020-04-06T21:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwNzc0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQyNzg5Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404427897", "bodyText": "Discussed with @xnikhil08 . Will resolve this conversation and refactor the code later when writing tests or as a tech debt.", "author": "bsrikan", "createdAt": "2020-04-06T22:31:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwNzc0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwOTYxNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404109617", "bodyText": "Can you pls explain what this prop is for -- props.mapIndex. Should this be added to mapProps in data.config?", "author": "bsrikan", "createdAt": "2020-04-06T13:55:23Z", "path": "one-ui/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.tsx", "diffHunk": "@@ -72,7 +72,7 @@ const SourceToEntityMap = (props) => {\n \n     const handleSubmitUri = (uri) => {\n         props.getMappingArtifactByMapName();\n-        props.fetchSrcDocFromUri(uri);\n+        props.fetchSrcDocFromUri(uri,props.mapIndex);", "originalCommit": "d05a230d4d1a0e9418b2b5262177b08326b69cac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM0ODcwNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r404348705", "bodyText": "It wouldn't affect any of the existing tests. I ran them locally and made sure they are working fine. But yeah when we will write more tests using the function props.fetchSrcDocFromUri, then yes we would have to add that in the data.config.", "author": "xnikhil08", "createdAt": "2020-04-06T19:53:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwOTYxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE0MDY2NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r405140664", "bodyText": "was deleting finally block intentional?", "author": "bsrikan", "createdAt": "2020-04-07T22:04:05Z", "path": "one-ui/ui/src/components/entities/entity-tiles.tsx", "diffHunk": "@@ -37,13 +37,10 @@ const EntityTiles = (props) => {\n                 let mapArtifacts = response.data;\n                 mapArtifacts.sort((a, b) => (a.entityType > b.entityType) ? 1 : -1)\n                 setEntityArtifacts([...mapArtifacts]);\n-              console.log('GET Mapping Artifacts API Called successfully!',response);\n             }\n           } catch (error) {\n               let message = error;\n-              console.log('Error while fetching the mappings!', message);\n-          } finally {\n-            resetSessionTime();", "originalCommit": "d05a230d4d1a0e9418b2b5262177b08326b69cac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE2MTU1OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r405161559", "bodyText": "Fixed with recent push. Resolving conversation.", "author": "bsrikan", "createdAt": "2020-04-07T22:57:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE0MDY2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE2MTcyOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3772#discussion_r405161729", "bodyText": "No that got deleted by mistake it seems. Thanks for letting me know. Updated the code again. Please review now.", "author": "xnikhil08", "createdAt": "2020-04-07T22:57:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE0MDY2NA=="}], "type": "inlineReview"}, {"oid": "dbe2f9cd186b55706e0edf5a19c3fbf48846c9e4", "url": "https://github.com/marklogic/marklogic-data-hub/commit/dbe2f9cd186b55706e0edf5a19c3fbf48846c9e4", "message": "DHFPROD-4186: Support for XML source data in Mapping and bug fixes\nDHFPROD-4186: Adding the missing finally block (+1 squashed commit)\nSquashed commits:\n[38748730d] DHFPROD-4186: Support for XML source data in Mapping and bug fixes\nDHFPROD-4186: Fixed namespace issue for array of nodes in an XML parentNode (+1 squashed commit)\nSquashed commits:\n[c622b4064] DHFPROD-4186: Support for XML source data in Mapping and few bug fixes\nDHFPROD-4186: Fixing few bugs in rendering XML data (+1 squashed commit)\nSquashed commits:\n[bfee0ee3a] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Updating test/code with review comments (+1 squashed commit)\nSquashed commits:\n[b79b67329] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Adding unit test for source data (+2 squashed commits)\nSquashed commits:\n[4eced1dd4] DHFPROD-4186: Additional changes covering few edge cases in XML data\n[48304639b] DHFPROD-4186: Added support for XML data in Mapping source table", "committedDate": "2020-04-07T22:55:23Z", "type": "commit"}, {"oid": "dbe2f9cd186b55706e0edf5a19c3fbf48846c9e4", "url": "https://github.com/marklogic/marklogic-data-hub/commit/dbe2f9cd186b55706e0edf5a19c3fbf48846c9e4", "message": "DHFPROD-4186: Support for XML source data in Mapping and bug fixes\nDHFPROD-4186: Adding the missing finally block (+1 squashed commit)\nSquashed commits:\n[38748730d] DHFPROD-4186: Support for XML source data in Mapping and bug fixes\nDHFPROD-4186: Fixed namespace issue for array of nodes in an XML parentNode (+1 squashed commit)\nSquashed commits:\n[c622b4064] DHFPROD-4186: Support for XML source data in Mapping and few bug fixes\nDHFPROD-4186: Fixing few bugs in rendering XML data (+1 squashed commit)\nSquashed commits:\n[bfee0ee3a] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Updating test/code with review comments (+1 squashed commit)\nSquashed commits:\n[b79b67329] DHFPROD-4186: Support for XML source data in Mapping\nDHFPROD-4186: Adding unit test for source data (+2 squashed commits)\nSquashed commits:\n[4eced1dd4] DHFPROD-4186: Additional changes covering few edge cases in XML data\n[48304639b] DHFPROD-4186: Added support for XML data in Mapping source table", "committedDate": "2020-04-07T22:55:23Z", "type": "forcePushed"}]}