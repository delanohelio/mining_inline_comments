{"pr_number": 4855, "pr_title": "DHFPROD-4315: CRUD Match Steps Thresholds", "pr_createdAt": "2020-11-12T19:34:53Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4855", "timeline": [{"oid": "3992d535c9fd98cd4652f99aef17e0aadc7b8f5d", "url": "https://github.com/marklogic/marklogic-data-hub/commit/3992d535c9fd98cd4652f99aef17e0aadc7b8f5d", "message": "DHFPROD-4315: CRUD Match Steps Thresholds", "committedDate": "2020-11-12T20:28:15Z", "type": "forcePushed"}, {"oid": "51920593278ac19b86df559ea7235330f2379015", "url": "https://github.com/marklogic/marklogic-data-hub/commit/51920593278ac19b86df559ea7235330f2379015", "message": "DHFPROD-4315: CRUD Match Steps Thresholds", "committedDate": "2020-11-12T22:47:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ5NzIyNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4855#discussion_r522497224", "bodyText": "We need to check for duplicate names when the action is custom as well.", "author": "ryanjdew", "createdAt": "2020-11-12T23:20:36Z", "path": "marklogic-data-hub-central/ui/src/components/entities/matching/threshold-modal/threshold-modal.tsx", "diffHunk": "@@ -0,0 +1,412 @@\n+import React, { useState, useEffect, useContext } from 'react';\n+import { Modal, Form, Input, Icon } from 'antd';\n+import { MLButton, MLTooltip, MLSelect } from '@marklogic/design-system';\n+import styles from './threshold-modal.module.scss';\n+\n+import { CurationContext } from '../../../../util/curation-context';\n+import { MatchingStep, Threshold } from '../../../../types/curation-types';\n+import { Definition } from '../../../../types/modeling-types';\n+import { NewMatchTooltips } from '../../../../config/tooltips.config';\n+import { updateMatchingArtifact } from '../../../../api/matching';\n+\n+type Props = {\n+  isVisible: boolean;\n+  editThreshold: any;\n+  toggleModal: (isVisible: boolean) => void;\n+};\n+\n+const layout = {\n+  labelCol: { span: 8 },\n+  wrapperCol: { span: 16 },\n+};\n+\n+const THRESHOLD_TYPE_OPTIONS = [\n+  { name: 'Merge', value: 'merge' },\n+  { name: 'Notify', value: 'notify' },\n+  { name: 'Custom', value: 'custom' },\n+];\n+\n+const { MLOption } = MLSelect;\n+ \n+const ThresholdModal: React.FC<Props> = (props) => {\n+  const { curationOptions, updateActiveStepArtifact } = useContext(CurationContext);\n+\n+  const [nameValue, setNameValue] = useState('');\n+  const [nameErrorMessage, setNameErrorMessage] = useState('');\n+\n+  const [actionType, setActionType] = useState<string | undefined>(undefined);\n+  const [actionTypeErrorMessage, setActionTypeErrorMessage] = useState('');\n+\n+  const [uriValue, setUriValue] = useState('');\n+  const [uriErrorMessage, setUriErrorMessage] = useState('');\n+  const [functionValue, setFunctionValue] = useState('');\n+  const [functionErrorMessage, setFunctionErrorMessage] = useState('');\n+  const [namespaceValue, setNamespaceValue] = useState('');\n+\n+  useEffect(() => {\n+    if (Object.keys(props.editThreshold).length !== 0 && props.isVisible) {\n+      let editThreshold = props.editThreshold;\n+      setNameValue(editThreshold['thresholdName']);\n+      setActionType(editThreshold['action']);\n+      if (editThreshold['action'] === 'custom') {\n+        setUriValue(editThreshold['actionModulePath'])\n+        if (editThreshold.hasOwnProperty('actionModuleNamespace')) {\n+          setNamespaceValue(editThreshold['actionModuleNamespace'])\n+        }\n+        if (editThreshold.hasOwnProperty('actionModuleFunction')) {\n+          setFunctionValue(editThreshold['actionModuleFunction'])\n+        }\n+      }\n+    }\n+  }, [JSON.stringify(props.editThreshold)]);\n+\n+  const handleInputChange = (event) => {\n+    switch(event.target.id) {\n+      case 'name-input':\n+        if (event.target.value === '') {\n+          setNameErrorMessage('A threshold name is required');\n+        } else {\n+          setNameErrorMessage('');\n+        }\n+        setNameValue(event.target.value);\n+        break;\n+\n+      case 'uri-input':\n+        if (event.target.value === '') {\n+          setUriErrorMessage('A URI is required');\n+        } else {\n+          setUriErrorMessage('');\n+        }\n+        setUriValue(event.target.value);\n+        break;\n+\n+      case 'function-input':\n+        if (event.target.value === '') {\n+          setFunctionErrorMessage('A function is required');\n+        } else {\n+          setFunctionErrorMessage('');\n+        }\n+        setFunctionValue(event.target.value);\n+        break;\n+\n+      case 'namespace-input':\n+        setNamespaceValue(event.target.value);\n+        break;\n+\n+      default:\n+        break;\n+    }\n+  };\n+\n+  const closeModal = () => {\n+    resetModal();\n+    props.toggleModal(false);\n+  };\n+\n+  const resetModal = () => {\n+    setNameValue('');\n+    setNameErrorMessage('');\n+    setActionType(undefined);\n+    setActionTypeErrorMessage('');\n+    setUriValue('');\n+    setUriErrorMessage('');\n+    setFunctionValue('');\n+    setFunctionErrorMessage('');\n+    setNamespaceValue('');\n+  };\n+\n+  const onSubmit = async (event) => {\n+    event.preventDefault();\n+    let nameErrorMessage = '';\n+    let actionErrorMessage = '';\n+    let thresholdName = nameValue || '';\n+    if (thresholdName === '') {\n+      nameErrorMessage = 'A threshold name is required';\n+    }\n+\n+    if (actionType === '' || actionType === undefined) {\n+      actionErrorMessage = 'An action is required';\n+    }\n+    switch(actionType) {\n+      case 'merge':\n+      case 'notify':\n+        {\n+\n+          if (actionErrorMessage === '' && nameErrorMessage === '' && Object.keys(props.editThreshold).length === 0) {\n+            let newThreshold: Threshold = {\n+              thresholdName,\n+              action: actionType,\n+              score: 0\n+            };\n+\n+            let newStepArtifact: MatchingStep = curationOptions.activeStep.stepArtifact;\n+            let duplicateNames = newStepArtifact.thresholds.filter( threshold => threshold.thresholdName === thresholdName);", "originalCommit": "51920593278ac19b86df559ea7235330f2379015", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUxNTY0OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4855#discussion_r522515649", "bodyText": "Fixed this and made UX change to delete threshold confirmation", "author": "brucean52", "createdAt": "2020-11-12T23:55:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ5NzIyNA=="}], "type": "inlineReview"}, {"oid": "3fafa456d5b1eb6e13426d9c22509dee720e514b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/3fafa456d5b1eb6e13426d9c22509dee720e514b", "message": "DHFPROD-4315: CRUD Match Steps Thresholds", "committedDate": "2020-11-12T23:53:33Z", "type": "forcePushed"}, {"oid": "325c005d21417b7374a587b5fb42c4c6a9d2ad59", "url": "https://github.com/marklogic/marklogic-data-hub/commit/325c005d21417b7374a587b5fb42c4c6a9d2ad59", "message": "DHFPROD-4315: CRUD Match Steps Thresholds", "committedDate": "2020-11-13T17:28:57Z", "type": "commit"}, {"oid": "325c005d21417b7374a587b5fb42c4c6a9d2ad59", "url": "https://github.com/marklogic/marklogic-data-hub/commit/325c005d21417b7374a587b5fb42c4c6a9d2ad59", "message": "DHFPROD-4315: CRUD Match Steps Thresholds", "committedDate": "2020-11-13T17:28:57Z", "type": "forcePushed"}]}