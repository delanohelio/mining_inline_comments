{"pr_number": 3966, "pr_title": "DHFPROD-4225: Check and confirm before starting the export", "pr_createdAt": "2020-05-18T19:18:40Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3966", "timeline": [{"oid": "791540fa11badd6eac5689174afefa95c967bc62", "url": "https://github.com/marklogic/marklogic-data-hub/commit/791540fa11badd6eac5689174afefa95c967bc62", "message": "DHFPROD-4225: Check and confirm before starting the export", "committedDate": "2020-05-18T20:26:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NDMwNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426894306", "bodyText": "data-conversion file is meant to be a file where payloads are parsed. If you have JSX or React code, it's better to keep it within the component for maintaining, testing and debugging", "author": "brucean52", "createdAt": "2020-05-18T21:08:44Z", "path": "marklogic-data-hub-central/ui/src/util/data-conversion.tsx", "diffHunk": "@@ -1,4 +1,8 @@\n import { xmlParser } from './../util/xml-parser';\n+import { Tooltip } from 'antd';\n+import React, { useState, useContext } from 'react';", "originalCommit": "791540fa11badd6eac5689174afefa95c967bc62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkyMDE3OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426920178", "bodyText": "Fixed. Thanks!", "author": "timur-isangulov", "createdAt": "2020-05-18T22:11:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NDMwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NjM2Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426896367", "bodyText": "I don't think you need this useEffect. Call getPreview() in displayExportModal() function", "author": "brucean52", "createdAt": "2020-05-18T21:13:13Z", "path": "marklogic-data-hub-central/ui/src/components/queries/managing/manage-query-modal/manage-query.tsx", "diffHunk": "@@ -32,6 +35,10 @@ const QueryModal = (props) => {\n         getQueries();\n     }, [mainModalVisibility, editModalVisibility, deleteModalVisibility]);\n \n+    useEffect(() => {", "originalCommit": "791540fa11badd6eac5689174afefa95c967bc62", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5Njk3Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426896972", "bodyText": "this is inefficient because you are calling getQueries() anytime these 3 booleans change. If I click \"cancel\" on delete or edit, or main modals, it will do a network request.", "author": "brucean52", "createdAt": "2020-05-18T21:14:40Z", "path": "marklogic-data-hub-central/ui/src/components/queries/managing/manage-query-modal/manage-query.tsx", "diffHunk": "@@ -32,6 +35,10 @@ const QueryModal = (props) => {\n         getQueries();", "originalCommit": "791540fa11badd6eac5689174afefa95c967bc62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkyMDM0Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426920346", "bodyText": "Fixed. Thanks.", "author": "timur-isangulov", "createdAt": "2020-05-18T22:11:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5Njk3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5ODQxOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426898419", "bodyText": "no reason to create the exportConfirmation variable. just return the JSX.", "author": "brucean52", "createdAt": "2020-05-18T21:17:57Z", "path": "marklogic-data-hub-central/ui/src/components/query-export/query-export-modal/query-export-modal.tsx", "diffHunk": "@@ -120,6 +127,15 @@ const QueryExportModal = (props) => {\n             </div>\n             }\n         </Form>\n+\n+        {props.hasStructured && <div>\n+            <Collapse bordered={false} className={styles.collapseCustomPanel} style={{ border: '0px', color: 'blue' }}>\n+                <Panel id='export-panel' header=\"Show Preview\" key=\"1\" style={{ border: '0px', color: 'blue' }}>\n+                    <Table data-testid='export-preview-table'className={styles.exportTable} dataSource={props.tableData} columns={props.tableColumns} pagination={false} size='small' scroll={{ x: 500 }} bordered />\n+                </Panel>\n+            </Collapse>\n+        </div>}\n+\n     </Modal>\n \n     return (", "originalCommit": "791540fa11badd6eac5689174afefa95c967bc62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkyMDQwNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426920404", "bodyText": "Changed. Thanks.", "author": "timur-isangulov", "createdAt": "2020-05-18T22:11:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5ODQxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NjMzOA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426896338", "bodyText": "@timur-isangulov any reason for checking status less than 300 ?", "author": "Sanjeevani19", "createdAt": "2020-05-18T21:13:10Z", "path": "marklogic-data-hub-central/ui/src/api/queries.tsx", "diffHunk": "@@ -60,6 +60,61 @@ export const exportQuery = (query, limit) => {\n   mapForm.reset();\n }\n \n+export const getExportQueryPreview = async (query) => {\n+  let queryString = JSON.stringify(query)\n+  const mapForm = document.createElement(\"form\");\n+  mapForm.id = \"exportForm\";\n+  const mapInput = document.createElement(\"input\");\n+  mapInput.type = \"hidden\";\n+  mapInput.name = \"fileType\";\n+  mapInput.value = \"csv\";\n+  const mapInput2 = document.createElement(\"input\");\n+  mapInput2.type = \"hidden\";\n+  mapInput2.name = \"limit\";\n+  mapInput2.value = '2';\n+  const mapInput3 = document.createElement(\"input\");\n+  mapInput3.type = \"hidden\";\n+  mapInput3.name = \"queryDocument\";\n+  mapInput3.value = queryString;\n+  mapForm.appendChild(mapInput);\n+  mapForm.appendChild(mapInput2);\n+  mapForm.appendChild(mapInput3);\n+  document.body.appendChild(mapForm);\n+\n+  return new Promise(function (resolve, reject) {\n+    let xhr = new XMLHttpRequest();\n+    xhr.open(\"POST\", \"/api/entitySearch/export\");\n+    xhr.onload = function () {\n+        if (this.status >= 200 && this.status < 300) {", "originalCommit": "791540fa11badd6eac5689174afefa95c967bc62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkyMjI4OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426922289", "bodyText": "Checking for range of success status codes.", "author": "timur-isangulov", "createdAt": "2020-05-18T22:17:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NjMzOA=="}], "type": "inlineReview"}, {"oid": "3031cdc8ce161d4b75df8dd2782848894ad23fb3", "url": "https://github.com/marklogic/marklogic-data-hub/commit/3031cdc8ce161d4b75df8dd2782848894ad23fb3", "message": "DHFPROD-4225: Check and confirm before starting the export", "committedDate": "2020-05-18T22:09:59Z", "type": "forcePushed"}, {"oid": "2f9dabbdf1b7aca8b4a581ec7754686132dfa17c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/2f9dabbdf1b7aca8b4a581ec7754686132dfa17c", "message": "DHFPROD-4225: Check and confirm before starting the export", "committedDate": "2020-05-19T16:26:19Z", "type": "commit"}, {"oid": "2f9dabbdf1b7aca8b4a581ec7754686132dfa17c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/2f9dabbdf1b7aca8b4a581ec7754686132dfa17c", "message": "DHFPROD-4225: Check and confirm before starting the export", "committedDate": "2020-05-19T16:26:19Z", "type": "forcePushed"}]}