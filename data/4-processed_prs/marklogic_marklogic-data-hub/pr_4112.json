{"pr_number": 4112, "pr_title": "DHFPROD-4843: Display service name in header, system-info dialog", "pr_createdAt": "2020-06-18T19:03:55Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4112", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2MDE0NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#discussion_r442460144", "bodyText": "This is good. I would probably add systemInfoVisible: true, setSystemInfoVisible: jest.fn() in system-info.data.ts and use that here like so: {...data.environment}", "author": "bsrikan", "createdAt": "2020-06-18T19:40:00Z", "path": "marklogic-data-hub-central/ui/src/components/header/system-info.test.tsx", "diffHunk": "@@ -0,0 +1,60 @@\n+import React from 'react';\n+import {render, cleanup, } from \"@testing-library/react\";\n+import SystemInfo from './system-info';\n+import {AuthoritiesContext, AuthoritiesService} from \"../../util/authorities\";\n+import {BrowserRouter as Router} from \"react-router-dom\";\n+import data from '../../assets/mock-data/system-info.data';\n+\n+describe('Update data load settings component', () => {\n+\n+    afterEach(() => {\n+        cleanup();\n+    });\n+\n+    test('verify project info display, user with \"Download\" button enabled', async () => {\n+        const authorityService = new AuthoritiesService();\n+        authorityService.setAuthorities(['downloadProjectFiles']);\n+        const { getByText } = render(<Router><AuthoritiesContext.Provider value={authorityService}>\n+            <SystemInfo \n+                serviceName={data.environment.serviceName}\n+                dataHubVersion={data.environment.dataHubVersion}\n+                marklogicVersion={data.environment.marklogicVersion}\n+                systemInfoVisible={true} \n+                setSystemInfoVisible={jest.fn()}", "originalCommit": "af98d85e9c4973a934b57b7f4426cd56c450350a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY3MDI2NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#discussion_r442670264", "bodyText": "@bsrikan:\n\nCan we also pls update \"marklogic-data-hub-central/ui/e2e/cypress/support/commands.js\" to include systemInfo\n\nCan you do this? I haven't done anything with the e2e cypress stuff, not sure what you're looking for.", "author": "wooldridge", "createdAt": "2020-06-19T07:10:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2MDE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY3MTAzOA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#discussion_r442671038", "bodyText": "@bsrikan:\n\nThis is good. I would probably add systemInfoVisible: true, setSystemInfoVisible: jest.fn() in system-info.data.ts and use that here like so: {...data.environment}\n\nWould be nice for brevity, but I don't want to put those additional properties in the environment object since they aren't returned from the environment method in the app.", "author": "wooldridge", "createdAt": "2020-06-19T07:12:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2MDE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk0ODk0OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#discussion_r442948949", "bodyText": "Sure @wooldridge makes sense for test data props. I will update the endpoint for the cypress command support with the new endpoint.", "author": "bsrikan", "createdAt": "2020-06-19T16:54:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2MDE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjgxOTE0Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#discussion_r442819143", "bodyText": "One thought I've had for the future is to standardize on (I think) \"system\" instead of using \"environment\" and \"system\" interchangeably, as having those separate terms raises the question of - What does each one mean? \"serviceName\" adds a little more confusion to because it implies there's the concept of a \"service\" that is separate from \"system\". Really, system = environment = service, so in the future, I think we'll simplify the naming here.", "author": "rjrudin", "createdAt": "2020-06-19T12:45:43Z", "path": "marklogic-data-hub-central/ui/src/util/environment.tsx", "diffHunk": "@@ -1,16 +1,15 @@\n import axios from 'axios';\n \n const defaultEnv = {\n-    projectName: '',\n+    serviceName: '',\n     dataHubVersion: '',\n     markLogicVersion: ''\n }\n \n export function setEnvironment()  {\n-    axios.get('/api/environment/project-info')\n+    axios.get('/api/environment/systemInfo')", "originalCommit": "af98d85e9c4973a934b57b7f4426cd56c450350a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjgxOTY4MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#discussion_r442819681", "bodyText": "I expect to rename this to SystemInfo in a future JIRA ticket as well, didn't want to increase the blast radius of this PR though. Also note that \"clusterName\" is appropriate here because this is a DHF class, and it doesn't know specifically about DHS, which is where the concept of \"serviceName\" exists.", "author": "rjrudin", "createdAt": "2020-06-19T12:46:47Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/VersionInfo.java", "diffHunk": "@@ -16,18 +16,21 @@\n \n     private String hubVersion;\n     private String markLogicVersion;\n+    private String clusterName;\n \n     public static VersionInfo newVersionInfo(HubClient hubClient) {", "originalCommit": "af98d85e9c4973a934b57b7f4426cd56c450350a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "76de656a598e71405858754738457d9df68a0ca9", "url": "https://github.com/marklogic/marklogic-data-hub/commit/76de656a598e71405858754738457d9df68a0ca9", "message": "DHFPROD-4843: Display service name in header, dialog\n\n- Refactor project-page component, use new /api/environment/systemInfo endpoint.\n- Rename ProjectPage component to SystemInfo\n- Move SystemInfo component with Header component since only Header calls SystemInfo\n- Refactor mocked user-context data and associated types.\n- Fix some typing issues in test mocks.\n- Test for service name in: header.test, system-info.test\n- /api/environment/project-info is now /api/environment/systemInfo.\n- Removing /api/info - sessionTimeout is now part of systemInfo.\n- No longer including projectName in the authentication response either, to avoid redundancy.\n\nThinking that SystemService.getVersions should be renamed to SystemService.getSystemInfo too, but will tackle that later in a separate PR to minimize the amount of changes here.\n\nDHFPROD-4843: Update Cypress custom command to use the new endpoint", "committedDate": "2020-06-19T20:17:58Z", "type": "commit"}, {"oid": "76de656a598e71405858754738457d9df68a0ca9", "url": "https://github.com/marklogic/marklogic-data-hub/commit/76de656a598e71405858754738457d9df68a0ca9", "message": "DHFPROD-4843: Display service name in header, dialog\n\n- Refactor project-page component, use new /api/environment/systemInfo endpoint.\n- Rename ProjectPage component to SystemInfo\n- Move SystemInfo component with Header component since only Header calls SystemInfo\n- Refactor mocked user-context data and associated types.\n- Fix some typing issues in test mocks.\n- Test for service name in: header.test, system-info.test\n- /api/environment/project-info is now /api/environment/systemInfo.\n- Removing /api/info - sessionTimeout is now part of systemInfo.\n- No longer including projectName in the authentication response either, to avoid redundancy.\n\nThinking that SystemService.getVersions should be renamed to SystemService.getSystemInfo too, but will tackle that later in a separate PR to minimize the amount of changes here.\n\nDHFPROD-4843: Update Cypress custom command to use the new endpoint", "committedDate": "2020-06-19T20:17:58Z", "type": "forcePushed"}]}