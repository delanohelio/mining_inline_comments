{"pr_number": 4663, "pr_title": "DHFPROD-4543:Map empty or null value to null when using parseDate and parseDateTime", "pr_createdAt": "2020-10-02T23:13:43Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4663", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxNzYwNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4663#discussion_r499617607", "bodyText": "I recommend removing these comments. They don't add anything - the code is clear in that if the value is null or whitespace, then null will be returned.", "author": "rjrudin", "createdAt": "2020-10-05T13:56:07Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/mapping-functions/core.sjs", "diffHunk": "@@ -91,8 +91,20 @@ function parseDate(value, pattern) {\n   if (pattern != null) {\n     pattern = pattern.toString().replace(\", \", \",\");\n   }\n-  if (value != null) {\n+  //return in case 'value' is null or undefined", "originalCommit": "a585dff1b5b5127c9392a79a952cdc09b558b40d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxOTI2NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4663#discussion_r499619265", "bodyText": "This logic is almost identical. You can reduce the duplication and further remove the need for any comments by introducing a new function here.\nThe 'replace(\", \", \",\");' bit should then be done on \"value\" after the new function eturns false.\nThe code would then read e.g.:\nif (isNullOrEmpty(value)) {\n  return null;\n}", "author": "rjrudin", "createdAt": "2020-10-05T13:58:23Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/mapping-functions/core.sjs", "diffHunk": "@@ -151,6 +163,19 @@ function parseDateTime(value, pattern) {\n   let supportedFormats = [\"YYYYMMDDThhmmss\", \"DD/MM/YYYY-hh:mm:ss\", \"DD/MM/YYYY hh:mm:ss\", \"YYYY/MM/DD-hh:mm:ss\" , \"YYYY/MM/DD hh:mm:ss\"];\n   let response;\n   let errorMsg = `The pattern '${pattern}' cannot be applied to the value '${value}'`;\n+\n+  if (value) {", "originalCommit": "a585dff1b5b5127c9392a79a952cdc09b558b40d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxOTY5OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4663#discussion_r499619699", "bodyText": "Throw in a test case for \"undefined\" as well - shouldn't require any code changes.", "author": "rjrudin", "createdAt": "2020-10-05T13:59:01Z", "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/mapping-functions/parseDate.sjs", "diffHunk": "@@ -22,7 +22,10 @@ function testMoreParseDate() {\n     test.assertEqual(xs.date(\"1996-07-16\"), core.parseDate(\"1996.07.16\", \"yyyy.MM.dd\")),\n \n     test.assertEqual(null, core.parseDate(\"07.16.1996\", \"Mon DD,YYYY\")),\n-    test.assertEqual(null, core.parseDate(\"notADate\", \"Mon DD,YYYY\"))\n+    test.assertEqual(null, core.parseDate(\"notADate\", \"Mon DD,YYYY\")),\n+    test.assertEqual(null, core.parseDate(null, \"Mon DD,YYYY\")),", "originalCommit": "a585dff1b5b5127c9392a79a952cdc09b558b40d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e7f9641ae4f91121016cce187554cfd2823b90ea", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e7f9641ae4f91121016cce187554cfd2823b90ea", "message": "DHFPROD-4543:Map empty or null value to null when using parseDate and parseDateTime", "committedDate": "2020-10-05T18:35:28Z", "type": "commit"}, {"oid": "e7f9641ae4f91121016cce187554cfd2823b90ea", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e7f9641ae4f91121016cce187554cfd2823b90ea", "message": "DHFPROD-4543:Map empty or null value to null when using parseDate and parseDateTime", "committedDate": "2020-10-05T18:35:28Z", "type": "forcePushed"}]}