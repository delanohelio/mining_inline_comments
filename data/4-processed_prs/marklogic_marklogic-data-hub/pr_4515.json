{"pr_number": 4515, "pr_title": "DHFPROD-5810:Adding \"targetEntity\" to mapping steps", "pr_createdAt": "2020-09-01T19:58:55Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4515", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5OTQwMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4515#discussion_r481399401", "bodyText": "I'm totally confused by this because I know this has been run successfully in QS for many months - likely since 5.0 was created - without having targetEntity in it. I'm glad adding targetEntity makes it work in QS, but I'm 99.9% sure that the mappings in this project have worked before without targetEntity.", "author": "rjrudin", "createdAt": "2020-09-01T20:04:27Z", "path": "examples/dh-5-example/flows/ingestion_mapping-flow.flow.json", "diffHunk": "@@ -1,105 +1,106 @@\n-{\r\n-  \"name\": \"ingestion_mapping-flow\",\r\n-  \"description\": \"This is the default flow containing all of the default steps\",\r\n-  \"batchSize\": 100,\r\n-  \"threadCount\": 4,\r\n-  \"options\": {\r\n-    \"sourceQuery\": null\r\n-  },\r\n-  \"steps\": {\r\n-    \"1\": {\r\n-      \"name\": \"ingest-step-json\",\r\n-      \"description\": \"ingests json docs in JSON format to data-hub-STAGING\",\r\n-      \"stepDefinitionName\": \"default-ingestion\",\r\n-      \"stepDefinitionType\": \"INGESTION\",\r\n-      \"options\": {\r\n-        \"sourceQuery\": null,\r\n-        \"collections\": [\r\n-          \"mapping-flow-ingestion-json\"\r\n-        ],\r\n-        \"permissions\": \"rest-reader,read,rest-writer,update\",\r\n-        \"outputFormat\": \"json\",\r\n-        \"targetDatabase\": \"data-hub-FINAL\"\r\n-      },\r\n-      \"customHook\": {},\r\n-      \"retryLimit\": 0,\r\n-      \"batchSize\": 100,\r\n-      \"threadCount\": 4,\r\n-      \"fileLocations\": {\r\n-        \"inputFilePath\": \"input\",\r\n-        \"inputFileType\": \"json\",\r\n-        \"outputURIReplacement\": \".*input*.,'/mapping-flow/json/'\"\r\n-      }\r\n-    },\r\n-    \"2\": {\r\n-      \"name\": \"mapping-step-json\",\r\n-      \"description\": \"maps and harmonizes JSON docs to data-hub-FINAL\",\r\n-      \"stepDefinitionName\": \"entity-services-mapping\",\r\n-      \"stepDefinitionType\": \"MAPPING\",\r\n-      \"options\": {\r\n-        \"sourceQuery\": \"cts.collectionQuery('mapping-flow-ingestion-json')\",\r\n-        \"mapping\": {\r\n-          \"name\": \"OrderMappingJson\",\r\n-          \"version\": 1\r\n-        },\r\n-        \"sourceDatabase\": \"data-hub-FINAL\",\r\n-        \"collections\": [\r\n-          \"mapping-flow-mapping-json\"\r\n-        ],\r\n-        \"outputFormat\": \"json\",\r\n-        \"targetDatabase\": \"data-hub-FINAL\"\r\n-      },\r\n-      \"customHook\": null,\r\n-      \"retryLimit\": 0,\r\n-      \"batchSize\": 0,\r\n-      \"threadCount\": 0\r\n-    },\r\n-    \"3\": {\r\n-      \"name\": \"ingest-step-xml\",\r\n-      \"description\": \"ingests xml docs in XML format to data-hub-STAGING\",\r\n-      \"stepDefinitionName\": \"default-ingestion\",\r\n-      \"stepDefinitionType\": \"INGESTION\",\r\n-      \"options\": {\r\n-        \"sourceQuery\": null,\r\n-        \"collections\": [\r\n-          \"mapping-flow-ingestion-xml\"\r\n-        ],\r\n-        \"permissions\": \"rest-reader,read,rest-writer,update\",\r\n-        \"outputFormat\": \"xml\",\r\n-        \"targetDatabase\": \"data-hub-STAGING\"\r\n-      },\r\n-      \"customHook\": {},\r\n-      \"retryLimit\": 0,\r\n-      \"batchSize\": 100,\r\n-      \"threadCount\": 4,\r\n-      \"fileLocations\": {\r\n-        \"inputFilePath\": \"input\",\r\n-        \"inputFileType\": \"xml\",\r\n-        \"outputURIReplacement\": \".*input*.,'/mapping-flow/xml/'\"\r\n-      }\r\n-    },\r\n-    \"4\": {\r\n-      \"name\": \"mapping-step-xml\",\r\n-      \"description\": \"maps and harmonizes XML docs to data-hub-FINAL\",\r\n-      \"stepDefinitionName\": \"entity-services-mapping\",\r\n-      \"stepDefinitionType\": \"MAPPING\",\r\n-      \"options\": {\r\n-        \"sourceQuery\": \"cts.collectionQuery('mapping-flow-ingestion-xml')\",\r\n-        \"mapping\": {\r\n-          \"name\": \"OrderMappingXml\",\r\n-          \"version\": 1\r\n-        },\r\n-        \"sourceDatabase\": \"data-hub-STAGING\",\r\n-        \"collections\": [\r\n-          \"mapping-flow-mapping-xml\"\r\n-        ],\r\n-        \"outputFormat\": \"xml\",\r\n-        \"targetDatabase\": \"data-hub-FINAL\"\r\n-      },\r\n-      \"customHook\": null,\r\n-      \"retryLimit\": 0,\r\n-      \"batchSize\": 0,\r\n-      \"threadCount\": 0\r\n-    }\r\n-  }\r\n-}\r\n+{\n+  \"name\": \"ingestion_mapping-flow\",\n+  \"description\": \"This is the default flow containing all of the default steps\",\n+  \"batchSize\": 100,\n+  \"threadCount\": 4,\n+  \"options\": {\n+    \"sourceQuery\": null\n+  },\n+  \"steps\": {\n+    \"1\": {\n+      \"name\": \"ingest-step-json\",\n+      \"description\": \"ingests json docs in JSON format to data-hub-STAGING\",\n+      \"stepDefinitionName\": \"default-ingestion\",\n+      \"stepDefinitionType\": \"INGESTION\",\n+      \"options\": {\n+        \"sourceQuery\": null,\n+        \"collections\": [\n+          \"mapping-flow-ingestion-json\"\n+        ],\n+        \"permissions\": \"rest-reader,read,rest-writer,update\",\n+        \"outputFormat\": \"json\",\n+        \"targetDatabase\": \"data-hub-FINAL\"\n+      },\n+      \"customHook\": {},\n+      \"retryLimit\": 0,\n+      \"batchSize\": 100,\n+      \"threadCount\": 4,\n+      \"fileLocations\": {\n+        \"inputFilePath\": \"input\",\n+        \"inputFileType\": \"json\",\n+        \"outputURIReplacement\": \".*input*.,'/mapping-flow/json/'\"\n+      }\n+    },\n+    \"2\": {\n+      \"name\": \"mapping-step-json\",\n+      \"description\": \"maps and harmonizes JSON docs to data-hub-FINAL\",\n+      \"stepDefinitionName\": \"entity-services-mapping\",\n+      \"stepDefinitionType\": \"MAPPING\",\n+      \"options\": {\n+        \"sourceQuery\": \"cts.collectionQuery('mapping-flow-ingestion-json')\",\n+        \"targetEntity\" : \"Order\",", "originalCommit": "9cff474518e2b2537dc56a708fcba14722748be3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNjM5MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4515#discussion_r481406391", "bodyText": "It still does. You can run mapping in QS using the Run button. The issue I think is that the source and entity table dont show up and we wont be able to edit the mapping expressions or Test/Clear.", "author": "bsrikan", "createdAt": "2020-09-01T20:18:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5OTQwMQ=="}], "type": "inlineReview"}, {"oid": "332ab3e7bf4827d690550967cfea93e7ea2a50b4", "url": "https://github.com/marklogic/marklogic-data-hub/commit/332ab3e7bf4827d690550967cfea93e7ea2a50b4", "message": "DHFPROD-5810:Adding \"targetEntity\" to mapping steps", "committedDate": "2020-09-01T20:58:54Z", "type": "commit"}, {"oid": "332ab3e7bf4827d690550967cfea93e7ea2a50b4", "url": "https://github.com/marklogic/marklogic-data-hub/commit/332ab3e7bf4827d690550967cfea93e7ea2a50b4", "message": "DHFPROD-5810:Adding \"targetEntity\" to mapping steps", "committedDate": "2020-09-01T20:58:54Z", "type": "forcePushed"}]}