{"pr_number": 4474, "pr_title": "DHFPROD-5183: Transform merge steps to new model", "pr_createdAt": "2020-08-24T22:33:36Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4474", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwMDQ3Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4474#discussion_r476400477", "bodyText": "No need to change this, but just an FYI, pinging @srinathgit  and @ryanjdew  on this too - one thing I'd like to do, particularly in our tests, is get a HubClient as early as possible and use that for all connections. The benefit is that it doesn't create a new DatabaseClient each time the way HubConfig does when you call one of its new*Client methods. That also means less and less code that depends on HubConfig - I'd really like our code to depend on HubClient and (if needed) HubProject, with HubConfig becoming something that's discarded once those two things are obtained. But again, no need to change this, just a note.", "author": "rjrudin", "createdAt": "2020-08-25T12:13:42Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/conversion/FlowConverter.java", "diffHunk": "@@ -514,4 +524,23 @@ protected void transformMatchingOptions(ObjectNode stepNode) {\n             stepNode.set(fieldName, node);\n         }\n     }\n+\n+    protected void transformMergingOptions(ObjectNode stepNode) {\n+        JsonNode beforeNode = stepNode.get(\"mergeOptions\");\n+        // if mergeOptions is null, this conversion has already run\n+        if (beforeNode == null) {\n+            return;\n+        }\n+\n+        JsonNode afterNode = MasteringService.on(hubConfig.newHubClient().getStagingClient()).updateMergeOptions(beforeNode);", "originalCommit": "a9e2848b65b802e8b218b030ca9e4330b80d1290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwMTY0OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4474#discussion_r476401648", "bodyText": "Can you add unit tests for these functions?", "author": "rjrudin", "createdAt": "2020-08-25T12:15:52Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/mastering/updateMergeOptionsLib.sjs", "diffHunk": "@@ -0,0 +1,209 @@\n+'use strict';\n+\n+function updateMergeOptions(opt)", "originalCommit": "a9e2848b65b802e8b218b030ca9e4330b80d1290", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQxNjE2OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4474#discussion_r476416168", "bodyText": "Oops, misplaced that file and found it in an auto-stash. Added in latest push.", "author": "fsnow", "createdAt": "2020-08-25T12:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwMTY0OA=="}], "type": "inlineReview"}, {"oid": "84b03b08ceb353ca775db41208f912e56b4a74d3", "url": "https://github.com/marklogic/marklogic-data-hub/commit/84b03b08ceb353ca775db41208f912e56b4a74d3", "message": "DHFPROD-5183: Transform merge steps to new model", "committedDate": "2020-08-25T12:37:21Z", "type": "commit"}]}