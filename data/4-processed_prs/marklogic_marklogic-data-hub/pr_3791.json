{"pr_number": 3791, "pr_title": "DHFPROD-4399:See up to 10 mapping errors after step runs", "pr_createdAt": "2020-04-05T08:04:41Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3791", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEyNjI1Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#discussion_r404126257", "bodyText": "MockRolesService is something that can be reused by other \"pages\" in test, so we should probably create a separate module. There is a __mocks__ folder under src/api to store mock functions", "author": "bsrikan", "createdAt": "2020-04-06T14:16:50Z", "path": "one-ui/ui/src/pages/Bench.test.tsx", "diffHunk": "@@ -1,9 +1,185 @@\n import React from 'react';\n-import { shallow } from 'enzyme';\n-import Bench from './Bench';\n-\n-describe('Bench component', () => {\n-  it('should render correctly', () => {\n-    shallow(<Bench />);\n-  });\n-});\n\\ No newline at end of file\n+import { render, fireEvent, waitForElement, cleanup } from '@testing-library/react'\n+import '@testing-library/jest-dom/extend-expect'\n+import axiosMock from 'axios'\n+import  Bench from '../pages/Bench';\n+import {IRolesContextInterface, RolesContext} from '../util/roles';\n+\n+jest.mock('axios');\n+\n+class MockRolesService implements IRolesContextInterface{", "originalCommit": "9f7d8a9d2cde625be66b864edfde0f730716a700", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEzNTI0Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#discussion_r404135243", "bodyText": "Mock responses below can also be reused. Can you pls move them into data.config.\nAlso pls change the flow/step name and uri", "author": "bsrikan", "createdAt": "2020-04-06T14:28:06Z", "path": "one-ui/ui/src/pages/Bench.test.tsx", "diffHunk": "@@ -1,9 +1,185 @@\n import React from 'react';\n-import { shallow } from 'enzyme';\n-import Bench from './Bench';\n-\n-describe('Bench component', () => {\n-  it('should render correctly', () => {\n-    shallow(<Bench />);\n-  });\n-});\n\\ No newline at end of file\n+import { render, fireEvent, waitForElement, cleanup } from '@testing-library/react'\n+import '@testing-library/jest-dom/extend-expect'\n+import axiosMock from 'axios'\n+import  Bench from '../pages/Bench';\n+import {IRolesContextInterface, RolesContext} from '../util/roles';\n+\n+jest.mock('axios');\n+\n+class MockRolesService implements IRolesContextInterface{\n+    public roles: string[] = [];\n+\n+    public setRoles: (roles: string[]) => void = (roles: string[]) => {\n+        this.roles = roles;\n+    };\n+    public canReadMappings:() => boolean = () => {\n+        return false;\n+    };\n+    public canWriteMappings:() => boolean = () => {\n+        return false;\n+    };\n+    public canReadMatchMerge:() => boolean = () => {\n+        return false;\n+    };\n+    public canWriteMatchMerge:() => boolean = () => {\n+        return false;\n+    };\n+    public canReadLoadData:() => boolean = () => {\n+        return true;\n+    };\n+    public canWriteLoadData:() => boolean = () => {\n+        return true;\n+    };\n+    public canReadEntityModels:() => boolean = () => {\n+        return false;\n+    };\n+    public canWriteEntityModels:() => boolean = () => {\n+        return false;\n+    };\n+    public canReadFlows:() => boolean = () => {\n+        return true;\n+    };\n+    public canWriteFlows:() => boolean = () => {\n+        return true;\n+    };\n+    public canReadStepDefinitions:() => boolean = () => {\n+        return false;\n+    };\n+    public canWriteStepDefinitions:() => boolean = () => {\n+        return false;\n+    };\n+    public hasOperatorRole:() => boolean = () => {\n+        return true;\n+    };\n+}\n+\n+//Mock Responses", "originalCommit": "9f7d8a9d2cde625be66b864edfde0f730716a700", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f8796dc8f0b20029ca2ef1a073758f8bd1e92bc9", "url": "https://github.com/marklogic/marklogic-data-hub/commit/f8796dc8f0b20029ca2ef1a073758f8bd1e92bc9", "message": "DHFPROD-4399:See up to 10 mapping errors after step runs", "committedDate": "2020-04-06T22:37:47Z", "type": "forcePushed"}, {"oid": "49a1a479a11f9464858c3fb65b02622931a16e88", "url": "https://github.com/marklogic/marklogic-data-hub/commit/49a1a479a11f9464858c3fb65b02622931a16e88", "message": "DHFPROD-4399:See up to 10 mapping errors after step runs", "committedDate": "2020-04-07T00:24:21Z", "type": "commit"}, {"oid": "49a1a479a11f9464858c3fb65b02622931a16e88", "url": "https://github.com/marklogic/marklogic-data-hub/commit/49a1a479a11f9464858c3fb65b02622931a16e88", "message": "DHFPROD-4399:See up to 10 mapping errors after step runs", "committedDate": "2020-04-07T00:24:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4OTM2OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#discussion_r405689368", "bodyText": "Should the stepName and definitions be mapping since its a test for mapping story. We have to create a similar one for ingestion as well and have a separate story for that.", "author": "bsrikan", "createdAt": "2020-04-08T17:23:01Z", "path": "one-ui/ui/src/config/bench.config.ts", "diffHunk": "@@ -0,0 +1,145 @@\n+import {IRolesContextInterface} from \"../util/roles\";\n+\n+class MockRolesService implements IRolesContextInterface{\n+  public roles: string[] = [];\n+\n+  public setRoles: (roles: string[]) => void = (roles: string[]) => {\n+    this.roles = roles;\n+  };\n+  public canReadMappings:() => boolean = () => {\n+    return false;\n+  };\n+  public canWriteMappings:() => boolean = () => {\n+    return false;\n+  };\n+  public canReadMatchMerge:() => boolean = () => {\n+    return false;\n+  };\n+  public canWriteMatchMerge:() => boolean = () => {\n+    return false;\n+  };\n+  public canReadLoadData:() => boolean = () => {\n+    return true;\n+  };\n+  public canWriteLoadData:() => boolean = () => {\n+    return true;\n+  };\n+  public canReadEntityModels:() => boolean = () => {\n+    return false;\n+  };\n+  public canWriteEntityModels:() => boolean = () => {\n+    return false;\n+  };\n+  public canReadFlows:() => boolean = () => {\n+    return true;\n+  };\n+  public canWriteFlows:() => boolean = () => {\n+    return true;\n+  };\n+  public canReadStepDefinitions:() => boolean = () => {\n+    return false;\n+  };\n+  public canWriteStepDefinitions:() => boolean = () => {\n+    return false;\n+  };\n+  public hasOperatorRole:() => boolean = () => {\n+    return true;\n+  };\n+}\n+\n+const response = {\"data\":{\"jobId\": \"350da405-c1e9-4fa7-8269-d9aefe3b4b9a\"}, \"status\": 200};\n+const jobResp = {\n+  \"data\": {\n+    \"jobId\": \"350da405-c1e9-4fa7-8269-d9aefe3b4b9a\",\n+    \"flow\": \"testFlow\",\n+    \"user\": \"admin\",\n+    \"lastAttemptedStep\": \"1\",\n+    \"lastCompletedStep\": \"1\",\n+    \"timeStarted\": \"2020-04-04T01:17:44.918282-07:00\",\n+    \"timeEnded\": \"2020-04-04T01:17:45.012137-07:00\",\n+    \"stepResponses\": {\n+      \"1\": {\n+        \"flowName\": \"testFlow\",\n+        \"stepName\": \"failedIngest\",\n+        \"stepDefinitionName\": \"default-ingestion\",\n+        \"stepDefinitionType\": \"ingestion\",", "originalCommit": "49a1a479a11f9464858c3fb65b02622931a16e88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY5NTAxMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#discussion_r405695011", "bodyText": "It can be either, this is just mock data. The UI code for rendering mapping is not in place yet, so used ingestion", "author": "srinathgit", "createdAt": "2020-04-08T17:32:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4OTM2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyNzQ0OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#discussion_r405727449", "bodyText": "Fair enough.", "author": "bsrikan", "createdAt": "2020-04-08T18:27:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4OTM2OA=="}], "type": "inlineReview"}]}