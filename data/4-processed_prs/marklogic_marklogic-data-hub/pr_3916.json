{"pr_number": 3916, "pr_title": "DHFPROD-4760: Set up to Run cypress tests on DHS", "pr_createdAt": "2020-05-05T06:38:38Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3916", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2NDQwNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420064406", "bodyText": "Remove this, it has no impact", "author": "rjrudin", "createdAt": "2020-05-05T12:18:39Z", "path": "marklogic-data-hub-central/ui/e2e/qa-project/gradle-dhs.properties", "diffHunk": "@@ -0,0 +1,45 @@\n+mlDHFVersion=5.3-SNAPSHOT\n+\n+mlIsHostLoadBalancer=true\n+mlIsProvisionedEnvironment=true\n+mlStagingAuth=basic\n+mlFinalAuth=basic\n+mlJobAuth=basic\n+mlAppServicesAuthentication=basic\n+mlJobSimpleSsl=true\n+mlFinalSimpleSsl=true\n+mlStagingSimpleSsl=true\n+mlAdminScheme=https\n+mlManageScheme=https\n+mlAppServicesSimpleSsl=true\n+mlManageSimpleSsl=true\n+sslFlag=true", "originalCommit": "91dec37ded11efe8f4df02bb7a29f43daa1a8b6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2NDY5Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420064693", "bodyText": "Can remove all of these mlStaging* properties, assuming they're already defined in gradle.properties", "author": "rjrudin", "createdAt": "2020-05-05T12:19:12Z", "path": "marklogic-data-hub-central/ui/e2e/qa-project/gradle-dhs.properties", "diffHunk": "@@ -0,0 +1,45 @@\n+mlDHFVersion=5.3-SNAPSHOT\n+\n+mlIsHostLoadBalancer=true\n+mlIsProvisionedEnvironment=true\n+mlStagingAuth=basic\n+mlFinalAuth=basic\n+mlJobAuth=basic\n+mlAppServicesAuthentication=basic\n+mlJobSimpleSsl=true\n+mlFinalSimpleSsl=true\n+mlStagingSimpleSsl=true\n+mlAdminScheme=https\n+mlManageScheme=https\n+mlAppServicesSimpleSsl=true\n+mlManageSimpleSsl=true\n+sslFlag=true\n+\n+mlStagingAppserverName=data-hub-STAGING", "originalCommit": "91dec37ded11efe8f4df02bb7a29f43daa1a8b6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2NDc5MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420064790", "bodyText": "Likewise, remove all of these mlJob* properties", "author": "rjrudin", "createdAt": "2020-05-05T12:19:21Z", "path": "marklogic-data-hub-central/ui/e2e/qa-project/gradle-dhs.properties", "diffHunk": "@@ -0,0 +1,45 @@\n+mlDHFVersion=5.3-SNAPSHOT\n+\n+mlIsHostLoadBalancer=true\n+mlIsProvisionedEnvironment=true\n+mlStagingAuth=basic\n+mlFinalAuth=basic\n+mlJobAuth=basic\n+mlAppServicesAuthentication=basic\n+mlJobSimpleSsl=true\n+mlFinalSimpleSsl=true\n+mlStagingSimpleSsl=true\n+mlAdminScheme=https\n+mlManageScheme=https\n+mlAppServicesSimpleSsl=true\n+mlManageSimpleSsl=true\n+sslFlag=true\n+\n+mlStagingAppserverName=data-hub-STAGING\n+mlStagingPort=8010\n+mlStagingDbName=data-hub-STAGING\n+mlStagingForestsPerHost=1\n+\n+mlAppServicesPort=8010\n+\n+mlJobAppserverName=data-hub-JOBS", "originalCommit": "91dec37ded11efe8f4df02bb7a29f43daa1a8b6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2NTA3MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420065070", "bodyText": "This is incorrect; remove it so that the correct default value is used. Also remove mlModulesDbName.", "author": "rjrudin", "createdAt": "2020-05-05T12:19:51Z", "path": "marklogic-data-hub-central/ui/e2e/qa-project/gradle-dhs.properties", "diffHunk": "@@ -0,0 +1,45 @@\n+mlDHFVersion=5.3-SNAPSHOT\n+\n+mlIsHostLoadBalancer=true\n+mlIsProvisionedEnvironment=true\n+mlStagingAuth=basic\n+mlFinalAuth=basic\n+mlJobAuth=basic\n+mlAppServicesAuthentication=basic\n+mlJobSimpleSsl=true\n+mlFinalSimpleSsl=true\n+mlStagingSimpleSsl=true\n+mlAdminScheme=https\n+mlManageScheme=https\n+mlAppServicesSimpleSsl=true\n+mlManageSimpleSsl=true\n+sslFlag=true\n+\n+mlStagingAppserverName=data-hub-STAGING\n+mlStagingPort=8010\n+mlStagingDbName=data-hub-STAGING\n+mlStagingForestsPerHost=1\n+\n+mlAppServicesPort=8010\n+\n+mlJobAppserverName=data-hub-JOBS\n+mlJobPort=8013\n+mlJobDbName=data-hub-JOBS\n+mlJobForestsPerHost=1\n+\n+mlModulesDbName=data-hub-MODULES\n+mlModulePermissions=flowDeveloper,read,flowDeveloper,execute,flowDeveloper,insert,flowDeveloper,update,flowOperator,read,flowOperator,execute,flowOperator,insert,flowOperator,update", "originalCommit": "91dec37ded11efe8f4df02bb7a29f43daa1a8b6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2NTE4NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420065185", "bodyText": "Remove these next 8 properties", "author": "rjrudin", "createdAt": "2020-05-05T12:20:02Z", "path": "marklogic-data-hub-central/ui/e2e/qa-project/gradle-dhs.properties", "diffHunk": "@@ -0,0 +1,45 @@\n+mlDHFVersion=5.3-SNAPSHOT\n+\n+mlIsHostLoadBalancer=true\n+mlIsProvisionedEnvironment=true\n+mlStagingAuth=basic\n+mlFinalAuth=basic\n+mlJobAuth=basic\n+mlAppServicesAuthentication=basic\n+mlJobSimpleSsl=true\n+mlFinalSimpleSsl=true\n+mlStagingSimpleSsl=true\n+mlAdminScheme=https\n+mlManageScheme=https\n+mlAppServicesSimpleSsl=true\n+mlManageSimpleSsl=true\n+sslFlag=true\n+\n+mlStagingAppserverName=data-hub-STAGING\n+mlStagingPort=8010\n+mlStagingDbName=data-hub-STAGING\n+mlStagingForestsPerHost=1\n+\n+mlAppServicesPort=8010\n+\n+mlJobAppserverName=data-hub-JOBS\n+mlJobPort=8013\n+mlJobDbName=data-hub-JOBS\n+mlJobForestsPerHost=1\n+\n+mlModulesDbName=data-hub-MODULES\n+mlModulePermissions=flowDeveloper,read,flowDeveloper,execute,flowDeveloper,insert,flowDeveloper,update,flowOperator,read,flowOperator,execute,flowOperator,insert,flowOperator,update\n+mlStagingTriggersDbName=data-hub-staging-TRIGGERS", "originalCommit": "91dec37ded11efe8f4df02bb7a29f43daa1a8b6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE0MzcwNA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420143704", "bodyText": "Are we going to provide mlHost param even when running locally?\nie ./setup.sh dhs=false mlHost=localhost", "author": "bsrikan", "createdAt": "2020-05-05T14:16:03Z", "path": "marklogic-data-hub-central/ui/e2e/setup.sh", "diffHunk": "@@ -1,16 +1,25 @@\n #!/bin/bash\n-set e+x\n+\n+cd qa-project;\n+DHS=`echo $1 | cut -d'=' -f 2`\n+mlHost=`echo $2 | cut -d'=' -f 2`\n+env='local'\n \n credentials='-PmlUsername=dh-dev -PmlPassword=dh-dev'\n-cd qa-project\n \n ./gradlew hubInit\n-cp ../cypress/fixtures/users/* src/main/ml-config/security/users/\n-./gradlew mlDeploy --info\n-./gradlew hubSaveIndexes --info\n-./gradlew hubDeployAsDeveloper $credentials --info\n \n+if $DHS\n+then\n+        ./gradlew hubDeployAsDeveloper  --info $credentials -PenvironmentName=dhs -PmlHost=$mlHost\n+        env='dhs'\n+else\n+        cp ../cypress/fixtures/users/* src/main/ml-config/security/users/\n+        ./gradlew mlDeploy --info\n+        ./gradlew hubSaveIndexes --info\n+        ./gradlew hubDeployAsDeveloper $credentials --info\n+fi\n \n-./gradlew hubRunFlow $credentials -PflowName=AdvantageFlow -PentityName=Customer -PbatchSize=100 -PthreadCount=4 -Psteps=\"1,2\"\n-./gradlew hubRunFlow $credentials -PflowName=PersonFlow -PentityName=Person -PbatchSize=100 -PthreadCount=4 -Psteps=\"1,2\"\n-./gradlew hubRunFlow $credentials -PflowName=PersonXMLFlow -PentityName=PersonXML -PbatchSize=100 -PthreadCount=4 -Psteps=\"1,2\"\n+./gradlew hubRunFlow $credentials -PenvironmentName=$env -PflowName=AdvantageFlow -PentityName=Customer -PbatchSize=100 -PthreadCount=4 -Psteps='1,2' -PmlHost=$mlHost  --info", "originalCommit": "91dec37ded11efe8f4df02bb7a29f43daa1a8b6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzNjQ1Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420236452", "bodyText": "Yes", "author": "SameeraPriyathamTadikonda", "createdAt": "2020-05-05T16:19:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE0MzcwNA=="}], "type": "inlineReview"}, {"oid": "151eb9e7a9bec2183880bb3e271293caccf73696", "url": "https://github.com/marklogic/marklogic-data-hub/commit/151eb9e7a9bec2183880bb3e271293caccf73696", "message": "DHFPROD-4760: Set up to Run cypress tests on DHS\n\nAdding mlhost to the setup and removing unused properties", "committedDate": "2020-05-05T16:49:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5OTE5NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420299194", "bodyText": "What does the \"dhs\" property do? I'm not aware of it.", "author": "rjrudin", "createdAt": "2020-05-05T17:55:09Z", "path": "Jenkinsfile", "diffHunk": "@@ -50,7 +50,7 @@ def dhfCypressE2ETests(String mlVersion, String type){\n                     ./gradlew clean;\n                     cd marklogic-data-hub-central/ui/e2e;\n                     chmod +x setup.sh;\n-                    ./setup.sh;\n+                    ./setup.sh dhs=false mlHost=localhost;", "originalCommit": "151eb9e7a9bec2183880bb3e271293caccf73696", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMzA2NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420313065", "bodyText": "We made few changes to the script setup.sh which is expecting the value \"dhs=true/fase\" based on the type of environment we are testing on. In Jenkins pipeline we are running cypress e2e tests on a local environment, so setting the property \"dhs=false\"", "author": "SameeraPriyathamTadikonda", "createdAt": "2020-05-05T18:18:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5OTE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMzYyNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420313626", "bodyText": "Setting up dhs=true will run the tasks \"hubdeployasdeveloper\" and dhs=false will run \"mldeploy\"", "author": "SameeraPriyathamTadikonda", "createdAt": "2020-05-05T18:19:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5OTE5NA=="}], "type": "inlineReview"}, {"oid": "752ea0deedf9693a129c27baf357c140f77fece8", "url": "https://github.com/marklogic/marklogic-data-hub/commit/752ea0deedf9693a129c27baf357c140f77fece8", "message": "DHFPROD-4760: Set up to Run cypress tests on DHS\n\nAdding mlhost to the setup and removing unused properties\n\nAdding few properties and stacktrace to gradle commands", "committedDate": "2020-05-05T23:26:37Z", "type": "forcePushed"}, {"oid": "d8c274c162a2c91f1d79e714ff3ab2126f28b066", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d8c274c162a2c91f1d79e714ff3ab2126f28b066", "message": "DHFPROD-4760: Set up to Run cypress tests on DHS\n\nAdding mlhost to the setup and removing unused properties\n\nAdding few properties and stacktrace to gradle commands\n\nFixing typo", "committedDate": "2020-05-05T23:31:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc1NTY0MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420755641", "bodyText": "For clarity, it's worth removing mlAdminScheme too, since it's not used (mlAdminSimpleSsl would need to be true as well if it were used). I'll approve though, it's a minor thing.", "author": "rjrudin", "createdAt": "2020-05-06T12:36:35Z", "path": "marklogic-data-hub-central/ui/e2e/qa-project/gradle-dhs.properties", "diffHunk": "@@ -0,0 +1,23 @@\n+mlDHFVersion=5.3-SNAPSHOT\n+\n+mlIsHostLoadBalancer=true\n+mlIsProvisionedEnvironment=true\n+mlStagingAuth=basic\n+mlFinalAuth=basic\n+mlJobAuth=basic\n+mlAppServicesAuthentication=basic\n+mlJobSimpleSsl=true\n+mlFinalSimpleSsl=true\n+mlStagingSimpleSsl=true\n+mlAdminScheme=https", "originalCommit": "d8c274c162a2c91f1d79e714ff3ab2126f28b066", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzMzgxNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3916#discussion_r420933816", "bodyText": "okay sure I'll remove when I add another commit.", "author": "SameeraPriyathamTadikonda", "createdAt": "2020-05-06T16:39:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc1NTY0MQ=="}], "type": "inlineReview"}, {"oid": "5d77998e20b1eead8a25ea4d0b7d5395229e7251", "url": "https://github.com/marklogic/marklogic-data-hub/commit/5d77998e20b1eead8a25ea4d0b7d5395229e7251", "message": "DHFPROD-4760: Set up to Run cypress tests on DHS\n\nAdding mlhost to the setup and removing unused properties\n\nAdding few properties and stacktrace to gradle commands\n\nFixing typo\n\nupdating the input file path", "committedDate": "2020-05-06T16:37:44Z", "type": "forcePushed"}, {"oid": "b4309f1b0b1723fe82a7412ec4affa9f5b265ead", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b4309f1b0b1723fe82a7412ec4affa9f5b265ead", "message": "DHFPROD-4760: Set up to Run cypress tests on DHS\n\nAdding mlhost to the setup and removing unused properties\n\nAdding few properties and stacktrace to gradle commands\n\nFixing typo\n\nupdating the input file path\n\nChanging the task to hubInit", "committedDate": "2020-05-06T18:43:20Z", "type": "commit"}, {"oid": "b4309f1b0b1723fe82a7412ec4affa9f5b265ead", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b4309f1b0b1723fe82a7412ec4affa9f5b265ead", "message": "DHFPROD-4760: Set up to Run cypress tests on DHS\n\nAdding mlhost to the setup and removing unused properties\n\nAdding few properties and stacktrace to gradle commands\n\nFixing typo\n\nupdating the input file path\n\nChanging the task to hubInit", "committedDate": "2020-05-06T18:43:20Z", "type": "forcePushed"}]}