{"pr_number": 3870, "pr_title": "DHFPROD-4728: Adding roles and users to export entity instances", "pr_createdAt": "2020-04-24T21:34:11Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3870", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwNzY2NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3870#discussion_r414907664", "bodyText": "Can we test for this file?\ntestInit() in HubProjectTest already performs such a test.", "author": "akshaysonvane", "createdAt": "2020-04-24T22:58:13Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubProjectImpl.java", "diffHunk": "@@ -371,6 +371,7 @@ public Path getCustomMappingFunctionsDir() {\n         writeRoleFile(rolesDir, \"data-hub-saved-query-reader.json\");\n         writeRoleFile(rolesDir, \"data-hub-saved-query-writer.json\");\n         writeRoleFile(rolesDir, \"hub-central-downloader.json\");\n+        writeRoleFile(rolesDir, \"hub-central-entity-exporter.json\");", "originalCommit": "a4cc7e7356559322ca822e1acfcecbf44f6db07f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e0608c7f7e66b4694c8e34ea41304f971207365a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e0608c7f7e66b4694c8e34ea41304f971207365a", "message": "DHFPROD-4728: Adding roles and users to export entity instances", "committedDate": "2020-04-25T00:03:20Z", "type": "commit"}, {"oid": "e0608c7f7e66b4694c8e34ea41304f971207365a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e0608c7f7e66b4694c8e34ea41304f971207365a", "message": "DHFPROD-4728: Adding roles and users to export entity instances", "committedDate": "2020-04-25T00:03:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ3MzU5OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3870#discussion_r415473598", "bodyText": "The middle tier endpoint for exporting should then have @secured(\"canExportEntityInstances\") on it. You can use setTestUserRoles to verify that a user with and without the role can access the endpoint.", "author": "rjrudin", "createdAt": "2020-04-27T02:48:41Z", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/impl/security.sjs", "diffHunk": "@@ -43,6 +43,10 @@ class Security {\n       response.authorities.push('canManageSavedQuery');\n     }\n \n+    if (currentRoleNames.includes('hub-central-entity-exporter')) {\n+      response.authorities.push('canExportEntityInstances');", "originalCommit": "e0608c7f7e66b4694c8e34ea41304f971207365a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTUwMzkzNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3870#discussion_r415503936", "bodyText": "@akshaysonvane Can you add this in the PR #3862 as you are working on adding the endpoints.", "author": "rahulvudutala", "createdAt": "2020-04-27T04:36:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ3MzU5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkwNzAxNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3870#discussion_r415907015", "bodyText": "Yes, I'll add that.", "author": "akshaysonvane", "createdAt": "2020-04-27T15:22:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ3MzU5OA=="}], "type": "inlineReview"}]}