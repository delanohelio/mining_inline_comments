{"pr_number": 1649, "pr_title": "Increase StartlevelEvent delay to 15 seconds", "pr_createdAt": "2020-09-17T22:48:39Z", "pr_url": "https://github.com/openhab/openhab-core/pull/1649", "timeline": [{"oid": "1d8d6032ceae22345ae4a589766659fe6de94b4b", "url": "https://github.com/openhab/openhab-core/commit/1d8d6032ceae22345ae4a589766659fe6de94b4b", "message": "Increase StartlevelEvent delay to 15 seconds\n\nThe rules are often not instantiated within 5 seconds.\nOn a Raspberry Pi 3B it can take 12 seconds before rules are instantiated.\nThe code has also been improved with proper null annotations.\n\nRelated to #1637\n\nSigned-off-by: Wouter Born <github@maindrain.net>", "committedDate": "2020-09-17T22:47:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc0NTU0Mw==", "url": "https://github.com/openhab/openhab-core/pull/1649#discussion_r490745543", "bodyText": "Oh, that's a worthwhile improvement - creating a new listener on every marker event was indeed a very bad idea. I'd bet that this change alone will make the RPi to only need 5 secs to be ready for rules now ;-)", "author": "kaikreuzer", "createdAt": "2020-09-18T07:08:25Z", "path": "bundles/org.openhab.core.model.rule/src/org/openhab/core/model/rule/jvmmodel/RulesRefresher.java", "diffHunk": "@@ -50,30 +51,65 @@\n  * @author Maoliang Huang - refactor\n  */\n @Component(immediate = true, service = {})\n+@NonNullByDefault\n public class RulesRefresher implements ReadyTracker {\n \n-    // delay in ms before rule resources are refreshed after items or services have changed\n-    private static final long REFRESH_DELAY = 5000;\n+    // delay in seconds before rule resources are refreshed after items or services have changed\n+    private static final long REFRESH_DELAY = 5;\n \n     private static final String POOL_NAME = \"automation\";\n     public static final String RULES_REFRESH = \"rules_refresh\";\n \n     private final Logger logger = LoggerFactory.getLogger(RulesRefresher.class);\n \n-    private ScheduledFuture<?> job;\n-    private ScheduledExecutorService scheduler = ThreadPoolManager.getScheduledPool(POOL_NAME);\n+    private @Nullable ScheduledFuture<?> job;\n+    private final ScheduledExecutorService scheduler = ThreadPoolManager.getScheduledPool(POOL_NAME);\n     private boolean started;\n-    private ReadyMarker marker = new ReadyMarker(\"dsl\", RULES_REFRESH);\n-\n-    private ItemRegistryChangeListener itemRegistryChangeListener;\n-    private ThingRegistryChangeListener thingRegistryChangeListener;\n+    private final ReadyMarker marker = new ReadyMarker(\"dsl\", RULES_REFRESH);\n \n     private final ModelRepository modelRepository;\n     private final ItemRegistry itemRegistry;\n     private final ThingRegistry thingRegistry;\n     private final EventPublisher eventPublisher;\n     private final ReadyService readyService;\n \n+    private final ItemRegistryChangeListener itemRegistryChangeListener = new ItemRegistryChangeListener() {", "originalCommit": "1d8d6032ceae22345ae4a589766659fe6de94b4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}