{"pr_number": 1603, "pr_title": "Use TypeParser in ProfileCallbackImpl#sendUpdate for StringType state", "pr_createdAt": "2020-08-21T19:54:12Z", "pr_url": "https://github.com/openhab/openhab-core/pull/1603", "timeline": [{"oid": "03c7f66d21997abfa8f3ee39d6ce96ca20814027", "url": "https://github.com/openhab/openhab-core/commit/03c7f66d21997abfa8f3ee39d6ce96ca20814027", "message": "Use TypeParser in ProfileCallbackImpl#sendUpdate for StringType state\n\nSigned-off-by: Anders Alfredsson <andersb86@gmail.com>", "committedDate": "2020-08-21T18:56:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzOTYxNw==", "url": "https://github.com/openhab/openhab-core/pull/1603#discussion_r475139617", "bodyText": "If the TypeParser fails, it returns null while the itemStateConverter keeps the state as is if it fails converting it.\nThe following code (the eventPublisher.post) expects a non-null value, so we need to make sure to set something here as well. To be in sync with the other case, it probably is best to also keep the original state (knowing that the sent command will not be valid for the resp. item).", "author": "kaikreuzer", "createdAt": "2020-08-22T21:23:23Z", "path": "bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/profiles/ProfileCallbackImpl.java", "diffHunk": "@@ -131,7 +134,12 @@ public void sendCommand(Command command) {\n     @Override\n     public void sendUpdate(State state) {\n         Item item = itemProvider.apply(link.getItemName());\n-        State acceptedState = itemStateConverter.convertToAcceptedState(state, item);\n+        State acceptedState;\n+        if (state instanceof StringType && !(item instanceof StringItem)) {\n+            acceptedState = TypeParser.parseState(item.getAcceptedDataTypes(), state.toString());", "originalCommit": "03c7f66d21997abfa8f3ee39d6ce96ca20814027", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM1MDI5OQ==", "url": "https://github.com/openhab/openhab-core/pull/1603#discussion_r475350299", "bodyText": "Added a check after the call to parseState, if acceptedState == null it gets set to the original state argument. Would that be enough?", "author": "pacive", "createdAt": "2020-08-24T05:27:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzOTYxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkxMzcwMA==", "url": "https://github.com/openhab/openhab-core/pull/1603#discussion_r475913700", "bodyText": "I'd think that should be fine, thanks!", "author": "kaikreuzer", "createdAt": "2020-08-24T21:48:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzOTYxNw=="}], "type": "inlineReview"}, {"oid": "9386d876f9e77400f13479fb94d368c4576a9dd8", "url": "https://github.com/openhab/openhab-core/commit/9386d876f9e77400f13479fb94d368c4576a9dd8", "message": "Add null check\n\nSigned-off-by: Anders Alfredsson <andersb86@gmail.com>", "committedDate": "2020-08-23T07:03:44Z", "type": "commit"}]}