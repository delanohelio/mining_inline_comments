{"pr_number": 1414, "pr_title": "Removed deprecated constructors and methods from Thing API", "pr_createdAt": "2020-04-09T11:29:04Z", "pr_url": "https://github.com/openhab/openhab-core/pull/1414", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEzOTQ5NA==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r406139494", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            throw new IllegalArgumentException(\"Kind must not be null or aempty!\");\n          \n          \n            \n                            throw new IllegalArgumentException(\"Kind must not be null or empty!\");", "author": "cweitkamp", "createdAt": "2020-04-09T11:30:04Z", "path": "bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/i18n/ChannelTypeI18nLocalizationService.java", "diffHunk": "@@ -160,11 +160,7 @@ public ChannelType createLocalizedChannelType(Bundle bundle, ChannelType channel\n                 }\n                 return triggerBuilder.build();\n             default:\n-                return new ChannelType(channelTypeUID, channelType.isAdvanced(), channelType.getItemType(),\n-                        channelType.getKind(), label == null ? defaultLabel : label, description,\n-                        channelType.getCategory(), channelType.getTags(), channelType.getState(),\n-                        channelType.getEvent(), channelType.getConfigDescriptionURI(),\n-                        channelType.getAutoUpdatePolicy());\n+                throw new IllegalArgumentException(\"Kind must not be null or aempty!\");", "originalCommit": "c12cdab833dc9c68f4c427b16d424e087ca4b9b7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEzOTczNQ==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r406139735", "bodyText": "Is this if really necessary?", "author": "cweitkamp", "createdAt": "2020-04-09T11:30:35Z", "path": "bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/type/StateChannelTypeBuilderImpl.java", "diffHunk": "@@ -65,15 +64,15 @@ public StateChannelTypeBuilder withCommandDescription(@Nullable CommandDescripti\n         return this;\n     }\n \n+    @SuppressWarnings(\"deprecation\")\n     @Override\n     public ChannelType build() {\n         if (stateDescription != null) {", "originalCommit": "c12cdab833dc9c68f4c427b16d424e087ca4b9b7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE0MDE1NA==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r406140154", "bodyText": "FTR: I am working on nullness annotations for this class.", "author": "cweitkamp", "createdAt": "2020-04-09T11:31:34Z", "path": "bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/type/ChannelType.java", "diffHunk": "@@ -18,6 +18,7 @@\n import java.util.Set;\n \n import org.apache.commons.lang.StringUtils;\n+import org.eclipse.jdt.annotation.Nullable;", "originalCommit": "c12cdab833dc9c68f4c427b16d424e087ca4b9b7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0NDgwNQ==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r407244805", "bodyText": "Looks like there are still add-ons using these deprecated constructors. I made a local add-ons port build and it failed on the Homematic add-on:\nHomematicTypeGeneratorImpl.java:[306,14266] The constructor ChannelType(ChannelTypeUID, boolean, String, ChannelKind, String, String, String, null, StateDescription, EventDescription, URI) is undefined\nSo if we'd merge this PR it would break the add-ons port. Unless the deprecations are fixed on the 2.5.x branch.", "author": "wborn", "createdAt": "2020-04-12T19:53:34Z", "path": "bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/type/ChannelType.java", "diffHunk": "@@ -41,59 +42,35 @@\n     private final ChannelKind kind;\n     private final Set<String> tags;\n     private final String category;\n-    private final StateDescription state;\n-    private final CommandDescription commandDescription;\n+    private final @Nullable StateDescription state;\n+    private final @Nullable CommandDescription commandDescription;\n     private final EventDescription event;\n     private final URI configDescriptionURI;\n     private final AutoUpdatePolicy autoUpdatePolicy;\n \n     /**\n+     * Creates a new instance of this class with the specified parameters.\n+     *\n      * @deprecated Use the {@link ChannelTypeBuilder} instead.\n      */\n     @Deprecated\n     public ChannelType(ChannelTypeUID uid, boolean advanced, String itemType, String label, String description,\n-            String category, Set<String> tags, StateDescription state, URI configDescriptionURI) {\n-        this(uid, advanced, itemType, ChannelKind.STATE, label, description, category, tags, state, null,\n-                configDescriptionURI);\n+            String category, Set<String> tags, EventDescription event, URI configDescriptionURI)\n+            throws IllegalArgumentException {\n+        this(uid, advanced, itemType, ChannelKind.TRIGGER, label, description, category, tags, null, null, event,\n+                configDescriptionURI, null);\n     }\n \n     /**\n+     * Creates a new instance of this class with the specified parameters.\n+     *\n      * @deprecated Use the {@link ChannelTypeBuilder} instead.\n      */\n     @Deprecated\n-    public ChannelType(ChannelTypeUID uid, boolean advanced, String itemType, ChannelKind kind, String label,", "originalCommit": "c12cdab833dc9c68f4c427b16d424e087ca4b9b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM4NTc5NQ==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r407385795", "bodyText": "I am currently working on a PR for the Homematic binding that will replace all deprecated constructors, methods etc. Will try to push it today.", "author": "MHerbst", "createdAt": "2020-04-13T08:55:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0NDgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM5NjY3NQ==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r407396675", "bodyText": "That will certainly help @MHerbst! \ud83d\udc4d", "author": "wborn", "createdAt": "2020-04-13T09:24:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0NDgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM5NzcyMw==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r407397723", "bodyText": "@MHerbst Thank you. I will crawl the rest of the add-ons and replace the remaining.\n@wborn How can I manage a local add-ons port for testing?", "author": "cweitkamp", "createdAt": "2020-04-13T09:27:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0NDgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQwMjAyNg==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r407402026", "bodyText": "I use this port-addons.sh script based on the script used by Jenkins in the add-ons port build.", "author": "wborn", "createdAt": "2020-04-13T09:39:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0NDgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQwNTk5OA==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r407405998", "bodyText": "So you run the script on a 2.5.x based branch.\nIf you want to do the same build as Jenkins you checkout 2.5.x in that dir. E.g. to see if there are any openhab-core changes breaking the add-ons port build.\nSometimes you also want to checkout your own 2.5.x branch to see if you can keep 2.5.x compatible with breaking changes in OH 3.0. I do that for instance when adding nullness annotations. You might also want to do that after fixing deprecations before submitting the PR.", "author": "wborn", "createdAt": "2020-04-13T09:51:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0NDgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ2NjA3Nw==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r407466077", "bodyText": "My PR to fix add-ons build: openhab/openhab-addons#7354", "author": "cweitkamp", "createdAt": "2020-04-13T12:59:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0NDgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc1OTc0OQ==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r408759749", "bodyText": "Thank you both for fixing the deprecations!\nThe add-ons port now again builds for me with this PR locally. \ud83d\udc4d", "author": "wborn", "createdAt": "2020-04-15T11:05:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0NDgwNQ=="}], "type": "inlineReview"}, {"oid": "6f3bdd0ebe121dea70c099ecf8c7edb98082655b", "url": "https://github.com/openhab/openhab-core/commit/6f3bdd0ebe121dea70c099ecf8c7edb98082655b", "message": "Minor changes\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-04-13T10:11:43Z", "type": "forcePushed"}, {"oid": "9538da6d235e2c9204a2c390acf12b5d4aab4259", "url": "https://github.com/openhab/openhab-core/commit/9538da6d235e2c9204a2c390acf12b5d4aab4259", "message": "Clean-up after rebase\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-04-15T08:01:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc2MDI1NA==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r408760254", "bodyText": "Why was it commented?\nCan it be uncommented, fixed or removed instead?", "author": "wborn", "createdAt": "2020-04-15T11:06:42Z", "path": "bundles/org.openhab.core.thing/src/test/java/org/openhab/core/thing/ThingUIDTest.java", "diffHunk": "@@ -26,19 +26,19 @@ public void testThreeSegments() {\n         ThingTypeUID thingType = new ThingTypeUID(\"fake\", \"type\");\n         ThingUID t = new ThingUID(thingType, \"gaga\");\n \n-        assertEquals(\"type\", t.getThingTypeId());\n+        assertEquals(\"type\", t.getThingTypeUID().getId());\n         assertEquals(\"gaga\", t.getId());\n         assertEquals(\"fake:type:gaga\", t.getAsString());\n     }\n \n-    @Test\n-    public void testTwoSegments() {\n-        ThingUID t = new ThingUID(\"fake\", \"gaga\");\n-\n-        assertNull(t.getThingTypeId());\n-        assertEquals(\"gaga\", t.getId());\n-        assertEquals(\"fake::gaga\", t.getAsString());\n-    }\n+    // @Test\n+    // public void testTwoSegments() {", "originalCommit": "9538da6d235e2c9204a2c390acf12b5d4aab4259", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEyODQyNg==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r410128426", "bodyText": "I readed and changed it.", "author": "cweitkamp", "createdAt": "2020-04-17T10:13:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc2MDI1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkyMzAxNw==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r408923017", "bodyText": "It's probably deprecated because this method always creates a new ThingTypeUID, whereas Thing.getThingTypeUID() returns an existing object. In a binding ThingHandler you typically already have a Thing object reference, so it will save CPU cycles and garbage (+ collection) by calling Thing.getThingTypeUID() and reusing the existing objects where possible.", "author": "wborn", "createdAt": "2020-04-15T15:15:46Z", "path": "bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/ThingUID.java", "diffHunk": "@@ -135,29 +135,11 @@ public ThingUID(String... segments) {\n         super(segments);\n     }\n \n-    /**\n-     * Returns the thing type id.\n-     *\n-     * @return thing type id\n-     * @deprecated use {@link Thing#getThingTypeUID()} instead.\n-     */\n-    @Deprecated\n-    public String getThingTypeId() {\n-        String thingType = getSegment(1);\n-        if (NO_THING_TYPE.equals(thingType)) {\n-            return null;\n-        } else {\n-            return thingType;\n-        }\n-    }\n-\n     /**\n      * Returns the thing type uid.\n      *\n      * @return thing type uid\n-     * @deprecated use {@link Thing#getThingTypeUID()} instead.", "originalCommit": "9538da6d235e2c9204a2c390acf12b5d4aab4259", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEzOTQzNA==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r410139434", "bodyText": "true ... and it can return null which` breaks other stuff like discovery ... (see e.g. 2d88d58).", "author": "cweitkamp", "createdAt": "2020-04-17T10:36:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkyMzAxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyNjkyNQ==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r410426925", "bodyText": "I finally found a way to remove it.", "author": "cweitkamp", "createdAt": "2020-04-17T19:28:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkyMzAxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1NzI3Ng==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r410457276", "bodyText": "Some more things to solve for the add-ons build: openhab/openhab-addons#7402 and openhab/openhab-addons#7403.", "author": "cweitkamp", "createdAt": "2020-04-17T20:36:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkyMzAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ4OTI5Ng==", "url": "https://github.com/openhab/openhab-core/pull/1414#discussion_r410489296", "bodyText": "Moved into separate PR (#1424) but kind of required for this PR.", "author": "cweitkamp", "createdAt": "2020-04-17T21:56:49Z", "path": "bundles/org.openhab.core.config.discovery/src/main/java/org/openhab/core/config/discovery/internal/DiscoveryResultImpl.java", "diffHunk": "@@ -45,31 +48,6 @@\n     DiscoveryResultImpl() {\n     }\n \n-    /**", "originalCommit": "a84dd66214076a85378942fa7f03b482ecf61f5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "674465944098923d857b6c67c150b858f3578f95", "url": "https://github.com/openhab/openhab-core/commit/674465944098923d857b6c67c150b858f3578f95", "message": "Clean-up after rebase\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-04-20T08:30:53Z", "type": "forcePushed"}, {"oid": "d9716ee868d1e55e5ce42bc034fcaa1620cc34cc", "url": "https://github.com/openhab/openhab-core/commit/d9716ee868d1e55e5ce42bc034fcaa1620cc34cc", "message": "Rebase and Spotless\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-04-26T10:32:52Z", "type": "forcePushed"}, {"oid": "8622f5e2b1811c77d452f0a08b04424685678577", "url": "https://github.com/openhab/openhab-core/commit/8622f5e2b1811c77d452f0a08b04424685678577", "message": "Rebase and Spotless\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-06-24T10:07:57Z", "type": "forcePushed"}, {"oid": "258e6ffe1162994a8acba2e88474b190352e7373", "url": "https://github.com/openhab/openhab-core/commit/258e6ffe1162994a8acba2e88474b190352e7373", "message": "Removed deprecated constructors and methods from Thing API\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-09-13T10:17:45Z", "type": "commit"}, {"oid": "258e6ffe1162994a8acba2e88474b190352e7373", "url": "https://github.com/openhab/openhab-core/commit/258e6ffe1162994a8acba2e88474b190352e7373", "message": "Removed deprecated constructors and methods from Thing API\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-09-13T10:17:45Z", "type": "forcePushed"}]}