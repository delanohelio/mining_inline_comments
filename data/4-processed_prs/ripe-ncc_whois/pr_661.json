{"pr_number": 661, "pr_title": "Allow *any* CORS origin on RDAP GET requests by default", "pr_createdAt": "2020-10-06T20:41:56Z", "pr_url": "https://github.com/RIPE-NCC/whois/pull/661", "timeline": [{"oid": "7bf1ffb06127ffb051c406741bf6841afe3826ec", "url": "https://github.com/RIPE-NCC/whois/commit/7bf1ffb06127ffb051c406741bf6841afe3826ec", "message": "Allow *any* CORS origin on RDAP GET requests by default (as recommended by RFC7480).", "committedDate": "2020-10-06T20:38:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU3ODU2OA==", "url": "https://github.com/RIPE-NCC/whois/pull/661#discussion_r502578568", "bodyText": "question: why is the requirement for the ORIGIN to be null placed? I do not see anything that cann point to this in the rfc...mind clarifying?", "author": "dadepo", "createdAt": "2020-10-09T17:35:54Z", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapCrossOriginFilter.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package net.ripe.db.whois.api.rdap;\n+\n+import com.google.common.net.HttpHeaders;\n+import org.eclipse.jetty.servlets.CrossOriginFilter;\n+\n+import javax.servlet.FilterChain;\n+import javax.servlet.ServletException;\n+import javax.servlet.ServletRequest;\n+import javax.servlet.ServletResponse;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.HttpMethod;\n+import java.io.IOException;\n+\n+/**\n+ * RDAP specific changes to Cross-Origin Resource Sharing (CORS).\n+ *\n+ *   \"When responding to queries, it is RECOMMENDED that servers use the\n+ *    Access-Control-Allow-Origin header field, as specified by\n+ *    [W3C.REC-cors-20140116].  A value of \"*\" is suitable when RDAP is\n+ *    used for public resources.\"\n+ *\n+ * Ref. https://tools.ietf.org/html/rfc7480#section-5.6\n+ *\n+ */\n+public class RdapCrossOriginFilter extends CrossOriginFilter {\n+\n+    @Override\n+    public void doFilter(final ServletRequest request, final ServletResponse response, final FilterChain chain) throws IOException, ServletException\n+    {\n+        handle((HttpServletRequest)request, (HttpServletResponse)response);\n+        super.doFilter(request, response, chain);\n+    }\n+\n+    private void handle(final HttpServletRequest request, final HttpServletResponse response) {\n+        if ((request.getHeader(HttpHeaders.ORIGIN) == null) && request.getMethod().equals(HttpMethod.GET)) {", "originalCommit": "7bf1ffb06127ffb051c406741bf6841afe3826ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE0MDQzOQ==", "url": "https://github.com/RIPE-NCC/whois/pull/661#discussion_r503140439", "bodyText": "The RFC recommends that the CORS header always appears in the GET response. If there is an Origin header, then the response is handled by the existing CrossOrigin filter. This PR adds a CORS header if there isn't an Origin header in the request.", "author": "eshryane", "createdAt": "2020-10-12T08:54:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU3ODU2OA=="}], "type": "inlineReview"}]}