{"pr_number": 9135, "pr_title": "Issue #9133: AvoidEscapedUnicodeCharacters should support '\\s' escape symbol", "pr_createdAt": "2020-12-26T07:26:30Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/9135", "timeline": [{"oid": "ff954b81103c5f09b171cb1f903a3897143f46a2", "url": "https://github.com/checkstyle/checkstyle/commit/ff954b81103c5f09b171cb1f903a3897143f46a2", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2020-12-27T13:50:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMzNDA5OA==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r549334098", "bodyText": "// violation comments should be on lines 19 and 25, where violation is reported", "author": "strkkk", "createdAt": "2020-12-28T12:41:27Z", "path": "src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/checks/avoidescapedunicodecharacters/InputAvoidEscapedUnicodeCharactersEscapedS.java", "diffHunk": "@@ -0,0 +1,28 @@\n+//non-compiled with javac: Compilable with Java14\n+package com.puppycrawl.tools.checkstyle.checks.avoidescapedunicodecharacters;\n+\n+/* Config:\n+ *\n+ * allowEscapesForControlCharacters = false\n+ * allowByTailComment = false\n+ * allowIfAllCharactersEscaped = true\n+ * allowNonPrintableEscapes = false\n+ */\n+public class InputAvoidEscapedUnicodeCharactersEscapedS {\n+    String value1 = \"\\u03bc\\t\"; // ok\n+    String value2 = \"\\u03bc\\s\"; // ok\n+    String value3 = \"\\u03bc\\s not all escaped chars\"; // violation\n+    String value31 = \"\\u03bc\\n not all escaped chars\"; // violation\n+    String value4 = \"\"\"\n+            \\s\\s\\s\\n\n+            \"\"\"; // ok\n+    String value5 = \"\"\"\n+            \\u03bc\\s\n+            \"\"\"; // ok\n+    String value6 = \"\"\"\n+            \\s\\s\\s\\n not all escaped chars\n+            \"\"\"; // violation\n+    String value7 = \"\"\"\n+            \\u03bc\\s not all escaped chars\n+            \"\"\"; // violation", "originalCommit": "ff954b81103c5f09b171cb1f903a3897143f46a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM3Mjk3Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r549372973", "bodyText": "@strkkk it is not possible to add comments to those particular lines; they would become text block content. I have added comments to make that more clear in the test case.", "author": "nmancus1", "createdAt": "2020-12-28T14:46:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMzNDA5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NjQ1MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r549566451", "bodyText": "It is ok to to have // violation as part of string value. All we need is visual marker that line has violation", "author": "romani", "createdAt": "2020-12-29T04:47:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMzNDA5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2ODc0MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r549568741", "bodyText": "@romani in the case of text blocks, the initial newline and triple quotes delimit the content. I cannot put a comment or text following the delimiter on the same line.  I could do a C style comment:\n                String test = /* violation */\"\"\"\n                        \"\"\";", "author": "nmancus1", "createdAt": "2020-12-29T05:02:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMzNDA5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2OTMxMA==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r549569310", "bodyText": "I left a comment after each text block, and a C style comment on the same line.", "author": "nmancus1", "createdAt": "2020-12-29T05:06:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMzNDA5OA=="}], "type": "inlineReview"}, {"oid": "0bf40006aa8a6aeb9654d22989cdfeea73ea9d6f", "url": "https://github.com/checkstyle/checkstyle/commit/0bf40006aa8a6aeb9654d22989cdfeea73ea9d6f", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2020-12-28T14:17:44Z", "type": "forcePushed"}, {"oid": "bb6ecfb3171bf25a07c3fcea982fbd6fd7501650", "url": "https://github.com/checkstyle/checkstyle/commit/bb6ecfb3171bf25a07c3fcea982fbd6fd7501650", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2020-12-29T04:44:40Z", "type": "forcePushed"}, {"oid": "d947bb55eedf35d945a96a7550abb513778d48f2", "url": "https://github.com/checkstyle/checkstyle/commit/d947bb55eedf35d945a96a7550abb513778d48f2", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2020-12-29T05:05:00Z", "type": "forcePushed"}, {"oid": "749879b32f46a021040f6a3cd9234a871fad8213", "url": "https://github.com/checkstyle/checkstyle/commit/749879b32f46a021040f6a3cd9234a871fad8213", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2020-12-29T05:14:26Z", "type": "forcePushed"}, {"oid": "d61d6958401175db6bccdcca23db6e16afe7aa7e", "url": "https://github.com/checkstyle/checkstyle/commit/d61d6958401175db6bccdcca23db6e16afe7aa7e", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2020-12-29T14:21:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0MjQ0Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r549942443", "bodyText": "I think we should move this text to PR description. This comment is hard to understand", "author": "romani", "createdAt": "2020-12-30T05:45:43Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java", "diffHunk": "@@ -348,7 +350,13 @@ public void beginTree(DetailAST rootAST) {\n \n     @Override\n     public void visitToken(DetailAST ast) {\n-        final String literal = ast.getText();\n+        // pitest does not like the following assignment guarded by\n+        // a 'if' statement that checks token type. Since traditional string\n+        // literals do not have preceeding whitespace or newline,\n+        // 'stripIndentAndInitialNewLineFromTextBlock' has no effect\n+        // on them and does not affect the functionality of this check.", "originalCommit": "d61d6958401175db6bccdcca23db6e16afe7aa7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIyMjM2OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r550222369", "bodyText": "@romani I put a detailed comment in the PR description, and just did a\n// See https://github.com/checkstyle/checkstyle/pull/9135#issue-545666710 comment before the assignment.\nAfter thinking about review items from #9134 (review), this is what git blame is for. Comment removed.", "author": "nmancus1", "createdAt": "2020-12-30T14:56:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0MjQ0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDA2NDY5Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r550064696", "bodyText": "Please change the link to https://docs.oracle.com/javase/specs/jls/se15/html/jls-3.html#jls-3.10.7\n\n\nAll patterns in this file seems to be sorted. It is better to place \\s between \\r and \\t\n\n\nThe docs says there is one more escape - for a trailing \\. Something like \\\\$.\nFor example\n\n\n    static final String value1 = \"\"\"\n        \\u03bc\\\n        \\s\\u03bc\\\n        \"\"\"; // ok\nis just \u03bc \u03bc. Please create a new issue for this.", "author": "pbludov", "createdAt": "2020-12-30T09:13:22Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java", "diffHunk": "@@ -191,6 +192,7 @@\n             + \"|\\\\\\\\n\"\n             + \"|\\\\\\\\r\"\n             + \"|\\\\\\\\t\"\n+            + \"|\\\\\\\\s\"", "originalCommit": "d61d6958401175db6bccdcca23db6e16afe7aa7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIyMjAwNw==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r550222007", "bodyText": "Done\nDone.\n#9143", "author": "nmancus1", "createdAt": "2020-12-30T14:55:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDA2NDY5Ng=="}], "type": "inlineReview"}, {"oid": "08389e8ebb2a988f1d36977610e958ad20ae6b91", "url": "https://github.com/checkstyle/checkstyle/commit/08389e8ebb2a988f1d36977610e958ad20ae6b91", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2020-12-30T14:51:31Z", "type": "forcePushed"}, {"oid": "0f978a614711242c7f6b239128106fc785c55b68", "url": "https://github.com/checkstyle/checkstyle/commit/0f978a614711242c7f6b239128106fc785c55b68", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2020-12-30T15:04:22Z", "type": "forcePushed"}, {"oid": "e302c725527352ba1baa1735e1edb320555d91df", "url": "https://github.com/checkstyle/checkstyle/commit/e302c725527352ba1baa1735e1edb320555d91df", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2021-01-06T15:36:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAwNjQ2OA==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r553006468", "bodyText": "Confirm Issue #9159 represents this fix. I will approve that issue and you should split this PR into 2 commits, 1 for new functionality and 1 for a bug fix. Then we can merge it since others have all approved this.\nThis is so the bug fix doesn't get lost in the release notes as they should go under different items.", "author": "rnveach", "createdAt": "2021-01-06T22:57:44Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java", "diffHunk": "@@ -348,7 +350,8 @@ public void beginTree(DetailAST rootAST) {\n \n     @Override\n     public void visitToken(DetailAST ast) {\n-        final String literal = ast.getText();\n+        final String literal =\n+            CheckUtil.stripIndentAndInitialNewLineFromTextBlock(ast.getText());", "originalCommit": "e302c725527352ba1baa1735e1edb320555d91df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAxNjY4NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r553016685", "bodyText": "Issue #9159 does represent this fix. PR split.", "author": "nmancus1", "createdAt": "2021-01-06T23:29:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAwNjQ2OA=="}], "type": "inlineReview"}, {"oid": "7471971603dbc5c9323687b32a31124c15df42f8", "url": "https://github.com/checkstyle/checkstyle/commit/7471971603dbc5c9323687b32a31124c15df42f8", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2021-01-06T23:26:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAxOTM5Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r553019392", "bodyText": "Should this change be in the first commit?", "author": "rnveach", "createdAt": "2021-01-06T23:38:35Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/AvoidEscapedUnicodeCharactersCheck.java", "diffHunk": "@@ -453,8 +455,7 @@ private static int countMatches(Pattern pattern, String target) {\n      */\n     private boolean isAllCharactersEscaped(String literal) {\n         return allowIfAllCharactersEscaped\n-                && ALL_ESCAPED_CHARS.matcher(literal.substring(1,\n-                        literal.length() - 1)).find();\n+                && ALL_ESCAPED_CHARS.matcher(literal).find();", "originalCommit": "7471971603dbc5c9323687b32a31124c15df42f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAyMDkxNA==", "url": "https://github.com/checkstyle/checkstyle/pull/9135#discussion_r553020914", "bodyText": "Yes, apologies. Fixing now.", "author": "nmancus1", "createdAt": "2021-01-06T23:44:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAxOTM5Mg=="}], "type": "inlineReview"}, {"oid": "6f2c92022c9d656344ce331c362d3751f3d2af1d", "url": "https://github.com/checkstyle/checkstyle/commit/6f2c92022c9d656344ce331c362d3751f3d2af1d", "message": "Issue #9159: AvoidEscapedUnicodeCharactersCheck: False positive on text blocks with a line separation(#9133)", "committedDate": "2021-01-06T23:43:56Z", "type": "commit"}, {"oid": "7bad06847db35836ea8cb5427ae446d9352c49c7", "url": "https://github.com/checkstyle/checkstyle/commit/7bad06847db35836ea8cb5427ae446d9352c49c7", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2021-01-06T23:43:56Z", "type": "commit"}, {"oid": "7bad06847db35836ea8cb5427ae446d9352c49c7", "url": "https://github.com/checkstyle/checkstyle/commit/7bad06847db35836ea8cb5427ae446d9352c49c7", "message": "Issue #9133: AvoidEscapedUnicodeCharacters should support escaped s", "committedDate": "2021-01-06T23:43:56Z", "type": "forcePushed"}]}