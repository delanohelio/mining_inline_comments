{"pr_number": 8892, "pr_title": "Issue #8879: fix local variable detection in resource node", "pr_createdAt": "2020-10-11T14:06:23Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8892", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk0NDMyMg==", "url": "https://github.com/checkstyle/checkstyle/pull/8892#discussion_r502944322", "bodyText": "Should it be node.getChildCount() > 1 ?", "author": "pbludov", "createdAt": "2020-10-11T17:37:48Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/utils/ScopeUtil.java", "diffHunk": "@@ -266,7 +266,7 @@ public static boolean isLocalVariableDef(DetailAST node) {\n         }\n \n         if (node.getType() == TokenTypes.RESOURCE) {\n-            localVariableDef = true;\n+            localVariableDef = node.getChildCount() != 1;", "originalCommit": "9baeffbe2fcc450c159a5f0375aa0b0251514e01", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1MzIyNA==", "url": "https://github.com/checkstyle/checkstyle/pull/8892#discussion_r502953224", "bodyText": "Good catch, fixed", "author": "strkkk", "createdAt": "2020-10-11T19:03:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk0NDMyMg=="}], "type": "inlineReview"}, {"oid": "28467fb6794b1088a9170c1c060e25eb16d798b6", "url": "https://github.com/checkstyle/checkstyle/commit/28467fb6794b1088a9170c1c060e25eb16d798b6", "message": "Issue #8879: fix local variable detection in resource node", "committedDate": "2020-10-11T19:01:33Z", "type": "forcePushed"}, {"oid": "0f14c9df19f33ddd12f96c75f33de9a5d765842a", "url": "https://github.com/checkstyle/checkstyle/commit/0f14c9df19f33ddd12f96c75f33de9a5d765842a", "message": "Issue #8879: fix local variable detection in resource node", "committedDate": "2020-10-11T19:51:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzAzMjcwMw==", "url": "https://github.com/checkstyle/checkstyle/pull/8892#discussion_r503032703", "bodyText": "Can we avoid this type of tests ?\nWe did do much to avoid this level of fakes that make no good to code.", "author": "romani", "createdAt": "2020-10-12T04:29:16Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/utils/ScopeUtilTest.java", "diffHunk": "@@ -166,7 +166,18 @@ public void testIsLocalVariableDefUnexpected() {\n \n     @Test\n     public void testIsLocalVariableDefResource() {\n-        assertTrue(ScopeUtil.isLocalVariableDef(getNode(TokenTypes.RESOURCE)), \"invalid result\");\n+        final DetailAstImpl resourceTwoChildren = getNode(TokenTypes.RESOURCE);\n+        final DetailAstImpl modifiers = new DetailAstImpl();\n+        modifiers.setType(TokenTypes.MODIFIERS);", "originalCommit": "0f14c9df19f33ddd12f96c75f33de9a5d765842a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3NTIxNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8892#discussion_r503075216", "bodyText": "This method checks node, so we need to provide a node to test. Another way is to parse some file, navigate to node and check result.\nI do not like the way test (and other tests in this file) is written, but it is common approach for this util class.\nI suggest to create separate issue for refactoring of this test class to avoid using fake nodes.", "author": "strkkk", "createdAt": "2020-10-12T06:56:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzAzMjcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM0NjY0MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8892#discussion_r503346641", "bodyText": "what force you to create this test ?\nWe had several bad cases of test to satisfy pitest coverage that it split in several groups, so some cases claimed to be not reachable.", "author": "romani", "createdAt": "2020-10-12T14:46:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzAzMjcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM1MDY4OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8892#discussion_r503350689", "bodyText": "I am not the one who created this test, it was like this before. I modified the logic, and result for such dummy node (with no children) is changed. This will never happen in real life.\nOther conditions (1 child, 2+ children) are covered by test cases for checks, which is not good since it is indirect test.\nSo I added new cases to check changed logic directly.", "author": "strkkk", "createdAt": "2020-10-12T14:53:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzAzMjcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5Mjc4MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8892#discussion_r503392781", "bodyText": "one more note - there is no need for this test case. Pitest will pass because this condition is tested indirectly by test cases for several checks.\n@romani if this is fine, I can remove it. If not, such test case should be kept to test this util method directly.", "author": "strkkk", "createdAt": "2020-10-12T16:02:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzAzMjcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyOTI3MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8892#discussion_r503429270", "bodyText": "Please remove this test, we need to keep pure UT only as very very last resort to satisfy coverage", "author": "romani", "createdAt": "2020-10-12T17:13:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzAzMjcwMw=="}], "type": "inlineReview"}, {"oid": "efd4785ceb17050a50729718c6d012c6c4674c9c", "url": "https://github.com/checkstyle/checkstyle/commit/efd4785ceb17050a50729718c6d012c6c4674c9c", "message": "Issue #8879: fix local variable detection in resource node", "committedDate": "2020-10-12T19:16:16Z", "type": "forcePushed"}, {"oid": "7db3611b79fc59a2fe3923e83762b76757fa2c0d", "url": "https://github.com/checkstyle/checkstyle/commit/7db3611b79fc59a2fe3923e83762b76757fa2c0d", "message": "Issue #8879: fix local variable detection in resource node", "committedDate": "2020-10-12T19:35:43Z", "type": "commit"}, {"oid": "7db3611b79fc59a2fe3923e83762b76757fa2c0d", "url": "https://github.com/checkstyle/checkstyle/commit/7db3611b79fc59a2fe3923e83762b76757fa2c0d", "message": "Issue #8879: fix local variable detection in resource node", "committedDate": "2020-10-12T19:35:43Z", "type": "forcePushed"}]}