{"pr_number": 8229, "pr_title": "Issue #8228: Update CIs to validate empty output of 'git status' afte\u2026", "pr_createdAt": "2020-05-10T16:32:21Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8229", "timeline": [{"oid": "b9e607787166ba395830156c434a19a8cc019ca3", "url": "https://github.com/checkstyle/checkstyle/commit/b9e607787166ba395830156c434a19a8cc019ca3", "message": "Issue #8228: Update CIs to validate empty output of 'git status' after execution", "committedDate": "2020-05-10T16:33:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5NTUwNw==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r422695507", "bodyText": "Please print git status before sleep, to show contributors what is left", "author": "romani", "createdAt": "2020-05-10T20:23:08Z", "path": ".ci/shippable.sh", "diffHunk": "@@ -131,6 +131,14 @@ validate-ci-temp-empty)\n   exit $fail\n   ;;\n \n+git-status)\n+  if [ $(git status | grep \"Changes not staged for commit\" | wc -l) -gt 0 ]; then\n+    echo \"There are changes in files after clone, recheck .gitattributes file\"\n+    sleep 5s", "originalCommit": "b9e607787166ba395830156c434a19a8cc019ca3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc1MjQwMA==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r422752400", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-05-11T02:52:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY5NTUwNw=="}], "type": "inlineReview"}, {"oid": "975f300cbc8ac0bda60cd85ab916bc06c441ea8f", "url": "https://github.com/checkstyle/checkstyle/commit/975f300cbc8ac0bda60cd85ab916bc06c441ea8f", "message": "Issue #8228: Update CIs to validate empty output of 'git status' after execution", "committedDate": "2020-05-11T02:51:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc4MDAzNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r422780036", "bodyText": "Sorry looks I was not attentive on merge on this status check.\nhttps://travis-ci.org/github/checkstyle/checkstyle/jobs/685191959\nIt should not be separate build item, it should be part of post build actions.\nPlease refactor travis.yml .\nPlease make second commit, that cause some file creation in git in some existing build to make sure build catch it and fail.", "author": "romani", "createdAt": "2020-05-11T04:54:42Z", "path": ".ci/travis/travis.sh", "diffHunk": "@@ -555,6 +555,7 @@ verify-no-exception-configs)\n git-status)\n   if [ $(git status | grep \"Changes not staged for commit\" | wc -l) -gt 0 ]; then\n     echo \"There are changes in files after clone, recheck .gitattributes file\"\n+    git status", "originalCommit": "975f300cbc8ac0bda60cd85ab916bc06c441ea8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc4MzMxNQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r422783315", "bodyText": "Travis builds run in matrix, right?  I was wondering about this.", "author": "nmancus1", "createdAt": "2020-05-11T05:08:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc4MDAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc4OTE2OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r422789168", "bodyText": "Done.", "author": "nmancus1", "createdAt": "2020-05-11T05:29:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc4MDAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg0MDI4Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r425840283", "bodyText": "@nmancus1 , please create a file in CI in repository folder during any build item, Travis should fail.\nVerification of leftover files in .ci-temp is less critical, but please show failure of Travis on it too.\nif travis is not failing - verification does not work.", "author": "romani", "createdAt": "2020-05-15T14:28:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc4MDAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk2ODI2Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r425968262", "bodyText": "Ok, maybe I'm misunderstanding the intention of this validation.  Are we trying to catch untracked files or changes in tracked files that haven't been committed?", "author": "nmancus1", "createdAt": "2020-05-15T18:12:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc4MDAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjExODkxMg==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426118912", "bodyText": "We need to detect any changes in git repository.", "author": "romani", "createdAt": "2020-05-16T04:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc4MDAzNg=="}], "type": "inlineReview"}, {"oid": "a047c3c2a58fe6e152adf53b1a93fdf29661aaa6", "url": "https://github.com/checkstyle/checkstyle/commit/a047c3c2a58fe6e152adf53b1a93fdf29661aaa6", "message": "Issue #8228: Test for travis.yml", "committedDate": "2020-05-11T05:27:52Z", "type": "forcePushed"}, {"oid": "7717c329bd1a7e94bcbdb38ea25eccb667306525", "url": "https://github.com/checkstyle/checkstyle/commit/7717c329bd1a7e94bcbdb38ea25eccb667306525", "message": "Issue #8228: Test for travis.yml", "committedDate": "2020-05-11T06:18:50Z", "type": "forcePushed"}, {"oid": "62b701734ddaf4bedca727ee34628d56a85767d6", "url": "https://github.com/checkstyle/checkstyle/commit/62b701734ddaf4bedca727ee34628d56a85767d6", "message": "Issue #8228: Update CIs to validate empty output of 'git status' after execution", "committedDate": "2020-05-15T17:00:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjExNjczMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426116731", "bodyText": "There are non empty git status after build, please clean up or update .gitattributes file\nThe same for others", "author": "romani", "createdAt": "2020-05-16T04:23:08Z", "path": ".ci/shippable.sh", "diffHunk": "@@ -131,6 +131,15 @@ validate-ci-temp-empty)\n   exit $fail\n   ;;\n \n+git-status)\n+  if [ $(git status | grep \"Changes not staged for commit\" | wc -l) -gt 0 ]; then\n+    echo \"There are changes in files after clone, recheck .gitattributes file\"", "originalCommit": "62b701734ddaf4bedca727ee34628d56a85767d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjExODM2Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426118363", "bodyText": "Done.", "author": "nmancus1", "createdAt": "2020-05-16T04:50:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjExNjczMQ=="}], "type": "inlineReview"}, {"oid": "88f320cac804c2b522fb2fdf8006ef1aee552505", "url": "https://github.com/checkstyle/checkstyle/commit/88f320cac804c2b522fb2fdf8006ef1aee552505", "message": "Issue #8228: Update CIs to validate empty output of 'git status' after execution", "committedDate": "2020-05-16T04:39:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyMTY1OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426121658", "bodyText": "No need to grep here. It is not a stable approach.\nPlease use git status --porcelain=v1 --untracked-files=normal instead. Here and in all such cases.", "author": "pbludov", "createdAt": "2020-05-16T05:45:31Z", "path": ".ci/shippable.sh", "diffHunk": "@@ -131,6 +131,15 @@ validate-ci-temp-empty)\n   exit $fail\n   ;;\n \n+git-status)\n+  if [ $(git status | grep \"Untracked files\" | wc -l) -gt 0 ]; then", "originalCommit": "88f320cac804c2b522fb2fdf8006ef1aee552505", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTI5MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426215290", "bodyText": "I agree.  Fixed.", "author": "nmancus1", "createdAt": "2020-05-17T04:14:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyMTY1OA=="}], "type": "inlineReview"}, {"oid": "9a32add64065f514867bd218b02b8dfd3fb3e92a", "url": "https://github.com/checkstyle/checkstyle/commit/9a32add64065f514867bd218b02b8dfd3fb3e92a", "message": "Issue #8228: Update CIs to validate empty output of 'git status' after execution", "committedDate": "2020-05-17T04:13:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjE2Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426216166", "bodyText": "Why not simple git status ?", "author": "romani", "createdAt": "2020-05-17T04:32:31Z", "path": ".ci/shippable.sh", "diffHunk": "@@ -131,6 +131,15 @@ validate-ci-temp-empty)\n   exit $fail\n   ;;\n \n+git-status)\n+  if [ \"$(git status --porcelain=v1 --untracked-files=normal)\" ]; then", "originalCommit": "9a32add64065f514867bd218b02b8dfd3fb3e92a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjUzMw==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426216533", "bodyText": "--porcelain=v1 ensures backwards compatibility, and after some research, seems to be standard for git scripts. Just let me know if you would like me to change it.", "author": "nmancus1", "createdAt": "2020-05-17T04:40:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjE2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxODMzMw==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426218333", "bodyText": "I have never used it, we need simple   behavior if something happened in git repo report it.\nPlease share link that explains that this is really good option", "author": "romani", "createdAt": "2020-05-17T05:15:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjE2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxODUwNA==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426218504", "bodyText": "https://stackoverflow.com/a/25149786/13160102\nand\nhttps://git-scm.com/docs/git-status#Documentation/git-status.txt---porcelainltversiongt\nBut, I found this, too, which is conflicting:\nhttps://stackoverflow.com/a/6978402/13160102", "author": "nmancus1", "createdAt": "2020-05-17T05:18:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjE2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI1MjE5Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426252193", "bodyText": "I have never used it, we need simple behavior if something happened in git repo report it.\n\n@romani the output of the git status command is not fixed and can be changed in any future version. Since git is actively used in scripts, the developers added a machine-readable format with versioning. So, \"--porcelain=v1 \" guarantees that the output of the command will not change in the future. Now there is already version 2, which is slightly different. But the format of version 1 will never change.", "author": "pbludov", "createdAt": "2020-05-17T11:51:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjE2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3NzA0Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426277042", "bodyText": "We do not parser output, all of this is not applicable to us, but ok.\nPlease do simple git status --porcelain defaults are good for us", "author": "romani", "createdAt": "2020-05-17T16:02:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjE2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5MDQ1NA==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r426290454", "bodyText": "I revoking my ok to to do non simple git status. Output in Travis is absolutely non for human, we need to do  simple git status for check and for printing to log to let user understand it easily.\nSee details at #8229 (comment)", "author": "romani", "createdAt": "2020-05-17T18:28:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjE2Ng=="}], "type": "inlineReview"}, {"oid": "89bb9647b36eb23f8110eb6a9e08ab27a8e56a6e", "url": "https://github.com/checkstyle/checkstyle/commit/89bb9647b36eb23f8110eb6a9e08ab27a8e56a6e", "message": "Issue #8228: Update CIs to validate empty output of 'git status' after execution", "committedDate": "2020-05-17T04:45:51Z", "type": "forcePushed"}, {"oid": "9cc65b23ef2ebb33b3d2363dcb0d8c99b6797074", "url": "https://github.com/checkstyle/checkstyle/commit/9cc65b23ef2ebb33b3d2363dcb0d8c99b6797074", "message": "Issue #8228: Update CIs to validate empty output of 'git status' after execution", "committedDate": "2020-05-18T01:59:07Z", "type": "forcePushed"}, {"oid": "5eed98b5146189cd8354f6ecb084f1b41e0d641d", "url": "https://github.com/checkstyle/checkstyle/commit/5eed98b5146189cd8354f6ecb084f1b41e0d641d", "message": "Issue #8228: Update CIs to validate empty output of 'git status' after execution", "committedDate": "2020-05-18T02:15:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAzNjYwOQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r427036609", "bodyText": "Please fix indentation", "author": "romani", "createdAt": "2020-05-19T05:21:49Z", "path": "wercker.yml", "diffHunk": "@@ -358,3 +358,12 @@ build:\n         echo \"------\"\n         du -hs * | sort -h\n \n+  - script:\n+      name: git-status\n+      code: |\n+        if [[ $RUN_JOB == 1 ]]; then\n+                  echo \"Command: ./.ci/wercker.sh git-status\"\n+                  ./.ci/wercker.sh git-status\n+                else", "originalCommit": "17f5be5c5ee92ffd2b6c2c5542b87fbce8fa7750", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzIzODY3MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8229#discussion_r427238670", "bodyText": "Done.", "author": "nmancus1", "createdAt": "2020-05-19T11:46:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAzNjYwOQ=="}], "type": "inlineReview"}, {"oid": "b934685e3cfa7c893d84ebded8a08a77a6c27769", "url": "https://github.com/checkstyle/checkstyle/commit/b934685e3cfa7c893d84ebded8a08a77a6c27769", "message": "Issue #8228: Update CIs to validate empty output of 'git status' after execution", "committedDate": "2020-05-19T05:31:05Z", "type": "commit"}, {"oid": "f5333c288074e4411d6af056c276a767dadda4f8", "url": "https://github.com/checkstyle/checkstyle/commit/f5333c288074e4411d6af056c276a767dadda4f8", "message": "Issue #8228: Clean up after Travis build items", "committedDate": "2020-05-19T05:31:40Z", "type": "commit"}, {"oid": "f5333c288074e4411d6af056c276a767dadda4f8", "url": "https://github.com/checkstyle/checkstyle/commit/f5333c288074e4411d6af056c276a767dadda4f8", "message": "Issue #8228: Clean up after Travis build items", "committedDate": "2020-05-19T05:31:40Z", "type": "forcePushed"}]}