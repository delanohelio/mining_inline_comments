{"pr_number": 8950, "pr_title": "config: make semaphore ci commands easy to run on local", "pr_createdAt": "2020-11-01T11:31:13Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8950", "timeline": [{"oid": "bb85a09d3a06173d06125311fcf3f3521c1b5c48", "url": "https://github.com/checkstyle/checkstyle/commit/bb85a09d3a06173d06125311fcf3f3521c1b5c48", "message": "infra: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T12:06:25Z", "type": "forcePushed"}, {"oid": "eedbf0617d69f09aef2fc3d784dbd1aa38a4b587", "url": "https://github.com/checkstyle/checkstyle/commit/eedbf0617d69f09aef2fc3d784dbd1aa38a4b587", "message": "infra: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T12:26:59Z", "type": "forcePushed"}, {"oid": "07e21d93846dccc66d1ea27f8f0684960b8fdfdf", "url": "https://github.com/checkstyle/checkstyle/commit/07e21d93846dccc66d1ea27f8f0684960b8fdfdf", "message": "infra: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T12:38:28Z", "type": "forcePushed"}, {"oid": "2cccc21e3c75018e793a4740477a81a56cb118d1", "url": "https://github.com/checkstyle/checkstyle/commit/2cccc21e3c75018e793a4740477a81a56cb118d1", "message": "infra: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T12:47:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYzMDQ0MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8950#discussion_r515630441", "bodyText": "check-missing-pitests was assigned priority 10 originally, and no-error-pmd was assigned 80. Now, priority assignment will be automatic from semaphore. Out of all these tests, no-error-pmd is the most frequently failed one for me, so I think that it made sense for it to have higher priority so that the build fails faster and not waste time/resources. I am not sure how many builds we can run in parallel, and if this even matters, but I thought it would be good to mention.", "author": "nmancus1", "createdAt": "2020-11-01T14:41:53Z", "path": ".semaphore/semaphore.yml", "diffHunk": "@@ -56,34 +34,22 @@ blocks:\n             - sem-version java 8 # NonDex only supports Java 8\n             - .ci/validation.sh nondex\n \n-        - name: No error test on pmd\n-          priority:\n-            - value: 80\n-              when: true\n-          commands:\n-            - mvn -e install -Pno-validations\n-            - .ci/validation.sh no-error-pmd\n-\n-        - name: No error test on Configurate\n-          priority:\n-            - value: 80\n-              when: true\n-          commands:\n-            - sem-version java 14\n-            - mvn -e install -Pno-validations\n-            - .ci/validation.sh no-violation-test-configurate\n-\n-        - name: No violation testing on josm\n-          commands:\n-            - mvn -e install -Pno-validations\n-            - .ci/validation.sh no-violation-test-josm\n-\n-        - name: No exception test\n+        - name: Validation (openjdk11)\n           matrix:\n-            - env_var: PROJECT\n+            - env_var: CMD\n               values:\n-                - guava-with-google-checks\n-                - guava-with-sun-checks\n-          commands:\n-            - mvn -e install -Pno-validations\n-            - .ci/no-exception-test.sh $PROJECT\n+                - .ci/no-exception-test.sh guava-with-google-checks\n+                - .ci/no-exception-test.sh guava-with-sun-checks\n+                - .ci/validation.sh all-sevntu-checks\n+                - .ci/validation.sh check-missing-pitests\n+                - .ci/validation.sh eclipse-static-analysis\n+                - .ci/validation.sh no-error-pmd", "originalCommit": "2cccc21e3c75018e793a4740477a81a56cb118d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYzMTc0MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8950#discussion_r515631741", "bodyText": "Makes sense. I'll make two jobs: one with high priority, another with default priority", "author": "pbludov", "createdAt": "2020-11-01T14:54:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYzMDQ0MQ=="}], "type": "inlineReview"}, {"oid": "fc39e5605b5046916f4ac3f253ae1401f9164f98", "url": "https://github.com/checkstyle/checkstyle/commit/fc39e5605b5046916f4ac3f253ae1401f9164f98", "message": "infra: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T15:08:11Z", "type": "forcePushed"}, {"oid": "c66c8b70adcaf75838ef8f8f2b071c35d39145aa", "url": "https://github.com/checkstyle/checkstyle/commit/c66c8b70adcaf75838ef8f8f2b071c35d39145aa", "message": "infra: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T15:11:51Z", "type": "forcePushed"}, {"oid": "dfaae93003442e2a93f132248b25eae35eb58040", "url": "https://github.com/checkstyle/checkstyle/commit/dfaae93003442e2a93f132248b25eae35eb58040", "message": "config: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T15:28:57Z", "type": "forcePushed"}, {"oid": "f091136533b661b6b019e656d4a703878bd73e1c", "url": "https://github.com/checkstyle/checkstyle/commit/f091136533b661b6b019e656d4a703878bd73e1c", "message": "config: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T15:46:26Z", "type": "forcePushed"}, {"oid": "dfe962d0e32b56000d5f35925cbef1ccb062372c", "url": "https://github.com/checkstyle/checkstyle/commit/dfe962d0e32b56000d5f35925cbef1ccb062372c", "message": "config: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T19:24:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2NzQ4OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8950#discussion_r515667489", "bodyText": "put fast in front... it will also group them a better  to read way\nmake it like:\n                - .ci/validation.sh all-sevntu-checks\n                - .ci/validation.sh check-missing-pitests\n                - .ci/validation.sh eclipse-static-analysis\n                - mvn -e clean install -Pno-validations\n                    && .ci/no-exception-test.sh guava-with-google-checks\n                - mvn -e clean install -Pno-validations\n                    && .ci/no-exception-test.sh guava-with-sun-checks\n                - mvn -e clean install -Pno-validations\n                    && .ci/validation.sh no-violation-test-josm", "author": "romani", "createdAt": "2020-11-01T20:24:05Z", "path": ".semaphore/semaphore.yml", "diffHunk": "@@ -27,63 +27,55 @@ blocks:\n               cache store m2 $HOME/.m2\n             fi\n       jobs:\n-        - name: Check for missing pitests\n-          priority:\n-            - value: 10\n-              when: true\n-          commands:\n-            - .ci/validation.sh check-missing-pitests\n-\n-        - name: Eclipse static analysis\n-          priority:\n-            - value: 10\n-              when: true\n-          commands:\n-            - .ci/validation.sh eclipse-static-analysis\n-\n-        - name: Ensure that all Sevntu check are used\n-          priority:\n-            - value: 10\n-              when: true\n-          commands:\n-            - .ci/validation.sh all-sevntu-checks\n-\n         - name: NonDex (openjdk8)\n           priority:\n-            - value: 80\n+            - value: 90\n               when: true\n+          matrix:\n+            - env_var: CMD\n+              values:\n+                - .ci/validation.sh nondex\n           commands:\n             - sem-version java 8 # NonDex only supports Java 8\n-            - .ci/validation.sh nondex\n-\n-        - name: No error test on pmd\n-          priority:\n-            - value: 80\n-              when: true\n-          commands:\n-            - mvn -e install -Pno-validations\n-            - .ci/validation.sh no-error-pmd\n+            - echo \"eval of CMD is starting\";\n+            - echo \"CMD=$CMD\";\n+            - eval $CMD;\n+            - echo \"eval of CMD is completed\";\n \n-        - name: No error test on Configurate\n+        - name: Validation (openjdk11, slow pool)\n           priority:\n             - value: 80\n               when: true\n+          matrix:\n+            - env_var: CMD\n+              values:\n+                - mvn -e clean install -Pno-validations\n+                    && .ci/validation.sh no-error-pmd\n+                - mvn -e clean install -Pno-validations\n+                    && .ci/validation.sh no-violation-test-configurate\n           commands:\n-            - sem-version java 14\n-            - mvn -e install -Pno-validations\n-            - .ci/validation.sh no-violation-test-configurate\n-\n-        - name: No violation testing on josm\n-          commands:\n-            - mvn -e install -Pno-validations\n-            - .ci/validation.sh no-violation-test-josm\n+            - sem-version java 11\n+            - echo \"eval of CMD is starting\";\n+            - echo \"CMD=$CMD\";\n+            - eval $CMD;\n+            - echo \"eval of CMD is completed\";\n \n-        - name: No exception test\n+        - name: Validation (openjdk11, fast pool)\n           matrix:\n-            - env_var: PROJECT\n+            - env_var: CMD\n               values:\n-                - guava-with-google-checks\n-                - guava-with-sun-checks\n+                - mvn -e clean install -Pno-validations\n+                    && .ci/no-exception-test.sh guava-with-google-checks\n+                - mvn -e clean install -Pno-validations\n+                    && .ci/no-exception-test.sh guava-with-sun-checks\n+                - .ci/validation.sh all-sevntu-checks\n+                - .ci/validation.sh check-missing-pitests\n+                - .ci/validation.sh eclipse-static-analysis\n+                - mvn -e clean install -Pno-validations", "originalCommit": "dfe962d0e32b56000d5f35925cbef1ccb062372c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2ODE3Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8950#discussion_r515668172", "bodyText": "done", "author": "pbludov", "createdAt": "2020-11-01T20:29:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2NzQ4OQ=="}], "type": "inlineReview"}, {"oid": "8cadd66da43994102442029b99776b1e21cbbe29", "url": "https://github.com/checkstyle/checkstyle/commit/8cadd66da43994102442029b99776b1e21cbbe29", "message": "config: make semaphore ci commands easy to run on local", "committedDate": "2020-11-01T20:29:19Z", "type": "forcePushed"}, {"oid": "ac28e84a8df9627db63fc3abe9a8d11202c6d1ee", "url": "https://github.com/checkstyle/checkstyle/commit/ac28e84a8df9627db63fc3abe9a8d11202c6d1ee", "message": "config: make semaphore ci commands easy to run on local", "committedDate": "2020-11-02T08:09:09Z", "type": "commit"}, {"oid": "ac28e84a8df9627db63fc3abe9a8d11202c6d1ee", "url": "https://github.com/checkstyle/checkstyle/commit/ac28e84a8df9627db63fc3abe9a8d11202c6d1ee", "message": "config: make semaphore ci commands easy to run on local", "committedDate": "2020-11-02T08:09:09Z", "type": "forcePushed"}]}