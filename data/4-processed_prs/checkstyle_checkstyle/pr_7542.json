{"pr_number": 7542, "pr_title": "Issue #6807: add suppression filter for RightCurlyAlone", "pr_createdAt": "2020-02-09T02:48:42Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/7542", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MzExOA==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r376853118", "bodyText": "This won't work with comments as specified in another issue.", "author": "rnveach", "createdAt": "2020-02-10T03:12:47Z", "path": "src/main/resources/google_checks.xml", "diffHunk": "@@ -95,6 +95,12 @@\n              value=\"CLASS_DEF, METHOD_DEF, CTOR_DEF, LITERAL_FOR, LITERAL_WHILE, STATIC_INIT,\n                     INSTANCE_INIT, ANNOTATION_DEF, ENUM_DEF\"/>\n         </module>\n+        <module name=\"SuppressionXpathSingleFilter\">\n+          <!-- suppresion is required till https://github.com/checkstyle/checkstyle/issues/7541 -->\n+          <property name=\"id\" value=\"RightCurlyAlone\"/>\n+          <property name=\"query\" value=\"//RCURLY[parent::SLIST[count(./*)=1]\n+                                                 or parent::OBJBLOCK[count(./*)=2]]\"/>", "originalCommit": "6d8c11f3c647fca60b609840628fc9e2567d5f7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg3MTUxNQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r376871515", "bodyText": "For Google style it ok. It will work as required. Even there will be not all violations suppressed, it is still good step forward.", "author": "romani", "createdAt": "2020-02-10T05:14:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MzExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MzIxNQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r376853215", "bodyText": "Shouldn't we be able to add an IT test to show it works?", "author": "rnveach", "createdAt": "2020-02-10T03:13:23Z", "path": "src/main/resources/google_checks.xml", "diffHunk": "@@ -95,6 +95,12 @@\n              value=\"CLASS_DEF, METHOD_DEF, CTOR_DEF, LITERAL_FOR, LITERAL_WHILE, STATIC_INIT,\n                     INSTANCE_INIT, ANNOTATION_DEF, ENUM_DEF\"/>\n         </module>\n+        <module name=\"SuppressionXpathSingleFilter\">\n+          <!-- suppresion is required till https://github.com/checkstyle/checkstyle/issues/7541 -->\n+          <property name=\"id\" value=\"RightCurlyAlone\"/>\n+          <property name=\"query\" value=\"//RCURLY[parent::SLIST[count(./*)=1]\n+                                                 or parent::OBJBLOCK[count(./*)=2]]\"/>", "originalCommit": "6d8c11f3c647fca60b609840628fc9e2567d5f7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg3MTgwNQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r376871805", "bodyText": "Too much effort, to make this hack supported by UTs, it is temporal fix till new Check is implemented.\nIt just ease problem.", "author": "romani", "createdAt": "2020-02-10T05:16:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MzIxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY0MjE4NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r377642184", "bodyText": "Why won't UTs support this now? Is it because we only 1 run check at a time instead of the full config?", "author": "rnveach", "createdAt": "2020-02-11T13:45:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MzIxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc1MDg3NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r377750875", "bodyText": "Yes, extra coding is required and try to avoid this in this workaround fix", "author": "romani", "createdAt": "2020-02-11T16:32:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MzIxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMTYzNg==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r377811636", "bodyText": "@romani Does it make sense we trim down the IT run to just the specific check and not run the entire config?\nOne issue with the entire config is it may produce similar violations from different checks. IMO, that might be better to show.", "author": "rnveach", "createdAt": "2020-02-11T18:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MzIxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE5MDg1Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r378190853", "bodyText": "in IT we run specific Check now:\n\n  \n    \n      checkstyle/src/it/java/com/google/checkstyle/test/chapter4formatting/rule412nonemptyblocks/RightCurlyTest.java\n    \n    \n        Lines 108 to 115\n      in\n      1a2d4c2\n    \n    \n    \n    \n\n        \n          \n           public void testRightCurlyAloneSame() throws Exception { \n        \n\n        \n          \n               final String[] expected = CommonUtil.EMPTY_STRING_ARRAY; \n        \n\n        \n          \n            \n        \n\n        \n          \n               final Configuration checkConfig = getModuleConfig(\"RightCurly\", \"RightCurlyAlone\"); \n        \n\n        \n          \n               final String filePath = getPath(\"InputRightCurlySame.java\"); \n        \n\n        \n          \n            \n        \n\n        \n          \n               final Integer[] warnList = getLinesWithWarn(filePath); \n        \n\n        \n          \n               verify(checkConfig, filePath, expected, warnList); \n        \n    \n  \n\n\nSo, as we become to use single-filters more and more, we need to extend our ITs to load few modules from config files and execute such few modules(check(s) + filters) on file.\nI do not want to do this in this PR, as it will extend scope of fix a lot and delay functional fix. It is better to do this as separate issue - #7546 .\n\nOne issue with the entire config is it may produce similar violations from different checks. IMO, that might be better to show.\n\nyou might talk about CI verification item that run whole config over file,\nfor this particular CI, I need Input that have no violations. So I used newly created file as some \"prove\" that suppression actually works.", "author": "romani", "createdAt": "2020-02-12T11:22:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MzIxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg5MDA5NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r376890094", "bodyText": "How this is related with issue?:)", "author": "strkkk", "createdAt": "2020-02-10T06:50:18Z", "path": "src/xdocs/google_style.xml", "diffHunk": "@@ -648,7 +648,7 @@\n                   <a href=\"config_blocks.html#LeftCurly\">LeftCurly</a>\n                   <br/>\n                   <span class=\"wrapper inline\">\n-                    <img src=\"images/ok_green.png\" alt=\"\" />\n+                    <img src=\"images/ok_blue.png\" alt=\"\" />", "originalCommit": "6d8c11f3c647fca60b609840628fc9e2567d5f7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkxODEwMg==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r376918102", "bodyText": "https://checkstyle.org/google_style.html#Google_Legend\nBlue for covers all, green for covers some.", "author": "pbludov", "createdAt": "2020-02-10T08:25:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg5MDA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMjM2Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r377812366", "bodyText": "What is this file?", "author": "rnveach", "createdAt": "2020-02-11T18:19:29Z", "path": "output.log", "diffHunk": "@@ -0,0 +1,2 @@\n+Starting audit...\n+Audit done.", "originalCommit": "243c251eb4e429ae661ee44a6054114b7cbd8310", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4NDk4Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r378184982", "bodyText": "ci item is fixed to create this file in .ci-temp", "author": "romani", "createdAt": "2020-02-12T11:10:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMjM2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIwMjE2Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r378202166", "bodyText": "CI failure\n\n./.ci/travis/travis.sh: line 174: .ci-temp/output.log: No such file or directory", "author": "rnveach", "createdAt": "2020-02-12T11:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMjM2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIzMDc2Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r378230767", "bodyText": "fixed.", "author": "romani", "createdAt": "2020-02-12T12:51:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMjM2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMjU5Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r377812596", "bodyText": "I am not seeing why this changed. Why is old file not needed anymore but new is.", "author": "rnveach", "createdAt": "2020-02-11T18:19:57Z", "path": ".ci/travis/travis.sh", "diffHunk": "@@ -169,8 +169,8 @@ assembly-run-all-jar)\n   CS_POM_VERSION=$(mvn -e -q -Dexec.executable='echo' -Dexec.args='${project.version}' \\\n                      --non-recursive org.codehaus.mojo:exec-maven-plugin:1.3.1:exec)\n   echo version:$CS_POM_VERSION\n-  FOLDER=src/it/resources/com/google/checkstyle/test/chapter3filestructure/rule332nolinewrap\n-  FILE=InputNoLineWrapGood.java\n+  FOLDER=src/it/resources/com/google/checkstyle/test/chapter4formatting/rule413emptyblocks\n+  FILE=InputRightCurlyAloneOrEmptyNoViolations.java", "originalCommit": "243c251eb4e429ae661ee44a6054114b7cbd8310", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4MzgyNg==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r378183826", "bodyText": "it is still in use by it:\n\u2714 ~/java/github/romani/checkstyle [6807-suppress-rightcurlyalone L|\u2714] \n$ ag \"InputNoLineWrapGood\" src/it/java\nsrc/it/java/com/google/checkstyle/test/chapter3filestructure/rule332nolinewrap/NoLineWrapTest.java\n57:        final String filePath = getPath(\"InputNoLineWrapGood.java\");\n\nI just create new file that is located in it, and not used by it but used by CI.\nOnes we create new Check, this file become used by it and CI.", "author": "romani", "createdAt": "2020-02-12T11:07:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMjU5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIwMTg2NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r378201864", "bodyText": "I'm not understanding. What is the purpose of this file / folder assignment if it can change and have no impact on CI? Why was old file needed before and not now?", "author": "rnveach", "createdAt": "2020-02-12T11:46:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMjU5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIxNTE4OA==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r378215188", "bodyText": "it does affect CI.\nyou can change this file to any other Input and CI will fail, as it is very rare Input in our google ITs have some code and completely follow google style. So Input is specially selected.\nOld file was used as it produce no violations, it is still good to be used in this CI item.\nBUT I introduced new Input file that is not used in ITs at all, as it is for future Check, so I reused it in this CI item to be used at least by something and alarm us if somebody try to change suppression in wrong way.", "author": "romani", "createdAt": "2020-02-12T12:16:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMjU5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI1Nzc4OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7542#discussion_r378257789", "bodyText": "very rare Input in our google ITs have some code and completely follow google style. So Input is specially selected.\n\nJust a thought for another time, but why not keep the file the same and just build a super file that contains everything and not need to switch it from file to file.", "author": "rnveach", "createdAt": "2020-02-12T13:44:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgxMjU5Ng=="}], "type": "inlineReview"}, {"oid": "25da276b1d0ce5a1c94f286059d8662dc0233754", "url": "https://github.com/checkstyle/checkstyle/commit/25da276b1d0ce5a1c94f286059d8662dc0233754", "message": "Issue #6807: add suppression filter for RightCurlyAlone", "committedDate": "2020-02-17T03:07:36Z", "type": "commit"}]}