{"pr_number": 8106, "pr_title": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson \u2026", "pr_createdAt": "2020-04-16T00:53:07Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8106", "timeline": [{"oid": "b29b7aa374449157e58402e843fca18e15067437", "url": "https://github.com/checkstyle/checkstyle/commit/b29b7aa374449157e58402e843fca18e15067437", "message": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson testing", "committedDate": "2020-04-16T08:44:34Z", "type": "forcePushed"}, {"oid": "801cc548d36a891e414528cbd13b57e0985de5c5", "url": "https://github.com/checkstyle/checkstyle/commit/801cc548d36a891e414528cbd13b57e0985de5c5", "message": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson testing", "committedDate": "2020-04-16T08:46:17Z", "type": "forcePushed"}, {"oid": "53d86860e7ec00808aec6a8d787167cdb013fc1d", "url": "https://github.com/checkstyle/checkstyle/commit/53d86860e7ec00808aec6a8d787167cdb013fc1d", "message": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson testing", "committedDate": "2020-04-17T09:25:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413017464", "bodyText": "we should use config from spring-cloud-gcp, checkstyle_checks.xml is only applicable to our repo ONLY, it is too strict to be used in other projects.", "author": "romani", "createdAt": "2020-04-22T14:11:00Z", "path": ".ci/wercker.sh", "diffHunk": "@@ -234,6 +234,19 @@ no-error-spring-integration)\n   removeFolderWithProtectedFiles spring-integration\n   ;;\n \n+no-error-spring-cloud-gcp)\n+  set -e\n+  CS_POM_VERSION=$(mvn -e -q -Dexec.executable='echo' -Dexec.args='${project.version}' \\\n+                     --non-recursive org.codehaus.mojo:exec-maven-plugin:1.3.1:exec)\n+  echo CS_version: ${CS_POM_VERSION}\n+  checkout_from https://github.com/spring-cloud/spring-cloud-gcp\n+  cd .ci-temp/spring-cloud-gcp\n+  mvn -e compile checkstyle:check -Dproject.version=${CS_POM_VERSION} \\\n+     -Dcheckstyle.configLocation=../../config/checkstyle_checks.xml", "originalCommit": "53d86860e7ec00808aec6a8d787167cdb013fc1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxOTg1Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413019852", "bodyText": "@elefeint  , please share a CI command on how to run only checkstyle validation on spring-cloud-gcp. We should use exactly the same command as in your CI.", "author": "romani", "createdAt": "2020-04-22T14:13:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAyMjcwMg==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413022702", "bodyText": "Either mvn or mvnw should work. I have maven 3.6.2 locally, which works.\nTry omitting the -Dcheckstyle.configLocation override from your invocation. The project's pom file should find the right configuration by default.", "author": "elefeint", "createdAt": "2020-04-22T14:17:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAyNDM1NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413024355", "bodyText": "Alright, I\u2019ll try this. Thanks \ud83d\udc4d", "author": "Gaurav-Punjabi", "createdAt": "2020-04-22T14:19:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAyNDg3Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413024872", "bodyText": "from wercker log:\n[INFO] --- maven-checkstyle-plugin:3.0.0:check (default-cli) @ spring-cloud-gcp-core ---\n[INFO] There are 135 errors reported by Checkstyle 8.18 with sun_checks.xml ruleset.\n\nattention to sun_checks.xml it is clear problem with execution command.\n@Gaurav-Punjabi , from where you get this command ? it looks like copy-paste from somewhere, very unrelated.\n\n-Dproject.version=${CS_POM_VERSION}\n\nwe need to have property in spring-cloud-gcp-core project to let us specify SNAPSHOT version", "author": "romani", "createdAt": "2020-04-22T14:20:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAyOTM2Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413029362", "bodyText": "@elefeint , looks like checkstyle version defined somewhere in parents on pom.xml, is it possible to have for us variable in pom.xml that we can specify during build execution to specify our SNAPSHOT version of checkstyle.", "author": "romani", "createdAt": "2020-04-22T14:25:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAzNTcyMA==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413035720", "bodyText": "@romani I got the command from equals verifier config. Also I ran ./mvnw checkstyle:check@checkstyle-validation  without specifying the location to config file. It generated 25 violations.", "author": "Gaurav-Punjabi", "createdAt": "2020-04-22T14:32:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5MTE2Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413091166", "bodyText": "I see those; I'll fix them (we've disabled checkstyle on samples, so that our users are not hindered, but I am not sure why our CI did not pick those up; it should run with full checkstyle profile).", "author": "elefeint", "createdAt": "2020-04-22T15:37:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM3MDEzMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413370131", "bodyText": "I looked into it more; the problem is in the difference between maven invoking a phase (as we do in our build) and invoking a specific goal (as your CI is doing). The phase invocation mvn validate would correctly configure the checkstyle execution named checkstyle-validation (we can't rename that because it needs to override the global Spring Cloud configuration). But the goal invocation mvn checkstyle:check creates an execution with fresh defaults, which are to run sun_checks.xml, which our project does not abide by.\nSo there are two ways to invoke checkstyle that will work for Spring Cloud GCP:\nOption1 (invoke goal and provide the execution configuration name):\nmvn checkstyle:check@checkstyle-validation -P full-checkstyle\nOption2 (invoke phase and let maven configure the correct goal):\nmvn validate -P full-checkstyle\n(-P full-checkstyle enables checkstyle in our sample applications; it's nice to have for Option 2 and necessary for Option1 -- otherwise the default checkstyle config with sun_checks.xml will be in effect)", "author": "elefeint", "createdAt": "2020-04-22T22:16:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM3ODk4MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413378981", "bodyText": "@elefeint It worked! \ud83d\udc4d Thanks. One last thing, as specified by roman in this comment #8106 (comment). Is there a way we can specify checkstyle snapshot version during build execution?", "author": "Gaurav-Punjabi", "createdAt": "2020-04-22T22:35:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQwMjQyMw==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413402423", "bodyText": "Do you really need -Dproject.version=${CS_POM_VERSION} if you are just running from root? The project version is embedded in the checked out pom file; it does not need to be overridden.", "author": "elefeint", "createdAt": "2020-04-22T23:32:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQwNjYxMg==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413406612", "bodyText": "oh, I understand what you mean; to test the latest version of checkstyle plugin, you need to override the one we have.\nUse maven-checkstyle-plugin.version. It will work on everything except samples project, which overrides it for some reason. I'll remove the override on our side.", "author": "elefeint", "createdAt": "2020-04-22T23:43:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQwNjc4OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413406789", "bodyText": "So, -Dmaven-checkstyle-plugin.version=${CS_POM_VERSION}", "author": "elefeint", "createdAt": "2020-04-22T23:43:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQwOTAwMw==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r413409003", "bodyText": "Actually, that's wrong; that one is for the maven plugin. Use puppycrawl-tools-checkstyle.version for the tool itself.", "author": "elefeint", "createdAt": "2020-04-22T23:49:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU5MjI0OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r414592248", "bodyText": "@romani I tried this command provided by @elefeint\nmvn validate -P full-checkstyle -Dpuppycrawl-tools-checkstyle.version=8.32-SNAPSHO\nBut it is throwing this error\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.0.0:check (checkstyle-validation) on project spring-cloud-gcp: Execution checkstyle-validation of goal org.apache.maven.plugins:maven-checkstyle-plugin:3.0.0:check failed: An API incompatibility was encountered while executing org.apache.maven.plugins:maven-checkstyle-plugin:3.0.0:check: java.lang.NoSuchMethodError: com.puppycrawl.tools.checkstyle.DefaultLogger.<init>(Ljava/io/OutputStream;Z)V\nIt would be great if you could just help me this. I'm stuck here.", "author": "Gaurav-Punjabi", "createdAt": "2020-04-24T13:51:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwNzg4NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r414607885", "bodyText": "Maven checkstyle plugin is still using the DefaultLogger constructors that were removed in checkstyle.\nYou'll have to work with the maven-checkstyle-plugin project to get them to stop using nonexistent constructors.", "author": "elefeint", "createdAt": "2020-04-24T14:12:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMzMDE5MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r415330191", "bodyText": "maven-checkstyle-plugin:3.0.0:check\n\n@elefeint , is it possible to upgrade maven plugin to 3.1.1 in spring-cloud-gcp ?\nhttp://maven.apache.org/plugins/maven-checkstyle-plugin/\nit is well known problem that we already resolved in 3.1.1 version.\n\n@Gaurav-Punjabi , please use mvn checkstyle:check@checkstyle-validation -P full-checkstyle we need to minimize execution time as much as possible.", "author": "romani", "createdAt": "2020-04-26T15:02:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMzMDY2Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r415330666", "bodyText": "@Gaurav-Punjabi , please use mvn checkstyle:check@checkstyle-validation -P full-checkstyle we need to minimize execution time as much as possible.\n\nYeah, I was going to use this command. I was just testing it with mvn validate \ud83d\udc4d", "author": "Gaurav-Punjabi", "createdAt": "2020-04-26T15:05:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjEyNzY2NA==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r416127664", "bodyText": "Upgraded to the latest maven plugin and checkstyle in spring-cloud/spring-cloud-gcp#2337. Try it now?", "author": "elefeint", "createdAt": "2020-04-27T20:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE2MTc1OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r416161758", "bodyText": "@elefeint DefaultLogger issue is resolved. Just one last thing, the checkstyle config for spring-cloud-gcp-samples has a property allowMissingJavadoc in JavadocMethodCheck. This property doesn't exist in the check as you can see here, which is throwing an error due to which we cannot run checkstyle. Can you please remove that property from the config ?\nYou can use this command to check this issue\n mvn validate -P full-checkstyle -Dpuppycrawl-tools-checkstyle.version=8.32-SNAPSHOT -Dmaven-checkstyle-plugin.version=3.1.1\n\nHere's the error log for your reference :)\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.1.1:check (checkstyle-validation) on project spring-cloud-gcp-samples: Failed during checkstyle configuration: cannot initialize module com.puppycrawl.tools.checkstyle.TreeWalker - cannot initialize module com.puppycrawl.tools.checkstyle.checks.javadoc.JavadocMethodCheck - Property 'allowMissingJavadoc' does not exist, please check the documentation -> [Help 1]", "author": "Gaurav-Punjabi", "createdAt": "2020-04-27T21:28:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE3NDExMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r416174111", "bodyText": "Just merged a fix. Try it again?", "author": "elefeint", "createdAt": "2020-04-27T21:50:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIwNjUyMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r416206521", "bodyText": "It works and we're good to go. I'll make the changes and will soon get it reviewed by the members. Thanks for your corporation \ud83d\udc4d\ud83c\udffb", "author": "Gaurav-Punjabi", "createdAt": "2020-04-27T23:00:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgzMDQzNw==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r416830437", "bodyText": "Please use mvn checkstyle:check@checkstyle-validation -P full-checkstyle to execute what we need only", "author": "romani", "createdAt": "2020-04-28T18:25:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgzODQ5Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/8106#discussion_r416838496", "bodyText": "Oh yeah my bad, Fixed it \ud83d\udc4d", "author": "Gaurav-Punjabi", "createdAt": "2020-04-28T18:39:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNzQ2NA=="}], "type": "inlineReview"}, {"oid": "3351a6352f984becef2f98d9a89175928da3dbcc", "url": "https://github.com/checkstyle/checkstyle/commit/3351a6352f984becef2f98d9a89175928da3dbcc", "message": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson testing", "committedDate": "2020-04-22T22:41:46Z", "type": "forcePushed"}, {"oid": "533d627e9ff08977c07c3ed05116c87b35b1c548", "url": "https://github.com/checkstyle/checkstyle/commit/533d627e9ff08977c07c3ed05116c87b35b1c548", "message": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson testing", "committedDate": "2020-04-27T23:09:19Z", "type": "forcePushed"}, {"oid": "eabd121db3bdc18920bd2e1d81d5934da92e5997", "url": "https://github.com/checkstyle/checkstyle/commit/eabd121db3bdc18920bd2e1d81d5934da92e5997", "message": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson testing", "committedDate": "2020-04-27T23:17:24Z", "type": "forcePushed"}, {"oid": "eab1066f039c3d394740fbd87e2c04709bfa84c8", "url": "https://github.com/checkstyle/checkstyle/commit/eab1066f039c3d394740fbd87e2c04709bfa84c8", "message": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson testing", "committedDate": "2020-04-28T18:38:36Z", "type": "forcePushed"}, {"oid": "ca81d7e154b46e425ef2735aa0942d989c42bc1d", "url": "https://github.com/checkstyle/checkstyle/commit/ca81d7e154b46e425ef2735aa0942d989c42bc1d", "message": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson testing", "committedDate": "2020-04-29T07:20:02Z", "type": "commit"}, {"oid": "ca81d7e154b46e425ef2735aa0942d989c42bc1d", "url": "https://github.com/checkstyle/checkstyle/commit/ca81d7e154b46e425ef2735aa0942d989c42bc1d", "message": "Issue #6209: add spring-cloud-gcp project to CIs no errror regresson testing", "committedDate": "2020-04-29T07:20:02Z", "type": "forcePushed"}]}