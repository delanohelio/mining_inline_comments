{"pr_number": 7437, "pr_title": "config: add .ci/bump-license-year-in-all-projects.sh", "pr_createdAt": "2020-01-03T00:57:30Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/7437", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzA3Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362693076", "bodyText": "header isn't in src directory.", "author": "rnveach", "createdAt": "2020-01-03T02:34:28Z", "path": ".ci/bump_license_year.sh", "diffHunk": "@@ -0,0 +1,15 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+OLD_PATTERN=\"// Copyright (C) 2001-$PREV_YEAR the original author or authors.\"\n+NEW_PATTERN=\"// Copyright (C) 2001-$CURR_YEAR the original author or authors.\"\n+find ./src -type f \\( -name *.java -o -name *.header -o -name *.g \\) \\", "originalCommit": "027a9f372db8b4c2e30305cfe023877e9f31be5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwODk5NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362708994", "bodyText": "fixed.", "author": "romani", "createdAt": "2020-01-03T05:29:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzA3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzMzMg==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362693332", "bodyText": "Since this is a regular expression pattern, don't you have to sanitize the ()s and -?", "author": "rnveach", "createdAt": "2020-01-03T02:36:50Z", "path": ".ci/bump_license_year.sh", "diffHunk": "@@ -0,0 +1,15 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+OLD_PATTERN=\"// Copyright (C) 2001-$PREV_YEAR the original author or authors.\"\n+NEW_PATTERN=\"// Copyright (C) 2001-$CURR_YEAR the original author or authors.\"\n+find ./src -type f \\( -name *.java -o -name *.header -o -name *.g \\) \\\n+  -exec sed -i \"s|$OLD_PATTERN|$NEW_PATTERN|g\" {} +", "originalCommit": "027a9f372db8b4c2e30305cfe023877e9f31be5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwOTAzNw==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362709037", "bodyText": "changed name of variable, it is not a regexp pattern", "author": "romani", "createdAt": "2020-01-03T05:30:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzMzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1NzAxNw==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362957017", "bodyText": "The s||g looks like a regular expression text to me.", "author": "rnveach", "createdAt": "2020-01-03T20:51:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzMzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3MTU5MA==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362971590", "bodyText": "sed -E is for regexp. we use just search and replace.", "author": "romani", "createdAt": "2020-01-03T21:45:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzMzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzM3OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362693379", "bodyText": "Why can't script help with this and print it?", "author": "rnveach", "createdAt": "2020-01-03T02:37:24Z", "path": ".ci/bump_license_year.sh", "diffHunk": "@@ -0,0 +1,15 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+OLD_PATTERN=\"// Copyright (C) 2001-$PREV_YEAR the original author or authors.\"\n+NEW_PATTERN=\"// Copyright (C) 2001-$CURR_YEAR the original author or authors.\"\n+find ./src -type f \\( -name *.java -o -name *.header -o -name *.g \\) \\\n+  -exec sed -i \"s|$OLD_PATTERN|$NEW_PATTERN|g\" {} +\n+\n+echo \"Please Verify that output below is ONLY single line:\"", "originalCommit": "027a9f372db8b4c2e30305cfe023877e9f31be5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwOTE4MA==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362709180", "bodyText": "actually it is not good verification, too late to verify, ... I rephrased a message", "author": "romani", "createdAt": "2020-01-03T05:31:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzM3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1NzQ2NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362957464", "bodyText": "Do you think we should have some pause and verify with a warning before doing the actual push? If diff is not a single line there is not way to stop the push.", "author": "rnveach", "createdAt": "2020-01-03T20:52:51Z", "path": ".ci/bump-license-year-in-all-projects.sh", "diffHunk": "@@ -0,0 +1,44 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+echo \"CURR_YEAR=$CURR_YEAR\"\n+echo \"PREV_YEAR=$PREV_YEAR\"\n+\n+./.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR .\n+git add . && git commit -m \"minor: bump year to $CURR_YEAR\" && git push origin master", "originalCommit": "df0d7c997c2a238f7af97a5c51b366401f6a709a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3MDI4Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362970286", "bodyText": "I do not think so if some thing will not work well it should be just fixed.\nI used some validation when I was not sure in command, it was just sanity check.\nIt is not required if we start automate it.", "author": "romani", "createdAt": "2020-01-03T21:40:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1NzQ2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1Nzc5MA==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362957790", "bodyText": "Why isn't cd and git command part of bump-license-year.sh? You pass all the necessary variables to do this.", "author": "rnveach", "createdAt": "2020-01-03T20:53:57Z", "path": ".ci/bump-license-year-in-all-projects.sh", "diffHunk": "@@ -0,0 +1,44 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+echo \"CURR_YEAR=$CURR_YEAR\"\n+echo \"PREV_YEAR=$PREV_YEAR\"\n+\n+./.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR .\n+git add . && git commit -m \"minor: bump year to $CURR_YEAR\" && git push origin master\n+\n+mkdir -p .ci-temp/bump-year\n+cd .ci-temp/bump-year\n+\n+git clone git@github.com:checkstyle/contribution.git\n+git clone git@github.com:checkstyle/sonar-checkstyle.git\n+git clone git@github.com:checkstyle/regression-tool.git\n+git clone git@github.com:sevntu-checkstyle/sevntu.checkstyle.git\n+git clone git@github.com:sevntu-checkstyle/methods-distance.git\n+\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR contribution\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR sonar-checkstyle\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR regression-tool\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR sevntu.checkstyle\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR methods-distance\n+\n+cd contribution\n+git add . && git commit -m \"minor: bump year to $CURR_YEAR\" && git push origin master", "originalCommit": "df0d7c997c2a238f7af97a5c51b366401f6a709a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3MDk1OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362970959", "bodyText": "something tell me to keep push out of logic for files modification.\nI am ok to keep this script in non optional state while it is not tested several times", "author": "romani", "createdAt": "2020-01-03T21:43:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1Nzc5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1ODQ4MA==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362958480", "bodyText": "Should this be Distinct?\nI think it would be better to make some wording like last time, like \"Diff should only be 1 line and should not continue if it is more than 1\".", "author": "rnveach", "createdAt": "2020-01-03T20:56:20Z", "path": ".ci/bump-license-year.sh", "diffHunk": "@@ -0,0 +1,19 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+PREV_YEAR=$1\n+CURR_YEAR=$2\n+DIR=$3\n+\n+OLD_VALUE=\"// Copyright (C) 2001-$PREV_YEAR the original author or authors.\"\n+NEW_VALUE=\"// Copyright (C) 2001-$CURR_YEAR the original author or authors.\"\n+\n+find $DIR -type f \\( -name *.java -o -name *.header -o -name *.g \\) \\\n+  -exec sed -i \"s|$OLD_VALUE|$NEW_VALUE|g\" {} +\n+\n+BASEDIR=$(pwd)\n+echo \"Distict Diff in $DIR is:\"", "originalCommit": "df0d7c997c2a238f7af97a5c51b366401f6a709a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3MTI5Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362971296", "bodyText": "typo is fixed.\nI try to avoid validation ... script should just work. I keep output to have some logs of what happened for investigation if problem appear.", "author": "romani", "createdAt": "2020-01-03T21:44:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1ODQ4MA=="}], "type": "inlineReview"}, {"oid": "d1cbafe6a1b38ffba6c17ed65b375af1f3dd0c57", "url": "https://github.com/checkstyle/checkstyle/commit/d1cbafe6a1b38ffba6c17ed65b375af1f3dd0c57", "message": "config: add .ci/bump-license-year-in-all-projects.sh", "committedDate": "2020-01-03T21:35:28Z", "type": "commit"}]}