{"pr_number": 8293, "pr_title": "Issue #8023: Update grammar for initial record support", "pr_createdAt": "2020-06-01T19:37:14Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8293", "timeline": [{"oid": "eb9a4c0a667913c60b0a6006c4ce83f38efa085e", "url": "https://github.com/checkstyle/checkstyle/commit/eb9a4c0a667913c60b0a6006c4ce83f38efa085e", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-03T22:08:47Z", "type": "forcePushed"}, {"oid": "4e65c03460cea3180f5bd9c88238840b0203e82e", "url": "https://github.com/checkstyle/checkstyle/commit/4e65c03460cea3180f5bd9c88238840b0203e82e", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-03T22:50:43Z", "type": "forcePushed"}, {"oid": "fc5fece89ff4596184c5e0ee4eba942f059715a6", "url": "https://github.com/checkstyle/checkstyle/commit/fc5fece89ff4596184c5e0ee4eba942f059715a6", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-04T21:26:32Z", "type": "forcePushed"}, {"oid": "314a91e19ce90761c152cfcca9470cfae208f138", "url": "https://github.com/checkstyle/checkstyle/commit/314a91e19ce90761c152cfcca9470cfae208f138", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-04T21:36:29Z", "type": "forcePushed"}, {"oid": "7a9bf1da1e40f12acea7ea269790da8a80f1cf35", "url": "https://github.com/checkstyle/checkstyle/commit/7a9bf1da1e40f12acea7ea269790da8a80f1cf35", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-05T00:03:29Z", "type": "forcePushed"}, {"oid": "d2d7fa74397c87daae9682e5e53ac7e4a25220fd", "url": "https://github.com/checkstyle/checkstyle/commit/d2d7fa74397c87daae9682e5e53ac7e4a25220fd", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-05T16:18:22Z", "type": "forcePushed"}, {"oid": "cba7fc26255174ed31e04c7e619ffb8811bb4f06", "url": "https://github.com/checkstyle/checkstyle/commit/cba7fc26255174ed31e04c7e619ffb8811bb4f06", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-05T17:48:37Z", "type": "forcePushed"}, {"oid": "dd5d03712ef0f935d7b27af4bfbc884f27e59f84", "url": "https://github.com/checkstyle/checkstyle/commit/dd5d03712ef0f935d7b27af4bfbc884f27e59f84", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-05T19:31:19Z", "type": "forcePushed"}, {"oid": "d77d8dc20f39e2eab8bfd74afecca39a50788ae8", "url": "https://github.com/checkstyle/checkstyle/commit/d77d8dc20f39e2eab8bfd74afecca39a50788ae8", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-05T20:14:59Z", "type": "forcePushed"}, {"oid": "6e12ca720c8c8ed871c382b7a5deef972f359728", "url": "https://github.com/checkstyle/checkstyle/commit/6e12ca720c8c8ed871c382b7a5deef972f359728", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-06T12:20:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3MTczMg==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r437071732", "bodyText": "looks like this record's indentation got off (I assume unintentionally?)", "author": "esilkensen", "createdAt": "2020-06-09T00:28:12Z", "path": "src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14Records.java", "diffHunk": "@@ -24,15 +35,15 @@ public record AnnotatedBinaryNode(@NonNull1 Node left, @NonNull1 Node right) { }\n \n     //Implements interface\n     public record Polar(double r, double theta) implements Coords {\n-        @Override\n-        public double x() {\n-            return r * Math.cos(theta);\n-        }\n+    @Override", "originalCommit": "6e12ca720c8c8ed871c382b7a5deef972f359728", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkxNTI0NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r438915245", "bodyText": "Fixed", "author": "nmancus1", "createdAt": "2020-06-11T16:26:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3MTczMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3NzI0MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r437077241", "bodyText": "I wondered about an approach like this as well -- I think it may be hard to catch all the cases, though (e.g. record[], record ->, record<T>, etc.), or to really decide keyword vs. identifier in the lexer (what about class record extends Object), and seems like it could be difficult to maintain.\nIt makes me wonder again about leaving record as an IDENT as far as the lexer is concerned, and just trying to deal with it in the grammar rule. I know you have already been down multiple paths with predicates -- I will take a look myself a little later tonight and see if anything strikes me...", "author": "esilkensen", "createdAt": "2020-06-09T00:50:23Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -1966,6 +2014,17 @@ IDENT\n             if (mTreatEnumAsKeyword && \"enum\".equals($getText)) {\n                 $setType(ENUM);\n             }\n+            // records must not be in literal list, else legacy usage of records\n+            // i.e. \"LogRecord record = log();\" as a variable and method name\n+            // cause false positives. The 'keyword as identifier' problem.\n+            if (mTreatRecordAsKeyword\n+                && \"record\".equals($getText)\n+                && LA(2) != '=' && LA(1) != ';'\n+                && LA(1) != ')' && LA(1) != '.'\n+                && LA(1) != ',' && LA(1) != '('\n+                && LA(2) != ':') {\n+                $setType(RECORD);", "originalCommit": "6e12ca720c8c8ed871c382b7a5deef972f359728", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3OTUzNQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r437079535", "bodyText": "This actually works pretty great for records, but messes up quite a few other things.  I got the idea from here.\nEdit: this is the recommended approach, but it requires quite a few changes to existing grammar.", "author": "nmancus1", "createdAt": "2020-06-09T00:59:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3NzI0MQ=="}], "type": "inlineReview"}, {"oid": "114bc18f85e96ac1645668ecf930f050f45bc772", "url": "https://github.com/checkstyle/checkstyle/commit/114bc18f85e96ac1645668ecf930f050f45bc772", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-06-10T21:27:17Z", "type": "forcePushed"}, {"oid": "0449997102639d5a55a6de5bc25873b34aa23120", "url": "https://github.com/checkstyle/checkstyle/commit/0449997102639d5a55a6de5bc25873b34aa23120", "message": "minor: lower coverage minimum for GeneratedJavaLexer.java (#8023)", "committedDate": "2020-06-11T16:23:33Z", "type": "forcePushed"}, {"oid": "4ed97924681a515317830afd3406520cfb480741", "url": "https://github.com/checkstyle/checkstyle/commit/4ed97924681a515317830afd3406520cfb480741", "message": "minor: lower coverage minimum for GeneratedJavaLexer.java (#8023)", "committedDate": "2020-06-11T17:24:56Z", "type": "forcePushed"}, {"oid": "af2bd54772e77ab7f9b3311f2736944cb5d03924", "url": "https://github.com/checkstyle/checkstyle/commit/af2bd54772e77ab7f9b3311f2736944cb5d03924", "message": "minor: lower coverage minimum for GeneratedJavaLexer.java (#8023)", "committedDate": "2020-06-12T14:37:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ3MjM0Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r439472343", "bodyText": "nit: looks like the commit message references the wrong file (Lexer instead of Recognizer)", "author": "esilkensen", "createdAt": "2020-06-12T14:59:45Z", "path": "pom.xml", "diffHunk": "@@ -906,7 +906,7 @@\n                     <limit>\n                       <counter>BRANCH</counter>\n                       <value>COVEREDRATIO</value>\n-                      <minimum>0.73</minimum>\n+                      <minimum>0.72</minimum>", "originalCommit": "af2bd54772e77ab7f9b3311f2736944cb5d03924", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4MDk2OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r439480969", "bodyText": "Good catch. Fixed.", "author": "nmancus1", "createdAt": "2020-06-12T15:14:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ3MjM0Mw=="}], "type": "inlineReview"}, {"oid": "4ea08c672a18154d44f393758bc4ce67ea18440b", "url": "https://github.com/checkstyle/checkstyle/commit/4ea08c672a18154d44f393758bc4ce67ea18440b", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-12T15:05:08Z", "type": "forcePushed"}, {"oid": "b6631dbf417ac4a5b4c3d7fb67073883054c05f3", "url": "https://github.com/checkstyle/checkstyle/commit/b6631dbf417ac4a5b4c3d7fb67073883054c05f3", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-14T15:15:01Z", "type": "forcePushed"}, {"oid": "a6ae552a0470add65fb752effcc84997757532ac", "url": "https://github.com/checkstyle/checkstyle/commit/a6ae552a0470add65fb752effcc84997757532ac", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-15T14:32:19Z", "type": "forcePushed"}, {"oid": "20015f723d5fa4203178208d18f706ea4156c3d0", "url": "https://github.com/checkstyle/checkstyle/commit/20015f723d5fa4203178208d18f706ea4156c3d0", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-15T14:40:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0MTgxMA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r441341810", "bodyText": "What do you think about naming this recordDefinition to fit in with enumDefinition, annotationDefinition, etc.? (If you think that makes sense, no need to rerun reports just for that renaming)", "author": "esilkensen", "createdAt": "2020-06-17T07:35:58Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -254,6 +257,7 @@ typeDefinitionInternal[AST modifiers]\n     | interfaceDefinition[#modifiers]\n     | enumDefinition[#modifiers]\n     | annotationDefinition[#modifiers]\n+    | recordDeclaration[#modifiers]", "originalCommit": "20015f723d5fa4203178208d18f706ea4156c3d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQzMDY3OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r441430678", "bodyText": "+1 for recordDefinition. Records are basically classes.", "author": "pbludov", "createdAt": "2020-06-17T10:00:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0MTgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk4NDcwOA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r441984708", "bodyText": "I was thinking the same. Done.", "author": "nmancus1", "createdAt": "2020-06-18T05:57:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0MTgxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0MjAxNA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r441342014", "bodyText": "intentional?", "author": "esilkensen", "createdAt": "2020-06-17T07:36:17Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -543,9 +547,60 @@ annotationExpression\n         {#annotationExpression = #(#[EXPR,\"EXPR\"],#annotationExpression);}\n     ;\n \n+\n+recordDeclaration![AST modifiers]\n+    :   r:\"record\" id:id\n+        (tp:typeParameters)?\n+        rc:recordComponentsList\n+        ic:implementsClause\n+        rb:recordBodyDeclaration\n+        {#recordDeclaration = #(#[RECORD_DEF, \"RECORD_DEF\"],\n+                              modifiers, r, id, rc);}\n+    ;\n+\n+// Build no AST for below rules until full records support\n+recordComponentsList!\n+    :   LPAREN recordComponents RPAREN\n+    ;\n+\n+recordComponents!\n+    // Taken from parameterDeclarationList\n+    :   (   ( recordComponent )=> recordComponent\n+            ( options {warnWhenFollowAmbig=false;} :\n+                ( COMMA recordComponent ) => COMMA recordComponent )*\n+            ( COMMA recordComponentVariableLength )?\n+        |\n+            recordComponentVariableLength\n+        )?\n+    ;\n+\n+recordComponentVariableLength!\n+    :   parameterModifier t:variableLengthParameterTypeSpec ELLIPSIS id\n+        declaratorBrackets[#t]\n+    ;\n+\n+recordComponent!\n+    :   annotations typeSpec[false] id\n+    ;\n+\n+recordBodyDeclaration!\n+    :   LCURLY\n+        (   (compactConstructorDeclaration)=> compactConstructorDeclaration\n+        |   field\n+        |   SEMI\n+        )*\n+        RCURLY\n+    ;\n+\n+compactConstructorDeclaration!\n+    :    annotations modifiers id\n+            constructorBody\n+    ;\n+//", "originalCommit": "20015f723d5fa4203178208d18f706ea4156c3d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk4NDYxNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r441984616", "bodyText": "It was, to sort of group all of the rules related to #8267 together.  I've removed it.", "author": "nmancus1", "createdAt": "2020-06-18T05:57:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0MjAxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0NTkzMw==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r441345933", "bodyText": "Could potentially link to #8267", "author": "esilkensen", "createdAt": "2020-06-17T07:43:07Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -543,9 +547,60 @@ annotationExpression\n         {#annotationExpression = #(#[EXPR,\"EXPR\"],#annotationExpression);}\n     ;\n \n+\n+recordDeclaration![AST modifiers]\n+    :   r:\"record\" id:id\n+        (tp:typeParameters)?\n+        rc:recordComponentsList\n+        ic:implementsClause\n+        rb:recordBodyDeclaration\n+        {#recordDeclaration = #(#[RECORD_DEF, \"RECORD_DEF\"],\n+                              modifiers, r, id, rc);}\n+    ;\n+\n+// Build no AST for below rules until full records support", "originalCommit": "20015f723d5fa4203178208d18f706ea4156c3d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk4NDMxNw==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r441984317", "bodyText": "Done.", "author": "nmancus1", "createdAt": "2020-06-18T05:55:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0NTkzMw=="}], "type": "inlineReview"}, {"oid": "9851538ea5142b1bf3021e7bdc80589b12c89851", "url": "https://github.com/checkstyle/checkstyle/commit/9851538ea5142b1bf3021e7bdc80589b12c89851", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-18T05:55:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI0MzE4Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r442243183", "bodyText": "This blank line has a pair on line 1668 (1732). Please remove both of them or none of them.", "author": "pbludov", "createdAt": "2020-06-18T13:53:22Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -1693,7 +1757,6 @@ options {\n     {\n         mTreatEnumAsKeyword = aTreatAsKeyword;\n     }\n-", "originalCommit": "9851538ea5142b1bf3021e7bdc80589b12c89851", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3NDQ4NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r442274485", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-06-18T14:34:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI0MzE4Mw=="}], "type": "inlineReview"}, {"oid": "899a3dfd19f20b9e7d9cc58b879dab454524f1ee", "url": "https://github.com/checkstyle/checkstyle/commit/899a3dfd19f20b9e7d9cc58b879dab454524f1ee", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-18T14:28:28Z", "type": "forcePushed"}, {"oid": "71258d83ab21e5aa5e6f69a792e5abefc28bf9a2", "url": "https://github.com/checkstyle/checkstyle/commit/71258d83ab21e5aa5e6f69a792e5abefc28bf9a2", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-21T12:54:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE5MjE5OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r445192198", "bodyText": "@rnveach\n\nAlso I notice this isn't full record support. Is there another issue defined that will house the full record support?\n\nHere is a link to the issue for full record support", "author": "esilkensen", "createdAt": "2020-06-24T21:51:05Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -543,9 +547,61 @@ annotationExpression\n         {#annotationExpression = #(#[EXPR,\"EXPR\"],#annotationExpression);}\n     ;\n \n+\n+recordDefinition![AST modifiers]\n+    :   r:\"record\" id:id\n+        (tp:typeParameters)?\n+        rc:recordComponentsList\n+        ic:implementsClause\n+        rb:recordBodyDeclaration\n+        {#recordDefinition = #(#[RECORD_DEF, \"RECORD_DEF\"],\n+                              modifiers, r, id, rc);}\n+    ;\n+\n+// Build no AST for other record rules until\n+// https://github.com/checkstyle/checkstyle/issues/8267", "originalCommit": "71258d83ab21e5aa5e6f69a792e5abefc28bf9a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "aaaf9d51304f780516e3dc0b3043e298a9687098", "url": "https://github.com/checkstyle/checkstyle/commit/aaaf9d51304f780516e3dc0b3043e298a9687098", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-25T14:14:10Z", "type": "forcePushed"}, {"oid": "1b9932d1a9cd447ac2b3daa67e9cd203b15180b6", "url": "https://github.com/checkstyle/checkstyle/commit/1b9932d1a9cd447ac2b3daa67e9cd203b15180b6", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-26T01:28:41Z", "type": "forcePushed"}, {"oid": "1d7ea67b55928b8f7448f4f58dce725559b5507d", "url": "https://github.com/checkstyle/checkstyle/commit/1d7ea67b55928b8f7448f4f58dce725559b5507d", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-06-26T04:03:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0OTk2MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448449960", "bodyText": "I am not sure I would make a bland statement like all Java 14 will be here as we are forced to add new tokens to the end. If some other token needs to be added, java 14 will have to be split between it.", "author": "rnveach", "createdAt": "2020-07-01T15:37:55Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -116,6 +116,9 @@ tokens {\n     BINARY_DIGIT; ID_START; ID_PART; INT_LITERAL; LONG_LITERAL;\n     FLOAT_LITERAL; DOUBLE_LITERAL; HEX_FLOAT_LITERAL; HEX_DOUBLE_LITERAL;\n     SIGNED_INTEGER; BINARY_EXPONENT;\n+\n+    //Start Java14 syntax here", "originalCommit": "1d7ea67b55928b8f7448f4f58dce725559b5507d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0ODQxOQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448948419", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-07-02T11:57:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0OTk2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1MDM4Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448450382", "bodyText": "Why text \"record\" and not LITERAL_record?", "author": "rnveach", "createdAt": "2020-07-01T15:38:39Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -543,6 +547,58 @@ annotationExpression\n         {#annotationExpression = #(#[EXPR,\"EXPR\"],#annotationExpression);}\n     ;\n \n+\n+recordDefinition![AST modifiers]\n+    :   r:\"record\" id:id", "originalCommit": "1d7ea67b55928b8f7448f4f58dce725559b5507d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg1MTQyMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448851421", "bodyText": "@nmancus1 can you answer here? I feel like I remember you mentioning this, but I know there were a number of attempts before landing on this solution. Would LITERAL_record also work?", "author": "esilkensen", "createdAt": "2020-07-02T08:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1MDM4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0NTIyMA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448945220", "bodyText": "Yes, it will work.", "author": "nmancus1", "createdAt": "2020-07-02T11:51:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1MDM4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0ODM1MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448948350", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-07-02T11:57:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1MDM4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1OTQ0NA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448459444", "bodyText": "Is there no ClassBodyDeclaration because of limited record support?", "author": "rnveach", "createdAt": "2020-07-01T15:53:03Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -543,6 +547,58 @@ annotationExpression\n         {#annotationExpression = #(#[EXPR,\"EXPR\"],#annotationExpression);}\n     ;\n \n+\n+recordDefinition![AST modifiers]\n+    :   r:\"record\" id:id\n+        (tp:typeParameters)?\n+        rc:recordComponentsList\n+        ic:implementsClause\n+        rb:recordBodyDeclaration\n+        {#recordDefinition = #(#[RECORD_DEF, \"RECORD_DEF\"],\n+                              modifiers, r, id, rc);}\n+    ;\n+\n+// Build no AST for other record rules until\n+// https://github.com/checkstyle/checkstyle/issues/8267\n+recordComponentsList!\n+    :   LPAREN recordComponents RPAREN\n+    ;\n+\n+recordComponents!\n+    // Taken from parameterDeclarationList\n+    :   (   ( recordComponent )=> recordComponent\n+            ( options {warnWhenFollowAmbig=false;} :\n+                ( COMMA recordComponent ) => COMMA recordComponent )*\n+            ( COMMA recordComponentVariableLength )?\n+        |\n+            recordComponentVariableLength\n+        )?\n+    ;\n+\n+recordComponentVariableLength!\n+    :   parameterModifier t:variableLengthParameterTypeSpec ELLIPSIS id\n+        declaratorBrackets[#t]\n+    ;\n+\n+recordComponent!\n+    :   annotations typeSpec[false] id\n+    ;\n+\n+recordBodyDeclaration!\n+    :   LCURLY\n+        (   (compactConstructorDeclaration)=> compactConstructorDeclaration\n+        |   field\n+        |   SEMI", "originalCommit": "1d7ea67b55928b8f7448f4f58dce725559b5507d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3MDIyNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448470226", "bodyText": "http://cr.openjdk.java.net/~gbierman/jep359/jep359-20191031/specs/records-jls.html#jls-8.10.2", "author": "rnveach", "createdAt": "2020-07-01T16:11:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1OTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg1NTY0Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448855647", "bodyText": "I think we are covered with field and SEMI (I like this comment \ud83d\ude04) \n  \n    \n      checkstyle/src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g\n    \n    \n        Lines 763 to 768\n      in\n      f1ee17d\n    \n    \n    \n    \n\n        \n          \n           // This is the body of a class.  You can have fields and extra semicolons, \n        \n\n        \n          \n           // That's about it (until you see what a field is...) \n        \n\n        \n          \n           classBlock \n        \n\n        \n          \n               :    LCURLY \n        \n\n        \n          \n                       ( field | SEMI )* \n        \n\n        \n          \n                   RCURLY \n        \n    \n  \n\n\nThis PR is parsing the InputJava14Records file which has records with fields, methods, etc. in their bodies.", "author": "esilkensen", "createdAt": "2020-07-02T09:00:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1OTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzOTAwNw==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448939007", "bodyText": "Is there no ClassBodyDeclaration because of limited record support?\n\nWell, I wasn't sure what the best way to do this was. classblock is already our ClassBodyDeclaration.  I can't reuse  classblock, since it has LCURLY and RCURLY already defined, and it doesn't make sense ( and causes lots of problems ) to add compactConstructorDeclaration to classblock.\nFor full records support, I planned to make this entire AST an OBJBLOCK, and the recordBodyDeclaration rule should work well with existing checks that way.", "author": "nmancus1", "createdAt": "2020-07-02T11:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1OTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0OTM1OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448949358", "bodyText": "I can't provide recommendation on best way to go. If you believe this is parsing correctly or will be changed in full support, then you can mark this as resolved. I just noticed the disparity and wanted to make sure I was missing something or it was going to be resolved.", "author": "rnveach", "createdAt": "2020-07-02T11:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1OTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1MjI2NA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448952264", "bodyText": "This parses everything I've thrown at it, and all the records files in JDK14 repo.  The only changes I plan to make are to build the AST for it in #8267.  I'm going to mark it as resolved.", "author": "nmancus1", "createdAt": "2020-07-02T12:04:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1OTQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ2ODc0Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448468743", "bodyText": "we not adding tp, ic rb because it is incomplete? I noticed the grammar print had nothing.", "author": "rnveach", "createdAt": "2020-07-01T16:08:33Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -543,6 +547,58 @@ annotationExpression\n         {#annotationExpression = #(#[EXPR,\"EXPR\"],#annotationExpression);}\n     ;\n \n+\n+recordDefinition![AST modifiers]\n+    :   r:\"record\" id:id\n+        (tp:typeParameters)?\n+        rc:recordComponentsList\n+        ic:implementsClause\n+        rb:recordBodyDeclaration\n+        {#recordDefinition = #(#[RECORD_DEF, \"RECORD_DEF\"],\n+                              modifiers, r, id, rc);}", "originalCommit": "1d7ea67b55928b8f7448f4f58dce725559b5507d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg1MDkyOA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448850928", "bodyText": "Yes, the plan is to add the AST in the follow-up issue #8267", "author": "esilkensen", "createdAt": "2020-07-02T08:53:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ2ODc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0NDgwOQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448944809", "bodyText": "we not adding tp, ic rb because it is incomplete?\n\nThat is correct, but I still needed to include them here to correctly parse everything.", "author": "nmancus1", "createdAt": "2020-07-02T11:50:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ2ODc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0ODM2Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448948363", "bodyText": "Ok, it may just be me but it sounds like it would be beneficial to add a comment saying updates will come in 8267 to ensure we don't miss anything. Its not clear what is intended and what is going to be finished later, unless I missed some complete list.", "author": "rnveach", "createdAt": "2020-07-02T11:57:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ2ODc0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1MzIzNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r448953236", "bodyText": "I will make it more clear. Edit: fixed.", "author": "nmancus1", "createdAt": "2020-07-02T12:06:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ2ODc0Mw=="}], "type": "inlineReview"}, {"oid": "d3c25d66e74713ec813a52872c2b091622b66ec3", "url": "https://github.com/checkstyle/checkstyle/commit/d3c25d66e74713ec813a52872c2b091622b66ec3", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-07-02T11:56:35Z", "type": "forcePushed"}, {"oid": "d9dd24dc259cf9984aa609128b89770dafe5385a", "url": "https://github.com/checkstyle/checkstyle/commit/d9dd24dc259cf9984aa609128b89770dafe5385a", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-07-02T13:21:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAyNjEwNQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r449026105", "bodyText": "I do not see myString in AST example.\nPlease modify code example to be minimalistic, AST should be same by structure as our CLI is printing it.", "author": "romani", "createdAt": "2020-07-02T14:04:25Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/api/TokenTypes.java", "diffHunk": "@@ -3540,6 +3540,34 @@\n     public static final int COMMENT_CONTENT =\n             GeneratedJavaTokenTypes.COMMENT_CONTENT;\n \n+    /**\n+     * The {@code record} keyword.  This element appears\n+     * as part of a record declaration.\n+     **/\n+    public static final int LITERAL_RECORD =\n+            GeneratedJavaTokenTypes.LITERAL_record;\n+\n+    /**\n+     * A record declaration.\n+     *\n+     * <p>For example:</p>\n+     * <pre>\n+     * public record myRecord (String myString, String myOtherString) {}", "originalCommit": "d9dd24dc259cf9984aa609128b89770dafe5385a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA0NTQ2Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r449045463", "bodyText": "Fixed, I also updated the format of the AST to match the format we discussed in other PR.", "author": "nmancus1", "createdAt": "2020-07-02T14:31:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAyNjEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAyNjYxNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r449026616", "bodyText": "// until ... space after //", "author": "romani", "createdAt": "2020-07-02T14:05:10Z", "path": "src/main/resources/com/puppycrawl/tools/checkstyle/grammar/java.g", "diffHunk": "@@ -543,6 +546,59 @@ annotationExpression\n         {#annotationExpression = #(#[EXPR,\"EXPR\"],#annotationExpression);}\n     ;\n \n+// Java 14 record definition. We will not completely build this AST\n+// until https://github.com/checkstyle/checkstyle/issues/8267\n+recordDefinition![AST modifiers]\n+    :   r:LITERAL_record id:id\n+        (tp:typeParameters)?        //until #8267", "originalCommit": "d9dd24dc259cf9984aa609128b89770dafe5385a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA0NDI3NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r449044275", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-07-02T14:30:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAyNjYxNg=="}], "type": "inlineReview"}, {"oid": "bef4f038879fb4d6d2ac5f9bea8fbb47df9c51a5", "url": "https://github.com/checkstyle/checkstyle/commit/bef4f038879fb4d6d2ac5f9bea8fbb47df9c51a5", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-07-02T14:24:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDg0OTgwOA==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r450849808", "bodyText": "as we skip ``--OBJBLOCK -> OBJBLOCKin AST, lets updateA record declaration` to `A record declaration, this implementation is just to avoid parse errors, full support will be at #8267`", "author": "romani", "createdAt": "2020-07-07T13:08:08Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/api/TokenTypes.java", "diffHunk": "@@ -3540,6 +3540,32 @@\n     public static final int COMMENT_CONTENT =\n             GeneratedJavaTokenTypes.COMMENT_CONTENT;\n \n+    /**\n+     * The {@code record} keyword.  This element appears\n+     * as part of a record declaration.\n+     **/\n+    public static final int LITERAL_RECORD =\n+            GeneratedJavaTokenTypes.LITERAL_record;\n+\n+    /**\n+     * A record declaration.", "originalCommit": "bef4f038879fb4d6d2ac5f9bea8fbb47df9c51a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk0NTc4MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8293#discussion_r450945781", "bodyText": "Fixed and rebased.", "author": "nmancus1", "createdAt": "2020-07-07T15:18:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDg0OTgwOA=="}], "type": "inlineReview"}, {"oid": "7cc4ed518a69e86c7b2a5f3da1a8101c84c486b1", "url": "https://github.com/checkstyle/checkstyle/commit/7cc4ed518a69e86c7b2a5f3da1a8101c84c486b1", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-07-07T15:17:48Z", "type": "forcePushed"}, {"oid": "73deaaa0aedca7faa8419d5527a0e473a2c6dc69", "url": "https://github.com/checkstyle/checkstyle/commit/73deaaa0aedca7faa8419d5527a0e473a2c6dc69", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-07-08T14:57:44Z", "type": "forcePushed"}, {"oid": "d7bc777d9d5052ffa5ad46615d801f58f7fe8741", "url": "https://github.com/checkstyle/checkstyle/commit/d7bc777d9d5052ffa5ad46615d801f58f7fe8741", "message": "Issue #8023: Update grammar for initial record support", "committedDate": "2020-07-08T15:10:56Z", "type": "commit"}, {"oid": "153d9692d929a3b3a58e45612d6e86bba57c9779", "url": "https://github.com/checkstyle/checkstyle/commit/153d9692d929a3b3a58e45612d6e86bba57c9779", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-07-08T15:10:56Z", "type": "commit"}, {"oid": "153d9692d929a3b3a58e45612d6e86bba57c9779", "url": "https://github.com/checkstyle/checkstyle/commit/153d9692d929a3b3a58e45612d6e86bba57c9779", "message": "minor: lower coverage minimum for GeneratedJavaRecognizer.java (#8023)", "committedDate": "2020-07-08T15:10:56Z", "type": "forcePushed"}]}