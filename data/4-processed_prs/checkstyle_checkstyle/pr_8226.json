{"pr_number": 8226, "pr_title": "Issue #7892: add empty .ci-temp validation for travis", "pr_createdAt": "2020-05-05T05:14:42Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8226", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjA2Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r426216067", "bodyText": "For some reason I feel that this should be done ones, at post script actions, the same as we do for git status", "author": "romani", "createdAt": "2020-05-17T04:30:41Z", "path": ".ci/travis/travis.sh", "diffHunk": "@@ -253,6 +266,10 @@ no-error-test-sbe)\n     \"s/'com.puppycrawl.tools:checkstyle:.*'/'com.puppycrawl.tools:checkstyle:$CS_POM_VERSION'/\" \\\n     build.gradle\n   ./gradlew build --stacktrace\n+  cd ..\n+  removeFolderWithProtectedFiles simple-binary-encoding\n+  cd ..\n+  validateTempDirectoryEmpty", "originalCommit": "e0523c2d7fe42629eea87f3aa92a79dc741e0c6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjIyMA==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r426216220", "bodyText": "See #7892 (comment)", "author": "nmancus1", "createdAt": "2020-05-17T04:33:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjA2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMxMzI3OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r426313278", "bodyText": "this does not explain this ...\nTravis has \n  \n    \n      checkstyle/.travis.yml\n    \n    \n        Lines 358 to 361\n      in\n      11baaf2\n    \n    \n    \n    \n\n        \n          \n           after_success: \n        \n\n        \n          \n             - | \n        \n\n        \n          \n               set -e \n        \n\n        \n          \n               if [[ -n $CMD_AFTER_SUCCESS \n        \n    \n  \n\n\nif you put this function here ... it will be good.", "author": "romani", "createdAt": "2020-05-17T22:44:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjA2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyNzkxOA==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r426327918", "bodyText": "It is done.", "author": "nmancus1", "createdAt": "2020-05-18T01:06:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNjA2Nw=="}], "type": "inlineReview"}, {"oid": "b2a197dbc7fcc002a9b574f880e07121833d97f9", "url": "https://github.com/checkstyle/checkstyle/commit/b2a197dbc7fcc002a9b574f880e07121833d97f9", "message": "Issue #7892: Add validation for empty .ci-temp folder after CI runs# Please enter the commit message for your changes. Lines starting", "committedDate": "2020-05-18T01:06:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI5NjkwMA==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r427296900", "bodyText": "fix indentation, it should be same as fail", "author": "romani", "createdAt": "2020-05-19T13:21:51Z", "path": ".travis.yml", "diffHunk": "@@ -396,3 +396,15 @@ after_success:\n         echo \"deploy to maven snapshot repository is finished\";\n     fi\n     sleep 5s\n+  - |\n+    fail=0\n+      if [ -z \"$(ls -A .ci-temp)\" ]; then", "originalCommit": "b2a197dbc7fcc002a9b574f880e07121833d97f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMxMjA1MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r427312051", "bodyText": "Fixed.", "author": "nmancus1", "createdAt": "2020-05-19T13:42:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI5NjkwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI5ODUxMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r427298511", "bodyText": "please move this to separate commit, as it is not related to .ci-temp commit.", "author": "romani", "createdAt": "2020-05-19T13:24:01Z", "path": ".ci/travis/travis.sh", "diffHunk": "@@ -288,8 +292,10 @@ no-exception-test-guava)\n   mvn -e clean install -Pno-validations\n   cd .ci-temp/contribution/checkstyle-tester\n   export MAVEN_OPTS=\"-Xmx2048m\"\n-  groovy ./launch.groovy --listOfProjects projects-to-test-on.properties\n+  groovy ./launch.groovy --listOfProjects projects-to-test-on.properties \\", "originalCommit": "b2a197dbc7fcc002a9b574f880e07121833d97f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMxMTc5NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r427311795", "bodyText": "Done.", "author": "nmancus1", "createdAt": "2020-05-19T13:42:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI5ODUxMQ=="}], "type": "inlineReview"}, {"oid": "40c6b9c4ac11565f01609e7893faec2fed56549c", "url": "https://github.com/checkstyle/checkstyle/commit/40c6b9c4ac11565f01609e7893faec2fed56549c", "message": "minor: fix bad line break", "committedDate": "2020-05-19T13:40:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0MTQ4OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r427341488", "bodyText": "we need to sleep before exit.\nTo let output successfully flushed in log file before container closure (base on experience, command before exit usually excluded from logs). I always wanted to find time to report this to Travis or find existing issue on this, as it might have already more elegant solution. If you have time please investigate this.", "author": "romani", "createdAt": "2020-05-19T14:22:40Z", "path": ".travis.yml", "diffHunk": "@@ -396,3 +396,15 @@ after_success:\n         echo \"deploy to maven snapshot repository is finished\";\n     fi\n     sleep 5s\n+  - |\n+    fail=0\n+    if [ -z \"$(ls -A .ci-temp)\" ]; then\n+        echo \"Empty .ci-temp/ validation did not find any warnings.\"\n+    else\n+        echo \"Directory .ci-temp/ is not empty. Verification failed.\"\n+        echo \"Contents of .ci-temp/:\"\n+        fail=1\n+    fi\n+    ls -A .ci-temp --color=auto\n+    exit $fail\n+    sleep 5s", "originalCommit": "40c6b9c4ac11565f01609e7893faec2fed56549c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM2Njc0OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r427366749", "bodyText": "Ok! I didn't know why all the sleeps were in there, I just figured it was for appearance/ human readability.  Fixed.", "author": "nmancus1", "createdAt": "2020-05-19T14:53:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0MTQ4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM3MjYzNA==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r427372634", "bodyText": "Do you notice this issue only when nonzero exit status occurs, or always?  Also, I didn't use set -e, should I update to include set -e option?", "author": "nmancus1", "createdAt": "2020-05-19T15:00:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0MTQ4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM3NDk2OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r427374969", "bodyText": "Please add set -e it is always good to fail quick in CI even on minors. It is much better than miss leak of violations or errors.", "author": "romani", "createdAt": "2020-05-19T15:03:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0MTQ4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyNDU3MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8226#discussion_r427724570", "bodyText": "@romani This looks like what you're describing: https://travis-ci.community/t/log-are-truncated-when-my-script-exits-abnormally/5878/4 Note that the OP is stating that this happens when script exits normally or with error.", "author": "nmancus1", "createdAt": "2020-05-20T03:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0MTQ4OA=="}], "type": "inlineReview"}, {"oid": "05250ead75a2dc4e507f17292c294645ecfd0084", "url": "https://github.com/checkstyle/checkstyle/commit/05250ead75a2dc4e507f17292c294645ecfd0084", "message": "minor: fix bad line break", "committedDate": "2020-05-19T14:52:35Z", "type": "forcePushed"}, {"oid": "7fc5fc42499b8a6872ceed78e21e8615f7ed6b61", "url": "https://github.com/checkstyle/checkstyle/commit/7fc5fc42499b8a6872ceed78e21e8615f7ed6b61", "message": "minor: fix bad line break", "committedDate": "2020-05-19T15:09:51Z", "type": "forcePushed"}, {"oid": "71b6dd3d8ed1ecfa51ecdfc1334b6c4f7dd9fa6b", "url": "https://github.com/checkstyle/checkstyle/commit/71b6dd3d8ed1ecfa51ecdfc1334b6c4f7dd9fa6b", "message": "minor: fix bad line break", "committedDate": "2020-05-19T17:32:16Z", "type": "forcePushed"}, {"oid": "4e212543eb03f7404a27eab33696b6bb684a2d4e", "url": "https://github.com/checkstyle/checkstyle/commit/4e212543eb03f7404a27eab33696b6bb684a2d4e", "message": "minor: fix bad line break", "committedDate": "2020-05-19T18:06:27Z", "type": "forcePushed"}, {"oid": "aebd8e880ab80806a73e25b19732af65db24c1a5", "url": "https://github.com/checkstyle/checkstyle/commit/aebd8e880ab80806a73e25b19732af65db24c1a5", "message": "minor: fix bad line break", "committedDate": "2020-05-24T15:34:53Z", "type": "forcePushed"}, {"oid": "0f06ef16b86583aec3d1294b68d1860c04b1257f", "url": "https://github.com/checkstyle/checkstyle/commit/0f06ef16b86583aec3d1294b68d1860c04b1257f", "message": "minor: fix bad line break", "committedDate": "2020-05-24T22:52:43Z", "type": "forcePushed"}, {"oid": "e54ef7cf91b1a3e4e02b7eeb382a629fcd8e255d", "url": "https://github.com/checkstyle/checkstyle/commit/e54ef7cf91b1a3e4e02b7eeb382a629fcd8e255d", "message": "Issue #7892: Add validation for empty .ci-temp folder after CI runs# Please enter the commit message for your changes. Lines starting", "committedDate": "2020-05-25T00:33:32Z", "type": "commit"}, {"oid": "5783c1a5d3b7c7a7b4a35d496a56162fce4dc63a", "url": "https://github.com/checkstyle/checkstyle/commit/5783c1a5d3b7c7a7b4a35d496a56162fce4dc63a", "message": "minor: fix bad line break", "committedDate": "2020-05-25T00:33:32Z", "type": "commit"}, {"oid": "5783c1a5d3b7c7a7b4a35d496a56162fce4dc63a", "url": "https://github.com/checkstyle/checkstyle/commit/5783c1a5d3b7c7a7b4a35d496a56162fce4dc63a", "message": "minor: fix bad line break", "committedDate": "2020-05-25T00:33:32Z", "type": "forcePushed"}]}