{"pr_number": 13432, "pr_title": "[BEAM-11355] Fix topological ordering of pipeline_from_stages after sort_stages", "pr_createdAt": "2020-11-26T01:45:40Z", "pr_url": "https://github.com/apache/beam/pull/13432", "timeline": [{"oid": "219217f447a11e03043a58f4895149c9c66368f2", "url": "https://github.com/apache/beam/commit/219217f447a11e03043a58f4895149c9c66368f2", "message": "Fix topological ordering", "committedDate": "2020-11-26T01:20:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc5ODY2NQ==", "url": "https://github.com/apache/beam/pull/13432#discussion_r532798665", "bodyText": "s/lsat/last/", "author": "robertwb", "createdAt": "2020-11-30T18:10:32Z", "path": "sdks/python/apache_beam/runners/portability/fn_api_runner/translations.py", "diffHunk": "@@ -557,8 +557,13 @@ def add_parent(child, parent):\n             pipeline_proto.components.transforms[parent])\n         copy_output_pcollections(components.transforms[parent])\n         del components.transforms[parent].subtransforms[:]\n-        add_parent(parent, parents.get(parent))\n+      # Ensure that child is the lsat item in the parent's subtransforms.", "originalCommit": "219217f447a11e03043a58f4895149c9c66368f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5ODI2Nw==", "url": "https://github.com/apache/beam/pull/13432#discussion_r532998267", "bodyText": "Thanks for catching; fixed.", "author": "yifanmai", "createdAt": "2020-12-01T00:44:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc5ODY2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc5OTcyMw==", "url": "https://github.com/apache/beam/pull/13432#discussion_r532799723", "bodyText": "Isn't sort_stages called before this? Or did you mean this is required to maintain the topolicial order from sort_stages?", "author": "robertwb", "createdAt": "2020-11-30T18:12:16Z", "path": "sdks/python/apache_beam/runners/portability/fn_api_runner/translations.py", "diffHunk": "@@ -557,8 +557,13 @@ def add_parent(child, parent):\n             pipeline_proto.components.transforms[parent])\n         copy_output_pcollections(components.transforms[parent])\n         del components.transforms[parent].subtransforms[:]\n-        add_parent(parent, parents.get(parent))\n+      # Ensure that child is the lsat item in the parent's subtransforms.\n+      # This is required to maintain topological order with sort_stages.", "originalCommit": "219217f447a11e03043a58f4895149c9c66368f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5ODgzNw==", "url": "https://github.com/apache/beam/pull/13432#discussion_r532998837", "bodyText": "Rephrased to make this clearer (topological order is maintained only if sort_stages was previously called).", "author": "yifanmai", "createdAt": "2020-12-01T00:46:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc5OTcyMw=="}], "type": "inlineReview"}, {"oid": "4234bad11b7dfd00467722b5e90e57aa099092e6", "url": "https://github.com/apache/beam/commit/4234bad11b7dfd00467722b5e90e57aa099092e6", "message": "Review fixes", "committedDate": "2020-12-01T00:44:28Z", "type": "commit"}, {"oid": "fafc2260ed9fa63e4ccdafd5407757329fa860e2", "url": "https://github.com/apache/beam/commit/fafc2260ed9fa63e4ccdafd5407757329fa860e2", "message": "Fix", "committedDate": "2020-12-01T00:46:17Z", "type": "commit"}]}