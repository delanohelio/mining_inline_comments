{"pr_number": 12209, "pr_title": "[BEAM-9629] Fix several connection leak issues.", "pr_createdAt": "2020-07-09T19:00:34Z", "pr_url": "https://github.com/apache/beam/pull/12209", "timeline": [{"oid": "136e9f78539f9f4cd2f3db50986400a194a77481", "url": "https://github.com/apache/beam/commit/136e9f78539f9f4cd2f3db50986400a194a77481", "message": "[BEAM-9629] Fix several connection leak issues.\n\n* Make the default max connections to be unlimited. This mirrors the 2.17 and earlier behavior since we used to create one DataSource per execution thread (and hence one connection).\n* Move connection fetching to @ProcessElement to not hold a connection for empty bundles.\n* Make sure that finalize() closes the connection so that it is returned to the pool if the bundle fails.", "committedDate": "2020-07-09T18:58:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0MDczNA==", "url": "https://github.com/apache/beam/pull/12209#discussion_r452940734", "bodyText": "Since this is a recurrent issue for users I am wondering if It would probably be good to add a snippet of how to achieve this (maybe in a subsequent PR since it is not exactly related).", "author": "iemejia", "createdAt": "2020-07-10T16:14:59Z", "path": "sdks/java/io/jdbc/src/main/java/org/apache/beam/sdk/io/jdbc/JdbcIO.java", "diffHunk": "@@ -147,10 +147,10 @@\n  * );\n  * }</pre>\n  *\n- * By default, the provided function instantiates a DataSource per execution thread. In some\n- * circumstances, such as DataSources that have a pool of connections, this can quickly overwhelm\n- * the database by requesting too many connections. In that case you should make the DataSource a\n- * static singleton so it gets instantiated only once per JVM.\n+ * <p>By default, the provided function requests a DataSource per execution thread. In some\n+ * circumstances this can quickly overwhelm the database by requesting too many connections. In that\n+ * case you should look into sharing a single instance of a {@link PoolingDataSource} across all the\n+ * execution threads.", "originalCommit": "136e9f78539f9f4cd2f3db50986400a194a77481", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc0NTgwNA==", "url": "https://github.com/apache/beam/pull/12209#discussion_r453745804", "bodyText": "Done in #12220", "author": "lukecwik", "createdAt": "2020-07-13T15:42:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0MDczNA=="}], "type": "inlineReview"}]}