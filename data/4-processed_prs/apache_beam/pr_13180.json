{"pr_number": 13180, "pr_title": " BEAM-9094 Configure S3 client for IO to s3 compatible object stores", "pr_createdAt": "2020-10-23T18:47:00Z", "pr_url": "https://github.com/apache/beam/pull/13180", "timeline": [{"oid": "933a8c57c1a37090271c2d7540f324dc882c693e", "url": "https://github.com/apache/beam/commit/933a8c57c1a37090271c2d7540f324dc882c693e", "message": "add s3 options", "committedDate": "2020-10-23T19:03:12Z", "type": "commit"}, {"oid": "21e4763ac4f5818790ed05374dc090ee79156504", "url": "https://github.com/apache/beam/commit/21e4763ac4f5818790ed05374dc090ee79156504", "message": "pass s3 options through to boto3_client", "committedDate": "2020-10-23T19:03:20Z", "type": "commit"}, {"oid": "27a856f189d58dba5e20913941ca96787a81d959", "url": "https://github.com/apache/beam/commit/27a856f189d58dba5e20913941ca96787a81d959", "message": "pass pipeline options through S3IO", "committedDate": "2020-10-23T19:03:23Z", "type": "commit"}, {"oid": "fbc6dd638cddf61677dd4dcf1f21a35fb767eda4", "url": "https://github.com/apache/beam/commit/fbc6dd638cddf61677dd4dcf1f21a35fb767eda4", "message": "consolidate naming convention without prefix", "committedDate": "2020-10-23T19:03:31Z", "type": "commit"}, {"oid": "fbc6dd638cddf61677dd4dcf1f21a35fb767eda4", "url": "https://github.com/apache/beam/commit/fbc6dd638cddf61677dd4dcf1f21a35fb767eda4", "message": "consolidate naming convention without prefix", "committedDate": "2020-10-23T19:03:31Z", "type": "forcePushed"}, {"oid": "584db8ba8813917747feb967ba039d503870b1bb", "url": "https://github.com/apache/beam/commit/584db8ba8813917747feb967ba039d503870b1bb", "message": "document change in CHANGES.md", "committedDate": "2020-10-23T19:06:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzMjk4Mw==", "url": "https://github.com/apache/beam/pull/13180#discussion_r511132983", "bodyText": "You are correct that it's desirable to use a sort of namespace prefix. Perhaps --aws_ or --aws_s3_. What do you think?\nYou must know more than me about s3 and AWS - I wonder if aws_session_token, aws_secret_access_key, aws_access_key_id  in this context are specific for s3, or if they provide some sort of AWS-wide authentication?\nIf they're s3-specific, then maybe we should namespace them as aws_s3? Let me know what you think.", "author": "pabloem", "createdAt": "2020-10-23T20:10:25Z", "path": "sdks/python/apache_beam/options/pipeline_options.py", "diffHunk": "@@ -1321,3 +1320,39 @@ def augment_options(cls, options):\n       for name, value in override.items():\n         setattr(options, name, value)\n     return options\n+\n+\n+class S3Options(PipelineOptions):\n+  @classmethod\n+  def _add_argparse_args(cls, parser):\n+    # These options are passed to the S3 IO Client\n+    parser.add_argument(\n+        '--aws_access_key_id',\n+        default=None,\n+        help='The secret key to use when creating the s3 client.')\n+    parser.add_argument(\n+        '--aws_secret_access_key',\n+        default=None,\n+        help='The secret key to use when creating the s3 client.')\n+    parser.add_argument(\n+        '--aws_session_token',\n+        default=None,\n+        help='The session token to use when creating the s3 client.')\n+    parser.add_argument(\n+        '--endpoint_url',\n+        default=None,\n+        help='The complete URL to use for the constructed s3 client.')\n+    parser.add_argument(\n+        '--region_name',\n+        default=None,\n+        help='The name of the region associated with the client.')\n+    parser.add_argument(\n+        '--api_version', default=None, help='The API version to use.')\n+    parser.add_argument(\n+        '--verify',\n+        default=None,\n+        help='Whether or not to verify SSL certificates.')\n+    parser.add_argument(\n+        '--use_ssl',\n+        default=True,\n+        help='Whether or not to use SSL. By default, SSL is used.')", "originalCommit": "584db8ba8813917747feb967ba039d503870b1bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzNDkxOA==", "url": "https://github.com/apache/beam/pull/13180#discussion_r511134918", "bodyText": "+1. Please do not use endpoint_url, region_name, api_version, verify, use_ssl and so on without a prefix.", "author": "aaltay", "createdAt": "2020-10-23T20:15:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzMjk4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1MDA5Nw==", "url": "https://github.com/apache/beam/pull/13180#discussion_r511150097", "bodyText": "Fair enough. I've moved them all to use the same s3 prefix which I think makes sense given they are collected under the S3Options class. @pabloem I believe the access keys can also be used for other AWS services, although I've never actually used them. I think it makes sense to consolidate the more generic aws options with the s3 options together for now given that this is the only use case at the moment. If there is another AWS service added in the future it could make sense then to split them up.", "author": "dandy10", "createdAt": "2020-10-23T20:52:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzMjk4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ5NzQxNg==", "url": "https://github.com/apache/beam/pull/13180#discussion_r511497416", "bodyText": "Thanks! That makes sense to me. Can you fix the broken unittests? Other than that, the change looks great (and it's very welcome, as we'd been needing it).", "author": "pabloem", "createdAt": "2020-10-24T17:55:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzMjk4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ5ODQ0Mw==", "url": "https://github.com/apache/beam/pull/13180#discussion_r511498443", "bodyText": "Will do. I tried to have a look at the failing tests and can't figure out which ones have actually failed (the formatting is quite difficult to parse). Unfortunately I don't have access to windows to run locally. The same pattern of failures seems to be affecting #13187 which is just a comment change, so perhaps the failures are unrelated?", "author": "dandy10", "createdAt": "2020-10-24T18:06:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzMjk4Mw=="}], "type": "inlineReview"}, {"oid": "594379abbc1e7beb66d8001f68a43edd5a50379e", "url": "https://github.com/apache/beam/commit/594379abbc1e7beb66d8001f68a43edd5a50379e", "message": "consolidate on s3 prefix for pipeline options", "committedDate": "2020-10-23T20:53:27Z", "type": "commit"}, {"oid": "3f07e5d073e8589111e24900ec710cc1242ba828", "url": "https://github.com/apache/beam/commit/3f07e5d073e8589111e24900ec710cc1242ba828", "message": "do not shadow imported module name", "committedDate": "2020-10-24T09:12:34Z", "type": "commit"}, {"oid": "c3e991adf4619c253121c1ebc5aa1ecea6b5d4fd", "url": "https://github.com/apache/beam/commit/c3e991adf4619c253121c1ebc5aa1ecea6b5d4fd", "message": "reinstantiate S3IO for each operation", "committedDate": "2020-10-24T09:12:56Z", "type": "commit"}, {"oid": "ef99f9e858b0504b0cd887fc3346480f40ca6efa", "url": "https://github.com/apache/beam/commit/ef99f9e858b0504b0cd887fc3346480f40ca6efa", "message": "undo unintentional format changes", "committedDate": "2020-10-24T09:18:03Z", "type": "commit"}, {"oid": "b8544d068095fb03abe6477b2c093c5643d805f0", "url": "https://github.com/apache/beam/commit/b8544d068095fb03abe6477b2c093c5643d805f0", "message": "update tests with new constructor args", "committedDate": "2020-10-24T11:27:00Z", "type": "commit"}, {"oid": "4786646dd778bb39a0096c86a90ca1352dabacbf", "url": "https://github.com/apache/beam/commit/4786646dd778bb39a0096c86a90ca1352dabacbf", "message": "format fix", "committedDate": "2020-10-24T11:39:32Z", "type": "commit"}, {"oid": "6fc8ffdb1b182c6e30064e2cbcb4f551637d8c6a", "url": "https://github.com/apache/beam/commit/6fc8ffdb1b182c6e30064e2cbcb4f551637d8c6a", "message": "fix naming error", "committedDate": "2020-10-25T14:02:03Z", "type": "commit"}, {"oid": "7f88b2aa60752556bea862955e2bf52f4ec8c64e", "url": "https://github.com/apache/beam/commit/7f88b2aa60752556bea862955e2bf52f4ec8c64e", "message": "remove duplicated property access", "committedDate": "2020-10-25T21:03:08Z", "type": "commit"}, {"oid": "25d7daf91a80da6cf568b803d1cc0a8284c1338f", "url": "https://github.com/apache/beam/commit/25d7daf91a80da6cf568b803d1cc0a8284c1338f", "message": "use action for boolean flag", "committedDate": "2020-10-27T12:14:14Z", "type": "commit"}]}