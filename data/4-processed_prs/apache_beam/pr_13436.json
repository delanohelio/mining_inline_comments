{"pr_number": 13436, "pr_title": "[BEAM-11075] Go SDK SideInput load tests", "pr_createdAt": "2020-11-30T11:12:55Z", "pr_url": "https://github.com/apache/beam/pull/13436", "timeline": [{"oid": "dcdea658645b80c47c47c27e4d02cb9f375fa134", "url": "https://github.com/apache/beam/commit/dcdea658645b80c47c47c27e4d02cb9f375fa134", "message": "sideinput go", "committedDate": "2020-11-23T07:51:13Z", "type": "commit"}, {"oid": "2dbaed0861ef4419e1c0a2ab52cf92ba7c7c582e", "url": "https://github.com/apache/beam/commit/2dbaed0861ef4419e1c0a2ab52cf92ba7c7c582e", "message": "wip: sideinput try to change collection to iterable", "committedDate": "2020-11-23T08:40:37Z", "type": "commit"}, {"oid": "029410062d018e8ed9d9369165676a107cd7f74b", "url": "https://github.com/apache/beam/commit/029410062d018e8ed9d9369165676a107cd7f74b", "message": "sideinput", "committedDate": "2020-11-23T10:46:55Z", "type": "commit"}, {"oid": "56b5cde721cfe02f623c6bed2d63293b79bf1ee2", "url": "https://github.com/apache/beam/commit/56b5cde721cfe02f623c6bed2d63293b79bf1ee2", "message": "error", "committedDate": "2020-11-26T07:55:13Z", "type": "commit"}, {"oid": "bf840742e77dc141d8218cea4b419221ee81a4ab", "url": "https://github.com/apache/beam/commit/bf840742e77dc141d8218cea4b419221ee81a4ab", "message": "Merge branch 'master' into go_sdk_sideinput", "committedDate": "2020-11-26T08:10:05Z", "type": "commit"}, {"oid": "9a803f76d825322aa9164708ccb6f4ea4baaa1a9", "url": "https://github.com/apache/beam/commit/9a803f76d825322aa9164708ccb6f4ea4baaa1a9", "message": "look for kv type", "committedDate": "2020-11-26T08:59:19Z", "type": "commit"}, {"oid": "fd4e053f57082380df0427a2a4d96ec21dd82c19", "url": "https://github.com/apache/beam/commit/fd4e053f57082380df0427a2a4d96ec21dd82c19", "message": "elementsToAcccess from numElements", "committedDate": "2020-11-26T09:59:04Z", "type": "commit"}, {"oid": "0b568ceab46d871b67101f387346c426117bf711", "url": "https://github.com/apache/beam/commit/0b568ceab46d871b67101f387346c426117bf711", "message": "sideinput with array works", "committedDate": "2020-11-26T10:11:21Z", "type": "commit"}, {"oid": "b8ac0796fe3ce9ccb4739899a4f7dd8dfc455971", "url": "https://github.com/apache/beam/commit/b8ac0796fe3ce9ccb4739899a4f7dd8dfc455971", "message": "sideinput with array works", "committedDate": "2020-11-26T10:33:36Z", "type": "commit"}, {"oid": "5534379491dd2c5ef203839d8d37a293ff45c42c", "url": "https://github.com/apache/beam/commit/5534379491dd2c5ef203839d8d37a293ff45c42c", "message": "sideinput iterator", "committedDate": "2020-11-27T07:35:48Z", "type": "commit"}, {"oid": "014df350b6f9daf4e4d549eceaff51ac01c0ac03", "url": "https://github.com/apache/beam/commit/014df350b6f9daf4e4d549eceaff51ac01c0ac03", "message": "sideinput v3", "committedDate": "2020-11-29T15:17:16Z", "type": "commit"}, {"oid": "40857ca524bfa399532dac51cc389e7c0b5b3ec0", "url": "https://github.com/apache/beam/commit/40857ca524bfa399532dac51cc389e7c0b5b3ec0", "message": "go sideinput", "committedDate": "2020-11-29T16:27:33Z", "type": "commit"}, {"oid": "e074d297f9fcf3d7b466fb378fb671b5618b235d", "url": "https://github.com/apache/beam/commit/e074d297f9fcf3d7b466fb378fb671b5618b235d", "message": "i++", "committedDate": "2020-11-30T09:49:54Z", "type": "commit"}, {"oid": "0e5b680f3a09b4ce0a4f01fb97d2099e6f1cef81", "url": "https://github.com/apache/beam/commit/0e5b680f3a09b4ce0a4f01fb97d2099e6f1cef81", "message": "add load test .groovy and build sideinput in build.gradle", "committedDate": "2020-11-30T11:08:34Z", "type": "commit"}, {"oid": "3e77516f1fdf942cd1bc58e1049e781af75ac05c", "url": "https://github.com/apache/beam/commit/3e77516f1fdf942cd1bc58e1049e781af75ac05c", "message": "remove .list from sideinput loadtest groovy", "committedDate": "2020-11-30T11:17:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzNTk5Nw==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532535997", "bodyText": "Why ${now}? We would quickly end up with tons of different measurements in the database with only one element.", "author": "kamilwu", "createdAt": "2020-11-30T11:43:06Z", "path": ".test-infra/jenkins/job_LoadTests_SideInput_Flink_Go.groovy", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import CommonTestProperties\n+import CommonJobProperties as commonJobProperties\n+import LoadTestsBuilder as loadTestsBuilder\n+import PhraseTriggeringPostCommitBuilder\n+import InfluxDBCredentialsHelper\n+\n+def now = new Date().format(\"MMddHHmmss\", TimeZone.getTimeZone('UTC'))\n+\n+def fromTemplate = { mode, name, id, testSpecificOptions ->\n+  [\n+    title          : \"SideInput Go Load test: ${name}\",\n+    test           : 'sideinput',\n+    runner         : CommonTestProperties.Runner.FLINK,\n+    pipelineOptions: [\n+      job_name           : \"load-tests-go-flink-${mode}-sideinput-${id}-${now}\",\n+      influx_namespace   : 'flink',\n+      influx_measurement : \"go_${mode}_sideinput_${id}_${now}\",", "originalCommit": "3e77516f1fdf942cd1bc58e1049e781af75ac05c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU2MzM1OA==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532563358", "bodyText": "Thank you, in the last commit I removed  ${now} from influx_measurement.", "author": "tszerszen", "createdAt": "2020-11-30T12:32:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzNTk5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzNjkyNg==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532536926", "bodyText": "Please do not provide any default values for this parameter, as it should be required.", "author": "kamilwu", "createdAt": "2020-11-30T11:44:59Z", "path": "sdks/go/test/load/sideinput/sideinput.go", "diffHunk": "@@ -0,0 +1,82 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package main\n+\n+import (\n+\t\"context\"\n+\t\"flag\"\n+\n+\t\"github.com/apache/beam/sdks/go/pkg/beam\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/io/synthetic\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/log\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/x/beamx\"\n+\t\"github.com/apache/beam/sdks/go/test/load\"\n+)\n+\n+var (\n+\taccessPercentage = flag.Int(\n+\t\t\"access_percentage\",\n+\t\t100,\n+\t\t\"Specifies the percentage of elements in the side input to be accessed.\")\n+\tsyntheticSourceConfig = flag.String(\n+\t\t\"input_options\",\n+\t\t\"{\"+", "originalCommit": "3e77516f1fdf942cd1bc58e1049e781af75ac05c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU2NDMxMg==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532564312", "bodyText": "I removed default value for flag syntheticSourceConfig.", "author": "tszerszen", "createdAt": "2020-11-30T12:34:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzNjkyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU0MDY5MA==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532540690", "bodyText": "beamx.Run -> beamx.RunWithMetrics. Please also add the code for sending results to the database.", "author": "kamilwu", "createdAt": "2020-11-30T11:51:33Z", "path": "sdks/go/test/load/sideinput/sideinput.go", "diffHunk": "@@ -0,0 +1,82 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package main\n+\n+import (\n+\t\"context\"\n+\t\"flag\"\n+\n+\t\"github.com/apache/beam/sdks/go/pkg/beam\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/io/synthetic\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/log\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/x/beamx\"\n+\t\"github.com/apache/beam/sdks/go/test/load\"\n+)\n+\n+var (\n+\taccessPercentage = flag.Int(\n+\t\t\"access_percentage\",\n+\t\t100,\n+\t\t\"Specifies the percentage of elements in the side input to be accessed.\")\n+\tsyntheticSourceConfig = flag.String(\n+\t\t\"input_options\",\n+\t\t\"{\"+\n+\t\t\t\"\\\"num_records\\\": 300, \"+\n+\t\t\t\"\\\"key_size\\\": 5, \"+\n+\t\t\t\"\\\"value_size\\\": 15}\",\n+\t\t\"A JSON object that describes the configuration for synthetic source\")\n+)\n+\n+func parseSyntheticConfig() synthetic.SourceConfig {\n+\tif *syntheticSourceConfig == \"\" {\n+\t\tpanic(\"--input_options not provided\")\n+\t} else {\n+\t\tencoded := []byte(*syntheticSourceConfig)\n+\t\treturn synthetic.DefaultSourceConfig().BuildFromJSON(encoded)\n+\t}\n+}\n+\n+func main() {\n+\tflag.Parse()\n+\tbeam.Init()\n+\tctx := context.Background()\n+\tp, s := beam.NewPipelineWithRoot()\n+\n+\tsyntheticConfig := parseSyntheticConfig()\n+\telementsToAccess := syntheticConfig.NumElements * *accessPercentage / 100\n+\n+\tsrc := synthetic.SourceSingle(s, syntheticConfig)\n+\tsrc = beam.ParDo(s, &load.RuntimeMonitor{}, src)\n+\n+\tsrc = beam.ParDo(s, func(_ []byte, values func(*[]byte, *[]byte) bool, emit func([]byte, []byte)) {\n+\t\tvar key []byte\n+\t\tvar value []byte\n+\t\ti := 0\n+\t\tfor values(&key, &value) {\n+\t\t\tif i == elementsToAccess {\n+\t\t\t\tbreak\n+\t\t\t}\n+\t\t\temit(key, value)\n+\t\t\ti++\n+\t\t}\n+\t}, beam.Impulse(s), beam.SideInput{Input: src})\n+\n+\tbeam.ParDo(s, &load.RuntimeMonitor{}, src)\n+\n+\tif err := beamx.Run(ctx, p); err != nil {", "originalCommit": "3e77516f1fdf942cd1bc58e1049e781af75ac05c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU2NDI2Mg==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532564262", "bodyText": "Ok, now it's run with beamx.RunWithMetrics.", "author": "tszerszen", "createdAt": "2020-11-30T12:34:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU0MDY5MA=="}], "type": "inlineReview"}, {"oid": "437f63e6432073486f95c79e5f9d3018d64b4753", "url": "https://github.com/apache/beam/commit/437f63e6432073486f95c79e5f9d3018d64b4753", "message": "dont use templates in loadTestJob", "committedDate": "2020-11-30T12:16:05Z", "type": "commit"}, {"oid": "e2b8d7dc835c5bdbf6f16eb3cd63e385d2349701", "url": "https://github.com/apache/beam/commit/e2b8d7dc835c5bdbf6f16eb3cd63e385d2349701", "message": "fix: run with metrics, remove now from .groovy and remove default synthetic source config", "committedDate": "2020-11-30T12:30:47Z", "type": "commit"}, {"oid": "70d5d9be738ea2b9d1fdec17485605b32bd715a0", "url": "https://github.com/apache/beam/commit/70d5d9be738ea2b9d1fdec17485605b32bd715a0", "message": "Merge branch 'master' into go_sdk_sideinput", "committedDate": "2020-11-30T12:59:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU4MjUxNw==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532582517", "bodyText": "This test is exactly the same as one below. Did you miss access_elements?\nEDIT: access_percentage", "author": "kamilwu", "createdAt": "2020-11-30T13:06:27Z", "path": ".test-infra/jenkins/job_LoadTests_SideInput_Flink_Go.groovy", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import CommonTestProperties\n+import CommonJobProperties as commonJobProperties\n+import LoadTestsBuilder as loadTestsBuilder\n+import PhraseTriggeringPostCommitBuilder\n+import InfluxDBCredentialsHelper\n+\n+def now = new Date().format(\"MMddHHmmss\", TimeZone.getTimeZone('UTC'))\n+\n+def batchScenarios = {\n+  [\n+    [\n+      title          : 'SideInput Go Load test: 10gb-1kb-10workers-1window-first-iterable',\n+      test           : 'sideinput',\n+      runner         : CommonTestProperties.Runner.FLINK,\n+      pipelineOptions: [\n+        job_name           : \"load-tests-go-flink-batch-sideinput-1-${now}\",\n+        influx_namespace   : 'flink',\n+        influx_measurement : 'go_batch_sideinput_1',\n+        input_options      : '\\'{' +\n+        '\"num_records\": 10000000,' +\n+        '\"key_size\": 100,' +\n+        '\"value_size\": 900}\\'',\n+        parallelism        : 10,\n+        endpoint           : 'localhost:8099',\n+        environment_type   : 'DOCKER',\n+        environment_config : \"${DOCKER_CONTAINER_REGISTRY}/beam_go_sdk:latest\",", "originalCommit": "70d5d9be738ea2b9d1fdec17485605b32bd715a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU4OTA5NA==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532589094", "bodyText": "@kamilwu if you look at job_LoadTests_SideInput_Python.groovy there are two iterable tests. They are exactly the same with the exception of a name, here's the fragment of code:\n    [\n      name: '10gb-1kb-10workers-1window-first-iterable',\n      testSpecificOptions: [\n        input_options    : '\\'{' +\n        '\"num_records\": 10000000,' +\n        '\"key_size\": 100,' +\n        '\"value_size\": 900}\\'',\n        side_input_type  : 'iter',\n        access_percentage: 1,\n      ]\n    ],\n    [\n      name: '10gb-1kb-10workers-1window-iterable',\n      testSpecificOptions: [\n        input_options    : '\\'{' +\n        '\"num_records\": 10000000,' +\n        '\"key_size\": 100,' +\n        '\"value_size\": 900}\\'',\n        side_input_type  : 'iter',\n      ]\n    ],\nAnd default access_percentage is 1, and it's not defined in second test case.", "author": "tszerszen", "createdAt": "2020-11-30T13:17:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU4MjUxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU5MzM0NQ==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532593345", "bodyText": "@kamilwu  Sorry, you're right default access_percentage is 100, therefore first test should have access_percentage 1, and second one none, which means it gets the default 100. Fixed it.", "author": "tszerszen", "createdAt": "2020-11-30T13:24:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU4MjUxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU4NzMxNQ==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532587315", "bodyText": "You cannot use 1 here. This number is an ID that uniquely identifies the test. For side input tests:\n\n1 corresponds to the 1gb-1kb-10workers-1window-1key-percent-dict test\n2 corresponds to the 1gb-1kb-10workers-1window-99key-percent-dict test\nand so on and so forth. You can see a full set of side input tests here: https://github.com/apache/beam/blob/master/.test-infra/jenkins/job_LoadTests_SideInput_Python.groovy", "author": "kamilwu", "createdAt": "2020-11-30T13:14:41Z", "path": ".test-infra/jenkins/job_LoadTests_SideInput_Flink_Go.groovy", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import CommonTestProperties\n+import CommonJobProperties as commonJobProperties\n+import LoadTestsBuilder as loadTestsBuilder\n+import PhraseTriggeringPostCommitBuilder\n+import InfluxDBCredentialsHelper\n+\n+def now = new Date().format(\"MMddHHmmss\", TimeZone.getTimeZone('UTC'))\n+\n+def batchScenarios = {\n+  [\n+    [\n+      title          : 'SideInput Go Load test: 10gb-1kb-10workers-1window-first-iterable',\n+      test           : 'sideinput',\n+      runner         : CommonTestProperties.Runner.FLINK,\n+      pipelineOptions: [\n+        job_name           : \"load-tests-go-flink-batch-sideinput-1-${now}\",\n+        influx_namespace   : 'flink',\n+        influx_measurement : 'go_batch_sideinput_1',", "originalCommit": "70d5d9be738ea2b9d1fdec17485605b32bd715a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU5MDA1Mg==", "url": "https://github.com/apache/beam/pull/13436#discussion_r532590052", "bodyText": "Thank you, you're right. Just fixed it.", "author": "tszerszen", "createdAt": "2020-11-30T13:19:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU4NzMxNQ=="}], "type": "inlineReview"}, {"oid": "6e8c20ae8a9ddbe32a0287fda12ac09b9bcab841", "url": "https://github.com/apache/beam/commit/6e8c20ae8a9ddbe32a0287fda12ac09b9bcab841", "message": "change corresponding tests numbers", "committedDate": "2020-11-30T13:18:54Z", "type": "commit"}, {"oid": "54cedb599d8afbf7e81a290d1d4580ba3cea6fa4", "url": "https://github.com/apache/beam/commit/54cedb599d8afbf7e81a290d1d4580ba3cea6fa4", "message": "fix access_percentage in first test", "committedDate": "2020-11-30T13:23:23Z", "type": "commit"}, {"oid": "356a762f446f7d5b41f0f65a6c14ba0909a25f5d", "url": "https://github.com/apache/beam/commit/356a762f446f7d5b41f0f65a6c14ba0909a25f5d", "message": "add import import static LoadTestsBuilder.DOCKER_CONTAINER_REGISTRY", "committedDate": "2020-11-30T13:38:06Z", "type": "commit"}, {"oid": "ad7247b09879585036247b827b9d52a8b23d6a9a", "url": "https://github.com/apache/beam/commit/ad7247b09879585036247b827b9d52a8b23d6a9a", "message": "func must be registered", "committedDate": "2020-12-01T10:05:21Z", "type": "commit"}, {"oid": "feeb905c433054894c48b4bcb46c4a89cb7aba5b", "url": "https://github.com/apache/beam/commit/feeb905c433054894c48b4bcb46c4a89cb7aba5b", "message": "registerDoFn", "committedDate": "2020-12-01T12:18:45Z", "type": "commit"}, {"oid": "8debda23e867632bcf86ab57aed77189d3e28ca9", "url": "https://github.com/apache/beam/commit/8debda23e867632bcf86ab57aed77189d3e28ca9", "message": "registerDoFn", "committedDate": "2020-12-01T12:20:02Z", "type": "commit"}, {"oid": "376eaf92cf214c9d5d232ad93cd5da9908c52c41", "url": "https://github.com/apache/beam/commit/376eaf92cf214c9d5d232ad93cd5da9908c52c41", "message": "fix errors", "committedDate": "2020-12-01T14:06:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY2MzYyNQ==", "url": "https://github.com/apache/beam/pull/13436#discussion_r538663625", "bodyText": "This isn't the main problem, we're debugging, but Structural DoFn fields must be exported to get serialized properly.\neg. ElementsToAccess instead.", "author": "lostluck", "createdAt": "2020-12-08T17:55:31Z", "path": "sdks/go/test/load/sideinput/sideinput.go", "diffHunk": "@@ -0,0 +1,100 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package main\n+\n+import (\n+\t\"context\"\n+\t\"flag\"\n+\t\"reflect\"\n+\n+\t\"github.com/apache/beam/sdks/go/pkg/beam\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/io/synthetic\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/log\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/x/beamx\"\n+\t\"github.com/apache/beam/sdks/go/test/load\"\n+)\n+\n+func init() {\n+\tbeam.RegisterDoFn(reflect.TypeOf((*doFn)(nil)))\n+}\n+\n+var (\n+\taccessPercentage = flag.Int(\n+\t\t\"access_percentage\",\n+\t\t100,\n+\t\t\"Specifies the percentage of elements in the side input to be accessed.\")\n+\tsyntheticSourceConfig = flag.String(\n+\t\t\"input_options\",\n+\t\t\"\",\n+\t\t\"A JSON object that describes the configuration for synthetic source\")\n+)\n+\n+func parseSyntheticConfig() synthetic.SourceConfig {\n+\tif *syntheticSourceConfig == \"\" {\n+\t\tpanic(\"--input_options not provided\")\n+\t} else {\n+\t\tencoded := []byte(*syntheticSourceConfig)\n+\t\treturn synthetic.DefaultSourceConfig().BuildFromJSON(encoded)\n+\t}\n+}\n+\n+type doFn struct {\n+\telementsToAccess int", "originalCommit": "376eaf92cf214c9d5d232ad93cd5da9908c52c41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg3NjQxOQ==", "url": "https://github.com/apache/beam/pull/13436#discussion_r538876419", "bodyText": "Thank you, I changed the name to start with capital letter.", "author": "tszerszen", "createdAt": "2020-12-08T23:07:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY2MzYyNQ=="}], "type": "inlineReview"}, {"oid": "f89cce0562ba19369b28287bfd2cb77915be5eba", "url": "https://github.com/apache/beam/commit/f89cce0562ba19369b28287bfd2cb77915be5eba", "message": "make Structural DoFn field as exported", "committedDate": "2020-12-08T22:50:31Z", "type": "commit"}, {"oid": "27b5ec8c99cdf585a1f30ef7934bb419fddf143b", "url": "https://github.com/apache/beam/commit/27b5ec8c99cdf585a1f30ef7934bb419fddf143b", "message": "merge master into sideinput", "committedDate": "2020-12-08T23:14:03Z", "type": "commit"}, {"oid": "b95846e34f0be539f82cd9a81e201edcb0a9aad7", "url": "https://github.com/apache/beam/commit/b95846e34f0be539f82cd9a81e201edcb0a9aad7", "message": "skip 10gb sideinput load tests add 2gb sideinput load test", "committedDate": "2020-12-09T10:46:26Z", "type": "commit"}, {"oid": "8f0eec40f566cf999645e2db477ef1bb34eecf11", "url": "https://github.com/apache/beam/commit/8f0eec40f566cf999645e2db477ef1bb34eecf11", "message": "sideinput 7 and 8 with 500mb data", "committedDate": "2020-12-09T12:57:38Z", "type": "commit"}, {"oid": "9e652be9b63ee0bc5b842f4d32581f16b38b66d8", "url": "https://github.com/apache/beam/commit/9e652be9b63ee0bc5b842f4d32581f16b38b66d8", "message": "400mb works both on dataflow and flink", "committedDate": "2020-12-09T16:30:42Z", "type": "commit"}, {"oid": "3be1cf922ea0e5912279ad8f4ce2c9f5874cf464", "url": "https://github.com/apache/beam/commit/3be1cf922ea0e5912279ad8f4ce2c9f5874cf464", "message": "400mb works both on dataflow and flink", "committedDate": "2020-12-09T16:35:24Z", "type": "commit"}, {"oid": "64123f3a058590df261ff6f310b6b8e9ea4861f0", "url": "https://github.com/apache/beam/commit/64123f3a058590df261ff6f310b6b8e9ea4861f0", "message": "add dataflow groovy for jenkins, add comment which informs that 400mb sideinput test is max for now", "committedDate": "2020-12-14T13:46:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ4NjUxNg==", "url": "https://github.com/apache/beam/pull/13436#discussion_r542486516", "bodyText": "In the Flink job, the title begins with 10gb, while here it begins with 400mb. Please choose one of these and stick to it.", "author": "kamilwu", "createdAt": "2020-12-14T15:43:45Z", "path": ".test-infra/jenkins/job_LoadTests_SideInput_Go.groovy", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import CommonJobProperties as commonJobProperties\n+import CommonTestProperties\n+import LoadTestsBuilder as loadTestsBuilder\n+import PhraseTriggeringPostCommitBuilder\n+import InfluxDBCredentialsHelper\n+\n+String now = new Date().format('MMddHHmmss', TimeZone.getTimeZone('UTC'))\n+\n+def batchScenarios = {\n+  [\n+    [\n+      title          : 'SideInput Go Load test: 400mb-1kb-10workers-1window-first-iterable',", "originalCommit": "64123f3a058590df261ff6f310b6b8e9ea4861f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc4NTg5NQ==", "url": "https://github.com/apache/beam/pull/13436#discussion_r542785895", "bodyText": "Thank you I changed everything to 400mb-*.", "author": "tszerszen", "createdAt": "2020-12-14T21:06:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ4NjUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ4OTE5NA==", "url": "https://github.com/apache/beam/pull/13436#discussion_r542489194", "bodyText": "The comment is OK, but you should also specify additional options for Flink. And while there is a link to Python Jenkins job, you could also add links to your newly defined jobs.", "author": "kamilwu", "createdAt": "2020-12-14T15:47:10Z", "path": ".test-infra/metrics/grafana/dashboards/perftests_metrics/SideInput_Load_Tests.json", "diffHunk": "@@ -21,7 +21,7 @@\n   \"links\": [],\n   \"panels\": [\n     {\n-      \"content\": \"The following options are common to all tests:\\n* key size: 100B\\n* value size: 900B\\n* number of workers: 10\\n* size of the window (if fixed windows are used): 1 second\\n\\nAdditional common options for Dataflow:\\n* experiments: use_runner_v2\\n* autoscaling_algorithm: NONE\\n\\n\\n[Jenkins job definition (Python, Dataflow)](https://github.com/apache/beam/blob/master/.test-infra/jenkins/job_LoadTests_SideInput_Python.groovy)\\n\\n\",\n+      \"content\": \"The following options are common to all tests:\\n* key size: 100B\\n* value size: 900B\\n* number of workers: 10\\n* size of the window (if fixed windows are used): 1 second\\n\\nAdditional common options for Dataflow:\\n* experiments: use_runner_v2\\n* autoscaling_algorithm: NONE\\n\\n\\n[Jenkins job definition (Python, Dataflow)](https://github.com/apache/beam/blob/master/.test-infra/jenkins/job_LoadTests_SideInput_Python.groovy)\\n\\nUntil the issue [BEAM-11427](https://issues.apache.org/jira/browse/BEAM-11427) in Go SDK is resolved, sideinput iteration test have 400MB, instead of 10GB.\",", "originalCommit": "64123f3a058590df261ff6f310b6b8e9ea4861f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0b7c6c75e7ac9a59199f148e61e888f833f70f79", "url": "https://github.com/apache/beam/commit/0b7c6c75e7ac9a59199f148e61e888f833f70f79", "message": "10gb -> 400mb", "committedDate": "2020-12-14T20:58:36Z", "type": "commit"}, {"oid": "f87d89ad7025783229a88fc930f64968b421018a", "url": "https://github.com/apache/beam/commit/f87d89ad7025783229a88fc930f64968b421018a", "message": "Merge branch 'master' of https://github.com/apache/beam into go_sdk_sideinput", "committedDate": "2020-12-14T21:01:44Z", "type": "commit"}, {"oid": "067fe64f1902cf0766b95be3b096daaebc4d3e75", "url": "https://github.com/apache/beam/commit/067fe64f1902cf0766b95be3b096daaebc4d3e75", "message": "add links to groovy Jenkins", "committedDate": "2020-12-15T09:23:40Z", "type": "commit"}, {"oid": "868d292b25282d8347838a7e056ee5ecd64dd958", "url": "https://github.com/apache/beam/commit/868d292b25282d8347838a7e056ee5ecd64dd958", "message": "add links to groovy Jenkins", "committedDate": "2020-12-15T09:29:25Z", "type": "commit"}, {"oid": "98ce479d735140e1628bd474eaf08ef6397c7e78", "url": "https://github.com/apache/beam/commit/98ce479d735140e1628bd474eaf08ef6397c7e78", "message": "make grafana sideinput smaller", "committedDate": "2020-12-15T12:23:41Z", "type": "commit"}]}