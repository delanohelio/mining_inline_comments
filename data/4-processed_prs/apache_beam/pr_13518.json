{"pr_number": 13518, "pr_title": "[BEAM-11415][BEAM-11416] Move Go ValidatesRunner tests and add filtering", "pr_createdAt": "2020-12-10T01:43:08Z", "pr_url": "https://github.com/apache/beam/pull/13518", "timeline": [{"oid": "e0a90df5ed064e714d704f94c7eca1780f48716a", "url": "https://github.com/apache/beam/commit/e0a90df5ed064e714d704f94c7eca1780f48716a", "message": "[BEAM-11415] [BEAM-11416] Move Go ValidatesRunner tests and add filtering.\n\nMerges the ValidatesRunner tests (basically just cross-language) and framework with the existing integration test code and adds the ability to filter/sickbay tests. Adjusts existing integration tests to also work with the new framework. Finally, adds gradle targets for running the script with Spark and Python Portable runners.", "committedDate": "2020-12-10T01:41:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc5OTM1Nw==", "url": "https://github.com/apache/beam/pull/13518#discussion_r542799357", "bodyText": "In open source Go the package name practically must match the folder the package lives in, unless it's a package main for a binary. That's probably the source of the pre and post commit failures.\nSo this would be xlang", "author": "lostluck", "createdAt": "2020-12-14T21:18:24Z", "path": "sdks/go/test/integration/xlang/xlang_test.go", "diffHunk": "@@ -0,0 +1,260 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package validatesrunner", "originalCommit": "e0a90df5ed064e714d704f94c7eca1780f48716a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg4MTY4OA==", "url": "https://github.com/apache/beam/pull/13518#discussion_r542881688", "bodyText": "Whoops, forgot to change that when I copied the file over. Done.", "author": "youngoli", "createdAt": "2020-12-14T22:36:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc5OTM1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk1MDIyOA==", "url": "https://github.com/apache/beam/pull/13518#discussion_r542950228", "bodyText": "We should consider (at some future time) to make these into flags, so they can be overridden as needed.\nhttps://pkg.go.dev/github.com/spf13/pflag#StringSlice\nNot super important as someone would still want to edit the default if they're trying to fix/resolve some of these.", "author": "lostluck", "createdAt": "2020-12-15T00:22:58Z", "path": "sdks/go/test/integration/integration.go", "diffHunk": "@@ -0,0 +1,108 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+// Package integration provides functionality that needs to be shared between all\n+// integration tests.\n+package integration\n+\n+import (\n+\t\"fmt\"\n+\t\"regexp\"\n+\t\"testing\"\n+\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/testing/ptest\"\n+)\n+\n+// Filters for temporarily skipping integration tests. All filters are regex\n+// matchers that must match the full name of a test at the point where\n+// CheckFilters is called. Multiple tests can be skipped by using regex\n+// wildcards. (ex. \"TestXLang_.*\" filters all tests starting with TestXLang_)\n+//\n+// It is strongly recommended to include, TODOs, Jira issues, or just comments\n+// describing why tests are being skipped.\n+\n+// sickbay filters tests that fail due to Go SDK errors. These tests will not\n+// execute on any runners.\n+var sickbay = []string{\n+\t// TODO(BEAM-11418): These tests are currently failing with the Go SDK.\n+\t\"TestXLang_CoGroupBy\",\n+\t\"TestXLang_Multi\",\n+\t\"TestXLang_Partition\",\n+}\n+\n+// Runner-specific test filters, for features that are not yet supported on\n+// specific runners.\n+\n+var directFilters = []string{\n+\t// The direct runner does not yet support cross-language.\n+\t\"TestXLang.*\",\n+}\n+\n+var portableFilters = []string{}\n+\n+var flinkFilters = []string{}\n+\n+var sparkFilters = []string{}", "originalCommit": "e0a90df5ed064e714d704f94c7eca1780f48716a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ2Nzc5Nw==", "url": "https://github.com/apache/beam/pull/13518#discussion_r545467797", "bodyText": "Agreed. Seems like a good idea, but not something to implement right now.", "author": "youngoli", "createdAt": "2020-12-17T23:17:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk1MDIyOA=="}], "type": "inlineReview"}, {"oid": "0f3c93c274be2d02cc4b12a40a9f89d901d8e9de", "url": "https://github.com/apache/beam/commit/0f3c93c274be2d02cc4b12a40a9f89d901d8e9de", "message": "[BEAM-11415] [BEAM-11416] Remove old VR tests and add additional filtering.\n\nThe old validatesrunner tests were causing Pre and Post-commit failures because they were automatically being tested by GoTest. Also, added filtering so that the ULR, Flink, and Spark gradle targets will pass.", "committedDate": "2020-12-18T03:43:53Z", "type": "commit"}, {"oid": "afe09986591dc6537c1ddb3d44e710cc373eca0a", "url": "https://github.com/apache/beam/commit/afe09986591dc6537c1ddb3d44e710cc373eca0a", "message": "fixup", "committedDate": "2020-12-23T05:19:12Z", "type": "commit"}]}