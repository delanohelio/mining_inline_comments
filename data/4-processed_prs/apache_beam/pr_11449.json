{"pr_number": 11449, "pr_title": "Updates and clarifications on type safety.", "pr_createdAt": "2020-04-17T18:56:00Z", "pr_url": "https://github.com/apache/beam/pull/11449", "timeline": [{"oid": "afeaabd62de59f045de2e33d19d5812f82d99db5", "url": "https://github.com/apache/beam/commit/afeaabd62de59f045de2e33d19d5812f82d99db5", "message": "Updates and clarifications on type safety.\n\n* Clarifiactions about when errors are raised.\n* Clarifications about PickleCoder. (Actually, the default is FastPrimitivesCoder.)\n* Users should not be calling ParDo with a function.\n* Removes unused (and not reccomended) *args and **kwargs in process methods.", "committedDate": "2020-04-17T18:52:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MzEyOQ==", "url": "https://github.com/apache/beam/pull/11449#discussion_r410453129", "bodyText": "I put these unused_ arguments because I ran this file through mypy and it was complaining about them not being there.\nPyCharm has similar complaints. Any solution to this?", "author": "udim", "createdAt": "2020-04-17T20:26:13Z", "path": "sdks/python/apache_beam/examples/snippets/snippets_test_py3.py", "diffHunk": "@@ -44,7 +44,7 @@ def test_bad_types_annotations(self):\n     # pylint: disable=expression-not-assigned\n     # pylint: disable=unused-variable\n     class FilterEvensDoFn(beam.DoFn):\n-      def process(self, element, *unused_args, **unused_kwargs):", "originalCommit": "afeaabd62de59f045de2e33d19d5812f82d99db5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5OTM1MA==", "url": "https://github.com/apache/beam/pull/11449#discussion_r410499350", "bodyText": "Well, mypy and PyCharm are certainly in error here. Possibly it's because we call DoFns with *args and **kwargs in places, but we construct those to match the actual signature. Please file a JIRA about this.", "author": "robertwb", "createdAt": "2020-04-17T22:28:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MzEyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwNDM4OQ==", "url": "https://github.com/apache/beam/pull/11449#discussion_r410504389", "bodyText": "I believe it's because the base class has *args and **kwargs in the prototype:\n\n  \n    \n      beam/sdks/python/apache_beam/transforms/core.py\n    \n    \n         Line 621\n      in\n      1de50c3\n    \n    \n    \n    \n\n        \n          \n           def process(self, element, *args, **kwargs):", "author": "udim", "createdAt": "2020-04-17T22:48:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MzEyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU5MDM5NQ==", "url": "https://github.com/apache/beam/pull/11449#discussion_r411590395", "bodyText": "Hmm... I wonder if it's possible to disable mypy for this method, as it's invoked dynamically and clearly can't figure out what's going on.", "author": "robertwb", "createdAt": "2020-04-20T18:16:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MzEyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1NDIzMg==", "url": "https://github.com/apache/beam/pull/11449#discussion_r410454232", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Beam will remove the outer iterable of the return type on the `DoFn.process` method and functions passed `FlatMap` to deduce the element type of resulting PCollection .\n          \n          \n            \n            Beam will remove the outer iterable of the return type on the `DoFn.process` method and functions passed to `FlatMap` to deduce the element type of resulting PCollection .", "author": "udim", "createdAt": "2020-04-17T20:28:47Z", "path": "website/src/documentation/sdks/python-type-safety.md", "diffHunk": "@@ -91,8 +92,8 @@ The following code declares an `int` input and a `str` output type hint on the `\n ```\n \n The following code declares `int` input and output type hints on `filter_evens`, using annotations on `FilterEvensDoFn.process`.\n-Since `process` returns a generator, the output type is annotated as `Iterable[int]` (`Generator[int, None, None]` would also work here).\n-Beam will remove the outer iterable of the return type on the `DoFn.process` method and functions passed to `ParDo` and `FlatMap`.\n+Since `process` returns a generator, the output type for a DoFn producing a `PCollection[int]` is annotated as `Iterable[int]` (`Generator[int, None, None]` would also work here).\n+Beam will remove the outer iterable of the return type on the `DoFn.process` method and functions passed `FlatMap` to deduce the element type of resulting PCollection .", "originalCommit": "afeaabd62de59f045de2e33d19d5812f82d99db5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ2NDkyNg==", "url": "https://github.com/apache/beam/pull/11449#discussion_r410464926", "bodyText": "If you're removing mentions of ParDo here, then the corresponding snippets should also be updated to use FlatMap instead of ParDo.", "author": "udim", "createdAt": "2020-04-17T20:54:47Z", "path": "website/src/documentation/sdks/python-type-safety.md", "diffHunk": "@@ -91,8 +92,8 @@ The following code declares an `int` input and a `str` output type hint on the `\n ```\n \n The following code declares `int` input and output type hints on `filter_evens`, using annotations on `FilterEvensDoFn.process`.\n-Since `process` returns a generator, the output type is annotated as `Iterable[int]` (`Generator[int, None, None]` would also work here).\n-Beam will remove the outer iterable of the return type on the `DoFn.process` method and functions passed to `ParDo` and `FlatMap`.", "originalCommit": "afeaabd62de59f045de2e33d19d5812f82d99db5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMDA1MA==", "url": "https://github.com/apache/beam/pull/11449#discussion_r410500050", "bodyText": "The ParDos in the snippets are being passed DoFns. I removed the reference to passing (raw) functions to ParDo.", "author": "robertwb", "createdAt": "2020-04-17T22:31:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ2NDkyNg=="}], "type": "inlineReview"}, {"oid": "62f15dd968d1889b315115a9f219618fe91c687a", "url": "https://github.com/apache/beam/commit/62f15dd968d1889b315115a9f219618fe91c687a", "message": "Update website/src/documentation/sdks/python-type-safety.md\n\nCo-Authored-By: Udi Meiri <udim@users.noreply.github.com>", "committedDate": "2020-04-17T22:30:13Z", "type": "commit"}]}