{"pr_number": 12952, "pr_title": "[BEAM-11022] Support bundle finalization for portable Flink in streaming.", "pr_createdAt": "2020-09-26T02:54:11Z", "pr_url": "https://github.com/apache/beam/pull/12952", "timeline": [{"oid": "f4a473a202566a359895eef94e7b73d3d15259ca", "url": "https://github.com/apache/beam/commit/f4a473a202566a359895eef94e7b73d3d15259ca", "message": "Draft - Add bundle finalization for flink.", "committedDate": "2020-10-05T23:29:20Z", "type": "forcePushed"}, {"oid": "23631b86064c98474abf8af1708549a34f306d51", "url": "https://github.com/apache/beam/commit/23631b86064c98474abf8af1708549a34f306d51", "message": "[BEAM-11022] Support bundle finalization for portable Flink in streaming.", "committedDate": "2020-10-06T01:32:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI5NTAyNQ==", "url": "https://github.com/apache/beam/pull/12952#discussion_r500295025", "bodyText": "I've been thinking that we should support bundle finalization also with checkpointing disabled in an eager fashion. Does not have to be tackled here but would be nice to fix eventually because checkpointing is disabled by default.", "author": "mxm", "createdAt": "2020-10-06T13:49:20Z", "path": "sdks/python/apache_beam/runners/portability/flink_runner_test.py", "diffHunk": "@@ -427,11 +427,29 @@ def test_sql(self):\n \n \n class FlinkRunnerTestStreaming(FlinkRunnerTest):\n+  def __init__(self, *args, **kwargs):\n+    super(FlinkRunnerTestStreaming, self).__init__(*args, **kwargs)\n+    self.enable_commit = False\n+\n+  def setUp(self):\n+    self.enable_commit = False\n+\n   def create_options(self):\n     options = super(FlinkRunnerTestStreaming, self).create_options()\n     options.view_as(StandardOptions).streaming = True\n+    if self.enable_commit:\n+      options._all_options['checkpointing_interval'] = 3000\n+      options._all_options['shutdown_sources_after_idle_ms'] = 60000\n     return options\n \n+  def test_callbacks_with_exception(self):\n+    self.enable_commit = True\n+    super(FlinkRunnerTest, self).test_callbacks_with_exception()\n+\n+  def test_register_finalizations(self):\n+    self.enable_commit = True\n+    super(FlinkRunnerTest, self).test_register_finalizations()", "originalCommit": "23631b86064c98474abf8af1708549a34f306d51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ5Njk0OQ==", "url": "https://github.com/apache/beam/pull/12952#discussion_r500496949", "bodyText": "If we can have bundle finalization not rely on checkpoint, that would be really good. I'm curious does it only require changes in Beam or it also requires some updates on Flink side like the batch support we need mentioned in https://lists.apache.org/thread.html/r89c74f4020cd15d3c1a4b84ef78d7da4f67824e1b5e2210f4c5c1f40%40%3Cdev.flink.apache.org%3E.", "author": "boyuanzz", "createdAt": "2020-10-06T18:08:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI5NTAyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDgyNjQzNQ==", "url": "https://github.com/apache/beam/pull/12952#discussion_r500826435", "bodyText": "It definitely requires changes in Flink for the finalization to be persisted without checkpointing by restoring the state from materialized intermediate results. However, if the user is fine with the job re-executing in case of failures, we may still offer bundle finalization. That may be acceptable as opposed to piling up to-be-acknowledged bundles which is likely going to fail the job. Perhaps this should be opt-in.", "author": "mxm", "createdAt": "2020-10-07T08:22:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI5NTAyNQ=="}], "type": "inlineReview"}, {"oid": "48adfaacea9adf8eba13eb981dbfb0cc0f4f0ea0", "url": "https://github.com/apache/beam/commit/48adfaacea9adf8eba13eb981dbfb0cc0f4f0ea0", "message": "Enable UsesBundleFinalizer for streaming portable flink.", "committedDate": "2020-10-06T19:30:35Z", "type": "forcePushed"}, {"oid": "44e4b59b45252f718423d91153c95d4de537b489", "url": "https://github.com/apache/beam/commit/44e4b59b45252f718423d91153c95d4de537b489", "message": "[BEAM-11022] Support bundle finalization for portable Flink in streaming.", "committedDate": "2020-10-07T20:09:11Z", "type": "forcePushed"}, {"oid": "84ee2dd7cec4523f2930937c1bd222618ffad2c0", "url": "https://github.com/apache/beam/commit/84ee2dd7cec4523f2930937c1bd222618ffad2c0", "message": "[BEAM-11022] Support bundle finalization for portable Flink in streaming.", "committedDate": "2020-10-07T23:59:24Z", "type": "forcePushed"}, {"oid": "4f067f6365f412ddab10d296397861c19da78cc6", "url": "https://github.com/apache/beam/commit/4f067f6365f412ddab10d296397861c19da78cc6", "message": "[BEAM-11022] Support bundle finalization for portable Flink in streaming.", "committedDate": "2020-10-08T17:48:09Z", "type": "commit"}, {"oid": "4f067f6365f412ddab10d296397861c19da78cc6", "url": "https://github.com/apache/beam/commit/4f067f6365f412ddab10d296397861c19da78cc6", "message": "[BEAM-11022] Support bundle finalization for portable Flink in streaming.", "committedDate": "2020-10-08T17:48:09Z", "type": "forcePushed"}]}