{"pr_number": 10778, "pr_title": "[BEAM-3301] Small cleanup to KV Decoder.", "pr_createdAt": "2020-02-05T23:26:30Z", "pr_url": "https://github.com/apache/beam/pull/10778", "timeline": [{"oid": "3f9567ffeef94e8914a327ab8193c8fa79443575", "url": "https://github.com/apache/beam/commit/3f9567ffeef94e8914a327ab8193c8fa79443575", "message": "[BEAM-3301] Small cleanup to FullValue code.\n\nThis enables nested KV coders to be decoded properly (the previous\ncode would drop nested KV's value). Currently there are no nested KV\ncoders present in the Go SDK, but it will be needed for SDF support.", "committedDate": "2020-02-05T23:24:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAxNDc2Nw==", "url": "https://github.com/apache/beam/pull/10778#discussion_r376014767", "bodyText": "Great warning to include!", "author": "lostluck", "createdAt": "2020-02-06T18:45:07Z", "path": "sdks/go/pkg/beam/core/runtime/exec/coder.go", "diffHunk": "@@ -304,8 +311,20 @@ func (c *kvDecoder) Decode(r io.Reader) (*FullValue, error) {\n \tif err != nil {\n \t\treturn nil, err\n \t}\n-\treturn &FullValue{Elm: key.Elm, Elm2: value.Elm}, nil\n+\treturn &FullValue{Elm: elideSingleElmFV(key), Elm2: elideSingleElmFV(value)}, nil\n+}\n \n+// elideSingleElmFV elides a FullValue if it has only one element, returning\n+// the contents of the first element, but returning the FullValue unchanged\n+// if it has two elements.\n+//\n+// Technically drops window and timestamp info, so only use when those are", "originalCommit": "3f9567ffeef94e8914a327ab8193c8fa79443575", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}