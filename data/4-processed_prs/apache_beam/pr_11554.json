{"pr_number": 11554, "pr_title": "[BEAM-9876] Migrate the Beam website from Jekyll to Hugo to enable localization of the site content", "pr_createdAt": "2020-04-28T12:31:29Z", "pr_url": "https://github.com/apache/beam/pull/11554", "timeline": [{"oid": "9a45fb4943ca61a3b9aac4e9e2d61db4b683ed12", "url": "https://github.com/apache/beam/commit/9a45fb4943ca61a3b9aac4e9e2d61db4b683ed12", "message": "Added Works With logos", "committedDate": "2020-04-30T19:07:46Z", "type": "forcePushed"}, {"oid": "222b12c05596803d71a463a007b6e1177d6c60ff", "url": "https://github.com/apache/beam/commit/222b12c05596803d71a463a007b6e1177d6c60ff", "message": "Added Works With logos", "committedDate": "2020-04-30T19:27:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYwNDUzNQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r418604535", "bodyText": "Won't this change cause issues with staging?", "author": "robertwb", "createdAt": "2020-05-01T15:55:10Z", "path": "website/www/site/content/en/blog/beam-2.19.0.md", "diffHunk": "@@ -25,7 +24,7 @@ limitations under the License.\n -->\n \n We are happy to present the new 2.19.0 release of Beam. This release includes both improvements and new functionality.\n-See the [download page]({{ site.baseurl }}/get-started/downloads/#2190-2020-02-04) for this release.<!--more-->", "originalCommit": "b267bb360866a723ac2536f408f23de648c7cd4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM0MDA3Mw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r419340073", "bodyText": "@robertwb: Hugo actually handles urls behind the scene (a great feature compared to Jekyll :D). You may check this out [1] for more details. In short, we only need to add canonifyURLs = true in website/www/site/config.toml.\n[1] https://gohugo.io/content-management/urls/#canonicalization", "author": "bntnam", "createdAt": "2020-05-04T10:22:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYwNDUzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYwNDk3MA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r418604970", "bodyText": "Why was this removed?", "author": "robertwb", "createdAt": "2020-05-01T15:56:10Z", "path": "website/www/site/content/en/blog/beam-2.20.0.md", "diffHunk": "@@ -43,7 +41,6 @@ Python SDK: . (#10223).\n * [BEAM-8841](https://issues.apache.org/jira/browse/BEAM-8841) Added ability to write to BigQuery via Avro file loads\n * [BEAM-9228](https://issues.apache.org/jira/browse/BEAM-9228) Direct runner for FnApi supports further parallelism\n * [BEAM-8550](https://issues.apache.org/jira/browse/BEAM-8550) Support for @RequiresTimeSortedInput in Flink and Spark\n-* [BEAM-6857](https://issues.apache.org/jira/browse/BEAM-6857) Added support for dynamic timers", "originalCommit": "b267bb360866a723ac2536f408f23de648c7cd4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMzNzA5NQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r419337095", "bodyText": "@robertwb: Oh, thanks for pointing out. It was updated recently. I have synced this PR to current repository. \ud83d\ude42", "author": "bntnam", "createdAt": "2020-05-04T10:16:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYwNDk3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY2MTAyNA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r419661024", "bodyText": "Probably don't want to check this in.", "author": "robertwb", "createdAt": "2020-05-04T19:04:36Z", "path": "website/www/site/content/en/contribute/release-guide.md", "diffHunk": "@@ -218,7 +214,7 @@ docker login docker.io\n After successful login, authorization info will be stored at ~/.docker/config.json file. For example,\n ```\n \"https://index.docker.io/v1/\": {\n-   \"auth\": \"xxxxxx\"\n+   \"auth\": \"aGFubmFoamlhbmc6cmtkdGpmZ2hrMTIxMw==\"", "originalCommit": "b267bb360866a723ac2536f408f23de648c7cd4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNzY4Mw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r419717683", "bodyText": "Stray {?", "author": "robertwb", "createdAt": "2020-05-04T20:46:27Z", "path": "website/www/site/content/en/blog/splittable-do-fn.md", "diffHunk": "@@ -475,8 +471,7 @@ IO connectors. However, a large amount of work is in progress or planned.\n \n As of August 2017, SDF is available for use in the Beam Java Direct runner and\n Dataflow Streaming runner, and implementation is in progress in the Flink and\n-Apex runners; see [capability matrix]({{ site.baseurl\n-}}/documentation/runners/capability-matrix/) for the current status. Support\n+Apex runners; see [capability matrix]({/documentation/runners/capability-matrix/) for the current status. Support", "originalCommit": "b267bb360866a723ac2536f408f23de648c7cd4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxODU5MA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r419718590", "bodyText": "Is this Partition or Map?", "author": "robertwb", "createdAt": "2020-05-04T20:48:22Z", "path": "website/www/site/content/en/documentation/transforms/python/elementwise/map.md", "diffHunk": "@@ -1,8 +1,5 @@\n ---\n-layout: section\n-title: \"Map\"\n-permalink: /documentation/transforms/python/elementwise/map/\n-section_menu: section-menu/documentation.html\n+title: \"Partition\"", "originalCommit": "b267bb360866a723ac2536f408f23de648c7cd4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyMjM1NQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r419822355", "bodyText": "This seems to be the wrong page.", "author": "robertwb", "createdAt": "2020-05-05T01:39:23Z", "path": "website/www/site/content/en/documentation/transforms/python/elementwise/kvswap.md", "diffHunk": "@@ -0,0 +1,142 @@\n+---\n+title: \"Partition\"", "originalCommit": "0162c9db3e7faf0d0e243c580ffa5ca5f497db98", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyMjU3NQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r419822575", "bodyText": "Another copy of \"Partiton.\" (There may be others, we should verify we haven't lost content in the move.)", "author": "robertwb", "createdAt": "2020-05-05T01:40:16Z", "path": "website/www/site/content/en/documentation/transforms/python/elementwise/pardo.md", "diffHunk": "@@ -0,0 +1,142 @@\n+---\n+title: \"Partition\"", "originalCommit": "0162c9db3e7faf0d0e243c580ffa5ca5f497db98", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNjk2OA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r419826968", "bodyText": "What is the problem here? What is markdownify and what is superscripts ?", "author": "aaltay", "createdAt": "2020-05-05T02:01:00Z", "path": "website/www/site/content/en/community/contact-us.md", "diffHunk": "@@ -0,0 +1,47 @@\n+---\n+title: \"Contact Us\"\n+aliases:\n+  - /community/\n+  - /use/issue-tracking/\n+  - /use/mailing-lists/\n+  - /get-started/support/\n+---\n+<!--\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+-->\n+\n+# Contact Us\n+\n+There are many ways to reach the Beam user and developer communities - use\n+whichever one seems best.\n+\n+<!-- We use div instead of table shortcode here, because markdownify break superscripts -->", "originalCommit": "0162c9db3e7faf0d0e243c580ffa5ca5f497db98", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE5OTk0OA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r420199948", "bodyText": "If you look at the table shortcode as its mentioned in the comment (its located at website/www/site/layouts/shortcodes/table), you will see we can pass the markdown into a div because of {{ .Inner | markdownify }}. And we use this table shortcode to replace {:.table} syntax in Jekyll. We've done it with several tables. However, only this one, it uses [^1] to refer a link and unfortunately {{ .Inner | markdownify }} doesn't support this passing, so we need to use the div directly on this without passing through markdownify.", "author": "bntnam", "createdAt": "2020-05-05T15:29:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNjk2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNzE3Nw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r419827177", "bodyText": "Why do we multiple breaks here?", "author": "aaltay", "createdAt": "2020-05-05T02:02:04Z", "path": "website/www/site/content/en/documentation/transforms/java/elementwise/regex.md", "diffHunk": "@@ -0,0 +1,34 @@\n+---\n+title: \"Regex\"\n+---\n+<!--\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+-->\n+# Regex\n+<table align=\"left\">\n+    <a target=\"_blank\" class=\"button\"\n+        href=\"https://beam.apache.org/releases/javadoc/current/index.html?org/apache/beam/sdk/transforms/Regex.html\">\n+      <img src=\"https://beam.apache.org/images/logos/sdks/java.png\" width=\"20px\" height=\"20px\"\n+           alt=\"Javadoc\" />\n+     Javadoc\n+    </a>\n+</table>\n+<br><br>", "originalCommit": "0162c9db3e7faf0d0e243c580ffa5ca5f497db98", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE5MzIyMQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r420193221", "bodyText": "In Jekyll, there was only one <br> at this line and once it was rendered, this <br> would be wrapped by <p><br></p>. In Hugo, <br> is still <br> after rendering so the spacing here is different. I don't wanna mimic <p><br></p> because it doesn't make sense, so I add one more <br> and now they have the same spacing.", "author": "bntnam", "createdAt": "2020-05-05T15:20:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNzE3Nw=="}], "type": "inlineReview"}, {"oid": "67e9635a1322e499f77927fa1a989158d0e7d963", "url": "https://github.com/apache/beam/commit/67e9635a1322e499f77927fa1a989158d0e7d963", "message": "Excluded website build files", "committedDate": "2020-05-05T20:16:10Z", "type": "forcePushed"}, {"oid": "eb15d861e44439f55f7601f67f90a4aace5f9c84", "url": "https://github.com/apache/beam/commit/eb15d861e44439f55f7601f67f90a4aace5f9c84", "message": "Excluded website build files", "committedDate": "2020-05-05T20:17:49Z", "type": "forcePushed"}, {"oid": "644931cc59f9c7cf32a6e7a73e70ed736367b354", "url": "https://github.com/apache/beam/commit/644931cc59f9c7cf32a6e7a73e70ed736367b354", "message": "Excluded website build files", "committedDate": "2020-05-05T21:15:58Z", "type": "forcePushed"}, {"oid": "2592c8396ae1a68dadc351135c2a79397fb70942", "url": "https://github.com/apache/beam/commit/2592c8396ae1a68dadc351135c2a79397fb70942", "message": "Added Apache License", "committedDate": "2020-05-05T22:32:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA3MDY2Mw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r421070663", "bodyText": "Can you try running these as non-root? The fact that docker is running as root is causing troubles for other tests, it seems.", "author": "pabloem", "createdAt": "2020-05-06T20:26:24Z", "path": "website/build.gradle", "diffHunk": "@@ -91,30 +92,38 @@ task startDockerContainer(type: Exec) {\n     \"${->createDockerContainer.containerId()}\" // Lazily evaluate containerId.\n }\n \n+task initGitSubmodules(type: Exec) {\n+    commandLine 'docker', 'exec', '-u', 'root',\n+                \"${->startDockerContainer.containerId()}\", 'git',  'submodule', 'update', '--init',  '--recursive'\n+}\n+\n+task installDependencies(type: Exec) {\n+    commandLine 'docker', 'exec', '-u', 'root', '--workdir', \"$dockerSourceDir\",\n+                \"${->startDockerContainer.containerId()}\", 'yarn', 'install'\n+}\n+\n+task buildGithubSamples(type: Exec) {\n+  commandLine 'docker', 'exec', '-u', 'root', '--workdir', \"$dockerSourceDir\",\n+              \"${->startDockerContainer.containerId()}\", 'yarn', 'build_github_samples'\n+}", "originalCommit": "2592c8396ae1a68dadc351135c2a79397fb70942", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA3NTgzMg==", "url": "https://github.com/apache/beam/pull/11554#discussion_r421075832", "bodyText": "I wonder if we should remove the -u root from the other docker exec command below as well? I don't know why it's there, and I had to remove all 4 in order to be able to run :websitePrecommit locally.\nAlso once I did get it running I ran into the following error:\nError: Error building site: TOCSS: failed to transform \"scss/main.scss\" (text/x-scss): SCSS processing failed: file \"/opt/website/www/site/assets/scss/_table-wrapper.sass\", line 12, col 35: Invalid CSS after \"...the License. */\": expected 1 selector or at-rule, was \"*/ {}\" \n\nWhich seems to be another issue. Need to change the comment syntax in main.scss", "author": "TheNeuralBit", "createdAt": "2020-05-06T20:36:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA3MDY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTExMzM2OQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r421113369", "bodyText": "Confirmed that removing these lines seems to have fixed the issue with creating files owned by root. I ran\nfind /home/jenkins/jenkins-slave/workspace/beam_PreCommit_Website_Stage_GCS_Commit/ -group root and find /home/jenkins/jenkins-slave/workspace/beam_PreCommit_Website_Commit/ -group root on the workers it used and they don't have any.\nAlso ran find with -exec rm on every worker to remove some root-owned files that I seemed to have missed before. We should be good now.", "author": "TheNeuralBit", "createdAt": "2020-05-06T21:50:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA3MDY2Mw=="}], "type": "inlineReview"}, {"oid": "27601ca538728f7060b4abd710accf3ce62ab440", "url": "https://github.com/apache/beam/commit/27601ca538728f7060b4abd710accf3ce62ab440", "message": "Docker removed root", "committedDate": "2020-05-06T20:48:40Z", "type": "forcePushed"}, {"oid": "ebb9af4da3dcd558174714be1d2b44fba10e36d0", "url": "https://github.com/apache/beam/commit/ebb9af4da3dcd558174714be1d2b44fba10e36d0", "message": "Modified test link checker", "committedDate": "2020-05-07T10:19:16Z", "type": "forcePushed"}, {"oid": "a8533ee527b939d3543d549346678fab67b31ea4", "url": "https://github.com/apache/beam/commit/a8533ee527b939d3543d549346678fab67b31ea4", "message": "Modified test link checker", "committedDate": "2020-05-07T11:57:38Z", "type": "forcePushed"}, {"oid": "fc457c8413b4c950120dfe146f2d0538b96fae04", "url": "https://github.com/apache/beam/commit/fc457c8413b4c950120dfe146f2d0538b96fae04", "message": "Modified test link checker", "committedDate": "2020-05-07T15:50:02Z", "type": "forcePushed"}, {"oid": "63e509e2f6d47518f1f8dc8f7ddba495859776a5", "url": "https://github.com/apache/beam/commit/63e509e2f6d47518f1f8dc8f7ddba495859776a5", "message": "Modified test link checker", "committedDate": "2020-05-07T16:15:21Z", "type": "forcePushed"}, {"oid": "5b6cd8baad4dc403b18f906cee7ec9f010a226e5", "url": "https://github.com/apache/beam/commit/5b6cd8baad4dc403b18f906cee7ec9f010a226e5", "message": "Applied changes - Migrated Jekyll to Hugo\n\nSetup Docsy themes\n\nFixed github_sample\n\nCleaned unused Jekyll files\n\nAdded Works With logos\n\nSync new update\n\nAdopted to reviews & Updated content\n\nExcluded website build files\n\nAdded Apache License\n\nDocker removed root\n\nModified test link checker\n\nLatest sync", "committedDate": "2020-05-07T22:57:34Z", "type": "forcePushed"}, {"oid": "f5d2053f680df26f91029923f2d726fc223a38eb", "url": "https://github.com/apache/beam/commit/f5d2053f680df26f91029923f2d726fc223a38eb", "message": "Cleaned unused Jekyll files", "committedDate": "2020-05-07T23:01:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIyODI2OA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422228268", "bodyText": "Are the whitespace changes in these yaml files necessary?", "author": "TheNeuralBit", "createdAt": "2020-05-08T16:04:35Z", "path": "website/www/site/data/meetings.yml", "diffHunk": "@@ -9,31 +9,30 @@\n # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n # See the License for the specific language governing permissions and\n # limitations under the License.\n-# Welcome to Jekyll!\n \n events:\n-- date: 2016/04/01\n-  time: \"9:30 - 16:00 Pacific\"\n-  location: PayPal<br>San Jose, CA, USA\n-  type: Dev/PPMC Meeting\n-  materials:\n-    - title: Presentation - PPMC Deep Dive\n-      link: \"https://docs.google.com/presentation/d/1uTb7dx4-Y2OM_B0_3XF_whwAL2FlDTTuq2QzP9sJ4Mg/edit?usp=sharing\"\n+  - date: 2016/04/01\n+    time: \"9:30 - 16:00 Pacific\"\n+    location: PayPal<br>San Jose, CA, USA\n+    type: Dev/PPMC Meeting\n+    materials:\n+      - title: Presentation - PPMC Deep Dive\n+        link: \"https://docs.google.com/presentation/d/1uTb7dx4-Y2OM_B0_3XF_whwAL2FlDTTuq2QzP9sJ4Mg/edit?usp=sharing\"\n \n-    - title: Notes - PPMC Deep Dive\n-      link: \"https://docs.google.com/document/d/1SXSLj7FMIgKqj43nTcczFpJzqASeUMUCpbyklk2fBkg/edit?usp=sharing\"\n-  notes:\n+      - title: Notes - PPMC Deep Dive\n+        link: \"https://docs.google.com/document/d/1SXSLj7FMIgKqj43nTcczFpJzqASeUMUCpbyklk2fBkg/edit?usp=sharing\"\n+    notes:\n \n-- date: 2016/05/04\n-  time: \"8:00 - 11:00 Pacific\"\n-  location: Virtual\n-  type: Technical Deep Dive\n-  materials:\n-    - title: Presentation - Beam Community Meeting\n-      link: \"https://drive.google.com/open?id=17i7SHViboWtLEZw27iabdMisPl987WWxvapJaXg_dEE\"\n+  - date: 2016/05/04\n+    time: \"8:00 - 11:00 Pacific\"\n+    location: Virtual\n+    type: Technical Deep Dive\n+    materials:\n+      - title: Presentation - Beam Community Meeting\n+        link: \"https://drive.google.com/open?id=17i7SHViboWtLEZw27iabdMisPl987WWxvapJaXg_dEE\"\n \n-    - title: Notes - Beam Community Meeting\n-      link: \"https://drive.google.com/open?id=1szhEE_pfhEtrQye61jXAidUcMW7oebZCRc2InUe3ou0\"\n-  notes:\n+      - title: Notes - Beam Community Meeting\n+        link: \"https://drive.google.com/open?id=1szhEE_pfhEtrQye61jXAidUcMW7oebZCRc2InUe3ou0\"\n+    notes:", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIzODU0MQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422238541", "bodyText": "@TheNeuralBit: The file is formatted in the correct form according to the Indentation rule [1].\n[1] https://docs.saltstack.com/en/master/topics/troubleshooting/yaml_idiosyncrasies.html", "author": "bntnam", "createdAt": "2020-05-08T16:24:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIyODI2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwMjMwMg==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422302302", "bodyText": "Would it be possible to keep this in it's separate yaml file and just reference it here rather than in-lining? That would reduce the diff some.\nNot a blocker, just a nice-to-have", "author": "TheNeuralBit", "createdAt": "2020-05-08T18:31:45Z", "path": "website/www/site/content/en/blog/capability-matrix.md", "diffHunk": "@@ -0,0 +1,604 @@\n+---\n+title:  \"Clarifying & Formalizing Runner Capabilities\"\n+date:   2016-03-17 11:00:00 -0700\n+categories:\n+  - beam\n+  - capability\n+aliases:\n+  - /beam/capability/2016/03/17/capability-matrix.html\n+authors:\n+  - fjp\n+  - takidau\n+\n+capability-matrix-snapshot:", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzA5MTc3OA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423091778", "bodyText": "Okay!", "author": "bntnam", "createdAt": "2020-05-11T14:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwMjMwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwNTQyOQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422305429", "bodyText": "nit: I think this is redundant because of the \"**/.htaccess\" above", "author": "TheNeuralBit", "createdAt": "2020-05-08T18:38:08Z", "path": "build.gradle", "diffHunk": "@@ -86,14 +86,18 @@ rat {\n     // JDBC package config files\n     \"**/META-INF/services/java.sql.Driver\",\n \n-    // Ruby build files\n+    // Website build files\n     \"**/Gemfile.lock\",\n     \"**/Rakefile\",\n     \"**/.htaccess\",\n-    \"website/src/_sass/_bootstrap.scss\",\n-    \"website/src/_sass/bootstrap/**/*\",\n-    \"website/src/js/bootstrap*.js\",\n-    \"website/src/js/bootstrap/**/*\",\n+    \"website/www/site/assets/scss/_bootstrap.scss\",\n+    \"website/www/site/assets/scss/bootstrap/**/*\",\n+    \"website/www/site/static/js/bootstrap*.js\",\n+    \"website/www/site/static/js/bootstrap/**/*\",\n+    \"website/www/site/static/.htaccess\",", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMyMzc1Nw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422323757", "bodyText": "nit: could you add a comment like this at the start of the new Dockerfile?\nAlso some comments above each of the \"RUN\" statements below saying what they're doing would be nice. They're a little inscrutable by themselves, but some comments like \"Install misc deps\", \"Install node\", \"Install yarn\" would make it easy to inspect", "author": "TheNeuralBit", "createdAt": "2020-05-08T19:15:41Z", "path": "website/Dockerfile", "diffHunk": "@@ -1,33 +1,65 @@\n-###############################################################################\n-#  Licensed to the Apache Software Foundation (ASF) under one\n-#  or more contributor license agreements.  See the NOTICE file\n-#  distributed with this work for additional information\n-#  regarding copyright ownership.  The ASF licenses this file\n-#  to you under the Apache License, Version 2.0 (the\n-#  \"License\"); you may not use this file except in compliance\n-#  with the License.  You may obtain a copy of the License at\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n #\n-#      http://www.apache.org/licenses/LICENSE-2.0\n+#   http://www.apache.org/licenses/LICENSE-2.0\n #\n-#  Unless required by applicable law or agreed to in writing, software\n-#  distributed under the License is distributed on an \"AS IS\" BASIS,\n-#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-#  See the License for the specific language governing permissions and\n-# limitations under the License.\n-###############################################################################\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n \n-# This image contains Ruby and dependencies required to build and test the Beam\n-# website. It is used by tasks in build.gradle.", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMyNDQ3Nw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422324477", "bodyText": "Why not install from the debian repo with apt-get? https://gohugo.io/getting-started/installing/#debian-and-ubuntu\nIf we keep it this way it would be nice to pull the version number out into a variable so it's easy to upgrade.", "author": "TheNeuralBit", "createdAt": "2020-05-08T19:17:13Z", "path": "website/Dockerfile", "diffHunk": "@@ -1,33 +1,65 @@\n-###############################################################################\n-#  Licensed to the Apache Software Foundation (ASF) under one\n-#  or more contributor license agreements.  See the NOTICE file\n-#  distributed with this work for additional information\n-#  regarding copyright ownership.  The ASF licenses this file\n-#  to you under the Apache License, Version 2.0 (the\n-#  \"License\"); you may not use this file except in compliance\n-#  with the License.  You may obtain a copy of the License at\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n #\n-#      http://www.apache.org/licenses/LICENSE-2.0\n+#   http://www.apache.org/licenses/LICENSE-2.0\n #\n-#  Unless required by applicable law or agreed to in writing, software\n-#  distributed under the License is distributed on an \"AS IS\" BASIS,\n-#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-#  See the License for the specific language governing permissions and\n-# limitations under the License.\n-###############################################################################\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n \n-# This image contains Ruby and dependencies required to build and test the Beam\n-# website. It is used by tasks in build.gradle.\n+FROM debian:stretch-slim\n \n-FROM ruby:2.5\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-e\", \"-u\", \"-x\", \"-c\"]\n \n-WORKDIR /ruby\n-RUN gem install bundler\n-# Update buildDockerImage's inputs.files if you change this list.\n-ADD Gemfile Gemfile.lock /ruby/\n-RUN bundle install --deployment --path $GEM_HOME\n+ENV DEBIAN_FRONTEND=noninteractive \\\n+    LANGUAGE=C.UTF-8 \\\n+    LANG=C.UTF-8 \\\n+    LC_ALL=C.UTF-8 \\\n+    LC_CTYPE=C.UTF-8 \\\n+    LC_MESSAGES=C.UTF-8\n \n-# Required for website testing using HTMLProofer.\n-ENV LC_ALL C.UTF-8\n+RUN apt-get update \\\n+    && apt-get install -y --no-install-recommends \\\n+        ca-certificates \\\n+        curl \\\n+        git \\\n+        gnupg2 \\\n+        gosu \\\n+        lynx \\\n+    && apt-get autoremove -yqq --purge \\\n+    && apt-get clean \\\n+    && rm -rf /var/lib/apt/lists/*\n \n-CMD sleep 3600\n+RUN curl -sL https://deb.nodesource.com/setup_10.x | bash - \\\n+    && apt-get update \\\n+    && apt-get install -y --no-install-recommends \\\n+        nodejs \\\n+    && apt-get autoremove -yqq --purge \\\n+    && apt-get clean \\\n+    && rm -rf /var/lib/apt/lists/*\n+\n+RUN curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n+    && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | tee /etc/apt/sources.list.d/yarn.list \\\n+    && apt-get update \\\n+    && apt-get install -y --no-install-recommends yarn \\\n+    && apt-get autoremove -yqq --purge \\\n+    && apt-get clean \\\n+    && rm -rf /var/lib/apt/lists/*\n+\n+RUN HUGOHOME=\"$(mktemp -d)\" \\\n+    && export HUGOHOME \\\n+    && curl -sL https://github.com/gohugoio/hugo/releases/download/v0.68.3/hugo_extended_0.68.3_Linux-64bit.tar.gz > \"${HUGOHOME}/hugo.tar.gz\" \\\n+    && tar -xzvf \"${HUGOHOME}/hugo.tar.gz\" hugo \\\n+    && mv hugo /usr/local/bin/hugo \\\n+    && chmod +x /usr/local/bin/hugo \\\n+    && rm -r \"${HUGOHOME}\"", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk5NTYzOQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422995639", "bodyText": "It's not recommended by Docsy which is our Hugo template [1].\n[1] https://www.docsy.dev/docs/getting-started/#linux", "author": "bntnam", "createdAt": "2020-05-11T12:14:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMyNDQ3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMyNTg4Mg==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422325882", "bodyText": "Beam not Airflow :) (to be safe I searched the diff and didn't find any other Airflow references)\nI'd also drop \"project\" and just say \"If you'd like to contribute to the Apache Beam website, ...\"", "author": "TheNeuralBit", "createdAt": "2020-05-08T19:20:05Z", "path": "website/README.md", "diffHunk": "@@ -17,58 +17,50 @@\n     under the License.\n -->\n \n+# Apache Beam website\n+\n These are the main sources of the website for Apache Beam, hosted at\n https://beam.apache.org/.\n \n-## About this site\n+## About\n \n-The Beam website is built using [Jekyll](https://jekyllrb.com/). Additionally,\n+The Beam website is built using [Hugo](https://gohugo.io/). Additionally,\n for additional formatting capabilities, this website uses\n [Twitter Bootstrap](https://getbootstrap.com/).\n \n Documentation generated from source code, such as Javadoc and Pydoc, is stored\n separately on the [beam-site\n repository](https://github.com/apache/beam-site/tree/release-docs).\n \n-## Active development\n+## Getting started\n \n Website development requires Docker installed if you wish to preview changes and\n run website tests.\n \n-The following command is used to build and serve the website locally.\n+The Docsy theme required for the site to work properly is included as a git submodule. This means that after you already cloned the repository, you need to update submodules at `<ROOT_DIRECTORY>`.\n+\n+`$ git submodule update --init --recursive`\n+\n+The following command is used to build and serve the website locally. Note: you should run the command at `<ROOT_DIRECTORY>`.\n \n-    $ ./gradlew :website:serveWebsite\n+`$ ./gradlew :website:serveWebsite`\n \n Any changes made locally will trigger a rebuild of the website.\n \n Websites tests may be run using this command:\n \n-    $ ./gradlew :website:testWebsite\n+`$ ./gradlew :website:testWebsite`\n \n-## Website push\n+For more detailed description, please refer to [contribution guide](CONTRIBUTE.md).\n+\n+## Deployment\n \n After a PR is merged, a background Jenkins job will automatically generate and\n push [website\n content](https://github.com/apache/beam/tree/asf-site/website/generated-content)\n to the asf-site branch. This content is later picked up and pushed to\n https://beam.apache.org/.\n \n-## Additional Information\n-\n-### Writing blog posts\n-\n-Blog posts are created in the `_posts` directory.\n-\n-If this is your first post, make sure to add yourself to `_data\\authors.yml`.\n-\n-While you a working on your post before the publishing time listed in its header,\n-add `--future` when running Jekyll in order to view your draft on your local copy of\n-the site.\n-\n-### Adding Jekyll plugins\n-\n-If you modify the site to use additional Jekyll plugins, add them in `Gemfile`\n-and then run `bundle update`, which will regenerate the complete `Gemfile.lock`.\n-Make sure that the updated `Gemfile.lock` is included in your pull request. For more information,\n-see the Bundler [documentation](https://bundler.io/v1.3/rationale.html).\n+## Contribution guide\n \n+If you'd like to contribute to the Apache Airflow website project, read our [contribution guide](CONTRIBUTE.md) where you can find detailed instructions on how to work with the website.", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMyNjQ2NA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422326464", "bodyText": "nit: \"For a more\" .. \"refer to the contribution guide\"", "author": "TheNeuralBit", "createdAt": "2020-05-08T19:21:10Z", "path": "website/README.md", "diffHunk": "@@ -17,58 +17,50 @@\n     under the License.\n -->\n \n+# Apache Beam website\n+\n These are the main sources of the website for Apache Beam, hosted at\n https://beam.apache.org/.\n \n-## About this site\n+## About\n \n-The Beam website is built using [Jekyll](https://jekyllrb.com/). Additionally,\n+The Beam website is built using [Hugo](https://gohugo.io/). Additionally,\n for additional formatting capabilities, this website uses\n [Twitter Bootstrap](https://getbootstrap.com/).\n \n Documentation generated from source code, such as Javadoc and Pydoc, is stored\n separately on the [beam-site\n repository](https://github.com/apache/beam-site/tree/release-docs).\n \n-## Active development\n+## Getting started\n \n Website development requires Docker installed if you wish to preview changes and\n run website tests.\n \n-The following command is used to build and serve the website locally.\n+The Docsy theme required for the site to work properly is included as a git submodule. This means that after you already cloned the repository, you need to update submodules at `<ROOT_DIRECTORY>`.\n+\n+`$ git submodule update --init --recursive`\n+\n+The following command is used to build and serve the website locally. Note: you should run the command at `<ROOT_DIRECTORY>`.\n \n-    $ ./gradlew :website:serveWebsite\n+`$ ./gradlew :website:serveWebsite`\n \n Any changes made locally will trigger a rebuild of the website.\n \n Websites tests may be run using this command:\n \n-    $ ./gradlew :website:testWebsite\n+`$ ./gradlew :website:testWebsite`\n \n-## Website push\n+For more detailed description, please refer to [contribution guide](CONTRIBUTE.md).", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMzMDMwNw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422330307", "bodyText": "Can you keep the 127.0.0.1:? I'm not sure about the default behavior of docker's \"--publish\" arg but its good to be clear we only want the port to be available internally.", "author": "TheNeuralBit", "createdAt": "2020-05-08T19:29:04Z", "path": "website/build.gradle", "diffHunk": "@@ -66,8 +67,8 @@ task createDockerContainer(type: Exec) {\n   gradle.taskGraph.whenReady {\n     def extraOptions = ''\n     if (gradle.taskGraph.hasTask(\":${project.name}:serveWebsite\")) {\n-      // Publish port 4000 where Jekyll serves website from\n-      extraOptions = '--publish 127.0.0.1:4000:4000'\n+      // Publish port 1313 where Hugo serves website from\n+      extraOptions = \"--publish 1313:1313\"", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMzODU5MA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422338590", "bodyText": "It looks like here and buildLocalWebsite were the only places where useBranchRepoConfig was true. Should it still be true here? Or should we just remove that config option altogether?", "author": "TheNeuralBit", "createdAt": "2020-05-08T19:47:10Z", "path": "website/build.gradle", "diffHunk": "@@ -130,55 +139,41 @@ class BuildTaskConfiguration {\n def createBuildTask = {\n   BuildTaskConfiguration config = it as BuildTaskConfiguration\n   task \"build${config.name}Website\" (type:Exec) {\n-    dependsOn setupDockerContainer, setupBuildDir\n+    dependsOn setupDockerContainer\n     finalizedBy stopAndRemoveDockerContainer\n-    inputs.files 'Gemfile.lock', '_config.yml'\n-    inputs.dir 'src'\n-    outputs.dir \"$buildDir/.sass-cache\"\n-    outputs.dir buildContentDir(config.name)\n-    def configs = \"${config.dockerWorkDir}/website/_config.yml\"\n-    if (config.useTestConfig) {\n-      configs += \",${config.dockerWorkDir}/website/_config_test.yml\"\n-    }\n+\n+    def configs = \"$dockerSourceDir/site/config.toml\"\n     if (config.useBranchRepoConfig) {\n-      configs += \",/tmp/_config_branch_repo.yml\"\n+      configs += \",/tmp/_config_branch_repo.toml\"\n     }\n-    def baseUrlFlag = config.baseUrl ? \"--baseurl=/${config.baseUrl}\" : \"\"\n+    def baseUrlFlag = config.baseUrl ? \"--baseURL /${config.baseUrl}\" : \"\"\n     commandLine 'docker', 'exec',\n       \"${->setupDockerContainer.containerId()}\", '/bin/bash', '-c',\n-      \"\"\"cd ${config.dockerWorkDir}/build/website && \\\n-        bundle exec jekyll build \\\n-        --destination generated-${config.name.toLowerCase()}-content \\\n-        --config ${configs} \\\n-        --incremental ${baseUrlFlag} \\\n-        --source ${config.dockerWorkDir}/website/src\n+      \"\"\"cd $dockerSourceDir && \\\n+        yarn build \\\n+        -d $dockerBuildDir/generated-${config.name.toLowerCase()}-content \\\n+        --config $configs \\\n+        $baseUrlFlag\n         \"\"\"\n   }\n }\n \n // task buildLocalWebsite\n createBuildTask(\n   name:'Local',\n-  useTestConfig: true,\n-  useBranchRepoConfig: true,\n-  dockerWorkDir: dockerWorkDir,\n )\n task buildWebsite(dependsOn:buildLocalWebsite)\n build.dependsOn buildWebsite\n \n // task buildGcsWebsite\n createBuildTask(\n   name:'Gcs',\n-  useTestConfig: true,\n-  useBranchRepoConfig: true,", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM0MTE5Mw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422341193", "bodyText": "Could you add a link to https://gohugo.io/getting-started/installing/ or something similar since people need to install hugo for commands in the rest of the doc", "author": "TheNeuralBit", "createdAt": "2020-05-08T19:52:55Z", "path": "website/CONTRIBUTE.md", "diffHunk": "@@ -0,0 +1,336 @@\n+<!--\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+-->\n+\n+# Contribution Guide\n+\n+This guide consists of:\n+\n+- [Project structure](#project-structure)\n+- [Configuration walkthrough](#configuration-walkthrough)\n+- [How to add a new doc](#how-to-add-a-new-doc)\n+- [How to add a new blogpost](#how-to-add-a-new-blogpost)\n+- [How to add a new landing page](#how-to-add-a-new-landing-page)\n+- [How to write in Hugo way](#how-to-write-in-hugo-way)\n+  - [Define TableOfContents](#define-tableofcontents)\n+  - [Language switching](#language-switching)\n+  - [Code highlighting](#code-highlighting)\n+  - [Adding class to markdown text](#paragraph)\n+  - [Table](#table)\n+  - [Github sample](#github-sample)\n+  - [Others](#others)\n+- [Translation guide](#translation-guide)\n+\n+## Project structure\n+\n+```\n+www/\n+\u251c\u2500\u2500 dist                                  # bundle files\n+\u251c\u2500\u2500 site\n+\u2502\u00a0\u00a0 \u251c\u2500\u2500 archetypes                        # frontmatter template\n+\u2502\u00a0\u00a0 \u251c\u2500\u2500 assets\n+\u2502   \u2502   \u2514\u2500\u2500 scss                          # styles\n+\u2502\u00a0\u00a0 \u251c\u2500\u2500 content                           # pages\n+\u2502   \u2502   \u2514\u2500\u2500 en\n+\u2502   \u2502       \u251c\u2500\u2500 blog\n+\u2502   \u2502       \u251c\u2500\u2500 community\n+\u2502   \u2502       \u251c\u2500\u2500 contribute\n+\u2502   \u2502       \u251c\u2500\u2500 documentation\n+\u2502   \u2502       \u251c\u2500\u2500 get-started\n+\u2502   \u2502       \u251c\u2500\u2500 privacy_policy\n+\u2502   \u2502       \u251c\u2500\u2500 roadmap\n+\u2502   \u2502       \u2514\u2500\u2500 security\n+\u2502   \u2502       \u2514\u2500\u2500 _index.md\n+\u2502\u00a0\u00a0 \u251c\u2500\u2500 data\n+\u2502\u00a0\u00a0 \u251c\u2500\u2500 layouts                           # content template\n+\u2502\u00a0\u00a0 \u251c\u2500\u2500 static\n+\u2502   \u2502   \u251c\u2500\u2500 downloads                     # downloaded files\n+\u2502   \u2502   \u2514\u2500\u2500 fonts\n+\u2502   \u2502   \u2514\u2500\u2500 images\n+\u2502   \u2502   \u2514\u2500\u2500 js\n+\u2502\u00a0\u00a0 \u2514\u2500\u2500 themes\n+\u2502       \u2514\u2500\u2500 docsy\n+\u251c\u2500\u2500 build_github_samples.sh\n+\u251c\u2500\u2500 check-links.sh                        # links checker\n+\u2514\u2500\u2500 package.json\n+```\n+\n+## Configuration walkthrough\n+\n+When we mention the `config file` in this documentation, we mean the Hugo configuration file located at `/www/site/config.toml`.\n+\n+Most of the setup are self-explained in the comments. Please refer to [Hugo documentation](https://gohugo.io/getting-started/configuration/) for more details.\n+\n+You should notice at `[params]`, they are considered as global variables. For instance, when you'd like to replace the release latest version, make a change on `release_latest = \"\"` to replace it everywhere in the project.", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM0MTgxMw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422341813", "bodyText": "I'm not clear on why you had to add this trap and while loop, could you explain that?", "author": "TheNeuralBit", "createdAt": "2020-05-08T19:54:07Z", "path": "website/build.gradle", "diffHunk": "@@ -78,7 +79,7 @@ task createDockerContainer(type: Exec) {\n       extraOptions += \" -u \\$(id -u):\\$(id -g)\"\n     }\n     commandLine '/bin/bash', '-c',\n-      \"docker create -v $project.rootDir:$dockerWorkDir $extraOptions $dockerImageTag\"\n+      \"docker create -v $project.rootDir:$dockerWorkDir $extraOptions $dockerImageTag sh -c 'trap \\\"exit 0\\\" INT; while true; do sleep 30; done;'\"", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEwMDY1MA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423100650", "bodyText": "My colleague said that it was needed to keep the container working all the time while each subsequent command was using docker exec in the same container.\nI tried to remove it and it actually failed the tasks using docker exec.", "author": "bntnam", "createdAt": "2020-05-11T14:56:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM0MTgxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM0MjQyNw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422342427", "bodyText": "nit: do these need to be separate tasks? Maybe they could be folded into setupDockerContainer", "author": "TheNeuralBit", "createdAt": "2020-05-08T19:55:32Z", "path": "website/build.gradle", "diffHunk": "@@ -91,30 +92,38 @@ task startDockerContainer(type: Exec) {\n     \"${->createDockerContainer.containerId()}\" // Lazily evaluate containerId.\n }\n \n+task initGitSubmodules(type: Exec) {\n+    commandLine 'docker', 'exec',\n+                \"${->startDockerContainer.containerId()}\", 'git',  'submodule', 'update', '--init',  '--recursive'\n+}\n+\n+task installDependencies(type: Exec) {\n+    commandLine 'docker', 'exec', '--workdir', \"$dockerSourceDir\",\n+                \"${->startDockerContainer.containerId()}\", 'yarn', 'install'\n+}\n+\n+task buildGithubSamples(type: Exec) {\n+  commandLine 'docker', 'exec', '--workdir', \"$dockerSourceDir\",\n+              \"${->startDockerContainer.containerId()}\", 'yarn', 'build_github_samples'\n+}\n+", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAyMDczMQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423020731", "bodyText": "I was going to include them in setupDockerContainer. However, Ahmet'd like to write comments above each of them in order to show the use cases. I think it's a good idea. \ud83d\ude04", "author": "bntnam", "createdAt": "2020-05-11T13:00:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM0MjQyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM0NjE0NA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422346144", "bodyText": "Is postcss/autoprefixer actually used anywhere? I can't find any other references to them", "author": "TheNeuralBit", "createdAt": "2020-05-08T20:03:31Z", "path": "website/www/package.json", "diffHunk": "@@ -0,0 +1,19 @@\n+{\n+  \"name\": \"apache-beam-website\",\n+  \"version\": \"1.0.0\",\n+  \"description\": \"Apache Beam website\",\n+  \"repository\": \"apache/beam\",\n+  \"license\": \"MIT\",\n+  \"scripts\": {\n+    \"build_github_samples\": \"./build_github_samples.sh\",\n+    \"develop\": \"cd site && hugo server\",\n+    \"build\": \"cross-env HUGO_ENV=production hugo -d ../dist -s site -v\",\n+    \"start\": \"hugo -d ../dist -s site -vw\"\n+  },\n+  \"dependencies\": {},\n+  \"devDependencies\": {\n+    \"autoprefixer\": \"^9.7.4\",\n+    \"cross-env\": \"^7.0.2\",\n+    \"postcss-cli\": \"^7.1.0\"", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzOTUwMQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423139501", "bodyText": "This is what I got on the build process when I tried to remove them. It's actually required by Docsy theme as a prerequisite. [1]\nError: Error building site: POSTCSS: failed to transform \"scss/main.css\" (text/css): resource \"scss/scss/main.scss_60afefe949d523e83b9759c49b47fc3a\" not found in file cache\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\n\n[1] https://www.docsy.dev/docs/getting-started/#install-postcss", "author": "bntnam", "createdAt": "2020-05-11T15:50:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM0NjE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA1NjA2NQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r424056065", "bodyText": "Ah I see. Could you add a comment stating they're required for docsy?", "author": "TheNeuralBit", "createdAt": "2020-05-12T21:53:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM0NjE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyNjgwNg==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422426806", "bodyText": "What is build_github_samples ?", "author": "aaltay", "createdAt": "2020-05-09T00:12:32Z", "path": "website/build.gradle", "diffHunk": "@@ -91,30 +92,38 @@ task startDockerContainer(type: Exec) {\n     \"${->createDockerContainer.containerId()}\" // Lazily evaluate containerId.\n }\n \n+task initGitSubmodules(type: Exec) {\n+    commandLine 'docker', 'exec',\n+                \"${->startDockerContainer.containerId()}\", 'git',  'submodule', 'update', '--init',  '--recursive'\n+}\n+\n+task installDependencies(type: Exec) {\n+    commandLine 'docker', 'exec', '--workdir', \"$dockerSourceDir\",\n+                \"${->startDockerContainer.containerId()}\", 'yarn', 'install'\n+}\n+\n+task buildGithubSamples(type: Exec) {\n+  commandLine 'docker', 'exec', '--workdir', \"$dockerSourceDir\",\n+              \"${->startDockerContainer.containerId()}\", 'yarn', 'build_github_samples'", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODkxNw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422428917", "bodyText": "I think I understand this. Does it move snippets to files?\nComments about these tasks will help.", "author": "aaltay", "createdAt": "2020-05-09T00:23:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyNjgwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyNzM4Nw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422427387", "bodyText": "Does check-links.sh cover a comparable amount of testing as the previous rake test?", "author": "aaltay", "createdAt": "2020-05-09T00:15:30Z", "path": "website/build.gradle", "diffHunk": "@@ -236,33 +231,24 @@ def buildContentDir(name) {\n }\n \n task serveWebsite(type: Exec) {\n-  dependsOn setupDockerContainer, setupBuildDir\n+  dependsOn setupDockerContainer\n   finalizedBy stopAndRemoveDockerContainer\n-  inputs.files 'Gemfile.lock', '_config.yml'\n-  inputs.dir 'src'\n-  outputs.dir \"$buildDir/.sass-cache\"\n-  outputs.dir buildContentDir('local')\n   commandLine 'docker', 'exec',\n     \"${->setupDockerContainer.containerId()}\", '/bin/bash', '-c',\n-    \"\"\"cd $dockerWorkDir/build/website && \\\n-      bundle exec jekyll serve \\\n-      --config $dockerWorkDir/website/_config.yml,/tmp/_config_branch_repo.yml \\\n-      --incremental \\\n-      --source $dockerWorkDir/website/src \\\n-      --host 0.0.0.0\n+    \"\"\"cd $dockerSourceDir && \\\n+      yarn develop \\\n+      --bind=\"0.0.0.0\" \\\n+      --config $dockerSourceDir/site/config.toml,/tmp/_config_branch_repo.toml\n       \"\"\"\n }\n \n task testWebsite(type: Exec) {\n   // dependsOn setupDockerContainer, 'buildWebsite'\n   finalizedBy stopAndRemoveDockerContainer\n \n-  inputs.files \"$buildDir/Rakefile\"\n-  inputs.dir buildContentDir('local')\n   commandLine 'docker', 'exec',\n     \"${->setupDockerContainer.containerId()}\", '/bin/bash', '-c',\n-    \"\"\"cd $dockerWorkDir/build/website && \\\n-      bundle exec -- rake test disable_external=${findProperty('disableExternal') ?: true}\"\"\"\n+    \"$dockerSourceDir/check-links.sh $dockerBuildDir/generated-local-content\"", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAzMjE4NQ==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423032185", "bodyText": "Jekyll testing is backed by Ruby with Rake. Unfortunately, we don't have the same thing officially in Hugo. Although the customization cannot be compared to the Rake test, it covers the most edge cases of broken links with various status codes.", "author": "bntnam", "createdAt": "2020-05-11T13:18:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyNzM4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODEyMg==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422428122", "bodyText": "exit with an error?", "author": "aaltay", "createdAt": "2020-05-09T00:19:15Z", "path": "website/www/check-links.sh", "diffHunk": "@@ -0,0 +1,93 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+set -euo pipefail\n+\n+\n+function redraw_progress_bar { # int barsize, int base, int current, int top\n+    # Source: https://stackoverflow.com/a/20311674\n+    local barsize=$1\n+    local base=$2\n+    local current=$3\n+    local top=$4\n+    local j=0\n+    local progress=$(( (barsize * (current - base)) / (top - base ) ))\n+    echo -n \"[\"\n+    for ((j=0; j < progress; j++)) ; do echo -n '='; done\n+    echo -n '=>'\n+    for ((j=progress; j < barsize ; j++)) ; do echo -n ' '; done\n+    echo -n \"] $current / $top \" $'\\r'\n+}\n+\n+if ! command -v lynx; then\n+    echo \"This script requires lynx to work properly.\"\n+    echo\n+    echo \"For more information, look at: http://lynx.browser.org/\"\n+    exit", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODIwMg==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422428202", "bodyText": "Do we really need this graphical thing? Most of these runs will be in jenkins.", "author": "aaltay", "createdAt": "2020-05-09T00:19:42Z", "path": "website/www/check-links.sh", "diffHunk": "@@ -0,0 +1,93 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+set -euo pipefail\n+\n+\n+function redraw_progress_bar { # int barsize, int base, int current, int top", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAzMDc5Mw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423030793", "bodyText": "I think it's good to know the progress when someone wanna run the test locally ./gradlew website:testWebsite \ud83d\ude04", "author": "bntnam", "createdAt": "2020-05-11T13:16:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODIwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyMDUwOA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423320508", "bodyText": "How long does it take to run it?", "author": "aaltay", "createdAt": "2020-05-11T21:07:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODIwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1NjM2MA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423856360", "bodyText": "Around 20-30 mins, since it gets the status response from all of the links (approx. 1500 if I don't remember wrong).", "author": "bntnam", "createdAt": "2020-05-12T16:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODIwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA1NDM3MA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r424054370", "bodyText": "This script should be very parallelizable since it's completely IO bound. Maybe consider something like xargs -P rather than a bash for loop", "author": "TheNeuralBit", "createdAt": "2020-05-12T21:50:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODIwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODQ5MA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422428490", "bodyText": "We will echo the same thing in L87. Maybe we can remove this duplication.", "author": "aaltay", "createdAt": "2020-05-09T00:21:11Z", "path": "website/www/check-links.sh", "diffHunk": "@@ -0,0 +1,93 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+set -euo pipefail\n+\n+\n+function redraw_progress_bar { # int barsize, int base, int current, int top\n+    # Source: https://stackoverflow.com/a/20311674\n+    local barsize=$1\n+    local base=$2\n+    local current=$3\n+    local top=$4\n+    local j=0\n+    local progress=$(( (barsize * (current - base)) / (top - base ) ))\n+    echo -n \"[\"\n+    for ((j=0; j < progress; j++)) ; do echo -n '='; done\n+    echo -n '=>'\n+    for ((j=progress; j < barsize ; j++)) ; do echo -n ' '; done\n+    echo -n \"] $current / $top \" $'\\r'\n+}\n+\n+if ! command -v lynx; then\n+    echo \"This script requires lynx to work properly.\"\n+    echo\n+    echo \"For more information, look at: http://lynx.browser.org/\"\n+    exit\n+fi\n+\n+MY_DIR=\"$(cd \"$(dirname \"$0\")\" && pwd)\"\n+pushd \"${MY_DIR}\" &>/dev/null || exit 1\n+\n+echo \"Working directory: ${MY_DIR}\"\n+\n+DIST_DIR=${1:-\"./dist\"}\n+echo \"Dist directory: ${DIST_DIR}\"\n+\n+echo \"\"\n+\n+if [[ ! -f \"${DIST_DIR}/index.html\" ]]; then\n+   echo \"You should build website first.\"\n+   exit 1\n+fi\n+\n+mkdir -pv \"${DIST_DIR}\"\n+\n+readarray -d '' pages < <(find \"${DIST_DIR}\" -name '*.html' -print0)\n+echo \"Found ${#pages[@]} HTML files.\"\n+\n+echo \"Searching links.\"\n+mapfile -t links < <(printf '%s\\n' \"${pages[@]}\" | xargs -n 1 lynx -listonly -nonumbers -dump -display_charset=iso-8859-1 | grep -v \" \")\n+mapfile -t external_links < <(printf '%s\\n' \"${links[@]}\" | grep \"^https\\?://\" | grep -v \"http://localhost\" | grep -v \"http://link/\" | grep -v \"http://docker.local\" | grep -v \"https://github.com/apache/beam/edit/master/website/www/site/content/\" | sort | uniq)\n+echo \"Found ${#links[@]} links including ${#external_links[@]} unique external links.\"\n+\n+echo \"Checking links.\"\n+invalid_links=()\n+i=1\n+for external_link in \"${external_links[@]}\"\n+do\n+    redraw_progress_bar 50 1 $i ${#external_links[@]}\n+\n+    if ! curl -sSfL --max-time 60 --connect-timeout 30 --retry 3 -4 \"${external_link}\" > /dev/null ; then\n+        invalid_links+=(\"${external_link}\")\n+        echo \"${external_link}\"", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAzMzkwMw==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423033903", "bodyText": "L87 returns broken links with the reason why it's false like 404 not found, 429 request limit, etc. And the above line returns all of the invalid links as the result.", "author": "bntnam", "createdAt": "2020-05-11T13:21:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODQ5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyMDMzNA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423320334", "bodyText": "I think this is still a duplication. But it is fine, not really harmful.", "author": "aaltay", "createdAt": "2020-05-11T21:07:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODQ5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODU1MA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r422428550", "bodyText": "what does popd &>/dev/null  do ?", "author": "aaltay", "createdAt": "2020-05-09T00:21:29Z", "path": "website/www/check-links.sh", "diffHunk": "@@ -0,0 +1,93 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+set -euo pipefail\n+\n+\n+function redraw_progress_bar { # int barsize, int base, int current, int top\n+    # Source: https://stackoverflow.com/a/20311674\n+    local barsize=$1\n+    local base=$2\n+    local current=$3\n+    local top=$4\n+    local j=0\n+    local progress=$(( (barsize * (current - base)) / (top - base ) ))\n+    echo -n \"[\"\n+    for ((j=0; j < progress; j++)) ; do echo -n '='; done\n+    echo -n '=>'\n+    for ((j=progress; j < barsize ; j++)) ; do echo -n ' '; done\n+    echo -n \"] $current / $top \" $'\\r'\n+}\n+\n+if ! command -v lynx; then\n+    echo \"This script requires lynx to work properly.\"\n+    echo\n+    echo \"For more information, look at: http://lynx.browser.org/\"\n+    exit\n+fi\n+\n+MY_DIR=\"$(cd \"$(dirname \"$0\")\" && pwd)\"\n+pushd \"${MY_DIR}\" &>/dev/null || exit 1\n+\n+echo \"Working directory: ${MY_DIR}\"\n+\n+DIST_DIR=${1:-\"./dist\"}\n+echo \"Dist directory: ${DIST_DIR}\"\n+\n+echo \"\"\n+\n+if [[ ! -f \"${DIST_DIR}/index.html\" ]]; then\n+   echo \"You should build website first.\"\n+   exit 1\n+fi\n+\n+mkdir -pv \"${DIST_DIR}\"\n+\n+readarray -d '' pages < <(find \"${DIST_DIR}\" -name '*.html' -print0)\n+echo \"Found ${#pages[@]} HTML files.\"\n+\n+echo \"Searching links.\"\n+mapfile -t links < <(printf '%s\\n' \"${pages[@]}\" | xargs -n 1 lynx -listonly -nonumbers -dump -display_charset=iso-8859-1 | grep -v \" \")\n+mapfile -t external_links < <(printf '%s\\n' \"${links[@]}\" | grep \"^https\\?://\" | grep -v \"http://localhost\" | grep -v \"http://link/\" | grep -v \"http://docker.local\" | grep -v \"https://github.com/apache/beam/edit/master/website/www/site/content/\" | sort | uniq)\n+echo \"Found ${#links[@]} links including ${#external_links[@]} unique external links.\"\n+\n+echo \"Checking links.\"\n+invalid_links=()\n+i=1\n+for external_link in \"${external_links[@]}\"\n+do\n+    redraw_progress_bar 50 1 $i ${#external_links[@]}\n+\n+    if ! curl -sSfL --max-time 60 --connect-timeout 30 --retry 3 -4 \"${external_link}\" > /dev/null ; then\n+        invalid_links+=(\"${external_link}\")\n+        echo \"${external_link}\"\n+    fi\n+    i=$((i+1))\n+done\n+# Clear line - hide progress bar\n+echo -n -e \"\\033[2K\"\n+\n+\n+if [[ ${#invalid_links[@]} -ne 0 ]]; then\n+    echo \"Found ${#invalid_links[@]} invalid links: \"\n+    printf '%s\\n' \"${invalid_links[@]}\"\n+else\n+    echo \"All links work\"\n+fi\n+\n+popd &>/dev/null || exit 1", "originalCommit": "f5d2053f680df26f91029923f2d726fc223a38eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAyODM1NA==", "url": "https://github.com/apache/beam/pull/11554#discussion_r423028354", "bodyText": "My colleague worked on it. As he said, sometimes the script does not work properly because it expects to be run from a specific directory. This means that with these lines below, the script will always work because the current directory is set to the location of the script:\nAt the start:\nMY_DIR=\"$(cd \"$(dirname \"$0\")\" && pwd)\"\npushd \"${MY_DIR}\" &>/dev/null || exit 1\n\nAt the end:\npopd &>/dev/null || exit 1", "author": "bntnam", "createdAt": "2020-05-11T13:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyODU1MA=="}], "type": "inlineReview"}, {"oid": "070de5455189db5e45465945b7264c7b3f9a57cd", "url": "https://github.com/apache/beam/commit/070de5455189db5e45465945b7264c7b3f9a57cd", "message": "Adapted to reviews", "committedDate": "2020-05-11T15:31:08Z", "type": "forcePushed"}, {"oid": "ba8b982110a034386641454725b85980a740c559", "url": "https://github.com/apache/beam/commit/ba8b982110a034386641454725b85980a740c559", "message": "Adapted to reviews", "committedDate": "2020-05-11T15:51:38Z", "type": "forcePushed"}, {"oid": "1af232ea6c609b4dabb464c44e2b9d31b1e593b6", "url": "https://github.com/apache/beam/commit/1af232ea6c609b4dabb464c44e2b9d31b1e593b6", "message": "Moved files from src to www", "committedDate": "2020-05-12T16:04:02Z", "type": "commit"}, {"oid": "f62983c511e16426ce09c48501c1061a9a0b04a3", "url": "https://github.com/apache/beam/commit/f62983c511e16426ce09c48501c1061a9a0b04a3", "message": "Applied changes - Migrated Jekyll to Hugo\n\nSetup Docsy themes\n\nFixed github_sample\n\nAdded Works With logos\n\nSync new update\n\nAdopted to reviews & Updated content\n\nExcluded website build files\n\nAdded Apache License\n\nDocker removed root\n\nModified test link checker\n\nLatest sync", "committedDate": "2020-05-12T16:04:02Z", "type": "commit"}, {"oid": "9b869ed3a3fdc37903e5c2f8ce811a0ee347c6f6", "url": "https://github.com/apache/beam/commit/9b869ed3a3fdc37903e5c2f8ce811a0ee347c6f6", "message": "Cleaned unused Jekyll files", "committedDate": "2020-05-12T16:04:02Z", "type": "commit"}, {"oid": "996bd2f566e8054ebebcf937829c37dbebbbce0e", "url": "https://github.com/apache/beam/commit/996bd2f566e8054ebebcf937829c37dbebbbce0e", "message": "Appended index.html to aliases", "committedDate": "2020-05-12T16:04:02Z", "type": "forcePushed"}, {"oid": "af64e527f04294d6c6f5d8678d09fbec3e5f54f7", "url": "https://github.com/apache/beam/commit/af64e527f04294d6c6f5d8678d09fbec3e5f54f7", "message": "Adapted to reviews", "committedDate": "2020-05-12T16:24:55Z", "type": "commit"}, {"oid": "822ca3b491a6fa4cae50c435974ccce16cec29fb", "url": "https://github.com/apache/beam/commit/822ca3b491a6fa4cae50c435974ccce16cec29fb", "message": "Appended index.html to aliases", "committedDate": "2020-05-12T16:24:55Z", "type": "forcePushed"}, {"oid": "d277bd5bf3f9942d504fcc26f196fa3439838372", "url": "https://github.com/apache/beam/commit/d277bd5bf3f9942d504fcc26f196fa3439838372", "message": "Fixes based on diff script", "committedDate": "2020-05-12T23:04:14Z", "type": "forcePushed"}, {"oid": "141b36bd7e94e8057ee2c76bd6f5de46b64e2470", "url": "https://github.com/apache/beam/commit/141b36bd7e94e8057ee2c76bd6f5de46b64e2470", "message": "Fixes based on diff script", "committedDate": "2020-05-12T23:51:01Z", "type": "forcePushed"}, {"oid": "51c4b42856b0a9ba90e05fa76962c90057d62661", "url": "https://github.com/apache/beam/commit/51c4b42856b0a9ba90e05fa76962c90057d62661", "message": "Fixes based on diff script", "committedDate": "2020-05-13T14:38:29Z", "type": "forcePushed"}, {"oid": "e21dd0fcac22329e3cd54c8da40741a4447998e3", "url": "https://github.com/apache/beam/commit/e21dd0fcac22329e3cd54c8da40741a4447998e3", "message": "Fixes based on diff script", "committedDate": "2020-05-13T14:49:14Z", "type": "commit"}, {"oid": "e21dd0fcac22329e3cd54c8da40741a4447998e3", "url": "https://github.com/apache/beam/commit/e21dd0fcac22329e3cd54c8da40741a4447998e3", "message": "Fixes based on diff script", "committedDate": "2020-05-13T14:49:14Z", "type": "forcePushed"}, {"oid": "0accec8e154606d57f5b49c0d4f92492a25d3a64", "url": "https://github.com/apache/beam/commit/0accec8e154606d57f5b49c0d4f92492a25d3a64", "message": "Corrected path flink_runner.gradle", "committedDate": "2020-05-14T08:09:16Z", "type": "commit"}]}