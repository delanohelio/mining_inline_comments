{"pr_number": 11166, "pr_title": "[BEAM-7923] Emit info when capture control options are configured.", "pr_createdAt": "2020-03-18T23:50:09Z", "pr_url": "https://github.com/apache/beam/pull/11166", "timeline": [{"oid": "de965ae87c5ea4cf93792c16293fb3fbc8fbf405", "url": "https://github.com/apache/beam/commit/de965ae87c5ea4cf93792c16293fb3fbc8fbf405", "message": "[BEAM-7923] Emit info when capture control options are configured.\n\n1. Info logging to notify users about invoking evict_captured_data on\nchanging capture_duration, capture_size_limit, and capturable_sources\noptions. The users have to explicitly evict captured data because the\nprocess is destructive and the usage should be the same as evicting\ncaptured data even when they don't modify options at all.\n2. Info logging about behavior difference between enabling capture\nreplay and disabling it. This functions as a switch enabling/disabling\nthe replayability, thus works without the need of evicting captured\ndata.\n3. Changed the default capture_duration from 5s to 60s.", "committedDate": "2020-03-18T23:49:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIzMDU0OA==", "url": "https://github.com/apache/beam/pull/11166#discussion_r395230548", "bodyText": "Replayed for replayability? How about this? I'm not sure what's a good phrasing, but...\nAlso, maybe capture->captured data?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      'computations will be replayed for replayability. If no capture is '\n          \n          \n            \n                      'computations will be replayed for consistent results. If no captured data is '", "author": "pabloem", "createdAt": "2020-03-19T18:20:44Z", "path": "sdks/python/apache_beam/runners/interactive/interactive_beam.py", "diffHunk": "@@ -64,11 +67,33 @@ def enable_capture_replay(self, value):\n     and pipeline runs always use the same data captured; False - Disables\n     capture of replayable source data so that following PCollection evaluation\n     and pipeline runs always use new data from sources.\"\"\"\n+    # This makes sure the log handler is configured correctly in case the\n+    # options are configured in an early stage.\n+    _ = ie.current_env()\n+    if value:\n+      _LOGGER.info(\n+          'Capture replay is enabled. When a PCollection is evaluated or the '\n+          'pipeline is executed, existing data captured from previous '\n+          'computations will be replayed for replayability. If no capture is '", "originalCommit": "de965ae87c5ea4cf93792c16293fb3fbc8fbf405", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIzMDgwNQ==", "url": "https://github.com/apache/beam/pull/11166#discussion_r395230805", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      'You have disabled capture replay. The next time a PCollection is '\n          \n          \n            \n                      'Capture replay is disabled. The next time a PCollection is '", "author": "pabloem", "createdAt": "2020-03-19T18:21:10Z", "path": "sdks/python/apache_beam/runners/interactive/interactive_beam.py", "diffHunk": "@@ -64,11 +67,33 @@ def enable_capture_replay(self, value):\n     and pipeline runs always use the same data captured; False - Disables\n     capture of replayable source data so that following PCollection evaluation\n     and pipeline runs always use new data from sources.\"\"\"\n+    # This makes sure the log handler is configured correctly in case the\n+    # options are configured in an early stage.\n+    _ = ie.current_env()\n+    if value:\n+      _LOGGER.info(\n+          'Capture replay is enabled. When a PCollection is evaluated or the '\n+          'pipeline is executed, existing data captured from previous '\n+          'computations will be replayed for replayability. If no capture is '\n+          'available, new data from capturable sources will be captured.')\n+    else:\n+      _LOGGER.info(\n+          'You have disabled capture replay. The next time a PCollection is '", "originalCommit": "de965ae87c5ea4cf93792c16293fb3fbc8fbf405", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIzMTIwMA==", "url": "https://github.com/apache/beam/pull/11166#discussion_r395231200", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      'captured from capturable sources. You will not have replayability '\n          \n          \n            \n                      'consumed from sources in the pipeline. You will not have replayability '", "author": "pabloem", "createdAt": "2020-03-19T18:21:50Z", "path": "sdks/python/apache_beam/runners/interactive/interactive_beam.py", "diffHunk": "@@ -64,11 +67,33 @@ def enable_capture_replay(self, value):\n     and pipeline runs always use the same data captured; False - Disables\n     capture of replayable source data so that following PCollection evaluation\n     and pipeline runs always use new data from sources.\"\"\"\n+    # This makes sure the log handler is configured correctly in case the\n+    # options are configured in an early stage.\n+    _ = ie.current_env()\n+    if value:\n+      _LOGGER.info(\n+          'Capture replay is enabled. When a PCollection is evaluated or the '\n+          'pipeline is executed, existing data captured from previous '\n+          'computations will be replayed for replayability. If no capture is '\n+          'available, new data from capturable sources will be captured.')\n+    else:\n+      _LOGGER.info(\n+          'You have disabled capture replay. The next time a PCollection is '\n+          'evaluated or the pipeline is executed, new data will always be '\n+          'captured from capturable sources. You will not have replayability '", "originalCommit": "de965ae87c5ea4cf93792c16293fb3fbc8fbf405", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIzMjQwNQ==", "url": "https://github.com/apache/beam/pull/11166#discussion_r395232405", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      'allow new data being captured under the updated size limit the '\n          \n          \n            \n                      'allow new data to be captured under the updated size limit, the '", "author": "pabloem", "createdAt": "2020-03-19T18:23:53Z", "path": "sdks/python/apache_beam/runners/interactive/interactive_beam.py", "diffHunk": "@@ -109,7 +144,16 @@ def capture_size_limit(self, value):\n       # Sets the capture size limit to 1GB.\n       interactive_beam.options.capture_size_limit = 1e9\n     \"\"\"\n-    self.capture_control._capture_size_limit = value\n+    if self.capture_control._capture_size_limit != value:\n+      _ = ie.current_env()\n+      _LOGGER.info(\n+          'You have changed capture size limit from %s bytes to %s bytes. To '\n+          'allow new data being captured under the updated size limit the '", "originalCommit": "de965ae87c5ea4cf93792c16293fb3fbc8fbf405", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIzMjg1NA==", "url": "https://github.com/apache/beam/pull/11166#discussion_r395232854", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      'To allow new data being captured for the updated duration the next '\n          \n          \n            \n                      'To allow new data to be captured for the updated duration, the next '", "author": "pabloem", "createdAt": "2020-03-19T18:24:36Z", "path": "sdks/python/apache_beam/runners/interactive/interactive_beam.py", "diffHunk": "@@ -92,7 +117,17 @@ def capture_duration(self, value):\n       interactive_beam.collect(some_pcoll)\n     \"\"\"\n     assert value.total_seconds() > 0, 'Duration must be a positive value.'\n-    self.capture_control._capture_duration = value\n+    if self.capture_control._capture_duration.total_seconds(\n+    ) != value.total_seconds():\n+      _ = ie.current_env()\n+      _LOGGER.info(\n+          'You have changed capture duration from %s seconds to %s seconds. '\n+          'To allow new data being captured for the updated duration the next '", "originalCommit": "de965ae87c5ea4cf93792c16293fb3fbc8fbf405", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIzMzI4MA==", "url": "https://github.com/apache/beam/pull/11166#discussion_r395233280", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    'altered sources being captured the next time a PCollection is '\n          \n          \n            \n                    'altered sources to be captured the next time a PCollection is '", "author": "pabloem", "createdAt": "2020-03-19T18:25:21Z", "path": "sdks/python/apache_beam/runners/interactive/interactive_beam.py", "diffHunk": "@@ -64,11 +67,33 @@ def enable_capture_replay(self, value):\n     and pipeline runs always use the same data captured; False - Disables\n     capture of replayable source data so that following PCollection evaluation\n     and pipeline runs always use new data from sources.\"\"\"\n+    # This makes sure the log handler is configured correctly in case the\n+    # options are configured in an early stage.\n+    _ = ie.current_env()\n+    if value:\n+      _LOGGER.info(\n+          'Capture replay is enabled. When a PCollection is evaluated or the '\n+          'pipeline is executed, existing data captured from previous '\n+          'computations will be replayed for replayability. If no capture is '\n+          'available, new data from capturable sources will be captured.')\n+    else:\n+      _LOGGER.info(\n+          'You have disabled capture replay. The next time a PCollection is '\n+          'evaluated or the pipeline is executed, new data will always be '\n+          'captured from capturable sources. You will not have replayability '\n+          'until re-enabling this option.')\n     self.capture_control._enable_capture_replay = value\n \n   @property\n   def capturable_sources(self):\n-    \"\"\"Interactive Beam automatically captures data from sources in this set.\"\"\"\n+    \"\"\"Interactive Beam automatically captures data from sources in this set.\n+    \"\"\"\n+    _ = ie.current_env()\n+    _LOGGER.info(\n+        'If you alter the capturable sources, to allow new data for the '\n+        'altered sources being captured the next time a PCollection is '", "originalCommit": "de965ae87c5ea4cf93792c16293fb3fbc8fbf405", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d50a4030af29db5efd2b69f3b72663754b8c0031", "url": "https://github.com/apache/beam/commit/d50a4030af29db5efd2b69f3b72663754b8c0031", "message": "Apply suggestions from code review\r\n\r\nApplied all suggestions and will need another commit to format this.\n\nCo-Authored-By: Pablo <pabloem@users.noreply.github.com>", "committedDate": "2020-03-19T18:42:32Z", "type": "commit"}, {"oid": "9f28f14bb56e9f107d0620d147526fd76451e435", "url": "https://github.com/apache/beam/commit/9f28f14bb56e9f107d0620d147526fd76451e435", "message": "format", "committedDate": "2020-03-19T18:47:00Z", "type": "commit"}]}