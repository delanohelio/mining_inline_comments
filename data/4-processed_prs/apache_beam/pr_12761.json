{"pr_number": 12761, "pr_title": "[BEAM-10853] Fixing copy name issue: Single name for all copies", "pr_createdAt": "2020-09-02T20:02:14Z", "pr_url": "https://github.com/apache/beam/pull/12761", "timeline": [{"oid": "653e95b438b8a45a66db63b7ea547cd25f2a8df1", "url": "https://github.com/apache/beam/commit/653e95b438b8a45a66db63b7ea547cd25f2a8df1", "message": "Fixing copy name issue: Single name for all copies", "committedDate": "2020-09-02T20:01:23Z", "type": "commit"}, {"oid": "ea30204fcdd3050899858afc4d10cde3c57307d8", "url": "https://github.com/apache/beam/commit/ea30204fcdd3050899858afc4d10cde3c57307d8", "message": "Fix formatting", "committedDate": "2020-09-02T20:08:04Z", "type": "commit"}, {"oid": "87299757455e0c65b1d54232feba0016020de0c8", "url": "https://github.com/apache/beam/commit/87299757455e0c65b1d54232feba0016020de0c8", "message": "fixup", "committedDate": "2020-09-02T23:46:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIwOTIyMw==", "url": "https://github.com/apache/beam/pull/12761#discussion_r483209223", "bodyText": "May be update the seed to _bq_uuid() function instead of concatenating two UUIDs ?\nAlso, I'm curious why the existing seed didn't work for this user.", "author": "chamikaramj", "createdAt": "2020-09-03T19:34:20Z", "path": "sdks/python/apache_beam/io/gcp/bigquery_file_loads.py", "diffHunk": "@@ -356,8 +359,13 @@ def process(self, element, job_name_prefix=None):\n       copy_from_reference.projectId = vp.RuntimeValueProvider.get_value(\n           'project', str, '')\n \n-    copy_job_name = '%s_%s' % (\n+    copy_job_name = '%s_%s_%s' % (\n         job_name_prefix,\n+        _bq_uuid(\n+            '%s:%s.%s' % (", "originalCommit": "87299757455e0c65b1d54232feba0016020de0c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIxNjY4Mw==", "url": "https://github.com/apache/beam/pull/12761#discussion_r483216683", "bodyText": "I've made the change, and added a smallmodification to a test that reproduces this issue.", "author": "pabloem", "createdAt": "2020-09-03T19:49:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIwOTIyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIyMDE0Mw==", "url": "https://github.com/apache/beam/pull/12761#discussion_r483220143", "bodyText": "Addressing the q about why this did not work - the BQ job names are generated by joining a prefix with the hashof a table name. COPY jobs are necessary when we write to multiple temporary tables, and copy to a single destination table.\nBecause we were hashing the destination table name, ALL the copy jobs had the same destination, so they had the same hash, and thus the same job name - and this would cause a failure.", "author": "pabloem", "createdAt": "2020-09-03T19:57:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIwOTIyMw=="}], "type": "inlineReview"}, {"oid": "59b6c40c9adf1d8a1586d304cec6b9cf973367e4", "url": "https://github.com/apache/beam/commit/59b6c40c9adf1d8a1586d304cec6b9cf973367e4", "message": "Addinga test case to verify multi-partitioned imports work.", "committedDate": "2020-09-03T19:46:27Z", "type": "commit"}, {"oid": "17a4b52e3022a50e4cce361ccadbe3ad3a25365b", "url": "https://github.com/apache/beam/commit/17a4b52e3022a50e4cce361ccadbe3ad3a25365b", "message": "Fixing copy job name generation", "committedDate": "2020-09-03T19:46:51Z", "type": "commit"}]}