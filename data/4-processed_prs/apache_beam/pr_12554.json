{"pr_number": 12554, "pr_title": "[BEAM-9615] Map user types to Schema reps.", "pr_createdAt": "2020-08-12T19:11:43Z", "pr_url": "https://github.com/apache/beam/pull/12554", "timeline": [{"oid": "a893db9a5c55a55462b459c1f61be4703a67a456", "url": "https://github.com/apache/beam/commit/a893db9a5c55a55462b459c1f61be4703a67a456", "message": "[BEAM-9615] Map user types to Schema reps.", "committedDate": "2020-08-12T19:07:51Z", "type": "commit"}, {"oid": "5563550d4bab05b642f18aec0f848c62e7a6b2a3", "url": "https://github.com/apache/beam/commit/5563550d4bab05b642f18aec0f848c62e7a6b2a3", "message": "Attempt to update gogradle.lock", "committedDate": "2020-08-12T21:12:42Z", "type": "commit"}, {"oid": "d541a53c650ec3efb1d3771a8d7407b4cc9eb5f2", "url": "https://github.com/apache/beam/commit/d541a53c650ec3efb1d3771a8d7407b4cc9eb5f2", "message": "!fixup gogradle.lock take two", "committedDate": "2020-08-12T22:35:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5MjU2Nw==", "url": "https://github.com/apache/beam/pull/12554#discussion_r470392567", "bodyText": "I get why this is ignoring the \"id\" field for the proto, but why \"options\"? This test seems to already be testing options in the other direction (options are respected when converting from schemas to reflect types). I figure it would also want to test that options are included as expected when converting to schemas.", "author": "youngoli", "createdAt": "2020-08-14T03:41:25Z", "path": "sdks/go/pkg/beam/core/runtime/graphx/schema/schema_test.go", "diffHunk": "@@ -161,18 +354,22 @@ func TestSchemaConversion(t *testing.T) {\n \t\t\t\tif err != nil {\n \t\t\t\t\tt.Fatalf(\"error ToType(%v) = %v\", test.st, err)\n \t\t\t\t}\n-\n-\t\t\t\tif d := cmp.Diff(reflect.New(test.rt).Elem().Interface(), reflect.New(got).Elem().Interface()); d != \"\" {\n-\t\t\t\t\tt.Errorf(\"diff (-want, +got): %v\", d)\n+\t\t\t\tif !test.rt.AssignableTo(got) {\n+\t\t\t\t\tt.Errorf(\"%v not assignable to %v\", test.rt, got)\n+\t\t\t\t\tif d := cmp.Diff(reflect.New(test.rt).Elem().Interface(), reflect.New(got).Elem().Interface()); d != \"\" {\n+\t\t\t\t\t\tt.Errorf(\"diff (-want, +got): %v\", d)\n+\t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\n \t\t\t{\n \t\t\t\tgot, err := FromType(test.rt)\n \t\t\t\tif err != nil {\n \t\t\t\t\tt.Fatalf(\"error FromType(%v) = %v\", test.rt, err)\n \t\t\t\t}\n-\n-\t\t\t\tif d := cmp.Diff(test.st, got); d != \"\" {\n+\t\t\t\tif d := cmp.Diff(test.st, got,\n+\t\t\t\t\tprotocmp.Transform(),\n+\t\t\t\t\tprotocmp.IgnoreFields(proto.MessageV2(&pipepb.Schema{}), \"id\", \"options\"),", "originalCommit": "d541a53c650ec3efb1d3771a8d7407b4cc9eb5f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5OTg0NQ==", "url": "https://github.com/apache/beam/pull/12554#discussion_r470399845", "bodyText": "I'll try removing it before submitting.\nI might have added this at an earlier iteration when the options also contained the fully qualified paths for comparison, which could vary from machine to machine. Those aren't being saved in the options anymore so it's fair for use to get rid of at this point I think....", "author": "lostluck", "createdAt": "2020-08-14T04:11:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5MjU2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc0NjE2Mg==", "url": "https://github.com/apache/beam/pull/12554#discussion_r470746162", "bodyText": "As a note, it's good practice to approve but still request small changes when the other person is able to merge themselves. As committers we're already responsible to ensure the code is good for the project, but allowing folks to be unblocked is good for the community.", "author": "lostluck", "createdAt": "2020-08-14T17:03:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5MjU2Nw=="}], "type": "inlineReview"}, {"oid": "dfd6356566eface737bb2d9df433a24d59331a8b", "url": "https://github.com/apache/beam/commit/dfd6356566eface737bb2d9df433a24d59331a8b", "message": "Don't ignore options in comparison.", "committedDate": "2020-08-14T16:39:17Z", "type": "commit"}]}