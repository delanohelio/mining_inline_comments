{"pr_number": 13290, "pr_title": "[BEAM-11074] build_release_candidate usability improvements.", "pr_createdAt": "2020-11-10T04:49:57Z", "pr_url": "https://github.com/apache/beam/pull/13290", "timeline": [{"oid": "033d56738e11306cd8bf6cd6e27ead605486a3d5", "url": "https://github.com/apache/beam/commit/033d56738e11306cd8bf6cd6e27ead605486a3d5", "message": "[BEAM-11074] build_release_candidate usability improvements.\n\nSpecifically, this change checks whether a tag exists before calling the gradle release plugin, allowing the user to either delete the existing tag or skip creating the tag. Also avoids going into interactive commit messages with SVN, instead using commit messages built-in to the script.", "committedDate": "2020-11-10T04:45:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDM4Ng==", "url": "https://github.com/apache/beam/pull/13290#discussion_r520760386", "bodyText": "Can you add a comment explaining how this deletes the tag?", "author": "ibzib", "createdAt": "2020-11-10T17:57:51Z", "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -116,13 +116,21 @@ if [[ $confirmation = \"y\" ]]; then\n   echo \"-------------Building Java Artifacts with Gradle-------------\"\n   git config credential.helper store\n \n-  ./gradlew release -Prelease.newVersion=${RELEASE}-SNAPSHOT \\\n-                -Prelease.releaseVersion=${RELEASE}-RC${RC_NUM} \\\n-                -Prelease.useAutomaticVersion=true --info --no-daemon\n-\n-  git push origin \"${RELEASE_BRANCH}\"\n-  git push origin \"v${RELEASE}-RC${RC_NUM}\"\n-\n+  if git rev-parse \"v${RELEASE}-RC${RC_NUM}\" >/dev/null 2>&1; then\n+    echo \"Tag v${RELEASE}-RC${RC_NUM} already exists.\"\n+    echo \"Delete the tag and create a new tag commit (y) or skip this step (n)? [y/N]\"\n+    read confirmation\n+    if [[ $confirmation = \"y\" ]]; then\n+      git push origin :refs/tags/v${RELEASE}-RC${RC_NUM}", "originalCommit": "033d56738e11306cd8bf6cd6e27ead605486a3d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk3NjQ4Ng==", "url": "https://github.com/apache/beam/pull/13290#discussion_r520976486", "bodyText": "Done.", "author": "youngoli", "createdAt": "2020-11-11T01:02:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDM4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDk5MA==", "url": "https://github.com/apache/beam/pull/13290#discussion_r520760990", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if [[ $confirmation = \"y\" ]]; then # Expected to only be \"n\" if user chose to skip creating tag.\n          \n          \n            \n              if [[ $confirmation = \"y\" ]]; then # Expected to be \"y\" unless user chose to skip creating tag.", "author": "ibzib", "createdAt": "2020-11-10T17:58:48Z", "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -116,13 +116,21 @@ if [[ $confirmation = \"y\" ]]; then\n   echo \"-------------Building Java Artifacts with Gradle-------------\"\n   git config credential.helper store\n \n-  ./gradlew release -Prelease.newVersion=${RELEASE}-SNAPSHOT \\\n-                -Prelease.releaseVersion=${RELEASE}-RC${RC_NUM} \\\n-                -Prelease.useAutomaticVersion=true --info --no-daemon\n-\n-  git push origin \"${RELEASE_BRANCH}\"\n-  git push origin \"v${RELEASE}-RC${RC_NUM}\"\n-\n+  if git rev-parse \"v${RELEASE}-RC${RC_NUM}\" >/dev/null 2>&1; then\n+    echo \"Tag v${RELEASE}-RC${RC_NUM} already exists.\"\n+    echo \"Delete the tag and create a new tag commit (y) or skip this step (n)? [y/N]\"\n+    read confirmation\n+    if [[ $confirmation = \"y\" ]]; then\n+      git push origin :refs/tags/v${RELEASE}-RC${RC_NUM}\n+    fi\n+  fi\n+  if [[ $confirmation = \"y\" ]]; then # Expected to only be \"n\" if user chose to skip creating tag.", "originalCommit": "033d56738e11306cd8bf6cd6e27ead605486a3d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk3NjQzMQ==", "url": "https://github.com/apache/beam/pull/13290#discussion_r520976431", "bodyText": "Done.", "author": "youngoli", "createdAt": "2020-11-11T01:02:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDk5MA=="}], "type": "inlineReview"}, {"oid": "2699c9dea45750a2577e733bdd45788b2aa43261", "url": "https://github.com/apache/beam/commit/2699c9dea45750a2577e733bdd45788b2aa43261", "message": "[BEAM-11074] Fixup", "committedDate": "2020-11-11T00:41:56Z", "type": "commit"}]}