{"pr_number": 12857, "pr_title": "[BEAM-9547] Add not_implemented_ok", "pr_createdAt": "2020-09-16T20:05:59Z", "pr_url": "https://github.com/apache/beam/pull/12857", "timeline": [{"oid": "48b3da3d125fc5d81da8c26fd1a46195725730a7", "url": "https://github.com/apache/beam/commit/48b3da3d125fc5d81da8c26fd1a46195725730a7", "message": "Add not_implemented_ok", "committedDate": "2020-09-16T19:57:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxOTM5OA==", "url": "https://github.com/apache/beam/pull/12857#discussion_r490019398", "bodyText": "What about doctests where both wont_implement_error and not_implemented_ok are True? (On that note, since we're also handling name errors, does the contents of this really matter anymore?)", "author": "robertwb", "createdAt": "2020-09-17T07:10:44Z", "path": "sdks/python/apache_beam/dataframe/doctests.py", "diffHunk": "@@ -316,31 +354,39 @@ def run(self, test, **kwargs):\n         example.source = 'pass'\n         example.want = ''\n         self.skipped += 1\n-      elif example.exc_msg is None and any(\n-          wont_implement(example)\n-          for wont_implement in self._wont_implement_ok.get(test.name, [])):\n+      elif example.exc_msg is None and self._is_wont_implement_ok(example,\n+                                                                  test):\n+        # Don't fail doctests that raise this error.\n+        example.exc_msg = '%s: ...' % WONT_IMPLEMENT\n+      elif example.exc_msg is None and self._is_not_implemented_ok(example,", "originalCommit": "48b3da3d125fc5d81da8c26fd1a46195725730a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM3NjYxNg==", "url": "https://github.com/apache/beam/pull/12857#discussion_r490376616", "bodyText": "does the contents of this really matter anymore?\n\nDo you mean the contents of exc_msg? It sort of matters because it's passed back to us in \"want\" in the output checker, then we can distinguish which exception is ok. But it is worth noting that for both of these cases the exc_msg is not actually being used by doctests as one might expect, since we short circuit it in the output checker. I think we could put whatever we want in the exc_msg.\n\nWhat about doctests where both wont_implement_error and not_implemented_ok are True?\n\nYeah overlap between the three sets is not handled well, there's just a precedence skip > wont_implement_ok > not_implemented_ok. Maybe there should be logic to enforce there's no overlap between wont_implement/not_implemented, I don't think we should allow one example to throw either error.", "author": "TheNeuralBit", "createdAt": "2020-09-17T16:11:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxOTM5OA=="}], "type": "inlineReview"}]}