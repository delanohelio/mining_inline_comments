{"pr_number": 12803, "pr_title": "[BEAM-10762] Fix artifact staging bug in Flink/Spark uber jar runners.", "pr_createdAt": "2020-09-10T00:05:10Z", "pr_url": "https://github.com/apache/beam/pull/12803", "timeline": [{"oid": "27f4836be06f38daf5741847c77e557b8b26a201", "url": "https://github.com/apache/beam/commit/27f4836be06f38daf5741847c77e557b8b26a201", "message": "[BEAM-10762] Fix artifact staging bug in Flink/Spark uber jar runners.\n\n- Replace the obsolete artifact staging token with the NO ARTIFACTS placeholder.\n\n- Add a test that verifies pipelines pass when no artifacts are staged.", "committedDate": "2020-09-10T00:01:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MTM2NA==", "url": "https://github.com/apache/beam/pull/12803#discussion_r486681364", "bodyText": "Nit: Should we pull this out as a constant somewhere (as we do with the other URNs)?", "author": "robertwb", "createdAt": "2020-09-10T23:06:36Z", "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkPipelineRunner.java", "diffHunk": "@@ -170,13 +169,16 @@ public static void main(String[] args) throws Exception {\n     Pipeline pipeline = PortablePipelineJarUtils.getPipelineFromClasspath(baseJobName);\n     Struct originalOptions = PortablePipelineJarUtils.getPipelineOptionsFromClasspath(baseJobName);\n \n-    // Flink pipeline jars distribute and retrieve artifacts via the classpath.\n-    PortablePipelineOptions portablePipelineOptions =\n-        PipelineOptionsTranslation.fromProto(originalOptions).as(PortablePipelineOptions.class);\n-    portablePipelineOptions.setRetrievalServiceType(RetrievalServiceType.CLASSLOADER);\n-    String retrievalToken = PortablePipelineJarUtils.getArtifactManifestUri(baseJobName);\n+    // The retrieval token is only required by the legacy artifact service, which the Flink runner\n+    // no longer uses.\n+    String retrievalToken =\n+        ArtifactApi.CommitManifestResponse.Constants.NO_ARTIFACTS_STAGED_TOKEN", "originalCommit": "27f4836be06f38daf5741847c77e557b8b26a201", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4NzcyNw==", "url": "https://github.com/apache/beam/pull/12803#discussion_r486687727", "bodyText": "I won't since this part of the API is deprecated.", "author": "ibzib", "createdAt": "2020-09-10T23:27:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MTM2NA=="}], "type": "inlineReview"}]}