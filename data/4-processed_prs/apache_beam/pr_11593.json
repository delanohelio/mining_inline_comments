{"pr_number": 11593, "pr_title": "[BEAM-9870] Always generate Dataflow-compatible FnApi protos.", "pr_createdAt": "2020-05-01T22:40:13Z", "pr_url": "https://github.com/apache/beam/pull/11593", "timeline": [{"oid": "cf98b80779cfb44ab79787f144bbaecad4867e88", "url": "https://github.com/apache/beam/commit/cf98b80779cfb44ab79787f144bbaecad4867e88", "message": "[BEAM-9870] Always generate Dataflow-compatible FnApi protos.\n\nFor various reasons, Dataflow patches up the proto representations of side inputs.\nThis change ensures these mutations are reflected regardless of whether FnAPI was\nexplicitly requested.\n\nAfter this change the Beam protos produced are identical (though the v1beta3\nrepresentation may change significantly).", "committedDate": "2020-05-01T22:35:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3MTk1Mg==", "url": "https://github.com/apache/beam/pull/11593#discussion_r418771952", "bodyText": "I'm a bit confused about the purpose of this change, if new_side_input is only used when use_fn_api is True?", "author": "ibzib", "createdAt": "2020-05-01T23:00:36Z", "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -345,7 +345,7 @@ def visit_transform(self, transform_node):\n           for ix, side_input in enumerate(transform_node.side_inputs):\n             access_pattern = side_input._side_input_data().access_pattern\n             if access_pattern == common_urns.side_inputs.ITERABLE.urn:\n-              if use_unified_worker:\n+              if use_unified_worker or not use_fn_api:", "originalCommit": "cf98b80779cfb44ab79787f144bbaecad4867e88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3NzgzMg==", "url": "https://github.com/apache/beam/pull/11593#discussion_r418777832", "bodyText": "The coder gets updated.", "author": "robertwb", "createdAt": "2020-05-01T23:27:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3MTk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc4MTE2Nw==", "url": "https://github.com/apache/beam/pull/11593#discussion_r418781167", "bodyText": "So side_input.pvalue.element_type = typehints.Any is a side effect and new_side_input = _DataflowIterableSideInput(side_input) has no effect?", "author": "ibzib", "createdAt": "2020-05-01T23:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3MTk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU2MjMzNA==", "url": "https://github.com/apache/beam/pull/11593#discussion_r419562334", "bodyText": "Yes, in non-FnAPI mode.", "author": "robertwb", "createdAt": "2020-05-04T16:25:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3MTk1Mg=="}], "type": "inlineReview"}, {"oid": "61827cd315a5d34702d0e6dda2eb3b34a0a548be", "url": "https://github.com/apache/beam/commit/61827cd315a5d34702d0e6dda2eb3b34a0a548be", "message": "Update test.", "committedDate": "2020-05-01T23:30:20Z", "type": "commit"}]}