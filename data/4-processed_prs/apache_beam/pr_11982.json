{"pr_number": 11982, "pr_title": "[BEAM-6892] Supporting bucket auto-creation for Dataflow.", "pr_createdAt": "2020-06-10T23:59:10Z", "pr_url": "https://github.com/apache/beam/pull/11982", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3ODQwNg==", "url": "https://github.com/apache/beam/pull/11982#discussion_r439078406", "bodyText": "I realize that there's a check for this in _create_default_gcs_bucket, but this method should fail if kms_key is set. Otherwise, it's saying that it's okay to have a default bucket with a KMS key.\n(The default bucket should not use a KMS key, and if a KMS key is specified Beam should not use a bucket with some other key (KMS or Google managed).)\nRefs:\n#8135 (comment)\nhttps://github.com/apache/beam/pull/8830/files", "author": "udim", "createdAt": "2020-06-11T21:24:34Z", "path": "sdks/python/apache_beam/io/gcp/gcsio.py", "diffHunk": "@@ -110,6 +110,27 @@ def parse_gcs_path(gcs_path, object_optional=False):\n   return match.group(1), match.group(2)\n \n \n+def default_gcs_bucket_name(project, region):\n+  from hashlib import md5\n+  return 'dataflow-staging-%s-%s' % (\n+      region, md5(project.encode('utf8')).hexdigest())\n+\n+\n+def get_or_create_default_gcs_bucket(project, region, kms_key=None):", "originalCommit": "e343bd8c145320217835dcf126a80c8bc5bc6e7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA5NDcxNQ==", "url": "https://github.com/apache/beam/pull/11982#discussion_r439094715", "bodyText": "okay I've made this not work in that case. WDYT?", "author": "pabloem", "createdAt": "2020-06-11T21:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3ODQwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE0MTQwNg==", "url": "https://github.com/apache/beam/pull/11982#discussion_r439141406", "bodyText": "I still need to review the rest of the code. Can look tomorrow, overloaded today", "author": "udim", "createdAt": "2020-06-12T00:18:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3ODQwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NDc2OA==", "url": "https://github.com/apache/beam/pull/11982#discussion_r439674768", "bodyText": "I don't understand this change - the order shouldn't matter, right?", "author": "udim", "createdAt": "2020-06-12T23:06:05Z", "path": "sdks/python/apache_beam/options/pipeline_options_validator_test.py", "diffHunk": "@@ -93,7 +93,7 @@ def test_missing_required_options(self):\n \n     self.assertEqual(\n         self.check_errors_for_arguments(\n-            errors, ['project', 'staging_location', 'temp_location', 'region']),\n+            errors, ['project', 'temp_location', 'staging_location', 'region']),", "originalCommit": "bdafc42464c3dfff18ef12520660ab4b0e7234e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NDg5Ng==", "url": "https://github.com/apache/beam/pull/11982#discussion_r439674896", "bodyText": "Rest of the PR LG", "author": "udim", "createdAt": "2020-06-12T23:06:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NDc2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NDcwNw==", "url": "https://github.com/apache/beam/pull/11982#discussion_r441274707", "bodyText": "Fixed this mixup.", "author": "pabloem", "createdAt": "2020-06-17T04:34:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NDc2OA=="}], "type": "inlineReview"}, {"oid": "c464b7caf303e484fa1a50e332217e8caf2c0a38", "url": "https://github.com/apache/beam/commit/c464b7caf303e484fa1a50e332217e8caf2c0a38", "message": "[BEAM-6892] Supporting bucket auto-creation for Dataflow.\n\nFailing to create default bucket if KMS KEY is passed in\n\nFixup!\n\nfixup\n\nFixup\n\nFixup", "committedDate": "2020-06-16T20:28:39Z", "type": "commit"}, {"oid": "c464b7caf303e484fa1a50e332217e8caf2c0a38", "url": "https://github.com/apache/beam/commit/c464b7caf303e484fa1a50e332217e8caf2c0a38", "message": "[BEAM-6892] Supporting bucket auto-creation for Dataflow.\n\nFailing to create default bucket if KMS KEY is passed in\n\nFixup!\n\nfixup\n\nFixup\n\nFixup", "committedDate": "2020-06-16T20:28:39Z", "type": "forcePushed"}, {"oid": "64e149158a4821379d3a42e7413acb644f931654", "url": "https://github.com/apache/beam/commit/64e149158a4821379d3a42e7413acb644f931654", "message": "Fixup", "committedDate": "2020-06-16T22:22:46Z", "type": "commit"}]}