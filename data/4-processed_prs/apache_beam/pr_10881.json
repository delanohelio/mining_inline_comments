{"pr_number": 10881, "pr_title": "[BEAM-9248] Integrate Google Cloud Natural Language functionality for Python SDK", "pr_createdAt": "2020-02-17T09:11:17Z", "pr_url": "https://github.com/apache/beam/pull/10881", "timeline": [{"oid": "dd46c3322d1f75516469f27ac168b203e3a031ef", "url": "https://github.com/apache/beam/commit/dd46c3322d1f75516469f27ac168b203e3a031ef", "message": "[BEAM-9248] Integrate Google Cloud Natural Language functionality for Python SDK", "committedDate": "2020-02-20T16:41:53Z", "type": "forcePushed"}, {"oid": "1cc1dfee58164265189eb87ad50aec249ed10d52", "url": "https://github.com/apache/beam/commit/1cc1dfee58164265189eb87ad50aec249ed10d52", "message": "[BEAM-9248] Integrate Google Cloud Natural Language functionality for Python SDK", "committedDate": "2020-02-20T16:45:28Z", "type": "forcePushed"}, {"oid": "161f92ec9f3c901bf016e0c2c9e3201d6f5590e0", "url": "https://github.com/apache/beam/commit/161f92ec9f3c901bf016e0c2c9e3201d6f5590e0", "message": "[BEAM-9248] Integrate Google Cloud Natural Language functionality for Python SDK", "committedDate": "2020-02-21T10:11:30Z", "type": "forcePushed"}, {"oid": "161f92ec9f3c901bf016e0c2c9e3201d6f5590e0", "url": "https://github.com/apache/beam/commit/161f92ec9f3c901bf016e0c2c9e3201d6f5590e0", "message": "[BEAM-9248] Integrate Google Cloud Natural Language functionality for Python SDK", "committedDate": "2020-02-21T10:11:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MTEyMw==", "url": "https://github.com/apache/beam/pull/10881#discussion_r384051123", "bodyText": "What happens if features are not on the above list? Do we need to keep and maintain an updated list?\nDoes the client library has a list of these?", "author": "aaltay", "createdAt": "2020-02-25T18:40:46Z", "path": "sdks/python/apache_beam/ml/gcp/naturallanguageml.py", "diffHunk": "@@ -0,0 +1,156 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+from __future__ import absolute_import\n+\n+from typing import Dict\n+from typing import Mapping\n+from typing import Optional\n+from typing import Sequence\n+from typing import Tuple\n+from typing import Union\n+\n+import apache_beam as beam\n+from apache_beam.metrics import Metrics\n+\n+try:\n+  from google.cloud import language\n+  from google.cloud.language import enums  # pylint: disable=unused-import\n+  from google.cloud.language import types\n+except ImportError:\n+  raise ImportError(\n+      'Google Cloud Natural Language API not supported for this execution '\n+      'environment (could not import Natural Language API client).')\n+\n+__all__ = ['Document', 'Feature', 'AnnotateText']\n+\n+\n+class Document(object):\n+  \"\"\"Represents the input to :class:`AnnotateText` transform.\n+\n+  Args:\n+    content (str): The content of the input or the Google Cloud Storage URI\n+      where the file is stored.\n+    type (`Union[str, google.cloud.language.enums.Document.Type]`): Text type.\n+      Possible values are `HTML`, `PLAIN_TEXT`. The default value is\n+      `PLAIN_TEXT`.\n+    language_hint (`Optional[str]`): The language of the text. If not specified,\n+      language will be automatically detected. Values should conform to\n+      ISO-639-1 standard.\n+    encoding (`Optional[str]`): Text encoding. Possible values are: `NONE`,\n+     `UTF8`, `UTF16`, `UTF32`. The default value is `UTF8`.\n+    from_gcs (bool): Whether the content should be interpret as a Google Cloud\n+      Storage URI. The default value is :data:`False`.\n+  \"\"\"\n+\n+  def __init__(\n+      self,\n+      content,  # type: str\n+      type='PLAIN_TEXT',  # type: Union[str, enums.Document.Type]\n+      language_hint=None,  # type: Optional[str]\n+      encoding='UTF8',  # type: Optional[str]\n+      from_gcs=False  # type: bool\n+  ):\n+    self.content = content\n+    self.type = type\n+    self.encoding = encoding\n+    self.language_hint = language_hint\n+    self.from_gcs = from_gcs\n+\n+  @staticmethod\n+  def to_dict(document):\n+    # type: (Document) -> Mapping[str, Optional[str]]\n+    if document.from_gcs:\n+      dict_repr = {'gcs_content_uri': document.content}\n+    else:\n+      dict_repr = {'content': document.content}\n+    dict_repr.update({\n+        'type': document.type, 'language': document.language_hint\n+    })\n+    return dict_repr\n+\n+\n+class Feature(object):\n+  EXTRACT_SYNTAX = 'extract_syntax'\n+  EXTRACT_ENTITIES = 'extract_entities'\n+  EXTRACT_DOCUMENT_SENTIMENT = 'extract_document_sentiment'\n+  EXTRACT_ENTITY_SENTIMENT = 'extract_entity_sentiment'\n+  CLASSIFY_TEXT = 'classify_text'\n+\n+  @staticmethod\n+  def to_dict(features):", "originalCommit": "161f92ec9f3c901bf016e0c2c9e3201d6f5590e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQwNzMyNw==", "url": "https://github.com/apache/beam/pull/10881#discussion_r384407327", "bodyText": "Yes, the client library has Features protobuf message that can used. In that case, I'll just remove my Feature class\u00a0and update type annotations. Thanks.", "author": "kamilwu", "createdAt": "2020-02-26T10:35:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MTEyMw=="}], "type": "inlineReview"}, {"oid": "1a82664776a492748e3e7afd6a0fc887c4307521", "url": "https://github.com/apache/beam/commit/1a82664776a492748e3e7afd6a0fc887c4307521", "message": "[BEAM-9248] Integrate Google Cloud Natural Language functionality for Python SDK", "committedDate": "2020-02-26T14:49:41Z", "type": "commit"}, {"oid": "86e37af6db8c3adb9dae32bce3540209889c6704", "url": "https://github.com/apache/beam/commit/86e37af6db8c3adb9dae32bce3540209889c6704", "message": "FIX: Use Features from the client library", "committedDate": "2020-02-26T14:49:41Z", "type": "commit"}, {"oid": "86e37af6db8c3adb9dae32bce3540209889c6704", "url": "https://github.com/apache/beam/commit/86e37af6db8c3adb9dae32bce3540209889c6704", "message": "FIX: Use Features from the client library", "committedDate": "2020-02-26T14:49:41Z", "type": "forcePushed"}]}