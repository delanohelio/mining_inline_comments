{"pr_number": 12558, "pr_title": "[BEAM-10695] Fix InteractiveEnvironment cannot evict PCollection", "pr_createdAt": "2020-08-12T21:26:34Z", "pr_url": "https://github.com/apache/beam/pull/12558", "timeline": [{"oid": "29cd48280172ad332f107eda699813f960bcb1d3", "url": "https://github.com/apache/beam/commit/29cd48280172ad332f107eda699813f960bcb1d3", "message": "Fix bug that evicting computed PCollections was changing list while iterating.\n\nChange-Id: I271efeef53f99c8083a6d37b89085cddd63bf56a", "committedDate": "2020-08-12T21:19:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI2NzIyMQ==", "url": "https://github.com/apache/beam/pull/12558#discussion_r470267221", "bodyText": "Don't you need to call discard on _computed_pcolls?", "author": "pabloem", "createdAt": "2020-08-13T21:46:21Z", "path": "sdks/python/apache_beam/runners/interactive/interactive_environment.py", "diffHunk": "@@ -501,9 +501,11 @@ def evict_computed_pcollections(self, pipeline=None):\n     is specified, evicts for all pipelines.\n     \"\"\"\n     if pipeline:\n+      discarded = set()\n       for pcoll in self._computed_pcolls:\n         if pcoll.pipeline is pipeline:\n-          self._computed_pcolls.discard(pcoll)\n+          discarded.add(pcoll)\n+      self._computed_pcolls -= discarded", "originalCommit": "29cd48280172ad332f107eda699813f960bcb1d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4NTIxMw==", "url": "https://github.com/apache/beam/pull/12558#discussion_r470285213", "bodyText": "I perform the set subtraction on L508 which takes care of it.", "author": "rohdesamuel", "createdAt": "2020-08-13T22:33:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI2NzIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2MDU4Ng==", "url": "https://github.com/apache/beam/pull/12558#discussion_r470360586", "bodyText": "ah makes sense", "author": "pabloem", "createdAt": "2020-08-14T01:22:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI2NzIyMQ=="}], "type": "inlineReview"}]}