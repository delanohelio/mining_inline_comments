{"pr_number": 13139, "pr_title": "[BEAM-9547] Implementation for drop, explode", "pr_createdAt": "2020-10-19T20:06:36Z", "pr_url": "https://github.com/apache/beam/pull/13139", "timeline": [{"oid": "a5c7ebe57f263db2176f977c508b2527abfac49b", "url": "https://github.com/apache/beam/commit/a5c7ebe57f263db2176f977c508b2527abfac49b", "message": "implement drop", "committedDate": "2020-10-16T21:58:02Z", "type": "commit"}, {"oid": "ac4395f5fa183ea7f9a002f6c32e933b5b8e8d5b", "url": "https://github.com/apache/beam/commit/ac4395f5fa183ea7f9a002f6c32e933b5b8e8d5b", "message": "Make TransformsTest verify proxy, fix some bugs", "committedDate": "2020-10-16T21:59:09Z", "type": "commit"}, {"oid": "35012801287fcaca0832d42cf44e72a2e23bbc99", "url": "https://github.com/apache/beam/commit/35012801287fcaca0832d42cf44e72a2e23bbc99", "message": "Add implementation for explode", "committedDate": "2020-10-19T19:46:26Z", "type": "commit"}, {"oid": "9e27287db91d844a7497ed94493f23d49ee83349", "url": "https://github.com/apache/beam/commit/9e27287db91d844a7497ed94493f23d49ee83349", "message": "lint", "committedDate": "2020-10-27T23:16:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4Mjk4Mg==", "url": "https://github.com/apache/beam/pull/13139#discussion_r513682982", "bodyText": "One danger here of using kwargs.get rather than letting it be a parameter is that you're hard-coding what all the defaults are (rather than using populate_defaults).", "author": "robertwb", "createdAt": "2020-10-28T18:47:37Z", "path": "sdks/python/apache_beam/dataframe/frames.py", "diffHunk": "@@ -619,21 +619,75 @@ def assign(self, **kwargs):\n                                             \"instances are supported.\")\n     return frame_base._elementwise_method('assign')(self, **kwargs)\n \n-\n   apply = frame_base.not_implemented_method('apply')\n-  explode = frame_base.not_implemented_method('explode')\n   isin = frame_base.not_implemented_method('isin')\n   append = frame_base.not_implemented_method('append')\n   combine = frame_base.not_implemented_method('combine')\n   combine_first = frame_base.not_implemented_method('combine_first')\n   count = frame_base.not_implemented_method('count')\n-  drop = frame_base.not_implemented_method('drop')\n   eval = frame_base.not_implemented_method('eval')\n   reindex = frame_base.not_implemented_method('reindex')\n   melt = frame_base.not_implemented_method('melt')\n   pivot = frame_base.not_implemented_method('pivot')\n   pivot_table = frame_base.not_implemented_method('pivot_table')\n \n+  @frame_base.args_to_kwargs(pd.DataFrame)\n+  @frame_base.populate_defaults(pd.DataFrame)\n+  def explode(self, column, ignore_index):\n+    # ignoring the index will not preserve it\n+    preserves = (partitionings.Nothing() if ignore_index\n+                 else partitionings.Singleton())\n+    return frame_base.DeferredFrame.wrap(\n+        expressions.ComputedExpression(\n+            'explode',\n+            lambda df: df.explode(column, ignore_index),\n+            [self._expr],\n+            preserves_partition_by=preserves,\n+            requires_partition_by=partitionings.Nothing()))\n+\n+\n+  @frame_base.args_to_kwargs(pd.DataFrame)\n+  @frame_base.populate_defaults(pd.DataFrame)\n+  @frame_base.maybe_inplace\n+  def drop(self, **kwargs):\n+    labels = kwargs.get('labels', None)", "originalCommit": "9e27287db91d844a7497ed94493f23d49ee83349", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5OTUzMw==", "url": "https://github.com/apache/beam/pull/13139#discussion_r513799533", "bodyText": "Ah whoops. I switched it over to use args directly", "author": "TheNeuralBit", "createdAt": "2020-10-28T22:28:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4Mjk4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4NDcwNA==", "url": "https://github.com/apache/beam/pull/13139#discussion_r513684704", "bodyText": "Is there a drawback to this being automatically inferred? (Or was it not?)\nSame below.", "author": "robertwb", "createdAt": "2020-10-28T18:50:29Z", "path": "sdks/python/apache_beam/dataframe/frames.py", "diffHunk": "@@ -1513,6 +1584,8 @@ def repeat(self, repeats):\n               'repeat',\n               lambda series: series.str.repeat(repeats),\n               [self._expr],\n+              # Output will also be a str Series", "originalCommit": "9e27287db91d844a7497ed94493f23d49ee83349", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzcxMTAyNw==", "url": "https://github.com/apache/beam/pull/13139#discussion_r513711027", "bodyText": "Yeah when I added the verification of the proxy in TransformTest I found that this proxy was incorrectly inferred as bool for the zipping case tested there.\nIn [10]: proxy.dtypes\nOut[10]: \nstr        object\nrepeats     int64\ndtype: object\n\nIn [11]: proxy.str.str.repeat(proxy.repeats)\nOut[11]: Series([], Name: str, dtype: bool)\nThe actual operation does produce object though:\nIn [13]: df.str.str.repeat(df.repeats)\nOut[13]: \n0      AAA\n1        B\n2     CCCC\n3    DDDDD\n4       EE\nName: str, dtype: object", "author": "TheNeuralBit", "createdAt": "2020-10-28T19:37:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4NDcwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzcxMTM3OA==", "url": "https://github.com/apache/beam/pull/13139#discussion_r513711378", "bodyText": "Maybe something we should fix upstream and patch around here in the meantime?", "author": "TheNeuralBit", "createdAt": "2020-10-28T19:37:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4NDcwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzNTgyNA==", "url": "https://github.com/apache/beam/pull/13139#discussion_r514435824", "bodyText": "Hmm... OK, can you file a JIRA to investigate?", "author": "robertwb", "createdAt": "2020-10-29T17:23:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4NDcwNA=="}], "type": "inlineReview"}, {"oid": "5eaf6355eac49162989da744ce5174816813e0f2", "url": "https://github.com/apache/beam/commit/5eaf6355eac49162989da744ce5174816813e0f2", "message": "remove hard-coded defaults", "committedDate": "2020-10-28T22:27:29Z", "type": "commit"}, {"oid": "037f102b993d1dcffa3cd9e99f69dd6c9faf128f", "url": "https://github.com/apache/beam/commit/037f102b993d1dcffa3cd9e99f69dd6c9faf128f", "message": "add BEAM-11155 link", "committedDate": "2020-10-29T21:43:55Z", "type": "commit"}]}