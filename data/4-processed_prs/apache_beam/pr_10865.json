{"pr_number": 10865, "pr_title": "[BEAM-9301] Checkout the hash of master instead of the branch in beam linkage checker script", "pr_createdAt": "2020-02-14T12:41:09Z", "pr_url": "https://github.com/apache/beam/pull/10865", "timeline": [{"oid": "30ccce706d5e17528746f5ec261d0b4ef8770a62", "url": "https://github.com/apache/beam/commit/30ccce706d5e17528746f5ec261d0b4ef8770a62", "message": "[BEAM-9301] Checkout the hash of master instead of the branch in beam linkage checker script\n\nThis avoids a failure when the branch is checked out elsewhere, e.g. if\nusing git worktrees.", "committedDate": "2020-02-14T12:44:14Z", "type": "forcePushed"}, {"oid": "30e641004e240257c9a4dcadc212532482508ed7", "url": "https://github.com/apache/beam/commit/30e641004e240257c9a4dcadc212532482508ed7", "message": "[BEAM-9301] Checkout the hash of master instead of the branch in beam linkage checker script\n\nThis avoids a failure when the branch is checked out elsewhere, e.g. if\nusing git worktrees.", "committedDate": "2020-02-14T14:18:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2MjMyNA==", "url": "https://github.com/apache/beam/pull/10865#discussion_r379462324", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            MASTER_COMMIT=`git rev-parse --short=8 master`\n          \n          \n            \n            MASTER_COMMIT=`git rev-parse --short=8 origin/master`\n          \n      \n    \n    \n  \n\nlocal master and remote master branch are different until \u201cgit pull\u201d", "author": "suztomo", "createdAt": "2020-02-14T14:35:36Z", "path": "sdks/java/build-tools/beam-linkage-check.sh", "diffHunk": "@@ -84,9 +84,9 @@ function runLinkageCheck () {\n BRANCH_COMMIT=`git rev-parse --short=8 HEAD`\n runLinkageCheck $BRANCH_COMMIT\n \n-git checkout master\n-git pull\n-MASTER_COMMIT=`git rev-parse --short=8 HEAD`\n+git fetch\n+MASTER_COMMIT=`git rev-parse --short=8 master`", "originalCommit": "30e641004e240257c9a4dcadc212532482508ed7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2NDEyMg==", "url": "https://github.com/apache/beam/pull/10865#discussion_r379464122", "bodyText": "Does line 71 local BRANCH_NAME=$(git symbolic-ref --short HEAD)  work?", "author": "suztomo", "createdAt": "2020-02-14T14:38:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2MjMyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUyODAwMg==", "url": "https://github.com/apache/beam/pull/10865#discussion_r379528002", "bodyText": "Line 71 would fail:\nsuztomo@suxtomo24:~/cloud-opensource-java$ MASTER_COMMIT=`git rev-parse --short=8 origin/master`\nsuztomo@suxtomo24:~/cloud-opensource-java$ git -c advice.detachedHead=false checkout $MASTER_COMMIT\nHEAD is now at eebf0ce4 update http client (#1220)\nsuztomo@suxtomo24:~/cloud-opensource-java$ git symbolic-ref --short HEAD\nfatal: ref HEAD is not a symbolic ref\nsuztomo@suxtomo24:~/cloud-opensource-java$ echo $?\n128", "author": "suztomo", "createdAt": "2020-02-14T16:34:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2MjMyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUzOTU0MA==", "url": "https://github.com/apache/beam/pull/10865#discussion_r379539540", "bodyText": "oh yes sorry shame on me, let me take a look, fix it and test it (never consider anything so obvious to not test it sorry).", "author": "iemejia", "createdAt": "2020-02-14T16:56:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2MjMyNA=="}], "type": "inlineReview"}, {"oid": "d020e93947bde64ae50f544afdcf8a94c072756f", "url": "https://github.com/apache/beam/commit/d020e93947bde64ae50f544afdcf8a94c072756f", "message": "[BEAM-9301] Checkout the hash of master instead of the branch in beam linkage checker script\n\nThis avoids a failure when the branch is checked out elsewhere, e.g. if\nusing git worktrees.", "committedDate": "2020-02-14T23:05:57Z", "type": "commit"}, {"oid": "d020e93947bde64ae50f544afdcf8a94c072756f", "url": "https://github.com/apache/beam/commit/d020e93947bde64ae50f544afdcf8a94c072756f", "message": "[BEAM-9301] Checkout the hash of master instead of the branch in beam linkage checker script\n\nThis avoids a failure when the branch is checked out elsewhere, e.g. if\nusing git worktrees.", "committedDate": "2020-02-14T23:05:57Z", "type": "forcePushed"}]}