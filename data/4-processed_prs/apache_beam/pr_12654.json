{"pr_number": 12654, "pr_title": "[BEAM-10766] Fix flake where ByteString coercion could modify cached type hints", "pr_createdAt": "2020-08-21T02:50:49Z", "pr_url": "https://github.com/apache/beam/pull/12654", "timeline": [{"oid": "a7a2f5acb2b3a7cdd810407d1d0187cc8e337f5c", "url": "https://github.com/apache/beam/commit/a7a2f5acb2b3a7cdd810407d1d0187cc8e337f5c", "message": "Create a new type rather than modifying", "committedDate": "2020-08-21T02:50:15Z", "type": "commit"}, {"oid": "a7a2f5acb2b3a7cdd810407d1d0187cc8e337f5c", "url": "https://github.com/apache/beam/commit/a7a2f5acb2b3a7cdd810407d1d0187cc8e337f5c", "message": "Create a new type rather than modifying", "committedDate": "2020-08-21T02:50:15Z", "type": "forcePushed"}, {"oid": "5f7bfe6cdc8a2395c7f00258cd7592aa28e9217a", "url": "https://github.com/apache/beam/commit/5f7bfe6cdc8a2395c7f00258cd7592aa28e9217a", "message": "yapf", "committedDate": "2020-08-21T02:54:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc2Njc3Mw==", "url": "https://github.com/apache/beam/pull/12654#discussion_r474766773", "bodyText": "Probably should also check if hasattr(typ, '__origin__') to be safe.\nIn native_type_compatibility we also check getattr(typ, '__module__', None) != 'typing' to exclude stuff that's not from the typing module.", "author": "udim", "createdAt": "2020-08-21T15:22:21Z", "path": "sdks/python/apache_beam/transforms/external.py", "diffHunk": "@@ -127,17 +127,21 @@ def _get_named_tuple_instance(self):\n         for key, value in self._values.items() if value is not None\n     }\n \n+    # In python 2 named_fields_to_schema will not accept str because its\n+    # ambiguous. This converts str hints to ByteString recursively so its clear\n+    # we intend to use BYTES.\n     # TODO(BEAM-7372): Remove coercion to ByteString\n     def coerce_str_to_bytes(typ):\n       if typ == str:\n         return ByteString\n \n       elif hasattr(typ, '__args__'):", "originalCommit": "5f7bfe6cdc8a2395c7f00258cd7592aa28e9217a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgxNzU5MA==", "url": "https://github.com/apache/beam/pull/12654#discussion_r474817590", "bodyText": "added hasattr(typ, '__origin__')", "author": "TheNeuralBit", "createdAt": "2020-08-21T16:59:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc2Njc3Mw=="}], "type": "inlineReview"}, {"oid": "1ad640a0fbe90e8f40a7263bec66eaaec98fcd9e", "url": "https://github.com/apache/beam/commit/1ad640a0fbe90e8f40a7263bec66eaaec98fcd9e", "message": "add __origin__ attr check", "committedDate": "2020-08-21T16:58:55Z", "type": "commit"}]}