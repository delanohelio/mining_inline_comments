{"pr_number": 11103, "pr_title": "[BEAM-9494] Reifying outputs from BQ file writing", "pr_createdAt": "2020-03-11T23:01:16Z", "pr_url": "https://github.com/apache/beam/pull/11103", "timeline": [{"oid": "75e2bb1dc9c2df159c38b566ba0a999ace767a9b", "url": "https://github.com/apache/beam/commit/75e2bb1dc9c2df159c38b566ba0a999ace767a9b", "message": "Reifying outputs from BQ file writing", "committedDate": "2020-03-12T16:51:18Z", "type": "commit"}, {"oid": "75e2bb1dc9c2df159c38b566ba0a999ace767a9b", "url": "https://github.com/apache/beam/commit/75e2bb1dc9c2df159c38b566ba0a999ace767a9b", "message": "Reifying outputs from BQ file writing", "committedDate": "2020-03-12T16:51:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzNzEwNg==", "url": "https://github.com/apache/beam/pull/11103#discussion_r391837106", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                # We flatten both PCollection paths, and reify. We do this due to some\n          \n          \n            \n                # trickiness with coder-setting on Flatten-GBK boundaries.\n          \n          \n            \n                all_destination_file_pairs_pc = (\n          \n          \n            \n                    (destination_files_kv_pc, more_destination_files_kv_pc)\n          \n          \n            \n                # TODO(BEAM-9494): Remove the identity transform. We flatten both PCollection paths\n          \n          \n            \n                # and use an identity function to work around a flatten optimization issue where the wrong\n          \n          \n            \n                # coder is being used.\n          \n          \n            \n                all_destination_file_pairs_pc = (\n          \n          \n            \n                    (destination_files_kv_pc, more_destination_files_kv_pc)", "author": "lukecwik", "createdAt": "2020-03-12T19:14:49Z", "path": "sdks/python/apache_beam/io/gcp/bigquery_file_loads.py", "diffHunk": "@@ -739,9 +739,12 @@ def _write_files(self, destination_data_kv_pc, file_prefix_pcv):\n             file_prefix_pcv,\n             *self.schema_side_inputs))\n \n+    # We flatten both PCollection paths, and reify. We do this due to some\n+    # trickiness with coder-setting on Flatten-GBK boundaries.\n     all_destination_file_pairs_pc = (\n         (destination_files_kv_pc, more_destination_files_kv_pc)", "originalCommit": "75e2bb1dc9c2df159c38b566ba0a999ace767a9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzNzIzOA==", "url": "https://github.com/apache/beam/pull/11103#discussion_r391837238", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    | \"ReifyInputs\" >> beam.Map(lambda x: x))\n          \n          \n            \n                    | \"IdentityWorkaround\" >> beam.Map(lambda x: x))", "author": "lukecwik", "createdAt": "2020-03-12T19:15:05Z", "path": "sdks/python/apache_beam/io/gcp/bigquery_file_loads.py", "diffHunk": "@@ -739,9 +739,12 @@ def _write_files(self, destination_data_kv_pc, file_prefix_pcv):\n             file_prefix_pcv,\n             *self.schema_side_inputs))\n \n+    # We flatten both PCollection paths, and reify. We do this due to some\n+    # trickiness with coder-setting on Flatten-GBK boundaries.\n     all_destination_file_pairs_pc = (\n         (destination_files_kv_pc, more_destination_files_kv_pc)\n-        | \"DestinationFilesUnion\" >> beam.Flatten())\n+        | \"DestinationFilesUnion\" >> beam.Flatten()\n+        | \"ReifyInputs\" >> beam.Map(lambda x: x))", "originalCommit": "75e2bb1dc9c2df159c38b566ba0a999ace767a9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fd02253098b6804bcc90a861514228a8267fb9ff", "url": "https://github.com/apache/beam/commit/fd02253098b6804bcc90a861514228a8267fb9ff", "message": "Update sdks/python/apache_beam/io/gcp/bigquery_file_loads.py\n\nCo-Authored-By: Lukasz Cwik <lcwik@google.com>", "committedDate": "2020-03-12T19:40:03Z", "type": "commit"}, {"oid": "d0c5481eee4461b90f9448ec04084219dda1c5f0", "url": "https://github.com/apache/beam/commit/d0c5481eee4461b90f9448ec04084219dda1c5f0", "message": "Update sdks/python/apache_beam/io/gcp/bigquery_file_loads.py\n\nCo-Authored-By: Lukasz Cwik <lcwik@google.com>", "committedDate": "2020-03-12T19:40:13Z", "type": "commit"}, {"oid": "cd53800645c030f8a3014577a7d6e51f1ff2f08c", "url": "https://github.com/apache/beam/commit/cd53800645c030f8a3014577a7d6e51f1ff2f08c", "message": "Fixing lint", "committedDate": "2020-03-12T20:30:56Z", "type": "commit"}]}