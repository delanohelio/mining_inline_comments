{"pr_number": 12520, "pr_title": "[BEAM-10677] Fix @SchemaFieldName in AutoValueSchema", "pr_createdAt": "2020-08-10T22:39:36Z", "pr_url": "https://github.com/apache/beam/pull/12520", "timeline": [{"oid": "032c6c8c87bbb60c4b27bec28c60b5390c353e3b", "url": "https://github.com/apache/beam/commit/032c6c8c87bbb60c4b27bec28c60b5390c353e3b", "message": "Add test for SchemaFieldName in AutoValue", "committedDate": "2020-08-10T22:37:48Z", "type": "commit"}, {"oid": "690f0643ee58d35d572e56069ec230f7db085d90", "url": "https://github.com/apache/beam/commit/690f0643ee58d35d572e56069ec230f7db085d90", "message": "Fix bugs with SchemaFieldName", "committedDate": "2020-08-10T22:37:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIyNTA0OA==", "url": "https://github.com/apache/beam/pull/12520#discussion_r468225048", "bodyText": "I'm not quite sure what the old logic was trying to verify. Now this verifies that every constructor parameter corresponds to a schema field.", "author": "TheNeuralBit", "createdAt": "2020-08-10T22:40:34Z", "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/utils/AutoValueUtils.java", "diffHunk": "@@ -139,11 +139,15 @@ private static boolean matchConstructor(\n                 Collectors.toMap(\n                     f -> ReflectUtils.stripGetterPrefix(f.getMethod().getName()),\n                     Function.identity()));\n-    for (FieldValueTypeInformation type : getterTypes) {\n-      if (typeMap.get(type.getName()) == null) {\n+\n+    // Verify that constructor parameters match (name and type) the inferred schema.\n+    for (Parameter parameter : constructor.getParameters()) {\n+      FieldValueTypeInformation type = typeMap.getOrDefault(parameter.getName(), null);\n+      if (type == null || type.getRawType() != parameter.getType()) {", "originalCommit": "690f0643ee58d35d572e56069ec230f7db085d90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2OTExMg==", "url": "https://github.com/apache/beam/pull/12520#discussion_r468269112", "bodyText": "I believe the getterTypes is the list of schema name, where typeMap is the attribute name from AutoValue class. It's trying to verify whether the schema matches the AutoValue class since it wants to get a constructor.", "author": "boyuanzz", "createdAt": "2020-08-11T01:09:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIyNTA0OA=="}], "type": "inlineReview"}]}