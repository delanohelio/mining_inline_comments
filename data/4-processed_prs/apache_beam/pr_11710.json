{"pr_number": 11710, "pr_title": "[BEAM-9964] Setting --workerCacheMB for Streaming Pipeline", "pr_createdAt": "2020-05-14T18:11:32Z", "pr_url": "https://github.com/apache/beam/pull/11710", "timeline": [{"oid": "bb3877ad9835feba5039f3e8bf763fb873395a19", "url": "https://github.com/apache/beam/commit/bb3877ad9835feba5039f3e8bf763fb873395a19", "message": "[BEAM-9964] Setting --workerCacheMB to make its way to the WindmillStateCache constructor. Right now, this is hardcoded at 100MB", "committedDate": "2020-05-14T18:07:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM0NTc0MQ==", "url": "https://github.com/apache/beam/pull/11710#discussion_r425345741", "bodyText": "Can you add a check to this test to make sure that the maximumWeight of the cache is the 100 MB? (perhaps use a number different than 100 to be sure).", "author": "pabloem", "createdAt": "2020-05-14T18:27:14Z", "path": "runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/WindmillStateCacheTest.java", "diffHunk": "@@ -130,7 +133,8 @@ private static StateNamespace triggerNamespace(long start, int triggerIdx) {\n \n   @Before\n   public void setUp() {\n-    cache = new WindmillStateCache();\n+    options = PipelineOptionsFactory.as(DataflowWorkerHarnessOptions.class);\n+    cache = new WindmillStateCache(options.getWorkerCacheMb());\n     assertEquals(0, cache.getWeight());", "originalCommit": "bb3877ad9835feba5039f3e8bf763fb873395a19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQzMDAzOQ==", "url": "https://github.com/apache/beam/pull/11710#discussion_r425430039", "bodyText": "Fixed this by adding a new Test method in WindmillStateCacheTest class. I created a new getter in the WindmillStateCache to retrieve the size of max weight on bytes, and compared it to the initial value set", "author": "omarismail94", "createdAt": "2020-05-14T21:05:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM0NTc0MQ=="}], "type": "inlineReview"}, {"oid": "e5dfe5f5cd4fd5629688fbacea91352d001a64b5", "url": "https://github.com/apache/beam/commit/e5dfe5f5cd4fd5629688fbacea91352d001a64b5", "message": "[BEAM-9964] Added testMaxWeight method in WIndmillStateCacheTest as per pabloem's comment", "committedDate": "2020-05-14T21:03:05Z", "type": "commit"}]}