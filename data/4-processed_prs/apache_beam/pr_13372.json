{"pr_number": 13372, "pr_title": "Enable more runner v2 tests.", "pr_createdAt": "2020-11-18T04:21:43Z", "pr_url": "https://github.com/apache/beam/pull/13372", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwMzYzMg==", "url": "https://github.com/apache/beam/pull/13372#discussion_r526403632", "bodyText": "These are already excluded by commonRunnerV2ExcludeCategories via category exclusion, so maybe they can just be removed from here?", "author": "tysonjh", "createdAt": "2020-11-18T20:35:44Z", "path": "runners/google-cloud-dataflow-java/build.gradle", "diffHunk": "@@ -359,25 +359,20 @@ task validatesRunnerV2 {\n     name: 'validatesRunnerV2Test',\n     excludedCategories: [\n       'org.apache.beam.sdk.testing.UsesRequiresTimeSortedInput',\n+      'org.apache.beam.sdk.testing.UsesUnboundedSplittableParDo',\n     ],\n     excludedTests: [\n       'org.apache.beam.sdk.transforms.windowing.WindowingTest.testNonPartitioningWindowing',\n       'org.apache.beam.sdk.transforms.windowing.WindowTest.testMergingCustomWindowsKeyedCollection',\n       'org.apache.beam.sdk.transforms.windowing.WindowTest.testMergingCustomWindows',\n \n-      'org.apache.beam.sdk.transforms.SplittableDoFnTest.testBundleFinalizationOccursOnUnboundedSplittableDoFn',\n-      'org.apache.beam.sdk.transforms.SplittableDoFnTest.testOutputAfterCheckpointBounded',\n-      'org.apache.beam.sdk.transforms.SplittableDoFnTest.testOutputAfterCheckpointUnbounded',\n-      'org.apache.beam.sdk.transforms.SplittableDoFnTest.testPairWithIndexBasicBounded',\n-      'org.apache.beam.sdk.transforms.SplittableDoFnTest.testPairWithIndexBasicUnbounded',\n-      'org.apache.beam.sdk.transforms.SplittableDoFnTest.testPairWithIndexWindowedTimestampedBounded',\n-      'org.apache.beam.sdk.transforms.SplittableDoFnTest.testWindowedSideInputWithCheckpointsBounded',\n-\n       'org.apache.beam.sdk.transforms.ReshuffleTest.testReshuffleWithTimestampsStreaming',\n \n+      // These tests are using TestStream, which is not supported in batch.", "originalCommit": "5138a9bbf06f2e5d380cfb8fb71f3eab563944be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNTAwMg==", "url": "https://github.com/apache/beam/pull/13372#discussion_r526405002", "bodyText": "This should probably move to the commonRunnerV2ExcludeCategories as well since it applies to both streaming/batch.", "author": "tysonjh", "createdAt": "2020-11-18T20:38:15Z", "path": "runners/google-cloud-dataflow-java/build.gradle", "diffHunk": "@@ -359,25 +359,20 @@ task validatesRunnerV2 {\n     name: 'validatesRunnerV2Test',\n     excludedCategories: [\n       'org.apache.beam.sdk.testing.UsesRequiresTimeSortedInput',", "originalCommit": "5138a9bbf06f2e5d380cfb8fb71f3eab563944be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "75d6cd9e843f71ca67a460ec9b8be9141e774922", "url": "https://github.com/apache/beam/commit/75d6cd9e843f71ca67a460ec9b8be9141e774922", "message": "Enable more runner v2 tests.", "committedDate": "2020-11-19T00:46:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1OTY4MQ==", "url": "https://github.com/apache/beam/pull/13372#discussion_r527059681", "bodyText": "Exclude UsesUnboundedPCollection here?", "author": "kennknowles", "createdAt": "2020-11-19T17:15:46Z", "path": "runners/google-cloud-dataflow-java/build.gradle", "diffHunk": "@@ -358,26 +359,19 @@ task validatesRunnerV2 {\n   dependsOn(createRunnerV2ValidatesRunnerTest(\n     name: 'validatesRunnerV2Test',\n     excludedCategories: [\n-      'org.apache.beam.sdk.testing.UsesRequiresTimeSortedInput',\n+      'org.apache.beam.sdk.testing.UsesUnboundedSplittableParDo',", "originalCommit": "75d6cd9e843f71ca67a460ec9b8be9141e774922", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2MDg1Mg==", "url": "https://github.com/apache/beam/pull/13372#discussion_r527060852", "bodyText": "This I am confused about. I did not think that Dataflow supported requiring time-sorted input in streaming either runner v1 or v2.", "author": "kennknowles", "createdAt": "2020-11-19T17:17:26Z", "path": "runners/google-cloud-dataflow-java/build.gradle", "diffHunk": "@@ -418,10 +412,6 @@ task validatesRunnerV2Streaming {\n     name: 'validatesRunnerV2TestStreaming',\n     pipelineOptions: runnerV2PipelineOptions + ['--streaming=true'],\n     excludedCategories: [\n-      // Not supported in Dataflow streaming mode.\n-      'org.apache.beam.sdk.testing.UsesRequiresTimeSortedInput',", "originalCommit": "75d6cd9e843f71ca67a460ec9b8be9141e774922", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwNzAzNg==", "url": "https://github.com/apache/beam/pull/13372#discussion_r527107036", "bodyText": "We moved the UsesRequiresTimeSortedInput  to the common exclude categories, which is for both streaming and batch.", "author": "boyuanzz", "createdAt": "2020-11-19T18:28:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2MDg1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2MzQyNA==", "url": "https://github.com/apache/beam/pull/13372#discussion_r527063424", "bodyText": "This value is runner-specific. For many configurations a much smaller number is appropriate. This number is probably safe for all runners so it OK. But can you set it in the gradle file to some large number that will work for all the ValidatesRunner tests? Probably 900 is safe for any of them since they are small compliance tests and none are high load.", "author": "kennknowles", "createdAt": "2020-11-19T17:21:11Z", "path": "sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/SplittableDoFnTest.java", "diffHunk": "@@ -304,6 +305,7 @@ public void testOutputAfterCheckpointBounded() {\n   @Test\n   @Category({ValidatesRunner.class, UsesUnboundedSplittableParDo.class})\n   public void testOutputAfterCheckpointUnbounded() {\n+    p.getOptions().as(TestPipelineOptions.class).setTestTimeoutSeconds(900L);", "originalCommit": "75d6cd9e843f71ca67a460ec9b8be9141e774922", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwNjU3OQ==", "url": "https://github.com/apache/beam/pull/13372#discussion_r527106579", "bodyText": "It turns out this value doesn't help the test to pass. The testOutputAfterCheckpointUnbounded  and testBundleFinalizationOccursOnUnboundedSplittableDoFn  are just hanging on dataflow streaming runner v2. I'll revert the change here.", "author": "boyuanzz", "createdAt": "2020-11-19T18:27:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2MzQyNA=="}], "type": "inlineReview"}, {"oid": "ba9210e759f3e00a8cb54abfedd3005f62d3dcac", "url": "https://github.com/apache/beam/commit/ba9210e759f3e00a8cb54abfedd3005f62d3dcac", "message": "Enable more runner v2 tests.", "committedDate": "2020-11-20T23:21:50Z", "type": "forcePushed"}, {"oid": "07cbed52ec185c3c4b1eeff7d237a35a6da107fd", "url": "https://github.com/apache/beam/commit/07cbed52ec185c3c4b1eeff7d237a35a6da107fd", "message": "Enable more runner v2 tests.", "committedDate": "2020-11-23T19:25:20Z", "type": "commit"}, {"oid": "07cbed52ec185c3c4b1eeff7d237a35a6da107fd", "url": "https://github.com/apache/beam/commit/07cbed52ec185c3c4b1eeff7d237a35a6da107fd", "message": "Enable more runner v2 tests.", "committedDate": "2020-11-23T19:25:20Z", "type": "forcePushed"}]}