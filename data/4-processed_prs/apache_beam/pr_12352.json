{"pr_number": 12352, "pr_title": "[BEAM-10549] Improve runtime type checking performance for the Python SDK", "pr_createdAt": "2020-07-23T06:49:22Z", "pr_url": "https://github.com/apache/beam/pull/12352", "timeline": [{"oid": "68b4ce8c8ed13fa446036a0b520e871ff0739c33", "url": "https://github.com/apache/beam/commit/68b4ce8c8ed13fa446036a0b520e871ff0739c33", "message": "Rebase onto master", "committedDate": "2020-08-19T20:55:23Z", "type": "forcePushed"}, {"oid": "1dc13b010de56971bfb0e2ef898518b1b84da5b7", "url": "https://github.com/apache/beam/commit/1dc13b010de56971bfb0e2ef898518b1b84da5b7", "message": "Fix test", "committedDate": "2020-08-19T21:40:40Z", "type": "commit"}, {"oid": "e85777a7e7b984e7a11ab2b6ced70a65f0df4331", "url": "https://github.com/apache/beam/commit/e85777a7e7b984e7a11ab2b6ced70a65f0df4331", "message": "Remove unneeded code.", "committedDate": "2020-08-19T23:09:30Z", "type": "commit"}, {"oid": "61f94fd9a864ec5b4159026d0e697c43e1a94535", "url": "https://github.com/apache/beam/commit/61f94fd9a864ec5b4159026d0e697c43e1a94535", "message": "Fix snippets bug", "committedDate": "2020-08-20T03:01:23Z", "type": "commit"}, {"oid": "5e07a9f88cc3ff4bb93a65c8e470af58bd59ea1e", "url": "https://github.com/apache/beam/commit/5e07a9f88cc3ff4bb93a65c8e470af58bd59ea1e", "message": "Remove accidental changes", "committedDate": "2020-08-20T06:11:57Z", "type": "commit"}, {"oid": "a23ea8bcf2fd20a826cceae0f3b6abb761be26dd", "url": "https://github.com/apache/beam/commit/a23ea8bcf2fd20a826cceae0f3b6abb761be26dd", "message": "Add TODO", "committedDate": "2020-08-20T16:55:56Z", "type": "commit"}, {"oid": "c0bd248b35fa3fa4baa1afd7d4f2b359c75d4850", "url": "https://github.com/apache/beam/commit/c0bd248b35fa3fa4baa1afd7d4f2b359c75d4850", "message": "Remove expensive isinstance check", "committedDate": "2020-08-21T00:49:00Z", "type": "commit"}, {"oid": "f396eb10074d487c4edffe5a859fdc843a8501bd", "url": "https://github.com/apache/beam/commit/f396eb10074d487c4edffe5a859fdc843a8501bd", "message": "Remove unused import", "committedDate": "2020-08-21T03:09:55Z", "type": "commit"}, {"oid": "e9314c3dfb425d5f83a6633c8287af7d88bcc52a", "url": "https://github.com/apache/beam/commit/e9314c3dfb425d5f83a6633c8287af7d88bcc52a", "message": "Fix TODO", "committedDate": "2020-08-21T04:18:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU5NzM4MA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r459597380", "bodyText": "You can just do if consumers here.\nAs discussed, there may be more than one consumer, so worth thinking about what to do in that case.", "author": "pabloem", "createdAt": "2020-07-23T17:03:39Z", "path": "sdks/python/apache_beam/runners/worker/opcounters.py", "diffHunk": "@@ -202,6 +205,17 @@ def __init__(\n     self._sample_counter = 0\n     self._next_sample = 0\n \n+    if consumers and len(consumers):", "originalCommit": "0d8c8c3fc3f1e5913109bc1d92bcc3e6d4a1a8b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3NDM0Mg==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464674342", "bodyText": "This check is slow. Let's guard this or remove it (as it will still fail below).", "author": "robertwb", "createdAt": "2020-08-03T21:34:26Z", "path": "sdks/python/apache_beam/runners/common.py", "diffHunk": "@@ -1340,6 +1342,17 @@ def process_outputs(\n         self.per_element_output_counter.add_input(0)\n       return\n \n+    if isinstance(results, (dict, str, unicode, bytes)):\n+      results_type = type(results).__name__\n+      raise TypeCheckError(\n+          'Returning a %s from a ParDo or FlatMap is '\n+          'discouraged. Please use list(\"%s\") if you really '\n+          'want this behavior.' % (results_type, results))\n+    elif not isinstance(results, collections.Iterable):", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE0NTE3Ng==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466145176", "bodyText": "Out of curiosity, why is this check slow? Also, if we do remove it, is there a way to still give a relevant error message when it fails below?", "author": "saavannanavati", "createdAt": "2020-08-06T04:53:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3NDM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4NDM3OA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468084378", "bodyText": "Not yet resolved?", "author": "robertwb", "createdAt": "2020-08-10T18:05:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3NDM0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3NTU2Ng==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464675566", "bodyText": "This should say \"only supported with portable runners (including the direct runner).\"", "author": "robertwb", "createdAt": "2020-08-03T21:37:26Z", "path": "sdks/python/apache_beam/options/pipeline_options.py", "diffHunk": "@@ -466,6 +466,13 @@ def _add_argparse_args(cls, parser):\n         help='Enable type checking at pipeline execution '\n         'time. NOTE: only supported with the '\n         'DirectRunner')\n+    parser.add_argument(\n+        '--performance_runtime_type_check',\n+        default=False,\n+        action='store_true',\n+        help='Enable faster type checking via sampling at pipeline execution '\n+        'time. NOTE: only supported with the '", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3NzMzMQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464677331", "bodyText": "Generally it's preferable not to pass something big like self, but rather just the subset of information that's required here (e.g. the dict of type hint sources to type hints). This will also be needed for the cases that different outputs have different types.", "author": "robertwb", "createdAt": "2020-08-03T21:41:41Z", "path": "sdks/python/apache_beam/runners/worker/bundle_processor.py", "diffHunk": "@@ -188,7 +188,8 @@ def __init__(self,\n             self.name_context.step_name,\n             0,\n             next(iter(itervalues(consumers))),\n-            self.windowed_coder)\n+            self.windowed_coder,\n+            self)", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE5MTEzNQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466191135", "bodyText": "Okay, I refactored it to pass only the necessary data. Also, I thought self was just a reference to the class instance so it wouldn't be expensive to pass it around - is this not the case?", "author": "saavannanavati", "createdAt": "2020-08-06T07:09:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3NzMzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyNzU0Mw==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466727543", "bodyText": "When I said \"big\" I meant in terms of surface area. (You're right that there's no performance concern here.) E.g. it's easier to reason about the code when we see that the callee is interested in the type hints rather than the whole operation.", "author": "robertwb", "createdAt": "2020-08-06T22:52:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3NzMzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3OTEwNg==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464679106", "bodyText": "Where is this used?", "author": "robertwb", "createdAt": "2020-08-03T21:46:12Z", "path": "sdks/python/apache_beam/runners/worker/operations.py", "diffHunk": "@@ -238,6 +247,7 @@ def __init__(self,\n     self.execution_context = None  # type: Optional[ExecutionContext]\n     self.consumers = collections.defaultdict(\n         list)  # type: DefaultDict[int, List[Operation]]\n+    self.producer = None", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE2NjAzNQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466166035", "bodyText": "Ah thanks, I'm not actually updating the value in the child class, DoOperation, so let me get rid of that and directly pass None", "author": "saavannanavati", "createdAt": "2020-08-06T06:06:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3OTEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MDY0NA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464680644", "bodyText": "What if this transform has a type hint and the DoFn itself has a type hint? Will we check both?\nI would probably create the dictionary of {type hint source string: type hint} right here, pre-packaged and ready to be used directly from the worker.", "author": "robertwb", "createdAt": "2020-08-03T21:50:04Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +268,71 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo):\n+      if not self._in_combine:\n+        transform.fn._full_label = applied_transform.full_label\n+        self.store_type_hints(transform)\n+\n+  def store_type_hints(self, transform):\n+    type_hints = transform.get_type_hints()\n+\n+    input_types = None\n+    if type_hints.input_types:\n+      normal_hints, kwarg_hints = type_hints.input_types\n+\n+      if kwarg_hints:\n+        input_types = kwarg_hints\n+      if normal_hints:\n+        input_types = normal_hints\n+\n+    output_types = None\n+    if type_hints.output_types:\n+      normal_hints, kwarg_hints = type_hints.output_types\n+\n+      if kwarg_hints:\n+        output_types = kwarg_hints\n+      if normal_hints:\n+        output_types = normal_hints\n+\n+    try:\n+      argspec = inspect.getfullargspec(transform.fn._process_argspec_fn())\n+      if len(argspec.args):\n+        arg_index = 0\n+        if argspec.args[0] == 'self':\n+          arg_index = 1\n+        transform.fn._runtime_parameter_name = argspec.args[arg_index]\n+        if isinstance(input_types, dict):\n+          input_types = (input_types[argspec.args[arg_index]], )\n+    except TypeError:\n+      pass\n+\n+    if input_types and len(input_types):\n+      input_types = input_types[0]\n+\n+    if output_types and len(output_types):\n+      output_types = output_types[0]\n+\n+    transform.fn._runtime_type_hints = type_hints._replace(\n+        input_types=input_types, output_types=output_types)", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE5MjgyOQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466192829", "bodyText": "Through debugging, I've noticed that the type hints are always stored in the transforms and not the DoFn's for some reason. Do you know of a case where the DoFn stores the type hint?\n\n\nSounds good, moved (most of) the pre-processing computation here", "author": "saavannanavati", "createdAt": "2020-08-06T07:13:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MDY0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MTA1Ng==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464681056", "bodyText": "Why is this Python 3 only? (Not that Python 2 is going to be around for long...)", "author": "robertwb", "createdAt": "2020-08-03T21:51:04Z", "path": "website/www/site/content/en/documentation/sdks/python-type-safety.md", "diffHunk": "@@ -210,7 +210,21 @@ However, if you enable runtime type checking, the code is guaranteed to fail at\n {{< code_sample \"sdks/python/apache_beam/examples/snippets/snippets_test.py\" type_hints_runtime_on >}}\n {{< /highlight >}}\n \n-Note that because runtime type checks are done for each `PCollection` element, enabling this feature may incur a significant performance penalty. It is therefore recommended that runtime type checks are disabled for production pipelines.\n+Note that because runtime type checks are done for each `PCollection` element, enabling this feature may incur a significant performance penalty. It is therefore recommended that runtime type checks are disabled for production pipelines. See the following section for a quicker, production-friendly alternative.\n+\n+### Faster Runtime Type Checking\n+You can enable faster, sampling-based runtime type checking by setting the pipeline option `performance_runtime_type_check` to `True`.\n+\n+The is a Python 3 only feature that works by runtime type checking a small subset of values, called a sample, using optimized Cython code.", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI5MzY4MA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r465293680", "bodyText": "We use inspect.getfullargspec in typecheck.py L320 which is Py3 only. It could be refactored to support Py2, but like you say, it's not going to be around for much longer so it may not be worth the effort", "author": "saavannanavati", "createdAt": "2020-08-04T19:53:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MTA1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyNzc0MA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466727740", "bodyText": "Ack. Sounds good to keep it as Python 3 only.", "author": "robertwb", "createdAt": "2020-08-06T22:53:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MTA1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MTMwOA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464681308", "bodyText": "Rather than enumerating the transforms here, I would just say that it doesn't run on combining operations.", "author": "robertwb", "createdAt": "2020-08-03T21:51:41Z", "path": "website/www/site/content/en/documentation/sdks/python-type-safety.md", "diffHunk": "@@ -210,7 +210,21 @@ However, if you enable runtime type checking, the code is guaranteed to fail at\n {{< code_sample \"sdks/python/apache_beam/examples/snippets/snippets_test.py\" type_hints_runtime_on >}}\n {{< /highlight >}}\n \n-Note that because runtime type checks are done for each `PCollection` element, enabling this feature may incur a significant performance penalty. It is therefore recommended that runtime type checks are disabled for production pipelines.\n+Note that because runtime type checks are done for each `PCollection` element, enabling this feature may incur a significant performance penalty. It is therefore recommended that runtime type checks are disabled for production pipelines. See the following section for a quicker, production-friendly alternative.\n+\n+### Faster Runtime Type Checking\n+You can enable faster, sampling-based runtime type checking by setting the pipeline option `performance_runtime_type_check` to `True`.\n+\n+The is a Python 3 only feature that works by runtime type checking a small subset of values, called a sample, using optimized Cython code.\n+\n+Currently, this feature does not support runtime type checking for side inputs or combine operations. Specifically, this feature will not runtime type check the following transforms:", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MTc3MA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464681770", "bodyText": "Why not?", "author": "robertwb", "createdAt": "2020-08-03T21:52:49Z", "path": "sdks/python/apache_beam/pipeline.py", "diffHunk": "@@ -520,10 +520,26 @@ def run(self, test_runner_api='AUTO'):\n             self._options,\n             allow_proto_holders=True).run(False)\n \n+      if (self._options.view_as(TypeOptions).runtime_type_check and\n+          self._options.view_as(TypeOptions).performance_runtime_type_check):\n+        raise RuntimeError(", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMwMjc1MQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r465302751", "bodyText": "I don't see a use case. The existing runtime_type_check flag does everything that performance_runtime_type_check does but more, since it runtime type-checks everything instead of sampling. If a user turns on both, they lose performance in 2 ways with no added benefit coming from the performance_runtime_type_check. What do you think?", "author": "saavannanavati", "createdAt": "2020-08-04T20:11:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MTc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyNjczMQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466726731", "bodyText": "I think eventually we'll want to consolidate the two. I suppose we can prohibit setting both if we want.", "author": "robertwb", "createdAt": "2020-08-06T22:50:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MTc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMzNTU1NQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468335555", "bodyText": "Sounds good", "author": "saavannanavati", "createdAt": "2020-08-11T05:32:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MTc3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MzMzNg==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464683336", "bodyText": "Move this logic into the visitor, rather than doing graph inspection on the workers. This will also allow us to consolidate all type checks into a single dict, rather than having redundant code for producer/consumer.", "author": "robertwb", "createdAt": "2020-08-03T21:56:46Z", "path": "sdks/python/apache_beam/runners/worker/opcounters.py", "diffHunk": "@@ -202,6 +209,37 @@ def __init__(\n     self._sample_counter = 0\n     self._next_sample = 0\n \n+    self.producer_type_hints = None\n+    self.producer_full_label = None\n+    self.producer_parameter_name = None\n+\n+    if producer and hasattr(producer, 'spec') and hasattr(producer.spec,\n+                                                          'serialized_fn'):\n+      fns = pickler.loads(producer.spec.serialized_fn)\n+      if fns:\n+        if hasattr(fns[0], '_runtime_type_hints'):\n+          self.producer_type_hints = fns[0]._runtime_type_hints\n+        if hasattr(fns[0], '_full_label'):\n+          self.producer_full_label = fns[0]._full_label\n+        if hasattr(fns[0], '_runtime_parameter_name'):\n+          self.producer_parameter_name = fns[0]._runtime_parameter_name\n+\n+    self.consumer_type_hints = []\n+    self.consumer_full_labels = []\n+    self.consumer_parameter_names = []\n+\n+    if consumers:", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE2ODU5Nw==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466168597", "bodyText": "I moved as much logic as possible to the visitor (and removed the duplicated code) but kept the producer/consumer distinction because that determines whether we type check using the output types (for the producer) versus the input types (for the consumer)", "author": "saavannanavati", "createdAt": "2020-08-06T06:14:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MzMzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MzYxNA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r464683614", "bodyText": "This logic belongs in the ParDoOperator (which I think already has a deserialized fn in hand).", "author": "robertwb", "createdAt": "2020-08-03T21:57:30Z", "path": "sdks/python/apache_beam/runners/worker/opcounters.py", "diffHunk": "@@ -202,6 +209,37 @@ def __init__(\n     self._sample_counter = 0\n     self._next_sample = 0\n \n+    self.producer_type_hints = None\n+    self.producer_full_label = None\n+    self.producer_parameter_name = None\n+\n+    if producer and hasattr(producer, 'spec') and hasattr(producer.spec,", "originalCommit": "6177c9b164ec15879d34bb1f3236faa31a2edd0b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyOTU5OQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466729599", "bodyText": "This should just be None (or better, omitted) for operations without specs. We should probably just have a method on ParDoOperation to extract the type hints  as this is the one case we support.", "author": "robertwb", "createdAt": "2020-08-06T22:59:04Z", "path": "sdks/python/apache_beam/runners/worker/bundle_processor.py", "diffHunk": "@@ -188,7 +189,8 @@ def __init__(self,\n             self.name_context.step_name,\n             0,\n             next(iter(itervalues(consumers))),\n-            self.windowed_coder)\n+            self.windowed_coder,\n+            get_perf_runtime_type_hints(self))", "originalCommit": "108e86960028af97e8b5d725e26593df77f0abc5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NzY0OA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r466747648", "bodyText": "TODO: During graph construction, don't add any None constraints. This will allow us to remove this check", "author": "saavannanavati", "createdAt": "2020-08-06T23:59:34Z", "path": "sdks/python/apache_beam/runners/worker/opcounters.py", "diffHunk": "@@ -224,8 +230,25 @@ def _observable_callback_inner(value, is_encoded=False):\n \n     return _observable_callback_inner\n \n+  def type_check(self, value):\n+    # type: (any, bool) -> None\n+    for transform_label, type_constraint_tuple in self.output_type_constraints.items():\n+      parameter_name, constraint = type_constraint_tuple\n+      if constraint is not None:", "originalCommit": "70e22b0a2685e29bc56d38d03c77808a52530e96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4NTcxOQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468085719", "bodyText": "Yes, please do that.", "author": "robertwb", "createdAt": "2020-08-10T18:07:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NzY0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4NTU0Mw==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468085543", "bodyText": "I don't think we want to mess with this. (Also, if we do, let's push this logic up into the visitor where we decide the label.)", "author": "robertwb", "createdAt": "2020-08-10T18:07:11Z", "path": "sdks/python/apache_beam/runners/worker/opcounters.py", "diffHunk": "@@ -224,8 +230,25 @@ def _observable_callback_inner(value, is_encoded=False):\n \n     return _observable_callback_inner\n \n+  def type_check(self, value):\n+    # type: (any, bool) -> None\n+    for transform_label, type_constraint_tuple in self.output_type_constraints.items():\n+      parameter_name, constraint = type_constraint_tuple\n+      if constraint is not None:\n+        try:\n+          _check_instance_type(constraint, value, parameter_name, verbose=True)\n+        except TypeCheckError as e:\n+          if not transform_label.startswith('ParDo'):", "originalCommit": "70e22b0a2685e29bc56d38d03c77808a52530e96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMyOTY0Mw==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468329643", "bodyText": "Okay, I pushed the logic up. The reason is so we stay consistent with how the existing error message is formatted.", "author": "saavannanavati", "createdAt": "2020-08-11T05:09:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4NTU0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTcyNQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470939725", "bodyText": "Oh... Yeah, changing all the error messages would be a pain, even if they're wrong now. Can you file a JIRA and drop a TODO to fix that then?", "author": "robertwb", "createdAt": "2020-08-15T05:16:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4NTU0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA3NTU3OQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r471075579", "bodyText": "Sure - who should I assign the TODO to?", "author": "saavannanavati", "createdAt": "2020-08-16T07:04:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4NTU0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4ODkwMw==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468088903", "bodyText": "This isn't correct, these type hints should not be used for this counter. Make this an optional argument defaulting to None and don't pass it here.", "author": "robertwb", "createdAt": "2020-08-10T18:13:38Z", "path": "sdks/python/apache_beam/runners/worker/operations.py", "diffHunk": "@@ -600,7 +627,8 @@ def _read_side_inputs(self, tags_and_types):\n           self.name_context.step_name,\n           view_options['coder'],\n           i,\n-          suffix='side-input')\n+          suffix='side-input',\n+          producer_type_hints=get_perf_runtime_type_hints(self))", "originalCommit": "70e22b0a2685e29bc56d38d03c77808a52530e96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMyOTk4Ng==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468329986", "bodyText": "Sounds good", "author": "saavannanavati", "createdAt": "2020-08-11T05:11:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4ODkwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4OTk1MA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468089950", "bodyText": "Why could this fail?", "author": "robertwb", "createdAt": "2020-08-10T18:15:31Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +269,95 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Store output type hints in current transform\n+      transform.fn._runtime_output_constraints = {\n+          applied_transform.full_label: self.get_output_type_hints(transform)\n+      }\n+\n+      # Store input type hints in producer transform\n+      producer = applied_transform.inputs[0].producer\n+      if (hasattr(producer, 'transform') and", "originalCommit": "70e22b0a2685e29bc56d38d03c77808a52530e96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMyODQ3Mg==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468328472", "bodyText": "This used to error out with Impulse objects but adding the new method _add_type_constraint_from_consumer to PTransform fixed it", "author": "saavannanavati", "createdAt": "2020-08-11T05:05:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4OTk1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5MDcyOA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468090728", "bodyText": "Cleaner to check isinstance(transform, core.ParDo).\nEven better would be to add a method like _add_producer_type_constraint to PTransform, default implementation empty, overridden in ParDo.", "author": "robertwb", "createdAt": "2020-08-10T18:16:55Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +269,95 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Store output type hints in current transform\n+      transform.fn._runtime_output_constraints = {\n+          applied_transform.full_label: self.get_output_type_hints(transform)\n+      }\n+\n+      # Store input type hints in producer transform\n+      producer = applied_transform.inputs[0].producer\n+      if (hasattr(producer, 'transform') and\n+          hasattr(producer.transform, 'fn') and", "originalCommit": "70e22b0a2685e29bc56d38d03c77808a52530e96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMzNTIzMA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468335230", "bodyText": "Awesome, added it", "author": "saavannanavati", "createdAt": "2020-08-11T05:31:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5MDcyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5MDk4MQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468090981", "bodyText": "We would want to add this regardless of the dict already being present, right? Perhaps with the above method that'd be simpler.", "author": "robertwb", "createdAt": "2020-08-10T18:17:26Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +269,95 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Store output type hints in current transform\n+      transform.fn._runtime_output_constraints = {\n+          applied_transform.full_label: self.get_output_type_hints(transform)\n+      }\n+\n+      # Store input type hints in producer transform\n+      producer = applied_transform.inputs[0].producer\n+      if (hasattr(producer, 'transform') and\n+          hasattr(producer.transform, 'fn') and\n+          hasattr(producer.transform.fn, '_runtime_output_constraints')):", "originalCommit": "70e22b0a2685e29bc56d38d03c77808a52530e96", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA5MTI2OA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r468091268", "bodyText": "Style: in Beam we avoid backslash line brakes. You can use yapf to break your lines for you. (If needed, add ()'s)>", "author": "robertwb", "createdAt": "2020-08-10T18:18:00Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +269,95 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Store output type hints in current transform\n+      transform.fn._runtime_output_constraints = {\n+          applied_transform.full_label: self.get_output_type_hints(transform)\n+      }\n+\n+      # Store input type hints in producer transform\n+      producer = applied_transform.inputs[0].producer\n+      if (hasattr(producer, 'transform') and\n+          hasattr(producer.transform, 'fn') and\n+          hasattr(producer.transform.fn, '_runtime_output_constraints')):\n+        producer = producer.transform.fn\n+        producer._runtime_output_constraints[applied_transform.full_label] \\", "originalCommit": "70e22b0a2685e29bc56d38d03c77808a52530e96", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzNzM5Ng==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470937396", "bodyText": "Why this change? Is encoded actually a list sometimes? (In which case, how did it ever pass?)", "author": "robertwb", "createdAt": "2020-08-15T04:44:30Z", "path": "sdks/python/apache_beam/examples/snippets/snippets.py", "diffHunk": "@@ -689,8 +689,9 @@ def examples_wordcount_streaming(argv):\n \n     output = (\n         lines\n-        | 'DecodeUnicode' >>\n-        beam.FlatMap(lambda encoded: encoded.decode('utf-8'))\n+        | 'DecodeUnicode' >> beam.FlatMap(\n+            lambda encoded:\n+            (encoded if isinstance(encoded, list) else encoded.decode('utf-8')))", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA3NTc0Mg==", "url": "https://github.com/apache/beam/pull/12352#discussion_r471075742", "bodyText": "We changed a test to use a list instead of bytes, since it was written incorrectly", "author": "saavannanavati", "createdAt": "2020-08-16T07:06:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzNzM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwODEyNQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r473208125", "bodyText": "What I'm really asking was why was the test wrong? Isn't a list the wrong thing to pass to the next operation, ExtractWords, which uses re.findall?", "author": "robertwb", "createdAt": "2020-08-19T17:35:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzNzM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI5NDYyNA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r473294624", "bodyText": "Oh yeah I see. The test is wrong now, but it was also wrong before because it returned an output value of type bytes, which we now throw an error for in process_outputs of common.py. We had an email thread about this earlier which I'll send a reply to for more context.", "author": "saavannanavati", "createdAt": "2020-08-19T20:19:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzNzM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQxNTk5OA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r473415998", "bodyText": "This should be changed to beam.Map(lambda encoded: encoded.decode('utf-8')) and the test values below changed back to bytes.", "author": "robertwb", "createdAt": "2020-08-19T23:06:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzNzM5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzNzYwNg==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470937606", "bodyText": "This seems incorrect for Map(...) or Composite/ParDo(...). I don't think we should add a ParDo(...) if it's not already there (in which case we could drop this whole try-catch).", "author": "robertwb", "createdAt": "2020-08-15T04:47:21Z", "path": "sdks/python/apache_beam/runners/worker/opcounters.py", "diffHunk": "@@ -224,8 +230,25 @@ def _observable_callback_inner(value, is_encoded=False):\n \n     return _observable_callback_inner\n \n+  def type_check(self, value):\n+    # type: (any, bool) -> None\n+    for transform_label, type_constraint_tuple in (\n+            self.output_type_constraints.items()):\n+      parameter_name, constraint = type_constraint_tuple\n+      try:\n+        _check_instance_type(constraint, value, parameter_name, verbose=True)\n+      except TypeCheckError as e:\n+        if not transform_label.startswith('ParDo'):", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzMTQzNg==", "url": "https://github.com/apache/beam/pull/12352#discussion_r473231436", "bodyText": "Drop a TODO(BEAM-10710) here as well.", "author": "robertwb", "createdAt": "2020-08-19T18:17:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzNzYwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzNzk2NQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470937965", "bodyText": "Omit this line. Different operations could choose to store them in different places (e.g. not all operations even have a serialized_fn).\nAlso, the line about \"This is only overridden by DoOperation's.\" is liable to go out of date (but unlikely to be updated) if we provide this anywhere else, and isn't important to this interface, so can be removed as well.\nWhat you might want to document, however, is the type of the return value.", "author": "robertwb", "createdAt": "2020-08-15T04:52:23Z", "path": "sdks/python/apache_beam/runners/worker/operations.py", "diffHunk": "@@ -452,6 +476,14 @@ def str_internal(self, is_recursive=False):\n \n     return '<%s %s>' % (printable_name, ', '.join(printable_fields))\n \n+  def _get_runtime_performance_hints(self):\n+    \"\"\"Returns any type hints required for performance runtime type-checking.\n+    These type hints are stored in the operation's spec's serialized_fn.", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzODMxOQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470938319", "bodyText": "Likewise, omit this comment about ParDo.", "author": "robertwb", "createdAt": "2020-08-15T04:57:05Z", "path": "sdks/python/apache_beam/transforms/ptransform.py", "diffHunk": "@@ -702,6 +702,14 @@ def to_runner_api_pickled(self, unused_context):\n   def runner_api_requires_keyed_input(self):\n     return False\n \n+  def _add_type_constraint_from_consumer(self, full_label, input_type_hints):\n+    \"\"\"Adds a consumer transform's input type hints to our output type\n+    constraints, which is used during performance runtime type-checking.\n+\n+    This is only overridden by ParDo's.", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzODUwMw==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470938503", "bodyText": "gettattr doesn't add the value if it's not present, you'll have to do\nif not hasattr(...):\n    self.fn._runtime_output_constraints = {}\nself.fn._runtime_output_constraints[...] = ...\n\n(I think this should be caught by tests, could you be sure you have a test that fails before fixing this?)", "author": "robertwb", "createdAt": "2020-08-15T04:59:32Z", "path": "sdks/python/apache_beam/transforms/core.py", "diffHunk": "@@ -1465,6 +1465,11 @@ def get_restriction_coder(self):\n     from apache_beam.runners.common import DoFnSignature\n     return DoFnSignature(self.fn).get_restriction_coder()\n \n+  def _add_type_constraint_from_consumer(self, full_label, input_type_hints):\n+    output_constraints = getattr(self.fn, '_runtime_output_constraints', {})", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzODYwMQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470938601", "bodyText": "Oh, I see you do it here. I think the logic would be clearer as above.", "author": "robertwb", "createdAt": "2020-08-15T05:00:35Z", "path": "sdks/python/apache_beam/transforms/core.py", "diffHunk": "@@ -1465,6 +1465,11 @@ def get_restriction_coder(self):\n     from apache_beam.runners.common import DoFnSignature\n     return DoFnSignature(self.fn).get_restriction_coder()\n \n+  def _add_type_constraint_from_consumer(self, full_label, input_type_hints):\n+    output_constraints = getattr(self.fn, '_runtime_output_constraints', {})\n+    output_constraints[full_label] = input_type_hints\n+    self.fn._runtime_output_constraints = output_constraints", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzODY3OQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470938679", "bodyText": "You're recording that the type hint comes from this transform, but are you recording that it comes from the input of this transform? (E.g. if I get a failure about transform B's type hint being violated, it may not be clear if it was its input type or output type that was bad.)", "author": "robertwb", "createdAt": "2020-08-15T05:01:58Z", "path": "sdks/python/apache_beam/transforms/core.py", "diffHunk": "@@ -1465,6 +1465,11 @@ def get_restriction_coder(self):\n     from apache_beam.runners.common import DoFnSignature\n     return DoFnSignature(self.fn).get_restriction_coder()\n \n+  def _add_type_constraint_from_consumer(self, full_label, input_type_hints):", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE3NDQyNw==", "url": "https://github.com/apache/beam/pull/12352#discussion_r471174427", "bodyText": "Yes, we store this information during get_input_type_hints which produces the data that's passed to _add_type_constraint_from_consumer.\nI added a test called test_downstream_input_type_hint_error_has_descriptive_error_msg to confirm this behavior, but let me know if that doesn't cover the case you're talking about.", "author": "saavannanavati", "createdAt": "2020-08-16T23:43:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzODY3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzODc2OA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470938768", "bodyText": "This will overwrite any typehint constraints that may have been set earlier. Instead, use the same method.", "author": "robertwb", "createdAt": "2020-08-15T05:03:00Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +268,89 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Prefix label with 'ParDo' if necessary\n+      full_label = applied_transform.full_label\n+      if not full_label.startswith('ParDo'):\n+        full_label = 'ParDo(%s)' % full_label\n+\n+      # Store output type hints in current transform\n+      transform.fn._runtime_output_constraints = {}", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzODc5OQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470938799", "bodyText": "Don't add this prefix.", "author": "robertwb", "createdAt": "2020-08-15T05:03:26Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +268,89 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Prefix label with 'ParDo' if necessary", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE2MjEwNA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r471162104", "bodyText": "Okay, I'll remove it. With regards to the JIRA issue filed from our conversation about this, I'll move the TODO to where 'ParDo' is currently being prefixed for other error messages here.", "author": "saavannanavati", "createdAt": "2020-08-16T21:41:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzODc5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzODg0Ng==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470938846", "bodyText": "Nit: move this line into the if block.", "author": "robertwb", "createdAt": "2020-08-15T05:04:19Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +268,89 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Prefix label with 'ParDo' if necessary\n+      full_label = applied_transform.full_label\n+      if not full_label.startswith('ParDo'):\n+        full_label = 'ParDo(%s)' % full_label\n+\n+      # Store output type hints in current transform\n+      transform.fn._runtime_output_constraints = {}\n+      output_type_hints = self.get_output_type_hints(transform)\n+      if output_type_hints:\n+        transform.fn._runtime_output_constraints[full_label] = (\n+            output_type_hints)\n+\n+      # Store input type hints in producer transform\n+      producer = applied_transform.inputs[0].producer", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTIzMQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470939231", "bodyText": "This does not need to be guarded by if isinstance(transform, core.ParDo), we can do it for all transforms. (Actually, the same could be said of the output type hints if we eliminated the direct access to _runtime_output_constraints as mentioned above.", "author": "robertwb", "createdAt": "2020-08-15T05:09:14Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +268,89 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Prefix label with 'ParDo' if necessary\n+      full_label = applied_transform.full_label\n+      if not full_label.startswith('ParDo'):\n+        full_label = 'ParDo(%s)' % full_label\n+\n+      # Store output type hints in current transform\n+      transform.fn._runtime_output_constraints = {}\n+      output_type_hints = self.get_output_type_hints(transform)\n+      if output_type_hints:\n+        transform.fn._runtime_output_constraints[full_label] = (\n+            output_type_hints)\n+\n+      # Store input type hints in producer transform", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTM0Nw==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470939347", "bodyText": "If this results in test failures due to more (incorrect) type hints being applied, feel free to drop a TODO here for future work.", "author": "robertwb", "createdAt": "2020-08-15T05:10:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTIzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE2NTA1NA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r471165054", "bodyText": "It fails for Impulse, GroupByKey, Flatten and a few other transforms. Sounds good, added a TODO for now.", "author": "saavannanavati", "createdAt": "2020-08-16T22:11:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTIzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE2OTY0OQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r471169649", "bodyText": "Nevermind, fixed it :)", "author": "saavannanavati", "createdAt": "2020-08-16T22:59:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTIzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTI4NQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470939285", "bodyText": "Also visit this transform to get its typehints, if any?", "author": "robertwb", "createdAt": "2020-08-15T05:09:47Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +268,89 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTQyMg==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470939422", "bodyText": "This is the one bit that might need to be guarded by DoFn.", "author": "robertwb", "createdAt": "2020-08-15T05:11:37Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +268,89 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Prefix label with 'ParDo' if necessary\n+      full_label = applied_transform.full_label\n+      if not full_label.startswith('ParDo'):\n+        full_label = 'ParDo(%s)' % full_label\n+\n+      # Store output type hints in current transform\n+      transform.fn._runtime_output_constraints = {}\n+      output_type_hints = self.get_output_type_hints(transform)\n+      if output_type_hints:\n+        transform.fn._runtime_output_constraints[full_label] = (\n+            output_type_hints)\n+\n+      # Store input type hints in producer transform\n+      producer = applied_transform.inputs[0].producer\n+      input_type_hints = self.get_input_type_hints(transform)\n+      if input_type_hints:\n+        producer.transform._add_type_constraint_from_consumer(\n+            full_label, input_type_hints)\n+\n+  def get_input_type_hints(self, transform):\n+    type_hints = transform.get_type_hints()\n+\n+    input_types = None\n+    if type_hints.input_types:\n+      normal_hints, kwarg_hints = type_hints.input_types\n+      if kwarg_hints:\n+        input_types = kwarg_hints\n+      if normal_hints:\n+        input_types = normal_hints\n+\n+    parameter_name = 'Unknown Parameter'\n+    try:", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTQ1MQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r470939451", "bodyText": "Why would TypeError be raised?", "author": "robertwb", "createdAt": "2020-08-15T05:11:52Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +268,89 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+\n+  _in_combine = False\n+  combine_classes = (\n+      core.CombineFn,\n+      core.CombinePerKey,\n+      core.CombineValuesDoFn,\n+      core.CombineValues,\n+      core.CombineGlobally)\n+\n+  def enter_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = True\n+\n+  def leave_composite_transform(self, applied_transform):\n+    if isinstance(applied_transform.transform, self.combine_classes):\n+      self._in_combine = False\n+\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    if isinstance(transform, core.ParDo) and not self._in_combine:\n+      # Prefix label with 'ParDo' if necessary\n+      full_label = applied_transform.full_label\n+      if not full_label.startswith('ParDo'):\n+        full_label = 'ParDo(%s)' % full_label\n+\n+      # Store output type hints in current transform\n+      transform.fn._runtime_output_constraints = {}\n+      output_type_hints = self.get_output_type_hints(transform)\n+      if output_type_hints:\n+        transform.fn._runtime_output_constraints[full_label] = (\n+            output_type_hints)\n+\n+      # Store input type hints in producer transform\n+      producer = applied_transform.inputs[0].producer\n+      input_type_hints = self.get_input_type_hints(transform)\n+      if input_type_hints:\n+        producer.transform._add_type_constraint_from_consumer(\n+            full_label, input_type_hints)\n+\n+  def get_input_type_hints(self, transform):\n+    type_hints = transform.get_type_hints()\n+\n+    input_types = None\n+    if type_hints.input_types:\n+      normal_hints, kwarg_hints = type_hints.input_types\n+      if kwarg_hints:\n+        input_types = kwarg_hints\n+      if normal_hints:\n+        input_types = normal_hints\n+\n+    parameter_name = 'Unknown Parameter'\n+    try:\n+      argspec = inspect.getfullargspec(transform.fn._process_argspec_fn())\n+      if len(argspec.args):\n+        arg_index = 0\n+        if argspec.args[0] == 'self':\n+          arg_index = 1\n+        parameter_name = argspec.args[arg_index]\n+        if isinstance(input_types, dict):\n+          input_types = (input_types[argspec.args[arg_index]], )\n+    except TypeError:", "originalCommit": "8ba15de2bead40991f2fb16a56e0cd8b4f0171ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE2MzI5NQ==", "url": "https://github.com/apache/beam/pull/12352#discussion_r471163295", "bodyText": "This is for when an unsupported callable is passed to inspect.getfullargspec. I updated the code so this is more clear.", "author": "saavannanavati", "createdAt": "2020-08-16T21:53:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzOTQ1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxMDAzOA==", "url": "https://github.com/apache/beam/pull/12352#discussion_r473210038", "bodyText": "Use transform._add_type_constraint_from_consumer rather than direct access here as well. Then you can get rid of hasattr(transform, 'fn') and just write\noutput_type_hints = self.get_output_type_hints(transform)\nif output_type_hints:\n  transform._add_type_constraint_from_consumer(output_type_hints)", "author": "robertwb", "createdAt": "2020-08-19T17:39:11Z", "path": "sdks/python/apache_beam/typehints/typecheck.py", "diffHunk": "@@ -265,3 +269,74 @@ def visit_transform(self, applied_transform):\n                 transform.get_type_hints(),\n                 applied_transform.full_label),\n             applied_transform.full_label)\n+\n+\n+class PerformanceTypeCheckVisitor(pipeline.PipelineVisitor):\n+  def visit_transform(self, applied_transform):\n+    transform = applied_transform.transform\n+    full_label = applied_transform.full_label\n+\n+    # Store output type hints in current transform\n+    if hasattr(transform, 'fn'):\n+      if not hasattr(transform.fn, '_runtime_output_constraints'):", "originalCommit": "a1fd8352a7be42499dee0b03432926038926609e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9cea2f7c0823676f2329537f3a1bc7da13a723bf", "url": "https://github.com/apache/beam/commit/9cea2f7c0823676f2329537f3a1bc7da13a723bf", "message": "Add performance runtime type check flag", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "a1610a818cb8ef90ad29c3c7f380d4fa44ca891f", "url": "https://github.com/apache/beam/commit/a1610a818cb8ef90ad29c3c7f380d4fa44ca891f", "message": "Add PerformanceTypeCheckVisitor which stores type hints in DoFns", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "4cb5ca1a4a938aacf8f75f7221799dad67650b37", "url": "https://github.com/apache/beam/commit/4cb5ca1a4a938aacf8f75f7221799dad67650b37", "message": "Store the type hints in the OperationCounters class", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "59daa2d6401dfbe13efc860075ab95028497bd8f", "url": "https://github.com/apache/beam/commit/59daa2d6401dfbe13efc860075ab95028497bd8f", "message": "Runtime type checking works with input values", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "8c44258fa936afe49717a0203fa2d8ac7b84f806", "url": "https://github.com/apache/beam/commit/8c44258fa936afe49717a0203fa2d8ac7b84f806", "message": "Runtime type checking works with output values", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "1f600d97b79d81df0e6e4db5680a89553919726e", "url": "https://github.com/apache/beam/commit/1f600d97b79d81df0e6e4db5680a89553919726e", "message": "Declare type_check function in cython and reduce error handling code", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "f708d1d59193b6e7faa3e73bea4ad3b5a881f97c", "url": "https://github.com/apache/beam/commit/f708d1d59193b6e7faa3e73bea4ad3b5a881f97c", "message": "Throw error if both flags are on", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "413d8fe13cd96112fb3e2a4698df275f7f0d81ea", "url": "https://github.com/apache/beam/commit/413d8fe13cd96112fb3e2a4698df275f7f0d81ea", "message": "Use producer and consumer Operations' type hints", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "e9fee8b6222d00cd8a694ef741d3b27c359fd837", "url": "https://github.com/apache/beam/commit/e9fee8b6222d00cd8a694ef741d3b27c359fd837", "message": "Store in _runtime_type_hints instead of _type_hints", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "fede55b748d1534b6e559f97e9fd28a56405feb4", "url": "https://github.com/apache/beam/commit/fede55b748d1534b6e559f97e9fd28a56405feb4", "message": "Simplify extraction process of type hints", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "645b6c20f71e9d3131d7822a0ecfa47b36609a7c", "url": "https://github.com/apache/beam/commit/645b6c20f71e9d3131d7822a0ecfa47b36609a7c", "message": "Rename variables", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "6d0e67d3265c79c42781624748074c99410afd69", "url": "https://github.com/apache/beam/commit/6d0e67d3265c79c42781624748074c99410afd69", "message": "Use correct type hints in broken tests", "committedDate": "2020-08-19T20:28:21Z", "type": "commit"}, {"oid": "26add2a587efa7eb66fb8b7c7ee2bb6b9da4593e", "url": "https://github.com/apache/beam/commit/26add2a587efa7eb66fb8b7c7ee2bb6b9da4593e", "message": "Add equivalent tests for both runtime type checking flags without duplication", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "8113343ba32e9beddbfda703c563ac3685ccf01d", "url": "https://github.com/apache/beam/commit/8113343ba32e9beddbfda703c563ac3685ccf01d", "message": "Remove accidental changes", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "31963339acc890e021a882619ae01146191f4e42", "url": "https://github.com/apache/beam/commit/31963339acc890e021a882619ae01146191f4e42", "message": "Fixup: apply YAPF", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "2ca9c0b698aa36236ec2d174849cc38acd1f39ad", "url": "https://github.com/apache/beam/commit/2ca9c0b698aa36236ec2d174849cc38acd1f39ad", "message": "Remove redundant test", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "31d17961161d1c72e028572bf563f78ad86103b4", "url": "https://github.com/apache/beam/commit/31d17961161d1c72e028572bf563f78ad86103b4", "message": "Fix cython error", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "db06489a999f81ffcd6f96867fd92938f36f99b6", "url": "https://github.com/apache/beam/commit/db06489a999f81ffcd6f96867fd92938f36f99b6", "message": "Fix cython error", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "793e5740aa425c3daea7d5525c7dbc846b23564f", "url": "https://github.com/apache/beam/commit/793e5740aa425c3daea7d5525c7dbc846b23564f", "message": "Fix cython error", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "0ccba4d7d1d7cd4bb57c04a4efe7e79c1bb69d6e", "url": "https://github.com/apache/beam/commit/0ccba4d7d1d7cd4bb57c04a4efe7e79c1bb69d6e", "message": "Fix update_counters_finish", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "de195b3e9a648b4cd2fc8bab555b84d57e8b71af", "url": "https://github.com/apache/beam/commit/de195b3e9a648b4cd2fc8bab555b84d57e8b71af", "message": "Fix bugs, and py2 incompatability", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "41ae22605ce78e691bd08cc1b86b22775b0cddc4", "url": "https://github.com/apache/beam/commit/41ae22605ce78e691bd08cc1b86b22775b0cddc4", "message": "Fixup: apply YAPF", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "3f7b6e8aa2ab7b02d7415ff6a93934c7e2df53c4", "url": "https://github.com/apache/beam/commit/3f7b6e8aa2ab7b02d7415ff6a93934c7e2df53c4", "message": "Fix line-too-long error", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "7958f85f121d9ae21699a9c76d907f1bec05110c", "url": "https://github.com/apache/beam/commit/7958f85f121d9ae21699a9c76d907f1bec05110c", "message": "For testing purposes, default to performance_runtime_type_check when both flags are on", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "25c671e527e1e1c8d3bb36bdbd9dc17e036141a3", "url": "https://github.com/apache/beam/commit/25c671e527e1e1c8d3bb36bdbd9dc17e036141a3", "message": "Fix import order", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "ba766c75628c893adc14aa5da38a7f0fa031a470", "url": "https://github.com/apache/beam/commit/ba766c75628c893adc14aa5da38a7f0fa031a470", "message": "Fixup: apply YAPF", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "152507f538a59fee7a608e7bb90ffdfd8d00d3bf", "url": "https://github.com/apache/beam/commit/152507f538a59fee7a608e7bb90ffdfd8d00d3bf", "message": "Fix bug where CombineFns could get type hints", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "51fc98cb154339b8ed4f897c5ec1dd1aee45209f", "url": "https://github.com/apache/beam/commit/51fc98cb154339b8ed4f897c5ec1dd1aee45209f", "message": "Fix ConsumerSet init bug", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "0f80be2b5ddb2328a4b7844d901e47331435b67f", "url": "https://github.com/apache/beam/commit/0f80be2b5ddb2328a4b7844d901e47331435b67f", "message": "Ignore all combine classes, and fix iteration bug", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "73b82de151fe3e6e0d5098112750f221d3716f3c", "url": "https://github.com/apache/beam/commit/73b82de151fe3e6e0d5098112750f221d3716f3c", "message": "Add full labels to transforms", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "3272eb893badcdd4b31658aaea72ddbc9cd90a7b", "url": "https://github.com/apache/beam/commit/3272eb893badcdd4b31658aaea72ddbc9cd90a7b", "message": "Provide more descriptive error message", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "05fc03844b7acd323c66b2a2bed89406d4799534", "url": "https://github.com/apache/beam/commit/05fc03844b7acd323c66b2a2bed89406d4799534", "message": "Fix bug where non-iterables wouldn't be type-checked", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "4b7d325b3b117bcc182573ff54cd1e59e99b57ec", "url": "https://github.com/apache/beam/commit/4b7d325b3b117bcc182573ff54cd1e59e99b57ec", "message": "Store argspec", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "31ec0a993f075d514bfad91bdc3ff15ca954d101", "url": "https://github.com/apache/beam/commit/31ec0a993f075d514bfad91bdc3ff15ca954d101", "message": "Compute type hints in visitor instead of opcounters for perf gains, and to get the main input kwarg", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "f75affa637aefd1aadb450f7fd6e08a395dd9509", "url": "https://github.com/apache/beam/commit/f75affa637aefd1aadb450f7fd6e08a395dd9509", "message": "Fixup: apply YAPF", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "1addd024d567b212b739aeb82b7daa1c57518b87", "url": "https://github.com/apache/beam/commit/1addd024d567b212b739aeb82b7daa1c57518b87", "message": "Fixup: apply YAPF", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "a8e63c38c5946dc597bc01db7b516e6a4e716d64", "url": "https://github.com/apache/beam/commit/a8e63c38c5946dc597bc01db7b516e6a4e716d64", "message": "Fix import order", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "ab3b72dd95a3d8ff1ccc59cd6a689401188e5092", "url": "https://github.com/apache/beam/commit/ab3b72dd95a3d8ff1ccc59cd6a689401188e5092", "message": "Fix lint errors", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "07ffd608d336023c9c2aeaecef5d570298485fd3", "url": "https://github.com/apache/beam/commit/07ffd608d336023c9c2aeaecef5d570298485fd3", "message": "Use param name in error string", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "a7617bfe7ff61888f156eb8486700ea816d54b6b", "url": "https://github.com/apache/beam/commit/a7617bfe7ff61888f156eb8486700ea816d54b6b", "message": "Fixup: apply YAPF", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "9af1dc8066463c1a1e52f3ae9ae9c39f0395b470", "url": "https://github.com/apache/beam/commit/9af1dc8066463c1a1e52f3ae9ae9c39f0395b470", "message": "Fix lint", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "e7e81888c9470c98c592b156febacac39d06e798", "url": "https://github.com/apache/beam/commit/e7e81888c9470c98c592b156febacac39d06e798", "message": "Fix bug where inspect can fail", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "7412cf08f709bf31df8715d0d5ed58a126de8e26", "url": "https://github.com/apache/beam/commit/7412cf08f709bf31df8715d0d5ed58a126de8e26", "message": "Check for dict, str, unicode, bytes types in OutputProcessor", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "755186be5e70aaa877811d0d6a4fc6f01d11389a", "url": "https://github.com/apache/beam/commit/755186be5e70aaa877811d0d6a4fc6f01d11389a", "message": "Fixup: apply YAPF", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "a52486c29184ab33656511c06f0436e934ef461b", "url": "https://github.com/apache/beam/commit/a52486c29184ab33656511c06f0436e934ef461b", "message": "Make feature Python 3 only", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "d644a7caac56a8a71ef2001c2f609fa3f9a43b20", "url": "https://github.com/apache/beam/commit/d644a7caac56a8a71ef2001c2f609fa3f9a43b20", "message": "Update tests to be compatible with both flags", "committedDate": "2020-08-19T20:40:35Z", "type": "commit"}, {"oid": "e3ae9cf2d00cfad8cb0226e69174ef11d0d21958", "url": "https://github.com/apache/beam/commit/e3ae9cf2d00cfad8cb0226e69174ef11d0d21958", "message": "Add tests", "committedDate": "2020-08-19T20:49:42Z", "type": "commit"}, {"oid": "f7c935b923cd5539074d003bba41cdea4d6e290c", "url": "https://github.com/apache/beam/commit/f7c935b923cd5539074d003bba41cdea4d6e290c", "message": "Add more tests", "committedDate": "2020-08-19T20:49:42Z", "type": "commit"}, {"oid": "2c5dcd4e9cbf329fb34b44d24ff2b208e028843b", "url": "https://github.com/apache/beam/commit/2c5dcd4e9cbf329fb34b44d24ff2b208e028843b", "message": "Fix lint errors", "committedDate": "2020-08-19T20:50:35Z", "type": "commit"}, {"oid": "1cd7f0c23ba636f1b2343225e33cb371ce65fdfa", "url": "https://github.com/apache/beam/commit/1cd7f0c23ba636f1b2343225e33cb371ce65fdfa", "message": "Add more tests", "committedDate": "2020-08-19T20:50:53Z", "type": "commit"}, {"oid": "5af07710c4e4ec5fcf3756e096a477c52a2fd808", "url": "https://github.com/apache/beam/commit/5af07710c4e4ec5fcf3756e096a477c52a2fd808", "message": "Leave performance_runtime_type_check off by default", "committedDate": "2020-08-19T20:50:53Z", "type": "commit"}, {"oid": "d0507c58252e14c527ae99bdf42fe10006349c68", "url": "https://github.com/apache/beam/commit/d0507c58252e14c527ae99bdf42fe10006349c68", "message": "Fix lint", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "ac2bfd9f950baa31bff2786f34469ddd42737f06", "url": "https://github.com/apache/beam/commit/ac2bfd9f950baa31bff2786f34469ddd42737f06", "message": "Add website documentation", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "4be7cdbfa33d1144fbdc289e036062879479a046", "url": "https://github.com/apache/beam/commit/4be7cdbfa33d1144fbdc289e036062879479a046", "message": "Use the same value in tests because sampling is non-deterministic", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "dc8224e452c7d014fae9fea2a10e896fe77801ad", "url": "https://github.com/apache/beam/commit/dc8224e452c7d014fae9fea2a10e896fe77801ad", "message": "Update a test", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "2df2aa64475a475613dd51f6e9b902d9aeb2e7d4", "url": "https://github.com/apache/beam/commit/2df2aa64475a475613dd51f6e9b902d9aeb2e7d4", "message": "Remove accidental changes", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "fdf38303dc7e911044df662da2f30df880612d9f", "url": "https://github.com/apache/beam/commit/fdf38303dc7e911044df662da2f30df880612d9f", "message": "PR Fixes", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "8a43744a9986ff7b8fd834da8da7e5430fc15de1", "url": "https://github.com/apache/beam/commit/8a43744a9986ff7b8fd834da8da7e5430fc15de1", "message": "Stage 1 Refactor", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "f23a394f2e8d5f6ec6c0eb266c360313b0e165cf", "url": "https://github.com/apache/beam/commit/f23a394f2e8d5f6ec6c0eb266c360313b0e165cf", "message": "Refactor Stage 2", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "beceef2cf5db1ef30d33854b7a225dd2b36ab3a5", "url": "https://github.com/apache/beam/commit/beceef2cf5db1ef30d33854b7a225dd2b36ab3a5", "message": "Refactor Stage 3", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "85e8d57de838eb09462fcbc34f0e3bf7f13a9641", "url": "https://github.com/apache/beam/commit/85e8d57de838eb09462fcbc34f0e3bf7f13a9641", "message": "Refactor Stage 4", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "ce8209c4819d9eb05b28e2807a97ee4cf7a9bdea", "url": "https://github.com/apache/beam/commit/ce8209c4819d9eb05b28e2807a97ee4cf7a9bdea", "message": "Refactor Stage 5", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "47fdb8db2bf96241df9eae71fbf8b54eb60dedb5", "url": "https://github.com/apache/beam/commit/47fdb8db2bf96241df9eae71fbf8b54eb60dedb5", "message": "Fixup: apply YAPF", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "51c5a00aa59e52f718ce5b88089a433f7ccd24e6", "url": "https://github.com/apache/beam/commit/51c5a00aa59e52f718ce5b88089a433f7ccd24e6", "message": "Add comments for how to type-check side inputs, and lint fixes", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "6c50cedd93e9ae4c3f036b428291f0cdafdcebea", "url": "https://github.com/apache/beam/commit/6c50cedd93e9ae4c3f036b428291f0cdafdcebea", "message": "Use mega type hint", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "507d57498dcf286088b15cdcf3b5da4b1bec7cfb", "url": "https://github.com/apache/beam/commit/507d57498dcf286088b15cdcf3b5da4b1bec7cfb", "message": "PR Fixes: fix None bug, empty type hints, and move label transformation to visitor", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "3d56b828b7ae033bd1dd45cd2b9f6f3d3f840ac8", "url": "https://github.com/apache/beam/commit/3d56b828b7ae033bd1dd45cd2b9f6f3d3f840ac8", "message": "Fix some PR comments", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "18ac071d7b48457303f503cded4ceb9bb9a48e6a", "url": "https://github.com/apache/beam/commit/18ac071d7b48457303f503cded4ceb9bb9a48e6a", "message": "Add new method to PTransform: _add_type_constraint_from_consumer", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "e513b390553f1bf0c76efdd448c59ccc76596b9d", "url": "https://github.com/apache/beam/commit/e513b390553f1bf0c76efdd448c59ccc76596b9d", "message": "Get runtime type hints only from DoOperation instead of all operations", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "e33d30a1731c6a396ef93819df32d7cd3b54ecb9", "url": "https://github.com/apache/beam/commit/e33d30a1731c6a396ef93819df32d7cd3b54ecb9", "message": "Fix lint errors", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "eff003890a1cd4ee192ae2fba42fc1dfb1017891", "url": "https://github.com/apache/beam/commit/eff003890a1cd4ee192ae2fba42fc1dfb1017891", "message": "Fix lint and cython error", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "0d453db4282e6ffd1efb9bffcfc264131c6d9932", "url": "https://github.com/apache/beam/commit/0d453db4282e6ffd1efb9bffcfc264131c6d9932", "message": "Fix test that was written incorrectly", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "09a4893d1e03b3536331e87eeda158d9dbd14030", "url": "https://github.com/apache/beam/commit/09a4893d1e03b3536331e87eeda158d9dbd14030", "message": "Add microbenchmark", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "7a03b617ccbaac3568a92e43e93d6d003955b91a", "url": "https://github.com/apache/beam/commit/7a03b617ccbaac3568a92e43e93d6d003955b91a", "message": "Fix benchmark & lint errors", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "8ea7c08fb5038138c29cceeb8b9317bd770bce4a", "url": "https://github.com/apache/beam/commit/8ea7c08fb5038138c29cceeb8b9317bd770bce4a", "message": "Use averaging in benchmark", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "d59817a29ad348d18af214a31f1c6aa5558ecb53", "url": "https://github.com/apache/beam/commit/d59817a29ad348d18af214a31f1c6aa5558ecb53", "message": "Remove iterable check in common.py for performance concerns", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "68a8eeaf732df59687adcbea7c162165749fe002", "url": "https://github.com/apache/beam/commit/68a8eeaf732df59687adcbea7c162165749fe002", "message": "Add TODO for fixing error message strings", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "6799bc4324789a1baa4edfad9f31cd35d8c5d23a", "url": "https://github.com/apache/beam/commit/6799bc4324789a1baa4edfad9f31cd35d8c5d23a", "message": "Update documentation strings", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "0f93f2a7a768cd2bb6c5d9041a9052e207867098", "url": "https://github.com/apache/beam/commit/0f93f2a7a768cd2bb6c5d9041a9052e207867098", "message": "Update test and move annotations to a comment", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "9488b45d76a8a479160194ee854a9d2a1c272406", "url": "https://github.com/apache/beam/commit/9488b45d76a8a479160194ee854a9d2a1c272406", "message": "Make logic easier to read and document type hints for _add_type_constraint_from_consumer", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "fd6dcdfe7b9c071118e265de0d6e451ee074c3c8", "url": "https://github.com/apache/beam/commit/fd6dcdfe7b9c071118e265de0d6e451ee074c3c8", "message": "Remove ParDo prefix and fix bug", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "55ea454e708d2812a1e5bba003f7c0540d3e480f", "url": "https://github.com/apache/beam/commit/55ea454e708d2812a1e5bba003f7c0540d3e480f", "message": "Remove unnecessary try/except and optimize a selector statement", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "0644a4da04f76d558f47588c42060dccf6bca9a8", "url": "https://github.com/apache/beam/commit/0644a4da04f76d558f47588c42060dccf6bca9a8", "message": "Use type hints for combine functions and add a TODO for removing the isinstance(transform, ParDo) check in the visitor", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "f8c9f742793924d8e964cae12aae2c6d1a877f6f", "url": "https://github.com/apache/beam/commit/f8c9f742793924d8e964cae12aae2c6d1a877f6f", "message": "Extract type hints for all transform types, not just ParDo's", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "cb4aa1cae5310c97a4615f279c51a352c801a6b2", "url": "https://github.com/apache/beam/commit/cb4aa1cae5310c97a4615f279c51a352c801a6b2", "message": "Fix lint errors", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "2a6af1c4c1ddab3d1fd752bdee90ad0c4950c636", "url": "https://github.com/apache/beam/commit/2a6af1c4c1ddab3d1fd752bdee90ad0c4950c636", "message": "Fix type hint annotation docstrings", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "8aecf610fa5375d24e71d679752aa93b1b1817fc", "url": "https://github.com/apache/beam/commit/8aecf610fa5375d24e71d679752aa93b1b1817fc", "message": "Add test and fix type hint docstring", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "7f6a261d2cc5b8ebd22ee8a766b284c6684faa33", "url": "https://github.com/apache/beam/commit/7f6a261d2cc5b8ebd22ee8a766b284c6684faa33", "message": "Turn the perf RTC flag on for testing purposes", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "dd12f83a6b87418a296cebd390fdd98c20ea4c97", "url": "https://github.com/apache/beam/commit/dd12f83a6b87418a296cebd390fdd98c20ea4c97", "message": "Add try/catch for getfullargspec error", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "dcca2f0a0565244b2afc7162278fb8aed8a0fd7c", "url": "https://github.com/apache/beam/commit/dcca2f0a0565244b2afc7162278fb8aed8a0fd7c", "message": "Fix IndexError", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "cfafa0d97256034f23ae51bcb8672372621b5796", "url": "https://github.com/apache/beam/commit/cfafa0d97256034f23ae51bcb8672372621b5796", "message": "Turn flag off", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "f39c47e6120f2baa6abedd1235dcde7d89bbca4e", "url": "https://github.com/apache/beam/commit/f39c47e6120f2baa6abedd1235dcde7d89bbca4e", "message": "Use cleaner syntax", "committedDate": "2020-08-19T20:51:12Z", "type": "commit"}, {"oid": "68b4ce8c8ed13fa446036a0b520e871ff0739c33", "url": "https://github.com/apache/beam/commit/68b4ce8c8ed13fa446036a0b520e871ff0739c33", "message": "Rebase onto master", "committedDate": "2020-08-19T20:55:23Z", "type": "commit"}]}