{"pr_number": 13163, "pr_title": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "pr_createdAt": "2020-10-21T19:39:20Z", "pr_url": "https://github.com/apache/beam/pull/13163", "timeline": [{"oid": "e115d1c855d94ac2ea7fb87e0da525769cf58ea8", "url": "https://github.com/apache/beam/commit/e115d1c855d94ac2ea7fb87e0da525769cf58ea8", "message": "Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-21T20:27:33Z", "type": "forcePushed"}, {"oid": "0232e2342694097199c62d83477f58567029a634", "url": "https://github.com/apache/beam/commit/0232e2342694097199c62d83477f58567029a634", "message": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-21T21:49:08Z", "type": "forcePushed"}, {"oid": "d489bfb28daed4cf6d602c7d67dec312893c8b94", "url": "https://github.com/apache/beam/commit/d489bfb28daed4cf6d602c7d67dec312893c8b94", "message": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-21T21:53:02Z", "type": "forcePushed"}, {"oid": "61ba5e6fbe4959b8d063cac4aa00954168cba060", "url": "https://github.com/apache/beam/commit/61ba5e6fbe4959b8d063cac4aa00954168cba060", "message": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-21T22:01:32Z", "type": "forcePushed"}, {"oid": "2b0033a65591f5e6402deb9416c0dcb9397a9644", "url": "https://github.com/apache/beam/commit/2b0033a65591f5e6402deb9416c0dcb9397a9644", "message": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-21T22:19:09Z", "type": "forcePushed"}, {"oid": "a43aab904cc4efa8cccd7d6d9de5d9ab80fd1761", "url": "https://github.com/apache/beam/commit/a43aab904cc4efa8cccd7d6d9de5d9ab80fd1761", "message": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-21T22:39:39Z", "type": "forcePushed"}, {"oid": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "url": "https://github.com/apache/beam/commit/ff701ba7ee9b78e8d0274032fbbbfb4571146662", "message": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-22T20:09:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MDIwNA==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510480204", "bodyText": "I thought that this would be covered by MonitoringInfosMetadataRequest\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                HarnessMonitoringInfosMetadataRequest harness_monitoring_infos_metadata = 1007;", "author": "lukecwik", "createdAt": "2020-10-22T21:54:07Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -108,6 +108,8 @@ message InstructionRequest {\n     ProcessBundleSplitRequest process_bundle_split = 1003;\n     FinalizeBundleRequest finalize_bundle = 1004;\n     MonitoringInfosMetadataRequest monitoring_infos = 1005;\n+    HarnessMonitoringInfosRequest harness_monitoring_infos = 1006;\n+    HarnessMonitoringInfosMetadataRequest harness_monitoring_infos_metadata = 1007;", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MDQxMQ==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510480411", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                HarnessMonitoringInfosMetadataResponse harness_monitoring_infos_metadata = 1007;", "author": "lukecwik", "createdAt": "2020-10-22T21:54:37Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -135,12 +137,55 @@ message InstructionResponse {\n     ProcessBundleSplitResponse process_bundle_split = 1003;\n     FinalizeBundleResponse finalize_bundle = 1004;\n     MonitoringInfosMetadataResponse monitoring_infos = 1005;\n+    HarnessMonitoringInfosResponse harness_monitoring_infos = 1006;\n+    HarnessMonitoringInfosMetadataResponse harness_monitoring_infos_metadata = 1007;", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MDY3Mg==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510480672", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // The SDK is allowed to reuse the identifiers across multiple bundles as long\n          \n          \n            \n            // as the MonitoringInfo could be reconstructed fully by overwriting its\n          \n          \n            \n            // payload field with the bytes specified here.\n          \n          \n            \n            // The SDK is allowed to reuse the identifiers for the lifetime of the associated control connection as long\n          \n          \n            \n            // as the MonitoringInfo could be reconstructed fully by overwriting its\n          \n          \n            \n            // payload field with the bytes specified here.", "author": "lukecwik", "createdAt": "2020-10-22T21:55:14Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -135,12 +137,55 @@ message InstructionResponse {\n     ProcessBundleSplitResponse process_bundle_split = 1003;\n     FinalizeBundleResponse finalize_bundle = 1004;\n     MonitoringInfosMetadataResponse monitoring_infos = 1005;\n+    HarnessMonitoringInfosResponse harness_monitoring_infos = 1006;\n+    HarnessMonitoringInfosMetadataResponse harness_monitoring_infos_metadata = 1007;\n \n     // DEPRECATED\n     RegisterResponse register = 1000;\n   }\n }\n \n+// A request to provide full MonitoringInfo associated with the entire SDK\n+// harness process, not specific to a bundle.\n+//\n+// An SDK can report metrics using an identifier that only contains the\n+// associated payload. A runner who wants to receive the full metrics\n+// information can request all the monitoring metadata via a\n+// MonitoringInfosMetadataRequest providing a list of ids as necessary.\n+//\n+// The SDK is allowed to reuse the identifiers across multiple bundles as long\n+// as the MonitoringInfo could be reconstructed fully by overwriting its\n+// payload field with the bytes specified here.", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MDgyNg==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510480826", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              // Metrics associated with the sdk harness process, not a specific bundle.\n          \n          \n            \n              // Metrics associated with the SDK harness, not a specific bundle.", "author": "lukecwik", "createdAt": "2020-10-22T21:55:31Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -135,12 +137,55 @@ message InstructionResponse {\n     ProcessBundleSplitResponse process_bundle_split = 1003;\n     FinalizeBundleResponse finalize_bundle = 1004;\n     MonitoringInfosMetadataResponse monitoring_infos = 1005;\n+    HarnessMonitoringInfosResponse harness_monitoring_infos = 1006;\n+    HarnessMonitoringInfosMetadataResponse harness_monitoring_infos_metadata = 1007;\n \n     // DEPRECATED\n     RegisterResponse register = 1000;\n   }\n }\n \n+// A request to provide full MonitoringInfo associated with the entire SDK\n+// harness process, not specific to a bundle.\n+//\n+// An SDK can report metrics using an identifier that only contains the\n+// associated payload. A runner who wants to receive the full metrics\n+// information can request all the monitoring metadata via a\n+// MonitoringInfosMetadataRequest providing a list of ids as necessary.\n+//\n+// The SDK is allowed to reuse the identifiers across multiple bundles as long\n+// as the MonitoringInfo could be reconstructed fully by overwriting its\n+// payload field with the bytes specified here.\n+message HarnessMonitoringInfosRequest {\n+}\n+\n+message HarnessMonitoringInfosResponse {\n+  // An identifier to MonitoringInfo.payload mapping containing\n+  // Metrics associated with the sdk harness process, not a specific bundle.", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MDk1MA==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510480950", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              // The SDK is allowed to reuse the identifiers across multiple bundles as long\n          \n          \n            \n              // The SDK is allowed to reuse the identifiers for the lifetime of the associated control connection as long", "author": "lukecwik", "createdAt": "2020-10-22T21:55:49Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -135,12 +137,55 @@ message InstructionResponse {\n     ProcessBundleSplitResponse process_bundle_split = 1003;\n     FinalizeBundleResponse finalize_bundle = 1004;\n     MonitoringInfosMetadataResponse monitoring_infos = 1005;\n+    HarnessMonitoringInfosResponse harness_monitoring_infos = 1006;\n+    HarnessMonitoringInfosMetadataResponse harness_monitoring_infos_metadata = 1007;\n \n     // DEPRECATED\n     RegisterResponse register = 1000;\n   }\n }\n \n+// A request to provide full MonitoringInfo associated with the entire SDK\n+// harness process, not specific to a bundle.\n+//\n+// An SDK can report metrics using an identifier that only contains the\n+// associated payload. A runner who wants to receive the full metrics\n+// information can request all the monitoring metadata via a\n+// MonitoringInfosMetadataRequest providing a list of ids as necessary.\n+//\n+// The SDK is allowed to reuse the identifiers across multiple bundles as long\n+// as the MonitoringInfo could be reconstructed fully by overwriting its\n+// payload field with the bytes specified here.\n+message HarnessMonitoringInfosRequest {\n+}\n+\n+message HarnessMonitoringInfosResponse {\n+  // An identifier to MonitoringInfo.payload mapping containing\n+  // Metrics associated with the sdk harness process, not a specific bundle.\n+  //\n+  // An SDK can report metrics using an identifier that only contains the\n+  // associated payload. A runner who wants to receive the full metrics\n+  // information can request all the monitoring metadata via a\n+  // MonitoringInfosMetadataRequest providing a list of ids as necessary.\n+  //\n+  // The SDK is allowed to reuse the identifiers across multiple bundles as long", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MTA2Mw==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510481063", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            message HarnessMonitoringInfosMetadataRequest {\n          \n          \n            \n              // A list of ids for which the full MonitoringInfo is requested for.\n          \n          \n            \n              repeated string monitoring_info_id = 1;\n          \n          \n            \n            }\n          \n          \n            \n            \n          \n          \n            \n            message HarnessMonitoringInfosMetadataResponse {\n          \n          \n            \n              // A mapping from an identifier to the full metrics information.\n          \n          \n            \n              // The \u201cbytes payload\u201d field is not populated on the MonitoringInfo\n          \n          \n            \n              map<string, org.apache.beam.model.pipeline.v1.MonitoringInfo>\n          \n          \n            \n                  monitoring_infos = 1;\n          \n          \n            \n            }", "author": "lukecwik", "createdAt": "2020-10-22T21:56:03Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -135,12 +137,55 @@ message InstructionResponse {\n     ProcessBundleSplitResponse process_bundle_split = 1003;\n     FinalizeBundleResponse finalize_bundle = 1004;\n     MonitoringInfosMetadataResponse monitoring_infos = 1005;\n+    HarnessMonitoringInfosResponse harness_monitoring_infos = 1006;\n+    HarnessMonitoringInfosMetadataResponse harness_monitoring_infos_metadata = 1007;\n \n     // DEPRECATED\n     RegisterResponse register = 1000;\n   }\n }\n \n+// A request to provide full MonitoringInfo associated with the entire SDK\n+// harness process, not specific to a bundle.\n+//\n+// An SDK can report metrics using an identifier that only contains the\n+// associated payload. A runner who wants to receive the full metrics\n+// information can request all the monitoring metadata via a\n+// MonitoringInfosMetadataRequest providing a list of ids as necessary.\n+//\n+// The SDK is allowed to reuse the identifiers across multiple bundles as long\n+// as the MonitoringInfo could be reconstructed fully by overwriting its\n+// payload field with the bytes specified here.\n+message HarnessMonitoringInfosRequest {\n+}\n+\n+message HarnessMonitoringInfosResponse {\n+  // An identifier to MonitoringInfo.payload mapping containing\n+  // Metrics associated with the sdk harness process, not a specific bundle.\n+  //\n+  // An SDK can report metrics using an identifier that only contains the\n+  // associated payload. A runner who wants to receive the full metrics\n+  // information can request all the monitoring metadata via a\n+  // MonitoringInfosMetadataRequest providing a list of ids as necessary.\n+  //\n+  // The SDK is allowed to reuse the identifiers across multiple bundles as long\n+  // as the MonitoringInfo could be reconstructed fully by overwriting its\n+  // payload field with the bytes specified here.\n+  map<string, bytes> monitoring_data = 1;\n+}\n+\n+message HarnessMonitoringInfosMetadataRequest {\n+  // A list of ids for which the full MonitoringInfo is requested for.\n+  repeated string monitoring_info_id = 1;\n+}\n+\n+message HarnessMonitoringInfosMetadataResponse {\n+  // A mapping from an identifier to the full metrics information.\n+  // The \u201cbytes payload\u201d field is not populated on the MonitoringInfo\n+  map<string, org.apache.beam.model.pipeline.v1.MonitoringInfo>\n+      monitoring_infos = 1;\n+}\n+", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MTE4Ng==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510481186", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // The SDK is allowed to reuse the identifiers across multiple bundles as long\n          \n          \n            \n            // The SDK is allowed to reuse the identifiers for the lifetime of the associated control connection as long", "author": "lukecwik", "createdAt": "2020-10-22T21:56:19Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -306,18 +351,18 @@ message ProcessBundleProgressRequest {\n   string instruction_id = 1;\n }\n \n-// A request to provide full MonitoringInfo for a given id.\n+// A request to provide full MonitoringInfo for a given bundle.\n //\n // An SDK can report metrics using an identifier that only contains the\n // associated payload. A runner who wants to receive the full metrics\n // information can request all the monitoring metadata via a\n // MonitoringInfosMetadataRequest providing a list of ids as necessary.\n //\n-// The MonitoringInfo ids are scoped to the associated control connection. For\n-// example, an SDK may reuse the ids across multiple bundles.\n+// The SDK is allowed to reuse the identifiers across multiple bundles as long", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MTM4OQ==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510481389", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // The SDK is allowed to reuse the identifiers across multiple bundles as long\n          \n          \n            \n            // The SDK is allowed to reuse the identifiers for the lifetime of the associated control connection as long", "author": "lukecwik", "createdAt": "2020-10-22T21:56:49Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -349,11 +394,11 @@ message ProcessBundleProgressResponse {\n // information can request all the monitoring metadata via a\n // MonitoringInfosMetadataRequest providing a list of ids as necessary.\n //\n-// The MonitoringInfo ids are scoped to the associated control connection. For\n-// example an SDK may reuse the ids across multiple bundles.\n+// The SDK is allowed to reuse the identifiers across multiple bundles as long", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MTY3Mg==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510481672", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // A request to provide full MonitoringInfo for a given bundle.\n          \n          \n            \n            // A request to provide full MonitoringInfo for a set of provided ids.", "author": "lukecwik", "createdAt": "2020-10-22T21:57:31Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -306,18 +351,18 @@ message ProcessBundleProgressRequest {\n   string instruction_id = 1;\n }\n \n-// A request to provide full MonitoringInfo for a given id.\n+// A request to provide full MonitoringInfo for a given bundle.", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MzMwOQ==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510483309", "bodyText": "Can you copy the update to say for the lifetime of the associated control connection in ProcessBundleProgressResponse and ProcessBundleResponse", "author": "lukecwik", "createdAt": "2020-10-22T22:01:19Z", "path": "model/fn-execution/src/main/proto/beam_fn_api.proto", "diffHunk": "@@ -306,18 +351,18 @@ message ProcessBundleProgressRequest {\n   string instruction_id = 1;\n }\n \n-// A request to provide full MonitoringInfo for a given id.\n+// A request to provide full MonitoringInfo for a given bundle.\n //\n // An SDK can report metrics using an identifier that only contains the\n // associated payload. A runner who wants to receive the full metrics\n // information can request all the monitoring metadata via a\n // MonitoringInfosMetadataRequest providing a list of ids as necessary.\n //\n-// The MonitoringInfo ids are scoped to the associated control connection. For\n-// example, an SDK may reuse the ids across multiple bundles.\n+// The SDK is allowed to reuse the identifiers across multiple bundles as long\n+// as the MonitoringInfo could be reconstructed fully by overwriting its\n+// payload field with the bytes specified here.\n message MonitoringInfosMetadataRequest {\n-  // A list of ids for which MonitoringInfo are requested. All but the payload\n-  // field will be populated.\n+  // A list of ids for which the full MonitoringInfo is requested for.\n   repeated string monitoring_info_id = 1;\n }\n ", "originalCommit": "ff701ba7ee9b78e8d0274032fbbbfb4571146662", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDUwNjg2MQ==", "url": "https://github.com/apache/beam/pull/13163#discussion_r510506861", "bodyText": "I believe I have applied all of your suggestions now. I did some through this webpage and some locally.", "author": "ajamato", "createdAt": "2020-10-22T23:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MzMwOQ=="}], "type": "inlineReview"}, {"oid": "0f61037c9b3e8881e616f7857be8c52f54edb99e", "url": "https://github.com/apache/beam/commit/0f61037c9b3e8881e616f7857be8c52f54edb99e", "message": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-22T23:05:05Z", "type": "forcePushed"}, {"oid": "0432f138f2bfb8d4d9543c4569581bdd3f8782db", "url": "https://github.com/apache/beam/commit/0432f138f2bfb8d4d9543c4569581bdd3f8782db", "message": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-22T23:07:01Z", "type": "commit"}, {"oid": "0432f138f2bfb8d4d9543c4569581bdd3f8782db", "url": "https://github.com/apache/beam/commit/0432f138f2bfb8d4d9543c4569581bdd3f8782db", "message": "[BEAM-11092] Add protos for new process wide HarnessMonitoringInfos, and BigQuery IO metrics", "committedDate": "2020-10-22T23:07:01Z", "type": "forcePushed"}]}