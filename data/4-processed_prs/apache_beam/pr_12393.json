{"pr_number": 12393, "pr_title": "Support creation of empty PCollection in beam CreateList", "pr_createdAt": "2020-07-28T16:03:48Z", "pr_url": "https://github.com/apache/beam/pull/12393", "timeline": [{"oid": "c230c28318621741c577e36de8acc9dc9c9ed4ee", "url": "https://github.com/apache/beam/commit/c230c28318621741c577e36de8acc9dc9c9ed4ee", "message": "Support creation of empty PCollection in beam CreateList", "committedDate": "2020-07-28T16:20:14Z", "type": "forcePushed"}, {"oid": "b0c3cf085ad0e6ad5dbf7b17d51925fcf7be526a", "url": "https://github.com/apache/beam/commit/b0c3cf085ad0e6ad5dbf7b17d51925fcf7be526a", "message": "Support creation of empty PCollection in beam CreateList", "committedDate": "2020-07-28T21:40:39Z", "type": "forcePushed"}, {"oid": "c92e57b694112eb176ebf78ba1adefdb537d8e15", "url": "https://github.com/apache/beam/commit/c92e57b694112eb176ebf78ba1adefdb537d8e15", "message": "Support creation of empty PCollection in beam CreateList", "committedDate": "2020-07-28T21:42:40Z", "type": "commit"}, {"oid": "c92e57b694112eb176ebf78ba1adefdb537d8e15", "url": "https://github.com/apache/beam/commit/c92e57b694112eb176ebf78ba1adefdb537d8e15", "message": "Support creation of empty PCollection in beam CreateList", "committedDate": "2020-07-28T21:42:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk1NDcxNw==", "url": "https://github.com/apache/beam/pull/12393#discussion_r461954717", "bodyText": "Optional, but how about this wording?:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // array. Differently from Create this supports the creation of an empty\n          \n          \n            \n            // array. Unlike Create this supports the creation of an empty", "author": "youngoli", "createdAt": "2020-07-28T23:41:07Z", "path": "sdks/go/pkg/beam/create.go", "diffHunk": "@@ -34,31 +34,44 @@ func Create(s Scope, values ...interface{}) PCollection {\n }\n \n // CreateList inserts a fixed set of values into the pipeline from a slice or\n-// array. It is a convenience wrapper over Create.\n+// array. Differently from Create this supports the creation of an empty", "originalCommit": "c92e57b694112eb176ebf78ba1adefdb537d8e15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk1NTM4Ng==", "url": "https://github.com/apache/beam/pull/12393#discussion_r461955386", "bodyText": "It seems better to have the error check below happen before this loop (unless you have a specific reason for putting the loop first).", "author": "youngoli", "createdAt": "2020-07-28T23:43:17Z", "path": "sdks/go/pkg/beam/create.go", "diffHunk": "@@ -34,31 +34,44 @@ func Create(s Scope, values ...interface{}) PCollection {\n }\n \n // CreateList inserts a fixed set of values into the pipeline from a slice or\n-// array. It is a convenience wrapper over Create.\n+// array. Differently from Create this supports the creation of an empty\n+// PCollection.\n func CreateList(s Scope, list interface{}) PCollection {\n-\tvar ret []interface{}\n \tval := reflect.ValueOf(list)\n+\tvar ret []interface{}\n+\tfor i := 0; i < val.Len(); i++ {", "originalCommit": "c92e57b694112eb176ebf78ba1adefdb537d8e15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA2ODEyMA==", "url": "https://github.com/apache/beam/pull/12393#discussion_r462068120", "bodyText": "You are right, thanks for spotting this.", "author": "simonepri", "createdAt": "2020-07-29T06:30:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk1NTM4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2MTU1MA==", "url": "https://github.com/apache/beam/pull/12393#discussion_r461961550", "bodyText": "Same suggestion as above:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // array. The values must be of the same type. Differently from TryCreate this\n          \n          \n            \n            // array. The values must be of the same type. Unlike TryCreate this", "author": "youngoli", "createdAt": "2020-07-29T00:02:56Z", "path": "sdks/go/pkg/beam/create.go", "diffHunk": "@@ -34,31 +34,44 @@ func Create(s Scope, values ...interface{}) PCollection {\n }\n \n // CreateList inserts a fixed set of values into the pipeline from a slice or\n-// array. It is a convenience wrapper over Create.\n+// array. Differently from Create this supports the creation of an empty\n+// PCollection.\n func CreateList(s Scope, list interface{}) PCollection {\n-\tvar ret []interface{}\n \tval := reflect.ValueOf(list)\n+\tvar ret []interface{}\n+\tfor i := 0; i < val.Len(); i++ {\n+\t\tret = append(ret, val.Index(i).Interface())\n+\t}\n \tif val.Kind() != reflect.Slice && val.Kind() != reflect.Array {\n \t\tpanic(fmt.Sprintf(\"Input %v must be a slice or array\", list))\n \t}\n-\tfor i := 0; i < val.Len(); i++ {\n-\t\tret = append(ret, val.Index(i).Interface())\n+\tif val.Len() == 0 {\n+\t\tt := reflect.TypeOf(list).Elem()\n+\t\treturn Must(TryCreateList(s, t, ret))\n \t}\n-\treturn Must(TryCreate(s, ret...))\n+\tt := reflect.ValueOf(ret[0]).Type()\n+\treturn Must(TryCreateList(s, t, ret))\n }\n \n func addCreateCtx(err error, s Scope) error {\n \treturn errors.WithContextf(err, \"inserting Create in scope %s\", s)\n }\n \n-// TryCreate inserts a fixed set of values into the pipeline. The values must\n-// be of the same type.\n+// TryCreate inserts a fixed non-empty set of values into the pipeline. The\n+// values must be of the same type.\n func TryCreate(s Scope, values ...interface{}) (PCollection, error) {\n \tif len(values) == 0 {\n \t\treturn PCollection{}, addCreateCtx(errors.New(\"create has no values\"), s)\n \t}\n \n \tt := reflect.ValueOf(values[0]).Type()\n+\treturn TryCreateList(s, t, values)\n+}\n+\n+// TryCreateList inserts a fixed set of values into the pipeline from a slice or\n+// array. The values must be of the same type. Differently from TryCreate this", "originalCommit": "c92e57b694112eb176ebf78ba1adefdb537d8e15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5f9848fe20fb394bcf1f7465562db6ff0ae52183", "url": "https://github.com/apache/beam/commit/5f9848fe20fb394bcf1f7465562db6ff0ae52183", "message": "Update docstrings", "committedDate": "2020-07-29T06:45:41Z", "type": "commit"}, {"oid": "1e651d804e44ec9d02a251b0054a28345ce5677b", "url": "https://github.com/apache/beam/commit/1e651d804e44ec9d02a251b0054a28345ce5677b", "message": "Refactor CreateList", "committedDate": "2020-07-29T06:46:16Z", "type": "commit"}, {"oid": "57133f8db8bbfd96c02beffb3cb7e907ac8c4697", "url": "https://github.com/apache/beam/commit/57133f8db8bbfd96c02beffb3cb7e907ac8c4697", "message": "Merge branch 'master' into beam-go-create-empty-pcollection", "committedDate": "2020-07-29T06:56:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQyMjM1Nw==", "url": "https://github.com/apache/beam/pull/12393#discussion_r462422357", "bodyText": "TryCreateList and CreateList should only differ in returning an error, and not force different parameters.\nThat said, for convenience it's totally reasonable for an unexported tryCreateList to have this signature for reuse as you've done, and have the exported TryCreateList infer from the raw empty list type.", "author": "lostluck", "createdAt": "2020-07-29T16:16:39Z", "path": "sdks/go/pkg/beam/create.go", "diffHunk": "@@ -34,31 +34,44 @@ func Create(s Scope, values ...interface{}) PCollection {\n }\n \n // CreateList inserts a fixed set of values into the pipeline from a slice or\n-// array. It is a convenience wrapper over Create.\n+// array. Unlike Create this supports the creation of an empty PCollection.\n func CreateList(s Scope, list interface{}) PCollection {\n-\tvar ret []interface{}\n \tval := reflect.ValueOf(list)\n \tif val.Kind() != reflect.Slice && val.Kind() != reflect.Array {\n \t\tpanic(fmt.Sprintf(\"Input %v must be a slice or array\", list))\n \t}\n+\tvar ret []interface{}\n \tfor i := 0; i < val.Len(); i++ {\n \t\tret = append(ret, val.Index(i).Interface())\n \t}\n-\treturn Must(TryCreate(s, ret...))\n+\tvar t reflect.Type\n+\tif len(ret) == 0 {\n+\t\tt = reflect.TypeOf(list).Elem()\n+\t} else {\n+\t\tt = reflect.ValueOf(ret[0]).Type()\n+\t}\n+\treturn Must(TryCreateList(s, ret, t))\n }\n \n func addCreateCtx(err error, s Scope) error {\n \treturn errors.WithContextf(err, \"inserting Create in scope %s\", s)\n }\n \n-// TryCreate inserts a fixed set of values into the pipeline. The values must\n-// be of the same type.\n+// TryCreate inserts a fixed non-empty set of values into the pipeline. The\n+// values must be of the same type.\n func TryCreate(s Scope, values ...interface{}) (PCollection, error) {\n \tif len(values) == 0 {\n \t\treturn PCollection{}, addCreateCtx(errors.New(\"create has no values\"), s)\n \t}\n \n \tt := reflect.ValueOf(values[0]).Type()\n+\treturn TryCreateList(s, values, t)\n+}\n+\n+// TryCreateList inserts a fixed set of values into the pipeline from a slice or\n+// array. The values must be of the same type. Unlike TryCreate this supports\n+// the creation of an empty PCollection.\n+func TryCreateList(s Scope, values []interface{}, t reflect.Type) (PCollection, error) {", "originalCommit": "57133f8db8bbfd96c02beffb3cb7e907ac8c4697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ1Mzk5Mw==", "url": "https://github.com/apache/beam/pull/12393#discussion_r462453993", "bodyText": "Thanks for the comment!\nI did not know about this convention, but makes completely sense.\nLet me know if it is okay now.", "author": "simonepri", "createdAt": "2020-07-29T17:08:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQyMjM1Nw=="}], "type": "inlineReview"}, {"oid": "f57dff397e5ea5ab1c1f79f4d9cd2aee96922b63", "url": "https://github.com/apache/beam/commit/f57dff397e5ea5ab1c1f79f4d9cd2aee96922b63", "message": "Refactor CreateList", "committedDate": "2020-07-29T16:54:29Z", "type": "forcePushed"}, {"oid": "58d6bf689fb8105f115d931527c7ea7502c1a0c0", "url": "https://github.com/apache/beam/commit/58d6bf689fb8105f115d931527c7ea7502c1a0c0", "message": "Refactor CreateList", "committedDate": "2020-07-29T17:02:01Z", "type": "forcePushed"}, {"oid": "631bbb8bb018f10d0594b151647e9b59ac314a5c", "url": "https://github.com/apache/beam/commit/631bbb8bb018f10d0594b151647e9b59ac314a5c", "message": "Refactor CreateList", "committedDate": "2020-07-29T17:04:18Z", "type": "commit"}, {"oid": "631bbb8bb018f10d0594b151647e9b59ac314a5c", "url": "https://github.com/apache/beam/commit/631bbb8bb018f10d0594b151647e9b59ac314a5c", "message": "Refactor CreateList", "committedDate": "2020-07-29T17:04:18Z", "type": "forcePushed"}]}