{"pr_number": 11867, "pr_title": "[BEAM-10158] Use a shared unbounded thread pool within Beam Python.", "pr_createdAt": "2020-05-29T22:03:54Z", "pr_url": "https://github.com/apache/beam/pull/11867", "timeline": [{"oid": "300a228a28e4f5aa869369b0e5739c4c8d44c5d4", "url": "https://github.com/apache/beam/commit/300a228a28e4f5aa869369b0e5739c4c8d44c5d4", "message": "[BEAM-10158] Use a shared unbounded thread pool within Beam Python.", "committedDate": "2020-05-29T21:59:00Z", "type": "commit"}, {"oid": "31c613afbeea1d321e6c475b2924da37ee3fcb4f", "url": "https://github.com/apache/beam/commit/31c613afbeea1d321e6c475b2924da37ee3fcb4f", "message": "fixup! Fix lint errors", "committedDate": "2020-05-29T22:20:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM2ODYzMg==", "url": "https://github.com/apache/beam/pull/11867#discussion_r433368632", "bodyText": "Do we expect UnboundedThreadPoolExecutor to be used directly after this? Should it be renamed to _UnboundedThreadPoolExecutor ?", "author": "aaltay", "createdAt": "2020-06-01T17:07:22Z", "path": "sdks/python/apache_beam/utils/thread_pool_executor.py", "diffHunk": "@@ -134,3 +134,12 @@ def shutdown(self, wait=True):\n       if wait:\n         for worker in self._workers:\n           worker.join()\n+\n+\n+class _SharedUnboundedThreadPoolExecutor(UnboundedThreadPoolExecutor):", "originalCommit": "31c613afbeea1d321e6c475b2924da37ee3fcb4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQzMTU3Ng==", "url": "https://github.com/apache/beam/pull/11867#discussion_r433431576", "bodyText": "People can still use UnboundedThreadPoolExecutor and there could be a usecase around having threads from the pool having meaningful names to simplify debugging so I'm going to leave it as is.", "author": "lukecwik", "createdAt": "2020-06-01T19:07:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM2ODYzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MjQ0Ng==", "url": "https://github.com/apache/beam/pull/11867#discussion_r433382446", "bodyText": "Maybe give it a constant name? SHARED_THREAD_POOL_EXECUTOR or something like that? To clarify it's an instance, and not a class.\nI know we did not do this for MetricsEnvironment, but I think it may be better.", "author": "pabloem", "createdAt": "2020-06-01T17:33:18Z", "path": "sdks/python/apache_beam/utils/thread_pool_executor.py", "diffHunk": "@@ -134,3 +134,12 @@ def shutdown(self, wait=True):\n       if wait:\n         for worker in self._workers:\n           worker.join()\n+\n+\n+class _SharedUnboundedThreadPoolExecutor(UnboundedThreadPoolExecutor):\n+  def shutdown(self, wait=True):\n+    # Prevent shutting down the shared thread pool\n+    pass\n+\n+\n+SharedUnboundedThreadPoolExecutor = _SharedUnboundedThreadPoolExecutor()", "originalCommit": "31c613afbeea1d321e6c475b2924da37ee3fcb4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQxNTUwNA==", "url": "https://github.com/apache/beam/pull/11867#discussion_r433415504", "bodyText": "+1, this is confusing.\nI would declare the global instance private to thread_pool_executor module (_shared_thread_pool_executor), and add a public getter function: thread_pool_executor.get_shared_executor().\nThis is also recommended by http://google.github.io/styleguide/pyguide.html#254-decision.", "author": "tvalentyn", "createdAt": "2020-06-01T18:35:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MjQ0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ0NzQyNg==", "url": "https://github.com/apache/beam/pull/11867#discussion_r433447426", "bodyText": "done", "author": "lukecwik", "createdAt": "2020-06-01T19:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MjQ0Ng=="}], "type": "inlineReview"}, {"oid": "826f89d8213d5402db732ca5aa38a7ebc2db936a", "url": "https://github.com/apache/beam/commit/826f89d8213d5402db732ca5aa38a7ebc2db936a", "message": "fixup! Address PR comments", "committedDate": "2020-06-01T19:37:54Z", "type": "commit"}, {"oid": "ec5000f4eace4d01f79734caf43d666e3719fe96", "url": "https://github.com/apache/beam/commit/ec5000f4eace4d01f79734caf43d666e3719fe96", "message": "fixup! fix lint", "committedDate": "2020-06-01T19:43:06Z", "type": "commit"}]}