{"pr_number": 13633, "pr_title": "[BEAM-9541] Use a single source of truth for latest Flink version in Gradle tasks.", "pr_createdAt": "2020-12-29T22:53:59Z", "pr_url": "https://github.com/apache/beam/pull/13633", "timeline": [{"oid": "f120eb7add5bb85eb161783c2d39156404bdaa96", "url": "https://github.com/apache/beam/commit/f120eb7add5bb85eb161783c2d39156404bdaa96", "message": "[BEAM-9541] Add flink_versions to gradle.properties.", "committedDate": "2020-12-29T22:46:37Z", "type": "commit"}, {"oid": "7eacb40ee9591b8133b6017eb72b37702a2b9417", "url": "https://github.com/apache/beam/commit/7eacb40ee9591b8133b6017eb72b37702a2b9417", "message": "[BEAM-9541] All Gradle tasks use latest Flink version.", "committedDate": "2020-12-29T23:23:21Z", "type": "commit"}, {"oid": "7eacb40ee9591b8133b6017eb72b37702a2b9417", "url": "https://github.com/apache/beam/commit/7eacb40ee9591b8133b6017eb72b37702a2b9417", "message": "[BEAM-9541] All Gradle tasks use latest Flink version.", "committedDate": "2020-12-29T23:23:21Z", "type": "forcePushed"}, {"oid": "08706dfd17cc25733042f1ad2aa6bde3b818dfa1", "url": "https://github.com/apache/beam/commit/08706dfd17cc25733042f1ad2aa6bde3b818dfa1", "message": "Disable Flink classloader leak check when using local execution mode.\n\nOtherwise the check will throw an error when the expansion service is called after the local cluster runs a job.", "committedDate": "2020-12-31T01:22:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIyNjA1NQ==", "url": "https://github.com/apache/beam/pull/13633#discussion_r551226055", "bodyText": "Just for pure curiosity, why is this needed?", "author": "iemejia", "createdAt": "2021-01-04T10:16:43Z", "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkExecutionEnvironments.java", "diffHunk": "@@ -375,4 +377,10 @@ private static void setManagedMemoryByFraction(final Configuration config) {\n       config.setString(\"taskmanager.memory.managed.size\", String.valueOf(managedMemorySize));\n     }\n   }\n+\n+  private static void disableClassLoaderLeakCheck(final Configuration config) {", "originalCommit": "08706dfd17cc25733042f1ad2aa6bde3b818dfa1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIzMjIzNg==", "url": "https://github.com/apache/beam/pull/13633#discussion_r551232236", "bodyText": "I believe this is because of GRPC which may attempt to load classes after the Flink job has been removed. Loading new classes on closed classloaders will error without this setting.", "author": "mxm", "createdAt": "2021-01-04T10:28:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIyNjA1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIzMzQwNA==", "url": "https://github.com/apache/beam/pull/13633#discussion_r551233404", "bodyText": "In any case, we should add a note or JIRA ticket to why this is necessary.", "author": "mxm", "createdAt": "2021-01-04T10:30:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIyNjA1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE4NTYzOQ==", "url": "https://github.com/apache/beam/pull/13633#discussion_r552185639", "bodyText": "Done.", "author": "ibzib", "createdAt": "2021-01-05T20:48:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIyNjA1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIzMzEyMw==", "url": "https://github.com/apache/beam/pull/13633#discussion_r551233123", "bodyText": "Personal preference but I find this easier to read:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (version == flink_minor_version) {\n          \n          \n            \n                  break\n          \n          \n            \n                }\n          \n          \n            \n                mustRunAfter(\":runners:flink:${version}:test\")\n          \n          \n            \n                if (version != flink_minor_version) {\n          \n          \n            \n                  mustRunAfter(\":runners:flink:${version}:test\")\n          \n          \n            \n                }", "author": "mxm", "createdAt": "2021-01-04T10:29:58Z", "path": "runners/flink/flink_runner.gradle", "diffHunk": "@@ -108,17 +108,14 @@ test {\n   if (System.getProperty(\"beamSurefireArgline\")) {\n     jvmArgs System.getProperty(\"beamSurefireArgline\")\n   }\n-  // TODO Running tests of all Flink versions in parallel can be too harsh on Jenkins memory\n-  // Run them serially for now, to avoid \"Exit code 137\", i.e. Jenkins host killing the Gradle test process\n-  if (project.path == \":runners:flink:1.9\") {\n-    mustRunAfter(\":runners:flink:1.8:test\")\n-  } else if (project.path == \":runners:flink:1.10\") {\n-    mustRunAfter(\":runners:flink:1.8:test\")\n-    mustRunAfter(\":runners:flink:1.9:test\")\n-  } else if (project.path == \":runners:flink:1.11\") {\n-    mustRunAfter(\":runners:flink:1.8:test\")\n-    mustRunAfter(\":runners:flink:1.9:test\")\n-    mustRunAfter(\":runners:flink:1.10:test\")\n+  // TODO(BEAM-6418) Running tests of all Flink versions in parallel can be too harsh on Jenkins memory.\n+  // Run them serially for now, to avoid \"Exit code 137\", i.e. Jenkins host killing the Gradle test process.\n+  def flink_minor_version = project.path.split(':').last()\n+  for (version in project.ext.allFlinkVersions) {\n+    if (version == flink_minor_version) {\n+      break\n+    }\n+    mustRunAfter(\":runners:flink:${version}:test\")", "originalCommit": "08706dfd17cc25733042f1ad2aa6bde3b818dfa1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE4Mzc3OA==", "url": "https://github.com/apache/beam/pull/13633#discussion_r552183778", "bodyText": "Wouldn't we end up with circular dependencies, like (1.12 mustRunAfter 1.11) && (1.11 mustRunAfter 1.12)?", "author": "ibzib", "createdAt": "2021-01-05T20:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIzMzEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzIwNzAxOA==", "url": "https://github.com/apache/beam/pull/13633#discussion_r553207018", "bodyText": "That is right. I've somehow read break as continue.", "author": "mxm", "createdAt": "2021-01-07T09:27:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIzMzEyMw=="}], "type": "inlineReview"}, {"oid": "e12a0d84b2cd0fc561e89796cedbce141b3b4359", "url": "https://github.com/apache/beam/commit/e12a0d84b2cd0fc561e89796cedbce141b3b4359", "message": "[BEAM-11570] Comment with link to context.", "committedDate": "2021-01-05T20:47:56Z", "type": "commit"}]}