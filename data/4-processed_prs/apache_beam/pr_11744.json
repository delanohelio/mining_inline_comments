{"pr_number": 11744, "pr_title": "[BEAM-10007] Handle ValueProvider pipeline options in PortableRunner", "pr_createdAt": "2020-05-18T19:37:22Z", "pr_url": "https://github.com/apache/beam/pull/11744", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU2NTY2OA==", "url": "https://github.com/apache/beam/pull/11744#discussion_r427565668", "bodyText": "why there is a special case for int? Can we do str(v) for everything except for valueproviders?", "author": "aaltay", "createdAt": "2020-05-19T20:01:55Z", "path": "sdks/python/apache_beam/runners/portability/portable_runner.py", "diffHunk": "@@ -164,10 +165,19 @@ def add_runner_options(parser):\n     all_options = self.options.get_all_options(\n         add_extra_args_fn=add_runner_options,\n         retain_unknown_options=self._retain_unknown_options)\n+\n     # TODO: Define URNs for options.\n     # convert int values: https://issues.apache.org/jira/browse/BEAM-5509\n+    def convert_pipeline_option_value(v):\n+      if type(v) == int:", "originalCommit": "24cb3865137876d32bfd00d110a4851d87ae3bf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NjA2Mg==", "url": "https://github.com/apache/beam/pull/11744#discussion_r427586062", "bodyText": "Good question. I was just maintaining the status quo and adding a special case for ValueProvider. Let me see if I can dig up why the str(v) is there for ints", "author": "TheNeuralBit", "createdAt": "2020-05-19T20:40:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU2NTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU5MjU4Nw==", "url": "https://github.com/apache/beam/pull/11744#discussion_r427592587", "bodyText": "Oh the relevant jira is linked right there. It seems that this is really a workaround for a bug in json_format where ints and floats aren't treated differently. I can look into fixing that upstream so we can get rid of the special case here.\nI don't think it would be good to call str(v) on everything", "author": "TheNeuralBit", "createdAt": "2020-05-19T20:52:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU2NTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY0NTQ4NA==", "url": "https://github.com/apache/beam/pull/11744#discussion_r427645484", "bodyText": "Interesting. For this PR, could you move that comment closer to the if type(v) == int line.\n\nI can look into fixing that upstream so we can get rid of the special case here.\n\nIf you have time, maybe file a bug. I do not think this is a very high priority for us.\n\nI don't think it would be good to call str(v) on everything\n\nI agree. I was trying to understand why are we doing this.", "author": "aaltay", "createdAt": "2020-05-19T22:54:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU2NTY2OA=="}], "type": "inlineReview"}, {"oid": "007ac0af06c32452b6f51f507182d0109bb665af", "url": "https://github.com/apache/beam/commit/007ac0af06c32452b6f51f507182d0109bb665af", "message": "Drop defaults when retrieving pipeline options in SdkWorkerMainTest", "committedDate": "2020-05-20T21:43:55Z", "type": "forcePushed"}, {"oid": "fb6fc7842217fc1e08e291709ad64c99f55db0de", "url": "https://github.com/apache/beam/commit/fb6fc7842217fc1e08e291709ad64c99f55db0de", "message": "Add failing value provider option test", "committedDate": "2020-07-08T19:27:10Z", "type": "commit"}, {"oid": "5ee1b71b0d0bee74ed306d043cede588eaa7a332", "url": "https://github.com/apache/beam/commit/5ee1b71b0d0bee74ed306d043cede588eaa7a332", "message": "fix pipeline options in PortableRunner", "committedDate": "2020-07-08T19:27:10Z", "type": "commit"}, {"oid": "d2d4ecbc183452d86044a4390162665cb2cf74d1", "url": "https://github.com/apache/beam/commit/d2d4ecbc183452d86044a4390162665cb2cf74d1", "message": "Make sdk_worker_main_test assertions more specific", "committedDate": "2020-07-08T19:30:46Z", "type": "commit"}, {"oid": "d2d4ecbc183452d86044a4390162665cb2cf74d1", "url": "https://github.com/apache/beam/commit/d2d4ecbc183452d86044a4390162665cb2cf74d1", "message": "Make sdk_worker_main_test assertions more specific", "committedDate": "2020-07-08T19:30:46Z", "type": "forcePushed"}]}