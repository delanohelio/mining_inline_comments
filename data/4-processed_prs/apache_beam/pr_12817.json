{"pr_number": 12817, "pr_title": "[BEAM-10876] Fix TypeError in dataflow_metrics when distribution sum \u2026", "pr_createdAt": "2020-09-10T21:59:05Z", "pr_url": "https://github.com/apache/beam/pull/12817", "timeline": [{"oid": "bc793bbbb2e8a21662bdf4afc513fd14da1ba805", "url": "https://github.com/apache/beam/commit/bc793bbbb2e8a21662bdf4afc513fd14da1ba805", "message": "[BEAM-10876] Fix TypeError in dataflow_metrics when distribution sum overflows", "committedDate": "2020-09-10T22:03:02Z", "type": "commit"}, {"oid": "bc793bbbb2e8a21662bdf4afc513fd14da1ba805", "url": "https://github.com/apache/beam/commit/bc793bbbb2e8a21662bdf4afc513fd14da1ba805", "message": "[BEAM-10876] Fix TypeError in dataflow_metrics when distribution sum overflows", "committedDate": "2020-09-10T22:03:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4NTExNA==", "url": "https://github.com/apache/beam/pull/12817#discussion_r486685114", "bodyText": "Do we need to log if this happens else this will be a silent failure.", "author": "angoenka", "createdAt": "2020-09-10T23:18:49Z", "path": "sdks/python/apache_beam/runners/dataflow/dataflow_metrics.py", "diffHunk": "@@ -210,6 +210,14 @@ def _get_metric_value(self, metric):\n       dist_sum = _get_match(\n           metric.distribution.object_value.properties,\n           lambda x: x.key == 'sum').value.integer_value\n+      if not dist_sum:\n+        # distribution metric is not meant to use on large values, but in case\n+        # it is, the value can overflow and become double_value, the correctness\n+        # of the value may not be guaranteed.\n+        dist_sum = int(", "originalCommit": "bc793bbbb2e8a21662bdf4afc513fd14da1ba805", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4NTYzMQ==", "url": "https://github.com/apache/beam/pull/12817#discussion_r486685631", "bodyText": "Sounds good.", "author": "y1chi", "createdAt": "2020-09-10T23:20:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4NTExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4ODA4OA==", "url": "https://github.com/apache/beam/pull/12817#discussion_r486688088", "bodyText": "Should we also add the metric name in the logs for easier debugging.", "author": "angoenka", "createdAt": "2020-09-10T23:28:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4NTExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3NzcxMw==", "url": "https://github.com/apache/beam/pull/12817#discussion_r487177713", "bodyText": "done.", "author": "y1chi", "createdAt": "2020-09-11T17:09:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4NTExNA=="}], "type": "inlineReview"}, {"oid": "f188fca255c637172331c57b9c165f08c74588b7", "url": "https://github.com/apache/beam/commit/f188fca255c637172331c57b9c165f08c74588b7", "message": "Add logging", "committedDate": "2020-09-10T23:24:51Z", "type": "commit"}, {"oid": "02490047890b4e3c2b5e8a00ad68831cf1e3a21e", "url": "https://github.com/apache/beam/commit/02490047890b4e3c2b5e8a00ad68831cf1e3a21e", "message": "Add the distribution counter to logging", "committedDate": "2020-09-11T17:08:42Z", "type": "commit"}]}