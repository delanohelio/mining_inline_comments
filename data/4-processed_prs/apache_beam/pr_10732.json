{"pr_number": 10732, "pr_title": "Adding new source tests for Py BQ source", "pr_createdAt": "2020-01-30T23:28:45Z", "pr_url": "https://github.com/apache/beam/pull/10732", "timeline": [{"oid": "19c7665960fc4658e26dc55a33a719327f1e1688", "url": "https://github.com/apache/beam/commit/19c7665960fc4658e26dc55a33a719327f1e1688", "message": "Adding new source tests", "committedDate": "2020-01-30T23:28:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM4NDc1Nw==", "url": "https://github.com/apache/beam/pull/10732#discussion_r373384757", "bodyText": "I believe we should use _ReadFromBigQuery when known_args.native is False", "author": "kamilwu", "createdAt": "2020-01-31T09:26:16Z", "path": "sdks/python/apache_beam/io/gcp/big_query_query_to_table_pipeline.py", "diffHunk": "@@ -63,9 +63,15 @@ def run_bq_pipeline(argv=None):\n \n   # Note to future modifiers: Keep using BigQuerySource if known_args.native is\n   # True.\n-  data = p | 'read' >> beam.io.Read(beam.io.BigQuerySource(\n-      query=known_args.query, use_standard_sql=known_args.use_standard_sql,\n-      kms_key=kms_key))\n+  if known_args.native:\n+    data = p | 'read' >> beam.io.gcp.bigquery._ReadFromBigQuery(", "originalCommit": "19c7665960fc4658e26dc55a33a719327f1e1688", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwNjI4MQ==", "url": "https://github.com/apache/beam/pull/10732#discussion_r373706281", "bodyText": "Ah I feel so dumb. Thanks Kamil. Done.", "author": "pabloem", "createdAt": "2020-01-31T22:05:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM4NDc1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM4ODc4OA==", "url": "https://github.com/apache/beam/pull/10732#discussion_r373388788", "bodyText": "We have to provide --project parameter explicitly. This is why Python36 PostCommit has failed I think.", "author": "kamilwu", "createdAt": "2020-01-31T09:35:56Z", "path": "sdks/python/apache_beam/io/gcp/big_query_query_to_table_pipeline.py", "diffHunk": "@@ -63,9 +63,15 @@ def run_bq_pipeline(argv=None):\n \n   # Note to future modifiers: Keep using BigQuerySource if known_args.native is\n   # True.\n-  data = p | 'read' >> beam.io.Read(beam.io.BigQuerySource(\n-      query=known_args.query, use_standard_sql=known_args.use_standard_sql,\n-      kms_key=kms_key))\n+  if known_args.native:\n+    data = p | 'read' >> beam.io.gcp.bigquery._ReadFromBigQuery(\n+        query=known_args.query,\n+        use_standard_sql=known_args.use_standard_sql,\n+        kms_key=kms_key)\n+  else:\n+    data = p | 'read' >> beam.io.Read(beam.io.BigQuerySource(\n+        query=known_args.query, use_standard_sql=known_args.use_standard_sql,", "originalCommit": "19c7665960fc4658e26dc55a33a719327f1e1688", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwNjM0Mw==", "url": "https://github.com/apache/beam/pull/10732#discussion_r373706343", "bodyText": "Done. Thanks Kamil!", "author": "pabloem", "createdAt": "2020-01-31T22:05:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM4ODc4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5MTA0NA==", "url": "https://github.com/apache/beam/pull/10732#discussion_r373391044", "bodyText": "Maybe we should add a --native parameter? This would make switching between difference sources/sinks much easier.", "author": "kamilwu", "createdAt": "2020-01-31T09:41:11Z", "path": "sdks/python/apache_beam/io/gcp/big_query_query_to_table_it_test.py", "diffHunk": "@@ -148,6 +148,7 @@ def test_big_query_legacy_sql(self):\n                   'output': self.output_table,\n                   'output_schema': DIALECT_OUTPUT_SCHEMA,\n                   'use_standard_sql': False,\n+                  'native': True,", "originalCommit": "19c7665960fc4658e26dc55a33a719327f1e1688", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwNjU5MQ==", "url": "https://github.com/apache/beam/pull/10732#discussion_r373706591", "bodyText": "a native parameter for BQ Sink? (_ReadFromBQ(native=False/True) - > expand depending on the parameter?)", "author": "pabloem", "createdAt": "2020-01-31T22:06:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5MTA0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAwNjU1NQ==", "url": "https://github.com/apache/beam/pull/10732#discussion_r374006555", "bodyText": "I though about something else (a native parameter for this test), but now I see it's already here: \n  \n    \n      beam/sdks/python/apache_beam/io/gcp/big_query_query_to_table_pipeline.py\n    \n    \n         Line 55\n      in\n      2bd3c5c\n    \n    \n    \n    \n\n        \n          \n           parser.add_argument('--native', default=False, action='store_true', \n        \n    \n  \n\n\nso it's fine.", "author": "kamilwu", "createdAt": "2020-02-03T09:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5MTA0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAwOTE4OQ==", "url": "https://github.com/apache/beam/pull/10732#discussion_r374009189", "bodyText": "But your idea sounds good. I think we could even remove the underscore, set True as the default value of native and expose that transform to users (not in this PR though) WDYT?", "author": "kamilwu", "createdAt": "2020-02-03T09:54:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5MTA0NA=="}], "type": "inlineReview"}, {"oid": "aa06bba012f960e1076862c8a8c79eb6e71dcb65", "url": "https://github.com/apache/beam/commit/aa06bba012f960e1076862c8a8c79eb6e71dcb65", "message": "Fixups", "committedDate": "2020-01-31T18:03:35Z", "type": "commit"}, {"oid": "a1b06d0d665763b5e9d51ca1de653fbe7063bcf6", "url": "https://github.com/apache/beam/commit/a1b06d0d665763b5e9d51ca1de653fbe7063bcf6", "message": "Fixup", "committedDate": "2020-01-31T20:53:35Z", "type": "commit"}]}