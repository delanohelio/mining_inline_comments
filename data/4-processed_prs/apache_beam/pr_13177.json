{"pr_number": 13177, "pr_title": "Sort stages according to data edges as well as must-follows.", "pr_createdAt": "2020-10-23T17:51:40Z", "pr_url": "https://github.com/apache/beam/pull/13177", "timeline": [{"oid": "d9bb7058a442b0c5314308e18c11091486300830", "url": "https://github.com/apache/beam/commit/d9bb7058a442b0c5314308e18c11091486300830", "message": "Order stages according to data edges as well as must-follows.", "committedDate": "2020-10-28T20:18:22Z", "type": "commit"}, {"oid": "d9bb7058a442b0c5314308e18c11091486300830", "url": "https://github.com/apache/beam/commit/d9bb7058a442b0c5314308e18c11091486300830", "message": "Order stages according to data edges as well as must-follows.", "committedDate": "2020-10-28T20:18:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2OTcxOA==", "url": "https://github.com/apache/beam/pull/13177#discussion_r511169718", "bodyText": "Do we need to traverse into sub-transforms to fetch their inputs, or are we guaranteed that all transforms are leaf transforms?", "author": "yifanmai", "createdAt": "2020-10-23T21:46:54Z", "path": "sdks/python/apache_beam/runners/portability/fn_api_runner/translations.py", "diffHunk": "@@ -1702,13 +1702,26 @@ def sort_stages(stages, pipeline_context):\n   seen = set()  # type: Set[Stage]\n   ordered = []\n \n+  producers = {\n+      pcoll: stage\n+      for stage in all_stages for t in stage.transforms", "originalCommit": "b6892f8fb29a2a1f3451a1e2e6ff7cc5ebd5d833", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzNDAzNw==", "url": "https://github.com/apache/beam/pull/13177#discussion_r514434037", "bodyText": "This should be sufficient. Generally the subtransform structure is not preserved when dealing with stages (and is simply reconstructed later).", "author": "robertwb", "createdAt": "2020-10-29T17:20:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2OTcxOA=="}], "type": "inlineReview"}]}