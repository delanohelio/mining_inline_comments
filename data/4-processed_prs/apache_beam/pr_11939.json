{"pr_number": 11939, "pr_title": "[BEAM-10197] Support typehints for Python's frozenset", "pr_createdAt": "2020-06-05T21:17:40Z", "pr_url": "https://github.com/apache/beam/pull/11939", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4NjIxNA==", "url": "https://github.com/apache/beam/pull/11939#discussion_r436186214", "bodyText": "If BaseSetHintTest inherited from TypeHintTestCase you could avoid multiple inheritance in the sub-classes below.", "author": "udim", "createdAt": "2020-06-05T22:07:26Z", "path": "sdks/python/apache_beam/typehints/typehints_test.py", "diffHunk": "@@ -612,54 +613,70 @@ def test_match_type_variables(self):\n                      hint.match_type_variables(typehints.Dict[int, str]))\n \n \n-class SetHintTestCase(TypeHintTestCase):\n+class BaseSetHintTest:", "originalCommit": "20dc6e0bdf6669639188fb72d545715fc9ab40b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQxNTMzOQ==", "url": "https://github.com/apache/beam/pull/11939#discussion_r436415339", "bodyText": "Just pushed a fix - BaseSetHintTest is now a wrapper for a nested class that inherits from TypeHintTestCase (which inherits from TestCase), thereby removing the multiple inheritance.\nI think BaseSetHintTest can't directly inherit from TypeHintTestCase because that would cause the unittest library to accidentally run the BaseSetHintTest tests which cannot be run without first being instantiated by the child classes (SetHintTestCase, FrozenSetHintTestCase). The nested class solves this issue - see here.", "author": "saavannanavati", "createdAt": "2020-06-08T00:13:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4NjIxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkwODQ2NA==", "url": "https://github.com/apache/beam/pull/11939#discussion_r436908464", "bodyText": "Nice solution! I've run into this in the past.\nWhat's happening is that pytest is loading all modules and inspecting their attributes looking for tests to run. Another solution solution would have been to set BaseSetHintTest = None near the bottom of this module. Effectively both solutions are hiding the base class from being collected by pytest.", "author": "udim", "createdAt": "2020-06-08T18:28:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4NjIxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkyMDQ3MQ==", "url": "https://github.com/apache/beam/pull/11939#discussion_r436920471", "bodyText": "That makes sense, thanks for the explanation!", "author": "saavannanavati", "createdAt": "2020-06-08T18:50:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4NjIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4Nzg3MQ==", "url": "https://github.com/apache/beam/pull/11939#discussion_r436187871", "bodyText": "You should omit *args, **kwargs if there aren't any more args allowed. This is the style we follow in this codebase. Here and below as well.\nFor example: if some code called BaseSetHintTest('Set', set, typehints.Set, typehints.FrozenSet) would you rather it be silently ignored or raised as an incorrect number of arguments?", "author": "udim", "createdAt": "2020-06-05T22:13:26Z", "path": "sdks/python/apache_beam/typehints/typehints_test.py", "diffHunk": "@@ -612,54 +613,70 @@ def test_match_type_variables(self):\n                      hint.match_type_variables(typehints.Dict[int, str]))\n \n \n-class SetHintTestCase(TypeHintTestCase):\n+class BaseSetHintTest:\n+  def __init__(self, string_type, py_type, beam_type, *args, **kwargs):", "originalCommit": "20dc6e0bdf6669639188fb72d545715fc9ab40b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQxNzA5MA==", "url": "https://github.com/apache/beam/pull/11939#discussion_r436417090", "bodyText": "That was there to forward arguments needed for the TestCase constructor but it looks like there is only one optional parameter, methodName, so I've pushed a fix to inline the parameter and remove *args, **kwargs. Thanks for the catch", "author": "saavannanavati", "createdAt": "2020-06-08T00:34:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4Nzg3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkxMDg3OA==", "url": "https://github.com/apache/beam/pull/11939#discussion_r436910878", "bodyText": "This is fine, but I would leave method_name out. We don't use this feature", "author": "udim", "createdAt": "2020-06-08T18:32:33Z", "path": "sdks/python/apache_beam/typehints/typehints_test.py", "diffHunk": "@@ -615,8 +615,8 @@ def test_match_type_variables(self):\n \n class BaseSetHintTest:\n   class CommonTests(TypeHintTestCase):\n-    def __init__(self, string_type, py_type, beam_type, *args, **kwargs):\n-      super().__init__(*args, **kwargs)\n+    def __init__(self, string_type, py_type, beam_type, method_name='runTest'):", "originalCommit": "970f2ce55ca4478a1106f0ba40068759198a2f3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d6b7d0eb9ead0d9f841f94fb035c2e814398745b", "url": "https://github.com/apache/beam/commit/d6b7d0eb9ead0d9f841f94fb035c2e814398745b", "message": "Merge remote-tracking branch 'origin/master' into BEAM-10197-support-frozenset-typehints", "committedDate": "2020-06-09T01:09:31Z", "type": "forcePushed"}, {"oid": "ff6ee7be7507dbf8930ac2e7b299a34e2f211dfc", "url": "https://github.com/apache/beam/commit/ff6ee7be7507dbf8930ac2e7b299a34e2f211dfc", "message": "Merge remote-tracking branch 'origin/master' into BEAM-10197-support-frozenset-typehints", "committedDate": "2020-06-09T01:17:30Z", "type": "forcePushed"}, {"oid": "5c909a79cac501e0c324e22eb24dc6f109ad4b68", "url": "https://github.com/apache/beam/commit/5c909a79cac501e0c324e22eb24dc6f109ad4b68", "message": "BEAM 10197 - Support typehints for frozenset", "committedDate": "2020-06-15T23:13:10Z", "type": "commit"}, {"oid": "d2c370a50eae9e65ff5ad22ff8b58c29abbd7840", "url": "https://github.com/apache/beam/commit/d2c370a50eae9e65ff5ad22ff8b58c29abbd7840", "message": "Added unit tests", "committedDate": "2020-06-15T23:13:10Z", "type": "commit"}, {"oid": "cd99a9f50127033ea682fae51209a0a446a790c9", "url": "https://github.com/apache/beam/commit/cd99a9f50127033ea682fae51209a0a446a790c9", "message": "Add additional unit tests for FrozenSet by refactoring existing Set tests with inheritance", "committedDate": "2020-06-15T23:13:10Z", "type": "commit"}, {"oid": "20f4f30ddd5ca634b0703a8c33f0181419648e53", "url": "https://github.com/apache/beam/commit/20f4f30ddd5ca634b0703a8c33f0181419648e53", "message": "Fixup: apply YAPF", "committedDate": "2020-06-15T23:13:10Z", "type": "commit"}, {"oid": "9916b82c7080732f1b51abaff562465e7e1d217e", "url": "https://github.com/apache/beam/commit/9916b82c7080732f1b51abaff562465e7e1d217e", "message": "Update Python type safety documentation", "committedDate": "2020-06-15T23:13:10Z", "type": "commit"}, {"oid": "0aa6e696734970d8a5a5bb59091c995c65cc60c8", "url": "https://github.com/apache/beam/commit/0aa6e696734970d8a5a5bb59091c995c65cc60c8", "message": "Refactor unit test design from multiple inheritance to single inheritance", "committedDate": "2020-06-15T23:13:10Z", "type": "commit"}, {"oid": "820300032f2bc16f57fdda4e54fc9dca56e41e1e", "url": "https://github.com/apache/beam/commit/820300032f2bc16f57fdda4e54fc9dca56e41e1e", "message": "Remove unnecessary *args, **kwargs", "committedDate": "2020-06-15T23:13:10Z", "type": "commit"}, {"oid": "5931a401b3c70ac720d989ce70160da3d9a66706", "url": "https://github.com/apache/beam/commit/5931a401b3c70ac720d989ce70160da3d9a66706", "message": "Fixed broken test by adding a test-only kwarg used in TypeVariable equality checks", "committedDate": "2020-06-15T23:13:10Z", "type": "commit"}, {"oid": "88e7e4f8f1f23fb035b4630fe84a6372df7ec2aa", "url": "https://github.com/apache/beam/commit/88e7e4f8f1f23fb035b4630fe84a6372df7ec2aa", "message": "Rebase with master", "committedDate": "2020-06-15T23:15:49Z", "type": "commit"}, {"oid": "88e7e4f8f1f23fb035b4630fe84a6372df7ec2aa", "url": "https://github.com/apache/beam/commit/88e7e4f8f1f23fb035b4630fe84a6372df7ec2aa", "message": "Rebase with master", "committedDate": "2020-06-15T23:15:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNjk4NA==", "url": "https://github.com/apache/beam/pull/11939#discussion_r440536984", "bodyText": "I think the logic here is reversed? (I don't see ignore_name used in any test in this commit.)\nAbout naming: (optional ideas)\n\nI'd recommend to be more descriptive about when name is ignored. Ex: ignore_name_in_eq\nI find using positive variable names easier to reason about. if use_name_in_eq is easier to read than if not ignore_name_in_eq.", "author": "udim", "createdAt": "2020-06-16T01:37:32Z", "path": "sdks/python/apache_beam/typehints/typehints.py", "diffHunk": "@@ -435,10 +435,14 @@ def type_check(self, instance):\n \n \n class TypeVariable(AnyTypeConstraint):\n-  def __init__(self, name):\n+  def __init__(self, name, ignore_name=False):\n     self.name = name\n+    self.ignore_name = ignore_name\n \n   def __eq__(self, other):\n+    if self.ignore_name:", "originalCommit": "5931a401b3c70ac720d989ce70160da3d9a66706", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEyMDMyMw==", "url": "https://github.com/apache/beam/pull/11939#discussion_r441120323", "bodyText": "Thanks, pushed a fix - it's used for one test in native_type_compatability_test.py\nAlso added unit tests for the new changes to TypeVariable", "author": "saavannanavati", "createdAt": "2020-06-16T20:25:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNjk4NA=="}], "type": "inlineReview"}, {"oid": "88df478b030f7f5821951de2fa89c9ecb6d5c370", "url": "https://github.com/apache/beam/commit/88df478b030f7f5821951de2fa89c9ecb6d5c370", "message": "Fixing TypeVariable's __eq__ and adding unit tests", "committedDate": "2020-06-16T20:08:05Z", "type": "forcePushed"}, {"oid": "141467b700425417d5333266d28f3ccdd41fdfe4", "url": "https://github.com/apache/beam/commit/141467b700425417d5333266d28f3ccdd41fdfe4", "message": "Fixing TypeVariable's __eq__ and adding unit tests", "committedDate": "2020-06-16T20:13:48Z", "type": "commit"}, {"oid": "141467b700425417d5333266d28f3ccdd41fdfe4", "url": "https://github.com/apache/beam/commit/141467b700425417d5333266d28f3ccdd41fdfe4", "message": "Fixing TypeVariable's __eq__ and adding unit tests", "committedDate": "2020-06-16T20:13:48Z", "type": "forcePushed"}, {"oid": "0796eb9682c2260e0fb7a877f780b2ca179bd35f", "url": "https://github.com/apache/beam/commit/0796eb9682c2260e0fb7a877f780b2ca179bd35f", "message": "Alphabetically sort imports", "committedDate": "2020-07-07T20:42:26Z", "type": "commit"}, {"oid": "62b980308084e04ef009a3b6971e7b5c7aa28931", "url": "https://github.com/apache/beam/commit/62b980308084e04ef009a3b6971e7b5c7aa28931", "message": "Fix lint errors", "committedDate": "2020-07-08T19:44:34Z", "type": "commit"}, {"oid": "757ff4c304e99180de99513fc0bb5b41137e35d6", "url": "https://github.com/apache/beam/commit/757ff4c304e99180de99513fc0bb5b41137e35d6", "message": "Alphabetically order imports", "committedDate": "2020-07-08T20:21:12Z", "type": "commit"}]}