{"pr_number": 11656, "pr_title": "[BEAM-9942] reduce groovy code duplication in python test-suites", "pr_createdAt": "2020-05-10T12:07:19Z", "pr_url": "https://github.com/apache/beam/pull/11656", "timeline": [{"oid": "6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "url": "https://github.com/apache/beam/commit/6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "message": "[BEAM-9942] reduce groovy code duplication in python test-suites", "committedDate": "2020-05-11T13:32:07Z", "type": "commit"}, {"oid": "6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "url": "https://github.com/apache/beam/commit/6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "message": "[BEAM-9942] reduce groovy code duplication in python test-suites", "committedDate": "2020-05-11T13:32:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxODI1NA==", "url": "https://github.com/apache/beam/pull/11656#discussion_r424618254", "bodyText": "We can move preCommitIT out as well, in a separate change. This is an example of a test that we currently run against only one of high priority versions.", "author": "tvalentyn", "createdAt": "2020-05-13T17:43:22Z", "path": "sdks/python/test-suites/dataflow/py37/build.gradle", "diffHunk": "@@ -24,19 +24,12 @@ dependencies {\n   distTarBall project(path: \":sdks:python\", configuration: \"distTarBall\")\n }\n \n-// Required to setup a Python 3 virtualenv.\n+// Required to setup a Python 3 virtualenv and task names.\n pythonVersion = '3.7'\n-\n+apply from: \"../common.gradle\"\n \n def runScriptsDir = \"${rootDir}/sdks/python/scripts\"\n \n-// Basic test options for ITs running on Jenkins.\n-def basicTestOpts = [\n-    \"--nocapture\",  // print stdout instantly\n-    \"--processes=8\",  // run tests in parallel\n-    \"--process-timeout=4500\", // timeout of whole command execution\n-]\n-\n def preCommitIT(String runScriptsDir, String envdir, Boolean streaming, Boolean runnerV2) {", "originalCommit": "6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyMzc4NQ==", "url": "https://github.com/apache/beam/pull/11656#discussion_r424623785", "bodyText": "CrossLanguage tests, SparkVR tests, also need to be configured to run against one of high-priority versions, looks like currently they are hardcoded to run in Python 2. This can be also done in a future change.  Feel free to open a JIRA to to track this cleanup.", "author": "tvalentyn", "createdAt": "2020-05-13T17:52:32Z", "path": "sdks/python/test-suites/portable/py2/build.gradle", "diffHunk": "@@ -113,28 +98,6 @@ task crossLanguagePortableWordCount {\n   }\n }\n \n-task postCommitPy2IT {\n-  dependsOn 'installGcpTest'\n-  dependsOn 'setupVirtualenv'\n-  dependsOn ':runners:flink:1.10:job-server:shadowJar'\n-\n-  doLast {\n-    def tests = [\n-        \"apache_beam.io.gcp.bigquery_read_it_test\",\n-    ]\n-    def testOpts = [\"--tests=${tests.join(',')}\"]\n-    def cmdArgs = mapToArgString([\n-        \"test_opts\": testOpts,\n-        \"suite\": \"postCommitIT-flink-py2\",\n-        \"pipeline_opts\": \"--runner=FlinkRunner --project=apache-beam-testing --environment_type=LOOPBACK --temp_location=gs://temp-storage-for-end-to-end-tests/temp-it\",\n-    ])\n-    exec {\n-      executable 'sh'\n-      args '-c', \". ${envdir}/bin/activate && ${runScriptsDir}/run_integration_test.sh $cmdArgs\"\n-    }\n-  }\n-}\n-\n task crossLanguageTests {", "originalCommit": "6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1NDc1Ng==", "url": "https://github.com/apache/beam/pull/11656#discussion_r425254756", "bodyText": "Exactly.\nBEAM-9980 aims to do that.", "author": "lazylynx", "createdAt": "2020-05-14T16:06:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyMzc4NQ=="}], "type": "inlineReview"}]}