{"pr_number": 10612, "pr_title": "[BEAM-9063] migrate docker images to apache", "pr_createdAt": "2020-01-16T20:00:28Z", "pr_url": "https://github.com/apache/beam/pull/10612", "timeline": [{"oid": "94ee931399e0494239b7fc25f4409414e7fa215b", "url": "https://github.com/apache/beam/commit/94ee931399e0494239b7fc25f4409414e7fa215b", "message": "[BEAM-9063] migrate docker images to apache", "committedDate": "2020-01-16T21:31:58Z", "type": "forcePushed"}, {"oid": "fc7bbd270bc5be7fa81c85c10fb9216f0189fcc7", "url": "https://github.com/apache/beam/commit/fc7bbd270bc5be7fa81c85c10fb9216f0189fcc7", "message": "[BEAM-9063] migrate docker images to apache", "committedDate": "2020-01-16T21:42:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzMzQ3MQ==", "url": "https://github.com/apache/beam/pull/10612#discussion_r368133471", "bodyText": "Elsewhere, we use underscores in our docker image names (e.g. java_sdk). We should use an underscore here to keep it consistent.", "author": "ibzib", "createdAt": "2020-01-17T20:57:54Z", "path": "gradle.properties", "diffHunk": "@@ -27,3 +27,6 @@ version=2.20.0-SNAPSHOT\n sdk_version=2.20.0.dev\n \n javaVersion=1.8\n+\n+docker_image_default_repo_root=apache\n+docker_image_default_repo_prefix=beam-", "originalCommit": "fc7bbd270bc5be7fa81c85c10fb9216f0189fcc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE2NjgwOA==", "url": "https://github.com/apache/beam/pull/10612#discussion_r369166808", "bodyText": "This is intended in order to distinguish project name and image name.", "author": "Hannah-Jiang", "createdAt": "2020-01-21T18:24:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzMzQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE5MDk4MA==", "url": "https://github.com/apache/beam/pull/10612#discussion_r369190980", "bodyText": "Ideally we would be able to use a subrepo or a slash in the image name, but since those are not supported by Docker, I don't think mixing hyphens and underscores is a good alternative. I think most users would expect either only hyphens or only underscores (the two are seldom mixed within the same string), so having both makes tags more difficult to use for humans (harder to remember and easy to make typos).", "author": "ibzib", "createdAt": "2020-01-21T19:13:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzMzQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE5OTk3MQ==", "url": "https://github.com/apache/beam/pull/10612#discussion_r369199971", "bodyText": "changed it to underscore.", "author": "Hannah-Jiang", "createdAt": "2020-01-21T19:31:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzMzQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTIwOTczNQ==", "url": "https://github.com/apache/beam/pull/10612#discussion_r369209735", "bodyText": "Thanks! Make sure you also change the prefix everywhere it needs to be hard-coded.", "author": "ibzib", "createdAt": "2020-01-21T19:52:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzMzQ3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzNDU3Ng==", "url": "https://github.com/apache/beam/pull/10612#discussion_r368134576", "bodyText": "Looks like we lost spark here.", "author": "ibzib", "createdAt": "2020-01-17T21:01:07Z", "path": "runners/spark/job-server/container/build.gradle", "diffHunk": "@@ -54,9 +54,10 @@ task copyDockerfileDependencies(type: Copy) {\n }\n \n docker {\n-  name containerImageName(name: 'spark-job-server',\n+  name containerImageName(name: ${project.docker_image_default_repo_prefix} + 'job-server',", "originalCommit": "fc7bbd270bc5be7fa81c85c10fb9216f0189fcc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE2NzIyMw==", "url": "https://github.com/apache/beam/pull/10612#discussion_r369167223", "bodyText": "Fixed it.\nIs there any reason we used - instead of _ for spark-job-server?", "author": "Hannah-Jiang", "createdAt": "2020-01-21T18:25:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzNDU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE4NTk1OQ==", "url": "https://github.com/apache/beam/pull/10612#discussion_r369185959", "bodyText": "I suppose it should probably use underscores like everywhere else.", "author": "ibzib", "createdAt": "2020-01-21T19:02:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzNDU3Ng=="}], "type": "inlineReview"}, {"oid": "a8496d2d387f5a788b58c64ebb9406f507ebf7cd", "url": "https://github.com/apache/beam/commit/a8496d2d387f5a788b58c64ebb9406f507ebf7cd", "message": "[BEAM-9063] migrate docker images to apache", "committedDate": "2020-01-21T18:23:13Z", "type": "forcePushed"}, {"oid": "d29a1d4ff850ec8289b0548fdcce3d7db24e69cf", "url": "https://github.com/apache/beam/commit/d29a1d4ff850ec8289b0548fdcce3d7db24e69cf", "message": "[BEAM-9063] migrate docker images to apache", "committedDate": "2020-01-21T19:31:12Z", "type": "commit"}, {"oid": "d29a1d4ff850ec8289b0548fdcce3d7db24e69cf", "url": "https://github.com/apache/beam/commit/d29a1d4ff850ec8289b0548fdcce3d7db24e69cf", "message": "[BEAM-9063] migrate docker images to apache", "committedDate": "2020-01-21T19:31:12Z", "type": "forcePushed"}, {"oid": "afd5aa7ce5fc7232b24ebaf98c94fa0f141c49f8", "url": "https://github.com/apache/beam/commit/afd5aa7ce5fc7232b24ebaf98c94fa0f141c49f8", "message": "change prefix from beam- to beam_", "committedDate": "2020-01-21T22:13:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcxNjUwMw==", "url": "https://github.com/apache/beam/pull/10612#discussion_r369716503", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /** Provides docker image default repo prefix (beam-). */\n          \n          \n            \n              /** Provides docker image default repo prefix (beam_). */", "author": "ibzib", "createdAt": "2020-01-22T18:03:41Z", "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/ReleaseInfo.java", "diffHunk": "@@ -59,10 +59,22 @@ public String getSdkVersion() {\n     return getProperties().get(\"sdk_version\");\n   }\n \n+  /** Provides docker image default root (apache). */\n+  public String getDefaultDockerRepoRoot() {\n+    return getProperties().get(\"docker_image_default_repo_root\");\n+  }\n+\n+  /** Provides docker image default repo prefix (beam-). */", "originalCommit": "afd5aa7ce5fc7232b24ebaf98c94fa0f141c49f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcxNjU1NQ==", "url": "https://github.com/apache/beam/pull/10612#discussion_r369716555", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static final String DEFAULT_DOCKER_IMAGE_PREFIX = \"beam-\";\n          \n          \n            \n              private static final String DEFAULT_DOCKER_IMAGE_PREFIX = \"beam_\";", "author": "ibzib", "createdAt": "2020-01-22T18:03:49Z", "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/ReleaseInfo.java", "diffHunk": "@@ -59,10 +59,22 @@ public String getSdkVersion() {\n     return getProperties().get(\"sdk_version\");\n   }\n \n+  /** Provides docker image default root (apache). */\n+  public String getDefaultDockerRepoRoot() {\n+    return getProperties().get(\"docker_image_default_repo_root\");\n+  }\n+\n+  /** Provides docker image default repo prefix (beam-). */\n+  public String getDefaultDockerRepoPrefix() {\n+    return getProperties().get(\"docker_image_default_repo_prefix\");\n+  }\n+\n   /////////////////////////////////////////////////////////////////////////\n   private static final Logger LOG = LoggerFactory.getLogger(ReleaseInfo.class);\n   private static final String DEFAULT_NAME = \"Apache Beam SDK for Java\";\n   private static final String DEFAULT_VERSION = \"Unknown\";\n+  private static final String DEFAULT_DOCKER_IMAGE_ROOT = \"apache\";\n+  private static final String DEFAULT_DOCKER_IMAGE_PREFIX = \"beam-\";", "originalCommit": "afd5aa7ce5fc7232b24ebaf98c94fa0f141c49f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e86c664362686f842645ad0217c2a2155a931007", "url": "https://github.com/apache/beam/commit/e86c664362686f842645ad0217c2a2155a931007", "message": "Update sdks/java/core/src/main/java/org/apache/beam/sdk/util/ReleaseInfo.java\n\nCo-Authored-By: Kyle Weaver <kcweaver@google.com>", "committedDate": "2020-01-22T18:31:44Z", "type": "commit"}, {"oid": "8e9280aadf677fcd18cf8cedd3ebf80f6257c101", "url": "https://github.com/apache/beam/commit/8e9280aadf677fcd18cf8cedd3ebf80f6257c101", "message": "Update sdks/java/core/src/main/java/org/apache/beam/sdk/util/ReleaseInfo.java\n\nCo-Authored-By: Kyle Weaver <kcweaver@google.com>", "committedDate": "2020-01-22T18:32:02Z", "type": "commit"}, {"oid": "4862cbbc11658498474d16e572135407642e0948", "url": "https://github.com/apache/beam/commit/4862cbbc11658498474d16e572135407642e0948", "message": "Merge branch 'master' into docker_images_migration", "committedDate": "2020-01-27T21:29:47Z", "type": "commit"}, {"oid": "90c0f49930ce0385951e409b7bf7988972f1e1a5", "url": "https://github.com/apache/beam/commit/90c0f49930ce0385951e409b7bf7988972f1e1a5", "message": "Merge branch 'master' into docker_images_migration", "committedDate": "2020-01-28T00:49:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1MjU2NA==", "url": "https://github.com/apache/beam/pull/10612#discussion_r371752564", "bodyText": "Would it be worth sourcing these from a script?", "author": "mxm", "createdAt": "2020-01-28T11:40:47Z", "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -45,6 +45,9 @@ PYTHON_ARTIFACTS_DIR=python\n BEAM_ROOT_DIR=beam\n WEBSITE_ROOT_DIR=beam-site\n \n+DOCKER_IMAGE_DEFAULT_REPO_ROOT=apache\n+DOCKER_IMAGE_DEFAULT_REPO_PREFIX=beam_", "originalCommit": "90c0f49930ce0385951e409b7bf7988972f1e1a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk2NDIzMg==", "url": "https://github.com/apache/beam/pull/10612#discussion_r371964232", "bodyText": "Yeap, that's a great idea and I think it's better to have a script which holds all variables and shared by all release scripts, so I haven't used a script this time. I created a ticket to fix it. BEAM-9207", "author": "Hannah-Jiang", "createdAt": "2020-01-28T17:58:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1MjU2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1MjYxNQ==", "url": "https://github.com/apache/beam/pull/10612#discussion_r371752615", "bodyText": "Would it be worth sourcing these from a script?", "author": "mxm", "createdAt": "2020-01-28T11:40:55Z", "path": "release/src/main/scripts/publish_docker_images.sh", "diffHunk": "@@ -24,6 +24,9 @@\n \n set -e\n \n+DOCKER_IMAGE_DEFAULT_REPO_ROOT=apache\n+DOCKER_IMAGE_DEFAULT_REPO_PREFIX=beam_", "originalCommit": "90c0f49930ce0385951e409b7bf7988972f1e1a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5a06fa529970dc91263dea625d60faa601a86ae3", "url": "https://github.com/apache/beam/commit/5a06fa529970dc91263dea625d60faa601a86ae3", "message": "Merge branch 'master' into docker_images_migration", "committedDate": "2020-02-21T00:58:05Z", "type": "commit"}, {"oid": "5b95684c42425285b1d63a1937e64d6e762303f9", "url": "https://github.com/apache/beam/commit/5b95684c42425285b1d63a1937e64d6e762303f9", "message": "Merge branch 'master' into docker_images_migration", "committedDate": "2020-02-21T19:22:23Z", "type": "commit"}, {"oid": "bed36ef63f8e0b32f4d1be71d42d1f76ef9da9ec", "url": "https://github.com/apache/beam/commit/bed36ef63f8e0b32f4d1be71d42d1f76ef9da9ec", "message": "add spark job server container", "committedDate": "2020-02-21T19:31:46Z", "type": "commit"}]}