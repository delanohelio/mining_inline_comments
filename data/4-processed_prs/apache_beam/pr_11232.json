{"pr_number": 11232, "pr_title": "[BEAM-8280] Document Python 3 annotations support", "pr_createdAt": "2020-03-26T01:09:40Z", "pr_url": "https://github.com/apache/beam/pull/11232", "timeline": [{"oid": "dcdaf65e44a293f0c27612bb14f025d2c68020b1", "url": "https://github.com/apache/beam/commit/dcdaf65e44a293f0c27612bb14f025d2c68020b1", "message": "[BEAM-8280] Document Python 3 annotations support\n\nAlso updates snippets, but since snippets are taken from Beam's Github\nrepo from master, imagine they look like they do in this PR (please).", "committedDate": "2020-03-26T01:04:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI4MTY0OA==", "url": "https://github.com/apache/beam/pull/11232#discussion_r398281648", "bodyText": "Is this also added to the changes.md ?", "author": "aaltay", "createdAt": "2020-03-26T02:25:49Z", "path": "website/src/documentation/sdks/python-type-safety.md", "diffHunk": "@@ -64,22 +84,75 @@ To specify type hints as properties of a `DoFn` or `PTransform`, use the decorat\n \n The following code declares an `int` type hint on `FilterEvensDoFn`, using the decorator `@with_input_types()`.\n \n+```py\n+{% github_sample /apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/snippets_test.py tag:type_hints_do_fn %}\n ```\n-{% github_sample /apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/snippets_test.py tag:type_hints_do_fn %}```\n \n Decorators receive an arbitrary number of positional and/or keyword arguments, typically interpreted in the context of the function they're wrapping. Generally the first argument is a type hint for the main input, and additional arguments are type hints for side inputs.\n \n-### Defining Generic Types\n+### Declaring Type Hints Using Annotations\n+\n+_New in version 2.21.0._", "originalCommit": "dcdaf65e44a293f0c27612bb14f025d2c68020b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc2NTA5MA==", "url": "https://github.com/apache/beam/pull/11232#discussion_r398765090", "bodyText": "Yes: https://github.com/apache/beam/pull/10717/files#diff-8b1c3fd0d4a6765c16dfd18509182f9d", "author": "udim", "createdAt": "2020-03-26T17:39:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI4MTY0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1Mzc1Ng==", "url": "https://github.com/apache/beam/pull/11232#discussion_r399553756", "bodyText": "I might lead with this paragraph, maybe even giving a very concrete example (\"for example, giving an error when trying to apply a PTransform that expects a PCollection of strings to a PCollection of ints\"). Then put the other paragraph about Beam not always being able to infer types next.", "author": "robertwb", "createdAt": "2020-03-27T21:48:26Z", "path": "website/src/documentation/sdks/python-type-safety.md", "diffHunk": "@@ -23,38 +23,58 @@ Python is a dynamically-typed language with no static type checking. Because of\n \n The Apache Beam SDK for Python uses **type hints** during pipeline construction and runtime to try to emulate the correctness guarantees achieved by true static typing. Additionally, using type hints lays some groundwork that allows the backend service to perform efficient type deduction and registration of `Coder` objects.\n \n-Python version 3.5 introduces a module called **typing** to provide hints for type validators in the language. The Beam SDK for Python, based on Python version 2.7, implements a subset of [PEP 484](https://www.python.org/dev/peps/pep-0484/) and aims to follow it as closely as possible in its own typehints module.\n+Python version 3.5 introduces a module called **typing** to provide hints for type validators in the language.\n+The Beam SDK for Python implements a subset of [PEP 484](https://www.python.org/dev/peps/pep-0484/) and aims to follow it as closely as possible in its own typehints module.\n+\n+These flags control Beam type safety:\n+- `--no_pipeline_type_check`\n+\n+  Disables type checking during pipeline construction.\n+  Default is to perform these checks.\n+- `--runtime_type_check`\n+\n+  Enables runtime type checking of every element.\n+  This may affect pipeline performance, so the default is to skip these checks.\n \n ## Benefits of Type Hints\n \n-The Beam SDK for Python includes some automatic type checking: for example, some `PTransform`s, such as `Create` and simple `ParDo` transforms, attempt to deduce their output type given their input. However, the Beam cannot infer types in all cases. Therefore, the recommendation is that you declare type hints to aid you in performing your own type checks if necessary.\n+The Beam SDK for Python includes some automatic type checking: for example, some `PTransforms`, such as `Create` and simple `ParDo` transforms, attempt to deduce their output type given their input. However, the Beam cannot infer types in all cases. Therefore, the recommendation is that you declare type hints to aid you in performing your own type checks if necessary.\n \n-When you use type hints, the runner raises exceptions during pipeline construction time, rather than runtime. For example, the runner generates an exception if it detects that your pipeline applies mismatched `PTransforms` (where the expected outputs of one transform do not match the expected inputs of the following transform). These exceptions are raised at pipeline construction time, regardless of where your pipeline will execute. Introducing type hints for the `PTransform`s you define allows you to catch potential bugs up front in the local runner, rather than after minutes of execution into a deep, complex pipeline.\n+When you use type hints, the runner raises exceptions during pipeline construction time, rather than runtime. For example, the runner generates an exception if it detects that your pipeline applies mismatched `PTransforms` (where the expected outputs of one transform do not match the expected inputs of the following transform). These exceptions are raised at pipeline construction time, regardless of where your pipeline will execute. Introducing type hints for the `PTransforms` you define allows you to catch potential bugs up front in the local runner, rather than after minutes of execution into a deep, complex pipeline.", "originalCommit": "dcdaf65e44a293f0c27612bb14f025d2c68020b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcxNTMyNg==", "url": "https://github.com/apache/beam/pull/11232#discussion_r405715326", "bodyText": "Done. Also reworded this paragraph a bit.", "author": "udim", "createdAt": "2020-04-08T18:07:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1Mzc1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1NDU1NA==", "url": "https://github.com/apache/beam/pull/11232#discussion_r399554554", "bodyText": "This should be the preferred way; put it first.", "author": "robertwb", "createdAt": "2020-03-27T21:50:32Z", "path": "website/src/documentation/sdks/python-type-safety.md", "diffHunk": "@@ -64,22 +84,75 @@ To specify type hints as properties of a `DoFn` or `PTransform`, use the decorat\n \n The following code declares an `int` type hint on `FilterEvensDoFn`, using the decorator `@with_input_types()`.\n \n+```py\n+{% github_sample /apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/snippets_test.py tag:type_hints_do_fn %}\n ```\n-{% github_sample /apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/snippets_test.py tag:type_hints_do_fn %}```\n \n Decorators receive an arbitrary number of positional and/or keyword arguments, typically interpreted in the context of the function they're wrapping. Generally the first argument is a type hint for the main input, and additional arguments are type hints for side inputs.\n \n-### Defining Generic Types\n+### Declaring Type Hints Using Annotations", "originalCommit": "dcdaf65e44a293f0c27612bb14f025d2c68020b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyMjY3NA==", "url": "https://github.com/apache/beam/pull/11232#discussion_r405722674", "bodyText": "done", "author": "udim", "createdAt": "2020-04-08T18:19:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1NDU1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1NDcwMA==", "url": "https://github.com/apache/beam/pull/11232#discussion_r399554700", "bodyText": "\"Declaring Type Hints Using Type Annotations\" (might be a bit redundant, but is clearer).", "author": "robertwb", "createdAt": "2020-03-27T21:51:01Z", "path": "website/src/documentation/sdks/python-type-safety.md", "diffHunk": "@@ -64,22 +84,75 @@ To specify type hints as properties of a `DoFn` or `PTransform`, use the decorat\n \n The following code declares an `int` type hint on `FilterEvensDoFn`, using the decorator `@with_input_types()`.\n \n+```py\n+{% github_sample /apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/snippets_test.py tag:type_hints_do_fn %}\n ```\n-{% github_sample /apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/snippets_test.py tag:type_hints_do_fn %}```\n \n Decorators receive an arbitrary number of positional and/or keyword arguments, typically interpreted in the context of the function they're wrapping. Generally the first argument is a type hint for the main input, and additional arguments are type hints for side inputs.\n \n-### Defining Generic Types\n+### Declaring Type Hints Using Annotations", "originalCommit": "dcdaf65e44a293f0c27612bb14f025d2c68020b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyMzA2MQ==", "url": "https://github.com/apache/beam/pull/11232#discussion_r405723061", "bodyText": "done", "author": "udim", "createdAt": "2020-04-08T18:20:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1NDcwMA=="}], "type": "inlineReview"}, {"oid": "e803a7a6ac409a6fe43d2130b7aed6000ba01955", "url": "https://github.com/apache/beam/commit/e803a7a6ac409a6fe43d2130b7aed6000ba01955", "message": "Addressed review comments", "committedDate": "2020-04-08T18:20:48Z", "type": "commit"}]}