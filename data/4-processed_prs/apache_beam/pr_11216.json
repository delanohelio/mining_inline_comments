{"pr_number": 11216, "pr_title": "[BEAM-9562] Remove TimerSpec from Proto", "pr_createdAt": "2020-03-25T03:21:49Z", "pr_url": "https://github.com/apache/beam/pull/11216", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0MDA5OQ==", "url": "https://github.com/apache/beam/pull/11216#discussion_r397940099", "bodyText": "I would suggest not changing the proto tag numbers otherwise you'll have a more difficult import/update issue with Google.\nIt will be much easier as a separate change to renumber them in increasing order, so timer_family_specs is 5, restriction_coder_id is 6, requests_finalization is 7, ... (making the import into Google much simpler to do).", "author": "lukecwik", "createdAt": "2020-03-25T15:21:18Z", "path": "model/pipeline/src/main/proto/beam_runner_api.proto", "diffHunk": "@@ -442,35 +442,30 @@ message ParDoPayload {\n   // be placed in the pipeline requirements.\n   map<string, StateSpec> state_specs = 4;\n \n-  // (Optional) A mapping of local timer names to timer specifications.\n-  // If this is set, the stateful processing requirement should also\n-  // be placed in the pipeline requirements.\n-  map<string, TimerSpec> timer_specs = 5;\n-\n-  // (Optional) A mapping of local timer family names to timer specifications.\n-  // If this is set, the stateful processing requirement should also\n-  // be placed in the pipeline requirements.\n-  map<string, TimerFamilySpec> timer_family_specs = 9;\n+  // (Optional) A mapping of local timer family names to timer family\n+  // specifications. If this is set, the stateful processing requirement should\n+  // also be placed in the pipeline requirements.\n+  map<string, TimerFamilySpec> timer_family_specs = 8;", "originalCommit": "b0a0b85e4f6b6a1e0679bfdf8caea499f9d46157", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0MjcyNg==", "url": "https://github.com/apache/beam/pull/11216#discussion_r397942726", "bodyText": "shouldn't this method replace to_runner_api?", "author": "lukecwik", "createdAt": "2020-03-25T15:24:27Z", "path": "sdks/python/apache_beam/transforms/userstate.py", "diffHunk": "@@ -141,6 +143,13 @@ def __init__(self, name, time_domain):\n   def __repr__(self):\n     return '%s(%s)' % (self.__class__.__name__, self.name)\n \n+  def to_timer_family_runner_api(self, context):", "originalCommit": "b0a0b85e4f6b6a1e0679bfdf8caea499f9d46157", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAxMTk2NQ==", "url": "https://github.com/apache/beam/pull/11216#discussion_r398011965", "bodyText": "I'm working on the Java changes meanwhile having some python tests to run to catch any breakages. Changing to to_runner_api is the next step. We should also remove TimerSpec definition from proto as long as nowhere else uses it.", "author": "boyuanzz", "createdAt": "2020-03-25T16:52:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0MjcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY5MTY5Ng==", "url": "https://github.com/apache/beam/pull/11216#discussion_r398691696", "bodyText": "+1 on TimerSpec removal", "author": "lukecwik", "createdAt": "2020-03-26T16:02:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0MjcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwMTE1Mg==", "url": "https://github.com/apache/beam/pull/11216#discussion_r398801152", "bodyText": "You can rename this method to to_runner_api and remove the method below.", "author": "lukecwik", "createdAt": "2020-03-26T18:31:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0MjcyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0MzgyOQ==", "url": "https://github.com/apache/beam/pull/11216#discussion_r397943829", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # TODO(BEAM-9602): Provide support of dynamic timer\n          \n          \n            \n            # TODO(BEAM-9602): Provide support for dynamic timer", "author": "lukecwik", "createdAt": "2020-03-25T15:25:51Z", "path": "sdks/python/apache_beam/transforms/userstate.py", "diffHunk": "@@ -149,6 +158,26 @@ def to_runner_api(self, context):\n             coders._TimerCoder(coders.SingletonCoder(None))))\n \n \n+# TODO(BEAM-9602): Provide support of dynamic timer", "originalCommit": "b0a0b85e4f6b6a1e0679bfdf8caea499f9d46157", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3cd45e0ebc255c396e862f48acad335b7c568ed9", "url": "https://github.com/apache/beam/commit/3cd45e0ebc255c396e862f48acad335b7c568ed9", "message": "Remove TimeSpec from proto", "committedDate": "2020-03-26T18:22:53Z", "type": "forcePushed"}, {"oid": "60d298adcef07eeb1aec42c864246301f43c1582", "url": "https://github.com/apache/beam/commit/60d298adcef07eeb1aec42c864246301f43c1582", "message": "Remove TimeSpec from proto", "committedDate": "2020-03-26T18:57:01Z", "type": "forcePushed"}, {"oid": "39703c640b785349719f05278c8ee8b1944076d6", "url": "https://github.com/apache/beam/commit/39703c640b785349719f05278c8ee8b1944076d6", "message": "Remove TimeSpec from proto", "committedDate": "2020-03-27T03:26:45Z", "type": "commit"}, {"oid": "39703c640b785349719f05278c8ee8b1944076d6", "url": "https://github.com/apache/beam/commit/39703c640b785349719f05278c8ee8b1944076d6", "message": "Remove TimeSpec from proto", "committedDate": "2020-03-27T03:26:45Z", "type": "forcePushed"}]}