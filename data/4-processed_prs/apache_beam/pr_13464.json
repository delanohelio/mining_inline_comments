{"pr_number": 13464, "pr_title": "[BEAM-11383] Add runtime normalization for file timestamps", "pr_createdAt": "2020-12-02T18:03:40Z", "pr_url": "https://github.com/apache/beam/pull/13464", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczMzgwNw==", "url": "https://github.com/apache/beam/pull/13464#discussion_r535733807", "bodyText": "Could/should we do this in applyJavaNature and/or applyPortabilityNature to get the benefit for all built jars?", "author": "TheNeuralBit", "createdAt": "2020-12-03T23:56:30Z", "path": "sdks/java/core/build.gradle", "diffHunk": "@@ -66,6 +66,10 @@ test {\n   }\n }\n \n+tasks.withType(Jar).configureEach {\n+  preserveFileTimestamps(false)\n+}\n+", "originalCommit": "7228b898dc88c78eac9d7bb23d225e530a2f8e75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MjIwNg==", "url": "https://github.com/apache/beam/pull/13464#discussion_r535962206", "bodyText": "Good point. I added this to applyJavaNature since applyPortabilityNature also calls applyJavaNature.", "author": "runningcode", "createdAt": "2020-12-04T09:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczMzgwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczNDg2Ng==", "url": "https://github.com/apache/beam/pull/13464#discussion_r535734866", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            allprojects {\n          \n          \n            \n            # Ignore sdk.properties so it doesn't spoil the build cache unnecessarily (see https://docs.gradle.org/6.6/userguide/more_about_tasks.html#sec:configure_input_normalization)\n          \n          \n            \n            allprojects {\n          \n      \n    \n    \n  \n\n(or something)", "author": "TheNeuralBit", "createdAt": "2020-12-03T23:59:05Z", "path": "build.gradle", "diffHunk": "@@ -375,8 +375,16 @@ if (project.hasProperty('compileAndRunTestsWithJava11')) {\n   project.sqlPreCommit.dependsOn ':sdks:java:testing:test-utils:verifyJavaVersion'\n } else {\n   allprojects {\n-    tasks.withType(Test) {\n+    tasks.withType(Test).configureEach {\n       exclude '**/JvmVerification.class'\n     }\n   }\n }\n+\n+allprojects {", "originalCommit": "7228b898dc88c78eac9d7bb23d225e530a2f8e75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MTYzNw==", "url": "https://github.com/apache/beam/pull/13464#discussion_r535961637", "bodyText": "Added", "author": "runningcode", "createdAt": "2020-12-04T09:34:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczNDg2Ng=="}], "type": "inlineReview"}, {"oid": "f8be8adc03d0353fa4c38c61c6683c9637afd605", "url": "https://github.com/apache/beam/commit/f8be8adc03d0353fa4c38c61c6683c9637afd605", "message": "[BEAM-11383] Add runtime normalization for sdk.properties.\n\nThis normalizes the sdk.properties file which has a build timestamp in it as well as the version and sdk version. For the purposes of the runtime classpath, these can be ignored so that tasks are not rerun if only the build timestamp is changed.\nThis should result in significantly higher cache hits as well as more up-to-date checks.\n\nThis also preserves timestamps for certain tasks for the same reason.\n\nBEAM-11383", "committedDate": "2020-12-04T09:33:36Z", "type": "commit"}, {"oid": "f8be8adc03d0353fa4c38c61c6683c9637afd605", "url": "https://github.com/apache/beam/commit/f8be8adc03d0353fa4c38c61c6683c9637afd605", "message": "[BEAM-11383] Add runtime normalization for sdk.properties.\n\nThis normalizes the sdk.properties file which has a build timestamp in it as well as the version and sdk version. For the purposes of the runtime classpath, these can be ignored so that tasks are not rerun if only the build timestamp is changed.\nThis should result in significantly higher cache hits as well as more up-to-date checks.\n\nThis also preserves timestamps for certain tasks for the same reason.\n\nBEAM-11383", "committedDate": "2020-12-04T09:33:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4ODY0OQ==", "url": "https://github.com/apache/beam/pull/13464#discussion_r536388649", "bodyText": "Ah yes I guess applyJavaNature is called in applyPortabilityNature already so this caputres both \ud83d\udc4d", "author": "TheNeuralBit", "createdAt": "2020-12-04T21:25:44Z", "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -770,6 +770,10 @@ class BeamModulePlugin implements Plugin<Project> {\n         + (defaultLintSuppressions + configuration.disableLintWarnings).collect { \"-Xlint:-${it}\" })\n       }\n \n+      project.tasks.withType(Jar).configureEach {\n+        preserveFileTimestamps(false)\n+      }\n+", "originalCommit": "f8be8adc03d0353fa4c38c61c6683c9637afd605", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}