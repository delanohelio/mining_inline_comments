{"pr_number": 10536, "pr_title": "[BEAM-7861] Add direct_running_mode option for direct runners to switch between multi_threading and multi_processing easily", "pr_createdAt": "2020-01-08T22:43:37Z", "pr_url": "https://github.com/apache/beam/pull/10536", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDUyMDYyMg==", "url": "https://github.com/apache/beam/pull/10536#discussion_r364520622", "bodyText": "Would it make sense to add another choice for EmbeddedWorkerHandler and change the default to that, instead of defaulting to None?", "author": "aaltay", "createdAt": "2020-01-09T01:15:52Z", "path": "sdks/python/apache_beam/options/pipeline_options.py", "diffHunk": "@@ -438,6 +438,12 @@ def _add_argparse_args(cls, parser):\n         type=int,\n         default=1,\n         help='number of parallel running workers.')\n+    parser.add_argument(\n+        '--direct_running_mode',\n+        default=None,", "originalCommit": "c394c532935e12e00aeb56dd08c4c5e217d140ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg1OTYyMw==", "url": "https://github.com/apache/beam/pull/10536#discussion_r364859623", "bodyText": "Yes, that makes more sense, I will make a commit.", "author": "Hannah-Jiang", "createdAt": "2020-01-09T17:09:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDUyMDYyMg=="}], "type": "inlineReview"}, {"oid": "b3f33d96d571c0e455bea8e08e4ed7b2ff2e7f79", "url": "https://github.com/apache/beam/commit/b3f33d96d571c0e455bea8e08e4ed7b2ff2e7f79", "message": "BEAM-7861 add direct_running_mode option\n\n[BEAM-7861] add in_memory choice", "committedDate": "2020-01-09T18:22:49Z", "type": "commit"}, {"oid": "b3f33d96d571c0e455bea8e08e4ed7b2ff2e7f79", "url": "https://github.com/apache/beam/commit/b3f33d96d571c0e455bea8e08e4ed7b2ff2e7f79", "message": "BEAM-7861 add direct_running_mode option\n\n[BEAM-7861] add in_memory choice", "committedDate": "2020-01-09T18:22:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkyOTI0Mw==", "url": "https://github.com/apache/beam/pull/10536#discussion_r364929243", "bodyText": "Could this be None any more? Since it has a default value.", "author": "aaltay", "createdAt": "2020-01-09T19:49:34Z", "path": "sdks/python/apache_beam/runners/portability/fn_api_runner.py", "diffHunk": "@@ -450,6 +450,21 @@ def run_pipeline(self,\n         pipeline_options.DirectOptions).direct_runner_bundle_repeat\n     self._num_workers = options.view_as(\n         pipeline_options.DirectOptions).direct_num_workers or self._num_workers\n+\n+    # set direct workers running mode if it is defined with pipeline options.\n+    if options.view_as(pipeline_options.DirectOptions).direct_running_mode \\\n+        is not None:", "originalCommit": "b3f33d96d571c0e455bea8e08e4ed7b2ff2e7f79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk4Njk2Mw==", "url": "https://github.com/apache/beam/pull/10536#discussion_r364986963", "bodyText": "Rephrased it. Thank you for catching it.", "author": "Hannah-Jiang", "createdAt": "2020-01-09T22:16:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkyOTI0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk5OTM2Mg==", "url": "https://github.com/apache/beam/pull/10536#discussion_r364999362", "bodyText": "Why not utf-8?", "author": "ibzib", "createdAt": "2020-01-09T22:52:41Z", "path": "sdks/python/apache_beam/runners/portability/fn_api_runner.py", "diffHunk": "@@ -450,6 +450,19 @@ def run_pipeline(self,\n         pipeline_options.DirectOptions).direct_runner_bundle_repeat\n     self._num_workers = options.view_as(\n         pipeline_options.DirectOptions).direct_num_workers or self._num_workers\n+\n+    # set direct workers running mode if it is defined with pipeline options.\n+    running_mode = \\\n+      options.view_as(pipeline_options.DirectOptions).direct_running_mode\n+    if running_mode == 'multi_threading':\n+      self._default_environment = environments.EmbeddedPythonGrpcEnvironment()\n+    elif running_mode == 'multi_processing':\n+      command_bytes = b'%s -m apache_beam.runners.worker.sdk_worker_main' \\\n+                       % sys.executable.encode('ascii')", "originalCommit": "e6faf9cf05d72af69b6934b164ee6e2a64afe290", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTAxNTA4MQ==", "url": "https://github.com/apache/beam/pull/10536#discussion_r365015081", "bodyText": "I removed command_bytes because we don't need it anymore.", "author": "Hannah-Jiang", "createdAt": "2020-01-09T23:48:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk5OTM2Mg=="}], "type": "inlineReview"}, {"oid": "6b6df2feea283424c837bf00c125703b3dac642c", "url": "https://github.com/apache/beam/commit/6b6df2feea283424c837bf00c125703b3dac642c", "message": "[BEAM-7861] rephrase direct_running_mode option checking", "committedDate": "2020-01-09T23:46:45Z", "type": "commit"}, {"oid": "6b6df2feea283424c837bf00c125703b3dac642c", "url": "https://github.com/apache/beam/commit/6b6df2feea283424c837bf00c125703b3dac642c", "message": "[BEAM-7861] rephrase direct_running_mode option checking", "committedDate": "2020-01-09T23:46:45Z", "type": "forcePushed"}]}