{"pr_number": 12643, "pr_title": "[BEAM-10438] Update SupportedZetaSqlBuiltinFunctions and support math functions", "pr_createdAt": "2020-08-20T00:05:45Z", "pr_url": "https://github.com/apache/beam/pull/12643", "timeline": [{"oid": "ae0a10ac1941a21e22ff105735e239538679ff44", "url": "https://github.com/apache/beam/commit/ae0a10ac1941a21e22ff105735e239538679ff44", "message": "Enable math scalar functions and add unit tests", "committedDate": "2020-08-25T18:22:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NDMyNw==", "url": "https://github.com/apache/beam/pull/12643#discussion_r489084327", "bodyText": "nit: Renames like this are probably a net negative when you take into account the total cost of a change (time authoring and reviewing, increased diffs when debugging future issues, potential upgrade friction for customers). It is hard to know exactly where the line is so feel free to push forward with these as much of the work is already done. In the future I would suggest avoiding non-functional changes, particularly if they are something that would be at most a nit on a code review. (These went in recently and didn't even get a nit comment.)", "author": "apilloud", "createdAt": "2020-09-16T00:03:21Z", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigquery/BeamBigQuerySqlDialect.java", "diffHunk": "@@ -87,16 +87,17 @@\n           .put(\"$extract_time\", \"TIME\")\n           .put(\"$extract_datetime\", \"DATETIME\")\n           .build();\n-  public static final String DOUBLE_POSITIVE_INF_FUNCTION = \"double_positive_inf\";\n-  public static final String DOUBLE_NEGATIVE_INF_FUNCTION = \"double_negative_inf\";\n-  public static final String DOUBLE_NAN_FUNCTION = \"double_nan\";\n-  private static final Map<String, String> DOUBLE_FUNCTIONS =\n+  public static final String DOUBLE_POSITIVE_INF_WRAPPER = \"double_positive_inf\";", "originalCommit": "ae0a10ac1941a21e22ff105735e239538679ff44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2MDU5Mg==", "url": "https://github.com/apache/beam/pull/12643#discussion_r512460592", "bodyText": "I agree. I will let this change get in and avoid similar changes in the future. Sorry for the inconvenience.", "author": "robinyqiu", "createdAt": "2020-10-27T07:17:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NDMyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NDc4Mw==", "url": "https://github.com/apache/beam/pull/12643#discussion_r489084783", "bodyText": "nit: This PR has a interesting mix of minor refactors and addition of new functionality. These should probably be separate changes.", "author": "apilloud", "createdAt": "2020-09-16T00:04:54Z", "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SupportedZetaSqlBuiltinFunctions.java", "diffHunk": "@@ -277,29 +293,31 @@\n           FunctionSignatureId.FN_PARSE_DATETIME, // parse_datetime\n           FunctionSignatureId.FN_PARSE_TIME, // parse_time\n           FunctionSignatureId.FN_PARSE_TIMESTAMP, // parse_timestamp\n+          // FunctionSignatureId.FN_LAST_DAY_DATE, // last_day date\n+          // FunctionSignatureId.FN_LAST_DAY_DATETIME, // last_day datetime\n \n           // Math functions\n-          // FunctionSignatureId.FN_ABS_INT64, // abs\n-          // FunctionSignatureId.FN_ABS_DOUBLE, // abs\n-          // FunctionSignatureId.FN_ABS_NUMERIC, // abs\n+          FunctionSignatureId.FN_ABS_INT64, // abs", "originalCommit": "ae0a10ac1941a21e22ff105735e239538679ff44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2MjE4MQ==", "url": "https://github.com/apache/beam/pull/12643#discussion_r512462181", "bodyText": "Make sense. I will remember to separate different categories of changes in the future. Thanks for the suggestion!", "author": "robinyqiu", "createdAt": "2020-10-27T07:21:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NDc4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NTMzNA==", "url": "https://github.com/apache/beam/pull/12643#discussion_r489085334", "bodyText": "This one scares me just a little. In particular, I'm worried that we might accidentally optimize such that we end up with a constant. Is that something we need to test? https://xkcd.com/221/", "author": "apilloud", "createdAt": "2020-09-16T00:06:49Z", "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SupportedZetaSqlBuiltinFunctions.java", "diffHunk": "@@ -475,17 +512,22 @@\n \n           // FunctionSignatureId.FN_RANGE_BUCKET, //  range_bucket(T, array<T>) -> int64\n \n-          // FunctionSignatureId.FN_RAND, // rand() -> double\n+          FunctionSignatureId.FN_RAND // rand() -> double", "originalCommit": "ae0a10ac1941a21e22ff105735e239538679ff44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1NDcwNw==", "url": "https://github.com/apache/beam/pull/12643#discussion_r512754707", "bodyText": "Thanks for catching this! I will disable this for now, and enable it later once we have a thorough test.", "author": "robinyqiu", "createdAt": "2020-10-27T14:45:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NTMzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NzQyMQ==", "url": "https://github.com/apache/beam/pull/12643#discussion_r489087421", "bodyText": "nit: these constants are only used in ZetaSqlMathFunctionsTest.java, do they belong there?", "author": "apilloud", "createdAt": "2020-09-16T00:14:15Z", "path": "sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSqlTypesUtils.java", "diffHunk": "@@ -24,6 +24,11 @@\n @Internal\n public class ZetaSqlTypesUtils {\n \n+  public static final BigDecimal NUMERIC_MAX_VALUE =", "originalCommit": "ae0a10ac1941a21e22ff105735e239538679ff44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "287067eeed7b7f48ef25ff5ddcd408ee572861c0", "url": "https://github.com/apache/beam/commit/287067eeed7b7f48ef25ff5ddcd408ee572861c0", "message": "Update SupportedZetaSqlBuiltinFunctions and support math functions", "committedDate": "2020-10-27T07:49:18Z", "type": "commit"}, {"oid": "287067eeed7b7f48ef25ff5ddcd408ee572861c0", "url": "https://github.com/apache/beam/commit/287067eeed7b7f48ef25ff5ddcd408ee572861c0", "message": "Update SupportedZetaSqlBuiltinFunctions and support math functions", "committedDate": "2020-10-27T07:49:18Z", "type": "forcePushed"}]}