{"pr_number": 12505, "pr_title": "[BEAM-8106] Add version to java container image name", "pr_createdAt": "2020-08-07T23:00:33Z", "pr_url": "https://github.com/apache/beam/pull/12505", "timeline": [{"oid": "35ac254cda952071aa2becf06591cd4469aea0ba", "url": "https://github.com/apache/beam/commit/35ac254cda952071aa2becf06591cd4469aea0ba", "message": "use javaVersion argument to version Java container image", "committedDate": "2020-08-07T22:57:28Z", "type": "forcePushed"}, {"oid": "2c28eff493ab8d624ab1836ae84545dceb3dcd10", "url": "https://github.com/apache/beam/commit/2c28eff493ab8d624ab1836ae84545dceb3dcd10", "message": "rename java -> java8 in publish script", "committedDate": "2020-08-07T22:57:28Z", "type": "forcePushed"}, {"oid": "1c46a53229ff774529bca26598327a4e9ca51e50", "url": "https://github.com/apache/beam/commit/1c46a53229ff774529bca26598327a4e9ca51e50", "message": "rename java -> java8 in publish script", "committedDate": "2020-09-01T06:40:24Z", "type": "forcePushed"}, {"oid": "6595512941db96bb32024c96c1a88f5fc40ffe5f", "url": "https://github.com/apache/beam/commit/6595512941db96bb32024c96c1a88f5fc40ffe5f", "message": "use imageJavaVersion argument to Java Dockerfile and images", "committedDate": "2020-09-14T00:37:15Z", "type": "forcePushed"}, {"oid": "46f5df487e9759e5e38ad5ce14250f1084f00460", "url": "https://github.com/apache/beam/commit/46f5df487e9759e5e38ad5ce14250f1084f00460", "message": "add java_version arg for building Java harness container", "committedDate": "2020-09-14T01:43:28Z", "type": "forcePushed"}, {"oid": "48c1242ff51d11d68e2d070b19d6e112de96c554", "url": "https://github.com/apache/beam/commit/48c1242ff51d11d68e2d070b19d6e112de96c554", "message": "docs changes", "committedDate": "2020-09-14T22:41:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5ODkyNQ==", "url": "https://github.com/apache/beam/pull/12505#discussion_r488798925", "bodyText": "nit: could you make this an exact check for 8 and 11 and throw an exception for other (unsupported) versions", "author": "TheNeuralBit", "createdAt": "2020-09-15T16:23:47Z", "path": "runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/Environments.java", "diffHunk": "@@ -357,4 +354,14 @@ private static File zipDirectory(File directory) throws IOException {\n       return env;\n     }\n   }\n+\n+  private static String getDefaultJavaSdkHarnessContainerUrl() {\n+    String javaVersionId =\n+        Float.parseFloat(System.getProperty(\"java.specification.version\")) >= 9 ? \"java11\" : \"java8\";", "originalCommit": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA5Mjc0MA==", "url": "https://github.com/apache/beam/pull/12505#discussion_r489092740", "bodyText": "I went ahead and added an Enum to Environments, and removed similar checks in DataflowRunner", "author": "emilymye", "createdAt": "2020-09-16T00:33:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5ODkyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwNDk3OQ==", "url": "https://github.com/apache/beam/pull/12505#discussion_r488804979", "bodyText": "typo here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            apache/beam_java_8sdk              latest              16ca619d489e        2 weeks ago        550MB\n          \n          \n            \n            apache/beam_java8_sdk              latest              16ca619d489e        2 weeks ago        550MB\n          \n      \n    \n    \n  \n\nI'm assuming this change and the others like it are the result of a search to find and update all the references to beam_java_sdk, so we don't need to worry about there being other references?", "author": "TheNeuralBit", "createdAt": "2020-09-15T16:33:38Z", "path": "website/www/site/content/en/documentation/runtime/environments.md", "diffHunk": "@@ -116,8 +116,8 @@ By default, no licenses/notices are added to the docker images.\n \n To examine the containers that you built, run `docker images` from anywhere in the command line. If you successfully built all of the container images, the command prints a table like the following:\n ```\n-REPOSITORY                          TAG                 IMAGE ID            CREATED           SIZE\n-apache/beam_java_sdk               latest              16ca619d489e        2 weeks ago        550MB\n+REPOSITORY                         TAG                 IMAGE ID            CREATED           SIZE\n+apache/beam_java_8sdk              latest              16ca619d489e        2 weeks ago        550MB", "originalCommit": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgxODgyNQ==", "url": "https://github.com/apache/beam/pull/12505#discussion_r488818825", "bodyText": "Let's make sure that the correct container name is set in the environment send to the remote SDKs that use Java transforms as cross-language transforms. (We don't have integration tests setup for this by we can just try existing Kafka/SQL x-lang examples to confirm)\nhttps://github.com/apache/beam/tree/master/sdks/python/apache_beam/examples/kafkataxi\nhttps://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/sql_taxi.py", "author": "chamikaramj", "createdAt": "2020-09-15T16:56:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwNDk3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwNDIwMg==", "url": "https://github.com/apache/beam/pull/12505#discussion_r489604202", "bodyText": "We should make sure the references to beam_java_sdk are updated in those examples too", "author": "TheNeuralBit", "createdAt": "2020-09-16T17:28:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwNDk3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyMjg0Mg==", "url": "https://github.com/apache/beam/pull/12505#discussion_r489622842", "bodyText": "Weird! I don't know why they didn't show up in my initial ctrl-f", "author": "emilymye", "createdAt": "2020-09-16T18:01:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwNDk3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyNDMwNg==", "url": "https://github.com/apache/beam/pull/12505#discussion_r489624306", "bodyText": "I bet it was a race condition, those examples were added in just the last couple of months", "author": "TheNeuralBit", "createdAt": "2020-09-16T18:04:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwNDk3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTg4NzY3OQ==", "url": "https://github.com/apache/beam/pull/12505#discussion_r489887679", "bodyText": "I went ahead and ran the Kafka example \"from local Beam repo\" without specifying the --sdk_harness_container_image_overrides to see if we should pass the correct URL, which it seems to do (based on the worker container manifest):\n{\n      \"args\": [ ... ],\n      \"image\": \"apache/beam_java8_sdk:2.25.0.dev\",\n      \"imagePullPolicy\": \"IfNotPresent\",\n      \"name\": \"sdk-1-0\",\n      \"volumeMounts\": [ {\n        \"mountPath\": \"/var/opt/google\",\n        \"name\": \"persist\"\n},     \n\nDataflow can't actually grab that container because it doesn't exist (on hub.docker.com), so the job itself doesn't work, but it seems to be grabbing the right URL.", "author": "emilymye", "createdAt": "2020-09-17T02:20:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwNDk3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkxOTA0Ng==", "url": "https://github.com/apache/beam/pull/12505#discussion_r489919046", "bodyText": "That looks correct. Thanks.", "author": "chamikaramj", "createdAt": "2020-09-17T03:10:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwNDk3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwOTM0OQ==", "url": "https://github.com/apache/beam/pull/12505#discussion_r488809349", "bodyText": "I'm +1 for just removing this. Looks like it was added in #8053 in order to start running a job for testing Java 11. As long as the jobs that use Java 11 still pass after removing this I think it's fine.\nI don't think users should be referencing this Dockerfile directly, if they're building a Java 11 container at all it should be through the gradle command (and even then we don't support Java 11 so they shouldn't be doing it).", "author": "TheNeuralBit", "createdAt": "2020-09-15T16:40:44Z", "path": "sdks/java/container/Dockerfile-java11", "diffHunk": "@@ -16,6 +16,10 @@\n # limitations under the License.\n ###############################################################################\n \n+##\n+# NOTE: This image is now deprecated.\n+# Use Dockerfile with the appropriate java_version build argument.\n+##", "originalCommit": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgxMDY2NQ==", "url": "https://github.com/apache/beam/pull/12505#discussion_r488810665", "bodyText": "Also the fact that this Dockerfile doesn't copy LICENSE and NOTICE is problematic.", "author": "TheNeuralBit", "createdAt": "2020-09-15T16:42:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwOTM0OQ=="}], "type": "inlineReview"}, {"oid": "00fb54357856ea443eebd691102190189f07b43f", "url": "https://github.com/apache/beam/commit/00fb54357856ea443eebd691102190189f07b43f", "message": "add JavaVersion to Environments", "committedDate": "2020-09-16T00:32:25Z", "type": "forcePushed"}, {"oid": "61e90dfaf3d026db671cae9920c9a7469aeb6a48", "url": "https://github.com/apache/beam/commit/61e90dfaf3d026db671cae9920c9a7469aeb6a48", "message": "remove underscore", "committedDate": "2020-09-16T23:47:03Z", "type": "forcePushed"}, {"oid": "e4ed684d027abe333f20eae70f00b54a9c11ad0a", "url": "https://github.com/apache/beam/commit/e4ed684d027abe333f20eae70f00b54a9c11ad0a", "message": "remove underscore", "committedDate": "2020-09-17T06:26:36Z", "type": "forcePushed"}, {"oid": "023cb28bde318aba4cf9653b8ff833c18585612c", "url": "https://github.com/apache/beam/commit/023cb28bde318aba4cf9653b8ff833c18585612c", "message": "remove underscore", "committedDate": "2020-09-18T23:51:42Z", "type": "forcePushed"}, {"oid": "9fa6ca542aa2b042babbbe522c4314011ad4c6d8", "url": "https://github.com/apache/beam/commit/9fa6ca542aa2b042babbbe522c4314011ad4c6d8", "message": "add java_version arg for building Java harness container", "committedDate": "2020-09-24T23:11:43Z", "type": "commit"}, {"oid": "59bae74531a378f9e6a98ccfa0671795b3e1f3e7", "url": "https://github.com/apache/beam/commit/59bae74531a378f9e6a98ccfa0671795b3e1f3e7", "message": "change default java container name to java8", "committedDate": "2020-09-24T23:14:24Z", "type": "commit"}, {"oid": "205e56a5aed27b32899cf695c19cdbd0dc009fb3", "url": "https://github.com/apache/beam/commit/205e56a5aed27b32899cf695c19cdbd0dc009fb3", "message": "docs changes", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "49d4b6c4ff6305312e0f08d215ebe8f100d87bfb", "url": "https://github.com/apache/beam/commit/49d4b6c4ff6305312e0f08d215ebe8f100d87bfb", "message": "delete Java11 Dockerfile", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "de808a11434510ecfaa63aa3f22d71cf676bae58", "url": "https://github.com/apache/beam/commit/de808a11434510ecfaa63aa3f22d71cf676bae58", "message": "fix typo", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "f2a0f08951b9520cb50a32f3eb62ca6ccb399dbd", "url": "https://github.com/apache/beam/commit/f2a0f08951b9520cb50a32f3eb62ca6ccb399dbd", "message": "add JavaVersion to Environments", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "4ec7a3cef306c6cfdac48ff603287c0a144c8d68", "url": "https://github.com/apache/beam/commit/4ec7a3cef306c6cfdac48ff603287c0a144c8d68", "message": "fix more references in documentation to beam_java_sdk", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "69221f6bff47621c4a650944a2623bbd74c09c9c", "url": "https://github.com/apache/beam/commit/69221f6bff47621c4a650944a2623bbd74c09c9c", "message": "fix names of functions", "committedDate": "2020-09-24T23:14:32Z", "type": "commit"}, {"oid": "d0ec608e846f519a4cbb607e89840381096fafbe", "url": "https://github.com/apache/beam/commit/d0ec608e846f519a4cbb607e89840381096fafbe", "message": "remove underscore", "committedDate": "2020-09-24T23:14:32Z", "type": "commit"}, {"oid": "d0ec608e846f519a4cbb607e89840381096fafbe", "url": "https://github.com/apache/beam/commit/d0ec608e846f519a4cbb607e89840381096fafbe", "message": "remove underscore", "committedDate": "2020-09-24T23:14:32Z", "type": "forcePushed"}]}