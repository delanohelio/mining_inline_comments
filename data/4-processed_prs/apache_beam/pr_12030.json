{"pr_number": 12030, "pr_title": "[BEAM-10270] Disable Pardo test with 200 iterations on Flink", "pr_createdAt": "2020-06-18T11:11:40Z", "pr_url": "https://github.com/apache/beam/pull/12030", "timeline": [{"oid": "3afa1cabb7758842d966da47c013f3c4ae2168eb", "url": "https://github.com/apache/beam/commit/3afa1cabb7758842d966da47c013f3c4ae2168eb", "message": "[BEAM-10270] Disable Pardo test with 200 iterations on Flink\n\nBecause of a possible performance regression, the test executes too long and the Jenkins job is timing out.", "committedDate": "2020-06-18T11:10:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxMjk3MA==", "url": "https://github.com/apache/beam/pull/12030#discussion_r442212970", "bodyText": "@dmvk Since you are the batch expert, do you have any idea about this?", "author": "mxm", "createdAt": "2020-06-18T13:09:55Z", "path": ".test-infra/jenkins/job_LoadTests_ParDo_Flink_Python.groovy", "diffHunk": "@@ -79,29 +79,31 @@ def batchScenarios = { datasetName -> [\n                         environment_type     : 'DOCKER',\n                 ]\n         ],\n-        [\n-                title          : 'ParDo Python Load test: 20M 100 byte records 200 times',\n-                test           : 'apache_beam.testing.load_tests.pardo_test',\n-                runner         : CommonTestProperties.Runner.PORTABLE,\n-                pipelineOptions: [\n-                        job_name             : 'load-tests-python-flink-batch-pardo-2-' + now,\n-                        project              : 'apache-beam-testing',\n-                        publish_to_big_query : true,\n-                        metrics_dataset      : datasetName,\n-                        metrics_table        : 'python_flink_batch_pardo_2',\n-                        influx_measurement   : 'python_batch_pardo_2',\n-                        input_options        : '\\'{' +\n-                                '\"num_records\": 20000000,' +\n-                                '\"key_size\": 10,' +\n-                                '\"value_size\": 90}\\'',\n-                        iterations           : 200,\n-                        number_of_counter_operations: 0,\n-                        number_of_counters   : 0,\n-                        parallelism          : 5,\n-                        job_endpoint         : 'localhost:8099',\n-                        environment_type     : 'DOCKER',\n-                ]\n-        ],\n+// TODO(BEAM-10270): Takes too long time to execute (currently more than 2 hours). Re-enable", "originalCommit": "3afa1cabb7758842d966da47c013f3c4ae2168eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA2MDIxMw==", "url": "https://github.com/apache/beam/pull/12030#discussion_r443060213", "bodyText": "As pointed out in the bug, there was sharp increase in python_dataflow_batch_pardo_2_runtime on May 7: http://metrics.beam.apache.org/d/MOi-kf3Zk/pardo-load-tests?orgId=1&var-processingType=batch&var-sdk=python&from=1584703436990&to=1592475836990&panelId=3&fullscreen\nPerhaps this PR is related? #11558", "author": "udim", "createdAt": "2020-06-19T22:04:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxMjk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA2MDUwMA==", "url": "https://github.com/apache/beam/pull/12030#discussion_r443060500", "bodyText": "Also the comment should say \"more than 4 hours\"", "author": "udim", "createdAt": "2020-06-19T22:06:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxMjk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQxOTM2OQ==", "url": "https://github.com/apache/beam/pull/12030#discussion_r443419369", "bodyText": "It could be related but it doesn't appear that any changes were made to the batch mode.", "author": "mxm", "createdAt": "2020-06-22T09:07:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxMjk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU2OTMyNQ==", "url": "https://github.com/apache/beam/pull/12030#discussion_r443569325", "bodyText": "Also the comment should say \"more than 4 hours\"\n\nFrom https://ci-beam.apache.org/job/beam_LoadTests_Python_ParDo_Flink_Batch/270/console:\n16:21:33 INFO:apache_beam.runners.portability.portable_runner:Job state changed to RUNNING\n19:48:20 Build timed out (after 240 minutes). Marking the build as aborted.\n\nThat gives us slightly more than 3 hours. The rest of time is spent on Pardo test with 10 iterations. I'll change the comment to \"more than 3 hours\"", "author": "kamilwu", "createdAt": "2020-06-22T13:46:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxMjk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYxODY5NA==", "url": "https://github.com/apache/beam/pull/12030#discussion_r443618694", "bodyText": "@mxm Sorry, back from vacation.\nUnfortunatelly I'm not really familiar with the portable runner. I guess that some of the recent  \"legacy\" batch runner changes may have affected the portable runner too, but it's hard to say.\nCan you git bisect to a commit that introduces the regression?", "author": "dmvk", "createdAt": "2020-06-22T14:53:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxMjk3MA=="}], "type": "inlineReview"}, {"oid": "3caae4a6f3baefa285cfecd167df0e07dd52d2b8", "url": "https://github.com/apache/beam/commit/3caae4a6f3baefa285cfecd167df0e07dd52d2b8", "message": "fix: 2 -> 3 hours", "committedDate": "2020-06-22T13:47:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0MjA4OA==", "url": "https://github.com/apache/beam/pull/12030#discussion_r443742088", "bodyText": "Ok to disable for now to allow the remaining tests to run, but we should also investigate what caused the regression.", "author": "mxm", "createdAt": "2020-06-22T18:15:47Z", "path": ".test-infra/jenkins/job_LoadTests_ParDo_Flink_Python.groovy", "diffHunk": "@@ -79,29 +79,31 @@ def batchScenarios = { datasetName -> [\n                         environment_type     : 'DOCKER',\n                 ]\n         ],\n-        [\n-                title          : 'ParDo Python Load test: 20M 100 byte records 200 times',\n-                test           : 'apache_beam.testing.load_tests.pardo_test',\n-                runner         : CommonTestProperties.Runner.PORTABLE,\n-                pipelineOptions: [\n-                        job_name             : 'load-tests-python-flink-batch-pardo-2-' + now,\n-                        project              : 'apache-beam-testing',\n-                        publish_to_big_query : true,\n-                        metrics_dataset      : datasetName,\n-                        metrics_table        : 'python_flink_batch_pardo_2',\n-                        influx_measurement   : 'python_batch_pardo_2',\n-                        input_options        : '\\'{' +\n-                                '\"num_records\": 20000000,' +\n-                                '\"key_size\": 10,' +\n-                                '\"value_size\": 90}\\'',\n-                        iterations           : 200,\n-                        number_of_counter_operations: 0,\n-                        number_of_counters   : 0,\n-                        parallelism          : 5,\n-                        job_endpoint         : 'localhost:8099',\n-                        environment_type     : 'DOCKER',\n-                ]\n-        ],\n+// TODO(BEAM-10270): Takes too long time to execute (currently more than 3 hours). Re-enable\n+// the test after its overhead is reduced.", "originalCommit": "3caae4a6f3baefa285cfecd167df0e07dd52d2b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}