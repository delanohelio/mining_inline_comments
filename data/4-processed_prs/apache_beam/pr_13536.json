{"pr_number": 13536, "pr_title": "[BEAM-11360] Updates Dataflow Python multi-language pipelines to use portable job submission by default", "pr_createdAt": "2020-12-12T01:42:07Z", "pr_url": "https://github.com/apache/beam/pull/13536", "timeline": [{"oid": "22483f62b40118e73225c19a506e2cba4c6a0c4b", "url": "https://github.com/apache/beam/commit/22483f62b40118e73225c19a506e2cba4c6a0c4b", "message": "Updates Dataflow Python multi-language pipelines to use portable job submission by default\n\nAlso cleans up hooks in Python SDK that are not needed when we directly generate Dataflow steps from the Runner API proto.", "committedDate": "2020-12-12T01:47:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk3NzU3Ng==", "url": "https://github.com/apache/beam/pull/13536#discussion_r542977576", "bodyText": "Don't we have to do something with external_transform_finder.contains_external_transforms? (Or is this fully redundant with the statement above?)\n(IMHO, this visitor pattern is a bit error-prone, perhaps it'd be worth a static method on ExternalTransformFinder that does the visiting and returns a boolean.)", "author": "robertwb", "createdAt": "2020-12-15T01:35:11Z", "path": "sdks/python/apache_beam/pipeline.py", "diffHunk": "@@ -509,19 +514,25 @@ def run(self, test_runner_api='AUTO'):\n             self.runner.__class__.__name__ == 'SwitchingDirectRunner' and\n             not self._options.view_as(StandardOptions).streaming)\n \n+        # Multi-language pipelines that contain external pipeline segments may\n+        # not be able to create a Python pipeline object graph. Hence following\n+        # runner API check should be skipped for such pipelines.\n+        external_transform_finder = ExternalTransformFinder()\n+        self.visit(external_transform_finder)", "originalCommit": "0b1ab4b31c7e3a5b9ab81c18505ac9de79689257", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY1OTU3Ng==", "url": "https://github.com/apache/beam/pull/13536#discussion_r543659576", "bodyText": "This was redundant. Updated.\nAlso, updated the visitor class by adding a static method like you mentioned.", "author": "chamikaramj", "createdAt": "2020-12-15T20:21:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk3NzU3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk3Nzk1MQ==", "url": "https://github.com/apache/beam/pull/13536#discussion_r542977951", "bodyText": "Just to check, this implies runner v2, right?", "author": "robertwb", "createdAt": "2020-12-15T01:36:08Z", "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -580,6 +533,11 @@ def run_pipeline(self, pipeline, options):\n       debug_options.add_experiment(\n           'min_cpu_platform=' + worker_options.min_cpu_platform)\n \n+    if pipeline.contains_external_transforms:\n+      # All Dataflow multi-language pipelines use portable job submission by\n+      # default.\n+      debug_options.add_experiment(\"use_portable_job_submission\")", "originalCommit": "0b1ab4b31c7e3a5b9ab81c18505ac9de79689257", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY1OTEzMQ==", "url": "https://github.com/apache/beam/pull/13536#discussion_r543659131", "bodyText": "Yes, updated to also include a Runner v2 check.", "author": "chamikaramj", "createdAt": "2020-12-15T20:20:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk3Nzk1MQ=="}], "type": "inlineReview"}, {"oid": "edf82e7e33528365f92220b491ae96f2461fce08", "url": "https://github.com/apache/beam/commit/edf82e7e33528365f92220b491ae96f2461fce08", "message": "Updates Dataflow Python multi-language pipelines to use portable job submission by default\n\nAlso cleans up hooks in Python SDK that are not needed when we directly generate Dataflow steps from the Runner API proto.", "committedDate": "2020-12-15T02:03:35Z", "type": "commit"}, {"oid": "abb61473886c6715c870beb5efc5abd6dc5129eb", "url": "https://github.com/apache/beam/commit/abb61473886c6715c870beb5efc5abd6dc5129eb", "message": "Fixes yapf.", "committedDate": "2020-12-15T02:03:36Z", "type": "commit"}, {"oid": "eb404ad586367201b8eca1c4cf44beb3aef01347", "url": "https://github.com/apache/beam/commit/eb404ad586367201b8eca1c4cf44beb3aef01347", "message": "Addresses reviewer comments.", "committedDate": "2020-12-15T04:32:39Z", "type": "commit"}, {"oid": "eb404ad586367201b8eca1c4cf44beb3aef01347", "url": "https://github.com/apache/beam/commit/eb404ad586367201b8eca1c4cf44beb3aef01347", "message": "Addresses reviewer comments.", "committedDate": "2020-12-15T04:32:39Z", "type": "forcePushed"}]}