{"pr_number": 10762, "pr_title": "[BEAM-3453] Use project specified in pipeline_options when creating pubsub subscription", "pr_createdAt": "2020-02-04T02:24:41Z", "pr_url": "https://github.com/apache/beam/pull/10762", "timeline": [{"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5", "url": "https://github.com/apache/beam/commit/9e51c971397040564e6ff66e7f1e95c7ee1f02d5", "message": "[BEAM-3453] Use default project when creating pubsub subscription", "committedDate": "2020-02-04T02:21:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ0OTU5MQ==", "url": "https://github.com/apache/beam/pull/10762#discussion_r374449591", "bodyText": "Beam has this pipeline option, project which is generally used to specify project explicitly. Asking user explicitly for resource avoid surprises. Shall we use it. \n  \n    \n      beam/sdks/python/apache_beam/options/pipeline_options.py\n    \n    \n         Line 473\n      in\n      40c2be0\n    \n    \n    \n    \n\n        \n          \n           parser.add_argument('--project',", "author": "angoenka", "createdAt": "2020-02-04T02:45:01Z", "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -499,13 +499,21 @@ def __init__(self, evaluation_context, applied_ptransform,\n     if self.source.id_label:\n       raise NotImplementedError(\n           'DirectRunner: id_label is not supported for PubSub reads')\n+\n+    import google.auth\n+\n+    _, sub_project = google.auth.default()", "originalCommit": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAxMTA3Ng==", "url": "https://github.com/apache/beam/pull/10762#discussion_r375011076", "bodyText": "Done. I'm defaulting to the default project from auth if the project is not specified. Thanks!", "author": "davidyan74", "createdAt": "2020-02-05T01:09:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ0OTU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MDUxOA==", "url": "https://github.com/apache/beam/pull/10762#discussion_r374450518", "bodyText": "We can fall back to topic's project if this fails. This also maintains the current functionality.", "author": "angoenka", "createdAt": "2020-02-04T02:49:16Z", "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -516,7 +524,7 @@ def get_subscription(cls, transform, project, short_topic_name,\n \n     sub_client = pubsub.SubscriberClient()\n     sub_name = sub_client.subscription_path(\n-        project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))\n+        sub_project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))", "originalCommit": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAwMzI2MQ==", "url": "https://github.com/apache/beam/pull/10762#discussion_r375003261", "bodyText": "Falling back to topic's project may make things less predictable, and failure to create the subscription could be transient and could be because of many reasons. The user should be sure which project it will create the subscription under. My take is that using the topic's project was a mistake from the beginning and it should be fixed. But let me know if you have other thoughts.", "author": "davidyan74", "createdAt": "2020-02-05T00:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MDUxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1NzE5Mg==", "url": "https://github.com/apache/beam/pull/10762#discussion_r375057192", "bodyText": "I think changing that would be a backward incompatible change and might break users. We can keep the existing behavior in place, and add a warning along the lines of this is wrong/deprecated/would change in the future.", "author": "aaltay", "createdAt": "2020-02-05T04:46:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MDUxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3OTAxMA==", "url": "https://github.com/apache/beam/pull/10762#discussion_r375579010", "bodyText": "According to our offline discussion, I've removed the code that gets the project from google.auth and we now only rely on the project specified in pipeline_options. PTAL again. Thanks!", "author": "davidyan74", "createdAt": "2020-02-06T00:11:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MDUxOA=="}], "type": "inlineReview"}, {"oid": "cdcc8b893acf31748946ca357e2a3f4fac79b5ec", "url": "https://github.com/apache/beam/commit/cdcc8b893acf31748946ca357e2a3f4fac79b5ec", "message": "Use pipeline_options to get the project information first, then the default project from auth, then from the topic", "committedDate": "2020-02-05T01:08:24Z", "type": "commit"}, {"oid": "e022e816ed55522a893ccc7d66dbef252a6443f2", "url": "https://github.com/apache/beam/commit/e022e816ed55522a893ccc7d66dbef252a6443f2", "message": "Merge branch 'master' of https://github.com/apache/beam into BEAM-3453", "committedDate": "2020-02-06T00:03:57Z", "type": "commit"}, {"oid": "f78dd7d507cf3e6ffb60698a40b1f2b657665a61", "url": "https://github.com/apache/beam/commit/f78dd7d507cf3e6ffb60698a40b1f2b657665a61", "message": "Removed the code that gets the project from google.auth. Added an entry about the change in CHANGES.md since it's potentially backward incompatible.", "committedDate": "2020-02-06T00:10:27Z", "type": "commit"}, {"oid": "15ce9584c0a10380c599d57f77065c700b20dc9d", "url": "https://github.com/apache/beam/commit/15ce9584c0a10380c599d57f77065c700b20dc9d", "message": "lint", "committedDate": "2020-02-06T02:07:09Z", "type": "commit"}, {"oid": "820d1b16a9e0ea4c8c0bbdb10a7eabe5346d7253", "url": "https://github.com/apache/beam/commit/820d1b16a9e0ea4c8c0bbdb10a7eabe5346d7253", "message": "Merge branch 'master' of https://github.com/apache/beam into BEAM-3453", "committedDate": "2020-02-06T19:03:57Z", "type": "commit"}, {"oid": "95f239390601986495de2a27e57309c9910b2760", "url": "https://github.com/apache/beam/commit/95f239390601986495de2a27e57309c9910b2760", "message": "yapf formatting", "committedDate": "2020-02-06T19:10:04Z", "type": "commit"}]}