{"pr_number": 12444, "pr_title": "[BEAM-10771] Added a whitespace lint as part of python lint precommit", "pr_createdAt": "2020-08-01T00:20:08Z", "pr_url": "https://github.com/apache/beam/pull/12444", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg5NjM4MQ==", "url": "https://github.com/apache/beam/pull/12444#discussion_r463896381", "bodyText": "a bit strange to apply this only when there is a python change. md files could be anywhere in the repo.", "author": "aaltay", "createdAt": "2020-08-01T00:30:38Z", "path": "sdks/python/scripts/run_pylint.sh", "diffHunk": "@@ -37,6 +37,11 @@ fi\n set -o errexit\n set -o pipefail\n \n+# Check for trailing spaces in non-Python text files.\n+echo \"Running whitespacelint...\"\n+MARKDOWN=$(find apache_beam -name '*.md' -print0)", "originalCommit": "832a43815dcedfd556e829649ad1d19a3b6776d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkwNTI5NA==", "url": "https://github.com/apache/beam/pull/12444#discussion_r463905294", "bodyText": "Yes, it makes sense to put it at the root.\nI've made a new task to run the tool in a python virtual env, but for all files.\nIt'll be triggered if there are markdown files or build.gradle files changed.", "author": "KevinGG", "createdAt": "2020-08-01T01:45:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg5NjM4MQ=="}], "type": "inlineReview"}, {"oid": "5b08fe905871f87b4d6e998258bbad83fea9c69a", "url": "https://github.com/apache/beam/commit/5b08fe905871f87b4d6e998258bbad83fea9c69a", "message": "Added :whitespacePreCommit task and job_PreCommit_Whitespace to jenkins.", "committedDate": "2020-08-01T01:52:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3MjkwMw==", "url": "https://github.com/apache/beam/pull/12444#discussion_r464672903", "bodyText": "Is it possible to limit the trigger pattern to *.md and build.gradle files only? (The task is checking only for those files anyway.)", "author": "aaltay", "createdAt": "2020-08-03T21:30:57Z", "path": ".test-infra/jenkins/job_PreCommit_Whitespace.groovy", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import PrecommitJobBuilder\n+\n+PrecommitJobBuilder builder = new PrecommitJobBuilder(\n+    scope: this,\n+    nameBase: 'Whitespace',\n+    gradleTask: ':whitespacePreCommit',\n+    triggerPathPatterns: ['^sdks/.*$'])", "originalCommit": "166a6fd2733cbaee1e15d4aefde327491677e60d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIyNTI4Ng==", "url": "https://github.com/apache/beam/pull/12444#discussion_r465225286", "bodyText": "R: @damgad\nHi Damian, sorry to bother you on this PR. Tyson told me you might be able to give some advice on this topic: does this regex look fine to you and could we test it before merging it? Thanks!", "author": "KevinGG", "createdAt": "2020-08-04T17:49:54Z", "path": ".test-infra/jenkins/job_PreCommit_Whitespace.groovy", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import PrecommitJobBuilder\n+\n+PrecommitJobBuilder builder = new PrecommitJobBuilder(\n+    scope: this,\n+    nameBase: 'Whitespace',\n+    gradleTask: ':whitespacePreCommit',\n+    triggerPathPatterns: [\n+      '.*\\\\.md$',\n+      '.*build\\\\.gradle$',\n+    ]", "originalCommit": "ea3b105cce8b1250384dbb00a70bc79a57cb3b61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY3NDAyNQ==", "url": "https://github.com/apache/beam/pull/12444#discussion_r465674025", "bodyText": "Hey, no worries. The regex looks fine, and I've also checked that it works. FYI: by running the seed job from the PR you can see your changes in action on Jenkins. However (practically) only committers could trigger that.", "author": "damgad", "createdAt": "2020-08-05T11:58:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIyNTI4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg4NTI5NQ==", "url": "https://github.com/apache/beam/pull/12444#discussion_r468885295", "bodyText": "Thanks, this is really helpful information!", "author": "KevinGG", "createdAt": "2020-08-11T21:51:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIyNTI4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY0NDA2Nw==", "url": "https://github.com/apache/beam/pull/12444#discussion_r465644067", "bodyText": "I suggest whitespacelint \"$FILE\" to correctly handle whitespaces and prevent globbing.", "author": "damgad", "createdAt": "2020-08-05T11:00:45Z", "path": "sdks/python/scripts/run_whitespacelint.sh", "diffHunk": "@@ -0,0 +1,32 @@\n+#!/bin/bash\n+#\n+#    Licensed to the Apache Software Foundation (ASF) under one or more\n+#    contributor license agreements.  See the NOTICE file distributed with\n+#    this work for additional information regarding copyright ownership.\n+#    The ASF licenses this file to You under the Apache License, Version 2.0\n+#    (the \"License\"); you may not use this file except in compliance with\n+#    the License.  You may obtain a copy of the License at\n+#\n+#       http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#    Unless required by applicable law or agreed to in writing, software\n+#    distributed under the License is distributed on an \"AS IS\" BASIS,\n+#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+#    See the License for the specific language governing permissions and\n+#    limitations under the License.\n+#\n+\n+set -o errexit\n+\n+pushd ../../\n+\n+# Check for trailing spaces in non-code text files.\n+# Currently include markdown files and gradle build files.\n+echo \"Running whitespacelint...\"\n+FILES=$(find .  \\( -name '*.md' -o -name 'build.gradle' \\))\n+for FILE in $FILES\n+do\n+  whitespacelint $FILE", "originalCommit": "ea3b105cce8b1250384dbb00a70bc79a57cb3b61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg4MTY3NQ==", "url": "https://github.com/apache/beam/pull/12444#discussion_r468881675", "bodyText": "Thanks, changing it.", "author": "KevinGG", "createdAt": "2020-08-11T21:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY0NDA2Nw=="}], "type": "inlineReview"}, {"oid": "c4944699380479be7194c70049727fbc49cdbb60", "url": "https://github.com/apache/beam/commit/c4944699380479be7194c70049727fbc49cdbb60", "message": "Removed trailing whitespaces from all markdown and gradle build files.", "committedDate": "2020-08-14T22:21:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgzNTczNQ==", "url": "https://github.com/apache/beam/pull/12444#discussion_r471835735", "bodyText": "did you find that you needed the mustRunAfter rules even though you also had the dependsOn rules?", "author": "pabloem", "createdAt": "2020-08-17T23:51:38Z", "path": "sdks/python/test-suites/tox/py38/build.gradle", "diffHunk": "@@ -33,3 +33,27 @@ apply from: \"../common.gradle\"\n \n // TODO(BEAM-8954): Remove this once tox uses isolated builds.\n testPy38Cython.mustRunAfter testPython38, testPy38CloudCoverage\n+\n+toxTask \"whitespacelint\", \"whitespacelint\"\n+\n+task archiveFilesToLint(type: Zip) {\n+  archiveFileName = \"files-to-whitespacelint.zip\"\n+  destinationDirectory = file(\"$buildDir/dist\")\n+\n+  from (\"$rootProject.projectDir\") {\n+    include \"**/*.md\"\n+    include \"**/build.gradle\"\n+  }\n+}\n+\n+task unpackFilesToLint(type: Copy) {\n+  from zipTree(\"$buildDir/dist/files-to-whitespacelint.zip\")\n+  into \"$buildDir/files-to-whitespacelint\"\n+}\n+\n+whitespacelint.dependsOn archiveFilesToLint, unpackFilesToLint\n+unpackFilesToLint.dependsOn archiveFilesToLint\n+archiveFilesToLint.dependsOn cleanPython\n+archiveFilesToLint.mustRunAfter cleanPython\n+unpackFilesToLint.mustRunAfter cleanPython, archiveFilesToLint", "originalCommit": "135890c38725ff88d300bca7e9d6db4f2a67ad4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIxMTQ1Mg==", "url": "https://github.com/apache/beam/pull/12444#discussion_r474211452", "bodyText": "Removed the mustRunAfter statements.", "author": "KevinGG", "createdAt": "2020-08-20T19:13:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgzNTczNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgzNjE2Mw==", "url": "https://github.com/apache/beam/pull/12444#discussion_r471836163", "bodyText": "Can you add mention of this job in .test-infra/jenkins/README.md? probably also in the PR template tables, please", "author": "pabloem", "createdAt": "2020-08-17T23:53:18Z", "path": ".test-infra/jenkins/job_PreCommit_Whitespace.groovy", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import PrecommitJobBuilder\n+\n+PrecommitJobBuilder builder = new PrecommitJobBuilder(", "originalCommit": "135890c38725ff88d300bca7e9d6db4f2a67ad4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIxMDg4OQ==", "url": "https://github.com/apache/beam/pull/12444#discussion_r474210889", "bodyText": "Added the item", "author": "KevinGG", "createdAt": "2020-08-20T19:12:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgzNjE2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgzNjM1NA==", "url": "https://github.com/apache/beam/pull/12444#discussion_r471836354", "bodyText": "Can you document in this file which groups of files are meant to be linted by this test?", "author": "pabloem", "createdAt": "2020-08-17T23:54:00Z", "path": "sdks/python/scripts/run_whitespacelint.sh", "diffHunk": "@@ -0,0 +1,56 @@\n+#!/bin/bash\n+#\n+#    Licensed to the Apache Software Foundation (ASF) under one or more\n+#    contributor license agreements.  See the NOTICE file distributed with\n+#    this work for additional information regarding copyright ownership.\n+#    The ASF licenses this file to You under the Apache License, Version 2.0\n+#    (the \"License\"); you may not use this file except in compliance with\n+#    the License.  You may obtain a copy of the License at\n+#\n+#       http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#    Unless required by applicable law or agreed to in writing, software\n+#    distributed under the License is distributed on an \"AS IS\" BASIS,\n+#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+#    See the License for the specific language governing permissions and\n+#    limitations under the License.\n+#\n+\n+set -e", "originalCommit": "135890c38725ff88d300bca7e9d6db4f2a67ad4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIxMDk4MQ==", "url": "https://github.com/apache/beam/pull/12444#discussion_r474210981", "bodyText": "Documented.", "author": "KevinGG", "createdAt": "2020-08-20T19:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgzNjM1NA=="}], "type": "inlineReview"}, {"oid": "cdc6778709615bbdb9206406a8ee2778a3b4263f", "url": "https://github.com/apache/beam/commit/cdc6778709615bbdb9206406a8ee2778a3b4263f", "message": "Added a whitespace lint precommit job.\n\nIt is triggered on changes of any markdown or gradle build file in the Beam repo.", "committedDate": "2020-08-20T19:07:09Z", "type": "commit"}, {"oid": "e81c6f457e6b211d7c83a7298d90abed2c26314c", "url": "https://github.com/apache/beam/commit/e81c6f457e6b211d7c83a7298d90abed2c26314c", "message": "Removed trailing whitespaces from all markdown and gradle build files.", "committedDate": "2020-08-20T19:07:09Z", "type": "commit"}, {"oid": "344599e77038ed79757307903389b847ac76881e", "url": "https://github.com/apache/beam/commit/344599e77038ed79757307903389b847ac76881e", "message": "Updated jenkins precommit job README, added comments of what needs to be linted.", "committedDate": "2020-08-20T19:07:09Z", "type": "commit"}, {"oid": "4e573fd41e43c9b0125d3425a18e57998e6582b1", "url": "https://github.com/apache/beam/commit/4e573fd41e43c9b0125d3425a18e57998e6582b1", "message": "Removed trailing whitespaces from HEAD changes", "committedDate": "2020-08-20T19:11:47Z", "type": "commit"}, {"oid": "4e573fd41e43c9b0125d3425a18e57998e6582b1", "url": "https://github.com/apache/beam/commit/4e573fd41e43c9b0125d3425a18e57998e6582b1", "message": "Removed trailing whitespaces from HEAD changes", "committedDate": "2020-08-20T19:11:47Z", "type": "forcePushed"}]}