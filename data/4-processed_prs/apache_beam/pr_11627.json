{"pr_number": 11627, "pr_title": "Fix thread local to be initialized on every thread.", "pr_createdAt": "2020-05-06T23:14:17Z", "pr_url": "https://github.com/apache/beam/pull/11627", "timeline": [{"oid": "6505ea0046b386f9667c25ced9e5af4868b7ba8f", "url": "https://github.com/apache/beam/commit/6505ea0046b386f9667c25ced9e5af4868b7ba8f", "message": "Fix thread local to be initialized on every thread.", "committedDate": "2020-05-06T23:13:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE1NTA5Mw==", "url": "https://github.com/apache/beam/pull/11627#discussion_r421155093", "bodyText": "Additional _BEAM_SERVICES?\nIt seems like creating a subclass of threading.local() would work in this case. Why type also works?", "author": "boyuanzz", "createdAt": "2020-05-06T23:43:51Z", "path": "sdks/python/apache_beam/utils/subprocess_server.py", "diffHunk": "@@ -161,8 +161,9 @@ class JavaJarServer(SubprocessServer):\n   BEAM_GROUP_ID = 'org.apache.beam'\n   JAR_CACHE = os.path.expanduser(\"~/.apache_beam/cache/jars\")\n \n-  _BEAM_SERVICES = threading.local()\n-  _BEAM_SERVICES.replacements = {}\n+  _BEAM_SERVICES = _BEAM_SERVICES = type(", "originalCommit": "6505ea0046b386f9667c25ced9e5af4868b7ba8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE2MDI5Mw==", "url": "https://github.com/apache/beam/pull/11627#discussion_r421160293", "bodyText": "Hmm... not sure how the duplicate got in there.\ntype(...) is actually creating a subclass here.", "author": "robertwb", "createdAt": "2020-05-07T00:00:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE1NTA5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE2MTExMg==", "url": "https://github.com/apache/beam/pull/11627#discussion_r421161112", "bodyText": "Thanks! I'll merge it after all tests pass.", "author": "boyuanzz", "createdAt": "2020-05-07T00:03:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE1NTA5Mw=="}], "type": "inlineReview"}, {"oid": "76fdf60da7ca3722e8f65a38cac95bea4e03439e", "url": "https://github.com/apache/beam/commit/76fdf60da7ca3722e8f65a38cac95bea4e03439e", "message": "un-duplicate _BEAM_SERVICES", "committedDate": "2020-05-06T23:59:38Z", "type": "commit"}]}