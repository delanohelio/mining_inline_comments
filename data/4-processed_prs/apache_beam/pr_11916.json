{"pr_number": 11916, "pr_title": "[BEAM-10189] Add ReadModifyWriteState user state to python sdk", "pr_createdAt": "2020-06-04T00:24:51Z", "pr_url": "https://github.com/apache/beam/pull/11916", "timeline": [{"oid": "30737beeb2306be2740fa83cf2c7b857ee3fb6ab", "url": "https://github.com/apache/beam/commit/30737beeb2306be2740fa83cf2c7b857ee3fb6ab", "message": "[BEAM-10189] Add ValueState user state to python sdk", "committedDate": "2020-06-04T03:39:34Z", "type": "commit"}, {"oid": "30737beeb2306be2740fa83cf2c7b857ee3fb6ab", "url": "https://github.com/apache/beam/commit/30737beeb2306be2740fa83cf2c7b857ee3fb6ab", "message": "[BEAM-10189] Add ValueState user state to python sdk", "committedDate": "2020-06-04T03:39:34Z", "type": "forcePushed"}, {"oid": "357ee1c666b76c669db63abbd017b0f552f124d1", "url": "https://github.com/apache/beam/commit/357ee1c666b76c669db63abbd017b0f552f124d1", "message": "Rename to ReadModifyWriteState", "committedDate": "2020-06-05T00:31:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI5MzYzMg==", "url": "https://github.com/apache/beam/pull/11916#discussion_r438293632", "bodyText": "Should this be renamed as well?", "author": "robertwb", "createdAt": "2020-06-10T17:30:46Z", "path": "sdks/python/apache_beam/runners/direct/direct_userstate.py", "diffHunk": "@@ -25,6 +25,7 @@\n from apache_beam.transforms import userstate\n from apache_beam.transforms.trigger import _ListStateTag\n from apache_beam.transforms.trigger import _SetStateTag\n+from apache_beam.transforms.trigger import _ValueStateTag", "originalCommit": "357ee1c666b76c669db63abbd017b0f552f124d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0MTYwMw==", "url": "https://github.com/apache/beam/pull/11916#discussion_r438941603", "bodyText": "Done.", "author": "y1chi", "createdAt": "2020-06-11T17:12:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI5MzYzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI5NjI4Mw==", "url": "https://github.com/apache/beam/pull/11916#discussion_r438296283", "bodyText": "Maybe to make this a stronger test, also write something at the end of process, and try reading it at the very beginning.", "author": "robertwb", "createdAt": "2020-06-10T17:35:08Z", "path": "sdks/python/apache_beam/transforms/userstate_test.py", "diffHunk": "@@ -452,6 +459,40 @@ def clear_values(self, bag_state=beam.DoFn.StateParam(BAG_STATE)):\n \n     self.assertEqual(['extra'], StatefulDoFnOnDirectRunnerTest.all_records)\n \n+  def test_simple_read_modify_write_stateful_dofn(self):\n+    class SimpleTestReadModifyWriteStatefulDoFn(DoFn):\n+      VALUE_STATE = ReadModifyWriteStateSpec('value', StrUtf8Coder())\n+\n+      def process(self, element, last_element=DoFn.StateParam(VALUE_STATE)):\n+        last_element.write('%s:%s' % element)\n+        yield last_element.read()\n+\n+    with TestPipeline() as p:\n+      (\n+          p | beam.Create([('a', 1), ('b', 3), ('c', 5)])\n+          | beam.ParDo(SimpleTestReadModifyWriteStatefulDoFn())\n+          | beam.ParDo(self.record_dofn()))\n+    self.assertEqual(['a:1', 'b:3', 'c:5'],\n+                     StatefulDoFnOnDirectRunnerTest.all_records)\n+\n+  def test_clearing_read_modify_write_state(self):\n+    class SimpleClearingReadModifyWriteStatefulDoFn(DoFn):\n+      VALUE_STATE = ReadModifyWriteStateSpec('value', VarIntCoder())\n+\n+      def process(self, element, last_element=DoFn.StateParam(VALUE_STATE)):\n+        last_element.write(element[1])", "originalCommit": "357ee1c666b76c669db63abbd017b0f552f124d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0MTY3Nw==", "url": "https://github.com/apache/beam/pull/11916#discussion_r438941677", "bodyText": "Done.", "author": "y1chi", "createdAt": "2020-06-11T17:12:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI5NjI4Mw=="}], "type": "inlineReview"}, {"oid": "705693ab23bd93ad125bc0dd0cc78e0487b287de", "url": "https://github.com/apache/beam/commit/705693ab23bd93ad125bc0dd0cc78e0487b287de", "message": "Rename _ValueStateTag to _ReadModifyWriteStateTag", "committedDate": "2020-06-11T17:10:38Z", "type": "commit"}, {"oid": "9c33339f03e8a281a4e17f9ac9ece8debda98496", "url": "https://github.com/apache/beam/commit/9c33339f03e8a281a4e17f9ac9ece8debda98496", "message": "Use deterministic teststream in tests and minor fix to direct_userstate", "committedDate": "2020-06-19T04:55:20Z", "type": "commit"}, {"oid": "7de9514d62c0367ecd55987d15936c46eae899c5", "url": "https://github.com/apache/beam/commit/7de9514d62c0367ecd55987d15936c46eae899c5", "message": "lint", "committedDate": "2020-06-19T05:32:56Z", "type": "commit"}]}