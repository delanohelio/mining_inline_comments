{"pr_number": 11547, "pr_title": "All Python DirectRunners call setup/teardown on DoFns", "pr_createdAt": "2020-04-28T02:59:08Z", "pr_url": "https://github.com/apache/beam/pull/11547", "timeline": [{"oid": "0b472cd98626d4711e51aceb76ebc09b518c2f5a", "url": "https://github.com/apache/beam/commit/0b472cd98626d4711e51aceb76ebc09b518c2f5a", "message": "All DirectRunners call setup/teardown on DoFns", "committedDate": "2020-04-28T02:58:28Z", "type": "commit"}, {"oid": "0ed8b4277f20acf11b674ef6f39d69bf6aa0356a", "url": "https://github.com/apache/beam/commit/0ed8b4277f20acf11b674ef6f39d69bf6aa0356a", "message": "fix formatter", "committedDate": "2020-04-28T03:15:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjMxMDYyMA==", "url": "https://github.com/apache/beam/pull/11547#discussion_r416310620", "bodyText": "Does the runner re-instantiate the DoFn for each bundle? That is the contract of teardown. The DoFn instance can never be touched again. (I'm mostly trying to learn more about the Python SDK and runners)", "author": "kennknowles", "createdAt": "2020-04-28T04:04:57Z", "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -874,6 +875,7 @@ def process_element(self, element):\n \n   def finish_bundle(self):\n     self.runner.finish()\n+    self.runner.teardown()", "originalCommit": "0ed8b4277f20acf11b674ef6f39d69bf6aa0356a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc2ODUzMA==", "url": "https://github.com/apache/beam/pull/11547#discussion_r416768530", "bodyText": "Yes, it does re-instantiate for each bundle. I remember we had a jira somewhere to re-use dofn instances for more than one bundle, we never implemented that.", "author": "aaltay", "createdAt": "2020-04-28T16:49:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjMxMDYyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc4NDk4Mg==", "url": "https://github.com/apache/beam/pull/11547#discussion_r416784982", "bodyText": "I need to check this, but in Python, generally, we do not reuse Dofns, so they're recreated for each bundle. Let me confirm..", "author": "pabloem", "createdAt": "2020-04-28T17:14:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjMxMDYyMA=="}], "type": "inlineReview"}]}