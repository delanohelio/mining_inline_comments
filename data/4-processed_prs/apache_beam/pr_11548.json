{"pr_number": 11548, "pr_title": "[BEAM-9136] Skip pulling licenses by default.", "pr_createdAt": "2020-04-28T03:41:46Z", "pr_url": "https://github.com/apache/beam/pull/11548", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyMTAwMQ==", "url": "https://github.com/apache/beam/pull/11548#discussion_r416621001", "bodyText": "How about we call both flags 'pull_licenses' and add \"pull_licenses=true\" to project root, with a comment what this flag does, and how to disable it?", "author": "tvalentyn", "createdAt": "2020-04-28T13:39:42Z", "path": "sdks/java/container/build.gradle", "diffHunk": "@@ -101,16 +84,44 @@ docker {\n                   project.rootProject[\"docker-tag\"] : project.sdk_version)\n   dockerfile project.file(\"./${dockerfileName}\")\n   files \"./build/\"\n+  buildArgs(['pull_licenses': !project.rootProject.hasProperty([\"no-licenses\"])])", "originalCommit": "4cfd44caff229b7cc9f9b5740a3d23c98b3c6677", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjczNTM3NQ==", "url": "https://github.com/apache/beam/pull/11548#discussion_r416735375", "bodyText": "Currently, there are three pull licenses options for Java.\nwhen docker-pull-licenses is set, licenses are pulled.\nwhen no-licenses is set, all license pulling related tasks are skipped.\nwhen no tag is passed, which is default mode, license urls are checked.\nWith Python, there are two options available.\nwith no-licenses tag, license pulling is skipped.\nwhen no tag is passed, which is default, licenses are pulled.\nPython doesn't support checking urls at the moment.\nI agree above settings are confuse, and would like to simplify it and make it consistent between docker images.\nSo, we will have only one tag, which is docker-pull-licenses.\nwhen docker-pull-licenses = pull, licenses are pulled.\nwhen docker-pull-licenses = skip, license related tasks are skipped.\nwhen docker-pull-licenses = check, license urls are checked.\nDefault mode is docker-pull-licenses = check both for Java and Python.\nWe need to update the script that pull licenses for Python to support checking urls.\nDoes this sound good?", "author": "Hannah-Jiang", "createdAt": "2020-04-28T16:02:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyMTAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg1NTczNw==", "url": "https://github.com/apache/beam/pull/11548#discussion_r416855737", "bodyText": "Sounds good. Sorry if this was covered in the discussion that I didn't read, but why would we want to check urls but not pull? Feel free to point me to the discussion.\nNaming suggestion:\nlicenses-in-docker-images=add\nlicenses-in-docker-images=skip\nlicenses-in-docker-images=check_urls", "author": "tvalentyn", "createdAt": "2020-04-28T19:08:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyMTAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg3NDEwMQ==", "url": "https://github.com/apache/beam/pull/11548#discussion_r416874101", "bodyText": "In short, users want to create a lightweight images, without adding licenses.\nLightweight images are welcomed for Jenkins test as well, it reduces image size by 85MB for Java image. More discussion can be found at here\nNaming suggestion sounds good to me, thank you.", "author": "Hannah-Jiang", "createdAt": "2020-04-28T19:40:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyMTAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk2MjQ1Mg==", "url": "https://github.com/apache/beam/pull/11548#discussion_r416962452", "bodyText": "Right, so to produce lightweight images we can skip license download. Why would we ever want to 'check' urls but not downloading the licenses? Quoting your comment on the mailing list:\n\nI tried to check if urls are valid instead of pulling the files and it\nreduced only 1 min of running time. So, it's not an option here.", "author": "tvalentyn", "createdAt": "2020-04-28T22:29:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyMTAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk3NTg5Ng==", "url": "https://github.com/apache/beam/pull/11548#discussion_r416975896", "bodyText": "The purpose of checking urls was to make sure files can be pulled from the urls when create images. If we set it to skip, no url checking process happened for the PRs and we may see many license issues when we create release images. Then release managers need to fix the issues. If we add the checking urls for each PR, contributors should fix the issues if any and will not have to fix them during release.", "author": "Hannah-Jiang", "createdAt": "2020-04-28T23:05:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyMTAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk3NjA3NA==", "url": "https://github.com/apache/beam/pull/11548#discussion_r416976074", "bodyText": "There are some more discussion at the thread today, in case you haven't seen it yet.", "author": "Hannah-Jiang", "createdAt": "2020-04-28T23:05:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyMTAwMQ=="}], "type": "inlineReview"}, {"oid": "4fc42159d469942449087a5c38ace8da29c18110", "url": "https://github.com/apache/beam/commit/4fc42159d469942449087a5c38ace8da29c18110", "message": "skip pulling licenses by default", "committedDate": "2020-04-29T04:15:22Z", "type": "forcePushed"}, {"oid": "8ba415b2f3ee240504041f9d7be05d58f1910527", "url": "https://github.com/apache/beam/commit/8ba415b2f3ee240504041f9d7be05d58f1910527", "message": "skip pulling licenses by default", "committedDate": "2020-04-29T05:05:01Z", "type": "commit"}, {"oid": "8ba415b2f3ee240504041f9d7be05d58f1910527", "url": "https://github.com/apache/beam/commit/8ba415b2f3ee240504041f9d7be05d58f1910527", "message": "skip pulling licenses by default", "committedDate": "2020-04-29T05:05:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NDk5Mg==", "url": "https://github.com/apache/beam/pull/11548#discussion_r417654992", "bodyText": "Wording suggestion:\n// Include dependency licences when we build docker images on Jenkins, see: https://s.apache.org/zt68q.", "author": "tvalentyn", "createdAt": "2020-04-29T22:42:06Z", "path": ".test-infra/jenkins/CommonJobProperties.groovy", "diffHunk": "@@ -163,6 +163,10 @@ class CommonJobProperties {\n     // For [BEAM-4847], hardcode Xms and Xmx to reasonable values (2g/4g).\n     context.switches(\"-Dorg.gradle.jvmargs=-Xms2g\")\n     context.switches(\"-Dorg.gradle.jvmargs=-Xmx4g\")\n+\n+    // Add docker-pull-licenses option to all Jenkins test to add licenses to when build docker images.", "originalCommit": "8ba415b2f3ee240504041f9d7be05d58f1910527", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzczNTg0NQ==", "url": "https://github.com/apache/beam/pull/11548#discussion_r417735845", "bodyText": "I will change the comment with different PR, because this PR triggers 10 tests and takes time to run and some tests are flaky.\nFor the comment about detecting isRelease tag, it will also be part of another PR about release.", "author": "Hannah-Jiang", "createdAt": "2020-04-30T03:39:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NDk5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzczOTIxOQ==", "url": "https://github.com/apache/beam/pull/11548#discussion_r417739219", "bodyText": "Do you have other comments? If not, I am going to merge it.", "author": "Hannah-Jiang", "createdAt": "2020-04-30T03:55:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NDk5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE2MDc0Nw==", "url": "https://github.com/apache/beam/pull/11548#discussion_r418160747", "bodyText": "This is my other comment(copying from above, in case you missed it): I suggested on mailing list that we can also pull licences whenever we run build containers on the release branch. If community does not like that option for some reason, then we should also update the release guide in this PR to make sure release manager is aware that they need to pass a non-default option, and check that licenses were added successfully.", "author": "tvalentyn", "createdAt": "2020-04-30T17:08:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NDk5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE3MTg4OA==", "url": "https://github.com/apache/beam/pull/11548#discussion_r418171888", "bodyText": "I saw on the mailing list that you have updated release guide to include the config flags to build images, and will be updating them. You can do those changes in a follow-up pr.\nYou can conisider looking at the value of\n\n  \n    \n      beam/buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy\n    \n    \n         Line 296\n      in\n      74a6565\n    \n    \n    \n    \n\n        \n          \n           return project.hasProperty('isRelease') \n        \n    \n  \n\n\nto determine whether the task is running for release branch, instead of asking release manager to pass a config flag.", "author": "tvalentyn", "createdAt": "2020-04-30T17:27:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NDk5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI0MTA1OQ==", "url": "https://github.com/apache/beam/pull/11548#discussion_r418241059", "bodyText": "yep, rewording and isRelease tag detection for docker image build with be in another PR.", "author": "Hannah-Jiang", "createdAt": "2020-04-30T19:31:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NDk5Mg=="}], "type": "inlineReview"}]}