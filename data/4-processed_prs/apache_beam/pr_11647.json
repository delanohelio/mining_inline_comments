{"pr_number": 11647, "pr_title": "[BEAM-9884] Add options to SqlTransform for specifying planner", "pr_createdAt": "2020-05-08T23:50:39Z", "pr_url": "https://github.com/apache/beam/pull/11647", "timeline": [{"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a", "url": "https://github.com/apache/beam/commit/7198723f94eb05879a45969ddbcb99dcb06d897a", "message": "Add options to SqlTransform for specifying planner", "committedDate": "2020-05-08T23:40:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5MjQxNQ==", "url": "https://github.com/apache/beam/pull/11647#discussion_r423192415", "bodyText": "Can you add some comments here or in class comment so clarify the ordering of getting planner names? E.g. get the class name set in SqlTransform first and the try pipeline options.", "author": "amaliujia", "createdAt": "2020-05-11T17:13:35Z", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -103,6 +105,8 @@\n \n   abstract @Nullable String defaultTableProvider();\n \n+  abstract @Nullable String queryPlannerClassName();", "originalCommit": "7198723f94eb05879a45969ddbcb99dcb06d897a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5MzU2Ng==", "url": "https://github.com/apache/beam/pull/11647#discussion_r423193566", "bodyText": "Can you add a test to show when withQueryPlannerClass(ZetaSQLQueryPlanner.class) is not used and BeamSqlPipelineOptions is set (to test that the ordering of finding the planner name is working).", "author": "amaliujia", "createdAt": "2020-05-11T17:15:23Z", "path": "sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLDialectSpecTest.java", "diffHunk": "@@ -144,6 +145,34 @@ public void testSimpleSelect() {\n     pipeline.run().waitUntilFinish(Duration.standardMinutes(PIPELINE_EXECUTION_WAITTIME_MINUTES));\n   }\n \n+  @Test\n+  public void testSimpleSelectWithPlannerName() {", "originalCommit": "7198723f94eb05879a45969ddbcb99dcb06d897a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDQyOQ==", "url": "https://github.com/apache/beam/pull/11647#discussion_r423194429", "bodyText": "Do you think if it is helpful to find a \"working\" class name, rather than a \"non null\" parameter? (meaning that try first class name even if it is non-null, if there is an exception, try the next one.)", "author": "amaliujia", "createdAt": "2020-05-11T17:16:39Z", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -123,7 +127,9 @@\n     }\n \n     sqlEnvBuilder.setQueryPlannerClassName(\n-        input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName());\n+        MoreObjects.firstNonNull(\n+            queryPlannerClassName(),\n+            input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName()));", "originalCommit": "7198723f94eb05879a45969ddbcb99dcb06d897a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MTc4OQ==", "url": "https://github.com/apache/beam/pull/11647#discussion_r423271789", "bodyText": "Hm.. I think maybe that would be surprising for the user.\nI think it would be better to just try to use a non-working class name and fail, than to fall back to a different planner - since changing the planner has implications on acceptable query syntax.", "author": "TheNeuralBit", "createdAt": "2020-05-11T19:35:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDQyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4OTcyMA==", "url": "https://github.com/apache/beam/pull/11647#discussion_r423289720", "bodyText": "that makes sense", "author": "amaliujia", "createdAt": "2020-05-11T20:09:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDQyOQ=="}], "type": "inlineReview"}, {"oid": "f09e325f47b395652526c44c36ba9e11a0c9a19d", "url": "https://github.com/apache/beam/commit/f09e325f47b395652526c44c36ba9e11a0c9a19d", "message": "Add doc about setting query planner", "committedDate": "2020-05-11T19:42:19Z", "type": "commit"}, {"oid": "16aef378e14e19e144930cedd6775d8b28900b1c", "url": "https://github.com/apache/beam/commit/16aef378e14e19e144930cedd6775d8b28900b1c", "message": "Add test verifying plannerName pipeline option", "committedDate": "2020-05-11T19:43:18Z", "type": "commit"}]}