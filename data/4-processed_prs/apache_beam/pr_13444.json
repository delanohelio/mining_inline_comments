{"pr_number": 13444, "pr_title": "[BEAM-11363] Create `:sdks:java:extensions:ml:integrationTest` target, run in Java PostCommit", "pr_createdAt": "2020-11-30T19:58:46Z", "pr_url": "https://github.com/apache/beam/pull/13444", "timeline": [{"oid": "42df9779199daf146059fd4a6c95c0ea873002a1", "url": "https://github.com/apache/beam/commit/42df9779199daf146059fd4a6c95c0ea873002a1", "message": "creates :sdks:java:extensions:ml:integrationTest target, run in java PostCommit", "committedDate": "2020-11-30T19:55:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ2Njk1Mg==", "url": "https://github.com/apache/beam/pull/13444#discussion_r535466952", "bodyText": "Just want to note that \"UP-TO-DATE\" and \"FROM-CACHE\" are two different Gradle statuses for a task. I presume if it is never up to date it is also never cached...", "author": "kennknowles", "createdAt": "2020-12-03T18:12:13Z", "path": "sdks/java/extensions/ml/build.gradle", "diffHunk": "@@ -44,11 +44,30 @@ dependencies {\n     testRuntimeOnly project(\":runners:google-cloud-dataflow-java\")\n }\n \n-project.test {\n-    def gcpProject = project.findProperty(\"gcpProject\") ?: 'apache-beam-testing'\n-    include \"**/**IT.class\"\n-    def pipelineOptions = [\n-            \"--project=${gcpProject}\"\n-    ]\n-    systemProperty \"beamTestPipelineOptions\", JsonOutput.toJson(pipelineOptions)\n+/**\n+ * These are integration tests with the GCP ML services and the DirectRunner.\n+ */\n+task integrationTest(type: Test) {\n+  group = \"Verification\"\n+  def gcpProject = project.findProperty('gcpProject') ?: 'apache-beam-testing'\n+  def gcpTempRoot = project.findProperty('gcpTempRoot') ?: 'gs://temp-storage-for-end-to-end-tests'\n+  systemProperty \"beamTestPipelineOptions\", JsonOutput.toJson([\n+          \"--runner=DirectRunner\",\n+          \"--project=${gcpProject}\",\n+          \"--tempRoot=${gcpTempRoot}\",\n+  ])\n+\n+  // Disable Gradle cache: these ITs interact with live service that should always be considered \"out of date\"\n+  outputs.upToDateWhen { false }", "originalCommit": "42df9779199daf146059fd4a6c95c0ea873002a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ3MjQ0MA==", "url": "https://github.com/apache/beam/pull/13444#discussion_r535472440", "bodyText": "I copied this from \n  \n    \n      beam/sdks/java/extensions/google-cloud-platform-core/build.gradle\n    \n    \n        Lines 76 to 77\n      in\n      c5d5b9a\n    \n    \n    \n    \n\n        \n          \n           // Disable Gradle cache: these ITs interact with live service that should always be considered \"out of date\" \n        \n\n        \n          \n           outputs.upToDateWhen { false } \n        \n    \n  \n\n\nI can update the comments in both places to be more correct - it sounds like just dropping \"Disable Gradle cache:\" would address it?", "author": "TheNeuralBit", "createdAt": "2020-12-03T18:18:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ2Njk1Mg=="}], "type": "inlineReview"}]}