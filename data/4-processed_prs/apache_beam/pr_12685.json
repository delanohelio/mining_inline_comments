{"pr_number": 12685, "pr_title": "[BEAM-10807] Add scheduled mail with metrics report", "pr_createdAt": "2020-08-26T08:37:44Z", "pr_url": "https://github.com/apache/beam/pull/12685", "timeline": [{"oid": "76e72abd63f4302039ffb87353fb71dee61dee3d", "url": "https://github.com/apache/beam/commit/76e72abd63f4302039ffb87353fb71dee61dee3d", "message": "[BEAM-10807] Add scheduled mail with metrics report", "committedDate": "2020-08-26T08:50:20Z", "type": "forcePushed"}, {"oid": "b6ded484e1100e2e4d24bec01f607a0e9b93ad05", "url": "https://github.com/apache/beam/commit/b6ded484e1100e2e4d24bec01f607a0e9b93ad05", "message": "yapf", "committedDate": "2020-08-27T17:45:50Z", "type": "forcePushed"}, {"oid": "048f7f17b439c00d78e66b7690d10abdfb9da3a4", "url": "https://github.com/apache/beam/commit/048f7f17b439c00d78e66b7690d10abdfb9da3a4", "message": "Custom workspace cleanup", "committedDate": "2020-08-29T08:59:07Z", "type": "forcePushed"}, {"oid": "a04dcd0a0a30764e1419de5e45a1987b517caa02", "url": "https://github.com/apache/beam/commit/a04dcd0a0a30764e1419de5e45a1987b517caa02", "message": "[BEAM-10807] Add scheduled mail with metrics report", "committedDate": "2020-08-31T18:44:36Z", "type": "commit"}, {"oid": "720d79608974b836fc92e885c717023563f059a3", "url": "https://github.com/apache/beam/commit/720d79608974b836fc92e885c717023563f059a3", "message": "yapf", "committedDate": "2020-08-31T18:44:36Z", "type": "commit"}, {"oid": "1d57242cd2ed54f0fccb38590985a72f12fb520a", "url": "https://github.com/apache/beam/commit/1d57242cd2ed54f0fccb38590985a72f12fb520a", "message": "fixup! yapf", "committedDate": "2020-08-31T18:44:36Z", "type": "commit"}, {"oid": "515bdc3c3627ad3d16b724a3247b39c851770250", "url": "https://github.com/apache/beam/commit/515bdc3c3627ad3d16b724a3247b39c851770250", "message": "Custom workspace cleanup", "committedDate": "2020-08-31T18:44:36Z", "type": "commit"}, {"oid": "3350d7fabb45195f7e725f0b2c55b0d88d9579b1", "url": "https://github.com/apache/beam/commit/3350d7fabb45195f7e725f0b2c55b0d88d9579b1", "message": "Update Jenkins README", "committedDate": "2020-08-31T18:44:36Z", "type": "commit"}, {"oid": "14d61d532a4cb303caf472eb5876da393608d2d2", "url": "https://github.com/apache/beam/commit/14d61d532a4cb303caf472eb5876da393608d2d2", "message": "Use tox", "committedDate": "2020-08-31T18:46:05Z", "type": "commit"}, {"oid": "14d61d532a4cb303caf472eb5876da393608d2d2", "url": "https://github.com/apache/beam/commit/14d61d532a4cb303caf472eb5876da393608d2d2", "message": "Use tox", "committedDate": "2020-08-31T18:46:05Z", "type": "forcePushed"}, {"oid": "06de4f6997640670d0fd26f9f0b29cf174c6f106", "url": "https://github.com/apache/beam/commit/06de4f6997640670d0fd26f9f0b29cf174c6f106", "message": "fixup! Use tox", "committedDate": "2020-08-31T18:51:03Z", "type": "commit"}, {"oid": "da4d8cdc029c7c6e88686b69771aa13d0be87b67", "url": "https://github.com/apache/beam/commit/da4d8cdc029c7c6e88686b69771aa13d0be87b67", "message": "fixup! fixup! Use tox", "committedDate": "2020-09-01T08:26:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA1Njk0Mw==", "url": "https://github.com/apache/beam/pull/12685#discussion_r481056943", "bodyText": "A regressions is defined as >=10 % increase in runtime?", "author": "mxm", "createdAt": "2020-09-01T11:06:59Z", "path": ".test-infra/jenkins/metrics_report/templates/Metrics_Report.template", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+<html>\n+<body>\n+\n+<h1>Beam Metrics Report</h1>\n+\n+Color legend:\n+<table>\n+    <tr>\n+        <td style=\"background-color:Red;padding:9px;text-align:center;\">>= 20</td>\n+        <td style=\"background-color:Yellow;padding:9px;text-align:center;\">>= 10</td>\n+        <td style=\"background-color:YellowGreen;padding:9px;text-align:center;\"><= -10</td>\n+        <td style=\"background-color:Green;padding:9px;text-align:center;\"><= -20</td>\n+    </tr>\n+</table>\n+\n+\n+<h2>Possible regression</h2>\n+\n+<table>\n+<tr>\n+    {% for header in headers -%}\n+        <td style=\"border-bottom:1px solid #ddd\"><b>{{ header }}</b></td>\n+    {% endfor %}\n+</tr>\n+\n+{% for row in metrics_data -%}\n+    {% if row[5] >= 10 %}", "originalCommit": "da4d8cdc029c7c6e88686b69771aa13d0be87b67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA3MjA2NQ==", "url": "https://github.com/apache/beam/pull/12685#discussion_r481072065", "bodyText": "Yes. It is related to difference of mean metric values from the last and previous week. Usually it is runtime but it can be read_time or write_time as well.", "author": "TobKed", "createdAt": "2020-09-01T11:37:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA1Njk0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEzNDM0NA==", "url": "https://github.com/apache/beam/pull/12685#discussion_r481134344", "bodyText": "Your report would be generated every time someone builds the whole project (by executing ./gradlew build). I think this is not what we wanted. Could you remove this line?", "author": "kamilwu", "createdAt": "2020-09-01T13:24:28Z", "path": ".test-infra/jenkins/build.gradle", "diffHunk": "@@ -20,3 +20,32 @@ plugins {\n   id 'org.apache.beam.module'\n }\n applyGroovyNature()\n+applyPythonNature()\n+\n+pythonVersion = '3.8'\n+\n+task generateMetricsReport {\n+  dependsOn setupVirtualenv\n+  def metricsReportFilename = \"beam-metrics_report.html\"\n+  def generateMetricsReportDir = \"${rootDir}/.test-infra/jenkins/metrics_report\"\n+  def generateMetricsReportPath = \"${generateMetricsReportDir}/${metricsReportFilename}\"\n+  def toxConfigFilePath = \"${rootDir}/.test-infra/jenkins/metrics_report/tox.ini\"\n+\n+  def influxDb = project.findProperty('influxDb')\n+  def influxHost = project.findProperty('influxHost')\n+  def influxPort = project.findProperty('influxPort')\n+\n+  doLast {\n+    exec {\n+      executable 'sh'\n+      args '-c', \". ${envdir}/bin/activate && tox -e py38-test -c ${toxConfigFilePath}\"\n+    }\n+    exec {\n+      executable 'sh'\n+      args '-c', \". ${envdir}/bin/activate && tox -e py38-generate-report -c ${toxConfigFilePath} -- --influx-db=${influxDb} --influx-host=${influxHost} --influx-port=${influxPort} --output-file=${generateMetricsReportPath}\"\n+    }\n+    logger.info('Create metrics report file {}', generateMetricsReportPath)\n+  }\n+  outputs.file \"${generateMetricsReportPath}\"\n+}\n+build.dependsOn generateMetricsReport", "originalCommit": "da4d8cdc029c7c6e88686b69771aa13d0be87b67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTQ2NQ==", "url": "https://github.com/apache/beam/pull/12685#discussion_r481401465", "bodyText": "Sure. It is removed. Thank you for pointing this out.", "author": "TobKed", "createdAt": "2020-09-01T20:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEzNDM0NA=="}], "type": "inlineReview"}, {"oid": "c33a9c7f9a68e5885d41b596f58222536e1a7ae6", "url": "https://github.com/apache/beam/commit/c33a9c7f9a68e5885d41b596f58222536e1a7ae6", "message": "Remove unwanted build dependency", "committedDate": "2020-09-01T13:43:19Z", "type": "commit"}]}