{"pr_number": 11524, "pr_title": "[BEAM-9815] Correct go integration test if clauses. ", "pr_createdAt": "2020-04-25T20:55:14Z", "pr_url": "https://github.com/apache/beam/pull/11524", "timeline": [{"oid": "1b9973be64cc892c7724bb97b441dd12bd4584e3", "url": "https://github.com/apache/beam/commit/1b9973be64cc892c7724bb97b441dd12bd4584e3", "message": "fixup", "committedDate": "2020-04-25T20:53:13Z", "type": "commit"}, {"oid": "b58282499e1bcdd352cd2e98c067adca7f8ed6ae", "url": "https://github.com/apache/beam/commit/b58282499e1bcdd352cd2e98c067adca7f8ed6ae", "message": "testing container theory", "committedDate": "2020-04-25T21:23:00Z", "type": "commit"}, {"oid": "b85def0aa6a4a85a2a246228dac2856355c33602", "url": "https://github.com/apache/beam/commit/b85def0aa6a4a85a2a246228dac2856355c33602", "message": "assume everything is fine", "committedDate": "2020-04-25T22:00:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk1OTExMA==", "url": "https://github.com/apache/beam/pull/11524#discussion_r415959110", "bodyText": "Shouldn't this be fatal? There isn't a \"default\" worker.", "author": "robertwb", "createdAt": "2020-04-27T16:23:50Z", "path": "sdks/go/container/boot.go", "diffHunk": "@@ -104,7 +104,7 @@ func main() {\n \n \tswitch len(artifacts) {\n \tcase 0:\n-\t\tlog.Fatal(\"No artifacts staged\")\n+\t\tlog.Printf(\"No artifacts staged. Attempting to run default \\\"worker\\\".\")", "originalCommit": "b85def0aa6a4a85a2a246228dac2856355c33602", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2MzgwOA==", "url": "https://github.com/apache/beam/pull/11524#discussion_r415963808", "bodyText": "I can revert this line. It was mostly to explore if the artifacts got copied to the expected location anyway because the model was discovered that way in the first place.", "author": "lostluck", "createdAt": "2020-04-27T16:29:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk1OTExMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2MDEyNw==", "url": "https://github.com/apache/beam/pull/11524#discussion_r415960127", "bodyText": "Isn't it better to avoid double assignment?", "author": "robertwb", "createdAt": "2020-04-27T16:25:10Z", "path": "sdks/go/test/run_integration_tests.sh", "diffHunk": "@@ -102,9 +102,8 @@ case $key in\n esac\n done\n \n-if [[ \"$RUNNER\" != \"universal\" ]]; then\n-  PUSH_CONTAINER_TO_GCR='yes'\n-else\n+PUSH_CONTAINER_TO_GCR='yes'", "originalCommit": "b85def0aa6a4a85a2a246228dac2856355c33602", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk3MDQxOA==", "url": "https://github.com/apache/beam/pull/11524#discussion_r415970418", "bodyText": "Not sure, the root issue seemed to be how the comparison operated though, rather than the assignement. I'll see if I can get the comparison to work properly but otherwise revert this.\nTangent: This is the \"preferred\" way of handling variable cases like this for Go, where the common case for the variable is used by default, and overridden by the special case. (Obviously if calculating the default value is expensive, and the special case is cheap, the calculus changes, since compute has cost.)", "author": "lostluck", "createdAt": "2020-04-27T16:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2MDEyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAwMDAxNw==", "url": "https://github.com/apache/beam/pull/11524#discussion_r416000017", "bodyText": "I'd guess that is because in Go one wants to use the declare-and-define syntax, which wouldn't work inside the if clause. The convention is opposite in Java/Python (where more value is placed on immutability). As for bash, well, I doubt there's any consistency around there... This is fine if you prefer.", "author": "robertwb", "createdAt": "2020-04-27T17:18:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2MDEyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkyMjI3Mw==", "url": "https://github.com/apache/beam/pull/11524#discussion_r416922273", "bodyText": "A fair observation. I ended up with reversing the if clause anyway since the positive check is clearer.", "author": "lostluck", "createdAt": "2020-04-28T21:06:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2MDEyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2MDQzMw==", "url": "https://github.com/apache/beam/pull/11524#discussion_r415960433", "bodyText": "extra space", "author": "robertwb", "createdAt": "2020-04-27T16:25:35Z", "path": "sdks/go/test/run_integration_tests.sh", "diffHunk": "@@ -148,7 +147,7 @@ if [[ PUSH_CONTAINER_TO_GCR == 'yes' ]]; then\n \n   # Push the container\n   gcloud docker -- push $CONTAINER\n-else\n+else ", "originalCommit": "b85def0aa6a4a85a2a246228dac2856355c33602", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2MTMyNw==", "url": "https://github.com/apache/beam/pull/11524#discussion_r415961327", "bodyText": "I used double brackets because that's what was used in the rest of the file. We should be consistent.", "author": "robertwb", "createdAt": "2020-04-27T16:26:42Z", "path": "sdks/go/test/run_integration_tests.sh", "diffHunk": "@@ -118,7 +117,7 @@ test -d sdks/go/test\n command -v docker\n docker -v\n \n-if [[ PUSH_CONTAINER_TO_GCR == 'yes' ]]; then\n+if [ \"$PUSH_CONTAINER_TO_GCR\" = \"yes\" ]; then", "originalCommit": "b85def0aa6a4a85a2a246228dac2856355c33602", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkyMjAwNA==", "url": "https://github.com/apache/beam/pull/11524#discussion_r416922004", "bodyText": "Done", "author": "lostluck", "createdAt": "2020-04-28T21:05:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2MTMyNw=="}], "type": "inlineReview"}, {"oid": "e3b3a828fbfed784334b170991a72fa2f3d9b503", "url": "https://github.com/apache/beam/commit/e3b3a828fbfed784334b170991a72fa2f3d9b503", "message": "Revert boot.go exploration. There's no default copied data.", "committedDate": "2020-04-27T16:39:33Z", "type": "commit"}, {"oid": "9cdcd19d9f71196de359c08c97735e539f872ff2", "url": "https://github.com/apache/beam/commit/9cdcd19d9f71196de359c08c97735e539f872ff2", "message": "!fixup comments", "committedDate": "2020-04-28T21:04:42Z", "type": "commit"}]}