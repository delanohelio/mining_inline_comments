{"pr_number": 13215, "pr_title": "[BEAM-11151] Adds the ToStringFnRunner to Java", "pr_createdAt": "2020-10-29T00:19:13Z", "pr_url": "https://github.com/apache/beam/pull/13215", "timeline": [{"oid": "b2dafd20447b0e5a7206b7b71c42e455964838f8", "url": "https://github.com/apache/beam/commit/b2dafd20447b0e5a7206b7b71c42e455964838f8", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-06T21:24:09Z", "type": "forcePushed"}, {"oid": "88f2aa0d21f1b46032d3ecaf6263250208fa1dd3", "url": "https://github.com/apache/beam/commit/88f2aa0d21f1b46032d3ecaf6263250208fa1dd3", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-06T21:25:50Z", "type": "forcePushed"}, {"oid": "a738ba8b57869d61a6e50c8da487884ed1a89ae2", "url": "https://github.com/apache/beam/commit/a738ba8b57869d61a6e50c8da487884ed1a89ae2", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-06T21:31:15Z", "type": "forcePushed"}, {"oid": "73d76e3996dda54a52e8ffeba061272435668f92", "url": "https://github.com/apache/beam/commit/73d76e3996dda54a52e8ffeba061272435668f92", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-06T21:54:25Z", "type": "forcePushed"}, {"oid": "73c8ed5ff2424fe9c7fc96cf72dea3472a7e74d8", "url": "https://github.com/apache/beam/commit/73c8ed5ff2424fe9c7fc96cf72dea3472a7e74d8", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-06T21:56:48Z", "type": "forcePushed"}, {"oid": "94ca6be258316752735dc34b21d655711c76478c", "url": "https://github.com/apache/beam/commit/94ca6be258316752735dc34b21d655711c76478c", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-06T23:21:57Z", "type": "forcePushed"}, {"oid": "0532cbcb4e190bd8a447db97ac986b47ab61ef5e", "url": "https://github.com/apache/beam/commit/0532cbcb4e190bd8a447db97ac986b47ab61ef5e", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-09T18:52:02Z", "type": "forcePushed"}, {"oid": "693e487c39008425a7ff7122188618ef906b1698", "url": "https://github.com/apache/beam/commit/693e487c39008425a7ff7122188618ef906b1698", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-09T21:43:34Z", "type": "forcePushed"}, {"oid": "f20809fd8ea53e557e74176d2889726528b68080", "url": "https://github.com/apache/beam/commit/f20809fd8ea53e557e74176d2889726528b68080", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-11T19:37:30Z", "type": "commit"}, {"oid": "f20809fd8ea53e557e74176d2889726528b68080", "url": "https://github.com/apache/beam/commit/f20809fd8ea53e557e74176d2889726528b68080", "message": "Add the ToStringFnRunner for Java", "committedDate": "2020-11-11T19:37:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ5MTc4NA==", "url": "https://github.com/apache/beam/pull/13215#discussion_r524491784", "bodyText": "Can you scope this more narrowly, or use  instead?", "author": "robertwb", "createdAt": "2020-11-16T18:42:03Z", "path": "sdks/java/harness/src/main/java/org/apache/beam/fn/harness/ToStringFnRunner.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.fn.harness;\n+\n+import com.google.auto.service.AutoService;\n+import java.util.Map;\n+import org.apache.beam.model.pipeline.v1.RunnerApi.PTransform;\n+import org.apache.beam.runners.core.construction.PTransformTranslation;\n+import org.apache.beam.sdk.function.ThrowingFunction;\n+import org.apache.beam.sdk.values.KV;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * Translates from elements to human-readable string.\n+ *\n+ * <p>Translation function:\n+ *\n+ * <ul>\n+ *   <li>Input: {@code KV<nonce, element>}\n+ *   <li>Output: {@code KV<nonce, string>}\n+ * </ul>\n+ *\n+ * <p>For each element, the human-readable string is returned. The nonce is used by a runner to\n+ * associate each input with its output. The nonce is represented as an opaque set of bytes.\n+ */\n+@SuppressWarnings({", "originalCommit": "f20809fd8ea53e557e74176d2889726528b68080", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ4NjgzOQ==", "url": "https://github.com/apache/beam/pull/13215#discussion_r525486839", "bodyText": "Done, scoped down to the offending method.", "author": "rohdesamuel", "createdAt": "2020-11-17T20:17:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ5MTc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ5Mzk0OA==", "url": "https://github.com/apache/beam/pull/13215#discussion_r524493948", "bodyText": "Rather than assigning a value and then overwriting it, do\nif (v == null) {\nval = \"null\";\n} else {\nval = v.toString();\n}\nYou could also just return \"\" + val or, even better, just use Objects.toString(input.getValue()).", "author": "robertwb", "createdAt": "2020-11-16T18:45:48Z", "path": "sdks/java/harness/src/main/java/org/apache/beam/fn/harness/ToStringFnRunner.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.fn.harness;\n+\n+import com.google.auto.service.AutoService;\n+import java.util.Map;\n+import org.apache.beam.model.pipeline.v1.RunnerApi.PTransform;\n+import org.apache.beam.runners.core.construction.PTransformTranslation;\n+import org.apache.beam.sdk.function.ThrowingFunction;\n+import org.apache.beam.sdk.values.KV;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * Translates from elements to human-readable string.\n+ *\n+ * <p>Translation function:\n+ *\n+ * <ul>\n+ *   <li>Input: {@code KV<nonce, element>}\n+ *   <li>Output: {@code KV<nonce, string>}\n+ * </ul>\n+ *\n+ * <p>For each element, the human-readable string is returned. The nonce is used by a runner to\n+ * associate each input with its output. The nonce is represented as an opaque set of bytes.\n+ */\n+@SuppressWarnings({\n+  \"rawtypes\" // TODO(https://issues.apache.org/jira/browse/BEAM-10556)\n+})\n+public class ToStringFnRunner {\n+  static final String URN = PTransformTranslation.TO_STRING_TRANSFORM_URN;\n+\n+  /**\n+   * A registrar which provides a factory to handle translating elements to a human readable string.\n+   */\n+  @AutoService(PTransformRunnerFactory.Registrar.class)\n+  public static class Registrar implements PTransformRunnerFactory.Registrar {\n+\n+    @Override\n+    public Map<String, PTransformRunnerFactory> getPTransformRunnerFactories() {\n+      return ImmutableMap.of(\n+          URN,\n+          MapFnRunners.forValueMapFnFactory(ToStringFnRunner::createToStringFunctionForPTransform));\n+    }\n+  }\n+\n+  static <T, V> ThrowingFunction<KV<T, V>, KV<T, String>> createToStringFunctionForPTransform(\n+      String ptransformId, PTransform pTransform) {\n+    return (KV<T, V> input) -> {\n+      String val = \"null\";", "originalCommit": "f20809fd8ea53e557e74176d2889726528b68080", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ4Njk0Mw==", "url": "https://github.com/apache/beam/pull/13215#discussion_r525486943", "bodyText": "Done.", "author": "rohdesamuel", "createdAt": "2020-11-17T20:18:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ5Mzk0OA=="}], "type": "inlineReview"}, {"oid": "7da9dbaf488709e75a727ba1e44bd523814a3aaa", "url": "https://github.com/apache/beam/commit/7da9dbaf488709e75a727ba1e44bd523814a3aaa", "message": "Scope warning more narrowly and use Objects.toString", "committedDate": "2020-11-17T20:17:35Z", "type": "commit"}, {"oid": "090acf88acaff7bb06b7e550919e6bbc751b3941", "url": "https://github.com/apache/beam/commit/090acf88acaff7bb06b7e550919e6bbc751b3941", "message": "Run spotlessApply", "committedDate": "2020-11-17T20:21:10Z", "type": "commit"}]}