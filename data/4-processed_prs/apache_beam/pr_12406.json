{"pr_number": 12406, "pr_title": "[BEAM-10591] Fix flaky xlang jdbc test", "pr_createdAt": "2020-07-29T11:29:25Z", "pr_url": "https://github.com/apache/beam/pull/12406", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1NjQ2Mw==", "url": "https://github.com/apache/beam/pull/12406#discussion_r462656463", "bodyText": "Should we log ?", "author": "chamikaramj", "createdAt": "2020-07-29T23:59:55Z", "path": "sdks/python/apache_beam/io/external/xlang_jdbcio_it_test.py", "diffHunk": "@@ -91,7 +90,12 @@ def setUp(self):\n         self.host, self.port, self.database_name)\n \n   def tearDown(self):\n-    self.postgres.stop()\n+    # Sometimes stopping the container raises ReadTimeout. We can ignore it\n+    # here to avoid the test failure.\n+    try:\n+      self.postgres.stop()\n+    except:  # pylint: disable=bare-except", "originalCommit": "84636d1ea00de224e6169c8f8505d53fc69e1604", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3MTM5OQ==", "url": "https://github.com/apache/beam/pull/12406#discussion_r462771399", "bodyText": "Yes, I think so. Done.", "author": "piotr-szuberski", "createdAt": "2020-07-30T06:44:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1NjQ2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1Njk4Mg==", "url": "https://github.com/apache/beam/pull/12406#discussion_r462656982", "bodyText": "Log the error ?", "author": "chamikaramj", "createdAt": "2020-07-30T00:01:39Z", "path": "sdks/python/apache_beam/io/external/xlang_jdbcio_it_test.py", "diffHunk": "@@ -150,6 +154,18 @@ def test_xlang_jdbc_read(self):\n       assert_that(\n           result, equal_to([JdbcReadTestRow(i) for i in range(ROW_COUNT)]))\n \n+  # Creating a container with testcontainers sometimes raises ReadTimeout\n+  # error. In java there are 2 retries set by default.\n+  def start_postgres_container(self, retries):\n+    for i in range(retries):\n+      try:\n+        self.postgres = PostgresContainer('postgres:12.3')\n+        self.postgres.start()\n+        break\n+      except:  # pylint: disable=bare-except\n+        if i == retries - 1:\n+          raise RuntimeError('Unable to initialize postgres container.')", "originalCommit": "84636d1ea00de224e6169c8f8505d53fc69e1604", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3MjQwNA==", "url": "https://github.com/apache/beam/pull/12406#discussion_r462772404", "bodyText": "I added the log and reraised the primary exception.", "author": "piotr-szuberski", "createdAt": "2020-07-30T06:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1Njk4Mg=="}], "type": "inlineReview"}, {"oid": "3a3005510a854588b6633fff50b0b9023a641843", "url": "https://github.com/apache/beam/commit/3a3005510a854588b6633fff50b0b9023a641843", "message": "[BEAM-10591] Fix flaky jdbc test by adding retries to container creation", "committedDate": "2020-07-30T11:21:48Z", "type": "commit"}, {"oid": "9fc3da38b5ca9680d4b0783f641e18d5b30a32bd", "url": "https://github.com/apache/beam/commit/9fc3da38b5ca9680d4b0783f641e18d5b30a32bd", "message": "Add logging after catching an exception", "committedDate": "2020-07-30T11:21:48Z", "type": "commit"}, {"oid": "9fc3da38b5ca9680d4b0783f641e18d5b30a32bd", "url": "https://github.com/apache/beam/commit/9fc3da38b5ca9680d4b0783f641e18d5b30a32bd", "message": "Add logging after catching an exception", "committedDate": "2020-07-30T11:21:48Z", "type": "forcePushed"}]}