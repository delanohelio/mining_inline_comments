{"pr_number": 11558, "pr_title": "[BEAM-8742] Add stateful and timely processing benchmarks", "pr_createdAt": "2020-04-28T17:46:02Z", "pr_url": "https://github.com/apache/beam/pull/11558", "timeline": [{"oid": "f26b6bd71293641c8ed504a3d545f1c1c3361deb", "url": "https://github.com/apache/beam/commit/f26b6bd71293641c8ed504a3d545f1c1c3361deb", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-28T20:27:03Z", "type": "forcePushed"}, {"oid": "c9f726891cffd72c00a621e5257c687b32b607b1", "url": "https://github.com/apache/beam/commit/c9f726891cffd72c00a621e5257c687b32b607b1", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-28T20:47:39Z", "type": "forcePushed"}, {"oid": "812f2e636bcea551f8853f0a211e342981061436", "url": "https://github.com/apache/beam/commit/812f2e636bcea551f8853f0a211e342981061436", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-29T09:50:13Z", "type": "forcePushed"}, {"oid": "bb8ea86f0744831bede0f3d9c2bf383fff8bd90b", "url": "https://github.com/apache/beam/commit/bb8ea86f0744831bede0f3d9c2bf383fff8bd90b", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-29T12:57:49Z", "type": "forcePushed"}, {"oid": "3aa99a8ddd4c015c83dd9df555b701ed7b21ed1b", "url": "https://github.com/apache/beam/commit/3aa99a8ddd4c015c83dd9df555b701ed7b21ed1b", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-29T13:55:55Z", "type": "forcePushed"}, {"oid": "56f9a83dfc67dffe09d2f2196f747e0b609abb0c", "url": "https://github.com/apache/beam/commit/56f9a83dfc67dffe09d2f2196f747e0b609abb0c", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-29T14:23:31Z", "type": "forcePushed"}, {"oid": "32eef9d42d11a62697152306a1700eda83e68875", "url": "https://github.com/apache/beam/commit/32eef9d42d11a62697152306a1700eda83e68875", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-29T14:47:50Z", "type": "forcePushed"}, {"oid": "b2ebca6f01647448b56f2ad9591902e66b1941ab", "url": "https://github.com/apache/beam/commit/b2ebca6f01647448b56f2ad9591902e66b1941ab", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-30T13:48:10Z", "type": "forcePushed"}, {"oid": "208d6d4e5a4558ba93c75cd8e6fb5d13423a251a", "url": "https://github.com/apache/beam/commit/208d6d4e5a4558ba93c75cd8e6fb5d13423a251a", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-30T14:30:13Z", "type": "forcePushed"}, {"oid": "8743b170349a1e0899ca01e839c78149c85c1960", "url": "https://github.com/apache/beam/commit/8743b170349a1e0899ca01e839c78149c85c1960", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-04-30T15:54:23Z", "type": "forcePushed"}, {"oid": "76bf9d45ba116db304b790245a8c7c95939ca440", "url": "https://github.com/apache/beam/commit/76bf9d45ba116db304b790245a8c7c95939ca440", "message": "Reduce load", "committedDate": "2020-04-30T18:29:05Z", "type": "forcePushed"}, {"oid": "28e25ec46c4f48a4d5b4f93b6e4d639108e04b4b", "url": "https://github.com/apache/beam/commit/28e25ec46c4f48a4d5b4f93b6e4d639108e04b4b", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-05-01T17:22:57Z", "type": "forcePushed"}, {"oid": "b7f306b049adeb04def86b76da7276aa20b3367b", "url": "https://github.com/apache/beam/commit/b7f306b049adeb04def86b76da7276aa20b3367b", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-05-01T17:26:02Z", "type": "forcePushed"}, {"oid": "d33925f2a2ff2b4d6d494d6eb527049ba377fcbb", "url": "https://github.com/apache/beam/commit/d33925f2a2ff2b4d6d494d6eb527049ba377fcbb", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-05-02T13:04:42Z", "type": "forcePushed"}, {"oid": "b6c94594cea30597ef6ab255535d1e8dd47b3a2f", "url": "https://github.com/apache/beam/commit/b6c94594cea30597ef6ab255535d1e8dd47b3a2f", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-05-04T10:57:49Z", "type": "forcePushed"}, {"oid": "4986fa797afc696c09f8c0d1d21d2b68fe92f7e9", "url": "https://github.com/apache/beam/commit/4986fa797afc696c09f8c0d1d21d2b68fe92f7e9", "message": "[BEAM-8742] Enable cron for streaming load test", "committedDate": "2020-05-04T13:34:40Z", "type": "forcePushed"}, {"oid": "2a44d4d46c747e65b749e6c97cd8e9093bfb8bc7", "url": "https://github.com/apache/beam/commit/2a44d4d46c747e65b749e6c97cd8e9093bfb8bc7", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-05-04T13:44:06Z", "type": "forcePushed"}, {"oid": "e9ddfd0aa3fbe4ec355b89f5e052f4c40fc88fed", "url": "https://github.com/apache/beam/commit/e9ddfd0aa3fbe4ec355b89f5e052f4c40fc88fed", "message": "Use the same parameters regardless of whether checkpointing is enabled", "committedDate": "2020-05-05T18:25:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM4OTYyOA==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420389628", "bodyText": "Why multiple trigger phrases?", "author": "tweise", "createdAt": "2020-05-05T20:35:39Z", "path": ".test-infra/jenkins/job_LoadTests_ParDo_Flink_Python.groovy", "diffHunk": "@@ -142,9 +249,22 @@ PhraseTriggeringPostCommitBuilder.postCommitJob(\n   'Load Tests Python ParDo Flink Batch suite',\n   this\n ) {\n-  loadTest(delegate, CommonTestProperties.TriggeringContext.PR)\n+  loadBatchTests(delegate, CommonTestProperties.TriggeringContext.PR)\n+}\n+\n+PhraseTriggeringPostCommitBuilder.postCommitJob(\n+    'beam_LoadTests_Python_ParDo_Flink_Streaming',", "originalCommit": "e9ddfd0aa3fbe4ec355b89f5e052f4c40fc88fed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY1MzE2Ng==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420653166", "bodyText": "There is one for batch and one for streaming. I think that makes sense, a lot of times we want to see the impact on either of those.\nIf you are referring to the args, this is the signature of the postCommitjob:\n  static void postCommitJob(nameBase,\n                            triggerPhrase,\n                            githubUiHint,\n                            scope,\n                            jobDefinition = {}) {", "author": "mxm", "createdAt": "2020-05-06T09:20:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM4OTYyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxMjk1MQ==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420912951", "bodyText": "Makes sense; misunderstanding on my part.", "author": "tweise", "createdAt": "2020-05-06T16:08:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM4OTYyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5MDU5Nw==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420390597", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      + \"shut down, chekpointing is not possible anymore. Shutting down the sources eventually leads to pipeline \"\n          \n          \n            \n                      + \"shut down, checkpointing is not possible anymore. Shutting down the sources eventually leads to pipeline \"", "author": "tweise", "createdAt": "2020-05-05T20:37:36Z", "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkDebugPipelineOptions.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.runners.flink;\n+\n+import org.apache.beam.sdk.options.Default;\n+import org.apache.beam.sdk.options.Description;\n+import org.apache.beam.sdk.options.PipelineOptions;\n+\n+/** Debug options which shouldn't normally be used. */\n+public interface FlinkDebugPipelineOptions extends PipelineOptions {\n+\n+  @Description(\n+      \"If not null, reports the checkpoint duration of each ParDo stage in the provided metric namespace.\")\n+  String getReportCheckpointDuration();\n+\n+  void setReportCheckpointDuration(String metricNamespace);\n+\n+  @Description(\n+      \"Shuts down sources which have been idle for the configured time of milliseconds. Once a source has been \"\n+          + \"shut down, chekpointing is not possible anymore. Shutting down the sources eventually leads to pipeline \"", "originalCommit": "e9ddfd0aa3fbe4ec355b89f5e052f4c40fc88fed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5ODA2Nw==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420398067", "bodyText": "Unless I misread, this parameter is directly tied to !shutdownSourcesOnFinalWatermark? How about consolidating the two? Just a single parameter shutdownSourcesAfterIdleMs should suffice:\n0 - immediate shutdown, which should be default, unless checkpointing is enabled\nvalue > 0 - wait, potentially forever\nThere was a question on the ML recently about shutdownSourcesOnFinalWatermark and if that should not be default. I think it should be (unless checkpointing was enabled), in which case we can never shutdown. So there should be almost no situation where this parameter needs to be set, except in a special case like this.", "author": "tweise", "createdAt": "2020-05-05T20:51:04Z", "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkDebugPipelineOptions.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.runners.flink;\n+\n+import org.apache.beam.sdk.options.Default;\n+import org.apache.beam.sdk.options.Description;\n+import org.apache.beam.sdk.options.PipelineOptions;\n+\n+/** Debug options which shouldn't normally be used. */\n+public interface FlinkDebugPipelineOptions extends PipelineOptions {\n+\n+  @Description(\n+      \"If not null, reports the checkpoint duration of each ParDo stage in the provided metric namespace.\")\n+  String getReportCheckpointDuration();\n+\n+  void setReportCheckpointDuration(String metricNamespace);\n+\n+  @Description(\n+      \"Shuts down sources which have been idle for the configured time of milliseconds. Once a source has been \"\n+          + \"shut down, chekpointing is not possible anymore. Shutting down the sources eventually leads to pipeline \"\n+          + \"shutdown once all input has been processed.\")\n+  @Default.Long(0)\n+  Long getShutdownSourcesAfterIdleMs();", "originalCommit": "e9ddfd0aa3fbe4ec355b89f5e052f4c40fc88fed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY1MzI2OA==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420653268", "bodyText": "That's a good suggestion. I think we can consolidate the two. The drawback is that we would break the existing parameter but if we also change the default that wouldn't be a problem.", "author": "mxm", "createdAt": "2020-05-06T09:20:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5ODA2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg5Nzg0NQ==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420897845", "bodyText": "PTAL @tweise I've unified the flags and made it auto-set the flag when checkpointing is enabled.", "author": "mxm", "createdAt": "2020-05-06T15:48:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5ODA2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5OTA3OQ==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420399079", "bodyText": "Not sure I like the idea of having these as a separate interface that FlinkPipelineOptions extends (!).", "author": "tweise", "createdAt": "2020-05-05T20:52:57Z", "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkDebugPipelineOptions.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.runners.flink;\n+\n+import org.apache.beam.sdk.options.Default;\n+import org.apache.beam.sdk.options.Description;\n+import org.apache.beam.sdk.options.PipelineOptions;\n+\n+/** Debug options which shouldn't normally be used. */\n+public interface FlinkDebugPipelineOptions extends PipelineOptions {", "originalCommit": "e9ddfd0aa3fbe4ec355b89f5e052f4c40fc88fed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY1MzQyNQ==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420653425", "bodyText": "That's how pipeline options work in Beam. Take a look at what else FlinkPipelineOptions extends.\nAt first, I used a separate interface but having multiple interfaces and casting between them (via .as(...)) is not nice either and we need to be careful not to pass the wrong interface.", "author": "mxm", "createdAt": "2020-05-06T09:20:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5OTA3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxNDA4Mw==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420914083", "bodyText": "Agreed. I would prefer we keep all the Flink options in a single interface though. The lone option here strictly isn't a \"debug option\" anyways.", "author": "tweise", "createdAt": "2020-05-06T16:10:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5OTA3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzNDI5Ng==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420934296", "bodyText": "Ok, I suppose we can move the option to FlinkPipelineOptions.", "author": "mxm", "createdAt": "2020-05-06T16:40:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5OTA3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQwMTg1NQ==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420401855", "bodyText": "Wouldn't it be sufficient to rely on Flink 's task-level checkpoint metrics for this?", "author": "tweise", "createdAt": "2020-05-05T20:57:49Z", "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java", "diffHunk": "@@ -455,6 +461,18 @@ public void open() throws Exception {\n     if (!options.getDisableMetrics()) {\n       flinkMetricContainer = new FlinkMetricContainer(getRuntimeContext());\n       doFnRunner = new DoFnRunnerWithMetricsUpdate<>(stepName, doFnRunner, flinkMetricContainer);\n+      String checkpointMetricNamespace =", "originalCommit": "e9ddfd0aa3fbe4ec355b89f5e052f4c40fc88fed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY1NTMyNA==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420655324", "bodyText": "I thought about that. The checkpointing metrics are kept at the JobManager. They are not accessible by the operator. So in order not to change the logic of the load tests which relies on the metrics accumulated during the job, returned in the PipelineResult, I opted to go this route.\nI think we may have to change the Beam service to allow querying job metrics during job runtime. At the moment, we can only retrieve them at the end of the job.", "author": "mxm", "createdAt": "2020-05-06T09:23:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQwMTg1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxNzAwOA==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420917008", "bodyText": "It would be good to expose/utilize the Flink metrics as part of the load test suite. This could, for example, be accomplished with a custom Flink metric reporter. It can be addressed as follow-up though.", "author": "tweise", "createdAt": "2020-05-06T16:15:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQwMTg1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzMjg1NQ==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420932855", "bodyText": "Yes, I agree that we want this to be more generic. I didn't want to mention the Flink metric reporter but I think that would introduce another level of complexity. Not sure if that is the right tool for the job. I'd rather query metrics through the job server and the rest api.", "author": "mxm", "createdAt": "2020-05-06T16:38:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQwMTg1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQxMTgyNw==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420411827", "bodyText": "Nice to see that it is finally possible to achieve this with timers! Should GenerateLoad be reusable?", "author": "tweise", "createdAt": "2020-05-05T21:17:08Z", "path": "sdks/python/apache_beam/testing/load_tests/pardo_test.py", "diffHunk": "@@ -125,6 +155,70 @@ def process(self, element):\n         'Measure time: End' >> beam.ParDo(MeasureTime(self.metrics_namespace)))\n \n \n+class StatefulLoadGenerator(beam.PTransform):", "originalCommit": "e9ddfd0aa3fbe4ec355b89f5e052f4c40fc88fed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY1NzA5Mg==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420657092", "bodyText": "Potentially, yes. The implementation should be changed to use SDF eventually but that is not properly supported yet for Python.", "author": "mxm", "createdAt": "2020-05-06T09:27:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQxMTgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxNTA0MQ==", "url": "https://github.com/apache/beam/pull/11558#discussion_r420915041", "bodyText": "Add link to the Flink checkpointing issue here?", "author": "tweise", "createdAt": "2020-05-06T16:12:03Z", "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkPipelineOptions.java", "diffHunk": "@@ -126,6 +126,16 @@\n \n   void setFailOnCheckpointingErrors(Boolean failOnCheckpointingErrors);\n \n+  @Description(", "originalCommit": "ef2934c373de2c094d288a569bea72579f0a603c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ef1d0bd57f989428bf97b299394ecab39df265fe", "url": "https://github.com/apache/beam/commit/ef1d0bd57f989428bf97b299394ecab39df265fe", "message": "fixup! remove FlinkDebugPipelineOptions interface", "committedDate": "2020-05-07T09:49:27Z", "type": "forcePushed"}, {"oid": "675f1852e71517ae0eeb65c4ee94dde3660ec172", "url": "https://github.com/apache/beam/commit/675f1852e71517ae0eeb65c4ee94dde3660ec172", "message": "fixup! remove FlinkDebugPipelineOptions interface", "committedDate": "2020-05-07T09:51:34Z", "type": "forcePushed"}, {"oid": "1a35436df4180a54caed69ea459304b34c3d4884", "url": "https://github.com/apache/beam/commit/1a35436df4180a54caed69ea459304b34c3d4884", "message": "[BEAM-9900] Remove shutdownSourcesOnFinalWatermark flag\n\nThe shutdownSourcesOnFinalWatermark has caused some confusion in the past. It is\ngenerally used for testing pipelines to ensure that the pipeline and the testing\ncluster shuts down at the end of the job. Without it, the pipeline will run\nforever in streaming mode, regardless of whether the input is finite or not.\n\nWe didn't want to enable the flag by default because shutting down any operators\nincluding sources in Flink will prevent checkpointing from working. If we have\nside input, for example, that may be the case even for long-running\npipelines. However, we can detect whether checkpointing is enabled and set the\nflag automatically.\n\nThe only situation where we may want the flag to be disabled is when users do\nnot have checkpointing enabled but want to take a savepoint. This should be rare\nand users can mitigate by setting the flag to false to prevent operators from\nshutting down.", "committedDate": "2020-05-07T11:51:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5ODIwMg==", "url": "https://github.com/apache/beam/pull/11558#discussion_r421498202", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /** The idle time before we the source shuts down. */\n          \n          \n            \n              /** The idle time before the source shuts down. */", "author": "tweise", "createdAt": "2020-05-07T13:21:25Z", "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/io/UnboundedSourceWrapper.java", "diffHunk": "@@ -91,11 +91,8 @@\n    */\n   private final List<? extends UnboundedSource<OutputT, CheckpointMarkT>> splitSources;\n \n-  /**\n-   * Shuts down the source if the final watermark is read. Note: This prevents further checkpoints\n-   * of the streaming application.\n-   */\n-  private final boolean shutdownOnFinalWatermark;\n+  /** The idle time before we the source shuts down. */", "originalCommit": "1a35436df4180a54caed69ea459304b34c3d4884", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bef40cc02231945bf345065e0fb0703d42fce86c", "url": "https://github.com/apache/beam/commit/bef40cc02231945bf345065e0fb0703d42fce86c", "message": "[BEAM-8742] Add stateful and timely processing benchmarks\n\nThis contains two new benchmarks which both execute in streaming mode:\n\n(1) A benchmark which uses timers and state\n(2) A benchmark which additionally checkpoints and reports checkpointing times", "committedDate": "2020-05-07T14:08:14Z", "type": "commit"}, {"oid": "d106f263e625e5d7c4f3848f16da301871f65142", "url": "https://github.com/apache/beam/commit/d106f263e625e5d7c4f3848f16da301871f65142", "message": "[BEAM-9900] Remove shutdownSourcesOnFinalWatermark flag\n\nThe shutdownSourcesOnFinalWatermark has caused some confusion in the past. It is\ngenerally used for testing pipelines to ensure that the pipeline and the testing\ncluster shuts down at the end of the job. Without it, the pipeline will run\nforever in streaming mode, regardless of whether the input is finite or not.\n\nWe didn't want to enable the flag by default because shutting down any operators\nincluding sources in Flink will prevent checkpointing from working. If we have\nside input, for example, that may be the case even for long-running\npipelines. However, we can detect whether checkpointing is enabled and set the\nflag automatically.\n\nThe only situation where we may want the flag to be disabled is when users do\nnot have checkpointing enabled but want to take a savepoint. This should be rare\nand users can mitigate by setting the flag to false to prevent operators from\nshutting down.", "committedDate": "2020-05-07T14:08:14Z", "type": "commit"}, {"oid": "d106f263e625e5d7c4f3848f16da301871f65142", "url": "https://github.com/apache/beam/commit/d106f263e625e5d7c4f3848f16da301871f65142", "message": "[BEAM-9900] Remove shutdownSourcesOnFinalWatermark flag\n\nThe shutdownSourcesOnFinalWatermark has caused some confusion in the past. It is\ngenerally used for testing pipelines to ensure that the pipeline and the testing\ncluster shuts down at the end of the job. Without it, the pipeline will run\nforever in streaming mode, regardless of whether the input is finite or not.\n\nWe didn't want to enable the flag by default because shutting down any operators\nincluding sources in Flink will prevent checkpointing from working. If we have\nside input, for example, that may be the case even for long-running\npipelines. However, we can detect whether checkpointing is enabled and set the\nflag automatically.\n\nThe only situation where we may want the flag to be disabled is when users do\nnot have checkpointing enabled but want to take a savepoint. This should be rare\nand users can mitigate by setting the flag to false to prevent operators from\nshutting down.", "committedDate": "2020-05-07T14:08:14Z", "type": "forcePushed"}]}