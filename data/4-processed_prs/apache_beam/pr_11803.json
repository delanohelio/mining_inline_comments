{"pr_number": 11803, "pr_title": "[BEAM-9679] Add a CoGroupByKey lesson to the Core Transforms section", "pr_createdAt": "2020-05-24T17:19:41Z", "pr_url": "https://github.com/apache/beam/pull/11803", "timeline": [{"oid": "4b0efc7ce5ff702dec9c6d2dda50d16aa518d96c", "url": "https://github.com/apache/beam/commit/4b0efc7ce5ff702dec9c6d2dda50d16aa518d96c", "message": "Add a CoGroupByKey lesson to the Core Transforms section", "committedDate": "2020-05-24T17:09:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk0OTUyNw==", "url": "https://github.com/apache/beam/pull/11803#discussion_r429949527", "bodyText": "Just realized that the GroupByKey and CoGroupByKey are not using the same Go version as the others. Can we make all of them uniform?", "author": "henryken", "createdAt": "2020-05-25T13:58:44Z", "path": "learning/katas/go/Core Transforms/CoGroupByKey/CoGroupByKey/go.mod", "diffHunk": "@@ -0,0 +1,26 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+module cogroupbykey\n+\n+go 1.14", "originalCommit": "4b0efc7ce5ff702dec9c6d2dda50d16aa518d96c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk1MTIyNQ==", "url": "https://github.com/apache/beam/pull/11803#discussion_r429951225", "bodyText": "Nice trick!", "author": "henryken", "createdAt": "2020-05-25T14:02:04Z", "path": "learning/katas/go/Core Transforms/CoGroupByKey/CoGroupByKey/pkg/task/task.go", "diffHunk": "@@ -0,0 +1,52 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package task\n+\n+import (\n+\t\"fmt\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam\"\n+)\n+\n+func ApplyTransform(s beam.Scope, fruits beam.PCollection, countries beam.PCollection) beam.PCollection {\n+\tfruitsKV := beam.ParDo(s, func(e string) (string, string) {\n+\t\treturn string(e[0]), e\n+\t}, fruits)\n+\n+\tcountriesKV := beam.ParDo(s, func(e string) (string, string) {\n+\t\treturn string(e[0]), e\n+\t}, countries)\n+\n+\tgrouped := beam.CoGroupByKey(s, fruitsKV, countriesKV)\n+\treturn beam.ParDo(s, func(key string, f func(*string) bool, c func(*string) bool, emit func(string)) {\n+\t\tv := &WordsAlphabet{\n+\t\t\tAlphabet: key,\n+\t\t}\n+\t\tf(&v.Fruit)\n+\t\tc(&v.Country)\n+\t\temit(v.String())\n+\t}, grouped)\n+}\n+\n+type WordsAlphabet struct {\n+\tAlphabet string\n+\tFruit string\n+\tCountry string\n+}\n+\n+func (wa *WordsAlphabet) String() string {\n+\treturn fmt.Sprintf(\"WordsAlphabet%+v\", *wa)", "originalCommit": "4b0efc7ce5ff702dec9c6d2dda50d16aa518d96c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2NTYzOQ==", "url": "https://github.com/apache/beam/pull/11803#discussion_r429965639", "bodyText": "I understand the convention of Go that prefers shorter variable name, but I personally find that f and c are cryptic.\nBut if it's well understood, I guess I'm just too old for this :)\nBtw, I like the variable naming in the examples at the top of the godoc.\nhttps://godoc.org/github.com/apache/beam/sdks/go/pkg/beam", "author": "henryken", "createdAt": "2020-05-25T14:31:48Z", "path": "learning/katas/go/Core Transforms/CoGroupByKey/CoGroupByKey/pkg/task/task.go", "diffHunk": "@@ -0,0 +1,52 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package task\n+\n+import (\n+\t\"fmt\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam\"\n+)\n+\n+func ApplyTransform(s beam.Scope, fruits beam.PCollection, countries beam.PCollection) beam.PCollection {\n+\tfruitsKV := beam.ParDo(s, func(e string) (string, string) {\n+\t\treturn string(e[0]), e\n+\t}, fruits)\n+\n+\tcountriesKV := beam.ParDo(s, func(e string) (string, string) {\n+\t\treturn string(e[0]), e\n+\t}, countries)\n+\n+\tgrouped := beam.CoGroupByKey(s, fruitsKV, countriesKV)\n+\treturn beam.ParDo(s, func(key string, f func(*string) bool, c func(*string) bool, emit func(string)) {", "originalCommit": "4b0efc7ce5ff702dec9c6d2dda50d16aa518d96c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3NDk3OQ==", "url": "https://github.com/apache/beam/pull/11803#discussion_r430474979", "bodyText": "I agree with you and realizing for code readability purposes it makes sense.  I created BEAM-10091 when we are all complete with the series of Go SDK katas.  I'd like to perform an overall cleanup for naming consistency and code readability.\nFor now, I will adjust the current CoGroupByKey lesson task for code readability.  Thank you, Henry.", "author": "damondouglas", "createdAt": "2020-05-26T14:53:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2NTYzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUxMjM3Nw==", "url": "https://github.com/apache/beam/pull/11803#discussion_r430512377", "bodyText": "+1 to using unambiguous names here.\nIn this case it's especially important to disambiguate between the iterator parameters (currently f and c) and the emiter parameter since they're both function parameters.\neg, using iter1, iter2 would be better than unrelated single character names. Also +1 to doing a global cleanup instead of immediately back updating everything previously. That said, there's no harm in starting in this PR.", "author": "lostluck", "createdAt": "2020-05-26T15:40:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2NTYzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE2NzAxOA==", "url": "https://github.com/apache/beam/pull/11803#discussion_r431167018", "bodyText": "Thanks for creating the cleanup task!", "author": "henryken", "createdAt": "2020-05-27T14:17:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2NTYzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2NTg0NQ==", "url": "https://github.com/apache/beam/pull/11803#discussion_r429965845", "bodyText": "Why not using wa here so that not to confuse with Value?", "author": "henryken", "createdAt": "2020-05-25T14:32:13Z", "path": "learning/katas/go/Core Transforms/CoGroupByKey/CoGroupByKey/pkg/task/task.go", "diffHunk": "@@ -0,0 +1,52 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package task\n+\n+import (\n+\t\"fmt\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam\"\n+)\n+\n+func ApplyTransform(s beam.Scope, fruits beam.PCollection, countries beam.PCollection) beam.PCollection {\n+\tfruitsKV := beam.ParDo(s, func(e string) (string, string) {\n+\t\treturn string(e[0]), e\n+\t}, fruits)\n+\n+\tcountriesKV := beam.ParDo(s, func(e string) (string, string) {\n+\t\treturn string(e[0]), e\n+\t}, countries)\n+\n+\tgrouped := beam.CoGroupByKey(s, fruitsKV, countriesKV)\n+\treturn beam.ParDo(s, func(key string, f func(*string) bool, c func(*string) bool, emit func(string)) {\n+\t\tv := &WordsAlphabet{", "originalCommit": "4b0efc7ce5ff702dec9c6d2dda50d16aa518d96c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2ODA2OA==", "url": "https://github.com/apache/beam/pull/11803#discussion_r429968068", "bodyText": "Is there any documentation available that explains about this DoFn variation?\nI still couldn't find a good programming guide for the Go version.", "author": "henryken", "createdAt": "2020-05-25T14:36:59Z", "path": "learning/katas/go/Core Transforms/CoGroupByKey/CoGroupByKey/task.md", "diffHunk": "@@ -0,0 +1,104 @@\n+<!--\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+-->\n+\n+# CoGroupByKey\n+\n+CoGroupByKey performs a relational join of two or more key/value PCollections that have the same \n+key type.\n+\n+**Kata:** Implement a [beam.CoGroupByKey](https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#CoGroupByKey) \n+transform that join words by the first alphabetical letter, and then produces the string representation of the \n+WordsAlphabet model.\n+\n+<div class=\"hint\">\n+    Refer to\n+    <a href=\"https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#CoGroupByKey\">beam.CoGroupByKey</a>\n+    to solve this problem.\n+</div>\n+\n+<div class=\"hint\">\n+  Refer to the Beam Programming Guide\n+  <a href=\"https://beam.apache.org/documentation/programming-guide/#cogroupbykey\">\n+    \"CoGroupByKey\"</a> section for more information.\n+</div>\n+\n+<div class=\"hint\">\n+  Think of this problem in three stages.  First, create key/value pairs of PCollections called KV\n+  for fruits and countries, pairing the first character with the word.  Next, apply CoGroupByKey to the KVs\n+  followed by a ParDo.\n+</div>\n+\n+<div class=\"hint\">\n+  In the last lesson we learned how to make key/value PCollections called KV.  Now we have \n+  two to make from fruits and countries.\n+  \n+  To return as a KV, you can return two values from your DoFn. The first return value represents the Key, and \n+  the second return value represents the Value.  An example is shown below.\n+  \n+```\n+func doFn(element string) (string, string) {\n+    key := string(element[0])\n+    value := element\n+    return key, value\n+}\n+``` \n+</div>\n+\n+<div class=\"hint\">\n+  In the last lesson we learned that \n+  <a href=\"https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#GroupByKey\">\n+  beam.GroupByKey</a> takes a single KV.\n+  <a href=\"https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#CoGroupByKey\">beam.CoGroupByKey</a>\n+  takes more than one KV.\n+</div>\n+\n+<div class=\"hint\">\n+  Our final step in this problem requires a\n+  <a href=\"https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#ParDo\">beam.ParDo</a>\n+  with a DoFn that's different than what we've seen in previous lessons.  In the previous step we should\n+  have a PCollection acquired from CoGroupByKey.  A ParDo for that PCollection expects a DoFn that looks\n+  like the following. \n+  \n+  ```\n+  func doFn(key string, aKV func(*string) bool, anotherKV func(*string) bool, emit func(string)){", "originalCommit": "4b0efc7ce5ff702dec9c6d2dda50d16aa518d96c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3ODk4MA==", "url": "https://github.com/apache/beam/pull/11803#discussion_r430478980", "bodyText": "I couldn't find any and solved this through analyzing the error output.  @lostluck if/whenever you have the chance, could you let us know if this is correct?", "author": "damondouglas", "createdAt": "2020-05-26T14:58:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2ODA2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUxNTQ4OQ==", "url": "https://github.com/apache/beam/pull/11803#discussion_r430515489", "bodyText": "GroupByKey by itself does have a single example attached to it, but CoGBK does not, nor does it explain it's relationship to GBK (it's a generalization of GBK that groups multiple PCollection KVs into a CoGBK<K, V1, V2..> )\nThe go docs definitely be improved in this regard.", "author": "lostluck", "createdAt": "2020-05-26T15:44:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2ODA2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUxNjM5NQ==", "url": "https://github.com/apache/beam/pull/11803#discussion_r430516395", "bodyText": "I did write a better guide for the Go SDK last year, but never go around to exporting it from Google internal. It's on my list of things to do before declaring the SDK is no longer experimental.", "author": "lostluck", "createdAt": "2020-05-26T15:45:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2ODA2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2OTc3Mw==", "url": "https://github.com/apache/beam/pull/11803#discussion_r429969773", "bodyText": "If I understand correctly, it seems that func(*string) bool should assign the value of V to the passed-in variable pointer, not the KV?\nBorrowing the concept of the Java version, these functions behave similarly to CoGbkResult.get() based on the sequence of the passed in PCollection?", "author": "henryken", "createdAt": "2020-05-25T14:40:43Z", "path": "learning/katas/go/Core Transforms/CoGroupByKey/CoGroupByKey/task.md", "diffHunk": "@@ -0,0 +1,104 @@\n+<!--\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+-->\n+\n+# CoGroupByKey\n+\n+CoGroupByKey performs a relational join of two or more key/value PCollections that have the same \n+key type.\n+\n+**Kata:** Implement a [beam.CoGroupByKey](https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#CoGroupByKey) \n+transform that join words by the first alphabetical letter, and then produces the string representation of the \n+WordsAlphabet model.\n+\n+<div class=\"hint\">\n+    Refer to\n+    <a href=\"https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#CoGroupByKey\">beam.CoGroupByKey</a>\n+    to solve this problem.\n+</div>\n+\n+<div class=\"hint\">\n+  Refer to the Beam Programming Guide\n+  <a href=\"https://beam.apache.org/documentation/programming-guide/#cogroupbykey\">\n+    \"CoGroupByKey\"</a> section for more information.\n+</div>\n+\n+<div class=\"hint\">\n+  Think of this problem in three stages.  First, create key/value pairs of PCollections called KV\n+  for fruits and countries, pairing the first character with the word.  Next, apply CoGroupByKey to the KVs\n+  followed by a ParDo.\n+</div>\n+\n+<div class=\"hint\">\n+  In the last lesson we learned how to make key/value PCollections called KV.  Now we have \n+  two to make from fruits and countries.\n+  \n+  To return as a KV, you can return two values from your DoFn. The first return value represents the Key, and \n+  the second return value represents the Value.  An example is shown below.\n+  \n+```\n+func doFn(element string) (string, string) {\n+    key := string(element[0])\n+    value := element\n+    return key, value\n+}\n+``` \n+</div>\n+\n+<div class=\"hint\">\n+  In the last lesson we learned that \n+  <a href=\"https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#GroupByKey\">\n+  beam.GroupByKey</a> takes a single KV.\n+  <a href=\"https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#CoGroupByKey\">beam.CoGroupByKey</a>\n+  takes more than one KV.\n+</div>\n+\n+<div class=\"hint\">\n+  Our final step in this problem requires a\n+  <a href=\"https://godoc.org/github.com/apache/beam/sdks/go/pkg/beam#ParDo\">beam.ParDo</a>\n+  with a DoFn that's different than what we've seen in previous lessons.  In the previous step we should\n+  have a PCollection acquired from CoGroupByKey.  A ParDo for that PCollection expects a DoFn that looks\n+  like the following. \n+  \n+  ```\n+  func doFn(key string, aKV func(*string) bool, anotherKV func(*string) bool, emit func(string)){", "originalCommit": "4b0efc7ce5ff702dec9c6d2dda50d16aa518d96c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYzMDk3MA==", "url": "https://github.com/apache/beam/pull/11803#discussion_r430630970", "bodyText": "Yes I believe this is correct.", "author": "damondouglas", "createdAt": "2020-05-26T18:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2OTc3Mw=="}], "type": "inlineReview"}, {"oid": "69b0895e43d156ad02ecc0004c042b8b058e692b", "url": "https://github.com/apache/beam/commit/69b0895e43d156ad02ecc0004c042b8b058e692b", "message": "Update go versions in go.mod", "committedDate": "2020-05-26T14:38:25Z", "type": "commit"}, {"oid": "1ab1a8712297bb4daa3c34339965e9a8a7dc804c", "url": "https://github.com/apache/beam/commit/1ab1a8712297bb4daa3c34339965e9a8a7dc804c", "message": "Rename variables to improve readability", "committedDate": "2020-05-26T18:48:03Z", "type": "commit"}, {"oid": "f54b73f14dee589baf3d9b6e287f8fcc20359020", "url": "https://github.com/apache/beam/commit/f54b73f14dee589baf3d9b6e287f8fcc20359020", "message": "Merge branch 'master' into BEAM-9679-core-transform-cogroupbykey", "committedDate": "2020-05-28T22:21:35Z", "type": "commit"}, {"oid": "3d7ee241f395a41fbff0a1d7da1154f7f6efdf86", "url": "https://github.com/apache/beam/commit/3d7ee241f395a41fbff0a1d7da1154f7f6efdf86", "message": "Update Go SDK stepik course", "committedDate": "2020-05-28T22:34:45Z", "type": "commit"}]}