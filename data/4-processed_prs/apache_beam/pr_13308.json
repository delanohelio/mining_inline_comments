{"pr_number": 13308, "pr_title": "[BEAM-10891] Standardized developer build environment using Docker", "pr_createdAt": "2020-11-11T22:13:00Z", "pr_url": "https://github.com/apache/beam/pull/13308", "timeline": [{"oid": "3a8def06ab69e4187bae453e6b2f1b5a6a612c4d", "url": "https://github.com/apache/beam/commit/3a8def06ab69e4187bae453e6b2f1b5a6a612c4d", "message": "[BEAM-10891] Standardized build environment using Docker", "committedDate": "2020-11-12T09:43:33Z", "type": "forcePushed"}, {"oid": "99e7d3d5b172397df6a5bb541c0d48d1acaa3c8f", "url": "https://github.com/apache/beam/commit/99e7d3d5b172397df6a5bb541c0d48d1acaa3c8f", "message": "[BEAM-10891] Standardized build environment using Docker", "committedDate": "2020-11-12T09:46:00Z", "type": "forcePushed"}, {"oid": "f66285dcdf90b004eef20d5d21e83084155e2fd3", "url": "https://github.com/apache/beam/commit/f66285dcdf90b004eef20d5d21e83084155e2fd3", "message": "[BEAM-10891] Standardized build environment using Docker", "committedDate": "2020-11-12T13:43:54Z", "type": "forcePushed"}, {"oid": "5814f96f7b4bd844ca47f377856402627f1e418c", "url": "https://github.com/apache/beam/commit/5814f96f7b4bd844ca47f377856402627f1e418c", "message": "[BEAM-10891] Standardized build environment using Docker", "committedDate": "2020-11-12T13:48:09Z", "type": "forcePushed"}, {"oid": "50ced866a9f984c1e901c0a0ba2125f34f2e6c4b", "url": "https://github.com/apache/beam/commit/50ced866a9f984c1e901c0a0ba2125f34f2e6c4b", "message": "[BEAM-10891] Standardized build environment using Docker", "committedDate": "2020-11-23T14:25:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQzNDU4OA==", "url": "https://github.com/apache/beam/pull/13308#discussion_r528434588", "bodyText": "I think you can add time to the package installation and will remove the need for this. I did that on my end and it worked!", "author": "omarismail94", "createdAt": "2020-11-23T01:07:32Z", "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,141 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+RUN apt -q update \\\n+    && apt install -y software-properties-common apt-utils apt-transport-https \\\n+    # Repo for different Python versions\n+    && add-apt-repository -y ppa:deadsnakes/ppa \\\n+    && apt-get -q install -y --no-install-recommends \\\n+        ant \\\n+        bats \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        ca-certificates \\\n+        clang \\\n+        cmake \\\n+        curl \\\n+        docker.io \\\n+        doxygen \\\n+        findbugs \\\n+        fuse \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        libbcprov-java \\\n+        libbz2-dev \\\n+        libcurl4-openssl-dev \\\n+        libfuse-dev \\\n+        libprotobuf-dev \\\n+        libprotoc-dev \\\n+        libsasl2-dev \\\n+        libsnappy-dev \\\n+        libssl-dev \\\n+        libtool \\\n+        libzstd-dev \\\n+        locales \\\n+        make \\\n+        maven \\\n+#        openjdk-11-jdk \\\n+        openjdk-8-jdk \\\n+        pinentry-curses \\\n+        pkg-config \\\n+        python \\\n+        python2.7 \\\n+#        python-pip \\\n+        python-pkg-resources \\\n+        python-setuptools \\\n+#        python-wheel \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.5 \\\n+        python3.6 \\\n+        python3.7 \\\n+        python2.7 \\\n+        virtualenv \\\n+        tox \\\n+        rsync \\\n+        shellcheck \\\n+        software-properties-common \\\n+        sudo \\\n+        valgrind \\\n+        vim \\\n+        wget \\\n+        zlib1g-dev \\\n+    && apt-get clean \\\n+    && rm -rf /var/lib/apt/lists/*\n+\n+###\n+# Install grpcio-tools mypy-protobuf for `python3 sdks/python/setup.py sdist` to work\n+###\n+RUN pip3 install grpcio-tools mypy-protobuf\n+\n+###\n+# Install Go\n+###\n+RUN mkdir -p /goroot \\\n+    && curl https://dl.google.com/go/go1.15.2.linux-amd64.tar.gz | tar xvzf - -C /goroot --strip-components=1 \\\n+    && chmod a+rwX -R /goroot\n+\n+# Set environment variables for Go\n+ENV GOROOT /goroot\n+ENV GOPATH /gopath\n+ENV PATH $GOROOT/bin:$GOPATH/bin:$PATH\n+CMD go get github.com/linkedin/goavro\n+\n+###\n+# Miscelaneous fixes...\n+###\n+# Turns out some build tools use 'time' and in this docker image this is no longer\n+# an executable but ONLY an internal command of bash\n+COPY time /usr/bin/time", "originalCommit": "5814f96f7b4bd844ca47f377856402627f1e418c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA0MjE3OQ==", "url": "https://github.com/apache/beam/pull/13308#discussion_r529042179", "bodyText": "Yes, already copied that improvement from your version.", "author": "nielsbasjes", "createdAt": "2020-11-23T22:39:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQzNDU4OA=="}], "type": "inlineReview"}, {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "url": "https://github.com/apache/beam/commit/5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "message": "[BEAM-10891] Standardized build environment using Docker", "committedDate": "2020-11-30T20:39:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5NjQxMw==", "url": "https://github.com/apache/beam/pull/13308#discussion_r532896413", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    python3.5 \\\n          \n          \n            \n                    python3.6 \\\n          \n          \n            \n                    python3.7 \\\n          \n          \n            \n                    python2.7 \\\n          \n          \n            \n                    python3.6 \\\n          \n          \n            \n                    python3.7 \\\n          \n          \n            \n                    python3.8 \\\n          \n      \n    \n    \n  \n\nWe no longer support python 2.7 or 3.5, and we do support 3.8 (looks like this is actually still incorrect in https://beam.apache.org/contribute/#prerequisites, I'll send a PR to fix)", "author": "TheNeuralBit", "createdAt": "2020-11-30T20:53:32Z", "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,110 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.5 \\\n+        python3.6 \\\n+        python3.7 \\\n+        python2.7 \\", "originalCommit": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5ODMwMg==", "url": "https://github.com/apache/beam/pull/13308#discussion_r532898302", "bodyText": "can this be removed?", "author": "TheNeuralBit", "createdAt": "2020-11-30T20:56:55Z", "path": "start-build-env.sh", "diffHunk": "@@ -0,0 +1,131 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+set -e               # exit on error\n+\n+cd \"$(dirname \"$0\")\" # connect to root\n+\n+DOCKER_DIR=dev-support/docker\n+DOCKER_FILE=\"${DOCKER_DIR}/Dockerfile\"\n+\n+CONTAINER_NAME=beam-dev-${USER}-$$\n+\n+#CPU_ARCH=$(echo \"$MACHTYPE\" | cut -d- -f1)\n+#if [ \"$CPU_ARCH\" = \"aarch64\" ]; then\n+#  DOCKER_FILE=\"${DOCKER_DIR}/Dockerfile_aarch64\"\n+#fi", "originalCommit": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE2MDUwNw==", "url": "https://github.com/apache/beam/pull/13308#discussion_r533160507", "bodyText": "Yes, I copied that from the Hadoop one.", "author": "nielsbasjes", "createdAt": "2020-12-01T08:43:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5ODMwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxMzYyOA==", "url": "https://github.com/apache/beam/pull/13308#discussion_r532913628", "bodyText": "Could you add a check that prints a helpful message if docker does not exist?", "author": "TheNeuralBit", "createdAt": "2020-11-30T21:25:32Z", "path": "start-build-env.sh", "diffHunk": "@@ -0,0 +1,131 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+set -e               # exit on error\n+\n+cd \"$(dirname \"$0\")\" # connect to root\n+\n+DOCKER_DIR=dev-support/docker\n+DOCKER_FILE=\"${DOCKER_DIR}/Dockerfile\"\n+\n+CONTAINER_NAME=beam-dev-${USER}-$$\n+\n+#CPU_ARCH=$(echo \"$MACHTYPE\" | cut -d- -f1)\n+#if [ \"$CPU_ARCH\" = \"aarch64\" ]; then\n+#  DOCKER_FILE=\"${DOCKER_DIR}/Dockerfile_aarch64\"\n+#fi\n+\n+docker build -t beam-build -f $DOCKER_FILE $DOCKER_DIR\n+\n+USER_NAME=${SUDO_USER:=$USER}\n+USER_ID=$(id -u \"${USER_NAME}\")\n+\n+if [ \"$(uname -s)\" = \"Darwin\" ]; then\n+  GROUP_ID=100\n+fi\n+\n+if [ \"$(uname -s)\" = \"Linux\" ]; then\n+  GROUP_ID=$(id -g \"${USER_NAME}\")\n+  # man docker-run\n+  # When using SELinux, mounted directories may not be accessible\n+  # to the container. To work around this, with Docker prior to 1.7\n+  # one needs to run the \"chcon -Rt svirt_sandbox_file_t\" command on\n+  # the directories. With Docker 1.7 and later the z mount option\n+  # does this automatically.\n+  if command -v selinuxenabled >/dev/null && selinuxenabled; then\n+    DCKR_VER=$(docker -v|\n+    awk '$1 == \"Docker\" && $2 == \"version\" {split($3,ver,\".\");print ver[1]\".\"ver[2]}')\n+    DCKR_MAJ=${DCKR_VER%.*}\n+    DCKR_MIN=${DCKR_VER#*.}\n+    if [ \"${DCKR_MAJ}\" -eq 1 ] && [ \"${DCKR_MIN}\" -ge 7 ] ||\n+        [ \"${DCKR_MAJ}\" -gt 1 ]; then\n+      V_OPTS=:z\n+    else\n+      for d in \"${PWD}\" \"${HOME}/.m2\"; do\n+        ctx=$(stat --printf='%C' \"$d\"|cut -d':' -f3)\n+        if [ \"$ctx\" != svirt_sandbox_file_t ] && [ \"$ctx\" != container_file_t ]; then\n+          printf 'INFO: SELinux is enabled.\\n'\n+          printf '\\tMounted %s may not be accessible to the container.\\n' \"$d\"\n+          printf 'INFO: If so, on the host, run the following command:\\n'\n+          printf '\\t# chcon -Rt svirt_sandbox_file_t %s\\n' \"$d\"\n+        fi\n+      done\n+    fi\n+  fi\n+fi\n+\n+# Set the home directory in the Docker container.\n+DOCKER_HOME_DIR=${DOCKER_HOME_DIR:-/home/${USER_NAME}}\n+\n+DOCKER_GROUP_ID=$(getent group docker | cut -d':' -f3)\n+\n+docker build -t \"beam-build-${USER_ID}\" - <<UserSpecificDocker\n+FROM beam-build\n+RUN rm -f /var/log/faillog /var/log/lastlog\n+RUN groupadd --non-unique -g ${GROUP_ID} ${USER_NAME}\n+RUN groupmod -g ${DOCKER_GROUP_ID} docker\n+RUN useradd -g ${GROUP_ID} -G docker -u ${USER_ID} -k /root -m ${USER_NAME} -d \"${DOCKER_HOME_DIR}\"\n+RUN echo \"${USER_NAME} ALL=NOPASSWD: ALL\" > \"/etc/sudoers.d/beam-build-${USER_ID}\"\n+ENV HOME \"${DOCKER_HOME_DIR}\"\n+ENV GOPATH ${HOME}/beam/sdks/go/examples/.gogradle/project_gopath\n+\n+# This next command still runs as root causing the ~/.cache/go-build to be owned by root\n+RUN go get github.com/linkedin/goavro\n+RUN chown -R ${USER_NAME}:${GROUP_ID} ${HOME}/.cache\n+UserSpecificDocker\n+\n+echo \"\"\n+echo \"Docker image build completed.\"\n+echo \"==============================================================================================\"\n+echo \"\"\n+\n+# If this env variable is empty, docker will be started\n+# in non interactive mode\n+DOCKER_INTERACTIVE_RUN=${DOCKER_INTERACTIVE_RUN-\"-i -t\"}\n+\n+DOCKER_SOCKET_MOUNT=\"\"\n+if [ -S /var/run/docker.sock ];\n+then\n+  DOCKER_SOCKET_MOUNT=\"-v /var/run/docker.sock:/var/run/docker.sock${V_OPTS:-}\"\n+  echo \"Enabling Docker support with the docker build environment.\"\n+else\n+  echo \"There is NO Docker support with the docker build environment.\"\n+fi\n+\n+COMMAND=( \"$@\" )\n+if [ $# -eq 0 ];\n+then\n+  COMMAND=( \"bash\" )\n+fi\n+\n+[ -d \"${HOME}/.beam_docker_build_env/.gradle\" ] || mkdir -p \"${HOME}/.beam_docker_build_env/.gradle\"\n+\n+# By mapping the .m2 directory you can do an mvn install from\n+# within the container and use the result on your normal\n+# system.  And this also is a significant speedup in subsequent\n+# builds because the dependencies are downloaded only once.\n+docker run --rm=true ${DOCKER_INTERACTIVE_RUN}                         \\", "originalCommit": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE3MTczNw==", "url": "https://github.com/apache/beam/pull/13308#discussion_r533171737", "bodyText": "Done", "author": "nielsbasjes", "createdAt": "2020-12-01T08:54:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxMzYyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxNTQ5MQ==", "url": "https://github.com/apache/beam/pull/13308#discussion_r532915491", "bodyText": "Let's make this more helpful - maybe it could point people to a page like this: https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user", "author": "TheNeuralBit", "createdAt": "2020-11-30T21:29:14Z", "path": "dev-support/docker/beam_env_checks.sh", "diffHunk": "@@ -0,0 +1,120 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# SHELLDOC-IGNORE\n+\n+# -------------------------------------------------------\n+function showWelcome {\n+# http://patorjk.com/software/taag/#p=display&f=Doom&t=Beam%20Build%20Env.\n+cat << \"Welcome-message\"\n+\n+______                       ______       _ _     _   _____\n+| ___ \\                      | ___ \\     (_) |   | | |  ___|\n+| |_/ / ___  __ _ _ __ ___   | |_/ /_   _ _| | __| | | |__ _ ____   __\n+| ___ \\/ _ \\/ _` | '_ ` _ \\  | ___ \\ | | | | |/ _` | |  __| '_ \\ \\ / /\n+| |_/ /  __/ (_| | | | | | | | |_/ / |_| | | | (_| | | |__| | | \\ V /\n+\\____/ \\___|\\__,_|_| |_| |_| \\____/ \\__,_|_|_|\\__,_| \\____/_| |_|\\_(_)\n+\n+This is the standard Beam Developer build environment.\n+This has all the right tools installed required to build\n+Apache Beam from source.\n+\n+Welcome-message\n+}\n+\n+# -------------------------------------------------------\n+\n+function showAbort {\n+  cat << \"Abort-message\"\n+\n+  ___  _                _   _\n+ / _ \\| |              | | (_)\n+/ /_\\ \\ |__   ___  _ __| |_ _ _ __   __ _\n+|  _  | '_ \\ / _ \\| '__| __| | '_ \\ / _\\` |\n+| | | | |_) | (_) | |  | |_| | | | | (_| |\n+\\_| |_/_.__/ \\___/|_|   \\__|_|_| |_|\\__, |\n+                                     __/ |\n+                                    |___/\n+\n+Abort-message\n+}\n+\n+# -------------------------------------------------------\n+\n+function failIfUserIsRoot {\n+    if [ \"$(id -u)\" -eq \"0\" ]; # If you are root then something went wrong.\n+    then\n+        cat <<End-of-message\n+\n+Apparently you are inside this docker container as the user root.\n+Putting it simply:\n+\n+   This should not occur.\n+\n+Known possible causes of this are:\n+1) Running this script as the root user ( Just don't )", "originalCommit": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE3MTM2Ng==", "url": "https://github.com/apache/beam/pull/13308#discussion_r533171366", "bodyText": "Done.", "author": "nielsbasjes", "createdAt": "2020-12-01T08:54:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxNTQ5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyMjIxNw==", "url": "https://github.com/apache/beam/pull/13308#discussion_r532922217", "bodyText": "nit: The ASCII art is nice for the welcome message but I'd drop it for this and the low memory message", "author": "TheNeuralBit", "createdAt": "2020-11-30T21:42:40Z", "path": "dev-support/docker/beam_env_checks.sh", "diffHunk": "@@ -0,0 +1,120 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# SHELLDOC-IGNORE\n+\n+# -------------------------------------------------------\n+function showWelcome {\n+# http://patorjk.com/software/taag/#p=display&f=Doom&t=Beam%20Build%20Env.\n+cat << \"Welcome-message\"\n+\n+______                       ______       _ _     _   _____\n+| ___ \\                      | ___ \\     (_) |   | | |  ___|\n+| |_/ / ___  __ _ _ __ ___   | |_/ /_   _ _| | __| | | |__ _ ____   __\n+| ___ \\/ _ \\/ _` | '_ ` _ \\  | ___ \\ | | | | |/ _` | |  __| '_ \\ \\ / /\n+| |_/ /  __/ (_| | | | | | | | |_/ / |_| | | | (_| | | |__| | | \\ V /\n+\\____/ \\___|\\__,_|_| |_| |_| \\____/ \\__,_|_|_|\\__,_| \\____/_| |_|\\_(_)\n+\n+This is the standard Beam Developer build environment.\n+This has all the right tools installed required to build\n+Apache Beam from source.\n+\n+Welcome-message\n+}\n+\n+# -------------------------------------------------------\n+\n+function showAbort {\n+  cat << \"Abort-message\"\n+\n+  ___  _                _   _\n+ / _ \\| |              | | (_)\n+/ /_\\ \\ |__   ___  _ __| |_ _ _ __   __ _\n+|  _  | '_ \\ / _ \\| '__| __| | '_ \\ / _\\` |\n+| | | | |_) | (_) | |  | |_| | | | | (_| |\n+\\_| |_/_.__/ \\___/|_|   \\__|_|_| |_|\\__, |\n+                                     __/ |\n+                                    |___/", "originalCommit": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE3MDc0OQ==", "url": "https://github.com/apache/beam/pull/13308#discussion_r533170749", "bodyText": "Hmm, Yeah.\nI'm always a big fan of making errors \"in your face\" and also this was copied from the Hadoop version of this (which I created over 5 years ago).\nIf it's ok with you I choose to leave it as-is.", "author": "nielsbasjes", "createdAt": "2020-12-01T08:53:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyMjIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyMjUwOQ==", "url": "https://github.com/apache/beam/pull/13308#discussion_r532922509", "bodyText": "I wonder if we could generate an ASCII firefly to put here :) https://beam.apache.org/community/mascot/", "author": "TheNeuralBit", "createdAt": "2020-11-30T21:43:15Z", "path": "dev-support/docker/beam_env_checks.sh", "diffHunk": "@@ -0,0 +1,120 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# SHELLDOC-IGNORE\n+\n+# -------------------------------------------------------\n+function showWelcome {\n+# http://patorjk.com/software/taag/#p=display&f=Doom&t=Beam%20Build%20Env.\n+cat << \"Welcome-message\"\n+\n+______                       ______       _ _     _   _____\n+| ___ \\                      | ___ \\     (_) |   | | |  ___|\n+| |_/ / ___  __ _ _ __ ___   | |_/ /_   _ _| | __| | | |__ _ ____   __\n+| ___ \\/ _ \\/ _` | '_ ` _ \\  | ___ \\ | | | | |/ _` | |  __| '_ \\ \\ / /\n+| |_/ /  __/ (_| | | | | | | | |_/ / |_| | | | (_| | | |__| | | \\ V /\n+\\____/ \\___|\\__,_|_| |_| |_| \\____/ \\__,_|_|_|\\__,_| \\____/_| |_|\\_(_)", "originalCommit": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE3MjEyNw==", "url": "https://github.com/apache/beam/pull/13308#discussion_r533172127", "bodyText": "Whoo, I like this challenge !", "author": "nielsbasjes", "createdAt": "2020-12-01T08:54:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyMjUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE2NzIwMA==", "url": "https://github.com/apache/beam/pull/13308#discussion_r536167200", "bodyText": "Sorry, I tried but my ASCII art skills are severely insufficient (and the automatic tools I found are did not create something I considered nice enough to include).", "author": "nielsbasjes", "createdAt": "2020-12-04T15:10:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyMjUwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyNDIxMg==", "url": "https://github.com/apache/beam/pull/13308#discussion_r532924212", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ###\n          \n          \n            \n            # Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n          \n          \n            \n            ###\n          \n          \n            \n            ###\n          \n          \n            \n            # Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n          \n          \n            \n            ###\n          \n          \n            \n            # TODO(BEAM-11327): Remove the need to run tests with UTF-8 encoding", "author": "TheNeuralBit", "createdAt": "2020-11-30T21:46:33Z", "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,110 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.5 \\\n+        python3.6 \\\n+        python3.7 \\\n+        python2.7 \\\n+        virtualenv \\\n+        tox\n+\n+###\n+# Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n+###", "originalCommit": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA1MjM3Mg==", "url": "https://github.com/apache/beam/pull/13308#discussion_r533052372", "bodyText": "What happens without these? If they are necessary for a build environment we should add them to https://beam.apache.org/contribute/#prerequisites as well", "author": "TheNeuralBit", "createdAt": "2020-12-01T03:38:18Z", "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,110 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.5 \\\n+        python3.6 \\\n+        python3.7 \\\n+        python2.7 \\\n+        virtualenv \\\n+        tox\n+\n+###\n+# Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n+###\n+RUN sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && \\\n+    locale-gen\n+ENV LANG en_US.UTF-8\n+ENV LANGUAGE en_US:en\n+ENV LC_ALL en_US.UTF-8\n+\n+###\n+# Set Python3.6 as default\n+###\n+RUN alias python=python3.6\n+\n+###\n+# Install grpcio-tools mypy-protobuf for `python3 sdks/python/setup.py sdist` to work\n+###\n+RUN pip3 install grpcio-tools mypy-protobuf", "originalCommit": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE3Njg4NA==", "url": "https://github.com/apache/beam/pull/13308#discussion_r533176884", "bodyText": "I'm not sure. I copied this from #12837", "author": "nielsbasjes", "createdAt": "2020-12-01T08:58:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA1MjM3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDEyMjUxMA==", "url": "https://github.com/apache/beam/pull/13308#discussion_r534122510", "bodyText": "I can confirm that without this the build fails around messages involving sdist.\nI'm no python expert but it seems this is really needed.\nSo I'm leaving this in.\nI've added a bit to the mentioned documentation page.", "author": "nielsbasjes", "createdAt": "2020-12-02T12:16:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA1MjM3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA1Mjk3Nw==", "url": "https://github.com/apache/beam/pull/13308#discussion_r533052977", "bodyText": "I don't think this belongs in CHANGES.md, it is intended to communicate changes in the Beam release to users, but this change is just for developers.", "author": "TheNeuralBit", "createdAt": "2020-12-01T03:40:37Z", "path": "CHANGES.md", "diffHunk": "@@ -97,6 +97,7 @@\n * Added support for avro payload format in Beam SQL Pubsub Table ([BEAM-5504](https://issues.apache.org/jira/browse/BEAM-5504))\n * Added option to disable unnecessary copying between operators in Flink Runner (Java) ([BEAM-11146](https://issues.apache.org/jira/browse/BEAM-11146))\n * Added CombineFn.setup and CombineFn.teardown to Python SDK. These methods let you initialize the CombineFn's state before any of the other methods of the CombineFn is executed and clean that state up later on. If you are using Dataflow, you need to enable Dataflow Runner V2 by passing `--experiments=use_runner_v2` before using this feature. ([BEAM-3736](https://issues.apache.org/jira/browse/BEAM-3736))\n+* Added Docker based developer build environment. ([BEAM-10891](https://issues.apache.org/jira/browse/BEAM-10891))", "originalCommit": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE3Mzc5Ng==", "url": "https://github.com/apache/beam/pull/13308#discussion_r533173796", "bodyText": "Ok, I'll remove it.", "author": "nielsbasjes", "createdAt": "2020-12-01T08:56:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA1Mjk3Nw=="}], "type": "inlineReview"}, {"oid": "e3c10f1d62fba2c04f5de347a899f7bd6161ada0", "url": "https://github.com/apache/beam/commit/e3c10f1d62fba2c04f5de347a899f7bd6161ada0", "message": "[BEAM-10891] Standardized build environment using Docker", "committedDate": "2020-12-01T08:57:18Z", "type": "commit"}, {"oid": "e3c10f1d62fba2c04f5de347a899f7bd6161ada0", "url": "https://github.com/apache/beam/commit/e3c10f1d62fba2c04f5de347a899f7bd6161ada0", "message": "[BEAM-10891] Standardized build environment using Docker", "committedDate": "2020-12-01T08:57:18Z", "type": "forcePushed"}, {"oid": "b93131be8876e6d3577a94af09a00da498029135", "url": "https://github.com/apache/beam/commit/b93131be8876e6d3577a94af09a00da498029135", "message": "Document additional python tools needed to build", "committedDate": "2020-12-02T12:16:37Z", "type": "commit"}, {"oid": "e5b45b856523943a27daf5ac726025cfaaf1c887", "url": "https://github.com/apache/beam/commit/e5b45b856523943a27daf5ac726025cfaaf1c887", "message": "Add pyenv and pyenv-virtualenv to the docker image", "committedDate": "2020-12-02T13:00:34Z", "type": "commit"}, {"oid": "3c715c64d3f169f44c5aab3bb0dcb13b926f7396", "url": "https://github.com/apache/beam/commit/3c715c64d3f169f44c5aab3bb0dcb13b926f7396", "message": "Attempt workaround wrong python distlib version", "committedDate": "2020-12-04T15:02:59Z", "type": "commit"}, {"oid": "3c715c64d3f169f44c5aab3bb0dcb13b926f7396", "url": "https://github.com/apache/beam/commit/3c715c64d3f169f44c5aab3bb0dcb13b926f7396", "message": "Attempt workaround wrong python distlib version", "committedDate": "2020-12-04T15:02:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5MzMyMA==", "url": "https://github.com/apache/beam/pull/13308#discussion_r536193320", "bodyText": "@nielsbasjes Here should work!\nRUN pip3 install distlib==0.3.1 yapf==0.29.0 pytest", "author": "omarismail94", "createdAt": "2020-12-04T15:46:48Z", "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,154 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        wget \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.6 \\\n+        python3.7 \\\n+        python3.8 \\\n+        virtualenv \\\n+        tox \\\n+        # Needed for pyenv:\n+        make \\\n+        libssl-dev \\\n+        zlib1g-dev \\\n+        libbz2-dev \\\n+        libreadline-dev \\\n+        libsqlite3-dev \\\n+        llvm \\\n+        libncurses5-dev \\\n+        libncursesw5-dev \\\n+        xz-utils \\\n+        tk-dev \\\n+        libffi-dev \\\n+        liblzma-dev \\\n+        python-openssl\n+\n+###\n+# Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n+###\n+# TODO(BEAM-11327): Remove the need to run tests with UTF-8 encoding\n+RUN sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && \\\n+    locale-gen\n+ENV LANG en_US.UTF-8\n+ENV LANGUAGE en_US:en\n+ENV LC_ALL en_US.UTF-8\n+\n+###\n+# Set Python3.6 as default\n+###\n+RUN alias python=python3.6\n+\n+###\n+# Install grpcio-tools mypy-protobuf for `python3 sdks/python/setup.py sdist` to work\n+###\n+RUN pip3 install grpcio-tools mypy-protobuf\n+\n+###\n+# Avoid https://github.com/pypa/virtualenv/issues/2006\n+RUN pip3 install distlib==0.3.1", "originalCommit": "3c715c64d3f169f44c5aab3bb0dcb13b926f7396", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5NzI3NA==", "url": "https://github.com/apache/beam/pull/13308#discussion_r536197274", "bodyText": "Done", "author": "nielsbasjes", "createdAt": "2020-12-04T15:52:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5MzMyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIzNDQxOA==", "url": "https://github.com/apache/beam/pull/13308#discussion_r536234418", "bodyText": "Thanks @omarismail94 this is exactly what I had in mind :) Sorry I wasn't clear @nielsbasjes", "author": "TheNeuralBit", "createdAt": "2020-12-04T16:46:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5MzMyMA=="}], "type": "inlineReview"}, {"oid": "fb46a1423120b2c0ee6ea18b75834fad2c60c63d", "url": "https://github.com/apache/beam/commit/fb46a1423120b2c0ee6ea18b75834fad2c60c63d", "message": "Install extra tools", "committedDate": "2020-12-04T15:51:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI0MDQxOA==", "url": "https://github.com/apache/beam/pull/13308#discussion_r536240418", "bodyText": "Can we drop the changes for pyenv? I think we should encourage python developers to use the container's system python instead. If that proves burdensome in the future we can add this back.", "author": "TheNeuralBit", "createdAt": "2020-12-04T16:55:47Z", "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,155 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        wget \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.6 \\\n+        python3.7 \\\n+        python3.8 \\\n+        virtualenv \\\n+        tox \\\n+        # Needed for pyenv:\n+        make \\\n+        libssl-dev \\\n+        zlib1g-dev \\\n+        libbz2-dev \\\n+        libreadline-dev \\\n+        libsqlite3-dev \\\n+        llvm \\\n+        libncurses5-dev \\\n+        libncursesw5-dev \\\n+        xz-utils \\\n+        tk-dev \\\n+        libffi-dev \\\n+        liblzma-dev \\\n+        python-openssl", "originalCommit": "fb46a1423120b2c0ee6ea18b75834fad2c60c63d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "503d140fee4a397aba74e41328ff1239dbfa16e1", "url": "https://github.com/apache/beam/commit/503d140fee4a397aba74e41328ff1239dbfa16e1", "message": "Drop pyenv from the image", "committedDate": "2020-12-04T21:52:03Z", "type": "commit"}]}