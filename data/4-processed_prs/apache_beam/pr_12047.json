{"pr_number": 12047, "pr_title": "[BEAM-10291] Adding full thread dump upon lull detection", "pr_createdAt": "2020-06-21T19:48:03Z", "pr_url": "https://github.com/apache/beam/pull/12047", "timeline": [{"oid": "02a6b612a356347baa8071972c837a9a183b5872", "url": "https://github.com/apache/beam/commit/02a6b612a356347baa8071972c837a9a183b5872", "message": "[BEAM-10291] Adding full thread dump upon lull detection to python fnapi sdk harness", "committedDate": "2020-06-30T20:19:34Z", "type": "commit"}, {"oid": "d78e9eb1251d090157079c6b370c8eb5c0f88149", "url": "https://github.com/apache/beam/commit/d78e9eb1251d090157079c6b370c8eb5c0f88149", "message": "fixing lint", "committedDate": "2020-06-30T20:19:34Z", "type": "commit"}, {"oid": "fe1e2143cac083294338db586f8c8d1b5e5399b4", "url": "https://github.com/apache/beam/commit/fe1e2143cac083294338db586f8c8d1b5e5399b4", "message": "fixing lint", "committedDate": "2020-06-30T20:19:34Z", "type": "commit"}, {"oid": "60af3835a006018422cbe6a0d0ded06ce85cb555", "url": "https://github.com/apache/beam/commit/60af3835a006018422cbe6a0d0ded06ce85cb555", "message": "fixing lint", "committedDate": "2020-06-30T20:19:34Z", "type": "commit"}, {"oid": "dad753b396cbc9f4bd48db3757ef88322be9bd21", "url": "https://github.com/apache/beam/commit/dad753b396cbc9f4bd48db3757ef88322be9bd21", "message": "added test", "committedDate": "2020-06-30T20:19:34Z", "type": "commit"}, {"oid": "dad753b396cbc9f4bd48db3757ef88322be9bd21", "url": "https://github.com/apache/beam/commit/dad753b396cbc9f4bd48db3757ef88322be9bd21", "message": "added test", "committedDate": "2020-06-30T20:19:34Z", "type": "forcePushed"}, {"oid": "9b039c35b9e342222d6753511f505f57e3d4bb2b", "url": "https://github.com/apache/beam/commit/9b039c35b9e342222d6753511f505f57e3d4bb2b", "message": "fixing lint", "committedDate": "2020-06-30T20:38:26Z", "type": "commit"}, {"oid": "35bb444a5dcdad88738d5cd3aad2940cebc82cba", "url": "https://github.com/apache/beam/commit/35bb444a5dcdad88738d5cd3aad2940cebc82cba", "message": "making it work with python2 and python3.5", "committedDate": "2020-06-30T23:37:51Z", "type": "commit"}, {"oid": "7213fb86f7aeef0d91bc279c992f3695586493ef", "url": "https://github.com/apache/beam/commit/7213fb86f7aeef0d91bc279c992f3695586493ef", "message": "making it work with python2 and python3.5", "committedDate": "2020-06-30T23:41:26Z", "type": "commit"}, {"oid": "c58ba72935041550c931f7052b564f5847ef8169", "url": "https://github.com/apache/beam/commit/c58ba72935041550c931f7052b564f5847ef8169", "message": "lint", "committedDate": "2020-06-30T23:53:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA1MjYyNg==", "url": "https://github.com/apache/beam/pull/12047#discussion_r448052626", "bodyText": "Can we reuse thread_dump (from https://github.com/apache/beam/blob/master/sdks/python/apache_beam/runners/worker/worker_status.py#L37) ?", "author": "aaltay", "createdAt": "2020-07-01T00:34:49Z", "path": "sdks/python/apache_beam/runners/worker/sdk_worker.py", "diffHunk": "@@ -570,6 +576,23 @@ def _log_lull_in_bundle_processor(self, processor):\n           step_name_log,\n           stack_trace)\n \n+      if self._should_log_full_thread_dump():\n+        self._log_full_thread_dump()\n+\n+  def _should_log_full_thread_dump(self):\n+    now = time.time()\n+    if self._last_full_thread_dump_secs + LOG_LULL_FULL_THREAD_DUMP_S < now:\n+      self._last_full_thread_dump_secs = now\n+      return True\n+    return False\n+\n+  def _log_full_thread_dump(self):", "originalCommit": "c58ba72935041550c931f7052b564f5847ef8169", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA1ODc2MA==", "url": "https://github.com/apache/beam/pull/12047#discussion_r448058760", "bodyText": "Thanks for the pointer. Done.", "author": "davidyan74", "createdAt": "2020-07-01T00:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA1MjYyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNDI4OQ==", "url": "https://github.com/apache/beam/pull/12047#discussion_r448524289", "bodyText": "This is a nit. I think at this point, you can remove _log_full_thread_dump() and directly call thread_dump() instead.", "author": "aaltay", "createdAt": "2020-07-01T17:50:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA1MjYyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNjA2OA==", "url": "https://github.com/apache/beam/pull/12047#discussion_r448526068", "bodyText": "Thanks! I'm using _log_full_thread_dump() as a mock in the unit test. I can mock thread_dump() instead there or leave it as is. Let me know your thoughts.", "author": "davidyan74", "createdAt": "2020-07-01T17:53:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA1MjYyNg=="}], "type": "inlineReview"}, {"oid": "bb220b2760566f1f8c502bf4dcccecb1680ea6eb", "url": "https://github.com/apache/beam/commit/bb220b2760566f1f8c502bf4dcccecb1680ea6eb", "message": "use thread_dump in worker_status", "committedDate": "2020-07-01T00:58:22Z", "type": "commit"}]}