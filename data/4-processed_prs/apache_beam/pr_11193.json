{"pr_number": 11193, "pr_title": "[BEAM-9550] Increase JVM Metaspace size for the TaskExecutors.", "pr_createdAt": "2020-03-23T15:35:06Z", "pr_url": "https://github.com/apache/beam/pull/11193", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0MzAwMQ==", "url": "https://github.com/apache/beam/pull/11193#discussion_r397443001", "bodyText": "The correct option name is: taskmanager.memory.jvm-metaspace.size: https://ci.apache.org/projects/flink/flink-docs-release-1.10/ops/config.html#taskmanager-memory-jvm-metaspace-size", "author": "mxm", "createdAt": "2020-03-24T20:33:46Z", "path": ".test-infra/dataproc/init-actions/flink.sh", "diffHunk": "@@ -155,7 +155,8 @@ function configure_flink() {\n # Settings applied by Cloud Dataproc initialization action\n jobmanager.rpc.address: ${master_hostname}\n jobmanager.heap.mb: ${flink_jobmanager_memory}\n-taskmanager.heap.mb: ${flink_taskmanager_memory}\n+taskmanager.memory.process.mb: ${flink_taskmanager_memory}\n+taskmanager.memory.jvm-metaspace.mb: 512", "originalCommit": "7f11ef3ccd806e69c17e4788ebf37b8a50889d2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0MzMyNw==", "url": "https://github.com/apache/beam/pull/11193#discussion_r397443327", "bodyText": "Also this one is taskmanager.memory.process.size: https://ci.apache.org/projects/flink/flink-docs-release-1.10/ops/config.html#taskmanager-memory-process-size", "author": "mxm", "createdAt": "2020-03-24T20:34:23Z", "path": ".test-infra/dataproc/init-actions/flink.sh", "diffHunk": "@@ -155,7 +155,8 @@ function configure_flink() {\n # Settings applied by Cloud Dataproc initialization action\n jobmanager.rpc.address: ${master_hostname}\n jobmanager.heap.mb: ${flink_jobmanager_memory}\n-taskmanager.heap.mb: ${flink_taskmanager_memory}\n+taskmanager.memory.process.mb: ${flink_taskmanager_memory}", "originalCommit": "7f11ef3ccd806e69c17e4788ebf37b8a50889d2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0MzUyOQ==", "url": "https://github.com/apache/beam/pull/11193#discussion_r397443529", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Flink config entry: taskmanager.memory.process.mb.\n          \n          \n            \n            # Flink config entry: taskmanager.memory.process.size", "author": "mxm", "createdAt": "2020-03-24T20:34:48Z", "path": ".test-infra/dataproc/init-actions/flink.sh", "diffHunk": "@@ -46,7 +46,7 @@ readonly FLINK_NETWORK_NUM_BUFFERS=2048\n readonly FLINK_JOBMANAGER_MEMORY_FRACTION='1.0'\n \n # Heap memory used by the task managers (slaves) determined by the physical (free) memory of the servers.\n-# Flink config entry: taskmanager.heap.mb.\n+# Flink config entry: taskmanager.memory.process.mb.", "originalCommit": "7f11ef3ccd806e69c17e4788ebf37b8a50889d2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ced772a6e33f7d116cc112bfd89e02284ea48a0f", "url": "https://github.com/apache/beam/commit/ced772a6e33f7d116cc112bfd89e02284ea48a0f", "message": "fix: correct config keys", "committedDate": "2020-03-25T12:19:13Z", "type": "forcePushed"}, {"oid": "adbf1d4ee21b2a6a1bb79d852fb8d37f52cf48eb", "url": "https://github.com/apache/beam/commit/adbf1d4ee21b2a6a1bb79d852fb8d37f52cf48eb", "message": "fix: execute tests in `BATCH_FORCED` mode", "committedDate": "2020-03-26T16:45:11Z", "type": "forcePushed"}, {"oid": "56a631a363db829d301c4b95c876ca958de78466", "url": "https://github.com/apache/beam/commit/56a631a363db829d301c4b95c876ca958de78466", "message": "fix: increase the fraction of total Flink memory to be used as managed memory", "committedDate": "2020-03-30T10:48:33Z", "type": "forcePushed"}, {"oid": "189c6529cd83cb22bd4f1c92dd9dc52a24b75a39", "url": "https://github.com/apache/beam/commit/189c6529cd83cb22bd4f1c92dd9dc52a24b75a39", "message": "[BEAM-9550] Increase JVM Metaspace size for the TaskExecutors.\n\nAdditionally:\n * replace deprecated `taskmanager.heap.mb` config key to `taskmanager.memory.process.mb`, as suggested in Apache Flink 1.10 Migration Guide.\n * remove unused variable in `flink_cluster.sh` script.", "committedDate": "2020-04-03T11:12:11Z", "type": "commit"}, {"oid": "8246adb83f855a7f5feb846e92e730954af0a2b5", "url": "https://github.com/apache/beam/commit/8246adb83f855a7f5feb846e92e730954af0a2b5", "message": "fix: correct config keys", "committedDate": "2020-04-03T11:12:11Z", "type": "commit"}, {"oid": "a068c430e73ed52c7f415caf9679a4b47e30154f", "url": "https://github.com/apache/beam/commit/a068c430e73ed52c7f415caf9679a4b47e30154f", "message": "fix: increase the fraction of total Flink memory to be used as managed memory", "committedDate": "2020-04-03T11:12:11Z", "type": "commit"}, {"oid": "c02d64f437ac2754dc01f31c8e6048f183128fa4", "url": "https://github.com/apache/beam/commit/c02d64f437ac2754dc01f31c8e6048f183128fa4", "message": "fix: change machine type to n1-highmem-4", "committedDate": "2020-04-03T11:12:11Z", "type": "forcePushed"}, {"oid": "a068c430e73ed52c7f415caf9679a4b47e30154f", "url": "https://github.com/apache/beam/commit/a068c430e73ed52c7f415caf9679a4b47e30154f", "message": "fix: increase the fraction of total Flink memory to be used as managed memory", "committedDate": "2020-04-03T11:12:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU3OTgwNw==", "url": "https://github.com/apache/beam/pull/11193#discussion_r405579807", "bodyText": "Should we set a fixed amount of memory here? 0.5 could be a lot.", "author": "mxm", "createdAt": "2020-04-08T14:44:43Z", "path": ".test-infra/dataproc/init-actions/flink.sh", "diffHunk": "@@ -155,7 +155,9 @@ function configure_flink() {\n # Settings applied by Cloud Dataproc initialization action\n jobmanager.rpc.address: ${master_hostname}\n jobmanager.heap.mb: ${flink_jobmanager_memory}\n-taskmanager.heap.mb: ${flink_taskmanager_memory}\n+taskmanager.memory.process.size: \"${flink_taskmanager_memory} mb\"\n+taskmanager.memory.jvm-metaspace.size: 512 mb\n+taskmanager.memory.managed.fraction: 0.5", "originalCommit": "a068c430e73ed52c7f415caf9679a4b47e30154f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU4MTU2OQ==", "url": "https://github.com/apache/beam/pull/11193#discussion_r405581569", "bodyText": "If you needed 0.5, then that's fine.", "author": "mxm", "createdAt": "2020-04-08T14:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU3OTgwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY0MzI0OA==", "url": "https://github.com/apache/beam/pull/11193#discussion_r405643248", "bodyText": "Yes, the jobs started working after setting the fraction to 0.5. The default value is 0.4, so the difference might not be that huge.", "author": "kamilwu", "createdAt": "2020-04-08T16:11:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU3OTgwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY0ODAyNQ==", "url": "https://github.com/apache/beam/pull/11193#discussion_r405648025", "bodyText": "Sounds good!", "author": "mxm", "createdAt": "2020-04-08T16:18:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU3OTgwNw=="}], "type": "inlineReview"}]}