{"pr_number": 11764, "pr_title": "[BEAM-10048] Clean up release guide.", "pr_createdAt": "2020-05-20T20:47:52Z", "pr_url": "https://github.com/apache/beam/pull/11764", "timeline": [{"oid": "29d19d0cc97473a23ff0d9d4a048377b5e2b3ae1", "url": "https://github.com/apache/beam/commit/29d19d0cc97473a23ff0d9d4a048377b5e2b3ae1", "message": "[BEAM-10048] Clean up release guide.\n\n- Remove redundancies between the release guide and build_release_candidate.sh.\n- Update website-related instructions for Hugo.", "committedDate": "2020-05-20T20:51:46Z", "type": "forcePushed"}, {"oid": "58520452dc8afa3d92babd9796ea9556b35c2e5a", "url": "https://github.com/apache/beam/commit/58520452dc8afa3d92babd9796ea9556b35c2e5a", "message": "[BEAM-10048] Clean up release guide.\n\n- Remove redundancies between the release guide and build_release_candidate.sh.\n- Update website-related instructions for Hugo.", "committedDate": "2020-05-20T20:52:21Z", "type": "forcePushed"}, {"oid": "21da8903180e58244f817d956a080d5a8c5e66a8", "url": "https://github.com/apache/beam/commit/21da8903180e58244f817d956a080d5a8c5e66a8", "message": "[BEAM-10048] Clean up release guide.\n\n- Remove redundancies between the release guide and build_release_candidate.sh.\n- Update website-related instructions for Hugo.", "committedDate": "2020-05-20T20:56:04Z", "type": "commit"}, {"oid": "21da8903180e58244f817d956a080d5a8c5e66a8", "url": "https://github.com/apache/beam/commit/21da8903180e58244f817d956a080d5a8c5e66a8", "message": "[BEAM-10048] Clean up release guide.\n\n- Remove redundancies between the release guide and build_release_candidate.sh.\n- Update website-related instructions for Hugo.", "committedDate": "2020-05-20T20:56:04Z", "type": "forcePushed"}, {"oid": "1404c6a1ab3ca7e9ff3267c7bd28e18472c33e2a", "url": "https://github.com/apache/beam/commit/1404c6a1ab3ca7e9ff3267c7bd28e18472c33e2a", "message": "Remove checklist from build_release_candidate.sh.\n\nIt is included in the release guide.", "committedDate": "2020-05-20T21:13:06Z", "type": "commit"}, {"oid": "1404c6a1ab3ca7e9ff3267c7bd28e18472c33e2a", "url": "https://github.com/apache/beam/commit/1404c6a1ab3ca7e9ff3267c7bd28e18472c33e2a", "message": "Remove checklist from build_release_candidate.sh.\n\nIt is included in the release guide.", "committedDate": "2020-05-20T21:13:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2NDkzNA==", "url": "https://github.com/apache/beam/pull/11764#discussion_r428364934", "bodyText": "nit: say \"by clicking the CLOSE button\". I was confused on how to close.", "author": "amaliujia", "createdAt": "2020-05-20T23:31:44Z", "path": "website/www/site/content/en/contribute/release-guide.md", "diffHunk": "@@ -583,189 +582,44 @@ For this step, we recommend you using automation script to create a RC, but you\n   1. Stage source release into dist.apache.org dev [repo](https://dist.apache.org/repos/dist/dev/beam/).\n   1. Stage,sign and hash python binaries into dist.apache.ord dev repo python dir\n   1. Stage SDK docker images to [docker hub Apache organization](https://hub.docker.com/search?q=apache%2Fbeam&type=image).\n-  1. Create a PR to update beam and beam-site, changes includes:\n+  1. Create a PR to update beam-site, changes includes:\n      * Copy python doc into beam-site\n      * Copy java doc into beam-site\n-     * Update release version into [_config.yml](https://github.com/apache/beam/blob/master/website/_config.yml).\n      \n #### Tasks you need to do manually\n-  1. Add new release into `website/src/get-started/downloads.md`.\n-  1. Update last release download links in `website/src/get-started/downloads.md`.\n-  1. Update `website/src/.htaccess` to redirect to the new version.\n-  1. Build and stage python wheels.\n+  1. Verify the script worked.\n+      1. Verify that the source and Python binaries are present in [dist.apache.org](https://dist.apache.org/repos/dist/dev/beam).\n+      1. Verify Docker images are published. How to find images:\n+          1. Visit [https://hub.docker.com/u/apache](https://hub.docker.com/search?q=apache%2Fbeam&type=image)\n+          2. Visit each repository and navigate to *tags* tab.\n+          3. Verify images are pushed with tags: ${RELEASE}_rc{RC_NUM}\n+      1. Verify that third party licenses are included in Docker containers by logging in to the images.\n+          - For Python SDK images, there should be around 80 ~ 100 dependencies.\n+          Please note that dependencies for the SDKs with different Python versions vary.\n+          Need to verify all Python images by replacing `${ver}` with each supported Python version `X.Y`.\n+          ```\n+          docker run -it --entrypoint=/bin/bash apache/beam_python${ver}_sdk:${RELEASE}_rc{RC_NUM}\n+          ls -al /opt/apache/beam/third_party_licenses/ | wc -l\n+          ```\n+          - For Java SDK images, there should be around 1400 dependencies.\n+          ```\n+          docker run -it --entrypoint=/bin/bash apache/beam_java_sdk:${RELEASE}_rc{RC_NUM}\n+          ls -al /opt/apache/beam/third_party_licenses/ | wc -l\n+          ```\n   1. Publish staging artifacts\n-      1. Go to the staging repo to close the staging repository on [Apache Nexus](https://repository.apache.org/#stagingRepositories). \n+      1. Go to the staging repo to close the staging repository on [Apache Nexus](https://repository.apache.org/#stagingRepositories).", "originalCommit": "1404c6a1ab3ca7e9ff3267c7bd28e18472c33e2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc3NDM5Mg==", "url": "https://github.com/apache/beam/pull/11764#discussion_r428774392", "bodyText": "I added more detailed instructions.", "author": "ibzib", "createdAt": "2020-05-21T16:40:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2NDkzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2NTEyNg==", "url": "https://github.com/apache/beam/pull/11764#discussion_r428365126", "bodyText": "Removing this big chunk of text because?", "author": "amaliujia", "createdAt": "2020-05-20T23:32:23Z", "path": "website/www/site/content/en/contribute/release-guide.md", "diffHunk": "@@ -583,189 +582,44 @@ For this step, we recommend you using automation script to create a RC, but you\n   1. Stage source release into dist.apache.org dev [repo](https://dist.apache.org/repos/dist/dev/beam/).\n   1. Stage,sign and hash python binaries into dist.apache.ord dev repo python dir\n   1. Stage SDK docker images to [docker hub Apache organization](https://hub.docker.com/search?q=apache%2Fbeam&type=image).\n-  1. Create a PR to update beam and beam-site, changes includes:\n+  1. Create a PR to update beam-site, changes includes:\n      * Copy python doc into beam-site\n      * Copy java doc into beam-site\n-     * Update release version into [_config.yml](https://github.com/apache/beam/blob/master/website/_config.yml).\n      \n #### Tasks you need to do manually\n-  1. Add new release into `website/src/get-started/downloads.md`.\n-  1. Update last release download links in `website/src/get-started/downloads.md`.\n-  1. Update `website/src/.htaccess` to redirect to the new version.\n-  1. Build and stage python wheels.\n+  1. Verify the script worked.\n+      1. Verify that the source and Python binaries are present in [dist.apache.org](https://dist.apache.org/repos/dist/dev/beam).\n+      1. Verify Docker images are published. How to find images:\n+          1. Visit [https://hub.docker.com/u/apache](https://hub.docker.com/search?q=apache%2Fbeam&type=image)\n+          2. Visit each repository and navigate to *tags* tab.\n+          3. Verify images are pushed with tags: ${RELEASE}_rc{RC_NUM}\n+      1. Verify that third party licenses are included in Docker containers by logging in to the images.\n+          - For Python SDK images, there should be around 80 ~ 100 dependencies.\n+          Please note that dependencies for the SDKs with different Python versions vary.\n+          Need to verify all Python images by replacing `${ver}` with each supported Python version `X.Y`.\n+          ```\n+          docker run -it --entrypoint=/bin/bash apache/beam_python${ver}_sdk:${RELEASE}_rc{RC_NUM}\n+          ls -al /opt/apache/beam/third_party_licenses/ | wc -l\n+          ```\n+          - For Java SDK images, there should be around 1400 dependencies.\n+          ```\n+          docker run -it --entrypoint=/bin/bash apache/beam_java_sdk:${RELEASE}_rc{RC_NUM}\n+          ls -al /opt/apache/beam/third_party_licenses/ | wc -l\n+          ```\n   1. Publish staging artifacts\n-      1. Go to the staging repo to close the staging repository on [Apache Nexus](https://repository.apache.org/#stagingRepositories). \n+      1. Go to the staging repo to close the staging repository on [Apache Nexus](https://repository.apache.org/#stagingRepositories).\n       1. When prompted for a description, enter \u201cApache Beam, version X, release candidate Y\u201d.\n-\n-\n-### (Alternative) Run all steps manually", "originalCommit": "1404c6a1ab3ca7e9ff3267c7bd28e18472c33e2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc2OTkxMA==", "url": "https://github.com/apache/beam/pull/11764#discussion_r428769910", "bodyText": "Because it's mostly an exact copy of build_release_candidate.sh. Any part of this block that wasn't part of build_release_candidate.sh was moved into the \"manual steps\" section.", "author": "ibzib", "createdAt": "2020-05-21T16:32:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2NTEyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2NTk1MA==", "url": "https://github.com/apache/beam/pull/11764#discussion_r428365950", "bodyText": "Add that ssh-add trick to cache ssh password?", "author": "amaliujia", "createdAt": "2020-05-20T23:34:52Z", "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -113,7 +113,7 @@ if [[ $confirmation = \"y\" ]]; then\n   echo \"-------------Staging Java Artifacts into Maven---------------\"", "originalCommit": "1404c6a1ab3ca7e9ff3267c7bd28e18472c33e2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc3MDUwMg==", "url": "https://github.com/apache/beam/pull/11764#discussion_r428770502", "bodyText": "I wasn't sure the best way to do that. Maybe we can add it in a later PR.", "author": "ibzib", "createdAt": "2020-05-21T16:33:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2NTk1MA=="}], "type": "inlineReview"}, {"oid": "79e84e98f7de076de72302a4bce9086236e1e947", "url": "https://github.com/apache/beam/commit/79e84e98f7de076de72302a4bce9086236e1e947", "message": "Include additional instructions for staging repository.", "committedDate": "2020-05-21T16:40:06Z", "type": "commit"}, {"oid": "0c3780c438bc1e3c9e314e87e8646e3f4e8972b4", "url": "https://github.com/apache/beam/commit/0c3780c438bc1e3c9e314e87e8646e3f4e8972b4", "message": "Clarify the usage of sign_hash_python_wheels.sh.", "committedDate": "2020-05-21T17:54:42Z", "type": "commit"}]}