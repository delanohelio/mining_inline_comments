{"pr_number": 13273, "pr_title": "[BEAM-11159] Use GCP pubsub client for TestPubsub", "pr_createdAt": "2020-11-05T20:21:09Z", "pr_url": "https://github.com/apache/beam/pull/13273", "timeline": [{"oid": "5f4378767d90cf580d39c8cee345bf635b31131e", "url": "https://github.com/apache/beam/commit/5f4378767d90cf580d39c8cee345bf635b31131e", "message": "use GCP pubsub client for TestPubsub", "committedDate": "2020-11-05T20:22:43Z", "type": "forcePushed"}, {"oid": "cf3bcb21c33c5015cf5ac7e21b681c8af0fbb6ab", "url": "https://github.com/apache/beam/commit/cf3bcb21c33c5015cf5ac7e21b681c8af0fbb6ab", "message": "use GCP pubsub client for TestPubsub", "committedDate": "2020-11-05T22:12:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQyNzc5Mg==", "url": "https://github.com/apache/beam/pull/13273#discussion_r518427792", "bodyText": "Assert isn't guaranteed to run. Would something like org.apache.beam.sdk.util.Preconditions.checkArgumentNotNull be more appropriate?", "author": "apilloud", "createdAt": "2020-11-05T23:15:30Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/TestPubsub.java", "diffHunk": "@@ -195,43 +227,46 @@ public SubscriptionPath subscriptionPath() {\n     return subscriptionPath;\n   }\n \n-  private List<SubscriptionPath> listSubscriptions(ProjectPath projectPath, TopicPath topicPath)\n-      throws IOException {\n-    return pubsub.listSubscriptions(projectPath, topicPath).stream()\n-        .filter((path) -> !path.equals(subscriptionPath))\n-        .collect(ImmutableList.toImmutableList());\n+  private Iterable<String> listSubscriptions(TopicPath topicPath) {\n+    assert topicAdmin != null;\n+    return topicAdmin.listTopicSubscriptions(topicPath.getPath()).iterateAll();\n   }\n \n   /** Publish messages to {@link #topicPath()}. */\n-  public void publish(List<PubsubMessage> messages) throws IOException {\n-    List<PubsubClient.OutgoingMessage> outgoingMessages =\n-        messages.stream().map(this::toOutgoingMessage).collect(toList());\n-    pubsub.publish(eventsTopicPath, outgoingMessages);\n-  }\n+  public void publish(List<PubsubMessage> messages) {\n+    assert eventsTopicPath != null;", "originalCommit": "5f4378767d90cf580d39c8cee345bf635b31131e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ1Mjk1Ng==", "url": "https://github.com/apache/beam/pull/13273#discussion_r518452956", "bodyText": "Good point, done", "author": "TheNeuralBit", "createdAt": "2020-11-06T00:30:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQyNzc5Mg=="}], "type": "inlineReview"}, {"oid": "7d62ea2f1de9f2d642449605c0021116293a5cc4", "url": "https://github.com/apache/beam/commit/7d62ea2f1de9f2d642449605c0021116293a5cc4", "message": "checkNotNull instead of assert", "committedDate": "2020-11-06T00:28:00Z", "type": "commit"}, {"oid": "7d62ea2f1de9f2d642449605c0021116293a5cc4", "url": "https://github.com/apache/beam/commit/7d62ea2f1de9f2d642449605c0021116293a5cc4", "message": "checkNotNull instead of assert", "committedDate": "2020-11-06T00:28:00Z", "type": "forcePushed"}]}