{"pr_number": 13484, "pr_title": "[BEAM-11207] Return valid error on job failures", "pr_createdAt": "2020-12-04T10:34:32Z", "pr_url": "https://github.com/apache/beam/pull/13484", "timeline": [{"oid": "1d8159279df29c73c669bff95d57d831ffd78599", "url": "https://github.com/apache/beam/commit/1d8159279df29c73c669bff95d57d831ffd78599", "message": "[BEAM-11207] Return valid error on job failures\n\nThe 'err' object was being overridden by the output of newUniversalPipelineResult. As a result, the user was not able to catch any job errors.", "committedDate": "2020-12-04T10:50:03Z", "type": "commit"}, {"oid": "1d8159279df29c73c669bff95d57d831ffd78599", "url": "https://github.com/apache/beam/commit/1d8159279df29c73c669bff95d57d831ffd78599", "message": "[BEAM-11207] Return valid error on job failures\n\nThe 'err' object was being overridden by the output of newUniversalPipelineResult. As a result, the user was not able to catch any job errors.", "committedDate": "2020-12-04T10:50:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ5MzM1Ng==", "url": "https://github.com/apache/beam/pull/13484#discussion_r536493356", "bodyText": "In Go, there's no reason to try to have a single return, or maintain an else.\nIn Go, prefer having the happiest path have the least indentation, and strive to return to that lowest level. Simply return, and avoid the extra indentation of an else.\nAn if else block implies that either clause can be executed and those possibilities need to be kept in mind when reading later code. If the if returns (or continues, or breaks, as appropriate), there's no need for an else, as the code in the If never interacts with anything after it.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tres, presultErr := newUniversalPipelineResult(ctx, jobID, client)\n          \n          \n            \n            \tif presultErr != nil {\n          \n          \n            \n            \t\tif err != nil {\n          \n          \n            \n            \t\t\treturn presult, errors.Wrap(err, presultErr.Error())\n          \n          \n            \n            \t\t} else {\n          \n          \n            \n            \t\t\treturn presult, presultErr\n          \n          \n            \n            \t\t}\n          \n          \n            \n            \t} else {\n          \n          \n            \n            \t\tpresult = res\n          \n          \n            \n            \t}\n          \n          \n            \n            \tres, presultErr := newUniversalPipelineResult(ctx, jobID, client)\n          \n          \n            \n            \tif presultErr != nil {\n          \n          \n            \n            \t\tif err != nil {\n          \n          \n            \n            \t\t\treturn presult, errors.Wrap(err, presultErr.Error())\n          \n          \n            \n            \t\t} \n          \n          \n            \n            \t\treturn presult, presultErr\n          \n          \n            \n            \t} \n          \n          \n            \n            \treturn res, err\n          \n      \n    \n    \n  \n\nThis in combination with my other suggestion below to remove the other line.", "author": "lostluck", "createdAt": "2020-12-05T03:19:02Z", "path": "sdks/go/pkg/beam/runners/universal/runnerlib/execute.go", "diffHunk": "@@ -94,11 +94,16 @@ func Execute(ctx context.Context, p *pipepb.Pipeline, endpoint string, opt *JobO\n \t}\n \terr = WaitForCompletion(ctx, client, jobID)\n \n-\tres, err := newUniversalPipelineResult(ctx, jobID, client)\n-\tif err != nil {\n-\t\treturn presult, err\n+\tres, presultErr := newUniversalPipelineResult(ctx, jobID, client)\n+\tif presultErr != nil {\n+\t\tif err != nil {\n+\t\t\treturn presult, errors.Wrap(err, presultErr.Error())\n+\t\t} else {\n+\t\t\treturn presult, presultErr\n+\t\t}\n+\t} else {\n+\t\tpresult = res\n \t}", "originalCommit": "1d8159279df29c73c669bff95d57d831ffd78599", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQxMjg0NQ==", "url": "https://github.com/apache/beam/pull/13484#discussion_r537412845", "bodyText": "Thanks, this definitely looks better. I pushed fixes.", "author": "kamilwu", "createdAt": "2020-12-07T10:56:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ5MzM1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ5MzQ2MA==", "url": "https://github.com/apache/beam/pull/13484#discussion_r536493460", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            \treturn presult, err\n          \n          \n            \n            }\n          \n          \n            \n            }\n          \n      \n    \n    \n  \n\ncleanup of the old return that doesn't need to be preserved.", "author": "lostluck", "createdAt": "2020-12-05T03:19:38Z", "path": "sdks/go/pkg/beam/runners/universal/runnerlib/execute.go", "diffHunk": "@@ -94,11 +94,16 @@ func Execute(ctx context.Context, p *pipepb.Pipeline, endpoint string, opt *JobO\n \t}\n \terr = WaitForCompletion(ctx, client, jobID)\n \n-\tres, err := newUniversalPipelineResult(ctx, jobID, client)\n-\tif err != nil {\n-\t\treturn presult, err\n+\tres, presultErr := newUniversalPipelineResult(ctx, jobID, client)\n+\tif presultErr != nil {\n+\t\tif err != nil {\n+\t\t\treturn presult, errors.Wrap(err, presultErr.Error())\n+\t\t} else {\n+\t\t\treturn presult, presultErr\n+\t\t}\n+\t} else {\n+\t\tpresult = res\n \t}\n-\tpresult = res\n \n \treturn presult, err\n }", "originalCommit": "1d8159279df29c73c669bff95d57d831ffd78599", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cde2b317dc69b4cccab801d111badc2cf1c4cc9c", "url": "https://github.com/apache/beam/commit/cde2b317dc69b4cccab801d111badc2cf1c4cc9c", "message": "fix: remove unnecessary else blocks", "committedDate": "2020-12-07T10:52:49Z", "type": "commit"}]}