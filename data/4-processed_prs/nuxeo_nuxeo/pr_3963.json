{"pr_number": 3963, "pr_title": "NXP-28939: split the retention based event rule properties", "pr_createdAt": "2020-04-23T10:18:26Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3963", "timeline": [{"oid": "e207e5ab86b28fb06d87600e4bd5f6dae2f05c89", "url": "https://github.com/nuxeo/nuxeo/commit/e207e5ab86b28fb06d87600e4bd5f6dae2f05c89", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-23T10:21:20Z", "type": "forcePushed"}, {"oid": "8df0865d9f626a1cfab18464910933d323202ed7", "url": "https://github.com/nuxeo/nuxeo/commit/8df0865d9f626a1cfab18464910933d323202ed7", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-23T14:00:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk0OTUwOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r413949509", "bodyText": "small typo: matadataXPath", "author": "nmpcunha", "createdAt": "2020-04-23T16:35:27Z", "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java", "diffHunk": "@@ -108,7 +110,7 @@ protected void awaitRetentionExpiration(long millis) throws InterruptedException\n \n     protected RetentionRule createRuleWithActions(RetentionRule.ApplicationPolicy policy,\n             StartingPointPolicy startingPointPolicy, List<String> docTypes, String startingPointEventId,\n-            String startingPointExpression, String matadataXPath, long years, long months, long days,\n+            String startingPointExpressionLanguage, String startingPointEventInput, String matadataXPath, long years, long months, long days,", "originalCommit": "8df0865d9f626a1cfab18464910933d323202ed7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4MjczMA==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414382730", "bodyText": "thanks, I will do it on master with a separate commit cleanup/format", "author": "RSalem07", "createdAt": "2020-04-24T08:12:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk0OTUwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIyNzA0NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414227045", "bodyText": "This seems unnecessarily verbose to me. I would suggest just startingPointExpression and startingPointValue instead (same with related various constants, parameters and variables).", "author": "efge", "createdAt": "2020-04-24T01:19:38Z", "path": "addons/nuxeo-retention/nuxeo-retention-core/src/main/resources/schemas/retention_definition.xsd", "diffHunk": "@@ -31,7 +31,8 @@\n       <xs:restriction base=\"xs:string\" ref:resolver=\"directoryResolver\" ref:directory=\"RetentionEvent\" />\n     </xs:simpleType>\n   </xs:element>\n-  <xs:element name=\"startingPointExpression\" type=\"xs:string\" />\n+  <xs:element name=\"startingPointExpressionLanguage\" type=\"xs:string\" />\n+  <xs:element name=\"startingPointEventInput\" type=\"xs:string\" />", "originalCommit": "8df0865d9f626a1cfab18464910933d323202ed7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM3NjkwNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414376905", "bodyText": "Yep, it was my first idea and after that I changed it. but let rename them :)", "author": "RSalem07", "createdAt": "2020-04-24T08:02:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIyNzA0NQ=="}], "type": "inlineReview"}, {"oid": "a99dba500600464a79c7819deacf50d33b65af96", "url": "https://github.com/nuxeo/nuxeo/commit/a99dba500600464a79c7819deacf50d33b65af96", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T07:59:15Z", "type": "forcePushed"}, {"oid": "d0046a782bc8e04c39497fb9749eebacc80290cd", "url": "https://github.com/nuxeo/nuxeo/commit/d0046a782bc8e04c39497fb9749eebacc80290cd", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T08:00:43Z", "type": "forcePushed"}, {"oid": "89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "url": "https://github.com/nuxeo/nuxeo/commit/89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T08:08:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ3NzAxMA==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414477010", "bodyText": "CoreBulkFeature is declared by CoreFeature, you should already have it in the test (no needs to depend on it).", "author": "kevinleturc", "createdAt": "2020-04-24T10:41:29Z", "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java", "diffHunk": "@@ -50,7 +51,7 @@\n  * @since 11.1\n  */\n @RunWith(FeaturesRunner.class)\n-@Features({ TransactionalFeature.class, AutomationFeature.class })\n+@Features({ TransactionalFeature.class, AutomationFeature.class, CoreBulkFeature.class })", "originalCommit": "89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3852c471f061cb82447b4496aa144b754bf44890", "url": "https://github.com/nuxeo/nuxeo/commit/3852c471f061cb82447b4496aa144b754bf44890", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T10:50:01Z", "type": "commit"}, {"oid": "3852c471f061cb82447b4496aa144b754bf44890", "url": "https://github.com/nuxeo/nuxeo/commit/3852c471f061cb82447b4496aa144b754bf44890", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T10:50:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4NjMwOA==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414486308", "bodyText": "Does this pass linting? If yes, it is ok for me!", "author": "nmpcunha", "createdAt": "2020-04-24T10:58:28Z", "path": "addons/nuxeo-retention/nuxeo-retention-web-ui/src/main/resources/web/nuxeo.war/ui/document/retentionrule/nuxeo-retentionrule-view-layout.html", "diffHunk": "@@ -69,7 +69,7 @@\n         <div role=\"widget\">\n           <label>[[i18n(\"retention.rule.label.startPolicy.eventBased.expression.placeholder\")]]</label>\n           <nuxeo-tag name=\"eventInput\">\n-            [[document.properties.retention_def:startingPointExpression]]", "originalCommit": "3852c471f061cb82447b4496aa144b754bf44890", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4ODgwNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414488805", "bodyText": "I think yes, I compared it to the others ones, it looks the same formatting :)", "author": "RSalem07", "createdAt": "2020-04-24T11:03:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4NjMwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwODYyNg==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414608626", "bodyText": "missing space after ,", "author": "efge", "createdAt": "2020-04-24T14:13:43Z", "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java", "diffHunk": "@@ -131,23 +134,30 @@ protected RetentionRule createRuleWithActions(RetentionRule.ApplicationPolicy po\n     protected RetentionRule createImmediateRuleMillis(RetentionRule.ApplicationPolicy policy, long durationMillis,\n             List<String> beginActions, List<String> endActions) {\n         return createRuleWithActions(policy, RetentionRule.StartingPointPolicy.IMMEDIATE, Arrays.asList(\"File\"), null,\n-                null, null, 0L, 0L, 0L, durationMillis, beginActions, endActions);\n+                null, null,null, 0L, 0L, 0L, durationMillis, beginActions, endActions);", "originalCommit": "3852c471f061cb82447b4496aa144b754bf44890", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwODg1Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414608853", "bodyText": "missing space after , (and 2 others below)", "author": "efge", "createdAt": "2020-04-24T14:13:57Z", "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/TestRetentionManager.java", "diffHunk": "@@ -61,19 +68,19 @@ public void testRuleOnlyFile() {\n     @Test\n     public void test1DayManualImmediateRuleRunningRetention() throws InterruptedException {\n         assertStillUnderRetentionAfter(file, createRuleWithActions(RetentionRule.ApplicationPolicy.MANUAL,\n-                RetentionRule.StartingPointPolicy.IMMEDIATE, null, null, null, null, 0, 0, 1, 0, null, null), 1000);\n+                RetentionRule.StartingPointPolicy.IMMEDIATE, null, null, null, null,null, 0, 0, 1, 0, null, null), 1000);", "originalCommit": "3852c471f061cb82447b4496aa144b754bf44890", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwOTg0Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414609846", "bodyText": "Maybe change the i18n label too? Not sure.", "author": "efge", "createdAt": "2020-04-24T14:15:27Z", "path": "addons/nuxeo-retention/nuxeo-retention-web-ui/src/main/resources/web/nuxeo.war/ui/document/retentionrule/nuxeo-retentionrule-create-layout.html", "diffHunk": "@@ -116,11 +116,11 @@\n              min-chars=\"0\">\n            </nuxeo-directory-suggestion>\n            <nuxeo-input role=\"widget\" name=\"eventInput\"\n-                        label=\"[[i18n('retention.rule.label.startPolicy.eventBased.expression.description')]]\"\n-                        placeholder=\"[[i18n('retention.rule.label.startPolicy.eventBased.expression.placeholder')]]\"\n-                        name=\"startingPointExpression\"\n+                        label=\"[[i18n('retention.rule.label.startPolicy.eventBased.input.description')]]\"\n+                        placeholder=\"[[i18n('retention.rule.label.startPolicy.eventBased.input.placeholder')]]\"", "originalCommit": "3852c471f061cb82447b4496aa144b754bf44890", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}