{"pr_number": 3970, "pr_title": "NXP-28139: add docker and docker-json templates", "pr_createdAt": "2020-04-24T12:30:16Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3970", "timeline": [{"oid": "1e3156f21c6d692ea81acd14c635f4a3a0df1f57", "url": "https://github.com/nuxeo/nuxeo/commit/1e3156f21c6d692ea81acd14c635f4a3a0df1f57", "message": "NXP-28139: add docker and docker-json templates", "committedDate": "2020-04-25T18:20:13Z", "type": "forcePushed"}, {"oid": "8ef070990bb061b75ef982f084a1ef1b2a19a70c", "url": "https://github.com/nuxeo/nuxeo/commit/8ef070990bb061b75ef982f084a1ef1b2a19a70c", "message": "NXP-28139: add docker and docker-json templates", "committedDate": "2020-05-04T12:49:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MTE4Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423541182", "bodyText": "We should enable compact for a production configuration which is the intent of this file.\nFurthemore, I think eventEol should be enable too in order to have one log per line.\ncomplete looks like a debug option to me and shouldn't be changed:\n\nIf true, the appender includes the JSON header and footer, and comma between records. Defaults to false.", "author": "kevinleturc", "createdAt": "2020-05-12T08:06:35Z", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,208 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"ConsoleJSONAppender\" target=\"SYSTEM_OUT\">\n+        <JsonLayout complete=\"false\" compact=\"false\"/>", "originalCommit": "8ef070990bb061b75ef982f084a1ef1b2a19a70c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MTU1OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423541559", "bodyText": "This appender is not defined.", "author": "kevinleturc", "createdAt": "2020-05-12T08:07:11Z", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,208 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"ConsoleJSONAppender\" target=\"SYSTEM_OUT\">\n+        <JsonLayout complete=\"false\" compact=\"false\"/>\n+    </Console>\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <File name=\"CLUSTER\" fileName=\"${sys:nuxeo.log.dir}/cluster.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <File name=\"STORAGE\" fileName=\"${sys:nuxeo.log.dir}/storage.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+    <!-- Elasticsearch logging -->\n+    <!--\n+    <File name=\"ELASTIC\" fileName=\"${sys:nuxeo.log.dir}/elastic.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- ====================== -->\n+    <!-- More Appender examples -->\n+    <!-- ====================== -->\n+\n+    <!-- Automation Trace appender - add ref into automation.core category\n+    <RollingFile name=\"AUTOMATION\" fileName=\"${sys:nuxeo.log.dir}/automation.log\"\n+                 filePattern=\"${sys:nuxeo.log.dir}/automation-%d{yyyy-MM-dd}.log.gz\" append=\"true\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+      <CronTriggeringPolicy schedule=\"0 0 0 * * ?\" evaluateOnStartup=\"true\" />\n+      <DefaultRolloverStrategy />\n+    </RollingFile>\n+    -->\n+\n+    <!-- Buffer events and log them asynchronously\n+    <Async name=\"ASYNC\" >\n+      <AppenderRef ref=\"FILE\" />\n+      <AppenderRef ref=\"CONSOLE\" />\n+      <AppenderRef ref=\"SMTP\" />\n+    </Async>\n+    -->\n+\n+    <!-- EMail events to an administrator\n+    <SMTP name=\"SMTP\" subject=\"Tomcat Server Errors\" to=\"admin@myhost.domain.com\" from=\"nobody@myhost.domain.com\"\n+          smtpHost=\"localhost\" smtpPort=\"25\" bufferSize=\"10\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </SMTP>\n+    -->\n+\n+    <!-- Syslog events\n+    <Syslog name=\"SYSLOG\" host=\"localhost\" facility=\"LOCAL7\">\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </Syslog>\n+    -->\n+    <!-- Log events to JMS (requires a topic to be created)\n+    <JMS name=\"JMS\" destinationBindingName=\"topic/MyErrorsTopic\" factoryBindingName=\"java:/ConnectionFactory\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+    </JMS>\n+    -->\n+  </Appenders>\n+  <Loggers>\n+    <!-- ============= -->\n+    <!-- Nuxeo Loggers -->\n+    <!-- ============= -->\n+\n+    <Logger name=\"org.nuxeo\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.core.storage.dbs.DBSCachingRepository\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.ElasticSearchComponent\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditBackend\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditMigrationWork\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.platform.query.core.PageProviderClassReplacerRegistry\" level=\"warn\" />\n+\n+    <!-- Uncomment to debug fragments pre-processing\n+    <Logger name=\"org.nuxeo.runtime.deployment.preprocessor\" level=\"info\" />\n+    -->\n+    <!-- Uncomment to debug SQL statements\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" />\n+    -->\n+    <!-- Uncomment to debug concurrent session execution errors on thread\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.SessionImpl\" level=\"debug\" />\n+    -->\n+    <!-- Display INFO logs for automation traces when activated -->\n+    <!-- Add <appender-ref ref=\"AUTOMATION\" /> if using AUTOMATION appender-->\n+    <Logger name=\"org.nuxeo.ecm.automation.core\" level=\"warn\" />\n+    <!-- Display by default WARN logs for Automation Scripting -->\n+    <Logger name=\"org.nuxeo.ecm.automation.scripting\" level=\"warn\" />\n+\n+    <Logger name=\"org.nuxeo.runtime.reload\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.osgi.OSGiRuntimeService\" level=\"info\" />\n+    <!-- Uncomment for components registration info\n+    <Logger name=\"org.nuxeo.runtime.model.impl\" level=\"info\" />\n+    -->\n+    <Logger name=\"org.nuxeo.osgi.application.loader.FrameworkLoader\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.StandaloneApplication\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.FrameworkBootstrap\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.jboss.deployment.NuxeoDeployer\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.tomcat.NuxeoDeployer\" level=\"info\" />\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <Logger name=\"org.jgroups\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    <Logger name=\"org.jboss.ha\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    -->\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <Logger name=\"org.nuxeo.ecm.core.management.jtajca\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    -->\n+    <!--\n+    <Logger name=\"org.nuxeo.elasticsearch\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"ELASTIC\" />\n+    </Logger>\n+    -->\n+\n+    <!-- =================== -->\n+    <!-- Third Party Loggers -->\n+    <!-- =================== -->\n+    <Logger name=\"org.apache.catalina.loader\" level=\"warn\" additivity=\"false\">\n+      <AppenderRef ref=\"CLASSLOADER\" />", "originalCommit": "8ef070990bb061b75ef982f084a1ef1b2a19a70c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MTU5Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423541592", "bodyText": "This appender is not defined.", "author": "kevinleturc", "createdAt": "2020-05-12T08:07:15Z", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,208 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"ConsoleJSONAppender\" target=\"SYSTEM_OUT\">\n+        <JsonLayout complete=\"false\" compact=\"false\"/>\n+    </Console>\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <File name=\"CLUSTER\" fileName=\"${sys:nuxeo.log.dir}/cluster.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <File name=\"STORAGE\" fileName=\"${sys:nuxeo.log.dir}/storage.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+    <!-- Elasticsearch logging -->\n+    <!--\n+    <File name=\"ELASTIC\" fileName=\"${sys:nuxeo.log.dir}/elastic.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- ====================== -->\n+    <!-- More Appender examples -->\n+    <!-- ====================== -->\n+\n+    <!-- Automation Trace appender - add ref into automation.core category\n+    <RollingFile name=\"AUTOMATION\" fileName=\"${sys:nuxeo.log.dir}/automation.log\"\n+                 filePattern=\"${sys:nuxeo.log.dir}/automation-%d{yyyy-MM-dd}.log.gz\" append=\"true\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+      <CronTriggeringPolicy schedule=\"0 0 0 * * ?\" evaluateOnStartup=\"true\" />\n+      <DefaultRolloverStrategy />\n+    </RollingFile>\n+    -->\n+\n+    <!-- Buffer events and log them asynchronously\n+    <Async name=\"ASYNC\" >\n+      <AppenderRef ref=\"FILE\" />\n+      <AppenderRef ref=\"CONSOLE\" />\n+      <AppenderRef ref=\"SMTP\" />\n+    </Async>\n+    -->\n+\n+    <!-- EMail events to an administrator\n+    <SMTP name=\"SMTP\" subject=\"Tomcat Server Errors\" to=\"admin@myhost.domain.com\" from=\"nobody@myhost.domain.com\"\n+          smtpHost=\"localhost\" smtpPort=\"25\" bufferSize=\"10\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </SMTP>\n+    -->\n+\n+    <!-- Syslog events\n+    <Syslog name=\"SYSLOG\" host=\"localhost\" facility=\"LOCAL7\">\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </Syslog>\n+    -->\n+    <!-- Log events to JMS (requires a topic to be created)\n+    <JMS name=\"JMS\" destinationBindingName=\"topic/MyErrorsTopic\" factoryBindingName=\"java:/ConnectionFactory\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+    </JMS>\n+    -->\n+  </Appenders>\n+  <Loggers>\n+    <!-- ============= -->\n+    <!-- Nuxeo Loggers -->\n+    <!-- ============= -->\n+\n+    <Logger name=\"org.nuxeo\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.core.storage.dbs.DBSCachingRepository\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.ElasticSearchComponent\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditBackend\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditMigrationWork\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.platform.query.core.PageProviderClassReplacerRegistry\" level=\"warn\" />\n+\n+    <!-- Uncomment to debug fragments pre-processing\n+    <Logger name=\"org.nuxeo.runtime.deployment.preprocessor\" level=\"info\" />\n+    -->\n+    <!-- Uncomment to debug SQL statements\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" />\n+    -->\n+    <!-- Uncomment to debug concurrent session execution errors on thread\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.SessionImpl\" level=\"debug\" />\n+    -->\n+    <!-- Display INFO logs for automation traces when activated -->\n+    <!-- Add <appender-ref ref=\"AUTOMATION\" /> if using AUTOMATION appender-->\n+    <Logger name=\"org.nuxeo.ecm.automation.core\" level=\"warn\" />\n+    <!-- Display by default WARN logs for Automation Scripting -->\n+    <Logger name=\"org.nuxeo.ecm.automation.scripting\" level=\"warn\" />\n+\n+    <Logger name=\"org.nuxeo.runtime.reload\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.osgi.OSGiRuntimeService\" level=\"info\" />\n+    <!-- Uncomment for components registration info\n+    <Logger name=\"org.nuxeo.runtime.model.impl\" level=\"info\" />\n+    -->\n+    <Logger name=\"org.nuxeo.osgi.application.loader.FrameworkLoader\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.StandaloneApplication\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.FrameworkBootstrap\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.jboss.deployment.NuxeoDeployer\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.tomcat.NuxeoDeployer\" level=\"info\" />\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <Logger name=\"org.jgroups\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    <Logger name=\"org.jboss.ha\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    -->\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <Logger name=\"org.nuxeo.ecm.core.management.jtajca\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    -->\n+    <!--\n+    <Logger name=\"org.nuxeo.elasticsearch\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"ELASTIC\" />\n+    </Logger>\n+    -->\n+\n+    <!-- =================== -->\n+    <!-- Third Party Loggers -->\n+    <!-- =================== -->\n+    <Logger name=\"org.apache.catalina.loader\" level=\"warn\" additivity=\"false\">\n+      <AppenderRef ref=\"CLASSLOADER\" />\n+    </Logger>\n+    <Logger name=\"org.apache.catalina.core.AprLifecycleListener\" level=\"info\" additivity=\"false\">\n+      <AppenderRef ref=\"TOMCAT\" />", "originalCommit": "8ef070990bb061b75ef982f084a1ef1b2a19a70c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MjM5OA==", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423542398", "bodyText": "Appender not defined", "author": "kevinleturc", "createdAt": "2020-05-12T08:08:32Z", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,209 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"CONSOLE\" target=\"SYSTEM_OUT\">\n+      <ThresholdFilter level=\"INFO\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%c{1}] %m%n\" />\n+    </Console>\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <File name=\"CLUSTER\" fileName=\"${sys:nuxeo.log.dir}/cluster.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <File name=\"STORAGE\" fileName=\"${sys:nuxeo.log.dir}/storage.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+    <!-- Elasticsearch logging -->\n+    <!--\n+    <File name=\"ELASTIC\" fileName=\"${sys:nuxeo.log.dir}/elastic.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- ====================== -->\n+    <!-- More Appender examples -->\n+    <!-- ====================== -->\n+\n+    <!-- Automation Trace appender - add ref into automation.core category\n+    <RollingFile name=\"AUTOMATION\" fileName=\"${sys:nuxeo.log.dir}/automation.log\"\n+                 filePattern=\"${sys:nuxeo.log.dir}/automation-%d{yyyy-MM-dd}.log.gz\" append=\"true\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+      <CronTriggeringPolicy schedule=\"0 0 0 * * ?\" evaluateOnStartup=\"true\" />\n+      <DefaultRolloverStrategy />\n+    </RollingFile>\n+    -->\n+\n+    <!-- Buffer events and log them asynchronously\n+    <Async name=\"ASYNC\" >\n+      <AppenderRef ref=\"FILE\" />\n+      <AppenderRef ref=\"CONSOLE\" />\n+      <AppenderRef ref=\"SMTP\" />\n+    </Async>\n+    -->\n+\n+    <!-- EMail events to an administrator\n+    <SMTP name=\"SMTP\" subject=\"Tomcat Server Errors\" to=\"admin@myhost.domain.com\" from=\"nobody@myhost.domain.com\"\n+          smtpHost=\"localhost\" smtpPort=\"25\" bufferSize=\"10\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </SMTP>\n+    -->\n+\n+    <!-- Syslog events\n+    <Syslog name=\"SYSLOG\" host=\"localhost\" facility=\"LOCAL7\">\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </Syslog>\n+    -->\n+    <!-- Log events to JMS (requires a topic to be created)\n+    <JMS name=\"JMS\" destinationBindingName=\"topic/MyErrorsTopic\" factoryBindingName=\"java:/ConnectionFactory\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+    </JMS>\n+    -->\n+  </Appenders>\n+  <Loggers>\n+    <!-- ============= -->\n+    <!-- Nuxeo Loggers -->\n+    <!-- ============= -->\n+\n+    <Logger name=\"org.nuxeo\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.core.storage.dbs.DBSCachingRepository\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.ElasticSearchComponent\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditBackend\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditMigrationWork\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.platform.query.core.PageProviderClassReplacerRegistry\" level=\"warn\" />\n+\n+    <!-- Uncomment to debug fragments pre-processing\n+    <Logger name=\"org.nuxeo.runtime.deployment.preprocessor\" level=\"info\" />\n+    -->\n+    <!-- Uncomment to debug SQL statements\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" />\n+    -->\n+    <!-- Uncomment to debug concurrent session execution errors on thread\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.SessionImpl\" level=\"debug\" />\n+    -->\n+    <!-- Display INFO logs for automation traces when activated -->\n+    <!-- Add <appender-ref ref=\"AUTOMATION\" /> if using AUTOMATION appender-->\n+    <Logger name=\"org.nuxeo.ecm.automation.core\" level=\"warn\" />\n+    <!-- Display by default WARN logs for Automation Scripting -->\n+    <Logger name=\"org.nuxeo.ecm.automation.scripting\" level=\"warn\" />\n+\n+    <Logger name=\"org.nuxeo.runtime.reload\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.osgi.OSGiRuntimeService\" level=\"info\" />\n+    <!-- Uncomment for components registration info\n+    <Logger name=\"org.nuxeo.runtime.model.impl\" level=\"info\" />\n+    -->\n+    <Logger name=\"org.nuxeo.osgi.application.loader.FrameworkLoader\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.StandaloneApplication\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.FrameworkBootstrap\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.jboss.deployment.NuxeoDeployer\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.tomcat.NuxeoDeployer\" level=\"info\" />\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <Logger name=\"org.jgroups\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    <Logger name=\"org.jboss.ha\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    -->\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <Logger name=\"org.nuxeo.ecm.core.management.jtajca\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    -->\n+    <!--\n+    <Logger name=\"org.nuxeo.elasticsearch\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"ELASTIC\" />\n+    </Logger>\n+    -->\n+\n+    <!-- =================== -->\n+    <!-- Third Party Loggers -->\n+    <!-- =================== -->\n+    <Logger name=\"org.apache.catalina.loader\" level=\"warn\" additivity=\"false\">\n+      <AppenderRef ref=\"CLASSLOADER\" />", "originalCommit": "8ef070990bb061b75ef982f084a1ef1b2a19a70c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MjQ4Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423542483", "bodyText": "Appender not defined.", "author": "kevinleturc", "createdAt": "2020-05-12T08:08:41Z", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,209 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"CONSOLE\" target=\"SYSTEM_OUT\">\n+      <ThresholdFilter level=\"INFO\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%c{1}] %m%n\" />\n+    </Console>\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <File name=\"CLUSTER\" fileName=\"${sys:nuxeo.log.dir}/cluster.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <File name=\"STORAGE\" fileName=\"${sys:nuxeo.log.dir}/storage.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+    <!-- Elasticsearch logging -->\n+    <!--\n+    <File name=\"ELASTIC\" fileName=\"${sys:nuxeo.log.dir}/elastic.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- ====================== -->\n+    <!-- More Appender examples -->\n+    <!-- ====================== -->\n+\n+    <!-- Automation Trace appender - add ref into automation.core category\n+    <RollingFile name=\"AUTOMATION\" fileName=\"${sys:nuxeo.log.dir}/automation.log\"\n+                 filePattern=\"${sys:nuxeo.log.dir}/automation-%d{yyyy-MM-dd}.log.gz\" append=\"true\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+      <CronTriggeringPolicy schedule=\"0 0 0 * * ?\" evaluateOnStartup=\"true\" />\n+      <DefaultRolloverStrategy />\n+    </RollingFile>\n+    -->\n+\n+    <!-- Buffer events and log them asynchronously\n+    <Async name=\"ASYNC\" >\n+      <AppenderRef ref=\"FILE\" />\n+      <AppenderRef ref=\"CONSOLE\" />\n+      <AppenderRef ref=\"SMTP\" />\n+    </Async>\n+    -->\n+\n+    <!-- EMail events to an administrator\n+    <SMTP name=\"SMTP\" subject=\"Tomcat Server Errors\" to=\"admin@myhost.domain.com\" from=\"nobody@myhost.domain.com\"\n+          smtpHost=\"localhost\" smtpPort=\"25\" bufferSize=\"10\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </SMTP>\n+    -->\n+\n+    <!-- Syslog events\n+    <Syslog name=\"SYSLOG\" host=\"localhost\" facility=\"LOCAL7\">\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </Syslog>\n+    -->\n+    <!-- Log events to JMS (requires a topic to be created)\n+    <JMS name=\"JMS\" destinationBindingName=\"topic/MyErrorsTopic\" factoryBindingName=\"java:/ConnectionFactory\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+    </JMS>\n+    -->\n+  </Appenders>\n+  <Loggers>\n+    <!-- ============= -->\n+    <!-- Nuxeo Loggers -->\n+    <!-- ============= -->\n+\n+    <Logger name=\"org.nuxeo\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.core.storage.dbs.DBSCachingRepository\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.ElasticSearchComponent\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditBackend\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditMigrationWork\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.platform.query.core.PageProviderClassReplacerRegistry\" level=\"warn\" />\n+\n+    <!-- Uncomment to debug fragments pre-processing\n+    <Logger name=\"org.nuxeo.runtime.deployment.preprocessor\" level=\"info\" />\n+    -->\n+    <!-- Uncomment to debug SQL statements\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" />\n+    -->\n+    <!-- Uncomment to debug concurrent session execution errors on thread\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.SessionImpl\" level=\"debug\" />\n+    -->\n+    <!-- Display INFO logs for automation traces when activated -->\n+    <!-- Add <appender-ref ref=\"AUTOMATION\" /> if using AUTOMATION appender-->\n+    <Logger name=\"org.nuxeo.ecm.automation.core\" level=\"warn\" />\n+    <!-- Display by default WARN logs for Automation Scripting -->\n+    <Logger name=\"org.nuxeo.ecm.automation.scripting\" level=\"warn\" />\n+\n+    <Logger name=\"org.nuxeo.runtime.reload\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.osgi.OSGiRuntimeService\" level=\"info\" />\n+    <!-- Uncomment for components registration info\n+    <Logger name=\"org.nuxeo.runtime.model.impl\" level=\"info\" />\n+    -->\n+    <Logger name=\"org.nuxeo.osgi.application.loader.FrameworkLoader\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.StandaloneApplication\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.FrameworkBootstrap\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.jboss.deployment.NuxeoDeployer\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.tomcat.NuxeoDeployer\" level=\"info\" />\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <Logger name=\"org.jgroups\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    <Logger name=\"org.jboss.ha\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    -->\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <Logger name=\"org.nuxeo.ecm.core.management.jtajca\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    -->\n+    <!--\n+    <Logger name=\"org.nuxeo.elasticsearch\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"ELASTIC\" />\n+    </Logger>\n+    -->\n+\n+    <!-- =================== -->\n+    <!-- Third Party Loggers -->\n+    <!-- =================== -->\n+    <Logger name=\"org.apache.catalina.loader\" level=\"warn\" additivity=\"false\">\n+      <AppenderRef ref=\"CLASSLOADER\" />\n+    </Logger>\n+    <Logger name=\"org.apache.catalina.core.AprLifecycleListener\" level=\"info\" additivity=\"false\">\n+      <AppenderRef ref=\"TOMCAT\" />", "originalCommit": "8ef070990bb061b75ef982f084a1ef1b2a19a70c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0NDcyNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423544725", "bodyText": "The two lines preceding the one you introduced also deals with JSON and was added for NXP-25096.\nThe ticket is mainly about log4j 1 so we should be able to remove these lines.\nNote: Link the given ticket to yours as it is the same topic just a different logging backend.", "author": "kevinleturc", "createdAt": "2020-05-12T08:12:26Z", "path": "server/nuxeo-server-tomcat/src/main/assemble/assembly.xml", "diffHunk": "@@ -180,6 +180,8 @@\n         <include name=\"log4j-*\" /> <!-- log4j2 / bridges: jcl, slf4j, log4j -->\n         <include name=\"json-smart-*\" />\n         <include name=\"jsonevent-layout-*\" />\n+        <!-- install log4j2 JSON logging dependencies in container classpath -->\n+        <include name=\"jackson-*\" />", "originalCommit": "8ef070990bb061b75ef982f084a1ef1b2a19a70c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY0MjkxMA==", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423642910", "bodyText": "I added it as related to this issue explaining it was config for log4j1", "author": "NourNuxeo", "createdAt": "2020-05-12T10:54:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0NDcyNQ=="}], "type": "inlineReview"}, {"oid": "0a7822f6995c692f9609af94f5a58d79c5c1523d", "url": "https://github.com/nuxeo/nuxeo/commit/0a7822f6995c692f9609af94f5a58d79c5c1523d", "message": "NXP-28139: add docker and docker-json templates", "committedDate": "2020-05-12T10:53:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg1MzY0NA==", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r427853644", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <JsonLayout eventEol=\"true\" compact=\"true\"/>\n          \n          \n            \n                  <JsonLayout eventEol=\"true\" compact=\"true\"/>", "author": "troger", "createdAt": "2020-05-20T09:02:34Z", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,201 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"ConsoleJSONAppender\" target=\"SYSTEM_OUT\">\n+        <JsonLayout eventEol=\"true\" compact=\"true\"/>", "originalCommit": "0a7822f6995c692f9609af94f5a58d79c5c1523d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "51a03e1a50235f9e9342425058b20be2bed3acb8", "url": "https://github.com/nuxeo/nuxeo/commit/51a03e1a50235f9e9342425058b20be2bed3acb8", "message": "NXP-28139: add docker and docker-json templates", "committedDate": "2020-05-20T09:10:19Z", "type": "commit"}, {"oid": "51a03e1a50235f9e9342425058b20be2bed3acb8", "url": "https://github.com/nuxeo/nuxeo/commit/51a03e1a50235f9e9342425058b20be2bed3acb8", "message": "NXP-28139: add docker and docker-json templates", "committedDate": "2020-05-20T09:10:19Z", "type": "forcePushed"}]}