{"pr_number": 3857, "pr_title": "NXP-28790: retention management configs", "pr_createdAt": "2020-03-24T14:13:14Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3857", "timeline": [{"oid": "9123b25491f5633b0f5b0b84fe54e3b54752a680", "url": "https://github.com/nuxeo/nuxeo/commit/9123b25491f5633b0f5b0b84fe54e3b54752a680", "message": "NXP-28790: set relaxed mode as standard for retention management", "committedDate": "2020-03-24T13:12:20Z", "type": "commit"}, {"oid": "a213dfcebc7e32c15f1da0c3aa821b6e55565309", "url": "https://github.com/nuxeo/nuxeo/commit/a213dfcebc7e32c15f1da0c3aa821b6e55565309", "message": "NXP-28790: provide compliance config as a template", "committedDate": "2020-03-25T12:50:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0MjU1NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397842555", "bodyText": "Why not in the if? If the mode is not compliance, there is no need for this component to require something as it will be empty.", "author": "troger", "createdAt": "2020-03-25T13:14:22Z", "path": "packages/nuxeo-retention-package/src/main/resources/install/templates/retention/nxserver/config/retention-compliance-config.xml.nxftl", "diffHunk": "@@ -0,0 +1,23 @@\n+<?xml version=\"1.0\"?>\n+\n+<component name=\"org.nuxeo.retention.compliance.types\">\n+\n+    <require>org.nuxeo.retention.types</require>", "originalCommit": "a213dfcebc7e32c15f1da0c3aa821b6e55565309", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0ODczMQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397848731", "bodyText": "My rational here was to avoid this contribution to be loaded before retention.types since I wasn't able to be sure how template and contribs engine works and if there is any chance of that to happen.", "author": "nmpcunha", "createdAt": "2020-03-25T13:23:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0MjU1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2Nzc5NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397867795", "bodyText": "It is not possible to have that scenario? If not I'll move that line \ud83d\ude42", "author": "nmpcunha", "createdAt": "2020-03-25T13:49:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0MjU1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg3Mzg3Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397873872", "bodyText": "You're right, it's better to have the require, but it's only needed when the component is not empty, so you can move that require with the other one, inside the if. If the component is empty, we don't care if it's loaded before or after org.nuxeo.retention.types.", "author": "troger", "createdAt": "2020-03-25T13:57:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0MjU1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0Mjk2Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397842967", "bodyText": "Empty line to be removed.", "author": "troger", "createdAt": "2020-03-25T13:15:00Z", "path": "packages/nuxeo-retention-package/src/main/resources/install/templates/retention/nxserver/config/retention-compliance-config.xml.nxftl", "diffHunk": "@@ -0,0 +1,23 @@\n+<?xml version=\"1.0\"?>\n+\n+<component name=\"org.nuxeo.retention.compliance.types\">\n+\n+    <require>org.nuxeo.retention.types</require>\n+\n+<#if \"${nuxeo.retention.mode}\" == \"compliance\">\n+    <require>org.nuxeo.ecm.core.schema.TypeService</require>\n+\n+    <extension target=\"org.nuxeo.ecm.core.schema.TypeService\" point=\"schema\">\n+        <schema name=\"files\" enabled=\"false\" />\n+    </extension>\n+\n+    <extension target=\"org.nuxeo.ecm.core.schema.TypeService\" point=\"doctype\">\n+        <facet name=\"Commentable\" enabled=\"false\" />\n+        <facet name=\"Publishable\" enabled=\"false\" />\n+        <facet name=\"Versionable\" enabled=\"false\" />\n+    </extension>\n+\n+</#if>\n+\n+</component>\n+", "originalCommit": "a213dfcebc7e32c15f1da0c3aa821b6e55565309", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0OTA0Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397849043", "bodyText": "Will we have more than 2 modes? If no, I would probably go for a \"boolean\".", "author": "troger", "createdAt": "2020-03-25T13:24:06Z", "path": "packages/nuxeo-retention-package/src/main/resources/install/templates/retention/nuxeo.defaults", "diffHunk": "@@ -0,0 +1,5 @@\n+## DO NOT EDIT THIS FILE, USE nuxeo.conf  ##\n+nuxeo.template.includes=\n+retention.target=.\n+\n+nuxeo.retention.mode=standard", "originalCommit": "a213dfcebc7e32c15f1da0c3aa821b6e55565309", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg1MDgzMw==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397850833", "bodyText": "Not for now.\nAs far as I was able to understand, we can have \"booleans\" but at the end of the day they are strings, in fact.\nThis way it was to try to map directly what is on our requirements, but I would also be ok with nuxeo.retention.compliant with \"true\" or \"false\"", "author": "nmpcunha", "createdAt": "2020-03-25T13:26:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0OTA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg3NTA0OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397875049", "bodyText": "I find it easier to understand/read if it's just \"enable or not the compliance mode\" :)\nLet's add people to the conversation! WDYT @efge @RSalem07 ?", "author": "troger", "createdAt": "2020-03-25T13:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0OTA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg3NzUxMA==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397877510", "bodyText": "from my point of view, as we have only the compliance mode enable or disabled (standard) we can use boolean, which also avoid string comparaison any any typo error", "author": "RSalem07", "createdAt": "2020-03-25T14:02:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0OTA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk2ODU3NA==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397968574", "bodyText": "I'd have chosen nuxeo.retention.compliance.enabled=true/false", "author": "efge", "createdAt": "2020-03-25T15:56:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0OTA0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2NjkyNw==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r397866927", "bodyText": "needs a break line at the end of the file.", "author": "RSalem07", "createdAt": "2020-03-25T13:48:52Z", "path": "packages/nuxeo-retention-package/src/main/resources/install/templates/retention/nuxeo.defaults", "diffHunk": "@@ -0,0 +1,5 @@\n+## DO NOT EDIT THIS FILE, USE nuxeo.conf  ##\n+nuxeo.template.includes=\n+retention.target=.\n+\n+nuxeo.retention.mode=standard", "originalCommit": "a213dfcebc7e32c15f1da0c3aa821b6e55565309", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "88485d18b4e460c62d17064807aa5b7efb1e1a30", "url": "https://github.com/nuxeo/nuxeo/commit/88485d18b4e460c62d17064807aa5b7efb1e1a30", "message": "NXP-28790: provide compliance config as a template", "committedDate": "2020-03-25T16:38:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNjExNA==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r398026114", "bodyText": "Please remove the blank line before <component as well.", "author": "efge", "createdAt": "2020-03-25T17:11:55Z", "path": "packages/nuxeo-retention-package/src/main/resources/install/templates/retention/nxserver/config/retention-compliance-config.xml.nxftl", "diffHunk": "@@ -0,0 +1,19 @@\n+<?xml version=\"1.0\"?>\n+\n+<component name=\"org.nuxeo.retention.compliance.types\">", "originalCommit": "88485d18b4e460c62d17064807aa5b7efb1e1a30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyOTYzNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r398029635", "bodyText": "Can remove \ud83d\udc4d\nBut, just to clarify, it is consistent with the examples provided \ud83d\ude09", "author": "nmpcunha", "createdAt": "2020-03-25T17:16:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNjExNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNjg5Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r398026896", "bodyText": "This <require> is useless, it's implicit in the fact that we use extension points from this component.", "author": "efge", "createdAt": "2020-03-25T17:12:59Z", "path": "packages/nuxeo-retention-package/src/main/resources/install/templates/retention/nxserver/config/retention-compliance-config.xml.nxftl", "diffHunk": "@@ -0,0 +1,19 @@\n+<?xml version=\"1.0\"?>\n+\n+<component name=\"org.nuxeo.retention.compliance.types\">\n+<#if \"${nuxeo.retention.compliance.enabled}\" == \"true\">\n+    <require>org.nuxeo.retention.types</require>\n+    <require>org.nuxeo.ecm.core.schema.TypeService</require>", "originalCommit": "88485d18b4e460c62d17064807aa5b7efb1e1a30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyODQ5Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r398028492", "bodyText": "What about loading order as we discussed above? Is there any chance that this specific contribution is loaded before org.nuxeo.retention.types?", "author": "nmpcunha", "createdAt": "2020-03-25T17:15:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNjg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAzMzgwMQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3857#discussion_r398033801", "bodyText": "point is to keep <require>org.nuxeo.retention.types</require> but drop the <require>org.nuxeo.ecm.core.schema.TypeService</require>  since you're already making contributions to it", "author": "nelsonsilva", "createdAt": "2020-03-25T17:22:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNjg5Ng=="}], "type": "inlineReview"}, {"oid": "e19b0b7ba3b60ce3d9c35ab1c5318fe8c4863dd0", "url": "https://github.com/nuxeo/nuxeo/commit/e19b0b7ba3b60ce3d9c35ab1c5318fe8c4863dd0", "message": "NXP-28790: provide compliance config as a template", "committedDate": "2020-03-25T17:28:05Z", "type": "commit"}, {"oid": "e19b0b7ba3b60ce3d9c35ab1c5318fe8c4863dd0", "url": "https://github.com/nuxeo/nuxeo/commit/e19b0b7ba3b60ce3d9c35ab1c5318fe8c4863dd0", "message": "NXP-28790: provide compliance config as a template", "committedDate": "2020-03-25T17:28:05Z", "type": "forcePushed"}]}