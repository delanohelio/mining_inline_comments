{"pr_number": 4491, "pr_title": "Task nxbt 3436 remove chart dependencies", "pr_createdAt": "2020-11-24T09:08:59Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4491", "timeline": [{"oid": "6f97c09ae1f8a02329541c13c4720a583227deeb", "url": "https://github.com/nuxeo/nuxeo/commit/6f97c09ae1f8a02329541c13c4720a583227deeb", "message": "NXBT-3436: tmp - use PR chart 2.0-PR-28-30", "committedDate": "2020-11-24T09:19:12Z", "type": "forcePushed"}, {"oid": "261e777fda28f517243e0a9033c6d6997da81960", "url": "https://github.com/nuxeo/nuxeo/commit/261e777fda28f517243e0a9033c6d6997da81960", "message": "NXBT-3436: tmp - use PR chart 2.0-PR-28-30", "committedDate": "2020-11-24T23:03:51Z", "type": "forcePushed"}, {"oid": "77d85cd58cc51e51913320ff1b17e9fc4569ee43", "url": "https://github.com/nuxeo/nuxeo/commit/77d85cd58cc51e51913320ff1b17e9fc4569ee43", "message": "NXBT-3436: tmp - use PR chart 2.0-PR-28-30", "committedDate": "2020-11-24T23:10:29Z", "type": "forcePushed"}, {"oid": "2339e11837815db9a56203a00e8986235c8fed06", "url": "https://github.com/nuxeo/nuxeo/commit/2339e11837815db9a56203a00e8986235c8fed06", "message": "NXBT-3436: tmp - deploy PR preview", "committedDate": "2020-11-25T20:48:07Z", "type": "forcePushed"}, {"oid": "f6f4833dc420872b68402ce379387f177ede1cd1", "url": "https://github.com/nuxeo/nuxeo/commit/f6f4833dc420872b68402ce379387f177ede1cd1", "message": "NXBT-3436: tmp - deploy PR preview", "committedDate": "2020-11-25T22:23:58Z", "type": "forcePushed"}, {"oid": "b1f46b88bd6f4ac44b643c1ea454080fc56d84ff", "url": "https://github.com/nuxeo/nuxeo/commit/b1f46b88bd6f4ac44b643c1ea454080fc56d84ff", "message": "NXBT-3436: tmp - deploy PR preview", "committedDate": "2020-11-26T08:59:21Z", "type": "forcePushed"}, {"oid": "90e7737e540af26e45474d98b1d285d8336b53e3", "url": "https://github.com/nuxeo/nuxeo/commit/90e7737e540af26e45474d98b1d285d8336b53e3", "message": "NXBT-3436: tmp - only stage: deploy preview", "committedDate": "2020-11-26T15:27:26Z", "type": "forcePushed"}, {"oid": "c0b1f83e8eda641b961ac369320656f2b1744025", "url": "https://github.com/nuxeo/nuxeo/commit/c0b1f83e8eda641b961ac369320656f2b1744025", "message": "NXBT-3436: tmp - only stage: deploy preview", "committedDate": "2020-11-26T19:54:19Z", "type": "forcePushed"}, {"oid": "4e5d2b6e05dc02253b0fd02676d3ee5d27716c46", "url": "https://github.com/nuxeo/nuxeo/commit/4e5d2b6e05dc02253b0fd02676d3ee5d27716c46", "message": "NXBT-3436: tmp - only stage: deploy preview", "committedDate": "2020-11-26T20:31:48Z", "type": "forcePushed"}, {"oid": "907ec800e89c983a36ec715c57a81aac1804429f", "url": "https://github.com/nuxeo/nuxeo/commit/907ec800e89c983a36ec715c57a81aac1804429f", "message": "NXBT-3436: tmp - only stage: deploy preview", "committedDate": "2020-11-26T21:31:05Z", "type": "forcePushed"}, {"oid": "d0cdcf192dff373c1ea78820d8ccaf240ca02b9e", "url": "https://github.com/nuxeo/nuxeo/commit/d0cdcf192dff373c1ea78820d8ccaf240ca02b9e", "message": "NXBT-3436: tmp - only stage: deploy preview", "committedDate": "2020-11-26T21:39:54Z", "type": "forcePushed"}, {"oid": "6dbf9b476febc5ad3554afb20824c69b50d68007", "url": "https://github.com/nuxeo/nuxeo/commit/6dbf9b476febc5ad3554afb20824c69b50d68007", "message": "NXBT-3436: tmp - only stage: deploy preview", "committedDate": "2020-11-26T22:09:04Z", "type": "forcePushed"}, {"oid": "2dcefb82c14026f43f3ad862085ee7def598d2dc", "url": "https://github.com/nuxeo/nuxeo/commit/2dcefb82c14026f43f3ad862085ee7def598d2dc", "message": "NXBT-3436: tmp - only stage: deploy preview", "committedDate": "2020-11-26T22:17:52Z", "type": "forcePushed"}, {"oid": "8cf6fcaaae869c2edaf1320d782713b03a41bd85", "url": "https://github.com/nuxeo/nuxeo/commit/8cf6fcaaae869c2edaf1320d782713b03a41bd85", "message": "NXBT-3436: tmp - only stage: deploy preview", "committedDate": "2020-11-27T15:42:15Z", "type": "forcePushed"}, {"oid": "9d8204ee4e4d72f810876dcac96090fde30ae341", "url": "https://github.com/nuxeo/nuxeo/commit/9d8204ee4e4d72f810876dcac96090fde30ae341", "message": "NXBT-3436: tmp - only stage: deploy preview", "committedDate": "2020-11-27T16:31:48Z", "type": "forcePushed"}, {"oid": "fdc668141dced011b6be1ef8655fb445ae930196", "url": "https://github.com/nuxeo/nuxeo/commit/fdc668141dced011b6be1ef8655fb445ae930196", "message": "NXBT-3436: tmp - use PR chart 2.0-PR-28-XX", "committedDate": "2020-11-27T18:32:21Z", "type": "forcePushed"}, {"oid": "23fa716050f8014817ef37c34a1a5285db9ab828", "url": "https://github.com/nuxeo/nuxeo/commit/23fa716050f8014817ef37c34a1a5285db9ab828", "message": "NXBT-3436: tmp - use PR chart 2.0-PR-28-XX", "committedDate": "2020-11-27T22:20:57Z", "type": "forcePushed"}, {"oid": "3cb7666b2a0b5f39b5840dd420b7c1027aecf4d4", "url": "https://github.com/nuxeo/nuxeo/commit/3cb7666b2a0b5f39b5840dd420b7c1027aecf4d4", "message": "NXBT-3436: Remove useless kubernetes-docker-cfg secret for preview", "committedDate": "2020-11-27T22:20:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0ODE5Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/4491#discussion_r532448197", "bodyText": "Shouldn't we need to update the apiVersion to have the dependencies in this file?", "author": "kevinleturc", "createdAt": "2020-11-30T09:20:03Z", "path": "ci/helm/preview/Chart.yaml", "diffHunk": "@@ -1,5 +1,16 @@\n apiVersion: v1", "originalCommit": "3cb7666b2a0b5f39b5840dd420b7c1027aecf4d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ1Njc2Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/4491#discussion_r532456762", "bodyText": "Nope, its' resolved client side when using Helm 3.", "author": "ataillefer", "createdAt": "2020-11-30T09:33:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0ODE5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0ODkxNw==", "url": "https://github.com/nuxeo/nuxeo/pull/4491#discussion_r532448917", "bodyText": "There's missing a new line at the end of the file.", "author": "kevinleturc", "createdAt": "2020-11-30T09:21:07Z", "path": "ci/helm/preview/values.yaml", "diffHunk": "@@ -20,48 +20,41 @@ cleanup:\n \n nuxeo:\n   fullnameOverride: nuxeo-preview\n-  nuxeo:\n-    podLabels:\n+  image:\n+    repository: \"$DOCKER_REGISTRY/nuxeo/nuxeo\"\n+    tag: \"$VERSION\"\n+    pullSecrets:\n+    - name: kubernetes-docker-cfg\n+  podLabels:\n+    branch: \"$BRANCH_NAME\"\n+    team: platform\n+    resource: pod\n+    usage: \"$USAGE\"\n+  service:\n+    annotations:\n+      fabric8.io/expose: \"true\"\n+    labels:\n       branch: \"$BRANCH_NAME\"\n       team: platform\n-      resource: pod\n-      usage: preview\n-    service:\n-      annotations:\n-        fabric8.io/ingress.annotations: |-\n-          nginx.ingress.kubernetes.io/proxy-body-size: 0\n-          nginx.ingress.kubernetes.io/server-snippet: ignore_invalid_headers off;\n-      labels:\n-        branch: \"$BRANCH_NAME\"\n-        team: platform\n-        resource: service\n-        usage: preview\n-    image:\n-      repository: $DOCKER_REGISTRY/nuxeo/nuxeo\n-      tag: $VERSION\n-      pullSecrets: kubernetes-docker-cfg\n-    persistence:\n-      enabled: $PERSISTENCE\n+      resource: service\n+      usage: \"$USAGE\"\n   mongodb:\n-    deploy: $PERSISTENCE\n-    useStatefulSet: $PERSISTENCE\n+    enabled: $PERSISTENCE\n+    host: \"mongodb.$PREVIEW_NAMESPACE.svc.cluster.local\"\n+  elasticsearch:\n+    enabled: $PERSISTENCE\n+    host: \"elasticsearch-master.$PREVIEW_NAMESPACE.svc.cluster.local\"\n+  persistentVolumeStorage:\n+    enabled: $PERSISTENCE\n+    size: \"100Mi\"\n+  logs:\n     persistence:\n       enabled: $PERSISTENCE\n-    labels:\n-      branch: \"$BRANCH_NAME\"\n-      resource: deployment\n-      team: platform\n-      usage: preview\n-    podLabels:\n-      branch: \"$BRANCH_NAME\"\n-      resource: pod\n-      team: platform\n-      usage: preview\n-  elasticsearch:\n-    deploy: $PERSISTENCE\n-    master:\n-      persistence:\n-        enabled: $PERSISTENCE\n-    data:\n-      persistence:\n-        enabled: $PERSISTENCE\n+      size: \"100Mi\"\n+  nodeSelector:\n+    team: platform\n+  tolerations:\n+  - effect: NoSchedule\n+    key: team\n+    operator: Equal\n+    value: platform", "originalCommit": "3cb7666b2a0b5f39b5840dd420b7c1027aecf4d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0OTExOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4491#discussion_r532449119", "bodyText": "There's missing a new line at the end of the file.", "author": "kevinleturc", "createdAt": "2020-11-30T09:21:29Z", "path": "ci/helm/values-elasticsearch.yaml", "diffHunk": "@@ -0,0 +1,32 @@\n+image: \"docker.elastic.co/elasticsearch/elasticsearch-oss\"\n+clusterName: elasticsearch\n+replicas: 1\n+minimumMasterNodes: 1\n+persistence:\n+  enabled: $PERSISTENCE\n+resources:\n+  requests:\n+    cpu: \"250m\"\n+    memory: \"1024Mi\"\n+  limits:\n+    cpu: \"500m\"\n+    memory: \"1024Mi\"\n+esJavaOpts: \"-Xmx380m -Xms380m\"\n+labels:\n+  branch: \"$BRANCH_NAME\"\n+  resource: pod\n+  team: platform\n+  usage: \"$USAGE\"\n+service:\n+  labels:\n+    branch: \"$BRANCH_NAME\"\n+    resource: service\n+    team: platform\n+    usage: \"$USAGE\"\n+tolerations:\n+  - key: team\n+    operator: Equal\n+    value: platform\n+    effect: NoSchedule\n+nodeSelector:\n+  team: platform", "originalCommit": "3cb7666b2a0b5f39b5840dd420b7c1027aecf4d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "19dfae6990684b9300b603f7b9b3268e6404f33c", "url": "https://github.com/nuxeo/nuxeo/commit/19dfae6990684b9300b603f7b9b3268e6404f33c", "message": "NXBT-3436: Remove useless kubernetes-docker-cfg secret for preview", "committedDate": "2020-11-30T09:36:16Z", "type": "forcePushed"}, {"oid": "f129eb6c94dc088dc60a825cff4b5408d05b717a", "url": "https://github.com/nuxeo/nuxeo/commit/f129eb6c94dc088dc60a825cff4b5408d05b717a", "message": "NXBT-3436: Make sure the test/preview namespace is always deleted in case of failure", "committedDate": "2020-11-30T09:36:16Z", "type": "forcePushed"}, {"oid": "00ceae9bb9e3df27c8efe70d86af186d7edab154", "url": "https://github.com/nuxeo/nuxeo/commit/00ceae9bb9e3df27c8efe70d86af186d7edab154", "message": "NXBT-3436: tmp - test PR preview with PR nuxeo chart", "committedDate": "2020-12-07T18:22:16Z", "type": "forcePushed"}, {"oid": "743724983adf181da53934040344495994a78984", "url": "https://github.com/nuxeo/nuxeo/commit/743724983adf181da53934040344495994a78984", "message": "NXBT-3436: tmp - preview stage only", "committedDate": "2020-12-08T09:16:45Z", "type": "forcePushed"}, {"oid": "fbc34335694396c4aa1564e92102a6886b16e60c", "url": "https://github.com/nuxeo/nuxeo/commit/fbc34335694396c4aa1564e92102a6886b16e60c", "message": "NXBT-3436: tmp - preview stage only", "committedDate": "2020-12-08T09:49:06Z", "type": "forcePushed"}, {"oid": "b630d264029c1aa138710defe0933ce2d8ea48b1", "url": "https://github.com/nuxeo/nuxeo/commit/b630d264029c1aa138710defe0933ce2d8ea48b1", "message": "NXBT-3436: tmp - preview stage only", "committedDate": "2020-12-08T11:16:51Z", "type": "forcePushed"}, {"oid": "ef3aa19b9be96f0059bcbd1b55267e6696ae2a19", "url": "https://github.com/nuxeo/nuxeo/commit/ef3aa19b9be96f0059bcbd1b55267e6696ae2a19", "message": "NXBT-3436: tmp - preview stage only", "committedDate": "2020-12-08T11:35:12Z", "type": "forcePushed"}, {"oid": "b4a3b66b9f7403a570b1fff077b3200ab2c3d4ff", "url": "https://github.com/nuxeo/nuxeo/commit/b4a3b66b9f7403a570b1fff077b3200ab2c3d4ff", "message": "NXBT-3436: tmp - preview stage only", "committedDate": "2020-12-08T14:12:29Z", "type": "forcePushed"}, {"oid": "39e177edfef30ee67f383c082760198f7df7fcc3", "url": "https://github.com/nuxeo/nuxeo/commit/39e177edfef30ee67f383c082760198f7df7fcc3", "message": "NXBT-3436: tmp - preview stage only", "committedDate": "2020-12-08T14:30:31Z", "type": "forcePushed"}, {"oid": "5810a8e1185021947fc0a701bcd717d2a49760a8", "url": "https://github.com/nuxeo/nuxeo/commit/5810a8e1185021947fc0a701bcd717d2a49760a8", "message": "NXBT-3436: Align on nuxeo Helm chart 2.0.0\n\n- External dependencies have been removed, must be installed separately for unit tests and preview.\n- Use Helm 3 instead of Helm 2 and `jx step helm`.\n- Don't rely on a preview chart with exposecontroller, simply install the nxueo chart with ingress enabled.", "committedDate": "2020-12-08T14:38:32Z", "type": "commit"}, {"oid": "eebf79ba450f8d7809e505a316f70042655939bd", "url": "https://github.com/nuxeo/nuxeo/commit/eebf79ba450f8d7809e505a316f70042655939bd", "message": "NXBT-3436: Make sure the test namespace is always deleted in case of failure", "committedDate": "2020-12-08T14:38:32Z", "type": "commit"}, {"oid": "d67b2a1b806bec02bc9f46316e45158f51c27ed5", "url": "https://github.com/nuxeo/nuxeo/commit/d67b2a1b806bec02bc9f46316e45158f51c27ed5", "message": "NXBT-3436: tmp - preview stage only", "committedDate": "2020-12-08T14:38:32Z", "type": "forcePushed"}, {"oid": "eebf79ba450f8d7809e505a316f70042655939bd", "url": "https://github.com/nuxeo/nuxeo/commit/eebf79ba450f8d7809e505a316f70042655939bd", "message": "NXBT-3436: Make sure the test namespace is always deleted in case of failure", "committedDate": "2020-12-08T14:38:32Z", "type": "forcePushed"}]}