{"pr_number": 3694, "pr_title": "fix-NXP-28462-html-preview", "pr_createdAt": "2020-01-23T18:54:32Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3694", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5OTI3Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/3694#discussion_r370299273", "bodyText": "Why is a document needed?", "author": "ataillefer", "createdAt": "2020-01-23T19:02:57Z", "path": "nuxeo-features/preview/nuxeo-preview-core/src/test/java/org/nuxeo/ecm/platform/preview/tests/adapter/TestPreviewAdapter.java", "diffHunk": "@@ -152,4 +156,18 @@ public void testFolderishDocument() throws Exception {\n         assertNotNull(adapter);\n     }\n \n+    @Test\n+    public void testConvertTextToHtml() throws IOException {\n+        Blob blob = new StringBlob(\"thisismytest\", \"text/plain\");\n+        DocumentModel doc = session.createDocumentModel(\"File\");", "originalCommit": "9d307846cdee0deece09e2bdb723fd303857aebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDU2NDgwOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3694#discussion_r370564809", "bodyText": "Indeed it's not, thanks.", "author": "efge", "createdAt": "2020-01-24T10:26:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5OTI3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwMDg0NA==", "url": "https://github.com/nuxeo/nuxeo/pull/3694#discussion_r370300844", "bodyText": "Why not init(List.of(blob) since this is master?\nOr do we need a mutable list?", "author": "ataillefer", "createdAt": "2020-01-23T19:06:21Z", "path": "nuxeo-core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/blobholder/SimpleBlobHolder.java", "diffHunk": "@@ -58,6 +59,11 @@ protected void init(List<Blob> blobs) {\n         creationDate = Calendar.getInstance();\n     }\n \n+    @Override\n+    public void setBlob(Blob blob) {\n+        init(new ArrayList<>(Arrays.asList(blob)));", "originalCommit": "9d307846cdee0deece09e2bdb723fd303857aebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDU2NTM5Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/3694#discussion_r370565397", "bodyText": "I'm not certain if we do but for anything that requires backports I'm using Java 8 syntax and being conservative with semantics (the existing constructor uses a mutable list).", "author": "efge", "createdAt": "2020-01-24T10:27:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwMDg0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDU2ODE1Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/3694#discussion_r370568157", "bodyText": "OK, right about keeping semantics.\nThough, I think we could have a wider discussion about using or not Java 11 features/syntax on master for issues that require backports. I think that in some cases we should allow us to use different code, to improve master. But this case is not a good example for sure.", "author": "ataillefer", "createdAt": "2020-01-24T10:34:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwMDg0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUxMjYwMw==", "url": "https://github.com/nuxeo/nuxeo/pull/3694#discussion_r370512603", "bodyText": "can we pass an empty map (Map.of, Collections.emptyMap()) instead of null on the map parameter", "author": "RSalem07", "createdAt": "2020-01-24T08:13:14Z", "path": "nuxeo-features/preview/nuxeo-preview-core/src/test/java/org/nuxeo/ecm/platform/preview/tests/adapter/TestPreviewAdapter.java", "diffHunk": "@@ -152,4 +156,18 @@ public void testFolderishDocument() throws Exception {\n         assertNotNull(adapter);\n     }\n \n+    @Test\n+    public void testConvertTextToHtml() throws IOException {\n+        Blob blob = new StringBlob(\"thisismytest\", \"text/plain\");\n+        DocumentModel doc = session.createDocumentModel(\"File\");\n+        doc.setPropertyValue(\"file:content\", (Serializable) blob);\n+        // convert using SimpleBlobHolder (like ConvertAdapter)\n+        BlobHolder blobHolder = new SimpleBlobHolder(blob);\n+        BlobHolder res = conversionService.convertToMimeType(\"text/html\", blobHolder , null);", "originalCommit": "9d307846cdee0deece09e2bdb723fd303857aebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDU2NTczMA==", "url": "https://github.com/nuxeo/nuxeo/pull/3694#discussion_r370565730", "bodyText": "null is accepted and turned into an empty map later on in the call stack.", "author": "efge", "createdAt": "2020-01-24T10:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUxMjYwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUxMzQ1Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/3694#discussion_r370513457", "bodyText": "we can use the constructor with single parameter (which use text/plain mime type internally):\nBlob blob = new StringBlob(\"thisismytest\", \"text/plain\"); ->  Blob blob = new StringBlob(\"thisismytest\");", "author": "RSalem07", "createdAt": "2020-01-24T08:16:01Z", "path": "nuxeo-features/preview/nuxeo-preview-core/src/test/java/org/nuxeo/ecm/platform/preview/tests/adapter/TestPreviewAdapter.java", "diffHunk": "@@ -152,4 +156,18 @@ public void testFolderishDocument() throws Exception {\n         assertNotNull(adapter);\n     }\n \n+    @Test\n+    public void testConvertTextToHtml() throws IOException {\n+        Blob blob = new StringBlob(\"thisismytest\", \"text/plain\");\n+        DocumentModel doc = session.createDocumentModel(\"File\");", "originalCommit": "9d307846cdee0deece09e2bdb723fd303857aebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDU2NjA3Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3694#discussion_r370566072", "bodyText": "We could but I want to be explicit about the MIME type here given that it's what the test is about.", "author": "efge", "createdAt": "2020-01-24T10:29:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUxMzQ1Nw=="}], "type": "inlineReview"}, {"oid": "93470d77a9d4e836ed3dc157cac4434bc6cf821b", "url": "https://github.com/nuxeo/nuxeo/commit/93470d77a9d4e836ed3dc157cac4434bc6cf821b", "message": "NXP-28462: fix error on HTML preview", "committedDate": "2020-01-24T10:30:46Z", "type": "commit"}, {"oid": "93470d77a9d4e836ed3dc157cac4434bc6cf821b", "url": "https://github.com/nuxeo/nuxeo/commit/93470d77a9d4e836ed3dc157cac4434bc6cf821b", "message": "NXP-28462: fix error on HTML preview", "committedDate": "2020-01-24T10:30:46Z", "type": "forcePushed"}]}