{"pr_number": 3999, "pr_title": "improvement-NXP-28849-Make-ColdStorage-an-addon", "pr_createdAt": "2020-05-04T19:28:46Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3999", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE3NTg5Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420175896", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <description>Nuxo cold storage allows the cold storage of document content. This can be needed for archiving,\n          \n          \n            \n              <description>Nuxeo cold storage allows the cold storage of document content. This can be needed for archiving,", "author": "troger", "createdAt": "2020-05-05T14:57:30Z", "path": "modules/platform/nuxeo-coldstorage/pom.xml", "diffHunk": "@@ -0,0 +1,51 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <groupId>org.nuxeo.ecm.platform</groupId>\n+    <artifactId>nuxeo-platform-parent</artifactId>\n+    <version>11.1-SNAPSHOT</version>\n+  </parent>\n+\n+  <groupId>org.nuxeo</groupId>\n+  <artifactId>nuxeo-coldstorage</artifactId>\n+  <name>Nuxeo cold storage</name>\n+  <description>Nuxo cold storage allows the cold storage of document content. This can be needed for archiving,", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4MDc3Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420180772", "bodyText": "Is he aware? :p", "author": "troger", "createdAt": "2020-05-05T15:04:02Z", "path": "modules/platform/nuxeo-coldstorage/src/main/java/org/nuxeo/coldstorage/helpers/ColdStorageHelper.java", "diffHunk": "@@ -15,10 +15,9 @@\n  *\n  * Contributors:\n  *     Salem Aouana\n- *     Nuno Cunha <ncunha@nuxeo.com>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4MjgwNw==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420182807", "bodyText": "Not needed.", "author": "troger", "createdAt": "2020-05-05T15:06:47Z", "path": "modules/platform/nuxeo-coldstorage/src/main/java/org/nuxeo/coldstorage/events/CheckColdStorageContentAvailabilityListener.java", "diffHunk": "@@ -12,20 +12,20 @@\n  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n- *\n+ *  ", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4Mzk3MA==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420183970", "bodyText": "You probably don't need that.", "author": "troger", "createdAt": "2020-05-05T15:08:17Z", "path": "modules/platform/nuxeo-coldstorage/src/main/resources/OSGI-INF/coldstorage-core-types-contrib.xml", "diffHunk": "@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\"?>\n+<component name=\"org.nuxeo.retention.types\">\n+\n+  <require>org.nuxeo.ecm.core.CoreExtensions</require>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NDU1Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420184557", "bodyText": "Not needed, it should be implicit when contributing to the component.", "author": "troger", "createdAt": "2020-05-05T15:09:04Z", "path": "modules/platform/nuxeo-coldstorage/src/main/resources/OSGI-INF/coldstorage-events-contrib.xml", "diffHunk": "@@ -1,6 +1,7 @@\n <?xml version=\"1.0\"?>\n-<component name=\"org.nuxeo.ecm.core.coldstorage.contrib\">\n+<component name=\"org.nuxeo.coldstorage.events.contrib\">\n \n+  <require>org.nuxeo.ecm.core.scheduler.SchedulerService</require>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NDY1NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420184655", "bodyText": "Same as above.", "author": "troger", "createdAt": "2020-05-05T15:09:11Z", "path": "modules/platform/nuxeo-coldstorage/src/main/resources/OSGI-INF/coldstorage-events-contrib.xml", "diffHunk": "@@ -9,17 +10,19 @@\n     </schedule>\n   </extension>\n \n+  <require>org.nuxeo.ecm.core.event.EventServiceComponent</require>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NDc4NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420184785", "bodyText": "Same as above.", "author": "troger", "createdAt": "2020-05-05T15:09:20Z", "path": "modules/platform/nuxeo-coldstorage/src/main/resources/OSGI-INF/coldstorage-events-contrib.xml", "diffHunk": "@@ -9,17 +10,19 @@\n     </schedule>\n   </extension>\n \n+  <require>org.nuxeo.ecm.core.event.EventServiceComponent</require>\n   <extension target=\"org.nuxeo.ecm.core.event.EventServiceComponent\" point=\"listener\">\n     <listener name=\"checkColdStorageContentAvailability\"\n-              class=\"org.nuxeo.ecm.core.coldstorage.CheckColdStorageContentAvailabilityListener\">\n+              class=\"org.nuxeo.coldstorage.events.CheckColdStorageContentAvailabilityListener\">\n       <event>checkColdStorageContentAvailability</event>\n     </listener>\n     <listener name=\"checkUpdateMainContentInColdStorage\"\n-              class=\"org.nuxeo.ecm.core.coldstorage.CheckUpdateMainContentInColdStorage\">\n+              class=\"org.nuxeo.coldstorage.events.CheckUpdateMainContentInColdStorage\">\n       <event>beforeDocumentModification</event>\n     </listener>\n   </extension>\n \n+  <require>org.nuxeo.ecm.platform.ec.notification.service.NotificationService</require>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NDkxNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420184915", "bodyText": "Not needed.", "author": "troger", "createdAt": "2020-05-05T15:09:30Z", "path": "modules/platform/nuxeo-coldstorage/src/main/resources/OSGI-INF/coldstorage-operations-contrib.xml", "diffHunk": "@@ -0,0 +1,11 @@\n+<?xml version=\"1.0\"?>\n+<component name=\"org.nuxeo.coldstorage.operations.contrib\" version=\"1.0\">\n+\n+  <require>org.nuxeo.ecm.core.operation.OperationServiceComponent</require>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NjMwMw==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420186303", "bodyText": "\ud83d\ude04", "author": "troger", "createdAt": "2020-05-05T15:11:21Z", "path": "modules/platform/nuxeo-coldstorage/src/test/java/org/nuxeo/coldstorage/operations/MoveToColdStorageTest.java", "diffHunk": "@@ -15,10 +15,9 @@\n  *\n  * Contributors:\n  *     Salem Aouana\n- *     Nuno Cunha <ncunha@nuxeo.com>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NjU1Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420186553", "bodyText": "Not needed.", "author": "troger", "createdAt": "2020-05-05T15:11:42Z", "path": "modules/platform/nuxeo-coldstorage/src/test/resources/META-INF/MANIFEST.MF", "diffHunk": "@@ -0,0 +1,11 @@\n+Manifest-Version: 1.0\n+Bundle-ManifestVersion: 2\n+Bundle-Name: Nuxeo Cold Storage Test\n+Bundle-SymbolicName: org.nuxeo.coldstorage.test;singleton:=true\n+Bundle-Vendor: Nuxeo\n+Bundle-Localization: bundle\n+Eclipse-LazyStart: true\n+Nuxeo-Component: OSGI-INF/test-coldstorage-contrib.xml,\n+ OSGI-INF/test-dummy-thumbnail-factory-contrib.xml\n+\n+", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NjkxNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420186915", "bodyText": "Not sure you need this file at all.", "author": "troger", "createdAt": "2020-05-05T15:12:09Z", "path": "modules/platform/nuxeo-coldstorage/src/test/resources/META-INF/MANIFEST.MF", "diffHunk": "@@ -0,0 +1,11 @@\n+Manifest-Version: 1.0", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY2MTQ1OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420661459", "bodyText": "currently the defined test bundle is used in ColdStorageFeature", "author": "RSalem07", "createdAt": "2020-05-06T09:34:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NjkxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NzU0Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420187547", "bodyText": "Could you sort it alphabetically as other modules?", "author": "troger", "createdAt": "2020-05-05T15:13:00Z", "path": "modules/platform/pom.xml", "diffHunk": "@@ -116,6 +116,7 @@\n     <module>nuxeo-webengine</module>\n     <module>nuxeo-wopi</module>\n     <module>rest-api</module>\n+    <module>nuxeo-coldstorage</module>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4ODEyNw==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420188127", "bodyText": "What is this file for?", "author": "troger", "createdAt": "2020-05-05T15:13:48Z", "path": "packages/nuxeo-coldstorage-package/src/main/resources/install.templates.coldstorage/nuxeo.defaults", "diffHunk": "@@ -0,0 +1,3 @@\n+## DO NOT EDIT THIS FILE, USE nuxeo.conf  ##", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY2MzkyNA==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420663924", "bodyText": "I was thinking that file should be added even empty", "author": "RSalem07", "createdAt": "2020-05-06T09:39:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4ODEyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDcxNDAzMA==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420714030", "bodyText": "If there is no template needed, the file is not needed.\nBTW, even if the file should be here, it should not be in install.templates.coldstorage/ but in install/templates/coldstorage/ to actually make it work\n=> it's really not needed :p", "author": "troger", "createdAt": "2020-05-06T11:17:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4ODEyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4OTI2NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420189265", "bodyText": "Sort it.", "author": "troger", "createdAt": "2020-05-05T15:15:24Z", "path": "packages/pom.xml", "diffHunk": "@@ -43,6 +43,7 @@\n     <module>nuxeo-template-rendering-package</module>\n     <module>nuxeo-tree-snapshot-package</module>\n     <module>nuxeo-wopi-package</module>\n+    <module>nuxeo-coldstorage-package</module>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4OTc5NA==", "url": "https://github.com/nuxeo/nuxeo/pull/3999#discussion_r420189794", "bodyText": "Sort it alphabetically, and missing type zip.", "author": "troger", "createdAt": "2020-05-05T15:16:09Z", "path": "pom.xml", "diffHunk": "@@ -2151,6 +2158,11 @@\n         <version>${nuxeo.platform.version}</version>\n         <type>zip</type>\n       </dependency>\n+      <dependency>\n+        <groupId>org.nuxeo.packages</groupId>\n+        <artifactId>nuxeo-coldstorage-package</artifactId>\n+        <version>${nuxeo.platform.version}</version>\n+      </dependency>", "originalCommit": "87df1d3cc43a6e3276b870aae4a523bba2ac9009", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d8afca9a888c6b28357f67630b83bcb24c1dec88", "url": "https://github.com/nuxeo/nuxeo/commit/d8afca9a888c6b28357f67630b83bcb24c1dec88", "message": "NXP-28849: Make ColdStorage an addon", "committedDate": "2020-05-06T13:00:34Z", "type": "forcePushed"}, {"oid": "013714853c3b88423ac934289627d6b1a5729c88", "url": "https://github.com/nuxeo/nuxeo/commit/013714853c3b88423ac934289627d6b1a5729c88", "message": "NXP-28849: Make ColdStorage an addon", "committedDate": "2020-05-06T13:05:24Z", "type": "commit"}, {"oid": "013714853c3b88423ac934289627d6b1a5729c88", "url": "https://github.com/nuxeo/nuxeo/commit/013714853c3b88423ac934289627d6b1a5729c88", "message": "NXP-28849: Make ColdStorage an addon", "committedDate": "2020-05-06T13:05:24Z", "type": "forcePushed"}]}