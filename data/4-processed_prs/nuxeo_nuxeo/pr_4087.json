{"pr_number": 4087, "pr_title": "10.10 hf/fix nxp 28798 task endpoint fail gracefully when missing doc route", "pr_createdAt": "2020-05-28T10:33:52Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4087", "timeline": [{"oid": "c2234101827a0e2d2fc409be2bab71e304190dcf", "url": "https://github.com/nuxeo/nuxeo/commit/c2234101827a0e2d2fc409be2bab71e304190dcf", "message": "NXP-28798: Gracefully log missing DocumentRoutes", "committedDate": "2020-05-28T10:33:09Z", "type": "commit"}, {"oid": "cbea24f3686ed02e6aa2a33253e364e20d5ddf3e", "url": "https://github.com/nuxeo/nuxeo/commit/cbea24f3686ed02e6aa2a33253e364e20d5ddf3e", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script", "committedDate": "2020-06-04T09:55:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc2MDQ2Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4087#discussion_r436760463", "bodyText": "Should be before the while.", "author": "troger", "createdAt": "2020-06-08T14:40:04Z", "path": "nuxeo-distribution/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,37 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+\n+def log = LogManager.getLogger(\"deleteOrphanTasks.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    def cache = [:]", "originalCommit": "cbea24f3686ed02e6aa2a33253e364e20d5ddf3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a2977ea467632f7908bef54d98153aed11fab6d9", "url": "https://github.com/nuxeo/nuxeo/commit/a2977ea467632f7908bef54d98153aed11fab6d9", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script", "committedDate": "2020-06-08T14:52:40Z", "type": "forcePushed"}, {"oid": "c7af3580e4d48927aa7db4117068e0395429bd74", "url": "https://github.com/nuxeo/nuxeo/commit/c7af3580e4d48927aa7db4117068e0395429bd74", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script", "committedDate": "2020-06-09T10:38:28Z", "type": "commit"}, {"oid": "c7af3580e4d48927aa7db4117068e0395429bd74", "url": "https://github.com/nuxeo/nuxeo/commit/c7af3580e4d48927aa7db4117068e0395429bd74", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script", "committedDate": "2020-06-09T10:38:28Z", "type": "forcePushed"}]}