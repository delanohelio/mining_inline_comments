{"pr_number": 3947, "pr_title": "NXP-28532: mention failing doc id and property when reindexing ES", "pr_createdAt": "2020-04-20T13:07:09Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3947", "timeline": [{"oid": "c77d0c64b54447ce05afec70ff239f53403654c3", "url": "https://github.com/nuxeo/nuxeo/commit/c77d0c64b54447ce05afec70ff239f53403654c3", "message": "NXP-28532: mention failing doc id and property when reindexing ES", "committedDate": "2020-04-20T13:07:48Z", "type": "forcePushed"}, {"oid": "eded036c968cc05ebdc49c8f740ef32990057964", "url": "https://github.com/nuxeo/nuxeo/commit/eded036c968cc05ebdc49c8f740ef32990057964", "message": "NXP-28532: mention failing doc id and property when reindexing ES", "committedDate": "2020-04-20T14:13:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ0Nzg4Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/3947#discussion_r411447887", "bodyText": "You can do directly throw new NuxeoException(message, e), no need for addInfo which is only useful if you rethrow the same NuxeoException that you caught.", "author": "efge", "createdAt": "2020-04-20T14:58:22Z", "path": "modules/platform/nuxeo-elasticsearch/nuxeo-elasticsearch-core/src/main/java/org/nuxeo/elasticsearch/io/JsonESDocumentWriter.java", "diffHunk": "@@ -212,7 +217,14 @@ protected static void writeProperties(JsonGenerator jg, DocumentModel doc, Strin\n         }\n \n         for (Property p : properties) {\n-            writer.writeProperty(jg, p);\n+            try {\n+                writer.writeProperty(jg, p);\n+            } catch (ClassCastException e) {\n+                var nuxeoException = new NuxeoException(e);\n+                nuxeoException.addInfo(\n+                        String.format(\"writing JSON property failed on document: %s for property: %s\", doc, p));", "originalCommit": "eded036c968cc05ebdc49c8f740ef32990057964", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e7560624c2c72c2ee895dbca809c650d75839e1a", "url": "https://github.com/nuxeo/nuxeo/commit/e7560624c2c72c2ee895dbca809c650d75839e1a", "message": "NXP-28532: mention failing doc id and property when reindexing ES", "committedDate": "2020-04-20T15:17:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxNDk3Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3947#discussion_r412214972", "bodyText": "Please keep the original exception as last argument when throwing a new one.", "author": "efge", "createdAt": "2020-04-21T14:05:44Z", "path": "modules/platform/nuxeo-elasticsearch/nuxeo-elasticsearch-core/src/main/java/org/nuxeo/elasticsearch/io/JsonESDocumentWriter.java", "diffHunk": "@@ -212,7 +217,12 @@ protected static void writeProperties(JsonGenerator jg, DocumentModel doc, Strin\n         }\n \n         for (Property p : properties) {\n-            writer.writeProperty(jg, p);\n+            try {\n+                writer.writeProperty(jg, p);\n+            } catch (ClassCastException e) {\n+                throw new NuxeoException(\n+                        String.format(\"writing JSON property failed on document: %s for property: %s\", doc, p));", "originalCommit": "e7560624c2c72c2ee895dbca809c650d75839e1a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMDE5Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3947#discussion_r412220192", "bodyText": "Yes sorry about that. Fixed", "author": "NourNuxeo", "createdAt": "2020-04-21T14:11:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxNDk3Mg=="}], "type": "inlineReview"}, {"oid": "e465cd1997ee3cd0c75a7562d5eb1a849a47f246", "url": "https://github.com/nuxeo/nuxeo/commit/e465cd1997ee3cd0c75a7562d5eb1a849a47f246", "message": "NXP-28532: mention failing doc id and property when reindexing ES", "committedDate": "2020-04-21T14:11:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTc0OA==", "url": "https://github.com/nuxeo/nuxeo/pull/3947#discussion_r413581748", "bodyText": "Doesn't seem used.", "author": "kevinleturc", "createdAt": "2020-04-23T07:36:42Z", "path": "modules/platform/nuxeo-elasticsearch/nuxeo-elasticsearch-core/src/main/java/org/nuxeo/elasticsearch/io/JsonESDocumentWriter.java", "diffHunk": "@@ -59,6 +62,8 @@\n  */\n public class JsonESDocumentWriter {\n \n+    private static final Logger log = LogManager.getLogger(JsonESDocumentWriter.class);", "originalCommit": "e465cd1997ee3cd0c75a7562d5eb1a849a47f246", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYzNjI2Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/3947#discussion_r413636266", "bodyText": "yes not anymore. Removing \ud83d\ude2c", "author": "NourNuxeo", "createdAt": "2020-04-23T08:54:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTc0OA=="}], "type": "inlineReview"}, {"oid": "d27f43df67798968d88b11b63d6df1e6a771a553", "url": "https://github.com/nuxeo/nuxeo/commit/d27f43df67798968d88b11b63d6df1e6a771a553", "message": "NXP-28532: mention failing doc id and property when reindexing ES", "committedDate": "2020-04-23T08:55:08Z", "type": "commit"}, {"oid": "d27f43df67798968d88b11b63d6df1e6a771a553", "url": "https://github.com/nuxeo/nuxeo/commit/d27f43df67798968d88b11b63d6df1e6a771a553", "message": "NXP-28532: mention failing doc id and property when reindexing ES", "committedDate": "2020-04-23T08:55:08Z", "type": "forcePushed"}]}