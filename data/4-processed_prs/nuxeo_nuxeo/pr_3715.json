{"pr_number": 3715, "pr_title": "fix-NXP-26003-userworkspace", "pr_createdAt": "2020-01-31T21:08:54Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3715", "timeline": [{"oid": "f670fe467598f735a3cf0e45e369a25cb259ebc6", "url": "https://github.com/nuxeo/nuxeo/commit/f670fe467598f735a3cf0e45e369a25cb259ebc6", "message": "NXP-26003: cleanup/format", "committedDate": "2020-01-31T16:10:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk5NDMyOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3715#discussion_r373994329", "bodyText": "Can be replaced by:\n        if (principal == null) {\n            principal = Framework.getService(UserManager.class).getPrincipal(username);\n        }", "author": "ThierryCasanova", "createdAt": "2020-02-03T09:24:28Z", "path": "nuxeo-features/nuxeo-platform-userworkspace/nuxeo-platform-userworkspace-core/src/main/java/org/nuxeo/ecm/platform/userworkspace/core/service/AbstractUserWorkspaceImpl.java", "diffHunk": "@@ -267,11 +265,17 @@ protected PathRef getExistingUserWorkspaceRoot(CoreSession session, String usern\n \n     protected PathRef getExistingUserWorkspace(CoreSession session, PathRef rootref, NuxeoPrincipal principal,\n             String username) {\n+        // try fetching a Principal for the session.hasPermission check\n+        UserManager userManager = Framework.getService(UserManager.class);\n+        if (principal == null) {\n+            principal = userManager.getPrincipal(username);\n+        }\n+", "originalCommit": "679002b7dcd0812808b3549a3ec2b88e9c68176b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "994c0ecb303ab5ed0670cf9512b88beb538a1132", "url": "https://github.com/nuxeo/nuxeo/commit/994c0ecb303ab5ed0670cf9512b88beb538a1132", "message": "NXP-26003: do not use the session principal when checking permission on a UserWorkspace\n\nDepending of the caller, the given CoreSession could be an unrestricted one, so the\ncall to hasPermission would always return true", "committedDate": "2020-02-07T09:47:33Z", "type": "commit"}, {"oid": "994c0ecb303ab5ed0670cf9512b88beb538a1132", "url": "https://github.com/nuxeo/nuxeo/commit/994c0ecb303ab5ed0670cf9512b88beb538a1132", "message": "NXP-26003: do not use the session principal when checking permission on a UserWorkspace\n\nDepending of the caller, the given CoreSession could be an unrestricted one, so the\ncall to hasPermission would always return true", "committedDate": "2020-02-07T09:47:33Z", "type": "forcePushed"}]}