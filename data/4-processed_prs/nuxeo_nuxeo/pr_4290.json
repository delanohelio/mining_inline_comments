{"pr_number": 4290, "pr_title": "NXP-29338: build and release slack notifications", "pr_createdAt": "2020-09-01T12:22:33Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4290", "timeline": [{"oid": "675deaf194b65b44723023b413039190912e0b7f", "url": "https://github.com/nuxeo/nuxeo/commit/675deaf194b65b44723023b413039190912e0b7f", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-01T12:23:42Z", "type": "forcePushed"}, {"oid": "f5d488013d103afd14cfc7665051334b23683a1d", "url": "https://github.com/nuxeo/nuxeo/commit/f5d488013d103afd14cfc7665051334b23683a1d", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-01T12:29:15Z", "type": "forcePushed"}, {"oid": "2d9d96fcfa378f0d115b81905ff2fba3d9f1124d", "url": "https://github.com/nuxeo/nuxeo/commit/2d9d96fcfa378f0d115b81905ff2fba3d9f1124d", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-01T13:11:19Z", "type": "forcePushed"}, {"oid": "11cdb41dfe4d9dd77c28a456b81ca44c9bd58491", "url": "https://github.com/nuxeo/nuxeo/commit/11cdb41dfe4d9dd77c28a456b81ca44c9bd58491", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-01T13:22:31Z", "type": "forcePushed"}, {"oid": "da9b07d465bc72faa1179b2cf847126cfd61fa9d", "url": "https://github.com/nuxeo/nuxeo/commit/da9b07d465bc72faa1179b2cf847126cfd61fa9d", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-02T12:53:59Z", "type": "forcePushed"}, {"oid": "bcc372a81c271c24c4a5a631e5d6a6b5fb55c37d", "url": "https://github.com/nuxeo/nuxeo/commit/bcc372a81c271c24c4a5a631e5d6a6b5fb55c37d", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-02T13:02:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1NzgzMw==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r482057833", "bodyText": "Could color be added?", "author": "kevinleturc", "createdAt": "2020-09-02T13:13:30Z", "path": "ci/Jenkinsfiles/build.groovy", "diffHunk": "@@ -885,6 +886,16 @@ pipeline {\n       script {\n         if (!isPullRequest() && env.DRY_RUN != \"true\") {\n           currentBuild.description = \"Build ${VERSION}\"\n+          if(!hudson.model.Result.FAILURE.equals(currentBuild.getPreviousBuild()?.getResult())) {\n+            slackSend(channel: \"${SLACK_CHANNEL}\", message: \"Successfully built ${BRANCH_NAME}/${BUILD_NUMBER}: ${BUILD_URL}\")", "originalCommit": "bcc372a81c271c24c4a5a631e5d6a6b5fb55c37d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA2NjA5Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r482066097", "bodyText": "Added color to all messages\ngood for success\ndanger for failure\nand #0167FF for promotion start notice", "author": "NourNuxeo", "createdAt": "2020-09-02T13:25:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1NzgzMw=="}], "type": "inlineReview"}, {"oid": "5c054e6049d7c60a5ac3cb22db1bb88591abb429", "url": "https://github.com/nuxeo/nuxeo/commit/5c054e6049d7c60a5ac3cb22db1bb88591abb429", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-02T13:25:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA2MTIyOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483061229", "bodyText": "Don't we want unsuccessful here, as we handle it for each step?", "author": "ataillefer", "createdAt": "2020-09-03T15:21:11Z", "path": "ci/Jenkinsfiles/build.groovy", "diffHunk": "@@ -885,6 +886,16 @@ pipeline {\n       script {\n         if (!isPullRequest() && env.DRY_RUN != \"true\") {\n           currentBuild.description = \"Build ${VERSION}\"\n+          if(!hudson.model.Result.FAILURE.equals(currentBuild.getPreviousBuild()?.getResult())) {\n+            slackSend(channel: \"${SLACK_CHANNEL}\", color: \"good\", message: \"Successfully built ${BRANCH_NAME}/${BUILD_NUMBER}: ${BUILD_URL}\")\n+          }\n+        }\n+      }\n+    }\n+    failure {", "originalCommit": "5c054e6049d7c60a5ac3cb22db1bb88591abb429", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEwMzU2Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483103562", "bodyText": "Didn't know about the nuance. \ud83d\udc4c", "author": "NourNuxeo", "createdAt": "2020-09-03T16:22:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA2MTIyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEwNjAxNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483106015", "bodyText": "also replaced the previous build check\nif(!hudson.model.Result.SUCCESS.equals(currentBuild.getPreviousBuild()?.getResult())) {", "author": "NourNuxeo", "createdAt": "2020-09-03T16:26:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA2MTIyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA2NDgxNg==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483064816", "bodyText": "WDYT of \"Successfully built nuxeo/nuxeo ${BRANCH_NAME} #${BUILD_NUMBER}\"?", "author": "ataillefer", "createdAt": "2020-09-03T15:26:14Z", "path": "ci/Jenkinsfiles/build.groovy", "diffHunk": "@@ -885,6 +886,16 @@ pipeline {\n       script {\n         if (!isPullRequest() && env.DRY_RUN != \"true\") {\n           currentBuild.description = \"Build ${VERSION}\"\n+          if(!hudson.model.Result.FAILURE.equals(currentBuild.getPreviousBuild()?.getResult())) {\n+            slackSend(channel: \"${SLACK_CHANNEL}\", color: \"good\", message: \"Successfully built ${BRANCH_NAME}/${BUILD_NUMBER}: ${BUILD_URL}\")", "originalCommit": "5c054e6049d7c60a5ac3cb22db1bb88591abb429", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEwMTY3Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483101672", "bodyText": "True we don't need to check it in success case", "author": "NourNuxeo", "createdAt": "2020-09-03T16:19:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA2NDgxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI1MjkwMA==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483252900", "bodyText": "went for #4290 (comment)", "author": "NourNuxeo", "createdAt": "2020-09-03T21:03:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA2NDgxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA2NjE0NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483066144", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                failure {\n          \n          \n            \n                unsuccessful {", "author": "ataillefer", "createdAt": "2020-09-03T15:27:41Z", "path": "ci/Jenkinsfiles/release.groovy", "diffHunk": "@@ -273,6 +284,10 @@ pipeline {\n           currentBuild.description = \"Release ${RELEASE_VERSION} from build ${params.BUILD_VERSION}\"\n         }\n       }\n+      slackSend(channel: \"${SLACK_CHANNEL}\", color: \"good\", message: \"Successfully promoted ${BRANCH_NAME} from ${CURRENT_VERSION} to ${RELEASE_VERSION}: ${BUILD_URL}\")\n+    }\n+    failure {", "originalCommit": "5c054e6049d7c60a5ac3cb22db1bb88591abb429", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3MDY1NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483070654", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                stage('Notify Promotion start on slack') {\n          \n          \n            \n                stage('Notify promotion start to Slack') {\n          \n      \n    \n    \n  \n\nmaybe?", "author": "ataillefer", "createdAt": "2020-09-03T15:34:14Z", "path": "ci/Jenkinsfiles/release.groovy", "diffHunk": "@@ -79,10 +79,21 @@ pipeline {\n     DOCKER_NAMESPACE = 'nuxeo'\n     NUXEO_IMAGE_NAME = 'nuxeo'\n     SLIM_IMAGE_NAME = 'slim'\n+    SLACK_CHANNEL = 'platform-notifs'\n   }\n \n   stages {\n \n+    stage('Notify Promotion start on slack') {", "originalCommit": "5c054e6049d7c60a5ac3cb22db1bb88591abb429", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEwNjcxMw==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483106713", "bodyText": "ok for no caps but it think on is more fitted as I would say on the forum ?", "author": "NourNuxeo", "createdAt": "2020-09-03T16:27:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3MDY1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI0MDIxNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483240215", "bodyText": "Sure!", "author": "ataillefer", "createdAt": "2020-09-03T20:36:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3MDY1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3NTQ5MQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483075491", "bodyText": "I'd go with a message similar to the build description we set at the end in case of success:  \"Starting release ${RELEASE_VERSION} from build ${params.BUILD_VERSION}: ${BUILD_URL}\", which will translate to \"Starting release 11.3 from build 11.3.47: https://xxx\" for instance.", "author": "ataillefer", "createdAt": "2020-09-03T15:41:17Z", "path": "ci/Jenkinsfiles/release.groovy", "diffHunk": "@@ -79,10 +79,21 @@ pipeline {\n     DOCKER_NAMESPACE = 'nuxeo'\n     NUXEO_IMAGE_NAME = 'nuxeo'\n     SLIM_IMAGE_NAME = 'slim'\n+    SLACK_CHANNEL = 'platform-notifs'\n   }\n \n   stages {\n \n+    stage('Notify Promotion start on slack') {\n+      steps {\n+        script {\n+          if (env.DRY_RUN != \"true\") {\n+            slackSend(channel: \"${SLACK_CHANNEL}\", color: \"#0167FF\", message: \"Promoting ${BRANCH_NAME} from ${CURRENT_VERSION} to ${RELEASE_VERSION}: ${BUILD_URL}\")", "originalCommit": "5c054e6049d7c60a5ac3cb22db1bb88591abb429", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEwODM0MA==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483108340", "bodyText": "fine for me \ud83d\udc4d", "author": "NourNuxeo", "createdAt": "2020-09-03T16:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3NTQ5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3NjE3MA==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483076170", "bodyText": "Should be it in the !DRY_RRUN block, no?", "author": "ataillefer", "createdAt": "2020-09-03T15:42:15Z", "path": "ci/Jenkinsfiles/release.groovy", "diffHunk": "@@ -273,6 +284,10 @@ pipeline {\n           currentBuild.description = \"Release ${RELEASE_VERSION} from build ${params.BUILD_VERSION}\"\n         }\n       }\n+      slackSend(channel: \"${SLACK_CHANNEL}\", color: \"good\", message: \"Successfully promoted ${BRANCH_NAME} from ${CURRENT_VERSION} to ${RELEASE_VERSION}: ${BUILD_URL}\")", "originalCommit": "5c054e6049d7c60a5ac3cb22db1bb88591abb429", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3NjQ3Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483076477", "bodyText": "Same thing I would go for \"Successfully released ${RELEASE_VERSION} from build ${params.BUILD_VERSION}: ${BUILD_URL}\"", "author": "ataillefer", "createdAt": "2020-09-03T15:42:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3NjE3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEwOTQzMg==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483109432", "bodyText": "since it's successfull why not considering the dev won't want to go and check the url as we did for build.groovy ?", "author": "NourNuxeo", "createdAt": "2020-09-03T16:32:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3NjE3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI0MTI2MA==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483241260", "bodyText": "In fact I didn't want to remove it from the suggestion for the build.\nLet's always display the build link: success/unsuccessful/build/release.", "author": "ataillefer", "createdAt": "2020-09-03T20:38:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3NjE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3NjkwNg==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483076906", "bodyText": "Condtioned by DRY_RUN?\nAnd align message if updated.", "author": "ataillefer", "createdAt": "2020-09-03T15:43:21Z", "path": "ci/Jenkinsfiles/release.groovy", "diffHunk": "@@ -273,6 +284,10 @@ pipeline {\n           currentBuild.description = \"Release ${RELEASE_VERSION} from build ${params.BUILD_VERSION}\"\n         }\n       }\n+      slackSend(channel: \"${SLACK_CHANNEL}\", color: \"good\", message: \"Successfully promoted ${BRANCH_NAME} from ${CURRENT_VERSION} to ${RELEASE_VERSION}: ${BUILD_URL}\")\n+    }\n+    failure {\n+      slackSend(channel: \"${SLACK_CHANNEL}\", colo: \"danger\", message: \"Failed to promote ${BRANCH_NAME} from ${CURRENT_VERSION} to ${RELEASE_VERSION}: ${BUILD_URL}\")", "originalCommit": "5c054e6049d7c60a5ac3cb22db1bb88591abb429", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEyNzEwMg==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483127102", "bodyText": "Done!", "author": "NourNuxeo", "createdAt": "2020-09-03T17:01:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3NjkwNg=="}], "type": "inlineReview"}, {"oid": "1e93e3bd8dac647c2c82e8341d0375a9d2cb3416", "url": "https://github.com/nuxeo/nuxeo/commit/1e93e3bd8dac647c2c82e8341d0375a9d2cb3416", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-03T16:58:12Z", "type": "forcePushed"}, {"oid": "2a05613e6f9517da4da81e98d93177412200b99d", "url": "https://github.com/nuxeo/nuxeo/commit/2a05613e6f9517da4da81e98d93177412200b99d", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-03T17:01:26Z", "type": "forcePushed"}, {"oid": "79f9062f74209530e8a88ffca2e72630aa0f8ee5", "url": "https://github.com/nuxeo/nuxeo/commit/79f9062f74209530e8a88ffca2e72630aa0f8ee5", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-03T17:07:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI0MDc1Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483240757", "bodyText": "Stick with \"release\" instead of \"promote\"?", "author": "ataillefer", "createdAt": "2020-09-03T20:37:55Z", "path": "ci/Jenkinsfiles/release.groovy", "diffHunk": "@@ -271,6 +282,14 @@ pipeline {\n       script {\n         if (env.DRY_RUN != \"true\") {\n           currentBuild.description = \"Release ${RELEASE_VERSION} from build ${params.BUILD_VERSION}\"\n+          slackSend(channel: \"${SLACK_CHANNEL}\", color: \"good\", message: \"Successfully released ${RELEASE_VERSION} from build ${params.BUILD_VERSION}\")\n+        }\n+      }\n+    }\n+    unsuccessful {\n+      script {\n+        if (env.DRY_RUN != \"true\") {\n+          slackSend(channel: \"${SLACK_CHANNEL}\", color: \"danger\", message: \"Failed to promote ${RELEASE_VERSION} from build ${params.BUILD_VERSION}: ${BUILD_URL}\")", "originalCommit": "79f9062f74209530e8a88ffca2e72630aa0f8ee5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI1MzI5MA==", "url": "https://github.com/nuxeo/nuxeo/pull/4290#discussion_r483253290", "bodyText": "ah sorry \ud83e\udd26", "author": "NourNuxeo", "createdAt": "2020-09-03T21:04:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI0MDc1Nw=="}], "type": "inlineReview"}, {"oid": "244b5cf896f5b3392d1ae4d37b759a2909e5d4cb", "url": "https://github.com/nuxeo/nuxeo/commit/244b5cf896f5b3392d1ae4d37b759a2909e5d4cb", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-03T21:05:37Z", "type": "forcePushed"}, {"oid": "5d52053346e50d64f11b72ea45e5bc2f41e06b3f", "url": "https://github.com/nuxeo/nuxeo/commit/5d52053346e50d64f11b72ea45e5bc2f41e06b3f", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-04T08:01:41Z", "type": "forcePushed"}, {"oid": "8291533633f4992f81b7296d7857f8ab654589f7", "url": "https://github.com/nuxeo/nuxeo/commit/8291533633f4992f81b7296d7857f8ab654589f7", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-04T13:21:09Z", "type": "commit"}, {"oid": "8291533633f4992f81b7296d7857f8ab654589f7", "url": "https://github.com/nuxeo/nuxeo/commit/8291533633f4992f81b7296d7857f8ab654589f7", "message": "NXP-29338: build and release slack notifications", "committedDate": "2020-09-04T13:21:09Z", "type": "forcePushed"}]}