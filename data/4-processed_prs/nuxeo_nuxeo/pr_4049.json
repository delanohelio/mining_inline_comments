{"pr_number": 4049, "pr_title": "NXP-29020 implement table of contents on explorer pages", "pr_createdAt": "2020-05-18T14:53:08Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4049", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzOTM1NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427139355", "bodyText": "you can now use proper variable scoping with let or const", "author": "akervern", "createdAt": "2020-05-19T08:54:31Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/resources/script/jquery.toc.js", "diffHunk": "@@ -0,0 +1,25 @@\n+(function ($) {\n+\n+  $.fn.toc = function (tocListContainer, tocList) {\n+    $(tocList).empty();\n+\n+    var index = 0;", "originalCommit": "b07f9377b07e9ba8de45fcbea33bb446dcdb74c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzOTY0MA==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427139640", "bodyText": "Use String templating for that: https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/template_strings", "author": "akervern", "createdAt": "2020-05-19T08:54:56Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/resources/script/jquery.toc.js", "diffHunk": "@@ -0,0 +1,25 @@\n+(function ($) {\n+\n+  $.fn.toc = function (tocListContainer, tocList) {\n+    $(tocList).empty();\n+\n+    var index = 0;\n+    $(\"h2\").each(function () {\n+      var name = \"toc\" + index;\n+      var anchor = \"<a name='\" + name + \"' class='anchor'></a>\";", "originalCommit": "b07f9377b07e9ba8de45fcbea33bb446dcdb74c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE2OTczMA==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427169730", "bodyText": "i changed the logics, you'll tell me if you prefer or not", "author": "atchertchian", "createdAt": "2020-05-19T09:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzOTY0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MDMyOA==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427140328", "bodyText": "Apparently jquery#each callback already contains index and obj ref: https://api.jquery.com/jQuery.each/#jQuery-each-object-callback", "author": "akervern", "createdAt": "2020-05-19T08:55:55Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/resources/script/jquery.toc.js", "diffHunk": "@@ -0,0 +1,25 @@\n+(function ($) {\n+\n+  $.fn.toc = function (tocListContainer, tocList) {\n+    $(tocList).empty();\n+\n+    var index = 0;\n+    $(\"h2\").each(function () {", "originalCommit": "b07f9377b07e9ba8de45fcbea33bb446dcdb74c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE2Mzc2MQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427163761", "bodyText": "even if i need the index outside of the iteration?", "author": "atchertchian", "createdAt": "2020-05-19T09:32:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MDMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE4MzQ1OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427183459", "bodyText": "you mean the list size?", "author": "akervern", "createdAt": "2020-05-19T10:05:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MDMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE4NTk2NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427185965", "bodyText": "i mean the number of toc items that were processed", "author": "atchertchian", "createdAt": "2020-05-19T10:09:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MDMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE4NzQ3MQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427187471", "bodyText": "i admit i originally copy/pasted the whole code from http://tutorials.jenkov.com/jquery/generating-table-of-contents.html, so i can rename the variable if it makes things clearer", "author": "atchertchian", "createdAt": "2020-05-19T10:11:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MDMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM3MzUxMA==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427373510", "bodyText": "Removed the use case after all (always show the TOC even if empty)", "author": "atchertchian", "createdAt": "2020-05-19T15:01:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MDMyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE0MDY4NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4049#discussion_r427140684", "bodyText": "It looks like you miss parenthesis here.", "author": "akervern", "createdAt": "2020-05-19T08:56:26Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/resources/script/jquery.toc.js", "diffHunk": "@@ -0,0 +1,25 @@\n+(function ($) {\n+\n+  $.fn.toc = function (tocListContainer, tocList) {\n+    $(tocList).empty();\n+\n+    var index = 0;\n+    $(\"h2\").each(function () {\n+      var name = \"toc\" + index;\n+      var anchor = \"<a name='\" + name + \"' class='anchor'></a>\";\n+      $(this).before(anchor);\n+\n+      var li = \"<li><a href='#\" + name + \"'>\" + $(this).text() + \"</a></li>\";\n+      $(tocList).append(li);\n+      index++;\n+    });\n+\n+    if (index < 2) {\n+      // only one item ==> remove TOC\n+      console.log(\"removing\");\n+      $(tocListContainer).remove;", "originalCommit": "b07f9377b07e9ba8de45fcbea33bb446dcdb74c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6dd21f69c4b6af32683cb4e5b4b802be9e704ae9", "url": "https://github.com/nuxeo/nuxeo/commit/6dd21f69c4b6af32683cb4e5b4b802be9e704ae9", "message": "NXP-29020: add ftests for table of contents", "committedDate": "2020-05-19T09:47:36Z", "type": "forcePushed"}, {"oid": "7e8eb3497526ed88d0edb3ed56c1f84918689286", "url": "https://github.com/nuxeo/nuxeo/commit/7e8eb3497526ed88d0edb3ed56c1f84918689286", "message": "NXP-29020: add ftests for table of contents", "committedDate": "2020-05-19T14:58:39Z", "type": "forcePushed"}, {"oid": "f39e06d07b75ac14e82d13152c1639a490e7b3a5", "url": "https://github.com/nuxeo/nuxeo/commit/f39e06d07b75ac14e82d13152c1639a490e7b3a5", "message": "NXP-29020: implement javascript table of contents on all artifact pages (except services)", "committedDate": "2020-05-19T15:00:01Z", "type": "commit"}, {"oid": "0b2d9e505d53f715bd711ad07331535967fb04c3", "url": "https://github.com/nuxeo/nuxeo/commit/0b2d9e505d53f715bd711ad07331535967fb04c3", "message": "NXP-29020: capitalize table of contents items", "committedDate": "2020-05-19T15:00:01Z", "type": "commit"}, {"oid": "9bf9276f970f2ada41beb54e4fa91ceb1fb4b2ca", "url": "https://github.com/nuxeo/nuxeo/commit/9bf9276f970f2ada41beb54e4fa91ceb1fb4b2ca", "message": "NXP-29020: add ftests for table of contents", "committedDate": "2020-05-19T15:00:01Z", "type": "commit"}, {"oid": "9bf9276f970f2ada41beb54e4fa91ceb1fb4b2ca", "url": "https://github.com/nuxeo/nuxeo/commit/9bf9276f970f2ada41beb54e4fa91ceb1fb4b2ca", "message": "NXP-29020: add ftests for table of contents", "committedDate": "2020-05-19T15:00:01Z", "type": "forcePushed"}]}