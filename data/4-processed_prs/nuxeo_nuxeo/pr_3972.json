{"pr_number": 3972, "pr_title": "NXBT-3289: remove buggy empty-docker-secret", "pr_createdAt": "2020-04-24T14:00:47Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3972", "timeline": [{"oid": "104b9fd577d16727923e65131471f000d933d60d", "url": "https://github.com/nuxeo/nuxeo/commit/104b9fd577d16727923e65131471f000d933d60d", "message": "NXBT-3289: remove buggy empty-docker-secret", "committedDate": "2020-04-25T18:19:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3MTQ2NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415571465", "bodyText": "why not simply\nkubectl create secret generic kubernetes-docker-cfg \\\n                  --namespace=${PREVIEW_NAMESPACE} \\\n                  --from-literal=.dockerconfigjson=\"\\$(kubectl --namespace platform get secret kubernetes-docker-cfg -ojsonpath='{.data.\\\\.dockerconfigjson}' | base64 --decode)\" \\\n                  --type=kubernetes.io/dockerconfigjson", "author": "ataillefer", "createdAt": "2020-04-27T07:22:10Z", "path": "Jenkinsfile", "diffHunk": "@@ -660,6 +660,10 @@ pipeline {\n                 // Previous preview deployment needs to be scaled to 0 to be replaced correctly\n                 sh \"kubectl -n ${PREVIEW_NAMESPACE} scale deployment nuxeo-preview --replicas=0\"\n               }\n+              sh \"\"\"kubectl create secret generic kubernetes-docker-cfg \\\n+                  --namespace=${PREVIEW_NAMESPACE} \\\n+                  --from-literal=.dockerconfigjson=\"\\$(kubectl --namespace platform get secret kubernetes-docker-cfg -ojsonpath='{.data.\\\\.dockerconfigjson}' | base64 --decode)\" \\\n+                  --type=kubernetes.io/dockerconfigjson --dry-run -o yaml | kubectl apply -f -\"\"\"", "originalCommit": "104b9fd577d16727923e65131471f000d933d60d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYzMTk0Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415631942", "bodyText": "Not sure it works if I paste some bash code directly in a script directive which takes groovy initially?\nI can also try and remove it but I wanted to stay consistent with the all the other kubectl calls accros the same file which are wrapped in an sh\"\"\" \"\"\"\" call.\nwdyt ?\nremoved --dry-run -o yaml | kubectl apply -f -", "author": "NourNuxeo", "createdAt": "2020-04-27T08:53:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3MTQ2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY4MjAxNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415682015", "bodyText": "@ataillefer is just simplifying the content of the sh\"\"\", not saying you should remove the sh\"\"\" part :)", "author": "troger", "createdAt": "2020-04-27T10:06:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3MTQ2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3Mjg2MQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415572861", "bodyText": "Could you pleas use a constant for 'platform' as we try to do for kubectl commands.\nI'd say, after this line:\nkubernetesNamespace = 'platform'", "author": "ataillefer", "createdAt": "2020-04-27T07:24:21Z", "path": "Jenkinsfile", "diffHunk": "@@ -660,6 +660,10 @@ pipeline {\n                 // Previous preview deployment needs to be scaled to 0 to be replaced correctly\n                 sh \"kubectl -n ${PREVIEW_NAMESPACE} scale deployment nuxeo-preview --replicas=0\"\n               }\n+              sh \"\"\"kubectl create secret generic kubernetes-docker-cfg \\\n+                  --namespace=${PREVIEW_NAMESPACE} \\\n+                  --from-literal=.dockerconfigjson=\"\\$(kubectl --namespace platform get secret kubernetes-docker-cfg -ojsonpath='{.data.\\\\.dockerconfigjson}' | base64 --decode)\" \\", "originalCommit": "104b9fd577d16727923e65131471f000d933d60d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY0OTk3OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415649979", "bodyText": "Changed the single quotes to double quotes on the whole lines where the var is used\ndone!", "author": "NourNuxeo", "createdAt": "2020-04-27T09:18:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3Mjg2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY4MjkxMg==", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415682912", "bodyText": "I would say this one is not linked to the Kubernetes namespace, it's just a GitHub status name.", "author": "troger", "createdAt": "2020-04-27T10:07:47Z", "path": "Jenkinsfile", "diffHunk": "@@ -158,7 +159,7 @@ def buildUnitTestStage(env) {\n     stage(\"Run ${env} unit tests\") {\n       container(\"maven-${env}\") {\n         script {\n-          setGitHubBuildStatus(\"platform/utests/${env}\", \"Unit tests - ${env} environment\", 'PENDING')\n+          setGitHubBuildStatus(\"${kubernetesNamespace}/utests/${env}\", \"Unit tests - ${env} environment\", 'PENDING')", "originalCommit": "cc7699aa915ee0a07f25208963efc28adef2c15b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY5MDMzMQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415690331", "bodyText": "yes I reverted all those gh status changes", "author": "NourNuxeo", "createdAt": "2020-04-27T10:19:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY4MjkxMg=="}], "type": "inlineReview"}, {"oid": "ccdf1a1450c45e0dbabf1994a286c90072a5c152", "url": "https://github.com/nuxeo/nuxeo/commit/ccdf1a1450c45e0dbabf1994a286c90072a5c152", "message": "NXBT-3289: remove buggy empty-docker-secret", "committedDate": "2020-04-27T10:17:12Z", "type": "commit"}, {"oid": "ccdf1a1450c45e0dbabf1994a286c90072a5c152", "url": "https://github.com/nuxeo/nuxeo/commit/ccdf1a1450c45e0dbabf1994a286c90072a5c152", "message": "NXBT-3289: remove buggy empty-docker-secret", "committedDate": "2020-04-27T10:17:12Z", "type": "forcePushed"}]}