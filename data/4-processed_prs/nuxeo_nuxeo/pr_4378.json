{"pr_number": 4378, "pr_title": "improvement NXP 29686 shell scripts docker runtime", "pr_createdAt": "2020-10-12T19:03:45Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4378", "timeline": [{"oid": "652ecca543e52367b1a88b84c736652d68b87252", "url": "https://github.com/nuxeo/nuxeo/commit/652ecca543e52367b1a88b84c736652d68b87252", "message": "NXP-29686: Cleanup", "committedDate": "2020-10-12T19:00:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503482986", "bodyText": ". does a \"source\" of the shell script in the same context as the current script. Meaning it can impact execution of the current script if it redefines environment variables for instance.\nAnother more common option outside of Docker is to just execute the script, but I don't know what's common in the Docker world.", "author": "efge", "createdAt": "2020-10-12T19:09:46Z", "path": "docker/docker-entrypoint.sh", "diffHunk": "@@ -53,6 +56,15 @@ if [[ ! -f $NUXEO_HOME/configured && ! -f $NUXEO_CONF ]]; then\n   touch $NUXEO_HOME/configured\n fi\n \n+# Handle shell scripts\n+echo \"ENTRYPOINT: Looking for shell scripts in /docker-entrypoint-initnuxeo.d\"\n+for f in /docker-entrypoint-initnuxeo.d/*; do\n+  case \"$f\" in\n+    *.sh)  echo \"Running $f\"; . \"$f\" ;;", "originalCommit": "02054c88e0845d97ce085e01320234de6d99f648", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg0Mjc1Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503842757", "bodyText": "Not aware of any best practices for running a script from the ENTRYPOINT of a Docker image.\nYou're right, executing the scripts would probably be safer for the environment, but, it's not easy to achieve since we don't control the permissions on the scripts to execute, like x, required for a script execution.\nTypically the /docker-entrypoint-initnuxeo.d directory can be mounted as a volume from a host directory containing the scripts to execute, in which case the resulting volume is owned by root, whereas the user running the entrypoint script is not root.", "author": "ataillefer", "createdAt": "2020-10-13T10:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg0OTY1NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503849654", "bodyText": "Ownership is not a problem for execution. One way to execute the script is just /bin/sh \"$f\".", "author": "efge", "createdAt": "2020-10-13T10:43:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg1MDA1MQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503850051", "bodyText": "Or /bin/bash if that's Docker usage.", "author": "efge", "createdAt": "2020-10-13T10:44:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkzODQ5Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503938496", "bodyText": "Interesting, thanks. Let's go for /bin/bash.", "author": "ataillefer", "createdAt": "2020-10-13T13:12:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng=="}], "type": "inlineReview"}, {"oid": "9882d4f4d13daa3af315e8e199254d33522d8515", "url": "https://github.com/nuxeo/nuxeo/commit/9882d4f4d13daa3af315e8e199254d33522d8515", "message": "NXP-29686: Allow to run shell scripts when starting Docker image", "committedDate": "2020-10-13T13:14:13Z", "type": "commit"}, {"oid": "c2f015ef2a6a20b12bb8044ef025cda8b9cddf82", "url": "https://github.com/nuxeo/nuxeo/commit/c2f015ef2a6a20b12bb8044ef025cda8b9cddf82", "message": "NXP-29686: Document scripts to install packages in a Docker image from Nuxeo", "committedDate": "2020-10-13T13:14:13Z", "type": "commit"}, {"oid": "c2f015ef2a6a20b12bb8044ef025cda8b9cddf82", "url": "https://github.com/nuxeo/nuxeo/commit/c2f015ef2a6a20b12bb8044ef025cda8b9cddf82", "message": "NXP-29686: Document scripts to install packages in a Docker image from Nuxeo", "committedDate": "2020-10-13T13:14:13Z", "type": "forcePushed"}]}