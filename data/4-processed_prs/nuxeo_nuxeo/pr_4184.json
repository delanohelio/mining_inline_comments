{"pr_number": 4184, "pr_title": "fix-NXP-29291-transient-store-ttl", "pr_createdAt": "2020-06-24T21:22:29Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4184", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIwMDk2Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4184#discussion_r445200963", "bodyText": "I would prefer nuxeo.transientstore.ttl as a property name (we already have another one related to transient stores, nuxeo.transientstore.provider).\nAnd therefore it would make sense for S3 to have nuxeo.s3storage.transientstore.ttl for example", "author": "efge", "createdAt": "2020-06-24T22:13:21Z", "path": "server/nuxeo-nxr-server/src/main/resources/templates/common/nuxeo.defaults", "diffHunk": "@@ -56,3 +56,5 @@ nuxeo.cache.concurrencylevel=500\n \n # boolean to switch back to former hot reload mechanism\n nuxeo.hotreload.compat.mechanism=false\n+\n+nuxeo.storage.transient.ttl=4320", "originalCommit": "aa755dd904e9b3a7d8fe760ad46683d9fd394aef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQwNzM4NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4184#discussion_r445407385", "bodyText": "works for me, i drew inspiration from nuxeo.storage.azure.* as it seemed nicer to read (would rather have nuxeo.storage.(transient|s3|azure|...).* than the current naming..).\nBut I agree that given we already have nuxeo.transientstore.provider we should be consistent. I'll update the PR.", "author": "nelsonsilva", "createdAt": "2020-06-25T08:52:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIwMDk2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQxMDQ4Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/4184#discussion_r445410482", "bodyText": "Wondering why not have a default value for the 2 properties in nuxeo.defaults?\nAlso, \"second\" is confusing, makes think of the time unit whereas it's minutes.\nIf we follow Florent's recommendations, something like:\nnuxeo.transientstore.ttl\nnuxeo.transientstore.second.level.ttl", "author": "ataillefer", "createdAt": "2020-06-25T08:58:01Z", "path": "server/nuxeo-nxr-server/src/main/resources/templates/common/config/transient-store-config.xml", "diffHunk": "@@ -7,8 +7,8 @@\n     <store name=\"default\" class=\"org.nuxeo.ecm.core.transientstore.keyvalueblob.KeyValueBlobTransientStore\">\n       <targetMaxSizeMB>-1</targetMaxSizeMB>\n       <absoluteMaxSizeMB>-1</absoluteMaxSizeMB>\n-      <firstLevelTTL>240</firstLevelTTL>\n-      <secondLevelTTL>10</secondLevelTTL>\n+      <firstLevelTTL>${nuxeo.storage.transient.ttl}</firstLevelTTL>\n+      <secondLevelTTL>${nuxeo.storage.transient.second.ttl:=10}</secondLevelTTL>", "originalCommit": "aa755dd904e9b3a7d8fe760ad46683d9fd394aef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQyMTQwMg==", "url": "https://github.com/nuxeo/nuxeo/pull/4184#discussion_r445421402", "bodyText": "just pushed a change to use nuxeo.transientstore.ttl2.\nI did think about that but I couldn't think of a good use case to change second level ttl so did not expose it by default in nuxeo.defaults.", "author": "nelsonsilva", "createdAt": "2020-06-25T09:16:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQxMDQ4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQyNTQ1NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4184#discussion_r445425455", "bodyText": "Moved to nuxeo.defaults", "author": "nelsonsilva", "createdAt": "2020-06-25T09:23:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQxMDQ4Mg=="}], "type": "inlineReview"}, {"oid": "813506cc7cf79e4fe277d3867936e88487fd8c61", "url": "https://github.com/nuxeo/nuxeo/commit/813506cc7cf79e4fe277d3867936e88487fd8c61", "message": "NXP-29291: allow configuring transient store ttl", "committedDate": "2020-06-25T09:08:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQyMTU4Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4184#discussion_r445421583", "bodyText": "What does the ${r\"\"} for?\nAlso, defaults should be there or in nuxeo.defaults, not both imho.", "author": "kevinleturc", "createdAt": "2020-06-25T09:17:13Z", "path": "packages/nuxeo-amazon-s3-package/src/main/resources/install/templates/s3binaries/nxserver/config/s3directupload-config.xml.nxftl", "diffHunk": "@@ -10,8 +10,8 @@\n       <property name=\"keyValueStore\">s3DirectUploadKeyValueStore</property> <!-- not defined there, fallback on default -->\n       <targetMaxSizeMB>${nuxeo.s3storage.transient.targetMaxSizeMB}</targetMaxSizeMB>\n       <absoluteMaxSizeMB>-1</absoluteMaxSizeMB>\n-      <firstLevelTTL>120</firstLevelTTL>\n-      <secondLevelTTL>10</secondLevelTTL>\n+      <firstLevelTTL>${nuxeo.s3storage.transientstore.ttl}</firstLevelTTL>\n+      <secondLevelTTL>${r\"${nuxeo.s3storage.transientstore.ttl2:=10}\"}</secondLevelTTL>", "originalCommit": "813506cc7cf79e4fe277d3867936e88487fd8c61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQyMzI4Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4184#discussion_r445423283", "bodyText": "${r\"..\"} is to not process the expression so it ends up in the XML contribution (we handle them ourselves in XML).\nI will move ttl2 to nuxeo.defaults then.", "author": "nelsonsilva", "createdAt": "2020-06-25T09:20:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQyMTU4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQyNTY2OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4184#discussion_r445425669", "bodyText": "Moved to nuxeo.defaults", "author": "nelsonsilva", "createdAt": "2020-06-25T09:24:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQyMTU4Mw=="}], "type": "inlineReview"}, {"oid": "5666034a5adc3e06621763ee41e9099ba6d53c35", "url": "https://github.com/nuxeo/nuxeo/commit/5666034a5adc3e06621763ee41e9099ba6d53c35", "message": "NXP-29291: allow configuring transient store ttl", "committedDate": "2020-06-25T09:22:45Z", "type": "forcePushed"}, {"oid": "124cd19735e591f4bc65adc0e54e36537c507fe2", "url": "https://github.com/nuxeo/nuxeo/commit/124cd19735e591f4bc65adc0e54e36537c507fe2", "message": "NXP-29291: allow configuring transient store ttl", "committedDate": "2020-06-25T10:04:23Z", "type": "commit"}, {"oid": "124cd19735e591f4bc65adc0e54e36537c507fe2", "url": "https://github.com/nuxeo/nuxeo/commit/124cd19735e591f4bc65adc0e54e36537c507fe2", "message": "NXP-29291: allow configuring transient store ttl", "committedDate": "2020-06-25T10:04:23Z", "type": "forcePushed"}]}