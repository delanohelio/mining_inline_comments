{"pr_number": 4438, "pr_title": "NXP-29825: keep only one install-packages.sh script", "pr_createdAt": "2020-11-04T15:04:41Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4438", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg5OTkyMg==", "url": "https://github.com/nuxeo/nuxeo/pull/4438#discussion_r517899922", "bodyText": "Would it make sense to separate this change (\">\" into \">>\"), which is not directly related to the merge of both scripts, and fixes the bug that empties the nuxeo.conf file when using the connect URL parameter?", "author": "atchertchian", "createdAt": "2020-11-05T09:17:31Z", "path": "docker/install-packages.sh", "diffHunk": "@@ -39,11 +43,19 @@ fi\n \n if [ -n \"$connect_url\" ]; then\n   echo \"Setting Connect URL: $connect_url\"\n-  printf \"org.nuxeo.connect.url=%b\\n\" \"$connect_url\" > $NUXEO_HOME/bin/nuxeo.conf\n+  printf \"org.nuxeo.connect.url=%b\\n\" \"$connect_url\" >> $NUXEO_HOME/bin/nuxeo.conf", "originalCommit": "e978909d0776e93934a3d9dae2ab1e8905b85851", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA0NjkzMw==", "url": "https://github.com/nuxeo/nuxeo/pull/4438#discussion_r518046933", "bodyText": "Could be a separate commit yes.", "author": "troger", "createdAt": "2020-11-05T13:24:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg5OTkyMg=="}], "type": "inlineReview"}, {"oid": "0d86cd5d89875710b512c6bfee2ee7254796be60", "url": "https://github.com/nuxeo/nuxeo/commit/0d86cd5d89875710b512c6bfee2ee7254796be60", "message": "NXP-29825: keep only one install-packages.sh script", "committedDate": "2020-11-05T17:02:24Z", "type": "forcePushed"}, {"oid": "b381cd0e2a0ae7a2852d0ced555099684f8e431a", "url": "https://github.com/nuxeo/nuxeo/commit/b381cd0e2a0ae7a2852d0ced555099684f8e431a", "message": "NXP-29825: correctly append Connect URL", "committedDate": "2020-11-05T17:09:17Z", "type": "commit"}, {"oid": "974ee3d93865fce3c50c3e0c5eec0783bca46306", "url": "https://github.com/nuxeo/nuxeo/commit/974ee3d93865fce3c50c3e0c5eec0783bca46306", "message": "NXP-29825: keep only one install-packages.sh script", "committedDate": "2020-11-05T17:09:17Z", "type": "forcePushed"}, {"oid": "f44008039f789e05c4c9d2945f49083259c93869", "url": "https://github.com/nuxeo/nuxeo/commit/f44008039f789e05c4c9d2945f49083259c93869", "message": "NXP-29825: keep only one install-packages.sh script", "committedDate": "2020-11-09T10:30:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg0NTkyOA==", "url": "https://github.com/nuxeo/nuxeo/pull/4438#discussion_r519845928", "bodyText": "mpInstallArgs?", "author": "ataillefer", "createdAt": "2020-11-09T14:17:22Z", "path": "docker/install-packages.sh", "diffHunk": "@@ -18,10 +18,14 @@ if [[ -f $NUXEO_HOME/configured ]]; then\n   exit 2\n fi\n \n+# default arguments for mp-install command\n+mp_install_args=\"--accept yes --relax no\"", "originalCommit": "f44008039f789e05c4c9d2945f49083259c93869", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1OTI4OA==", "url": "https://github.com/nuxeo/nuxeo/pull/4438#discussion_r519859288", "bodyText": "RUN /install-packages.sh", "author": "ataillefer", "createdAt": "2020-11-09T14:35:51Z", "path": "docker/README.md", "diffHunk": "@@ -130,23 +130,23 @@ dive nuxeo/nuxeo:latest\n \n ## Build a Custom Image From Nuxeo\n \n-We provide some utility scripts to install Nuxeo packages when building an image from the Nuxeo image:\n+We provide a utility script to install remote Nuxeo packages from [Nuxeo Connect](https://connect.nuxeo.com/) and local Nuxeo packages when building an image from the Nuxeo image:\n \n-- [install-local-packages.sh](./install-local-packages.sh): install a local Nuxeo package embedded in the image as a ZIP file.\n-- [install-packages.sh](./install-packages.sh): install a remote Nuxeo package from [Nuxeo Connect](https://connect.nuxeo.com/).\n-\n-For instance, you can use these scripts in the following `Dockerfile`:\n+For instance, you can use this script in the following `Dockerfile`:\n \n ```Dockerfile\n FROM <DOCKER_REGISTRY>/nuxeo:<TAG>\n \n ARG CLID\n ARG CONNECT_URL\n \n+COPY --chown=900:0 path/to/local-package-nodeps-*.zip $NUXEO_HOME/local-packages/local-package-nodeps.zip\n COPY --chown=900:0 path/to/local-package-*.zip $NUXEO_HOME/local-packages/local-package.zip\n \n-RUN /install-local-packages.sh $NUXEO_HOME/local-packages\n-RUN /install-packages.sh --clid ${CLID} --connect-url ${CONNECT_URL} nuxeo-web-ui nuxeo-drive\n+# Install a local package without its dependencies (`mp-install --nodeps`)\n+RUN /install-packages --offline $NUXEO_HOME/local-packages/local-package-nodeps.zip", "originalCommit": "f44008039f789e05c4c9d2945f49083259c93869", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f780a68241d5bfe2aa87be1940d5e92b957ff9c7", "url": "https://github.com/nuxeo/nuxeo/commit/f780a68241d5bfe2aa87be1940d5e92b957ff9c7", "message": "NXP-29825: keep only one install-packages.sh script", "committedDate": "2020-11-09T18:07:08Z", "type": "commit"}, {"oid": "f780a68241d5bfe2aa87be1940d5e92b957ff9c7", "url": "https://github.com/nuxeo/nuxeo/commit/f780a68241d5bfe2aa87be1940d5e92b957ff9c7", "message": "NXP-29825: keep only one install-packages.sh script", "committedDate": "2020-11-09T18:07:08Z", "type": "forcePushed"}]}