{"pr_number": 1683, "pr_title": "Improvements found while diagnosing problems with fibers under load", "pr_createdAt": "2020-05-27T18:24:13Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1683", "timeline": [{"oid": "67f9e26d4f04d35859e852e99fdee959ce9869eb", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/67f9e26d4f04d35859e852e99fdee959ce9869eb", "message": "Add debugging for suspended fibers", "committedDate": "2020-05-22T19:36:46Z", "type": "commit"}, {"oid": "38a12fe9c13061bdc55b9dfbcf910c25a2a5f2d9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/38a12fe9c13061bdc55b9dfbcf910c25a2a5f2d9", "message": "Improve diagnostics", "committedDate": "2020-05-22T20:09:30Z", "type": "commit"}, {"oid": "fa7da4bab6ec7643362c6021cde29e3a1c5d2a09", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fa7da4bab6ec7643362c6021cde29e3a1c5d2a09", "message": "Change fiber numbering", "committedDate": "2020-05-22T23:49:04Z", "type": "commit"}, {"oid": "a8895ee406307c766092f9bf8dc5263504ba4caa", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a8895ee406307c766092f9bf8dc5263504ba4caa", "message": "Client 8.0.2", "committedDate": "2020-05-23T00:00:19Z", "type": "commit"}, {"oid": "1b0c03f4fb4b9c89c2664ccd7fc453c9f209a229", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1b0c03f4fb4b9c89c2664ccd7fc453c9f209a229", "message": "Additional diagnostics", "committedDate": "2020-05-24T13:09:12Z", "type": "commit"}, {"oid": "1af1039806a6c25ef09a4e5662980df54132b791", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1af1039806a6c25ef09a4e5662980df54132b791", "message": "Merge remote-tracking branch 'origin/develop' into fiber-suspend-debug", "committedDate": "2020-05-27T15:47:07Z", "type": "commit"}, {"oid": "7376601db32f6663affcc6bf3e6983c5b0ef6807", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7376601db32f6663affcc6bf3e6983c5b0ef6807", "message": "Refactor test code", "committedDate": "2020-05-27T17:03:10Z", "type": "commit"}, {"oid": "4d0fad225d0d4857d1bb14010fec423917abaaad", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4d0fad225d0d4857d1bb14010fec423917abaaad", "message": "Remove unused code", "committedDate": "2020-05-27T18:17:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM2OTg3OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1683#discussion_r431369878", "bodyText": "Consider using Optional.ofNullable(fiber.getLastIfSuspended()) rather than the separate get and if statement.", "author": "russgold", "createdAt": "2020-05-27T18:54:29Z", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -219,6 +220,28 @@ public void stopNamespace(String ns) {\n     }\n   }\n \n+  /**\n+   * Report on currently suspended fibers. This is the first step toward diagnosing if we need special handling\n+   * to kill or kick these fibers.\n+   */\n+  public void reportSuspendedFibers() {\n+    if (LOGGER.isFineEnabled()) {\n+      BiConsumer<String, FiberGate> consumer =\n+          (namespace, gate) -> {\n+            gate.getCurrentFibers().forEach(\n+                (key, fiber) -> {\n+                  Step lastIfSuspended = fiber.getLastIfSuspended();", "originalCommit": "4d0fad225d0d4857d1bb14010fec423917abaaad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM3MjE1NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1683#discussion_r431372155", "bodyText": "The name is a bit unclear. Maybe getSuspendedStep would be clearer. Its semantics would be the same, as a fiber can have at most one suspended step.", "author": "russgold", "createdAt": "2020-05-27T18:58:23Z", "path": "operator/src/main/java/oracle/kubernetes/operator/work/Fiber.java", "diffHunk": "@@ -318,6 +319,22 @@ public boolean isDone() {\n     return status.get() == DONE;\n   }\n \n+  /**\n+   * The most recently invoked step if the fiber is currently suspended.\n+   * @return Last invoked step for suspended fiber.\n+   */\n+  public Step getLastIfSuspended() {", "originalCommit": "4d0fad225d0d4857d1bb14010fec423917abaaad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ffca5e68e6e03bfa761708fc773f0363b5953de3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ffca5e68e6e03bfa761708fc773f0363b5953de3", "message": "Review comments and trigger full recheck", "committedDate": "2020-05-27T19:26:04Z", "type": "commit"}, {"oid": "1ad90cb4b27790b0d23153e93f5123d8f5e527f1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1ad90cb4b27790b0d23153e93f5123d8f5e527f1", "message": "Merge remote-tracking branch 'origin/develop' into fiber-suspend-debug", "committedDate": "2020-05-28T13:05:04Z", "type": "commit"}]}