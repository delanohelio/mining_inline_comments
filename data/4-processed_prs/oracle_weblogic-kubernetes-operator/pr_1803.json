{"pr_number": 1803, "pr_title": "MII Sample Testing: Add option to dynamically allocate Traefik nodeports ...", "pr_createdAt": "2020-07-13T22:57:11Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1803", "timeline": [{"oid": "81b924154e59e9428c6b9dcdec3a5250606b5d8b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/81b924154e59e9428c6b9dcdec3a5250606b5d8b", "message": "MII Sample Testing: Add MII sample stand-alone test option to dynamically allocate Traefik nodeports, and change MII sample integration test to use this option.", "committedDate": "2020-07-13T22:52:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5MzEwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1803#discussion_r454093101", "bodyText": "Can you use the the script setup.sh  in samples/charts/utils directory to configure traefik.  The latest version of traefik  ( v 2.2.1) has different chart repository ( containous.github.io/traefik-helm-chart), The chart name is not stable/traefik but traefik/traefik.  I am working on a PR to upgrade the traefik version.  All these will be taken care by setup.sh, provided you use the command \"setup.sh create traefik\" in your script.", "author": "anpanigr", "createdAt": "2020-07-14T04:30:45Z", "path": "src/integration-tests/model-in-image/deploy-traefik.sh", "diffHunk": "@@ -49,32 +53,60 @@ set +e\n helm get values ${TRAEFIK_NAME} -n ${TRAEFIK_NAMESPACE} > $WORKDIR/test-out/traefik-values.cur 2>&1\n res=$?\n set -e\n-echo ${DOMAIN_NAMESPACE} >> $WORKDIR/test-out/traefik-values.cur\n+for evar in DOMAIN_NAMESPACE TRAEFIK_NAMESPACE TRAEFIK_NAME TRAEFIK_HTTP_NODEPORT TRAEFIK_HTTPS_NODEPORT; do\n+  echo \"${evar}=${!evar}\" >> $WORKDIR/test-out/traefik-values.cur\n+done\n if [ $res -eq 0 ] \\\n    && [ -e \"$WORKDIR/test-out/traefik-values.orig\" ] \\\n    && [ \"$(cat $WORKDIR/test-out/traefik-values.cur)\" = \"$(cat $WORKDIR/test-out/traefik-values.orig)\" ]; then\n   echo \"@@\"\n-  echo \"@@ Traefik already installed. Skipping uninstall/install.\"\n+  echo \"@@ Traefik already installed. Skipping uninstall/install. Current values:\"\n+  cat $WORKDIR/test-out/traefik-values.orig\n   echo \"@@\"\n else\n   set +e\n+  echo \"@@\"\n+  echo \"@@ Uninstalling old install (if any) using 'helm uninstall $TRAEFIK_NAME -n $TRAEFIK_NAMESPACE'\"\n+  echo \"@@\"\n   helm uninstall $TRAEFIK_NAME -n $TRAEFIK_NAMESPACE\n+  echo \"@@ Creating traefik namespace '$TRAEFIK_NAMESPACE' and domain namepace '$DOMAIN_NAMESPACE'\"\n   kubectl create namespace $TRAEFIK_NAMESPACE\n   kubectl create namespace $DOMAIN_NAMESPACE\n   set -e\n \n   cd ${SRCDIR}\n \n+  echo \"@@ Installing traefik\"\n+\n   # you only need to add the repo once, but we do it every time for simplicity\n   helm repo add stable https://kubernetes-charts.storage.googleapis.com/\n \n+  set -x\n+\n   helm install ${TRAEFIK_NAME} stable/traefik \\", "originalCommit": "81b924154e59e9428c6b9dcdec3a5250606b5d8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwMjA2OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1803#discussion_r454402069", "bodyText": "How about I do that in a future PR once the newest version of setup.sh is ready?", "author": "tbarnes-us", "createdAt": "2020-07-14T14:33:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5MzEwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ0NzQ1NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1803#discussion_r454447454", "bodyText": "Note: The interface to setup.sh will not change unless you want a non default Traefik version.", "author": "anpanigr", "createdAt": "2020-07-14T15:33:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5MzEwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ2MzE5OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1803#discussion_r454463199", "bodyText": "We will wire in setup.sh in a different pull, as discussed in the meeting.  Please approve if you're fine with this change.", "author": "tbarnes-us", "createdAt": "2020-07-14T15:56:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5MzEwMQ=="}], "type": "inlineReview"}]}