{"pr_number": 1735, "pr_title": "Add namespace to operator log messages", "pr_createdAt": "2020-06-12T22:39:26Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1735", "timeline": [{"oid": "4bcbba07505db55377524dda504c783a4d6ad2c7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4bcbba07505db55377524dda504c783a4d6ad2c7", "message": "Add namespace to log messages", "committedDate": "2020-06-11T21:53:02Z", "type": "commit"}, {"oid": "89a77ae18a2079b1849730c59fd0c72398ee7911", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/89a77ae18a2079b1849730c59fd0c72398ee7911", "message": "Add a new file", "committedDate": "2020-06-11T22:09:56Z", "type": "commit"}, {"oid": "7353aa2a8f561d8772a557f04514bad8d4220b30", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7353aa2a8f561d8772a557f04514bad8d4220b30", "message": "Handle namespace watch event", "committedDate": "2020-06-12T19:31:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NjMzNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1735#discussion_r439676337", "bodyText": "consider adding a utility method in LoggingContext that handles setting the context, invoke the code, and removal of context, something like LoggingContext.runUnderContext(LoggingContext, Runnable).", "author": "alai8", "createdAt": "2020-06-12T23:14:33Z", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -231,8 +232,23 @@ public void reportSuspendedFibers() {\n             gate.getCurrentFibers().forEach(\n                 (key, fiber) -> {\n                   Optional.ofNullable(fiber.getSuspendedStep()).ifPresent(suspendedStep -> {\n-                    LOGGER.fine(\"Namespace: \" + namespace + \", DomainUid: \" + key\n-                        + \", Fiber: \" + fiber.toString() + \" is SUSPENDED at \" + suspendedStep.getName());\n+                  \n+                    // find out the domainUID \n+                    Packet packet = fiber == null ? null : fiber.getPacket();\n+                    String domainUid = null;\n+                    if (packet != null) {\n+                      DomainPresenceInfo info = packet.getSpi(DomainPresenceInfo.class);\n+                      if (info != null) {\n+                        domainUid = info.getDomainUid();\n+                      }\n+                    }\n+                    LoggingContext.context(new LoggingContext().namespace(namespace).domainUid(domainUid));", "originalCommit": "7353aa2a8f561d8772a557f04514bad8d4220b30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NDcyMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1735#discussion_r439754723", "bodyText": "Or maybe have a Closable wrapper to allow for a 'try (closable) {}' pattern?", "author": "tbarnes-us", "createdAt": "2020-06-13T17:24:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NjMzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2NDg2Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1735#discussion_r440964863", "bodyText": "Changed to use AutoCloseable.", "author": "doxiao", "createdAt": "2020-06-16T15:59:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NjMzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NDUzOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1735#discussion_r439754538", "bodyText": "Does this need a corresponding LoggingContext().remove() in a finally?", "author": "tbarnes-us", "createdAt": "2020-06-13T17:21:45Z", "path": "operator/src/main/java/oracle/kubernetes/operator/ServerStatusReader.java", "diffHunk": "@@ -167,6 +168,8 @@ public NextAction apply(Packet packet) {\n             String state = null;\n             ClientPool helper = ClientPool.getInstance();\n             ApiClient client = helper.take();\n+            String namespace = pod.getMetadata().getNamespace();\n+            LoggingContext.context(new LoggingContext().namespace(namespace));", "originalCommit": "7353aa2a8f561d8772a557f04514bad8d4220b30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2NjU4NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1735#discussion_r440966584", "bodyText": "fixed", "author": "doxiao", "createdAt": "2020-06-16T16:01:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NDUzOA=="}], "type": "inlineReview"}, {"oid": "b8e434341180b3562f45ae654bbaeac2c54c7f44", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b8e434341180b3562f45ae654bbaeac2c54c7f44", "message": "Remove the thread local in ServerStatusReader", "committedDate": "2020-06-15T17:31:59Z", "type": "commit"}, {"oid": "42bf6ea24df193d3e1d1aa8c7014dff0966a508c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/42bf6ea24df193d3e1d1aa8c7014dff0966a508c", "message": "Use Closeable and more", "committedDate": "2020-06-16T11:01:34Z", "type": "commit"}, {"oid": "d0502cf7383b7e984be76ca4fcb02ccba18c9245", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d0502cf7383b7e984be76ca4fcb02ccba18c9245", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into add-domain-ns-to-op-log", "committedDate": "2020-06-16T11:04:32Z", "type": "commit"}, {"oid": "d0502cf7383b7e984be76ca4fcb02ccba18c9245", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d0502cf7383b7e984be76ca4fcb02ccba18c9245", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into add-domain-ns-to-op-log", "committedDate": "2020-06-16T11:04:32Z", "type": "forcePushed"}, {"oid": "16a367081a8be033d5e8461407773bc40f98a40d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/16a367081a8be033d5e8461407773bc40f98a40d", "message": "add unit test for LoggingFormatter", "committedDate": "2020-06-16T13:37:36Z", "type": "commit"}, {"oid": "3c33dcd6d0fe12b06fb24795a925edfd80e9100a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3c33dcd6d0fe12b06fb24795a925edfd80e9100a", "message": "Add unit test cases for namespace", "committedDate": "2020-06-16T13:40:17Z", "type": "commit"}, {"oid": "d3116fb32d2fa8e7be956477d5f4769c7b9c9235", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d3116fb32d2fa8e7be956477d5f4769c7b9c9235", "message": "Add missing file", "committedDate": "2020-06-16T13:43:43Z", "type": "commit"}, {"oid": "29cc0155bcf7a1cee904dcd35a8e06fa1de9ff7b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/29cc0155bcf7a1cee904dcd35a8e06fa1de9ff7b", "message": "fix", "committedDate": "2020-06-16T13:46:19Z", "type": "commit"}, {"oid": "de45f3086de02be13dde6eb508c04b920fe3ce07", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/de45f3086de02be13dde6eb508c04b920fe3ce07", "message": "some cleanup and unit testing", "committedDate": "2020-06-16T15:34:32Z", "type": "commit"}]}