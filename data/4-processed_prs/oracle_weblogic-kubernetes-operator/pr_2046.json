{"pr_number": 2046, "pr_title": "Update the startServer.sh copy functionality to only chmod owned files", "pr_createdAt": "2020-11-10T21:14:07Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2046", "timeline": [{"oid": "0bf1eff249ce7846de1de0e4d7c00938a3a2fbef", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0bf1eff249ce7846de1de0e4d7c00938a3a2fbef", "message": "Remove unnecessary chmod 750", "committedDate": "2020-11-10T01:07:57Z", "type": "commit"}, {"oid": "168cfccc4a7e36c0a83776b9f4763bf704f64d0f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/168cfccc4a7e36c0a83776b9f4763bf704f64d0f", "message": "Try only chmod'ing if file is created", "committedDate": "2020-11-10T11:56:17Z", "type": "commit"}, {"oid": "380f41804f01b1d4d290582fb82ffa235558e930", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/380f41804f01b1d4d290582fb82ffa235558e930", "message": "Update tests to use chown oracle:root", "committedDate": "2020-11-10T16:05:24Z", "type": "commit"}, {"oid": "8bbcba98bf5860cccff9d5f9f76d4c43a9d17013", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8bbcba98bf5860cccff9d5f9f76d4c43a9d17013", "message": "Switch to checking ownership before chmod", "committedDate": "2020-11-10T16:48:51Z", "type": "commit"}, {"oid": "42cad7f35c449e967144b4f045fd04d5f5e4d005", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/42cad7f35c449e967144b4f045fd04d5f5e4d005", "message": "Add diagnostics", "committedDate": "2020-11-10T17:02:33Z", "type": "commit"}, {"oid": "6677658e393df525beb7ac2090134271af41c36b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6677658e393df525beb7ac2090134271af41c36b", "message": "Remove diagnostics", "committedDate": "2020-11-10T20:55:32Z", "type": "commit"}, {"oid": "6cbe0aedb61877dc650ac08c596bce8d9949b27c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6cbe0aedb61877dc650ac08c596bce8d9949b27c", "message": "Merge remote-tracking branch 'origin/develop' into remove-chmod750", "committedDate": "2020-11-10T20:57:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4NTU0OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2046#discussion_r522285549", "bodyText": "What file isn't owned?  Note that there is similar logic in the liveness probe script.", "author": "tbarnes-us", "createdAt": "2020-11-12T17:29:34Z", "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -34,15 +34,17 @@ function copyIfChanged() {\n     trace \"Copying '$1' to '$2'.\"\n     cp $1 $2\n     [ $? -ne 0 ] && trace SEVERE \"failed cp $1 $2\" && exitOrLoop\n-    chmod 750 $2 \n-    [ $? -ne 0 ] && trace SEVERE \"failed chmod 750 $2\" && exitOrLoop\n+    if [ -O \"$2\" ]; then\n+      chmod 770 $2\n+      [ $? -ne 0 ] && trace SEVERE \"failed chmod 770 $2\" && exitOrLoop\n+    fi", "originalCommit": "6cbe0aedb61877dc650ac08c596bce8d9949b27c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4ODU4Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2046#discussion_r522288586", "bodyText": "On OpenShift, the containers will not be run as the \"oracle\" user, but instead will be run as a new user (large UID), but that is part of the \"root\" group. In the case of the boot.properties, or any file that already exists and is being copied over, the file will still be owned by \"oracle\" and so the script cannot chmod the file.", "author": "rjeberhard", "createdAt": "2020-11-12T17:33:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4NTU0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4OTEyNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2046#discussion_r522289124", "bodyText": "Yes, I'll change the liveness probe too", "author": "rjeberhard", "createdAt": "2020-11-12T17:34:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4NTU0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI5MTQzNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2046#discussion_r522291434", "bodyText": "It's interesting that boot.properties is created and copied over by the operator at runtime (contains the WL credentials), but it still needs an unknown check and a chmod...", "author": "tbarnes-us", "createdAt": "2020-11-12T17:37:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4NTU0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMwMzg3OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2046#discussion_r522303878", "bodyText": "It's not copied by the \"operator\". It's copied by the user principal inside the server instance running a script injected by the operator.", "author": "rjeberhard", "createdAt": "2020-11-12T17:56:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI4NTU0OQ=="}], "type": "inlineReview"}, {"oid": "372a3ad2ad5fdc802bed416fbedda1fc6f18f53a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/372a3ad2ad5fdc802bed416fbedda1fc6f18f53a", "message": "Adjust liveness probe too", "committedDate": "2020-11-12T17:45:53Z", "type": "commit"}]}