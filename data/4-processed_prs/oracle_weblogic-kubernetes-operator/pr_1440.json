{"pr_number": 1440, "pr_title": "OWLS 79243  :  Helm 3/2 support for Operator Integration Tests", "pr_createdAt": "2020-02-19T19:53:41Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440", "timeline": [{"oid": "fd5cec52a4b6bc38109ef7416f0b1f8e634e77bd", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fd5cec52a4b6bc38109ef7416f0b1f8e634e77bd", "message": "Initial Change for Helm 2.x/3.x comptibility", "committedDate": "2020-02-18T22:21:20Z", "type": "commit"}, {"oid": "81d4ccc6f1231f221103aaa1328422ec83d254bd", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/81d4ccc6f1231f221103aaa1328422ec83d254bd", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243", "committedDate": "2020-02-19T18:36:47Z", "type": "commit"}, {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/356b4a9b70207da0ac4b1aeb884afba654a6d795", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243", "committedDate": "2020-02-20T16:08:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NDI1MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382184251", "bodyText": "remove name from printed message", "author": "vanajamukkara", "createdAt": "2020-02-20T18:38:33Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/BaseTest.java", "diffHunk": "@@ -82,6 +84,17 @@\n     QUICKTEST =\n         System.getenv(\"QUICKTEST\") != null && System.getenv(\"QUICKTEST\").equalsIgnoreCase(\"true\");\n \n+    HELM_VERSION = System.getenv(\"HELM_VERSION\");\n+    if (HELM_VERSION == null) {\n+      HELM_VERSION = \"V2\";\n+    }\n+ \n+    VOYAGER_VERSION = System.getenv(\"VOYAGER_VERSION\");\n+    if (VOYAGER_VERSION == null) {\n+      VOYAGER_VERSION = \"10.0.0\";\n+    }\n+\n+    System.out.println(\"(PANI) HELM VERSION IS \" + HELM_VERSION);", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIwODY0Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382208646", "bodyText": "Modified to   System.out.println(\"Helm Version is \" + HELM_VERSION)", "author": "anpanigr", "createdAt": "2020-02-20T19:25:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NDI1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NDc4MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382184780", "bodyText": "fix typo in --namespace", "author": "vanajamukkara", "createdAt": "2020-02-20T18:39:38Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -166,7 +167,13 @@ public void testCreateSecondOperatorUsingSameOperatorNsNegativeInstall() throws\n                 + \"does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTI1OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185258", "bodyText": "fix typo", "author": "vanajamukkara", "createdAt": "2020-02-20T18:40:33Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -237,13 +244,20 @@ public void testNotPreexistedOpServiceAccountCreateOperatorNegativeInstall() thr\n             true,\n             RestCertType.SELF_SIGNED);\n     String oprelease = (String)(operator.getOperatorMap()).get(\"releaseName\");\n+    String opnamespace = (String)(operator.getOperatorMap()).get(\"namespace\");\n     try {\n       operator.callHelmInstall();\n       throw new RuntimeException(\n           \"FAILURE: Helm installs operator with not preexisted service account \");\n \n     } catch (Exception ex) {\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIxMzAwNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382213004", "bodyText": "done", "author": "anpanigr", "createdAt": "2020-02-20T19:33:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTI1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTM0OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185348", "bodyText": "fix typo", "author": "vanajamukkara", "createdAt": "2020-02-20T18:40:45Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -319,7 +334,13 @@ public void testSecondOpSharingSameTargetDomainsNsNegativeInstall() throws Excep\n                 + \"target domains namespaces does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTQ3MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185471", "bodyText": "fix typo", "author": "vanajamukkara", "createdAt": "2020-02-20T18:40:58Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -374,7 +396,13 @@ public void testTargetNsIsNotPreexistedNegativeInstall() throws Exception {\n                 + \"namespaces does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTc0Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185742", "bodyText": "fix typo in --namespace", "author": "vanajamukkara", "createdAt": "2020-02-20T18:41:34Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -430,7 +459,13 @@ public void testSecondOpSharingSameExternalRestPortNegativeInstall() throws Exce\n             \"FAILURE: Helm install operator with dublicated rest port number does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIxMzA3NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382213074", "bodyText": "done", "author": "anpanigr", "createdAt": "2020-02-20T19:33:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTc0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTg4Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185886", "bodyText": "fix typo in --namespace", "author": "vanajamukkara", "createdAt": "2020-02-20T18:41:50Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -481,7 +517,13 @@ public void testCreateWithUpperCaseTargetDomainNegativeInstall() throws Exceptio\n                 + \"domains namespace does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4Nzk3Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382187976", "bodyText": "code is duplicated in many places..write a small method may be callHelmList() and call that...", "author": "vanajamukkara", "createdAt": "2020-02-20T18:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTg4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4OTM0Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382189342", "bodyText": "should be \"\" or null, not \"Empty String\"", "author": "vanajamukkara", "createdAt": "2020-02-20T18:48:40Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -36,7 +36,12 @@ public LoadBalancer(Map lbMap) throws Exception {\n         Paths.get(userProjectsDir + \"/load-balancers/\" + lbMap.get(\"domainUID\")));\n \n     if (lbMap.get(\"loadBalancer\").equals(\"TRAEFIK\")) {\n-      String cmdLb = \"helm list traefik-operator | grep DEPLOYED\";\n+      String cmdLb = \"Empty String\";", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIxNjI5MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382216290", "bodyText": "reset the string to String cmdLb = \"\" in all occurrences", "author": "anpanigr", "createdAt": "2020-02-20T19:39:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4OTM0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MDEzMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382190130", "bodyText": "this condition doesn't look correct, namespace is required for V3 ...can you check again", "author": "vanajamukkara", "createdAt": "2020-02-20T18:50:12Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -36,7 +36,12 @@ public LoadBalancer(Map lbMap) throws Exception {\n         Paths.get(userProjectsDir + \"/load-balancers/\" + lbMap.get(\"domainUID\")));\n \n     if (lbMap.get(\"loadBalancer\").equals(\"TRAEFIK\")) {\n-      String cmdLb = \"helm list traefik-operator | grep DEPLOYED\";\n+      String cmdLb = \"Empty String\";\n+      if (! BaseTest.HELM_VERSION.equals(\"V2\")) {", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MDI2OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382190268", "bodyText": "should be \"\" or null, not \"Empty String\"", "author": "vanajamukkara", "createdAt": "2020-02-20T18:50:28Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -53,7 +58,12 @@ public LoadBalancer(Map lbMap) throws Exception {\n     }\n \n     if (lbMap.get(\"loadBalancer\").equals(\"VOYAGER\")) {\n-      String cmdLb = \"helm list voyager-operator | grep DEPLOYED\";\n+      String cmdLb = \"Empty String\";", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MDM3NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382190375", "bodyText": "check condition", "author": "vanajamukkara", "createdAt": "2020-02-20T18:50:40Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -53,7 +58,12 @@ public LoadBalancer(Map lbMap) throws Exception {\n     }\n \n     if (lbMap.get(\"loadBalancer\").equals(\"VOYAGER\")) {\n-      String cmdLb = \"helm list voyager-operator | grep DEPLOYED\";\n+      String cmdLb = \"Empty String\";\n+      if (! BaseTest.HELM_VERSION.equals(\"V2\")) {", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIyNTkyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382225928", "bodyText": "Changed to   if ( BaseTest.HELM_VERSION.equals(\"V2\")) {", "author": "anpanigr", "createdAt": "2020-02-20T19:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MDM3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MjE3OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382192178", "bodyText": "you can just do\ncmd = cmd + \" --namespace traefik \";\n\nsame for initialization ...", "author": "vanajamukkara", "createdAt": "2020-02-20T18:54:05Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -163,7 +171,11 @@ private void upgradeTraefikNamespace() throws Exception {\n    * @throws Exception when could not get values\n    */\n   private String getKubernetesNamespaceToUpdate(String domainNamespace) throws Exception {\n-    ExecResult result = TestUtils.exec(\"helm get values traefik-operator\", true);\n+    String cmd = new String(\"helm get values traefik-operator \");\n+    if (! BaseTest.HELM_VERSION.equals(\"V2\")) {\n+      cmd = cmd + new String(\" --namespace traefik \");", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIyNzc0Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382227747", "bodyText": "Modified as follows  ...\nString cmd = \"helm get values traefik-operator \";\nif (BaseTest.HELM_VERSION.equals(\"V2\")) {\ncmd = cmd + \" --namespace traefik \";\n}", "author": "anpanigr", "createdAt": "2020-02-20T20:02:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MjE3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5NDg4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382194887", "bodyText": "have you tried using same command for both something like\n\"helm install \"+ name + \" ingress-per-domain\" or\n\"helm install --name \"+ name + \" ingress-per-domain\"", "author": "vanajamukkara", "createdAt": "2020-02-20T18:59:09Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -189,23 +201,31 @@ private String getKubernetesNamespaceToUpdate(String domainNamespace) throws Exc\n \n   private void createTraefikIngress() throws Exception {\n \n-    String chartDir = BaseTest.getProjectRoot() + \"/integration-tests/src/test/resources/charts\";\n+    String chartDir = BaseTest.getProjectRoot() + \"/kubernetes/samples/charts\";\n \n     StringBuffer cmd = new StringBuffer(\"cd \");\n-    cmd.append(chartDir).append(\" && helm install ingress-per-domain \");\n-    cmd.append(\" --name \")\n-        .append(lbMap.get(\"name\"))\n-        .append(\" --namespace \")\n-        .append(lbMap.get(\"namespace\"))\n-        .append(\" --set \")\n-        .append(\"wlsDomain.domainUID=\")\n-        .append(lbMap.get(\"domainUID\"))\n-        .append(\" --set \")\n-        .append(\"wlsDomain.clusterName=\")\n-        .append(lbMap.get(\"clusterName\"))\n-        .append(\" --set \")\n-        .append(\"traefik.hostname=\")\n-        .append(lbMap.get(\"domainUID\"))\n+    cmd.append(chartDir).append(\" && \");\n+    \n+    if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+      cmd.append(\" helm install ingress-per-domain \")", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIyOTM5Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382229392", "bodyText": "Helm V3.x  does not accept --name argument, instead it take a chart name as first argument directly.  So there is no common syntax for both Helm Release", "author": "anpanigr", "createdAt": "2020-02-20T20:05:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5NDg4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5NTg5MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382195890", "bodyText": "fix initialization", "author": "vanajamukkara", "createdAt": "2020-02-20T19:01:01Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -222,23 +242,11 @@ private void createTraefikIngress() throws Exception {\n    * @throws Exception on failure\n    */\n   public void createVoyagerLoadBalancer() throws Exception {\n-\n-    String cmd1 = \"helm repo add appscode https://charts.appscode.com/stable/\";\n-    LoggerHelper.getLocal().log(Level.INFO, \"Executing Add Appscode Chart Repository cmd \" + cmd1);\n-\n-    executeHelmCommand(cmd1);\n-\n-    String cmd2 = \"helm repo update\";\n-    LoggerHelper.getLocal().log(Level.INFO, \"Executing Appscode Chart Repository upgrade cmd \" + cmd2);\n-\n-    executeHelmCommand(cmd2);\n-\n-    String cmd3 =\n-        \"helm install appscode/voyager --name voyager-operator --version 7.4.0 --namespace voyager \"\n-            + \"--set cloudProvider=baremetal --set apiserver.enableValidatingWebhook=false\";\n-    LoggerHelper.getLocal().log(Level.INFO, \"Executing Install voyager operator cmd \" + cmd3);\n-\n-    executeHelmCommand(cmd3);\n+    String cmdLb = \"Empty String\";", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIyOTUwNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382229505", "bodyText": "done", "author": "anpanigr", "createdAt": "2020-02-20T20:06:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5NTg5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5NjUxOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382196519", "bodyText": "same comment as above", "author": "vanajamukkara", "createdAt": "2020-02-20T19:02:05Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -294,23 +306,31 @@ private void upgradeVoyagerNamespace() throws Exception {\n   }\n \n   private void createVoyagerIngress() throws Exception {\n-    String chartDir = BaseTest.getProjectRoot() + \"/integration-tests/src/test/resources/charts\";\n+    String chartDir = BaseTest.getProjectRoot() + \"/kubernetes/samples/charts\";\n \n     StringBuffer cmd = new StringBuffer(\"cd \");\n-    cmd.append(chartDir).append(\" && helm install ingress-per-domain \");\n-    cmd.append(\" --name \")\n-        .append(lbMap.get(\"name\"))\n-        .append(\" --namespace \")\n-        .append(lbMap.get(\"namespace\"))\n-        .append(\" --set type=VOYAGER\")\n-        .append(\" --set \")\n-        .append(\"wlsDomain.domainUID=\")\n-        .append(lbMap.get(\"domainUID\"))\n-        .append(\" --set \")\n-        .append(\"wlsDomain.clusterName=\")\n-        .append(lbMap.get(\"clusterName\"))\n-        .append(\" --set \")\n-        .append(\"voyager.webPort=\")\n+    cmd.append(chartDir).append(\" && \");\n+\n+    if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+      cmd.append(\" helm install ingress-per-domain \")", "originalCommit": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIyOTc5MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382229791", "bodyText": "There is no common syntax for both Helm Release", "author": "anpanigr", "createdAt": "2020-02-20T20:06:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5NjUxOQ=="}], "type": "inlineReview"}, {"oid": "8c0f737dbd43c75ecdac70f1235ff00a3814d0a8", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8c0f737dbd43c75ecdac70f1235ff00a3814d0a8", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243", "committedDate": "2020-02-20T19:48:14Z", "type": "commit"}, {"oid": "d9e1be19e1b09078982013281c63ba9be5ac2524", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d9e1be19e1b09078982013281c63ba9be5ac2524", "message": "Resolve review comment on PR", "committedDate": "2020-02-20T20:17:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI0MzE1NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382243155", "bodyText": "do this in the IT class in unprepare rather than having test specific code in common cleanup script", "author": "vanajamukkara", "createdAt": "2020-02-20T20:35:33Z", "path": "src/integration-tests/bash/cleanup.sh", "diffHunk": "@@ -317,11 +317,30 @@ mkdir -p $TMP_DIR || fail No permision to create directory $TMP_DIR\n \n # first, if helm is installed, delete all installed helm charts\n if [ -x \"$(command -v helm)\" ]; then\n+  helm version --short --client  | grep v2\n+  [[ $? == 0 ]] && HELM_VERSION=V2\n+  [[ $? == 1 ]] && HELM_VERSION=V3\n+  echo \"Detected Helm Version [$(helm version --short --client)]\"\n   echo @@ Deleting installed helm charts\n-  helm list --short | while read helm_name; do\n-     helm delete --purge  $helm_name\n+  namespaces=`kubectl get ns | grep -v NAME | awk '{ print $1 }'`\n+  for ns in $namespaces\n+  do \n+     helm list --short --namespace $ns | while read helm_name; do\n+     if [ \"$HELM_VERSION\" == \"V2\" ]; then\n+       helm delete --purge  $helm_name\n+     else \n+      helm uninstall $helm_name -n $ns \n+     fi\n+     done\n   done\n \n+  # Remove namespace(s) from usablity Integration tests", "originalCommit": "d9e1be19e1b09078982013281c63ba9be5ac2524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxNjExNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382316115", "bodyText": "Removed", "author": "anpanigr", "createdAt": "2020-02-20T23:27:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI0MzE1NQ=="}], "type": "inlineReview"}, {"oid": "fff87075faf5ea220ec908c01b4747c8ef80c0ed", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fff87075faf5ea220ec908c01b4747c8ef80c0ed", "message": "Removed Helm Env varaiable dependency from the Test", "committedDate": "2020-02-20T23:34:02Z", "type": "commit"}, {"oid": "3a34d99e104961785edbe3606a463477c5d188a0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3a34d99e104961785edbe3606a463477c5d188a0", "message": "Modified the helm scripts", "committedDate": "2020-02-21T21:50:11Z", "type": "commit"}, {"oid": "35b1ac0be59ce34160b5c99e3a1e50fa80891bfc", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/35b1ac0be59ce34160b5c99e3a1e50fa80891bfc", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243", "committedDate": "2020-02-26T01:34:05Z", "type": "commit"}, {"oid": "de16e10598b3903903cfce3f39334eb65cca4ee3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/de16e10598b3903903cfce3f39334eb65cca4ee3", "message": "Modify helm command for Upgrade Test", "committedDate": "2020-02-26T01:35:02Z", "type": "commit"}, {"oid": "1754a20817db2d2ad81992e1bc946e80f49162f8", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1754a20817db2d2ad81992e1bc946e80f49162f8", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243", "committedDate": "2020-03-02T20:59:03Z", "type": "commit"}]}