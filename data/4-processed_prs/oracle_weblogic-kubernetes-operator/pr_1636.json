{"pr_number": 1636, "pr_title": "Create image with basic domain model in extension class", "pr_createdAt": "2020-05-08T21:08:05Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1636", "timeline": [{"oid": "582f28abd23f0ed8aaf0f998e51f5a9df4c79d4e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/582f28abd23f0ed8aaf0f998e51f5a9df4c79d4e", "message": "creating mii basic image in extension class", "committedDate": "2020-05-09T03:15:36Z", "type": "commit"}, {"oid": "bdbc62816528c61d02894ce77dc62fa9bdab9c10", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bdbc62816528c61d02894ce77dc62fa9bdab9c10", "message": "adding javadoc", "committedDate": "2020-05-09T05:18:12Z", "type": "commit"}, {"oid": "a7b4a24029f964cf4985ba1ba27d84ff68bad157", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a7b4a24029f964cf4985ba1ba27d84ff68bad157", "message": "delete images in close()", "committedDate": "2020-05-09T06:11:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxMTQ3Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1636#discussion_r422711472", "bodyText": "The REPO_NAME will either be a value or empty, so please always add it.  We need this for the kind-based tests where there is no need for a REPO_USERNAME, but we do have a REPO_NAME.", "author": "rjeberhard", "createdAt": "2020-05-10T22:47:20Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/TestConstants.java", "diffHunk": "@@ -31,18 +33,34 @@\n       .orElse(REPO_DUMMY_VALUE);\n   public static final String REPO_EMAIL = Optional.ofNullable(System.getenv(\"REPO_EMAIL\"))\n       .orElse(REPO_DUMMY_VALUE);\n+\n+  // jenkins constants\n   public static final String BUILD_ID = Optional.ofNullable(System.getenv(\"BUILD_ID\"))\n       .orElse(\"\");\n   public static final String BRANCH_NAME_FROM_JENKINS = Optional.ofNullable(System.getenv(\"BRANCH\"))\n       .orElse(\"\");\n+\n   public static final String K8S_NODEPORT_HOST = Optional.ofNullable(System.getenv(\"K8S_NODEPORT_HOST\"))\n         .orElse(assertDoesNotThrow(() -> InetAddress.getLocalHost().getHostName()));\n   public static final String GOOGLE_REPO_URL = \"https://kubernetes-charts.storage.googleapis.com/\";\n   public static final String LOGS_DIR = System.getenv().getOrDefault(\"RESULT_ROOT\",\n       System.getProperty(\"java.io.tmpdir\")) + \"/diagnosticlogs\";\n   public static final String PV_ROOT = System.getenv().getOrDefault(\"PV_ROOT\",\n       System.getProperty(\"java.io.tmpdir\") + \"/ittestspvroot\");\n+\n+  // NGINX constants\n   public static final String NGINX_RELEASE_NAME = \"nginx-release\" + BUILD_ID;\n   public static final String STABLE_REPO_NAME = \"stable\";\n   public static final String NGINX_CHART_NAME = \"nginx-ingress\";\n+\n+  // MII image constants\n+  public static final String MII_BASIC_WDT_MODEL_FILE = \"model-basicdomain-singlecluster-sampleapp-wls.yaml\";\n+  public static final String MII_BASIC_IMAGE_NAME = REPO_USERNAME.equals(REPO_DUMMY_VALUE)", "originalCommit": "805ac92a37d0345716bc2605e47117d784db4873", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxMjM3NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1636#discussion_r422712374", "bodyText": "yes, I just noticed that...fixing and testing on kind jenkins job", "author": "vanajamukkara", "createdAt": "2020-05-10T22:55:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxMTQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzA5NDQ1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1636#discussion_r423094456", "bodyText": "done", "author": "vanajamukkara", "createdAt": "2020-05-11T14:47:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxMTQ3Mg=="}], "type": "inlineReview"}, {"oid": "683b535bec846ef101f03937bfed314c12ae6de6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/683b535bec846ef101f03937bfed314c12ae6de6", "message": "move few constants from ItMiiDomain to TestConstants.java and renamed model yaml filename", "committedDate": "2020-05-11T04:52:11Z", "type": "commit"}, {"oid": "805ac92a37d0345716bc2605e47117d784db4873", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/805ac92a37d0345716bc2605e47117d784db4873", "message": "sync with latest develop", "committedDate": "2020-05-11T06:19:54Z", "type": "commit"}, {"oid": "47665813b51f1a80870918e580b797c7916a6ed9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/47665813b51f1a80870918e580b797c7916a6ed9", "message": "fix image name for kind cluster", "committedDate": "2020-05-11T06:53:02Z", "type": "commit"}, {"oid": "1f8f82cf6db481735bb9aac7aa3deb7752955438", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1f8f82cf6db481735bb9aac7aa3deb7752955438", "message": "fix image name", "committedDate": "2020-05-11T06:57:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2NjUwMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1636#discussion_r423166503", "bodyText": "@vanajamukkara Did you test this ? when does this method gets invoked, at the end of the first class that creates the image or at the end of the last class that executes ?", "author": "sankarpn", "createdAt": "2020-05-11T16:31:38Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/extensions/ImageBuilders.java", "diffHunk": "@@ -84,5 +120,64 @@ public void beforeAll(ExtensionContext context) {\n   @Override\n   public void close() {\n     logger.info(\"Cleanup images after all test suites are run\");\n+", "originalCommit": "1f8f82cf6db481735bb9aac7aa3deb7752955438", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE4MDM1Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1636#discussion_r423180352", "bodyText": "yes, its getting executed at the very end of the last class. https://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-model-in-image-tests-10/50/consoleFull", "author": "vanajamukkara", "createdAt": "2020-05-11T16:54:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2NjUwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5MTc5MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1636#discussion_r423191790", "bodyText": "Great", "author": "sankarpn", "createdAt": "2020-05-11T17:12:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2NjUwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NTg0NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1636#discussion_r423195845", "bodyText": "can you log this as a message?", "author": "sankarpn", "createdAt": "2020-05-11T17:19:01Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/extensions/ImageBuilders.java", "diffHunk": "@@ -84,5 +120,64 @@ public void beforeAll(ExtensionContext context) {\n   @Override\n   public void close() {\n     logger.info(\"Cleanup images after all test suites are run\");\n+\n+    // delete mii basic image\n+    if (miiBasicImage != null) {\n+      deleteImage(miiBasicImage);\n+    }\n+\n+    // delete operator image\n+    if (operatorImage != null) {\n+      deleteImage(operatorImage);\n+    }\n+\n+  }\n+\n+  /**\n+   * Create image with basic domain model yaml and sample app.\n+   * @param imageName name of the image\n+   * @param imageTag tag of the image\n+   * @return true if image is created successfully\n+   */\n+  private boolean createMiiBasicImage(String imageName, String imageTag) {\n+\n+    final String image = imageName + \":\" + imageTag;\n+\n+    // build the model file list\n+    final List<String> modelList = Collections.singletonList(MODEL_DIR + \"/\" + MII_BASIC_WDT_MODEL_FILE);\n+\n+    // build an application archive using what is in resources/apps/APP_NAME", "originalCommit": "1f8f82cf6db481735bb9aac7aa3deb7752955438", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI1MzY2Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1636#discussion_r423253666", "bodyText": "done", "author": "vanajamukkara", "createdAt": "2020-05-11T19:01:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NTg0NQ=="}], "type": "inlineReview"}, {"oid": "49b10a122ea7855d2bb39902147ab22c18d20135", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/49b10a122ea7855d2bb39902147ab22c18d20135", "message": "adding log message", "committedDate": "2020-05-12T02:49:53Z", "type": "commit"}, {"oid": "ba00a6a46b0d7c8cf95755f4bd318927e6fc068a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ba00a6a46b0d7c8cf95755f4bd318927e6fc068a", "message": "merge with latest develop", "committedDate": "2020-05-12T23:57:38Z", "type": "commit"}]}