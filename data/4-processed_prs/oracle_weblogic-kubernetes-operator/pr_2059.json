{"pr_number": 2059, "pr_title": "Tanzu sample certification documentation", "pr_createdAt": "2020-11-17T22:05:02Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059", "timeline": [{"oid": "f2a765ab792fcc92e5012b3b70873157876e4ec7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f2a765ab792fcc92e5012b3b70873157876e4ec7", "message": "adding sample doc for Tanzu Kubernetes Grid", "committedDate": "2020-11-17T22:02:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA2NTc1NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r526065755", "bodyText": ",, (typo, double comma)", "author": "rosemarymarano", "createdAt": "2020-11-18T12:57:51Z", "path": "docs-source/content/samples/simple/tanzu-kubernetes-service/_index.md", "diffHunk": "@@ -0,0 +1,759 @@\n+---\n+title: \"Tanzu Kubernetes Service\"\n+date: 2020-11-16T13:34:31-05:00\n+weight: 9\n+description: \"Sample for using the operator to set up a WLS cluster on the Tanzu Kubernetes Service.\"\n+---\n+\n+\n+This sample demonstrates how to use the Oracle [WebLogic Server Kubernetes Operator](/weblogic-kubernetes-operator/) (hereafter \u201cthe operator\u201d) to set up a WebLogic Server (WLS) cluster on the Tanzu Kubernetes Grid (TKG).\n+After performing the sample steps,, your WLS domain runs on a TKG Kubernetes cluster instance and you can manage your WLS domain by using the WebLogic Server Administration Console.", "originalCommit": "f2a765ab792fcc92e5012b3b70873157876e4ec7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI1NjA3MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r526256071", "bodyText": "fixed", "author": "sankarpn", "createdAt": "2020-11-18T17:06:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA2NTc1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA2ODE0Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r526068147", "bodyText": "(https://helm.sh/docs/intro/install/); -> don't need the semi-colon here; only after the word later.", "author": "rosemarymarano", "createdAt": "2020-11-18T13:01:37Z", "path": "docs-source/content/samples/simple/tanzu-kubernetes-service/_index.md", "diffHunk": "@@ -0,0 +1,759 @@\n+---\n+title: \"Tanzu Kubernetes Service\"\n+date: 2020-11-16T13:34:31-05:00\n+weight: 9\n+description: \"Sample for using the operator to set up a WLS cluster on the Tanzu Kubernetes Service.\"\n+---\n+\n+\n+This sample demonstrates how to use the Oracle [WebLogic Server Kubernetes Operator](/weblogic-kubernetes-operator/) (hereafter \u201cthe operator\u201d) to set up a WebLogic Server (WLS) cluster on the Tanzu Kubernetes Grid (TKG).\n+After performing the sample steps,, your WLS domain runs on a TKG Kubernetes cluster instance and you can manage your WLS domain by using the WebLogic Server Administration Console.\n+\n+TKG is a managed Kubernetes Service that lets you quickly deploy and manage Kubernetes clusters. To learn more, see the [Tanzu Kubernetes Grid (TKG)](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.2/vmware-tanzu-kubernetes-grid-12/GUID-index.html) overview page.\n+\n+#### Contents\n+\n+ - [Prerequisites](#prerequisites)\n+   - [Create the Tanzu kubernetes cluster](#create-the-tanzu-cluster)\n+   - [Oracle container registry](#oracle-container-registry)\n+ - [Install WebLogic Server Kubernetes Operator](#install-weblogic-server-kubernetes-operator)\n+ - [Create docker image](#create-docker-image)\n+ - [Create WebLogic domain](#create-weblogic-domain)\n+ - [Invoke the web application](#invoke-the-web-application)\n+\n+#### Prerequisites\n+\n+This sample assumes the following prerequisite environment setup.\n+\n+* WebLogic Server Kubernetes operator: This document was tested with version v3.1.0.\n+* Operating System: GNU/Linux.\n+* [Git](https://git-scm.com/downloads); use `git --version` to test if `git` works.  This document was tested with version 2.17.1.\n+* TKG CLI; use `tkg version` to test if tkg works. This document was tested with version v1.1.3.\n+* [kubectl](https://kubernetes-io-vnext-staging.netlify.com/docs/tasks/tools/install-kubectl/); use `kubectl version` to test if `kubectl` works.  This document was tested with version v1.18.6.\n+* [helm](https://helm.sh/docs/intro/install/); version 3.1 or later; use `helm version` to check the `helm` version.  This document was tested with version v3.2.1.", "originalCommit": "f2a765ab792fcc92e5012b3b70873157876e4ec7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI1NjEzMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r526256131", "bodyText": "fixed", "author": "sankarpn", "createdAt": "2020-11-18T17:06:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA2ODE0Nw=="}], "type": "inlineReview"}, {"oid": "71d2f83c178211b201d9b3b3d196ffd6eef3cfc4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/71d2f83c178211b201d9b3b3d196ffd6eef3cfc4", "message": "fix the doc based on Rosemary's review comments", "committedDate": "2020-11-18T17:05:28Z", "type": "commit"}, {"oid": "2d34ac246d39fa400b054309a5117516c0403c33", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2d34ac246d39fa400b054309a5117516c0403c33", "message": "address Monica's review comments", "committedDate": "2020-11-18T22:07:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAyMDYyNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527020625", "bodyText": "with domain source type of Model In Image -> with a Model in Image domain source type\nruns on an TKG -> runs on a TKG\nOnce the domain has been provisioned -> After the domain has been provisioned, (comma)\nWebLogic Administration console -> WebLogic Server Administration Console", "author": "rosemarymarano", "createdAt": "2020-11-19T16:24:24Z", "path": "docs-source/content/samples/simple/tanzu-kubernetes-service/_index.md", "diffHunk": "@@ -7,7 +7,7 @@ description: \"Sample for using the operator to set up a WLS cluster on the Tanzu\n \n \n This sample demonstrates how to use the Oracle [WebLogic Server Kubernetes Operator](/weblogic-kubernetes-operator/) (hereafter \u201cthe operator\u201d) to set up a WebLogic Server (WLS) cluster on the Tanzu Kubernetes Grid (TKG).\n-After performing the sample steps, your WLS domain runs on a TKG Kubernetes cluster instance and you can manage your WLS domain by using the WebLogic Server Administration Console.\n+After performing the sample steps, your WLS domain with domain source type of Model In Image runs on an TKG Kubernetes cluster instance. Once the domain has been provisioned you can monitor it using the WebLogic Administration console.", "originalCommit": "2d34ac246d39fa400b054309a5117516c0403c33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2NjMxOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527066319", "bodyText": "fixed", "author": "sankarpn", "createdAt": "2020-11-19T17:25:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAyMDYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2NzEwOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527067109", "bodyText": "Fixed", "author": "sankarpn", "createdAt": "2020-11-19T17:26:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAyMDYyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAyMTAxOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527021019", "bodyText": "will direct you to accept Oracle Standard Terms -> will direct you to accept the Oracle Standard Terms", "author": "rosemarymarano", "createdAt": "2020-11-19T16:24:51Z", "path": "docs-source/content/samples/simple/tanzu-kubernetes-service/_index.md", "diffHunk": "@@ -48,7 +48,7 @@ k8s-cluster-101-md-0-577b7dc766-p2gkz   Ready      <none>   2d20h   v1.18.6+vmwa\n \n ##### Oracle Container Registry\n \n-You will need an Oracle account. The following steps will direct you to accept the license agreement for WebLogic Server.  Make note of your Oracle Account password and email.  This sample pertains to 12.2.1.4, but other versions may work as well.\n+You will need an Oracle Container Registry account. The following steps will direct you to accept Oracle Standard Terms and Restrictions to pull the WebLogic Server images.  Make note of your Oracle Account password and email.  This sample pertains to 12.2.1.4, but other versions may work as well.", "originalCommit": "2d34ac246d39fa400b054309a5117516c0403c33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2NjY5Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527066693", "bodyText": "fixed", "author": "sankarpn", "createdAt": "2020-11-19T17:26:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAyMTAxOQ=="}], "type": "inlineReview"}, {"oid": "e67d2abaed5718e21aa7767c02e2b8e54f677880", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e67d2abaed5718e21aa7767c02e2b8e54f677880", "message": "address Rosemary's review comments", "committedDate": "2020-11-19T17:27:50Z", "type": "commit"}, {"oid": "91be3143a1dc41ec0a6cb1f093062506ef83cde2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/91be3143a1dc41ec0a6cb1f093062506ef83cde2", "message": "fianl edits", "committedDate": "2020-11-19T18:08:19Z", "type": "commit"}, {"oid": "036ed255502e9ba9a76672f0ae87dc1bff8e4109", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/036ed255502e9ba9a76672f0ae87dc1bff8e4109", "message": "last edits", "committedDate": "2020-11-19T19:50:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI3ODA4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527278087", "bodyText": "Maybe to link back to the Prerequisites area would be nice.", "author": "mriccell", "createdAt": "2020-11-19T23:44:38Z", "path": "docs-source/content/samples/simple/tanzu-kubernetes-service/_index.md", "diffHunk": "@@ -0,0 +1,752 @@\n+---\n+title: \"Tanzu Kubernetes Service\"\n+date: 2020-11-16T13:34:31-05:00\n+weight: 9\n+description: \"Sample for using the operator to set up a WLS cluster on the Tanzu Kubernetes Service.\"\n+---\n+\n+\n+This sample demonstrates how to use the Oracle [WebLogic Server Kubernetes Operator](/weblogic-kubernetes-operator/) (hereafter \u201cthe operator\u201d) to set up a WebLogic Server (WLS) cluster on the Tanzu Kubernetes Grid (TKG).\n+After performing the sample steps, your WLS domain with a Model in Image domain source type runs on a TKG Kubernetes cluster instance. After the domain has been provisioned, you can monitor it using the WebLogic Server Administration console.\n+\n+TKG is a managed Kubernetes Service that lets you quickly deploy and manage Kubernetes clusters. To learn more, see the [Tanzu Kubernetes Grid (TKG)](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.2/vmware-tanzu-kubernetes-grid-12/GUID-index.html) overview page.\n+\n+#### Contents\n+\n+ - [Prerequisites](#prerequisites)\n+   - [Create a Tanzu Kubernetes cluster](#create-a-tanzu-kubernetes-cluster)\n+   - [Oracle Container Registry](#oracle-container-registry)\n+ - [Install WebLogic Server Kubernetes Operator](#install-weblogic-server-kubernetes-operator)\n+ - [Create Docker image](#create-docker-image)\n+ - [Create WebLogic domain](#create-weblogic-domain)\n+ - [Invoke the web application](#invoke-the-web-application)\n+\n+#### Prerequisites\n+\n+This sample assumes the following prerequisite environment setup.\n+\n+* WebLogic Server Kubernetes Operator: This document was tested with version v3.1.0.\n+* Operating System: GNU/Linux.\n+* [Git](https://git-scm.com/downloads); use `git --version` to test if `git` works.  This document was tested with version 2.17.1.\n+* TKG CLI; use `tkg version` to test if TKG works. This document was tested with version v1.1.3.\n+* [kubectl](https://kubernetes-io-vnext-staging.netlify.com/docs/tasks/tools/install-kubectl/); use `kubectl version` to test if `kubectl` works.  This document was tested with version v1.18.6.\n+* [Helm](https://helm.sh/docs/intro/install/) version 3.1 or later; use `helm version` to check the `helm` version.  This document was tested with version v3.2.1.\n+\n+##### Create a Tanzu Kubernetes cluster\n+\n+Create the Kubernetes cluster using the TKG CLI. See the [Tanzu documentation](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.2/vmware-tanzu-kubernetes-grid-12/GUID-index.html) to set up your Kubernetes cluster.\n+After your Kubernetes cluster is up and running, run the following commands to make sure `kubectl` can access the Kubernetes cluster:\n+\n+```bash\n+$ kubectl get nodes -o wide\n+NAME                                    STATUS     ROLES    AGE     VERSION            INTERNAL-IP       EXTERNAL-IP       OS-IMAGE                 KERNEL-VERSION   CONTAINER-RUNTIME\n+k8s-cluster-101-control-plane-8nj7t     NotReady   master   2d20h   v1.18.6+vmware.1   192.168.100.147   192.168.100.147   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-552hn   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.148   192.168.100.148   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-m8wrc   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.149   192.168.100.149   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-p2gkz   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.150   192.168.100.150   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+```\n+\n+##### Oracle Container Registry\n+\n+You will need an Oracle Container Registry account. The following steps will direct you to accept the Oracle Standard Terms and Restrictions to pull the WebLogic Server images.  Make note of your Oracle Account password and email.  This sample pertains to 12.2.1.4, but other versions may work as well.\n+\n+Obtain the WebLogic Server image from the [Oracle Container Registry](https://container-registry.oracle.com/).\n+\n+  - First time users, [follow these directions](/weblogic-kubernetes-operator/userguide/managing-domains/domain-in-image/base-images/#obtaining-standard-images-from-the-oracle-container-registry).   \n+  - Find and then pull the WebLogic 12.2.1.4 install image:\n+     ```bash\n+     $ docker pull container-registry.oracle.com/middleware/weblogic:12.2.1.4\n+     ```\n+\n+#### Install WebLogic Server Kubernetes Operator\n+\n+The Oracle WebLogic Server Kubernetes Operator is an adapter to integrate WebLogic Server and Kubernetes, allowing Kubernetes to serve as a container infrastructure hosting WLS instances.\n+The operator runs as a Kubernetes Pod and stands ready to perform actions related to running WLS on Kubernetes.\n+\n+Clone the Oracle WebLogic Server Kubernetes Operator repository to your machine. We will use several scripts in this repository to create a WebLogic domain.\n+Kubernetes Operators use [Helm](https://helm.sh/) to manage Kubernetes applications. The operator\u2019s Helm chart is located in the `kubernetes/charts/weblogic-operator` directory. Install the operator by running the following commands.\n+\n+Clone the repository.\n+\n+```bash\n+$ git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+$ cd weblogic-kubernetes-operator\n+$ git checkout v3.1.0\n+```\n+\n+Grant the Helm service account the cluster-admin role.\n+\n+```bash\n+$ cat <<EOF | kubectl apply -f -\n+apiVersion: rbac.authorization.k8s.io/v1\n+kind: ClusterRoleBinding\n+metadata:\n+  name: helm-user-cluster-admin-role\n+roleRef:\n+  apiGroup: rbac.authorization.k8s.io\n+  kind: ClusterRole\n+  name: cluster-admin\n+subjects:\n+- kind: ServiceAccount\n+  name: default\n+  namespace: kube-system\n+EOF\n+```\n+\n+Create a namespace and service account for the operator.\n+\n+```bash\n+$ kubectl create namespace sample-weblogic-operator-ns\n+namespace/sample-weblogic-operator-ns created\n+\n+\n+$ kubectl create serviceaccount -n sample-weblogic-operator-ns sample-weblogic-operator-sa\n+serviceaccount/sample-weblogic-operator-sa created\n+```\n+\n+Install the operator.\n+\n+```bash\n+$ helm install weblogic-operator kubernetes/charts/weblogic-operator \\\n+  --namespace sample-weblogic-operator-ns \\\n+  --set serviceAccount=sample-weblogic-operator-sa \\\n+  --set \"enableClusterRoleBinding=true\" --wait\n+\n+NAME: weblogic-operator\n+LAST DEPLOYED: Tue Nov 17 09:33:58 2020\n+NAMESPACE: sample-weblogic-operator-ns\n+STATUS: deployed\n+REVISION: 1\n+TEST SUITE: None\n+```\n+\n+Verify the operator with the following commands; the status will be running.\n+\n+```bash\n+$ helm list -A\n+NAME                        NAMESPACE                     REVISION   UPDATED                                 STATUS       CHART                   APP VERSION\n+sample-weblogic-operator    sample-weblogic-operator-ns   1          2020-11-17 09:33:58.584239273 -0700 PDT deployed     weblogic-operator-3.1\n+\n+\n+$ kubectl get pods -n sample-weblogic-operator-ns\n+NAME                                 READY   STATUS    RESTARTS   AGE\n+weblogic-operator-775b668c8f-nwwnn   1/1     Running   0          32s\n+```\n+\n+\n+#### Create Docker image\n+\n+\n+  - [Image creation prerequisites](#image-creation-prerequisites)\n+  - [Image creation - Introduction](#image-creation---introduction)\n+  - [Understanding your first archive](#understanding-your-first-archive)\n+  - [Staging a ZIP file of the archive](#staging-a-zip-file-of-the-archive)\n+  - [Staging model files](#staging-model-files)\n+  - [Creating the image with WIT](#creating-the-image-with-wit)\n+\n+##### Image creation prerequisites\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 or 11 installation.\n+2. Copy the sample to a new directory; for example, use the directory `/tmp/mii-sample`.\n+\n+```bash\n+$ mkdir /tmp/mii-sample\n+$ cp -r /root/weblogic-kubernetes-operator/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/* /tmp/mii-sample\n+```\n+\n+\n+**Note**: We will refer to this working copy of the sample as `/tmp/mii-sample`; however, you can use a different location.\n+\n+Download the latest WebLogic Deploying Tooling (WDT) and WebLogic Image Tool (WIT) installer ZIP files to your `/tmp/mii-sample/model-images` directory. Both WDT and WIT are required to create your Model in Image Docker images.\n+\n+For example, visit the GitHub [WebLogic Deploy Tooling Releases](https://github.com/oracle/weblogic-deploy-tooling/releases) and [WebLogic Image Tool Releases](https://github.com/oracle/weblogic-image-tool/releases) web pages to determine the latest release version for each, and then, assuming the version numbers are `1.9.7` and `1.9.5` respectively, call:\n+\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+\n+$ curl -m 120 -fL https://github.com/oracle/weblogic-deploy-tooling/releases/download/release-1.9.7/weblogic-deploy.zip \\\n+  -o /tmp/mii-sample/model-images/weblogic-deploy.zip\n+\n+$ curl -m 120 -fL https://github.com/oracle/weblogic-image-tool/releases/download/release-1.9.5/imagetool.zip \\\n+  -o /tmp/mii-sample/model-images/imagetool.zip\n+```\n+\n+\n+To set up the WebLogic Image Tool, run the following commands:\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+\n+$ unzip imagetool.zip\n+\n+$ ./imagetool/bin/imagetool.sh cache addInstaller \\\n+  --type wdt \\\n+  --version latest \\\n+  --path /tmp/mii-sample/model-images/weblogic-deploy.zip\n+```\n+\n+These steps will install WIT to the `/tmp/mii-sample/model-images/imagetool` directory, plus put a `wdt_latest` entry in the tool\u2019s cache which points to the WDT ZIP file installer. You will use WIT later in the sample for creating model images.\n+\n+\n+##### Image creation - Introduction\n+\n+The goal of image creation is to demonstrate using the WebLogic Image Tool to create an image named `model-in-image:WLS-v1` from files that you will stage to `/tmp/mii-sample/model-images/model-in-image:WLS-v1/`.\n+The staged files will contain a web application in a WDT archive, and WDT model configuration for a WebLogic Administration Server called `admin-server` and a WebLogic cluster called `cluster-1`.\n+\n+Overall, a Model in Image image must contain a WebLogic Server installation and a WebLogic Deploy Tooling installation in its `/u01/wdt/weblogic-deploy` directory.\n+In addition, if you have WDT model archive files, then the image must also contain these files in its `/u01/wdt/models` directory.\n+Finally, an image optionally may also contain your WDT model YAML file and properties files in the same `/u01/wdt/models` directory.\n+If you do not specify a WDT model YAML file in your `/u01/wdt/models` directory, then the model YAML file must be supplied dynamically using a Kubernetes ConfigMap that is referenced by your Domain `spec.model.configMap` field.\n+We provide an example of using a model ConfigMap later in this sample.\n+\n+The following sections contain the steps for creating the image `model-in-image:WLS-v1`.\n+\n+##### Understanding your first archive\n+\n+The sample includes a predefined archive directory in `/tmp/mii-sample/archives/archive-v1` that you will use to create an archive ZIP file for the image.\n+\n+The archive top directory, named `wlsdeploy`, contains a directory named `applications`, which includes an \u2018exploded\u2019 sample JSP web application in the directory, `myapp-v1`. Three useful aspects to remember about WDT archives are:\n+  - A model image can contain multiple WDT archives.\n+  - WDT archives can contain multiple applications, libraries, and other components.\n+  - WDT archives have a [well defined directory structure](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/archive.md), which always has `wlsdeploy` as the top directory.\n+\n+The application displays important details about the WebLogic Server instance that it\u2019s running on: namely its domain name, cluster name, and server name, as well as the names of any data sources that are targeted to the server.\n+\n+\n+##### Staging a ZIP file of the archive\n+\n+When you create the image, you will use the files in the staging directory, `/tmp/mii-sample/model-in-image__WLS-v1`. In preparation, you need it to contain a ZIP file of the WDT application archive.\n+\n+Run the following commands to create your application archive ZIP file and put it in the expected directory:\n+\n+```bash\n+# Delete existing archive.zip in case we have an old leftover version\n+$ rm -f /tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip\n+\n+# Move to the directory which contains the source files for our archive\n+$ cd /tmp/mii-sample/archives/archive-v1\n+\n+# Zip the archive to the location will later use when we run the WebLogic Image Tool\n+$ zip -r /tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip wlsdeploy\n+```\n+\n+##### Staging model files\n+\n+In this step, you explore the staged WDT model YAML file and properties in the `/tmp/mii-sample/model-in-image__WLS-v1` directory. The model in this directory references the web application in your archive,\n+configures a WebLogic Server Administration Server, and configures a WebLogic cluster. It consists of only two files, `model.10.properties`, a file with a single property, and, `model.10.yaml`, a YAML file with your WebLogic configuration `model.10.yaml`.\n+\n+```\n+CLUSTER_SIZE=5\n+```\n+\n+Here is the WLS `model.10.yaml`:\n+\n+```\n+domainInfo:\n+    AdminUserName: '@@SECRET:__weblogic-credentials__:username@@'\n+    AdminPassword: '@@SECRET:__weblogic-credentials__:password@@'\n+    ServerStartMode: 'prod'\n+\n+topology:\n+    Name: '@@ENV:CUSTOM_DOMAIN_NAME@@'\n+    AdminServerName: 'admin-server'\n+    Cluster:\n+        'cluster-1':\n+            DynamicServers:\n+                ServerTemplate:  'cluster-1-template'\n+                ServerNamePrefix: 'managed-server'\n+                DynamicClusterSize: '@@PROP:CLUSTER_SIZE@@'\n+                MaxDynamicClusterSize: '@@PROP:CLUSTER_SIZE@@'\n+                MinDynamicClusterSize: '0'\n+                CalculatedListenPorts: false\n+    Server:\n+        'admin-server':\n+            ListenPort: 7001\n+    ServerTemplate:\n+        'cluster-1-template':\n+            Cluster: 'cluster-1'\n+            ListenPort: 8001\n+\n+appDeployments:\n+    Application:\n+        myapp:\n+            SourcePath: 'wlsdeploy/applications/myapp-v1'\n+            ModuleType: ear\n+            Target: 'cluster-1'\n+```\n+\n+\n+\n+The model files:\n+\n+- Define a WebLogic domain with:\n+    - Cluster `cluster-1`\n+    - Administration Server `admin-server`\n+    - A `cluster-1` targeted EAR application that\u2019s located in the WDT archive ZIP file at `wlsdeploy/applications/myapp-v1`\n+\n+- Leverage macros to inject external values:\n+    - The property file `CLUSTER_SIZE` property is referenced in the model YAML file `DynamicClusterSize` and `MaxDynamicClusterSize` fields using a PROP macro.\n+    - The model file domain name is injected using a custom environment variable named `CUSTOM_DOMAIN_NAME` using an ENV macro.\n+        - You set this environment variable later in this sample using an env field in its Domain.\n+        - _This conveniently provides a simple way to deploy multiple differently named domains using the same model image_.\n+    - The model file administrator user name and password are set using a `weblogic-credentials` secret macro reference to the WebLogic credential secret.\n+        - This secret is in turn referenced using the `webLogicCredentialsSecret` field in the Domain.\n+        - The `weblogic-credentials` is a reserved name that always dereferences to the owning Domain actual WebLogic credentials secret name.\n+\n+A Model in Image image can contain multiple properties files, archive ZIP files, and YAML files but in this sample you use just one of each. For a complete discussion of Model in Images model file naming conventions, file loading order, and macro syntax, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) files in the Model in Image user documentation.\n+\n+##### Creating the image with WIT\n+\n+At this point, you have staged all of the files needed for the image `model-in-image:WLS-v1`; they include:\n+\n+  - `/tmp/mii-sample/model-images/weblogic-deploy.zip`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/model.10.yaml`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/model.10.properties`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip`\n+\n+If you don\u2019t see the `weblogic-deploy.zip` file, then you missed a step in the prerequisites.", "originalCommit": "036ed255502e9ba9a76672f0ae87dc1bff8e4109", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMzNjg1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527336856", "bodyText": "Done.", "author": "sankarpn", "createdAt": "2020-11-20T01:32:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI3ODA4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI4MDU0Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527280543", "bodyText": "Why two ingresses one for the cluster and one for admin console?  Can you not do 2 paths?  This is an example with traefik\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\nname: traefik-pathrouting-1\nnamespace: sample-domain1-ns\nannotations:\nkubernetes.io/ingress.class: traefik\nspec:\nrules:\n\nhost:\nhttp:\npaths:\n\npath: /\nbackend:\nserviceName: sample-domain1-cluster-cluster-1\nservicePort: 8001\npath: /console\nbackend:\nserviceName: sample-domain1-admin-server\nservicePort: 7001", "author": "mriccell", "createdAt": "2020-11-19T23:51:49Z", "path": "docs-source/content/samples/simple/tanzu-kubernetes-service/_index.md", "diffHunk": "@@ -0,0 +1,752 @@\n+---\n+title: \"Tanzu Kubernetes Service\"\n+date: 2020-11-16T13:34:31-05:00\n+weight: 9\n+description: \"Sample for using the operator to set up a WLS cluster on the Tanzu Kubernetes Service.\"\n+---\n+\n+\n+This sample demonstrates how to use the Oracle [WebLogic Server Kubernetes Operator](/weblogic-kubernetes-operator/) (hereafter \u201cthe operator\u201d) to set up a WebLogic Server (WLS) cluster on the Tanzu Kubernetes Grid (TKG).\n+After performing the sample steps, your WLS domain with a Model in Image domain source type runs on a TKG Kubernetes cluster instance. After the domain has been provisioned, you can monitor it using the WebLogic Server Administration console.\n+\n+TKG is a managed Kubernetes Service that lets you quickly deploy and manage Kubernetes clusters. To learn more, see the [Tanzu Kubernetes Grid (TKG)](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.2/vmware-tanzu-kubernetes-grid-12/GUID-index.html) overview page.\n+\n+#### Contents\n+\n+ - [Prerequisites](#prerequisites)\n+   - [Create a Tanzu Kubernetes cluster](#create-a-tanzu-kubernetes-cluster)\n+   - [Oracle Container Registry](#oracle-container-registry)\n+ - [Install WebLogic Server Kubernetes Operator](#install-weblogic-server-kubernetes-operator)\n+ - [Create Docker image](#create-docker-image)\n+ - [Create WebLogic domain](#create-weblogic-domain)\n+ - [Invoke the web application](#invoke-the-web-application)\n+\n+#### Prerequisites\n+\n+This sample assumes the following prerequisite environment setup.\n+\n+* WebLogic Server Kubernetes Operator: This document was tested with version v3.1.0.\n+* Operating System: GNU/Linux.\n+* [Git](https://git-scm.com/downloads); use `git --version` to test if `git` works.  This document was tested with version 2.17.1.\n+* TKG CLI; use `tkg version` to test if TKG works. This document was tested with version v1.1.3.\n+* [kubectl](https://kubernetes-io-vnext-staging.netlify.com/docs/tasks/tools/install-kubectl/); use `kubectl version` to test if `kubectl` works.  This document was tested with version v1.18.6.\n+* [Helm](https://helm.sh/docs/intro/install/) version 3.1 or later; use `helm version` to check the `helm` version.  This document was tested with version v3.2.1.\n+\n+##### Create a Tanzu Kubernetes cluster\n+\n+Create the Kubernetes cluster using the TKG CLI. See the [Tanzu documentation](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.2/vmware-tanzu-kubernetes-grid-12/GUID-index.html) to set up your Kubernetes cluster.\n+After your Kubernetes cluster is up and running, run the following commands to make sure `kubectl` can access the Kubernetes cluster:\n+\n+```bash\n+$ kubectl get nodes -o wide\n+NAME                                    STATUS     ROLES    AGE     VERSION            INTERNAL-IP       EXTERNAL-IP       OS-IMAGE                 KERNEL-VERSION   CONTAINER-RUNTIME\n+k8s-cluster-101-control-plane-8nj7t     NotReady   master   2d20h   v1.18.6+vmware.1   192.168.100.147   192.168.100.147   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-552hn   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.148   192.168.100.148   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-m8wrc   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.149   192.168.100.149   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-p2gkz   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.150   192.168.100.150   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+```\n+\n+##### Oracle Container Registry\n+\n+You will need an Oracle Container Registry account. The following steps will direct you to accept the Oracle Standard Terms and Restrictions to pull the WebLogic Server images.  Make note of your Oracle Account password and email.  This sample pertains to 12.2.1.4, but other versions may work as well.\n+\n+Obtain the WebLogic Server image from the [Oracle Container Registry](https://container-registry.oracle.com/).\n+\n+  - First time users, [follow these directions](/weblogic-kubernetes-operator/userguide/managing-domains/domain-in-image/base-images/#obtaining-standard-images-from-the-oracle-container-registry).   \n+  - Find and then pull the WebLogic 12.2.1.4 install image:\n+     ```bash\n+     $ docker pull container-registry.oracle.com/middleware/weblogic:12.2.1.4\n+     ```\n+\n+#### Install WebLogic Server Kubernetes Operator\n+\n+The Oracle WebLogic Server Kubernetes Operator is an adapter to integrate WebLogic Server and Kubernetes, allowing Kubernetes to serve as a container infrastructure hosting WLS instances.\n+The operator runs as a Kubernetes Pod and stands ready to perform actions related to running WLS on Kubernetes.\n+\n+Clone the Oracle WebLogic Server Kubernetes Operator repository to your machine. We will use several scripts in this repository to create a WebLogic domain.\n+Kubernetes Operators use [Helm](https://helm.sh/) to manage Kubernetes applications. The operator\u2019s Helm chart is located in the `kubernetes/charts/weblogic-operator` directory. Install the operator by running the following commands.\n+\n+Clone the repository.\n+\n+```bash\n+$ git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+$ cd weblogic-kubernetes-operator\n+$ git checkout v3.1.0\n+```\n+\n+Grant the Helm service account the cluster-admin role.\n+\n+```bash\n+$ cat <<EOF | kubectl apply -f -\n+apiVersion: rbac.authorization.k8s.io/v1\n+kind: ClusterRoleBinding\n+metadata:\n+  name: helm-user-cluster-admin-role\n+roleRef:\n+  apiGroup: rbac.authorization.k8s.io\n+  kind: ClusterRole\n+  name: cluster-admin\n+subjects:\n+- kind: ServiceAccount\n+  name: default\n+  namespace: kube-system\n+EOF\n+```\n+\n+Create a namespace and service account for the operator.\n+\n+```bash\n+$ kubectl create namespace sample-weblogic-operator-ns\n+namespace/sample-weblogic-operator-ns created\n+\n+\n+$ kubectl create serviceaccount -n sample-weblogic-operator-ns sample-weblogic-operator-sa\n+serviceaccount/sample-weblogic-operator-sa created\n+```\n+\n+Install the operator.\n+\n+```bash\n+$ helm install weblogic-operator kubernetes/charts/weblogic-operator \\\n+  --namespace sample-weblogic-operator-ns \\\n+  --set serviceAccount=sample-weblogic-operator-sa \\\n+  --set \"enableClusterRoleBinding=true\" --wait\n+\n+NAME: weblogic-operator\n+LAST DEPLOYED: Tue Nov 17 09:33:58 2020\n+NAMESPACE: sample-weblogic-operator-ns\n+STATUS: deployed\n+REVISION: 1\n+TEST SUITE: None\n+```\n+\n+Verify the operator with the following commands; the status will be running.\n+\n+```bash\n+$ helm list -A\n+NAME                        NAMESPACE                     REVISION   UPDATED                                 STATUS       CHART                   APP VERSION\n+sample-weblogic-operator    sample-weblogic-operator-ns   1          2020-11-17 09:33:58.584239273 -0700 PDT deployed     weblogic-operator-3.1\n+\n+\n+$ kubectl get pods -n sample-weblogic-operator-ns\n+NAME                                 READY   STATUS    RESTARTS   AGE\n+weblogic-operator-775b668c8f-nwwnn   1/1     Running   0          32s\n+```\n+\n+\n+#### Create Docker image\n+\n+\n+  - [Image creation prerequisites](#image-creation-prerequisites)\n+  - [Image creation - Introduction](#image-creation---introduction)\n+  - [Understanding your first archive](#understanding-your-first-archive)\n+  - [Staging a ZIP file of the archive](#staging-a-zip-file-of-the-archive)\n+  - [Staging model files](#staging-model-files)\n+  - [Creating the image with WIT](#creating-the-image-with-wit)\n+\n+##### Image creation prerequisites\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 or 11 installation.\n+2. Copy the sample to a new directory; for example, use the directory `/tmp/mii-sample`.\n+\n+```bash\n+$ mkdir /tmp/mii-sample\n+$ cp -r /root/weblogic-kubernetes-operator/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/* /tmp/mii-sample\n+```\n+\n+\n+**Note**: We will refer to this working copy of the sample as `/tmp/mii-sample`; however, you can use a different location.\n+\n+Download the latest WebLogic Deploying Tooling (WDT) and WebLogic Image Tool (WIT) installer ZIP files to your `/tmp/mii-sample/model-images` directory. Both WDT and WIT are required to create your Model in Image Docker images.\n+\n+For example, visit the GitHub [WebLogic Deploy Tooling Releases](https://github.com/oracle/weblogic-deploy-tooling/releases) and [WebLogic Image Tool Releases](https://github.com/oracle/weblogic-image-tool/releases) web pages to determine the latest release version for each, and then, assuming the version numbers are `1.9.7` and `1.9.5` respectively, call:\n+\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+\n+$ curl -m 120 -fL https://github.com/oracle/weblogic-deploy-tooling/releases/download/release-1.9.7/weblogic-deploy.zip \\\n+  -o /tmp/mii-sample/model-images/weblogic-deploy.zip\n+\n+$ curl -m 120 -fL https://github.com/oracle/weblogic-image-tool/releases/download/release-1.9.5/imagetool.zip \\\n+  -o /tmp/mii-sample/model-images/imagetool.zip\n+```\n+\n+\n+To set up the WebLogic Image Tool, run the following commands:\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+\n+$ unzip imagetool.zip\n+\n+$ ./imagetool/bin/imagetool.sh cache addInstaller \\\n+  --type wdt \\\n+  --version latest \\\n+  --path /tmp/mii-sample/model-images/weblogic-deploy.zip\n+```\n+\n+These steps will install WIT to the `/tmp/mii-sample/model-images/imagetool` directory, plus put a `wdt_latest` entry in the tool\u2019s cache which points to the WDT ZIP file installer. You will use WIT later in the sample for creating model images.\n+\n+\n+##### Image creation - Introduction\n+\n+The goal of image creation is to demonstrate using the WebLogic Image Tool to create an image named `model-in-image:WLS-v1` from files that you will stage to `/tmp/mii-sample/model-images/model-in-image:WLS-v1/`.\n+The staged files will contain a web application in a WDT archive, and WDT model configuration for a WebLogic Administration Server called `admin-server` and a WebLogic cluster called `cluster-1`.\n+\n+Overall, a Model in Image image must contain a WebLogic Server installation and a WebLogic Deploy Tooling installation in its `/u01/wdt/weblogic-deploy` directory.\n+In addition, if you have WDT model archive files, then the image must also contain these files in its `/u01/wdt/models` directory.\n+Finally, an image optionally may also contain your WDT model YAML file and properties files in the same `/u01/wdt/models` directory.\n+If you do not specify a WDT model YAML file in your `/u01/wdt/models` directory, then the model YAML file must be supplied dynamically using a Kubernetes ConfigMap that is referenced by your Domain `spec.model.configMap` field.\n+We provide an example of using a model ConfigMap later in this sample.\n+\n+The following sections contain the steps for creating the image `model-in-image:WLS-v1`.\n+\n+##### Understanding your first archive\n+\n+The sample includes a predefined archive directory in `/tmp/mii-sample/archives/archive-v1` that you will use to create an archive ZIP file for the image.\n+\n+The archive top directory, named `wlsdeploy`, contains a directory named `applications`, which includes an \u2018exploded\u2019 sample JSP web application in the directory, `myapp-v1`. Three useful aspects to remember about WDT archives are:\n+  - A model image can contain multiple WDT archives.\n+  - WDT archives can contain multiple applications, libraries, and other components.\n+  - WDT archives have a [well defined directory structure](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/archive.md), which always has `wlsdeploy` as the top directory.\n+\n+The application displays important details about the WebLogic Server instance that it\u2019s running on: namely its domain name, cluster name, and server name, as well as the names of any data sources that are targeted to the server.\n+\n+\n+##### Staging a ZIP file of the archive\n+\n+When you create the image, you will use the files in the staging directory, `/tmp/mii-sample/model-in-image__WLS-v1`. In preparation, you need it to contain a ZIP file of the WDT application archive.\n+\n+Run the following commands to create your application archive ZIP file and put it in the expected directory:\n+\n+```bash\n+# Delete existing archive.zip in case we have an old leftover version\n+$ rm -f /tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip\n+\n+# Move to the directory which contains the source files for our archive\n+$ cd /tmp/mii-sample/archives/archive-v1\n+\n+# Zip the archive to the location will later use when we run the WebLogic Image Tool\n+$ zip -r /tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip wlsdeploy\n+```\n+\n+##### Staging model files\n+\n+In this step, you explore the staged WDT model YAML file and properties in the `/tmp/mii-sample/model-in-image__WLS-v1` directory. The model in this directory references the web application in your archive,\n+configures a WebLogic Server Administration Server, and configures a WebLogic cluster. It consists of only two files, `model.10.properties`, a file with a single property, and, `model.10.yaml`, a YAML file with your WebLogic configuration `model.10.yaml`.\n+\n+```\n+CLUSTER_SIZE=5\n+```\n+\n+Here is the WLS `model.10.yaml`:\n+\n+```\n+domainInfo:\n+    AdminUserName: '@@SECRET:__weblogic-credentials__:username@@'\n+    AdminPassword: '@@SECRET:__weblogic-credentials__:password@@'\n+    ServerStartMode: 'prod'\n+\n+topology:\n+    Name: '@@ENV:CUSTOM_DOMAIN_NAME@@'\n+    AdminServerName: 'admin-server'\n+    Cluster:\n+        'cluster-1':\n+            DynamicServers:\n+                ServerTemplate:  'cluster-1-template'\n+                ServerNamePrefix: 'managed-server'\n+                DynamicClusterSize: '@@PROP:CLUSTER_SIZE@@'\n+                MaxDynamicClusterSize: '@@PROP:CLUSTER_SIZE@@'\n+                MinDynamicClusterSize: '0'\n+                CalculatedListenPorts: false\n+    Server:\n+        'admin-server':\n+            ListenPort: 7001\n+    ServerTemplate:\n+        'cluster-1-template':\n+            Cluster: 'cluster-1'\n+            ListenPort: 8001\n+\n+appDeployments:\n+    Application:\n+        myapp:\n+            SourcePath: 'wlsdeploy/applications/myapp-v1'\n+            ModuleType: ear\n+            Target: 'cluster-1'\n+```\n+\n+\n+\n+The model files:\n+\n+- Define a WebLogic domain with:\n+    - Cluster `cluster-1`\n+    - Administration Server `admin-server`\n+    - A `cluster-1` targeted EAR application that\u2019s located in the WDT archive ZIP file at `wlsdeploy/applications/myapp-v1`\n+\n+- Leverage macros to inject external values:\n+    - The property file `CLUSTER_SIZE` property is referenced in the model YAML file `DynamicClusterSize` and `MaxDynamicClusterSize` fields using a PROP macro.\n+    - The model file domain name is injected using a custom environment variable named `CUSTOM_DOMAIN_NAME` using an ENV macro.\n+        - You set this environment variable later in this sample using an env field in its Domain.\n+        - _This conveniently provides a simple way to deploy multiple differently named domains using the same model image_.\n+    - The model file administrator user name and password are set using a `weblogic-credentials` secret macro reference to the WebLogic credential secret.\n+        - This secret is in turn referenced using the `webLogicCredentialsSecret` field in the Domain.\n+        - The `weblogic-credentials` is a reserved name that always dereferences to the owning Domain actual WebLogic credentials secret name.\n+\n+A Model in Image image can contain multiple properties files, archive ZIP files, and YAML files but in this sample you use just one of each. For a complete discussion of Model in Images model file naming conventions, file loading order, and macro syntax, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) files in the Model in Image user documentation.\n+\n+##### Creating the image with WIT\n+\n+At this point, you have staged all of the files needed for the image `model-in-image:WLS-v1`; they include:\n+\n+  - `/tmp/mii-sample/model-images/weblogic-deploy.zip`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/model.10.yaml`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/model.10.properties`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip`\n+\n+If you don\u2019t see the `weblogic-deploy.zip` file, then you missed a step in the prerequisites.\n+\n+Now, you use the Image Tool to create an image named `model-in-image:WLS-v1` that\u2019s layered on a base WebLogic image. You\u2019ve already set up this tool during the prerequisite steps.\n+\n+Run the following commands to create the model image and verify that it worked:\n+\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+$ ./imagetool/bin/imagetool.sh update \\\n+  --tag model-in-image:WLS-v1 \\\n+  --fromImage container-registry.oracle.com/middleware/weblogic:12.2.1.4 \\\n+  --wdtModel      ./model-in-image__WLS-v1/model.10.yaml \\\n+  --wdtVariables  ./model-in-image__WLS-v1/model.10.properties \\\n+  --wdtArchive    ./model-in-image__WLS-v1/archive.zip \\\n+  --wdtModelOnly \\\n+  --wdtDomainType WLS \\\n+  --chown oracle:root\n+```\n+\n+If you don\u2019t see the `imagetool` directory, then you missed a step in the prerequisites.\n+\n+This command runs the WebLogic Image Tool in its Model in Image mode, and does the following:\n+\n+  - Builds the final Docker image as a layer on the `container-registry.oracle.com/middleware/weblogic:12.2.1.4` base image.\n+  - Copies the WDT ZIP file that\u2019s referenced in the WIT cache into the image.\n+      - Note that you cached WDT in WIT using the keyword `latest` when you set up the cache during the sample prerequisites steps.\n+      - This lets WIT implicitly assume it\u2019s the desired WDT version and removes the need to pass a `-wdtVersion` flag.\n+  - Copies the specified WDT model, properties, and application archives to image location `/u01/wdt/models`.\n+\n+When the command succeeds, it should end with output like the following:\n+\n+```\n+[INFO   ] Build successful. Build time=36s. Image tag=model-in-image:WLS-v1\n+```\n+\n+Also, if you run the `docker images` command, then you will see a Docker image named `model-in-image:WLS-v1`.\n+\n+> Note: If you have Kubernetes cluster worker nodes that are remote to your local machine, then you need to put the image in a location that these nodes can access. See [Ensuring your Kubernetes cluster can access images](#ensuring-your-kubernetes-cluster-can-access-images).\n+\n+\n+#### Create WebLogic domain\n+\n+In this section, you will deploy the new image to namespace `sample-domain1-ns`, including the following steps:\n+\n+- Create a namespace for the WebLogic domain.\n+- Upgrade the operator to manage the WebLogic domain namespace.   \n+- Create a Secret containing your WebLogic administrator user name and password.\n+- Create a Secret containing your Model in Image runtime encryption password:\n+    - All Model in Image domains must supply a runtime encryption Secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the operator.\n+    - The value must be kept private but can be arbitrary; you can optionally supply a different secret value every time you restart the domain.\n+- Deploy a Domain YAML file that references the new image.\n+- Wait for the domain\u2019s Pods to start and reach their ready state.\n+\n+##### Namespace\n+\n+Create a namespace that can host one or more domains:\n+\n+```bash\n+$ kubectl create namespace sample-domain1-ns\n+```\n+\n+##### Upgrade the operator\n+\n+Upgrade the operator to manage the WebLogic domains in namespace `sample-domain1-ns`.\n+\n+```bash\n+$ cd /root/weblogic-kubernetes-operator\n+$ helm upgrade weblogic-operator  kubernetes/charts/weblogic-operator \\\n+  --namespace sample-weblogic-operator-ns \\\n+  --reuse-values \\\n+  --set \"domainNamespaces={sample-domain1-ns}\" \\\n+  --wait\n+```\n+\n+##### Secrets\n+\n+First, create the secrets needed by the WLS type model domain. In this case, you have two secrets.\n+\n+Run the following `kubectl` commands to deploy the required secrets:\n+\n+```bash\n+$ kubectl -n sample-domain1-ns create secret generic \\\n+  sample-domain1-weblogic-credentials \\\n+   --from-literal=username=weblogic --from-literal=password=welcome1\n+$ kubectl -n sample-domain1-ns label  secret \\\n+  sample-domain1-weblogic-credentials \\\n+  weblogic.domainUID=sample-domain1\n+\n+$ kubectl -n sample-domain1-ns create secret generic \\\n+  sample-domain1-runtime-encryption-secret \\\n+   --from-literal=password=my_runtime_password\n+$ kubectl -n sample-domain1-ns label  secret \\\n+  sample-domain1-runtime-encryption-secret \\\n+  weblogic.domainUID=sample-domain1\n+```\n+\n+  Some important details about these secrets:\n+\n+  - The WebLogic credentials secret:\n+    - It is required and must contain `username` and `password` fields.\n+    - It must be referenced by the `spec.webLogicCredentialsSecret` field in your Domain.\n+    - It also must be referenced by macros in the `domainInfo.AdminUserName` and `domainInfo.AdminPassWord` fields in your model YAML file.\n+\n+  - The Model WDT runtime secret:\n+    - This is a special secret required by Model in Image.\n+    - It must contain a `password` field.\n+    - It must be referenced using the `spec.model.runtimeEncryptionSecret` field in its Domain.\n+    - It must remain the same for as long as the domain is deployed to Kubernetes but can be changed between deployments.\n+    - It is used to encrypt data as it's internally passed using log files from the domain's introspector job and on to its WebLogic Server pods.\n+\n+  - Deleting and recreating the secrets:\n+    - You delete a secret before creating it, otherwise the create command will fail if the secret already exists.\n+    - This allows you to change the secret when using the `kubectl create secret` command.\n+\n+  - You name and label secrets using their associated domain UID for two reasons:\n+    - To make it obvious which secrets belong to which domains.\n+    - To make it easier to clean up a domain. Typical cleanup scripts use the `weblogic.domainUID` label as a convenience for finding all resources associated with a domain.\n+\n+##### Domain resource\n+\n+Now, you create a Domain YAML file. A Domain is the key resource that tells the operator how to deploy a WebLogic domain.\n+\n+Copy the following to a file called `/tmp/mii-sample/mii-initial.yaml` or similar, or use the file `/tmp/mii-sample/domain-resources/WLS/mii-initial-d1-WLS-v1.yaml` that is included in the sample source.\n+\n+\n+  {{%expand \"Click here to view the WLS Domain YAML file.\" %}}\n+  ```\n+    #\n+    # This is an example of how to define a Domain resource.\n+    #\n+    apiVersion: \"weblogic.oracle/v8\"\n+    kind: Domain\n+    metadata:\n+      name: sample-domain1\n+      namespace: sample-domain1-ns\n+      labels:\n+        weblogic.domainUID: sample-domain1\n+\n+    spec:\n+      # Set to 'FromModel' to indicate 'Model in Image'.\n+      domainHomeSourceType: FromModel\n+\n+      # The WebLogic Domain Home, this must be a location within\n+      # the image for 'Model in Image' domains.\n+      domainHome: /u01/domains/sample-domain1\n+\n+      # The WebLogic Server Docker image that the Operator uses to start the domain\n+      image: \"model-in-image:WLS-v1\"\n+\n+      # Defaults to \"Always\" if image tag (version) is ':latest'\n+      imagePullPolicy: \"IfNotPresent\"\n+\n+      # Identify which Secret contains the credentials for pulling an image\n+      #imagePullSecrets:\n+      #- name: regsecret\n+\n+      # Identify which Secret contains the WebLogic Admin credentials,\n+      # the secret must contain 'username' and 'password' fields.\n+      webLogicCredentialsSecret:\n+        name: sample-domain1-weblogic-credentials\n+\n+      # Whether to include the WebLogic Server stdout in the pod's stdout, default is true\n+      includeServerOutInPodLog: true\n+\n+      # Whether to enable overriding your log file location, see also 'logHome'\n+      #logHomeEnabled: false\n+\n+      # The location for domain log, server logs, server out, introspector out, and Node Manager log files\n+      # see also 'logHomeEnabled', 'volumes', and 'volumeMounts'.\n+      #logHome: /shared/logs/sample-domain1\n+\n+      # Set which WebLogic Servers the Operator will start\n+      # - \"NEVER\" will not start any server in the domain\n+      # - \"ADMIN_ONLY\" will start up only the administration server (no managed servers will be started)\n+      # - \"IF_NEEDED\" will start all non-clustered servers, including the administration server, and clustered servers up to their replica count.\n+      serverStartPolicy: \"IF_NEEDED\"\n+\n+      # Settings for all server pods in the domain including the introspector job pod\n+      serverPod:\n+        # Optional new or overridden environment variables for the domain's pods\n+        # - This sample uses CUSTOM_DOMAIN_NAME in its image model file\n+        #   to set the Weblogic domain name\n+        env:\n+        - name: CUSTOM_DOMAIN_NAME\n+          value: \"domain1\"\n+        - name: JAVA_OPTIONS\n+          value: \"-Dweblogic.StdoutDebugEnabled=false\"\n+        - name: USER_MEM_ARGS\n+          value: \"-XX:+UseContainerSupport -Djava.security.egd=file:/dev/./urandom \"\n+\n+        # Optional volumes and mounts for the domain's pods. See also 'logHome'.\n+        #volumes:\n+        #- name: weblogic-domain-storage-volume\n+        #  persistentVolumeClaim:\n+        #    claimName: sample-domain1-weblogic-sample-pvc\n+        #volumeMounts:\n+        #- mountPath: /shared\n+        #  name: weblogic-domain-storage-volume\n+\n+      # The desired behavior for starting the domain's administration server.\n+      adminServer:\n+        # The serverStartState legal values are \"RUNNING\" or \"ADMIN\"\n+        # \"RUNNING\" means the listed server will be started up to \"RUNNING\" mode\n+        # \"ADMIN\" means the listed server will be start up to \"ADMIN\" mode\n+        serverStartState: \"RUNNING\"\n+        # Setup a Kubernetes node port for the administration server default channel\n+        #adminService:\n+        #  channels:\n+        #  - channelName: default\n+        #    nodePort: 30701\n+\n+      # The number of managed servers to start for unlisted clusters\n+      replicas: 1\n+\n+      # The desired behavior for starting a specific cluster's member servers\n+      clusters:\n+      - clusterName: cluster-1\n+        serverStartState: \"RUNNING\"\n+        replicas: 2\n+\n+      # Change the `restartVersion` to force the introspector job to rerun\n+      # and apply any new model configuration, to also force a subsequent\n+      # roll of your domain's WebLogic Server pods.\n+      restartVersion: '1'\n+\n+      configuration:\n+\n+        # Settings for domainHomeSourceType 'FromModel'\n+        model:\n+          # Valid model domain types are 'WLS', 'JRF', and 'RestrictedJRF', default is 'WLS'\n+          domainType: \"WLS\"\n+\n+          # Optional configmap for additional models and variable files\n+          #configMap: sample-domain1-wdt-config-map\n+\n+          # All 'FromModel' domains require a runtimeEncryptionSecret with a 'password' field\n+          runtimeEncryptionSecret: sample-domain1-runtime-encryption-secret\n+\n+        # Secrets that are referenced by model yaml macros\n+        # (the model yaml in the optional configMap or in the image)\n+        #secrets:\n+        #- sample-domain1-datasource-secret\n+  ```\n+  {{% /expand %}}\n+\n+\n+  > **Note**: Before you deploy the domain custom resource, determine if you have Kubernetes cluster worker nodes that are remote to your local machine. If so, you need to put the Domain's image in a location that these nodes can access and you may also need to modify your Domain YAML file to reference the new location. See [Ensuring your Kubernetes cluster can access images]({{< relref \"/samples/simple/domains/model-in-image/_index.md#ensuring-your-kubernetes-cluster-can-access-images\" >}}).\n+\n+Run the following command to create the domain custom resource:\n+\n+```bash\n+$ kubectl apply -f /tmp/mii-sample/domain-resources/WLS/mii-initial-d1-WLS-v1.yaml\n+```\n+> **Note**: If you are choosing not to use the predefined Domain YAML file and instead created your own Domain YAML file earlier, then substitute your custom file name in the above command. Previously, we suggested naming it `/tmp/mii-sample/mii-initial.yaml`.\n+\n+Verify the WebLogic Server pods are all running:\n+\n+```\n+$ kubectl get all -n sample-domain1-ns\n+NAME                                 READY   STATUS    RESTARTS   AGE\n+pod/sample-domain1-admin-server      1/1     Running   0          41m\n+pod/sample-domain1-managed-server1   1/1     Running   0          40m\n+pod/sample-domain1-managed-server2   1/1     Running   0          40m\n+\n+NAME                                       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\n+service/sample-domain1-admin-server        ClusterIP   None           <none>        7001/TCP   41m\n+service/sample-domain1-cluster-cluster-1   ClusterIP   100.66.99.27   <none>        8001/TCP   40m\n+service/sample-domain1-managed-server1     ClusterIP   None           <none>        8001/TCP   40m\n+service/sample-domain1-managed-server2     ClusterIP   None           <none>        8001/TCP   40m\n+\n+\n+```\n+\n+#### Invoke the web application\n+\n+Create a load balancer to access the WebLogic Server Administration Console and applications deployed in the cluster.\n+Tanzu supports the MetalLB load balancer and NGINX ingress for routing.\n+\n+\n+Install the MetalLB load balancer by running following commands:\n+\n+```bash\n+## create namespace metallb-system\n+$ kubectl create ns metallb-system\n+\n+## deploy MetalLB load balancer\n+$ kubectl apply -f https://raw.githubusercontent.com/google/metallb/v0.9.2/manifests/metallb.yaml -n metallb-system\n+\n+## create secret\n+$ kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=\"$(openssl rand -base64 128)\"\n+\n+$ cat metallb-configmap.yaml\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  namespace: metallb-system\n+  name: config\n+data:\n+  config: |\n+    address-pools:\n+    - name: default\n+      protocol: layer2\n+      addresses:\n+      - 192.168.100.50-192.168.100.65\n+\n+$ kubectl apply -f metallb-configmap.yaml\n+configmap/config created\n+\n+$ kubectl get all -n metallb-system\n+NAME                              READY   STATUS    RESTARTS   AGE\n+pod/controller-684f5d9b49-jkzfk   1/1     Running   0          2m14s\n+pod/speaker-b457r                 1/1     Running   0          2m14s\n+pod/speaker-bzmmj                 1/1     Running   0          2m14s\n+pod/speaker-gphh5                 1/1     Running   0          2m14s\n+pod/speaker-lktgc                 1/1     Running   0          2m14s\n+\n+NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                 AGE\n+daemonset.apps/speaker   4         4         4       4            4           beta.kubernetes.io/os=linux   2m14s\n+\n+NAME                         READY   UP-TO-DATE   AVAILABLE   AGE\n+deployment.apps/controller   1/1     1            1           2m14s\n+\n+NAME                                    DESIRED   CURRENT   READY   AGE\n+replicaset.apps/controller-684f5d9b49   1         1         1       2m14s\n+```\n+\n+\n+Install NGINX.\n+\n+```bash\n+$ helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\n+$ helm repo update\n+$ helm install ingress-nginx ingress-nginx/ingress-nginx\n+```\n+\n+\n+Create ingress routing for accessing the application deployed in the cluster.\n+\n+```bash\n+$ cat cluster-ingress.yaml", "originalCommit": "036ed255502e9ba9a76672f0ae87dc1bff8e4109", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMzNzA4NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527337085", "bodyText": "Good point, merged both and used single yaml to create both access paths.", "author": "sankarpn", "createdAt": "2020-11-20T01:32:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI4MDU0Mw=="}], "type": "inlineReview"}, {"oid": "c6320b433ea06523dfb4804c4007e82775ffe697", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c6320b433ea06523dfb4804c4007e82775ffe697", "message": "merged the ingress for both cluster and admin console", "committedDate": "2020-11-20T01:31:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY2NTY4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527665681", "bodyText": "to access Administration console. -> to access the Administration Console.", "author": "rosemarymarano", "createdAt": "2020-11-20T12:41:16Z", "path": "docs-source/content/samples/simple/tanzu-kubernetes-service/_index.md", "diffHunk": "@@ -639,64 +639,42 @@ $ helm install ingress-nginx ingress-nginx/ingress-nginx\n ```\n \n \n-Create ingress routing for accessing the application deployed in the cluster.\n+Create ingress for accessing the application deployed in the cluster and to access Administration console.", "originalCommit": "c6320b433ea06523dfb4804c4007e82775ffe697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5MjA4Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527792086", "bodyText": "fixed", "author": "sankarpn", "createdAt": "2020-11-20T16:04:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY2NTY4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcwODg1Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527708853", "bodyText": "@sankarpn, I'm okay with changing this after the fact, but \"extensions/v1beta1\" was deprecated in k8s 1.14 and will be removed in 1.22. The new apiVersion is \"networking.k8s.io/v1beta1\". I believe that we had already updated almost all of our samples, but there are likely places missing.", "author": "rjeberhard", "createdAt": "2020-11-20T14:00:35Z", "path": "docs-source/content/samples/simple/tanzu-kubernetes-service/_index.md", "diffHunk": "@@ -0,0 +1,730 @@\n+---\n+title: \"Tanzu Kubernetes Service\"\n+date: 2020-11-16T13:34:31-05:00\n+weight: 9\n+description: \"Sample for using the operator to set up a WLS cluster on the Tanzu Kubernetes Service.\"\n+---\n+\n+\n+This sample demonstrates how to use the Oracle [WebLogic Server Kubernetes Operator](/weblogic-kubernetes-operator/) (hereafter \u201cthe operator\u201d) to set up a WebLogic Server (WLS) cluster on the Tanzu Kubernetes Grid (TKG).\n+After performing the sample steps, your WLS domain with a Model in Image domain source type runs on a TKG Kubernetes cluster instance. After the domain has been provisioned, you can monitor it using the WebLogic Server Administration console.\n+\n+TKG is a managed Kubernetes Service that lets you quickly deploy and manage Kubernetes clusters. To learn more, see the [Tanzu Kubernetes Grid (TKG)](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.2/vmware-tanzu-kubernetes-grid-12/GUID-index.html) overview page.\n+\n+#### Contents\n+\n+ - [Prerequisites](#prerequisites)\n+   - [Create a Tanzu Kubernetes cluster](#create-a-tanzu-kubernetes-cluster)\n+   - [Oracle Container Registry](#oracle-container-registry)\n+ - [Install WebLogic Server Kubernetes Operator](#install-weblogic-server-kubernetes-operator)\n+ - [Create Docker image](#create-docker-image)\n+ - [Create WebLogic domain](#create-weblogic-domain)\n+ - [Invoke the web application](#invoke-the-web-application)\n+\n+#### Prerequisites\n+\n+This sample assumes the following prerequisite environment setup.\n+\n+* WebLogic Server Kubernetes Operator: This document was tested with version v3.1.0.\n+* Operating System: GNU/Linux.\n+* [Git](https://git-scm.com/downloads); use `git --version` to test if `git` works.  This document was tested with version 2.17.1.\n+* TKG CLI; use `tkg version` to test if TKG works. This document was tested with version v1.1.3.\n+* [kubectl](https://kubernetes-io-vnext-staging.netlify.com/docs/tasks/tools/install-kubectl/); use `kubectl version` to test if `kubectl` works.  This document was tested with version v1.18.6.\n+* [Helm](https://helm.sh/docs/intro/install/) version 3.1 or later; use `helm version` to check the `helm` version.  This document was tested with version v3.2.1.\n+\n+##### Create a Tanzu Kubernetes cluster\n+\n+Create the Kubernetes cluster using the TKG CLI. See the [Tanzu documentation](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.2/vmware-tanzu-kubernetes-grid-12/GUID-index.html) to set up your Kubernetes cluster.\n+After your Kubernetes cluster is up and running, run the following commands to make sure `kubectl` can access the Kubernetes cluster:\n+\n+```bash\n+$ kubectl get nodes -o wide\n+NAME                                    STATUS     ROLES    AGE     VERSION            INTERNAL-IP       EXTERNAL-IP       OS-IMAGE                 KERNEL-VERSION   CONTAINER-RUNTIME\n+k8s-cluster-101-control-plane-8nj7t     NotReady   master   2d20h   v1.18.6+vmware.1   192.168.100.147   192.168.100.147   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-552hn   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.148   192.168.100.148   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-m8wrc   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.149   192.168.100.149   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-p2gkz   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.150   192.168.100.150   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+```\n+\n+##### Oracle Container Registry\n+\n+You will need an Oracle Container Registry account. The following steps will direct you to accept the Oracle Standard Terms and Restrictions to pull the WebLogic Server images.  Make note of your Oracle Account password and email.  This sample pertains to 12.2.1.4, but other versions may work as well.\n+\n+Obtain the WebLogic Server image from the [Oracle Container Registry](https://container-registry.oracle.com/).\n+\n+  - First time users, [follow these directions](/weblogic-kubernetes-operator/userguide/managing-domains/domain-in-image/base-images/#obtaining-standard-images-from-the-oracle-container-registry).   \n+  - Find and then pull the WebLogic 12.2.1.4 install image:\n+     ```bash\n+     $ docker pull container-registry.oracle.com/middleware/weblogic:12.2.1.4\n+     ```\n+\n+#### Install WebLogic Server Kubernetes Operator\n+\n+The Oracle WebLogic Server Kubernetes Operator is an adapter to integrate WebLogic Server and Kubernetes, allowing Kubernetes to serve as a container infrastructure hosting WLS instances.\n+The operator runs as a Kubernetes Pod and stands ready to perform actions related to running WLS on Kubernetes.\n+\n+Clone the Oracle WebLogic Server Kubernetes Operator repository to your machine. We will use several scripts in this repository to create a WebLogic domain.\n+Kubernetes Operators use [Helm](https://helm.sh/) to manage Kubernetes applications. The operator\u2019s Helm chart is located in the `kubernetes/charts/weblogic-operator` directory. Install the operator by running the following commands.\n+\n+Clone the repository.\n+\n+```bash\n+$ git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+$ cd weblogic-kubernetes-operator\n+$ git checkout v3.1.0\n+```\n+\n+Grant the Helm service account the cluster-admin role.\n+\n+```bash\n+$ cat <<EOF | kubectl apply -f -\n+apiVersion: rbac.authorization.k8s.io/v1\n+kind: ClusterRoleBinding\n+metadata:\n+  name: helm-user-cluster-admin-role\n+roleRef:\n+  apiGroup: rbac.authorization.k8s.io\n+  kind: ClusterRole\n+  name: cluster-admin\n+subjects:\n+- kind: ServiceAccount\n+  name: default\n+  namespace: kube-system\n+EOF\n+```\n+\n+Create a namespace and service account for the operator.\n+\n+```bash\n+$ kubectl create namespace sample-weblogic-operator-ns\n+namespace/sample-weblogic-operator-ns created\n+\n+\n+$ kubectl create serviceaccount -n sample-weblogic-operator-ns sample-weblogic-operator-sa\n+serviceaccount/sample-weblogic-operator-sa created\n+```\n+\n+Install the operator.\n+\n+```bash\n+$ helm install weblogic-operator kubernetes/charts/weblogic-operator \\\n+  --namespace sample-weblogic-operator-ns \\\n+  --set serviceAccount=sample-weblogic-operator-sa \\\n+  --set \"enableClusterRoleBinding=true\" --wait\n+\n+NAME: weblogic-operator\n+LAST DEPLOYED: Tue Nov 17 09:33:58 2020\n+NAMESPACE: sample-weblogic-operator-ns\n+STATUS: deployed\n+REVISION: 1\n+TEST SUITE: None\n+```\n+\n+Verify the operator with the following commands; the status will be running.\n+\n+```bash\n+$ helm list -A\n+NAME                        NAMESPACE                     REVISION   UPDATED                                 STATUS       CHART                   APP VERSION\n+sample-weblogic-operator    sample-weblogic-operator-ns   1          2020-11-17 09:33:58.584239273 -0700 PDT deployed     weblogic-operator-3.1\n+\n+\n+$ kubectl get pods -n sample-weblogic-operator-ns\n+NAME                                 READY   STATUS    RESTARTS   AGE\n+weblogic-operator-775b668c8f-nwwnn   1/1     Running   0          32s\n+```\n+\n+\n+#### Create Docker image\n+\n+\n+  - [Image creation prerequisites](#image-creation-prerequisites)\n+  - [Image creation - Introduction](#image-creation---introduction)\n+  - [Understanding your first archive](#understanding-your-first-archive)\n+  - [Staging a ZIP file of the archive](#staging-a-zip-file-of-the-archive)\n+  - [Staging model files](#staging-model-files)\n+  - [Creating the image with WIT](#creating-the-image-with-wit)\n+\n+##### Image creation prerequisites\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 or 11 installation.\n+2. Copy the sample to a new directory; for example, use the directory `/tmp/mii-sample`.\n+\n+```bash\n+$ mkdir /tmp/mii-sample\n+$ cp -r /root/weblogic-kubernetes-operator/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/* /tmp/mii-sample\n+```\n+\n+\n+**Note**: We will refer to this working copy of the sample as `/tmp/mii-sample`; however, you can use a different location.\n+\n+Download the latest WebLogic Deploying Tooling (WDT) and WebLogic Image Tool (WIT) installer ZIP files to your `/tmp/mii-sample/model-images` directory. Both WDT and WIT are required to create your Model in Image Docker images.\n+\n+For example, visit the GitHub [WebLogic Deploy Tooling Releases](https://github.com/oracle/weblogic-deploy-tooling/releases) and [WebLogic Image Tool Releases](https://github.com/oracle/weblogic-image-tool/releases) web pages to determine the latest release version for each, and then, assuming the version numbers are `1.9.7` and `1.9.5` respectively, call:\n+\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+\n+$ curl -m 120 -fL https://github.com/oracle/weblogic-deploy-tooling/releases/download/release-1.9.7/weblogic-deploy.zip \\\n+  -o /tmp/mii-sample/model-images/weblogic-deploy.zip\n+\n+$ curl -m 120 -fL https://github.com/oracle/weblogic-image-tool/releases/download/release-1.9.5/imagetool.zip \\\n+  -o /tmp/mii-sample/model-images/imagetool.zip\n+```\n+\n+\n+To set up the WebLogic Image Tool, run the following commands:\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+\n+$ unzip imagetool.zip\n+\n+$ ./imagetool/bin/imagetool.sh cache addInstaller \\\n+  --type wdt \\\n+  --version latest \\\n+  --path /tmp/mii-sample/model-images/weblogic-deploy.zip\n+```\n+\n+These steps will install WIT to the `/tmp/mii-sample/model-images/imagetool` directory, plus put a `wdt_latest` entry in the tool\u2019s cache which points to the WDT ZIP file installer. You will use WIT later in the sample for creating model images.\n+\n+\n+##### Image creation - Introduction\n+\n+The goal of image creation is to demonstrate using the WebLogic Image Tool to create an image named `model-in-image:WLS-v1` from files that you will stage to `/tmp/mii-sample/model-images/model-in-image:WLS-v1/`.\n+The staged files will contain a web application in a WDT archive, and WDT model configuration for a WebLogic Administration Server called `admin-server` and a WebLogic cluster called `cluster-1`.\n+\n+Overall, a Model in Image image must contain a WebLogic Server installation and a WebLogic Deploy Tooling installation in its `/u01/wdt/weblogic-deploy` directory.\n+In addition, if you have WDT model archive files, then the image must also contain these files in its `/u01/wdt/models` directory.\n+Finally, an image optionally may also contain your WDT model YAML file and properties files in the same `/u01/wdt/models` directory.\n+If you do not specify a WDT model YAML file in your `/u01/wdt/models` directory, then the model YAML file must be supplied dynamically using a Kubernetes ConfigMap that is referenced by your Domain `spec.model.configMap` field.\n+We provide an example of using a model ConfigMap later in this sample.\n+\n+The following sections contain the steps for creating the image `model-in-image:WLS-v1`.\n+\n+##### Understanding your first archive\n+\n+The sample includes a predefined archive directory in `/tmp/mii-sample/archives/archive-v1` that you will use to create an archive ZIP file for the image.\n+\n+The archive top directory, named `wlsdeploy`, contains a directory named `applications`, which includes an \u2018exploded\u2019 sample JSP web application in the directory, `myapp-v1`. Three useful aspects to remember about WDT archives are:\n+  - A model image can contain multiple WDT archives.\n+  - WDT archives can contain multiple applications, libraries, and other components.\n+  - WDT archives have a [well defined directory structure](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/archive.md), which always has `wlsdeploy` as the top directory.\n+\n+The application displays important details about the WebLogic Server instance that it\u2019s running on: namely its domain name, cluster name, and server name, as well as the names of any data sources that are targeted to the server.\n+\n+\n+##### Staging a ZIP file of the archive\n+\n+When you create the image, you will use the files in the staging directory, `/tmp/mii-sample/model-in-image__WLS-v1`. In preparation, you need it to contain a ZIP file of the WDT application archive.\n+\n+Run the following commands to create your application archive ZIP file and put it in the expected directory:\n+\n+```bash\n+# Delete existing archive.zip in case we have an old leftover version\n+$ rm -f /tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip\n+\n+# Move to the directory which contains the source files for our archive\n+$ cd /tmp/mii-sample/archives/archive-v1\n+\n+# Zip the archive to the location will later use when we run the WebLogic Image Tool\n+$ zip -r /tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip wlsdeploy\n+```\n+\n+##### Staging model files\n+\n+In this step, you explore the staged WDT model YAML file and properties in the `/tmp/mii-sample/model-in-image__WLS-v1` directory. The model in this directory references the web application in your archive,\n+configures a WebLogic Server Administration Server, and configures a WebLogic cluster. It consists of only two files, `model.10.properties`, a file with a single property, and, `model.10.yaml`, a YAML file with your WebLogic configuration `model.10.yaml`.\n+\n+```\n+CLUSTER_SIZE=5\n+```\n+\n+Here is the WLS `model.10.yaml`:\n+\n+```\n+domainInfo:\n+    AdminUserName: '@@SECRET:__weblogic-credentials__:username@@'\n+    AdminPassword: '@@SECRET:__weblogic-credentials__:password@@'\n+    ServerStartMode: 'prod'\n+\n+topology:\n+    Name: '@@ENV:CUSTOM_DOMAIN_NAME@@'\n+    AdminServerName: 'admin-server'\n+    Cluster:\n+        'cluster-1':\n+            DynamicServers:\n+                ServerTemplate:  'cluster-1-template'\n+                ServerNamePrefix: 'managed-server'\n+                DynamicClusterSize: '@@PROP:CLUSTER_SIZE@@'\n+                MaxDynamicClusterSize: '@@PROP:CLUSTER_SIZE@@'\n+                MinDynamicClusterSize: '0'\n+                CalculatedListenPorts: false\n+    Server:\n+        'admin-server':\n+            ListenPort: 7001\n+    ServerTemplate:\n+        'cluster-1-template':\n+            Cluster: 'cluster-1'\n+            ListenPort: 8001\n+\n+appDeployments:\n+    Application:\n+        myapp:\n+            SourcePath: 'wlsdeploy/applications/myapp-v1'\n+            ModuleType: ear\n+            Target: 'cluster-1'\n+```\n+\n+\n+\n+The model files:\n+\n+- Define a WebLogic domain with:\n+    - Cluster `cluster-1`\n+    - Administration Server `admin-server`\n+    - A `cluster-1` targeted EAR application that\u2019s located in the WDT archive ZIP file at `wlsdeploy/applications/myapp-v1`\n+\n+- Leverage macros to inject external values:\n+    - The property file `CLUSTER_SIZE` property is referenced in the model YAML file `DynamicClusterSize` and `MaxDynamicClusterSize` fields using a PROP macro.\n+    - The model file domain name is injected using a custom environment variable named `CUSTOM_DOMAIN_NAME` using an ENV macro.\n+        - You set this environment variable later in this sample using an env field in its Domain.\n+        - _This conveniently provides a simple way to deploy multiple differently named domains using the same model image_.\n+    - The model file administrator user name and password are set using a `weblogic-credentials` secret macro reference to the WebLogic credential secret.\n+        - This secret is in turn referenced using the `webLogicCredentialsSecret` field in the Domain.\n+        - The `weblogic-credentials` is a reserved name that always dereferences to the owning Domain actual WebLogic credentials secret name.\n+\n+A Model in Image image can contain multiple properties files, archive ZIP files, and YAML files but in this sample you use just one of each. For a complete discussion of Model in Images model file naming conventions, file loading order, and macro syntax, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) files in the Model in Image user documentation.\n+\n+##### Creating the image with WIT\n+\n+At this point, you have staged all of the files needed for the image `model-in-image:WLS-v1`; they include:\n+\n+  - `/tmp/mii-sample/model-images/weblogic-deploy.zip`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/model.10.yaml`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/model.10.properties`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip`\n+\n+If you don\u2019t see the `weblogic-deploy.zip` file, then you missed a step in the [prerequisites](#image-creation-prerequisites).\n+\n+Now, you use the Image Tool to create an image named `model-in-image:WLS-v1` that\u2019s layered on a base WebLogic image. You\u2019ve already set up this tool during the prerequisite steps.\n+\n+Run the following commands to create the model image and verify that it worked:\n+\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+$ ./imagetool/bin/imagetool.sh update \\\n+  --tag model-in-image:WLS-v1 \\\n+  --fromImage container-registry.oracle.com/middleware/weblogic:12.2.1.4 \\\n+  --wdtModel      ./model-in-image__WLS-v1/model.10.yaml \\\n+  --wdtVariables  ./model-in-image__WLS-v1/model.10.properties \\\n+  --wdtArchive    ./model-in-image__WLS-v1/archive.zip \\\n+  --wdtModelOnly \\\n+  --wdtDomainType WLS \\\n+  --chown oracle:root\n+```\n+\n+If you don\u2019t see the `imagetool` directory, then you missed a step in the prerequisites.\n+\n+This command runs the WebLogic Image Tool in its Model in Image mode, and does the following:\n+\n+  - Builds the final Docker image as a layer on the `container-registry.oracle.com/middleware/weblogic:12.2.1.4` base image.\n+  - Copies the WDT ZIP file that\u2019s referenced in the WIT cache into the image.\n+      - Note that you cached WDT in WIT using the keyword `latest` when you set up the cache during the sample prerequisites steps.\n+      - This lets WIT implicitly assume it\u2019s the desired WDT version and removes the need to pass a `-wdtVersion` flag.\n+  - Copies the specified WDT model, properties, and application archives to image location `/u01/wdt/models`.\n+\n+When the command succeeds, it should end with output like the following:\n+\n+```\n+[INFO   ] Build successful. Build time=36s. Image tag=model-in-image:WLS-v1\n+```\n+\n+Also, if you run the `docker images` command, then you will see a Docker image named `model-in-image:WLS-v1`.\n+\n+> Note: If you have Kubernetes cluster worker nodes that are remote to your local machine, then you need to put the image in a location that these nodes can access. See [Ensuring your Kubernetes cluster can access images](#ensuring-your-kubernetes-cluster-can-access-images).\n+\n+\n+#### Create WebLogic domain\n+\n+In this section, you will deploy the new image to namespace `sample-domain1-ns`, including the following steps:\n+\n+- Create a namespace for the WebLogic domain.\n+- Upgrade the operator to manage the WebLogic domain namespace.   \n+- Create a Secret containing your WebLogic administrator user name and password.\n+- Create a Secret containing your Model in Image runtime encryption password:\n+    - All Model in Image domains must supply a runtime encryption Secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the operator.\n+    - The value must be kept private but can be arbitrary; you can optionally supply a different secret value every time you restart the domain.\n+- Deploy a Domain YAML file that references the new image.\n+- Wait for the domain\u2019s Pods to start and reach their ready state.\n+\n+##### Namespace\n+\n+Create a namespace that can host one or more domains:\n+\n+```bash\n+$ kubectl create namespace sample-domain1-ns\n+```\n+\n+##### Upgrade the operator\n+\n+Upgrade the operator to manage the WebLogic domains in namespace `sample-domain1-ns`.\n+\n+```bash\n+$ cd /root/weblogic-kubernetes-operator\n+$ helm upgrade weblogic-operator  kubernetes/charts/weblogic-operator \\\n+  --namespace sample-weblogic-operator-ns \\\n+  --reuse-values \\\n+  --set \"domainNamespaces={sample-domain1-ns}\" \\\n+  --wait\n+```\n+\n+##### Secrets\n+\n+First, create the secrets needed by the WLS type model domain. In this case, you have two secrets.\n+\n+Run the following `kubectl` commands to deploy the required secrets:\n+\n+```bash\n+$ kubectl -n sample-domain1-ns create secret generic \\\n+  sample-domain1-weblogic-credentials \\\n+   --from-literal=username=weblogic --from-literal=password=welcome1\n+$ kubectl -n sample-domain1-ns label  secret \\\n+  sample-domain1-weblogic-credentials \\\n+  weblogic.domainUID=sample-domain1\n+\n+$ kubectl -n sample-domain1-ns create secret generic \\\n+  sample-domain1-runtime-encryption-secret \\\n+   --from-literal=password=my_runtime_password\n+$ kubectl -n sample-domain1-ns label  secret \\\n+  sample-domain1-runtime-encryption-secret \\\n+  weblogic.domainUID=sample-domain1\n+```\n+\n+  Some important details about these secrets:\n+\n+  - The WebLogic credentials secret:\n+    - It is required and must contain `username` and `password` fields.\n+    - It must be referenced by the `spec.webLogicCredentialsSecret` field in your Domain.\n+    - It also must be referenced by macros in the `domainInfo.AdminUserName` and `domainInfo.AdminPassWord` fields in your model YAML file.\n+\n+  - The Model WDT runtime secret:\n+    - This is a special secret required by Model in Image.\n+    - It must contain a `password` field.\n+    - It must be referenced using the `spec.model.runtimeEncryptionSecret` field in its Domain.\n+    - It must remain the same for as long as the domain is deployed to Kubernetes but can be changed between deployments.\n+    - It is used to encrypt data as it's internally passed using log files from the domain's introspector job and on to its WebLogic Server pods.\n+\n+  - Deleting and recreating the secrets:\n+    - You delete a secret before creating it, otherwise the create command will fail if the secret already exists.\n+    - This allows you to change the secret when using the `kubectl create secret` command.\n+\n+  - You name and label secrets using their associated domain UID for two reasons:\n+    - To make it obvious which secrets belong to which domains.\n+    - To make it easier to clean up a domain. Typical cleanup scripts use the `weblogic.domainUID` label as a convenience for finding all resources associated with a domain.\n+\n+##### Domain resource\n+\n+Now, you create a Domain YAML file. A Domain is the key resource that tells the operator how to deploy a WebLogic domain.\n+\n+Copy the following to a file called `/tmp/mii-sample/mii-initial.yaml` or similar, or use the file `/tmp/mii-sample/domain-resources/WLS/mii-initial-d1-WLS-v1.yaml` that is included in the sample source.\n+\n+\n+  {{%expand \"Click here to view the WLS Domain YAML file.\" %}}\n+  ```\n+    #\n+    # This is an example of how to define a Domain resource.\n+    #\n+    apiVersion: \"weblogic.oracle/v8\"\n+    kind: Domain\n+    metadata:\n+      name: sample-domain1\n+      namespace: sample-domain1-ns\n+      labels:\n+        weblogic.domainUID: sample-domain1\n+\n+    spec:\n+      # Set to 'FromModel' to indicate 'Model in Image'.\n+      domainHomeSourceType: FromModel\n+\n+      # The WebLogic Domain Home, this must be a location within\n+      # the image for 'Model in Image' domains.\n+      domainHome: /u01/domains/sample-domain1\n+\n+      # The WebLogic Server Docker image that the Operator uses to start the domain\n+      image: \"model-in-image:WLS-v1\"\n+\n+      # Defaults to \"Always\" if image tag (version) is ':latest'\n+      imagePullPolicy: \"IfNotPresent\"\n+\n+      # Identify which Secret contains the credentials for pulling an image\n+      #imagePullSecrets:\n+      #- name: regsecret\n+\n+      # Identify which Secret contains the WebLogic Admin credentials,\n+      # the secret must contain 'username' and 'password' fields.\n+      webLogicCredentialsSecret:\n+        name: sample-domain1-weblogic-credentials\n+\n+      # Whether to include the WebLogic Server stdout in the pod's stdout, default is true\n+      includeServerOutInPodLog: true\n+\n+      # Whether to enable overriding your log file location, see also 'logHome'\n+      #logHomeEnabled: false\n+\n+      # The location for domain log, server logs, server out, introspector out, and Node Manager log files\n+      # see also 'logHomeEnabled', 'volumes', and 'volumeMounts'.\n+      #logHome: /shared/logs/sample-domain1\n+\n+      # Set which WebLogic Servers the Operator will start\n+      # - \"NEVER\" will not start any server in the domain\n+      # - \"ADMIN_ONLY\" will start up only the administration server (no managed servers will be started)\n+      # - \"IF_NEEDED\" will start all non-clustered servers, including the administration server, and clustered servers up to their replica count.\n+      serverStartPolicy: \"IF_NEEDED\"\n+\n+      # Settings for all server pods in the domain including the introspector job pod\n+      serverPod:\n+        # Optional new or overridden environment variables for the domain's pods\n+        # - This sample uses CUSTOM_DOMAIN_NAME in its image model file\n+        #   to set the Weblogic domain name\n+        env:\n+        - name: CUSTOM_DOMAIN_NAME\n+          value: \"domain1\"\n+        - name: JAVA_OPTIONS\n+          value: \"-Dweblogic.StdoutDebugEnabled=false\"\n+        - name: USER_MEM_ARGS\n+          value: \"-XX:+UseContainerSupport -Djava.security.egd=file:/dev/./urandom \"\n+\n+        # Optional volumes and mounts for the domain's pods. See also 'logHome'.\n+        #volumes:\n+        #- name: weblogic-domain-storage-volume\n+        #  persistentVolumeClaim:\n+        #    claimName: sample-domain1-weblogic-sample-pvc\n+        #volumeMounts:\n+        #- mountPath: /shared\n+        #  name: weblogic-domain-storage-volume\n+\n+      # The desired behavior for starting the domain's administration server.\n+      adminServer:\n+        # The serverStartState legal values are \"RUNNING\" or \"ADMIN\"\n+        # \"RUNNING\" means the listed server will be started up to \"RUNNING\" mode\n+        # \"ADMIN\" means the listed server will be start up to \"ADMIN\" mode\n+        serverStartState: \"RUNNING\"\n+        # Setup a Kubernetes node port for the administration server default channel\n+        #adminService:\n+        #  channels:\n+        #  - channelName: default\n+        #    nodePort: 30701\n+\n+      # The number of managed servers to start for unlisted clusters\n+      replicas: 1\n+\n+      # The desired behavior for starting a specific cluster's member servers\n+      clusters:\n+      - clusterName: cluster-1\n+        serverStartState: \"RUNNING\"\n+        replicas: 2\n+\n+      # Change the `restartVersion` to force the introspector job to rerun\n+      # and apply any new model configuration, to also force a subsequent\n+      # roll of your domain's WebLogic Server pods.\n+      restartVersion: '1'\n+\n+      configuration:\n+\n+        # Settings for domainHomeSourceType 'FromModel'\n+        model:\n+          # Valid model domain types are 'WLS', 'JRF', and 'RestrictedJRF', default is 'WLS'\n+          domainType: \"WLS\"\n+\n+          # Optional configmap for additional models and variable files\n+          #configMap: sample-domain1-wdt-config-map\n+\n+          # All 'FromModel' domains require a runtimeEncryptionSecret with a 'password' field\n+          runtimeEncryptionSecret: sample-domain1-runtime-encryption-secret\n+\n+        # Secrets that are referenced by model yaml macros\n+        # (the model yaml in the optional configMap or in the image)\n+        #secrets:\n+        #- sample-domain1-datasource-secret\n+  ```\n+  {{% /expand %}}\n+\n+\n+  > **Note**: Before you deploy the domain custom resource, determine if you have Kubernetes cluster worker nodes that are remote to your local machine. If so, you need to put the Domain's image in a location that these nodes can access and you may also need to modify your Domain YAML file to reference the new location. See [Ensuring your Kubernetes cluster can access images]({{< relref \"/samples/simple/domains/model-in-image/_index.md#ensuring-your-kubernetes-cluster-can-access-images\" >}}).\n+\n+Run the following command to create the domain custom resource:\n+\n+```bash\n+$ kubectl apply -f /tmp/mii-sample/domain-resources/WLS/mii-initial-d1-WLS-v1.yaml\n+```\n+> **Note**: If you are choosing not to use the predefined Domain YAML file and instead created your own Domain YAML file earlier, then substitute your custom file name in the above command. Previously, we suggested naming it `/tmp/mii-sample/mii-initial.yaml`.\n+\n+Verify the WebLogic Server pods are all running:\n+\n+```\n+$ kubectl get all -n sample-domain1-ns\n+NAME                                 READY   STATUS    RESTARTS   AGE\n+pod/sample-domain1-admin-server      1/1     Running   0          41m\n+pod/sample-domain1-managed-server1   1/1     Running   0          40m\n+pod/sample-domain1-managed-server2   1/1     Running   0          40m\n+\n+NAME                                       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\n+service/sample-domain1-admin-server        ClusterIP   None           <none>        7001/TCP   41m\n+service/sample-domain1-cluster-cluster-1   ClusterIP   100.66.99.27   <none>        8001/TCP   40m\n+service/sample-domain1-managed-server1     ClusterIP   None           <none>        8001/TCP   40m\n+service/sample-domain1-managed-server2     ClusterIP   None           <none>        8001/TCP   40m\n+\n+\n+```\n+\n+#### Invoke the web application\n+\n+Create a load balancer to access the WebLogic Server Administration Console and applications deployed in the cluster.\n+Tanzu supports the MetalLB load balancer and NGINX ingress for routing.\n+\n+\n+Install the MetalLB load balancer by running following commands:\n+\n+```bash\n+## create namespace metallb-system\n+$ kubectl create ns metallb-system\n+\n+## deploy MetalLB load balancer\n+$ kubectl apply -f https://raw.githubusercontent.com/google/metallb/v0.9.2/manifests/metallb.yaml -n metallb-system\n+\n+## create secret\n+$ kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=\"$(openssl rand -base64 128)\"\n+\n+$ cat metallb-configmap.yaml\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  namespace: metallb-system\n+  name: config\n+data:\n+  config: |\n+    address-pools:\n+    - name: default\n+      protocol: layer2\n+      addresses:\n+      - 192.168.100.50-192.168.100.65\n+\n+$ kubectl apply -f metallb-configmap.yaml\n+configmap/config created\n+\n+$ kubectl get all -n metallb-system\n+NAME                              READY   STATUS    RESTARTS   AGE\n+pod/controller-684f5d9b49-jkzfk   1/1     Running   0          2m14s\n+pod/speaker-b457r                 1/1     Running   0          2m14s\n+pod/speaker-bzmmj                 1/1     Running   0          2m14s\n+pod/speaker-gphh5                 1/1     Running   0          2m14s\n+pod/speaker-lktgc                 1/1     Running   0          2m14s\n+\n+NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                 AGE\n+daemonset.apps/speaker   4         4         4       4            4           beta.kubernetes.io/os=linux   2m14s\n+\n+NAME                         READY   UP-TO-DATE   AVAILABLE   AGE\n+deployment.apps/controller   1/1     1            1           2m14s\n+\n+NAME                                    DESIRED   CURRENT   READY   AGE\n+replicaset.apps/controller-684f5d9b49   1         1         1       2m14s\n+```\n+\n+\n+Install NGINX.\n+\n+```bash\n+$ helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\n+$ helm repo update\n+$ helm install ingress-nginx ingress-nginx/ingress-nginx\n+```\n+\n+\n+Create ingress for accessing the application deployed in the cluster and to access Administration console.\n+\n+```bash\n+$ cat ingress.yaml\n+\n+apiVersion: extensions/v1beta1", "originalCommit": "c6320b433ea06523dfb4804c4007e82775ffe697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5MTk1MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527791951", "bodyText": "Changed the apiVersion version to \"networking.k8s.io/v1beta1\"", "author": "sankarpn", "createdAt": "2020-11-20T16:04:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcwODg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcxMDYwMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527710600", "bodyText": "@rjeberhard wondering if this sample can show how to use labels so that the operator autodete cts the namespace and we do not need this step?", "author": "mriccell", "createdAt": "2020-11-20T14:03:36Z", "path": "docs-source/content/samples/simple/tanzu-kubernetes-service/_index.md", "diffHunk": "@@ -0,0 +1,730 @@\n+---\n+title: \"Tanzu Kubernetes Service\"\n+date: 2020-11-16T13:34:31-05:00\n+weight: 9\n+description: \"Sample for using the operator to set up a WLS cluster on the Tanzu Kubernetes Service.\"\n+---\n+\n+\n+This sample demonstrates how to use the Oracle [WebLogic Server Kubernetes Operator](/weblogic-kubernetes-operator/) (hereafter \u201cthe operator\u201d) to set up a WebLogic Server (WLS) cluster on the Tanzu Kubernetes Grid (TKG).\n+After performing the sample steps, your WLS domain with a Model in Image domain source type runs on a TKG Kubernetes cluster instance. After the domain has been provisioned, you can monitor it using the WebLogic Server Administration console.\n+\n+TKG is a managed Kubernetes Service that lets you quickly deploy and manage Kubernetes clusters. To learn more, see the [Tanzu Kubernetes Grid (TKG)](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.2/vmware-tanzu-kubernetes-grid-12/GUID-index.html) overview page.\n+\n+#### Contents\n+\n+ - [Prerequisites](#prerequisites)\n+   - [Create a Tanzu Kubernetes cluster](#create-a-tanzu-kubernetes-cluster)\n+   - [Oracle Container Registry](#oracle-container-registry)\n+ - [Install WebLogic Server Kubernetes Operator](#install-weblogic-server-kubernetes-operator)\n+ - [Create Docker image](#create-docker-image)\n+ - [Create WebLogic domain](#create-weblogic-domain)\n+ - [Invoke the web application](#invoke-the-web-application)\n+\n+#### Prerequisites\n+\n+This sample assumes the following prerequisite environment setup.\n+\n+* WebLogic Server Kubernetes Operator: This document was tested with version v3.1.0.\n+* Operating System: GNU/Linux.\n+* [Git](https://git-scm.com/downloads); use `git --version` to test if `git` works.  This document was tested with version 2.17.1.\n+* TKG CLI; use `tkg version` to test if TKG works. This document was tested with version v1.1.3.\n+* [kubectl](https://kubernetes-io-vnext-staging.netlify.com/docs/tasks/tools/install-kubectl/); use `kubectl version` to test if `kubectl` works.  This document was tested with version v1.18.6.\n+* [Helm](https://helm.sh/docs/intro/install/) version 3.1 or later; use `helm version` to check the `helm` version.  This document was tested with version v3.2.1.\n+\n+##### Create a Tanzu Kubernetes cluster\n+\n+Create the Kubernetes cluster using the TKG CLI. See the [Tanzu documentation](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.2/vmware-tanzu-kubernetes-grid-12/GUID-index.html) to set up your Kubernetes cluster.\n+After your Kubernetes cluster is up and running, run the following commands to make sure `kubectl` can access the Kubernetes cluster:\n+\n+```bash\n+$ kubectl get nodes -o wide\n+NAME                                    STATUS     ROLES    AGE     VERSION            INTERNAL-IP       EXTERNAL-IP       OS-IMAGE                 KERNEL-VERSION   CONTAINER-RUNTIME\n+k8s-cluster-101-control-plane-8nj7t     NotReady   master   2d20h   v1.18.6+vmware.1   192.168.100.147   192.168.100.147   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-552hn   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.148   192.168.100.148   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-m8wrc   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.149   192.168.100.149   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+k8s-cluster-101-md-0-577b7dc766-p2gkz   Ready      <none>   2d20h   v1.18.6+vmware.1   192.168.100.150   192.168.100.150   VMware Photon OS/Linux   4.19.132-1.ph3   containerd://1.3.4\n+```\n+\n+##### Oracle Container Registry\n+\n+You will need an Oracle Container Registry account. The following steps will direct you to accept the Oracle Standard Terms and Restrictions to pull the WebLogic Server images.  Make note of your Oracle Account password and email.  This sample pertains to 12.2.1.4, but other versions may work as well.\n+\n+Obtain the WebLogic Server image from the [Oracle Container Registry](https://container-registry.oracle.com/).\n+\n+  - First time users, [follow these directions](/weblogic-kubernetes-operator/userguide/managing-domains/domain-in-image/base-images/#obtaining-standard-images-from-the-oracle-container-registry).   \n+  - Find and then pull the WebLogic 12.2.1.4 install image:\n+     ```bash\n+     $ docker pull container-registry.oracle.com/middleware/weblogic:12.2.1.4\n+     ```\n+\n+#### Install WebLogic Server Kubernetes Operator\n+\n+The Oracle WebLogic Server Kubernetes Operator is an adapter to integrate WebLogic Server and Kubernetes, allowing Kubernetes to serve as a container infrastructure hosting WLS instances.\n+The operator runs as a Kubernetes Pod and stands ready to perform actions related to running WLS on Kubernetes.\n+\n+Clone the Oracle WebLogic Server Kubernetes Operator repository to your machine. We will use several scripts in this repository to create a WebLogic domain.\n+Kubernetes Operators use [Helm](https://helm.sh/) to manage Kubernetes applications. The operator\u2019s Helm chart is located in the `kubernetes/charts/weblogic-operator` directory. Install the operator by running the following commands.\n+\n+Clone the repository.\n+\n+```bash\n+$ git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+$ cd weblogic-kubernetes-operator\n+$ git checkout v3.1.0\n+```\n+\n+Grant the Helm service account the cluster-admin role.\n+\n+```bash\n+$ cat <<EOF | kubectl apply -f -\n+apiVersion: rbac.authorization.k8s.io/v1\n+kind: ClusterRoleBinding\n+metadata:\n+  name: helm-user-cluster-admin-role\n+roleRef:\n+  apiGroup: rbac.authorization.k8s.io\n+  kind: ClusterRole\n+  name: cluster-admin\n+subjects:\n+- kind: ServiceAccount\n+  name: default\n+  namespace: kube-system\n+EOF\n+```\n+\n+Create a namespace and service account for the operator.\n+\n+```bash\n+$ kubectl create namespace sample-weblogic-operator-ns\n+namespace/sample-weblogic-operator-ns created\n+\n+\n+$ kubectl create serviceaccount -n sample-weblogic-operator-ns sample-weblogic-operator-sa\n+serviceaccount/sample-weblogic-operator-sa created\n+```\n+\n+Install the operator.\n+\n+```bash\n+$ helm install weblogic-operator kubernetes/charts/weblogic-operator \\\n+  --namespace sample-weblogic-operator-ns \\\n+  --set serviceAccount=sample-weblogic-operator-sa \\\n+  --set \"enableClusterRoleBinding=true\" --wait\n+\n+NAME: weblogic-operator\n+LAST DEPLOYED: Tue Nov 17 09:33:58 2020\n+NAMESPACE: sample-weblogic-operator-ns\n+STATUS: deployed\n+REVISION: 1\n+TEST SUITE: None\n+```\n+\n+Verify the operator with the following commands; the status will be running.\n+\n+```bash\n+$ helm list -A\n+NAME                        NAMESPACE                     REVISION   UPDATED                                 STATUS       CHART                   APP VERSION\n+sample-weblogic-operator    sample-weblogic-operator-ns   1          2020-11-17 09:33:58.584239273 -0700 PDT deployed     weblogic-operator-3.1\n+\n+\n+$ kubectl get pods -n sample-weblogic-operator-ns\n+NAME                                 READY   STATUS    RESTARTS   AGE\n+weblogic-operator-775b668c8f-nwwnn   1/1     Running   0          32s\n+```\n+\n+\n+#### Create Docker image\n+\n+\n+  - [Image creation prerequisites](#image-creation-prerequisites)\n+  - [Image creation - Introduction](#image-creation---introduction)\n+  - [Understanding your first archive](#understanding-your-first-archive)\n+  - [Staging a ZIP file of the archive](#staging-a-zip-file-of-the-archive)\n+  - [Staging model files](#staging-model-files)\n+  - [Creating the image with WIT](#creating-the-image-with-wit)\n+\n+##### Image creation prerequisites\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 or 11 installation.\n+2. Copy the sample to a new directory; for example, use the directory `/tmp/mii-sample`.\n+\n+```bash\n+$ mkdir /tmp/mii-sample\n+$ cp -r /root/weblogic-kubernetes-operator/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/* /tmp/mii-sample\n+```\n+\n+\n+**Note**: We will refer to this working copy of the sample as `/tmp/mii-sample`; however, you can use a different location.\n+\n+Download the latest WebLogic Deploying Tooling (WDT) and WebLogic Image Tool (WIT) installer ZIP files to your `/tmp/mii-sample/model-images` directory. Both WDT and WIT are required to create your Model in Image Docker images.\n+\n+For example, visit the GitHub [WebLogic Deploy Tooling Releases](https://github.com/oracle/weblogic-deploy-tooling/releases) and [WebLogic Image Tool Releases](https://github.com/oracle/weblogic-image-tool/releases) web pages to determine the latest release version for each, and then, assuming the version numbers are `1.9.7` and `1.9.5` respectively, call:\n+\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+\n+$ curl -m 120 -fL https://github.com/oracle/weblogic-deploy-tooling/releases/download/release-1.9.7/weblogic-deploy.zip \\\n+  -o /tmp/mii-sample/model-images/weblogic-deploy.zip\n+\n+$ curl -m 120 -fL https://github.com/oracle/weblogic-image-tool/releases/download/release-1.9.5/imagetool.zip \\\n+  -o /tmp/mii-sample/model-images/imagetool.zip\n+```\n+\n+\n+To set up the WebLogic Image Tool, run the following commands:\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+\n+$ unzip imagetool.zip\n+\n+$ ./imagetool/bin/imagetool.sh cache addInstaller \\\n+  --type wdt \\\n+  --version latest \\\n+  --path /tmp/mii-sample/model-images/weblogic-deploy.zip\n+```\n+\n+These steps will install WIT to the `/tmp/mii-sample/model-images/imagetool` directory, plus put a `wdt_latest` entry in the tool\u2019s cache which points to the WDT ZIP file installer. You will use WIT later in the sample for creating model images.\n+\n+\n+##### Image creation - Introduction\n+\n+The goal of image creation is to demonstrate using the WebLogic Image Tool to create an image named `model-in-image:WLS-v1` from files that you will stage to `/tmp/mii-sample/model-images/model-in-image:WLS-v1/`.\n+The staged files will contain a web application in a WDT archive, and WDT model configuration for a WebLogic Administration Server called `admin-server` and a WebLogic cluster called `cluster-1`.\n+\n+Overall, a Model in Image image must contain a WebLogic Server installation and a WebLogic Deploy Tooling installation in its `/u01/wdt/weblogic-deploy` directory.\n+In addition, if you have WDT model archive files, then the image must also contain these files in its `/u01/wdt/models` directory.\n+Finally, an image optionally may also contain your WDT model YAML file and properties files in the same `/u01/wdt/models` directory.\n+If you do not specify a WDT model YAML file in your `/u01/wdt/models` directory, then the model YAML file must be supplied dynamically using a Kubernetes ConfigMap that is referenced by your Domain `spec.model.configMap` field.\n+We provide an example of using a model ConfigMap later in this sample.\n+\n+The following sections contain the steps for creating the image `model-in-image:WLS-v1`.\n+\n+##### Understanding your first archive\n+\n+The sample includes a predefined archive directory in `/tmp/mii-sample/archives/archive-v1` that you will use to create an archive ZIP file for the image.\n+\n+The archive top directory, named `wlsdeploy`, contains a directory named `applications`, which includes an \u2018exploded\u2019 sample JSP web application in the directory, `myapp-v1`. Three useful aspects to remember about WDT archives are:\n+  - A model image can contain multiple WDT archives.\n+  - WDT archives can contain multiple applications, libraries, and other components.\n+  - WDT archives have a [well defined directory structure](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/archive.md), which always has `wlsdeploy` as the top directory.\n+\n+The application displays important details about the WebLogic Server instance that it\u2019s running on: namely its domain name, cluster name, and server name, as well as the names of any data sources that are targeted to the server.\n+\n+\n+##### Staging a ZIP file of the archive\n+\n+When you create the image, you will use the files in the staging directory, `/tmp/mii-sample/model-in-image__WLS-v1`. In preparation, you need it to contain a ZIP file of the WDT application archive.\n+\n+Run the following commands to create your application archive ZIP file and put it in the expected directory:\n+\n+```bash\n+# Delete existing archive.zip in case we have an old leftover version\n+$ rm -f /tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip\n+\n+# Move to the directory which contains the source files for our archive\n+$ cd /tmp/mii-sample/archives/archive-v1\n+\n+# Zip the archive to the location will later use when we run the WebLogic Image Tool\n+$ zip -r /tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip wlsdeploy\n+```\n+\n+##### Staging model files\n+\n+In this step, you explore the staged WDT model YAML file and properties in the `/tmp/mii-sample/model-in-image__WLS-v1` directory. The model in this directory references the web application in your archive,\n+configures a WebLogic Server Administration Server, and configures a WebLogic cluster. It consists of only two files, `model.10.properties`, a file with a single property, and, `model.10.yaml`, a YAML file with your WebLogic configuration `model.10.yaml`.\n+\n+```\n+CLUSTER_SIZE=5\n+```\n+\n+Here is the WLS `model.10.yaml`:\n+\n+```\n+domainInfo:\n+    AdminUserName: '@@SECRET:__weblogic-credentials__:username@@'\n+    AdminPassword: '@@SECRET:__weblogic-credentials__:password@@'\n+    ServerStartMode: 'prod'\n+\n+topology:\n+    Name: '@@ENV:CUSTOM_DOMAIN_NAME@@'\n+    AdminServerName: 'admin-server'\n+    Cluster:\n+        'cluster-1':\n+            DynamicServers:\n+                ServerTemplate:  'cluster-1-template'\n+                ServerNamePrefix: 'managed-server'\n+                DynamicClusterSize: '@@PROP:CLUSTER_SIZE@@'\n+                MaxDynamicClusterSize: '@@PROP:CLUSTER_SIZE@@'\n+                MinDynamicClusterSize: '0'\n+                CalculatedListenPorts: false\n+    Server:\n+        'admin-server':\n+            ListenPort: 7001\n+    ServerTemplate:\n+        'cluster-1-template':\n+            Cluster: 'cluster-1'\n+            ListenPort: 8001\n+\n+appDeployments:\n+    Application:\n+        myapp:\n+            SourcePath: 'wlsdeploy/applications/myapp-v1'\n+            ModuleType: ear\n+            Target: 'cluster-1'\n+```\n+\n+\n+\n+The model files:\n+\n+- Define a WebLogic domain with:\n+    - Cluster `cluster-1`\n+    - Administration Server `admin-server`\n+    - A `cluster-1` targeted EAR application that\u2019s located in the WDT archive ZIP file at `wlsdeploy/applications/myapp-v1`\n+\n+- Leverage macros to inject external values:\n+    - The property file `CLUSTER_SIZE` property is referenced in the model YAML file `DynamicClusterSize` and `MaxDynamicClusterSize` fields using a PROP macro.\n+    - The model file domain name is injected using a custom environment variable named `CUSTOM_DOMAIN_NAME` using an ENV macro.\n+        - You set this environment variable later in this sample using an env field in its Domain.\n+        - _This conveniently provides a simple way to deploy multiple differently named domains using the same model image_.\n+    - The model file administrator user name and password are set using a `weblogic-credentials` secret macro reference to the WebLogic credential secret.\n+        - This secret is in turn referenced using the `webLogicCredentialsSecret` field in the Domain.\n+        - The `weblogic-credentials` is a reserved name that always dereferences to the owning Domain actual WebLogic credentials secret name.\n+\n+A Model in Image image can contain multiple properties files, archive ZIP files, and YAML files but in this sample you use just one of each. For a complete discussion of Model in Images model file naming conventions, file loading order, and macro syntax, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) files in the Model in Image user documentation.\n+\n+##### Creating the image with WIT\n+\n+At this point, you have staged all of the files needed for the image `model-in-image:WLS-v1`; they include:\n+\n+  - `/tmp/mii-sample/model-images/weblogic-deploy.zip`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/model.10.yaml`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/model.10.properties`\n+  - `/tmp/mii-sample/model-images/model-in-image__WLS-v1/archive.zip`\n+\n+If you don\u2019t see the `weblogic-deploy.zip` file, then you missed a step in the [prerequisites](#image-creation-prerequisites).\n+\n+Now, you use the Image Tool to create an image named `model-in-image:WLS-v1` that\u2019s layered on a base WebLogic image. You\u2019ve already set up this tool during the prerequisite steps.\n+\n+Run the following commands to create the model image and verify that it worked:\n+\n+```bash\n+$ cd /tmp/mii-sample/model-images\n+$ ./imagetool/bin/imagetool.sh update \\\n+  --tag model-in-image:WLS-v1 \\\n+  --fromImage container-registry.oracle.com/middleware/weblogic:12.2.1.4 \\\n+  --wdtModel      ./model-in-image__WLS-v1/model.10.yaml \\\n+  --wdtVariables  ./model-in-image__WLS-v1/model.10.properties \\\n+  --wdtArchive    ./model-in-image__WLS-v1/archive.zip \\\n+  --wdtModelOnly \\\n+  --wdtDomainType WLS \\\n+  --chown oracle:root\n+```\n+\n+If you don\u2019t see the `imagetool` directory, then you missed a step in the prerequisites.\n+\n+This command runs the WebLogic Image Tool in its Model in Image mode, and does the following:\n+\n+  - Builds the final Docker image as a layer on the `container-registry.oracle.com/middleware/weblogic:12.2.1.4` base image.\n+  - Copies the WDT ZIP file that\u2019s referenced in the WIT cache into the image.\n+      - Note that you cached WDT in WIT using the keyword `latest` when you set up the cache during the sample prerequisites steps.\n+      - This lets WIT implicitly assume it\u2019s the desired WDT version and removes the need to pass a `-wdtVersion` flag.\n+  - Copies the specified WDT model, properties, and application archives to image location `/u01/wdt/models`.\n+\n+When the command succeeds, it should end with output like the following:\n+\n+```\n+[INFO   ] Build successful. Build time=36s. Image tag=model-in-image:WLS-v1\n+```\n+\n+Also, if you run the `docker images` command, then you will see a Docker image named `model-in-image:WLS-v1`.\n+\n+> Note: If you have Kubernetes cluster worker nodes that are remote to your local machine, then you need to put the image in a location that these nodes can access. See [Ensuring your Kubernetes cluster can access images](#ensuring-your-kubernetes-cluster-can-access-images).\n+\n+\n+#### Create WebLogic domain\n+\n+In this section, you will deploy the new image to namespace `sample-domain1-ns`, including the following steps:\n+\n+- Create a namespace for the WebLogic domain.\n+- Upgrade the operator to manage the WebLogic domain namespace.   \n+- Create a Secret containing your WebLogic administrator user name and password.\n+- Create a Secret containing your Model in Image runtime encryption password:\n+    - All Model in Image domains must supply a runtime encryption Secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the operator.\n+    - The value must be kept private but can be arbitrary; you can optionally supply a different secret value every time you restart the domain.\n+- Deploy a Domain YAML file that references the new image.\n+- Wait for the domain\u2019s Pods to start and reach their ready state.\n+\n+##### Namespace\n+\n+Create a namespace that can host one or more domains:\n+\n+```bash\n+$ kubectl create namespace sample-domain1-ns\n+```\n+\n+##### Upgrade the operator\n+\n+Upgrade the operator to manage the WebLogic domains in namespace `sample-domain1-ns`.", "originalCommit": "c6320b433ea06523dfb4804c4007e82775ffe697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcxMzk1Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527713953", "bodyText": "Yes, you are absolutely correct. If back on line 110, the initial helm install used the new functionality to select namespaces by a label, then the helm upgrade would not be necessary here.\n@sankarpn, do you understand or shall I propose a change to your branch?", "author": "rjeberhard", "createdAt": "2020-11-20T14:09:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcxMDYwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5MjQ4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527792487", "bodyText": "added these 2 params to helm install\n--set \"domainNamespaceSelectionStrategy=LabelSelector\" \n--set \"domainNamespaceLabelSelector=weblogic-operator=enabled\" \\", "author": "sankarpn", "createdAt": "2020-11-20T16:04:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcxMDYwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgwNjg1Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2059#discussion_r527806857", "bodyText": "Can you remove this section of upgrading the operator to add the namespace of the domain?", "author": "mriccell", "createdAt": "2020-11-20T16:26:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcxMDYwMA=="}], "type": "inlineReview"}, {"oid": "caa5fbdef1c99e927f16b553fa51538bfb640c8e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/caa5fbdef1c99e927f16b553fa51538bfb640c8e", "message": "changed the apiVersion for ingress and using the autodetect namespace\nparameter", "committedDate": "2020-11-20T16:02:23Z", "type": "commit"}, {"oid": "e0814a6728ce84b065a1009ed4c727bf27e4d4cd", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e0814a6728ce84b065a1009ed4c727bf27e4d4cd", "message": "label the domain namespace", "committedDate": "2020-11-20T17:17:17Z", "type": "commit"}]}