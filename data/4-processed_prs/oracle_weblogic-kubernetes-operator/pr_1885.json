{"pr_number": 1885, "pr_title": "Retry docker login, image push/pull from/to repos", "pr_createdAt": "2020-08-25T22:54:40Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1885", "timeline": [{"oid": "cd1fbf8899be8d5c37e1bf93e23b1558e19c93e2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cd1fbf8899be8d5c37e1bf93e23b1558e19c93e2", "message": "Using standard retry logic to retry the build", "committedDate": "2020-08-24T19:39:05Z", "type": "commit"}, {"oid": "a19014dd9307dc10503daffa3fe89446c9e4ce99", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a19014dd9307dc10503daffa3fe89446c9e4ce99", "message": "Use retry for docker login and image pull and push", "committedDate": "2020-08-24T23:16:45Z", "type": "commit"}, {"oid": "f273e154cb3c99d953b75a4fc08f2c3d2f2f0dc0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f273e154cb3c99d953b75a4fc08f2c3d2f2f0dc0", "message": "increase timeout to 30 minutes", "committedDate": "2020-08-25T01:14:04Z", "type": "commit"}, {"oid": "15d1baf0c58738f17e5b17ed22dbd5f923125d5e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/15d1baf0c58738f17e5b17ed22dbd5f923125d5e", "message": "Retry the push", "committedDate": "2020-08-25T15:50:38Z", "type": "commit"}, {"oid": "70c5b701601e29b5bb1d041ef7776d9c8d4008fd", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/70c5b701601e29b5bb1d041ef7776d9c8d4008fd", "message": "wip", "committedDate": "2020-08-25T18:13:59Z", "type": "commit"}, {"oid": "488b0e7fd55a6082afc9825905ba3551fa40d087", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/488b0e7fd55a6082afc9825905ba3551fa40d087", "message": "use iterator to push", "committedDate": "2020-08-25T18:20:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NTg2NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1885#discussion_r477355865", "bodyText": "removing this condition, test will fail when SKIP_BASIC_IMAGE_BUILD is set", "author": "vanajamukkara", "createdAt": "2020-08-26T14:42:18Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/extensions/ImageBuilders.java", "diffHunk": "@@ -154,20 +172,33 @@ public void beforeAll(ExtensionContext context) {\n \n           if (!REPO_USERNAME.equals(REPO_DUMMY_VALUE)) {\n             logger.info(\"docker login\");\n-            assertTrue(dockerLogin(REPO_REGISTRY, REPO_USERNAME, REPO_PASSWORD), \"docker login failed\");\n+            withStandardRetryPolicy\n+                .conditionEvaluationListener(\n+                    condition -> logger.info(\"Waiting for docker login to be successful\"\n+                        + \"(elapsed time {0} ms, remaining time {1} ms)\",\n+                        condition.getElapsedTimeInMS(),\n+                        condition.getRemainingTimeInMS()))\n+                .until(() -> dockerLogin(OCR_REGISTRY, OCR_USERNAME, OCR_PASSWORD));\n           }\n         }\n-        // push the image\n+        // push the images to repo\n         if (!REPO_NAME.isEmpty()) {\n-          logger.info(\"docker push image {0} to {1}\", operatorImage, REPO_NAME);\n-          assertTrue(dockerPush(operatorImage), String.format(\"docker push failed for image %s\", operatorImage));\n \n-          if (System.getenv(\"SKIP_BASIC_IMAGE_BUILD\") == null) {", "originalCommit": "488b0e7fd55a6082afc9825905ba3551fa40d087", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQxMTkwNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1885#discussion_r477411907", "bodyText": "Good catch, that was removed by mistake.", "author": "sankarpn", "createdAt": "2020-08-26T15:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NTg2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQxMTk5Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1885#discussion_r477411996", "bodyText": "fixed", "author": "sankarpn", "createdAt": "2020-08-26T15:58:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NTg2NQ=="}], "type": "inlineReview"}, {"oid": "b9f00dbd19583557e6f45c9383e18e547042c8ae", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b9f00dbd19583557e6f45c9383e18e547042c8ae", "message": "check SKIP_BASIC_IMAGE_BUILD is set before pushing it to repo", "committedDate": "2020-08-26T15:57:41Z", "type": "commit"}]}