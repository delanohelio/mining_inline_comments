{"pr_number": 1740, "pr_title": "add readiness check after ingress is created", "pr_createdAt": "2020-06-16T19:15:42Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1740", "timeline": [{"oid": "ea110c4cfd5f7a50fb846deb6df3f547fb2e8f18", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ea110c4cfd5f7a50fb846deb6df3f547fb2e8f18", "message": "add readiness check for ingress", "committedDate": "2020-06-16T19:11:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0NTEzNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1740#discussion_r441145136", "bodyText": "createIngressForDomainAndVerify() can call checkIngressReady()", "author": "vanajamukkara", "createdAt": "2020-06-16T21:12:29Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItScaleMiiDomainNginx.java", "diffHunk": "@@ -133,7 +134,10 @@ public static void initAll(@Namespaces(3) List<String> namespaces) {\n       clusterNameMsPortMap.put(CLUSTER_NAME_PREFIX + i, MANAGED_SERVER_PORT);\n     }\n     logger.info(\"Creating ingress for domain {0} in namespace {1}\", domainUid, domainNamespace);\n-    createIngressForDomainAndVerify(domainUid, domainNamespace, clusterNameMsPortMap);\n+    List<String> ingressHostList = createIngressForDomainAndVerify(domainUid, domainNamespace, clusterNameMsPortMap);", "originalCommit": "ea110c4cfd5f7a50fb846deb6df3f547fb2e8f18", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0NTU1MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1740#discussion_r441145551", "bodyText": "log stdout and stderr as well", "author": "vanajamukkara", "createdAt": "2020-06-16T21:13:23Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/TestUtils.java", "diffHunk": "@@ -179,6 +179,51 @@ public static String getDateAndTimeStamp() {\n     return dateFormat.format(date) + \"-\" + System.currentTimeMillis();\n   }\n \n+  /**\n+   * Call a web app and wait for the response code 200.\n+   * @param curlCmd curl command to call the web app\n+   * @param maxIterations max iterations to call the curl command\n+   * @return true if 200 response code is returned, false otherwise\n+   */\n+  public static boolean callWebAppAndWaitTillReady(String curlCmd, int maxIterations)  {\n+\n+    ExecResult result = null;\n+    String responseCode = \"\";\n+\n+    for (int i = 0; i < maxIterations; i++) {\n+      try {\n+        result = ExecCommand.exec(curlCmd);\n+        responseCode = result.stdout().trim();\n+\n+        if (result.exitValue() != 0 || !responseCode.equals(\"200\")) {\n+          logger.info(\"callWebApp did not return 200 response code, got {0}, iteration {1} of {2}\",\n+                  responseCode, i, maxIterations);\n+\n+          try {\n+            Thread.sleep(1000);\n+          } catch (InterruptedException ignore) {\n+            // ignore\n+          }\n+        } else if (responseCode.equals(\"200\")) {\n+          logger.info(\"callWebApp returned 200 response code, iteration {0}\", i);\n+          return true;\n+        }\n+      } catch (Exception e) {\n+        logger.info(\"Got exception while running command: {0}\", curlCmd);\n+        logger.info(e.toString());\n+        if (result != null) {\n+          logger.info(\"result.stdout: \\n{0}\", result.stdout());\n+          logger.info(\"result.stderr: \\n{0}\", result.stderr());\n+        }\n+        return false;\n+      }\n+    }\n+\n+    logger.info(\"FAILURE: callWebApp did not return 200 response code, got {0}\", responseCode);", "originalCommit": "ea110c4cfd5f7a50fb846deb6df3f547fb2e8f18", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "239a2f594be7c1e75f958774e793a0fc69f214f7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/239a2f594be7c1e75f958774e793a0fc69f214f7", "message": "fix with Vanaja's comments", "committedDate": "2020-06-16T22:55:56Z", "type": "commit"}, {"oid": "ad32ce8949556f9b4d5e816f76907dce5ceeaa6f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ad32ce8949556f9b4d5e816f76907dce5ceeaa6f", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-readiness4ingress", "committedDate": "2020-06-16T22:56:05Z", "type": "commit"}, {"oid": "abeaedac03e373e96604c5c10ca1b29b7430b7d1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/abeaedac03e373e96604c5c10ca1b29b7430b7d1", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-readiness4ingress", "committedDate": "2020-06-18T22:08:26Z", "type": "commit"}]}