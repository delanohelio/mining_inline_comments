{"pr_number": 2012, "pr_title": "OWLS85461 add introspect version to server pod label", "pr_createdAt": "2020-10-27T12:33:01Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012", "timeline": [{"oid": "d8dc1a7b7b0a77aa0da9bfa95092d076c82b2a74", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d8dc1a7b7b0a77aa0da9bfa95092d076c82b2a74", "message": "initial changes to add introspect version to pod labels", "committedDate": "2020-10-23T13:43:08Z", "type": "commit"}, {"oid": "46bb990ba30944301cf553b43e090faa21a3b07d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/46bb990ba30944301cf553b43e090faa21a3b07d", "message": "work in progress", "committedDate": "2020-10-23T17:53:53Z", "type": "commit"}, {"oid": "a900afafcbe52ec912887214141859a6dfe6e593", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a900afafcbe52ec912887214141859a6dfe6e593", "message": "work in progress", "committedDate": "2020-10-26T02:24:37Z", "type": "commit"}, {"oid": "ad4be5622e4f6f0d4602fb10cc30403b3e353c49", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ad4be5622e4f6f0d4602fb10cc30403b3e353c49", "message": "cleanup", "committedDate": "2020-10-26T14:08:26Z", "type": "commit"}, {"oid": "4d7ce38c0c4ac946af45553d7c504c7e59821c51", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4d7ce38c0c4ac946af45553d7c504c7e59821c51", "message": "fix unit test failure in PodWatcherTest not related to this PR", "committedDate": "2020-10-26T14:12:22Z", "type": "commit"}, {"oid": "6d9bb16c1fdbbef3ba6751ad38b6556516fc10ef", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6d9bb16c1fdbbef3ba6751ad38b6556516fc10ef", "message": "minor changes", "committedDate": "2020-10-26T20:38:23Z", "type": "commit"}, {"oid": "5501a1b7f54ca640e3810d979b93d09be2aecb66", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5501a1b7f54ca640e3810d979b93d09be2aecb66", "message": "doc changes", "committedDate": "2020-10-26T20:53:17Z", "type": "commit"}, {"oid": "cc78fc7d9cfd325080f458b28698ed58f347d57c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cc78fc7d9cfd325080f458b28698ed58f347d57c", "message": "add an example in the doc", "committedDate": "2020-10-26T21:28:26Z", "type": "commit"}, {"oid": "9d3c1d0a917f86aa0407a3cddb8be5038125f924", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9d3c1d0a917f86aa0407a3cddb8be5038125f924", "message": "Merge remote-tracking branch 'origin/develop' into add-introspect-version-label", "committedDate": "2020-10-27T12:30:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2NzQyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512667428", "bodyText": "Starting from operator 3.1.0 -> Beginning with operator 3.1.0\nthat the pod is running at -> at which the pod is running", "author": "rosemarymarano", "createdAt": "2020-10-27T12:55:17Z", "path": "docs-source/content/userguide/managing-domains/domain-lifecycle/introspection.md", "diffHunk": "@@ -44,6 +44,21 @@ Set `introspectVersion` to a new value.\n \n As with `restartVersion`, the `introspectVersion` field has no required format; however, we recommend using a value likely to be unique such as a continually increasing number or a timestamp.\n \n+Starting from operator 3.1.0, if a domain resource's `spec.introspectVersion` is set, each of the domain's WebLogic Server pods will have a label with the key `weblogic.IntrospectVersion` to indicate the `introspectVersion` that the pod is running at.", "originalCommit": "9d3c1d0a917f86aa0407a3cddb8be5038125f924", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3MzA0OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512673049", "bodyText": "value either -> value, either (comma here)\nthe pod, or when -> the pod or when (no comma here)", "author": "rosemarymarano", "createdAt": "2020-10-27T13:03:52Z", "path": "docs-source/content/userguide/managing-domains/domain-lifecycle/introspection.md", "diffHunk": "@@ -44,6 +44,21 @@ Set `introspectVersion` to a new value.\n \n As with `restartVersion`, the `introspectVersion` field has no required format; however, we recommend using a value likely to be unique such as a continually increasing number or a timestamp.\n \n+Starting from operator 3.1.0, if a domain resource's `spec.introspectVersion` is set, each of the domain's WebLogic Server pods will have a label with the key `weblogic.IntrospectVersion` to indicate the `introspectVersion` that the pod is running at.\n+\n+```\n+Name:           domain1-admin-server\n+Namespace:      domain1-ns\n+Priority:       0\n+Labels:         weblogic.createdByOperator=true\n+                weblogic.domainName=domain1\n+                weblogic.domainUID=domain1\n+                weblogic.introspectVersion=12345\n+                weblogic.serverName=admin-server\n+```\n+\n+When a domain's `spec.intrsopectVersion` is changed, the `weblogic.introspectVersion` label of each WebLogic Server pod is updated to the new `introspectVersion` value either when the operator restarts the pod, or when the operator determines that the pod does not need to be restarted.", "originalCommit": "9d3c1d0a917f86aa0407a3cddb8be5038125f924", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4NjUwNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512686504", "bodyText": "[initiate introspection] ->[Initiating introspection]\nSee also overridesConfigurationStrategy. -> I do not see overridesConfigurationStrategy on this page.", "author": "rosemarymarano", "createdAt": "2020-10-27T13:23:21Z", "path": "docs-source/content/userguide/managing-domains/domain-resource.md", "diffHunk": "@@ -161,7 +161,7 @@ Elements related to domain [startup and shutdown]({{< relref \"/userguide/managin\n * `replicas`: The default number of cluster member Managed Server instances to start for each WebLogic cluster in the domain configuration, unless `replicas` is specified for that cluster under the `clusters` field. For each cluster, the operator will sort cluster member Managed Server names from the WebLogic domain configuration by normalizing any numbers in the Managed Server name and then sorting alphabetically. This is done so that server names such as \"managed-server10\" come after \"managed-server9\". The operator will then start Managed Servers from the sorted list, up to the `replicas` count, unless specific Managed Servers are specified as starting in their entry under the `managedServers` field. In that case, the specified Managed Servers will be started and then additional cluster members will be started, up to the `replicas` count, by finding further cluster members in the sorted list that are not already started. If cluster members are started because of their entries under `managedServers`, then a cluster may have more cluster members running than its `replicas` count. Defaults to 0.\n * `maxClusterConcurrentStartup`: The maximum number of cluster member Managed Server instances that the operator will start in parallel for a given cluster, if `maxConcurrentStartup` is not specified for a specific cluster under the `clusters` field. A value of 0 means there is no configured limit. Defaults to 0.\n * `allowReplicasBelowMinDynClusterSize`: Whether to allow the number of running cluster member Managed Server instances to drop below the minimum dynamic cluster size configured in the WebLogic domain configuration, if this is not specified for a specific cluster under the `clusters` field. Defaults to true.\n-* `introspectVersion`: Changes to this field cause the operator to repeat its introspection of the WebLogic domain configuration. Repeating introspection is required for the operator to recognize changes to the domain configuration, such as adding a new WebLogic cluster or Managed Server instance, to regenerate configuration overrides, or to regenerate the WebLogic domain home when the `domainHomeSourceType` is FromModel. Introspection occurs automatically, without requiring change to this field, when servers are first started or restarted after a full domain shut down. For the FromModel `domainHomeSourceType`, introspection also occurs when a running server must be restarted because of changes to any of the fields [listed here]({{< relref \"/userguide/managing-domains/domain-lifecycle/startup#fields-that-cause-servers-to-be-restarted\" >}}). See also `overridesConfigurationStrategy`.\n+* `introspectVersion`: Changes to this field cause the operator to repeat its introspection of the WebLogic domain configuration (see [initiate introspection]({{< relref \"/userguide/managing-domains/domain-lifecycle/introspection/_index.md#initiating-introspection\" >}})). Repeating introspection is required for the operator to recognize changes to the domain configuration, such as adding a new WebLogic cluster or Managed Server instance, to regenerate configuration overrides, or to regenerate the WebLogic domain home when the `domainHomeSourceType` is FromModel. Introspection occurs automatically, without requiring change to this field, when servers are first started or restarted after a full domain shut down. For the FromModel `domainHomeSourceType`, introspection also occurs when a running server must be restarted because of changes to any of the fields [listed here]({{< relref \"/userguide/managing-domains/domain-lifecycle/startup#fields-that-cause-servers-to-be-restarted\" >}}). See also `overridesConfigurationStrategy`.", "originalCommit": "9d3c1d0a917f86aa0407a3cddb8be5038125f924", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjcxMzY4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512713681", "bodyText": "\"See also overridesConfigurationStrategy\" part is old  (was there before this PR). I'll double check it.", "author": "doxiao", "createdAt": "2020-10-27T13:57:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4NjUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjczMDEzNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512730137", "bodyText": "This bullet is added in 3.0.0, and there has never been overridesConfigurationStrategy as far as I can tell. The closest is overrideDistributionStrategy. Tom? Ryan?", "author": "doxiao", "createdAt": "2020-10-27T14:17:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4NjUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjczOTUxNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512739514", "bodyText": "Yes, it's a typo. It's referring to overrideDistributionStrategy.", "author": "rjeberhard", "createdAt": "2020-10-27T14:28:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4NjUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgyNTE2Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512825166", "bodyText": "thanks. I made the change.", "author": "doxiao", "createdAt": "2020-10-27T16:06:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4NjUwNA=="}], "type": "inlineReview"}, {"oid": "eef06c56df8c07216148bcde5b2e3053fb33c874", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/eef06c56df8c07216148bcde5b2e3053fb33c874", "message": "doc edits to address review comments", "committedDate": "2020-10-27T14:28:17Z", "type": "commit"}, {"oid": "f65501687cd567c1bf099e3cb6dd043aa0a541de", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f65501687cd567c1bf099e3cb6dd043aa0a541de", "message": "Merge remote-tracking branch 'origin/develop' into add-introspect-version-label", "committedDate": "2020-10-27T14:47:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1ODg4Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512758883", "bodyText": "intrsopectVersion --> introspectVersion", "author": "tbarnes-us", "createdAt": "2020-10-27T14:50:33Z", "path": "docs-source/content/userguide/managing-domains/domain-lifecycle/introspection.md", "diffHunk": "@@ -57,7 +57,7 @@ Labels:         weblogic.createdByOperator=true\n                 weblogic.serverName=admin-server\n ```\n \n-When a domain's `spec.intrsopectVersion` is changed, the `weblogic.introspectVersion` label of each WebLogic Server pod is updated to the new `introspectVersion` value either when the operator restarts the pod, or when the operator determines that the pod does not need to be restarted.\n+When a domain's `spec.intrsopectVersion` is changed, the `weblogic.introspectVersion` label of each WebLogic Server pod is updated to the new `introspectVersion` value, either when the operator restarts the pod or when the operator determines that the pod does not need to be restarted.", "originalCommit": "f65501687cd567c1bf099e3cb6dd043aa0a541de", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2NjYxOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512766618", "bodyText": "Please reference the exact name/location of the namespace strategy setting and expand the CRD acronym to something like - Custom Resource for Domains (CRD)", "author": "tbarnes-us", "createdAt": "2020-10-27T14:59:35Z", "path": "operator/src/main/resources/Operator.properties", "diffHunk": "@@ -189,6 +189,7 @@ WLSKO-0176=Job {1} in namespace {0} failed, job details are {2}\n WLSKO-0177=Pod {0} in namespace {1} failed, the pod status is {2}\n WLSKO-0178=Patching administration server Pod labels with ''weblogic.introspectVersion'' {2} for WebLogic domain with UID: {0}. Administration server name: {1}.\n WLSKO-0179=Patching managed server Pod labels with ''weblogic.introspectVersion'' {2} for WebLogic domain with UID: {0}. Managed server name: {1}.\n+WLSKO-0180=Operator cannot start. 'Dedicated' namespace strategy selected, but the CRD is not installed", "originalCommit": "f65501687cd567c1bf099e3cb6dd043aa0a541de", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2ODYxMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512768613", "bodyText": "restartVersion?", "author": "tbarnes-us", "createdAt": "2020-10-27T15:01:49Z", "path": "docs-source/content/userguide/managing-domains/domain-lifecycle/introspection.md", "diffHunk": "@@ -44,6 +44,21 @@ Set `introspectVersion` to a new value.\n \n As with `restartVersion`, the `introspectVersion` field has no required format; however, we recommend using a value likely to be unique such as a continually increasing number or a timestamp.\n \n+Beginning with operator 3.1.0, if a domain resource's `spec.introspectVersion` is set, each of the domain's WebLogic Server pods will have a label with the key `weblogic.IntrospectVersion` to indicate the `introspectVersion` at which the pod is running.\n+\n+```\n+Name:           domain1-admin-server\n+Namespace:      domain1-ns\n+Priority:       0\n+Labels:         weblogic.createdByOperator=true\n+                weblogic.domainName=domain1\n+                weblogic.domainUID=domain1\n+                weblogic.introspectVersion=12345\n+                weblogic.serverName=admin-server", "originalCommit": "f65501687cd567c1bf099e3cb6dd043aa0a541de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc4MTk0OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512781949", "bodyText": "It is just an example to show the new label. startVersion is not always set.", "author": "doxiao", "createdAt": "2020-10-27T15:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2ODYxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgxNDgxNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512814816", "bodyText": "Up to you.  introspectVersion is not always set either.", "author": "tbarnes-us", "createdAt": "2020-10-27T15:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2ODYxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgyODA0MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512828041", "bodyText": "I am sure there are many things that are in the pod but not in this example. We are talking about the use case where the  introspect version is set here.", "author": "doxiao", "createdAt": "2020-10-27T16:10:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2ODYxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2OTA4Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512769082", "bodyText": "weblogic.IntrospectVersion --> weblogic.introspectVersion", "author": "tbarnes-us", "createdAt": "2020-10-27T15:02:26Z", "path": "docs-source/content/userguide/managing-domains/domain-lifecycle/introspection.md", "diffHunk": "@@ -44,6 +44,21 @@ Set `introspectVersion` to a new value.\n \n As with `restartVersion`, the `introspectVersion` field has no required format; however, we recommend using a value likely to be unique such as a continually increasing number or a timestamp.\n \n+Beginning with operator 3.1.0, if a domain resource's `spec.introspectVersion` is set, each of the domain's WebLogic Server pods will have a label with the key `weblogic.IntrospectVersion` to indicate the `introspectVersion` at which the pod is running.", "originalCommit": "f65501687cd567c1bf099e3cb6dd043aa0a541de", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc3MjY2NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512772664", "bodyText": "Minor minor nit: combine repeated patch string concatenation code into a single local variable...", "author": "tbarnes-us", "createdAt": "2020-10-27T15:06:41Z", "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/PodStepContext.java", "diffHunk": "@@ -364,6 +366,24 @@ protected Step patchPod(V1Pod currentPod, Step next) {\n             new V1Patch(patchBuilder.build().toString()), patchResponse(next));\n   }\n \n+  private Step updateCurrentPod(V1Pod currentPod, Step next) {\n+    return createProgressingStep(updatePod(currentPod, next));\n+  }\n+\n+  protected Step updatePod(V1Pod currentPod, Step next) {\n+    JsonPatchBuilder patchBuilder = Json.createPatchBuilder();\n+    String baseName = \"/metadata/labels/\";\n+    if (!getPodLabels().containsKey(INTROSPECTION_STATE_LABEL)) {\n+      patchBuilder.add(baseName + INTROSPECTION_STATE_LABEL, getDomain().getSpec().getIntrospectVersion());\n+    } else {\n+      patchBuilder.replace(baseName + INTROSPECTION_STATE_LABEL, getDomain().getSpec().getIntrospectVersion());", "originalCommit": "f65501687cd567c1bf099e3cb6dd043aa0a541de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3OTA4Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512879083", "bodyText": "Or better, into a method call. But I agree that this code is needless duplication.", "author": "russgold", "createdAt": "2020-10-27T17:18:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc3MjY2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgwOTEwMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512809103", "bodyText": "There's a lot of overlap between the MANAGED/ADMIN _ POD_ PATCHED/CREATED/REPLACED/EXISTS log messages at KO-0120/0121/0041/0042/0043/0050/0051/0052.\nIMO, they should be aligned since that would simplify tracing pod transitions.  Something like:\nAction on pod ''{0}'' of type ''managed server/adminstration server'', operation ''patched/created/replaced/exists'', domain UID ''{1}'', label ''weblogic.introspectVersion''=''{2}'', label ''weblogic.restartVersion''=''{3}''.\n\nThey could remain separate log messages, or combined into a single log message that parameterizes the operation and server type.\nAlso, I suspect 'domain UID' is no longer needed since it's probably always reported in the log message's domain UID field...", "author": "tbarnes-us", "createdAt": "2020-10-27T15:48:12Z", "path": "operator/src/main/resources/Operator.properties", "diffHunk": "@@ -187,6 +187,8 @@ WLSKO-0175=Job {0} in namespace {1} failed with status {2}. Check log messages \\\n   copied from the introspector pod {3} log for additional information.\n WLSKO-0176=Job {1} in namespace {0} failed, job details are {2}\n WLSKO-0177=Pod {0} in namespace {1} failed, the pod status is {2}\n+WLSKO-0178=Patching administration server Pod labels with ''weblogic.introspectVersion'' {2} for WebLogic domain with UID: {0}. Administration server name: {1}.\n+WLSKO-0179=Patching managed server Pod labels with ''weblogic.introspectVersion'' {2} for WebLogic domain with UID: {0}. Managed server name: {1}.", "originalCommit": "f65501687cd567c1bf099e3cb6dd043aa0a541de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgyMTk1Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512821953", "bodyText": "I would suggest that we make this change in a different PR after everyone agrees.  Note that a lot of unit test cases check the log messages.", "author": "doxiao", "createdAt": "2020-10-27T16:02:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgwOTEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg0Mzg1MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512843851", "bodyText": "I don't think all that many tests are checking each message. The change shouldn't be all that much work, but I agree it is not really part of this PR.", "author": "russgold", "createdAt": "2020-10-27T16:29:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgwOTEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg1MDc2NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512850764", "bodyText": "I've filed https://jira.****/jira/browse/OWLS-85639 to track.  @rjeberhard FYI", "author": "tbarnes-us", "createdAt": "2020-10-27T16:38:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgwOTEwMw=="}], "type": "inlineReview"}, {"oid": "965b0935b45e994651f1da566b7bb82c12502a75", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/965b0935b45e994651f1da566b7bb82c12502a75", "message": "address review comments", "committedDate": "2020-10-27T16:08:07Z", "type": "commit"}, {"oid": "0dc1af7050c5e8b0a7311faf0f18940d455b3bcb", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0dc1af7050c5e8b0a7311faf0f18940d455b3bcb", "message": "cleanup", "committedDate": "2020-10-27T16:16:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg1NjAzOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512856038", "bodyText": "[initiating introspection] -> [Initiating introspection] (capital \"I\" as in the section title.)", "author": "rosemarymarano", "createdAt": "2020-10-27T16:45:54Z", "path": "docs-source/content/userguide/managing-domains/domain-resource.md", "diffHunk": "@@ -161,14 +161,14 @@ Elements related to domain [startup and shutdown]({{< relref \"/userguide/managin\n * `replicas`: The default number of cluster member Managed Server instances to start for each WebLogic cluster in the domain configuration, unless `replicas` is specified for that cluster under the `clusters` field. For each cluster, the operator will sort cluster member Managed Server names from the WebLogic domain configuration by normalizing any numbers in the Managed Server name and then sorting alphabetically. This is done so that server names such as \"managed-server10\" come after \"managed-server9\". The operator will then start Managed Servers from the sorted list, up to the `replicas` count, unless specific Managed Servers are specified as starting in their entry under the `managedServers` field. In that case, the specified Managed Servers will be started and then additional cluster members will be started, up to the `replicas` count, by finding further cluster members in the sorted list that are not already started. If cluster members are started because of their entries under `managedServers`, then a cluster may have more cluster members running than its `replicas` count. Defaults to 0.\n * `maxClusterConcurrentStartup`: The maximum number of cluster member Managed Server instances that the operator will start in parallel for a given cluster, if `maxConcurrentStartup` is not specified for a specific cluster under the `clusters` field. A value of 0 means there is no configured limit. Defaults to 0.\n * `allowReplicasBelowMinDynClusterSize`: Whether to allow the number of running cluster member Managed Server instances to drop below the minimum dynamic cluster size configured in the WebLogic domain configuration, if this is not specified for a specific cluster under the `clusters` field. Defaults to true.\n-* `introspectVersion`: Changes to this field cause the operator to repeat its introspection of the WebLogic domain configuration (see [initiate introspection]({{< relref \"/userguide/managing-domains/domain-lifecycle/introspection/_index.md#initiating-introspection\" >}})). Repeating introspection is required for the operator to recognize changes to the domain configuration, such as adding a new WebLogic cluster or Managed Server instance, to regenerate configuration overrides, or to regenerate the WebLogic domain home when the `domainHomeSourceType` is FromModel. Introspection occurs automatically, without requiring change to this field, when servers are first started or restarted after a full domain shut down. For the FromModel `domainHomeSourceType`, introspection also occurs when a running server must be restarted because of changes to any of the fields [listed here]({{< relref \"/userguide/managing-domains/domain-lifecycle/startup#fields-that-cause-servers-to-be-restarted\" >}}). See also `overridesConfigurationStrategy`.\n+* `introspectVersion`: Changes to this field cause the operator to repeat its introspection of the WebLogic domain configuration (see [initiating introspection]({{< relref \"/userguide/managing-domains/domain-lifecycle/introspection/_index.md#initiating-introspection\" >}})). Repeating introspection is required for the operator to recognize changes to the domain configuration, such as adding a new WebLogic cluster or Managed Server instance, to regenerate configuration overrides, or to regenerate the WebLogic domain home when the `domainHomeSourceType` is FromModel. Introspection occurs automatically, without requiring change to this field, when servers are first started or restarted after a full domain shut down. For the FromModel `domainHomeSourceType`, introspection also occurs when a running server must be restarted because of changes to any of the fields [listed here]({{< relref \"/userguide/managing-domains/domain-lifecycle/startup#fields-that-cause-servers-to-be-restarted\" >}}). See also `overridesConfigurationStrategy`.", "originalCommit": "eef06c56df8c07216148bcde5b2e3053fb33c874", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkzMjY2NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512932664", "bodyText": "fixed. thanks for your quick review!", "author": "doxiao", "createdAt": "2020-10-27T18:28:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg1NjAzOA=="}], "type": "inlineReview"}, {"oid": "af1ad2e17636538236d43e842eb2e66b3691b420", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/af1ad2e17636538236d43e842eb2e66b3691b420", "message": "add domainRestartVersion to the example", "committedDate": "2020-10-27T18:10:06Z", "type": "commit"}, {"oid": "a6f05b94cc67ed4af38ce7b4df245dce7231c9bf", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a6f05b94cc67ed4af38ce7b4df245dce7231c9bf", "message": "move the patch part into the existing patch step and remove log messages", "committedDate": "2020-10-27T18:17:27Z", "type": "commit"}, {"oid": "d5516e66c657461d7035a231453c31fb4bb8fb06", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d5516e66c657461d7035a231453c31fb4bb8fb06", "message": "minor doc edit", "committedDate": "2020-10-27T18:23:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1ODc2MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512958760", "bodyText": "This is still much more complex than is needed. Look at PodStepContext.createMetadata(). This is where we define the labels and annotations for server pods. To add a new label, all you need to do is define it there. The rest of the code will automatically handle detection of differences between what is supposed to be and what we find.", "author": "russgold", "createdAt": "2020-10-27T19:12:26Z", "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/PodStepContext.java", "diffHunk": "@@ -359,6 +361,15 @@ protected Step patchPod(V1Pod currentPod, Step next) {\n     KubernetesUtils.addPatches(\n         patchBuilder, \"/metadata/annotations/\", getAnnotations(currentPod), getPodAnnotations());\n \n+    if (introspectVersionChanged(currentPod)) {", "originalCommit": "d5516e66c657461d7035a231453c31fb4bb8fb06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk2NzY1NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512967654", "bodyText": "The label was added in the createPodModel method but in the non hashed part. If you look into getPodLabels() you'll see that the labels that are to be patched there are the customer defined labels in the server specs. I don't think you want to add this label in there.", "author": "doxiao", "createdAt": "2020-10-27T19:25:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1ODc2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1OTU1Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512959557", "bodyText": "Is there a particular reason to renumber this? I deliberately skipped some numbers to allow 178 and 179 for messages that seemed logically connected to the previous ones. Do we have a rule banning skipped numbers?", "author": "russgold", "createdAt": "2020-10-27T19:13:53Z", "path": "operator/src/main/resources/Operator.properties", "diffHunk": "@@ -187,7 +187,7 @@ WLSKO-0175=Job {0} in namespace {1} failed with status {2}. Check log messages \\\n   copied from the introspector pod {3} log for additional information.\n WLSKO-0176=Job {1} in namespace {0} failed, job details are {2}\n WLSKO-0177=Pod {0} in namespace {1} failed, the pod status is {2}\n-WLSKO-0180=Operator cannot start. 'Dedicated' namespace strategy selected, but the CRD is not installed\n+WLSKO-0178=Operator cannot start. Operator 'domainNamespaceSelectionStrategy' is set to 'Dedicated', but the Custom Resource Definition for ''domains.weblogic.oracle'' is not installed.", "originalCommit": "d5516e66c657461d7035a231453c31fb4bb8fb06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk2NTc5OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512965798", "bodyText": "Sorry, I had two log messages 0178 and 0179 in my previous version of the changes. Now they are gone and I thought yours could move up. I assume that we could skip numbers.", "author": "doxiao", "createdAt": "2020-10-27T19:23:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1OTU1Nw=="}], "type": "inlineReview"}, {"oid": "f1d316c38a23d755aa6fc0d09ae629d4b3f6aa34", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f1d316c38a23d755aa6fc0d09ae629d4b3f6aa34", "message": "refactored a little", "committedDate": "2020-10-27T20:41:15Z", "type": "commit"}, {"oid": "ca7d8c0b3f9423e08945469b4e675d8af11be05b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ca7d8c0b3f9423e08945469b4e675d8af11be05b", "message": "Correct overrideDistributionStrategy other places", "committedDate": "2020-10-27T21:25:38Z", "type": "commit"}, {"oid": "e2bd8fa7ae7945988679e445d6b283089bd2fd46", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e2bd8fa7ae7945988679e445d6b283089bd2fd46", "message": "Add correct the other misspelled field name", "committedDate": "2020-10-27T21:40:17Z", "type": "commit"}]}