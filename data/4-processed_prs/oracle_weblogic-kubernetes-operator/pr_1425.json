{"pr_number": 1425, "pr_title": "Add FAQ entry for persistent volume using OCI FSS", "pr_createdAt": "2020-02-12T23:35:55Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425", "timeline": [{"oid": "e16d90367e56b05c8022cc46561b8d06a48b2998", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e16d90367e56b05c8022cc46561b8d06a48b2998", "message": "Add FAQ entry for persistent volume using OCI FSS", "committedDate": "2020-02-12T23:29:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3NTk1OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378575959", "bodyText": "This should have a weight in order to choose where it ends up in the FAQ contents list.  See other FAQs for their weights.", "author": "tbarnes-us", "createdAt": "2020-02-12T23:40:44Z", "path": "docs-source/content/faq/oci-fss-pv.md", "diffHunk": "@@ -0,0 +1,96 @@\n+---\n+title: \"Using OCI File Storage (FSS) for Persistent Volumes\"\n+date: 2020-02-12T12:12:12-05:00\n+draft: false", "originalCommit": "e16d90367e56b05c8022cc46561b8d06a48b2998", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MDE2Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378580166", "bodyText": "I didn't and don't see a weight on any FAQ file?", "author": "TheFrogPad", "createdAt": "2020-02-12T23:54:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3NTk1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzOTMzOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378839339", "bodyText": "You're right. The FAQs do not have weights, not sure why other than perhaps we have not been particular about their order.", "author": "rosemarymarano", "createdAt": "2020-02-13T12:49:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3NTk1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3NjcwNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378576705", "bodyText": "Long sentence.  Maybe at least put a comma before 'then the file system'.", "author": "tbarnes-us", "createdAt": "2020-02-12T23:43:14Z", "path": "docs-source/content/faq/oci-fss-pv.md", "diffHunk": "@@ -0,0 +1,96 @@\n+---\n+title: \"Using OCI File Storage (FSS) for Persistent Volumes\"\n+date: 2020-02-12T12:12:12-05:00\n+draft: false\n+---\n+\n+If you are running your Kubernetes cluster on Oracle Container Engine \n+for Kubernetes (commonly known as OKE), and you use OCI File Storage (FSS)\n+for persistent volumes to store the WebLogic domain home then the file system\n+handling demonstrated in the operator persistent volume sample will require\n+an update to properly initialize the file ownership on the persistent volume\n+when the domain is initially created.\n+", "originalCommit": "e16d90367e56b05c8022cc46561b8d06a48b2998", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MDQ3Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378580472", "bodyText": "Sure, @rosemarymarano, can you provide your usual input?", "author": "TheFrogPad", "createdAt": "2020-02-12T23:55:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3NjcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MTUwMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378581500", "bodyText": "BTW, this is very similar to the FAQ of OCI Load Balancer so I can update there if needed...", "author": "TheFrogPad", "createdAt": "2020-02-12T23:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3NjcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg0MzEzMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378843130", "bodyText": "Yes, definitely needs a comma after domain home (classic if something, then something).\nI didn't see a similar sentence in the OCI Load Balancer FAQ, but if it exists, please fix it there also.", "author": "rosemarymarano", "createdAt": "2020-02-13T12:57:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3NjcwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg0Mzg5Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378843896", "bodyText": "normally -> typically", "author": "rosemarymarano", "createdAt": "2020-02-13T12:58:54Z", "path": "docs-source/content/faq/oci-fss-pv.md", "diffHunk": "@@ -0,0 +1,96 @@\n+---\n+title: \"Using OCI File Storage (FSS) for Persistent Volumes\"\n+date: 2020-02-12T12:12:12-05:00\n+draft: false\n+---\n+\n+If you are running your Kubernetes cluster on Oracle Container Engine \n+for Kubernetes (commonly known as OKE), and you use OCI File Storage (FSS)\n+for persistent volumes to store the WebLogic domain home then the file system\n+handling demonstrated in the operator persistent volume sample will require\n+an update to properly initialize the file ownership on the persistent volume\n+when the domain is initially created.\n+\n+{{% notice note %}}\n+File permission handling on persistent volumes can differ between\n+cloud providers and even with the underlying storage handling on\n+Linux based systems. These instructions provide one option to\n+update file ownership used by the standard Oracle images where\n+UID `1000` and GID `1000` normally represent the `oracle` or `opc` user.", "originalCommit": "e16d90367e56b05c8022cc46561b8d06a48b2998", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg0NDk0OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378844948", "bodyText": "see from the -> seen in the", "author": "rosemarymarano", "createdAt": "2020-02-13T13:01:10Z", "path": "docs-source/content/faq/oci-fss-pv.md", "diffHunk": "@@ -0,0 +1,96 @@\n+---\n+title: \"Using OCI File Storage (FSS) for Persistent Volumes\"\n+date: 2020-02-12T12:12:12-05:00\n+draft: false\n+---\n+\n+If you are running your Kubernetes cluster on Oracle Container Engine \n+for Kubernetes (commonly known as OKE), and you use OCI File Storage (FSS)\n+for persistent volumes to store the WebLogic domain home then the file system\n+handling demonstrated in the operator persistent volume sample will require\n+an update to properly initialize the file ownership on the persistent volume\n+when the domain is initially created.\n+\n+{{% notice note %}}\n+File permission handling on persistent volumes can differ between\n+cloud providers and even with the underlying storage handling on\n+Linux based systems. These instructions provide one option to\n+update file ownership used by the standard Oracle images where\n+UID `1000` and GID `1000` normally represent the `oracle` or `opc` user.\n+For more information on persistent volume handling,\n+see [Persistent storage]({{< relref \"/userguide/managing-domains/persistent-storage/_index.md\" >}}).\n+{{% /notice %}}\n+\n+\n+### Failure during domain creation with persistent volume sample\n+\n+The existing sample for [creation of a domain home on persistent volume](https://github.com/oracle/weblogic-kubernetes-operator/tree/master/kubernetes/samples/scripts/create-weblogic-domain/domain-home-on-pv)\n+uses a Kubernetes job to create the domain. The sample uses an\n+`initContainers` section to change the file ownership which will\n+fail for OCI FSS created volumes used with an OKE cluster.\n+\n+The OCI FSS volume contains some files that are not modifiable thus\n+causing the Kubernetes job to fail. The failure is see from the", "originalCommit": "e16d90367e56b05c8022cc46561b8d06a48b2998", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg0NjQ3Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378846477", "bodyText": "In the snippet of the create-domain-job-template.yaml below, you will see -> In the following snippet of the create-domain-job-template.yaml, you can see", "author": "rosemarymarano", "createdAt": "2020-02-13T13:04:36Z", "path": "docs-source/content/faq/oci-fss-pv.md", "diffHunk": "@@ -0,0 +1,96 @@\n+---\n+title: \"Using OCI File Storage (FSS) for Persistent Volumes\"\n+date: 2020-02-12T12:12:12-05:00\n+draft: false\n+---\n+\n+If you are running your Kubernetes cluster on Oracle Container Engine \n+for Kubernetes (commonly known as OKE), and you use OCI File Storage (FSS)\n+for persistent volumes to store the WebLogic domain home then the file system\n+handling demonstrated in the operator persistent volume sample will require\n+an update to properly initialize the file ownership on the persistent volume\n+when the domain is initially created.\n+\n+{{% notice note %}}\n+File permission handling on persistent volumes can differ between\n+cloud providers and even with the underlying storage handling on\n+Linux based systems. These instructions provide one option to\n+update file ownership used by the standard Oracle images where\n+UID `1000` and GID `1000` normally represent the `oracle` or `opc` user.\n+For more information on persistent volume handling,\n+see [Persistent storage]({{< relref \"/userguide/managing-domains/persistent-storage/_index.md\" >}}).\n+{{% /notice %}}\n+\n+\n+### Failure during domain creation with persistent volume sample\n+\n+The existing sample for [creation of a domain home on persistent volume](https://github.com/oracle/weblogic-kubernetes-operator/tree/master/kubernetes/samples/scripts/create-weblogic-domain/domain-home-on-pv)\n+uses a Kubernetes job to create the domain. The sample uses an\n+`initContainers` section to change the file ownership which will\n+fail for OCI FSS created volumes used with an OKE cluster.\n+\n+The OCI FSS volume contains some files that are not modifiable thus\n+causing the Kubernetes job to fail. The failure is see from the\n+description of the Kubernetes job pod:\n+```bash\n+$ kubectl describe -n domain1-ns pod domain1-create-weblogic-sample-domain-job-wdkvs\n+   :\n+   :\n+Init Containers:\n+  fix-pvc-owner:\n+    Container ID:  docker://7051b6abdc296c76e937246df03d157926f2f7477e63b6af3bf65f6ae1ceddee\n+    Image:         container-registry.oracle.com/middleware/weblogic:12.2.1.3\n+    Image ID:      docker-pullable://container-registry.oracle.com/middleware/weblogic@sha256:47dfd4fdf6b56210a6c49021b57dc2a6f2b0d3b3cfcd253af7a75ff6e7421498\n+    Port:          <none>\n+    Host Port:     <none>\n+    Command:\n+      sh\n+      -c\n+      chown -R 1000:1000 /shared\n+    State:          Terminated\n+      Reason:       Error\n+      Exit Code:    1\n+      Started:      Wed, 12 Feb 2020 18:28:53 +0000\n+      Finished:     Wed, 12 Feb 2020 18:28:53 +0000\n+    Ready:          False\n+    Restart Count:  0\n+    Environment:    <none>\n+\n+   :\n+```\n+\n+### Updating the domain on persistent volume sample\n+In the snippet of the [create-domain-job-template.yaml](https://github.com/oracle/weblogic-kubernetes-operator/blob/master/kubernetes/samples/scripts/create-weblogic-domain/domain-home-on-pv/create-domain-job-template.yaml)", "originalCommit": "e16d90367e56b05c8022cc46561b8d06a48b2998", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg0OTMwOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378849308", "bodyText": "The new command shown above should be made to your copy of this template file and will result in the ownership updated only for the expected files before the WebLogic domain is created on the persistent volume. ->\nUse this new command in your copy of this template file. This will result in the ownership being updated only for the expected files before the WebLogic domain is created on the persistent volume.", "author": "rosemarymarano", "createdAt": "2020-02-13T13:10:25Z", "path": "docs-source/content/faq/oci-fss-pv.md", "diffHunk": "@@ -0,0 +1,96 @@\n+---\n+title: \"Using OCI File Storage (FSS) for Persistent Volumes\"\n+date: 2020-02-12T12:12:12-05:00\n+draft: false\n+---\n+\n+If you are running your Kubernetes cluster on Oracle Container Engine \n+for Kubernetes (commonly known as OKE), and you use OCI File Storage (FSS)\n+for persistent volumes to store the WebLogic domain home then the file system\n+handling demonstrated in the operator persistent volume sample will require\n+an update to properly initialize the file ownership on the persistent volume\n+when the domain is initially created.\n+\n+{{% notice note %}}\n+File permission handling on persistent volumes can differ between\n+cloud providers and even with the underlying storage handling on\n+Linux based systems. These instructions provide one option to\n+update file ownership used by the standard Oracle images where\n+UID `1000` and GID `1000` normally represent the `oracle` or `opc` user.\n+For more information on persistent volume handling,\n+see [Persistent storage]({{< relref \"/userguide/managing-domains/persistent-storage/_index.md\" >}}).\n+{{% /notice %}}\n+\n+\n+### Failure during domain creation with persistent volume sample\n+\n+The existing sample for [creation of a domain home on persistent volume](https://github.com/oracle/weblogic-kubernetes-operator/tree/master/kubernetes/samples/scripts/create-weblogic-domain/domain-home-on-pv)\n+uses a Kubernetes job to create the domain. The sample uses an\n+`initContainers` section to change the file ownership which will\n+fail for OCI FSS created volumes used with an OKE cluster.\n+\n+The OCI FSS volume contains some files that are not modifiable thus\n+causing the Kubernetes job to fail. The failure is see from the\n+description of the Kubernetes job pod:\n+```bash\n+$ kubectl describe -n domain1-ns pod domain1-create-weblogic-sample-domain-job-wdkvs\n+   :\n+   :\n+Init Containers:\n+  fix-pvc-owner:\n+    Container ID:  docker://7051b6abdc296c76e937246df03d157926f2f7477e63b6af3bf65f6ae1ceddee\n+    Image:         container-registry.oracle.com/middleware/weblogic:12.2.1.3\n+    Image ID:      docker-pullable://container-registry.oracle.com/middleware/weblogic@sha256:47dfd4fdf6b56210a6c49021b57dc2a6f2b0d3b3cfcd253af7a75ff6e7421498\n+    Port:          <none>\n+    Host Port:     <none>\n+    Command:\n+      sh\n+      -c\n+      chown -R 1000:1000 /shared\n+    State:          Terminated\n+      Reason:       Error\n+      Exit Code:    1\n+      Started:      Wed, 12 Feb 2020 18:28:53 +0000\n+      Finished:     Wed, 12 Feb 2020 18:28:53 +0000\n+    Ready:          False\n+    Restart Count:  0\n+    Environment:    <none>\n+\n+   :\n+```\n+\n+### Updating the domain on persistent volume sample\n+In the snippet of the [create-domain-job-template.yaml](https://github.com/oracle/weblogic-kubernetes-operator/blob/master/kubernetes/samples/scripts/create-weblogic-domain/domain-home-on-pv/create-domain-job-template.yaml)\n+below, you will see the updated `command` for the init container:\n+```\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: %DOMAIN_UID%-create-weblogic-sample-domain-job\n+  namespace: %NAMESPACE%\n+spec:\n+  template:\n+    metadata:\n+  :\n+  :\n+    spec:\n+      restartPolicy: Never\n+      initContainers:\n+        - name: fix-pvc-owner\n+          image: %WEBLOGIC_IMAGE%\n+          command: [\"sh\", \"-c\", \"chown -R 1000:1000 $(ls -a %DOMAIN_ROOT_DIR% | grep -v '^\\\\.')\"]\n+          volumeMounts:\n+          - name: weblogic-sample-domain-storage-volume\n+            mountPath: %DOMAIN_ROOT_DIR%\n+          securityContext:\n+            runAsUser: 0\n+            runAsGroup: 0\n+      containers:\n+        - name: create-weblogic-sample-domain-job\n+          image: %WEBLOGIC_IMAGE%\n+\n+  :\n+```\n+The new `command` shown above should be made to your copy of this template file", "originalCommit": "e16d90367e56b05c8022cc46561b8d06a48b2998", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkyMzI4Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r378923286", "bodyText": "Actually, the last part of this second sentence should be, \"being updated for the expected files only, before the WebLogic domain is created on the persistent volume.\"\n(Position of only: Keep only close to that which it modifies to improve the clarity and accuracy of the sentence.)", "author": "rosemarymarano", "createdAt": "2020-02-13T15:14:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg0OTMwOA=="}], "type": "inlineReview"}, {"oid": "77c8cf220d585e719873153c061355e483092757", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/77c8cf220d585e719873153c061355e483092757", "message": "Update init container command and FAQ text per review", "committedDate": "2020-02-13T19:06:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5MDc5NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r379090794", "bodyText": "Not a show-stopper, but the weight entry is still missing.  The FAQ files in the 'develop' branch look like they all have 'weight:' entries.", "author": "tbarnes-us", "createdAt": "2020-02-13T20:06:41Z", "path": "docs-source/content/faq/oci-fss-pv.md", "diffHunk": "@@ -0,0 +1,96 @@\n+---\n+title: \"Using OCI File Storage (FSS) for Persistent Volumes\"\n+date: 2020-02-12T12:12:12-05:00\n+draft: false", "originalCommit": "77c8cf220d585e719873153c061355e483092757", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5OTU1NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1425#discussion_r379099555", "bodyText": "fixed", "author": "markxnelson", "createdAt": "2020-02-13T20:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5MDc5NA=="}], "type": "inlineReview"}, {"oid": "333d79892855ea662e99944d1eb3a2a5bf440d8b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/333d79892855ea662e99944d1eb3a2a5bf440d8b", "message": "Update oci-fss-pv.md", "committedDate": "2020-02-13T20:25:29Z", "type": "commit"}, {"oid": "51670e8a4ddce578686c1ecccbe17bad8b957adb", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/51670e8a4ddce578686c1ecccbe17bad8b957adb", "message": "update the \\magic command", "committedDate": "2020-02-13T20:55:31Z", "type": "commit"}, {"oid": "e94a9a0e5d1d90e4a47f3cda7f8b90c254e27046", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e94a9a0e5d1d90e4a47f3cda7f8b90c254e27046", "message": "fix magic command", "committedDate": "2020-02-13T20:57:45Z", "type": "commit"}, {"oid": "cbf6c1d0bf10943b450647f8dd3cbf0a5d5a8ff0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cbf6c1d0bf10943b450647f8dd3cbf0a5d5a8ff0", "message": "Update init container command with extra bullet proof syntax", "committedDate": "2020-02-13T21:24:25Z", "type": "commit"}, {"oid": "33a8aab05c432a3538406fc1f58fc18df9255222", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/33a8aab05c432a3538406fc1f58fc18df9255222", "message": "Update init container command properly this time!", "committedDate": "2020-02-13T22:25:06Z", "type": "commit"}]}