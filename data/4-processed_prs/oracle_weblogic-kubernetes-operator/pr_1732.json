{"pr_number": 1732, "pr_title": "Added Voyager to Junit5 framework ", "pr_createdAt": "2020-06-12T18:28:07Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732", "timeline": [{"oid": "6ace9b6328e03c5ba3027b4a3af54a23272cf209", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6ace9b6328e03c5ba3027b4a3af54a23272cf209", "message": "Added Voyager to Junit5 framework jenkins-ignore", "committedDate": "2020-06-12T18:25:03Z", "type": "commit"}, {"oid": "694141bc639afe07bc34e97557fed6b4f172f2b0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/694141bc639afe07bc34e97557fed6b4f172f2b0", "message": "Changed DisplayName jenkins-ignore", "committedDate": "2020-06-15T18:08:11Z", "type": "commit"}, {"oid": "46c29a3bad36e96a647b8010d09b996f17597c2d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/46c29a3bad36e96a647b8010d09b996f17597c2d", "message": "Synced up with develop branch jenkins-ignore", "committedDate": "2020-06-16T18:59:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjMwNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441736307", "bodyText": "remove commented code", "author": "vanajamukkara", "createdAt": "2020-06-17T18:13:16Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItVoyagerSample.java", "diffHunk": "@@ -0,0 +1,298 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+//import com.google.common.primitives.Ints;", "originalCommit": "46c29a3bad36e96a647b8010d09b996f17597c2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxNDA4Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441914086", "bodyText": "done", "author": "hzhao-github", "createdAt": "2020-06-18T01:11:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjMwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441740775", "bodyText": "check Xian's PR #1740 which checks for ingress ready", "author": "vanajamukkara", "createdAt": "2020-06-17T18:21:13Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItVoyagerSample.java", "diffHunk": "@@ -0,0 +1,298 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+//import com.google.common.primitives.Ints;\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.AdminService;\n+import oracle.weblogic.domain.Channel;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.annotations.tags.MustNotRunInParallel;\n+import oracle.weblogic.kubernetes.annotations.tags.Slow;\n+import oracle.weblogic.kubernetes.extensions.LoggedTest;\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+import org.awaitility.core.ConditionFactory;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+\n+import static java.util.concurrent.TimeUnit.MINUTES;\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.K8S_NODEPORT_HOST;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.VOYAGER_CHART_NAME;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDockerRegistrySecret;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.dockerLoginAndPushImageToRegistry;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installVoyagerIngressAndVerify;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.awaitility.Awaitility.with;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+/**\n+ * Verify that Voyager and Voyager ingress are installed successfully.\n+ */\n+@DisplayName(\"Test Voyager is installed and the Voyager ingress is created successfully\")\n+@IntegrationTest\n+class ItVoyagerSample implements LoggedTest {\n+\n+  // constants for operator and WebLogic domain\n+  private static String domainUid = \"voyager-domain-1\";\n+  private static String clusterName = \"cluster-1\";\n+  private static String adminServerPodName = domainUid + \"-admin-server\";\n+  private static String managedServerPrefix = domainUid + \"-managed-server\";\n+  private static int managedServerPort = 8001;\n+  private static int replicaCount = 2;\n+  private static String opNamespace = null;\n+  private static String domainNamespace = null;\n+  private static ConditionFactory withStandardRetryPolicy = null;\n+\n+  private static HelmParams voyagerHelmParams = null;\n+\n+  /**\n+   * Install operator, create a one cluster domain and install Voyager.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism\n+   */\n+  @BeforeAll\n+  public static void init(@Namespaces(3) List<String> namespaces) {\n+    // create standard, reusable retry/backoff policy\n+    withStandardRetryPolicy = with().pollDelay(2, SECONDS)\n+      .and().with().pollInterval(10, SECONDS)\n+      .atMost(5, MINUTES).await();\n+\n+    // get a unique Voyager namespace\n+    logger.info(\"Get a unique namespace for Voyager\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    String voyagerNamespace = namespaces.get(0);\n+\n+    // get a unique operator namespace\n+    logger.info(\"Get a unique namespace for operator\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    opNamespace = namespaces.get(1);\n+\n+    // get a unique domain namespace\n+    logger.info(\"Get a unique namespace for WebLogic domain\");\n+    assertNotNull(namespaces.get(2), \"Namespace list is null\");\n+    domainNamespace = namespaces.get(2);\n+\n+    final String cloudProvider = \"baremetal\";\n+    final boolean enableValidatingWebhook = false;\n+\n+    // install and verify Voyager\n+    voyagerHelmParams =\n+      installAndVerifyVoyager(voyagerNamespace, cloudProvider, enableValidatingWebhook);\n+\n+    // install and verify operator\n+    installAndVerifyOperator(opNamespace, domainNamespace);\n+\n+    // create and verify one cluster domain\n+    logger.info(\"Create domain and verify that it's running\");\n+    createAndVerifyDomain();\n+  }\n+\n+  @AfterAll\n+  void tearDown() {\n+    // uninstall Voyager\n+    if (voyagerHelmParams != null) {\n+      assertThat(uninstallVoyager(voyagerHelmParams))\n+          .as(\"Test uninstallVoyager returns true\")\n+          .withFailMessage(\"uninstallVoyager() did not return true\")\n+          .isTrue();\n+    }\n+  }\n+\n+  /**\n+   * The test invokes a webapp to verify the Voyager is installed successfully and ready to use.\n+   */\n+  @Test\n+  @DisplayName(\"Create the Voyager ingress and invoke the webapp to verify Voyager load balancer works\")\n+  @Slow\n+  @MustNotRunInParallel\n+  public void testVoyagerWorks() {\n+    String ingressName = domainUid + \"-ingress-host-routing\";\n+    String ingressServiceName = VOYAGER_CHART_NAME + \"-\" + ingressName;\n+    String channelName = \"tcp-80\";\n+\n+    try {\n+      // create Voyager ingress resource\n+      Map<String, Integer> clusterNameMsPortMap = new HashMap<>();\n+      clusterNameMsPortMap.put(clusterName, managedServerPort);\n+      List<String>  hostNames =\n+          installVoyagerIngressAndVerify(domainUid, domainNamespace, ingressName, clusterNameMsPortMap);", "originalCommit": "46c29a3bad36e96a647b8010d09b996f17597c2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTM4OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441741389", "bodyText": "isn't the ingress creation same for Nginx or Voyager?", "author": "vanajamukkara", "createdAt": "2020-06-17T18:22:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3MzMzOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441773338", "bodyText": "No They are diff", "author": "hzhao-github", "createdAt": "2020-06-17T19:09:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3Nzc1NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441777755", "bodyText": "We don't know the Nodeport until the Voyager ingress controller is created", "author": "hzhao-github", "createdAt": "2020-06-17T19:18:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgxMTY1OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441811658", "bodyText": "I will try to create a generic method that is not related to either Nginx or Voyager, see if we can consolidate", "author": "hzhao-github", "createdAt": "2020-06-17T20:24:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgxNDY1OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441814658", "bodyText": "Voyager ingress controller is already created, you can pass the node port to this method and verify ingress is ready by accessing ready app?", "author": "vanajamukkara", "createdAt": "2020-06-17T20:30:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgxNTY3Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441815676", "bodyText": "No, I need to get Nodeport after ingress controller is cfeated in installVoyagerIngressAndVerify, not passed to the method", "author": "hzhao-github", "createdAt": "2020-06-17T20:32:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgyMDM0NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441820345", "bodyText": "ok, I think we are using different terms here but talking the same ...ingress controllers are nginx, voyager, traefik, etc ..ingress resource is what you are creating in this method. You mean you can access node port after creating the ingress resource?", "author": "vanajamukkara", "createdAt": "2020-06-17T20:38:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgyODg0OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441828848", "bodyText": "all clear after discussing in slack, huiling will make the needed changes. Thanks Huiling.", "author": "vanajamukkara", "createdAt": "2020-06-17T20:55:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxNDIwMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441914203", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T01:12:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDc3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTY1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441741656", "bodyText": "This is not needed if you have the check for ingress ready", "author": "vanajamukkara", "createdAt": "2020-06-17T18:22:53Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItVoyagerSample.java", "diffHunk": "@@ -0,0 +1,298 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+//import com.google.common.primitives.Ints;\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.AdminService;\n+import oracle.weblogic.domain.Channel;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.annotations.tags.MustNotRunInParallel;\n+import oracle.weblogic.kubernetes.annotations.tags.Slow;\n+import oracle.weblogic.kubernetes.extensions.LoggedTest;\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+import org.awaitility.core.ConditionFactory;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+\n+import static java.util.concurrent.TimeUnit.MINUTES;\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.K8S_NODEPORT_HOST;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.VOYAGER_CHART_NAME;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDockerRegistrySecret;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.dockerLoginAndPushImageToRegistry;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installVoyagerIngressAndVerify;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.awaitility.Awaitility.with;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+/**\n+ * Verify that Voyager and Voyager ingress are installed successfully.\n+ */\n+@DisplayName(\"Test Voyager is installed and the Voyager ingress is created successfully\")\n+@IntegrationTest\n+class ItVoyagerSample implements LoggedTest {\n+\n+  // constants for operator and WebLogic domain\n+  private static String domainUid = \"voyager-domain-1\";\n+  private static String clusterName = \"cluster-1\";\n+  private static String adminServerPodName = domainUid + \"-admin-server\";\n+  private static String managedServerPrefix = domainUid + \"-managed-server\";\n+  private static int managedServerPort = 8001;\n+  private static int replicaCount = 2;\n+  private static String opNamespace = null;\n+  private static String domainNamespace = null;\n+  private static ConditionFactory withStandardRetryPolicy = null;\n+\n+  private static HelmParams voyagerHelmParams = null;\n+\n+  /**\n+   * Install operator, create a one cluster domain and install Voyager.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism\n+   */\n+  @BeforeAll\n+  public static void init(@Namespaces(3) List<String> namespaces) {\n+    // create standard, reusable retry/backoff policy\n+    withStandardRetryPolicy = with().pollDelay(2, SECONDS)\n+      .and().with().pollInterval(10, SECONDS)\n+      .atMost(5, MINUTES).await();\n+\n+    // get a unique Voyager namespace\n+    logger.info(\"Get a unique namespace for Voyager\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    String voyagerNamespace = namespaces.get(0);\n+\n+    // get a unique operator namespace\n+    logger.info(\"Get a unique namespace for operator\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    opNamespace = namespaces.get(1);\n+\n+    // get a unique domain namespace\n+    logger.info(\"Get a unique namespace for WebLogic domain\");\n+    assertNotNull(namespaces.get(2), \"Namespace list is null\");\n+    domainNamespace = namespaces.get(2);\n+\n+    final String cloudProvider = \"baremetal\";\n+    final boolean enableValidatingWebhook = false;\n+\n+    // install and verify Voyager\n+    voyagerHelmParams =\n+      installAndVerifyVoyager(voyagerNamespace, cloudProvider, enableValidatingWebhook);\n+\n+    // install and verify operator\n+    installAndVerifyOperator(opNamespace, domainNamespace);\n+\n+    // create and verify one cluster domain\n+    logger.info(\"Create domain and verify that it's running\");\n+    createAndVerifyDomain();\n+  }\n+\n+  @AfterAll\n+  void tearDown() {\n+    // uninstall Voyager\n+    if (voyagerHelmParams != null) {\n+      assertThat(uninstallVoyager(voyagerHelmParams))\n+          .as(\"Test uninstallVoyager returns true\")\n+          .withFailMessage(\"uninstallVoyager() did not return true\")\n+          .isTrue();\n+    }\n+  }\n+\n+  /**\n+   * The test invokes a webapp to verify the Voyager is installed successfully and ready to use.\n+   */\n+  @Test\n+  @DisplayName(\"Create the Voyager ingress and invoke the webapp to verify Voyager load balancer works\")\n+  @Slow\n+  @MustNotRunInParallel\n+  public void testVoyagerWorks() {\n+    String ingressName = domainUid + \"-ingress-host-routing\";\n+    String ingressServiceName = VOYAGER_CHART_NAME + \"-\" + ingressName;\n+    String channelName = \"tcp-80\";\n+\n+    try {\n+      // create Voyager ingress resource\n+      Map<String, Integer> clusterNameMsPortMap = new HashMap<>();\n+      clusterNameMsPortMap.put(clusterName, managedServerPort);\n+      List<String>  hostNames =\n+          installVoyagerIngressAndVerify(domainUid, domainNamespace, ingressName, clusterNameMsPortMap);\n+\n+      // wait 60 seconds for ingress service to be ready\n+      Thread.sleep(60 * 1000);", "originalCommit": "46c29a3bad36e96a647b8010d09b996f17597c2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxNDE3NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441914175", "bodyText": "removed", "author": "hzhao-github", "createdAt": "2020-06-18T01:12:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTY1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MzQzNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441743434", "bodyText": "test should log the exception and fail on exception", "author": "vanajamukkara", "createdAt": "2020-06-17T18:26:02Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItVoyagerSample.java", "diffHunk": "@@ -0,0 +1,298 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+//import com.google.common.primitives.Ints;\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.AdminService;\n+import oracle.weblogic.domain.Channel;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.annotations.tags.MustNotRunInParallel;\n+import oracle.weblogic.kubernetes.annotations.tags.Slow;\n+import oracle.weblogic.kubernetes.extensions.LoggedTest;\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+import org.awaitility.core.ConditionFactory;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+\n+import static java.util.concurrent.TimeUnit.MINUTES;\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.K8S_NODEPORT_HOST;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.VOYAGER_CHART_NAME;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDockerRegistrySecret;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.dockerLoginAndPushImageToRegistry;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installVoyagerIngressAndVerify;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.awaitility.Awaitility.with;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+/**\n+ * Verify that Voyager and Voyager ingress are installed successfully.\n+ */\n+@DisplayName(\"Test Voyager is installed and the Voyager ingress is created successfully\")\n+@IntegrationTest\n+class ItVoyagerSample implements LoggedTest {\n+\n+  // constants for operator and WebLogic domain\n+  private static String domainUid = \"voyager-domain-1\";\n+  private static String clusterName = \"cluster-1\";\n+  private static String adminServerPodName = domainUid + \"-admin-server\";\n+  private static String managedServerPrefix = domainUid + \"-managed-server\";\n+  private static int managedServerPort = 8001;\n+  private static int replicaCount = 2;\n+  private static String opNamespace = null;\n+  private static String domainNamespace = null;\n+  private static ConditionFactory withStandardRetryPolicy = null;\n+\n+  private static HelmParams voyagerHelmParams = null;\n+\n+  /**\n+   * Install operator, create a one cluster domain and install Voyager.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism\n+   */\n+  @BeforeAll\n+  public static void init(@Namespaces(3) List<String> namespaces) {\n+    // create standard, reusable retry/backoff policy\n+    withStandardRetryPolicy = with().pollDelay(2, SECONDS)\n+      .and().with().pollInterval(10, SECONDS)\n+      .atMost(5, MINUTES).await();\n+\n+    // get a unique Voyager namespace\n+    logger.info(\"Get a unique namespace for Voyager\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    String voyagerNamespace = namespaces.get(0);\n+\n+    // get a unique operator namespace\n+    logger.info(\"Get a unique namespace for operator\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    opNamespace = namespaces.get(1);\n+\n+    // get a unique domain namespace\n+    logger.info(\"Get a unique namespace for WebLogic domain\");\n+    assertNotNull(namespaces.get(2), \"Namespace list is null\");\n+    domainNamespace = namespaces.get(2);\n+\n+    final String cloudProvider = \"baremetal\";\n+    final boolean enableValidatingWebhook = false;\n+\n+    // install and verify Voyager\n+    voyagerHelmParams =\n+      installAndVerifyVoyager(voyagerNamespace, cloudProvider, enableValidatingWebhook);\n+\n+    // install and verify operator\n+    installAndVerifyOperator(opNamespace, domainNamespace);\n+\n+    // create and verify one cluster domain\n+    logger.info(\"Create domain and verify that it's running\");\n+    createAndVerifyDomain();\n+  }\n+\n+  @AfterAll\n+  void tearDown() {\n+    // uninstall Voyager\n+    if (voyagerHelmParams != null) {\n+      assertThat(uninstallVoyager(voyagerHelmParams))\n+          .as(\"Test uninstallVoyager returns true\")\n+          .withFailMessage(\"uninstallVoyager() did not return true\")\n+          .isTrue();\n+    }\n+  }\n+\n+  /**\n+   * The test invokes a webapp to verify the Voyager is installed successfully and ready to use.\n+   */\n+  @Test\n+  @DisplayName(\"Create the Voyager ingress and invoke the webapp to verify Voyager load balancer works\")\n+  @Slow\n+  @MustNotRunInParallel\n+  public void testVoyagerWorks() {\n+    String ingressName = domainUid + \"-ingress-host-routing\";\n+    String ingressServiceName = VOYAGER_CHART_NAME + \"-\" + ingressName;\n+    String channelName = \"tcp-80\";\n+\n+    try {\n+      // create Voyager ingress resource\n+      Map<String, Integer> clusterNameMsPortMap = new HashMap<>();\n+      clusterNameMsPortMap.put(clusterName, managedServerPort);\n+      List<String>  hostNames =\n+          installVoyagerIngressAndVerify(domainUid, domainNamespace, ingressName, clusterNameMsPortMap);\n+\n+      // wait 60 seconds for ingress service to be ready\n+      Thread.sleep(60 * 1000);\n+      logger.info(\"Getting node port for ingress service: \" + ingressServiceName);\n+\n+      // get ingress service Nodeport\n+      int ingressServiceNodePort = assertDoesNotThrow(()\n+          -> getServiceNodePort(domainNamespace, ingressServiceName, channelName),\n+              \"Getting admin server node port failed\");\n+      logger.info(\"Node port for {0} is: {1} :\", ingressServiceName, ingressServiceNodePort);\n+\n+      // invoke webapp\n+      String curlRequest = String.format(\"curl --silent --show-error --noproxy '*' \"\n+          + \"-H 'host: %s' http://%s:%s/sample-war/index.jsp\",\n+              hostNames.get(0), K8S_NODEPORT_HOST, ingressServiceNodePort);\n+      logger.info(\"Exec curl command :\" + curlRequest);\n+      ExecResult result = ExecCommand.exec(curlRequest, true);\n+      assertNotNull(result, \"curl command returns null\");\n+      logger.info(\"curl command returns: \\n{0}, \\n{1}\", result.stdout(), result.stderr());\n+      assertTrue(result.stdout().contains(\"Hello World\"), \"Failed to invoke the webapp\");\n+    } catch (Exception ex) {\n+      ex.printStackTrace();", "originalCommit": "46c29a3bad36e96a647b8010d09b996f17597c2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxNzM0NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441917345", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T01:25:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MzQzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Mjc3MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441752771", "bodyText": "I see the same code in Nginx as well for listIngresses() and slightly different for createIngress() methods. Can Ingress be pulled out as another impl class instead of duplicate code?", "author": "vanajamukkara", "createdAt": "2020-06-17T18:42:49Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/Voyager.java", "diffHunk": "@@ -0,0 +1,155 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes.actions.impl;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import io.kubernetes.client.custom.IntOrString;\n+import io.kubernetes.client.openapi.ApiException;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1HTTPIngressPath;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1HTTPIngressRuleValue;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1Ingress;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressBackend;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressList;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressRule;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressSpec;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Helm;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Kubernetes;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+\n+/**\n+ * Utility class for Voyager ingress controller.\n+ */\n+public class Voyager {\n+  /**\n+   * Install Voyager Helm chart.\n+   *\n+   * @param params the parameters to Helm install command such as release name, namespace, repo url or chart dir,\n+   *               chart name and chart values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(VoyagerParams params) {\n+    return Helm.install(params.getHelmParams(), params.getValues());\n+  }\n+\n+  /**\n+   * Upgrade Voyager Helm release.\n+   *\n+   * @param params the parameters to Helm upgrade command such as release name, namespace and chart values to override\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(VoyagerParams params) {\n+    return Helm.upgrade(params.getHelmParams(), params.getValues());\n+  }\n+\n+  /**\n+   * Uninstall Voyager Helm release.\n+   *\n+   * @param params the parameters to Helm uninstall command such as release name and namespace\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean uninstall(HelmParams params) {\n+    return Helm.uninstall(params);\n+  }\n+\n+  /**\n+   * Create an ingress for the WebLogic domain with domainUid in the specified domain namespace.\n+   * The ingress host is set to 'domainUid.clusterName.test'.\n+   *\n+   * @param ingressName name of the ingress to be created\n+   * @param domainNamespace the WebLogic domain namespace in which the ingress will be created\n+   * @param domainUid the WebLogic domainUid which is backend to the ingress\n+   * @param clusterNameMsPortMap the map with key as cluster name and value as managed server port of the cluster\n+   * @return list of ingress hosts or null if got ApiException when calling Kubernetes client API to create ingress\n+   */\n+  public static List<String> createIngress(String ingressName,\n+                                           String domainNamespace,\n+                                           String domainUid,\n+                                           Map<String, Integer> clusterNameMsPortMap) {\n+\n+    final String ingressApiVersion = \"extensions/v1beta1\";\n+    final String ingressKind = \"Ingress\";\n+    final String ingressType = \"NodePort\";\n+    final String ingressAffinity = \"cookie\";\n+    final String ingressClass = \"voyager\";\n+\n+    // set the annotations for Voyager\n+    HashMap<String, String> annotation = new HashMap<>();\n+    annotation.put(\"ingress.appscode.com/type\", ingressType);\n+    annotation.put(\"ingress.appscode.com/affinity\", ingressAffinity);\n+    annotation.put(\"kubernetes.io/ingress.class\", ingressClass);\n+\n+    List<String> ingressHostList = new ArrayList<>();\n+    ArrayList<ExtensionsV1beta1IngressRule> ingressRules = new ArrayList<>();\n+    clusterNameMsPortMap.forEach((clusterName, managedServerPort) -> {\n+      // set the http ingress paths\n+      ExtensionsV1beta1HTTPIngressPath httpIngressPath = new ExtensionsV1beta1HTTPIngressPath()\n+          .path(null)\n+          .backend(new ExtensionsV1beta1IngressBackend()\n+              .serviceName(domainUid + \"-cluster-\" + clusterName.toLowerCase().replace(\"_\", \"-\"))\n+              .servicePort(new IntOrString(managedServerPort))\n+          );\n+      ArrayList<ExtensionsV1beta1HTTPIngressPath> httpIngressPaths = new ArrayList<>();\n+      httpIngressPaths.add(httpIngressPath);\n+\n+      // set the ingress rule\n+      String ingressHost = domainUid + \".\" + clusterName + \".org\";\n+      ExtensionsV1beta1IngressRule ingressRule = new ExtensionsV1beta1IngressRule()\n+          .host(ingressHost)\n+          .http(new ExtensionsV1beta1HTTPIngressRuleValue()\n+              .paths(httpIngressPaths));\n+\n+      ingressRules.add(ingressRule);\n+      ingressHostList.add(ingressHost);\n+    });\n+\n+    // set the ingress\n+    ExtensionsV1beta1Ingress ingress = new ExtensionsV1beta1Ingress()\n+        .apiVersion(ingressApiVersion)\n+        .kind(ingressKind)\n+        .metadata(new V1ObjectMeta()\n+            .name(ingressName)\n+            .namespace(domainNamespace)\n+            .annotations(annotation))\n+        .spec(new ExtensionsV1beta1IngressSpec()\n+            .rules(ingressRules));\n+\n+    // create the ingress\n+    try {\n+      Kubernetes.createIngress(domainNamespace, ingress);\n+    } catch (ApiException apex) {\n+      logger.severe(\"got ApiException while calling createIngress: {0}\", apex.getResponseBody());\n+      return null;\n+    }\n+    return ingressHostList;\n+  }\n+\n+  /**\n+   * List all of the ingresses in the specified namespace.\n+   *\n+   * @param namespace the namespace to which the ingresses belong\n+   * @return a list of ingress names in the namespace\n+   * @throws ApiException if Kubernetes client API call fails\n+   */\n+  public static List<String> listIngresses(String namespace) throws ApiException {", "originalCommit": "46c29a3bad36e96a647b8010d09b996f17597c2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NDgwMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441774802", "bodyText": "agreed. but we need to discuss how to", "author": "hzhao-github", "createdAt": "2020-06-17T19:12:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Mjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc4MjgxNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441782816", "bodyText": "because we currently have nginx or voyager hard-coded. We need a name convention in order to share same method, IMO", "author": "hzhao-github", "createdAt": "2020-06-17T19:28:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Mjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgwODk5NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441808994", "bodyText": "listIngress should be the same no matter which ingress controller is used.", "author": "xiancao", "createdAt": "2020-06-17T20:19:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Mjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgwOTgzNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441809834", "bodyText": "Only annotations are different for each ingress controller. You can create a class Ingress which will have createIngress and listIngresses methods. createIngress takes annotations as one of the parameter. Nginx and Voyager can call Ingress class for creareIngress.", "author": "vanajamukkara", "createdAt": "2020-06-17T20:20:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Mjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgxMDc0NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441810745", "bodyText": "That's Vanaja's point - we may need to consolidate it to a class that is not named Nginx or Voyager. It may cause confusion if Voyager calls Niginx.listIngress, right?", "author": "hzhao-github", "createdAt": "2020-06-17T20:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Mjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgxNjQ2MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441816461", "bodyText": "That's what I am thinking @vanajamukkara", "author": "hzhao-github", "createdAt": "2020-06-17T20:33:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Mjc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxNDM3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441914379", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T01:13:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Mjc3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ2NDM1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r440464356", "bodyText": "Here we are not asserting voyager as the load balancer, since we are not making only a single call to webapp thru Ingress Port", "author": "anpanigr", "createdAt": "2020-06-15T21:44:25Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItVoyagerSample.java", "diffHunk": "@@ -0,0 +1,298 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+//import com.google.common.primitives.Ints;\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.AdminService;\n+import oracle.weblogic.domain.Channel;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.annotations.tags.MustNotRunInParallel;\n+import oracle.weblogic.kubernetes.annotations.tags.Slow;\n+import oracle.weblogic.kubernetes.extensions.LoggedTest;\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+import org.awaitility.core.ConditionFactory;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+\n+import static java.util.concurrent.TimeUnit.MINUTES;\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.K8S_NODEPORT_HOST;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.VOYAGER_CHART_NAME;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDockerRegistrySecret;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.dockerLoginAndPushImageToRegistry;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installVoyagerIngressAndVerify;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.awaitility.Awaitility.with;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+/**\n+ * Verify that Voyager and Voyager ingress are installed successfully.\n+ */\n+@DisplayName(\"Test Voyager is installed and the Voyager ingress is created successfully\")\n+@IntegrationTest\n+class ItVoyagerSample implements LoggedTest {\n+\n+  // constants for operator and WebLogic domain\n+  private static String domainUid = \"voyager-domain-1\";\n+  private static String clusterName = \"cluster-1\";\n+  private static String adminServerPodName = domainUid + \"-admin-server\";\n+  private static String managedServerPrefix = domainUid + \"-managed-server\";\n+  private static int managedServerPort = 8001;\n+  private static int replicaCount = 2;\n+  private static String opNamespace = null;\n+  private static String domainNamespace = null;\n+  private static ConditionFactory withStandardRetryPolicy = null;\n+\n+  private static HelmParams voyagerHelmParams = null;\n+\n+  /**\n+   * Install operator, create a one cluster domain and install Voyager.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism\n+   */\n+  @BeforeAll\n+  public static void init(@Namespaces(3) List<String> namespaces) {\n+    // create standard, reusable retry/backoff policy\n+    withStandardRetryPolicy = with().pollDelay(2, SECONDS)\n+      .and().with().pollInterval(10, SECONDS)\n+      .atMost(5, MINUTES).await();\n+\n+    // get a unique Voyager namespace\n+    logger.info(\"Get a unique namespace for Voyager\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    String voyagerNamespace = namespaces.get(0);\n+\n+    // get a unique operator namespace\n+    logger.info(\"Get a unique namespace for operator\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    opNamespace = namespaces.get(1);\n+\n+    // get a unique domain namespace\n+    logger.info(\"Get a unique namespace for WebLogic domain\");\n+    assertNotNull(namespaces.get(2), \"Namespace list is null\");\n+    domainNamespace = namespaces.get(2);\n+\n+    final String cloudProvider = \"baremetal\";\n+    final boolean enableValidatingWebhook = false;\n+\n+    // install and verify Voyager\n+    voyagerHelmParams =\n+      installAndVerifyVoyager(voyagerNamespace, cloudProvider, enableValidatingWebhook);\n+\n+    // install and verify operator\n+    installAndVerifyOperator(opNamespace, domainNamespace);\n+\n+    // create and verify one cluster domain\n+    logger.info(\"Create domain and verify that it's running\");\n+    createAndVerifyDomain();\n+  }\n+\n+  @AfterAll\n+  void tearDown() {\n+    // uninstall Voyager\n+    if (voyagerHelmParams != null) {\n+      assertThat(uninstallVoyager(voyagerHelmParams))\n+          .as(\"Test uninstallVoyager returns true\")\n+          .withFailMessage(\"uninstallVoyager() did not return true\")\n+          .isTrue();\n+    }\n+  }\n+\n+  /**\n+   * The test invokes a webapp to verify the Voyager is installed successfully and ready to use.\n+   */\n+  @Test\n+  @DisplayName(\"Create the Voyager ingress and invoke the webapp to verify Voyager load balancer works\")", "originalCommit": "694141bc639afe07bc34e97557fed6b4f172f2b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyMTc3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441921779", "bodyText": "changed to\nCreate the Voyager ingress and test Voyager load balancing with host name-based routing", "author": "hzhao-github", "createdAt": "2020-06-18T01:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ2NDM1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ2NTkxNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r440465917", "bodyText": "Add a check to see all the Services and Ingress Objects are ready to use.", "author": "anpanigr", "createdAt": "2020-06-15T21:48:01Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/Voyager.java", "diffHunk": "@@ -0,0 +1,155 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes.actions.impl;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import io.kubernetes.client.custom.IntOrString;\n+import io.kubernetes.client.openapi.ApiException;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1HTTPIngressPath;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1HTTPIngressRuleValue;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1Ingress;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressBackend;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressList;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressRule;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressSpec;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Helm;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Kubernetes;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+\n+/**\n+ * Utility class for Voyager ingress controller.\n+ */\n+public class Voyager {\n+  /**\n+   * Install Voyager Helm chart.\n+   *\n+   * @param params the parameters to Helm install command such as release name, namespace, repo url or chart dir,\n+   *               chart name and chart values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(VoyagerParams params) {\n+    return Helm.install(params.getHelmParams(), params.getValues());\n+  }\n+\n+  /**\n+   * Upgrade Voyager Helm release.\n+   *\n+   * @param params the parameters to Helm upgrade command such as release name, namespace and chart values to override\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(VoyagerParams params) {\n+    return Helm.upgrade(params.getHelmParams(), params.getValues());\n+  }\n+\n+  /**\n+   * Uninstall Voyager Helm release.\n+   *\n+   * @param params the parameters to Helm uninstall command such as release name and namespace\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean uninstall(HelmParams params) {\n+    return Helm.uninstall(params);\n+  }\n+\n+  /**\n+   * Create an ingress for the WebLogic domain with domainUid in the specified domain namespace.\n+   * The ingress host is set to 'domainUid.clusterName.test'.\n+   *\n+   * @param ingressName name of the ingress to be created\n+   * @param domainNamespace the WebLogic domain namespace in which the ingress will be created\n+   * @param domainUid the WebLogic domainUid which is backend to the ingress\n+   * @param clusterNameMsPortMap the map with key as cluster name and value as managed server port of the cluster\n+   * @return list of ingress hosts or null if got ApiException when calling Kubernetes client API to create ingress\n+   */\n+  public static List<String> createIngress(String ingressName,", "originalCommit": "694141bc639afe07bc34e97557fed6b4f172f2b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NTIxOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441775219", "bodyText": "I added more check in Sticky session test suite. Let me move it over here", "author": "hzhao-github", "createdAt": "2020-06-17T19:13:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ2NTkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyOTc4Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441929783", "bodyText": "Seems that we add the checks in CommonTestUtils.java. There are several checks there to make sure the ingress is up and ready to use. If I move all these checks to Voyager.java(now Ingress.java), it would make the class to looks to complex. Can you please check CommonTestUtils.installVoyagerIngressAndVerify for those checks, see if you like them?", "author": "hzhao-github", "createdAt": "2020-06-18T02:14:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ2NTkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEyNDM4OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441124389", "bodyText": "Can u check the readiness of the Ingress Object instated of waiting for 60s", "author": "anpanigr", "createdAt": "2020-06-16T20:32:25Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItVoyagerSample.java", "diffHunk": "@@ -0,0 +1,298 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+//import com.google.common.primitives.Ints;\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.AdminService;\n+import oracle.weblogic.domain.Channel;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.annotations.tags.MustNotRunInParallel;\n+import oracle.weblogic.kubernetes.annotations.tags.Slow;\n+import oracle.weblogic.kubernetes.extensions.LoggedTest;\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+import org.awaitility.core.ConditionFactory;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+\n+import static java.util.concurrent.TimeUnit.MINUTES;\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.K8S_NODEPORT_HOST;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.VOYAGER_CHART_NAME;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDockerRegistrySecret;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.dockerLoginAndPushImageToRegistry;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyVoyager;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installVoyagerIngressAndVerify;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.awaitility.Awaitility.with;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+/**\n+ * Verify that Voyager and Voyager ingress are installed successfully.\n+ */\n+@DisplayName(\"Test Voyager is installed and the Voyager ingress is created successfully\")\n+@IntegrationTest\n+class ItVoyagerSample implements LoggedTest {\n+\n+  // constants for operator and WebLogic domain\n+  private static String domainUid = \"voyager-domain-1\";\n+  private static String clusterName = \"cluster-1\";\n+  private static String adminServerPodName = domainUid + \"-admin-server\";\n+  private static String managedServerPrefix = domainUid + \"-managed-server\";\n+  private static int managedServerPort = 8001;\n+  private static int replicaCount = 2;\n+  private static String opNamespace = null;\n+  private static String domainNamespace = null;\n+  private static ConditionFactory withStandardRetryPolicy = null;\n+\n+  private static HelmParams voyagerHelmParams = null;\n+\n+  /**\n+   * Install operator, create a one cluster domain and install Voyager.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism\n+   */\n+  @BeforeAll\n+  public static void init(@Namespaces(3) List<String> namespaces) {\n+    // create standard, reusable retry/backoff policy\n+    withStandardRetryPolicy = with().pollDelay(2, SECONDS)\n+      .and().with().pollInterval(10, SECONDS)\n+      .atMost(5, MINUTES).await();\n+\n+    // get a unique Voyager namespace\n+    logger.info(\"Get a unique namespace for Voyager\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    String voyagerNamespace = namespaces.get(0);\n+\n+    // get a unique operator namespace\n+    logger.info(\"Get a unique namespace for operator\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    opNamespace = namespaces.get(1);\n+\n+    // get a unique domain namespace\n+    logger.info(\"Get a unique namespace for WebLogic domain\");\n+    assertNotNull(namespaces.get(2), \"Namespace list is null\");\n+    domainNamespace = namespaces.get(2);\n+\n+    final String cloudProvider = \"baremetal\";\n+    final boolean enableValidatingWebhook = false;\n+\n+    // install and verify Voyager\n+    voyagerHelmParams =\n+      installAndVerifyVoyager(voyagerNamespace, cloudProvider, enableValidatingWebhook);\n+\n+    // install and verify operator\n+    installAndVerifyOperator(opNamespace, domainNamespace);\n+\n+    // create and verify one cluster domain\n+    logger.info(\"Create domain and verify that it's running\");\n+    createAndVerifyDomain();\n+  }\n+\n+  @AfterAll\n+  void tearDown() {\n+    // uninstall Voyager\n+    if (voyagerHelmParams != null) {\n+      assertThat(uninstallVoyager(voyagerHelmParams))\n+          .as(\"Test uninstallVoyager returns true\")\n+          .withFailMessage(\"uninstallVoyager() did not return true\")\n+          .isTrue();\n+    }\n+  }\n+\n+  /**\n+   * The test invokes a webapp to verify the Voyager is installed successfully and ready to use.\n+   */\n+  @Test\n+  @DisplayName(\"Create the Voyager ingress and invoke the webapp to verify Voyager load balancer works\")\n+  @Slow\n+  @MustNotRunInParallel\n+  public void testVoyagerWorks() {\n+    String ingressName = domainUid + \"-ingress-host-routing\";\n+    String ingressServiceName = VOYAGER_CHART_NAME + \"-\" + ingressName;\n+    String channelName = \"tcp-80\";\n+\n+    try {\n+      // create Voyager ingress resource\n+      Map<String, Integer> clusterNameMsPortMap = new HashMap<>();\n+      clusterNameMsPortMap.put(clusterName, managedServerPort);\n+      List<String>  hostNames =\n+          installVoyagerIngressAndVerify(domainUid, domainNamespace, ingressName, clusterNameMsPortMap);\n+\n+      // wait 60 seconds for ingress service to be ready", "originalCommit": "46c29a3bad36e96a647b8010d09b996f17597c2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxODE0MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r441918140", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T01:28:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEyNDM4OQ=="}], "type": "inlineReview"}, {"oid": "2c0827efa43e9b32f75d54780f145b42fc895c23", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2c0827efa43e9b32f75d54780f145b42fc895c23", "message": "Changes b ased on comments jenkins-ignore", "committedDate": "2020-06-18T02:13:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2NTYyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442265621", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Utility class for Voyager ingress controller.\n          \n          \n            \n             * Utility class for Ingress Resource.", "author": "vanajamukkara", "createdAt": "2020-06-18T14:23:36Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/Ingress.java", "diffHunk": "@@ -0,0 +1,114 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes.actions.impl;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import io.kubernetes.client.custom.IntOrString;\n+import io.kubernetes.client.openapi.ApiException;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1HTTPIngressPath;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1HTTPIngressRuleValue;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1Ingress;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressBackend;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressList;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressRule;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressSpec;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Kubernetes;\n+\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.INGRESS_API_VERSION;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.INGRESS_KIND;\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+\n+/**\n+ * Utility class for Voyager ingress controller.", "originalCommit": "2c0827efa43e9b32f75d54780f145b42fc895c23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0MTQyMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442341420", "bodyText": "copy/paste error :( fixed", "author": "hzhao-github", "createdAt": "2020-06-18T16:09:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2NTYyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2NjEyNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442266125", "bodyText": "missing javadoc for annotations argument", "author": "vanajamukkara", "createdAt": "2020-06-18T14:24:16Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/Ingress.java", "diffHunk": "@@ -0,0 +1,114 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes.actions.impl;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import io.kubernetes.client.custom.IntOrString;\n+import io.kubernetes.client.openapi.ApiException;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1HTTPIngressPath;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1HTTPIngressRuleValue;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1Ingress;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressBackend;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressList;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressRule;\n+import io.kubernetes.client.openapi.models.ExtensionsV1beta1IngressSpec;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Kubernetes;\n+\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.INGRESS_API_VERSION;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.INGRESS_KIND;\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+\n+/**\n+ * Utility class for Voyager ingress controller.\n+ */\n+public class Ingress {\n+\n+  /**\n+   * Create an ingress for the WebLogic domain with domainUid in the specified domain namespace.\n+   * The ingress host is set to 'domainUid.clusterName.test'.\n+   *\n+   * @param ingressName name of the ingress to be created\n+   * @param domainNamespace the WebLogic domain namespace in which the ingress will be created\n+   * @param domainUid the WebLogic domainUid which is backend to the ingress\n+   * @param clusterNameMsPortMap the map with key as cluster name and value as managed server port of the cluster\n+   * @return list of ingress hosts or null if got ApiException when calling Kubernetes client API to create ingress\n+   */\n+  public static List<String> createIngress(String ingressName,", "originalCommit": "2c0827efa43e9b32f75d54780f145b42fc895c23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NDUyNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442344526", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T16:14:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2NjEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2NzA1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442267056", "bodyText": "update javadoc for annotations", "author": "vanajamukkara", "createdAt": "2020-06-18T14:25:24Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/TestActions.java", "diffHunk": "@@ -338,14 +319,21 @@ public static boolean uninstallVoyager(HelmParams params) {\n   }\n \n   /**\n-   * Get a list of ingresses in the specified namespace.\n+   * Create an ingress for the WebLogic domain with domainUid in the specified domain namespace.\n+   * The ingress host is set to 'domainUid.clusterName.test'.\n    *\n-   * @param namespace in which to list all the ingresses\n-   * @return list of ingress names in the specified namespace\n-   * @throws ApiException if Kubernetes client API call fails\n+   * @param ingressName the name of the ingress to be created\n+   * @param domainNamespace the WebLogic domain namespace in which to create the ingress\n+   * @param domainUid WebLogic domainUid which is backend to the ingress\n+   * @param clusterNameMsPortMap the map with key as cluster name and value as managed server port of the cluster\n+   * @return list of ingress hosts or null if got ApiException when calling Kubernetes client API to create ingress\n    */\n-  public static List<String> listIngresses(String namespace) throws ApiException {\n-    return Nginx.listIngresses(namespace);\n+  public static List<String> createIngress(String ingressName,", "originalCommit": "2c0827efa43e9b32f75d54780f145b42fc895c23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NDgwMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442344800", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T16:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2NzA1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2ODUxMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442268513", "bodyText": "update javadoc for podName", "author": "vanajamukkara", "createdAt": "2020-06-18T14:27:21Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/assertions/TestAssertions.java", "diffHunk": "@@ -67,8 +67,8 @@\n    * @param namespace in which to check if Voyager pod is running\n    * @return true if Voyager pod is running, false otherwise\n    */\n-  public static Callable<Boolean> isVoyagerRunning(String namespace) {\n-    return Voyager.isRunning(namespace);\n+  public static Callable<Boolean> isVoyagerRunning(String namespace, String podName) {", "originalCommit": "2c0827efa43e9b32f75d54780f145b42fc895c23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NzM2Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442347363", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T16:19:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2ODUxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2ODY5Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442268696", "bodyText": "update javadoc for podName", "author": "vanajamukkara", "createdAt": "2020-06-18T14:27:34Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/assertions/TestAssertions.java", "diffHunk": "@@ -77,30 +77,8 @@\n    * @param namespace in which to check if Voyager pod is in the ready state\n    * @return true if Voyager pod is in the ready state, false otherwise\n    */\n-  public static Callable<Boolean> isVoyagerReady(String namespace) {\n-    return Voyager.isReady(namespace);\n-  }\n-\n-  /**\n-   * Check if Voyager ingress pod is running in a given namespace and pod name.\n-   *\n-   * @param namespace in which to check if Voyager ingress pod is running\n-   * @param podName name of Voyager ingress pod to check\n-   * @return true if Voyager ingress pod is running, false otherwise\n-   */\n-  public static Callable<Boolean> isVoyagerIngressRunning(String namespace, String podName) {\n-    return Voyager.isIngressRunning(namespace, podName);\n-  }\n-\n-  /**\n-   * Check if Voyager ingress pod exists and running in a given namespace and pod name.\n-   *\n-   * @param namespace in which to check if Voyager ingress pod is in the ready state\n-   * @param podName name of Voyager ingress pod to check\n-   * @return true if Voyager ingress pods is in the ready state, false otherwise\n-   */\n-  public static Callable<Boolean> isVoyagerIngressReady(String namespace, String podName) {\n-    return Voyager.isIngressReady(namespace, podName);\n+  public static Callable<Boolean> isVoyagerReady(String namespace, String podName) {", "originalCommit": "2c0827efa43e9b32f75d54780f145b42fc895c23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NzY3OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442347678", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T16:19:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2ODY5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2OTE4Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442269182", "bodyText": "update javadoc for podName", "author": "vanajamukkara", "createdAt": "2020-06-18T14:28:15Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/assertions/impl/Voyager.java", "diffHunk": "@@ -16,8 +16,9 @@\n    * @param namespace in which to check if the Voyager pod is running\n    * @return true if the Voyager pod is running, false otherwise\n    */\n-  public static Callable<Boolean> isRunning(String namespace) {\n-    return () -> Kubernetes.isVoyagerPodRunning(namespace);\n+  public static Callable<Boolean> isRunning(String namespace, String podName) {", "originalCommit": "2c0827efa43e9b32f75d54780f145b42fc895c23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM2MDQ5NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442360495", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T16:40:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2OTE4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2OTMxNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442269315", "bodyText": "same as above", "author": "vanajamukkara", "createdAt": "2020-06-18T14:28:27Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/assertions/impl/Voyager.java", "diffHunk": "@@ -26,30 +27,8 @@\n    * @param namespace in which to check the Voyager pod is ready\n    * @return true if the Voyager pod is in the ready state, false otherwise\n    */\n-  public static Callable<Boolean> isReady(String namespace) {\n-    return () -> Kubernetes.isVoyagerPodReady(namespace);\n+  public static Callable<Boolean> isReady(String namespace, String podName) {", "originalCommit": "2c0827efa43e9b32f75d54780f145b42fc895c23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM2MDU3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1732#discussion_r442360579", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-06-18T16:40:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2OTMxNQ=="}], "type": "inlineReview"}, {"oid": "261d3a28c0a847aff5826d5edceaeeaf4ce89371", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/261d3a28c0a847aff5826d5edceaeeaf4ce89371", "message": "Changes based on comments jenkins-ignore", "committedDate": "2020-06-18T16:38:51Z", "type": "commit"}, {"oid": "2939bf369ad6bcabef4ed3167e2f11471d07204a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2939bf369ad6bcabef4ed3167e2f11471d07204a", "message": "Fixed ingressHost jenkins-ignore", "committedDate": "2020-06-21T21:32:40Z", "type": "commit"}]}