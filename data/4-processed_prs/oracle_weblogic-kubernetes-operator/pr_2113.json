{"pr_number": 2113, "pr_title": "Added shell scripts to create and configure OKE cluster and run integration test", "pr_createdAt": "2020-12-18T05:27:30Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113", "timeline": [{"oid": "c82d2d6e7c1ab0b4c5ea32daec330f3c219f5e54", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c82d2d6e7c1ab0b4c5ea32daec330f3c219f5e54", "message": "fixed typo", "committedDate": "2020-12-15T00:42:39Z", "type": "commit"}, {"oid": "f542832a93a4a1e00737266f07cdd7e7fe25040e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f542832a93a4a1e00737266f07cdd7e7fe25040e", "message": "fixed script", "committedDate": "2020-12-15T03:22:07Z", "type": "commit"}, {"oid": "f1c39f5dc98ed8f6253e49be0c202bf328fdd64d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f1c39f5dc98ed8f6253e49be0c202bf328fdd64d", "message": "fixed script1", "committedDate": "2020-12-15T03:29:09Z", "type": "commit"}, {"oid": "6614bd52499342c2fc145858204779c70744b16d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6614bd52499342c2fc145858204779c70744b16d", "message": "added script", "committedDate": "2020-12-16T17:24:17Z", "type": "commit"}, {"oid": "2ba687d31d211f68fcc219eeea829994d27ec69a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2ba687d31d211f68fcc219eeea829994d27ec69a", "message": "added script1", "committedDate": "2020-12-16T17:32:17Z", "type": "commit"}, {"oid": "e4c2d6d1c74b415036300b486f905614fde7eef8", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e4c2d6d1c74b415036300b486f905614fde7eef8", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into shoke", "committedDate": "2020-12-16T17:53:11Z", "type": "commit"}, {"oid": "ebba82c83e963ab810ae05569e34938e71c930f0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ebba82c83e963ab810ae05569e34938e71c930f0", "message": "corrected script", "committedDate": "2020-12-16T20:33:09Z", "type": "commit"}, {"oid": "9362b37f6f829fb064b8d8ed2223c1c0095d6d04", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9362b37f6f829fb064b8d8ed2223c1c0095d6d04", "message": "fixed grep", "committedDate": "2020-12-17T00:11:43Z", "type": "commit"}, {"oid": "a4fa17c6d049b4eaf0be63469c6ef23f289b54d7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a4fa17c6d049b4eaf0be63469c6ef23f289b54d7", "message": "fixed err", "committedDate": "2020-12-17T01:25:25Z", "type": "commit"}, {"oid": "77502a0db039356bcaf0ae2c066b8f5140dafd57", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/77502a0db039356bcaf0ae2c066b8f5140dafd57", "message": "fixed prop function", "committedDate": "2020-12-17T01:57:46Z", "type": "commit"}, {"oid": "ccf0d5f5c73eb13b8b75662092588bf78c4d2497", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ccf0d5f5c73eb13b8b75662092588bf78c4d2497", "message": "fixed typo", "committedDate": "2020-12-17T03:07:42Z", "type": "commit"}, {"oid": "c1e0f4fc052f853f4d9a438765fdf55e5fa58bf3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c1e0f4fc052f853f4d9a438765fdf55e5fa58bf3", "message": "fixed typo", "committedDate": "2020-12-17T17:32:08Z", "type": "commit"}, {"oid": "239d13f52caef8f2820a5023427181e7aeed1c44", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/239d13f52caef8f2820a5023427181e7aeed1c44", "message": "added delete cluster", "committedDate": "2020-12-17T20:34:01Z", "type": "commit"}, {"oid": "03420dba1c41947e123103561a843bb9247323c7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/03420dba1c41947e123103561a843bb9247323c7", "message": "cleanup", "committedDate": "2020-12-17T21:34:28Z", "type": "commit"}, {"oid": "c4d6fbcf5a2f784caf89f2d5fed86f8e6dbf72b4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c4d6fbcf5a2f784caf89f2d5fed86f8e6dbf72b4", "message": "added doc", "committedDate": "2020-12-17T22:00:50Z", "type": "commit"}, {"oid": "de48d1dc01ddf9a2400d2ab34de8ced54f97ed54", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/de48d1dc01ddf9a2400d2ab34de8ced54f97ed54", "message": "added doc1", "committedDate": "2020-12-17T22:58:25Z", "type": "commit"}, {"oid": "452540bfb6298d4171704941ae5326a65d6ee2a8", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/452540bfb6298d4171704941ae5326a65d6ee2a8", "message": "fixed permission", "committedDate": "2020-12-18T00:23:54Z", "type": "commit"}, {"oid": "3b1915df960112318116beb62191b01378f9285d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3b1915df960112318116beb62191b01378f9285d", "message": "fixed typo", "committedDate": "2020-12-18T01:16:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3NTgyMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545975823", "bodyText": "Can you put this to multiple lines or just leave \"#setup terraform\"?", "author": "xiancao", "createdAt": "2020-12-18T17:21:32Z", "path": "kubernetes/samples/scripts/terraform/oke.create.sh", "diffHunk": "@@ -37,12 +37,13 @@ function setupTerraform () {\n       curl -O https://releases.hashicorp.com/terraform/0.11.10/terraform_0.11.10_darwin_amd64.zip\n       unzip terraform_0.11.10_darwin_amd64.zip\n     elif [[ \"${OSTYPE}\" == \"linux\"* ]]; then\n-       curl -O https://releases.hashicorp.com/terraform/0.11.8/terraform_0.11.8_linux_amd64.zip\n-       unzip terraform_0.11.8_linux_amd64.zip\n+#setup terraform#curl -LO --retry 3 https://releases.hashicorp.com/terraform/0.11.8/terraform_0.11.8_linux_amd64.zip#unzip -o terraform_0.11.8_linux_amd64.zip -d ${WORKSPACE}/bin/#rm terraform_0.11.8_linux_amd64.zip#chmod +x ${WORKSPACE}/bin/terraform", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MDg2OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545990869", "bodyText": "removed commented out lines", "author": "marinakog", "createdAt": "2020-12-18T17:48:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3NTgyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3NjU4OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545976588", "bodyText": "add some indentation for the function body.", "author": "xiancao", "createdAt": "2020-12-18T17:23:09Z", "path": "kubernetes/samples/scripts/terraform/oke.create.sh", "diffHunk": "@@ -68,6 +69,60 @@ function createCluster () {\n     terraform apply -auto-approve -var-file=${terraformVarDir}/${clusterTFVarsFile}.tfvars\n }\n \n+function createRoleBindings () {\n+kubectl -n kube-system create serviceaccount $okeclustername-sa", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MDk5MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545990991", "bodyText": "fixed", "author": "marinakog", "createdAt": "2020-12-18T17:48:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3NjU4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3Njg0OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545976849", "bodyText": "add some indentation for the function body.", "author": "xiancao", "createdAt": "2020-12-18T17:23:35Z", "path": "kubernetes/samples/scripts/terraform/oke.create.sh", "diffHunk": "@@ -68,6 +69,60 @@ function createCluster () {\n     terraform apply -auto-approve -var-file=${terraformVarDir}/${clusterTFVarsFile}.tfvars\n }\n \n+function createRoleBindings () {\n+kubectl -n kube-system create serviceaccount $okeclustername-sa\n+kubectl create clusterrolebinding add-on-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:$okeclustername-sa\n+TOKENNAME=`kubectl -n kube-system get serviceaccount/$okeclustername-sa -o jsonpath='{.secrets[0].name}'`\n+TOKEN=`kubectl -n kube-system get secret $TOKENNAME -o jsonpath='{.data.token}'| base64 --decode`\n+kubectl config set-credentials $okeclustername-sa --token=$TOKEN\n+kubectl config set-context --current --user=$okeclustername-sa\n+}\n+\n+function checkClusterRunning () {\n+\n+echo 'Confirm we have kubectl working...'", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MTA1Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545991057", "bodyText": "fixed", "author": "marinakog", "createdAt": "2020-12-18T17:48:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3Njg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3NzgwNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545977806", "bodyText": "add some indentation for the function body.", "author": "xiancao", "createdAt": "2020-12-18T17:25:17Z", "path": "kubernetes/samples/scripts/terraform/oke.delete.sh", "diffHunk": "@@ -0,0 +1,68 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script deletes provisioned OKE Kubernetes cluster using terraform (https://www.terraform.io/)\n+#\n+#\n+\n+set -o errexit\n+set -o pipefail\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+function cleanupLB {\n+  echo 'Clean up left over LB'\n+myvcn_id=`oci network vcn list --compartment-id $compartment_ocid  --display-name=${clusterName}_vcn | jq -r '.data[] | .id'`", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MTEyNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545991124", "bodyText": "fixed", "author": "marinakog", "createdAt": "2020-12-18T17:48:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3NzgwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3ODQ2OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545978468", "bodyText": "delete this empty line", "author": "xiancao", "createdAt": "2020-12-18T17:26:25Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,194 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MTE5MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545991191", "bodyText": "fixed", "author": "marinakog", "createdAt": "2020-12-18T17:49:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3ODQ2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3OTE4Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545979182", "bodyText": "delete this empty line", "author": "xiancao", "createdAt": "2020-12-18T17:27:32Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,194 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MTI2Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545991266", "bodyText": "fixed", "author": "marinakog", "createdAt": "2020-12-18T17:49:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3OTE4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3OTQ0Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545979443", "bodyText": "delete this empty line", "author": "xiancao", "createdAt": "2020-12-18T17:28:03Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,194 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+\n+mkdir -m777 -p \"${outdir}\"\n+export RESULT_ROOT=\"${outdir}/wl_k8s_test_results\"\n+if [ -d \"${RESULT_ROOT}\" ]; then\n+  rm -Rf \"${RESULT_ROOT}/*\"\n+else\n+  mkdir -m777 \"${RESULT_ROOT}\"\n+fi\n+\n+echo \"Results will be in ${RESULT_ROOT}\"\n+\n+export PV_ROOT=\"${outdir}/k8s-pvroot\"\n+if [ -d \"${PV_ROOT}\" ]; then\n+  rm -Rf \"${PV_ROOT}/*\"\n+else\n+  mkdir -m777 \"${PV_ROOT}\"\n+fi\n+\n+echo \"Persistent volume files, if any, will be in ${PV_ROOT}\"\n+\n+echo 'Create a OKE cluster'\n+mkdir -p \"${WORKSPACE}/terraform\"\n+cp -rf ${terraform_script_dir_name}/*.tf ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/template.tfvars ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/*.sh ${WORKSPACE}/terraform/.\n+chmod 777 ${WORKSPACE}/terraform/*.sh\n+mkdir -p ${WORKSPACE}/terraform/terraforminstall\n+\n+", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MTM0Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545991342", "bodyText": "fixed", "author": "marinakog", "createdAt": "2020-12-18T17:49:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3OTQ0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk3OTc0NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545979744", "bodyText": "add some indentation here.", "author": "xiancao", "createdAt": "2020-12-18T17:28:29Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,194 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+\n+mkdir -m777 -p \"${outdir}\"\n+export RESULT_ROOT=\"${outdir}/wl_k8s_test_results\"\n+if [ -d \"${RESULT_ROOT}\" ]; then\n+  rm -Rf \"${RESULT_ROOT}/*\"\n+else\n+  mkdir -m777 \"${RESULT_ROOT}\"\n+fi\n+\n+echo \"Results will be in ${RESULT_ROOT}\"\n+\n+export PV_ROOT=\"${outdir}/k8s-pvroot\"\n+if [ -d \"${PV_ROOT}\" ]; then\n+  rm -Rf \"${PV_ROOT}/*\"\n+else\n+  mkdir -m777 \"${PV_ROOT}\"\n+fi\n+\n+echo \"Persistent volume files, if any, will be in ${PV_ROOT}\"\n+\n+echo 'Create a OKE cluster'\n+mkdir -p \"${WORKSPACE}/terraform\"\n+cp -rf ${terraform_script_dir_name}/*.tf ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/template.tfvars ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/*.sh ${WORKSPACE}/terraform/.\n+chmod 777 ${WORKSPACE}/terraform/*.sh\n+mkdir -p ${WORKSPACE}/terraform/terraforminstall\n+\n+\n+if ! sh ${WORKSPACE}/terraform/oke.create.sh ${oci_property_file} ${WORKSPACE}/terraform ; then\n+sh ${WORKSPACE}/terraform/oke.delete.sh ${oci_property_file} ${WORKSPACE}/terraform", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4MDM3NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545980375", "bodyText": "use same indentation in this section.", "author": "xiancao", "createdAt": "2020-12-18T17:29:33Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,194 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+\n+mkdir -m777 -p \"${outdir}\"\n+export RESULT_ROOT=\"${outdir}/wl_k8s_test_results\"\n+if [ -d \"${RESULT_ROOT}\" ]; then\n+  rm -Rf \"${RESULT_ROOT}/*\"\n+else\n+  mkdir -m777 \"${RESULT_ROOT}\"\n+fi\n+\n+echo \"Results will be in ${RESULT_ROOT}\"\n+\n+export PV_ROOT=\"${outdir}/k8s-pvroot\"\n+if [ -d \"${PV_ROOT}\" ]; then\n+  rm -Rf \"${PV_ROOT}/*\"\n+else\n+  mkdir -m777 \"${PV_ROOT}\"\n+fi\n+\n+echo \"Persistent volume files, if any, will be in ${PV_ROOT}\"\n+\n+echo 'Create a OKE cluster'\n+mkdir -p \"${WORKSPACE}/terraform\"\n+cp -rf ${terraform_script_dir_name}/*.tf ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/template.tfvars ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/*.sh ${WORKSPACE}/terraform/.\n+chmod 777 ${WORKSPACE}/terraform/*.sh\n+mkdir -p ${WORKSPACE}/terraform/terraforminstall\n+\n+\n+if ! sh ${WORKSPACE}/terraform/oke.create.sh ${oci_property_file} ${WORKSPACE}/terraform ; then\n+sh ${WORKSPACE}/terraform/oke.delete.sh ${oci_property_file} ${WORKSPACE}/terraform\n+fi\n+\n+clusterName=$(prop 'okeclustername')\n+\n+export KUBECONFIG=${WORKSPACE}/terraform/${clusterName}_kubeconfig\n+export PATH=${WORKSPACE}/terraform/terraforminstall:$PATH\n+\n+echo \"creating storage class to setup OFSS ...\"\n+\n+echo \"getting MountTarget ID\"\n+compartment_ocid=$(prop 'compartment.ocid')\n+mount_target_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .id'`\n+#export mount_target_id=$mount_target_id\n+mt_privateip_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .\"private-ip-ids\"[]'`\n+\n+mt_private_ip=`oci network private-ip get --private-ip-id $mt_privateip_id | jq -r '.data | .\"ip-address\"'`\n+export NFS_SERVER=$mt_private_ip\n+echo \"Using NFS Server ${NFS_SERVER}\"\n+\n+echo \"Creating Storage Class to mount OFSS\"\n+\n+cat << EOF | kubectl apply -f -\n+kind: StorageClass\n+apiVersion: storage.k8s.io/v1beta1\n+metadata:\n+  name: oci-fss\n+provisioner: oracle.com/oci-fss\n+parameters:\n+  # Insert mount target from the FSS here\n+  mntTargetId: ${mount_target_id}\n+EOF\n+\n+echo 'Set up test running ENVVARs...'\n+NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+if [ -z \"$NODE_IP\" ]; then\n+\techo \"retry get node ip \";", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MTQyMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545991423", "bodyText": "fixed", "author": "marinakog", "createdAt": "2020-12-18T17:49:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4MDM3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5ODM3Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545998372", "bodyText": "change this indentation to the same as the next line.", "author": "xiancao", "createdAt": "2020-12-18T18:02:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4MDM3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4MDgxMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545980813", "bodyText": "add indentation in this section", "author": "xiancao", "createdAt": "2020-12-18T17:30:15Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,194 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+\n+mkdir -m777 -p \"${outdir}\"\n+export RESULT_ROOT=\"${outdir}/wl_k8s_test_results\"\n+if [ -d \"${RESULT_ROOT}\" ]; then\n+  rm -Rf \"${RESULT_ROOT}/*\"\n+else\n+  mkdir -m777 \"${RESULT_ROOT}\"\n+fi\n+\n+echo \"Results will be in ${RESULT_ROOT}\"\n+\n+export PV_ROOT=\"${outdir}/k8s-pvroot\"\n+if [ -d \"${PV_ROOT}\" ]; then\n+  rm -Rf \"${PV_ROOT}/*\"\n+else\n+  mkdir -m777 \"${PV_ROOT}\"\n+fi\n+\n+echo \"Persistent volume files, if any, will be in ${PV_ROOT}\"\n+\n+echo 'Create a OKE cluster'\n+mkdir -p \"${WORKSPACE}/terraform\"\n+cp -rf ${terraform_script_dir_name}/*.tf ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/template.tfvars ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/*.sh ${WORKSPACE}/terraform/.\n+chmod 777 ${WORKSPACE}/terraform/*.sh\n+mkdir -p ${WORKSPACE}/terraform/terraforminstall\n+\n+\n+if ! sh ${WORKSPACE}/terraform/oke.create.sh ${oci_property_file} ${WORKSPACE}/terraform ; then\n+sh ${WORKSPACE}/terraform/oke.delete.sh ${oci_property_file} ${WORKSPACE}/terraform\n+fi\n+\n+clusterName=$(prop 'okeclustername')\n+\n+export KUBECONFIG=${WORKSPACE}/terraform/${clusterName}_kubeconfig\n+export PATH=${WORKSPACE}/terraform/terraforminstall:$PATH\n+\n+echo \"creating storage class to setup OFSS ...\"\n+\n+echo \"getting MountTarget ID\"\n+compartment_ocid=$(prop 'compartment.ocid')\n+mount_target_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .id'`\n+#export mount_target_id=$mount_target_id\n+mt_privateip_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .\"private-ip-ids\"[]'`\n+\n+mt_private_ip=`oci network private-ip get --private-ip-id $mt_privateip_id | jq -r '.data | .\"ip-address\"'`\n+export NFS_SERVER=$mt_private_ip\n+echo \"Using NFS Server ${NFS_SERVER}\"\n+\n+echo \"Creating Storage Class to mount OFSS\"\n+\n+cat << EOF | kubectl apply -f -\n+kind: StorageClass\n+apiVersion: storage.k8s.io/v1beta1\n+metadata:\n+  name: oci-fss\n+provisioner: oracle.com/oci-fss\n+parameters:\n+  # Insert mount target from the FSS here\n+  mntTargetId: ${mount_target_id}\n+EOF\n+\n+echo 'Set up test running ENVVARs...'\n+NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+if [ -z \"$NODE_IP\" ]; then\n+\techo \"retry get node ip \";\n+    sleep 15;\n+    NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+fi\n+\n+export K8S_NODEPORT_HOST=$NODE_IP\n+export JAVA_HOME=\"${JAVA_HOME:-`type -p java|xargs readlink -f|xargs dirname|xargs dirname`}\"\n+\n+echo 'Clean up result root...'\n+rm -rf \"${RESULT_ROOT:?}/*\"\n+\n+cd ${WORKSPACE}\n+\n+echo 'Run tests...'\n+\n+if [ \"${maven_profile_name}\" = \"oke-cert\" ]; then\n+echo \"Running mvn -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P ${maven_profile_name} verify\"", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MTQ4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545991487", "bodyText": "fixed", "author": "marinakog", "createdAt": "2020-12-18T17:49:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4MDgxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4MDk3Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545980977", "bodyText": "add indentation in this section", "author": "xiancao", "createdAt": "2020-12-18T17:30:33Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,194 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+\n+mkdir -m777 -p \"${outdir}\"\n+export RESULT_ROOT=\"${outdir}/wl_k8s_test_results\"\n+if [ -d \"${RESULT_ROOT}\" ]; then\n+  rm -Rf \"${RESULT_ROOT}/*\"\n+else\n+  mkdir -m777 \"${RESULT_ROOT}\"\n+fi\n+\n+echo \"Results will be in ${RESULT_ROOT}\"\n+\n+export PV_ROOT=\"${outdir}/k8s-pvroot\"\n+if [ -d \"${PV_ROOT}\" ]; then\n+  rm -Rf \"${PV_ROOT}/*\"\n+else\n+  mkdir -m777 \"${PV_ROOT}\"\n+fi\n+\n+echo \"Persistent volume files, if any, will be in ${PV_ROOT}\"\n+\n+echo 'Create a OKE cluster'\n+mkdir -p \"${WORKSPACE}/terraform\"\n+cp -rf ${terraform_script_dir_name}/*.tf ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/template.tfvars ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/*.sh ${WORKSPACE}/terraform/.\n+chmod 777 ${WORKSPACE}/terraform/*.sh\n+mkdir -p ${WORKSPACE}/terraform/terraforminstall\n+\n+\n+if ! sh ${WORKSPACE}/terraform/oke.create.sh ${oci_property_file} ${WORKSPACE}/terraform ; then\n+sh ${WORKSPACE}/terraform/oke.delete.sh ${oci_property_file} ${WORKSPACE}/terraform\n+fi\n+\n+clusterName=$(prop 'okeclustername')\n+\n+export KUBECONFIG=${WORKSPACE}/terraform/${clusterName}_kubeconfig\n+export PATH=${WORKSPACE}/terraform/terraforminstall:$PATH\n+\n+echo \"creating storage class to setup OFSS ...\"\n+\n+echo \"getting MountTarget ID\"\n+compartment_ocid=$(prop 'compartment.ocid')\n+mount_target_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .id'`\n+#export mount_target_id=$mount_target_id\n+mt_privateip_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .\"private-ip-ids\"[]'`\n+\n+mt_private_ip=`oci network private-ip get --private-ip-id $mt_privateip_id | jq -r '.data | .\"ip-address\"'`\n+export NFS_SERVER=$mt_private_ip\n+echo \"Using NFS Server ${NFS_SERVER}\"\n+\n+echo \"Creating Storage Class to mount OFSS\"\n+\n+cat << EOF | kubectl apply -f -\n+kind: StorageClass\n+apiVersion: storage.k8s.io/v1beta1\n+metadata:\n+  name: oci-fss\n+provisioner: oracle.com/oci-fss\n+parameters:\n+  # Insert mount target from the FSS here\n+  mntTargetId: ${mount_target_id}\n+EOF\n+\n+echo 'Set up test running ENVVARs...'\n+NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+if [ -z \"$NODE_IP\" ]; then\n+\techo \"retry get node ip \";\n+    sleep 15;\n+    NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+fi\n+\n+export K8S_NODEPORT_HOST=$NODE_IP\n+export JAVA_HOME=\"${JAVA_HOME:-`type -p java|xargs readlink -f|xargs dirname|xargs dirname`}\"\n+\n+echo 'Clean up result root...'\n+rm -rf \"${RESULT_ROOT:?}/*\"\n+\n+cd ${WORKSPACE}\n+\n+echo 'Run tests...'\n+\n+if [ \"${maven_profile_name}\" = \"oke-cert\" ]; then\n+echo \"Running mvn -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P ${maven_profile_name} verify\"\n+mvn -Dwdt.download.url=\"${wdt_download_url}\" -Dwit.download.url=\"${wit_download_url}\" -Djdk.tls.client.protocols=TLSv1.2 -pl integration-tests -P ${maven_profile_name} verify 2>&1 | tee \"${RESULT_ROOT}/oke.log\"\n+else\n+  if [ \"${parallel_run}\" = \"false\" ]; then\n+  echo \"Running mvn -Dit.test=${test_filter} -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P integration-tests verify\"", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5MTUzMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545991532", "bodyText": "fixed", "author": "marinakog", "createdAt": "2020-12-18T17:49:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4MDk3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4MTE4NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545981184", "bodyText": "delete these empty lines.", "author": "xiancao", "createdAt": "2020-12-18T17:30:58Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,194 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+\n+mkdir -m777 -p \"${outdir}\"\n+export RESULT_ROOT=\"${outdir}/wl_k8s_test_results\"\n+if [ -d \"${RESULT_ROOT}\" ]; then\n+  rm -Rf \"${RESULT_ROOT}/*\"\n+else\n+  mkdir -m777 \"${RESULT_ROOT}\"\n+fi\n+\n+echo \"Results will be in ${RESULT_ROOT}\"\n+\n+export PV_ROOT=\"${outdir}/k8s-pvroot\"\n+if [ -d \"${PV_ROOT}\" ]; then\n+  rm -Rf \"${PV_ROOT}/*\"\n+else\n+  mkdir -m777 \"${PV_ROOT}\"\n+fi\n+\n+echo \"Persistent volume files, if any, will be in ${PV_ROOT}\"\n+\n+echo 'Create a OKE cluster'\n+mkdir -p \"${WORKSPACE}/terraform\"\n+cp -rf ${terraform_script_dir_name}/*.tf ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/template.tfvars ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/*.sh ${WORKSPACE}/terraform/.\n+chmod 777 ${WORKSPACE}/terraform/*.sh\n+mkdir -p ${WORKSPACE}/terraform/terraforminstall\n+\n+\n+if ! sh ${WORKSPACE}/terraform/oke.create.sh ${oci_property_file} ${WORKSPACE}/terraform ; then\n+sh ${WORKSPACE}/terraform/oke.delete.sh ${oci_property_file} ${WORKSPACE}/terraform\n+fi\n+\n+clusterName=$(prop 'okeclustername')\n+\n+export KUBECONFIG=${WORKSPACE}/terraform/${clusterName}_kubeconfig\n+export PATH=${WORKSPACE}/terraform/terraforminstall:$PATH\n+\n+echo \"creating storage class to setup OFSS ...\"\n+\n+echo \"getting MountTarget ID\"\n+compartment_ocid=$(prop 'compartment.ocid')\n+mount_target_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .id'`\n+#export mount_target_id=$mount_target_id\n+mt_privateip_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .\"private-ip-ids\"[]'`\n+\n+mt_private_ip=`oci network private-ip get --private-ip-id $mt_privateip_id | jq -r '.data | .\"ip-address\"'`\n+export NFS_SERVER=$mt_private_ip\n+echo \"Using NFS Server ${NFS_SERVER}\"\n+\n+echo \"Creating Storage Class to mount OFSS\"\n+\n+cat << EOF | kubectl apply -f -\n+kind: StorageClass\n+apiVersion: storage.k8s.io/v1beta1\n+metadata:\n+  name: oci-fss\n+provisioner: oracle.com/oci-fss\n+parameters:\n+  # Insert mount target from the FSS here\n+  mntTargetId: ${mount_target_id}\n+EOF\n+\n+echo 'Set up test running ENVVARs...'\n+NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+if [ -z \"$NODE_IP\" ]; then\n+\techo \"retry get node ip \";\n+    sleep 15;\n+    NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+fi\n+\n+export K8S_NODEPORT_HOST=$NODE_IP\n+export JAVA_HOME=\"${JAVA_HOME:-`type -p java|xargs readlink -f|xargs dirname|xargs dirname`}\"\n+\n+echo 'Clean up result root...'\n+rm -rf \"${RESULT_ROOT:?}/*\"\n+\n+cd ${WORKSPACE}\n+\n+echo 'Run tests...'\n+\n+if [ \"${maven_profile_name}\" = \"oke-cert\" ]; then\n+echo \"Running mvn -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P ${maven_profile_name} verify\"\n+mvn -Dwdt.download.url=\"${wdt_download_url}\" -Dwit.download.url=\"${wit_download_url}\" -Djdk.tls.client.protocols=TLSv1.2 -pl integration-tests -P ${maven_profile_name} verify 2>&1 | tee \"${RESULT_ROOT}/oke.log\"\n+else\n+  if [ \"${parallel_run}\" = \"false\" ]; then\n+  echo \"Running mvn -Dit.test=${test_filter} -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P integration-tests verify\"\n+  mvn -Dit.test=\"${test_filter}, !ItExternalRmiTunneling, !ItSamples, !ItMiiSample, !ItTwoDomainsLoadBalancers, !ItMonitoringExporter, !ItPodRestart\" -Dwdt.download.url=\"${wdt_download_url}\" -Dwit.download.url=\"${wit_download_url}\" -Djdk.tls.client.protocols=TLSv1.2 -pl integration-tests -P ${maven_profile_name} verify 2>&1 | tee \"${RESULT_ROOT}/oke.log\"\n+  else\n+    echo \"Running mvn -Dit.test=${test_filter}, !ItOperatorUpgrade, !ItDedicatedMode -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -DPARALLEL_CLASSES=${parallel_run} -DNUMBER_OF_THREADS=${threads}  -pl integration-tests -P ${MVN_PROFILE} verify\"\n+     mvn -Dit.test=\"${test_filter}, !ItTwoDomainsLoadBalancers, !ItExternalRmiTunneling, !ItMiiSample, !ItSamples, !ItPodRestart\" -Dwdt.download.url=\"${wdt_download_url}\" -Dwit.download.url=\"${wit_download_url}\" -DPARALLEL_CLASSES=\"${parallel_run}\" -DNUMBER_OF_THREADS=\"2\" -Djdk.tls.client.protocols=TLSv1.2 -pl integration-tests -P ${maven_profile_name} verify 2>&1 | tee \"${RESULT_ROOT}/oke.log\"\n+  fi\n+fi\n+", "originalCommit": "3b1915df960112318116beb62191b01378f9285d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5Mjk0Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545992947", "bodyText": "done", "author": "marinakog", "createdAt": "2020-12-18T17:52:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4MTE4NA=="}], "type": "inlineReview"}, {"oid": "8f765afdf25777301712fd40f927a493b81df7a1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8f765afdf25777301712fd40f927a493b81df7a1", "message": "addressed review comments from Xian", "committedDate": "2020-12-18T17:45:55Z", "type": "commit"}, {"oid": "307f993f9e355fab642ca7eec59d12a258c056ea", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/307f993f9e355fab642ca7eec59d12a258c056ea", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into shoke", "committedDate": "2020-12-18T17:46:12Z", "type": "commit"}, {"oid": "fd1ccd8682c807fcac7c5d74ce7924a0a6a55cd9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fd1ccd8682c807fcac7c5d74ce7924a0a6a55cd9", "message": "addressed review comments from Xian1", "committedDate": "2020-12-18T17:50:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5NzM4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545997381", "bodyText": "delete this empty line", "author": "xiancao", "createdAt": "2020-12-18T18:00:25Z", "path": "kubernetes/samples/scripts/terraform/oke.create.sh", "diffHunk": "@@ -68,6 +68,60 @@ function createCluster () {\n     terraform apply -auto-approve -var-file=${terraformVarDir}/${clusterTFVarsFile}.tfvars\n }\n \n+function createRoleBindings () {\n+    kubectl -n kube-system create serviceaccount $okeclustername-sa\n+    kubectl create clusterrolebinding add-on-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:$okeclustername-sa\n+    TOKENNAME=`kubectl -n kube-system get serviceaccount/$okeclustername-sa -o jsonpath='{.secrets[0].name}'`\n+    TOKEN=`kubectl -n kube-system get secret $TOKENNAME -o jsonpath='{.data.token}'| base64 --decode`\n+    kubectl config set-credentials $okeclustername-sa --token=$TOKEN\n+    kubectl config set-context --current --user=$okeclustername-sa\n+}\n+\n+function checkClusterRunning () {\n+\n+    echo 'Confirm we have kubectl working...'\n+\n+    myline=`kubectl get nodes | awk '{print $2}'| tail -n+2`\n+    status=\"NotReady\"\n+    max=50\n+    count=1\n+\n+    privateIP=${vcn_cidr_prefix//./\\\\.}\\\\.10\\\\.\n+    myline=`kubectl get nodes -o wide | grep \"${privateIP}\" | awk '{print $2}'`\n+    NODE_IP=`kubectl get nodes -o wide| grep \"${privateIP}\" | awk '{print $7}'`\n+    echo $myline\n+    status=$myline\n+    max=100\n+    count=1\n+    while [ \"$myline\" != \"Ready\" -a $count -le $max ] ; do\n+      echo \"echo '[ERROR] Some Nodes in the Cluster are not in the Ready Status , sleep 10s more ...\"\n+      sleep 10\n+      myline=`kubectl get nodes -o wide | grep \"${privateIP}\" | awk '{print $2}'`\n+      NODE_IP=`kubectl get nodes -o wide| grep \"${privateIP}\" | awk '{print $7}'`\n+      [[ ${myline} -eq \"Ready\"  ]]\n+      echo \"Status is ${myline} Iter [$count/$max]\"\n+      count=`expr $count + 1`\n+    done\n+\n+    NODES=`kubectl get nodes -o wide | grep \"${privateIP}\" | wc -l`\n+    if [ \"$NODES\" == \"1\" ]; then\n+      echo '- looks good'\n+    else\n+      echo '- could not talk to cluster, aborting'\n+      cd ${terraformVarDir}\n+      terraform destroy -auto-approve -var-file=${terraformVarDir}/${clusterTFVarsFile}.tfvars\n+      exit 1\n+    fi\n+", "originalCommit": "fd1ccd8682c807fcac7c5d74ce7924a0a6a55cd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAwNDg5Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546004893", "bodyText": "done", "author": "marinakog", "createdAt": "2020-12-18T18:15:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5NzM4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5NzgyNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545997825", "bodyText": "delete this empty line", "author": "xiancao", "createdAt": "2020-12-18T18:01:19Z", "path": "kubernetes/samples/scripts/terraform/oke.delete.sh", "diffHunk": "@@ -0,0 +1,67 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script deletes provisioned OKE Kubernetes cluster using terraform (https://www.terraform.io/)\n+#\n+\n+set -o errexit\n+set -o pipefail\n+\n+function prop {\n+  grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+function cleanupLB {\n+  echo 'Clean up left over LB'\n+  myvcn_id=`oci network vcn list --compartment-id $compartment_ocid  --display-name=${clusterName}_vcn | jq -r '.data[] | .id'`\n+  declare -a vcnidarray\n+  vcnidarray=(${myvcn_id// /})\n+  myip=`oci lb load-balancer list --compartment-id $compartment_ocid |jq -r '.data[] | .id'`\n+  mysubnets=`oci network subnet list --vcn-id=${vcnidarray[0]} --display-name=${clusterName}-LB-${1} --compartment-id $compartment_ocid | jq -r '.data[] | .id'`\n+\n+  declare -a iparray\n+  declare -a mysubnetsidarray\n+  mysubnetsidarray=(${mysubnets// /})\n+\n+  iparray=(${myip// /})\n+  vcn_cidr_prefix=$(prop 'vcn.cidr.prefix')\n+  for k in \"${mysubnetsidarray[@]}\"\n+    do\n+      for i in \"${iparray[@]}\"\n+         do\n+            lb=`oci lb load-balancer get --load-balancer-id=$i`\n+            if [[ (-z \"${lb##*$vcn_cidr_prefix*}\") || (-z \"${lb##*$k*}\") ]] ;then\n+               echo \"deleting lb with id $i\"\n+               oci lb load-balancer delete --load-balancer-id=$i --force || true\n+            fi\n+        done\n+    done\n+", "originalCommit": "fd1ccd8682c807fcac7c5d74ce7924a0a6a55cd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAwNDg1MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546004850", "bodyText": "done", "author": "marinakog", "createdAt": "2020-12-18T18:15:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5NzgyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5NzkyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545997928", "bodyText": "delete this empty line", "author": "xiancao", "createdAt": "2020-12-18T18:01:30Z", "path": "kubernetes/samples/scripts/terraform/oke.delete.sh", "diffHunk": "@@ -0,0 +1,67 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script deletes provisioned OKE Kubernetes cluster using terraform (https://www.terraform.io/)\n+#\n+\n+set -o errexit\n+set -o pipefail\n+\n+function prop {\n+  grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+function cleanupLB {\n+  echo 'Clean up left over LB'\n+  myvcn_id=`oci network vcn list --compartment-id $compartment_ocid  --display-name=${clusterName}_vcn | jq -r '.data[] | .id'`\n+  declare -a vcnidarray\n+  vcnidarray=(${myvcn_id// /})\n+  myip=`oci lb load-balancer list --compartment-id $compartment_ocid |jq -r '.data[] | .id'`\n+  mysubnets=`oci network subnet list --vcn-id=${vcnidarray[0]} --display-name=${clusterName}-LB-${1} --compartment-id $compartment_ocid | jq -r '.data[] | .id'`\n+\n+  declare -a iparray\n+  declare -a mysubnetsidarray\n+  mysubnetsidarray=(${mysubnets// /})\n+\n+  iparray=(${myip// /})\n+  vcn_cidr_prefix=$(prop 'vcn.cidr.prefix')\n+  for k in \"${mysubnetsidarray[@]}\"\n+    do\n+      for i in \"${iparray[@]}\"\n+         do\n+            lb=`oci lb load-balancer get --load-balancer-id=$i`\n+            if [[ (-z \"${lb##*$vcn_cidr_prefix*}\") || (-z \"${lb##*$k*}\") ]] ;then\n+               echo \"deleting lb with id $i\"\n+               oci lb load-balancer delete --load-balancer-id=$i --force || true\n+            fi\n+        done\n+    done\n+\n+}\n+\n+function deleteOKE {\n+  cd ${terraform_script_dir}\n+  terraform init -var-file=${terraform_script_dir}/${clusterName}.tfvars\n+  terraform plan -var-file=${terraform_script_dir}/${clusterName}.tfvars\n+  terraform destroy -auto-approve -var-file=${terraform_script_dir}/${clusterName}.tfvars\n+}\n+\n+#MAIN\n+oci_property_file=${1:-$PWD/oci.props}\n+terraform_script_dir=${2:-$PWD}\n+\n+", "originalCommit": "fd1ccd8682c807fcac7c5d74ce7924a0a6a55cd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAwNDc5Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546004793", "bodyText": "done", "author": "marinakog", "createdAt": "2020-12-18T18:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5NzkyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5ODAwOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545998008", "bodyText": "delete this empty line", "author": "xiancao", "createdAt": "2020-12-18T18:01:41Z", "path": "kubernetes/samples/scripts/terraform/oke.delete.sh", "diffHunk": "@@ -0,0 +1,67 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script deletes provisioned OKE Kubernetes cluster using terraform (https://www.terraform.io/)\n+#\n+\n+set -o errexit\n+set -o pipefail\n+\n+function prop {\n+  grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+function cleanupLB {\n+  echo 'Clean up left over LB'\n+  myvcn_id=`oci network vcn list --compartment-id $compartment_ocid  --display-name=${clusterName}_vcn | jq -r '.data[] | .id'`\n+  declare -a vcnidarray\n+  vcnidarray=(${myvcn_id// /})\n+  myip=`oci lb load-balancer list --compartment-id $compartment_ocid |jq -r '.data[] | .id'`\n+  mysubnets=`oci network subnet list --vcn-id=${vcnidarray[0]} --display-name=${clusterName}-LB-${1} --compartment-id $compartment_ocid | jq -r '.data[] | .id'`\n+\n+  declare -a iparray\n+  declare -a mysubnetsidarray\n+  mysubnetsidarray=(${mysubnets// /})\n+\n+  iparray=(${myip// /})\n+  vcn_cidr_prefix=$(prop 'vcn.cidr.prefix')\n+  for k in \"${mysubnetsidarray[@]}\"\n+    do\n+      for i in \"${iparray[@]}\"\n+         do\n+            lb=`oci lb load-balancer get --load-balancer-id=$i`\n+            if [[ (-z \"${lb##*$vcn_cidr_prefix*}\") || (-z \"${lb##*$k*}\") ]] ;then\n+               echo \"deleting lb with id $i\"\n+               oci lb load-balancer delete --load-balancer-id=$i --force || true\n+            fi\n+        done\n+    done\n+\n+}\n+\n+function deleteOKE {\n+  cd ${terraform_script_dir}\n+  terraform init -var-file=${terraform_script_dir}/${clusterName}.tfvars\n+  terraform plan -var-file=${terraform_script_dir}/${clusterName}.tfvars\n+  terraform destroy -auto-approve -var-file=${terraform_script_dir}/${clusterName}.tfvars\n+}\n+\n+#MAIN\n+oci_property_file=${1:-$PWD/oci.props}\n+terraform_script_dir=${2:-$PWD}\n+\n+\n+clusterName=$(prop 'okeclustername')\n+compartment_ocid=$(prop 'compartment.ocid')\n+vcn_cidr_prefix=$(prop 'vcn.cidr.prefix')\n+export KUBECONFIG=${terraform_script_dir}/${clusterName}_kubeconfig\n+export PATH=${terraform_script_dir}/terraforminstall:$PATH\n+\n+", "originalCommit": "fd1ccd8682c807fcac7c5d74ce7924a0a6a55cd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAwNDc0Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546004746", "bodyText": "done", "author": "marinakog", "createdAt": "2020-12-18T18:15:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5ODAwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5ODU1Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r545998552", "bodyText": "delete this empty line.", "author": "xiancao", "createdAt": "2020-12-18T18:02:51Z", "path": "kubernetes/samples/scripts/terraform/oke.create.sh", "diffHunk": "@@ -37,12 +37,12 @@ function setupTerraform () {\n       curl -O https://releases.hashicorp.com/terraform/0.11.10/terraform_0.11.10_darwin_amd64.zip\n       unzip terraform_0.11.10_darwin_amd64.zip\n     elif [[ \"${OSTYPE}\" == \"linux\"* ]]; then\n-       curl -O https://releases.hashicorp.com/terraform/0.11.8/terraform_0.11.8_linux_amd64.zip\n-       unzip terraform_0.11.8_linux_amd64.zip\n+       curl -LO --retry 3 https://releases.hashicorp.com/terraform/0.11.8/terraform_0.11.8_linux_amd64.zip\n+       unzip -o terraform_0.11.8_linux_amd64.zip -d ${terraformDir}\n     else\n        echo \"Unsupported OS\"\n     fi\n-    chmod 777 ${terraformDir}/terraform\n+    chmod +x ${terraformDir}/terraform\n     export PATH=${terraformDir}:${PATH}\n ", "originalCommit": "fd1ccd8682c807fcac7c5d74ce7924a0a6a55cd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAwNDY1OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546004658", "bodyText": "done", "author": "marinakog", "createdAt": "2020-12-18T18:14:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5ODU1Mg=="}], "type": "inlineReview"}, {"oid": "d3a07df6c426614b17e2f68fa14fb3990d03e3ab", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d3a07df6c426614b17e2f68fa14fb3990d03e3ab", "message": "addressed review comments from Xian2", "committedDate": "2020-12-18T18:07:50Z", "type": "commit"}, {"oid": "13a473aedd9bca36d12aa76499ea8039d0cd6810", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/13a473aedd9bca36d12aa76499ea8039d0cd6810", "message": "addressed review comments from Xian3", "committedDate": "2020-12-18T18:14:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzMTQ1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546031456", "bodyText": "Can we make the number of thread as variable when we run the tests in parallel.", "author": "anpanigr", "createdAt": "2020-12-18T19:01:40Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,183 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"", "originalCommit": "13a473aedd9bca36d12aa76499ea8039d0cd6810", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0ODM3NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546048374", "bodyText": "it is optional variable, you can pass it as opt , this is just default value", "author": "marinakog", "createdAt": "2020-12-18T19:29:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzMTQ1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0OTEzNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546049134", "bodyText": "x) threads=\"${OPTARG}\"", "author": "marinakog", "createdAt": "2020-12-18T19:30:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzMTQ1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyODI3NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546028274", "bodyText": "match echo with actual mvn command", "author": "vanajamukkara", "createdAt": "2020-12-18T18:57:09Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,183 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+mkdir -m777 -p \"${outdir}\"\n+export RESULT_ROOT=\"${outdir}/wl_k8s_test_results\"\n+if [ -d \"${RESULT_ROOT}\" ]; then\n+  rm -Rf \"${RESULT_ROOT}/*\"\n+else\n+  mkdir -m777 \"${RESULT_ROOT}\"\n+fi\n+\n+echo \"Results will be in ${RESULT_ROOT}\"\n+\n+export PV_ROOT=\"${outdir}/k8s-pvroot\"\n+if [ -d \"${PV_ROOT}\" ]; then\n+  rm -Rf \"${PV_ROOT}/*\"\n+else\n+  mkdir -m777 \"${PV_ROOT}\"\n+fi\n+\n+echo \"Persistent volume files, if any, will be in ${PV_ROOT}\"\n+\n+echo 'Create a OKE cluster'\n+mkdir -p \"${WORKSPACE}/terraform\"\n+cp -rf ${terraform_script_dir_name}/*.tf ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/template.tfvars ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/*.sh ${WORKSPACE}/terraform/.\n+chmod 777 ${WORKSPACE}/terraform/*.sh\n+mkdir -p ${WORKSPACE}/terraform/terraforminstall\n+\n+if ! sh ${WORKSPACE}/terraform/oke.create.sh ${oci_property_file} ${WORKSPACE}/terraform ; then\n+  sh ${WORKSPACE}/terraform/oke.delete.sh ${oci_property_file} ${WORKSPACE}/terraform\n+fi\n+\n+clusterName=$(prop 'okeclustername')\n+\n+export KUBECONFIG=${WORKSPACE}/terraform/${clusterName}_kubeconfig\n+export PATH=${WORKSPACE}/terraform/terraforminstall:$PATH\n+\n+echo \"creating storage class to setup OFSS ...\"\n+\n+echo \"getting MountTarget ID\"\n+compartment_ocid=$(prop 'compartment.ocid')\n+mount_target_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .id'`\n+mt_privateip_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .\"private-ip-ids\"[]'`\n+mt_private_ip=`oci network private-ip get --private-ip-id $mt_privateip_id | jq -r '.data | .\"ip-address\"'`\n+\n+export NFS_SERVER=$mt_private_ip\n+echo \"Using NFS Server ${NFS_SERVER}\"\n+echo \"Creating Storage Class to mount OFSS\"\n+cat << EOF | kubectl apply -f -\n+kind: StorageClass\n+apiVersion: storage.k8s.io/v1beta1\n+metadata:\n+  name: oci-fss\n+provisioner: oracle.com/oci-fss\n+parameters:\n+  # Insert mount target from the FSS here\n+  mntTargetId: ${mount_target_id}\n+EOF\n+\n+echo 'Set up test running ENVVARs...'\n+NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+if [ -z \"$NODE_IP\" ]; then\n+\techo \"retry get node ip \";\n+  sleep 15;\n+  NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+fi\n+\n+export K8S_NODEPORT_HOST=$NODE_IP\n+export JAVA_HOME=\"${JAVA_HOME:-`type -p java|xargs readlink -f|xargs dirname|xargs dirname`}\"\n+\n+echo 'Clean up result root...'\n+rm -rf \"${RESULT_ROOT:?}/*\"\n+cd ${WORKSPACE}\n+echo 'Run tests...'\n+if [ \"${maven_profile_name}\" = \"oke-cert\" ]; then\n+  echo \"Running mvn -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P ${maven_profile_name} verify\"", "originalCommit": "13a473aedd9bca36d12aa76499ea8039d0cd6810", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA2MDc5NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546060795", "bodyText": "done", "author": "marinakog", "createdAt": "2020-12-18T19:55:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyODI3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MTE5Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546051196", "bodyText": "match with actual mvn command", "author": "vanajamukkara", "createdAt": "2020-12-18T19:35:11Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,183 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+mkdir -m777 -p \"${outdir}\"\n+export RESULT_ROOT=\"${outdir}/wl_k8s_test_results\"\n+if [ -d \"${RESULT_ROOT}\" ]; then\n+  rm -Rf \"${RESULT_ROOT}/*\"\n+else\n+  mkdir -m777 \"${RESULT_ROOT}\"\n+fi\n+\n+echo \"Results will be in ${RESULT_ROOT}\"\n+\n+export PV_ROOT=\"${outdir}/k8s-pvroot\"\n+if [ -d \"${PV_ROOT}\" ]; then\n+  rm -Rf \"${PV_ROOT}/*\"\n+else\n+  mkdir -m777 \"${PV_ROOT}\"\n+fi\n+\n+echo \"Persistent volume files, if any, will be in ${PV_ROOT}\"\n+\n+echo 'Create a OKE cluster'\n+mkdir -p \"${WORKSPACE}/terraform\"\n+cp -rf ${terraform_script_dir_name}/*.tf ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/template.tfvars ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/*.sh ${WORKSPACE}/terraform/.\n+chmod 777 ${WORKSPACE}/terraform/*.sh\n+mkdir -p ${WORKSPACE}/terraform/terraforminstall\n+\n+if ! sh ${WORKSPACE}/terraform/oke.create.sh ${oci_property_file} ${WORKSPACE}/terraform ; then\n+  sh ${WORKSPACE}/terraform/oke.delete.sh ${oci_property_file} ${WORKSPACE}/terraform\n+fi\n+\n+clusterName=$(prop 'okeclustername')\n+\n+export KUBECONFIG=${WORKSPACE}/terraform/${clusterName}_kubeconfig\n+export PATH=${WORKSPACE}/terraform/terraforminstall:$PATH\n+\n+echo \"creating storage class to setup OFSS ...\"\n+\n+echo \"getting MountTarget ID\"\n+compartment_ocid=$(prop 'compartment.ocid')\n+mount_target_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .id'`\n+mt_privateip_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .\"private-ip-ids\"[]'`\n+mt_private_ip=`oci network private-ip get --private-ip-id $mt_privateip_id | jq -r '.data | .\"ip-address\"'`\n+\n+export NFS_SERVER=$mt_private_ip\n+echo \"Using NFS Server ${NFS_SERVER}\"\n+echo \"Creating Storage Class to mount OFSS\"\n+cat << EOF | kubectl apply -f -\n+kind: StorageClass\n+apiVersion: storage.k8s.io/v1beta1\n+metadata:\n+  name: oci-fss\n+provisioner: oracle.com/oci-fss\n+parameters:\n+  # Insert mount target from the FSS here\n+  mntTargetId: ${mount_target_id}\n+EOF\n+\n+echo 'Set up test running ENVVARs...'\n+NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+if [ -z \"$NODE_IP\" ]; then\n+\techo \"retry get node ip \";\n+  sleep 15;\n+  NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+fi\n+\n+export K8S_NODEPORT_HOST=$NODE_IP\n+export JAVA_HOME=\"${JAVA_HOME:-`type -p java|xargs readlink -f|xargs dirname|xargs dirname`}\"\n+\n+echo 'Clean up result root...'\n+rm -rf \"${RESULT_ROOT:?}/*\"\n+cd ${WORKSPACE}\n+echo 'Run tests...'\n+if [ \"${maven_profile_name}\" = \"oke-cert\" ]; then\n+  echo \"Running mvn -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P ${maven_profile_name} verify\"\n+  mvn -Dwdt.download.url=\"${wdt_download_url}\" -Dwit.download.url=\"${wit_download_url}\" -Djdk.tls.client.protocols=TLSv1.2 -pl integration-tests -P ${maven_profile_name} verify 2>&1 | tee \"${RESULT_ROOT}/oke.log\"\n+else\n+  if [ \"${parallel_run}\" = \"false\" ]; then\n+    echo \"Running mvn -Dit.test=${test_filter} -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P integration-tests verify\"", "originalCommit": "13a473aedd9bca36d12aa76499ea8039d0cd6810", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA2MDY4OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546060688", "bodyText": "done", "author": "marinakog", "createdAt": "2020-12-18T19:55:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MTE5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MTIzMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546051232", "bodyText": "match with actual mvn command", "author": "vanajamukkara", "createdAt": "2020-12-18T19:35:16Z", "path": "oketest.sh", "diffHunk": "@@ -0,0 +1,183 @@\n+#!/bin/bash\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# This script provisions a OKE Kubernetes cluster using terraform (https://www.terraform.io/) and runs the new\n+# integration test suite against that cluster. Blog https://blogs.oracle.com/weblogicserver/easily-create-an-oci-container-engine-for-kubernetes-cluster-with-terraform-installer-to-run-weblogic-server\n+# provides detailed explanation for OCI properties file creation.\n+#\n+#\n+# As of May 6, 2020, the tests are clean on Kubernetes 1.16 with the following JDK workarounds:\n+# 1. Maven must be run with OpenJDK 11.0.7, available here: https://github.com/AdoptOpenJDK/openjdk11-upstream-binaries/releases/download/jdk-11.0.7%2B10/OpenJDK11U-jdk_x64_linux_11.0.7_10.tar.gz\n+#    This is because of a critical bug fix. Unfortunately, the Oracle JDK 11.0.7 release was based on an earlier build and doesn't have the fix.\n+# 2. The WebLogic Image Tool will not accept an OpenJDK JDK. Set WIT_JAVA_HOME to an Oracle JDK Java Home.\n+#    For example, \"export WIT_JAVA_HOME=/usr/java/jdk-11.0.7\" before running this script.\n+#\n+set -o errexit\n+set -o pipefail\n+\n+script=\"${BASH_SOURCE[0]}\"\n+scriptDir=\"$( cd \"$( dirname \"${script}\" )\" && pwd )\"\n+\n+function usage {\n+  echo \"usage: ${script} [-n <terraform config files directory>] [-o <directory>] [-t <tests>] [-c <name>] [-p true|false] [-x <number_of_threads>] [-d <wdt_download_url>] [-i <wit_download_url>] [-m <maven_profile_name>] [-h]\"\n+  echo \"  -n Terraform config files directory \"\n+  echo \"  -o Output directory (optional) \"\n+  echo \"      (default: \\${WORKSPACE}/logdir/\\${BUILD_TAG}, if \\${WORKSPACE} defined, else /scratch/\\${USER}/kindtest) \"\n+  echo \"  -b  Availability Domain Name \"\n+  echo \"      (for example: VPGL:PHX-AD-1 , check limits quota with OCI admin)\"\n+  echo \"  -t Test filter (optional) \"\n+  echo \"      (default: **/It*) \"\n+  echo \"  -s Oracle Cloud Infra properties file  \"\n+  echo \"  -p Run It classes in parallel\"\n+  echo \"      (default: false) \"\n+  echo \"  -x Number of threads to run the classes in parallel\"\n+  echo \"      (default: 2) \"\n+  echo \"  -d WDT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-deploy-tooling/releases/latest) \"\n+  echo \"  -i WIT download URL\"\n+  echo \"      (default: https://github.com/oracle/weblogic-image-tool/releases/latest) \"\n+  echo \"  -m Run integration-tests or oke-cert \"\n+  echo \"      (default: integration-tests, supported values: oke-cert) \"\n+  echo \"  -h Help\"\n+  exit $1\n+}\n+\n+function prop {\n+    grep \"${1}\" ${oci_property_file}| grep -v \"#\" | cut -d'=' -f2\n+}\n+\n+if [[ -z \"${WORKSPACE}\" ]]; then\n+  outdir=\"/scratch/${USER}/oketest\"\n+  export WORKSPACE=${PWD}\n+else\n+  outdir=\"${WORKSPACE}/logdir/${BUILD_TAG}\"\n+fi\n+test_filter=\"**/It*\"\n+parallel_run=\"false\"\n+threads=\"2\"\n+wdt_download_url=\"https://github.com/oracle/weblogic-deploy-tooling/releases/latest\"\n+wit_download_url=\"https://github.com/oracle/weblogic-image-tool/releases/latest\"\n+maven_profile_name=\"integration-tests\"\n+\n+while getopts \":h:n:o:t:x:s:p:d:i:m:b:\" opt; do\n+  case $opt in\n+    n) terraform_script_dir_name=\"${OPTARG}\"\n+    ;;\n+    s) oci_property_file=\"${OPTARG}\"\n+    ;;\n+    b) availability_domain=\"${OPTARG}\"\n+    ;;\n+    o) outdir=\"${OPTARG}\"\n+    ;;\n+    t) test_filter=\"${OPTARG}\"\n+    ;;\n+    x) threads=\"${OPTARG}\"\n+    ;;\n+    p) parallel_run=\"${OPTARG}\"\n+    ;;\n+    d) wdt_download_url=\"${OPTARG}\"\n+    ;;\n+    i) wit_download_url=\"${OPTARG}\"\n+    ;;\n+    m) maven_profile_name=\"${OPTARG}\"\n+    ;;\n+    h) usage 0\n+    ;;\n+    d) echo \"Ignoring -d=${OPTARG}\"\n+    ;;\n+    i) echo \"Ignoring -i=${OPTARG}\"\n+    ;;\n+    *) usage 1\n+    ;;\n+  esac\n+done\n+\n+k8s_version=$(prop 'k8s.version')\n+echo \"Using Kubernetes version: ${k8s_version}\"\n+\n+mkdir -m777 -p \"${outdir}\"\n+export RESULT_ROOT=\"${outdir}/wl_k8s_test_results\"\n+if [ -d \"${RESULT_ROOT}\" ]; then\n+  rm -Rf \"${RESULT_ROOT}/*\"\n+else\n+  mkdir -m777 \"${RESULT_ROOT}\"\n+fi\n+\n+echo \"Results will be in ${RESULT_ROOT}\"\n+\n+export PV_ROOT=\"${outdir}/k8s-pvroot\"\n+if [ -d \"${PV_ROOT}\" ]; then\n+  rm -Rf \"${PV_ROOT}/*\"\n+else\n+  mkdir -m777 \"${PV_ROOT}\"\n+fi\n+\n+echo \"Persistent volume files, if any, will be in ${PV_ROOT}\"\n+\n+echo 'Create a OKE cluster'\n+mkdir -p \"${WORKSPACE}/terraform\"\n+cp -rf ${terraform_script_dir_name}/*.tf ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/template.tfvars ${WORKSPACE}/terraform/.\n+cp -rf ${WORKSPACE}/kubernetes/samples/scripts/terraform/*.sh ${WORKSPACE}/terraform/.\n+chmod 777 ${WORKSPACE}/terraform/*.sh\n+mkdir -p ${WORKSPACE}/terraform/terraforminstall\n+\n+if ! sh ${WORKSPACE}/terraform/oke.create.sh ${oci_property_file} ${WORKSPACE}/terraform ; then\n+  sh ${WORKSPACE}/terraform/oke.delete.sh ${oci_property_file} ${WORKSPACE}/terraform\n+fi\n+\n+clusterName=$(prop 'okeclustername')\n+\n+export KUBECONFIG=${WORKSPACE}/terraform/${clusterName}_kubeconfig\n+export PATH=${WORKSPACE}/terraform/terraforminstall:$PATH\n+\n+echo \"creating storage class to setup OFSS ...\"\n+\n+echo \"getting MountTarget ID\"\n+compartment_ocid=$(prop 'compartment.ocid')\n+mount_target_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .id'`\n+mt_privateip_id=`oci fs mount-target  list --compartment-id=$compartment_ocid  --display-name=${clusterName}-mt --availability-domain=${availability_domain} | jq -r '.data[] | .\"private-ip-ids\"[]'`\n+mt_private_ip=`oci network private-ip get --private-ip-id $mt_privateip_id | jq -r '.data | .\"ip-address\"'`\n+\n+export NFS_SERVER=$mt_private_ip\n+echo \"Using NFS Server ${NFS_SERVER}\"\n+echo \"Creating Storage Class to mount OFSS\"\n+cat << EOF | kubectl apply -f -\n+kind: StorageClass\n+apiVersion: storage.k8s.io/v1beta1\n+metadata:\n+  name: oci-fss\n+provisioner: oracle.com/oci-fss\n+parameters:\n+  # Insert mount target from the FSS here\n+  mntTargetId: ${mount_target_id}\n+EOF\n+\n+echo 'Set up test running ENVVARs...'\n+NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+if [ -z \"$NODE_IP\" ]; then\n+\techo \"retry get node ip \";\n+  sleep 15;\n+  NODE_IP=`kubectl get nodes -o wide| awk '{print $7}'| tail -n+3`\n+fi\n+\n+export K8S_NODEPORT_HOST=$NODE_IP\n+export JAVA_HOME=\"${JAVA_HOME:-`type -p java|xargs readlink -f|xargs dirname|xargs dirname`}\"\n+\n+echo 'Clean up result root...'\n+rm -rf \"${RESULT_ROOT:?}/*\"\n+cd ${WORKSPACE}\n+echo 'Run tests...'\n+if [ \"${maven_profile_name}\" = \"oke-cert\" ]; then\n+  echo \"Running mvn -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P ${maven_profile_name} verify\"\n+  mvn -Dwdt.download.url=\"${wdt_download_url}\" -Dwit.download.url=\"${wit_download_url}\" -Djdk.tls.client.protocols=TLSv1.2 -pl integration-tests -P ${maven_profile_name} verify 2>&1 | tee \"${RESULT_ROOT}/oke.log\"\n+else\n+  if [ \"${parallel_run}\" = \"false\" ]; then\n+    echo \"Running mvn -Dit.test=${test_filter} -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -pl integration-tests -P integration-tests verify\"\n+    mvn -Dit.test=\"${test_filter}, !ItExternalRmiTunneling, !ItSamples, !ItMiiSample, !ItTwoDomainsLoadBalancers, !ItMonitoringExporter, !ItPodRestart\" -Dwdt.download.url=\"${wdt_download_url}\" -Dwit.download.url=\"${wit_download_url}\" -Djdk.tls.client.protocols=TLSv1.2 -pl integration-tests -P ${maven_profile_name} verify 2>&1 | tee \"${RESULT_ROOT}/oke.log\"\n+  else\n+    echo \"Running mvn -Dit.test=${test_filter}, !ItOperatorUpgrade, !ItDedicatedMode -Dwdt.download.url=${wdt_download_url} -Dwit.download.url=${wit_download_url} -DPARALLEL_CLASSES=${parallel_run} -DNUMBER_OF_THREADS=${threads}  -pl integration-tests -P ${MVN_PROFILE} verify\"", "originalCommit": "13a473aedd9bca36d12aa76499ea8039d0cd6810", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA2MDcyNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2113#discussion_r546060727", "bodyText": "done", "author": "marinakog", "createdAt": "2020-12-18T19:55:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MTIzMg=="}], "type": "inlineReview"}, {"oid": "e17e631cd99804452367c27e2ba8ac267e683ec3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e17e631cd99804452367c27e2ba8ac267e683ec3", "message": "matched echo with command", "committedDate": "2020-12-18T19:54:39Z", "type": "commit"}]}