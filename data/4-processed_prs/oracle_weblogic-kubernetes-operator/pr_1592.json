{"pr_number": 1592, "pr_title": "Check fileext wdt", "pr_createdAt": "2020-04-24T15:43:27Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592", "timeline": [{"oid": "56c2855e536262c88e11c8667429fc8abb908436", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/56c2855e536262c88e11c8667429fc8abb908436", "message": "add check for wdt version and file extensions in model directories", "committedDate": "2020-04-23T02:23:03Z", "type": "commit"}, {"oid": "641d907871f4f3efb921fabc2875fbf85d455b85", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/641d907871f4f3efb921fabc2875fbf85d455b85", "message": "fix script errors", "committedDate": "2020-04-23T16:00:58Z", "type": "commit"}, {"oid": "b95e00018c671906be2c1f09e9cdbf26b2def2c2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b95e00018c671906be2c1f09e9cdbf26b2def2c2", "message": "fix script error", "committedDate": "2020-04-23T16:33:14Z", "type": "commit"}, {"oid": "a7608f0a6fca37bce9c39804e6fd49f8417d5464", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a7608f0a6fca37bce9c39804e6fd49f8417d5464", "message": "update error wordings", "committedDate": "2020-04-23T17:14:42Z", "type": "commit"}, {"oid": "107be1f9f5037ea0adef2868f1977fb9994b2eae", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/107be1f9f5037ea0adef2868f1977fb9994b2eae", "message": "fix wordings", "committedDate": "2020-04-24T14:11:38Z", "type": "commit"}, {"oid": "f22b9b852d6cbbe5a08c7e2041a9bd71253e4091", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f22b9b852d6cbbe5a08c7e2041a9bd71253e4091", "message": "update check extension for wdt configmap", "committedDate": "2020-04-24T15:34:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY3OTQ4OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414679489", "bodyText": "extension -> extensions", "author": "tbarnes-us", "createdAt": "2020-04-24T15:48:59Z", "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -384,6 +387,55 @@ function checkDirNotExistsOrEmpty() {\n   trace \"Exiting checkDirNotExistsOrEmpty\"\n }\n \n+# limit the file extensions in the model directories\n+\n+function checkModelDirectoryExtensions() {\n+  trace \"Entering checkModelDirectoryExtensions\"\n+\n+  cd ${IMG_MODELS_HOME}\n+  counter=$(ls  -I  *.yaml -I *.zip -I *.properties | wc -l)\n+  if [ $counter -ne 0 ] ; then\n+        trace SEVERE \"Directory ${IMG_MODELS_HOME} contains files with unsupported extension. Extension must be\" \\", "originalCommit": "f22b9b852d6cbbe5a08c7e2041a9bd71253e4091", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4MDk1Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414680953", "bodyText": "Extension must be -> Expected extensions", "author": "tbarnes-us", "createdAt": "2020-04-24T15:51:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY3OTQ4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4MjE1Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414882153", "bodyText": "done", "author": "jshum2479", "createdAt": "2020-04-24T21:47:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY3OTQ4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4MTQwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414681401", "bodyText": "How about:\n\"Model files with unsupported extensions: '$(ls -I  *.yaml -I *.zip -I *.properties)'\"", "author": "tbarnes-us", "createdAt": "2020-04-24T15:51:45Z", "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -384,6 +387,55 @@ function checkDirNotExistsOrEmpty() {\n   trace \"Exiting checkDirNotExistsOrEmpty\"\n }\n \n+# limit the file extensions in the model directories\n+\n+function checkModelDirectoryExtensions() {\n+  trace \"Entering checkModelDirectoryExtensions\"\n+\n+  cd ${IMG_MODELS_HOME}\n+  counter=$(ls  -I  *.yaml -I *.zip -I *.properties | wc -l)\n+  if [ $counter -ne 0 ] ; then\n+        trace SEVERE \"Directory ${IMG_MODELS_HOME} contains files with unsupported extension. Extension must be\" \\\n+          \".yaml, .properties, or .zip\"\n+        trace SEVERE $(ls -I  *.yaml -I *.zip -I *.properties)", "originalCommit": "f22b9b852d6cbbe5a08c7e2041a9bd71253e4091", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4MjIyMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414882222", "bodyText": "done", "author": "jshum2479", "createdAt": "2020-04-24T21:47:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4MTQwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4MjIwNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414682206", "bodyText": "extension -> extensions\nExtension must be -> Expected extensions", "author": "tbarnes-us", "createdAt": "2020-04-24T15:52:51Z", "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -384,6 +387,55 @@ function checkDirNotExistsOrEmpty() {\n   trace \"Exiting checkDirNotExistsOrEmpty\"\n }\n \n+# limit the file extensions in the model directories\n+\n+function checkModelDirectoryExtensions() {\n+  trace \"Entering checkModelDirectoryExtensions\"\n+\n+  cd ${IMG_MODELS_HOME}\n+  counter=$(ls  -I  *.yaml -I *.zip -I *.properties | wc -l)\n+  if [ $counter -ne 0 ] ; then\n+        trace SEVERE \"Directory ${IMG_MODELS_HOME} contains files with unsupported extension. Extension must be\" \\\n+          \".yaml, .properties, or .zip\"\n+        trace SEVERE $(ls -I  *.yaml -I *.zip -I *.properties)\n+        exitOrLoop\n+  fi\n+  if [ -d ${WDT_CONFIGMAP_ROOT} ] ; then\n+    cd ${WDT_CONFIGMAP_ROOT}\n+    counter=$(ls  -I  *.yaml -I *.properties | wc -l)\n+    if [ $counter -ne 0 ] ; then\n+          trace SEVERE \"Directory ${WDT_CONFIGMAP_ROOT} contains files with unsupported extension. Extension must be\" \\", "originalCommit": "f22b9b852d6cbbe5a08c7e2041a9bd71253e4091", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4NzYzMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414687631", "bodyText": "Directory > Model configmap directory", "author": "tbarnes-us", "createdAt": "2020-04-24T16:00:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4MjIwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4MjMwMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414882302", "bodyText": "done", "author": "jshum2479", "createdAt": "2020-04-24T21:47:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4MjIwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4NTQwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414685401", "bodyText": "Just in case the version format changes, or there's some other bug, please provide an environment variable to bypass the check, and also print an informative message if the bypass is in effect.\nAnd add to each trace above.  \". To bypass this check, set environment variable 'WDT_BYPASS_WDT_VERSION_CHECK' to 'true'.\"", "author": "tbarnes-us", "createdAt": "2020-04-24T15:57:26Z", "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -384,6 +387,55 @@ function checkDirNotExistsOrEmpty() {\n   trace \"Exiting checkDirNotExistsOrEmpty\"\n }\n \n+# limit the file extensions in the model directories\n+\n+function checkModelDirectoryExtensions() {\n+  trace \"Entering checkModelDirectoryExtensions\"\n+\n+  cd ${IMG_MODELS_HOME}\n+  counter=$(ls  -I  *.yaml -I *.zip -I *.properties | wc -l)\n+  if [ $counter -ne 0 ] ; then\n+        trace SEVERE \"Directory ${IMG_MODELS_HOME} contains files with unsupported extension. Extension must be\" \\\n+          \".yaml, .properties, or .zip\"\n+        trace SEVERE $(ls -I  *.yaml -I *.zip -I *.properties)\n+        exitOrLoop\n+  fi\n+  if [ -d ${WDT_CONFIGMAP_ROOT} ] ; then\n+    cd ${WDT_CONFIGMAP_ROOT}\n+    counter=$(ls  -I  *.yaml -I *.properties | wc -l)\n+    if [ $counter -ne 0 ] ; then\n+          trace SEVERE \"Directory ${WDT_CONFIGMAP_ROOT} contains files with unsupported extension. Extension must be\" \\\n+            \".yaml or .properties\"\n+          trace SEVERE $(ls -I  *.yaml -I *.properties)\n+          exitOrLoop\n+    fi\n+  fi\n+\n+  trace \"Exiting checkModelDirectoryExtensions\"\n+}\n+\n+# Check for WDT version\n+\n+function checkWDTVersion() {\n+  trace \"Entering checkWDTVersion\"\n+  unzip -c ${WDT_ROOT}/lib/weblogic-deploy-core.jar META-INF/MANIFEST.MF > /tmp/wdtversion.txt || exitOrLoop\n+  local wdt_version=\"$(grep \"Implementation-Version\" /tmp/wdtversion.txt | cut -f2 -d' ' | tr -d '\\r' )\" || exitOrLoop\n+  if  [ ! -z ${wdt_version} ]; then\n+    versionGE ${wdt_version} ${WDT_MINIMUM_VERSION}\n+    if [ $? != \"0\" ] ; then\n+      trace SEVERE \"Model in Image domain requires Weblogic Deploy Tool minimum version ${WDT_MINIMUM_VERSION}. \" \\\n+      \"The version in the image is ${wdt_version}, you need to update the Weblogic Deploy Tool version in the image.\"\n+      exitOrLoop\n+    fi\n+  else\n+    trace SEVERE \"Unknown Weblogic Deploy Tool version. Model in Image domain requires Weblogic Deploy Tool \" \\\n+      \"minimum version ${WDT_MINIMUM_VERSION}\"\n+    exitOrLoop\n+  fi", "originalCommit": "f22b9b852d6cbbe5a08c7e2041a9bd71253e4091", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4MjM1NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414882354", "bodyText": "done", "author": "jshum2479", "createdAt": "2020-04-24T21:47:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4NTQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY0OTg2MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r418649860", "bodyText": "I don't see the text I requested in the SEVERE.", "author": "tbarnes-us", "createdAt": "2020-05-01T17:36:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4NTQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2OTE0Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r418669143", "bodyText": "done", "author": "jshum2479", "createdAt": "2020-05-01T18:18:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4NTQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3Mjg1Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r418672853", "bodyText": "thanks", "author": "tbarnes-us", "createdAt": "2020-05-01T18:26:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4NTQwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4ODE1MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414688150", "bodyText": "How about:\ntrace SEVERE \"Model configmap directory files with unsupported extensions: '$(ls -I  *.yaml -I *.properties)'.\"", "author": "tbarnes-us", "createdAt": "2020-04-24T16:01:16Z", "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -384,6 +387,55 @@ function checkDirNotExistsOrEmpty() {\n   trace \"Exiting checkDirNotExistsOrEmpty\"\n }\n \n+# limit the file extensions in the model directories\n+\n+function checkModelDirectoryExtensions() {\n+  trace \"Entering checkModelDirectoryExtensions\"\n+\n+  cd ${IMG_MODELS_HOME}\n+  counter=$(ls  -I  *.yaml -I *.zip -I *.properties | wc -l)\n+  if [ $counter -ne 0 ] ; then\n+        trace SEVERE \"Directory ${IMG_MODELS_HOME} contains files with unsupported extension. Extension must be\" \\\n+          \".yaml, .properties, or .zip\"\n+        trace SEVERE $(ls -I  *.yaml -I *.zip -I *.properties)\n+        exitOrLoop\n+  fi\n+  if [ -d ${WDT_CONFIGMAP_ROOT} ] ; then\n+    cd ${WDT_CONFIGMAP_ROOT}\n+    counter=$(ls  -I  *.yaml -I *.properties | wc -l)\n+    if [ $counter -ne 0 ] ; then\n+          trace SEVERE \"Directory ${WDT_CONFIGMAP_ROOT} contains files with unsupported extension. Extension must be\" \\\n+            \".yaml or .properties\"\n+          trace SEVERE $(ls -I  *.yaml -I *.properties)", "originalCommit": "f22b9b852d6cbbe5a08c7e2041a9bd71253e4091", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4MjQ1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414882456", "bodyText": "done", "author": "jshum2479", "createdAt": "2020-04-24T21:47:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY4ODE1MA=="}], "type": "inlineReview"}, {"oid": "44150a03c9fa08daa511a97307a8a4a66b2cd53b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/44150a03c9fa08daa511a97307a8a4a66b2cd53b", "message": "PR fixes", "committedDate": "2020-04-24T16:20:42Z", "type": "commit"}, {"oid": "4210a04851127079d4938701d90ea5c4c6bf6882", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4210a04851127079d4938701d90ea5c4c6bf6882", "message": "add bypass option for wdt version check", "committedDate": "2020-04-24T16:36:33Z", "type": "commit"}, {"oid": "2407215c5e0ecc701365caecde3e9acbf92b370a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2407215c5e0ecc701365caecde3e9acbf92b370a", "message": "update script for checkDirectoryExtension", "committedDate": "2020-04-24T18:59:57Z", "type": "commit"}, {"oid": "1f9f944b67d4772ce698e578b19c304fc0615ab6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1f9f944b67d4772ce698e578b19c304fc0615ab6", "message": "update wordings", "committedDate": "2020-04-24T19:17:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODkyNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414818925", "bodyText": "spelling", "author": "markxnelson", "createdAt": "2020-04-24T19:41:21Z", "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -384,6 +389,57 @@ function checkDirNotExistsOrEmpty() {\n   trace \"Exiting checkDirNotExistsOrEmpty\"\n }\n \n+# limit the file extensions in the model directories\n+\n+function checkModelDirectoryExtensions() {\n+  trace \"Entering checkModelDirectoryExtensions\"\n+\n+  cd ${IMG_MODELS_HOME}\n+  counter=$(ls  -I  \"*.yaml\" -I \"*.zip\" -I \"*.properties\" | wc -l)\n+  if [ $counter -ne 0 ] ; then\n+    trace SEVERE \"Model image directory ${IMG_MODELS_HOME} contains files with unsupported extensions. \" \\\n+      \"Expected extensions: .yaml, .properties, or .zip\"\n+    trace SEVERE \"Model image directory files with unsupported extensions: \" \\\n+      \"'$(ls -I \"*.yaml\" -I \"*.zip\" -I \"*.properties\")'\"\n+    exitOrLoop\n+  fi\n+  if [ -d ${WDT_CONFIGMAP_ROOT} ] ; then\n+    cd ${WDT_CONFIGMAP_ROOT}\n+    counter=$(ls  -I  \"*.yaml\" -I \"*.properties\" | wc -l)\n+    if [ $counter -ne 0 ] ; then\n+      trace SEVERE \"Model configmap directory ${WDT_CONFIGMAP_ROOT} contains files with unsupported extensions. \" \\\n+      \"Expected extensions: .yaml or .properties\"\n+      trace SEVERE \"Model configmap directory files with unsupported extensions: \" \\\n+        \"'$(ls -I \"*.yaml\" -I \"*.properties\")'\"\n+      exitOrLoop\n+    fi\n+  fi\n+\n+  trace \"Exiting checkModelDirectoryExtensions\"\n+}\n+\n+# Check for WDT version\n+\n+function checkWDTVersion() {\n+  trace \"Entering checkWDTVersion\"\n+  unzip -c ${WDT_ROOT}/lib/weblogic-deploy-core.jar META-INF/MANIFEST.MF > /tmp/wdtversion.txt || exitOrLoop\n+  local wdt_version=\"$(grep \"Implementation-Version\" /tmp/wdtversion.txt | cut -f2 -d' ' | tr -d '\\r' )\" || exitOrLoop\n+  if  [ ! -z ${wdt_version} ]; then\n+    versionGE ${wdt_version} ${WDT_MINIMUM_VERSION}\n+    if [ $? != \"0\" ] ; then\n+      trace SEVERE \"Model in Image domain requires Weblogic Deploy Tool minimum version ${WDT_MINIMUM_VERSION}. \" \\\n+      \"The version in the image is ${wdt_version}, you need to update the Weblogic Deploy Tool version in the image.\"\n+      exitOrLoop\n+    fi\n+  else\n+    trace SEVERE \"Unknown Weblogic Deploy Tool version. Model in Image domain requires Weblogic Deploy Tool \" \\", "originalCommit": "1f9f944b67d4772ce698e578b19c304fc0615ab6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4MjgxOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414882818", "bodyText": "rephrased the sentence", "author": "jshum2479", "createdAt": "2020-04-24T21:48:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODkyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODk4Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414818982", "bodyText": "spelling", "author": "markxnelson", "createdAt": "2020-04-24T19:41:27Z", "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -384,6 +389,57 @@ function checkDirNotExistsOrEmpty() {\n   trace \"Exiting checkDirNotExistsOrEmpty\"\n }\n \n+# limit the file extensions in the model directories\n+\n+function checkModelDirectoryExtensions() {\n+  trace \"Entering checkModelDirectoryExtensions\"\n+\n+  cd ${IMG_MODELS_HOME}\n+  counter=$(ls  -I  \"*.yaml\" -I \"*.zip\" -I \"*.properties\" | wc -l)\n+  if [ $counter -ne 0 ] ; then\n+    trace SEVERE \"Model image directory ${IMG_MODELS_HOME} contains files with unsupported extensions. \" \\\n+      \"Expected extensions: .yaml, .properties, or .zip\"\n+    trace SEVERE \"Model image directory files with unsupported extensions: \" \\\n+      \"'$(ls -I \"*.yaml\" -I \"*.zip\" -I \"*.properties\")'\"\n+    exitOrLoop\n+  fi\n+  if [ -d ${WDT_CONFIGMAP_ROOT} ] ; then\n+    cd ${WDT_CONFIGMAP_ROOT}\n+    counter=$(ls  -I  \"*.yaml\" -I \"*.properties\" | wc -l)\n+    if [ $counter -ne 0 ] ; then\n+      trace SEVERE \"Model configmap directory ${WDT_CONFIGMAP_ROOT} contains files with unsupported extensions. \" \\\n+      \"Expected extensions: .yaml or .properties\"\n+      trace SEVERE \"Model configmap directory files with unsupported extensions: \" \\\n+        \"'$(ls -I \"*.yaml\" -I \"*.properties\")'\"\n+      exitOrLoop\n+    fi\n+  fi\n+\n+  trace \"Exiting checkModelDirectoryExtensions\"\n+}\n+\n+# Check for WDT version\n+\n+function checkWDTVersion() {\n+  trace \"Entering checkWDTVersion\"\n+  unzip -c ${WDT_ROOT}/lib/weblogic-deploy-core.jar META-INF/MANIFEST.MF > /tmp/wdtversion.txt || exitOrLoop\n+  local wdt_version=\"$(grep \"Implementation-Version\" /tmp/wdtversion.txt | cut -f2 -d' ' | tr -d '\\r' )\" || exitOrLoop\n+  if  [ ! -z ${wdt_version} ]; then\n+    versionGE ${wdt_version} ${WDT_MINIMUM_VERSION}\n+    if [ $? != \"0\" ] ; then\n+      trace SEVERE \"Model in Image domain requires Weblogic Deploy Tool minimum version ${WDT_MINIMUM_VERSION}. \" \\\n+      \"The version in the image is ${wdt_version}, you need to update the Weblogic Deploy Tool version in the image.\"", "originalCommit": "1f9f944b67d4772ce698e578b19c304fc0615ab6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4MjkwMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414882903", "bodyText": "rephrased the sentence", "author": "jshum2479", "createdAt": "2020-04-24T21:48:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODk4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxOTAzMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414819033", "bodyText": "spelling", "author": "markxnelson", "createdAt": "2020-04-24T19:41:32Z", "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -384,6 +389,57 @@ function checkDirNotExistsOrEmpty() {\n   trace \"Exiting checkDirNotExistsOrEmpty\"\n }\n \n+# limit the file extensions in the model directories\n+\n+function checkModelDirectoryExtensions() {\n+  trace \"Entering checkModelDirectoryExtensions\"\n+\n+  cd ${IMG_MODELS_HOME}\n+  counter=$(ls  -I  \"*.yaml\" -I \"*.zip\" -I \"*.properties\" | wc -l)\n+  if [ $counter -ne 0 ] ; then\n+    trace SEVERE \"Model image directory ${IMG_MODELS_HOME} contains files with unsupported extensions. \" \\\n+      \"Expected extensions: .yaml, .properties, or .zip\"\n+    trace SEVERE \"Model image directory files with unsupported extensions: \" \\\n+      \"'$(ls -I \"*.yaml\" -I \"*.zip\" -I \"*.properties\")'\"\n+    exitOrLoop\n+  fi\n+  if [ -d ${WDT_CONFIGMAP_ROOT} ] ; then\n+    cd ${WDT_CONFIGMAP_ROOT}\n+    counter=$(ls  -I  \"*.yaml\" -I \"*.properties\" | wc -l)\n+    if [ $counter -ne 0 ] ; then\n+      trace SEVERE \"Model configmap directory ${WDT_CONFIGMAP_ROOT} contains files with unsupported extensions. \" \\\n+      \"Expected extensions: .yaml or .properties\"\n+      trace SEVERE \"Model configmap directory files with unsupported extensions: \" \\\n+        \"'$(ls -I \"*.yaml\" -I \"*.properties\")'\"\n+      exitOrLoop\n+    fi\n+  fi\n+\n+  trace \"Exiting checkModelDirectoryExtensions\"\n+}\n+\n+# Check for WDT version\n+\n+function checkWDTVersion() {\n+  trace \"Entering checkWDTVersion\"\n+  unzip -c ${WDT_ROOT}/lib/weblogic-deploy-core.jar META-INF/MANIFEST.MF > /tmp/wdtversion.txt || exitOrLoop\n+  local wdt_version=\"$(grep \"Implementation-Version\" /tmp/wdtversion.txt | cut -f2 -d' ' | tr -d '\\r' )\" || exitOrLoop\n+  if  [ ! -z ${wdt_version} ]; then\n+    versionGE ${wdt_version} ${WDT_MINIMUM_VERSION}\n+    if [ $? != \"0\" ] ; then\n+      trace SEVERE \"Model in Image domain requires Weblogic Deploy Tool minimum version ${WDT_MINIMUM_VERSION}. \" \\", "originalCommit": "1f9f944b67d4772ce698e578b19c304fc0615ab6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4MzQ4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r414883481", "bodyText": "rephrased the sentence", "author": "jshum2479", "createdAt": "2020-04-24T21:50:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxOTAzMw=="}], "type": "inlineReview"}, {"oid": "1c35272efd03ef31158eeb33a37ad4d8cf1765a3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1c35272efd03ef31158eeb33a37ad4d8cf1765a3", "message": "update wordings", "committedDate": "2020-04-24T21:09:05Z", "type": "commit"}, {"oid": "2cf1ddafbbbde284b3606a573e528213ad8c5254", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2cf1ddafbbbde284b3606a573e528213ad8c5254", "message": "Correct spelling", "committedDate": "2020-05-01T15:57:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY0ODk2NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r418648964", "bodyText": "Would it be OK to secretly allow a '.zip'?  A 'small' app could fit in the cm.  Or do we specifically want to disallow this?", "author": "tbarnes-us", "createdAt": "2020-05-01T17:34:22Z", "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -384,6 +389,61 @@ function checkDirNotExistsOrEmpty() {\n   trace \"Exiting checkDirNotExistsOrEmpty\"\n }\n \n+# limit the file extensions in the model directories\n+\n+function checkModelDirectoryExtensions() {\n+  trace \"Entering checkModelDirectoryExtensions\"\n+\n+  cd ${IMG_MODELS_HOME}\n+  counter=$(ls  -I  \"*.yaml\" -I \"*.zip\" -I \"*.properties\" | wc -l)\n+  if [ $counter -ne 0 ] ; then\n+    trace SEVERE \"Model image directory ${IMG_MODELS_HOME} contains files with unsupported extensions. \" \\\n+      \"Expected extensions: .yaml, .properties, or .zip\"\n+    trace SEVERE \"Model image directory files with unsupported extensions: \" \\\n+      \"'$(ls -I \"*.yaml\" -I \"*.zip\" -I \"*.properties\")'\"\n+    exitOrLoop\n+  fi\n+  if [ -d ${WDT_CONFIGMAP_ROOT} ] ; then\n+    cd ${WDT_CONFIGMAP_ROOT}\n+    counter=$(ls  -I  \"*.yaml\" -I \"*.properties\" | wc -l)", "originalCommit": "2cf1ddafbbbde284b3606a573e528213ad8c5254", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MTUyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r418661528", "bodyText": "Lets's disallow for now, There are quite a few places to change and it's hard to tell user to try it and if it doesn't fit do it other way.  This PR is for checking extension and WDT version, not dealing with features.", "author": "jshum2479", "createdAt": "2020-05-01T18:00:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY0ODk2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MjA5OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1592#discussion_r418672099", "bodyText": "Sure. Thanks for considering it. Resolving.", "author": "tbarnes-us", "createdAt": "2020-05-01T18:24:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY0ODk2NA=="}], "type": "inlineReview"}, {"oid": "3d811e86c5dc2bfb5e4f36a2a2522ed9db39e03c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3d811e86c5dc2bfb5e4f36a2a2522ed9db39e03c", "message": "add bypsss wdt version check wordings", "committedDate": "2020-05-01T18:17:19Z", "type": "commit"}]}