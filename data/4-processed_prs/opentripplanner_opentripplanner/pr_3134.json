{"pr_number": 3134, "pr_title": "Remove AlertPatcher", "pr_createdAt": "2020-07-07T12:39:43Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3134", "timeline": [{"oid": "55adda42bc3b69baaf24867798c795948bad3718", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/55adda42bc3b69baaf24867798c795948bad3718", "message": "Remove unused xml serialization references", "committedDate": "2020-07-06T11:58:45Z", "type": "commit"}, {"oid": "c8632f824deb698e86a6fd54fd37a15caee5be15", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c8632f824deb698e86a6fd54fd37a15caee5be15", "message": "remove createPatches", "committedDate": "2020-07-06T12:00:53Z", "type": "commit"}, {"oid": "c4fa84276e315176718e8cb02f993f9170f2d4bb", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c4fa84276e315176718e8cb02f993f9170f2d4bb", "message": "Move apiAlert", "committedDate": "2020-07-06T12:01:07Z", "type": "commit"}, {"oid": "810e513757c1dbffcc808fa6caf7aa449551264a", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/810e513757c1dbffcc808fa6caf7aa449551264a", "message": "Remove role handling\n\nAs there are no sensitive services anymore", "committedDate": "2020-07-06T12:07:48Z", "type": "commit"}, {"oid": "0be2ceda2b60264965ebb2224663ed71e0165cc1", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/0be2ceda2b60264965ebb2224663ed71e0165cc1", "message": "Remove multipart handling\n\nAnd documentation to scripting and analyst, which were using it", "committedDate": "2020-07-06T12:13:56Z", "type": "commit"}, {"oid": "d4cc3f24b514b304423d665dc15e9a29ee17c065", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d4cc3f24b514b304423d665dc15e9a29ee17c065", "message": "Remove unused alertPatches from graph", "committedDate": "2020-07-06T13:55:07Z", "type": "commit"}, {"oid": "d0cbb130ae87f57841a1d3319e02d29296a2b339", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d0cbb130ae87f57841a1d3319e02d29296a2b339", "message": "Remove old tests", "committedDate": "2020-07-06T14:03:55Z", "type": "commit"}, {"oid": "d5115a784a901423ad36a1baf149e098113a9902", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d5115a784a901423ad36a1baf149e098113a9902", "message": "Split StreetNote separate from Alert", "committedDate": "2020-07-06T14:36:06Z", "type": "commit"}, {"oid": "4bee8e3b5c1cd495c383c959655f5de304f52297", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/4bee8e3b5c1cd495c383c959655f5de304f52297", "message": "Remove AlertPatch and move logic to TransitAlert", "committedDate": "2020-07-08T11:59:20Z", "type": "commit"}, {"oid": "13178d329b9ba7cb69701c7abaf79575a9811d90", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/13178d329b9ba7cb69701c7abaf79575a9811d90", "message": "Make street note serializable", "committedDate": "2020-07-08T11:59:20Z", "type": "commit"}, {"oid": "13178d329b9ba7cb69701c7abaf79575a9811d90", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/13178d329b9ba7cb69701c7abaf79575a9811d90", "message": "Make street note serializable", "committedDate": "2020-07-08T11:59:20Z", "type": "forcePushed"}, {"oid": "3269f2fd11d86dcc3d6ee3f7b87c487ee94e6d36", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/3269f2fd11d86dcc3d6ee3f7b87c487ee94e6d36", "message": "Update documentation", "committedDate": "2020-07-09T08:07:33Z", "type": "commit"}, {"oid": "f9b678caf40ec2cd54485a207000c917088956dd", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f9b678caf40ec2cd54485a207000c917088956dd", "message": "Add missing methods from Index API", "committedDate": "2020-07-09T08:12:34Z", "type": "commit"}, {"oid": "20fcf27b9545e43d595be93c9a39d8ded8089c84", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/20fcf27b9545e43d595be93c9a39d8ded8089c84", "message": "Merge branch 'dev-2.x' into remove-alert-patcher", "committedDate": "2020-08-03T09:07:56Z", "type": "commit"}, {"oid": "4baed481d8a38d4eb5e5d4485814743db8e7bf5d", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/4baed481d8a38d4eb5e5d4485814743db8e7bf5d", "message": "Merge branch 'legacygraphql' into remove-alert-patcher", "committedDate": "2020-08-06T16:33:01Z", "type": "commit"}, {"oid": "fa7cb0191e2573191bb057216760f3bfab157d4f", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/fa7cb0191e2573191bb057216760f3bfab157d4f", "message": "Merge branch 'dev-2.x' of github.com:opentripplanner/OpenTripPlanner into remove-alert-patcher", "committedDate": "2020-08-06T16:33:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMwMTU0Nw==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3134#discussion_r477301547", "bodyText": "Should this be mentioned in the migration guide?", "author": "t2gran", "createdAt": "2020-08-26T13:30:52Z", "path": "src/main/java/org/opentripplanner/api/model/ApiAlert.java", "diffHunk": "@@ -8,4 +8,5 @@\n     public String alertUrl;\n     /** null means unknown */\n     public Date effectiveStartDate;\n+    public Date effectiveEndDate;", "originalCommit": "fa7cb0191e2573191bb057216760f3bfab157d4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0MzExMg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3134#discussion_r478243112", "bodyText": "Added", "author": "hannesj", "createdAt": "2020-08-27T08:22:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMwMTU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMwNTE5OA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3134#discussion_r477305198", "bodyText": "I expect there to be merge conflicts with the current dev-2.x branch for this file. It is ok to accept what ever is in the dev-2.x branch and just comment out the sections that do not compile. We (Entur) can fixit after it is merged.", "author": "t2gran", "createdAt": "2020-08-26T13:35:51Z", "path": "src/ext/java/org/opentripplanner/ext/transmodelapi/TransmodelIndexGraphQLSchema.java", "diffHunk": "@@ -1080,32 +1080,55 @@ public TransmodelIndexGraphQLSchema(Graph graph, RoutingRequest defaultRequest)\n                         .name(\"id\")\n                         .type(new GraphQLNonNull(Scalars.GraphQLID))\n                         .dataFetcher(environment -> relay.toGlobalId(\n-                                ptSituationElementType.getName(), ((AlertPatch) environment.getSource()).getId()))\n+                                ptSituationElementType.getName(), ((TransitAlert) environment.getSource()).getId()))", "originalCommit": "fa7cb0191e2573191bb057216760f3bfab157d4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0MzM1Mw==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3134#discussion_r478243353", "bodyText": "Merge conflicts were fixed, and everything at least compiles succesfully", "author": "hannesj", "createdAt": "2020-08-27T08:22:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMwNTE5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMwNjMyMA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3134#discussion_r477306320", "bodyText": "@lassetyr Would you mind to review this part? The changes to the Siri updaters.", "author": "t2gran", "createdAt": "2020-08-26T13:37:32Z", "path": "src/ext/java/org/opentripplanner/ext/siri/SiriAlertsUpdateHandler.java", "diffHunk": "@@ -1,12 +1,15 @@\n package org.opentripplanner.ext.siri;\n \n-import org.apache.commons.lang3.tuple.Pair;\n import org.opentripplanner.model.FeedScopedId;\n import org.opentripplanner.model.Route;\n import org.opentripplanner.model.calendar.ServiceDate;\n-import org.opentripplanner.routing.alertpatch.*;\n+import org.opentripplanner.routing.alertpatch.AlertUrl;\n+import org.opentripplanner.routing.alertpatch.EntitySelector;\n+import org.opentripplanner.routing.alertpatch.StopCondition;\n+import org.opentripplanner.routing.alertpatch.TimePeriod;\n+import org.opentripplanner.routing.alertpatch.TransitAlert;\n import org.opentripplanner.routing.core.TraverseMode;", "originalCommit": "fa7cb0191e2573191bb057216760f3bfab157d4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyOTg5Ng==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3134#discussion_r477329896", "bodyText": "Looks good, I am also in favor of merging.", "author": "lassetyr", "createdAt": "2020-08-26T14:08:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMwNjMyMA=="}], "type": "inlineReview"}, {"oid": "9b796fb9ac9876ff719137ef3bc692d0c81d91e3", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/9b796fb9ac9876ff719137ef3bc692d0c81d91e3", "message": "Merge branch 'dev-2.x' of github.com:opentripplanner/OpenTripPlanner into remove-alert-patcher", "committedDate": "2020-08-27T07:26:16Z", "type": "forcePushed"}, {"oid": "7402dae06c3af2c1c0799f6d1ccbe631fbef48f9", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7402dae06c3af2c1c0799f6d1ccbe631fbef48f9", "message": "Merge branch 'dev-2.x' of github.com:opentripplanner/OpenTripPlanner into remove-alert-patcher", "committedDate": "2020-08-27T07:28:43Z", "type": "commit"}, {"oid": "7402dae06c3af2c1c0799f6d1ccbe631fbef48f9", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7402dae06c3af2c1c0799f6d1ccbe631fbef48f9", "message": "Merge branch 'dev-2.x' of github.com:opentripplanner/OpenTripPlanner into remove-alert-patcher", "committedDate": "2020-08-27T07:28:43Z", "type": "forcePushed"}, {"oid": "5c707f42c419b77df82c2707dd7b663fbdeeb10b", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/5c707f42c419b77df82c2707dd7b663fbdeeb10b", "message": "Add note about changed alert type", "committedDate": "2020-08-27T08:18:09Z", "type": "commit"}]}