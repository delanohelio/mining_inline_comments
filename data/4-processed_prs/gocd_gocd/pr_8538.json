{"pr_number": 8538, "pr_title": "Introduce stage overview on pipeline activity page.", "pr_createdAt": "2020-09-09T09:47:37Z", "pr_url": "https://github.com/gocd/gocd/pull/8538", "timeline": [{"oid": "f1e5855c5c6a963c360f9315150c0b38ef86fa6a", "url": "https://github.com/gocd/gocd/commit/f1e5855c5c6a963c360f9315150c0b38ef86fa6a", "message": "Introduce stage overview on pipeline activity page.", "committedDate": "2020-09-09T09:44:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ4NTIyOQ==", "url": "https://github.com/gocd/gocd/pull/8538#discussion_r485485229", "bodyText": "Fix this!\nFix stage settings page when pipeline is defined from a template.", "author": "GaneshSPatil", "createdAt": "2020-09-09T09:49:49Z", "path": "server/src/main/webapp/WEB-INF/rails/webpack/views/pages/pipeline_activity/pipeline_run_info_widget.tsx", "diffHunk": "@@ -100,16 +103,54 @@ export class PipelineRunWidget extends MithrilViewComponent<PipelineRunAttrs> {\n       </td>\n       <td class={styles.right} data-test-id=\"stage-status\">\n         {pipelineRunInfo.stages().map((stage, index) => {\n+\n+          const pipelineName = stage.pipelineName();\n+          const pipelineCounter = stage.pipelineCounter();\n+          const stageName = stage.stageName();\n+          const stageCounter = stage.stageCounter();\n+\n+          let optionalStageOverview: m.Children | undefined;\n+\n+          let isModelOpen = vnode.attrs.stageOverviewState.isOpen(pipelineName, pipelineCounter, stageName, stageCounter);\n+          if (!isModelOpen && vnode.attrs.stageOverviewState.getPipelineCounter() === pipelineCounter) {\n+            const previousStageCounter = `${((+stageCounter) - 1)}`;\n+            const isOpenForPreviousStageInstance = vnode.attrs.stageOverviewState.isOpen(pipelineName, pipelineCounter, stageName, previousStageCounter);\n+\n+            if (isOpenForPreviousStageInstance) {\n+              isModelOpen = true;\n+              vnode.attrs.stageOverviewState.hide();\n+              vnode.attrs.showStageOverview(pipelineName, pipelineCounter, stageName, stageCounter, stage.stageStatus(), {stopPropagation: () => undefined});\n+            }\n+          }\n+\n+          if (isModelOpen) {\n+            // @ts-ignore\n+            stage.status = stage.stageStatus();\n+            // @ts-ignore\n+            stage.canOperate = vnode.attrs.canOperatePipeline;\n+\n+            optionalStageOverview = <StageOverview pipelineName={stage.pipelineName()}\n+                                                   isDisplayedOnPipelineActivityPage={true}\n+                                                   canAdminister={vnode.attrs.canAdministerPipeline}\n+                                                   pipelineCounter={stage.pipelineCounter()}\n+                                                   stageName={stageName}\n+                                                   stageCounter={stageCounter}\n+                                                   stages={pipelineRunInfo.stages()}\n+                                                   templateName={undefined}", "originalCommit": "f1e5855c5c6a963c360f9315150c0b38ef86fa6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e111b53e5ba6d467facc49c224ed9bf8ef6f7891", "url": "https://github.com/gocd/gocd/commit/e111b53e5ba6d467facc49c224ed9bf8ef6f7891", "message": "Link to template stage config edit page when pipeline is defined from a template", "committedDate": "2020-09-09T10:03:18Z", "type": "commit"}]}