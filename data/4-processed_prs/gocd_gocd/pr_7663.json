{"pr_number": 7663, "pr_title": "Added config migration to support rules in config repo", "pr_createdAt": "2020-01-28T06:14:56Z", "pr_url": "https://github.com/gocd/gocd/pull/7663", "timeline": [{"oid": "eca2f4e72afc2ac895dfb9c956d06768b007bf1a", "url": "https://github.com/gocd/gocd/commit/eca2f4e72afc2ac895dfb9c956d06768b007bf1a", "message": "Updated tests\n - fixed tests which relied on default ID added to config repo - added the id in the tests itself, rather than adding a default one", "committedDate": "2020-01-28T10:02:04Z", "type": "forcePushed"}, {"oid": "ca511f69d118ee062338b4a625311f8cefbeb468", "url": "https://github.com/gocd/gocd/commit/ca511f69d118ee062338b4a625311f8cefbeb468", "message": "Updated tests\n - fixed tests which relied on default ID added to config repo - added the id in the tests itself, rather than adding a default one", "committedDate": "2020-01-28T10:52:58Z", "type": "forcePushed"}, {"oid": "609257acf441dd3172673ddbf13813d48cd1b1e8", "url": "https://github.com/gocd/gocd/commit/609257acf441dd3172673ddbf13813d48cd1b1e8", "message": "Adding support for rule in config repo\n\n - added a config migration to add <allow type=\"*\" action=\"refer\">*</allow> to all config repos as by default the rule will be deny all", "committedDate": "2020-01-31T06:01:13Z", "type": "commit"}, {"oid": "00b357c112ef1a3168aee5a6a4f6c8966137eb43", "url": "https://github.com/gocd/gocd/commit/00b357c112ef1a3168aee5a6a4f6c8966137eb43", "message": "Code refactoring\n - rename of getMaterialConfig to getRepo\n - inlining of constructors", "committedDate": "2020-01-31T06:01:13Z", "type": "commit"}, {"oid": "fe89912aae06741fb80fa3c2769b957f55e08ab3", "url": "https://github.com/gocd/gocd/commit/fe89912aae06741fb80fa3c2769b957f55e08ab3", "message": "Updated tests\n - fixed tests which relied on default ID added to config repo - added the id in the tests itself, rather than adding a default one", "committedDate": "2020-01-31T06:01:14Z", "type": "commit"}, {"oid": "fe89912aae06741fb80fa3c2769b957f55e08ab3", "url": "https://github.com/gocd/gocd/commit/fe89912aae06741fb80fa3c2769b957f55e08ab3", "message": "Updated tests\n - fixed tests which relied on default ID added to config repo - added the id in the tests itself, rather than adding a default one", "committedDate": "2020-01-31T06:01:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTY1Nw==", "url": "https://github.com/gocd/gocd/pull/7663#discussion_r374979657", "bodyText": "@kritika-singh3 where has this check moved? This check ensured a config repo is invalid if the material config within is invalid.", "author": "maheshp", "createdAt": "2020-02-04T23:19:35Z", "path": "config/config-api/src/main/java/com/thoughtworks/go/config/remote/ConfigRepoConfig.java", "diffHunk": "@@ -142,29 +88,8 @@ private void validateUniquenessOfId(ValidationContext validationContext) {\n         }\n     }\n \n-    public boolean validateTree(ValidationContext validationContext) {\n-        validate(validationContext);\n-        boolean isValid = errors.isEmpty();\n-\n-        if (getMaterialConfig() != null) {\n-            isValid = getMaterialConfig().errors().isEmpty() && isValid;", "originalCommit": "609257acf441dd3172673ddbf13813d48cd1b1e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1MTA0Mg==", "url": "https://github.com/gocd/gocd/pull/7663#discussion_r375051042", "bodyText": "@maheshp The check for materialConfig is present in validate(ValidationContext ) method. The same will get called from the validateTree method from RuleAwarePluginProfile class.", "author": "kritika-singh3", "createdAt": "2020-02-05T04:11:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTY1Nw=="}], "type": "inlineReview"}]}