{"pr_number": 8203, "pr_title": "Copy specific wrapper files needed to run the gocd-server in a container", "pr_createdAt": "2020-05-31T04:26:02Z", "pr_url": "https://github.com/gocd/gocd/pull/8203", "timeline": [{"oid": "d0b49e6935918ef9a412d44dffd7b23d08e6d96d", "url": "https://github.com/gocd/gocd/commit/d0b49e6935918ef9a412d44dffd7b23d08e6d96d", "message": "Copy specific wrapper files needed to run the gocd-server in a container\n* Remove deprecated MAINTAINER instruction\n* Reduce number of intermediate layers", "committedDate": "2020-06-01T04:45:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc0NzcxMw==", "url": "https://github.com/gocd/gocd/pull/8203#discussion_r433747713", "bodyText": "My worry about this is that will silently break if the structure of the zip changes. I tried this locally and the files copied over are 197MB and the files left behind due to this are 17MB. Not sure if the risk is worth that.\nAlso, there is a LICENSE file there, that would be nice to copy over, if going with this.", "author": "arvindsv", "createdAt": "2020-06-02T09:35:38Z", "path": "buildSrc/src/main/resources/gocd-docker-server/Dockerfile.server.ftl", "diffHunk": "@@ -28,10 +28,18 @@ RUN \\\n   curl --fail --location --silent --show-error \"https://download.gocd.org/binaries/${fullVersion}/generic/go-server-${fullVersion}.zip\" > /tmp/go-server-${fullVersion}.zip\n </#if>\n RUN unzip /tmp/go-server-${fullVersion}.zip -d /\n-RUN mv /go-server-${goVersion} /go-server && chown -R ${r\"${UID}\"}:0 /go-server && chmod -R g=u /go-server", "originalCommit": "d0b49e6935918ef9a412d44dffd7b23d08e6d96d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA0MzY0MQ==", "url": "https://github.com/gocd/gocd/pull/8203#discussion_r434043641", "bodyText": "There are windows, mac, freebsd etc files that are not needed to run on alpine. But, yeah, I guess I'll remove this change if you think that the structure is likely to change.", "author": "varshavaradarajan", "createdAt": "2020-06-02T17:19:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc0NzcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA0ODYyNg==", "url": "https://github.com/gocd/gocd/pull/8203#discussion_r434048626", "bodyText": "Not sure if it's likely to change, but I'd like something to fail in an obvious way if it changes ...", "author": "arvindsv", "createdAt": "2020-06-02T17:27:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc0NzcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMxMzA3NQ==", "url": "https://github.com/gocd/gocd/pull/8203#discussion_r434313075", "bodyText": "I guess if something important does change, docker run will fail to start the server. There used to be some docker tests we were running to make sure basic things(bringing up a server and all agents) worked. I don't see it on build.go.cd anymore though.\nThis: https://github.com/gocd/docker-test", "author": "varshavaradarajan", "createdAt": "2020-06-03T05:17:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc0NzcxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc3ODMwOQ==", "url": "https://github.com/gocd/gocd/pull/8203#discussion_r433778309", "bodyText": "I see we use curl later here. ls it not needed?", "author": "arvindsv", "createdAt": "2020-06-02T10:31:57Z", "path": "buildSrc/src/main/groovy/com/thoughtworks/go/build/docker/Distro.groovy", "diffHunk": "@@ -54,7 +54,7 @@ enum Distro implements DistroBehavior {\n       return [\n         '# install glibc and zlib for adoptopenjdk',\n         '# See https://github.com/AdoptOpenJDK/openjdk-docker/blob/ce8b120411b131e283106ab89ea5921ebb1d1759/8/jdk/alpine/Dockerfile.hotspot.releases.slim#L24-L54',\n-        '  apk add --no-cache --virtual .build-deps curl binutils',", "originalCommit": "d0b49e6935918ef9a412d44dffd7b23d08e6d96d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA0MTIzMg==", "url": "https://github.com/gocd/gocd/pull/8203#discussion_r434041232", "bodyText": "We have already added curl", "author": "varshavaradarajan", "createdAt": "2020-06-02T17:15:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc3ODMwOQ=="}], "type": "inlineReview"}, {"oid": "d9a682ccbab127fc99c8a2048b67b25dbeda5b5d", "url": "https://github.com/gocd/gocd/commit/d9a682ccbab127fc99c8a2048b67b25dbeda5b5d", "message": "Copy specific wrapper files needed to run the gocd-server in a container\n* Remove deprecated MAINTAINER instruction\n* Reduce number of intermediate layers", "committedDate": "2020-06-03T05:08:27Z", "type": "commit"}, {"oid": "d9a682ccbab127fc99c8a2048b67b25dbeda5b5d", "url": "https://github.com/gocd/gocd/commit/d9a682ccbab127fc99c8a2048b67b25dbeda5b5d", "message": "Copy specific wrapper files needed to run the gocd-server in a container\n* Remove deprecated MAINTAINER instruction\n* Reduce number of intermediate layers", "committedDate": "2020-06-03T05:08:27Z", "type": "forcePushed"}]}