{"pr_number": 8602, "pr_title": "IGNITE-13734 .NET: Register service return type on method invocation", "pr_createdAt": "2020-12-23T16:18:50Z", "pr_url": "https://github.com/apache/ignite/pull/8602", "timeline": [{"oid": "56fb493ca9bc6b6848a2e171c98f1e6bb364491b", "url": "https://github.com/apache/ignite/commit/56fb493ca9bc6b6848a2e171c98f1e6bb364491b", "message": "IGNITE-13734: Register service return type on method invocation.", "committedDate": "2020-12-23T16:16:53Z", "type": "commit"}, {"oid": "fb2206fb56eeefa0b897e6a84bb0ea8c6fbe6f7d", "url": "https://github.com/apache/ignite/commit/fb2206fb56eeefa0b897e6a84bb0ea8c6fbe6f7d", "message": "IGNITE-13734: Register service return type on method invocation.", "committedDate": "2020-12-23T16:35:28Z", "type": "commit"}, {"oid": "d00b8adf462c4d803c5a36dc7288cc4dc42e72a9", "url": "https://github.com/apache/ignite/commit/d00b8adf462c4d803c5a36dc7288cc4dc42e72a9", "message": "IGNITE-13734: Register service return type on method invocation.", "committedDate": "2020-12-23T16:39:36Z", "type": "commit"}, {"oid": "ef76d227943a90f0867c260744e4156d081e1fc0", "url": "https://github.com/apache/ignite/commit/ef76d227943a90f0867c260744e4156d081e1fc0", "message": "Merge branch 'master' into IGNITE-13734", "committedDate": "2020-12-24T08:28:22Z", "type": "commit"}, {"oid": "fb9cbfe7fcae0846f23275f39c29267a22c8428e", "url": "https://github.com/apache/ignite/commit/fb9cbfe7fcae0846f23275f39c29267a22c8428e", "message": "Merge branch 'master' into IGNITE-13734", "committedDate": "2020-12-24T12:07:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4Mjc2OA==", "url": "https://github.com/apache/ignite/pull/8602#discussion_r548882768", "bodyText": "Unused import", "author": "ptupitsyn", "createdAt": "2020-12-25T15:06:08Z", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Services/ServiceProxyTest.cs", "diffHunk": "@@ -18,6 +18,7 @@\n namespace Apache.Ignite.Core.Tests.Services\n {\n     using System;\n+    using System.CodeDom;", "originalCommit": "d00b8adf462c4d803c5a36dc7288cc4dc42e72a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4NDI0Nw==", "url": "https://github.com/apache/ignite/pull/8602#discussion_r548884247", "bodyText": "Let's extract a method string GetTypeName(int id, bool java).", "author": "ptupitsyn", "createdAt": "2020-12-25T15:22:38Z", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Binary/BinaryProcessor.cs", "diffHunk": "@@ -162,7 +168,34 @@ public BinaryType RegisterEnum(string typeName, IEnumerable<KeyValuePair<string,\n         /// <returns>Type or null.</returns>\n         public string GetTypeName(int id)\n         {\n-            return DoOutInOp((int) Op.GetType, w => w.WriteInt(id), r => Marshaller.StartUnmarshal(r).ReadString());\n+            try\n+            {\n+                return DoOutInOp((int) Op.GetType, w =>", "originalCommit": "d00b8adf462c4d803c5a36dc7288cc4dc42e72a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4NjY4Mw==", "url": "https://github.com/apache/ignite/pull/8602#discussion_r548886683", "bodyText": "Fixed.", "author": "nizhikov", "createdAt": "2020-12-25T15:46:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4NDI0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4NDk2Ng==", "url": "https://github.com/apache/ignite/pull/8602#discussion_r548884966", "bodyText": "I think we can return the name of the registered type from above, no need to call into Java again.", "author": "ptupitsyn", "createdAt": "2020-12-25T15:29:01Z", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Binary/BinaryProcessor.cs", "diffHunk": "@@ -162,7 +168,34 @@ public BinaryType RegisterEnum(string typeName, IEnumerable<KeyValuePair<string,\n         /// <returns>Type or null.</returns>\n         public string GetTypeName(int id)\n         {\n-            return DoOutInOp((int) Op.GetType, w => w.WriteInt(id), r => Marshaller.StartUnmarshal(r).ReadString());\n+            try\n+            {\n+                return DoOutInOp((int) Op.GetType, w =>\n+                {\n+                    w.WriteInt(id);\n+                    w.WriteByte(DotNetPlatformId);\n+                }, r => Marshaller.StartUnmarshal(r).ReadString());\n+            }\n+            catch (BinaryObjectException)\n+            {\n+                if (!Marshaller.RegisterSameJavaType.Value)\n+                    throw;\n+            }\n+\n+            // Try to get java type name and register corresponding DotNet type.\n+            var javaTypeName = DoOutInOp((int) Op.GetType, w =>\n+            {\n+                w.WriteInt(id);\n+                w.WriteByte(JavaPlatformId);\n+            }, r => Marshaller.StartUnmarshal(r).ReadString());\n+\n+            RegisterType(id, Marshaller.GetTypeName(javaTypeName), false);\n+\n+            return DoOutInOp((int) Op.GetType, w =>", "originalCommit": "d00b8adf462c4d803c5a36dc7288cc4dc42e72a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4NjY5OQ==", "url": "https://github.com/apache/ignite/pull/8602#discussion_r548886699", "bodyText": "Fixed.", "author": "nizhikov", "createdAt": "2020-12-25T15:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4NDk2Ng=="}], "type": "inlineReview"}, {"oid": "397347274e37aee04e24e86edf5082b2d593734c", "url": "https://github.com/apache/ignite/commit/397347274e37aee04e24e86edf5082b2d593734c", "message": "Merge branch 'master' into IGNITE-13734", "committedDate": "2020-12-25T15:39:54Z", "type": "commit"}, {"oid": "2bdafff84d7afea6ba41821b34b8f2b02974570f", "url": "https://github.com/apache/ignite/commit/2bdafff84d7afea6ba41821b34b8f2b02974570f", "message": "IGNITE-13734: code review fixes.", "committedDate": "2020-12-25T15:51:18Z", "type": "commit"}]}