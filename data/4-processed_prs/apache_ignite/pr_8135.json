{"pr_number": 8135, "pr_title": "IGNITE-12921 SqlViewExporterSpi moved to the internal package", "pr_createdAt": "2020-08-10T12:23:27Z", "pr_url": "https://github.com/apache/ignite/pull/8135", "timeline": [{"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e", "url": "https://github.com/apache/ignite/commit/d97ea1017bb049a2ce06a73ffcc2d885bb84b09e", "message": "IGNITE-12921: SqlViewExporterSpi moved to the internal package.", "committedDate": "2020-08-10T12:18:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MTgxNA==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471691814", "bodyText": "Could you please replace supplier by simple method call? There is no need to use lambda syntax here.", "author": "agura", "createdAt": "2020-08-17T18:34:07Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {", "originalCommit": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk2MTkzMQ==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471961931", "bodyText": "replaced.", "author": "nizhikov", "createdAt": "2020-08-18T07:11:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MTgxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471693476", "bodyText": "Nevertheless, what if spi array already contains SqlViewExporterSpi?", "author": "agura", "createdAt": "2020-08-17T18:35:19Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {\n+            SystemViewExporterSpi[] spi = ctx.config().getSystemViewExporterSpi();\n+\n+            if (!IgniteComponentType.INDEXING.inClassPath())\n+                return spi;\n+\n+            SystemViewExporterSpi[] spiWithSql = new SystemViewExporterSpi[spi != null ? spi.length + 1 : 1];", "originalCommit": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk1NjkzMQ==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471956931", "bodyText": "SqlViewExporterSpi now is package-private so it's forbidden for the user to create instances.", "author": "nizhikov", "createdAt": "2020-08-18T07:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA3OTkxMg==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r489079912", "bodyText": "Any way it is just somewhat sloppy.", "author": "agura", "createdAt": "2020-09-15T23:48:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEzMzkzNw==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r490133937", "bodyText": "OK, I've added a check to ensure SqlViewExporterSpi not presented in the initial array.", "author": "nizhikov", "createdAt": "2020-09-17T10:19:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIwMjA5MQ==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r490202091", "bodyText": "It's definitely redundant due to a package privacy. I told about naming only. Please revert this check and merge.", "author": "agura", "createdAt": "2020-09-17T12:25:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5ODI2Mw==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471698263", "bodyText": "Visibility scope for this constant is too broad.", "author": "agura", "createdAt": "2020-08-17T18:38:45Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -53,6 +57,9 @@\n  */\n public class GridSystemViewManager extends GridManagerAdapter<SystemViewExporterSpi>\n     implements ReadOnlySystemViewRegistry {\n+    /** Class name for a SQL view exporter of system views. */\n+    public static final String SYSTEM_VIEW_SQL_SPI = \"org.apache.ignite.internal.managers.systemview.SqlViewExporterSpi\";", "originalCommit": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk2MjQxNQ==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471962415", "bodyText": "fixed.", "author": "nizhikov", "createdAt": "2020-08-18T07:12:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5ODI2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcwNjQzOQ==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471706439", "bodyText": "IMHO, it isn't the best solution to have internal implementation of any SPI. May be we can extract some common parts of Exporter SPI into a new internal super-class which should be inherited by SystemViewExporterSpi and our internal analog of SqlViewEXporterSpi?", "author": "agura", "createdAt": "2020-08-17T18:45:37Z", "path": "modules/indexing/src/main/java/org/apache/ignite/internal/managers/systemview/SqlViewExporterSpi.java", "diffHunk": "@@ -36,12 +37,9 @@\n  * This SPI implementation exports metrics as SQL views.\n  *\n  * Note, instance of this class created with reflection.\n- * @see IgnitionEx#SYSTEM_VIEW_SQL_SPI\n+ * @see GridSystemViewManager#SYSTEM_VIEW_SQL_SPI\n  */\n-public class SqlViewExporterSpi extends IgniteSpiAdapter implements SystemViewExporterSpi {\n-    /** System view filter. */\n-    @Nullable private Predicate<SystemView<?>> filter;\n-\n+class SqlViewExporterSpi extends IgniteSpiAdapter implements SystemViewExporterSpi {", "originalCommit": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk3MjA4NQ==", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471972085", "bodyText": "AbstractSystemViewExporterSpi introduced. Please, take a look one more time.", "author": "nizhikov", "createdAt": "2020-08-18T07:30:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcwNjQzOQ=="}], "type": "inlineReview"}, {"oid": "702b52563b0165270d84920c7785b6731ff01e98", "url": "https://github.com/apache/ignite/commit/702b52563b0165270d84920c7785b6731ff01e98", "message": "Merge branch 'master' into IGNITE-12921", "committedDate": "2020-08-18T07:03:04Z", "type": "commit"}, {"oid": "42fa58850ec2dfc34a7e31381320cb99325bc3c5", "url": "https://github.com/apache/ignite/commit/42fa58850ec2dfc34a7e31381320cb99325bc3c5", "message": "IGNITE-12921: code review fixes.", "committedDate": "2020-08-18T07:12:52Z", "type": "commit"}, {"oid": "9a35215139e3af529e8e7d9531facdfebea6a643", "url": "https://github.com/apache/ignite/commit/9a35215139e3af529e8e7d9531facdfebea6a643", "message": "IGNITE-12921: code review fixes.", "committedDate": "2020-08-18T07:28:55Z", "type": "commit"}, {"oid": "583e005725800c24788780c2fd80903a9356e01f", "url": "https://github.com/apache/ignite/commit/583e005725800c24788780c2fd80903a9356e01f", "message": "Merge branch 'master' into IGNITE-12921", "committedDate": "2020-09-17T10:14:54Z", "type": "commit"}, {"oid": "310f8485b32bc4ba6f2e7446b47f0d20ab5efaef", "url": "https://github.com/apache/ignite/commit/310f8485b32bc4ba6f2e7446b47f0d20ab5efaef", "message": "IGNITE-12921: Check added.", "committedDate": "2020-09-17T10:52:47Z", "type": "commit"}, {"oid": "e9b69247ca5cc44c23ce98860ecb182daf592cf9", "url": "https://github.com/apache/ignite/commit/e9b69247ca5cc44c23ce98860ecb182daf592cf9", "message": "IGNITE-12921: Check removed.", "committedDate": "2020-09-17T12:43:26Z", "type": "commit"}, {"oid": "d0532e2cf3161d3ceeb75b2c4754f8a97dfb7880", "url": "https://github.com/apache/ignite/commit/d0532e2cf3161d3ceeb75b2c4754f8a97dfb7880", "message": "IGNITE-12921: Check removed.", "committedDate": "2020-09-17T12:44:49Z", "type": "commit"}, {"oid": "addb8b0da53354cd1393705eb13ab9e3b13fd370", "url": "https://github.com/apache/ignite/commit/addb8b0da53354cd1393705eb13ab9e3b13fd370", "message": "IGNITE-12921: code style fixes", "committedDate": "2020-09-17T12:59:01Z", "type": "commit"}, {"oid": "802d9743b9a57dd2ccb99a9f4b8aaf442f4fdfab", "url": "https://github.com/apache/ignite/commit/802d9743b9a57dd2ccb99a9f4b8aaf442f4fdfab", "message": "IGNITE-12921: code style fixes", "committedDate": "2020-09-17T13:33:59Z", "type": "commit"}, {"oid": "22ff7fb95fbaa802da0cba8da0250fea2b870367", "url": "https://github.com/apache/ignite/commit/22ff7fb95fbaa802da0cba8da0250fea2b870367", "message": "Merge branch 'master' into IGNITE-12921", "committedDate": "2020-09-18T10:23:20Z", "type": "commit"}, {"oid": "d6ec63b8ad0828a88cc81394b15f63af7c3712e3", "url": "https://github.com/apache/ignite/commit/d6ec63b8ad0828a88cc81394b15f63af7c3712e3", "message": "IGNITE-12921: test fix", "committedDate": "2020-09-18T10:37:39Z", "type": "commit"}]}