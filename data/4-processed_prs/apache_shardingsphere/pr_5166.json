{"pr_number": 5166, "pr_title": "Optimize MetaData Center #MetaDataCenter-phase-3-4", "pr_createdAt": "2020-04-13T11:15:10Z", "pr_url": "https://github.com/apache/shardingsphere/pull/5166", "timeline": [{"oid": "0f45f9f893d43d3305f47a532e0c4b1f42af0956", "url": "https://github.com/apache/shardingsphere/commit/0f45f9f893d43d3305f47a532e0c4b1f42af0956", "message": "for issue 5128, add metadata center docs", "committedDate": "2020-04-13T10:41:47Z", "type": "commit"}, {"oid": "9ef762c68e85a5991466842040ca38f7ac6beff6", "url": "https://github.com/apache/shardingsphere/commit/9ef762c68e85a5991466842040ca38f7ac6beff6", "message": "for issue 5128, add empty lines", "committedDate": "2020-04-13T11:06:55Z", "type": "commit"}, {"oid": "0ef9ab39bdb2121c6773af97c96540bc554fc797", "url": "https://github.com/apache/shardingsphere/commit/0ef9ab39bdb2121c6773af97c96540bc554fc797", "message": "for issue 5128, revise documents", "committedDate": "2020-04-13T11:12:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzODk4Mw==", "url": "https://github.com/apache/shardingsphere/pull/5166#discussion_r407438983", "bodyText": "config/registry/metadata center", "author": "kimmking", "createdAt": "2020-04-13T11:37:27Z", "path": "docs/document/content/features/orchestration/_index.en.md", "diffHunk": "@@ -7,4 +7,4 @@ chapter = true\n \n ## Navigation\n \n-Provide orchestration of config/registry center(and metadata center in plan), dynamic configuration, database & application disabling, and APM.\n+Provide orchestration of config/registry center/metadata center, dynamic configuration, database & application disabling, and APM.", "originalCommit": "0ef9ab39bdb2121c6773af97c96540bc554fc797", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ0MDI4NQ==", "url": "https://github.com/apache/shardingsphere/pull/5166#discussion_r407440285", "bodyText": "\u901a\u8fc7\u67d0\u4e00\u4e2aProxy\u5b9e\u4f8b\u6267\u884cDDL\u4ee5\u540e\uff0c\u7cfb\u7edf\u5148\u5c06\u65b0\u7684\u5143\u6570\u636e\u5b58\u50a8\u5230\u5143\u6570\u636e\u4e2d\u5fc3\uff0c\u7136\u540e\u901a\u8fc7\u4e8b\u4ef6\u5e7f\u64ad\u673a\u5236\uff0c\u901a\u77e5\u5176\u5b83Proxy\u5b9e\u4f8b\u4ece\u6e90\u6570\u636e\u5e93\u4e2d\u5fc3\u540c\u6b65\u5143\u6570\u636e\uff0c\u4fdd\u8bc1\u5143\u6570\u636e\u4e00\u81f4\u3002", "author": "kimmking", "createdAt": "2020-04-13T11:42:06Z", "path": "docs/document/content/features/orchestration/metadata-center.cn.md", "diffHunk": "@@ -0,0 +1,103 @@\n++++\n+pre = \"<b>3.3.3. </b>\"\n+toc = true\n+title = \"\u5143\u6570\u636e\u4e2d\u5fc3\"\n+weight = 3\n++++\n+\n+## \u5b9e\u73b0\u52a8\u673a\n+\n+- \u5143\u6570\u636e\u662fSharding-JDBC/Sharding-Proxy\u6240\u4f7f\u7528\u7684\u6570\u636e\u6e90\u7684\u8868\u3001\u5217\u548c\u7d22\u5f15\u7b49\u6838\u5fc3\u6570\u636e\uff0c\u5143\u6570\u636e\u4fdd\u969cShardingSphere\u5404\u4e2a\u7ec4\u4ef6\u80fd\u591f\u6b63\u786e\u8fd0\u884c\u3002\n+\n+- \u5143\u6570\u636e\u4e2d\u5fc3\u5bf9\u5143\u6570\u636e\u8fdb\u884c\u7edf\u4e00\u7ec4\u7ec7\u548c\u7ba1\u7406\uff0c\u5b9e\u73b0\u5143\u6570\u636e\u7684\u7edf\u4e00\u52a0\u8f7d\u3001\u53d8\u66f4\u901a\u77e5\u548c\u6570\u636e\u540c\u6b65\u3002\n+\n+## \u5143\u6570\u636e\u4e2d\u5fc3\u6570\u636e\u7ed3\u6784\n+\n+\u5143\u6570\u636e\u4e2d\u5fc3\u5728\u5b9a\u4e49\u7684\u547d\u540d\u7a7a\u95f4\u7684metadata\u8282\u70b9\u4e0b\uff0c\u4ee5YAML\u683c\u5f0f\u5b58\u50a8\uff0c\u6bcf\u4e2a\u903b\u8f91\u6570\u636e\u6e90\u72ec\u7acb\u5b58\u50a8\u3002\n+\n+```\n+metadata\n+    \u251c\u2500\u2500schema1\n+    \u251c      \u251c\u2500\u2500 [YAML text contents]     \n+    \u251c\u2500\u2500schema2\n+    \u251c      \u251c\u2500\u2500 [YAML text contents]    \n+    \u251c\u2500\u2500....\n+```\n+\n+## YAML Text Contents\n+\n+\u5728\u5143\u6570\u636e\u4e2d\u5fc3\u4e2d\uff0c\u5143\u6570\u636e\u5206\u4e3a `configuredSchemaMetaData` \u548c `unconfiguredSchemaMetaDataMap` \u4e24\u90e8\u5206\u3002\n+\n+\u5143\u6570\u636e\u5185\u5bb9\u76ee\u524d\u4e0d\u652f\u6301\u52a8\u6001\u4fee\u6539\u3002\n+\n+```\n+configuredSchemaMetaData:\n+  tables:                                       # \u8868\n+    t_order:                                    # \u8868\u540d\n+      columns:                                  # \u5217\n+        id:                                     # \u5217\u540d\n+          caseSensitive: false\n+          dataType: 0\n+          generated: false\n+          name: id\n+          primaryKey: trues\n+        order_id:\n+          caseSensitive: false\n+          dataType: 0\n+          generated: false\n+          name: order_id\n+          primaryKey: false\n+      indexs:                                   # \u7d22\u5f15\n+        t_user_order_id_index:                  # \u7d22\u5f15\u540d\n+          name: t_user_order_id_index\n+    t_order_item:\n+      columns:\n+        order_id:\n+          caseSensitive: false\n+          dataType: 0\n+          generated: false\n+          name: order_id\n+          primaryKey: false\n+unconfiguredSchemaMetaDataMap:\n+  ds_0:                                         # \u6570\u636e\u6e90\n+    tables:                                     # \u8868\n+      t_user:                                   # \u8868\u540d\n+        columns:                                # \u5217\n+          user_id:                              # \u5217\u540d\n+            caseSensitive: false\n+            dataType: 0\n+            generated: false\n+            name: user_id\n+            primaryKey: false\n+          id:\n+            caseSensitive: false\n+            dataType: 0\n+            generated: false\n+            name: id\n+            primaryKey: true\n+          order_id:\n+            caseSensitive: false\n+            dataType: 0\n+            generated: false\n+            name: order_id\n+            primaryKey: false\n+        indexes:                                # \u7d22\u5f15\n+          t_user_order_id_index:                # \u7d22\u5f15\u540d\n+            name: t_user_order_id_index\n+          t_user_user_id_index:\n+            name: t_user_user_id_index\n+          primary:\n+            name: PRIMARY\n+```\n+\n+### configuredSchemaMetaData\n+\n+\u5b58\u50a8\u6240\u6709\u914d\u7f6e\u4e86\u5206\u7247\u89c4\u5219\u7684\u6570\u636e\u6e90\u7684\u5143\u6570\u636e\u3002\n+\n+### unconfiguredSchemaMetaDataMap\n+\n+\u5b58\u50a8\u6ca1\u6709\u914d\u7f6e\u5206\u7247\u89c4\u5219\u7684\u6570\u636e\u6e90\u7684\u5143\u6570\u636e\u3002\n+\n+## \u53d8\u66f4\u901a\u77e5\n+\n+\u901a\u8fc7\u67d0\u4e00\u4e2aProxy\u5b9e\u4f8b\u6267\u884cDDL\u4ee5\u540e\uff0c\u5143\u6570\u636e\u4e2d\u5fc3\u901a\u8fc7\u4e8b\u4ef6\u673a\u5236\uff0c\u901a\u77e5\u5176\u5b83Proxy\u5b9e\u4f8b\u91cd\u65b0\u52a0\u8f7d\u5143\u6570\u636e\uff0c\u4fdd\u8bc1\u5143\u6570\u636e\u4e00\u81f4\u3002", "originalCommit": "0ef9ab39bdb2121c6773af97c96540bc554fc797", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ1NzA1Mg==", "url": "https://github.com/apache/shardingsphere/pull/5166#discussion_r407457052", "bodyText": "\u7cfb\u7edf -> ShardingSphere maybe better.", "author": "menghaoranss", "createdAt": "2020-04-13T12:34:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ0MDI4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ0MDQyMw==", "url": "https://github.com/apache/shardingsphere/pull/5166#discussion_r407440423", "bodyText": "Sharding-JDBC/Sharding-Proxy", "author": "kimmking", "createdAt": "2020-04-13T11:42:32Z", "path": "docs/document/content/features/orchestration/metadata-center.en.md", "diffHunk": "@@ -0,0 +1,103 @@\n++++\n+pre = \"<b>3.3.3. </b>\"\n+toc = true\n+title = \"Metadata Center\"\n+weight = 3\n++++\n+\n+## Motivation\n+\n+- Metadata is the core data of the data source used by Sharding-JDBC / Sharding-Proxy, which contains tables, columns, and indexes, etc. Metadata ensures that each component of ShardingSphere can run correctly.", "originalCommit": "0ef9ab39bdb2121c6773af97c96540bc554fc797", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ0MDYxNg==", "url": "https://github.com/apache/shardingsphere/pull/5166#discussion_r407440616", "bodyText": "missing namespace&orchestration node\uff1f", "author": "kimmking", "createdAt": "2020-04-13T11:43:08Z", "path": "docs/document/content/features/orchestration/metadata-center.cn.md", "diffHunk": "@@ -0,0 +1,103 @@\n++++\n+pre = \"<b>3.3.3. </b>\"\n+toc = true\n+title = \"\u5143\u6570\u636e\u4e2d\u5fc3\"\n+weight = 3\n++++\n+\n+## \u5b9e\u73b0\u52a8\u673a\n+\n+- \u5143\u6570\u636e\u662fSharding-JDBC/Sharding-Proxy\u6240\u4f7f\u7528\u7684\u6570\u636e\u6e90\u7684\u8868\u3001\u5217\u548c\u7d22\u5f15\u7b49\u6838\u5fc3\u6570\u636e\uff0c\u5143\u6570\u636e\u4fdd\u969cShardingSphere\u5404\u4e2a\u7ec4\u4ef6\u80fd\u591f\u6b63\u786e\u8fd0\u884c\u3002\n+\n+- \u5143\u6570\u636e\u4e2d\u5fc3\u5bf9\u5143\u6570\u636e\u8fdb\u884c\u7edf\u4e00\u7ec4\u7ec7\u548c\u7ba1\u7406\uff0c\u5b9e\u73b0\u5143\u6570\u636e\u7684\u7edf\u4e00\u52a0\u8f7d\u3001\u53d8\u66f4\u901a\u77e5\u548c\u6570\u636e\u540c\u6b65\u3002\n+\n+## \u5143\u6570\u636e\u4e2d\u5fc3\u6570\u636e\u7ed3\u6784\n+\n+\u5143\u6570\u636e\u4e2d\u5fc3\u5728\u5b9a\u4e49\u7684\u547d\u540d\u7a7a\u95f4\u7684metadata\u8282\u70b9\u4e0b\uff0c\u4ee5YAML\u683c\u5f0f\u5b58\u50a8\uff0c\u6bcf\u4e2a\u903b\u8f91\u6570\u636e\u6e90\u72ec\u7acb\u5b58\u50a8\u3002\n+\n+```", "originalCommit": "0ef9ab39bdb2121c6773af97c96540bc554fc797", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ0MDY4OQ==", "url": "https://github.com/apache/shardingsphere/pull/5166#discussion_r407440689", "bodyText": "as the above", "author": "kimmking", "createdAt": "2020-04-13T11:43:23Z", "path": "docs/document/content/features/orchestration/metadata-center.en.md", "diffHunk": "@@ -0,0 +1,103 @@\n++++\n+pre = \"<b>3.3.3. </b>\"\n+toc = true\n+title = \"Metadata Center\"\n+weight = 3\n++++\n+\n+## Motivation\n+\n+- Metadata is the core data of the data source used by Sharding-JDBC / Sharding-Proxy, which contains tables, columns, and indexes, etc. Metadata ensures that each component of ShardingSphere can run correctly.\n+\n+- The metadata center organizes and manages the metadata in a unified manner to realize the unified loading of metadata, change notifications and data synchronization.\n+\n+## Data Structure in Metadata Center\n+\n+The metadata center stores metadata in YAML under the metadata node of the defined namespace, and each logical data source is stored independently.\n+\n+```\n+metadata\n+    \u251c\u2500\u2500schema1\n+    \u251c      \u251c\u2500\u2500 [YAML text contents]     \n+    \u251c\u2500\u2500schema2\n+    \u251c      \u251c\u2500\u2500 [YAML text contents]    \n+    \u251c\u2500\u2500....\n+```\n+\n+## YAML text contents\n+\n+In the metadata center, metadata is divided into two parts: `configuredSchemaMetaData` and` unconfiguredSchemaMetaDataMap`.\n+\n+Dynamic modification of metadata content is not supported currently.\n+\n+```\n+configuredSchemaMetaData:\n+  tables:                                       # Tables\n+    t_order:                                    # table_name\n+      columns:                                  # Columns\n+        id:                                     # column_name\n+          caseSensitive: false\n+          dataType: 0\n+          generated: false\n+          name: id\n+          primaryKey: trues\n+        order_id:\n+          caseSensitive: false\n+          dataType: 0\n+          generated: false\n+          name: order_id\n+          primaryKey: false\n+      indexs:                                   # Indexes\n+        t_user_order_id_index:                  # index_name\n+          name: t_user_order_id_index\n+    t_order_item:\n+      columns:\n+        order_id:\n+          caseSensitive: false\n+          dataType: 0\n+          generated: false\n+          name: order_id\n+          primaryKey: false\n+unconfiguredSchemaMetaDataMap:\n+  ds_0:                                         # DataSources\n+    tables:                                     # Tables\n+      t_user:                                   # table_name\n+        columns:                                # Columns\n+          user_id:                              # column_name\n+            caseSensitive: false\n+            dataType: 0\n+            generated: false\n+            name: user_id\n+            primaryKey: false\n+          id:\n+            caseSensitive: false\n+            dataType: 0\n+            generated: false\n+            name: id\n+            primaryKey: true\n+          order_id:\n+            caseSensitive: false\n+            dataType: 0\n+            generated: false\n+            name: order_id\n+            primaryKey: false\n+        indexes:                                # Indexes\n+          t_user_order_id_index:                # index_name\n+            name: t_user_order_id_index\n+          t_user_user_id_index:\n+            name: t_user_user_id_index\n+          primary:\n+            name: PRIMARY\n+```\n+\n+### configuredSchemaMetaData\n+\n+Store metadata for all data sources configured with sharding rules.\n+\n+### unconfiguredSchemaMetaDataMap\n+\n+Store metadata for data sources that no sharding rules configured.\n+\n+## Change Notifications\n+\n+After DDL is executed through a certain Proxy instance, the metadata center notifies other Proxy instances to reload metadata through an event mechanism to ensure metadata consistency.", "originalCommit": "0ef9ab39bdb2121c6773af97c96540bc554fc797", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f91f28ca35b455ebcbe520ba24b0c4ad0f2eb7e7", "url": "https://github.com/apache/shardingsphere/commit/f91f28ca35b455ebcbe520ba24b0c4ad0f2eb7e7", "message": "for issue 5128, revise documents", "committedDate": "2020-04-13T12:32:38Z", "type": "commit"}]}