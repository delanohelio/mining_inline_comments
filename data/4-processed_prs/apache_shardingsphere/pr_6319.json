{"pr_number": 6319, "pr_title": "fix for rewrite of subquery", "pr_createdAt": "2020-07-10T07:52:41Z", "pr_url": "https://github.com/apache/shardingsphere/pull/6319", "timeline": [{"oid": "0db90241fcc5ad301d33df134ee5aabec978112e", "url": "https://github.com/apache/shardingsphere/commit/0db90241fcc5ad301d33df134ee5aabec978112e", "message": "fix for rewrite of subquery", "committedDate": "2020-07-10T07:50:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ1Mzg2Mg==", "url": "https://github.com/apache/shardingsphere/pull/6319#discussion_r453453862", "bodyText": "It seems two of those statements can be merged into one. Please simplify it.", "author": "tristaZero", "createdAt": "2020-07-13T06:11:10Z", "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-binder/src/main/java/org/apache/shardingsphere/sql/parser/binder/statement/dml/SelectStatementContext.java", "diffHunk": "@@ -192,42 +193,32 @@ public boolean isSameGroupByAndOrderByItems() {\n     \n     @Override\n     public Collection<SimpleTableSegment> getAllTables() {\n-        Collection<SimpleTableSegment> result = new LinkedList<>(getSimpleTableSegments());\n-        if (getSqlStatement().getWhere().isPresent()) {\n-            result.addAll(getAllTablesFromWhere(getSqlStatement().getWhere().get()));\n-        }\n-        result.addAll(getAllTablesFromProjections(getSqlStatement().getProjections()));\n-        if (getSqlStatement().getGroupBy().isPresent()) {\n-            result.addAll(getAllTablesFromOrderByItems(getSqlStatement().getGroupBy().get().getGroupByItems()));\n-        }\n-        if (getSqlStatement().getOrderBy().isPresent()) {\n-            result.addAll(getAllTablesFromOrderByItems(getSqlStatement().getOrderBy().get().getOrderByItems()));\n-        }\n+        Collection<SimpleTableSegment> result = getTableFromSelect(getSqlStatement());\n         return result;", "originalCommit": "0db90241fcc5ad301d33df134ee5aabec978112e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ1NDY0Nw==", "url": "https://github.com/apache/shardingsphere/pull/6319#discussion_r453454647", "bodyText": "Are there other cases covering more the subqueries?", "author": "tristaZero", "createdAt": "2020-07-13T06:14:03Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-rewrite/src/test/resources/sharding/select.xml", "diffHunk": "@@ -28,8 +28,8 @@\n     </rewrite-assertion>\n \n     <rewrite-assertion id=\"select_with_subquery\" db-type=\"MySQL\">\n-        <input sql=\"SELECT * FROM (select * from t_account where account_id=?) a WHERE account_id = 100\" parameters=\"100\" />\n-        <output sql=\"SELECT * FROM (select * from t_account_0 where account_id=?) a WHERE account_id = 100\" parameters=\"100\" />\n+        <input sql=\"SELECT * FROM (select t_account.account_id from t_account where t_account.account_id=?) a WHERE account_id = 100\" parameters=\"100\" />", "originalCommit": "0db90241fcc5ad301d33df134ee5aabec978112e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "282ffa6d995577e5b171ff4169f27806d930b765", "url": "https://github.com/apache/shardingsphere/commit/282ffa6d995577e5b171ff4169f27806d930b765", "message": "add some test case", "committedDate": "2020-07-13T06:42:04Z", "type": "commit"}]}