{"pr_number": 4996, "pr_title": "add sharding.transaction.seata.at.enable config to compatible with se\u2026", "pr_createdAt": "2020-03-29T14:04:50Z", "pr_url": "https://github.com/apache/shardingsphere/pull/4996", "timeline": [{"oid": "657150ad4ea610540e64e44ee7da1f290ef0d96f", "url": "https://github.com/apache/shardingsphere/commit/657150ad4ea610540e64e44ee7da1f290ef0d96f", "message": "add sharding.transaction.seata.at.enable config to compatible with seata global transaction", "committedDate": "2020-03-29T13:51:08Z", "type": "commit"}, {"oid": "ac36182d547d0d61de0f9e874d21f0635446dfad", "url": "https://github.com/apache/shardingsphere/commit/ac36182d547d0d61de0f9e874d21f0635446dfad", "message": "for checkstyle", "committedDate": "2020-03-29T14:05:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNTkxMg==", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399905912", "bodyText": "Constant for literal\uff1f", "author": "kimmking", "createdAt": "2020-03-30T03:13:37Z", "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "diffHunk": "@@ -47,34 +47,56 @@\n     \n     private final Map<String, DataSource> dataSourceMap = new HashMap<>();\n     \n-    private final FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+    private final String applicationId;\n+    \n+    private final String transactionServiceGroup;\n+    \n+    private final boolean enableSeataAT;\n+    \n+    public SeataATShardingTransactionManager() {\n+        FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+        enableSeataAT = configuration.getBoolean(\"sharding.transaction.seata.at.enable\", true);", "originalCommit": "ac36182d547d0d61de0f9e874d21f0635446dfad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5NzE2OQ==", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399997169", "bodyText": "I'll fix it in next PR", "author": "cherrylzhao", "createdAt": "2020-03-30T08:02:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNTkxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNjYzMg==", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399906632", "bodyText": "If turn off this flag, seata client is not initialized and seat-at is disabled?", "author": "kimmking", "createdAt": "2020-03-30T03:17:14Z", "path": "sharding-transaction/sharding-transaction-base/sharding-transaction-base-seata-at/src/main/java/org/apache/shardingsphere/transaction/base/seata/at/SeataATShardingTransactionManager.java", "diffHunk": "@@ -47,34 +47,56 @@\n     \n     private final Map<String, DataSource> dataSourceMap = new HashMap<>();\n     \n-    private final FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+    private final String applicationId;\n+    \n+    private final String transactionServiceGroup;\n+    \n+    private final boolean enableSeataAT;\n+    \n+    public SeataATShardingTransactionManager() {\n+        FileConfiguration configuration = new FileConfiguration(\"seata.conf\");\n+        enableSeataAT = configuration.getBoolean(\"sharding.transaction.seata.at.enable\", true);\n+        applicationId = configuration.getConfig(\"client.application.id\");\n+        transactionServiceGroup = configuration.getConfig(\"client.transaction.service.group\", \"default\");\n+    }\n     \n     @Override\n     public void init(final DatabaseType databaseType, final Collection<ResourceDataSource> resourceDataSources) {\n-        initSeataRPCClient();\n-        for (ResourceDataSource each : resourceDataSources) {\n-            dataSourceMap.put(each.getOriginalName(), new DataSourceProxy(each.getDataSource()));\n+        if (enableSeataAT) {", "originalCommit": "ac36182d547d0d61de0f9e874d21f0635446dfad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk5ODQ3Nw==", "url": "https://github.com/apache/shardingsphere/pull/4996#discussion_r399998477", "bodyText": "yes it is\uff0cmeantime physical datasource will not be wrapped to seata DataSourceProxy", "author": "cherrylzhao", "createdAt": "2020-03-30T08:04:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNjYzMg=="}], "type": "inlineReview"}]}