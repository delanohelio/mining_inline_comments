{"pr_number": 4497, "pr_title": "update example orchestration to 5.x", "pr_createdAt": "2020-02-27T08:49:06Z", "pr_url": "https://github.com/apache/shardingsphere/pull/4497", "timeline": [{"oid": "25b2e6ec42c7371e4d61426bc48ff6cbf42bea8b", "url": "https://github.com/apache/shardingsphere/commit/25b2e6ec42c7371e4d61426bc48ff6cbf42bea8b", "message": "update example orchestration to 5.x", "committedDate": "2020-02-27T11:05:34Z", "type": "commit"}, {"oid": "6e0c13bcdbb1ded052036ff5fe04ff7ced710dce", "url": "https://github.com/apache/shardingsphere/commit/6e0c13bcdbb1ded052036ff5fe04ff7ced710dce", "message": "update example-sharding-jdbc orchestration to 5.x", "committedDate": "2020-02-27T11:05:34Z", "type": "commit"}, {"oid": "c300134b27b9a5297493f53db3583dedc4e8a20b", "url": "https://github.com/apache/shardingsphere/commit/c300134b27b9a5297493f53db3583dedc4e8a20b", "message": "Modify the reference path of the imported class", "committedDate": "2020-02-27T13:38:55Z", "type": "commit"}, {"oid": "c300134b27b9a5297493f53db3583dedc4e8a20b", "url": "https://github.com/apache/shardingsphere/commit/c300134b27b9a5297493f53db3583dedc4e8a20b", "message": "Modify the reference path of the imported class", "committedDate": "2020-02-27T13:38:55Z", "type": "forcePushed"}, {"oid": "33182177010bf245694c6f2bf0ec5b271f8fe5c9", "url": "https://github.com/apache/shardingsphere/commit/33182177010bf245694c6f2bf0ec5b271f8fe5c9", "message": "update pom&overwrite config", "committedDate": "2020-02-28T02:00:42Z", "type": "commit"}, {"oid": "33182177010bf245694c6f2bf0ec5b271f8fe5c9", "url": "https://github.com/apache/shardingsphere/commit/33182177010bf245694c6f2bf0ec5b271f8fe5c9", "message": "update pom&overwrite config", "committedDate": "2020-02-28T02:00:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ3MTEyNQ==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r385471125", "bodyText": "I understand nacos's namespace is namespace's id, not namespace's name.", "author": "dongzl", "createdAt": "2020-02-28T01:56:18Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-raw-jdbc-example/src/main/resources/META-INF/nacos/cloud/encrypt.yaml", "diffHunk": "@@ -1,10 +1,18 @@\n orchestration:\n-  name: demo_yaml_ds_encrypt\n-  overwrite: false\n-  registry:\n-    type: nacos\n+  demo_naocs_yaml_ds_encrypt:\n+    orchestrationType: config_center\n+    instanceType: nacos\n     serverLists: localhost:8848\n-    namespace:\n+    namespace: orchestration-yaml-demo", "originalCommit": "c300134b27b9a5297493f53db3583dedc4e8a20b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA2OTU1Ng==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r386069556", "bodyText": "yeah You're right. thx", "author": "geomonlin", "createdAt": "2020-03-01T01:57:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ3MTEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ3MTUwNA==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r385471504", "bodyText": "The same to above.", "author": "dongzl", "createdAt": "2020-02-28T01:58:02Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-raw-jdbc-example/src/main/resources/META-INF/nacos/local/encrypt.yaml", "diffHunk": "@@ -1,13 +1,21 @@\n orchestration:\n-  name: demo_yaml_ds_encrypt\n-  overwrite: true\n-  registry:\n-    type: nacos\n+  demo_nacos_yaml_ds_encrypt:\n+    orchestrationType: config_center\n+    instanceType: nacos\n     serverLists: localhost:8848\n-    namespace:\n+    namespace: orchestration-yaml-demo", "originalCommit": "c300134b27b9a5297493f53db3583dedc4e8a20b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ3MjYyNw==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r385472627", "bodyText": "There should be a blank line.", "author": "dongzl", "createdAt": "2020-02-28T02:02:43Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-raw-jdbc-example/src/main/resources/META-INF/zookeeper/cloud/encrypt.yaml", "diffHunk": "@@ -1,7 +1,8 @@\n orchestration:\n-  name: demo_yaml_ds_encrypt\n-  overwrite: false\n-  registry:\n-    type: zookeeper\n+  demo_yaml_ds_encrypt:\n+    orchestrationType: config_center,registry_center\n+    instanceType: zookeeper\n     serverLists: localhost:2181\n     namespace: orchestration-yaml-demo\n+    props:\n+      overwrite: true", "originalCommit": "c300134b27b9a5297493f53db3583dedc4e8a20b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ3MzE0OQ==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r385473149", "bodyText": "There should be a blank line.", "author": "dongzl", "createdAt": "2020-02-28T02:05:08Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-spring-boot-example/src/main/resources/application-local-nacos-encrypt.properties", "diffHunk": "@@ -31,8 +31,14 @@ spring.shardingsphere.encrypt.tables.t_order.columns.status.encryptor=status_enc\n spring.shardingsphere.props.query.with.cipher.comlum=true\n spring.shardingsphere.props.sql.show=true\n \n-spring.shardingsphere.orchestration.name=demo_spring_boot_ds_encrypt\n-spring.shardingsphere.orchestration.overwrite=true\n-spring.shardingsphere.orchestration.registry.type=nacos\n-spring.shardingsphere.orchestration.registry.server-lists=localhost:8848\n-spring.shardingsphere.orchestration.registry.namespace=\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_encrypt.orchestration-type=config_center\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_encrypt.instance-type=nacos\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_encrypt.server-lists=localhost:8848\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_encrypt.namespace=\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_encrypt.props.overwrite=true\n+\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_encrypt.orchestration-type=registry_center\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_encrypt.instance-type=zookeeper\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_encrypt.server-lists=localhost:2181\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_encrypt.namespace=orchestration-spring-boot-demo\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_encrypt.props.overwrite=true", "originalCommit": "c300134b27b9a5297493f53db3583dedc4e8a20b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ3MzI1NQ==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r385473255", "bodyText": "The same to above.", "author": "dongzl", "createdAt": "2020-02-28T02:05:26Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-spring-boot-example/src/main/resources/application-local-nacos-master-slave.properties", "diffHunk": "@@ -23,8 +23,14 @@ spring.shardingsphere.masterslave.name=ds_ms\n spring.shardingsphere.masterslave.master-data-source-name=ds_master\n spring.shardingsphere.masterslave.slave-data-source-names=ds_slave_0,ds_slave_1\n \n-spring.shardingsphere.orchestration.name=demo_spring_boot_ds_ms\n-spring.shardingsphere.orchestration.overwrite=true\n-spring.shardingsphere.orchestration.registry.type=nacos\n-spring.shardingsphere.orchestration.registry.server-lists=localhost:8848\n-spring.shardingsphere.orchestration.registry.namespace=\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_ms.orchestration-type=config_center\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_ms.instance-type=nacos\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_ms.server-lists=localhost:8848\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_ms.namespace=\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_ms.props.overwrite=true\n+\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_ms.orchestration-type=registry_center\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_ms.instance-type=zookeeper\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_ms.server-lists=localhost:2181\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_ms.namespace=orchestration-spring-boot-demo\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_ms.props.overwrite=true", "originalCommit": "c300134b27b9a5297493f53db3583dedc4e8a20b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ3MzczOQ==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r385473739", "bodyText": "There are redundant blank line.", "author": "dongzl", "createdAt": "2020-02-28T02:07:32Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-spring-boot-example/src/main/resources/application-local-nacos-sharding-databases-tables.properties", "diffHunk": "@@ -35,8 +35,15 @@ spring.shardingsphere.sharding.tables.t_order_item.key-generator.column=order_it\n spring.shardingsphere.sharding.tables.t_order_item.key-generator.type=SNOWFLAKE\n spring.shardingsphere.sharding.tables.t_order_item.key-generator.props.worker.id=123\n \n-spring.shardingsphere.orchestration.name=demo_spring_boot_ds_sharding\n-spring.shardingsphere.orchestration.overwrite=true\n-spring.shardingsphere.orchestration.registry.type=nacos\n-spring.shardingsphere.orchestration.registry.server-lists=localhost:8848\n-spring.shardingsphere.orchestration.registry.namespace=\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_sharding.orchestration-type=config_center\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_sharding.instance-type=nacos\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_sharding.server-lists=localhost:8848\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_sharding.namespace=\n+spring.shardingsphere.orchestration.demo_spring_boot_ds_sharding.props.overwrite=true\n+\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_sharding.orchestration-type=registry_center\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_sharding.instance-type=zookeeper\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_sharding.server-lists=localhost:2181\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_sharding.namespace=orchestration-spring-boot-demo\n+spring.shardingsphere.orchestration.demo1_spring_boot_ds_sharding.props.overwrite=true\n+", "originalCommit": "c300134b27b9a5297493f53db3583dedc4e8a20b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ3NTEwOQ==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r385475109", "bodyText": "Why fix this type param?", "author": "dongzl", "createdAt": "2020-02-28T02:13:10Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-spring-namespace-example/src/main/resources/META-INF/zookeeper/local/application-encrypt.xml", "diffHunk": "@@ -59,15 +59,15 @@\n             </encrypt:tables>\n             <encrypt:encryptors>\n                 <encrypt:encryptor id=\"name_encryptor\" type=\"AES\" props-ref=\"props\"/>\n-                <encrypt:encryptor id=\"pwd_encryptor\" type=\"assistedTest\" />", "originalCommit": "c300134b27b9a5297493f53db3583dedc4e8a20b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d69d30d012ee7ad13278cd912b0c385b22926163", "url": "https://github.com/apache/shardingsphere/commit/d69d30d012ee7ad13278cd912b0c385b22926163", "message": "update orchestration config", "committedDate": "2020-02-28T09:56:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzNjE0NA==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r386036144", "bodyText": "why remove namespace?", "author": "kimmking", "createdAt": "2020-02-29T15:44:54Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-raw-jdbc-example/src/main/resources/META-INF/nacos/local/encrypt.yaml", "diffHunk": "@@ -3,7 +3,7 @@ orchestration:\n     orchestrationType: config_center\n     instanceType: nacos\n     serverLists: localhost:8848\n-    namespace: orchestration-yaml-demo", "originalCommit": "d69d30d012ee7ad13278cd912b0c385b22926163", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA2OTUwOQ==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r386069509", "bodyText": "This namespace  become namespaceId in naocs. If write namespace ,found should write  value of namespaceId \"db5af0a7-ae65-49b2-810a-df5cb77103a1\". However Show the configuration with empty namespace by default in nacos.", "author": "geomonlin", "createdAt": "2020-03-01T01:55:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzNjE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzNjgxMw==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r386036813", "bodyText": "why add a shardingtype swtich?", "author": "kimmking", "createdAt": "2020-02-29T15:55:32Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-raw-jdbc-example/src/main/java/org/apache/shardingsphere/example/orchestration/raw/jdbc/config/RegistryCenterConfigurationUtil.java", "diffHunk": "@@ -31,20 +34,58 @@\n \n     private static final String NACOS_NAMESPACE = \"\";\n     \n-    public static RegistryCenterConfiguration getZooKeeperConfiguration() {\n-        RegistryCenterConfiguration result = new RegistryCenterConfiguration(\"zookeeper\");\n+    public static Map<String, InstanceConfiguration> getZooKeeperConfiguration(String overwrite, ShardingType shardingType) {\n+        Map<String, InstanceConfiguration> instanceConfigurationMap = new HashMap<String, InstanceConfiguration>();\n+        Properties properties = new Properties();\n+        properties.setProperty(\"overwrite\", overwrite);\n+        InstanceConfiguration result = new InstanceConfiguration(\"zookeeper\", properties);\n         result.setServerLists(ZOOKEEPER_CONNECTION_STRING);\n         result.setNamespace(NAMESPACE);\n-        return result;\n+        result.setOrchestrationType(\"registry_center,config_center\");\n+        switch (shardingType) {\n+            case SHARDING_DATABASES_AND_TABLES:", "originalCommit": "d69d30d012ee7ad13278cd912b0c385b22926163", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA3NjI1OQ==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r386076259", "bodyText": "Diff dataSource name persist to different dataId.  As shown in the picture\uff1a", "author": "geomonlin", "createdAt": "2020-03-01T04:35:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzNjgxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAzNzgzNQ==", "url": "https://github.com/apache/shardingsphere/pull/4497#discussion_r386037835", "bodyText": "the last blank is standard.\nshould be retrieved.", "author": "kimmking", "createdAt": "2020-02-29T16:11:04Z", "path": "examples/sharding-jdbc-example/orchestration-example/orchestration-spring-namespace-example/src/main/resources/META-INF/zookeeper/local/application-master-slave.xml", "diffHunk": "@@ -15,44 +15,44 @@\n                         http://shardingsphere.apache.org/schema/shardingsphere/masterslave/master-slave.xsd\n                         http://shardingsphere.apache.org/schema/shardingsphere/orchestration\n                         http://shardingsphere.apache.org/schema/shardingsphere/orchestration/orchestration.xsd\">\n-    <import resource=\"classpath*:META-INF/zookeeper/registry-center.xml\" />\n-    <context:component-scan base-package=\"org.apache.shardingsphere.example.core.mybatis\" />\n+    <import resource=\"classpath*:META-INF/zookeeper/registry-center.xml\"/>\n+    <context:component-scan base-package=\"org.apache.shardingsphere.example.core.mybatis\"/>\n \n     <bean id=\"demo_ds_master\" class=\"com.zaxxer.hikari.HikariDataSource\" destroy-method=\"close\">\n         <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\"/>\n         <property name=\"jdbcUrl\" value=\"jdbc:mysql://localhost:3306/demo_ds_master\"/>\n         <property name=\"username\" value=\"root\"/>\n         <property name=\"password\" value=\"\"/>\n     </bean>\n-    \n+\n     <bean id=\"demo_ds_slave_0\" class=\"com.zaxxer.hikari.HikariDataSource\" destroy-method=\"close\">\n         <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\"/>\n         <property name=\"jdbcUrl\" value=\"jdbc:mysql://localhost:3306/demo_ds_slave_0\"/>\n         <property name=\"username\" value=\"root\"/>\n         <property name=\"password\" value=\"\"/>\n     </bean>\n-    \n+\n     <bean id=\"demo_ds_slave_1\" class=\"com.zaxxer.hikari.HikariDataSource\" destroy-method=\"close\">\n         <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\"/>\n         <property name=\"jdbcUrl\" value=\"jdbc:mysql://localhost:3306/demo_ds_slave_1\"/>\n         <property name=\"username\" value=\"root\"/>\n         <property name=\"password\" value=\"\"/>\n     </bean>\n \n-    <master-slave:load-balance-algorithm id=\"randomStrategy\" type=\"RANDOM\" />", "originalCommit": "d69d30d012ee7ad13278cd912b0c385b22926163", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f991aa44b69cc31f5141aa552f5bc15084b38084", "url": "https://github.com/apache/shardingsphere/commit/f991aa44b69cc31f5141aa552f5bc15084b38084", "message": "update encrypt type and format", "committedDate": "2020-03-01T05:41:57Z", "type": "commit"}, {"oid": "f991aa44b69cc31f5141aa552f5bc15084b38084", "url": "https://github.com/apache/shardingsphere/commit/f991aa44b69cc31f5141aa552f5bc15084b38084", "message": "update encrypt type and format", "committedDate": "2020-03-01T05:41:57Z", "type": "forcePushed"}, {"oid": "eb54d3bdaf56590399f295b69096c46ec517aa22", "url": "https://github.com/apache/shardingsphere/commit/eb54d3bdaf56590399f295b69096c46ec517aa22", "message": "update pom name", "committedDate": "2020-03-01T08:48:56Z", "type": "commit"}]}