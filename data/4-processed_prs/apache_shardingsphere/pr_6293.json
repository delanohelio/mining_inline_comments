{"pr_number": 6293, "pr_title": "fix sql support doc", "pr_createdAt": "2020-07-07T10:02:53Z", "pr_url": "https://github.com/apache/shardingsphere/pull/6293", "timeline": [{"oid": "a713e03281380a40175ddcd5c14070d89df486ad", "url": "https://github.com/apache/shardingsphere/commit/a713e03281380a40175ddcd5c14070d89df486ad", "message": "fix sql support doc", "committedDate": "2020-07-07T10:01:28Z", "type": "commit"}, {"oid": "7d2ca47217a01eabbce67ab90938ccaf7b26239b", "url": "https://github.com/apache/shardingsphere/commit/7d2ca47217a01eabbce67ab90938ccaf7b26239b", "message": "add sharding rewrite test case and fix sql support doc", "committedDate": "2020-07-08T03:41:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ4NjkyNg==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r451486926", "bodyText": "Please express this one in Chinese.", "author": "tristaZero", "createdAt": "2020-07-08T11:59:08Z", "path": "docs/document/content/features/sharding/use-norms/sql.cn.md", "diffHunk": "@@ -149,5 +150,4 @@ SELECT * FROM t_order WHERE to_date(create_time, 'yyyy-mm-dd') = '2019-01-01';\n \n | SQL                                                                                         | \u4e0d\u652f\u6301\u539f\u56e0                          |\n | ------------------------------------------------------------------------------------------- |----------------------------------- |\n-| SELECT SUM(DISTINCT col1), SUM(col1) FROM tbl_name                                          | \u540c\u65f6\u4f7f\u7528\u666e\u901a\u805a\u5408\u51fd\u6570\u548cDISTINCT\u805a\u5408\u51fd\u6570 |\n-\n+| SELECT SUM(DISTINCT tbl_name.col1), SUM(tbl_name.col1) FROM tbl_name | Use column owner that is not table alias |", "originalCommit": "7d2ca47217a01eabbce67ab90938ccaf7b26239b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ4ODIyNQ==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r451488225", "bodyText": "\u5b50\u67e5\u8be2\u4e2dprojection, where \u4e2dcolumn \u5305\u542btable,\u6ca1\u6709\u4f7f\u7528table\u522b\u540d\n\n\u5b50\u67e5\u8be2\u7684SELECT\u4e2d\u7684\u67e5\u8be2\u5217\u548cWHERE\u6761\u4ef6\u4e2d\u67e5\u8be2\u5217\u5305\u542b\u8868\u540d\uff0c\u4f46\u6ca1\u6709\u4f7f\u7528\u8868\u522b\u540d\nMy understanding is correct, isn't it?", "author": "tristaZero", "createdAt": "2020-07-08T12:01:37Z", "path": "docs/document/content/features/sharding/use-norms/sql.cn.md", "diffHunk": "@@ -110,19 +110,20 @@ SELECT * FROM t_order WHERE to_date(create_time, 'yyyy-mm-dd') = '2019-01-01';\n | DROP INDEX idx_name                                                                         |                          |\n | SELECT DISTINCT * FROM tbl_name WHERE col1 = ?                                              |                          |\n | SELECT COUNT(DISTINCT col1) FROM tbl_name                                                   |                          |\n+| SELECT subquery_alias.col1 FROM (select tbl_alias.col1 from tbl_name tbl_alias where tbl_alias.col2=?) subquery_alias                                                   |                                         |\n \n ### \u4e0d\u652f\u6301\u7684SQL\n \n | SQL                                                                                        | \u4e0d\u652f\u6301\u539f\u56e0                  |\n | ------------------------------------------------------------------------------------------ | -------------------------- |\n | INSERT INTO tbl_name (col1, col2, ...) VALUES(1+2, ?, ...)                                 | VALUES\u8bed\u53e5\u4e0d\u652f\u6301\u8fd0\u7b97\u8868\u8fbe\u5f0f   |\n | INSERT INTO tbl_name (col1, col2, ...) SELECT col1, col2, ... FROM tbl_name WHERE col3 = ? | INSERT .. SELECT           |\n-| SELECT COUNT(col1) as count_alias FROM tbl_name GROUP BY col1 HAVING count_alias > ?       | HAVING                     |\n | SELECT * FROM tbl_name1 UNION SELECT * FROM tbl_name2                                      | UNION                      |\n | SELECT * FROM tbl_name1 UNION ALL SELECT * FROM tbl_name2                                  | UNION ALL                  |\n-| SELECT * FROM ds.tbl_name1                                                                 | \u5305\u542bschema                 |\n | SELECT SUM(DISTINCT col1), SUM(col1) FROM tbl_name                                         | \u8be6\u89c1DISTINCT\u652f\u6301\u60c5\u51b5\u8be6\u7ec6\u8bf4\u660e |\n | SELECT * FROM tbl_name WHERE to_date(create_time, 'yyyy-mm-dd') = ?                        | \u4f1a\u5bfc\u81f4\u5168\u8def\u7531                |\n+| (SELECT * FROM tbl_name)                                                                   | \u6682\u4e0d\u652f\u6301\u52a0\u62ec\u53f7\u7684\u67e5\u8be2                              |\n+| SELECT subquery_alias.col1 FROM (select tbl_name.col1 from tbl_name where tbl_name.col2=?) subquery_alias| \u5b50\u67e5\u8be2\u4e2dprojection, where \u4e2dcolumn \u5305\u542btable,\u6ca1\u6709\u4f7f\u7528table\u522b\u540d                                         |", "originalCommit": "7d2ca47217a01eabbce67ab90938ccaf7b26239b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkwNTg0Ng==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r451905846", "bodyText": "Yes", "author": "jingshanglu", "createdAt": "2020-07-09T01:04:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ4ODIyNQ=="}], "type": "inlineReview"}, {"oid": "a38ae3ffd33c1bdde1f1cfe288bb2ea9a4929ba5", "url": "https://github.com/apache/shardingsphere/commit/a38ae3ffd33c1bdde1f1cfe288bb2ea9a4929ba5", "message": "fix", "committedDate": "2020-07-09T01:07:27Z", "type": "commit"}, {"oid": "57bfa10ceaa513b5bc9a16f0249b45a091c752be", "url": "https://github.com/apache/shardingsphere/commit/57bfa10ceaa513b5bc9a16f0249b45a091c752be", "message": "Merge remote-tracking branch 'upstream/master' into test", "committedDate": "2020-07-13T09:20:35Z", "type": "commit"}, {"oid": "14f6af0c92490b7bbaadea68b2d54f3277a9d2c2", "url": "https://github.com/apache/shardingsphere/commit/14f6af0c92490b7bbaadea68b2d54f3277a9d2c2", "message": "fix", "committedDate": "2020-07-13T10:01:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5NDEwNw==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r454094107", "bodyText": "So where is the explanation for this one?", "author": "tristaZero", "createdAt": "2020-07-14T04:34:43Z", "path": "docs/document/content/features/sharding/use-norms/sql.cn.md", "diffHunk": "@@ -110,19 +110,20 @@ SELECT * FROM t_order WHERE to_date(create_time, 'yyyy-mm-dd') = '2019-01-01';\n | DROP INDEX idx_name                                                                         |                          |\n | SELECT DISTINCT * FROM tbl_name WHERE col1 = ?                                              |                          |\n | SELECT COUNT(DISTINCT col1) FROM tbl_name                                                   |                          |\n+| SELECT subquery_alias.col1 FROM (select tbl_name.col1 from tbl_name where tbl_name.col2=?) subquery_alias                                                   |                                         |", "originalCommit": "14f6af0c92490b7bbaadea68b2d54f3277a9d2c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDExNDQ0NQ==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r454114445", "bodyText": "this one is supported sql.", "author": "jingshanglu", "createdAt": "2020-07-14T05:41:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5NDEwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5NTIxNg==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r454095216", "bodyText": "Many of users maybe have no idea about projection,  maybe \u67e5\u8be2\u5217 will be better\nThere is no alias in this statement, so your explanation looks strange and uneasy understanding. My suggestion is to add IF condition, for example, \u67e5\u8be2\u5217\u662f\u51fd\u6570\u8868\u8fbe\u5f0f\u65f6\uff0c\u67e5\u8be2\u5217\u524d\u4e0d\u80fd\u4f7f\u7528\u8868\u540d\uff1b\u82e5\u67e5\u8be2\u8868\u5b58\u5728\u522b\u540d\uff0c\u5219\u53ef\u4f7f\u7528\u8868\u7684\u522b\u540d", "author": "tristaZero", "createdAt": "2020-07-14T04:38:58Z", "path": "docs/document/content/features/sharding/use-norms/sql.cn.md", "diffHunk": "@@ -110,19 +110,20 @@ SELECT * FROM t_order WHERE to_date(create_time, 'yyyy-mm-dd') = '2019-01-01';\n | DROP INDEX idx_name                                                                         |                          |\n | SELECT DISTINCT * FROM tbl_name WHERE col1 = ?                                              |                          |\n | SELECT COUNT(DISTINCT col1) FROM tbl_name                                                   |                          |\n+| SELECT subquery_alias.col1 FROM (select tbl_name.col1 from tbl_name where tbl_name.col2=?) subquery_alias                                                   |                                         |\n \n ### \u4e0d\u652f\u6301\u7684SQL\n \n | SQL                                                                                        | \u4e0d\u652f\u6301\u539f\u56e0                  |\n | ------------------------------------------------------------------------------------------ | -------------------------- |\n | INSERT INTO tbl_name (col1, col2, ...) VALUES(1+2, ?, ...)                                 | VALUES\u8bed\u53e5\u4e0d\u652f\u6301\u8fd0\u7b97\u8868\u8fbe\u5f0f   |\n | INSERT INTO tbl_name (col1, col2, ...) SELECT col1, col2, ... FROM tbl_name WHERE col3 = ? | INSERT .. SELECT           |\n-| SELECT COUNT(col1) as count_alias FROM tbl_name GROUP BY col1 HAVING count_alias > ?       | HAVING                     |\n | SELECT * FROM tbl_name1 UNION SELECT * FROM tbl_name2                                      | UNION                      |\n | SELECT * FROM tbl_name1 UNION ALL SELECT * FROM tbl_name2                                  | UNION ALL                  |\n-| SELECT * FROM ds.tbl_name1                                                                 | \u5305\u542bschema                 |\n | SELECT SUM(DISTINCT col1), SUM(col1) FROM tbl_name                                         | \u8be6\u89c1DISTINCT\u652f\u6301\u60c5\u51b5\u8be6\u7ec6\u8bf4\u660e |\n | SELECT * FROM tbl_name WHERE to_date(create_time, 'yyyy-mm-dd') = ?                        | \u4f1a\u5bfc\u81f4\u5168\u8def\u7531                |\n+| (SELECT * FROM tbl_name)                                                                   | \u6682\u4e0d\u652f\u6301\u52a0\u62ec\u53f7\u7684\u67e5\u8be2                              |\n+| SELECT MAX(tbl_name.col1) FROM tbl_name                                                    | projection\u4e2d\u5728\u51fd\u6570\u4e2d\u9700\u8981\u4f7f\u7528\u8868\u522b\u540d\u5f15\u7528\u67e5\u8be2\u5217                                         |", "originalCommit": "14f6af0c92490b7bbaadea68b2d54f3277a9d2c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5NjcxMw==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r454096713", "bodyText": "My concern is that your expression is for users, for whom it is the first and vital guideline, IMO. So please be careful with this document. Thanks.", "author": "tristaZero", "createdAt": "2020-07-14T04:44:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5NTIxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5NTMwMw==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r454095303", "bodyText": "Same with the above one.", "author": "tristaZero", "createdAt": "2020-07-14T04:39:18Z", "path": "docs/document/content/features/sharding/use-norms/sql.cn.md", "diffHunk": "@@ -149,5 +150,4 @@ SELECT * FROM t_order WHERE to_date(create_time, 'yyyy-mm-dd') = '2019-01-01';\n \n | SQL                                                                                         | \u4e0d\u652f\u6301\u539f\u56e0                          |\n | ------------------------------------------------------------------------------------------- |----------------------------------- |\n-| SELECT SUM(DISTINCT col1), SUM(col1) FROM tbl_name                                          | \u540c\u65f6\u4f7f\u7528\u666e\u901a\u805a\u5408\u51fd\u6570\u548cDISTINCT\u805a\u5408\u51fd\u6570 |\n-\n+| SELECT SUM(DISTINCT tbl_name.col1), SUM(tbl_name.col1) FROM tbl_name                        | projection\u4e2d\u5728\u51fd\u6570\u4e2d\u9700\u8981\u4f7f\u7528\u8868\u522b\u540d\u6765\u5f15\u7528\u67e5\u8be2\u5217 |", "originalCommit": "14f6af0c92490b7bbaadea68b2d54f3277a9d2c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5NTQxOA==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r454095418", "bodyText": "Same with the first one.", "author": "tristaZero", "createdAt": "2020-07-14T04:39:40Z", "path": "docs/document/content/features/sharding/use-norms/sql.en.md", "diffHunk": "@@ -110,19 +110,20 @@ When shardingColumn in expressions and functions, ShardingSphere will use full r\n | DROP INDEX idx_name                                                                         |                                         |\n | SELECT DISTINCT * FROM tbl_name WHERE col1 = ?                                              |                                         |\n | SELECT COUNT(DISTINCT col1) FROM tbl_name                                                   |                                         |\n+| SELECT subquery_alias.col1 FROM (select tbl_name.col1 from tbl_name where tbl_name.col2=?) subquery_alias                                                   |                                         |", "originalCommit": "14f6af0c92490b7bbaadea68b2d54f3277a9d2c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5NTU2MQ==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r454095561", "bodyText": "Please change them togather.", "author": "tristaZero", "createdAt": "2020-07-14T04:40:03Z", "path": "docs/document/content/features/sharding/use-norms/sql.en.md", "diffHunk": "@@ -110,19 +110,20 @@ When shardingColumn in expressions and functions, ShardingSphere will use full r\n | DROP INDEX idx_name                                                                         |                                         |\n | SELECT DISTINCT * FROM tbl_name WHERE col1 = ?                                              |                                         |\n | SELECT COUNT(DISTINCT col1) FROM tbl_name                                                   |                                         |\n+| SELECT subquery_alias.col1 FROM (select tbl_name.col1 from tbl_name where tbl_name.col2=?) subquery_alias                                                   |                                         |\n \n ### Unsupported SQL\n \n | SQL                                                                                        | Reason                                              |\n | ------------------------------------------------------------------------------------------ | --------------------------------------------------- |\n | INSERT INTO tbl_name (col1, col2, ...) VALUES(1+2, ?, ...)                                 | VALUES clause does not support operation expression |\n | INSERT INTO tbl_name (col1, col2, ...) SELECT col1, col2, ... FROM tbl_name WHERE col3 = ? | INSERT .. SELECT                                    |\n-| SELECT COUNT(col1) as count_alias FROM tbl_name GROUP BY col1 HAVING count_alias > ?       | HAVING                                              |\n | SELECT * FROM tbl_name1 UNION SELECT * FROM tbl_name2                                      | UNION                                               |\n | SELECT * FROM tbl_name1 UNION ALL SELECT * FROM tbl_name2                                  | UNION ALL                                           |\n-| SELECT * FROM ds.tbl_name1                                                                 | Contain schema                                      |\n | SELECT SUM(DISTINCT col1), SUM(col1) FROM tbl_name                                         | See DISTINCT availability detail                    |\n | SELECT * FROM tbl_name WHERE to_date(create_time, 'yyyy-mm-dd') = ?                        | Lead to full routing                                |\n+| (SELECT * FROM tbl_name)                                                                   | Contain brackets                              |\n+| SELECT MAX(tbl_name.col1) FROM tbl_name                                                    | Please use table alias to refer to columns in function     |", "originalCommit": "14f6af0c92490b7bbaadea68b2d54f3277a9d2c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bbb8c88da8c2a9b0b07602fd2ae03c45b8cec5c1", "url": "https://github.com/apache/shardingsphere/commit/bbb8c88da8c2a9b0b07602fd2ae03c45b8cec5c1", "message": "fix", "committedDate": "2020-07-14T05:56:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE5NzQyNQ==", "url": "https://github.com/apache/shardingsphere/pull/6293#discussion_r454197425", "bodyText": "The select function item contains TableName. Otherwise, If this query table had an alias, then TableAlias could work well in select function items.", "author": "tristaZero", "createdAt": "2020-07-14T08:39:28Z", "path": "docs/document/content/features/sharding/use-norms/sql.en.md", "diffHunk": "@@ -110,19 +110,20 @@ When shardingColumn in expressions and functions, ShardingSphere will use full r\n | DROP INDEX idx_name                                                                         |                                         |\n | SELECT DISTINCT * FROM tbl_name WHERE col1 = ?                                              |                                         |\n | SELECT COUNT(DISTINCT col1) FROM tbl_name                                                   |                                         |\n+| SELECT subquery_alias.col1 FROM (select tbl_name.col1 from tbl_name where tbl_name.col2=?) subquery_alias                                                   |                                         |\n \n ### Unsupported SQL\n \n | SQL                                                                                        | Reason                                              |\n | ------------------------------------------------------------------------------------------ | --------------------------------------------------- |\n | INSERT INTO tbl_name (col1, col2, ...) VALUES(1+2, ?, ...)                                 | VALUES clause does not support operation expression |\n | INSERT INTO tbl_name (col1, col2, ...) SELECT col1, col2, ... FROM tbl_name WHERE col3 = ? | INSERT .. SELECT                                    |\n-| SELECT COUNT(col1) as count_alias FROM tbl_name GROUP BY col1 HAVING count_alias > ?       | HAVING                                              |\n | SELECT * FROM tbl_name1 UNION SELECT * FROM tbl_name2                                      | UNION                                               |\n | SELECT * FROM tbl_name1 UNION ALL SELECT * FROM tbl_name2                                  | UNION ALL                                           |\n-| SELECT * FROM ds.tbl_name1                                                                 | Contain schema                                      |\n | SELECT SUM(DISTINCT col1), SUM(col1) FROM tbl_name                                         | See DISTINCT availability detail                    |\n | SELECT * FROM tbl_name WHERE to_date(create_time, 'yyyy-mm-dd') = ?                        | Lead to full routing                                |\n+| (SELECT * FROM tbl_name)                                                                   | Contain brackets                              |\n+| SELECT MAX(tbl_name.col1) FROM tbl_name                                                    | When the select item is a function expression, the real table name cannot be used before the column; if refer a column with table name,please set an alias for the table and use alias to refer a column with the alias |", "originalCommit": "bbb8c88da8c2a9b0b07602fd2ae03c45b8cec5c1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "93b346295bd8a5b61be344282cd6678bba33ac4d", "url": "https://github.com/apache/shardingsphere/commit/93b346295bd8a5b61be344282cd6678bba33ac4d", "message": "fix", "committedDate": "2020-07-14T08:58:14Z", "type": "commit"}]}