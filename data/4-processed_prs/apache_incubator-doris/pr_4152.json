{"pr_number": 4152, "pr_title": "[Spill To Disk][2/6] Add some runningtime function and change some function will be called in the future", "pr_createdAt": "2020-07-23T04:26:46Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4152", "timeline": [{"oid": "332054e415310340131a8a89ae4a87b7611f4cbb", "url": "https://github.com/apache/incubator-doris/commit/332054e415310340131a8a89ae4a87b7611f4cbb", "message": "[Spill To Disk][2/6] Add some function and change some function will use in future.\n\nissue:#3926", "committedDate": "2020-07-23T04:12:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI0MzI0NQ==", "url": "https://github.com/apache/incubator-doris/pull/4152#discussion_r459243245", "bodyText": "CheckFreeListHeadIsNotNull", "author": "wutiangan", "createdAt": "2020-07-23T06:43:13Z", "path": "be/src/runtime/bufferpool/suballocator.cc", "diffHunk": "@@ -219,6 +230,10 @@ unique_ptr<Suballocation> Suballocator::PopFreeListHead(int list_idx) {\n   return result;\n }\n \n+bool Suballocator::CheckFreeListHead(int list_idx) const {\n+    return free_lists_[list_idx] != nullptr;", "originalCommit": "332054e415310340131a8a89ae4a87b7611f4cbb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI0NTA4Nw==", "url": "https://github.com/apache/incubator-doris/pull/4152#discussion_r459245087", "bodyText": "Modify annotation\uff0c the annotation is not consistent with function.", "author": "wutiangan", "createdAt": "2020-07-23T06:48:16Z", "path": "be/src/runtime/bufferpool/suballocator.h", "diffHunk": "@@ -128,6 +129,10 @@ class Suballocator {\n   // if list is empty.\n   std::unique_ptr<Suballocation> PopFreeListHead(int list_idx);\n \n+  // Get the allocation at the head of the free list at index 'list_idx'. Return nullptr\n+  // if list is empty.\n+  bool CheckFreeListHead(int list_idx) const;\n+", "originalCommit": "332054e415310340131a8a89ae4a87b7611f4cbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxMDYyNA==", "url": "https://github.com/apache/incubator-doris/pull/4152#discussion_r459310624", "bodyText": "ok\uff0cI will change the name", "author": "HappenLee", "createdAt": "2020-07-23T09:03:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI0NTA4Nw=="}], "type": "inlineReview"}, {"oid": "8dd5ccf43330201f47c503ab52fa154d9d1d29aa", "url": "https://github.com/apache/incubator-doris/commit/8dd5ccf43330201f47c503ab52fa154d9d1d29aa", "message": "change function name CheckFreeListHeadNotNull", "committedDate": "2020-07-23T09:07:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMyNTAwMw==", "url": "https://github.com/apache/incubator-doris/pull/4152#discussion_r459325003", "bodyText": "I think the implementation isn't consistent with the method comment and name.\nOnly if there has one tuple. _fixed_tuple_row_size will large than zero.\n    for (int i = 0; i < _desc.tuple_descriptors().size(); ++i) {\n        const TupleDescriptor* tuple_desc = _desc.tuple_descriptors()[i];\n        const int tuple_byte_size = tuple_desc->byte_size();\n        _fixed_tuple_row_size += tuple_byte_size;\n        if (!tuple_desc->string_slots().empty()) {\n            _string_slots.push_back(make_pair(i, tuple_desc->string_slots()));\n        }\n        // if (!tuple_desc->collection_slots().empty()) {\n        //     _collection_slots.push_back(make_pair(i, tuple_desc->collection_slots()));\n        // }\n    }", "author": "kangkaisen", "createdAt": "2020-07-23T09:30:20Z", "path": "be/src/runtime/buffered_tuple_stream2.h", "diffHunk": "@@ -257,6 +257,11 @@ class BufferedTupleStream2 {\n     bool has_tuple_footprint() const {\n         return _fixed_tuple_row_size > 0 || !_string_slots.empty() || _nullable_tuple;\n     }\n+    /// Returns true if the row consumes any memory. If false, the stream only needs to\n+    /// store the count of rows.\n+    bool row_consumes_memory() const {", "originalCommit": "8dd5ccf43330201f47c503ab52fa154d9d1d29aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgyNDQ0Nw==", "url": "https://github.com/apache/incubator-doris/pull/4152#discussion_r459824447", "bodyText": "I will change the fun name", "author": "HappenLee", "createdAt": "2020-07-24T02:26:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMyNTAwMw=="}], "type": "inlineReview"}, {"oid": "76551d9f12354f2e944046f3dc20f44e8992b964", "url": "https://github.com/apache/incubator-doris/commit/76551d9f12354f2e944046f3dc20f44e8992b964", "message": "Remove the unreasonable code and add some comments", "committedDate": "2020-07-24T10:28:01Z", "type": "commit"}]}