{"pr_number": 3761, "pr_title": "[StorageEngine] Make StorageEngine::open return more detailed info", "pr_createdAt": "2020-06-03T09:49:18Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3761", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTEyODM3Mg==", "url": "https://github.com/apache/incubator-doris/pull/3761#discussion_r435128372", "bodyText": "Why not change it to RETURN_NOT_OK_STATUS_WITH_WARN?", "author": "morningman", "createdAt": "2020-06-04T09:46:15Z", "path": "be/src/olap/data_dir.cpp", "diffHunk": "@@ -267,12 +281,13 @@ Status DataDir::_init_meta() {\n     _meta = new (std::nothrow) OlapMeta(_path);\n     if (_meta == nullptr) {\n         LOG(WARNING) << \"new olap meta failed\";\n-        return Status::InternalError(\"new olap meta failed\");\n+        return Status::MemoryAllocFailed(\"new olap meta failed\");", "originalCommit": "b7592844e89478b90d7c6e6740100edc636c6ace", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMwMjkxNA==", "url": "https://github.com/apache/incubator-doris/pull/3761#discussion_r435302914", "bodyText": "Updated.", "author": "acelyc111", "createdAt": "2020-06-04T14:29:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTEyODM3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMzMzM3MA==", "url": "https://github.com/apache/incubator-doris/pull/3761#discussion_r435333370", "bodyText": "better to capture explictly.", "author": "imay", "createdAt": "2020-06-04T15:09:05Z", "path": "be/src/olap/storage_engine.cpp", "diffHunk": "@@ -170,22 +167,28 @@ OLAPStatus StorageEngine::_open() {\n \n     _parse_default_rowset_type();\n \n-    return OLAP_SUCCESS;\n+    return Status::OK();\n }\n \n-OLAPStatus StorageEngine::_init_store_map() {\n+Status StorageEngine::_init_store_map() {\n     std::vector<DataDir*> tmp_stores;\n     std::vector<std::thread> threads;\n     std::atomic<bool> init_error{false};\n+    SpinLock error_msg_lock;\n+    std::string error_msg;\n     for (auto& path : _options.store_paths) {\n         DataDir* store = new DataDir(path.path, path.capacity_bytes, path.storage_medium,\n                                      _tablet_manager.get(), _txn_manager.get());\n         tmp_stores.emplace_back(store);\n-        threads.emplace_back([store, &init_error]() {\n+        threads.emplace_back([&]() {", "originalCommit": "cfaaf6a5584a48db017a566be450f04c77799251", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f03284079bca948dc9cfca43ebb4f2cc8141e6cb", "url": "https://github.com/apache/incubator-doris/commit/f03284079bca948dc9cfca43ebb4f2cc8141e6cb", "message": "[StorageEngine] Make StorageEngine::open return more detailed info\n\nStorageEngine::open just return a very vague status info when failed,\nwe have to check logs to find out the root reason, and it's not\nconvenient to check logs if we run unit tests in CI dockers.\nIt would be better to return more detailed failure info to point out\nthe root reason, for example, it may return error status with message\n\"file descriptors limit is too small\".", "committedDate": "2020-06-05T15:58:45Z", "type": "commit"}, {"oid": "6d174ead30a91ccb34499cfb8c475dbcf0092867", "url": "https://github.com/apache/incubator-doris/commit/6d174ead30a91ccb34499cfb8c475dbcf0092867", "message": "fix", "committedDate": "2020-06-05T15:58:45Z", "type": "commit"}, {"oid": "58c3d5b85d95fbfc342949975f264d6724f7f316", "url": "https://github.com/apache/incubator-doris/commit/58c3d5b85d95fbfc342949975f264d6724f7f316", "message": "capture", "committedDate": "2020-06-05T15:58:45Z", "type": "commit"}, {"oid": "58c3d5b85d95fbfc342949975f264d6724f7f316", "url": "https://github.com/apache/incubator-doris/commit/58c3d5b85d95fbfc342949975f264d6724f7f316", "message": "capture", "committedDate": "2020-06-05T15:58:45Z", "type": "forcePushed"}]}