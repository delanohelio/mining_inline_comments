{"pr_number": 2796, "pr_title": "Improve comparison and printing of Version", "pr_createdAt": "2020-01-19T04:28:30Z", "pr_url": "https://github.com/apache/incubator-doris/pull/2796", "timeline": [{"oid": "0dc19357f00932e0eca8f6913893032f5dee9ab0", "url": "https://github.com/apache/incubator-doris/commit/0dc19357f00932e0eca8f6913893032f5dee9ab0", "message": "Improve comparison and printing of Version\n\nThere are two members in `Version`:` first` and `second`.\nThere are many places where we need to print one `Version` object  and\ncompare two `Version` objects, but in the current code, these two members\nare accessed directly, which makes the code very tedious.\n\nThis patch mainly do:\n1. Adds overloaded methods for `operator<<()` for `Version`, so\n   we can directly print a Version object;\n2. Adds the `cantains()` method to determine whether it is an containment\n   relationship;\n3. Uses `operator==()` to determine if two `Version` objects are equal.\n\nBecause there are too many places need to be modified, there are still some\nnaked codes left, which will be modified later.\n\nThis patch also removes some necessary header file references.\n\nNo functional changes in this patch.", "committedDate": "2020-01-19T04:04:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3MzgwNw==", "url": "https://github.com/apache/incubator-doris/pull/2796#discussion_r368273807", "bodyText": "it is not correspond with the definition of contains() function", "author": "chaoyli", "createdAt": "2020-01-19T08:01:56Z", "path": "be/src/olap/tablet.cpp", "diffHunk": "@@ -272,16 +255,11 @@ OLAPStatus Tablet::add_rowset(RowsetSharedPtr rowset, bool need_persist) {\n     // yiguolei: temp code, should remove the rowset contains by this rowset\n     // but it should be removed in multi path version\n     for (auto& it : _rs_version_map) {", "originalCommit": "0dc19357f00932e0eca8f6913893032f5dee9ab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3Nzk5Nw==", "url": "https://github.com/apache/incubator-doris/pull/2796#discussion_r368277997", "bodyText": "Done.\nshould be rowset->version().contains(it.first)", "author": "lingbin", "createdAt": "2020-01-19T09:14:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3MzgwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3NDEyNg==", "url": "https://github.com/apache/incubator-doris/pull/2796#discussion_r368274126", "bodyText": "first <= other.first && second >= other.second", "author": "chaoyli", "createdAt": "2020-01-19T08:08:36Z", "path": "be/src/olap/olap_common.h", "diffHunk": "@@ -189,20 +186,29 @@ struct Version {\n     int64_t second;\n \n     Version(int64_t first_, int64_t second_) : first(first_), second(second_) {}\n-\n     Version() : first(0), second(0) {}\n \n+    friend std::ostream& operator<<(std::ostream& os, const Version& version);\n+\n     bool operator!=(const Version& rhs) const {\n         return first != rhs.first || second != rhs.second;\n     }\n \n     bool operator==(const Version& rhs) const {\n         return first == rhs.first && second == rhs.second;\n     }\n+\n+    bool contains(const Version& other) const {", "originalCommit": "0dc19357f00932e0eca8f6913893032f5dee9ab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3NjkwOQ==", "url": "https://github.com/apache/incubator-doris/pull/2796#discussion_r368276909", "bodyText": "Done. Thank you for your careful review.", "author": "lingbin", "createdAt": "2020-01-19T08:57:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3NDEyNg=="}], "type": "inlineReview"}, {"oid": "614bfa49d4136d5b827175d9c65b0ad5df948449", "url": "https://github.com/apache/incubator-doris/commit/614bfa49d4136d5b827175d9c65b0ad5df948449", "message": "Fix compare typo", "committedDate": "2020-01-19T09:19:29Z", "type": "commit"}]}