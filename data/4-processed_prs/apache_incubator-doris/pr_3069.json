{"pr_number": 3069, "pr_title": "Support 64 bit timestamp in from_unixtime", "pr_createdAt": "2020-03-10T11:08:51Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3069", "timeline": [{"oid": "b22a1ea1fa3f76a978af03b19b1daa3fa24402aa", "url": "https://github.com/apache/incubator-doris/commit/b22a1ea1fa3f76a978af03b19b1daa3fa24402aa", "message": "support timestamp to 64bit in broker load", "committedDate": "2020-03-10T07:35:06Z", "type": "commit"}, {"oid": "e320f8a78f30af1f444f37a3470894e8760a489e", "url": "https://github.com/apache/incubator-doris/commit/e320f8a78f30af1f444f37a3470894e8760a489e", "message": "fix", "committedDate": "2020-03-10T11:02:05Z", "type": "commit"}, {"oid": "642337196a0b66f458bcaca824abdf782e7698a2", "url": "https://github.com/apache/incubator-doris/commit/642337196a0b66f458bcaca824abdf782e7698a2", "message": "fix", "committedDate": "2020-03-10T11:06:23Z", "type": "commit"}, {"oid": "6d6f96e8a847b4b0140772578aaa398833f820ea", "url": "https://github.com/apache/incubator-doris/commit/6d6f96e8a847b4b0140772578aaa398833f820ea", "message": "fix parquet timestamp to 64 bit", "committedDate": "2020-03-10T13:40:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMzEwMw==", "url": "https://github.com/apache/incubator-doris/pull/3069#discussion_r390703103", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        timestamp = ts_array->Value(_current_line_of_batch) / 1000000000; // convert to Second\n          \n          \n            \n                        timestamp = ts_array->Value(_current_line_of_batch) / 1000000000L; // convert to Second", "author": "imay", "createdAt": "2020-03-11T01:42:27Z", "path": "be/src/exec/parquet_reader.cpp", "diffHunk": "@@ -188,30 +189,38 @@ Status ParquetReaderWrap::read_record_batch(const std::vector<SlotDescriptor*>&\n Status ParquetReaderWrap::handle_timestamp(const std::shared_ptr<arrow::TimestampArray>& ts_array, uint8_t *buf, int32_t *wbytes) {\n     const auto type = std::dynamic_pointer_cast<arrow::TimestampType>(ts_array->type());\n     // Doris only supports seconds\n-    time_t timestamp = 0;\n+    int64_t timestamp = 0;\n     switch (type->unit()) {\n         case arrow::TimeUnit::type::NANO: {// INT96\n-            timestamp = (time_t)((int64_t)ts_array->Value(_current_line_of_batch) / 1000000000); // convert to Second\n+            timestamp = ts_array->Value(_current_line_of_batch) / 1000000000; // convert to Second", "originalCommit": "6d6f96e8a847b4b0140772578aaa398833f820ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMzU1NA==", "url": "https://github.com/apache/incubator-doris/pull/3069#discussion_r390703554", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                while(current_t > 0) {\n          \n          \n            \n                while (current_t > 0) {\n          \n      \n    \n    \n  \n\nAdd some comments about what this block is doing.", "author": "imay", "createdAt": "2020-03-11T01:44:19Z", "path": "be/src/runtime/datetime_value.cpp", "diffHunk": "@@ -1557,13 +1557,28 @@ bool DateTimeValue::from_unixtime(int64_t timestamp, const std::string& timezone\n     if (timestamp < 0 || timestamp > 253402271999L) {\n         return false;\n     }\n+\n     boost::local_time::time_zone_ptr local_time_zone = TimezoneDatabase::find_timezone(timezone);\n     if (local_time_zone == nullptr) {\n         return false;                            \n     }\n-    boost::local_time::local_date_time lt(boost::posix_time::from_time_t(timestamp), local_time_zone);\n+\n+    int64_t current_t = timestamp;\n+    boost::posix_time::ptime time = boost::posix_time::ptime(boost::gregorian::date(1970,1,1));\n+\n+    while(current_t > 0) {", "originalCommit": "6d6f96e8a847b4b0140772578aaa398833f820ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0c1b83702f6ae8f8fed87c655dafa7481b436f03", "url": "https://github.com/apache/incubator-doris/commit/0c1b83702f6ae8f8fed87c655dafa7481b436f03", "message": "fix format", "committedDate": "2020-03-13T07:33:34Z", "type": "commit"}, {"oid": "dd00ba6f35309f3431505de50196a24382161f96", "url": "https://github.com/apache/incubator-doris/commit/dd00ba6f35309f3431505de50196a24382161f96", "message": "Merge branch 'master' of https://github.com/apache/incubator-doris into output_scale", "committedDate": "2020-03-14T13:46:16Z", "type": "commit"}]}