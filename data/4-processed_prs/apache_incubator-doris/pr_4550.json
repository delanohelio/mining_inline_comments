{"pr_number": 4550, "pr_title": "\u3010Feature\u3011Doris can  set default configuration of database data quota and replica quota #4540#", "pr_createdAt": "2020-09-07T07:11:11Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4550", "timeline": [{"oid": "66dc41008c5024e32b251ee90ce1b6042accb8a0", "url": "https://github.com/apache/incubator-doris/commit/66dc41008c5024e32b251ee90ce1b6042accb8a0", "message": "Doris FE can set default configuration of database database quota and replica quota #4540#", "committedDate": "2020-09-06T14:20:55Z", "type": "commit"}, {"oid": "fffdc388fd618e711b3ab16705687a56839aa542", "url": "https://github.com/apache/incubator-doris/commit/fffdc388fd618e711b3ab16705687a56839aa542", "message": "Update default_db_data_quota_bytes and default_db_replica_quota_bytes description of  fe.config.md", "committedDate": "2020-09-07T12:31:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MDE4Ng==", "url": "https://github.com/apache/incubator-doris/pull/4550#discussion_r486360186", "bodyText": "If change this to Config, different FE may has different configuration. So this will result in inconsistency of meta data.\nThis is just a default value filled in for compatibility with old data. I suggest to leave it as FeConstants.default_db_replica_quota_size", "author": "morningman", "createdAt": "2020-09-10T13:52:53Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/Database.java", "diffHunk": "@@ -483,7 +483,7 @@ public void readFields(DataInput in) throws IOException {\n         if (Catalog.getCurrentCatalogJournalVersion() >= FeMetaVersion.VERSION_81) {\n             replicaQuotaSize = in.readLong();\n         } else {\n-            replicaQuotaSize = FeConstants.default_db_replica_quota_size;\n+            replicaQuotaSize = Config.default_db_replica_quota_bytes;", "originalCommit": "fffdc388fd618e711b3ab16705687a56839aa542", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQxOTE4Mw==", "url": "https://github.com/apache/incubator-doris/pull/4550#discussion_r486419183", "bodyText": "Hi morningman:\nYou are right, I restore the modification of default_db_replica_quota_size.", "author": "zhaojintaozhao", "createdAt": "2020-09-10T15:07:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MDE4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MjQ5OQ==", "url": "https://github.com/apache/incubator-doris/pull/4550#discussion_r486362499", "bodyText": "The unit is wrong. This is not a \"byte size\", but a \"number of\" replicas.", "author": "morningman", "createdAt": "2020-09-10T13:54:51Z", "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1250,4 +1250,16 @@\n      */\n     @ConfField(mutable = true, masterOnly = true)\n     public static boolean enable_batch_delete_by_default = false;\n+\n+    /**\n+     * Used to set default db data quota bytes.\n+     */\n+    @ConfField(mutable = true, masterOnly = false)\n+    public static long default_db_data_quota_bytes = 1024 * 1024 * 1024 * 1024L; // 1TB\n+\n+    /**\n+     * Used to set default db replica quota bytes.\n+     */\n+    @ConfField(mutable = true, masterOnly = false)\n+    public static long default_db_replica_quota_bytes = 1024 * 1024 * 1024;", "originalCommit": "fffdc388fd618e711b3ab16705687a56839aa542", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQxOTM5Mw==", "url": "https://github.com/apache/incubator-doris/pull/4550#discussion_r486419393", "bodyText": "I restore the modification of default_db_replica_quota_size.", "author": "zhaojintaozhao", "createdAt": "2020-09-10T15:07:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MjQ5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MzI1OQ==", "url": "https://github.com/apache/incubator-doris/pull/4550#discussion_r486363259", "bodyText": "Both config should be masterOnly = true", "author": "morningman", "createdAt": "2020-09-10T13:55:29Z", "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1250,4 +1250,16 @@\n      */\n     @ConfField(mutable = true, masterOnly = true)\n     public static boolean enable_batch_delete_by_default = false;\n+\n+    /**\n+     * Used to set default db data quota bytes.\n+     */\n+    @ConfField(mutable = true, masterOnly = false)\n+    public static long default_db_data_quota_bytes = 1024 * 1024 * 1024 * 1024L; // 1TB", "originalCommit": "fffdc388fd618e711b3ab16705687a56839aa542", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQxNjIzNg==", "url": "https://github.com/apache/incubator-doris/pull/4550#discussion_r486416236", "bodyText": "Yes, that's right. I change \"masterOnly\" to true", "author": "zhaojintaozhao", "createdAt": "2020-09-10T15:03:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MzI1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQyMDgxNw==", "url": "https://github.com/apache/incubator-doris/pull/4550#discussion_r486420817", "bodyText": "OK\uff0c I change the \"masterOnly\" property of default_db_data_quota_bytes to true", "author": "zhaojintaozhao", "createdAt": "2020-09-10T15:09:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MzI1OQ=="}], "type": "inlineReview"}, {"oid": "cbc1c8bd987c0effa6df4b519139fd4ab6beafdb", "url": "https://github.com/apache/incubator-doris/commit/cbc1c8bd987c0effa6df4b519139fd4ab6beafdb", "message": "#4540 restore the modification of default_db_replica_quota_size, and change masterOnly property of default_db_data_quota_bytes is true", "committedDate": "2020-09-10T14:50:11Z", "type": "commit"}]}