{"pr_number": 3098, "pr_title": "[Bug] tablet meta is not updated correctly after compaction", "pr_createdAt": "2020-03-13T03:30:06Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3098", "timeline": [{"oid": "6ffb4d21c313684de6f5eee6ed3ab7bb98cf29d5", "url": "https://github.com/apache/incubator-doris/commit/6ffb4d21c313684de6f5eee6ed3ab7bb98cf29d5", "message": "fix bug", "committedDate": "2020-03-13T03:19:29Z", "type": "commit"}, {"oid": "5574b05f61545bddec3b6a343db36f9c8e8d4a2d", "url": "https://github.com/apache/incubator-doris/commit/5574b05f61545bddec3b6a343db36f9c8e8d4a2d", "message": "fix bug", "committedDate": "2020-03-13T03:37:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAxNjMzOQ==", "url": "https://github.com/apache/incubator-doris/pull/3098#discussion_r392016339", "bodyText": "Why add a check for largest_segment_group->current_num_rows_per_row_block() == 0?\nYou encounter this issue #2750?", "author": "kangkaisen", "createdAt": "2020-03-13T03:40:55Z", "path": "be/src/olap/rowset/alpha_rowset.cpp", "diffHunk": "@@ -166,7 +166,9 @@ OLAPStatus AlphaRowset::split_range(\n     RowBlockPosition step_pos;\n \n     std::shared_ptr<SegmentGroup> largest_segment_group = _segment_group_with_largest_size();\n-    if (largest_segment_group == nullptr) {\n+    if (largest_segment_group == nullptr || largest_segment_group->current_num_rows_per_row_block() == 0) {", "originalCommit": "5574b05f61545bddec3b6a343db36f9c8e8d4a2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjEzMjQ3NA==", "url": "https://github.com/apache/incubator-doris/pull/3098#discussion_r392132474", "bodyText": "Yes, so I and a check here to avoid coredump in our product env, but leave a warning log to observe. This problem still needs to be analyzed.", "author": "morningman", "createdAt": "2020-03-13T10:02:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAxNjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE5NTg1MA==", "url": "https://github.com/apache/incubator-doris/pull/3098#discussion_r392195850", "bodyText": "OK", "author": "kangkaisen", "createdAt": "2020-03-13T12:24:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAxNjMzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAxNjY2Mw==", "url": "https://github.com/apache/incubator-doris/pull/3098#discussion_r392016663", "bodyText": "I think we shouldn't remove these logs.\nThese logs are very important for track transaction issue.", "author": "kangkaisen", "createdAt": "2020-03-13T03:42:55Z", "path": "be/src/olap/task/engine_publish_version_task.cpp", "diffHunk": "@@ -60,7 +60,7 @@ OLAPStatus EnginePublishVersionTask::finish() {\n             OLAPStatus publish_status = OLAP_SUCCESS;\n             TabletInfo tablet_info = tablet_rs.first;\n             RowsetSharedPtr rowset = tablet_rs.second;\n-            LOG(INFO) << \"begin to publish version on tablet. \"\n+            VLOG(3) << \"begin to publish version on tablet. \"", "originalCommit": "5574b05f61545bddec3b6a343db36f9c8e8d4a2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjEzMzU1Nw==", "url": "https://github.com/apache/incubator-doris/pull/3098#discussion_r392133557", "bodyText": "There are too many this kind of logs in our env. Why you need a \"begin\" log?", "author": "morningman", "createdAt": "2020-03-13T10:04:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAxNjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE5NzMwNA==", "url": "https://github.com/apache/incubator-doris/pull/3098#discussion_r392197304", "bodyText": "Would better keep all publish version and transaction log. Our publish version and transaction performance is still poor. We need these logs to track issue.", "author": "kangkaisen", "createdAt": "2020-03-13T12:27:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAxNjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjIzOTU5Mw==", "url": "https://github.com/apache/incubator-doris/pull/3098#discussion_r392239593", "bodyText": "OK, I will leave the begin and finish log", "author": "morningman", "createdAt": "2020-03-13T13:51:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAxNjY2Mw=="}], "type": "inlineReview"}, {"oid": "997063c8d931c62add20acc0c989eed24c86cde5", "url": "https://github.com/apache/incubator-doris/commit/997063c8d931c62add20acc0c989eed24c86cde5", "message": "fix by review", "committedDate": "2020-03-13T13:50:48Z", "type": "commit"}]}