{"pr_number": 3734, "pr_title": "[Memory Engine] Add MemTabletScan", "pr_createdAt": "2020-05-30T11:38:11Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3734", "timeline": [{"oid": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb", "url": "https://github.com/apache/incubator-doris/commit/f9da6f48b7bb94500af41b992de247c7b8b6ccbb", "message": "[Memory Engine] Add MemTabletScan", "committedDate": "2020-05-30T11:31:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5MzgyMA==", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433593820", "bodyText": "In what situation, _data_dir is nullptr?", "author": "chaoyli", "createdAt": "2020-06-02T02:57:41Z", "path": "be/src/olap/base_tablet.cpp", "diffHunk": "@@ -44,11 +43,13 @@ OLAPStatus BaseTablet::set_tablet_state(TabletState state) {\n }\n \n void BaseTablet::_gen_tablet_path() {\n-    std::string path = _data_dir->path() + DATA_PREFIX;\n-    path = path_util::join_path_segments(path, std::to_string(_tablet_meta->shard_id()));\n-    path = path_util::join_path_segments(path, std::to_string(_tablet_meta->tablet_id()));\n-    path = path_util::join_path_segments(path, std::to_string(_tablet_meta->schema_hash()));\n-    _tablet_path = path;\n+    if (_data_dir != nullptr) {", "originalCommit": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY1Mzg1NA==", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433653854", "bodyText": "In unittest", "author": "decster", "createdAt": "2020-06-02T06:44:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5MzgyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5NzMxMA==", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433597310", "bodyText": "What's the use of _limit?", "author": "chaoyli", "createdAt": "2020-06-02T03:13:59Z", "path": "be/src/olap/memory/mem_tablet_scan.h", "diffHunk": "@@ -0,0 +1,82 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+#pragma once\n+\n+#include \"olap/memory/common.h\"\n+#include \"olap/memory/row_block.h\"\n+#include \"olap/memory/schema.h\"\n+\n+namespace doris {\n+namespace memory {\n+\n+class ScanSpec {\n+public:\n+    ScanSpec(vector<std::string>&& columns, uint64_t version = UINT64_MAX,\n+             uint64_t limit = UINT64_MAX)\n+            : _version(version), _limit(limit), _columns(std::move(columns)) {}\n+\n+    uint64_t version() const { return _version; }\n+\n+    uint64_t limit() const { return _limit; }\n+\n+    const vector<std::string> columns() const { return _columns; }\n+\n+private:\n+    friend class MemTablet;\n+\n+    uint64_t _version = UINT64_MAX;\n+    uint64_t _limit = UINT64_MAX;", "originalCommit": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY1NDE1NA==", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433654154", "bodyText": "For example: select * from tablet limit 10;", "author": "decster", "createdAt": "2020-06-02T06:45:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5NzMxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5NzQ0OA==", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433597448", "bodyText": "use max_version may be better.", "author": "chaoyli", "createdAt": "2020-06-02T03:14:39Z", "path": "be/src/olap/memory/mem_tablet.h", "diffHunk": "@@ -79,6 +81,8 @@ class MemTablet : public BaseTablet {\n \n     std::mutex _write_lock;\n \n+    std::atomic<uint64_t> _latest_version;", "originalCommit": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY3NDY3MQ==", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433674671", "bodyText": "OK", "author": "decster", "createdAt": "2020-06-02T07:29:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5NzQ0OA=="}], "type": "inlineReview"}, {"oid": "efef1bf193b4d5ecb506973dbfd1f7f6a1e73472", "url": "https://github.com/apache/incubator-doris/commit/efef1bf193b4d5ecb506973dbfd1f7f6a1e73472", "message": "[Memory Engine] Add MemTabletScan: address review comments", "committedDate": "2020-06-02T06:53:45Z", "type": "commit"}]}