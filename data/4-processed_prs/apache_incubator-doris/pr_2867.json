{"pr_number": 2867, "pr_title": "Fix bug that _min_percentage_of_error_disk was not initialized", "pr_createdAt": "2020-02-09T13:31:16Z", "pr_url": "https://github.com/apache/incubator-doris/pull/2867", "timeline": [{"oid": "5fe55e8a49c4636bd8b790ff3320591505bf317b", "url": "https://github.com/apache/incubator-doris/commit/5fe55e8a49c4636bd8b790ff3320591505bf317b", "message": "Fix bug that _min_percentage_of_error_disk was not initialized\n\nIn `StorageEngine`, the member `_min_percentage_of_error_disk` was not\ninitialized (so it defaults to 0), which causes the process to exit\nwhenever one disk fails.\n\nWhat we expect is that exit the process only when the number of\nfailed disks reach a certain percentage.\n\nAlso, this variable should mean the maximum percentage of\nerror disks allowed, not the minimum, so change the configuration\nname to `max_percentage_of_error_disk`", "committedDate": "2020-02-09T13:30:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NjkwOA==", "url": "https://github.com/apache/incubator-doris/pull/2867#discussion_r376786908", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                bool _too_many_disks_are_broken(uint32_t unused_num, uint32_t total_num);\n          \n          \n            \n                bool _check_disks_broken_percentage(uint32_t unused_num, uint32_t total_num);", "author": "kangkaisen", "createdAt": "2020-02-09T14:09:13Z", "path": "be/src/olap/storage_engine.h", "diffHunk": "@@ -225,7 +224,7 @@ class StorageEngine {\n \n     OLAPStatus _judge_and_update_effective_cluster_id(int32_t cluster_id);\n \n-    OLAPStatus _start_bg_worker();\n+    bool _too_many_disks_are_broken(uint32_t unused_num, uint32_t total_num);", "originalCommit": "5fe55e8a49c4636bd8b790ff3320591505bf317b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc5NDIwMw==", "url": "https://github.com/apache/incubator-doris/pull/2867#discussion_r376794203", "bodyText": "Ummm, coincidentally, I did take some time to name it. Not to be pedantic, but I do think the original is better.  :-)\nThe method's return type is bool, return true means: \"yes, it is too many, so we should do something(the process will exit)\".\nso, finally, I choosed from these two:\n\n_are_too_many_disks_broken()\n_too_many_disks_are_broken()\n\nOn the other hand, percentage is a neutral noun(although we do judge by percentage), returning true, can not directly indicate whether it is a high or a low percentage,  or whether we expect it to be high or low. And like some other check_xxx()methods, It may be misinterpreted as: when true is returned, it is a valid situation (so we don't need to do anything).\nbut if we choose _check_disks_broken_percentage_is_too_hign(), it would be too long.", "author": "lingbin", "createdAt": "2020-02-09T15:52:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NjkwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg0Mzk4MQ==", "url": "https://github.com/apache/incubator-doris/pull/2867#discussion_r376843981", "bodyText": "OK", "author": "kangkaisen", "createdAt": "2020-02-10T02:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NjkwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg2MDE2NA==", "url": "https://github.com/apache/incubator-doris/pull/2867#discussion_r376860164", "bodyText": "_too_many_disks_on_failure()", "author": "chaoyli", "createdAt": "2020-02-10T03:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NjkwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgzNjk0NQ==", "url": "https://github.com/apache/incubator-doris/pull/2867#discussion_r376836945", "bodyText": "How about set the default to 0 to make it strict, so that we won't miss the broken disks", "author": "morningman", "createdAt": "2020-02-10T01:20:54Z", "path": "be/src/common/config.h", "diffHunk": "@@ -203,7 +203,8 @@ namespace config {\n     CONF_Int32(disk_stat_monitor_interval, \"5\");\n     CONF_Int32(unused_rowset_monitor_interval, \"30\");\n     CONF_String(storage_root_path, \"${DORIS_HOME}/storage\");\n-    CONF_Int32(min_percentage_of_error_disk, \"50\");\n+    // BE process will exit if the percentage of error disk reach this value.\n+    CONF_Int32(max_percentage_of_error_disk, \"50\");", "originalCommit": "5fe55e8a49c4636bd8b790ff3320591505bf317b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg0NTc1Ng==", "url": "https://github.com/apache/incubator-doris/pull/2867#discussion_r376845756", "bodyText": "Ok", "author": "lingbin", "createdAt": "2020-02-10T02:23:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgzNjk0NQ=="}], "type": "inlineReview"}, {"oid": "039ba38d2dd88ca532bf89c92ab88ed8b11a0301", "url": "https://github.com/apache/incubator-doris/commit/039ba38d2dd88ca532bf89c92ab88ed8b11a0301", "message": "make max_percentage_of_error_disk conf default to 0", "committedDate": "2020-02-10T02:23:20Z", "type": "commit"}, {"oid": "de867b0014b8d415e207697ec4f16bf302bafe67", "url": "https://github.com/apache/incubator-doris/commit/de867b0014b8d415e207697ec4f16bf302bafe67", "message": "Change method name to `too_many_disks_are_failed()`", "committedDate": "2020-02-10T08:00:31Z", "type": "commit"}]}