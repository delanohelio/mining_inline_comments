{"pr_number": 3867, "pr_title": "[Doris On ES][Docs] refator documentation for doe", "pr_createdAt": "2020-06-15T08:08:47Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3867", "timeline": [{"oid": "2fa37ab259e63a03c480fe9dc149bad563c98fad", "url": "https://github.com/apache/incubator-doris/commit/2fa37ab259e63a03c480fe9dc149bad563c98fad", "message": "[Doris On ES] refator documentation for doe", "committedDate": "2020-06-15T08:05:48Z", "type": "commit"}, {"oid": "068dbdf321ae5b577baaf6f1d41680d6dc199f2a", "url": "https://github.com/apache/incubator-doris/commit/068dbdf321ae5b577baaf6f1d41680d6dc199f2a", "message": "[Doris On ES] refator documentation for doe", "committedDate": "2020-06-15T09:15:17Z", "type": "commit"}, {"oid": "9294beca76d54ec326e559feb5daaf1aaa61610e", "url": "https://github.com/apache/incubator-doris/commit/9294beca76d54ec326e559feb5daaf1aaa61610e", "message": "[Doris On ES] refator documentation for doe", "committedDate": "2020-06-15T09:17:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA1MjUyMQ==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440052521", "bodyText": "\u7528``\u5c06\u53d8\u91cf\u540d\u62ec\u8d77\u6765\uff0c\u53ef\u4ee5\u907f\u514d\u4e0b\u5212\u7ebf\u9020\u6210\u7684\u659c\u4f53\u5f71\u54cd", "author": "EmmyMiao87", "createdAt": "2020-06-15T09:38:24Z", "path": "docs/zh-CN/extending-doris/doris-on-es.md", "diffHunk": "@@ -30,72 +30,320 @@ Doris-On-ES\u5c06Doris\u7684\u5206\u5e03\u5f0f\u67e5\u8be2\u89c4\u5212\u80fd\u529b\u548cES(Elasticsearch)\u7684\u5168\u6587\n  \n  1. ES\u4e2d\u7684\u591aindex\u5206\u5e03\u5f0fJoin\u67e5\u8be2\n  2. Doris\u548cES\u4e2d\u7684\u8868\u8054\u5408\u67e5\u8be2\uff0c\u66f4\u590d\u6742\u7684\u5168\u6587\u68c0\u7d22\u8fc7\u6ee4\n- 3. ES keyword\u7c7b\u578b\u5b57\u6bb5\u7684\u805a\u5408\u67e5\u8be2\uff1a\u9002\u7528\u4e8eindex \u9891\u7e41\u53d1\u751f\u53d8\u5316\u3001\u5355\u4e2a\u5206\u7247\u6587\u6863\u6570\u91cf\u5343\u4e07\u7ea7\u4ee5\u4e0a\u4e14\u8be5\u5b57\u6bb5\u57fa\u6570(cardinality)\u975e\u5e38\u5927\n \n \u672c\u6587\u6863\u4e3b\u8981\u4ecb\u7ecd\u8be5\u529f\u80fd\u7684\u5b9e\u73b0\u539f\u7406\u3001\u4f7f\u7528\u65b9\u5f0f\u7b49\u3002\n \n ## \u540d\u8bcd\u89e3\u91ca\n \n-* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\u3002\n-* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\u3002\n-* Elasticsearch(ES)\uff1a\u76ee\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u5206\u5e03\u5f0f\u641c\u7d22\u5f15\u64ce\u3002\n-* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\u3002\n-* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\u3002\n-* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\u3002\n+### Doirs\u76f8\u5173\n+* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9,\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\n+* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9,\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\n \n+### ES\u76f8\u5173\n+* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\n+* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\n+* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\n+* _source: \u5bfc\u5165\u65f6\u4f20\u5165\u7684\u539f\u59cbJSON\u683c\u5f0f\u6587\u6863\u5185\u5bb9", "originalCommit": "9294beca76d54ec326e559feb5daaf1aaa61610e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA4ODM0OA==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440088348", "bodyText": "\u8fd9\u5e94\u8be5\u663e\u793a\u95ee\u9898\u5427\uff0c\u8868\u683c\u91cc\u9762\u7684\u52a0\\\u5c31\u53ef\u4ee5\u4e86\uff0c\u7c7b\u522b\u7684\u597d\u50cf\u4e0d\u7528", "author": "wuyunfeng", "createdAt": "2020-06-15T10:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA1MjUyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA1MjU4Mw==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440052583", "bodyText": "\u540c\u4e0a", "author": "EmmyMiao87", "createdAt": "2020-06-15T09:38:29Z", "path": "docs/zh-CN/extending-doris/doris-on-es.md", "diffHunk": "@@ -30,72 +30,320 @@ Doris-On-ES\u5c06Doris\u7684\u5206\u5e03\u5f0f\u67e5\u8be2\u89c4\u5212\u80fd\u529b\u548cES(Elasticsearch)\u7684\u5168\u6587\n  \n  1. ES\u4e2d\u7684\u591aindex\u5206\u5e03\u5f0fJoin\u67e5\u8be2\n  2. Doris\u548cES\u4e2d\u7684\u8868\u8054\u5408\u67e5\u8be2\uff0c\u66f4\u590d\u6742\u7684\u5168\u6587\u68c0\u7d22\u8fc7\u6ee4\n- 3. ES keyword\u7c7b\u578b\u5b57\u6bb5\u7684\u805a\u5408\u67e5\u8be2\uff1a\u9002\u7528\u4e8eindex \u9891\u7e41\u53d1\u751f\u53d8\u5316\u3001\u5355\u4e2a\u5206\u7247\u6587\u6863\u6570\u91cf\u5343\u4e07\u7ea7\u4ee5\u4e0a\u4e14\u8be5\u5b57\u6bb5\u57fa\u6570(cardinality)\u975e\u5e38\u5927\n \n \u672c\u6587\u6863\u4e3b\u8981\u4ecb\u7ecd\u8be5\u529f\u80fd\u7684\u5b9e\u73b0\u539f\u7406\u3001\u4f7f\u7528\u65b9\u5f0f\u7b49\u3002\n \n ## \u540d\u8bcd\u89e3\u91ca\n \n-* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\u3002\n-* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\u3002\n-* Elasticsearch(ES)\uff1a\u76ee\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u5206\u5e03\u5f0f\u641c\u7d22\u5f15\u64ce\u3002\n-* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\u3002\n-* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\u3002\n-* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\u3002\n+### Doirs\u76f8\u5173\n+* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9,\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\n+* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9,\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\n \n+### ES\u76f8\u5173\n+* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\n+* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\n+* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\n+* _source: \u5bfc\u5165\u65f6\u4f20\u5165\u7684\u539f\u59cbJSON\u683c\u5f0f\u6587\u6863\u5185\u5bb9\n+* doc_values: ES/Lucene \u4e2d\u5b57\u6bb5\u7684\u5217\u5f0f\u5b58\u50a8\u5b9a\u4e49", "originalCommit": "9294beca76d54ec326e559feb5daaf1aaa61610e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEwNTA3Ng==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440105076", "bodyText": "change it to english", "author": "wutiangan", "createdAt": "2020-06-15T11:19:03Z", "path": "docs/en/extending-doris/doris-on-es.md", "diffHunk": "@@ -26,62 +26,314 @@ under the License.\n \n # Doris On ES\n \n-Doris-On-ES combines Doris's distributed query planning capability with ES (Elastic search)'s full-text search capability to provide a more complete OLAP scenario solution:\n+Doris-On-ES not only take advantage of Doris's distributed query planning capability but also ES (Elastic search)'s full-text search capability, provide a more complete OLAP scenario solution:\n \n 1. Multi-index Distributed Join Query in ES\n 2. Joint Query of Tables in Doris and ES, More Complex Full-Text Retrieval and Filtering\n-3. Aggregated queries for fields of ES keyword type: suitable for frequent changes in index, tens of millions or more of single fragmented documents, and the cardinality of the field is very large\n \n This document mainly introduces the realization principle and usage of this function.\n \n-## Noun Interpretation\n+## Glossary\n+\n+### Noun in Doris\n \n * FE: Frontend, the front-end node of Doris. Responsible for metadata management and request access.\n * BE: Backend, Doris's back-end node. Responsible for query execution and data storage.\n-* Elastic search (ES): The most popular open source distributed search engine.\n+\n+### Noun in ES\n+\n * DataNode: The data storage and computing node of ES.\n * MasterNode: The Master node of ES, which manages metadata, nodes, data distribution, etc.\n * scroll: The built-in data set cursor feature of ES for streaming scanning and filtering of data.\n+* _source: contains the original JSON document body that was passed at index time\n+* doc_values: store the same values as the _source but in a column-oriented fashion\n+* keyword: string datatype in ES, but the content not analyzed by analyzer\n+* text: string datatype in ES, the content analyzed by analyzer\n \n \n-## How to use it\n+## How To Use\n \n-### Create appearance\n+### Create ES Index\n \n ```\n-CREATE EXTERNAL TABLE `es_table` (\n-  `id` bigint(20) COMMENT \"\",\n+PUT test\n+{\n+   \"settings\": {\n+      \"index\": {\n+         \"number_of_shards\": \"1\",\n+         \"number_of_replicas\": \"0\"\n+      }\n+   },\n+   \"mappings\": {\n+      \"doc\": { // ES 7.x\u7248\u672c\u4e4b\u540e\u521b\u5efa\u7d22\u5f15\u65f6\u4e0d\u9700\u8981\u6307\u5b9atype\uff0c\u4f1a\u6709\u4e00\u4e2a\u9ed8\u8ba4\u4e14\u552f\u4e00\u7684`_doc` type\n+         \"properties\": {\n+            \"k1\": {\n+               \"type\": \"long\"\n+            },\n+            \"k2\": {\n+               \"type\": \"date\"\n+            },\n+            \"k3\": {\n+               \"type\": \"keyword\"\n+            },\n+            \"k4\": {\n+               \"type\": \"text\",\n+               \"analyzer\": \"standard\"\n+            },\n+            \"k5\": {\n+               \"type\": \"float\"\n+            }\n+         }\n+      }\n+   }\n+}\n+```\n+\n+### Add JSON documents to ES index\n+\n+```\n+POST /_bulk\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Elasticsearch\", \"k4\": \"Trying out Elasticsearch\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Doris\", \"k4\": \"Trying out Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris On ES\", \"k4\": \"Doris On ES\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris\", \"k4\": \"Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"ES\", \"k4\": \"ES\", \"k5\": 10.0}\n+```\n+\n+### Create external ES table\n+\n+```\n+CREATE EXTERNAL TABLE `test` (\n+  `k1` bigint(20) COMMENT \"\",\n+  `k2` datetime COMMENT \"\",\n+  `k3` varchar(20) COMMENT \"\",\n+  `k4` varchar(100) COMMENT \"\",\n+  `k5` float COMMENT \"\"\n+) ENGINE=ELASTICSEARCH // ENGINE\u5fc5\u987b\u662fElasticsearch\n+PROPERTIES (\n+\"hosts\" = \"http://192.168.0.1:8200,http://192.168.0.2:8200\",\n+\"index\" = \"test\u201d,\n+\"type\" = \"doc\",\n+\n+\"user\" = \"root\",\n+\"password\" = \"root\"\n+);\n+```\n+\n+The following parameters are accepted by ES table:\n+\n+\u53c2\u6570 | \u8bf4\u660e", "originalCommit": "9294beca76d54ec326e559feb5daaf1aaa61610e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEwNTE5Ng==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440105196", "bodyText": "change it to english", "author": "wutiangan", "createdAt": "2020-06-15T11:19:20Z", "path": "docs/en/extending-doris/doris-on-es.md", "diffHunk": "@@ -26,62 +26,314 @@ under the License.\n \n # Doris On ES\n \n-Doris-On-ES combines Doris's distributed query planning capability with ES (Elastic search)'s full-text search capability to provide a more complete OLAP scenario solution:\n+Doris-On-ES not only take advantage of Doris's distributed query planning capability but also ES (Elastic search)'s full-text search capability, provide a more complete OLAP scenario solution:\n \n 1. Multi-index Distributed Join Query in ES\n 2. Joint Query of Tables in Doris and ES, More Complex Full-Text Retrieval and Filtering\n-3. Aggregated queries for fields of ES keyword type: suitable for frequent changes in index, tens of millions or more of single fragmented documents, and the cardinality of the field is very large\n \n This document mainly introduces the realization principle and usage of this function.\n \n-## Noun Interpretation\n+## Glossary\n+\n+### Noun in Doris\n \n * FE: Frontend, the front-end node of Doris. Responsible for metadata management and request access.\n * BE: Backend, Doris's back-end node. Responsible for query execution and data storage.\n-* Elastic search (ES): The most popular open source distributed search engine.\n+\n+### Noun in ES\n+\n * DataNode: The data storage and computing node of ES.\n * MasterNode: The Master node of ES, which manages metadata, nodes, data distribution, etc.\n * scroll: The built-in data set cursor feature of ES for streaming scanning and filtering of data.\n+* _source: contains the original JSON document body that was passed at index time\n+* doc_values: store the same values as the _source but in a column-oriented fashion\n+* keyword: string datatype in ES, but the content not analyzed by analyzer\n+* text: string datatype in ES, the content analyzed by analyzer\n \n \n-## How to use it\n+## How To Use\n \n-### Create appearance\n+### Create ES Index\n \n ```\n-CREATE EXTERNAL TABLE `es_table` (\n-  `id` bigint(20) COMMENT \"\",\n+PUT test\n+{\n+   \"settings\": {\n+      \"index\": {\n+         \"number_of_shards\": \"1\",\n+         \"number_of_replicas\": \"0\"\n+      }\n+   },\n+   \"mappings\": {\n+      \"doc\": { // ES 7.x\u7248\u672c\u4e4b\u540e\u521b\u5efa\u7d22\u5f15\u65f6\u4e0d\u9700\u8981\u6307\u5b9atype\uff0c\u4f1a\u6709\u4e00\u4e2a\u9ed8\u8ba4\u4e14\u552f\u4e00\u7684`_doc` type\n+         \"properties\": {\n+            \"k1\": {\n+               \"type\": \"long\"\n+            },\n+            \"k2\": {\n+               \"type\": \"date\"\n+            },\n+            \"k3\": {\n+               \"type\": \"keyword\"\n+            },\n+            \"k4\": {\n+               \"type\": \"text\",\n+               \"analyzer\": \"standard\"\n+            },\n+            \"k5\": {\n+               \"type\": \"float\"\n+            }\n+         }\n+      }\n+   }\n+}\n+```\n+\n+### Add JSON documents to ES index\n+\n+```\n+POST /_bulk\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Elasticsearch\", \"k4\": \"Trying out Elasticsearch\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Doris\", \"k4\": \"Trying out Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris On ES\", \"k4\": \"Doris On ES\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris\", \"k4\": \"Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"ES\", \"k4\": \"ES\", \"k5\": 10.0}\n+```\n+\n+### Create external ES table\n+\n+```\n+CREATE EXTERNAL TABLE `test` (\n+  `k1` bigint(20) COMMENT \"\",\n+  `k2` datetime COMMENT \"\",\n+  `k3` varchar(20) COMMENT \"\",\n+  `k4` varchar(100) COMMENT \"\",\n+  `k5` float COMMENT \"\"\n+) ENGINE=ELASTICSEARCH // ENGINE\u5fc5\u987b\u662fElasticsearch\n+PROPERTIES (\n+\"hosts\" = \"http://192.168.0.1:8200,http://192.168.0.2:8200\",\n+\"index\" = \"test\u201d,\n+\"type\" = \"doc\",\n+\n+\"user\" = \"root\",\n+\"password\" = \"root\"\n+);\n+```\n+\n+The following parameters are accepted by ES table:\n+\n+\u53c2\u6570 | \u8bf4\u660e\n+---|---\n+**hosts** | ES Cluster Connection Address, maybe one or more node, load-balance is also accepted\n+**index** | the related ES index name\n+**type** | the type for this index\uff0cIf not specified, `_doc` will be used\n+**user** | username for ES\n+**password** | password for the user\n+\n+* For clusters before 7.x, please pay attention to choosing the correct type when building the table\n+* The authentication method only supports Http Bastic authentication, and the fully open source ES cluster user and password do not need to be specified\uff0cNeed to ensure that the user has access to /_cluster/state and other path permissions and read permissions to index\n+* The column names in the Doris table need to exactly match the field names in the ES, and the field types should be as consistent as possible\n+*  **ENGINE** must be: **Elasticsearch**\n+\n+##### Filter to push down\n+\n+An important ability of `Doris On ES` is the push-down of filter conditions: The filtering conditions are pushed to ES, so that only the data that really meets the conditions will be returned, which can significantly improve query performance and reduce CPU, memory, and IO utilization of Doris and ES\n+\n+The following operators (Operators) will be optimized to the following ES Query:\n+\n+| SQL syntax  | ES 5.x+ syntax | \n+|-------|:---:|\n+| =   | term query|\n+| in  | terms query   |\n+| > , < , >= , \u21d0  | range query |\n+| and  | bool.filter   |\n+| or  | bool.should   |\n+| not  | bool.must_not   |\n+| not in  | bool.must_not + terms query |\n+| is\\_not\\_null  | exists query |\n+| is\\_null  | bool.must_not + exists query |\n+| esquery  | QueryDSL in ES native json form   |\n+\n+##### Data type mapping\n+\n+Doris\\ES  |  byte | short | integer | long | float | double| keyword | text | date\n+------------- | ------------- | ------  | ---- | ----- | ----  | ------ | ----| --- | --- |\n+tinyint  | &radic; |  |  |  |   |   |   |   |  \n+smallint | &radic; | &radic; |  | |   |   |   |   |  \n+int | &radic; |  &radic; | &radic; | |   |   |   |   |  \n+bigint | &radic;  | &radic;  | &radic;  | &radic; |   |   |   |   | \n+float |   |   |   |   | &radic; |   |   |   |  \n+double |   |   |   |   |   | &radic; |   |   |  \n+char |   |   |   |   |   |   | &radic; | &radic; |  \n+varchar |  |   |   |   |   |   | &radic; | &radic; |   \n+date |   |   |   |   |   |   |   |   | &radic;|  \n+datetime |   |   |   |   |   |   |   |   | &radic;|  \n+\n+\n+### Enable column scan to optimize query speed(enable\\_docvalue\\_scan=true)\n+\n+```\n+CREATE EXTERNAL TABLE `test` (\n   `k1` bigint(20) COMMENT \"\",\n   `k2` datetime COMMENT \"\",\n   `k3` varchar(20) COMMENT \"\",\n   `k4` varchar(100) COMMENT \"\",\n   `k5` float COMMENT \"\"\n ) ENGINE=ELASTICSEARCH\n-PARTITION BY RANGE(`id`)\n-()\n PROPERTIES (\n \"hosts\" = \"http://192.168.0.1:8200,http://192.168.0.2:8200\",\n+\"index\" = \"test\u201d,\n+\"type\" = \"doc\",\n \"user\" = \"root\",\n \"password\" = \"root\",\n-\"index\" = \"tindex\u201d,\n-\"type\" = \"doc\"\n+\n+\"enable_docvalue_scan\" = \"true\"\n );\n ```\n \n-Description of parameters:\n+Parameter Description\uff1a\n \n-Parameter | description\n+Parameter | Description\n ---|---\n-Hosts | ES Cluster Connection Address, which can specify one or more, through which Doris obtains the share distribution information of ES version number and index\n-User | Open the user name of the ES cluster authenticated by basic, you need to ensure that the user has access to: / cluster / state / nodes / HTTP and other path permissions and read permissions for index\n-Password | corresponding user's password information\n-The index name of the ES corresponding to the table in index | Doris can be alias\n-Type | Specifies the type of index, defaulting to _doc\n-Transport | Internal reservation, default to http\n+**enable\\_docvalue\\_scan** | whether to enable ES/Lucene column storage to get the value of the query field, the default is false\n+\n+Doris obtains data from ES following the following two principles:\n+\n+* **Best effort**: Automatically detect whether the column to be read has column storage enabled (doc_value: true).If all the fields obtained have column storage, Doris will obtain the values \u200b\u200bof all fields from the column storage(doc_values)\n+* **Automatic downgrade**: If the field to be obtained has one or more field that is not have doc_value, the values \u200b\u200bof all fields will be parsed from the line store `_source`\n+\n+##### Advantage\uff1a\n+\n+By default, Doris On ES will get all the required columns from the row storage, which is `_source`, and the storage of `_source` is the origin json format document\uff0cInferior to column storage in batch read performance\uff0cEspecially obvious when only a few columns are needed\uff0cWhen only a few columns are obtained, the performance of docvalue is about ten times that of _source\n \n-### Query\n+##### Tip\n+1. Fields of type `text` are not column-stored in ES, so if the value of the field to be obtained has a field of type `text`, it will be automatically downgraded to get from `_source`\n+2. In the case of too many fields obtained (`>= 25`), the performance of getting field values \u200b\u200bfrom `docvalue` will be basically the same as getting field values \u200b\u200bfrom `_source`\n \n-#### Basic Conditions Filtration\n+\n+### Detect keyword type field(enable\\_keyword\\_sniff=true)\n+\n+```\n+CREATE EXTERNAL TABLE `test` (\n+  `k1` bigint(20) COMMENT \"\",\n+  `k2` datetime COMMENT \"\",\n+  `k3` varchar(20) COMMENT \"\",\n+  `k4` varchar(100) COMMENT \"\",\n+  `k5` float COMMENT \"\"\n+) ENGINE=ELASTICSEARCH\n+PROPERTIES (\n+\"hosts\" = \"http://192.168.0.1:8200,http://192.168.0.2:8200\",\n+\"index\" = \"test\u201d,\n+\"type\" = \"doc\",\n+\"user\" = \"root\",\n+\"password\" = \"root\",\n+\n+\"enable_keyword_sniff\" = \"true\"\n+);\n+```\n+\n+\u53c2\u6570\u8bf4\u660e\uff1a\n+", "originalCommit": "9294beca76d54ec326e559feb5daaf1aaa61610e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEwNzMxNA==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440107314", "bodyText": "\"\u5b8c\u5168\u5f00\u6e90\u7684ES\u96c6\u7fa4\u7528\u6237\u548c\u5bc6\u7801\u4e0d\u9700\u8981\u6307\u5b9a\"\nThis sentence doesn't read smoothly", "author": "wutiangan", "createdAt": "2020-06-15T11:23:50Z", "path": "docs/zh-CN/extending-doris/doris-on-es.md", "diffHunk": "@@ -30,72 +30,320 @@ Doris-On-ES\u5c06Doris\u7684\u5206\u5e03\u5f0f\u67e5\u8be2\u89c4\u5212\u80fd\u529b\u548cES(Elasticsearch)\u7684\u5168\u6587\n  \n  1. ES\u4e2d\u7684\u591aindex\u5206\u5e03\u5f0fJoin\u67e5\u8be2\n  2. Doris\u548cES\u4e2d\u7684\u8868\u8054\u5408\u67e5\u8be2\uff0c\u66f4\u590d\u6742\u7684\u5168\u6587\u68c0\u7d22\u8fc7\u6ee4\n- 3. ES keyword\u7c7b\u578b\u5b57\u6bb5\u7684\u805a\u5408\u67e5\u8be2\uff1a\u9002\u7528\u4e8eindex \u9891\u7e41\u53d1\u751f\u53d8\u5316\u3001\u5355\u4e2a\u5206\u7247\u6587\u6863\u6570\u91cf\u5343\u4e07\u7ea7\u4ee5\u4e0a\u4e14\u8be5\u5b57\u6bb5\u57fa\u6570(cardinality)\u975e\u5e38\u5927\n \n \u672c\u6587\u6863\u4e3b\u8981\u4ecb\u7ecd\u8be5\u529f\u80fd\u7684\u5b9e\u73b0\u539f\u7406\u3001\u4f7f\u7528\u65b9\u5f0f\u7b49\u3002\n \n ## \u540d\u8bcd\u89e3\u91ca\n \n-* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\u3002\n-* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\u3002\n-* Elasticsearch(ES)\uff1a\u76ee\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u5206\u5e03\u5f0f\u641c\u7d22\u5f15\u64ce\u3002\n-* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\u3002\n-* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\u3002\n-* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\u3002\n+### Doirs\u76f8\u5173\n+* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9,\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\n+* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9,\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\n \n+### ES\u76f8\u5173\n+* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\n+* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\n+* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\n+* _source: \u5bfc\u5165\u65f6\u4f20\u5165\u7684\u539f\u59cbJSON\u683c\u5f0f\u6587\u6863\u5185\u5bb9\n+* doc_values: ES/Lucene \u4e2d\u5b57\u6bb5\u7684\u5217\u5f0f\u5b58\u50a8\u5b9a\u4e49\n+* keyword: \u5b57\u7b26\u4e32\u7c7b\u578b\u5b57\u6bb5\uff0cES/Lucene\u4e0d\u4f1a\u5bf9\u6587\u672c\u5185\u5bb9\u8fdb\u884c\u5206\u8bcd\u5904\u7406\n+* text: \u5b57\u7b26\u4e32\u7c7b\u578b\u5b57\u6bb5\uff0cES/Lucene\u4f1a\u5bf9\u6587\u672c\u5185\u5bb9\u8fdb\u884c\u5206\u8bcd\u5904\u7406\uff0c\u5206\u8bcd\u5668\u9700\u8981\u7528\u6237\u6307\u5b9a\uff0c\u9ed8\u8ba4\u4e3astandard\u82f1\u6587\u5206\u8bcd\u5668\n \n-## \u5982\u4f55\u4f7f\u7528\n \n-### \u521b\u5efa\u5916\u8868\n+## \u4f7f\u7528\u65b9\u6cd5\n+\n+### \u521b\u5efaES\u7d22\u5f15\n \n ```\n-CREATE EXTERNAL TABLE `es_table` (\n-  `id` bigint(20) COMMENT \"\",\n+PUT test\n+{\n+   \"settings\": {\n+      \"index\": {\n+         \"number_of_shards\": \"1\",\n+         \"number_of_replicas\": \"0\"\n+      }\n+   },\n+   \"mappings\": {\n+      \"doc\": { // ES 7.x\u7248\u672c\u4e4b\u540e\u521b\u5efa\u7d22\u5f15\u65f6\u4e0d\u9700\u8981\u6307\u5b9atype\uff0c\u4f1a\u6709\u4e00\u4e2a\u9ed8\u8ba4\u4e14\u552f\u4e00\u7684`_doc` type\n+         \"properties\": {\n+            \"k1\": {\n+               \"type\": \"long\"\n+            },\n+            \"k2\": {\n+               \"type\": \"date\"\n+            },\n+            \"k3\": {\n+               \"type\": \"keyword\"\n+            },\n+            \"k4\": {\n+               \"type\": \"text\",\n+               \"analyzer\": \"standard\"\n+            },\n+            \"k5\": {\n+               \"type\": \"float\"\n+            }\n+         }\n+      }\n+   }\n+}\n+```\n+\n+### ES\u7d22\u5f15\u5bfc\u5165\u6570\u636e\n+\n+```\n+POST /_bulk\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Elasticsearch\", \"k4\": \"Trying out Elasticsearch\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Doris\", \"k4\": \"Trying out Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris On ES\", \"k4\": \"Doris On ES\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris\", \"k4\": \"Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"ES\", \"k4\": \"ES\", \"k5\": 10.0}\n+```\n+\n+### Doris\u4e2d\u521b\u5efaES\u5916\u8868\n+\n+```\n+CREATE EXTERNAL TABLE `test` (\n+  `k1` bigint(20) COMMENT \"\",\n+  `k2` datetime COMMENT \"\",\n+  `k3` varchar(20) COMMENT \"\",\n+  `k4` varchar(100) COMMENT \"\",\n+  `k5` float COMMENT \"\"\n+) ENGINE=ELASTICSEARCH // ENGINE\u5fc5\u987b\u662fElasticsearch\n+PROPERTIES (\n+\"hosts\" = \"http://192.168.0.1:8200,http://192.168.0.2:8200\",\n+\"index\" = \"test\u201d,\n+\"type\" = \"doc\",\n+\n+\"user\" = \"root\",\n+\"password\" = \"root\"\n+);\n+```\n+\n+\u53c2\u6570\u8bf4\u660e\uff1a\n+\n+\u53c2\u6570 | \u8bf4\u660e\n+---|---\n+**hosts** | ES\u96c6\u7fa4\u5730\u5740\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u662fES\u524d\u7aef\u7684\u8d1f\u8f7d\u5747\u8861\u5730\u5740\n+**index** | \u5bf9\u5e94\u7684ES\u7684index\u540d\u5b57\n+**type** | index\u7684type\uff0c\u4e0d\u6307\u5b9a\u7684\u60c5\u51b5\u4f1a\u4f7f\u7528_doc\n+**user** | ES\u96c6\u7fa4\u7528\u6237\u540d\n+**password** | \u5bf9\u5e94\u7528\u6237\u7684\u5bc6\u7801\u4fe1\u606f\n+\n+* ES 7.x\u4e4b\u524d\u7684\u96c6\u7fa4\u8bf7\u6ce8\u610f\u5728\u5efa\u8868\u7684\u65f6\u5019\u9009\u62e9\u6b63\u786e\u7684**\u7d22\u5f15\u7c7b\u578btype**\n+* \u8ba4\u8bc1\u65b9\u5f0f\u4ec5\u652f\u6301Http Bastic\u8ba4\u8bc1\uff0c\u5b8c\u5168\u5f00\u6e90\u7684ES\u96c6\u7fa4\u7528\u6237\u548c\u5bc6\u7801\u4e0d\u9700\u8981\u6307\u5b9a\uff0c\u9700\u8981\u786e\u4fdd\u8be5\u7528\u6237\u6709\u8bbf\u95ee: /\\_cluster/state/\u3001\\_nodes/http\u7b49\u8def\u5f84\u6743\u9650\u548c\u5bf9index\u7684\u8bfb\u6743\u9650", "originalCommit": "9294beca76d54ec326e559feb5daaf1aaa61610e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEwNzgxNg==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440107816", "bodyText": "es support decimal\uff1f", "author": "wutiangan", "createdAt": "2020-06-15T11:25:01Z", "path": "docs/zh-CN/extending-doris/doris-on-es.md", "diffHunk": "@@ -30,72 +30,320 @@ Doris-On-ES\u5c06Doris\u7684\u5206\u5e03\u5f0f\u67e5\u8be2\u89c4\u5212\u80fd\u529b\u548cES(Elasticsearch)\u7684\u5168\u6587\n  \n  1. ES\u4e2d\u7684\u591aindex\u5206\u5e03\u5f0fJoin\u67e5\u8be2\n  2. Doris\u548cES\u4e2d\u7684\u8868\u8054\u5408\u67e5\u8be2\uff0c\u66f4\u590d\u6742\u7684\u5168\u6587\u68c0\u7d22\u8fc7\u6ee4\n- 3. ES keyword\u7c7b\u578b\u5b57\u6bb5\u7684\u805a\u5408\u67e5\u8be2\uff1a\u9002\u7528\u4e8eindex \u9891\u7e41\u53d1\u751f\u53d8\u5316\u3001\u5355\u4e2a\u5206\u7247\u6587\u6863\u6570\u91cf\u5343\u4e07\u7ea7\u4ee5\u4e0a\u4e14\u8be5\u5b57\u6bb5\u57fa\u6570(cardinality)\u975e\u5e38\u5927\n \n \u672c\u6587\u6863\u4e3b\u8981\u4ecb\u7ecd\u8be5\u529f\u80fd\u7684\u5b9e\u73b0\u539f\u7406\u3001\u4f7f\u7528\u65b9\u5f0f\u7b49\u3002\n \n ## \u540d\u8bcd\u89e3\u91ca\n \n-* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\u3002\n-* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\u3002\n-* Elasticsearch(ES)\uff1a\u76ee\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u5206\u5e03\u5f0f\u641c\u7d22\u5f15\u64ce\u3002\n-* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\u3002\n-* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\u3002\n-* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\u3002\n+### Doirs\u76f8\u5173\n+* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9,\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\n+* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9,\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\n \n+### ES\u76f8\u5173\n+* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\n+* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\n+* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\n+* _source: \u5bfc\u5165\u65f6\u4f20\u5165\u7684\u539f\u59cbJSON\u683c\u5f0f\u6587\u6863\u5185\u5bb9\n+* doc_values: ES/Lucene \u4e2d\u5b57\u6bb5\u7684\u5217\u5f0f\u5b58\u50a8\u5b9a\u4e49\n+* keyword: \u5b57\u7b26\u4e32\u7c7b\u578b\u5b57\u6bb5\uff0cES/Lucene\u4e0d\u4f1a\u5bf9\u6587\u672c\u5185\u5bb9\u8fdb\u884c\u5206\u8bcd\u5904\u7406\n+* text: \u5b57\u7b26\u4e32\u7c7b\u578b\u5b57\u6bb5\uff0cES/Lucene\u4f1a\u5bf9\u6587\u672c\u5185\u5bb9\u8fdb\u884c\u5206\u8bcd\u5904\u7406\uff0c\u5206\u8bcd\u5668\u9700\u8981\u7528\u6237\u6307\u5b9a\uff0c\u9ed8\u8ba4\u4e3astandard\u82f1\u6587\u5206\u8bcd\u5668\n \n-## \u5982\u4f55\u4f7f\u7528\n \n-### \u521b\u5efa\u5916\u8868\n+## \u4f7f\u7528\u65b9\u6cd5\n+\n+### \u521b\u5efaES\u7d22\u5f15\n \n ```\n-CREATE EXTERNAL TABLE `es_table` (\n-  `id` bigint(20) COMMENT \"\",\n+PUT test\n+{\n+   \"settings\": {\n+      \"index\": {\n+         \"number_of_shards\": \"1\",\n+         \"number_of_replicas\": \"0\"\n+      }\n+   },\n+   \"mappings\": {\n+      \"doc\": { // ES 7.x\u7248\u672c\u4e4b\u540e\u521b\u5efa\u7d22\u5f15\u65f6\u4e0d\u9700\u8981\u6307\u5b9atype\uff0c\u4f1a\u6709\u4e00\u4e2a\u9ed8\u8ba4\u4e14\u552f\u4e00\u7684`_doc` type\n+         \"properties\": {\n+            \"k1\": {\n+               \"type\": \"long\"\n+            },\n+            \"k2\": {\n+               \"type\": \"date\"\n+            },\n+            \"k3\": {\n+               \"type\": \"keyword\"\n+            },\n+            \"k4\": {\n+               \"type\": \"text\",\n+               \"analyzer\": \"standard\"\n+            },\n+            \"k5\": {\n+               \"type\": \"float\"\n+            }\n+         }\n+      }\n+   }\n+}\n+```\n+\n+### ES\u7d22\u5f15\u5bfc\u5165\u6570\u636e\n+\n+```\n+POST /_bulk\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Elasticsearch\", \"k4\": \"Trying out Elasticsearch\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Doris\", \"k4\": \"Trying out Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris On ES\", \"k4\": \"Doris On ES\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris\", \"k4\": \"Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"ES\", \"k4\": \"ES\", \"k5\": 10.0}\n+```\n+\n+### Doris\u4e2d\u521b\u5efaES\u5916\u8868\n+\n+```\n+CREATE EXTERNAL TABLE `test` (\n+  `k1` bigint(20) COMMENT \"\",\n+  `k2` datetime COMMENT \"\",\n+  `k3` varchar(20) COMMENT \"\",\n+  `k4` varchar(100) COMMENT \"\",\n+  `k5` float COMMENT \"\"\n+) ENGINE=ELASTICSEARCH // ENGINE\u5fc5\u987b\u662fElasticsearch\n+PROPERTIES (\n+\"hosts\" = \"http://192.168.0.1:8200,http://192.168.0.2:8200\",\n+\"index\" = \"test\u201d,\n+\"type\" = \"doc\",\n+\n+\"user\" = \"root\",\n+\"password\" = \"root\"\n+);\n+```\n+\n+\u53c2\u6570\u8bf4\u660e\uff1a\n+\n+\u53c2\u6570 | \u8bf4\u660e\n+---|---\n+**hosts** | ES\u96c6\u7fa4\u5730\u5740\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u662fES\u524d\u7aef\u7684\u8d1f\u8f7d\u5747\u8861\u5730\u5740\n+**index** | \u5bf9\u5e94\u7684ES\u7684index\u540d\u5b57\n+**type** | index\u7684type\uff0c\u4e0d\u6307\u5b9a\u7684\u60c5\u51b5\u4f1a\u4f7f\u7528_doc\n+**user** | ES\u96c6\u7fa4\u7528\u6237\u540d\n+**password** | \u5bf9\u5e94\u7528\u6237\u7684\u5bc6\u7801\u4fe1\u606f\n+\n+* ES 7.x\u4e4b\u524d\u7684\u96c6\u7fa4\u8bf7\u6ce8\u610f\u5728\u5efa\u8868\u7684\u65f6\u5019\u9009\u62e9\u6b63\u786e\u7684**\u7d22\u5f15\u7c7b\u578btype**\n+* \u8ba4\u8bc1\u65b9\u5f0f\u4ec5\u652f\u6301Http Bastic\u8ba4\u8bc1\uff0c\u5b8c\u5168\u5f00\u6e90\u7684ES\u96c6\u7fa4\u7528\u6237\u548c\u5bc6\u7801\u4e0d\u9700\u8981\u6307\u5b9a\uff0c\u9700\u8981\u786e\u4fdd\u8be5\u7528\u6237\u6709\u8bbf\u95ee: /\\_cluster/state/\u3001\\_nodes/http\u7b49\u8def\u5f84\u6743\u9650\u548c\u5bf9index\u7684\u8bfb\u6743\u9650\n+* Doris\u8868\u4e2d\u7684\u5217\u540d\u9700\u8981\u548cES\u4e2d\u7684\u5b57\u6bb5\u540d\u5b8c\u5168\u5339\u914d\uff0c\u5b57\u6bb5\u7c7b\u578b\u5e94\u8be5\u4fdd\u6301\u4e00\u81f4\n+*  **ENGINE**\u5fc5\u987b\u662f **Elasticsearch**\n+\n+##### \u8fc7\u6ee4\u6761\u4ef6\u4e0b\u63a8\n+`Doris On ES`\u4e00\u4e2a\u91cd\u8981\u7684\u529f\u80fd\u5c31\u662f\u8fc7\u6ee4\u6761\u4ef6\u7684\u4e0b\u63a8: \u8fc7\u6ee4\u6761\u4ef6\u4e0b\u63a8\u7ed9ES\uff0c\u8fd9\u6837\u53ea\u6709\u771f\u6b63\u6ee1\u8db3\u6761\u4ef6\u7684\u6570\u636e\u624d\u4f1a\u88ab\u8fd4\u56de\uff0c\u80fd\u591f\u663e\u8457\u7684\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u548c\u964d\u4f4eDoris\u548cElasticsearch\u7684CPU\u3001memory\u3001IO\u5229\u7528\u7387\n+\n+\u4e0b\u9762\u7684\u64cd\u4f5c\u7b26(Operators)\u4f1a\u88ab\u4f18\u5316\u6210\u5982\u4e0bES Query:\n+\n+| SQL syntax  | ES 5.x+ syntax | \n+|-------|:---:|\n+| =   | term query|\n+| in  | terms query   |\n+| > , < , >= , \u21d0  | range query |\n+| and  | bool.filter   |\n+| or  | bool.should   |\n+| not  | bool.must_not   |\n+| not in  | bool.must_not + terms query |\n+| is\\_not\\_null  | exists query |\n+| is\\_null  | bool.must_not + exists query |\n+| esquery  | ES\u539f\u751fjson\u5f62\u5f0f\u7684QueryDSL   |\n+\n+##### \u6570\u636e\u7c7b\u578b\u6620\u5c04\n+\n+Doris\\ES  |  byte | short | integer | long | float | double| keyword | text | date\n+------------- | ------------- | ------  | ---- | ----- | ----  | ------ | ----| --- | --- |\n+tinyint  | &radic; |  |  |  |   |   |   |   |  \n+smallint | &radic; | &radic; |  | |   |   |   |   |  \n+int | &radic; |  &radic; | &radic; | |   |   |   |   |  \n+bigint | &radic;  | &radic;  | &radic;  | &radic; |   |   |   |   | \n+float |   |   |   |   | &radic; |   |   |   |  \n+double |   |   |   |   |   | &radic; |   |   |  \n+char |   |   |   |   |   |   | &radic; | &radic; |  \n+varchar |  |   |   |   |   |   | &radic; | &radic; |   \n+date |   |   |   |   |   |   |   |   | &radic;|  \n+datetime |   |   |   |   |   |   |   |   | &radic;|  \n+", "originalCommit": "9294beca76d54ec326e559feb5daaf1aaa61610e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzMTkxOQ==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440531919", "bodyText": "emm, not support decimal", "author": "wuyunfeng", "createdAt": "2020-06-16T01:18:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEwNzgxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEwOTQyOA==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440109428", "bodyText": "query\u540e\u9762\u9700\u8981\u52a0\u4e2a\u62ec\u53f7\uff0c\u5c06\u5982match\u3001geoshape\u62ec\u8d77\u6765", "author": "wutiangan", "createdAt": "2020-06-15T11:28:24Z", "path": "docs/zh-CN/extending-doris/doris-on-es.md", "diffHunk": "@@ -30,72 +30,320 @@ Doris-On-ES\u5c06Doris\u7684\u5206\u5e03\u5f0f\u67e5\u8be2\u89c4\u5212\u80fd\u529b\u548cES(Elasticsearch)\u7684\u5168\u6587\n  \n  1. ES\u4e2d\u7684\u591aindex\u5206\u5e03\u5f0fJoin\u67e5\u8be2\n  2. Doris\u548cES\u4e2d\u7684\u8868\u8054\u5408\u67e5\u8be2\uff0c\u66f4\u590d\u6742\u7684\u5168\u6587\u68c0\u7d22\u8fc7\u6ee4\n- 3. ES keyword\u7c7b\u578b\u5b57\u6bb5\u7684\u805a\u5408\u67e5\u8be2\uff1a\u9002\u7528\u4e8eindex \u9891\u7e41\u53d1\u751f\u53d8\u5316\u3001\u5355\u4e2a\u5206\u7247\u6587\u6863\u6570\u91cf\u5343\u4e07\u7ea7\u4ee5\u4e0a\u4e14\u8be5\u5b57\u6bb5\u57fa\u6570(cardinality)\u975e\u5e38\u5927\n \n \u672c\u6587\u6863\u4e3b\u8981\u4ecb\u7ecd\u8be5\u529f\u80fd\u7684\u5b9e\u73b0\u539f\u7406\u3001\u4f7f\u7528\u65b9\u5f0f\u7b49\u3002\n \n ## \u540d\u8bcd\u89e3\u91ca\n \n-* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\u3002\n-* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9\u3002\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\u3002\n-* Elasticsearch(ES)\uff1a\u76ee\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u5206\u5e03\u5f0f\u641c\u7d22\u5f15\u64ce\u3002\n-* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\u3002\n-* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\u3002\n-* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\u3002\n+### Doirs\u76f8\u5173\n+* FE\uff1aFrontend\uff0cDoris \u7684\u524d\u7aef\u8282\u70b9,\u8d1f\u8d23\u5143\u6570\u636e\u7ba1\u7406\u548c\u8bf7\u6c42\u63a5\u5165\n+* BE\uff1aBackend\uff0cDoris \u7684\u540e\u7aef\u8282\u70b9,\u8d1f\u8d23\u67e5\u8be2\u6267\u884c\u548c\u6570\u636e\u5b58\u50a8\n \n+### ES\u76f8\u5173\n+* DataNode\uff1aES\u7684\u6570\u636e\u5b58\u50a8\u4e0e\u8ba1\u7b97\u8282\u70b9\n+* MasterNode\uff1aES\u7684Master\u8282\u70b9\uff0c\u7ba1\u7406\u5143\u6570\u636e\u3001\u8282\u70b9\u3001\u6570\u636e\u5206\u5e03\u7b49\n+* scroll\uff1aES\u5185\u7f6e\u7684\u6570\u636e\u96c6\u6e38\u6807\u7279\u6027\uff0c\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u626b\u63cf\u548c\u8fc7\u6ee4\n+* _source: \u5bfc\u5165\u65f6\u4f20\u5165\u7684\u539f\u59cbJSON\u683c\u5f0f\u6587\u6863\u5185\u5bb9\n+* doc_values: ES/Lucene \u4e2d\u5b57\u6bb5\u7684\u5217\u5f0f\u5b58\u50a8\u5b9a\u4e49\n+* keyword: \u5b57\u7b26\u4e32\u7c7b\u578b\u5b57\u6bb5\uff0cES/Lucene\u4e0d\u4f1a\u5bf9\u6587\u672c\u5185\u5bb9\u8fdb\u884c\u5206\u8bcd\u5904\u7406\n+* text: \u5b57\u7b26\u4e32\u7c7b\u578b\u5b57\u6bb5\uff0cES/Lucene\u4f1a\u5bf9\u6587\u672c\u5185\u5bb9\u8fdb\u884c\u5206\u8bcd\u5904\u7406\uff0c\u5206\u8bcd\u5668\u9700\u8981\u7528\u6237\u6307\u5b9a\uff0c\u9ed8\u8ba4\u4e3astandard\u82f1\u6587\u5206\u8bcd\u5668\n \n-## \u5982\u4f55\u4f7f\u7528\n \n-### \u521b\u5efa\u5916\u8868\n+## \u4f7f\u7528\u65b9\u6cd5\n+\n+### \u521b\u5efaES\u7d22\u5f15\n \n ```\n-CREATE EXTERNAL TABLE `es_table` (\n-  `id` bigint(20) COMMENT \"\",\n+PUT test\n+{\n+   \"settings\": {\n+      \"index\": {\n+         \"number_of_shards\": \"1\",\n+         \"number_of_replicas\": \"0\"\n+      }\n+   },\n+   \"mappings\": {\n+      \"doc\": { // ES 7.x\u7248\u672c\u4e4b\u540e\u521b\u5efa\u7d22\u5f15\u65f6\u4e0d\u9700\u8981\u6307\u5b9atype\uff0c\u4f1a\u6709\u4e00\u4e2a\u9ed8\u8ba4\u4e14\u552f\u4e00\u7684`_doc` type\n+         \"properties\": {\n+            \"k1\": {\n+               \"type\": \"long\"\n+            },\n+            \"k2\": {\n+               \"type\": \"date\"\n+            },\n+            \"k3\": {\n+               \"type\": \"keyword\"\n+            },\n+            \"k4\": {\n+               \"type\": \"text\",\n+               \"analyzer\": \"standard\"\n+            },\n+            \"k5\": {\n+               \"type\": \"float\"\n+            }\n+         }\n+      }\n+   }\n+}\n+```\n+\n+### ES\u7d22\u5f15\u5bfc\u5165\u6570\u636e\n+\n+```\n+POST /_bulk\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Elasticsearch\", \"k4\": \"Trying out Elasticsearch\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Trying out Doris\", \"k4\": \"Trying out Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris On ES\", \"k4\": \"Doris On ES\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"Doris\", \"k4\": \"Doris\", \"k5\": 10.0}\n+{\"index\":{\"_index\":\"test\",\"_type\":\"doc\"}}\n+{ \"k1\" : 100, \"k2\": \"2020-01-01\", \"k3\": \"ES\", \"k4\": \"ES\", \"k5\": 10.0}\n+```\n+\n+### Doris\u4e2d\u521b\u5efaES\u5916\u8868\n+\n+```\n+CREATE EXTERNAL TABLE `test` (\n+  `k1` bigint(20) COMMENT \"\",\n+  `k2` datetime COMMENT \"\",\n+  `k3` varchar(20) COMMENT \"\",\n+  `k4` varchar(100) COMMENT \"\",\n+  `k5` float COMMENT \"\"\n+) ENGINE=ELASTICSEARCH // ENGINE\u5fc5\u987b\u662fElasticsearch\n+PROPERTIES (\n+\"hosts\" = \"http://192.168.0.1:8200,http://192.168.0.2:8200\",\n+\"index\" = \"test\u201d,\n+\"type\" = \"doc\",\n+\n+\"user\" = \"root\",\n+\"password\" = \"root\"\n+);\n+```\n+\n+\u53c2\u6570\u8bf4\u660e\uff1a\n+\n+\u53c2\u6570 | \u8bf4\u660e\n+---|---\n+**hosts** | ES\u96c6\u7fa4\u5730\u5740\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u662fES\u524d\u7aef\u7684\u8d1f\u8f7d\u5747\u8861\u5730\u5740\n+**index** | \u5bf9\u5e94\u7684ES\u7684index\u540d\u5b57\n+**type** | index\u7684type\uff0c\u4e0d\u6307\u5b9a\u7684\u60c5\u51b5\u4f1a\u4f7f\u7528_doc\n+**user** | ES\u96c6\u7fa4\u7528\u6237\u540d\n+**password** | \u5bf9\u5e94\u7528\u6237\u7684\u5bc6\u7801\u4fe1\u606f\n+\n+* ES 7.x\u4e4b\u524d\u7684\u96c6\u7fa4\u8bf7\u6ce8\u610f\u5728\u5efa\u8868\u7684\u65f6\u5019\u9009\u62e9\u6b63\u786e\u7684**\u7d22\u5f15\u7c7b\u578btype**\n+* \u8ba4\u8bc1\u65b9\u5f0f\u4ec5\u652f\u6301Http Bastic\u8ba4\u8bc1\uff0c\u5b8c\u5168\u5f00\u6e90\u7684ES\u96c6\u7fa4\u7528\u6237\u548c\u5bc6\u7801\u4e0d\u9700\u8981\u6307\u5b9a\uff0c\u9700\u8981\u786e\u4fdd\u8be5\u7528\u6237\u6709\u8bbf\u95ee: /\\_cluster/state/\u3001\\_nodes/http\u7b49\u8def\u5f84\u6743\u9650\u548c\u5bf9index\u7684\u8bfb\u6743\u9650\n+* Doris\u8868\u4e2d\u7684\u5217\u540d\u9700\u8981\u548cES\u4e2d\u7684\u5b57\u6bb5\u540d\u5b8c\u5168\u5339\u914d\uff0c\u5b57\u6bb5\u7c7b\u578b\u5e94\u8be5\u4fdd\u6301\u4e00\u81f4\n+*  **ENGINE**\u5fc5\u987b\u662f **Elasticsearch**\n+\n+##### \u8fc7\u6ee4\u6761\u4ef6\u4e0b\u63a8\n+`Doris On ES`\u4e00\u4e2a\u91cd\u8981\u7684\u529f\u80fd\u5c31\u662f\u8fc7\u6ee4\u6761\u4ef6\u7684\u4e0b\u63a8: \u8fc7\u6ee4\u6761\u4ef6\u4e0b\u63a8\u7ed9ES\uff0c\u8fd9\u6837\u53ea\u6709\u771f\u6b63\u6ee1\u8db3\u6761\u4ef6\u7684\u6570\u636e\u624d\u4f1a\u88ab\u8fd4\u56de\uff0c\u80fd\u591f\u663e\u8457\u7684\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u548c\u964d\u4f4eDoris\u548cElasticsearch\u7684CPU\u3001memory\u3001IO\u5229\u7528\u7387\n+\n+\u4e0b\u9762\u7684\u64cd\u4f5c\u7b26(Operators)\u4f1a\u88ab\u4f18\u5316\u6210\u5982\u4e0bES Query:\n+\n+| SQL syntax  | ES 5.x+ syntax | \n+|-------|:---:|\n+| =   | term query|\n+| in  | terms query   |\n+| > , < , >= , \u21d0  | range query |\n+| and  | bool.filter   |\n+| or  | bool.should   |\n+| not  | bool.must_not   |\n+| not in  | bool.must_not + terms query |\n+| is\\_not\\_null  | exists query |\n+| is\\_null  | bool.must_not + exists query |\n+| esquery  | ES\u539f\u751fjson\u5f62\u5f0f\u7684QueryDSL   |\n+\n+##### \u6570\u636e\u7c7b\u578b\u6620\u5c04\n+\n+Doris\\ES  |  byte | short | integer | long | float | double| keyword | text | date\n+------------- | ------------- | ------  | ---- | ----- | ----  | ------ | ----| --- | --- |\n+tinyint  | &radic; |  |  |  |   |   |   |   |  \n+smallint | &radic; | &radic; |  | |   |   |   |   |  \n+int | &radic; |  &radic; | &radic; | |   |   |   |   |  \n+bigint | &radic;  | &radic;  | &radic;  | &radic; |   |   |   |   | \n+float |   |   |   |   | &radic; |   |   |   |  \n+double |   |   |   |   |   | &radic; |   |   |  \n+char |   |   |   |   |   |   | &radic; | &radic; |  \n+varchar |  |   |   |   |   |   | &radic; | &radic; |   \n+date |   |   |   |   |   |   |   |   | &radic;|  \n+datetime |   |   |   |   |   |   |   |   | &radic;|  \n+\n+\n+### \u542f\u7528\u5217\u5f0f\u626b\u63cf\u4f18\u5316\u67e5\u8be2\u901f\u5ea6(enable\\_docvalue\\_scan=true)\n+\n+```\n+CREATE EXTERNAL TABLE `test` (\n   `k1` bigint(20) COMMENT \"\",\n   `k2` datetime COMMENT \"\",\n   `k3` varchar(20) COMMENT \"\",\n   `k4` varchar(100) COMMENT \"\",\n   `k5` float COMMENT \"\"\n ) ENGINE=ELASTICSEARCH\n-PARTITION BY RANGE(`id`)\n-()\n PROPERTIES (\n \"hosts\" = \"http://192.168.0.1:8200,http://192.168.0.2:8200\",\n+\"index\" = \"test\u201d,\n+\"type\" = \"doc\",\n \"user\" = \"root\",\n \"password\" = \"root\",\n-\"index\" = \"tindex\u201d,\n-\"type\" = \"doc\"\n+\n+\"enable_docvalue_scan\" = \"true\"\n );\n ```\n \n \u53c2\u6570\u8bf4\u660e\uff1a\n \n \u53c2\u6570 | \u8bf4\u660e\n ---|---\n-hosts | ES\u96c6\u7fa4\u8fde\u63a5\u5730\u5740\uff0c\u53ef\u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\uff0cDoris\u901a\u8fc7\u8fd9\u4e2a\u5730\u5740\u83b7\u53d6\u5230ES\u7248\u672c\u53f7\u3001index\u7684shard\u5206\u5e03\u4fe1\u606f\n-user | \u5f00\u542fbasic\u8ba4\u8bc1\u7684ES\u96c6\u7fa4\u7684\u7528\u6237\u540d\uff0c\u9700\u8981\u786e\u4fdd\u8be5\u7528\u6237\u6709\u8bbf\u95ee: /\\_cluster/state/\\_nodes/http\u7b49\u8def\u5f84\u6743\u9650\u548c\u5bf9index\u7684\u8bfb\u6743\u9650\n-password | \u5bf9\u5e94\u7528\u6237\u7684\u5bc6\u7801\u4fe1\u606f\n-index | Doris\u4e2d\u7684\u8868\u5bf9\u5e94\u7684ES\u7684index\u540d\u5b57\uff0c\u53ef\u4ee5\u662falias\n-type | \u6307\u5b9aindex\u7684type\uff0c\u9ed8\u8ba4\u662f_doc\n-transport | \u5185\u90e8\u4fdd\u7559\uff0c\u9ed8\u8ba4\u4e3ahttp\n+**enable\\_docvalue\\_scan** | \u662f\u5426\u5f00\u542f\u901a\u8fc7ES/Lucene\u5217\u5f0f\u5b58\u50a8\u83b7\u53d6\u67e5\u8be2\u5b57\u6bb5\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3afalse\n+\n+\u5f00\u542f\u540eDoris\u4eceES\u4e2d\u83b7\u53d6\u6570\u636e\u4f1a\u9075\u5faa\u4ee5\u4e0b\u4e24\u4e2a\u539f\u5219\uff1a\n+\n+* **\u5c3d\u529b\u800c\u4e3a**: \u81ea\u52a8\u63a2\u6d4b\u8981\u8bfb\u53d6\u7684\u5b57\u6bb5\u662f\u5426\u5f00\u542f\u5217\u5f0f\u5b58\u50a8(doc_value: true)\uff0c\u5982\u679c\u83b7\u53d6\u7684\u5b57\u6bb5\u5168\u90e8\u6709\u5217\u5b58\uff0cDoris\u4f1a\u4ece\u5217\u5f0f\u5b58\u50a8\u4e2d\u83b7\u53d6\u6240\u6709\u5b57\u6bb5\u7684\u503c\n+* **\u81ea\u52a8\u964d\u7ea7**: \u5982\u679c\u8981\u83b7\u53d6\u7684\u5b57\u6bb5\u53ea\u8981\u6709\u4e00\u4e2a\u5b57\u6bb5\u6ca1\u6709\u5217\u5b58\uff0c\u6240\u6709\u5b57\u6bb5\u7684\u503c\u90fd\u4f1a\u4ece\u884c\u5b58`_source`\u4e2d\u89e3\u6790\u83b7\u53d6\n+\n+##### \u4f18\u52bf\uff1a\n+\n+\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cDoris On ES\u4f1a\u4ece\u884c\u5b58\u4e5f\u5c31\u662f`_source`\u4e2d\u83b7\u53d6\u6240\u9700\u7684\u6240\u6709\u5217\uff0c`_source`\u7684\u5b58\u50a8\u91c7\u7528\u7684\u884c\u5f0f+json\u7684\u5f62\u5f0f\u5b58\u50a8\uff0c\u5728\u6279\u91cf\u8bfb\u53d6\u6027\u80fd\u4e0a\u8981\u52a3\u4e8e\u5217\u5f0f\u5b58\u50a8\uff0c\u5c24\u5176\u5728\u53ea\u9700\u8981\u5c11\u6570\u5217\u7684\u60c5\u51b5\u4e0b\u5c24\u4e3a\u660e\u663e\uff0c\u53ea\u83b7\u53d6\u5c11\u6570\u5217\u7684\u60c5\u51b5\u4e0b\uff0cdocvalue\u7684\u6027\u80fd\u5927\u7ea6\u662f_source\u6027\u80fd\u7684\u5341\u51e0\u500d\n+\n+##### \u6ce8\u610f\n+1. `text`\u7c7b\u578b\u7684\u5b57\u6bb5\u5728ES\u4e2d\u662f\u6ca1\u6709\u5217\u5f0f\u5b58\u50a8\uff0c\u56e0\u6b64\u5982\u679c\u8981\u83b7\u53d6\u7684\u5b57\u6bb5\u503c\u6709`text`\u7c7b\u578b\u5b57\u6bb5\u4f1a\u81ea\u52a8\u964d\u7ea7\u4e3a\u4ece`_source`\u4e2d\u83b7\u53d6\n+2. \u5728\u83b7\u53d6\u7684\u5b57\u6bb5\u6570\u91cf\u8fc7\u591a\u7684\u60c5\u51b5\u4e0b(`>= 25`)\uff0c\u4ece`docvalue`\u4e2d\u83b7\u53d6\u5b57\u6bb5\u503c\u7684\u6027\u80fd\u4f1a\u548c\u4ece`_source`\u4e2d\u83b7\u53d6\u5b57\u6bb5\u503c\u57fa\u672c\u4e00\u6837\n \n-### \u67e5\u8be2\n \n-#### \u57fa\u672c\u6761\u4ef6\u8fc7\u6ee4\n+### \u63a2\u6d4bkeyword\u7c7b\u578b\u5b57\u6bb5(enable\\_keyword\\_sniff=true)\n+\n+```\n+CREATE EXTERNAL TABLE `test` (\n+  `k1` bigint(20) COMMENT \"\",\n+  `k2` datetime COMMENT \"\",\n+  `k3` varchar(20) COMMENT \"\",\n+  `k4` varchar(100) COMMENT \"\",\n+  `k5` float COMMENT \"\"\n+) ENGINE=ELASTICSEARCH\n+PROPERTIES (\n+\"hosts\" = \"http://192.168.0.1:8200,http://192.168.0.2:8200\",\n+\"index\" = \"test\u201d,\n+\"type\" = \"doc\",\n+\"user\" = \"root\",\n+\"password\" = \"root\",\n+\n+\"enable_keyword_sniff\" = \"true\"\n+);\n+```\n+\n+\u53c2\u6570\u8bf4\u660e\uff1a\n+\n+\u53c2\u6570 | \u8bf4\u660e\n+---|---\n+**enable\\_keyword\\_sniff** | \u662f\u5426\u5bf9ES\u4e2d\u5b57\u7b26\u4e32\u7c7b\u578b\u5206\u8bcd\u7c7b\u578b(**text**) `fields` \u8fdb\u884c\u63a2\u6d4b\uff0c\u83b7\u53d6\u989d\u5916\u7684\u672a\u5206\u8bcd(**keyword**)\u5b57\u6bb5\u540d(multi-fields\u673a\u5236)\n+\n+\u5728ES\u4e2d\u53ef\u4ee5\u4e0d\u5efa\u7acbindex\u76f4\u63a5\u8fdb\u884c\u6570\u636e\u5bfc\u5165\uff0c\u8fd9\u65f6\u5019ES\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7d22\u5f15\uff0c\u9488\u5bf9\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u5b57\u6bb5ES\u4f1a\u521b\u5efa\u4e00\u4e2a\u65e2\u6709`text`\u7c7b\u578b\u7684\u5b57\u6bb5\u53c8\u6709`keyword`\u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u8fd9\u5c31\u662fES\u7684multi fields\u7279\u6027\uff0cmapping\u5982\u4e0b\uff1a\n+\n+```\n+\"k4\": {\n+   \"type\": \"text\",\n+   \"fields\": {\n+      \"keyword\": {   \n+         \"type\": \"keyword\",\n+         \"ignore_above\": 256\n+      }\n+   }\n+}\n+```\n+\u5bf9k4\u8fdb\u884c\u6761\u4ef6\u8fc7\u6ee4\u65f6\u6bd4\u5982=\uff0cDoris On ES\u4f1a\u5c06\u67e5\u8be2\u8f6c\u6362\u4e3aES\u7684TermQuery\n+\n+SQL\u8fc7\u6ee4\u6761\u4ef6\uff1a\n+\n+```\n+k4 = \"Doris On ES\"\n+```\n+\n+\u8f6c\u6362\u6210ES\u7684query DSL\u4e3a\uff1a\n+\n+```\n+\"term\" : {\n+    \"k4\": \"Doris On ES\"\n+\n+}\n+```\n+\n+\u56e0\u4e3ak4\u7684\u7b2c\u4e00\u5b57\u6bb5\u7c7b\u578b\u4e3a`text`\uff0c\u5728\u6570\u636e\u5bfc\u5165\u7684\u65f6\u5019\u5c31\u4f1a\u6839\u636ek4\u8bbe\u7f6e\u7684\u5206\u8bcd\u5668(\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\uff0c\u5c31\u662fstandard\u5206\u8bcd\u5668)\u8fdb\u884c\u5206\u8bcd\u5904\u7406\u5f97\u5230doris\u3001on\u3001es\u4e09\u4e2aTerm\uff0c\u5982\u4e0bES analyze API\u5206\u6790\uff1a\n+\n+```\n+POST /_analyze\n+{\n+  \"analyzer\": \"standard\",\n+  \"text\": \"Doris On ES\"\n+}\n+```\n+\u5206\u8bcd\u7684\u7ed3\u679c\u662f\uff1a\n+\n+```\n+{\n+   \"tokens\": [\n+      {\n+         \"token\": \"doris\",\n+         \"start_offset\": 0,\n+         \"end_offset\": 5,\n+         \"type\": \"<ALPHANUM>\",\n+         \"position\": 0\n+      },\n+      {\n+         \"token\": \"on\",\n+         \"start_offset\": 6,\n+         \"end_offset\": 8,\n+         \"type\": \"<ALPHANUM>\",\n+         \"position\": 1\n+      },\n+      {\n+         \"token\": \"es\",\n+         \"start_offset\": 9,\n+         \"end_offset\": 11,\n+         \"type\": \"<ALPHANUM>\",\n+         \"position\": 2\n+      }\n+   ]\n+}\n+```\n+\u67e5\u8be2\u65f6\u4f7f\u7528\u7684\u662f\uff1a\n+\n+```\n+\"term\" : {\n+    \"k4\": \"Doris On ES\"\n+}\n+```\n+`Doris On ES`\u8fd9\u4e2aterm\u5339\u914d\u4e0d\u5230\u8bcd\u5178\u4e2d\u7684\u4efb\u4f55term\uff0c\u4e0d\u4f1a\u8fd4\u56de\u4efb\u4f55\u7ed3\u679c\uff0c\u800c\u542f\u7528`enable_keyword_sniff: true`\u4f1a\u81ea\u52a8\u5c06`k4 = \"Doris On ES\"`\u8f6c\u6362\u6210`k4.keyword = \"Doris On ES\"`\u6765\u5b8c\u5168\u5339\u914dSQL\u8bed\u4e49\uff0c\u8f6c\u6362\u540e\u7684ES query DSL\u4e3a:\n+\n+```\n+\"term\" : {\n+    \"k4.keyword\": \"Doris On ES\"\n+}\n+```\n+\n+`k4.keyword` \u7684\u7c7b\u578b\u662f`keyword`\uff0c\u6570\u636e\u5199\u5165ES\u4e2d\u662f\u4e00\u4e2a\u5b8c\u6574\u7684term\uff0c\u6240\u4ee5\u53ef\u4ee5\u5339\u914d\n+\n+### \u67e5\u8be2\u7528\u6cd5\n+\n+\u5b8c\u6210\u5728Doris\u4e2d\u5efa\u7acbES\u5916\u8868\u540e\uff0c\u9664\u4e86\u65e0\u6cd5\u4f7f\u7528Doris\u4e2d\u7684\u6570\u636e\u6a21\u578b(rollup\u3001\u9884\u805a\u5408\u3001\u7269\u5316\u89c6\u56fe\u7b49)\u5916\u5e76\u65e0\u533a\u522b\n+\n+#### \u57fa\u672c\u67e5\u8be2\n \n ```\n select * from es_table where k1 > 1000 and k3 ='term' or k4 like 'fu*z_'\n ```\n \n-#### \u6269\u5c55\u7684esquery sql\u8bed\u6cd5\n+#### \u6269\u5c55\u7684esquery\n \u901a\u8fc7`esquery`\u51fd\u6570\u5c06\u4e00\u4e9b\u65e0\u6cd5\u7528sql\u8868\u8ff0\u7684ES query\u5982match\u3001geoshape\u7b49\u4e0b\u63a8\u7ed9ES\u8fdb\u884c\u8fc7\u6ee4\u5904\u7406\uff0c`esquery`\u7684\u7b2c\u4e00\u4e2a\u5217\u540d\u53c2\u6570\u7528\u4e8e\u5173\u8054`index`\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662fES\u7684\u57fa\u672c`Query DSL`\u7684json\u8868\u8ff0\uff0c\u4f7f\u7528\u82b1\u62ec\u53f7`{}`\u5305\u542b\uff0cjson\u7684`root key`\u6709\u4e14\u53ea\u80fd\u6709\u4e00\u4e2a\uff0c\u5982match\u3001geo_shape\u3001bool\u7b49", "originalCommit": "9294beca76d54ec326e559feb5daaf1aaa61610e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDExMDI0OQ==", "url": "https://github.com/apache/incubator-doris/pull/3867#discussion_r440110249", "bodyText": "\u4e0d\u4e0d=\u4e0d", "author": "wutiangan", "createdAt": "2020-06-15T11:29:59Z", "path": "docs/zh-CN/extending-doris/doris-on-es.md", "diffHunk": "@@ -195,37 +443,30 @@ select * from es_table where esquery(k4, ' {\n \n 1. \u521b\u5efaES\u5916\u8868\u540e\uff0cFE\u4f1a\u8bf7\u6c42\u5efa\u8868\u6307\u5b9a\u7684\u4e3b\u673a\uff0c\u83b7\u53d6\u6240\u6709\u8282\u70b9\u7684HTTP\u7aef\u53e3\u4fe1\u606f\u4ee5\u53caindex\u7684shard\u5206\u5e03\u4fe1\u606f\u7b49\uff0c\u5982\u679c\u8bf7\u6c42\u5931\u8d25\u4f1a\u987a\u5e8f\u904d\u5386host\u5217\u8868\u76f4\u81f3\u6210\u529f\u6216\u5b8c\u5168\u5931\u8d25\n \n-2. \u67e5\u8be2\u65f6\uff0c\u4f1a\u6839\u636eFE\u5f97\u5230\u7684\u4e00\u4e9b\u8282\u70b9\u4fe1\u606f\u548cindex\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u751f\u6210\u67e5\u8be2\u8ba1\u5212\u5e76\u53d1\u7ed9\u5bf9\u5e94\u7684BE\u8282\u70b9\n+2. \u67e5\u8be2\u65f6\u4f1a\u6839\u636eFE\u5f97\u5230\u7684\u4e00\u4e9b\u8282\u70b9\u4fe1\u606f\u548cindex\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u751f\u6210\u67e5\u8be2\u8ba1\u5212\u5e76\u53d1\u7ed9\u5bf9\u5e94\u7684BE\u8282\u70b9\n \n-3. BE\u8282\u70b9\u4f1a\u6839\u636e`\u5c31\u8fd1\u539f\u5219`\u5373\u4f18\u5148\u8bf7\u6c42\u672c\u5730\u90e8\u7f72\u7684ES\u8282\u70b9\uff0cBE\u901a\u8fc7`HTTP Scroll`\u65b9\u5f0f\u6d41\u5f0f\u7684\u4eceES index\u7684\u6bcf\u4e2a\u5206\u7247\u4e2d\u5e76\u53d1\u7684\u83b7\u53d6\u6570\u636e\n+3. BE\u8282\u70b9\u4f1a\u6839\u636e`\u5c31\u8fd1\u539f\u5219`\u5373\u4f18\u5148\u8bf7\u6c42\u672c\u5730\u90e8\u7f72\u7684ES\u8282\u70b9\uff0cBE\u901a\u8fc7`HTTP Scroll`\u65b9\u5f0f\u6d41\u5f0f\u7684\u4eceES index\u7684\u6bcf\u4e2a\u5206\u7247\u4e2d\u5e76\u53d1\u7684\u4ece`_source`\u6216`docvalue`\u4e2d\u83b7\u53d6\u6570\u636e\n \n-4. \u8ba1\u7b97\u5b8c\u7ed3\u679c\u540e\uff0c\u8fd4\u56de\u7ed9client\u7aef\n-\n-## Push-Down operations\n-`Doris On Elasticsearch`\u4e00\u4e2a\u91cd\u8981\u7684\u529f\u80fd\u5c31\u662f\u8fc7\u6ee4\u6761\u4ef6\u7684\u4e0b\u63a8: \u8fc7\u6ee4\u6761\u4ef6\u4e0b\u63a8\u7ed9ES\uff0c\u8fd9\u6837\u53ea\u6709\u771f\u6b63\u6ee1\u8db3\u6761\u4ef6\u7684\u6570\u636e\u624d\u4f1a\u88ab\u8fd4\u56de\uff0c\u80fd\u591f\u663e\u8457\u7684\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u548c\u964d\u4f4eDoris\u548cElasticsearch\u7684CPU\u3001memory\u3001IO\u5229\u7528\u7387\n-\n-\u4e0b\u9762\u7684\u64cd\u4f5c\u7b26(Operators)\u4f1a\u88ab\u4f18\u5316\u6210\u5982\u4e0b\u4e0b\u63a8filters:\n-\n-| SQL syntax  | ES 5.x+ syntax | \n-|-------|:---:|\n-| =   | term query|\n-| in  | terms query   |\n-| > , < , >= , \u21d0  | range   |\n-| and  | bool.filter   |\n-| or  | bool.should   |\n-| not  | bool.must_not   |\n-| not in  | bool.must_not + terms  |\n-| esquery  | ES Query DSL   |\n+4. Doris\u8ba1\u7b97\u5b8c\u7ed3\u679c\u540e\uff0c\u8fd4\u56de\u7ed9\u7528\u6237\n \n \n-## \u5176\u4ed6\u8bf4\u660e\n+## Q&A\n \n-1. ES\u7684\u7248\u672c\u8981\u6c42\n+1. Doris On ES\u5bf9ES\u7684\u7248\u672c\u8981\u6c42\n \n-    ES\u4e3b\u7248\u672c\u5927\u4e8e5\uff0cES\u57282.x\u4e4b\u524d\u548c5.x\u4e4b\u540e\u6570\u636e\u7684\u626b\u63cf\u65b9\u5f0f\u4e0d\u540c\uff0c\u76ee\u524d\u652f\u63015.x\u4e4b\u540e\u7684\n+    ES\u4e3b\u7248\u672c\u5927\u4e8e5\uff0cES\u57282.x\u4e4b\u524d\u548c5.x\u4e4b\u540e\u6570\u636e\u7684\u626b\u63cf\u65b9\u5f0f\u4e0d\u540c\uff0c\u76ee\u524d\u652f\u6301\u4ec55.x\u4e4b\u540e\u7684\n+    \n 2. \u662f\u5426\u652f\u6301X-Pack\u8ba4\u8bc1\u7684ES\u96c6\u7fa4\n \n     \u652f\u6301\u6240\u6709\u4f7f\u7528HTTP Basic\u8ba4\u8bc1\u65b9\u5f0f\u7684ES\u96c6\u7fa4\n 3. \u4e00\u4e9b\u67e5\u8be2\u6bd4\u8bf7\u6c42ES\u6162\u5f88\u591a\n \n     \u662f\uff0c\u6bd4\u5982_count\u76f8\u5173\u7684query\u7b49\uff0cES\u5185\u90e8\u4f1a\u76f4\u63a5\u8bfb\u53d6\u6ee1\u8db3\u6761\u4ef6\u7684\u6587\u6863\u4e2a\u6570\u76f8\u5173\u7684\u5143\u6570\u636e\uff0c\u4e0d\u9700\u8981\u5bf9\u771f\u5b9e\u7684\u6570\u636e\u8fdb\u884c\u8fc7\u6ee4\n+\n+4. \u805a\u5408\u64cd\u4f5c\u662f\u5426\u53ef\u4ee5\u4e0b\u63a8\n+\n+   \u76ee\u524dDoris On ES\u4e0d\u652f\u6301\u805a\u5408\u64cd\u4f5c\u5982sum, avg, min/max \u7b49\u4e0b\u63a8\uff0c\u8ba1\u7b97\u65b9\u5f0f\u662f\u6279\u91cf\u6d41\u5f0f\u7684\u4eceES\u83b7\u53d6\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684\u6587\u6863\uff0c\u7136\u540e\u5728Doris\u4e2d\u8fdb\u884c\u8ba1\u7b97\n+   \n+5. \u65e5\u671f\u7c7b\u578b\u5b57\u6bb5\u7684\u8fc7\u6ee4\u6761\u4ef6\u65e0\u6cd5\u4e0b\u63a8\n+   \n+   \u65e5\u671f\u7c7b\u578b\u7684\u5b57\u6bb5\u56e0\u4e3a\u65f6\u95f4\u683c\u5f0f\u7684\u95ee\u9898\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u90fd\u4e0d\u4e0d\u4f1a\u4e0b\u63a8\uff1b\u5bf9\u4e8e\u65e5\u671f\u7c7b\u578b\u7684\u8fc7\u6ee4\u53ef\u4ee5\u91c7\u7528\u5b57\u7b26\u4e32\u5f62\u5f0f\uff0c\u65e5\u671f\u683c\u5f0f\u9700\u8981\u548cES\u4e2d\u4fdd\u6301\u5b8c\u5168\u4e00\u81f4", "originalCommit": "9294beca76d54ec326e559feb5daaf1aaa61610e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1fc7ed1fa2151a398dbc14afc88094be573fd7c0", "url": "https://github.com/apache/incubator-doris/commit/1fc7ed1fa2151a398dbc14afc88094be573fd7c0", "message": "reorginize some sentence", "committedDate": "2020-06-16T01:25:07Z", "type": "commit"}, {"oid": "58c49e9bca594fbff9731fb4fe00ff95e21cb586", "url": "https://github.com/apache/incubator-doris/commit/58c49e9bca594fbff9731fb4fe00ff95e21cb586", "message": "reorginize some sentence", "committedDate": "2020-06-16T09:24:25Z", "type": "commit"}]}