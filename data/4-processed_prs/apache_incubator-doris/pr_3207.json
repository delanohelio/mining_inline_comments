{"pr_number": 3207, "pr_title": "StorageEngine: unused_rowsets use unordered_multimap", "pr_createdAt": "2020-03-26T08:14:32Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3207", "timeline": [{"oid": "d1c46976982506e8865eb2f204e7d76d82688046", "url": "https://github.com/apache/incubator-doris/commit/d1c46976982506e8865eb2f204e7d76d82688046", "message": "unused_rowsets use unordered_multimap", "committedDate": "2020-03-26T07:51:30Z", "type": "commit"}, {"oid": "62e913ca3c156eefc1589cc712c2629a0b511e37", "url": "https://github.com/apache/incubator-doris/commit/62e913ca3c156eefc1589cc712c2629a0b511e37", "message": "format selection", "committedDate": "2020-03-26T07:59:08Z", "type": "commit"}, {"oid": "29ab44da5e77fd4c413a5acd669acedcf00c3239", "url": "https://github.com/apache/incubator-doris/commit/29ab44da5e77fd4c413a5acd669acedcf00c3239", "message": "fix", "committedDate": "2020-03-26T10:35:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUwNzQ0Nw==", "url": "https://github.com/apache/incubator-doris/pull/3207#discussion_r398507447", "bodyText": "Previous, rowset_id is not unique.\nNowadays, rowset_id is unique. So you can use std::unordered_map<std::string, RowsetSharedPtr> _unused_rowsets instead, not use unique_id().", "author": "chaoyli", "createdAt": "2020-03-26T11:42:21Z", "path": "be/src/olap/storage_engine.h", "diffHunk": "@@ -296,7 +296,9 @@ class StorageEngine {\n     static StorageEngine* _s_instance;\n \n     Mutex _gc_mutex;\n-    std::unordered_map<std::string, RowsetSharedPtr> _unused_rowsets;\n+    // map<rowset_id(str), pair<rowset_path(str),RowsetSharedPtr>>\n+    // if we use RowsetId as the key, we need custom hash func\n+    std::unordered_multimap<std::string, std::pair<std::string,RowsetSharedPtr>> _unused_rowsets;", "originalCommit": "29ab44da5e77fd4c413a5acd669acedcf00c3239", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUzNTIyNg==", "url": "https://github.com/apache/incubator-doris/pull/3207#discussion_r398535226", "bodyText": "It couldn't be better. I'll fix it.", "author": "vagetablechicken", "createdAt": "2020-03-26T12:32:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUwNzQ0Nw=="}], "type": "inlineReview"}, {"oid": "194a8a2938fcc8d4ba1bec4d654887bc835a0dfd", "url": "https://github.com/apache/incubator-doris/commit/194a8a2938fcc8d4ba1bec4d654887bc835a0dfd", "message": "remove rowset_path", "committedDate": "2020-03-27T02:37:49Z", "type": "commit"}, {"oid": "c930a2e76be4140f9de7a3840d04fd403b16801f", "url": "https://github.com/apache/incubator-doris/commit/c930a2e76be4140f9de7a3840d04fd403b16801f", "message": "fix", "committedDate": "2020-03-27T03:16:20Z", "type": "commit"}]}