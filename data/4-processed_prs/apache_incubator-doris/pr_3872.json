{"pr_number": 3872, "pr_title": "[Bug] Fix bug that BE crash when doing Insert Operation", "pr_createdAt": "2020-06-15T09:38:02Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3872", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDExNDQ1OQ==", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r440114459", "bodyText": "black list  --> blacklist", "author": "wutiangan", "createdAt": "2020-06-15T11:38:52Z", "path": "fe/src/main/java/org/apache/doris/qe/Coordinator.java", "diffHunk": "@@ -1469,8 +1470,41 @@ public boolean isBackendStateHealthy() {\n             try {\n                 return BackendServiceProxy.getInstance().execPlanFragmentAsync(brpcAddress, rpcParams);\n             } catch (RpcException e) {\n-                SimpleScheduler.addToBlacklist(backend.getId());\n-                throw e;\n+                // Do not throw exception here.\n+                // return a completed future, the caller will check the result and do the cancel process.\n+                PExecPlanFragmentResult result = new PExecPlanFragmentResult();\n+                PStatus pStatus = new PStatus();\n+                pStatus.error_msgs.add(e.getMessage());\n+                // use THRIFT_RPC_ERROR so that this BE will be added to the black list later.", "originalCommit": "ce38590182edb0771ec7166069a2467c66a07345", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxNjUwMA==", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r440616500", "bodyText": "done", "author": "morningman", "createdAt": "2020-06-16T06:35:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDExNDQ1OQ=="}], "type": "inlineReview"}, {"oid": "b0cb04ec83fcd571b699759c0431f3ad3e2c77d3", "url": "https://github.com/apache/incubator-doris/commit/b0cb04ec83fcd571b699759c0431f3ad3e2c77d3", "message": "remerge", "committedDate": "2020-06-15T12:48:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0OTcyNQ==", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r441249725", "bodyText": "If you have time. I think we would better use std::lock_guard and std:: mutex  instead of boost::lock_guard and boost::mutex.", "author": "kangkaisen", "createdAt": "2020-06-17T02:47:26Z", "path": "be/src/runtime/plan_fragment_executor.cpp", "diffHunk": "@@ -323,7 +323,12 @@ Status PlanFragmentExecutor::open_internal() {\n     {\n         SCOPED_TIMER(profile()->total_time_counter());\n         collect_query_statistics();\n-        Status status = _sink->close(runtime_state(), _status);\n+        Status status;\n+        {\n+            boost::lock_guard<boost::mutex> l(_status_lock);", "originalCommit": "5a73cc2a94f9ae88019226bd430bc97d7d823ad4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwNDQ1MQ==", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r442204451", "bodyText": "I will remove them in next PR", "author": "morningman", "createdAt": "2020-06-18T12:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0OTcyNQ=="}], "type": "inlineReview"}, {"oid": "4d08fc023cb3e8925283582db4c6cf49dc41b4dc", "url": "https://github.com/apache/incubator-doris/commit/4d08fc023cb3e8925283582db4c6cf49dc41b4dc", "message": "remerge", "committedDate": "2020-06-18T13:11:11Z", "type": "commit"}, {"oid": "6870491338a46ce2ce5d15cfab356f3e6d02f56e", "url": "https://github.com/apache/incubator-doris/commit/6870491338a46ce2ce5d15cfab356f3e6d02f56e", "message": "add missing code", "committedDate": "2020-06-18T13:11:11Z", "type": "commit"}, {"oid": "a9201abf538f2a86520ccd4a244a324cb7dc251c", "url": "https://github.com/apache/incubator-doris/commit/a9201abf538f2a86520ccd4a244a324cb7dc251c", "message": "fix ut", "committedDate": "2020-06-18T13:11:11Z", "type": "commit"}, {"oid": "a9201abf538f2a86520ccd4a244a324cb7dc251c", "url": "https://github.com/apache/incubator-doris/commit/a9201abf538f2a86520ccd4a244a324cb7dc251c", "message": "fix ut", "committedDate": "2020-06-18T13:11:11Z", "type": "forcePushed"}]}