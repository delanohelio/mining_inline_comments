{"pr_number": 3148, "pr_title": "improve performent of hash join in some case", "pr_createdAt": "2020-03-19T11:13:09Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3148", "timeline": [{"oid": "55530010711c6e4a627889ce7aba79dcc90064d1", "url": "https://github.com/apache/incubator-doris/commit/55530010711c6e4a627889ce7aba79dcc90064d1", "message": "improve performent of hash join in some case", "committedDate": "2020-03-19T11:32:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTAwMTU2NQ==", "url": "https://github.com/apache/incubator-doris/pull/3148#discussion_r395001565", "bodyText": "I think these compare can be done just once when initializing the HashJoinNode, no need to judge it for every row.", "author": "morningman", "createdAt": "2020-03-19T12:51:26Z", "path": "be/src/exec/hash_join_node_ir.cpp", "diffHunk": "@@ -137,11 +137,20 @@ int HashJoinNode::process_probe_batch(RowBatch* out_batch, RowBatch* probe_batch\n     return rows_returned;\n }\n \n+// when build table has too many duplicated rows, the collisions will be very serious,\n+// so in some case will don't need to store duplicated value in hash table, we can build an unique one\n void HashJoinNode::process_build_batch(RowBatch* build_batch) {\n     // insert build row into our hash table\n     for (int i = 0; i < build_batch->num_rows(); ++i) {\n-        _hash_tbl->insert(build_batch->get_row(i));\n+        if (_join_op == TJoinOp::LEFT_ANTI_JOIN|| _join_op == TJoinOp::RIGHT_ANTI_JOIN", "originalCommit": "55530010711c6e4a627889ce7aba79dcc90064d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxMDk2NQ==", "url": "https://github.com/apache/incubator-doris/pull/3148#discussion_r395410965", "bodyText": "done", "author": "yangzhg", "createdAt": "2020-03-20T02:09:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTAwMTU2NQ=="}], "type": "inlineReview"}, {"oid": "289cb3165ed23dc27efc76e3815c9dc8f097feae", "url": "https://github.com/apache/incubator-doris/commit/289cb3165ed23dc27efc76e3815c9dc8f097feae", "message": "improve performent of hash join in some case", "committedDate": "2020-03-20T02:08:26Z", "type": "forcePushed"}, {"oid": "ae2ecaccb12fd80dd240b9ff846746a476f7bf55", "url": "https://github.com/apache/incubator-doris/commit/ae2ecaccb12fd80dd240b9ff846746a476f7bf55", "message": "improve performent of hash join in some case", "committedDate": "2020-03-20T02:27:29Z", "type": "commit"}, {"oid": "ae2ecaccb12fd80dd240b9ff846746a476f7bf55", "url": "https://github.com/apache/incubator-doris/commit/ae2ecaccb12fd80dd240b9ff846746a476f7bf55", "message": "improve performent of hash join in some case", "committedDate": "2020-03-20T02:27:29Z", "type": "forcePushed"}]}