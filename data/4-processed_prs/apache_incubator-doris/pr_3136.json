{"pr_number": 3136, "pr_title": "[tablet meta] Do some refactor on TabletMeta", "pr_createdAt": "2020-03-18T07:53:49Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3136", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQwMzk1MQ==", "url": "https://github.com/apache/incubator-doris/pull/3136#discussion_r395403951", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                DCHECK(store);\n          \n          \n            \n                DCHECK(store != nullptr);\n          \n      \n    \n    \n  \n\nPrefer \"var != nullptr\" for pointer compare. Only use this when the bool value", "author": "imay", "createdAt": "2020-03-20T01:32:07Z", "path": "be/src/olap/task/engine_storage_migration_task.cpp", "diffHunk": "@@ -234,21 +225,13 @@ OLAPStatus EngineStorageMigrationTask::_storage_medium_migrate(\n }\n \n // TODO(ygl): lost some infomation here, such as cumulative layer point\n-OLAPStatus EngineStorageMigrationTask::_generate_new_header(\n+void EngineStorageMigrationTask::_generate_new_header(\n         DataDir* store, const uint64_t new_shard,\n         const TabletSharedPtr& tablet,\n         const std::vector<RowsetSharedPtr>& consistent_rowsets,\n         TabletMetaSharedPtr new_tablet_meta) {\n-    if (store == nullptr) {\n-        LOG(WARNING) << \"fail to generate new header for store is null\";\n-        return OLAP_ERR_HEADER_INIT_FAILED;\n-    }\n-    OLAPStatus res = tablet->generate_tablet_meta_copy(new_tablet_meta);\n-    if (res != OLAP_SUCCESS) {\n-        LOG(WARNING) << \"could not generate new tablet meta. \"\n-                     << \"tablet:\" << tablet->full_name();\n-        return res;\n-    }\n+    DCHECK(store);", "originalCommit": "55e033199e4928f3159d5017e1ac62d4b51ea457", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQwNTc5Nw==", "url": "https://github.com/apache/incubator-doris/pull/3136#discussion_r395405797", "bodyText": "Seems that it will be better to make argument a rvalue reference.", "author": "imay", "createdAt": "2020-03-20T01:42:02Z", "path": "be/src/olap/snapshot_manager.cpp", "diffHunk": "@@ -558,9 +541,9 @@ OLAPStatus SnapshotManager::_convert_beta_rowsets_to_alpha(const TabletMetaShare\n     }\n     if (res == OLAP_SUCCESS && modified) {\n         if (is_incremental) {\n-            res = new_tablet_meta->revise_inc_rs_metas(new_rowset_metas);\n+            new_tablet_meta->revise_inc_rs_metas(new_rowset_metas);", "originalCommit": "55e033199e4928f3159d5017e1ac62d4b51ea457", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQwNjA3OA==", "url": "https://github.com/apache/incubator-doris/pull/3136#discussion_r395406078", "bodyText": "same with above", "author": "imay", "createdAt": "2020-03-20T01:43:30Z", "path": "be/src/olap/snapshot_manager.cpp", "diffHunk": "@@ -558,9 +541,9 @@ OLAPStatus SnapshotManager::_convert_beta_rowsets_to_alpha(const TabletMetaShare\n     }\n     if (res == OLAP_SUCCESS && modified) {\n         if (is_incremental) {\n-            res = new_tablet_meta->revise_inc_rs_metas(new_rowset_metas);\n+            new_tablet_meta->revise_inc_rs_metas(new_rowset_metas);\n         } else {\n-            res = new_tablet_meta->revise_rs_metas(new_rowset_metas);\n+            new_tablet_meta->revise_rs_metas(new_rowset_metas);", "originalCommit": "55e033199e4928f3159d5017e1ac62d4b51ea457", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "90e88584cfb45a56329f26b8e27595014326e238", "url": "https://github.com/apache/incubator-doris/commit/90e88584cfb45a56329f26b8e27595014326e238", "message": "[tablet meta] Do some refactor on TabletMeta", "committedDate": "2020-03-20T02:33:22Z", "type": "commit"}, {"oid": "9942318e275b9d32ffd737f1eed181bc00cf97a2", "url": "https://github.com/apache/incubator-doris/commit/9942318e275b9d32ffd737f1eed181bc00cf97a2", "message": "add more", "committedDate": "2020-03-20T02:33:22Z", "type": "commit"}, {"oid": "250b06d6267c658b781094eb521fd1c66c146270", "url": "https://github.com/apache/incubator-doris/commit/250b06d6267c658b781094eb521fd1c66c146270", "message": "Update be/src/olap/task/engine_storage_migration_task.cpp\n\nCo-Authored-By: ZHAO Chun <buaa.zhaoc@gmail.com>", "committedDate": "2020-03-20T02:33:22Z", "type": "forcePushed"}, {"oid": "f84a7a899ce3ff8a48eb3c7a5dc006d4a1a7ebf8", "url": "https://github.com/apache/incubator-doris/commit/f84a7a899ce3ff8a48eb3c7a5dc006d4a1a7ebf8", "message": "fix by comments", "committedDate": "2020-03-20T03:15:06Z", "type": "commit"}, {"oid": "f84a7a899ce3ff8a48eb3c7a5dc006d4a1a7ebf8", "url": "https://github.com/apache/incubator-doris/commit/f84a7a899ce3ff8a48eb3c7a5dc006d4a1a7ebf8", "message": "fix by comments", "committedDate": "2020-03-20T03:15:06Z", "type": "forcePushed"}]}