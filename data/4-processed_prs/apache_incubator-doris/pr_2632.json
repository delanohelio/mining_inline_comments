{"pr_number": 2632, "pr_title": "[Rowset Reader] Improve the merge read efficiency of alpha rowsets", "pr_createdAt": "2020-01-01T09:15:20Z", "pr_url": "https://github.com/apache/incubator-doris/pull/2632", "timeline": [{"oid": "8dd286826f1cfb0317920c51bfbc65183c5651ce", "url": "https://github.com/apache/incubator-doris/commit/8dd286826f1cfb0317920c51bfbc65183c5651ce", "message": "first", "committedDate": "2019-12-31T16:46:49Z", "type": "commit"}, {"oid": "2bc401e6b68d23580f419905f745ceffb0cdafcc", "url": "https://github.com/apache/incubator-doris/commit/2bc401e6b68d23580f419905f745ceffb0cdafcc", "message": "second", "committedDate": "2020-01-01T08:03:21Z", "type": "commit"}, {"oid": "8a83b447feb1ae2ff62266254a4b8bbadb7788f9", "url": "https://github.com/apache/incubator-doris/commit/8a83b447feb1ae2ff62266254a4b8bbadb7788f9", "message": "second", "committedDate": "2020-01-01T09:12:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMxOTU3MQ==", "url": "https://github.com/apache/incubator-doris/pull/2632#discussion_r362319571", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            bool RowCursorWithOrdinalComparator::operator () (const RowCursorWithOrdinal &x, const RowCursorWithOrdinal &y) const {\n          \n          \n            \n            bool RowCursorWithOrdinalComparator::operator () (const RowCursorWithOrdinal& x, const RowCursorWithOrdinal& y) const {", "author": "imay", "createdAt": "2020-01-01T12:11:44Z", "path": "be/src/olap/rowset/alpha_rowset_reader.cpp", "diffHunk": "@@ -326,4 +382,8 @@ RowsetSharedPtr AlphaRowsetReader::rowset() {\n     return std::static_pointer_cast<Rowset>(_rowset);\n }\n \n+bool RowCursorWithOrdinalComparator::operator () (const RowCursorWithOrdinal &x, const RowCursorWithOrdinal &y) const {", "originalCommit": "8a83b447feb1ae2ff62266254a4b8bbadb7788f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMyMDAxMA==", "url": "https://github.com/apache/incubator-doris/pull/2632#discussion_r362320010", "bodyText": "why not use use RowCursorWithOrdinal as element of queue. If then, there is no need to record ordinal.", "author": "imay", "createdAt": "2020-01-01T12:20:32Z", "path": "be/src/olap/rowset/alpha_rowset_reader.h", "diffHunk": "@@ -103,6 +128,9 @@ class AlphaRowsetReader : public RowsetReader {\n     RowsetReaderContext* _current_read_context;\n     OlapReaderStatistics _owned_stats;\n     OlapReaderStatistics* _stats = &_owned_stats;\n+\n+    // a priority queue for merging rowsets\n+    std::priority_queue<RowCursorWithOrdinal, vector<RowCursorWithOrdinal>, RowCursorWithOrdinalComparator> _merge_queue;", "originalCommit": "8a83b447feb1ae2ff62266254a4b8bbadb7788f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3NzQ3Mw==", "url": "https://github.com/apache/incubator-doris/pull/2632#discussion_r362377473", "bodyText": "I removed the RowCursorWithOrdinal, and use MergeContext directly", "author": "morningman", "createdAt": "2020-01-02T06:09:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMyMDAxMA=="}], "type": "inlineReview"}, {"oid": "9f0d1c4fab9a92a972ce6284efa0914f246be5b7", "url": "https://github.com/apache/incubator-doris/commit/9f0d1c4fab9a92a972ce6284efa0914f246be5b7", "message": "4", "committedDate": "2020-01-01T13:44:57Z", "type": "commit"}, {"oid": "d6482b1f74935bcdfbaf235b64ccc7bb9ae703a8", "url": "https://github.com/apache/incubator-doris/commit/d6482b1f74935bcdfbaf235b64ccc7bb9ae703a8", "message": "fix by reviews", "committedDate": "2020-01-02T02:26:45Z", "type": "commit"}]}