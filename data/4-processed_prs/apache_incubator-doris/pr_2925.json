{"pr_number": 2925, "pr_title": "fix bug: Error of exporting double type data to hdfs (#2924)", "pr_createdAt": "2020-02-17T16:44:44Z", "pr_url": "https://github.com/apache/incubator-doris/pull/2925", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQzODEyNg==", "url": "https://github.com/apache/incubator-doris/pull/2925#discussion_r380438126", "bodyText": "why?", "author": "kangpinghuang", "createdAt": "2020-02-18T03:23:39Z", "path": "be/src/runtime/export_sink.cpp", "diffHunk": "@@ -142,10 +142,10 @@ Status ExportSink::gen_row_buffer(TupleRow* row, std::stringstream* ss) {\n                     (*ss) << reinterpret_cast<PackedInt128*>(item)->value;\n                     break;\n                 case TYPE_FLOAT:\n-                    (*ss) << *static_cast<float*>(item);\n+                    (*ss) << std::to_string(*static_cast<float*>(item));\n                     break;\n                 case TYPE_DOUBLE:\n-                    (*ss) << *static_cast<double*>(item);\n+                    (*ss) << std::to_string(*static_cast<double*>(item));", "originalCommit": "42ca89325f6d1f5ebd13e58225e8abcc1bf0f499", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQzODY0NQ==", "url": "https://github.com/apache/incubator-doris/pull/2925#discussion_r380438645", "bodyText": "Could you please add a comment to tell the reader why it was converted to a string first?\nFor example the following comment\uff1a\nTo prevent loss of precision on float and double types, they are converted to strings before output.\nFor example: For a double value 27361919854.929001, the direct output of using std::stringstream is 2.73619e + 10, and after conversion to a string, it outputs 27361919854.929001", "author": "lingbin", "createdAt": "2020-02-18T03:26:30Z", "path": "be/src/runtime/export_sink.cpp", "diffHunk": "@@ -142,10 +142,10 @@ Status ExportSink::gen_row_buffer(TupleRow* row, std::stringstream* ss) {\n                     (*ss) << reinterpret_cast<PackedInt128*>(item)->value;\n                     break;\n                 case TYPE_FLOAT:\n-                    (*ss) << *static_cast<float*>(item);\n+                    (*ss) << std::to_string(*static_cast<float*>(item));", "originalCommit": "42ca89325f6d1f5ebd13e58225e8abcc1bf0f499", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2NTM0NQ==", "url": "https://github.com/apache/incubator-doris/pull/2925#discussion_r380665345", "bodyText": "Please use FloatToBuffer(gutil/strings/numbers.h) to print float and double value", "author": "imay", "createdAt": "2020-02-18T13:18:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQzODY0NQ=="}], "type": "inlineReview"}, {"oid": "3b16781eeeb4eb31de8f78d21da734c7d74a4c58", "url": "https://github.com/apache/incubator-doris/commit/3b16781eeeb4eb31de8f78d21da734c7d74a4c58", "message": "fix bug: Error of exporting double type data to hdfs (#2924)", "committedDate": "2020-02-19T15:58:34Z", "type": "commit"}, {"oid": "ecd50db2d39b178737d7cf51517e218b41426ddc", "url": "https://github.com/apache/incubator-doris/commit/ecd50db2d39b178737d7cf51517e218b41426ddc", "message": "Merge branch 'master' of https://github.com/apache/incubator-doris into export_double_error", "committedDate": "2020-02-19T16:01:29Z", "type": "commit"}, {"oid": "2fb5e5acef6c899d5b595406bcc7900435d8e22c", "url": "https://github.com/apache/incubator-doris/commit/2fb5e5acef6c899d5b595406bcc7900435d8e22c", "message": "fix", "committedDate": "2020-02-20T02:55:21Z", "type": "commit"}, {"oid": "2fb5e5acef6c899d5b595406bcc7900435d8e22c", "url": "https://github.com/apache/incubator-doris/commit/2fb5e5acef6c899d5b595406bcc7900435d8e22c", "message": "fix", "committedDate": "2020-02-20T02:55:21Z", "type": "forcePushed"}]}