{"pr_number": 3219, "pr_title": "[Plugin] Making FE audit module pluggable", "pr_createdAt": "2020-03-27T16:10:37Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3219", "timeline": [{"oid": "646c0ad2f02e87d056388c3545d2e506e022e22d", "url": "https://github.com/apache/incubator-doris/commit/646c0ad2f02e87d056388c3545d2e506e022e22d", "message": "5", "committedDate": "2020-03-28T14:11:57Z", "type": "forcePushed"}, {"oid": "5a9afbfd4df138f00075d1eea2d412d591811654", "url": "https://github.com/apache/incubator-doris/commit/5a9afbfd4df138f00075d1eea2d412d591811654", "message": "6", "committedDate": "2020-03-29T04:08:28Z", "type": "forcePushed"}, {"oid": "e72850f8de1aada66ef561b24f34c21ee4e3986b", "url": "https://github.com/apache/incubator-doris/commit/e72850f8de1aada66ef561b24f34c21ee4e3986b", "message": "Add plugin", "committedDate": "2020-03-29T04:16:37Z", "type": "forcePushed"}, {"oid": "967669039893dc27074d753a2fd22b4eb8ca2812", "url": "https://github.com/apache/incubator-doris/commit/967669039893dc27074d753a2fd22b4eb8ca2812", "message": "Add plugin", "committedDate": "2020-03-29T15:00:24Z", "type": "forcePushed"}, {"oid": "5aedb241699ee23ee21c562751c7fb93275d1a1c", "url": "https://github.com/apache/incubator-doris/commit/5aedb241699ee23ee21c562751c7fb93275d1a1c", "message": "Add plugin", "committedDate": "2020-03-30T04:25:19Z", "type": "commit"}, {"oid": "5aedb241699ee23ee21c562751c7fb93275d1a1c", "url": "https://github.com/apache/incubator-doris/commit/5aedb241699ee23ee21c562751c7fb93275d1a1c", "message": "Add plugin", "committedDate": "2020-03-30T04:25:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkyNzAzNQ==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r399927035", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * \u672c\u90fd\u76ee\u5f55\u3002\u5982\uff1a`/home/work/data/plugin/`\u3002\u8fd9\u4e2a\u76f8\u5f53\u4e8e `.zip` \u6587\u4ef6\u89e3\u538b\u540e\u7684\u76ee\u5f55\u3002\u9700\u8981\u5728\u6240\u6709 FE \u548c BE \u8282\u70b9\u90e8\u7f72\u3002\n          \n          \n            \n            * \u672c\u5730\u76ee\u5f55\u3002\u5982\uff1a`/home/work/data/plugin/`\u3002\u8fd9\u4e2a\u76f8\u5f53\u4e8e `.zip` \u6587\u4ef6\u89e3\u538b\u540e\u7684\u76ee\u5f55\u3002\u9700\u8981\u5728\u6240\u6709 FE \u548c BE \u8282\u70b9\u90e8\u7f72\u3002", "author": "Seaven", "createdAt": "2020-03-30T04:56:19Z", "path": "docs/documentation/cn/extending-doris/plugin-development-manual.md", "diffHunk": "@@ -0,0 +1,291 @@\n+<!-- \n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+# \u63d2\u4ef6\u5f00\u53d1\u624b\u518c\n+\n+## \u4ecb\u7ecd\n+\n+Doris \u652f\u6301\u52a8\u6001\u52a0\u8f7d\u63d2\u4ef6\u3002\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5f00\u53d1\u81ea\u5df1\u7684\u63d2\u4ef6\u6765\u6269\u5c55Doris\u7684\u529f\u80fd\u3002\u8fd9\u4e2a\u624b\u518c\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u5f00\u53d1\u3001\u7f16\u8bd1\u548c\u90e8\u7f72 Frontend \u7aef\u7684\u63d2\u4ef6\u3002\n+\n+`fe_plugins` \u76ee\u5f55\u662f FE \u63d2\u4ef6\u7684\u6839\u6a21\u5757\u3002\u8fd9\u4e2a\u6839\u6a21\u5757\u7edf\u4e00\u7ba1\u7406\u63d2\u4ef6\u6240\u9700\u7684\u4f9d\u8d56\u3002\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u63d2\u4ef6\uff0c\u76f8\u5f53\u4e8e\u5728\u8fd9\u4e2a\u6839\u6a21\u5757\u6dfb\u52a0\u4e00\u4e2a\u5b50\u6a21\u5757\u3002\n+\n+## \u63d2\u4ef6\u7ec4\u6210\n+\n+\u4e00\u4e2aFE\u7684\u63d2\u4ef6\u53ef\u4ee5\u4f7f\u4e00\u4e2a**zip\u538b\u7f29\u5305**\u6216\u8005\u662f\u4e00\u4e2a**\u76ee\u5f55**\u3002\u5176\u5185\u5bb9\u81f3\u5c11\u5305\u542b\u4e24\u4e2a\u6587\u4ef6\uff1a`plugin.properties` \u548c `.jar` \u6587\u4ef6\u3002`plugin.properties`\u7528\u4e8e\u63cf\u8ff0\u63d2\u4ef6\u4fe1\u606f\u3002\n+\n+\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b\uff1a\n+\n+```\n+# plugin .zip\n+auditodemo.zip:\n+    -plugin.properties\n+    -auditdemo.jar\n+    -xxx.config\n+    -data/\n+    -test_data/\n+\n+# plugin local directory\n+auditodemo/:\n+    -plugin.properties\n+    -auditdemo.jar\n+    -xxx.config\n+    -data/\n+    -test_data/\n+```\n+\n+`plugin.properties` \u5185\u5bb9\u793a\u4f8b:\n+\n+```\n+### required:\n+#\n+# the plugin name\n+name = audit_plugin_demo\n+#\n+# the plugin type\n+type = AUDIT\n+#\n+# simple summary of the plugin\n+description = just for test\n+#\n+# Doris's version, like: 0.11.0\n+version = 0.11.0\n+\n+### FE-Plugin optional:\n+#\n+# version of java the code is built against\n+# use the command \"java -version\" value, like 1.8.0, 9.0.1, 13.0.4\n+java.version = 1.8.31\n+#\n+# the name of the class to load, fully-qualified.\n+classname = AuditPluginDemo\n+\n+### BE-Plugin optional:\n+# the name of the so to load\n+soName = example.so\n+```\n+\n+## \u7f16\u5199\u4e00\u4e2a\u63d2\u4ef6\n+\n+\u63d2\u4ef6\u7684\u5f00\u53d1\u73af\u5883\u4f9d\u8d56Doris\u7684\u5f00\u53d1\u7f16\u8bd1\u73af\u5883\u3002\u6240\u4ee5\u8bf7\u5148\u786e\u4fddDoris\u7684\u7f16\u8bd1\u5f00\u53d1\u73af\u5883\u8fd0\u884c\u6b63\u5e38\u3002\n+\n+### \u521b\u5efa\u4e00\u4e2a\u6a21\u5757\n+\n+\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u5728 `fe_plugins` \u76ee\u5f55\u521b\u5efa\u4e00\u4e2a\u5b50\u6a21\u5757\u7528\u6237\u5b9e\u73b0\u521b\u5efa\u548c\u521b\u5efa\u5de5\u7a0b\u3002\u5176\u4e2d `doris-fe-test` \u4e3a\u63d2\u4ef6\u540d\u79f0\u3002\n+\n+```\n+mvn archetype: generate -DarchetypeCatalog = internal -DgroupId = org.apache -DartifactId = doris-fe-test -DinteractiveMode = false\n+```\n+\n+\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 maven \u5de5\u7a0b\uff0c\u5e76\u4e14\u81ea\u52a8\u5411 `fe_plugins/pom.xml` \u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5b50\u6a21\u5757\uff1a\n+\n+```\n+\u00a0\u00a0\u00a0\u00a0.....\n+\u00a0\u00a0\u00a0\u00a0<groupId>org.apache</groupId>\n+\u00a0\u00a0\u00a0\u00a0<artifactId>doris-fe-plugins</artifactId>\n+\u00a0\u00a0\u00a0\u00a0<packaging>pom</packaging>\n+\u00a0\u00a0\u00a0\u00a0<version>1.0-SNAPSHOT</version>\n+\u00a0\u00a0\u00a0\u00a0<modules>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<module>auditdemo</module>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# new plugin module\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<module>doris-fe-test</module>\n+\u00a0\u00a0\u00a0\u00a0</modules>\n+\u00a0\u00a0\u00a0\u00a0.....\n+```\n+\n+\u65b0\u7684\u5de5\u7a0b\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a\n+\n+```\n+-doris-fe-test/\n+-pom.xml\n+-src/\n+    ---- main/java/org/apache/\n+    ------- App.java # mvn auto generate, ignore\n+    ---- test/java/org/apache\n+```\n+\n+\u63a5\u4e0b\u6765\u6211\u4eec\u5728 `main` \u76ee\u5f55\u4e0b\u6dfb\u52a0\u4e00\u4e2a `assembly` \u76ee\u5f55\u6765\u5b58\u653e `plugin.properties` \u548c `zip.xml`\u3002\u6700\u7ec8\u7684\u5de5\u7a0b\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a\n+\n+```\n+-doris-fe-test/\n+-pom.xml\n+-src/\n+---- main/\n+------ assembly/\n+-------- plugin.properties\n+-------- zip.xml\n+------ java/org/apache/\n+--------App.java # mvn auto generate, ignore\n+---- test/java/org/apache\n+```\n+\n+### \u6dfb\u52a0 zip.xml\n+\n+`zip.xml` \u7528\u4e8e\u63cf\u8ff0\u6700\u7ec8\u751f\u6210\u7684 zip \u538b\u7f29\u5305\u4e2d\u7684\u6587\u4ef6\u5185\u5bb9\u3002\uff08\u5982 .jar file, plugin.properties \u7b49\u7b49\uff09\n+\n+```\n+<assembly>\n+\u00a0\u00a0\u00a0\u00a0<id>plugin</id>\n+\u00a0\u00a0\u00a0\u00a0<formats>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<format>zip</format>\n+\u00a0\u00a0\u00a0\u00a0</formats>\n+\u00a0\u00a0\u00a0\u00a0<!-IMPORTANT: must be false->\n+\u00a0\u00a0\u00a0\u00a0<includeBaseDirectory>false</includeBaseDirectory>\n+\u00a0\u00a0\u00a0\u00a0<fileSets>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<fileSet>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<directory>target</directory>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<includes>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<include>*.jar</include>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</ ncludes>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<outputDirectory>/</outputDirectory>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</fileSet>\n+\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<fileSet>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<directory>src/main/assembly</directory>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<includes>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<include>plugin.properties</include>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</includes>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<outputDirectory>/</outputDirectory>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</fileSet>\n+\u00a0\u00a0\u00a0\u00a0</fileSets>\n+</assembly>\n+```\n+\n+### \u66f4\u65b0 pom.xml\n+\n+\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u66f4\u65b0\u5b50\u6a21\u5757\u7684 `pom.xml` \u6587\u4ef6\uff0c\u6dfb\u52a0 doris-fe \u4f9d\u8d56\uff1a\n+\n+```\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <groupId>org.apache</groupId>\n+        <artifactId>doris-fe-plugins</artifactId>\n+        <version>1.0-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <artifactId>auditloader</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.apache</groupId>\n+            <artifactId>doris-fe</artifactId>\n+        </dependency>\n+\n+        <!-- other dependencies -->\n+        <dependency>\n+            ...\n+        </dependency>\n+    </dependencies>\n+\n+\n+    <build>\n+        <finalName>auditloader</finalName>\n+        <plugins>\n+            <plugin>\n+                <artifactId>maven-assembly-plugin</artifactId>\n+                <version>2.4.1</version>\n+                <configuration>\n+                    <appendAssemblyId>false</appendAssemblyId>\n+                    <descriptors>\n+                        <descriptor>src/main/assembly/zip.xml</descriptor>\n+                    </descriptors>\n+                </configuration>\n+                <executions>\n+                    <execution>\n+                        <id>make-assembly</id>\n+                        <phase>package</phase>\n+                        <goals>\n+                            <goal>single</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+</project>\n+```\n+\n+### \u5b9e\u73b0\u63d2\u4ef6\n+\n+\u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u6109\u5feb\u7684\u8fdb\u884c\u63d2\u4ef6\u529f\u80fd\u7684\u5f00\u53d1\u5566\u3002\u63d2\u4ef6\u9700\u8981\u5b9e\u73b0 `Plugin` \u63a5\u53e3\u3002\u5177\u4f53\u53ef\u4ee5\u53c2\u9605 Doris \u81ea\u5e26\u7684 `auditdemo` \u63d2\u4ef6\u793a\u4f8b\u4ee3\u7801\u3002\n+\n+### \u7f16\u8bd1\n+\n+\u5728\u7f16\u8bd1\u63d2\u4ef6\u4e4b\u524d\uff0c\u9700\u8981\u5148\u6267\u884c `sh build.sh --fe` \u8fdb\u884c Doris FE \u4ee3\u7801\u7684\u7f16\u8bd1\uff0c\u5e76\u786e\u4fdd\u7f16\u8bd1\u6210\u529f\u3002\n+\n+\u4e4b\u540e\uff0c\u6267\u884c `sh build_plugin.sh` \u7f16\u8bd1\u6240\u6709\u63d2\u4ef6\u3002\u6700\u7ec8\u7684\u4ea7\u51fa\u4f1a\u5b58\u653e\u5728 `fe_plugins/output` \u76ee\u5f55\u4e2d\u3002\n+\n+\u6216\u8005\u4e5f\u53ef\u4ee5\u6267\u884c `sh build_plugin.sh --p your_plugin_name` \u6765\u4ec5\u7f16\u8bd1\u6307\u5b9a\u7684\u63d2\u4ef6\u3002\n+ \n+### \u53e6\u4e00\u79cd\u5f00\u53d1\u65b9\u5f0f\n+\n+\u60a8\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u4fee\u6539\u81ea\u5e26\u7684 `auditdemo` \u63d2\u4ef6\u793a\u4f8b\u4ee3\u7801\u8fdb\u884c\u5f00\u53d1\u3002\n+\n+## \u90e8\u7f72\n+\n+\u63d2\u4ef6\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u4e09\u79cd\u65b9\u5f0f\u90e8\u7f72\u3002\n+\n+* \u5c06 `.zip` \u6587\u4ef6\u653e\u5728 Http \u6216 Https \u670d\u52a1\u5668\u4e0a\u3002\u5982\uff1a`http://xxx.xxxxxx.com/data/plugin.zip`, Doris \u4f1a\u4e0b\u8f7d\u8fd9\u4e2a\u6587\u4ef6\u3002\n+* \u672c\u5730 `.zip` \u6587\u4ef6\u3002 \u5982\uff1a`/home/work/data/plugin.zip`\u3002\u9700\u8981\u5728\u6240\u6709 FE \u548c BE \u8282\u70b9\u90e8\u7f72\u3002\n+* \u672c\u90fd\u76ee\u5f55\u3002\u5982\uff1a`/home/work/data/plugin/`\u3002\u8fd9\u4e2a\u76f8\u5f53\u4e8e `.zip` \u6587\u4ef6\u89e3\u538b\u540e\u7684\u76ee\u5f55\u3002\u9700\u8981\u5728\u6240\u6709 FE \u548c BE \u8282\u70b9\u90e8\u7f72\u3002", "originalCommit": "5aedb241699ee23ee21c562751c7fb93275d1a1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5MDY4Nw==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r400090687", "bodyText": "OK", "author": "morningman", "createdAt": "2020-03-30T10:36:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkyNzAzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzNDgxNw==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r399934817", "bodyText": "Maybe pluginPath is better ?", "author": "Seaven", "createdAt": "2020-03-30T05:28:30Z", "path": "fe/src/main/java/org/apache/doris/plugin/PluginContext.java", "diffHunk": "@@ -18,4 +18,14 @@\n package org.apache.doris.plugin;\n \n public class PluginContext {\n+\n+    private String pluginJarPath;", "originalCommit": "5aedb241699ee23ee21c562751c7fb93275d1a1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5MjIxNw==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r400092217", "bodyText": "OK", "author": "morningman", "createdAt": "2020-03-30T10:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzNDgxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk0MDQyMQ==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r399940421", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void setPluginJarPath(String pluginJarPath) {\n          \n          \n            \n                protected void setPluginJarPath(String pluginJarPath) {\n          \n      \n    \n    \n  \n\nLet user use the method is not a good idea", "author": "Seaven", "createdAt": "2020-03-30T05:49:02Z", "path": "fe/src/main/java/org/apache/doris/plugin/PluginContext.java", "diffHunk": "@@ -18,4 +18,14 @@\n package org.apache.doris.plugin;\n \n public class PluginContext {\n+\n+    private String pluginJarPath;\n+\n+    public void setPluginJarPath(String pluginJarPath) {", "originalCommit": "5aedb241699ee23ee21c562751c7fb93275d1a1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5MjQxMw==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r400092413", "bodyText": "OK", "author": "morningman", "createdAt": "2020-03-30T10:39:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk0MDQyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk0MTExOQ==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r399941119", "bodyText": "LOG.error ?", "author": "Seaven", "createdAt": "2020-03-30T05:51:32Z", "path": "fe/src/main/java/org/apache/doris/qe/AuditEventProcessor.java", "diffHunk": "@@ -0,0 +1,118 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.apache.doris.qe;\n+\n+import org.apache.doris.plugin.AuditEvent;\n+import org.apache.doris.plugin.AuditPlugin;\n+import org.apache.doris.plugin.Plugin;\n+import org.apache.doris.plugin.PluginInfo.PluginType;\n+import org.apache.doris.plugin.PluginMgr;\n+\n+import com.google.common.collect.Queues;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import java.util.List;\n+import java.util.concurrent.BlockingQueue;\n+import java.util.concurrent.TimeUnit;\n+\n+/*\n+ * Class for processing all audit events.\n+ * It will receive audit events and handle them to all AUDIT type plugins. \n+ */\n+public class AuditEventProcessor {\n+    private static final Logger LOG = LogManager.getLogger(AuditEventProcessor.class);\n+    private static final long UPDATE_PLUGIN_INTERVAL_MS = 60 * 1000; // 1min\n+\n+    private PluginMgr pluginMgr;\n+\n+    private List<Plugin> auditPlugins;\n+    private long lastUpdateTime = 0;\n+\n+    private BlockingQueue<AuditEvent> eventQueue = Queues.newLinkedBlockingDeque(10000);\n+    private Thread workerThread;\n+\n+    private volatile boolean isStopped = false;\n+\n+    public AuditEventProcessor(PluginMgr pluginMgr) {\n+        this.pluginMgr = pluginMgr;\n+    }\n+\n+    public void start() {\n+        workerThread = new Thread(new Worker(), \"AuditEventProcessor\");\n+        workerThread.start();\n+    }\n+\n+    public void stop() {\n+        isStopped = true;\n+        if (workerThread != null) {\n+            try {\n+                workerThread.join();\n+            } catch (InterruptedException e) {\n+                // TODO Auto-generated catch block\n+                e.printStackTrace();", "originalCommit": "5aedb241699ee23ee21c562751c7fb93275d1a1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5MzEwMA==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r400093100", "bodyText": "I will add a LOG.warn here", "author": "morningman", "createdAt": "2020-03-30T10:40:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk0MTExOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1ODI5MQ==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r399958291", "bodyText": "\u8fd0\u884c\u65f6", "author": "wutiangan", "createdAt": "2020-03-30T06:42:24Z", "path": "docs/documentation/cn/extending-doris/audit-plugin.md", "diffHunk": "@@ -0,0 +1,108 @@\n+<!-- \n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+# \u5ba1\u8ba1\u65e5\u5fd7\u63d2\u4ef6\n+\n+Doris \u7684\u5ba1\u8ba1\u65e5\u5fd7\u63d2\u4ef6\u662f\u5728 FE \u7684\u63d2\u4ef6\u6846\u67b6\u57fa\u7840\u4e0a\u5f00\u53d1\u7684\u3002\u662f\u4e00\u4e2a\u53ef\u9009\u63d2\u4ef6\u3002\u7528\u6237\u53ef\u4ee5\u5728\u8fd0\u884c\u662f\u5b89\u88c5\u6216\u5378\u8f7d\u8fd9\u4e2a\u63d2\u4ef6\u3002", "originalCommit": "5aedb241699ee23ee21c562751c7fb93275d1a1c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1OTI4MQ==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r399959281", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            partition by range(time) ()\n          \n          \n            \n            partition by range(time)", "author": "wutiangan", "createdAt": "2020-03-30T06:44:51Z", "path": "docs/documentation/cn/extending-doris/audit-plugin.md", "diffHunk": "@@ -0,0 +1,108 @@\n+<!-- \n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+# \u5ba1\u8ba1\u65e5\u5fd7\u63d2\u4ef6\n+\n+Doris \u7684\u5ba1\u8ba1\u65e5\u5fd7\u63d2\u4ef6\u662f\u5728 FE \u7684\u63d2\u4ef6\u6846\u67b6\u57fa\u7840\u4e0a\u5f00\u53d1\u7684\u3002\u662f\u4e00\u4e2a\u53ef\u9009\u63d2\u4ef6\u3002\u7528\u6237\u53ef\u4ee5\u5728\u8fd0\u884c\u662f\u5b89\u88c5\u6216\u5378\u8f7d\u8fd9\u4e2a\u63d2\u4ef6\u3002\n+\n+\u8be5\u63d2\u4ef6\u53ef\u4ee5\u5c06 FE \u7684\u5ba1\u8ba1\u65e5\u5fd7\u5b9a\u671f\u7684\u5bfc\u5165\u5230\u6307\u5b9a Doris \u96c6\u7fa4\u4e2d\uff0c\u4ee5\u65b9\u4fbf\u7528\u6237\u901a\u8fc7 SQL \u5bf9\u5ba1\u8ba1\u65e5\u5fd7\u8fdb\u884c\u67e5\u770b\u548c\u5206\u6790\u3002\n+\n+## \u7f16\u8bd1\u3001\u914d\u7f6e\u548c\u90e8\u7f72\n+\n+### \u7f16\u8bd1\n+\n+\u5728 Doris \u4ee3\u7801\u76ee\u5f55\u4e0b\u6267\u884c `sh build_plugin.sh` \u540e\uff0c\u4f1a\u5728 `fe_plugins/output` \u76ee\u5f55\u4e0b\u5f97\u5230 `auditloader.zip` \u6587\u4ef6\u3002\n+\n+### \u914d\u7f6e\n+\n+\u89e3\u538b `auditloader.zip` \u53ef\u4ee5\u770b\u5230\u4e09\u4e2a\u6587\u4ef6\uff1a\n+\n+```\n+auditloader.jar\n+plugin.properties\n+plugin.conf\n+```\n+\n+\u6253\u5f00 `plugin.conf` \u8fdb\u884c\u914d\u7f6e\u3002\u914d\u7f6e\u9879\u8bf4\u660e\u53c2\u89c1\u6ce8\u91ca\u3002\n+\n+\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u91cd\u65b0\u5c06\u4e09\u4e2a\u6587\u4ef6\u6253\u5305\u4e3a `auditloader.zip`.\n+\n+### \u90e8\u7f72\n+\n+\u60a8\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u6587\u4ef6\u653e\u7f6e\u5728\u4e00\u4e2a http \u4e0b\u8f7d\u670d\u52a1\u5668\u4e0a\uff0c\u6216\u8005\u62f7\u8d1d\u5230\u6240\u6709 FE \u7684\u6307\u5b9a\u76ee\u5f55\u4e0b\u3002\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u540e\u8005\u3002\n+\n+### \u5b89\u88c5\n+\n+\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u5b89\u88c5\u63d2\u4ef6\u524d\uff0c\u9700\u8981\u521b\u5efa\u4e4b\u524d\u5728 `plugin.conf` \u4e2d\u6307\u5b9a\u7684\u5ba1\u8ba1\u6570\u636e\u5e93\u548c\u8868\u3002\u5176\u4e2d\u5efa\u8868\u8bed\u53e5\u5982\u4e0b\uff1a\n+\n+```\n+create table doris_audit_tbl__\n+(\n+    query_id varchar(48) comment \"Unique query id\",\n+    time datetime not null comment \"Query start time\",\n+    client_ip varchar(32) comment \"Client IP\",\n+    user varchar(64) comment \"User name\",\n+    db varchar(96) comment \"Database of this query\",\n+    state varchar(8) comment \"Query result state. EOF, ERR, OK\",\n+    query_time bigint comment \"Query execution time in millisecond\",\n+    scan_bytes bigint comment \"Total scan bytes of this query\",\n+    scan_rows bigint comment \"Total scan rows of this query\",\n+    return_rows bigint comment \"Returned rows of this query\",\n+    stmt_id int comment \"An incremental id of statement\",\n+    is_query tinyint comment \"Is this statemt a query. 1 or 0\",\n+    frontend_ip varchar(32) comment \"Frontend ip of executing this statement\",\n+    stmt varchar(2048) comment \"The original statement, trimed if longer than 2048 bytes\"\n+)\n+partition by range(time) ()", "originalCommit": "5aedb241699ee23ee21c562751c7fb93275d1a1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5MzgxMw==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r400093813", "bodyText": "This is not a typo, there IS a () here, which means no partitions created in this statement.", "author": "morningman", "createdAt": "2020-03-30T10:42:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1OTI4MQ=="}], "type": "inlineReview"}, {"oid": "102b3e09a3cd0a2c51f7887fc0621b052f72a039", "url": "https://github.com/apache/incubator-doris/commit/102b3e09a3cd0a2c51f7887fc0621b052f72a039", "message": "fix some comment", "committedDate": "2020-03-30T06:44:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk2MTE4Mw==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r399961183", "bodyText": "\u4e00\u822c\u547d\u4ee4\u90fd\u662f-p(\u4e00\u4e2a-\uff0c\u5e76\u4e14p\u662f\u5355\u4e2a\u5b57\u6bcd)\u6216\u8005--plugin-name\uff08\u4e24\u4e2a--\uff0c\u5e76\u4e14plugin-name is full name\uff09", "author": "wutiangan", "createdAt": "2020-03-30T06:49:52Z", "path": "docs/documentation/cn/extending-doris/plugin-development-manual.md", "diffHunk": "@@ -0,0 +1,291 @@\n+<!-- \n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+# \u63d2\u4ef6\u5f00\u53d1\u624b\u518c\n+\n+## \u4ecb\u7ecd\n+\n+Doris \u652f\u6301\u52a8\u6001\u52a0\u8f7d\u63d2\u4ef6\u3002\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5f00\u53d1\u81ea\u5df1\u7684\u63d2\u4ef6\u6765\u6269\u5c55Doris\u7684\u529f\u80fd\u3002\u8fd9\u4e2a\u624b\u518c\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u5f00\u53d1\u3001\u7f16\u8bd1\u548c\u90e8\u7f72 Frontend \u7aef\u7684\u63d2\u4ef6\u3002\n+\n+`fe_plugins` \u76ee\u5f55\u662f FE \u63d2\u4ef6\u7684\u6839\u6a21\u5757\u3002\u8fd9\u4e2a\u6839\u6a21\u5757\u7edf\u4e00\u7ba1\u7406\u63d2\u4ef6\u6240\u9700\u7684\u4f9d\u8d56\u3002\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u63d2\u4ef6\uff0c\u76f8\u5f53\u4e8e\u5728\u8fd9\u4e2a\u6839\u6a21\u5757\u6dfb\u52a0\u4e00\u4e2a\u5b50\u6a21\u5757\u3002\n+\n+## \u63d2\u4ef6\u7ec4\u6210\n+\n+\u4e00\u4e2aFE\u7684\u63d2\u4ef6\u53ef\u4ee5\u4f7f\u4e00\u4e2a**zip\u538b\u7f29\u5305**\u6216\u8005\u662f\u4e00\u4e2a**\u76ee\u5f55**\u3002\u5176\u5185\u5bb9\u81f3\u5c11\u5305\u542b\u4e24\u4e2a\u6587\u4ef6\uff1a`plugin.properties` \u548c `.jar` \u6587\u4ef6\u3002`plugin.properties`\u7528\u4e8e\u63cf\u8ff0\u63d2\u4ef6\u4fe1\u606f\u3002\n+\n+\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b\uff1a\n+\n+```\n+# plugin .zip\n+auditodemo.zip:\n+    -plugin.properties\n+    -auditdemo.jar\n+    -xxx.config\n+    -data/\n+    -test_data/\n+\n+# plugin local directory\n+auditodemo/:\n+    -plugin.properties\n+    -auditdemo.jar\n+    -xxx.config\n+    -data/\n+    -test_data/\n+```\n+\n+`plugin.properties` \u5185\u5bb9\u793a\u4f8b:\n+\n+```\n+### required:\n+#\n+# the plugin name\n+name = audit_plugin_demo\n+#\n+# the plugin type\n+type = AUDIT\n+#\n+# simple summary of the plugin\n+description = just for test\n+#\n+# Doris's version, like: 0.11.0\n+version = 0.11.0\n+\n+### FE-Plugin optional:\n+#\n+# version of java the code is built against\n+# use the command \"java -version\" value, like 1.8.0, 9.0.1, 13.0.4\n+java.version = 1.8.31\n+#\n+# the name of the class to load, fully-qualified.\n+classname = AuditPluginDemo\n+\n+### BE-Plugin optional:\n+# the name of the so to load\n+soName = example.so\n+```\n+\n+## \u7f16\u5199\u4e00\u4e2a\u63d2\u4ef6\n+\n+\u63d2\u4ef6\u7684\u5f00\u53d1\u73af\u5883\u4f9d\u8d56Doris\u7684\u5f00\u53d1\u7f16\u8bd1\u73af\u5883\u3002\u6240\u4ee5\u8bf7\u5148\u786e\u4fddDoris\u7684\u7f16\u8bd1\u5f00\u53d1\u73af\u5883\u8fd0\u884c\u6b63\u5e38\u3002\n+\n+### \u521b\u5efa\u4e00\u4e2a\u6a21\u5757\n+\n+\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u5728 `fe_plugins` \u76ee\u5f55\u521b\u5efa\u4e00\u4e2a\u5b50\u6a21\u5757\u7528\u6237\u5b9e\u73b0\u521b\u5efa\u548c\u521b\u5efa\u5de5\u7a0b\u3002\u5176\u4e2d `doris-fe-test` \u4e3a\u63d2\u4ef6\u540d\u79f0\u3002\n+\n+```\n+mvn archetype: generate -DarchetypeCatalog = internal -DgroupId = org.apache -DartifactId = doris-fe-test -DinteractiveMode = false\n+```\n+\n+\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 maven \u5de5\u7a0b\uff0c\u5e76\u4e14\u81ea\u52a8\u5411 `fe_plugins/pom.xml` \u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5b50\u6a21\u5757\uff1a\n+\n+```\n+\u00a0\u00a0\u00a0\u00a0.....\n+\u00a0\u00a0\u00a0\u00a0<groupId>org.apache</groupId>\n+\u00a0\u00a0\u00a0\u00a0<artifactId>doris-fe-plugins</artifactId>\n+\u00a0\u00a0\u00a0\u00a0<packaging>pom</packaging>\n+\u00a0\u00a0\u00a0\u00a0<version>1.0-SNAPSHOT</version>\n+\u00a0\u00a0\u00a0\u00a0<modules>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<module>auditdemo</module>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# new plugin module\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<module>doris-fe-test</module>\n+\u00a0\u00a0\u00a0\u00a0</modules>\n+\u00a0\u00a0\u00a0\u00a0.....\n+```\n+\n+\u65b0\u7684\u5de5\u7a0b\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a\n+\n+```\n+-doris-fe-test/\n+-pom.xml\n+-src/\n+    ---- main/java/org/apache/\n+    ------- App.java # mvn auto generate, ignore\n+    ---- test/java/org/apache\n+```\n+\n+\u63a5\u4e0b\u6765\u6211\u4eec\u5728 `main` \u76ee\u5f55\u4e0b\u6dfb\u52a0\u4e00\u4e2a `assembly` \u76ee\u5f55\u6765\u5b58\u653e `plugin.properties` \u548c `zip.xml`\u3002\u6700\u7ec8\u7684\u5de5\u7a0b\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a\n+\n+```\n+-doris-fe-test/\n+-pom.xml\n+-src/\n+---- main/\n+------ assembly/\n+-------- plugin.properties\n+-------- zip.xml\n+------ java/org/apache/\n+--------App.java # mvn auto generate, ignore\n+---- test/java/org/apache\n+```\n+\n+### \u6dfb\u52a0 zip.xml\n+\n+`zip.xml` \u7528\u4e8e\u63cf\u8ff0\u6700\u7ec8\u751f\u6210\u7684 zip \u538b\u7f29\u5305\u4e2d\u7684\u6587\u4ef6\u5185\u5bb9\u3002\uff08\u5982 .jar file, plugin.properties \u7b49\u7b49\uff09\n+\n+```\n+<assembly>\n+\u00a0\u00a0\u00a0\u00a0<id>plugin</id>\n+\u00a0\u00a0\u00a0\u00a0<formats>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<format>zip</format>\n+\u00a0\u00a0\u00a0\u00a0</formats>\n+\u00a0\u00a0\u00a0\u00a0<!-IMPORTANT: must be false->\n+\u00a0\u00a0\u00a0\u00a0<includeBaseDirectory>false</includeBaseDirectory>\n+\u00a0\u00a0\u00a0\u00a0<fileSets>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<fileSet>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<directory>target</directory>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<includes>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<include>*.jar</include>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</ ncludes>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<outputDirectory>/</outputDirectory>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</fileSet>\n+\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<fileSet>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<directory>src/main/assembly</directory>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<includes>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<include>plugin.properties</include>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</includes>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<outputDirectory>/</outputDirectory>\n+\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0</fileSet>\n+\u00a0\u00a0\u00a0\u00a0</fileSets>\n+</assembly>\n+```\n+\n+### \u66f4\u65b0 pom.xml\n+\n+\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u66f4\u65b0\u5b50\u6a21\u5757\u7684 `pom.xml` \u6587\u4ef6\uff0c\u6dfb\u52a0 doris-fe \u4f9d\u8d56\uff1a\n+\n+```\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <groupId>org.apache</groupId>\n+        <artifactId>doris-fe-plugins</artifactId>\n+        <version>1.0-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <artifactId>auditloader</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.apache</groupId>\n+            <artifactId>doris-fe</artifactId>\n+        </dependency>\n+\n+        <!-- other dependencies -->\n+        <dependency>\n+            ...\n+        </dependency>\n+    </dependencies>\n+\n+\n+    <build>\n+        <finalName>auditloader</finalName>\n+        <plugins>\n+            <plugin>\n+                <artifactId>maven-assembly-plugin</artifactId>\n+                <version>2.4.1</version>\n+                <configuration>\n+                    <appendAssemblyId>false</appendAssemblyId>\n+                    <descriptors>\n+                        <descriptor>src/main/assembly/zip.xml</descriptor>\n+                    </descriptors>\n+                </configuration>\n+                <executions>\n+                    <execution>\n+                        <id>make-assembly</id>\n+                        <phase>package</phase>\n+                        <goals>\n+                            <goal>single</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+</project>\n+```\n+\n+### \u5b9e\u73b0\u63d2\u4ef6\n+\n+\u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u6109\u5feb\u7684\u8fdb\u884c\u63d2\u4ef6\u529f\u80fd\u7684\u5f00\u53d1\u5566\u3002\u63d2\u4ef6\u9700\u8981\u5b9e\u73b0 `Plugin` \u63a5\u53e3\u3002\u5177\u4f53\u53ef\u4ee5\u53c2\u9605 Doris \u81ea\u5e26\u7684 `auditdemo` \u63d2\u4ef6\u793a\u4f8b\u4ee3\u7801\u3002\n+\n+### \u7f16\u8bd1\n+\n+\u5728\u7f16\u8bd1\u63d2\u4ef6\u4e4b\u524d\uff0c\u9700\u8981\u5148\u6267\u884c `sh build.sh --fe` \u8fdb\u884c Doris FE \u4ee3\u7801\u7684\u7f16\u8bd1\uff0c\u5e76\u786e\u4fdd\u7f16\u8bd1\u6210\u529f\u3002\n+\n+\u4e4b\u540e\uff0c\u6267\u884c `sh build_plugin.sh` \u7f16\u8bd1\u6240\u6709\u63d2\u4ef6\u3002\u6700\u7ec8\u7684\u4ea7\u51fa\u4f1a\u5b58\u653e\u5728 `fe_plugins/output` \u76ee\u5f55\u4e2d\u3002\n+\n+\u6216\u8005\u4e5f\u53ef\u4ee5\u6267\u884c `sh build_plugin.sh --p your_plugin_name` \u6765\u4ec5\u7f16\u8bd1\u6307\u5b9a\u7684\u63d2\u4ef6\u3002", "originalCommit": "5aedb241699ee23ee21c562751c7fb93275d1a1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5Mzg3MA==", "url": "https://github.com/apache/incubator-doris/pull/3219#discussion_r400093870", "bodyText": "OK", "author": "morningman", "createdAt": "2020-03-30T10:42:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk2MTE4Mw=="}], "type": "inlineReview"}, {"oid": "87ba2fde9b3f379ccd217232e3471070de4ad59d", "url": "https://github.com/apache/incubator-doris/commit/87ba2fde9b3f379ccd217232e3471070de4ad59d", "message": "fix by review", "committedDate": "2020-03-30T10:45:04Z", "type": "commit"}]}