{"pr_number": 2884, "pr_title": "Add `sync_dir` interface to Env", "pr_createdAt": "2020-02-12T01:38:59Z", "pr_url": "https://github.com/apache/incubator-doris/pull/2884", "timeline": [{"oid": "da7bf2364fac43327449b195614095d733811ce9", "url": "https://github.com/apache/incubator-doris/commit/da7bf2364fac43327449b195614095d733811ce9", "message": "Add `sync_dir` interface to Env\n\nwhen we need to ensure that **a newly-created file** is fully\nsynchronized back to disk, we should call `fsync()` on the parent\ndirectory\u2014that is, the directory containing the newly-created file.\nThat is to say, In this situation, we should call `fsync()` on\nboth the newly-created file and its parent directory.\n\nUnfortunately, currently in Doris, in any scenario, directories\nare not fsynced.\n\nThis patch adds `sync_dir()` interface first, laying the goundwork\nfor future fixes.\n\nThis patch also remove unneeded private method `dir_exists()`.", "committedDate": "2020-02-11T15:46:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzOTI2OA==", "url": "https://github.com/apache/incubator-doris/pull/2884#discussion_r378039268", "bodyText": "necessity or not depends application logic. Is not depends on API", "author": "chaoyli", "createdAt": "2020-02-12T04:48:48Z", "path": "be/src/env/env.h", "diffHunk": "@@ -139,9 +138,21 @@ class Env {\n     // Delete the named file.\n     virtual Status delete_file(const std::string& fname) = 0;\n \n-    // Create the specified directory. Returns error if directory exists.\n+    // Create the specified directory.\n+    // NOTE: It will return error if the path already exist(not necessarily as a directory)\n     virtual Status create_dir(const std::string& dirname) = 0;", "originalCommit": "da7bf2364fac43327449b195614095d733811ce9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA1MjA0NA==", "url": "https://github.com/apache/incubator-doris/pull/2884#discussion_r378052044", "bodyText": "You may be misunderstood, \"not necessarily as a directory\" means for the case where pathname is a symbolic link, dangling, and so on,  this method will return error too.", "author": "lingbin", "createdAt": "2020-02-12T05:52:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzOTI2OA=="}], "type": "inlineReview"}]}