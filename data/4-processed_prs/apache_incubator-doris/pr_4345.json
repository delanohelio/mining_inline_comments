{"pr_number": 4345, "pr_title": "[Bug][MemTracker] Cleanup the mem tracker's constructor to avoid wrong usage", "pr_createdAt": "2020-08-12T13:29:24Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4345", "timeline": [{"oid": "9ca2af58be88ec8f55d85ddc83de6a3eaecfd4f8", "url": "https://github.com/apache/incubator-doris/commit/9ca2af58be88ec8f55d85ddc83de6a3eaecfd4f8", "message": "[Bug][MemTracker] Cleanup the mem tracker's contructor to avoid wrong usage\n\nIf a mem tracker has parent, it should be created by 'CreateTracker'.\nSo I removed other unused contructors.", "committedDate": "2020-08-12T13:18:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI3NTUwNw==", "url": "https://github.com/apache/incubator-doris/pull/4345#discussion_r469275507", "bodyText": "GetRequestPoolMemTracker is from\nhttps://github.com/cloudera/Impala/blob/495397101e5807c701df71ea288f4815d69c2c8a/be/src/runtime/mem-tracker.h#L497\nSo we didn't make it shared last time, just Ieave it as it is. Maybe we could return shared ptr, I think there should be no problem.", "author": "vagetablechicken", "createdAt": "2020-08-12T13:52:17Z", "path": "be/src/runtime/mem_tracker.h", "diffHunk": "@@ -588,14 +579,18 @@ class PoolMemTrackerRegistry {\n   /// with the process tracker as its parent. There is no explicit per-pool byte_limit\n   /// set at any particular impalad, so newly created trackers will always have a limit\n   /// of -1.\n+  /// TODO(cmy): this method is not used for now. the memtracker returned from here is\n+  ///            got from a shared_ptr in `pool_to_mem_trackers_`.\n+  ///            I don't know why it need to return a raw pointer.\n+  ///            If this method be further used, please notice that.", "originalCommit": "9ca2af58be88ec8f55d85ddc83de6a3eaecfd4f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMwNjE5Nw==", "url": "https://github.com/apache/incubator-doris/pull/4345#discussion_r469306197", "bodyText": "Okay, since this function has not been used yet, I will change the return value to shared_ptr", "author": "morningman", "createdAt": "2020-08-12T14:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI3NTUwNw=="}], "type": "inlineReview"}, {"oid": "8b2c5f4d997088d558db8efcf05e7760bfc60127", "url": "https://github.com/apache/incubator-doris/commit/8b2c5f4d997088d558db8efcf05e7760bfc60127", "message": "fix bug", "committedDate": "2020-08-12T14:56:30Z", "type": "commit"}]}