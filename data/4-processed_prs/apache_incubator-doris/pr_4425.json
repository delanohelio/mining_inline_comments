{"pr_number": 4425, "pr_title": "Support batch delete[part 2] ", "pr_createdAt": "2020-08-22T00:04:48Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4425", "timeline": [{"oid": "b90e9ff12229f825912e5ac09d827854e8991d36", "url": "https://github.com/apache/incubator-doris/commit/b90e9ff12229f825912e5ac09d827854e8991d36", "message": "support_batch_delete", "committedDate": "2020-08-21T15:28:43Z", "type": "commit"}, {"oid": "7fa15844c0648bfebc4f807ae157469b7fb31461", "url": "https://github.com/apache/incubator-doris/commit/7fa15844c0648bfebc4f807ae157469b7fb31461", "message": "support batch delete for read compaction", "committedDate": "2020-08-21T15:30:28Z", "type": "commit"}, {"oid": "89bb95363d47cb116fe82d745a57c09fa074b066", "url": "https://github.com/apache/incubator-doris/commit/89bb95363d47cb116fe82d745a57c09fa074b066", "message": "add field", "committedDate": "2020-08-21T15:32:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMwMjYwNg==", "url": "https://github.com/apache/incubator-doris/pull/4425#discussion_r475302606", "bodyText": "why\uff1f", "author": "yangzhg", "createdAt": "2020-08-24T01:51:28Z", "path": "be/src/olap/field.h", "diffHunk": "@@ -535,4 +535,4 @@ class FieldFactory {\n \n }  // namespace doris\n \n-#endif // DORIS_BE_SRC_OLAP_FIELD_H\n+#endif // DORIS_BE_SRC_OLAP_FIELD_H", "originalCommit": "89bb95363d47cb116fe82d745a57c09fa074b066", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMwMzg0OQ==", "url": "https://github.com/apache/incubator-doris/pull/4425#discussion_r475303849", "bodyText": "better user reinterpret_cast", "author": "yangzhg", "createdAt": "2020-08-24T01:57:28Z", "path": "be/src/olap/row_cursor.h", "diffHunk": "@@ -109,6 +109,14 @@ class RowCursor {\n         return column_schema(index)->index_size();\n     }\n \n+    inline bool is_delete() const {\n+        auto sign_idx = _schema->delete_sign_idx();\n+        if (sign_idx < 0) {\n+            return false;\n+        }\n+        return (*(char*) (cell(sign_idx).cell_ptr())) > 0;", "originalCommit": "89bb95363d47cb116fe82d745a57c09fa074b066", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMwMzk2Mg==", "url": "https://github.com/apache/incubator-doris/pull/4425#discussion_r475303962", "bodyText": "why\uff1f", "author": "yangzhg", "createdAt": "2020-08-24T01:57:56Z", "path": "be/src/olap/schema.h", "diffHunk": "@@ -158,4 +158,4 @@ class Schema {\n     int32_t _delete_sign_idx = -1;\n };\n \n-} // namespace doris\n+} // namespace doris", "originalCommit": "89bb95363d47cb116fe82d745a57c09fa074b066", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMwMzk3Ng==", "url": "https://github.com/apache/incubator-doris/pull/4425#discussion_r475303976", "bodyText": "why\uff1f", "author": "yangzhg", "createdAt": "2020-08-24T01:57:59Z", "path": "be/src/olap/schema.cpp", "diffHunk": "@@ -105,4 +105,4 @@ Schema::~Schema() {\n     }\n }\n \n-}\n+}", "originalCommit": "89bb95363d47cb116fe82d745a57c09fa074b066", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9f3164c2db2a7b058fb9eae855b618ca6760fbb8", "url": "https://github.com/apache/incubator-doris/commit/9f3164c2db2a7b058fb9eae855b618ca6760fbb8", "message": "fix", "committedDate": "2020-08-24T03:21:43Z", "type": "commit"}, {"oid": "73b7e62a7b18f2326ad0d29993fb09b42ab3634a", "url": "https://github.com/apache/incubator-doris/commit/73b7e62a7b18f2326ad0d29993fb09b42ab3634a", "message": "fix", "committedDate": "2020-08-24T03:25:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE2NDk5OQ==", "url": "https://github.com/apache/incubator-doris/pull/4425#discussion_r476164999", "bodyText": "unnessary empty lines", "author": "yangzhg", "createdAt": "2020-08-25T04:40:15Z", "path": "be/src/olap/reader.cpp", "diffHunk": "@@ -1033,14 +1039,20 @@ void Reader::_init_load_bf_columns(const ReaderParams& read_params) {\n }\n \n OLAPStatus Reader::_init_delete_condition(const ReaderParams& read_params) {\n+", "originalCommit": "73b7e62a7b18f2326ad0d29993fb09b42ab3634a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE2NTIxMg==", "url": "https://github.com/apache/incubator-doris/pull/4425#discussion_r476165212", "bodyText": "white spaces", "author": "yangzhg", "createdAt": "2020-08-25T04:40:33Z", "path": "be/src/olap/reader.cpp", "diffHunk": "@@ -427,14 +430,17 @@ OLAPStatus Reader::_unique_key_next_row(RowCursor* row_cursor, MemPool* mem_pool\n                 }\n                 break;\n             }\n-\n+            ", "originalCommit": "73b7e62a7b18f2326ad0d29993fb09b42ab3634a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE2NTUyNw==", "url": "https://github.com/apache/incubator-doris/pull/4425#discussion_r476165527", "bodyText": "why?", "author": "yangzhg", "createdAt": "2020-08-25T04:40:59Z", "path": "be/src/olap/tablet_schema.h", "diffHunk": "@@ -134,6 +134,7 @@ class TabletSchema {\n     bool _has_bf_fpp = false;\n     double _bf_fpp = 0;\n     bool _is_in_memory = false;\n+", "originalCommit": "73b7e62a7b18f2326ad0d29993fb09b42ab3634a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE2NTk1Mw==", "url": "https://github.com/apache/incubator-doris/pull/4425#discussion_r476165953", "bodyText": "why?", "author": "yangzhg", "createdAt": "2020-08-25T04:41:33Z", "path": "be/src/olap/reader.cpp", "diffHunk": "@@ -411,13 +414,13 @@ OLAPStatus Reader::_unique_key_next_row(RowCursor* row_cursor, MemPool* mem_pool\n             *eof = true;\n             return OLAP_SUCCESS;\n         }\n-\n         cur_delete_flag = _next_delete_flag;\n         // the verion is in reverse order, the first row is the highest version,\n         // in UNIQUE_KEY highest version is the final result, there is no need to\n         // merge the lower versions\n         direct_copy_row(row_cursor, *_next_key);\n         agg_finalize_row(_value_cids, row_cursor, mem_pool);\n+", "originalCommit": "73b7e62a7b18f2326ad0d29993fb09b42ab3634a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "20a592d1f375643971aa8932a5456a0fcb2570af", "url": "https://github.com/apache/incubator-doris/commit/20a592d1f375643971aa8932a5456a0fcb2570af", "message": "fix format", "committedDate": "2020-08-25T04:48:41Z", "type": "commit"}, {"oid": "20b2b6ef4742b2101ab6c9d81e0ad587a57193af", "url": "https://github.com/apache/incubator-doris/commit/20b2b6ef4742b2101ab6c9d81e0ad587a57193af", "message": "fix format", "committedDate": "2020-08-25T04:50:09Z", "type": "commit"}]}