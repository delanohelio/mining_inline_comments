{"pr_number": 3128, "pr_title": "[Thrift] Fix a bug when ThriftClientImpl close() error", "pr_createdAt": "2020-03-17T04:08:51Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3128", "timeline": [{"oid": "4ec74a4773f62fa13c07e3664c8bf88a987213b9", "url": "https://github.com/apache/incubator-doris/commit/4ec74a4773f62fa13c07e3664c8bf88a987213b9", "message": "[Thrift] Fix a bug when ThriftClientImpl close() error\n\nIn ThriftClientImpl close(), the under layer TTransport may throw an exception,\nthis pathch catch the exception to avoid crash.", "committedDate": "2020-03-17T03:55:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQzOTM3MQ==", "url": "https://github.com/apache/incubator-doris/pull/3128#discussion_r393439371", "bodyText": "prefer nullptr.", "author": "imay", "createdAt": "2020-03-17T04:31:03Z", "path": "be/src/util/thrift_client.cpp", "diffHunk": "@@ -65,12 +76,21 @@ Status ThriftClientImpl::open_with_retry(int num_tries, int wait_ms) {\n     return status;\n }\n \n-Status ThriftClientImpl::close() {\n-    if (_transport->isOpen()) {\n-        _transport->close();\n+void ThriftClientImpl::close() {\n+    try {\n+        if (_transport.get() != NULL && _transport->isOpen()) _transport->close();", "originalCommit": "4ec74a4773f62fa13c07e3664c8bf88a987213b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "20da32b833af6f73ad8a2c910b38a4ff6c85802c", "url": "https://github.com/apache/incubator-doris/commit/20da32b833af6f73ad8a2c910b38a4ff6c85802c", "message": "nullptr", "committedDate": "2020-03-17T05:35:17Z", "type": "commit"}]}