{"pr_number": 2839, "pr_title": "[Compaction] Avoid unnecessary compaction", "pr_createdAt": "2020-02-05T14:09:24Z", "pr_url": "https://github.com/apache/incubator-doris/pull/2839", "timeline": [{"oid": "b410933f6e44dcecb15e5700811602ca7712cc4a", "url": "https://github.com/apache/incubator-doris/commit/b410933f6e44dcecb15e5700811602ca7712cc4a", "message": "avoid compaction", "committedDate": "2020-02-05T14:06:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM0OTU4OQ==", "url": "https://github.com/apache/incubator-doris/pull/2839#discussion_r375349589", "bodyText": "We have checked input_rowsets.size  firstly, so _input_rowsets.size() at least should be 2 and the base_size should larger than zero.\n   if (_input_rowsets.size() <= 1) {\n        return OLAP_ERR_BE_NO_SUITABLE_VERSION;\n    }", "author": "kangkaisen", "createdAt": "2020-02-05T16:04:49Z", "path": "be/src/olap/base_compaction.cpp", "diffHunk": "@@ -87,6 +93,11 @@ OLAPStatus BaseCompaction::pick_rowsets_to_compact() {\n     }\n \n     double base_cumulative_delta_ratio = config::base_cumulative_delta_ratio;\n+    if (base_size == 0) {", "originalCommit": "b410933f6e44dcecb15e5700811602ca7712cc4a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYyNjg4MA==", "url": "https://github.com/apache/incubator-doris/pull/2839#discussion_r375626880", "bodyText": "_input_rowsets.size() is the number of rowsets.\nFor example, we have 2 rowsets with version: [0-1] and [2-2];\nthe base_size here is the data size of [0-1], which can be zero.", "author": "morningman", "createdAt": "2020-02-06T03:40:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM0OTU4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY0MjgwOQ==", "url": "https://github.com/apache/incubator-doris/pull/2839#discussion_r375642809", "bodyText": "OK.  I see.", "author": "kangkaisen", "createdAt": "2020-02-06T05:09:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM0OTU4OQ=="}], "type": "inlineReview"}, {"oid": "a58b2a82142022e940407b9539b906c989b4b778", "url": "https://github.com/apache/incubator-doris/commit/a58b2a82142022e940407b9539b906c989b4b778", "message": "fix compile bug", "committedDate": "2020-02-06T07:22:29Z", "type": "commit"}]}