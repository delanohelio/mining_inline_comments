{"pr_number": 4523, "pr_title": "[Bug] Fix bug of core local value", "pr_createdAt": "2020-09-02T13:17:07Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4523", "timeline": [{"oid": "edb18987c495d4fc3b512d1f1114c56137050007", "url": "https://github.com/apache/incubator-doris/commit/edb18987c495d4fc3b512d1f1114c56137050007", "message": "[Bug] Fix bug of core local value\n\nWhen creating core local value from CoreDataAllocator,\nA lock is needed to protect the modification of _blocks.", "committedDate": "2020-09-02T13:09:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2NzU5NA==", "url": "https://github.com/apache/incubator-doris/pull/4523#discussion_r482767594", "bodyText": "CoreData is to bind data to cpu to eliminate the lock.\nIf add a lock, it's design is meaningless.", "author": "chaoyli", "createdAt": "2020-09-03T07:33:21Z", "path": "be/src/util/core_local.cpp", "diffHunk": "@@ -61,6 +65,7 @@ class CoreDataAllocatorImpl : public CoreDataAllocator {\n     }\n private:\n     static constexpr int ELEMENTS_PER_BLOCK = BLOCK_SIZE / ELEMENT_BYTES;\n+    SpinLock _lock; // lock to protect the modification of _blocks", "originalCommit": "edb18987c495d4fc3b512d1f1114c56137050007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc4NjQ0Mw==", "url": "https://github.com/apache/incubator-doris/pull/4523#discussion_r482786443", "bodyText": "This is only used when creating the core local value (by calling get_or_create() of CoreDataAllocatorImpl).\nAnd when creating the value, there is nothing to do with \"cpu-bind\".\nThe so called \"cpu-bind\" operation happens when accessing the CoreLocalValue,\nnot related to CoreDataAllocatorImpl", "author": "morningman", "createdAt": "2020-09-03T08:04:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2NzU5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc4ODU4Mw==", "url": "https://github.com/apache/incubator-doris/pull/4523#discussion_r482788583", "bodyText": "OK, I have no problem.", "author": "chaoyli", "createdAt": "2020-09-03T08:07:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2NzU5NA=="}], "type": "inlineReview"}]}