{"pr_number": 2658, "pr_title": "[AlphaRowset] set num_segments field in rowset meta if missing", "pr_createdAt": "2020-01-04T08:13:31Z", "pr_url": "https://github.com/apache/incubator-doris/pull/2658", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAzMzk0OQ==", "url": "https://github.com/apache/incubator-doris/pull/2658#discussion_r363033949", "bodyText": "I think the cumulative rowsets will hit above if clause. So this comment is some misleading.", "author": "imay", "createdAt": "2020-01-04T12:52:33Z", "path": "be/src/olap/rowset/rowset_meta.h", "diffHunk": "@@ -326,11 +326,12 @@ class RowsetMeta {\n     //    so the segments in it are non overlapping.\n     // 2. the segments_overlap() flag in rowset meta is set to NONOVERLAPPING, explicitly.\n     bool is_segments_overlapping() const {\n-        if (num_segments() == 0) {\n-            // specially for delete version\n+        if (end_version() > start_version() || segments_overlap() == NONOVERLAPPING) {\n             return false;\n         }\n-        if (end_version() > start_version() || segments_overlap() == NONOVERLAPPING) {\n+\n+        // some of cumulative rowsets may have no segments.(no data, or a delete version)", "originalCommit": "bee2ebc69e9083c82e31c2124d9a4a52a3e5cdce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE3ODgyMw==", "url": "https://github.com/apache/incubator-doris/pull/2658#discussion_r363178823", "bodyText": "Changed", "author": "morningman", "createdAt": "2020-01-06T07:04:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAzMzk0OQ=="}], "type": "inlineReview"}, {"oid": "1a5dabae7cfb41f4cd294a17ebcfa59d3279e78f", "url": "https://github.com/apache/incubator-doris/commit/1a5dabae7cfb41f4cd294a17ebcfa59d3279e78f", "message": "first", "committedDate": "2020-01-06T09:01:04Z", "type": "commit"}, {"oid": "861160d0cb0b88e6c3db18486848a31a5e9b0a07", "url": "https://github.com/apache/incubator-doris/commit/861160d0cb0b88e6c3db18486848a31a5e9b0a07", "message": "second", "committedDate": "2020-01-06T09:01:04Z", "type": "commit"}, {"oid": "d14420c199c1a89dd92423647251edb7c8ee28d1", "url": "https://github.com/apache/incubator-doris/commit/d14420c199c1a89dd92423647251edb7c8ee28d1", "message": "third", "committedDate": "2020-01-06T09:01:04Z", "type": "commit"}, {"oid": "7b6dfa1a1202aea54218181e6ffbb454c8dba4b3", "url": "https://github.com/apache/incubator-doris/commit/7b6dfa1a1202aea54218181e6ffbb454c8dba4b3", "message": "fix comment", "committedDate": "2020-01-06T09:01:04Z", "type": "commit"}, {"oid": "3aac8a97ff879f31bda4ccd98ae8b316ab093a03", "url": "https://github.com/apache/incubator-doris/commit/3aac8a97ff879f31bda4ccd98ae8b316ab093a03", "message": "fix log", "committedDate": "2020-01-06T09:01:04Z", "type": "commit"}, {"oid": "f4c3bd87f354105447f878d4d7aa615e8b3d038d", "url": "https://github.com/apache/incubator-doris/commit/f4c3bd87f354105447f878d4d7aa615e8b3d038d", "message": "add log", "committedDate": "2020-01-06T09:01:04Z", "type": "commit"}, {"oid": "d21c827409ed2e8ead5305b14cd1376d8a25070c", "url": "https://github.com/apache/incubator-doris/commit/d21c827409ed2e8ead5305b14cd1376d8a25070c", "message": "fix", "committedDate": "2020-01-06T09:01:04Z", "type": "commit"}, {"oid": "d21c827409ed2e8ead5305b14cd1376d8a25070c", "url": "https://github.com/apache/incubator-doris/commit/d21c827409ed2e8ead5305b14cd1376d8a25070c", "message": "fix", "committedDate": "2020-01-06T09:01:04Z", "type": "forcePushed"}, {"oid": "041d06601e283dbe0eba0569014b536abe2229c8", "url": "https://github.com/apache/incubator-doris/commit/041d06601e283dbe0eba0569014b536abe2229c8", "message": "fix num row bug", "committedDate": "2020-01-06T11:23:17Z", "type": "commit"}, {"oid": "45ed0b8a58c12a33bc625ff3904f7150a6da51ad", "url": "https://github.com/apache/incubator-doris/commit/45ed0b8a58c12a33bc625ff3904f7150a6da51ad", "message": "check row nums", "committedDate": "2020-01-06T12:04:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI5NDQ1OQ==", "url": "https://github.com/apache/incubator-doris/pull/2658#discussion_r363294459", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                const AlphaRowsetExtraMetaPB& alpha_rowset_extra_meta_pb() {\n          \n          \n            \n                const AlphaRowsetExtraMetaPB& alpha_rowset_extra_meta_pb() const {", "author": "imay", "createdAt": "2020-01-06T13:34:34Z", "path": "be/src/olap/rowset/rowset_meta.h", "diffHunk": "@@ -350,6 +352,9 @@ class RowsetMeta {\n         return score;\n     }\n \n+    const AlphaRowsetExtraMetaPB& alpha_rowset_extra_meta_pb() {", "originalCommit": "45ed0b8a58c12a33bc625ff3904f7150a6da51ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "abf82d767f25f6fb61d93845225d3c55f977617f", "url": "https://github.com/apache/incubator-doris/commit/abf82d767f25f6fb61d93845225d3c55f977617f", "message": "Update be/src/olap/rowset/rowset_meta.h\n\nCo-Authored-By: ZHAO Chun <buaa.zhaoc@gmail.com>", "committedDate": "2020-01-06T14:06:19Z", "type": "commit"}, {"oid": "3fc38d606d6c1652c53369c3c996cf77beffad40", "url": "https://github.com/apache/incubator-doris/commit/3fc38d606d6c1652c53369c3c996cf77beffad40", "message": "fix ut", "committedDate": "2020-01-06T15:02:30Z", "type": "commit"}, {"oid": "71baa08ad9a919b109fdd508936bf829462bd680", "url": "https://github.com/apache/incubator-doris/commit/71baa08ad9a919b109fdd508936bf829462bd680", "message": "fix bug", "committedDate": "2020-01-07T01:02:46Z", "type": "commit"}, {"oid": "210d80e41a7b1babf8042718ae12a38033833104", "url": "https://github.com/apache/incubator-doris/commit/210d80e41a7b1babf8042718ae12a38033833104", "message": "fix bug", "committedDate": "2020-01-07T01:09:16Z", "type": "commit"}, {"oid": "3947d1c92125113cedc41ae54ecc566945a8e201", "url": "https://github.com/apache/incubator-doris/commit/3947d1c92125113cedc41ae54ecc566945a8e201", "message": "fix debug", "committedDate": "2020-01-07T01:24:42Z", "type": "commit"}]}