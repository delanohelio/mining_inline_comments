{"pr_number": 4347, "pr_title": "udf: replace function", "pr_createdAt": "2020-08-13T14:13:40Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4347", "timeline": [{"oid": "1a15f533098eec6708121004ef835d111dc374f3", "url": "https://github.com/apache/incubator-doris/commit/1a15f533098eec6708121004ef835d111dc374f3", "message": "udf: replace function", "committedDate": "2020-08-13T14:09:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNDk0OA==", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470004948", "bodyText": "In MySQL, this function named replace(), so better to name it as replace()", "author": "morningman", "createdAt": "2020-08-13T14:42:58Z", "path": "docs/zh-CN/sql-reference/sql-functions/string-functions/str_replace.md", "diffHunk": "@@ -0,0 +1,46 @@\n+---\n+{\n+    \"title\": \"str_replace\",", "originalCommit": "1a15f533098eec6708121004ef835d111dc374f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2MzgzNw==", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470363837", "bodyText": "replace is a keyword has been used by sql syntax analysis.", "author": "xinghuayu007", "createdAt": "2020-08-14T01:36:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNDk0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNTExNA==", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470005114", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ##keyword\n          \n          \n            \n            ## keyword", "author": "morningman", "createdAt": "2020-08-13T14:43:12Z", "path": "docs/en/sql-reference/sql-functions/string-functions/str_replace.md", "diffHunk": "@@ -0,0 +1,46 @@\n+---\n+{\n+    \"title\": \"str_replace\",\n+    \"language\": \"zh-CN\"\n+}\n+---\n+\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+# str_replace\n+## description\n+### Syntax\n+\n+`VARCHAR STR_REPLACE (VARCHAR str, VARCHAR old, VARCHAR new)`\n+\n+replace all old substring with new substring in str \n+\n+## example\n+\n+```\n+mysql> select str_replace(\"http://www.baidu.com:9090\", \"9090\", \"\");\n++------------------------------------------------------+\n+| str_replace('http://www.baidu.com:9090', '9090', '') |\n++------------------------------------------------------+\n+| http://www.baidu.com:                                |\n++------------------------------------------------------+\n+```\n+##keyword", "originalCommit": "1a15f533098eec6708121004ef835d111dc374f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNjQ1NA==", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470006454", "bodyText": "Should return null if any of them is null", "author": "morningman", "createdAt": "2020-08-13T14:45:02Z", "path": "be/src/exprs/string_functions.cpp", "diffHunk": "@@ -998,4 +998,23 @@ StringVal StringFunctions::split_part(FunctionContext* context, const StringVal&\n     int len = (find[field.val - 1] == -1 ? content.len : find[field.val - 1]) - start_pos;\n     return StringVal(content.ptr + start_pos, len);\n }\n+\n+StringVal StringFunctions::str_replace(FunctionContext *context, const StringVal &origStr, const StringVal &oldStr, const StringVal &newStr) {\n+    if (origStr.is_null || oldStr.is_null || newStr.is_null) {\n+        return origStr;", "originalCommit": "1a15f533098eec6708121004ef835d111dc374f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNzQ3Mw==", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470007473", "bodyText": "Better to add more tests to test to corner case, like null, empty string, expr2 longer than expr1, Chinese char, etc...", "author": "morningman", "createdAt": "2020-08-13T14:46:28Z", "path": "be/test/exprs/string_functions_test.cpp", "diffHunk": "@@ -494,6 +494,19 @@ TEST_F(StringFunctionsTest, rpad) {\n     ASSERT_EQ(StringVal(\"\u5475\u5475hih\"),\n               StringFunctions::rpad(ctx, StringVal(\"\u5475\u5475\"), IntVal(5), StringVal(\"hi\")));\n }\n+\n+TEST_F(StringFunctionsTest, str_replace) {\n+    ASSERT_EQ(StringVal(\"http://www.baidu.com:8080\"),\n+            StringFunctions::str_replace(ctx, StringVal(\"http://www.baidu.com:9090\"), StringVal(\"9090\"), StringVal(\"8080\")));\n+\n+    ASSERT_EQ(StringVal(\"http://www.baidu.com:9090\"),\n+        StringFunctions::str_replace(ctx, StringVal(\"http://www.baidu.com:9090\"), StringVal(\"9070\"), StringVal(\"8080\")));\n+    ASSERT_EQ(StringVal(\"http://www.baidu.com:9090\"),\n+        StringFunctions::str_replace(ctx, StringVal(\"http://www.baidu.com:9090\"), StringVal(\"\"), StringVal(\"8080\")));\n+    ASSERT_EQ(StringVal(\"http://www.baidu.com:\"),\n+        StringFunctions::str_replace(ctx, StringVal(\"http://www.baidu.com:9090\"), StringVal(\"9090\"), StringVal(\"\")));", "originalCommit": "1a15f533098eec6708121004ef835d111dc374f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7d072b9a65d555e7e710cb5140435e00a8ff7bdc", "url": "https://github.com/apache/incubator-doris/commit/7d072b9a65d555e7e710cb5140435e00a8ff7bdc", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-08-14T01:37:05Z", "type": "commit"}, {"oid": "391158f52190755b5fc621c31bf703835c0a7b3b", "url": "https://github.com/apache/incubator-doris/commit/391158f52190755b5fc621c31bf703835c0a7b3b", "message": "udf: replace function", "committedDate": "2020-08-14T02:11:25Z", "type": "commit"}, {"oid": "5eb52e1e5742d2e9f7aae5ac8da81545ae5f3df2", "url": "https://github.com/apache/incubator-doris/commit/5eb52e1e5742d2e9f7aae5ac8da81545ae5f3df2", "message": "udf: replace function", "committedDate": "2020-08-14T03:58:30Z", "type": "commit"}, {"oid": "a79ea91cf36eec54a4ca54018b92a6fa4baa98cc", "url": "https://github.com/apache/incubator-doris/commit/a79ea91cf36eec54a4ca54018b92a6fa4baa98cc", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-08-18T02:31:52Z", "type": "commit"}, {"oid": "86f841f29fa4ee19773d6c5922465194a2887cf6", "url": "https://github.com/apache/incubator-doris/commit/86f841f29fa4ee19773d6c5922465194a2887cf6", "message": "udf: replace function", "committedDate": "2020-08-18T03:56:14Z", "type": "commit"}, {"oid": "ade1afa75c94a178a6801ba1324acf25ad8b16fe", "url": "https://github.com/apache/incubator-doris/commit/ade1afa75c94a178a6801ba1324acf25ad8b16fe", "message": "udf: replace function", "committedDate": "2020-08-18T03:59:59Z", "type": "commit"}, {"oid": "1d95a491115064c9753694ad4d45c2f72b8d2645", "url": "https://github.com/apache/incubator-doris/commit/1d95a491115064c9753694ad4d45c2f72b8d2645", "message": "udf: replace function", "committedDate": "2020-08-18T08:01:45Z", "type": "commit"}]}