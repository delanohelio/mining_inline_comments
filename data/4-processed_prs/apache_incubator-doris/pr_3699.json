{"pr_number": 3699, "pr_title": "[Bug] Duplicate Key table core when predicate on metric column", "pr_createdAt": "2020-05-27T07:49:25Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3699", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5MTMxNA==", "url": "https://github.com/apache/incubator-doris/pull/3699#discussion_r431091314", "bodyText": "it cores just because of zone_maps.size() == cond_it.first  and zone_maps.at(cond_it.first) returns null ?", "author": "yangzhg", "createdAt": "2020-05-27T12:50:01Z", "path": "be/src/olap/olap_cond.cpp", "diffHunk": "@@ -651,14 +651,10 @@ bool Conditions::delete_conditions_eval(const RowCursor& row) const {\n bool Conditions::rowset_pruning_filter(const std::vector<KeyRange>& zone_maps) const {\n     //\u901a\u8fc7\u6240\u6709\u5217\u4e0a\u7684\u5220\u9664\u6761\u4ef6\u5bf9version\u8fdb\u884c\u8fc7\u6ee4\n     for (auto& cond_it : _columns) {\n-        if (_cond_column_is_key_or_duplicate(cond_it.second) && cond_it.first > zone_maps.size()) {\n-            LOG(WARNING) << \"where condition not equal zone maps size. \"\n-                         << \"cond_id=\" << cond_it.first\n-                         << \", zone_map_size=\" << zone_maps.size();\n-            return false;\n-        }\n-        if (_cond_column_is_key_or_duplicate(cond_it.second) && !cond_it.second->eval(zone_maps.at(cond_it.first))) {\n-            return true;\n+        if (_cond_column_is_key_or_duplicate(cond_it.second)) {\n+            if (cond_it.first < zone_maps.size() && !cond_it.second->eval(zone_maps.at(cond_it.first))) {", "originalCommit": "48f6b0079e9bf9550873323b8f9203d4cfd0421c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTUyODAwOA==", "url": "https://github.com/apache/incubator-doris/pull/3699#discussion_r431528008", "bodyText": "Yes, because zone_maps has only one item. zone_maps.at(1) will core dump.", "author": "chaoyli", "createdAt": "2020-05-28T01:10:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5MTMxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5NDMzMw==", "url": "https://github.com/apache/incubator-doris/pull/3699#discussion_r431094333", "bodyText": "Could you please transform Cninese to English?", "author": "EmmyMiao87", "createdAt": "2020-05-27T12:54:51Z", "path": "be/src/olap/olap_cond.cpp", "diffHunk": "@@ -651,14 +651,10 @@ bool Conditions::delete_conditions_eval(const RowCursor& row) const {\n bool Conditions::rowset_pruning_filter(const std::vector<KeyRange>& zone_maps) const {\n     //\u901a\u8fc7\u6240\u6709\u5217\u4e0a\u7684\u5220\u9664\u6761\u4ef6\u5bf9version\u8fdb\u884c\u8fc7\u6ee4", "originalCommit": "48f6b0079e9bf9550873323b8f9203d4cfd0421c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA3MzAzMQ==", "url": "https://github.com/apache/incubator-doris/pull/3699#discussion_r431073031", "bodyText": "Could you please add some comment for this method. about the meaning of its return.\nAnd you can also modify Chinese comment to English.", "author": "morningman", "createdAt": "2020-05-27T12:19:26Z", "path": "be/src/olap/olap_cond.cpp", "diffHunk": "@@ -651,14 +651,10 @@ bool Conditions::delete_conditions_eval(const RowCursor& row) const {\n bool Conditions::rowset_pruning_filter(const std::vector<KeyRange>& zone_maps) const {\n     //\u901a\u8fc7\u6240\u6709\u5217\u4e0a\u7684\u5220\u9664\u6761\u4ef6\u5bf9version\u8fdb\u884c\u8fc7\u6ee4\n     for (auto& cond_it : _columns) {\n-        if (_cond_column_is_key_or_duplicate(cond_it.second) && cond_it.first > zone_maps.size()) {\n-            LOG(WARNING) << \"where condition not equal zone maps size. \"\n-                         << \"cond_id=\" << cond_it.first\n-                         << \", zone_map_size=\" << zone_maps.size();\n-            return false;\n-        }\n-        if (_cond_column_is_key_or_duplicate(cond_it.second) && !cond_it.second->eval(zone_maps.at(cond_it.first))) {\n-            return true;\n+        if (_cond_column_is_key_or_duplicate(cond_it.second)) {", "originalCommit": "48f6b0079e9bf9550873323b8f9203d4cfd0421c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "db558dbe889c8898155d4e9788abcebbd1b069e4", "url": "https://github.com/apache/incubator-doris/commit/db558dbe889c8898155d4e9788abcebbd1b069e4", "message": "Add some comment in English", "committedDate": "2020-05-28T01:30:02Z", "type": "commit"}]}