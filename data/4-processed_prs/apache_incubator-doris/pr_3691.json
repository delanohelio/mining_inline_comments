{"pr_number": 3691, "pr_title": "[refactor] Simple refactor on class Reader", "pr_createdAt": "2020-05-26T11:31:19Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3691", "timeline": [{"oid": "82c0ede40b2a4ff35d3de6b3a9eb1f4e3bcc4df0", "url": "https://github.com/apache/incubator-doris/commit/82c0ede40b2a4ff35d3de6b3a9eb1f4e3bcc4df0", "message": "[refactor] Simple refactor on class Reader\n\nThis is a simple refactor patch on class Reader without any functional changes.\nMain refactor points:\n- Remove some useless return value\n- Move some class member variables to function's local scope variables\n- Use range loop\n- Use empty() instead of size() for some STL containers size judgement\n- Use in-class initialization instead of initialize in constructor function\n- Some other small refactor", "committedDate": "2020-05-26T11:30:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1OTAyOA==", "url": "https://github.com/apache/incubator-doris/pull/3691#discussion_r430459028", "bodyText": "Is it safe to refer a local variable is_lower_keys_included?\nWill the local is_lower_keys_included be deconstructed after this method?", "author": "morningman", "createdAt": "2020-05-26T14:32:26Z", "path": "be/src/olap/reader.cpp", "diffHunk": "@@ -532,33 +521,31 @@ OLAPStatus Reader::_capture_rs_readers(const ReaderParams& read_params) {\n         }\n     }\n \n-    _reader_context.reader_type = read_params.reader_type;\n-    _reader_context.tablet_schema = &_tablet->tablet_schema();\n-    _reader_context.need_ordered_result = need_ordered_result;\n-    _reader_context.return_columns = &_return_columns;\n-    _reader_context.seek_columns = &_seek_columns;\n-    _reader_context.load_bf_columns = &_load_bf_columns;\n-    _reader_context.conditions = &_conditions;\n-    _reader_context.predicates = &_col_predicates;\n-    _reader_context.lower_bound_keys = &_keys_param.start_keys;\n-    _reader_context.is_lower_keys_included = &_is_lower_keys_included;\n-    _reader_context.upper_bound_keys = &_keys_param.end_keys;\n-    _reader_context.is_upper_keys_included = &_is_upper_keys_included;\n-    _reader_context.delete_handler = &_delete_handler;\n-    _reader_context.stats = &_stats;\n-    _reader_context.runtime_state = read_params.runtime_state;\n-    _reader_context.use_page_cache = read_params.use_page_cache;\n+    RowsetReaderContext reader_context;\n+    reader_context.reader_type = read_params.reader_type;\n+    reader_context.tablet_schema = &_tablet->tablet_schema();\n+    reader_context.need_ordered_result = need_ordered_result;\n+    reader_context.return_columns = &_return_columns;\n+    reader_context.seek_columns = &_seek_columns;\n+    reader_context.load_bf_columns = &_load_bf_columns;\n+    reader_context.conditions = &_conditions;\n+    reader_context.predicates = &_col_predicates;\n+    reader_context.lower_bound_keys = &_keys_param.start_keys;\n+    reader_context.is_lower_keys_included = &is_lower_keys_included;", "originalCommit": "82c0ede40b2a4ff35d3de6b3a9eb1f4e3bcc4df0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ5OTk1Mg==", "url": "https://github.com/apache/incubator-doris/pull/3691#discussion_r430499952", "bodyText": "Oh, it's not safe, I've fixed it now.", "author": "acelyc111", "createdAt": "2020-05-26T15:26:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1OTAyOA=="}], "type": "inlineReview"}, {"oid": "385f7f98cc097d21ba16c54a0a02fcc19d07250d", "url": "https://github.com/apache/incubator-doris/commit/385f7f98cc097d21ba16c54a0a02fcc19d07250d", "message": "fix", "committedDate": "2020-05-26T15:22:15Z", "type": "commit"}]}