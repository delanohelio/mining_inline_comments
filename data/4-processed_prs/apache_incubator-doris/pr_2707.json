{"pr_number": 2707, "pr_title": "add BE udf bitmap_or & bitmap_and", "pr_createdAt": "2020-01-08T09:17:43Z", "pr_url": "https://github.com/apache/incubator-doris/pull/2707", "timeline": [{"oid": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7", "url": "https://github.com/apache/incubator-doris/commit/dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7", "message": "add BE udf bitmap_or & bitmap_and", "committedDate": "2020-01-08T09:13:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMjIzMw==", "url": "https://github.com/apache/incubator-doris/pull/2707#discussion_r364132233", "bodyText": "return null when input is null.", "author": "imay", "createdAt": "2020-01-08T09:22:42Z", "path": "be/src/exprs/bitmap_function.cpp", "diffHunk": "@@ -387,7 +387,48 @@ BigIntVal BitmapFunctions::bitmap_intersect_finalize(FunctionContext* ctx, const\n     delete src_bitmap;\n     return result;\n }\n+StringVal BitmapFunctions::bitmap_or(FunctionContext* ctx, const StringVal& src, const StringVal& dst){", "originalCommit": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMjM0MQ==", "url": "https://github.com/apache/incubator-doris/pull/2707#discussion_r364132341", "bodyText": "better to change src and dst to lhs and rhs.", "author": "imay", "createdAt": "2020-01-08T09:22:56Z", "path": "be/src/exprs/bitmap_function.cpp", "diffHunk": "@@ -387,7 +387,48 @@ BigIntVal BitmapFunctions::bitmap_intersect_finalize(FunctionContext* ctx, const\n     delete src_bitmap;\n     return result;\n }\n+StringVal BitmapFunctions::bitmap_or(FunctionContext* ctx, const StringVal& src, const StringVal& dst){", "originalCommit": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMjQ3Ng==", "url": "https://github.com/apache/incubator-doris/pull/2707#discussion_r364132476", "bodyText": "rename src and dst to lhs and rhs", "author": "imay", "createdAt": "2020-01-08T09:23:16Z", "path": "be/src/exprs/bitmap_function.cpp", "diffHunk": "@@ -387,7 +387,48 @@ BigIntVal BitmapFunctions::bitmap_intersect_finalize(FunctionContext* ctx, const\n     delete src_bitmap;\n     return result;\n }\n+StringVal BitmapFunctions::bitmap_or(FunctionContext* ctx, const StringVal& src, const StringVal& dst){\n+    RoaringBitmap bitmap;\n+    if (!src.is_null) {\n+        if (src.len == 0) {\n+            bitmap.merge(*reinterpret_cast<RoaringBitmap*>(src.ptr));\n+        } else {\n+            bitmap.merge(RoaringBitmap((char*)src.ptr));\n+        }\n+    }\n+\n+    if (!dst.is_null) {\n+        if (dst.len == 0) {\n+            bitmap.merge(*reinterpret_cast<RoaringBitmap*>(dst.ptr));\n+        } else {\n+            bitmap.merge(RoaringBitmap((char*)dst.ptr));\n+        }\n+    }\n \n+    StringVal result(ctx,bitmap.size());\n+    bitmap.serialize((char*)result.ptr);\n+    return result;\n+}\n+StringVal BitmapFunctions::bitmap_and(FunctionContext* ctx, const StringVal& src, const StringVal& dst){", "originalCommit": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMjkwMA==", "url": "https://github.com/apache/incubator-doris/pull/2707#discussion_r364132900", "bodyText": "input should be BITMAP.", "author": "imay", "createdAt": "2020-01-08T09:24:08Z", "path": "gensrc/script/doris_builtins_functions.py", "diffHunk": "@@ -610,7 +610,10 @@\n         '_ZN5doris15BitmapFunctions12bitmap_countEPN9doris_udf15FunctionContextERKNS1_9StringValE'],\n     [['bitmap_empty'], 'BITMAP', [],\n         '_ZN5doris15BitmapFunctions12bitmap_emptyEPN9doris_udf15FunctionContextE'],\n-\n+    [['bitmap_or'], 'BITMAP', ['VARCHAR','VARCHAR'],", "originalCommit": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a62c7694e8272c201bd56e46ba1ffa1aa68c7552", "url": "https://github.com/apache/incubator-doris/commit/a62c7694e8272c201bd56e46ba1ffa1aa68c7552", "message": "rename & modify type", "committedDate": "2020-01-08T09:54:51Z", "type": "commit"}]}