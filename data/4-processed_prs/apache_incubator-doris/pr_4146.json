{"pr_number": 4146, "pr_title": "[CodeRefactor] Modify FE modules", "pr_createdAt": "2020-07-22T14:17:28Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4146", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxNzA0Nw==", "url": "https://github.com/apache/incubator-doris/pull/4146#discussion_r459217047", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if [ ${BUILD_FE} -eq 1]; then\n          \n          \n            \n                if [ ${BUILD_FE} -eq 1 ]; then", "author": "xy720", "createdAt": "2020-07-23T05:09:07Z", "path": "build.sh", "diffHunk": "@@ -176,34 +184,55 @@ cd ${DORIS_HOME}/docs\n ./build_help_zip.sh\n cd ${DORIS_HOME}\n \n+# Assesmble FE modules\n+FE_MODULES=\n+if [ ${BUILD_FE} -eq 1 -o ${BUILD_SPARK_DPP} -eq 1 ]; then\n+    if [ ${BUILD_FE} -eq 1 ]; then\n+        FE_MODULES=\"fe-common,spark-dpp,fe-core\"\n+    fi\n+    if [ ${BUILD_SPARK_DPP} -eq 1 ]; then\n+        FE_MODULES=\"fe-common,spark-dpp\"\n+    fi\n+fi\n+\n # Clean and build Frontend\n-if [ ${BUILD_FE} -eq 1 ] ; then\n-    echo \"Build Frontend\"\n+if [ ${FE_MODULES}x != \"\"x ]; then\n+    echo \"Build Frontend Modules: $FE_MODULES\"\n     cd ${DORIS_HOME}/fe\n     if [ ${CLEAN} -eq 1 ]; then\n         ${MVN_CMD} clean\n     fi\n-    ${MVN_CMD} package -DskipTests\n+    ${MVN_CMD} package -pl ${FE_MODULES} -DskipTests\n     cd ${DORIS_HOME}\n fi\n \n # Clean and prepare output dir\n DORIS_OUTPUT=${DORIS_HOME}/output/\n mkdir -p ${DORIS_OUTPUT}\n \n-#Copy Frontend and Backend\n-if [ ${BUILD_FE} -eq 1 ]; then\n-    install -d ${DORIS_OUTPUT}/fe/bin ${DORIS_OUTPUT}/fe/conf \\\n-               ${DORIS_OUTPUT}/fe/webroot/ ${DORIS_OUTPUT}/fe/lib/\n-\n-    cp -r -p ${DORIS_HOME}/bin/*_fe.sh ${DORIS_OUTPUT}/fe/bin/\n-    cp -r -p ${DORIS_HOME}/conf/fe.conf ${DORIS_OUTPUT}/fe/conf/\n-    rm -rf ${DORIS_OUTPUT}/fe/lib/*\n-    cp -r -p ${DORIS_HOME}/fe/fe-core/target/lib/* ${DORIS_OUTPUT}/fe/lib/\n-    cp -r -p ${DORIS_HOME}/fe/fe-core/target/palo-fe.jar ${DORIS_OUTPUT}/fe/lib/\n-    cp -r -p ${DORIS_HOME}/docs/build/help-resource.zip ${DORIS_OUTPUT}/fe/lib/\n-    cp -r -p ${DORIS_HOME}/webroot/* ${DORIS_OUTPUT}/fe/webroot/\n+# Copy Frontend and Backend\n+if [ ${BUILD_FE} -eq 1 -o ${BUILD_SPARK_DPP} -eq 1 ]; then\n+    if [ ${BUILD_FE} -eq 1]; then", "originalCommit": "0d538212f22cc075c071e6fd0e4372e1879ea50d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI5NTg3Ng==", "url": "https://github.com/apache/incubator-doris/pull/4146#discussion_r459295876", "bodyText": "I think better named it without version, just like \"palo-fe.jar\", may be \"spark-dpp.jar\". Because we will have a DppVersion in FeConstant.", "author": "xy720", "createdAt": "2020-07-23T08:37:02Z", "path": "fe/spark-dpp/pom.xml", "diffHunk": "@@ -0,0 +1,430 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache</groupId>\n+        <artifactId>doris-fe</artifactId>\n+        <version>3.4.0</version>\n+        <relativePath>../pom.xml</relativePath>\n+    </parent>\n+\n+    <artifactId>spark-dpp</artifactId>\n+    <version>1.0.0</version>\n+    <packaging>jar</packaging>\n+\n+    <properties>\n+        <doris.home>${basedir}/../../</doris.home>\n+        <fe_ut_parallel>1</fe_ut_parallel>\n+    </properties>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.apache</groupId>\n+            <artifactId>fe-common</artifactId>\n+        </dependency>\n+\n+        <!-- https://mvnrepository.com/artifact/commons-codec/commons-codec -->\n+        <dependency>\n+            <groupId>commons-codec</groupId>\n+            <artifactId>commons-codec</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 -->\n+        <dependency>\n+            <groupId>org.apache.commons</groupId>\n+            <artifactId>commons-lang3</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <!-- https://mvnrepository.com/artifact/com.google.code.gson/gson -->\n+        <dependency>\n+            <groupId>com.google.code.gson</groupId>\n+            <artifactId>gson</artifactId>\n+        </dependency>\n+\n+        <!-- https://mvnrepository.com/artifact/org.jmockit/jmockit -->\n+        <dependency>\n+            <groupId>org.jmockit</groupId>\n+            <artifactId>jmockit</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+\n+        <!-- https://mvnrepository.com/artifact/joda-time/joda-time -->\n+        <dependency>\n+            <groupId>joda-time</groupId>\n+            <artifactId>joda-time</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <!-- https://mvnrepository.com/artifact/junit/junit -->\n+        <dependency>\n+            <groupId>junit</groupId>\n+            <artifactId>junit</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+\n+        <!-- https://mvnrepository.com/artifact/log4j/log4j -->\n+        <dependency>\n+            <groupId>log4j</groupId>\n+            <artifactId>log4j</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.roaringbitmap</groupId>\n+            <artifactId>RoaringBitmap</artifactId>\n+        </dependency>\n+\n+        <!-- spark -->\n+        <!-- https://mvnrepository.com/artifact/org.apache.spark/spark-core_2.12 -->\n+        <dependency>\n+            <groupId>org.apache.spark</groupId>\n+            <artifactId>spark-core_2.12</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+\t\t<!-- https://mvnrepository.com/artifact/org.apache.spark/spark-sql_2.12 -->\n+        <dependency>\n+            <groupId>org.apache.spark</groupId>\n+            <artifactId>spark-sql_2.12</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.hadoop</groupId>\n+            <artifactId>hadoop-common</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.parquet</groupId>\n+            <artifactId>parquet-column</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.parquet</groupId>\n+            <artifactId>parquet-hadoop</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.parquet</groupId>\n+            <artifactId>parquet-common</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>commons-collections</groupId>\n+            <artifactId>commons-collections</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.scala-lang</groupId>\n+            <artifactId>scala-library</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>com.esotericsoftware</groupId>\n+            <artifactId>kryo-shaded</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.spark</groupId>\n+            <artifactId>spark-catalyst_2.12</artifactId>\n+            <version>2.4.5</version>\n+            <scope>provided</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>com.google.guava</groupId>\n+            <artifactId>guava</artifactId>\n+        </dependency>\n+    </dependencies>\n+\n+    <build>\n+        <finalName>spark-dpp-${version}</finalName>", "originalCommit": "0d538212f22cc075c071e6fd0e4372e1879ea50d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA1NDUwOA==", "url": "https://github.com/apache/incubator-doris/pull/4146#discussion_r462054508", "bodyText": "If without version, it is difficult to found out which version it is when we saw this file.", "author": "morningman", "createdAt": "2020-07-29T05:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI5NTg3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMwNDc1Ng==", "url": "https://github.com/apache/incubator-doris/pull/4146#discussion_r459304756", "bodyText": "The default build FE should without Spark Dpp application?", "author": "kangkaisen", "createdAt": "2020-07-23T08:52:46Z", "path": "build.sh", "diffHunk": "@@ -50,20 +50,22 @@ usage() {\n Usage: $0 <options>\n   Optional options:\n      --be               build Backend\n-     --fe               build Frontend\n+     --fe               build Frontend and Spark Dpp application", "originalCommit": "0d538212f22cc075c071e6fd0e4372e1879ea50d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA1NDkyNA==", "url": "https://github.com/apache/incubator-doris/pull/4146#discussion_r462054924", "bodyText": "Can not, FE depends on some class in SparkDpp. Maybe we can move them to fe-common later.", "author": "morningman", "createdAt": "2020-07-29T05:55:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMwNDc1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA2Njg0MQ==", "url": "https://github.com/apache/incubator-doris/pull/4146#discussion_r462066841", "bodyText": "OK", "author": "kangkaisen", "createdAt": "2020-07-29T06:27:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMwNDc1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMwNjI2OA==", "url": "https://github.com/apache/incubator-doris/pull/4146#discussion_r459306268", "bodyText": "Would better add a explain for dpp.", "author": "kangkaisen", "createdAt": "2020-07-23T08:55:22Z", "path": "fe/README", "diffHunk": "@@ -0,0 +1,14 @@\n+# fe-common\n+\n+This module is used to store some common classes of other modules.\n+\n+# spark-dpp", "originalCommit": "0d538212f22cc075c071e6fd0e4372e1879ea50d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "883b261440173609c93820d5240acb9e23c20134", "url": "https://github.com/apache/incubator-doris/commit/883b261440173609c93820d5240acb9e23c20134", "message": "fix checkstyle", "committedDate": "2020-07-27T01:50:25Z", "type": "forcePushed"}, {"oid": "6e1a018c935b94da41079e14306946002a1cf38a", "url": "https://github.com/apache/incubator-doris/commit/6e1a018c935b94da41079e14306946002a1cf38a", "message": "[CodeRefactor] Modify FE module", "committedDate": "2020-07-28T08:28:26Z", "type": "commit"}, {"oid": "4f53c19d1ee6ac320f68b72c096ce05bdd4c7a78", "url": "https://github.com/apache/incubator-doris/commit/4f53c19d1ee6ac320f68b72c096ce05bdd4c7a78", "message": "fix checkstyle", "committedDate": "2020-07-28T08:28:26Z", "type": "commit"}, {"oid": "0e786956c4ce7541145d4822c7e4bafdddd8920e", "url": "https://github.com/apache/incubator-doris/commit/0e786956c4ce7541145d4822c7e4bafdddd8920e", "message": "fix bug", "committedDate": "2020-07-28T10:10:55Z", "type": "forcePushed"}, {"oid": "f2891376b26a724377a8efaf4ad6fbf4161da187", "url": "https://github.com/apache/incubator-doris/commit/f2891376b26a724377a8efaf4ad6fbf4161da187", "message": "fix bug", "committedDate": "2020-07-29T05:51:40Z", "type": "commit"}, {"oid": "f2891376b26a724377a8efaf4ad6fbf4161da187", "url": "https://github.com/apache/incubator-doris/commit/f2891376b26a724377a8efaf4ad6fbf4161da187", "message": "fix bug", "committedDate": "2020-07-29T05:51:40Z", "type": "forcePushed"}]}