{"pr_number": 4526, "pr_title": "[BUG] Fix segment group add zone map bug when schema change.", "pr_createdAt": "2020-09-03T03:04:05Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4526", "timeline": [{"oid": "ea1fc6cf80c26c43344fba8c7d2d74812d761ba3", "url": "https://github.com/apache/incubator-doris/commit/ea1fc6cf80c26c43344fba8c7d2d74812d761ba3", "message": "fix", "committedDate": "2020-09-03T02:31:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgwNTg1MA==", "url": "https://github.com/apache/incubator-doris/pull/4526#discussion_r482805850", "bodyText": "Better to add some comment to explain why break here.", "author": "morningman", "createdAt": "2020-09-03T08:36:10Z", "path": "be/src/olap/rowset/segment_group.cpp", "diffHunk": "@@ -258,32 +258,45 @@ OLAPStatus SegmentGroup::add_zone_maps_for_linked_schema_change(\n \n     for (size_t i = 0; i < zonemap_col_num; ++i) {\n         \n-        // in duplicated table update from 0.11 to 0.12, zone map index may be missed\n+        // in duplicated table update from 0.11 to 0.12, zone map index may be missed and may not a new column.\n         if (_schema->keys_type() == DUP_KEYS && \n             schema_mapping[i].ref_column != -1 &&\n             schema_mapping[i].ref_column >= zone_map_fields.size()) {\n-            continue;\n+            break; // _zone_maps follows _schema column index", "originalCommit": "ea1fc6cf80c26c43344fba8c7d2d74812d761ba3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "20417fa74260f54b192b2149627ca94be5a189a9", "url": "https://github.com/apache/incubator-doris/commit/20417fa74260f54b192b2149627ca94be5a189a9", "message": "add comment", "committedDate": "2020-09-03T08:46:24Z", "type": "commit"}, {"oid": "7643afcd4fcbb733dcdcfa4de7c2540410fcb474", "url": "https://github.com/apache/incubator-doris/commit/7643afcd4fcbb733dcdcfa4de7c2540410fcb474", "message": "add comment", "committedDate": "2020-09-03T08:49:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyNzg2Ng==", "url": "https://github.com/apache/incubator-doris/pull/4526#discussion_r482827866", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // process should not add missed zonemap and we break the loap.\n          \n          \n            \n                        // process should not add missed zonemap and we break the loop.", "author": "morningman", "createdAt": "2020-09-03T09:10:32Z", "path": "be/src/olap/rowset/segment_group.cpp", "diffHunk": "@@ -258,34 +258,52 @@ OLAPStatus SegmentGroup::add_zone_maps_for_linked_schema_change(\n \n     for (size_t i = 0; i < zonemap_col_num; ++i) {\n         \n-        // in duplicated table update from 0.11 to 0.12, zone map index may be missed\n+        // in duplicated table update from 0.11 to 0.12, zone map index may be missed and may not a new column.\n         if (_schema->keys_type() == DUP_KEYS && \n             schema_mapping[i].ref_column != -1 &&\n             schema_mapping[i].ref_column >= zone_map_fields.size()) {\n-            continue;\n+            \n+            // the sequence of columns in _zone_maps and _schema must be consistent, so here\n+            // process should not add missed zonemap and we break the loap.", "originalCommit": "7643afcd4fcbb733dcdcfa4de7c2540410fcb474", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "630ece527b6f208bb965cd4a574d140874b941c7", "url": "https://github.com/apache/incubator-doris/commit/630ece527b6f208bb965cd4a574d140874b941c7", "message": "Update be/src/olap/rowset/segment_group.cpp\n\nCo-authored-by: Mingyu Chen <morningman.cmy@gmail.com>", "committedDate": "2020-09-03T09:11:27Z", "type": "commit"}]}