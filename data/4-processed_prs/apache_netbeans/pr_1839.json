{"pr_number": 1839, "pr_title": "[NETBEANS-3428] FlatLaf: new close, left, right, drop-down and maximi\u2026", "pr_createdAt": "2020-01-03T12:39:48Z", "pr_url": "https://github.com/apache/netbeans/pull/1839", "timeline": [{"oid": "54c299cd973d5e23255822cfa85af4495c996471", "url": "https://github.com/apache/netbeans/commit/54c299cd973d5e23255822cfa85af4495c996471", "message": "[NETBEANS-3428] FlatLaf: new close, left, right, drop-down and maximize buttons for multi-tabs, breadcrumb bar, search bar, etc", "committedDate": "2020-01-03T12:35:02Z", "type": "commit"}, {"oid": "8d13d55302742b55f5c44058e9b6e8df1dcbb9a0", "url": "https://github.com/apache/netbeans/commit/8d13d55302742b55f5c44058e9b6e8df1dcbb9a0", "message": "removed println", "committedDate": "2020-01-03T13:05:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxNjk5Ng==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362816996", "bodyText": "What's the \"-1\" magic number here? Does it mean \"not applicable?\"", "author": "eirikbakke", "createdAt": "2020-01-03T13:58:04Z", "path": "platform/o.n.swing.laf.flatlaf/src/org/netbeans/swing/laf/flatlaf/FlatLFCustoms.java", "diffHunk": "@@ -45,6 +47,21 @@\n             // scale on Java 8 and Linux\n             SPLIT_PANE_DIVIDER_SIZE_VERTICAL, UIScale.scale(4),\n             SPLIT_PANE_DIVIDER_SIZE_HORIZONTAL, UIScale.scale(4),\n+\n+            // for org.openide.awt.CloseButtonFactory\n+            \"nb.close.tab.icon.enabled.icon\", FlatTabControlIcon.get(TabControlButton.ID_CLOSE_BUTTON, TabControlButton.STATE_DEFAULT), // NOI18N\n+            \"nb.close.tab.icon.pressed.icon\", FlatTabControlIcon.get(TabControlButton.ID_CLOSE_BUTTON, TabControlButton.STATE_PRESSED), // NOI18N\n+            \"nb.close.tab.icon.rollover.icon\", FlatTabControlIcon.get(TabControlButton.ID_CLOSE_BUTTON, TabControlButton.STATE_ROLLOVER), // NOI18N\n+            \"nb.bigclose.tab.icon.enabled.icon\", FlatTabControlIcon.get(TabControlButton.ID_CLOSE_BUTTON, TabControlButton.STATE_DEFAULT), // NOI18N\n+            \"nb.bigclose.tab.icon.pressed.icon\", FlatTabControlIcon.get(TabControlButton.ID_CLOSE_BUTTON, TabControlButton.STATE_PRESSED), // NOI18N\n+            \"nb.bigclose.tab.icon.rollover.icon\", FlatTabControlIcon.get(TabControlButton.ID_CLOSE_BUTTON, TabControlButton.STATE_ROLLOVER), // NOI18N\n+\n+            // for org.netbeans.core.multitabs.ButtonFactory\n+            \"nb.multitabs.button.dropdown.icon\", FlatTabControlIcon.get(TabControlButton.ID_DROP_DOWN_BUTTON, -1), // NOI18N", "originalCommit": "8d13d55302742b55f5c44058e9b6e8df1dcbb9a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxNzQwMg==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362817402", "bodyText": "Ah. Perhaps make buttonState an Integer object and allow it to be null for this case, rather than introducing a magic number.", "author": "eirikbakke", "createdAt": "2020-01-03T13:59:14Z", "path": "platform/o.n.swing.laf.flatlaf/src/org/netbeans/swing/laf/flatlaf/ui/FlatTabControlIcon.java", "diffHunk": "@@ -130,6 +131,21 @@ protected void paintIcon(Component c, Graphics2D g, int width, int height, doubl\n         Color bgColor = new Color(0, 0, 0, 0); // Alpha zero means no background.\n         Color fgColor = foreground;\n         {\n+            int buttonState = this.buttonState;\n+            if (buttonState == -1) {", "originalCommit": "8d13d55302742b55f5c44058e9b6e8df1dcbb9a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjg1ODgyNw==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362858827", "bodyText": "done", "author": "DevCharly", "createdAt": "2020-01-03T15:52:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxNzQwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxNzc2OA==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362817768", "bodyText": "Have you tested that this state ends up being used? Are you sure the button does not end up trying to make its own disabled version using an ImageFilter? (In the latter case the disabled version would not look good on HiDPI screens.)", "author": "eirikbakke", "createdAt": "2020-01-03T14:00:25Z", "path": "platform/o.n.swing.laf.flatlaf/src/org/netbeans/swing/laf/flatlaf/ui/FlatTabControlIcon.java", "diffHunk": "@@ -130,6 +131,21 @@ protected void paintIcon(Component c, Graphics2D g, int width, int height, doubl\n         Color bgColor = new Color(0, 0, 0, 0); // Alpha zero means no background.\n         Color fgColor = foreground;\n         {\n+            int buttonState = this.buttonState;\n+            if (buttonState == -1) {\n+                // get button state from component\n+                if (!c.isEnabled()) {\n+                    buttonState = TabControlButton.STATE_DISABLED;", "originalCommit": "8d13d55302742b55f5c44058e9b6e8df1dcbb9a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgyODM3Ng==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362828376", "bodyText": "Yes, this works. The reason is that class FlatTabControlIcon is not an instance of javax.swing.ImageIcon. So LookAndFeel.getDisabledIcon() returns null and the normal icon is used.", "author": "DevCharly", "createdAt": "2020-01-03T14:32:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxNzc2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk0NjA2Ng==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362946066", "bodyText": "Great!", "author": "eirikbakke", "createdAt": "2020-01-03T20:14:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxNzc2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxOTEwNA==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362819104", "bodyText": "Adding new keys to UIManager.getDefaults() constitutes an API change; should probably update apichanges.xml. And perhaps go over the names of the new keys one more time to make sure they follow the convention of the existing keys.", "author": "eirikbakke", "createdAt": "2020-01-03T14:05:03Z", "path": "platform/openide.awt/src/org/openide/awt/CloseButtonFactory.java", "diffHunk": "@@ -141,6 +141,9 @@ private static boolean isGTKLaF () {\n     }\n \n     private static Icon getCloseTabImage() {\n+        if( null == closeTabImage ) {\n+            closeTabImage = UIManager.getIcon(\"nb.close.tab.icon.enabled.icon\"); //NOI18N", "originalCommit": "8d13d55302742b55f5c44058e9b6e8df1dcbb9a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MjM3Ng==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r363062376", "bodyText": "While introducing new keys is an API change, the keys are not documented in apichange.xml. That could be an additional task, or we could introduce a LAF guide on wiki. I would not hold this one off due to that.", "author": "lkishalmi", "createdAt": "2020-01-05T00:32:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxOTEwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MzEwOA==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r363063108", "bodyText": "Sure--it's not worth any extra effort now.", "author": "eirikbakke", "createdAt": "2020-01-05T00:57:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxOTEwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgyMDMyNQ==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362820325", "bodyText": "I remember from https://github.com/apache/netbeans/pull/859/files that the close-button drawing code had to be duplicated between and org.openide.awt.AquaVectorCloseButton and o.n.swing.tabcontrol.plaf.AquaVectorTabControlIcon. Are both of the corresponding locations for FlatLAF updated in this PR? Do the new UIManager keys prevent the need for this duplication?", "author": "eirikbakke", "createdAt": "2020-01-03T14:09:09Z", "path": "platform/o.n.swing.laf.flatlaf/src/org/netbeans/swing/laf/flatlaf/FlatLFCustoms.java", "diffHunk": "@@ -45,6 +47,21 @@\n             // scale on Java 8 and Linux\n             SPLIT_PANE_DIVIDER_SIZE_VERTICAL, UIScale.scale(4),\n             SPLIT_PANE_DIVIDER_SIZE_HORIZONTAL, UIScale.scale(4),\n+\n+            // for org.openide.awt.CloseButtonFactory", "originalCommit": "8d13d55302742b55f5c44058e9b6e8df1dcbb9a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjg5NjM3Mw==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362896373", "bodyText": "Yes, I thinks so. Also FlatLaf is a single module, but Aqua/Windows LAF support is scattered to many modules.\nAnyway, there is only one close button in FlatLaf in FlatTabControlIcon.", "author": "DevCharly", "createdAt": "2020-01-03T17:39:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgyMDMyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgyMDg4Nw==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362820887", "bodyText": "This is just a fallback, right? I assume all of these icons are vector-drawn to work with HiDPI screens?", "author": "eirikbakke", "createdAt": "2020-01-03T14:10:49Z", "path": "platform/core.multitabs/src/org/netbeans/core/multitabs/ButtonFactory.java", "diffHunk": "@@ -47,7 +48,11 @@\n      */\n     public static JButton createDropDownButton( Controller controller ) {\n         final JButton btn = new JButton( new TabListPopupAction(controller) );\n-        btn.setIcon( ImageUtilities.loadImageIcon( \"org/netbeans/core/multitabs/resources/down.png\", true) ); //NOI18N\n+        Icon icon = UIManager.getIcon(\"nb.multitabs.button.dropdown.icon\");\n+        if (icon == null) {\n+            icon = ImageUtilities.loadImageIcon( \"org/netbeans/core/multitabs/resources/down.png\", true ); //NOI18N", "originalCommit": "8d13d55302742b55f5c44058e9b6e8df1dcbb9a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjg4ODQzNA==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362888434", "bodyText": "No, not just a fallback.\nVector icons are only used for FlatLaf.\nOther LaFs still use the bitmap images.", "author": "DevCharly", "createdAt": "2020-01-03T17:15:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgyMDg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjg5MTE5NQ==", "url": "https://github.com/apache/netbeans/pull/1839#discussion_r362891195", "bodyText": "But should be not very difficult to extend Windows8VectorTabControlIcon and AquaVectorTabControlIcon in the same way I've extended FlatTabControlIcon...", "author": "DevCharly", "createdAt": "2020-01-03T17:24:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgyMDg4Nw=="}], "type": "inlineReview"}, {"oid": "2afd00c7ca1efff89dcdfe3185060d72a06aea7b", "url": "https://github.com/apache/netbeans/commit/2afd00c7ca1efff89dcdfe3185060d72a06aea7b", "message": "replaced buttonState magic number in FlatTabControlIcon", "committedDate": "2020-01-03T15:51:22Z", "type": "commit"}]}