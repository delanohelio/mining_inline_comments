{"pr_number": 2445, "pr_title": "Adding breadcrumbs for LSP languages.", "pr_createdAt": "2020-10-11T21:06:50Z", "pr_url": "https://github.com/apache/netbeans/pull/2445", "timeline": [{"oid": "e36710bce3c2f7c1ed8ac814a395b38449de6715", "url": "https://github.com/apache/netbeans/commit/e36710bce3c2f7c1ed8ac814a395b38449de6715", "message": "Adding support for breadcrumbs for LSP languages.", "committedDate": "2020-10-11T21:09:47Z", "type": "commit"}, {"oid": "e36710bce3c2f7c1ed8ac814a395b38449de6715", "url": "https://github.com/apache/netbeans/commit/e36710bce3c2f7c1ed8ac814a395b38449de6715", "message": "Adding support for breadcrumbs for LSP languages.", "committedDate": "2020-10-11T21:09:47Z", "type": "forcePushed"}, {"oid": "7b17b17c3dc461403cfa14e038e127eb4e43d86b", "url": "https://github.com/apache/netbeans/commit/7b17b17c3dc461403cfa14e038e127eb4e43d86b", "message": "Fixing editor.breadcrumbs friends.", "committedDate": "2020-10-12T04:46:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDkyNzE2NQ==", "url": "https://github.com/apache/netbeans/pull/2445#discussion_r504927165", "bodyText": "I would use the shorter constructor, that does not require specifying the last two arguments.", "author": "matthiasblaesing", "createdAt": "2020-10-14T19:40:56Z", "path": "ide/lsp.client/src/org/netbeans/modules/lsp/client/bindings/BreadcrumbsImpl.java", "diffHunk": "@@ -0,0 +1,368 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.lsp.client.bindings;\n+\n+import java.awt.BorderLayout;\n+import java.awt.Dimension;\n+import java.awt.Image;\n+import java.beans.PropertyChangeEvent;\n+import java.beans.PropertyChangeListener;\n+import java.io.CharConversionException;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.stream.Collectors;\n+import javax.swing.JComponent;\n+import javax.swing.JPanel;\n+import javax.swing.SwingUtilities;\n+import javax.swing.event.ChangeEvent;\n+import javax.swing.event.ChangeListener;\n+import javax.swing.text.BadLocationException;\n+import javax.swing.text.Document;\n+import javax.swing.text.JTextComponent;\n+import javax.swing.text.Position;\n+import org.eclipse.lsp4j.DocumentSymbol;\n+import org.eclipse.lsp4j.DocumentSymbolParams;\n+import org.eclipse.lsp4j.SymbolInformation;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.jsonrpc.messages.Either;\n+import org.netbeans.api.actions.Openable;\n+import org.netbeans.editor.SideBarFactory;\n+import org.netbeans.modules.editor.NbEditorUtilities;\n+import org.netbeans.modules.editor.breadcrumbs.spi.BreadcrumbsController;\n+import org.netbeans.modules.editor.breadcrumbs.spi.BreadcrumbsElement;\n+import org.netbeans.modules.lsp.client.LSPBindings;\n+import org.netbeans.modules.lsp.client.LSPBindings.BackgroundTask;\n+import org.netbeans.modules.lsp.client.Utils;\n+import org.openide.filesystems.FileObject;\n+import org.openide.loaders.DataObject;\n+import org.openide.loaders.DataObjectNotFoundException;\n+import org.openide.util.Exceptions;\n+import org.openide.util.ImageUtilities;\n+import org.openide.util.Lookup;\n+import org.openide.util.RequestProcessor;\n+import org.openide.util.lookup.Lookups;\n+import org.openide.xml.XMLUtil;\n+\n+/**\n+ *\n+ * @author lahvac\n+ */\n+public class BreadcrumbsImpl implements BackgroundTask {\n+\n+    private static final RequestProcessor WORKER = new RequestProcessor(BreadcrumbsImpl.class.getName(), 1, false, false);\n+    private final JTextComponent comp;\n+    private final Document doc;\n+    private RootBreadcrumbsElementImpl rootElement;\n+\n+    public BreadcrumbsImpl(JTextComponent comp) {\n+        this.comp = comp;\n+        this.doc = comp.getDocument();\n+        this.comp.addCaretListener(evt -> {\n+            update();\n+        });\n+    }\n+\n+    @Override\n+    public void run(LSPBindings bindings, FileObject file) {\n+        try {\n+            //TODO: modified while the query is running?\n+            List<Either<SymbolInformation, DocumentSymbol>> symbols = bindings.getTextDocumentService().documentSymbol(new DocumentSymbolParams(new TextDocumentIdentifier(Utils.toURI(file)))).get();\n+\n+            synchronized (this) {\n+                this.rootElement = new RootBreadcrumbsElementImpl(file, doc, symbols.stream().map(this::toDocumentSymbol).collect(Collectors.toList()));\n+            }\n+\n+            SwingUtilities.invokeLater(() -> update());\n+        } catch (InterruptedException | ExecutionException ex) {\n+            Exceptions.printStackTrace(ex);\n+        }\n+    }\n+\n+    private DocumentSymbol toDocumentSymbol(Either<SymbolInformation, DocumentSymbol> variants) {\n+        if (variants.isRight()) return variants.getRight();\n+\n+        SymbolInformation left = variants.getLeft();\n+\n+        return new DocumentSymbol(left.getName(), left.getKind(), left.getLocation().getRange(), left.getLocation().getRange(), null, Collections.emptyList());", "originalCommit": "7b17b17c3dc461403cfa14e038e127eb4e43d86b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDkyODExNg==", "url": "https://github.com/apache/netbeans/pull/2445#discussion_r504928116", "bodyText": "I suggest to reflow this to:\n        try {\n            //TODO: modified while the query is running?\n            List<Either<SymbolInformation, DocumentSymbol>> symbols = bindings\n                .getTextDocumentService()\n                .documentSymbol(\n                    new DocumentSymbolParams(\n                        new TextDocumentIdentifier(Utils.toURI(file))\n                    )\n                )\n                .get();\n\n            synchronized (this) {\n                this.rootElement = new RootBreadcrumbsElementImpl(\n                    file,\n                    doc,\n                    symbols.stream().map(this::toDocumentSymbol).collect(Collectors.toList())\n                );\n            }\n\n            SwingUtilities.invokeLater(() -> update());\n        } catch (InterruptedException | ExecutionException ex) {\n            Exceptions.printStackTrace(ex);\n        }", "author": "matthiasblaesing", "createdAt": "2020-10-14T19:42:41Z", "path": "ide/lsp.client/src/org/netbeans/modules/lsp/client/bindings/BreadcrumbsImpl.java", "diffHunk": "@@ -0,0 +1,368 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.lsp.client.bindings;\n+\n+import java.awt.BorderLayout;\n+import java.awt.Dimension;\n+import java.awt.Image;\n+import java.beans.PropertyChangeEvent;\n+import java.beans.PropertyChangeListener;\n+import java.io.CharConversionException;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n+import java.util.stream.Collectors;\n+import javax.swing.JComponent;\n+import javax.swing.JPanel;\n+import javax.swing.SwingUtilities;\n+import javax.swing.event.ChangeEvent;\n+import javax.swing.event.ChangeListener;\n+import javax.swing.text.BadLocationException;\n+import javax.swing.text.Document;\n+import javax.swing.text.JTextComponent;\n+import javax.swing.text.Position;\n+import org.eclipse.lsp4j.DocumentSymbol;\n+import org.eclipse.lsp4j.DocumentSymbolParams;\n+import org.eclipse.lsp4j.SymbolInformation;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.jsonrpc.messages.Either;\n+import org.netbeans.api.actions.Openable;\n+import org.netbeans.editor.SideBarFactory;\n+import org.netbeans.modules.editor.NbEditorUtilities;\n+import org.netbeans.modules.editor.breadcrumbs.spi.BreadcrumbsController;\n+import org.netbeans.modules.editor.breadcrumbs.spi.BreadcrumbsElement;\n+import org.netbeans.modules.lsp.client.LSPBindings;\n+import org.netbeans.modules.lsp.client.LSPBindings.BackgroundTask;\n+import org.netbeans.modules.lsp.client.Utils;\n+import org.openide.filesystems.FileObject;\n+import org.openide.loaders.DataObject;\n+import org.openide.loaders.DataObjectNotFoundException;\n+import org.openide.util.Exceptions;\n+import org.openide.util.ImageUtilities;\n+import org.openide.util.Lookup;\n+import org.openide.util.RequestProcessor;\n+import org.openide.util.lookup.Lookups;\n+import org.openide.xml.XMLUtil;\n+\n+/**\n+ *\n+ * @author lahvac\n+ */\n+public class BreadcrumbsImpl implements BackgroundTask {\n+\n+    private static final RequestProcessor WORKER = new RequestProcessor(BreadcrumbsImpl.class.getName(), 1, false, false);\n+    private final JTextComponent comp;\n+    private final Document doc;\n+    private RootBreadcrumbsElementImpl rootElement;\n+\n+    public BreadcrumbsImpl(JTextComponent comp) {\n+        this.comp = comp;\n+        this.doc = comp.getDocument();\n+        this.comp.addCaretListener(evt -> {\n+            update();\n+        });\n+    }\n+\n+    @Override\n+    public void run(LSPBindings bindings, FileObject file) {\n+        try {\n+            //TODO: modified while the query is running?\n+            List<Either<SymbolInformation, DocumentSymbol>> symbols = bindings.getTextDocumentService().documentSymbol(new DocumentSymbolParams(new TextDocumentIdentifier(Utils.toURI(file)))).get();\n+\n+            synchronized (this) {\n+                this.rootElement = new RootBreadcrumbsElementImpl(file, doc, symbols.stream().map(this::toDocumentSymbol).collect(Collectors.toList()));\n+            }", "originalCommit": "7b17b17c3dc461403cfa14e038e127eb4e43d86b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}