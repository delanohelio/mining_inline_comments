{"pr_number": 1991, "pr_title": "[NETBEANS-3918] defer creation of target folder until/if needed", "pr_createdAt": "2020-02-29T22:29:56Z", "pr_url": "https://github.com/apache/netbeans/pull/1991", "timeline": [{"oid": "0237febf42ceceee360d0a93fd477373fee206e9", "url": "https://github.com/apache/netbeans/commit/0237febf42ceceee360d0a93fd477373fee206e9", "message": "[NETBEANS-3918] defer creation of target folder until/if needed", "committedDate": "2020-02-29T21:41:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA3NzQ5OQ==", "url": "https://github.com/apache/netbeans/pull/1991#discussion_r386077499", "bodyText": "The proposed property PROP_TARGET_FOLDR_HINT can hold any value, not just File. To prevent ClassCastException change this and next line to if (value instanceof File) { ... }.", "author": "jtulach", "createdAt": "2020-03-01T05:05:18Z", "path": "platform/openide.loaders/src/org/openide/loaders/TemplateWizard.java", "diffHunk": "@@ -244,7 +252,14 @@ public DataFolder getTemplatesFolder () {\n     public DataFolder getTargetFolder () throws IOException {\n         LOG.log(Level.FINE, \"targetFolder={0} for {1}\", new Object[] {targetDataFolder, this});\n         if (targetDataFolder == null) {\n-            throw new IOException(NbBundle.getMessage(TemplateWizard.class, \"ERR_NoFilesystem\"));\n+            // Fix for [NETBEANS-3918] and [NETBEANS-3875]\n+            File targetFolderFile = (File) getProperty(PROP_TARGET_FOLDER_HINT);", "originalCommit": "c4051d6f3fabf3ac6e69d483b71a172c42d95dbd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA3NzgyMQ==", "url": "https://github.com/apache/netbeans/pull/1991#discussion_r386077821", "bodyText": "This would be an API change and as such it would need additional attributes of an API change. See the wiki page for overall description. Here is the enumeration of what I am missing the most:\n\nincrementing module version, using @since tag\nmodifying apichanges.xml\ntesting the change", "author": "jtulach", "createdAt": "2020-03-01T05:12:08Z", "path": "platform/openide.loaders/src/org/openide/loaders/TemplateWizard.java", "diffHunk": "@@ -47,6 +48,13 @@\n * @see TemplateRegistration\n */\n public class TemplateWizard extends WizardDescriptor {\n+    /** Set to <CODE>File</CODE> to use for deferred creation of target folder.\n+     * If <CODE>TemplateWizard.getTargetFolder()</CODE> is called and the\n+     * the target folder has not been set then this property value is\n+     * used to create the directory and DataFolder. This allows deferral\n+     * of creation of DataFolder until and <em>if</em> it is needed.\n+     */", "originalCommit": "c4051d6f3fabf3ac6e69d483b71a172c42d95dbd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA3ODM5Mg==", "url": "https://github.com/apache/netbeans/pull/1991#discussion_r386078392", "bodyText": "Please note that TemplateWizard hasn't yet been using java.io.File. This would be the first time and I am not happy about it as it limits the usage of TemplateWizard to local disk. Could you consider alternative solution? Could you introduce\npublic void setTargetFolder(Supplier<DataFolder> toBeCreatedFolder) {\n}\ne.g. give the code a chance to work with DataFolder and FileObject only, but delay creation of the actual folder as much as possible?", "author": "jtulach", "createdAt": "2020-03-01T05:25:31Z", "path": "platform/openide.loaders/src/org/openide/loaders/TemplateWizard.java", "diffHunk": "@@ -244,7 +252,14 @@ public DataFolder getTemplatesFolder () {\n     public DataFolder getTargetFolder () throws IOException {\n         LOG.log(Level.FINE, \"targetFolder={0} for {1}\", new Object[] {targetDataFolder, this});\n         if (targetDataFolder == null) {\n-            throw new IOException(NbBundle.getMessage(TemplateWizard.class, \"ERR_NoFilesystem\"));\n+            // Fix for [NETBEANS-3918] and [NETBEANS-3875]\n+            File targetFolderFile = (File) getProperty(PROP_TARGET_FOLDER_HINT);\n+            if(targetFolderFile != null) {\n+                targetFolderFile.mkdirs();\n+                setTargetFolder(DataFolder.findFolder(FileUtil.toFileObject(targetFolderFile)));", "originalCommit": "c4051d6f3fabf3ac6e69d483b71a172c42d95dbd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}