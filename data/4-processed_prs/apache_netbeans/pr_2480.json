{"pr_number": 2480, "pr_title": "Search for JDK in typical location", "pr_createdAt": "2020-10-23T13:13:52Z", "pr_url": "https://github.com/apache/netbeans/pull/2480", "timeline": [{"oid": "e3d0dc6cefc6c41856867a63ca6c4dbd6e1cb322", "url": "https://github.com/apache/netbeans/commit/e3d0dc6cefc6c41856867a63ca6c4dbd6e1cb322", "message": "Applying typescript hints", "committedDate": "2020-10-23T11:48:55Z", "type": "commit"}, {"oid": "69af7491fae42e876de0cb068d85e2886d1eebf7", "url": "https://github.com/apache/netbeans/commit/69af7491fae42e876de0cb068d85e2886d1eebf7", "message": "Search for JDK in typical location", "committedDate": "2020-10-23T13:10:02Z", "type": "commit"}, {"oid": "a41a4906084a17d178a7658146d53ab76c00e721", "url": "https://github.com/apache/netbeans/commit/a41a4906084a17d178a7658146d53ab76c00e721", "message": "Start the LanguageClient just once", "committedDate": "2020-10-23T13:22:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDkyNDI2Ng==", "url": "https://github.com/apache/netbeans/pull/2480#discussion_r510924266", "bodyText": "I would rather check on full property name: java.home and netbeans.jdkhome...", "author": "Ondrej-Douda", "createdAt": "2020-10-23T14:29:39Z", "path": "java/java.lsp.server/vscode/src/extension.ts", "diffHunk": "@@ -65,33 +65,112 @@ function findClusters(myPath : string): string[] {\n     return clusters;\n }\n \n-export function activate(context: ExtensionContext) {\n-    //verify acceptable JDK is available/set:\n-    let specifiedJDK = workspace.getConfiguration('netbeans').get('jdkhome');\n-    const beVerbose : boolean = workspace.getConfiguration('netbeans').get('verbose', false);\n-    let info = {\n-        clusters : findClusters(context.extensionPath),\n-        extensionPath: context.extensionPath,\n-        storagePath : context.globalStoragePath,\n-        jdkHome : specifiedJDK,\n-        verbose: beVerbose\n-    };\n-    \n-    let log = vscode.window.createOutputChannel(\"Java Language Server\");\n+function findJDK(onChange: (path : string | null) => void): void {\n+    function find(): string | null {\n+        let nbJdk = workspace.getConfiguration('netbeans').get('jdkhome');\n+        if (nbJdk) {\n+            return nbJdk as string;\n+        }\n+        let javahome = workspace.getConfiguration('java').get('home');\n+        if (javahome) {\n+            return javahome as string;\n+        }\n \n-    vscode.extensions.all.forEach((e, index) => {\n+        let jdkHome: any = process.env.JDK_HOME;\n+        if (jdkHome) {\n+            return jdkHome as string;\n+        }\n+        let jHome: any = process.env.JAVA_HOME;\n+        if (jHome) {\n+            return jHome as string;\n+        }\n+        return null;\n+    }\n+\n+    let currentJdk = find();\n+    workspace.onDidChangeConfiguration(params => {\n+        if (!params.affectsConfiguration('java') && !params.affectsConfiguration('netbeans')) {", "originalCommit": "a41a4906084a17d178a7658146d53ab76c00e721", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxNTkxNQ==", "url": "https://github.com/apache/netbeans/pull/2480#discussion_r511015915", "bodyText": "ConfigurationChangeEvent doesn't seem to have a way to check that.", "author": "JaroslavTulach", "createdAt": "2020-10-23T16:55:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDkyNDI2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDkyNTUxNA==", "url": "https://github.com/apache/netbeans/pull/2480#discussion_r510925514", "bodyText": "This asks for vscode.extensions.getExtension('redhat.java') !== undefined...", "author": "Ondrej-Douda", "createdAt": "2020-10-23T14:31:30Z", "path": "java/java.lsp.server/vscode/src/extension.ts", "diffHunk": "@@ -65,33 +65,112 @@ function findClusters(myPath : string): string[] {\n     return clusters;\n }\n \n-export function activate(context: ExtensionContext) {\n-    //verify acceptable JDK is available/set:\n-    let specifiedJDK = workspace.getConfiguration('netbeans').get('jdkhome');\n-    const beVerbose : boolean = workspace.getConfiguration('netbeans').get('verbose', false);\n-    let info = {\n-        clusters : findClusters(context.extensionPath),\n-        extensionPath: context.extensionPath,\n-        storagePath : context.globalStoragePath,\n-        jdkHome : specifiedJDK,\n-        verbose: beVerbose\n-    };\n-    \n-    let log = vscode.window.createOutputChannel(\"Java Language Server\");\n+function findJDK(onChange: (path : string | null) => void): void {\n+    function find(): string | null {\n+        let nbJdk = workspace.getConfiguration('netbeans').get('jdkhome');\n+        if (nbJdk) {\n+            return nbJdk as string;\n+        }\n+        let javahome = workspace.getConfiguration('java').get('home');\n+        if (javahome) {\n+            return javahome as string;\n+        }\n \n-    vscode.extensions.all.forEach((e, index) => {\n+        let jdkHome: any = process.env.JDK_HOME;\n+        if (jdkHome) {\n+            return jdkHome as string;\n+        }\n+        let jHome: any = process.env.JAVA_HOME;\n+        if (jHome) {\n+            return jHome as string;\n+        }\n+        return null;\n+    }\n+\n+    let currentJdk = find();\n+    workspace.onDidChangeConfiguration(params => {\n+        if (!params.affectsConfiguration('java') && !params.affectsConfiguration('netbeans')) {\n+            return;\n+        }\n+        let newJdk = find();\n+        if (newJdk !== currentJdk) {\n+            onChange(newJdk);\n+        }\n+    });\n+    onChange(currentJdk);\n+}\n+\n+export function activate(context: ExtensionContext) {\n+    vscode.extensions.all.forEach((e) => {", "originalCommit": "a41a4906084a17d178a7658146d53ab76c00e721", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxNTAwMA==", "url": "https://github.com/apache/netbeans/pull/2480#discussion_r511015000", "bodyText": "OK, thanks: Done in e38771f", "author": "JaroslavTulach", "createdAt": "2020-10-23T16:54:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDkyNTUxNA=="}], "type": "inlineReview"}, {"oid": "bb591a879ad742cc8d0cedcf977eda9a89746279", "url": "https://github.com/apache/netbeans/commit/bb591a879ad742cc8d0cedcf977eda9a89746279", "message": "Consistently using: Apache Netbeans Language Server", "committedDate": "2020-10-23T14:38:57Z", "type": "commit"}, {"oid": "e38771f24ab1926a6718f559204cd47a1e137996", "url": "https://github.com/apache/netbeans/commit/e38771f24ab1926a6718f559204cd47a1e137996", "message": "Only set the workspace setting when workspace.name is defined", "committedDate": "2020-10-23T16:53:12Z", "type": "commit"}]}