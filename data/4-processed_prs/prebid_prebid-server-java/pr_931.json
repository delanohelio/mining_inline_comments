{"pr_number": 931, "pr_title": "Implement new logic for video sizeId in Rubicon bidder", "pr_createdAt": "2020-09-25T12:23:36Z", "pr_url": "https://github.com/prebid/prebid-server-java/pull/931", "timeline": [{"oid": "186dd214e652d63e6a46f662d81c01a0485e3cb2", "url": "https://github.com/prebid/prebid-server-java/commit/186dd214e652d63e6a46f662d81c01a0485e3cb2", "message": "Implement new logic for video sizeId.", "committedDate": "2020-09-25T12:02:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2MzcyNQ==", "url": "https://github.com/prebid/prebid-server-java/pull/931#discussion_r494963725", "bodyText": "Please make the variable final.\nMove the declaration of the variable near the usage - after skipDelay definition.", "author": "rpanchyk", "createdAt": "2020-09-25T12:48:11Z", "path": "src/main/java/org/prebid/server/bidder/rubicon/RubiconBidder.java", "diffHunk": "@@ -612,7 +612,8 @@ private static boolean isFullyPopulatedVideo(Video video) {\n                 && video.getLinearity() != null && video.getApi() != null;\n     }\n \n-    private Video makeVideo(Video video, RubiconVideoParams rubiconVideoParams, ExtImpPrebid prebidImpExt) {\n+    private Video makeVideo(Imp imp, RubiconVideoParams rubiconVideoParams, ExtImpPrebid prebidImpExt) {\n+        Video video = imp.getVideo();", "originalCommit": "186dd214e652d63e6a46f662d81c01a0485e3cb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NDk1NA==", "url": "https://github.com/prebid/prebid-server-java/pull/931#discussion_r494964954", "bodyText": "Seems we can combine this condition with above.", "author": "rpanchyk", "createdAt": "2020-09-25T12:50:26Z", "path": "src/main/java/org/prebid/server/bidder/rubicon/RubiconBidder.java", "diffHunk": "@@ -622,13 +623,32 @@ private Video makeVideo(Video video, RubiconVideoParams rubiconVideoParams, ExtI\n \n         final Integer skip = rubiconVideoParams != null ? rubiconVideoParams.getSkip() : null;\n         final Integer skipDelay = rubiconVideoParams != null ? rubiconVideoParams.getSkipdelay() : null;\n-        final Integer sizeId = rubiconVideoParams != null ? rubiconVideoParams.getSizeId() : null;\n+        final Integer sizeId = (rubiconVideoParams != null ? rubiconVideoParams.getSizeId() : null) != null\n+                ? rubiconVideoParams.getSizeId()\n+                : calculateVideoSizeIdDueToPlacement(video.getPlacement(), imp.getInstl());\n         return video.toBuilder()\n                 .ext(mapper.mapper().valueToTree(\n                         RubiconVideoExt.of(skip, skipDelay, RubiconVideoExtRp.of(sizeId), videoType)))\n                 .build();\n     }\n \n+    private Integer calculateVideoSizeIdDueToPlacement(Integer placement, Integer instl) {\n+        if (placement != null) {\n+            if (placement == 1) {\n+                return 201;\n+            }\n+            if (placement == 3) {\n+                return 203;\n+            }\n+        }\n+        if (instl != null) {\n+            if (instl == 1) {", "originalCommit": "186dd214e652d63e6a46f662d81c01a0485e3cb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NTkxNg==", "url": "https://github.com/prebid/prebid-server-java/pull/931#discussion_r494965916", "bodyText": "Let's make it less cryptic and create separate variable for rubiconVideoParams.getSizeId() value.", "author": "rpanchyk", "createdAt": "2020-09-25T12:52:12Z", "path": "src/main/java/org/prebid/server/bidder/rubicon/RubiconBidder.java", "diffHunk": "@@ -622,13 +623,32 @@ private Video makeVideo(Video video, RubiconVideoParams rubiconVideoParams, ExtI\n \n         final Integer skip = rubiconVideoParams != null ? rubiconVideoParams.getSkip() : null;\n         final Integer skipDelay = rubiconVideoParams != null ? rubiconVideoParams.getSkipdelay() : null;\n-        final Integer sizeId = rubiconVideoParams != null ? rubiconVideoParams.getSizeId() : null;\n+        final Integer sizeId = (rubiconVideoParams != null ? rubiconVideoParams.getSizeId() : null) != null", "originalCommit": "186dd214e652d63e6a46f662d81c01a0485e3cb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2Nzg4OQ==", "url": "https://github.com/prebid/prebid-server-java/pull/931#discussion_r494967889", "bodyText": "Usually by the project code style, we name such methods as resolveXXX(..).\nIn this case we can name it like resolveVideoSizeId(..).", "author": "rpanchyk", "createdAt": "2020-09-25T12:55:47Z", "path": "src/main/java/org/prebid/server/bidder/rubicon/RubiconBidder.java", "diffHunk": "@@ -622,13 +623,32 @@ private Video makeVideo(Video video, RubiconVideoParams rubiconVideoParams, ExtI\n \n         final Integer skip = rubiconVideoParams != null ? rubiconVideoParams.getSkip() : null;\n         final Integer skipDelay = rubiconVideoParams != null ? rubiconVideoParams.getSkipdelay() : null;\n-        final Integer sizeId = rubiconVideoParams != null ? rubiconVideoParams.getSizeId() : null;\n+        final Integer sizeId = (rubiconVideoParams != null ? rubiconVideoParams.getSizeId() : null) != null\n+                ? rubiconVideoParams.getSizeId()\n+                : calculateVideoSizeIdDueToPlacement(video.getPlacement(), imp.getInstl());", "originalCommit": "186dd214e652d63e6a46f662d81c01a0485e3cb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d00f64cd814c8597b1296be1e358b9b088820bfa", "url": "https://github.com/prebid/prebid-server-java/commit/d00f64cd814c8597b1296be1e358b9b088820bfa", "message": "Fixes after review", "committedDate": "2020-09-25T13:16:14Z", "type": "commit"}, {"oid": "6dc54c1508818a8d4b6033e2a8e38e9ee66fd42b", "url": "https://github.com/prebid/prebid-server-java/commit/6dc54c1508818a8d4b6033e2a8e38e9ee66fd42b", "message": "Additional test", "committedDate": "2020-09-25T13:25:17Z", "type": "commit"}, {"oid": "0e2d979ea534b8c8efc06287096add6f8fde7e74", "url": "https://github.com/prebid/prebid-server-java/commit/0e2d979ea534b8c8efc06287096add6f8fde7e74", "message": "Adding test changes", "committedDate": "2020-09-25T13:52:34Z", "type": "commit"}, {"oid": "cacc9b4e1d6f72f711bb0e33d822ace9af8a56b7", "url": "https://github.com/prebid/prebid-server-java/commit/cacc9b4e1d6f72f711bb0e33d822ace9af8a56b7", "message": "Merge pull request #2 from prebid/master\n\nMerge master", "committedDate": "2021-01-14T14:07:25Z", "type": "commit"}, {"oid": "f3d1efc5a0ce65d89a5c618d6c166327b48c9e26", "url": "https://github.com/prebid/prebid-server-java/commit/f3d1efc5a0ce65d89a5c618d6c166327b48c9e26", "message": "Merge branch 'master' into HB-9993/video_sizeId/newLogic\n\n# Conflicts:\n#\tsrc/main/java/org/prebid/server/bidder/rubicon/RubiconBidder.java", "committedDate": "2021-01-14T14:45:21Z", "type": "commit"}]}