{"pr_number": 1809, "pr_title": "fix NPE with support tank infantry weapons", "pr_createdAt": "2020-03-31T21:58:42Z", "pr_url": "https://github.com/MegaMek/megamek/pull/1809", "timeline": [{"oid": "56071c37eb1fdb8446fa943866ee3cab58cf317c", "url": "https://github.com/MegaMek/megamek/commit/56071c37eb1fdb8446fa943866ee3cab58cf317c", "message": "fix NPE with support tank infantry weapons", "committedDate": "2020-03-31T21:57:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NDA0MQ==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401244041", "bodyText": "Cast to Infantry isn't needed here.", "author": "Windchild292", "createdAt": "2020-03-31T22:07:20Z", "path": "megamek/src/megamek/client/bot/princess/InfantryFireControl.java", "diffHunk": "@@ -115,8 +115,10 @@ public double getMaxDamageAtRange(final MovePath shooterPath, final MovePath tar\n \n             // case 1\n             if (weaponType.hasFlag(WeaponType.F_INFANTRY)) {\n+                int infantryCount = shooter.isConventionalInfantry() ?\n+                        ((Infantry) shooter).getInternal(Infantry.LOC_INFANTRY) : 1;", "originalCommit": "56071c37eb1fdb8446fa943866ee3cab58cf317c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI5ODM3MA==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401298370", "bodyText": "It's used by the bot to calculate incoming and outgoing damage when evaluating a path being considered by an infantry unit. So it was trying to evaluate a move path for a foot platoon and checking how much damage an \"apocalypse world rover\" would do to the foot platoon. That particular tank has a weapon with an infantry flag, but was not an infantry unit.\nI'm pretty sure this will lead to incorrect behavior for battle armor, so I'm going to take another look at it.", "author": "NickAragua", "createdAt": "2020-04-01T00:58:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NDA0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNDExMg==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401304112", "bodyText": "There, that should do it.", "author": "NickAragua", "createdAt": "2020-04-01T01:21:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NDA0MQ=="}], "type": "inlineReview"}, {"oid": "1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "url": "https://github.com/MegaMek/megamek/commit/1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "message": "fix BA damage calculation", "committedDate": "2020-04-01T01:19:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNDU2NQ==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401304565", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for (final Mounted weapon : shooter.getWeaponList()) {            \n          \n          \n            \n                    for (final Mounted weapon : shooter.getWeaponList()) {", "author": "Windchild292", "createdAt": "2020-04-01T01:23:11Z", "path": "megamek/src/megamek/client/bot/princess/InfantryFireControl.java", "diffHunk": "@@ -91,7 +92,7 @@ public double getMaxDamageAtRange(final MovePath shooterPath, final MovePath tar\n                 && target.hasETypeFlag(Entity.ETYPE_INFANTRY) && ((Infantry) target).isMechanized();\n \n         // cycle through my weapons\n-        for (final Mounted weapon : shooter.getWeaponList()) {\n+        for (final Mounted weapon : shooter.getWeaponList()) {            ", "originalCommit": "1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNDY2MQ==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401304661", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(shooter.isConventionalInfantry()) {\n          \n          \n            \n                            if (shooter.isConventionalInfantry()) {", "author": "Windchild292", "createdAt": "2020-04-01T01:23:31Z", "path": "megamek/src/megamek/client/bot/princess/InfantryFireControl.java", "diffHunk": "@@ -115,8 +116,16 @@ public double getMaxDamageAtRange(final MovePath shooterPath, final MovePath tar\n \n             // case 1\n             if (weaponType.hasFlag(WeaponType.F_INFANTRY)) {\n+                int infantryCount = 1;\n+                \n+                if(shooter.isConventionalInfantry()) {", "originalCommit": "1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNDcxOQ==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401304719", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            } else if(shooter instanceof BattleArmor){\n          \n          \n            \n                            } else if (shooter instanceof BattleArmor) {", "author": "Windchild292", "createdAt": "2020-04-01T01:23:44Z", "path": "megamek/src/megamek/client/bot/princess/InfantryFireControl.java", "diffHunk": "@@ -115,8 +116,16 @@ public double getMaxDamageAtRange(final MovePath shooterPath, final MovePath tar\n \n             // case 1\n             if (weaponType.hasFlag(WeaponType.F_INFANTRY)) {\n+                int infantryCount = 1;\n+                \n+                if(shooter.isConventionalInfantry()) {\n+                    infantryCount = shooter.getInternal(Infantry.LOC_INFANTRY);\n+                } else if(shooter instanceof BattleArmor){", "originalCommit": "1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b765fcceb7ab65a5afad15056c7a970c1a585dc", "url": "https://github.com/MegaMek/megamek/commit/6b765fcceb7ab65a5afad15056c7a970c1a585dc", "message": "Update megamek/src/megamek/client/bot/princess/InfantryFireControl.java\n\nCo-Authored-By: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-04-01T01:31:27Z", "type": "commit"}, {"oid": "5b67909442c1e606455ed09b00300a05604846cb", "url": "https://github.com/MegaMek/megamek/commit/5b67909442c1e606455ed09b00300a05604846cb", "message": "Update megamek/src/megamek/client/bot/princess/InfantryFireControl.java\n\nCo-Authored-By: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-04-01T01:31:36Z", "type": "commit"}, {"oid": "abf1eadbbe4668b062a26d4d4f6fda70dc712d99", "url": "https://github.com/MegaMek/megamek/commit/abf1eadbbe4668b062a26d4d4f6fda70dc712d99", "message": "Update megamek/src/megamek/client/bot/princess/InfantryFireControl.java\n\nCo-Authored-By: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-04-01T01:31:41Z", "type": "commit"}]}