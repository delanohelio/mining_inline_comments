{"pr_number": 2156, "pr_title": "Fixed null pointer exception causing bot to break", "pr_createdAt": "2020-08-17T14:55:10Z", "pr_url": "https://github.com/MegaMek/megamek/pull/2156", "timeline": [{"oid": "6323445ec74cadd22242efdbb922d8c4b76b852b", "url": "https://github.com/MegaMek/megamek/commit/6323445ec74cadd22242efdbb922d8c4b76b852b", "message": "Fixed null pointer exception causing bot to break", "committedDate": "2020-08-17T14:37:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzODcyOA==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471538728", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        System.out.println(\"Null entity reference in cacheImgTag()\");\n          \n          \n            \n                        MegaMek.getLogger().error(this, \"Null entity reference\");", "author": "Windchild292", "createdAt": "2020-08-17T14:59:34Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1151,33 +1151,29 @@ private String getCachedImgTag(int id){\n     private void cacheImgTag(Entity entity){\n \n         if(entity == null) {\n-            System.out.println(\"Null entity reference\");\n+            System.out.println(\"Null entity reference in cacheImgTag()\");", "originalCommit": "6323445ec74cadd22242efdbb922d8c4b76b852b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzODkyOQ==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471538929", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    }else if (imgCache.containsKey(entity.getId())) {//remove images that should be refreshed\n          \n          \n            \n                    } else if (imgCache.containsKey(entity.getId())) {\n          \n          \n            \n                        //remove images that should be refreshed", "author": "Windchild292", "createdAt": "2020-08-17T14:59:51Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1151,33 +1151,29 @@ private String getCachedImgTag(int id){\n     private void cacheImgTag(Entity entity){\n \n         if(entity == null) {\n-            System.out.println(\"Null entity reference\");\n+            System.out.println(\"Null entity reference in cacheImgTag()\");\n             return;\n         }\n \n         if (imgCache == null) {\n             imgCache = new Hashtable<>();\n-        }else if (imgCache.containsKey(entity.getId())) {\n-            //remove images that should be regenerated\n+        }else if (imgCache.containsKey(entity.getId())) {//remove images that should be refreshed", "originalCommit": "6323445ec74cadd22242efdbb922d8c4b76b852b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzOTU1OQ==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471539559", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(getTargetImage(entity) != null){//convert image to base64, add to to <img> tag and store in cache\n          \n          \n            \n                    if (getTargetImage(entity) != null) {\n          \n          \n            \n                        //convert image to base64, add to to <img> tag and store in cache", "author": "Windchild292", "createdAt": "2020-08-17T15:00:43Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1151,33 +1151,29 @@ private String getCachedImgTag(int id){\n     private void cacheImgTag(Entity entity){\n \n         if(entity == null) {\n-            System.out.println(\"Null entity reference\");\n+            System.out.println(\"Null entity reference in cacheImgTag()\");\n             return;\n         }\n \n         if (imgCache == null) {\n             imgCache = new Hashtable<>();\n-        }else if (imgCache.containsKey(entity.getId())) {\n-            //remove images that should be regenerated\n+        }else if (imgCache.containsKey(entity.getId())) {//remove images that should be refreshed\n             imgCache.remove(entity.getId());\n         }\n \n-        //convert to base64, add to to <img> tag and store in cache\n-        if (!imgCache.containsKey(entity.getId())) {\n-            Image image = ImageUtil.getScaledImage(getTargetImage(entity),  56, 48);\n-            if(image!=null) {\n-                try {\n-                    String base64Text;\n-                    ByteArrayOutputStream baos = new ByteArrayOutputStream();\n-                    ImageIO.write((RenderedImage) image, \"png\", baos);\n-                    baos.flush();\n-                    base64Text = Base64.getEncoder().encodeToString(baos.toByteArray());\n-                    baos.close();\n-                    String img = \"<img src='data:image/png;base64,\" + base64Text + \"'>\";\n-                    imgCache.put(entity.getId(), img);\n-                } catch (final IOException ioe) {\n-                    throw new UncheckedIOException(ioe);\n-                }\n+        if(getTargetImage(entity) != null){//convert image to base64, add to to <img> tag and store in cache", "originalCommit": "6323445ec74cadd22242efdbb922d8c4b76b852b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471541003", "bodyText": "if (bv == null) {\n    return null;\n} else if (e.isDestroyed()) {\n    return bv.getTilesetManager().wreckMarkerFor(e, -1);\n} else {\n    return bv.getTilesetManager().imageFor(e);\n}", "author": "Windchild292", "createdAt": "2020-08-17T15:02:58Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1186,10 +1182,14 @@ private void cacheImgTag(Entity entity){\n      * Gets the current mech image\n      */\n     private Image getTargetImage(Entity e){\n-        if(e.isDestroyed()) {\n-            return bv.getTilesetManager().wreckMarkerFor(e, -1);\n+        if(bv == null){\n+            return  null;\n         }else {\n-            return bv.getTilesetManager().imageFor(e);\n+            if (e.isDestroyed()) {\n+                return bv.getTilesetManager().wreckMarkerFor(e, -1);\n+            } else {\n+                return bv.getTilesetManager().imageFor(e);\n+            }\n         }", "originalCommit": "6323445ec74cadd22242efdbb922d8c4b76b852b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTI2Mw==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471541263", "bodyText": "Suggested rewrite to improve readability.", "author": "Windchild292", "createdAt": "2020-08-17T15:03:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1MDI5NA==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471550294", "bodyText": "Apparently I'm sloppy when it's early. I appreciate the suggestions.", "author": "Krashner", "createdAt": "2020-08-17T15:16:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MDA1Mw==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471560053", "bodyText": "It happens to us all, and welcome :)", "author": "Windchild292", "createdAt": "2020-08-17T15:31:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw=="}], "type": "inlineReview"}, {"oid": "003a3704d61d4a88f229a76b99c1cd9b0636eff9", "url": "https://github.com/MegaMek/megamek/commit/003a3704d61d4a88f229a76b99c1cd9b0636eff9", "message": "Update megamek/src/megamek/client/Client.java\r\n\r\nSuggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-08-17T15:11:52Z", "type": "commit"}, {"oid": "404482bd4a69bc7978ea6b2172f6961766dbd2da", "url": "https://github.com/MegaMek/megamek/commit/404482bd4a69bc7978ea6b2172f6961766dbd2da", "message": "Update megamek/src/megamek/client/Client.java\r\n\r\nSuggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-08-17T15:12:13Z", "type": "commit"}, {"oid": "c806953e87dfc92726070d9009e96d7bc399b36d", "url": "https://github.com/MegaMek/megamek/commit/c806953e87dfc92726070d9009e96d7bc399b36d", "message": "Update megamek/src/megamek/client/Client.java\r\n\r\nSuggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-08-17T15:12:27Z", "type": "commit"}, {"oid": "55578c152e70d891c312091a55fae76076549952", "url": "https://github.com/MegaMek/megamek/commit/55578c152e70d891c312091a55fae76076549952", "message": "Fixed readability for getTargetImage", "committedDate": "2020-08-17T15:16:13Z", "type": "commit"}]}