{"pr_number": 1845, "pr_title": "AbstractUnitSelector: MegaMek Implementation", "pr_createdAt": "2020-04-12T21:58:56Z", "pr_url": "https://github.com/MegaMek/megamek/pull/1845", "timeline": [{"oid": "51787eff546e2759c97f0b8f53ae01c4dfef1afd", "url": "https://github.com/MegaMek/megamek/commit/51787eff546e2759c97f0b8f53ae01c4dfef1afd", "message": "Cleaning up UnitSelectorDialog, part 1", "committedDate": "2020-03-13T18:33:35Z", "type": "commit"}, {"oid": "796cfdf592b62fd97633e782fae0ee6e22dff8bb", "url": "https://github.com/MegaMek/megamek/commit/796cfdf592b62fd97633e782fae0ee6e22dff8bb", "message": "Switching file to use logger instead of system.out", "committedDate": "2020-03-13T18:39:41Z", "type": "commit"}, {"oid": "e121e9ec5bf346848444e46b7938a55610c810b8", "url": "https://github.com/MegaMek/megamek/commit/e121e9ec5bf346848444e46b7938a55610c810b8", "message": "Renaming variables", "committedDate": "2020-03-13T18:53:22Z", "type": "commit"}, {"oid": "59aed2f79434305a6058c961817e8ccc5d34d577", "url": "https://github.com/MegaMek/megamek/commit/59aed2f79434305a6058c961817e8ccc5d34d577", "message": "Moving initialize to a shared method", "committedDate": "2020-03-13T19:13:48Z", "type": "commit"}, {"oid": "ac4708a1b94a8df52cc37cd167091d42e0382b1f", "url": "https://github.com/MegaMek/megamek/commit/ac4708a1b94a8df52cc37cd167091d42e0382b1f", "message": "More moving and renaming variables", "committedDate": "2020-03-13T19:14:06Z", "type": "commit"}, {"oid": "87f034f286cf4a0b46d13e4853d7c47879326046", "url": "https://github.com/MegaMek/megamek/commit/87f034f286cf4a0b46d13e4853d7c47879326046", "message": "Renaming gridBagConstraints variable", "committedDate": "2020-03-13T19:19:32Z", "type": "commit"}, {"oid": "b28fafa2b35594e9dda4a2d6e6084a932e29dedb", "url": "https://github.com/MegaMek/megamek/commit/b28fafa2b35594e9dda4a2d6e6084a932e29dedb", "message": "Cleaning up a bunch of the gridbags to instead just modify the x and y of a single one", "committedDate": "2020-03-13T19:24:48Z", "type": "commit"}, {"oid": "0bf350f4c5a24578d81c5b23d33d2aa4f022d4ee", "url": "https://github.com/MegaMek/megamek/commit/0bf350f4c5a24578d81c5b23d33d2aa4f022d4ee", "message": "Buttons are now created in a method", "committedDate": "2020-03-13T19:38:30Z", "type": "commit"}, {"oid": "864c1718b507d26058ec99ff8aab1f9a631830d9", "url": "https://github.com/MegaMek/megamek/commit/864c1718b507d26058ec99ff8aab1f9a631830d9", "message": "Moving internal class to the bottom of the file", "committedDate": "2020-03-13T19:42:24Z", "type": "commit"}, {"oid": "6b804c687e0287481778b5aa7cbce4651c7ca24b", "url": "https://github.com/MegaMek/megamek/commit/6b804c687e0287481778b5aa7cbce4651c7ca24b", "message": "Final cleanup", "committedDate": "2020-03-13T19:45:01Z", "type": "commit"}, {"oid": "770dba775f84139d1e22e93b19c91c5050a632f7", "url": "https://github.com/MegaMek/megamek/commit/770dba775f84139d1e22e93b19c91c5050a632f7", "message": "Fixing issues in unit selector - NPE", "committedDate": "2020-03-13T23:02:19Z", "type": "commit"}, {"oid": "33f6df9db67202d70373dc1d612c94bad5de56d7", "url": "https://github.com/MegaMek/megamek/commit/33f6df9db67202d70373dc1d612c94bad5de56d7", "message": "Modernizing Select Mech to Select Unit", "committedDate": "2020-03-14T02:04:48Z", "type": "commit"}, {"oid": "c49058f1334efcacc6cb524af7387e5ce567dc4e", "url": "https://github.com/MegaMek/megamek/commit/c49058f1334efcacc6cb524af7387e5ce567dc4e", "message": "Applying initial changes for switching to using a MekHQ specific variant", "committedDate": "2020-03-14T02:05:33Z", "type": "commit"}, {"oid": "c6afac48de7a7382943af8e3383f833a7ec58ee6", "url": "https://github.com/MegaMek/megamek/commit/c6afac48de7a7382943af8e3383f833a7ec58ee6", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_UnitSelector", "committedDate": "2020-03-14T02:40:58Z", "type": "commit"}, {"oid": "e5dcdfcff9dd98c0a19f22dc7e34c5c16b79126b", "url": "https://github.com/MegaMek/megamek/commit/e5dcdfcff9dd98c0a19f22dc7e34c5c16b79126b", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_UnitSelector", "committedDate": "2020-03-14T13:36:30Z", "type": "commit"}, {"oid": "9898da8e25cef0b5448f65a69bd3155885c1178b", "url": "https://github.com/MegaMek/megamek/commit/9898da8e25cef0b5448f65a69bd3155885c1178b", "message": "Removing old UnitSelectorDialog", "committedDate": "2020-03-14T16:38:55Z", "type": "commit"}, {"oid": "870f324de98c6b46e3ab72dfd39d8e66e2178bff", "url": "https://github.com/MegaMek/megamek/commit/870f324de98c6b46e3ab72dfd39d8e66e2178bff", "message": "Adding the MekHQ localization here so that the unit selectors are all localized in the same place", "committedDate": "2020-03-14T16:39:53Z", "type": "commit"}, {"oid": "f6c001709389544e1db741c3d403509a91e66dc2", "url": "https://github.com/MegaMek/megamek/commit/f6c001709389544e1db741c3d403509a91e66dc2", "message": "Making modifications to the UnitSelector classes in MegaMek as part of adding the MekHQ unit selector", "committedDate": "2020-03-14T16:40:41Z", "type": "commit"}, {"oid": "b636a8216d0c34bad33b8c59557a437db6fa949e", "url": "https://github.com/MegaMek/megamek/commit/b636a8216d0c34bad33b8c59557a437db6fa949e", "message": "Trying to figure out unit tech level bug", "committedDate": "2020-03-14T18:12:35Z", "type": "commit"}, {"oid": "1e9bdf562d5ba02c961283dbd45882a73099088e", "url": "https://github.com/MegaMek/megamek/commit/1e9bdf562d5ba02c961283dbd45882a73099088e", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_UnitSelector", "committedDate": "2020-03-20T18:49:28Z", "type": "commit"}, {"oid": "0377fa9086dcc4ae4733cf3979711b330829a963", "url": "https://github.com/MegaMek/megamek/commit/0377fa9086dcc4ae4733cf3979711b330829a963", "message": "Doing a bit of reformatting in AbstractUnitSelector", "committedDate": "2020-03-20T19:25:41Z", "type": "commit"}, {"oid": "b2efd1951c4492784e3f829b6ee1aa5e8dec665d", "url": "https://github.com/MegaMek/megamek/commit/b2efd1951c4492784e3f829b6ee1aa5e8dec665d", "message": "Fixed the unit selector not updating with regards to tech level", "committedDate": "2020-03-20T19:47:33Z", "type": "commit"}, {"oid": "7d27491962c5f661abf429ceef8242226ee4f3c7", "url": "https://github.com/MegaMek/megamek/commit/7d27491962c5f661abf429ceef8242226ee4f3c7", "message": "Switching to using an abstract method to update any options", "committedDate": "2020-03-20T19:54:40Z", "type": "commit"}, {"oid": "eb2599626fab803817ec6ceff965549d63f35ff3", "url": "https://github.com/MegaMek/megamek/commit/eb2599626fab803817ec6ceff965549d63f35ff3", "message": "Removing client from the file", "committedDate": "2020-03-20T20:18:57Z", "type": "commit"}, {"oid": "d1c16160ef090bac2b88e35d1ecd6fe8ba3c7af6", "url": "https://github.com/MegaMek/megamek/commit/d1c16160ef090bac2b88e35d1ecd6fe8ba3c7af6", "message": "Removing loggers used in testing", "committedDate": "2020-03-20T20:22:20Z", "type": "commit"}, {"oid": "6cb616706472ee16b249b956462c190c599faab9", "url": "https://github.com/MegaMek/megamek/commit/6cb616706472ee16b249b956462c190c599faab9", "message": "Removing deprecation notice", "committedDate": "2020-03-20T20:41:35Z", "type": "commit"}, {"oid": "1f2706db0b3ef768d9c487a523601ca5dc469e4f", "url": "https://github.com/MegaMek/megamek/commit/1f2706db0b3ef768d9c487a523601ca5dc469e4f", "message": "Fixing the logger usage", "committedDate": "2020-03-20T20:46:02Z", "type": "commit"}, {"oid": "cbdfec3eb7ecd93b1f9507ccbfa9a9ba0be8162e", "url": "https://github.com/MegaMek/megamek/commit/cbdfec3eb7ecd93b1f9507ccbfa9a9ba0be8162e", "message": "Fixing user preferences to work properly for MegaMek, although we need to fix the default sorting ordeR", "committedDate": "2020-03-21T23:12:07Z", "type": "commit"}, {"oid": "afcdfc933439fa09fcaa89c63afdad36e20ed319", "url": "https://github.com/MegaMek/megamek/commit/afcdfc933439fa09fcaa89c63afdad36e20ed319", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_UnitSelector", "committedDate": "2020-04-12T01:18:26Z", "type": "commit"}, {"oid": "f5502347287967e9ad0c2adfb25f4bdab511d429", "url": "https://github.com/MegaMek/megamek/commit/f5502347287967e9ad0c2adfb25f4bdab511d429", "message": "Removing unused imports", "committedDate": "2020-04-12T02:25:17Z", "type": "commit"}, {"oid": "1f42f3f4b1eb413e318d80ea77c16ed691e7a005", "url": "https://github.com/MegaMek/megamek/commit/1f42f3f4b1eb413e318d80ea77c16ed691e7a005", "message": "Applying fixes based on testing", "committedDate": "2020-04-12T03:44:31Z", "type": "commit"}, {"oid": "6235e29c960049fa61d219c9224f96b7178f8caf", "url": "https://github.com/MegaMek/megamek/commit/6235e29c960049fa61d219c9224f96b7178f8caf", "message": "Moving getChosenMechSummary to MML", "committedDate": "2020-04-12T15:05:28Z", "type": "commit"}, {"oid": "335c8a3e08b6ed6743c5381ff60195eb91ceb46c", "url": "https://github.com/MegaMek/megamek/commit/335c8a3e08b6ed6743c5381ff60195eb91ceb46c", "message": "Merge branch 'dev_Windchild_NOC' into dev_Windchild_UnitSelector", "committedDate": "2020-04-12T15:47:53Z", "type": "commit"}, {"oid": "17acf839cccfd537f80116304222f66c9c6eb69f", "url": "https://github.com/MegaMek/megamek/commit/17acf839cccfd537f80116304222f66c9c6eb69f", "message": "Adding natural order comparator usage", "committedDate": "2020-04-12T15:50:57Z", "type": "commit"}, {"oid": "5075fa3e7adc45dc79ddc136d20461a7641939b5", "url": "https://github.com/MegaMek/megamek/commit/5075fa3e7adc45dc79ddc136d20461a7641939b5", "message": "Fixing spacing", "committedDate": "2020-04-12T15:53:15Z", "type": "commit"}, {"oid": "b49f99977c14329da9b4d8b6de49315a6fb42969", "url": "https://github.com/MegaMek/megamek/commit/b49f99977c14329da9b4d8b6de49315a6fb42969", "message": "Implementing properties", "committedDate": "2020-04-12T17:00:17Z", "type": "commit"}, {"oid": "7accc4bd5253ee6e5b4e2449c9d701fe4368e2bf", "url": "https://github.com/MegaMek/megamek/commit/7accc4bd5253ee6e5b4e2449c9d701fe4368e2bf", "message": "Implementing techLevelDisplayType", "committedDate": "2020-04-12T17:59:33Z", "type": "commit"}, {"oid": "39360ae4983dbeaeaf0bc83b82ac451611d4703a", "url": "https://github.com/MegaMek/megamek/commit/39360ae4983dbeaeaf0bc83b82ac451611d4703a", "message": "Removing old comment", "committedDate": "2020-04-12T18:32:22Z", "type": "commit"}, {"oid": "50d4e800f52463aeb9c8eb204f420685a0a93ec5", "url": "https://github.com/MegaMek/megamek/commit/50d4e800f52463aeb9c8eb204f420685a0a93ec5", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_UnitSelector", "committedDate": "2020-04-13T18:05:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgwMjk5MA==", "url": "https://github.com/MegaMek/megamek/pull/1845#discussion_r410802990", "bodyText": "Why is this replaced here and not below where the right bracket is replaced?", "author": "sixlettervariables", "createdAt": "2020-04-19T03:23:40Z", "path": "megamek/src/megamek/client/ui/swing/dialog/AbstractUnitSelectorDialog.java", "diffHunk": "@@ -0,0 +1,934 @@\n+/*\n+ *  MechSelectorDialog.java - Copyright (C) 2002,2004 Josh Yockey\n+ *  Renamed UnitSelectorDialog - Jay Lawson <jaylawson39 at yahoo.com>\n+ *  Renamed AbstractUnitSelectorDialog - Copyright (c) 2020 - The MegaMek Team\n+ *  This program is free software; you can redistribute it and/or modify it\n+ *  under the terms of the GNU General Public License as published by the Free\n+ *  Software Foundation; either version 2 of the License, or (at your option)\n+ *  any later version.\n+ *\n+ *  This program is distributed in the hope that it will be useful, but\n+ *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n+ *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License\n+ *  for more details.\n+ */\n+package megamek.client.ui.swing.dialog;\n+\n+import java.awt.Dimension;\n+import java.awt.Font;\n+import java.awt.GridBagConstraints;\n+import java.awt.GridBagLayout;\n+import java.awt.Insets;\n+import java.awt.event.ActionEvent;\n+import java.awt.event.ActionListener;\n+import java.awt.event.KeyEvent;\n+import java.awt.event.KeyListener;\n+import java.awt.event.WindowEvent;\n+import java.util.*;\n+import java.util.regex.PatternSyntaxException;\n+\n+import javax.swing.AbstractAction;\n+import javax.swing.Action;\n+import javax.swing.DefaultComboBoxModel;\n+import javax.swing.DefaultRowSorter;\n+import javax.swing.JButton;\n+import javax.swing.JComboBox;\n+import javax.swing.JComponent;\n+import javax.swing.JDialog;\n+import javax.swing.JEditorPane;\n+import javax.swing.JFrame;\n+import javax.swing.JLabel;\n+import javax.swing.JList;\n+import javax.swing.JOptionPane;\n+import javax.swing.JPanel;\n+import javax.swing.JRootPane;\n+import javax.swing.JScrollPane;\n+import javax.swing.JSplitPane;\n+import javax.swing.JTabbedPane;\n+import javax.swing.JTable;\n+import javax.swing.JTextField;\n+import javax.swing.KeyStroke;\n+import javax.swing.ListSelectionModel;\n+import javax.swing.RowFilter;\n+import javax.swing.RowSorter.SortKey;\n+import javax.swing.ScrollPaneConstants;\n+import javax.swing.SortOrder;\n+import javax.swing.SwingConstants;\n+import javax.swing.event.DocumentEvent;\n+import javax.swing.event.DocumentListener;\n+import javax.swing.event.ListSelectionEvent;\n+import javax.swing.event.ListSelectionListener;\n+import javax.swing.table.AbstractTableModel;\n+import javax.swing.table.TableColumn;\n+import javax.swing.table.TableRowSorter;\n+\n+import megamek.client.ui.Messages;\n+import megamek.client.ui.swing.*;\n+import megamek.common.Entity;\n+import megamek.common.EntityWeightClass;\n+import megamek.common.MechFileParser;\n+import megamek.common.MechSearchFilter;\n+import megamek.common.MechSummary;\n+import megamek.common.MechSummaryCache;\n+import megamek.common.MechView;\n+import megamek.common.TechConstants;\n+import megamek.common.UnitType;\n+import megamek.common.loaders.EntityLoadingException;\n+import megamek.common.logging.DefaultMmLogger;\n+import megamek.common.logging.MMLogger;\n+import megamek.common.options.GameOptions;\n+import megamek.common.options.OptionsConstants;\n+import megamek.common.templates.TROView;\n+import megamek.common.util.sorter.NaturalOrderComparator;\n+\n+/**\n+ * This is a heavily reworked version of the original MechSelectorDialog which\n+ * brings up a list of units for the player to select to add to their forces.\n+ * The original list has been changed to a sortable table and a text filter\n+ * is used for advanced searching.\n+ */\n+public abstract class AbstractUnitSelectorDialog extends JDialog implements Runnable, KeyListener,\n+        ActionListener, ListSelectionListener {\n+    //region Variable Declarations\n+    private static final long serialVersionUID = 8144354264100884817L;\n+\n+    public static final String CLOSE_ACTION = \"closeAction\";\n+    public static final String SELECT_ACTION = \"selectAction\";\n+\n+    public static final int ALLOWED_YEAR_ANY = 999999;\n+\n+    protected static final int TECH_LEVEL_DISPLAY_IS = 0;\n+    protected static final int TECH_LEVEL_DISPLAY_CLAN = 1;\n+    protected static final int TECH_LEVEL_DISPLAY_IS_CLAN = 2;\n+\n+    protected JButton buttonSelectClose;\n+    protected JButton buttonSelect;\n+    protected JButton buttonClose;\n+    protected JButton buttonShowBV;\n+\n+    private JButton buttonAdvancedSearch;\n+    private JButton buttonResetSearch;\n+    protected JList<String> listTechLevel = new JList<>();\n+    /**\n+     * We need to map the selected index of listTechLevel to the actual TL it\n+     * belongs to\n+     */\n+    protected Map<Integer, Integer> techLevelListToIndex = new HashMap<>();\n+    protected JComboBox<String> comboUnitType = new JComboBox<>();\n+    protected JComboBox<String> comboWeight = new JComboBox<>();\n+    protected JLabel labelImage = new JLabel(\"\"); //inline to avoid potential null pointer issues\n+    protected JTable tableUnits;\n+    protected JTextField textFilter;\n+    private MechViewPanel panelMechView;\n+    private MechViewPanel panelTROView;\n+\n+    private StringBuffer searchBuffer = new StringBuffer();\n+    private long lastSearch = 0;\n+    // how long after a key is typed does a new search begin\n+    private static final int KEY_TIMEOUT = 1000;\n+\n+    protected static MechSummaryCache mscInstance = MechSummaryCache.getInstance();\n+    protected MechSummary[] mechs;\n+\n+    private MechTableModel unitModel = new MechTableModel();\n+    protected MechSearchFilter searchFilter;\n+\n+    private UnitLoadingDialog unitLoadingDialog;\n+    private AdvancedSearchDialog asd;\n+    protected JFrame frame;\n+\n+    protected TableRowSorter<MechTableModel> sorter;\n+\n+    protected GameOptions gameOptions = null;\n+    protected boolean enableYearLimits = false;\n+    protected int allowedYear = ALLOWED_YEAR_ANY;\n+    protected boolean canonOnly = false;\n+    protected int gameTechLevel = TechConstants.T_SIMPLE_INTRO;\n+    protected int techLevelDisplayType = TECH_LEVEL_DISPLAY_IS_CLAN;\n+\n+    protected static MMLogger logger = DefaultMmLogger.getInstance();\n+    //endregion Variable Declarations\n+\n+    protected AbstractUnitSelectorDialog(JFrame frame, UnitLoadingDialog unitLoadingDialog) {\n+        super(frame, Messages.getString(\"MechSelectorDialog.title\"), true); //$NON-NLS-1$\n+        setName(\"UnitSelectorDialog\");\n+        this.frame = frame;\n+        this.unitLoadingDialog = unitLoadingDialog;\n+        super.setVisible(false);\n+    }\n+\n+    /**\n+     * This is used to update any values that are set based on individual options\n+     */\n+    public abstract void updateOptionValues();\n+\n+    /**\n+     * This has been set up to permit preference implementation in anything that extends this\n+     */\n+    private void setUserPreferences() {\n+        GUIPreferences guiPreferences = GUIPreferences.getInstance();\n+        setSize(guiPreferences.getMechSelectorSizeWidth(), guiPreferences.getMechSelectorSizeHeight());\n+\n+        comboUnitType.setSelectedIndex(guiPreferences.getMechSelectorUnitType());\n+\n+        comboWeight.setSelectedIndex(guiPreferences.getMechSelectorWeightClass());\n+\n+        updateTypeCombo(guiPreferences.getMechSelectorRulesLevels().replaceAll(\"\\\\[\", \"\"));", "originalCommit": "50d4e800f52463aeb9c8eb204f420685a0a93ec5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkzOTA4Ng==", "url": "https://github.com/MegaMek/megamek/pull/1845#discussion_r410939086", "bodyText": "Yep, inherited code... but I'm not sure.\nI've reworked it so that it just sends the guiPreferences to updateTypeCombo and if needed it gets the rules and does the replacements, as that's just a better way to handle it.", "author": "Windchild292", "createdAt": "2020-04-19T16:18:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgwMjk5MA=="}], "type": "inlineReview"}, {"oid": "1538912addbf011c0ccb3fc79e2994e49ed62299", "url": "https://github.com/MegaMek/megamek/commit/1538912addbf011c0ccb3fc79e2994e49ed62299", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_UnitSelector", "committedDate": "2020-04-19T15:39:33Z", "type": "commit"}, {"oid": "9641b9e10fd0f42a9d0d07801ebe09d88424ec66", "url": "https://github.com/MegaMek/megamek/commit/9641b9e10fd0f42a9d0d07801ebe09d88424ec66", "message": "Applying review changes", "committedDate": "2020-04-19T16:18:07Z", "type": "commit"}, {"oid": "22edc8550ef4127814682de8e97a0293db70e051", "url": "https://github.com/MegaMek/megamek/commit/22edc8550ef4127814682de8e97a0293db70e051", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_UnitSelector", "committedDate": "2020-04-20T17:00:21Z", "type": "commit"}, {"oid": "930edde871f46ca8256768cc0308b06030caf359", "url": "https://github.com/MegaMek/megamek/commit/930edde871f46ca8256768cc0308b06030caf359", "message": "Fixing merge conflicts", "committedDate": "2020-07-07T18:47:50Z", "type": "commit"}, {"oid": "f2e9d378f6da43854e3f94a3e2220bd19c26c477", "url": "https://github.com/MegaMek/megamek/commit/f2e9d378f6da43854e3f94a3e2220bd19c26c477", "message": "Applying gender changes", "committedDate": "2020-07-07T18:50:13Z", "type": "commit"}]}