{"pr_number": 1253, "pr_title": "Bumps library versions to latest", "pr_createdAt": "2020-09-15T04:56:10Z", "pr_url": "https://github.com/openzipkin/brave/pull/1253", "timeline": [{"oid": "d6866e1924733a6675eefa9c764215e7780d3e13", "url": "https://github.com/openzipkin/brave/commit/d6866e1924733a6675eefa9c764215e7780d3e13", "message": "Bumps library versions to latest", "committedDate": "2020-09-15T04:55:47Z", "type": "commit"}, {"oid": "8dc07ba393786e491b02a1122d080e0556f03f37", "url": "https://github.com/openzipkin/brave/commit/8dc07ba393786e491b02a1122d080e0556f03f37", "message": "avoid leaking suddenly recent mongo admin commands", "committedDate": "2020-09-15T07:22:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0NDk1OA==", "url": "https://github.com/openzipkin/brave/pull/1253#discussion_r488444958", "bodyText": "assertj got weird and leaked data which I didn't feel like hunting down. This is a classloader test", "author": "codefromthecrypt", "createdAt": "2020-09-15T07:25:46Z", "path": "brave-tests/src/main/java/brave/test/propagation/PropagationTest.java", "diffHunk": "@@ -180,8 +180,9 @@ public MapEntry() {\n       Map<Object, String> map = new LinkedHashMap<>();\n       injector.inject(ctx, map);\n \n-      assertThat(extractor.extract(map).context())", "originalCommit": "8dc07ba393786e491b02a1122d080e0556f03f37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0NTIzMQ==", "url": "https://github.com/openzipkin/brave/pull/1253#discussion_r488445231", "bodyText": "assertj's recursive can't tell the difference between two exceptions with the same value state anymore", "author": "codefromthecrypt", "createdAt": "2020-09-15T07:26:13Z", "path": "brave/src/test/java/brave/handler/MutableSpanTest.java", "diffHunk": "@@ -578,7 +579,7 @@\n         MutableSpan other = otherConstructor.get();\n         assertThat(span).isNotSameAs(other); // sanity\n         assertNeitherEqualNorShareHashCode(span, other);\n-        assertThat(span).usingRecursiveComparison().isNotEqualTo(other); // double check our impl\n+        assertThat(Objects.deepEquals(span, other)).isFalse(); // double check our impl", "originalCommit": "8dc07ba393786e491b02a1122d080e0556f03f37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0NTY5Mw==", "url": "https://github.com/openzipkin/brave/pull/1253#discussion_r488445693", "bodyText": "typical maintenance and without this we can't really trace kafka 2.6 as it won't completely implement the interface", "author": "codefromthecrypt", "createdAt": "2020-09-15T07:26:53Z", "path": "instrumentation/kafka-clients/src/main/java/brave/kafka/clients/TracingConsumer.java", "diffHunk": "@@ -313,6 +313,11 @@ public ConsumerGroupMetadata groupMetadata() {\n     return delegate.groupMetadata();\n   }\n \n+  // Do not use @Override annotation to avoid compatibility issue version < 2.6\n+  public void enforceRebalance() {\n+    delegate.enforceRebalance();", "originalCommit": "8dc07ba393786e491b02a1122d080e0556f03f37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0NjQxMw==", "url": "https://github.com/openzipkin/brave/pull/1253#discussion_r488446413", "bodyText": "super strange that in a patch \"admin\" database commands suddenly show up. Due to order of things, we would only see \"endSessions\"! This explicitly gets rid of this similar to p6spy until/unless someone asks for full admin coverage and in that case end w/o start probably is undesirable.", "author": "codefromthecrypt", "createdAt": "2020-09-15T07:28:11Z", "path": "instrumentation/mongodb/src/main/java/brave/mongodb/TraceMongoCommandListener.java", "diffHunk": "@@ -61,11 +61,13 @@\n    * all callbacks happen on the same thread.\n    */\n   @Override public void commandStarted(CommandStartedEvent event) {\n+    String databaseName = event.getDatabaseName();\n+    if (\"admin\".equals(databaseName)) return; // don't trace commands like \"endSessions\"", "originalCommit": "8dc07ba393786e491b02a1122d080e0556f03f37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0NjY5Nw==", "url": "https://github.com/openzipkin/brave/pull/1253#discussion_r488446697", "bodyText": "same as our zipkin image, inlined and also lets us skip docker if we want.", "author": "codefromthecrypt", "createdAt": "2020-09-15T07:28:41Z", "path": "instrumentation/spring-rabbit/src/test/java/brave/spring/rabbit/ITSpringRabbit.java", "diffHunk": "@@ -61,14 +67,41 @@\n   static final String TEST_QUEUE_BATCH = \"test-queue-1\";\n   static final Exchange exchange_batch = topicExchange(\"test-exchange-1\").durable(true).build();\n   static final Queue queue_batch = new Queue(TEST_QUEUE_BATCH);\n-  static final Binding binding_batch = bind(queue_batch).to(exchange_batch).with(\"test.binding.1\").noargs();\n+  static final Binding binding_batch =\n+    bind(queue_batch).to(exchange_batch).with(\"test.binding.1\").noargs();\n+\n+  static final String IMAGE = \"rabbitmq:3.8-management-alpine\";\n+  static final int RABBIT_PORT = 5672;\n+\n+  static final class RabbitMQContainer extends GenericContainer<RabbitMQContainer> {", "originalCommit": "8dc07ba393786e491b02a1122d080e0556f03f37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0Njk4NQ==", "url": "https://github.com/openzipkin/brave/pull/1253#discussion_r488446985", "bodyText": "ordered lexicographical as tired of scanning", "author": "codefromthecrypt", "createdAt": "2020-09-15T07:29:10Z", "path": "pom.xml", "diffHunk": "@@ -82,55 +83,58 @@\n     <zipkin-reporter.version>2.15.2</zipkin-reporter.version>\n \n     <!-- Ensure older versions of spring still work -->\n-    <spring5.version>5.2.7.RELEASE</spring5.version>\n+    <spring5.version>5.2.8.RELEASE</spring5.version>\n     <spring.version>3.2.18.RELEASE</spring.version>\n \n     <!-- Apis used, but not in Jetty 7.6* imply duplication in servlet25 test fixtures -->\n     <!-- prefer sparkjava's jetty to reduce downloads -->\n     <jetty.version>9.4.30.v20200611</jetty.version>\n     <jetty-servlet25.version>7.6.21.v20160908</jetty-servlet25.version>\n     <!-- Note: 3.1.x requires Java 8; 3.0.20.Final is broken -->\n-    <resteasy.version>3.12.1.Final</resteasy.version>\n+    <resteasy.version>3.13.1.Final</resteasy.version>\n \n-    <kafka.version>2.5.0</kafka.version>\n-    <!-- must align with kafka version https://github.com/charithe/kafka-junit -->\n-    <kafka-junit.version>4.1.9</kafka-junit.version>\n+    <kafka.version>2.6.0</kafka.version>\n     <activemq.version>5.16.0</activemq.version>\n-    <spring-rabbit.version>2.2.8.RELEASE</spring-rabbit.version>\n+    <spring-rabbit.version>2.2.10.RELEASE</spring-rabbit.version>\n \n-    <finagle.version>20.6.0</finagle.version>\n+    <finagle.version>20.8.1</finagle.version>\n     <log4j.version>2.13.3</log4j.version>\n-    <okhttp.version>4.7.2</okhttp.version>\n+    <okhttp.version>4.9.0</okhttp.version>\n     <httpclient.version>4.5.12</httpclient.version>\n \n-    <grpc.version>1.30.2</grpc.version>\n+    <grpc.version>1.32.1</grpc.version>\n+    <protobuf.version>3.12.0</protobuf.version>\n     <!-- prefer grpc's version of netty -->\n-    <netty.version>4.1.48.Final</netty.version>\n+    <netty.version>4.1.51.Final</netty.version>\n \n     <sparkjava.version>2.9.2</sparkjava.version>\n+\n+    <!-- Test only dependencies -->\n     <junit.version>4.13</junit.version>\n-    <assertj.version>3.16.1</assertj.version>\n+    <assertj.version>3.17.2</assertj.version>\n     <powermock.version>2.0.7</powermock.version>\n-    <mockito.version>3.3.3</mockito.version>\n+    <mockito.version>3.5.10</mockito.version>\n     <jersey.version>2.31</jersey.version>\n-    <jmh.version>1.23</jmh.version>\n+    <!-- must align with kafka version https://github.com/charithe/kafka-junit -->\n+    <kafka-junit.version>4.1.10</kafka-junit.version>\n     <testcontainers.version>1.14.3</testcontainers.version>\n \n+    <animal-sniffer-maven-plugin.version>1.19</animal-sniffer-maven-plugin.version>", "originalCommit": "8dc07ba393786e491b02a1122d080e0556f03f37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyMDAyNQ==", "url": "https://github.com/openzipkin/brave/pull/1253#discussion_r490920025", "bodyText": "thanks!! \ud83d\ude4f\ud83c\udffd", "author": "jeqo", "createdAt": "2020-09-18T12:39:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0Njk4NQ=="}], "type": "inlineReview"}]}