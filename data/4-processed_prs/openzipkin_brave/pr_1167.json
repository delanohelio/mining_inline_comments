{"pr_number": 1167, "pr_title": "Deprecates Tracing.Builder.spanReporter", "pr_createdAt": "2020-04-20T11:22:23Z", "pr_url": "https://github.com/openzipkin/brave/pull/1167", "timeline": [{"oid": "8a81dfa2790a204eb1427273899d2cc48487e929", "url": "https://github.com/openzipkin/brave/commit/8a81dfa2790a204eb1427273899d2cc48487e929", "message": "Deprecates Tracing.Builder.spanReporter", "committedDate": "2020-05-08T11:26:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA5MTYzMg==", "url": "https://github.com/openzipkin/brave/pull/1167#discussion_r422091632", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Spans returned by a tracer report data to Zipkin when , or do\n          \n          \n            \n            Spans returned by a tracer report data to Zipkin when finished, or do", "author": "codefromthecrypt", "createdAt": "2020-05-08T11:29:13Z", "path": "brave/README.md", "diffHunk": "@@ -56,7 +59,7 @@ The tracer creates and joins spans that model the latency of potentially\n distributed work. It can employ sampling to reduce overhead in process\n or to reduce the amount of data sent to Zipkin.\n \n-Spans returned by a tracer report data to Zipkin when finished, or do\n+Spans returned by a tracer report data to Zipkin when , or do", "originalCommit": "2240618b35d47927e18171b4e08893067a1317cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "59f4f57583bb8d0c1ddf3eb41c199d56315b5e06", "url": "https://github.com/openzipkin/brave/commit/59f4f57583bb8d0c1ddf3eb41c199d56315b5e06", "message": "removes old span handler and deprecated ErrorParser", "committedDate": "2020-05-08T13:51:23Z", "type": "forcePushed"}, {"oid": "a0d52374cb3cb96155d95c40e4c9094c64a40fc7", "url": "https://github.com/openzipkin/brave/commit/a0d52374cb3cb96155d95c40e4c9094c64a40fc7", "message": "Deprecates Tracing.Builder.spanReporter\n\nthis is replaced by io.zipkin.reporter2:zipkin-reporter-brave", "committedDate": "2020-05-09T03:23:22Z", "type": "commit"}, {"oid": "a0d52374cb3cb96155d95c40e4c9094c64a40fc7", "url": "https://github.com/openzipkin/brave/commit/a0d52374cb3cb96155d95c40e4c9094c64a40fc7", "message": "Deprecates Tracing.Builder.spanReporter\n\nthis is replaced by io.zipkin.reporter2:zipkin-reporter-brave", "committedDate": "2020-05-09T03:23:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ0NzQwNw==", "url": "https://github.com/openzipkin/brave/pull/1167#discussion_r422447407", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ```\n          \n          \n            \n            ```java", "author": "codefromthecrypt", "createdAt": "2020-05-09T03:25:45Z", "path": "brave/README.md", "diffHunk": "@@ -590,6 +593,69 @@ customizer.customize(tracingBuilder);\n ```\n A span metrics example is [here](src/test/java/brave/features/handler/SpanMetricsCustomizer.java)\n \n+### Non-Zipkin Span Reporting example\n+<h3>Non-Zipkin Span Reporting example</h3>\n+When reporting to a Zipkin compatible collector, use [io.zipkin.reporter2:zipkin-reporter-brave](https://github.com/openzipkin/zipkin-reporter-java).\n+\n+The below example highlights notes for those sending data into a different\n+format. Notably, most trace systems only need data at the `end` hook.\n+\n+```java\n+public boolean end(TraceContext context, MutableSpan span, Cause cause) {\n+  // Return when a user intentionally called Span.abandon()\n+  if (cause == Cause.ABANDONED) return true;\n+  // Sampled means \"remote sampled\", e.g. to the tracing system.\n+  if (!Boolean.TRUE.equals(context.sampled())) return true;\n+\n+  // span.tags(\"error\") is only set when instrumentation sets it. If your\n+  // format requires span.tags(\"error\"), use Tags.ERROR when span.error()\n+  // is set, but span.tags(\"error\") is not. Some formats will look at the\n+  // stack trace instead.\n+  maybeAddErrorTag(context, span);\n+  MyFormat customFormat = convert(context, span);\n+  nonZipkinReporter.report(converted);\n+  return true;\n+}\n+```\n+\n+### Child Counting Example\n+Some data formats desire knowing how many spans a parent created. Below is an\n+example of how to do that, using [WeakConcurrentMap](https://github.com/raphw/weak-lock-free).\n+\n+```", "originalCommit": "a0d52374cb3cb96155d95c40e4c9094c64a40fc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "273e67ac9361a887f667c78e075dcf1f1d71bfb0", "url": "https://github.com/openzipkin/brave/commit/273e67ac9361a887f667c78e075dcf1f1d71bfb0", "message": "format", "committedDate": "2020-05-09T03:25:51Z", "type": "commit"}, {"oid": "72769b362f7809c16b90740f2790098205974294", "url": "https://github.com/openzipkin/brave/commit/72769b362f7809c16b90740f2790098205974294", "message": "polish up deprecation", "committedDate": "2020-05-09T04:11:36Z", "type": "commit"}]}