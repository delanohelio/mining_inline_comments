{"pr_number": 1438, "pr_title": "Prioritise cache response of course enrolments api", "pr_createdAt": "2020-07-15T09:56:56Z", "pr_url": "https://github.com/edx/edx-app-android/pull/1438", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3MDA3Nw==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456370077", "bodyText": "no need to initialize Null.", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T10:53:26Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3MTMyOQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456371329", "bodyText": "these lines of code should be in the background thread otherwise increase load time.", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T10:56:18Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE5ODUzNA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r457198534", "bodyText": "IMO we have to use the retrofit callback.", "author": "farhan-arshad-dev", "createdAt": "2020-07-20T09:02:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3MTMyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3MjI1Mg==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456372252", "bodyText": "better to display loadingIndicator before loading course data when getting cached data.", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T10:58:17Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3NjkzNQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456376935", "bodyText": "should cover all the scenarios as cover before. L#125", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T11:09:47Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {\n+                    setCourseData(new ArrayList<>(response.body()));\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment.getRouter().forceLogout(getContext(),\n+                            environment.getAnalyticsRegistry(),\n+                            environment.getNotificationDelegate());\n+                } else {\n+                    errorNotification.showError(getContext(), new HttpStatusException(\n+                            Response.error(HttpStatus.INTERNAL_SERVER_ERROR,\n+                                    ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))),\n+                            R.string.lbl_reload,\n+                            new View.OnClickListener() {\n+                                @Override\n+                                public void onClick(View v) {\n+                                    if (NetworkUtil.isConnected(getContext())) {\n+                                        onRefresh();\n+                                    }\n+                                }\n+                            });\n+                }\n+                binding.swipeContainer.setRefreshing(false);\n+                binding.loadingIndicator.getRoot().setVisibility(View.GONE);\n+\n+                if (!EventBus.getDefault().isRegistered(MyCoursesListFragment.this)) {\n+                    EventBus.getDefault().registerSticky(MyCoursesListFragment.this);\n+                }\n+            }\n+\n+            @Override\n+            public void onFailure(Call<List<EnrolledCoursesResponse>> call, Throwable t) {\n+                errorNotification.showError(getContext(), t.getCause(), R.string.lbl_reload,", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3NzgxMA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456377810", "bodyText": "IMO getEnrolledCourses is the more appropriate name here instated of apiCall", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T11:12:00Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3ODE4MQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456378181", "bodyText": "better to add @NotNull annotation with call and response params.", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T11:13:01Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM4MjY1Ng==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456382656", "bodyText": "IMO, we have to check response code 200, there is the min chance to get other response code, as isSuccessful Returns true if response code is in the range [200..300).", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T11:24:17Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM4NTI4Mw==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456385283", "bodyText": "better to replace with lambda notation.", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T11:30:58Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {\n+                    setCourseData(new ArrayList<>(response.body()));\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment.getRouter().forceLogout(getContext(),\n+                            environment.getAnalyticsRegistry(),\n+                            environment.getNotificationDelegate());\n+                } else {\n+                    errorNotification.showError(getContext(), new HttpStatusException(\n+                            Response.error(HttpStatus.INTERNAL_SERVER_ERROR,\n+                                    ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))),\n+                            R.string.lbl_reload,\n+                            new View.OnClickListener() {", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4OTIwNw==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456489207", "bodyText": "there should be more appropriate method name e.d populateCourseData.", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T14:46:49Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -110,70 +108,25 @@ public void onRefresh() {\n     @Override\n     public void onViewCreated(View view, Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n-        loadData(true);\n-    }\n-\n-    @Override\n-    public Loader<AsyncTaskResult<List<EnrolledCoursesResponse>>> onCreateLoader(int i, Bundle bundle) {\n-        return new CoursesAsyncLoader(getActivity());\n+        loadData(true, true);\n     }\n \n-    @Override\n-    public void onLoadFinished(Loader<AsyncTaskResult<List<EnrolledCoursesResponse>>> asyncTaskResultLoader, AsyncTaskResult<List<EnrolledCoursesResponse>> result) {\n-        adapter.clear();\n-        final Exception exception = result.getEx();\n-        if (exception != null) {\n-            if (exception instanceof AuthException) {\n-                loginPrefs.clear();\n-                getActivity().finish();\n-            } else if (exception instanceof HttpStatusException) {\n-                final HttpStatusException httpStatusException = (HttpStatusException) exception;\n-                switch (httpStatusException.getStatusCode()) {\n-                    case HttpStatus.UNAUTHORIZED: {\n-                        environment.getRouter().forceLogout(getContext(),\n-                                environment.getAnalyticsRegistry(),\n-                                environment.getNotificationDelegate());\n-                        break;\n-                    }\n-                }\n-            } else {\n-                logger.error(exception);\n-            }\n-\n-            errorNotification.showError(getActivity(), exception, R.string.lbl_reload,\n-                    new View.OnClickListener() {\n-                        @Override\n-                        public void onClick(View v) {\n-                            if (NetworkUtil.isConnected(getContext())) {\n-                                onRefresh();\n-                            }\n-                        }\n-                    });\n-        } else if (result.getResult() != null) {\n-            ArrayList<EnrolledCoursesResponse> newItems = new ArrayList<EnrolledCoursesResponse>(result.getResult());\n-\n-            updateDatabaseAfterDownload(newItems);\n-\n-            if (result.getResult().size() > 0) {\n-                adapter.setItems(newItems);\n-            }\n-            addFindCoursesFooter();\n-            adapter.notifyDataSetChanged();\n+    private void setCourseData(ArrayList<EnrolledCoursesResponse> data) {", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MDU4NQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456490585", "bodyText": "As these line of code is executed in any case pass/fail service response. Should cover in retrofit call fail/success too.", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T14:48:54Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -110,70 +108,25 @@ public void onRefresh() {\n     @Override\n     public void onViewCreated(View view, Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n-        loadData(true);\n-    }\n-\n-    @Override\n-    public Loader<AsyncTaskResult<List<EnrolledCoursesResponse>>> onCreateLoader(int i, Bundle bundle) {\n-        return new CoursesAsyncLoader(getActivity());\n+        loadData(true, true);\n     }\n \n-    @Override\n-    public void onLoadFinished(Loader<AsyncTaskResult<List<EnrolledCoursesResponse>>> asyncTaskResultLoader, AsyncTaskResult<List<EnrolledCoursesResponse>> result) {\n-        adapter.clear();\n-        final Exception exception = result.getEx();\n-        if (exception != null) {\n-            if (exception instanceof AuthException) {\n-                loginPrefs.clear();\n-                getActivity().finish();\n-            } else if (exception instanceof HttpStatusException) {\n-                final HttpStatusException httpStatusException = (HttpStatusException) exception;\n-                switch (httpStatusException.getStatusCode()) {\n-                    case HttpStatus.UNAUTHORIZED: {\n-                        environment.getRouter().forceLogout(getContext(),\n-                                environment.getAnalyticsRegistry(),\n-                                environment.getNotificationDelegate());\n-                        break;\n-                    }\n-                }\n-            } else {\n-                logger.error(exception);\n-            }\n-\n-            errorNotification.showError(getActivity(), exception, R.string.lbl_reload,\n-                    new View.OnClickListener() {\n-                        @Override\n-                        public void onClick(View v) {\n-                            if (NetworkUtil.isConnected(getContext())) {\n-                                onRefresh();\n-                            }\n-                        }\n-                    });\n-        } else if (result.getResult() != null) {\n-            ArrayList<EnrolledCoursesResponse> newItems = new ArrayList<EnrolledCoursesResponse>(result.getResult());\n-\n-            updateDatabaseAfterDownload(newItems);\n-\n-            if (result.getResult().size() > 0) {\n-                adapter.setItems(newItems);\n-            }\n-            addFindCoursesFooter();\n-            adapter.notifyDataSetChanged();\n+    private void setCourseData(ArrayList<EnrolledCoursesResponse> data) {\n+        updateDatabaseAfterDownload(data);\n \n-            if (adapter.isEmpty() && !ConfigUtil.Companion.isCourseDiscoveryEnabled(environment)) {\n-                errorNotification.showError(R.string.no_courses_to_display,\n-                        FontAwesomeIcons.fa_exclamation_circle, 0, null);\n-                binding.myCourseList.setVisibility(View.GONE);\n-            } else {\n-                binding.myCourseList.setVisibility(View.VISIBLE);\n-                errorNotification.hideError();\n-            }\n+        if (data.size() > 0) {\n+            adapter.setItems(data);\n         }\n-        binding.swipeContainer.setRefreshing(false);\n-        binding.loadingIndicator.getRoot().setVisibility(View.GONE);\n+        addFindCoursesFooter();\n+        adapter.notifyDataSetChanged();\n \n-        if (!EventBus.getDefault().isRegistered(MyCoursesListFragment.this)) {\n-            EventBus.getDefault().registerSticky(MyCoursesListFragment.this);", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MTQ5Nw==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456491497", "bodyText": "should create a common method to show the error message, as these lines of code also using in case of success.", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T14:50:12Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {\n+                    setCourseData(new ArrayList<>(response.body()));\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment.getRouter().forceLogout(getContext(),\n+                            environment.getAnalyticsRegistry(),\n+                            environment.getNotificationDelegate());\n+                } else {\n+                    errorNotification.showError(getContext(), new HttpStatusException(\n+                            Response.error(HttpStatus.INTERNAL_SERVER_ERROR,\n+                                    ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))),\n+                            R.string.lbl_reload,\n+                            new View.OnClickListener() {\n+                                @Override\n+                                public void onClick(View v) {\n+                                    if (NetworkUtil.isConnected(getContext())) {\n+                                        onRefresh();\n+                                    }\n+                                }\n+                            });\n+                }\n+                binding.swipeContainer.setRefreshing(false);\n+                binding.loadingIndicator.getRoot().setVisibility(View.GONE);\n+\n+                if (!EventBus.getDefault().isRegistered(MyCoursesListFragment.this)) {\n+                    EventBus.getDefault().registerSticky(MyCoursesListFragment.this);\n+                }\n+            }\n+\n+            @Override\n+            public void onFailure(Call<List<EnrolledCoursesResponse>> call, Throwable t) {\n+                errorNotification.showError(getContext(), t.getCause(), R.string.lbl_reload,\n+                        new View.OnClickListener() {\n+                            @Override\n+                            public void onClick(View v) {\n+                                if (NetworkUtil.isConnected(getContext())) {\n+                                    onRefresh();\n+                                }\n+                            }\n+                        });", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5NTgyNg==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456495826", "bodyText": "should place these line of code in onFailure case too.", "author": "farhan-arshad-dev", "createdAt": "2020-07-17T14:56:54Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {\n+                    setCourseData(new ArrayList<>(response.body()));\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment.getRouter().forceLogout(getContext(),\n+                            environment.getAnalyticsRegistry(),\n+                            environment.getNotificationDelegate());\n+                } else {\n+                    errorNotification.showError(getContext(), new HttpStatusException(\n+                            Response.error(HttpStatus.INTERNAL_SERVER_ERROR,\n+                                    ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))),\n+                            R.string.lbl_reload,\n+                            new View.OnClickListener() {\n+                                @Override\n+                                public void onClick(View v) {\n+                                    if (NetworkUtil.isConnected(getContext())) {\n+                                        onRefresh();\n+                                    }\n+                                }\n+                            });\n+                }\n+                binding.swipeContainer.setRefreshing(false);\n+                binding.loadingIndicator.getRoot().setVisibility(View.GONE);\n+\n+                if (!EventBus.getDefault().isRegistered(MyCoursesListFragment.this)) {\n+                    EventBus.getDefault().registerSticky(MyCoursesListFragment.this);\n+                }", "originalCommit": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzMjc2Nw==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458032767", "bodyText": "Need auto-format.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T11:42:00Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY2Mjk3MA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458662970", "bodyText": "pending", "author": "farhan-arshad-dev", "createdAt": "2020-07-22T09:32:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzMjc2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzNDI4MQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458034281", "bodyText": "Need to remove single lambda parameter declaration.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T11:44:54Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }\n+            }\n+        })\n+\n+    }\n+\n+    private fun addFindCoursesFooter() { // Validate footer is not already added.\n+        if (binding.myCourseList.footerViewsCount > 0) {\n+            return\n+        }\n+        if (isCourseDiscoveryEnabled(environment!!)) { // Add 'Find a Course' list item as a footer.\n+            val footer: PanelFindCourseBinding = DataBindingUtil.inflate(LayoutInflater.from(activity),\n+                    R.layout.panel_find_course, binding.myCourseList, false)\n+            binding.myCourseList.addFooterView(footer.root, null, false)\n+            footer.courseBtn.setOnClickListener { v: View? ->", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzNTYyNg==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458035626", "bodyText": "should avoid using !!.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T11:47:34Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzNTY3Mw==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458035673", "bodyText": "should avoid using !!.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T11:47:39Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzNjQ3OA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458036478", "bodyText": "should be nullable while removing !!.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T11:49:08Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzNDM5OA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458134398", "bodyText": "Should not call when populateCourseData from the cache.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T14:20:22Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1NDQxMg==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458254412", "bodyText": "The app should not handle the error codes in case of fetching data from the cache.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T17:06:51Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1NDcyMQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458254721", "bodyText": "The app should not handle the error codes in case of fetching data from the cache.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T17:07:18Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM1NjM0MA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458356340", "bodyText": "Are we sure while fetching data from cache we won't get any exception?", "author": "omerhabib26", "createdAt": "2020-07-21T20:06:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1NDcyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU3Mjg0NA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458572844", "bodyText": "When we get an exception while fetching data from the cache, the app should make the service call if get any error then app handle those exceptions.", "author": "farhan-arshad-dev", "createdAt": "2020-07-22T06:52:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1NDcyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1OTMyNg==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458259326", "bodyText": "IMO, App should make the server call on completion of the cache call.\n@miankhalid thoughts?", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T17:14:54Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM1Njk2NA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458356964", "bodyText": "In the start, I suggested this as well", "author": "omerhabib26", "createdAt": "2020-07-21T20:07:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1OTMyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU3MzkzMA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458573930", "bodyText": "@miankhalid thoughts?", "author": "farhan-arshad-dev", "createdAt": "2020-07-22T06:54:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1OTMyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3MjUwMQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458272501", "bodyText": "I think there is no need this TODO from now,  Should confirm before removing this TODO", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T17:36:42Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU3NDE0MQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458574141", "bodyText": "FYI @miankhalid", "author": "farhan-arshad-dev", "createdAt": "2020-07-22T06:55:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3MjUwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MTMwMw==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458581303", "bodyText": "If the TODO item is completed then yes, it makes sense to remove the TODO now.", "author": "miankhalid", "createdAt": "2020-07-22T07:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3MjUwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY2MzkyNw==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458663927", "bodyText": "pending", "author": "farhan-arshad-dev", "createdAt": "2020-07-22T09:34:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3MjUwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3ODE0MQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458278141", "bodyText": "IMO it's better to add lateinit with Inject labeled members.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T17:45:37Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDE3Mg==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458290172", "bodyText": "I think we have to add L54-L55 may be open edx community uses those lines of code?\n@miankhalid thoughts?", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T18:05:24Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY2MDA1NQ==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458660055", "bodyText": "not need to add.", "author": "farhan-arshad-dev", "createdAt": "2020-07-22T09:27:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDE3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NzczOA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458297738", "bodyText": "there should be a Ref for this inspiration.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T18:18:18Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY2Mzk3Ng==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458663976", "bodyText": "pending", "author": "farhan-arshad-dev", "createdAt": "2020-07-22T09:34:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NzczOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY5NTk3Ng==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458695976", "bodyText": "inspiration from BaseWebViewFragment.java L:173", "author": "omerhabib26", "createdAt": "2020-07-22T10:32:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NzczOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5OTMxOA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458299318", "bodyText": "comment should be in the next line.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T18:20:50Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }\n+            }\n+        })\n+\n+    }\n+\n+    private fun addFindCoursesFooter() { // Validate footer is not already added.", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5OTQ2Ng==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458299466", "bodyText": "comment should be in the next line.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T18:21:05Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }\n+            }\n+        })\n+\n+    }\n+\n+    private fun addFindCoursesFooter() { // Validate footer is not already added.\n+        if (binding.myCourseList.footerViewsCount > 0) {\n+            return\n+        }\n+        if (isCourseDiscoveryEnabled(environment!!)) { // Add 'Find a Course' list item as a footer.", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMDExNg==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458300116", "bodyText": "comment should be in the next line.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T18:22:17Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMDE1NA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458300154", "bodyText": "comment should be in the next line.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T18:22:22Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMDIwNA==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458300204", "bodyText": "comment should be in the next line.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T18:22:26Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMjUwMw==", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458302503", "bodyText": "comment should be in the next line.", "author": "farhan-arshad-dev", "createdAt": "2020-07-21T18:26:28Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }\n+            }\n+        })\n+\n+    }\n+\n+    private fun addFindCoursesFooter() { // Validate footer is not already added.\n+        if (binding.myCourseList.footerViewsCount > 0) {\n+            return\n+        }\n+        if (isCourseDiscoveryEnabled(environment!!)) { // Add 'Find a Course' list item as a footer.\n+            val footer: PanelFindCourseBinding = DataBindingUtil.inflate(LayoutInflater.from(activity),\n+                    R.layout.panel_find_course, binding.myCourseList, false)\n+            binding.myCourseList.addFooterView(footer.root, null, false)\n+            footer.courseBtn.setOnClickListener { v: View? ->\n+                environment?.analyticsRegistry?.trackUserFindsCourses()\n+                EventBus.getDefault().post(MoveToDiscoveryTabEvent(Screen.COURSE_DISCOVERY))\n+            }\n+        }\n+        // Add empty view to cause divider to render at the bottom of the list.\n+        binding.myCourseList.addFooterView(View(context), null, false)\n+    }\n+\n+    override fun onRefresh() {\n+        EventBus.getDefault().post(MainDashboardRefreshEvent())\n+    }\n+\n+    fun onEvent(event: MainDashboardRefreshEvent?) {\n+        loadData(showProgress = true, isCached = false)\n+    }\n+\n+    override fun onRevisit() {\n+        super.onRevisit()\n+        if (NetworkUtil.isConnected(activity)) {\n+            binding.swipeContainer.isEnabled = true\n+        }\n+    }\n+\n+    fun onEvent(event: NetworkConnectivityChangeEvent?) {\n+        if (activity != null) {\n+            if (NetworkUtil.isConnected(context)) {\n+                binding.swipeContainer.isEnabled = true\n+            } else { //Disable swipe functionality and hide the loading view", "originalCommit": "cb391aa762efb5db818e222477781fe218d8960e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d448916df86d6e349b8f68066f9c4cc628e39eed", "url": "https://github.com/edx/edx-app-android/commit/d448916df86d6e349b8f68066f9c4cc628e39eed", "message": "Prioritise cache response of course enrolments api\n-LEARNER-7778\n-Remove AsynLoader Class\n-Convert MyCourseListFragment into kotlin\n-Improve line of codes\n-Prioritise cache response over server call", "committedDate": "2020-07-22T12:30:15Z", "type": "commit"}, {"oid": "d448916df86d6e349b8f68066f9c4cc628e39eed", "url": "https://github.com/edx/edx-app-android/commit/d448916df86d6e349b8f68066f9c4cc628e39eed", "message": "Prioritise cache response of course enrolments api\n-LEARNER-7778\n-Remove AsynLoader Class\n-Convert MyCourseListFragment into kotlin\n-Improve line of codes\n-Prioritise cache response over server call", "committedDate": "2020-07-22T12:30:15Z", "type": "forcePushed"}]}