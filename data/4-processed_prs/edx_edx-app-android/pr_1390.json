{"pr_number": 1390, "pr_title": "Add Microsoft Authentication to Mobile Login / Registration.", "pr_createdAt": "2020-03-27T10:37:40Z", "pr_url": "https://github.com/edx/edx-app-android/pull/1390", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyNzk1OA==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407427958", "bodyText": "Why are we using an old version? and also a + instead of a fully resolved version?\np.s. the latest version according to docs is: implementation 'com.microsoft.identity.client:msal:1.+'", "author": "miankhalid", "createdAt": "2020-04-13T11:00:50Z", "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -149,6 +149,7 @@ dependencies {\n     implementation 'com.google.android.gms:play-services-cast-framework:16.2.0'\n \n     implementation 'com.facebook.android:facebook-login:5.9.0'\n+    implementation 'com.microsoft.identity.client:msal:0.3+'", "originalCommit": "b95a94bdc0053c5ddb1495b76dccd637d534183b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2MDA3Mg==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r409460072", "bodyText": "We need to change the implementation to move to the latest version of  client:msal.", "author": "farhan-arshad-dev", "createdAt": "2020-04-16T10:44:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyNzk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA1NTExMA==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r410055110", "bodyText": "Ok, I would suggest creating a ticket for the up gradation then.", "author": "miankhalid", "createdAt": "2020-04-17T07:56:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyNzk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMzMTQ4NQ==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r410331485", "bodyText": "Ticket has been created LEARNER-7712", "author": "farhan-arshad-dev", "createdAt": "2020-04-17T16:22:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyNzk1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyODgyNA==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407428824", "bodyText": "This comment should be above this line:\n// Apply the Performance Monitoring plugin to enable instrumentation", "author": "miankhalid", "createdAt": "2020-04-13T11:03:38Z", "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -259,6 +260,13 @@ def firebaseEnabled = firebaseConfig?.get('ENABLED')\n if (firebaseEnabled ?: false) {\n     apply plugin: 'com.google.gms.google-services'\n     // Apply the Performance Monitoring plugin to enable instrumentation\n+    // Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n+    // with message \"In project '*' a resolved Google Play services library dependency depends on\n+    // another at an exact version (e.g. [1.3.1 ,2.3]).\" so ad below statement to resolve build issue.\n+    // Ref: https://stackoverflow.com/a/57479692\n+    googleServices {\n+        disableVersionCheck = true\n+    }\n     apply plugin: 'com.google.firebase.firebase-perf'", "originalCommit": "b95a94bdc0053c5ddb1495b76dccd637d534183b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2MjM3MA==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r409462370", "bodyText": "Done.", "author": "farhan-arshad-dev", "createdAt": "2020-04-16T10:48:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyODgyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyOTc4OQ==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407429789", "bodyText": "I would suggest we use a block comment here instead of multi-line comments.\nnit:\n, so adding the following statement to resolve the build issue.\ninstead of\n so ad below statement to resolve build issue.", "author": "miankhalid", "createdAt": "2020-04-13T11:06:58Z", "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -259,6 +260,13 @@ def firebaseEnabled = firebaseConfig?.get('ENABLED')\n if (firebaseEnabled ?: false) {\n     apply plugin: 'com.google.gms.google-services'\n     // Apply the Performance Monitoring plugin to enable instrumentation\n+    // Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n+    // with message \"In project '*' a resolved Google Play services library dependency depends on\n+    // another at an exact version (e.g. [1.3.1 ,2.3]).\" so ad below statement to resolve build issue.\n+    // Ref: https://stackoverflow.com/a/57479692", "originalCommit": "b95a94bdc0053c5ddb1495b76dccd637d534183b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzMDA5NQ==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407430095", "bodyText": "Also, did you try updating com.google.gms:google-services to version 4.3.3 instead?\np.s. this is also mentioned as a solution in the SO link you've added in the comment.", "author": "miankhalid", "createdAt": "2020-04-13T11:08:03Z", "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -259,6 +260,13 @@ def firebaseEnabled = firebaseConfig?.get('ENABLED')\n if (firebaseEnabled ?: false) {\n     apply plugin: 'com.google.gms.google-services'\n     // Apply the Performance Monitoring plugin to enable instrumentation\n+    // Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n+    // with message \"In project '*' a resolved Google Play services library dependency depends on\n+    // another at an exact version (e.g. [1.3.1 ,2.3]).\" so ad below statement to resolve build issue.\n+    // Ref: https://stackoverflow.com/a/57479692\n+    googleServices {\n+        disableVersionCheck = true\n+    }", "originalCommit": "b95a94bdc0053c5ddb1495b76dccd637d534183b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NTMwMA==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r409465300", "bodyText": "Still unable to build after upgrading the com.google.gms:google-services to version 4.3.3.", "author": "farhan-arshad-dev", "createdAt": "2020-04-16T10:54:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzMDA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzNzcwOA==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407437708", "bodyText": "The task that generates auth_config.json for the config and executes for the Microsoft authentication", "author": "miankhalid", "createdAt": "2020-04-13T11:32:50Z", "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -510,6 +521,22 @@ android.applicationVariants.all { variant ->\n         tasks.getByName(googleServicesJsonValidationTask).dependsOn(serviceJsonTask)\n     }\n \n+    // Task that generate auth_config.json for the config and execute for the Microsoft authentication", "originalCommit": "d8747deea9ef5a79fd9d78ba87238e430542d68c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2Nzc3Mg==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r409467772", "bodyText": "Done.", "author": "farhan-arshad-dev", "createdAt": "2020-04-16T10:58:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzNzcwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzODM5MA==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407438390", "bodyText": "java.net.URLEncoder is an unnecessary qualified reference, you can just use URLEncoder.encode instead.", "author": "miankhalid", "createdAt": "2020-04-13T11:35:12Z", "path": "OpenEdXMobile/gradle_scripts/AndroidHelper.gradle", "diffHunk": "@@ -99,6 +99,65 @@ class AndroidHelper {\n         }\n         return available\n     }\n+\n+    static def saveMicrosoftAuthConfigs(project, microsoftConfig) {\n+        def microsoftConfigsJsonPath = project.projectDir.toString() + \"/res/raw/auth_config.json\"\n+        new FileWriter(microsoftConfigsJsonPath).withWriter {\n+            getMicrosoftConfigurations(project, microsoftConfig).writeTo(it)\n+        }\n+    }\n+\n+    static def getMicrosoftConfigurations(project, microsoftConfig) {\n+        if (isValidConfigurations(microsoftConfig)) {\n+            def jsonBuilder = new JsonBuilder()\n+            def clientId = microsoftConfig.get(\"CLIENT_ID\")\n+            def signatureHash = microsoftConfig.get(\"SIGNATURE_HASH\")\n+            def audienceType = microsoftConfig.get(\"AUDIENCE_TYPE\")\n+            def tenantId = microsoftConfig.get(\"TENANT_ID\")\n+            jsonBuilder {\n+                \"client_id\" \"$clientId\"\n+                \"authorization_user_agent\" \"DEFAULT\"\n+                \"redirect_uri\" \"msauth://\" + project.APPLICATION_ID + \"/\" + java.net.URLEncoder.encode(signatureHash, \"UTF-8\")", "originalCommit": "d8747deea9ef5a79fd9d78ba87238e430542d68c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ2NzgxNA==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r409467814", "bodyText": "Done.", "author": "farhan-arshad-dev", "createdAt": "2020-04-16T10:58:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzODM5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzODk5Ng==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407438996", "bodyText": "why was this logic changed? previous logic seems fine to me", "author": "miankhalid", "createdAt": "2020-04-13T11:37:30Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/LoginActivity.java", "diffHunk": "@@ -145,12 +146,16 @@ public void setSocialLoginButtons(boolean googleEnabled, boolean facebookEnabled\n                                               boolean microsoftEnabled) {\n                 if (!facebookEnabled && !googleEnabled && !microsoftEnabled) {\n                     activityLoginBinding.panelLoginSocial.setVisibility(View.GONE);\n-                } else if (!facebookEnabled) {\n-                    activityLoginBinding.socialAuth.facebookButton.getRoot().setVisibility(View.GONE);\n-                } else if (!googleEnabled) {\n-                    activityLoginBinding.socialAuth.googleButton.getRoot().setVisibility(View.GONE);\n-                } else if (!microsoftEnabled) {\n-                    activityLoginBinding.socialAuth.microsoftButton.getRoot().setVisibility(View.GONE);\n+                } else {", "originalCommit": "8ba526d8fd65953090b85dc8e819ffc649e0161b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ3MTkwNQ==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r409471905", "bodyText": "if Facebook and google are disabled, but this logic only hides facebook, not the google button.", "author": "farhan-arshad-dev", "createdAt": "2020-04-16T11:06:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzODk5Ng=="}], "type": "inlineReview"}, {"oid": "bd9c825d91be5fb4b1b20a8285bf43beb687fb8b", "url": "https://github.com/edx/edx-app-android/commit/bd9c825d91be5fb4b1b20a8285bf43beb687fb8b", "message": "Add Microsoft Authentication to Mobile Login/Registration\n- LEARNER-3877", "committedDate": "2020-04-16T05:39:08Z", "type": "commit"}, {"oid": "5c0f2eb5c36c00f6230a2f09f426892495bdda8b", "url": "https://github.com/edx/edx-app-android/commit/5c0f2eb5c36c00f6230a2f09f426892495bdda8b", "message": "Fix button cutting issue", "committedDate": "2020-04-16T05:39:57Z", "type": "forcePushed"}, {"oid": "ae06649bcfbecdf86fd0fd6866105eb8aa3e00f4", "url": "https://github.com/edx/edx-app-android/commit/ae06649bcfbecdf86fd0fd6866105eb8aa3e00f4", "message": "Address PR comments", "committedDate": "2020-04-16T11:17:13Z", "type": "forcePushed"}, {"oid": "ab120e1e74d2a922965ab40e064af6215abd7f3d", "url": "https://github.com/edx/edx-app-android/commit/ab120e1e74d2a922965ab40e064af6215abd7f3d", "message": "Address PR comments", "committedDate": "2020-04-16T11:22:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA4NTgwNA==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r410085804", "bodyText": "This needs to be a block comment like:\n    /*\n     * Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n     * another at an exact version (e.g. [1.3.1 ,2.3]).\", so adding the following statement to\n     * resolve the build issue.\n     * Ref: https://stackoverflow.com/a/57479692\n     */", "author": "miankhalid", "createdAt": "2020-04-17T08:53:56Z", "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -259,14 +259,15 @@ def firebaseConfig = config.get('FIREBASE')\n def firebaseEnabled = firebaseConfig?.get('ENABLED')\n if (firebaseEnabled ?: false) {\n     apply plugin: 'com.google.gms.google-services'\n-    // Apply the Performance Monitoring plugin to enable instrumentation\n     // Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n     // with message \"In project '*' a resolved Google Play services library dependency depends on\n-    // another at an exact version (e.g. [1.3.1 ,2.3]).\" so ad below statement to resolve build issue.\n+    // another at an exact version (e.g. [1.3.1 ,2.3]).\", so adding the following statement to\n+    // resolve the build issue.\n     // Ref: https://stackoverflow.com/a/57479692", "originalCommit": "ab120e1e74d2a922965ab40e064af6215abd7f3d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEzOTU4NQ==", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r410139585", "bodyText": "Updated.", "author": "farhan-arshad-dev", "createdAt": "2020-04-17T10:36:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA4NTgwNA=="}], "type": "inlineReview"}, {"oid": "5bdbc13a778fe807c965cb783196092afc84fa5e", "url": "https://github.com/edx/edx-app-android/commit/5bdbc13a778fe807c965cb783196092afc84fa5e", "message": "Add gradle script to create auth_config.json\n- Test case fix that leads the travic-ci build failed.", "committedDate": "2020-04-17T10:27:35Z", "type": "commit"}, {"oid": "5bdbc13a778fe807c965cb783196092afc84fa5e", "url": "https://github.com/edx/edx-app-android/commit/5bdbc13a778fe807c965cb783196092afc84fa5e", "message": "Add gradle script to create auth_config.json\n- Test case fix that leads the travic-ci build failed.", "committedDate": "2020-04-17T10:27:35Z", "type": "forcePushed"}]}