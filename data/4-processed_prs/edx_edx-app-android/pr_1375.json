{"pr_number": 1375, "pr_title": "Move firebase keys from json to config file", "pr_createdAt": "2020-02-21T11:40:25Z", "pr_url": "https://github.com/edx/edx-app-android/pull/1375", "timeline": [{"oid": "f835b9f7da808418f5ffe06fa479e8ce418693fa", "url": "https://github.com/edx/edx-app-android/commit/f835b9f7da808418f5ffe06fa479e8ce418693fa", "message": "Move firebase keys from json to config file\n\n- LEARNER-7585.\n- Move google-services.json content to configs.\n- Generate google-services.json file using the\n  configs at build time at the time of build\n  before the keys validation task firebase.", "committedDate": "2020-02-26T10:48:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyODg4Mg==", "url": "https://github.com/edx/edx-app-android/pull/1375#discussion_r388128882", "bodyText": "We should avoid the package_name hard coding.", "author": "farhan", "createdAt": "2020-03-05T08:00:44Z", "path": "OpenEdXMobile/gradle_scripts/AndroidHelper.gradle", "diffHunk": "@@ -0,0 +1,117 @@\n+import groovy.json.JsonBuilder\n+\n+class AndroidHelper {\n+\n+    static def saveProcessedConfig(project, config) {\n+        def path = project.file(\"assets/config\")\n+        path.mkdirs()\n+        def jsonWriter = new FileWriter(path.absolutePath + \"/config.json\")\n+        def builder = new JsonBuilder(config)\n+        jsonWriter.withWriter {\n+            builder.writeTo(it)\n+        }\n+    }\n+\n+    static def saveGoogleServiceJson(project, firebaseConfig) {\n+        def googleServiceJsonPath = project.projectDir.toString() + \"/google-services.json\"\n+        new FileWriter(googleServiceJsonPath).withWriter {\n+            getGoogleServicesContent(firebaseConfig).writeTo(it)\n+        }\n+    }\n+\n+    static def getGoogleServicesContent(firebaseConfig) {\n+        if (checkRequiredFields(firebaseConfig)) {\n+            def jsonBuilder = new JsonBuilder()\n+            def projectNumber = firebaseConfig.get(\"PROJECT_NUMBER\")\n+            def projectId = firebaseConfig.get(\"PROJECT_ID\")\n+            def oauthClientId = firebaseConfig.get(\"OAUTH_CLIENT_ID\")\n+            def currentKey = firebaseConfig.get(\"CURRENT_KEY\")\n+            def otherPlatformOauthClientId = firebaseConfig.get(\"OTHER_PLATFORM_OAUTH_CLIENT_ID\")\n+            def appStoreId = firebaseConfig.get(\"APP_STORE_ID\")\n+            // construct the google-services.json fields\n+            jsonBuilder {\n+                project_info {\n+                    project_number projectNumber\n+                    firebase_url \"https://$projectId\" + \".firebaseio.com\"\n+                    project_id projectId\n+                    storage_bucket projectId + \".appspot.com\"\n+                }\n+                client([{\n+                            client_info {\n+                                \"mobilesdk_app_id\" \"1:$projectNumber:android:c04089bb49270266\"\n+                                \"android_client_info\" {\n+                                    \"package_name\" \"org.edx.mobile\"", "originalCommit": "f835b9f7da808418f5ffe06fa479e8ce418693fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0Mjk3MQ==", "url": "https://github.com/edx/edx-app-android/pull/1375#discussion_r388242971", "bodyText": "done.", "author": "farhan-arshad-dev", "createdAt": "2020-03-05T11:45:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyODg4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyOTMzNg==", "url": "https://github.com/edx/edx-app-android/pull/1375#discussion_r388129336", "bodyText": "We should avoid the mobilesdk_app_id value hard coding", "author": "farhan", "createdAt": "2020-03-05T08:01:50Z", "path": "OpenEdXMobile/gradle_scripts/AndroidHelper.gradle", "diffHunk": "@@ -0,0 +1,117 @@\n+import groovy.json.JsonBuilder\n+\n+class AndroidHelper {\n+\n+    static def saveProcessedConfig(project, config) {\n+        def path = project.file(\"assets/config\")\n+        path.mkdirs()\n+        def jsonWriter = new FileWriter(path.absolutePath + \"/config.json\")\n+        def builder = new JsonBuilder(config)\n+        jsonWriter.withWriter {\n+            builder.writeTo(it)\n+        }\n+    }\n+\n+    static def saveGoogleServiceJson(project, firebaseConfig) {\n+        def googleServiceJsonPath = project.projectDir.toString() + \"/google-services.json\"\n+        new FileWriter(googleServiceJsonPath).withWriter {\n+            getGoogleServicesContent(firebaseConfig).writeTo(it)\n+        }\n+    }\n+\n+    static def getGoogleServicesContent(firebaseConfig) {\n+        if (checkRequiredFields(firebaseConfig)) {\n+            def jsonBuilder = new JsonBuilder()\n+            def projectNumber = firebaseConfig.get(\"PROJECT_NUMBER\")\n+            def projectId = firebaseConfig.get(\"PROJECT_ID\")\n+            def oauthClientId = firebaseConfig.get(\"OAUTH_CLIENT_ID\")\n+            def currentKey = firebaseConfig.get(\"CURRENT_KEY\")\n+            def otherPlatformOauthClientId = firebaseConfig.get(\"OTHER_PLATFORM_OAUTH_CLIENT_ID\")\n+            def appStoreId = firebaseConfig.get(\"APP_STORE_ID\")\n+            // construct the google-services.json fields\n+            jsonBuilder {\n+                project_info {\n+                    project_number projectNumber\n+                    firebase_url \"https://$projectId\" + \".firebaseio.com\"\n+                    project_id projectId\n+                    storage_bucket projectId + \".appspot.com\"\n+                }\n+                client([{\n+                            client_info {\n+                                \"mobilesdk_app_id\" \"1:$projectNumber:android:c04089bb49270266\"", "originalCommit": "f835b9f7da808418f5ffe06fa479e8ce418693fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0MzAxMg==", "url": "https://github.com/edx/edx-app-android/pull/1375#discussion_r388243012", "bodyText": "done.", "author": "farhan-arshad-dev", "createdAt": "2020-03-05T11:45:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyOTMzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEzMjgxMA==", "url": "https://github.com/edx/edx-app-android/pull/1375#discussion_r388132810", "bodyText": "Let's put the minimum possible values required for our features.\nTry avoiding the info specially iOS-specific info and check if we can minimize the fields.", "author": "farhan", "createdAt": "2020-03-05T08:10:44Z", "path": "OpenEdXMobile/gradle_scripts/AndroidHelper.gradle", "diffHunk": "@@ -0,0 +1,117 @@\n+import groovy.json.JsonBuilder\n+\n+class AndroidHelper {\n+\n+    static def saveProcessedConfig(project, config) {\n+        def path = project.file(\"assets/config\")\n+        path.mkdirs()\n+        def jsonWriter = new FileWriter(path.absolutePath + \"/config.json\")\n+        def builder = new JsonBuilder(config)\n+        jsonWriter.withWriter {\n+            builder.writeTo(it)\n+        }\n+    }\n+\n+    static def saveGoogleServiceJson(project, firebaseConfig) {\n+        def googleServiceJsonPath = project.projectDir.toString() + \"/google-services.json\"\n+        new FileWriter(googleServiceJsonPath).withWriter {\n+            getGoogleServicesContent(firebaseConfig).writeTo(it)\n+        }\n+    }\n+\n+    static def getGoogleServicesContent(firebaseConfig) {\n+        if (checkRequiredFields(firebaseConfig)) {\n+            def jsonBuilder = new JsonBuilder()\n+            def projectNumber = firebaseConfig.get(\"PROJECT_NUMBER\")\n+            def projectId = firebaseConfig.get(\"PROJECT_ID\")\n+            def oauthClientId = firebaseConfig.get(\"OAUTH_CLIENT_ID\")\n+            def currentKey = firebaseConfig.get(\"CURRENT_KEY\")\n+            def otherPlatformOauthClientId = firebaseConfig.get(\"OTHER_PLATFORM_OAUTH_CLIENT_ID\")\n+            def appStoreId = firebaseConfig.get(\"APP_STORE_ID\")\n+            // construct the google-services.json fields\n+            jsonBuilder {\n+                project_info {\n+                    project_number projectNumber\n+                    firebase_url \"https://$projectId\" + \".firebaseio.com\"\n+                    project_id projectId\n+                    storage_bucket projectId + \".appspot.com\"\n+                }\n+                client([{\n+                            client_info {\n+                                \"mobilesdk_app_id\" \"1:$projectNumber:android:c04089bb49270266\"\n+                                \"android_client_info\" {\n+                                    \"package_name\" \"org.edx.mobile\"\n+                                }\n+                            }\n+                            oauth_client([\n+                                    {\n+                                        \"client_id\" oauthClientId\n+                                        \"client_type\" 3\n+                                    }\n+                            ])\n+                            api_key(\n+                                    [{\n+                                         \"current_key\" currentKey\n+                                     }])\n+                            services {", "originalCommit": "f835b9f7da808418f5ffe06fa479e8ce418693fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0MzA0NA==", "url": "https://github.com/edx/edx-app-android/pull/1375#discussion_r388243044", "bodyText": "We can remove the code to create the services field for the google-services.json, otherwise produce some issues while emitting the analytics event.", "author": "farhan-arshad-dev", "createdAt": "2020-03-05T11:45:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEzMjgxMA=="}], "type": "inlineReview"}, {"oid": "fbf23722e09e5974a803709eaebad7d719dbc690", "url": "https://github.com/edx/edx-app-android/commit/fbf23722e09e5974a803709eaebad7d719dbc690", "message": "Remove extra key related to the iOS", "committedDate": "2020-03-06T09:29:12Z", "type": "forcePushed"}, {"oid": "4e5c31d7bdacb3e9e974e635e2fcbf39115477ef", "url": "https://github.com/edx/edx-app-android/commit/4e5c31d7bdacb3e9e974e635e2fcbf39115477ef", "message": "Move firebase keys from json to config file\n\n- LEARNER-7585.\n- Move google-services.json content to configs.\n- Generate google-services.json file using the\n  configs at build time at the time of build\n  before the keys validation task firebase.", "committedDate": "2020-03-06T12:29:59Z", "type": "commit"}, {"oid": "ab308c2b57d2f85d68269126ec9f10afbd34bc91", "url": "https://github.com/edx/edx-app-android/commit/ab308c2b57d2f85d68269126ec9f10afbd34bc91", "message": "Update README.md for firebase configurations", "committedDate": "2020-03-06T12:37:51Z", "type": "commit"}, {"oid": "ab308c2b57d2f85d68269126ec9f10afbd34bc91", "url": "https://github.com/edx/edx-app-android/commit/ab308c2b57d2f85d68269126ec9f10afbd34bc91", "message": "Update README.md for firebase configurations", "committedDate": "2020-03-06T12:37:51Z", "type": "forcePushed"}]}