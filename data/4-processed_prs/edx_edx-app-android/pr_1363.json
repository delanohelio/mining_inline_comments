{"pr_number": 1363, "pr_title": "Update mobile payment banner functionality", "pr_createdAt": "2020-01-15T11:02:07Z", "pr_url": "https://github.com/edx/edx-app-android/pull/1363", "timeline": [{"oid": "3622173e307a00ac9e0e8255beaeaba9cb51cc86", "url": "https://github.com/edx/edx-app-android/commit/3622173e307a00ac9e0e8255beaeaba9cb51cc86", "message": "Enhance feature based content locking and payment banner experience.\n\n- LEARNER-7549\n- LEARNER-7602", "committedDate": "2020-01-18T08:54:37Z", "type": "forcePushed"}, {"oid": "d5a6030e61bfa3066a5b1ed51cdfe8d420e5f203", "url": "https://github.com/edx/edx-app-android/commit/d5a6030e61bfa3066a5b1ed51cdfe8d420e5f203", "message": "Enhance feature based content locking and payment banner experience.\n\n- LEARNER-7549\n- LEARNER-7602", "committedDate": "2020-01-18T09:17:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1NTIwMw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r371655203", "bodyText": "this event is triggered only to send the course data to the course navigation screen. am I right?", "author": "farhan-arshad-dev", "createdAt": "2020-01-28T08:11:19Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -595,21 +591,19 @@ public void onResponse(Call<CourseUpgradeResponse> call, Response<CourseUpgradeR\n                     if (getActivity() != null) {\n                         // Set the revenue cookie\n                         EdxCookieManager.getSharedInstance(getActivity()).setMobileCookie();\n-                        final CourseUpgradeResponse courseUpgradeResponse = response.body();\n-                        if (courseUpgradeResponse != null && courseUpgradeResponse.showUpsell()\n-                                && !TextUtils.isEmpty(courseUpgradeResponse.getBasketUrl())) {\n-                            viewUpgradeToVerifiedFooter.setVisibility(View.VISIBLE);\n-                            if (!TextUtils.isEmpty(courseUpgradeResponse.getPrice())) {\n-                                tvUpgradePrice.setText(courseUpgradeResponse.getPrice());\n-                            } else {\n-                                tvUpgradePrice.setVisibility(View.GONE);\n-                            }\n-                            btnUpgradeCourse.setOnClickListener(view ->\n-                                    environment.getRouter().showCourseUpgradeWebViewActivity(\n-                                            getActivity(), courseUpgradeResponse.getBasketUrl()\n-                                    ));\n+                        courseUpgradeData = response.body();\n+                        if (courseUpgradeData != null && courseUpgradeData.showUpsell()\n+                                && !TextUtils.isEmpty(courseUpgradeData.getBasketUrl())) {\n+                            PaymentsBannerFragment.Companion.loadPaymentsBannerFragment(\n+                                    R.id.fragment_container, courseData, null,\n+                                    courseUpgradeData, true, getChildFragmentManager(), true);\n+                            EventBus.getDefault().postSticky(new CourseUpgradeDataReceivedEvent(", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1OTQwNA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r371659404", "bodyText": "This should be triggered before the if condition after Line# 594 because it's a sticky event, and should be trigger again after performing payment.", "author": "farhan-arshad-dev", "createdAt": "2020-01-28T08:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1NTIwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIzNjE2MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372236161", "bodyText": "this line of code deserves java doc, we need to trigger the event.", "author": "farhan-arshad-dev", "createdAt": "2020-01-29T08:04:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1NTIwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIzNzc3Ng==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372237776", "bodyText": "there is no need to trigger this event in a case when the app gets the response before moving to the other screen. otherwise, a particular fragment/activity will get the data twice.", "author": "farhan-arshad-dev", "createdAt": "2020-01-29T08:09:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1NTIwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM0NjU4Mw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373346583", "bodyText": "fixed!", "author": "farhan", "createdAt": "2020-01-31T07:31:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1NTIwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2OTEzMQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r371669131", "bodyText": "After receiving the Sticky event that should be removed.", "author": "farhan-arshad-dev", "createdAt": "2020-01-28T08:47:33Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/LockedCourseUnitFragment.kt", "diffHunk": "@@ -0,0 +1,77 @@\n+package org.edx.mobile.view\n+\n+import android.databinding.DataBindingUtil\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import com.google.inject.Inject\n+import de.greenrobot.event.EventBus\n+import org.edx.mobile.R\n+import org.edx.mobile.databinding.FragmentLockedCourseUnitBinding\n+import org.edx.mobile.event.CourseUpgradeDataReceivedEvent\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.model.course.CourseComponent\n+import org.edx.mobile.module.analytics.Analytics\n+import org.edx.mobile.module.analytics.AnalyticsRegistry\n+\n+class LockedCourseUnitFragment : CourseUnitFragment() {\n+    @Inject\n+    var analyticsRegistry: AnalyticsRegistry? = null\n+\n+    companion object {\n+        @JvmStatic\n+        fun newInstance(unit: CourseComponent,\n+                        courseData: EnrolledCoursesResponse,\n+                        courseUpgradeData: CourseUpgradeResponse?): LockedCourseUnitFragment {\n+            val fragment = LockedCourseUnitFragment()\n+            val bundle = Bundle()\n+            bundle.putSerializable(Router.EXTRA_COURSE_UNIT, unit)\n+            bundle.putSerializable(Router.EXTRA_COURSE_DATA, courseData)\n+            courseUpgradeData?.let {\n+                bundle.putSerializable(Router.EXTRA_COURSE_UPGRADE_DATA, courseUpgradeData)\n+            }\n+            fragment.arguments = bundle\n+            return fragment\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        val binding: FragmentLockedCourseUnitBinding =\n+                DataBindingUtil.inflate(inflater, R.layout.fragment_locked_course_unit, container, false)\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        val courseUpgradeData = arguments?.getSerializable(Router.EXTRA_COURSE_UPGRADE_DATA)\n+        if (courseUpgradeData != null) {\n+            val courseData = arguments?.getSerializable(Router.EXTRA_COURSE_DATA) as EnrolledCoursesResponse\n+            loadPaymentBannerFragment(courseData, courseUpgradeData as CourseUpgradeResponse)\n+        }\n+        if (!EventBus.getDefault().isRegistered(this)) {\n+            EventBus.getDefault().registerSticky(this)\n+        }\n+        analyticsRegistry?.trackScreenView(Analytics.Screens.COURSE_UNIT_LOCKED)\n+    }\n+\n+    fun onEvent(event: CourseUpgradeDataReceivedEvent) {\n+        val courseData = arguments?.getSerializable(Router.EXTRA_COURSE_DATA) as EnrolledCoursesResponse", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM0ODgzOA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373348838", "bodyText": "done!", "author": "farhan", "createdAt": "2020-01-31T07:40:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2OTEzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTcxMTk2Nw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r371711967", "bodyText": "IMO, we have to use the Parcelalbe introduce in android instated of.", "author": "farhan-arshad-dev", "createdAt": "2020-01-28T10:12:39Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/model/api/CourseUpgradeResponse.java", "diffHunk": "@@ -2,7 +2,9 @@\n \n import com.google.gson.annotations.SerializedName;\n \n-public class CourseUpgradeResponse {\n+import java.io.Serializable;\n+\n+public class CourseUpgradeResponse implements Serializable {", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM1MDUxNA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373350514", "bodyText": "done!", "author": "farhan", "createdAt": "2020-01-31T07:46:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTcxMTk2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0MTU3OA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r371741578", "bodyText": "We have to check the following conditions here.\n\nFirebase is enabled.\nFirebase remote config for Revenue is enabled.\nCourseUpgrade->ShowUpsell is true.", "author": "farhan-arshad-dev", "createdAt": "2020-01-28T11:14:06Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/adapters/CourseUnitPagerAdapter.java", "diffHunk": "@@ -79,7 +84,11 @@ public Fragment getItem(int pos) {\n         CourseUnitFragment unitFragment;\n         final boolean isYoutubeVideo = (minifiedUnit instanceof VideoBlockModel && ((VideoBlockModel) minifiedUnit).getData().encodedVideos.getYoutubeVideoInfo() != null);\n         if (minifiedUnit.getAuthorizationDenialReason() == AuthorizationDenialReason.FEATURE_BASED_ENROLLMENTS) {\n-            unitFragment = CourseUnitMobileNotSupportedFragment.newInstance(minifiedUnit);\n+//            if (MPB is enabled on firebase config) {\n+            unitFragment = LockedCourseUnitFragment.newInstance(minifiedUnit, courseData, courseUpgradeData);", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUyMDYzMg==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373520632", "bodyText": "fixed as per discussion", "author": "farhan", "createdAt": "2020-01-31T14:55:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0MTU3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0MjkyNA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r371742924", "bodyText": "Need a new line here.", "author": "farhan-arshad-dev", "createdAt": "2020-01-28T11:17:21Z", "path": "OpenEdXMobile/res/anim/slide_down.xml", "diffHunk": "@@ -0,0 +1,8 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<set xmlns:android=\"http://schemas.android.com/apk/res/android\" >\n+\n+    <translate\n+        android:duration=\"500\"\n+        android:fromYDelta=\"0\"\n+        android:toYDelta=\"100%\" />\n+</set>", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0Mjk3MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r371742971", "bodyText": "Need a new line here.", "author": "farhan-arshad-dev", "createdAt": "2020-01-28T11:17:26Z", "path": "OpenEdXMobile/res/anim/slide_up.xml", "diffHunk": "@@ -0,0 +1,8 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<set xmlns:android=\"http://schemas.android.com/apk/res/android\" >\n+\n+    <translate\n+        android:duration=\"500\"\n+        android:fromYDelta=\"100%\"\n+        android:toYDelta=\"0\" />\n+</set>", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0NTc3MA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r371745770", "bodyText": "There should be logic to remove PaymentsBannerFragment in case of getCourseUpgradeStatus onFailure after successfully performing the payment.", "author": "farhan-arshad-dev", "createdAt": "2020-01-28T11:24:30Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -618,7 +612,6 @@ public void onResponse(Call<CourseUpgradeResponse> call, Response<CourseUpgradeR\n                 public void onFailure(Call<CourseUpgradeResponse> call, Throwable t) {\n                     // Setting the call to null ensures that only 1 request is enqueued at a specific point in time\n                     getCourseUpgradeStatus = null;\n-                    viewUpgradeToVerifiedFooter.setVisibility(View.GONE);", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM1MjE3MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373352171", "bodyText": "done!", "author": "farhan", "createdAt": "2020-01-31T07:52:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0NTc3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI1MDUzNw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372250537", "bodyText": "need a new line at the end.", "author": "farhan-arshad-dev", "createdAt": "2020-01-29T08:42:29Z", "path": "OpenEdXMobile/res/layout/fragment_payments_banner.xml", "diffHunk": "@@ -0,0 +1,80 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <android.support.constraint.ConstraintLayout\n+        android:id=\"@+id/upgrade_to_verified_footer\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:paddingBottom=\"@dimen/edx_half_margin\">\n+\n+        <View\n+            android:id=\"@+id/divider\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"@dimen/edx_divider_length\"\n+            android:background=\"@color/edx_success_accent\"\n+            app:layout_constraintTop_toTopOf=\"parent\" />\n+\n+        <TextView\n+            android:id=\"@+id/upgrade_banner_description\"\n+            style=\"@style/regular_text\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_margin=\"@dimen/edx_half_margin\"\n+            android:gravity=\"center\"\n+            android:text=\"@string/upgrade_banner_description\"\n+            android:textColor=\"@color/black\"\n+            app:layout_constraintTop_toBottomOf=\"@+id/divider\"\n+            tools:ignore=\"MissingPrefix\" />\n+\n+        <LinearLayout\n+            android:id=\"@+id/ll_upgrade_button\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_margin=\"@dimen/edx_half_margin\"\n+            android:background=\"@drawable/edx_success_accent_round_background\"\n+            android:orientation=\"vertical\"\n+            android:padding=\"@dimen/edx_half_margin\"\n+            app:layout_constraintEnd_toStartOf=\"@+id/info\"\n+            app:layout_constraintStart_toStartOf=\"parent\"\n+            app:layout_constraintTop_toBottomOf=\"@+id/upgrade_banner_description\">\n+\n+            <TextView\n+                style=\"@style/edX.Widget.Button\"\n+                fontPath=\"fonts/OpenSans-Semibold.ttf\"\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:text=\"@string/upgrade_to_verified_today_title\"\n+                android:textColor=\"@color/white\"\n+                tools:ignore=\"MissingPrefix\" />\n+\n+            <TextView\n+                android:id=\"@+id/tv_upgrade_price\"\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:gravity=\"center\"\n+                android:textColor=\"@color/transparent_white_85\"\n+                tools:text=\"$99 USD\" />\n+        </LinearLayout>\n+\n+        <org.edx.mobile.view.custom.IconImageViewXml\n+            android:id=\"@+id/info\"\n+            style=\"@style/edX.Widget.BorderedButton\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"0dp\"\n+            android:layout_marginEnd=\"@dimen/edx_half_margin\"\n+            android:focusable=\"true\"\n+            android:visibility=\"gone\"\n+            app:iconColor=\"@color/edx_brand_primary_base\"\n+            app:iconName=\"fa-info-circle\"\n+            app:layout_constraintBottom_toBottomOf=\"@+id/ll_upgrade_button\"\n+            app:layout_constraintDimensionRatio=\"1:1\"\n+            app:layout_constraintEnd_toEndOf=\"parent\"\n+            app:layout_constraintTop_toTopOf=\"@+id/ll_upgrade_button\"\n+            tools:visibility=\"visible\" />\n+\n+    </android.support.constraint.ConstraintLayout>\n+\n+</layout>", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUyMDI4NQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373520285", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:55:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI1MDUzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMxMzI0MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372313241", "bodyText": "courseUpgradeData can be null when we trigger the sticky event after Line# 594.", "author": "farhan-arshad-dev", "createdAt": "2020-01-29T10:52:14Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/PaymentsBannerFragment.kt", "diffHunk": "@@ -0,0 +1,113 @@\n+package org.edx.mobile.view\n+\n+import android.content.Context\n+import android.databinding.DataBindingUtil\n+import android.os.Bundle\n+import android.support.v4.app.Fragment\n+import android.support.v4.app.FragmentManager\n+import android.support.v4.app.FragmentTransaction\n+import android.text.TextUtils\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import com.google.inject.Inject\n+import kotlinx.android.synthetic.main.fragment_payments_banner.*\n+import org.edx.mobile.R\n+import org.edx.mobile.base.BaseFragment\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.databinding.FragmentPaymentsBannerBinding\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.model.course.CourseComponent\n+\n+class PaymentsBannerFragment : BaseFragment() {\n+    @Inject\n+    var environment: IEdxEnvironment? = null\n+\n+    companion object {\n+        private const val EXTRA_SHOW_INFO_BUTTON = \"show_info_button\"\n+        private fun newInstance(courseData: EnrolledCoursesResponse,\n+                                courseUnit: CourseComponent?,\n+                                courseUpgradeData: CourseUpgradeResponse,\n+                                showInfoButton: Boolean): Fragment {\n+            val fragment = PaymentsBannerFragment()\n+            val bundle = Bundle()\n+            bundle.putSerializable(Router.EXTRA_COURSE_DATA, courseData)\n+            courseUnit?.let {\n+                bundle.putSerializable(Router.EXTRA_COURSE_UNIT, it)\n+            }\n+            bundle.putSerializable(Router.EXTRA_COURSE_UPGRADE_DATA, courseUpgradeData)\n+            bundle.putBoolean(EXTRA_SHOW_INFO_BUTTON, showInfoButton)\n+            fragment.arguments = bundle\n+            return fragment\n+        }\n+\n+        fun loadPaymentsBannerFragment(containerId: Int,\n+                                       courseData: EnrolledCoursesResponse,\n+                                       courseUnit: CourseComponent?,\n+                                       courseUpgradeData: CourseUpgradeResponse, showInfoButton: Boolean,", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM1MjQxMA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373352410", "bodyText": "fixed!", "author": "farhan", "createdAt": "2020-01-31T07:53:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMxMzI0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMxNDk4Ng==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372314986", "bodyText": "if (!TextUtils.isEmpty(courseUpgradeData.price)) { use instated of.", "author": "farhan-arshad-dev", "createdAt": "2020-01-29T10:55:46Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/PaymentsBannerFragment.kt", "diffHunk": "@@ -0,0 +1,113 @@\n+package org.edx.mobile.view\n+\n+import android.content.Context\n+import android.databinding.DataBindingUtil\n+import android.os.Bundle\n+import android.support.v4.app.Fragment\n+import android.support.v4.app.FragmentManager\n+import android.support.v4.app.FragmentTransaction\n+import android.text.TextUtils\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import com.google.inject.Inject\n+import kotlinx.android.synthetic.main.fragment_payments_banner.*\n+import org.edx.mobile.R\n+import org.edx.mobile.base.BaseFragment\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.databinding.FragmentPaymentsBannerBinding\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.model.course.CourseComponent\n+\n+class PaymentsBannerFragment : BaseFragment() {\n+    @Inject\n+    var environment: IEdxEnvironment? = null\n+\n+    companion object {\n+        private const val EXTRA_SHOW_INFO_BUTTON = \"show_info_button\"\n+        private fun newInstance(courseData: EnrolledCoursesResponse,\n+                                courseUnit: CourseComponent?,\n+                                courseUpgradeData: CourseUpgradeResponse,\n+                                showInfoButton: Boolean): Fragment {\n+            val fragment = PaymentsBannerFragment()\n+            val bundle = Bundle()\n+            bundle.putSerializable(Router.EXTRA_COURSE_DATA, courseData)\n+            courseUnit?.let {\n+                bundle.putSerializable(Router.EXTRA_COURSE_UNIT, it)\n+            }\n+            bundle.putSerializable(Router.EXTRA_COURSE_UPGRADE_DATA, courseUpgradeData)\n+            bundle.putBoolean(EXTRA_SHOW_INFO_BUTTON, showInfoButton)\n+            fragment.arguments = bundle\n+            return fragment\n+        }\n+\n+        fun loadPaymentsBannerFragment(containerId: Int,\n+                                       courseData: EnrolledCoursesResponse,\n+                                       courseUnit: CourseComponent?,\n+                                       courseUpgradeData: CourseUpgradeResponse, showInfoButton: Boolean,\n+                                       childFragmentManager: FragmentManager, animate: Boolean) {\n+            val frag: Fragment? = childFragmentManager.findFragmentByTag(\"payment_banner_frag\")\n+            if (frag != null) {\n+                // Payment banner already exists\n+                return\n+            }\n+            val fragment: Fragment = newInstance(courseData, courseUnit, courseUpgradeData, showInfoButton)\n+            // This activity will only ever hold this lone fragment, so we\n+            // can afford to retain the instance during activity recreation\n+            fragment.retainInstance = true\n+            val fragmentTransaction: FragmentTransaction = childFragmentManager.beginTransaction()\n+            if(animate) {\n+                fragmentTransaction.setCustomAnimations(R.anim.slide_up, android.R.anim.fade_out)\n+            }\n+            fragmentTransaction.replace(containerId, fragment, \"payment_banner_frag\")\n+            fragmentTransaction.disallowAddToBackStack()\n+            fragmentTransaction.commitAllowingStateLoss()\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        val binding: FragmentPaymentsBannerBinding =\n+                DataBindingUtil.inflate(inflater, R.layout.fragment_payments_banner, container, false)\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        populateCourseUpgradeBanner(view.context)\n+    }\n+\n+    private fun populateCourseUpgradeBanner(context: Context) {\n+        val courseUpgradeData: CourseUpgradeResponse =\n+                arguments?.getSerializable(Router.EXTRA_COURSE_UPGRADE_DATA) as CourseUpgradeResponse\n+        val courseData: EnrolledCoursesResponse =\n+                arguments?.getSerializable(Router.EXTRA_COURSE_DATA) as EnrolledCoursesResponse\n+        val showInfoButton: Boolean = arguments?.getBoolean(EXTRA_SHOW_INFO_BUTTON) ?: false\n+        upgrade_to_verified_footer.visibility = View.VISIBLE\n+        if (showInfoButton) {\n+            info.visibility = View.VISIBLE\n+            info.setOnClickListener {\n+                environment?.router?.showPaymentsInfoActivity(context, courseData, courseUpgradeData)\n+            }\n+        } else {\n+            info.visibility = View.GONE\n+        }\n+        if (!TextUtils.isEmpty(courseUpgradeData.getPrice())) {", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUyMDAxMw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373520013", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:54:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMxNDk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMyMzU4OQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372323589", "bodyText": "need an auto format here.", "author": "farhan-arshad-dev", "createdAt": "2020-01-29T11:15:23Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/PaymentsBannerFragment.kt", "diffHunk": "@@ -0,0 +1,113 @@\n+package org.edx.mobile.view\n+\n+import android.content.Context\n+import android.databinding.DataBindingUtil\n+import android.os.Bundle\n+import android.support.v4.app.Fragment\n+import android.support.v4.app.FragmentManager\n+import android.support.v4.app.FragmentTransaction\n+import android.text.TextUtils\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import com.google.inject.Inject\n+import kotlinx.android.synthetic.main.fragment_payments_banner.*\n+import org.edx.mobile.R\n+import org.edx.mobile.base.BaseFragment\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.databinding.FragmentPaymentsBannerBinding\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.model.course.CourseComponent\n+\n+class PaymentsBannerFragment : BaseFragment() {\n+    @Inject\n+    var environment: IEdxEnvironment? = null\n+\n+    companion object {\n+        private const val EXTRA_SHOW_INFO_BUTTON = \"show_info_button\"\n+        private fun newInstance(courseData: EnrolledCoursesResponse,\n+                                courseUnit: CourseComponent?,\n+                                courseUpgradeData: CourseUpgradeResponse,\n+                                showInfoButton: Boolean): Fragment {\n+            val fragment = PaymentsBannerFragment()\n+            val bundle = Bundle()\n+            bundle.putSerializable(Router.EXTRA_COURSE_DATA, courseData)\n+            courseUnit?.let {\n+                bundle.putSerializable(Router.EXTRA_COURSE_UNIT, it)\n+            }\n+            bundle.putSerializable(Router.EXTRA_COURSE_UPGRADE_DATA, courseUpgradeData)\n+            bundle.putBoolean(EXTRA_SHOW_INFO_BUTTON, showInfoButton)\n+            fragment.arguments = bundle\n+            return fragment\n+        }\n+\n+        fun loadPaymentsBannerFragment(containerId: Int,\n+                                       courseData: EnrolledCoursesResponse,\n+                                       courseUnit: CourseComponent?,\n+                                       courseUpgradeData: CourseUpgradeResponse, showInfoButton: Boolean,\n+                                       childFragmentManager: FragmentManager, animate: Boolean) {\n+            val frag: Fragment? = childFragmentManager.findFragmentByTag(\"payment_banner_frag\")\n+            if (frag != null) {\n+                // Payment banner already exists\n+                return\n+            }\n+            val fragment: Fragment = newInstance(courseData, courseUnit, courseUpgradeData, showInfoButton)\n+            // This activity will only ever hold this lone fragment, so we\n+            // can afford to retain the instance during activity recreation\n+            fragment.retainInstance = true\n+            val fragmentTransaction: FragmentTransaction = childFragmentManager.beginTransaction()\n+            if(animate) {", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxOTg5Ng==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373519896", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:54:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMyMzU4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMzMjU0Mg==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372332542", "bodyText": "can be replaced by the following code\nval courseUnit: CourseComponent? = arguments?.getSerializable(Router.EXTRA_COURSE_UNIT) as CourseComponent?", "author": "farhan-arshad-dev", "createdAt": "2020-01-29T11:36:54Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/PaymentsBannerFragment.kt", "diffHunk": "@@ -0,0 +1,113 @@\n+package org.edx.mobile.view\n+\n+import android.content.Context\n+import android.databinding.DataBindingUtil\n+import android.os.Bundle\n+import android.support.v4.app.Fragment\n+import android.support.v4.app.FragmentManager\n+import android.support.v4.app.FragmentTransaction\n+import android.text.TextUtils\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import com.google.inject.Inject\n+import kotlinx.android.synthetic.main.fragment_payments_banner.*\n+import org.edx.mobile.R\n+import org.edx.mobile.base.BaseFragment\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.databinding.FragmentPaymentsBannerBinding\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.model.course.CourseComponent\n+\n+class PaymentsBannerFragment : BaseFragment() {\n+    @Inject\n+    var environment: IEdxEnvironment? = null\n+\n+    companion object {\n+        private const val EXTRA_SHOW_INFO_BUTTON = \"show_info_button\"\n+        private fun newInstance(courseData: EnrolledCoursesResponse,\n+                                courseUnit: CourseComponent?,\n+                                courseUpgradeData: CourseUpgradeResponse,\n+                                showInfoButton: Boolean): Fragment {\n+            val fragment = PaymentsBannerFragment()\n+            val bundle = Bundle()\n+            bundle.putSerializable(Router.EXTRA_COURSE_DATA, courseData)\n+            courseUnit?.let {\n+                bundle.putSerializable(Router.EXTRA_COURSE_UNIT, it)\n+            }\n+            bundle.putSerializable(Router.EXTRA_COURSE_UPGRADE_DATA, courseUpgradeData)\n+            bundle.putBoolean(EXTRA_SHOW_INFO_BUTTON, showInfoButton)\n+            fragment.arguments = bundle\n+            return fragment\n+        }\n+\n+        fun loadPaymentsBannerFragment(containerId: Int,\n+                                       courseData: EnrolledCoursesResponse,\n+                                       courseUnit: CourseComponent?,\n+                                       courseUpgradeData: CourseUpgradeResponse, showInfoButton: Boolean,\n+                                       childFragmentManager: FragmentManager, animate: Boolean) {\n+            val frag: Fragment? = childFragmentManager.findFragmentByTag(\"payment_banner_frag\")\n+            if (frag != null) {\n+                // Payment banner already exists\n+                return\n+            }\n+            val fragment: Fragment = newInstance(courseData, courseUnit, courseUpgradeData, showInfoButton)\n+            // This activity will only ever hold this lone fragment, so we\n+            // can afford to retain the instance during activity recreation\n+            fragment.retainInstance = true\n+            val fragmentTransaction: FragmentTransaction = childFragmentManager.beginTransaction()\n+            if(animate) {\n+                fragmentTransaction.setCustomAnimations(R.anim.slide_up, android.R.anim.fade_out)\n+            }\n+            fragmentTransaction.replace(containerId, fragment, \"payment_banner_frag\")\n+            fragmentTransaction.disallowAddToBackStack()\n+            fragmentTransaction.commitAllowingStateLoss()\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        val binding: FragmentPaymentsBannerBinding =\n+                DataBindingUtil.inflate(inflater, R.layout.fragment_payments_banner, container, false)\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        populateCourseUpgradeBanner(view.context)\n+    }\n+\n+    private fun populateCourseUpgradeBanner(context: Context) {\n+        val courseUpgradeData: CourseUpgradeResponse =\n+                arguments?.getSerializable(Router.EXTRA_COURSE_UPGRADE_DATA) as CourseUpgradeResponse\n+        val courseData: EnrolledCoursesResponse =\n+                arguments?.getSerializable(Router.EXTRA_COURSE_DATA) as EnrolledCoursesResponse\n+        val showInfoButton: Boolean = arguments?.getBoolean(EXTRA_SHOW_INFO_BUTTON) ?: false\n+        upgrade_to_verified_footer.visibility = View.VISIBLE\n+        if (showInfoButton) {\n+            info.visibility = View.VISIBLE\n+            info.setOnClickListener {\n+                environment?.router?.showPaymentsInfoActivity(context, courseData, courseUpgradeData)\n+            }\n+        } else {\n+            info.visibility = View.GONE\n+        }\n+        if (!TextUtils.isEmpty(courseUpgradeData.getPrice())) {\n+            tv_upgrade_price.text = courseUpgradeData.price\n+        } else {\n+            tv_upgrade_price.visibility = View.GONE\n+        }\n+\n+        val serializable = arguments?.getSerializable(Router.EXTRA_COURSE_UNIT)\n+        var courseUnit: CourseComponent? = null\n+        serializable?.let {\n+            courseUnit = arguments?.getSerializable(Router.EXTRA_COURSE_UNIT) as CourseComponent\n+        }", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxOTc5OQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373519799", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:54:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMzMjU0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMzNDE1MA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372334150", "bodyText": "there is no need to implement the let in case of null, because if we not putSerializable then we will get null object on receiving end.", "author": "farhan-arshad-dev", "createdAt": "2020-01-29T11:41:03Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/PaymentsBannerFragment.kt", "diffHunk": "@@ -0,0 +1,113 @@\n+package org.edx.mobile.view\n+\n+import android.content.Context\n+import android.databinding.DataBindingUtil\n+import android.os.Bundle\n+import android.support.v4.app.Fragment\n+import android.support.v4.app.FragmentManager\n+import android.support.v4.app.FragmentTransaction\n+import android.text.TextUtils\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import com.google.inject.Inject\n+import kotlinx.android.synthetic.main.fragment_payments_banner.*\n+import org.edx.mobile.R\n+import org.edx.mobile.base.BaseFragment\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.databinding.FragmentPaymentsBannerBinding\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.model.course.CourseComponent\n+\n+class PaymentsBannerFragment : BaseFragment() {\n+    @Inject\n+    var environment: IEdxEnvironment? = null\n+\n+    companion object {\n+        private const val EXTRA_SHOW_INFO_BUTTON = \"show_info_button\"\n+        private fun newInstance(courseData: EnrolledCoursesResponse,\n+                                courseUnit: CourseComponent?,\n+                                courseUpgradeData: CourseUpgradeResponse,\n+                                showInfoButton: Boolean): Fragment {\n+            val fragment = PaymentsBannerFragment()\n+            val bundle = Bundle()\n+            bundle.putSerializable(Router.EXTRA_COURSE_DATA, courseData)\n+            courseUnit?.let {", "originalCommit": "7147a9c68d806ebbbb0e60604d9d33e401d5548b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxOTQwMw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373519403", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:53:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMzNDE1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc5OTM2Ng==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372799366", "bodyText": "need auto format.", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T07:49:57Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/PaymentsInfoFragment.kt", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.edx.mobile.view\n+\n+import android.databinding.DataBindingUtil\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import kotlinx.android.synthetic.main.fragment_payments_info.*\n+import org.edx.mobile.R\n+import org.edx.mobile.base.BaseFragment\n+import org.edx.mobile.databinding.FragmentPaymentsInfoBinding\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.util.DateUtil\n+import org.edx.mobile.util.ResourceUtil\n+import java.text.SimpleDateFormat\n+import java.util.*\n+\n+class PaymentsInfoFragment : BaseFragment() {", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxODk1OA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373518958", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:52:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc5OTM2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMDY2OA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372800668", "bodyText": "Need auto-format", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T07:53:46Z", "path": "OpenEdXMobile/res/layout-land/fragment_payments_info.xml", "diffHunk": "@@ -0,0 +1,121 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxODc1OA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373518758", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:52:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMDY2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMTExOA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372801118", "bodyText": "Need to add android:paddingEnd=\"@dimen/edx_margin\", to make the symmetry in case of RTL.", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T07:55:02Z", "path": "OpenEdXMobile/res/layout-land/fragment_payments_info.xml", "diffHunk": "@@ -0,0 +1,121 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:orientation=\"vertical\">\n+\n+        <ScrollView\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"0dp\"\n+            android:layout_weight=\"1\">\n+\n+            <LinearLayout\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:orientation=\"vertical\">\n+\n+                <android.support.constraint.ConstraintLayout\n+                    android:layout_width=\"match_parent\"\n+                    android:layout_height=\"wrap_content\"\n+                    android:background=\"#aa0075B4\"\n+                    android:paddingStart=\"@dimen/edx_margin\"", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwMjg1NA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374602854", "bodyText": "not need file has been removed.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:56:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMTExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMTI5MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372801291", "bodyText": "We have to declare in colors.xml", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T07:55:34Z", "path": "OpenEdXMobile/res/layout-land/fragment_payments_info.xml", "diffHunk": "@@ -0,0 +1,121 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:orientation=\"vertical\">\n+\n+        <ScrollView\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"0dp\"\n+            android:layout_weight=\"1\">\n+\n+            <LinearLayout\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:orientation=\"vertical\">\n+\n+                <android.support.constraint.ConstraintLayout\n+                    android:layout_width=\"match_parent\"\n+                    android:layout_height=\"wrap_content\"\n+                    android:background=\"#aa0075B4\"", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxODU1NA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373518554", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:52:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMTI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMTg1Ng==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372801856", "bodyText": "no need of android:layout_gravity within ConstraintLayout", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T07:57:11Z", "path": "OpenEdXMobile/res/layout-land/fragment_payments_info.xml", "diffHunk": "@@ -0,0 +1,121 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:orientation=\"vertical\">\n+\n+        <ScrollView\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"0dp\"\n+            android:layout_weight=\"1\">\n+\n+            <LinearLayout\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:orientation=\"vertical\">\n+\n+                <android.support.constraint.ConstraintLayout\n+                    android:layout_width=\"match_parent\"\n+                    android:layout_height=\"wrap_content\"\n+                    android:background=\"#aa0075B4\"\n+                    android:paddingStart=\"@dimen/edx_margin\"\n+                    android:paddingTop=\"@dimen/edx_margin\"\n+                    android:paddingBottom=\"@dimen/edx_margin\">\n+\n+                    <ImageView\n+                        android:id=\"@+id/btn_close\"\n+                        android:layout_width=\"@dimen/fa_xxxx_large\"\n+                        android:layout_height=\"@dimen/fa_xxxx_large\"\n+                        android:layout_gravity=\"center\"", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxODQ5Nw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373518497", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:51:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMTg1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwOTQ4NQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372809485", "bodyText": "We have to use the following code instated of static height\n<ImageView\n\tandroid:id=\"@+id/certificate_slice\"\n\tandroid:layout_width=\"wrap_content\"\n\tandroid:layout_height=\"0dp\"\n        android:layout_marginTop=\"@dimen/edx_margin\"\n        android:background=\"@drawable/ic_new_cert\"\n        android:contentDescription=\"@null\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/btn_close\" />", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T08:19:14Z", "path": "OpenEdXMobile/res/layout-land/fragment_payments_info.xml", "diffHunk": "@@ -0,0 +1,121 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:orientation=\"vertical\">\n+\n+        <ScrollView\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"0dp\"\n+            android:layout_weight=\"1\">\n+\n+            <LinearLayout\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:orientation=\"vertical\">\n+\n+                <android.support.constraint.ConstraintLayout\n+                    android:layout_width=\"match_parent\"\n+                    android:layout_height=\"wrap_content\"\n+                    android:background=\"#aa0075B4\"\n+                    android:paddingStart=\"@dimen/edx_margin\"\n+                    android:paddingTop=\"@dimen/edx_margin\"\n+                    android:paddingBottom=\"@dimen/edx_margin\">\n+\n+                    <ImageView\n+                        android:id=\"@+id/btn_close\"\n+                        android:layout_width=\"@dimen/fa_xxxx_large\"\n+                        android:layout_height=\"@dimen/fa_xxxx_large\"\n+                        android:layout_gravity=\"center\"\n+                        android:layout_marginEnd=\"@dimen/edx_margin\"\n+                        android:background=\"@drawable/selectable_box_overlay\"\n+                        android:contentDescription=\"@string/close\"\n+                        android:padding=\"@dimen/widget_margin\"\n+                        android:src=\"@drawable/ic_close\"\n+                        android:tint=\"@color/white\"\n+                        app:layout_constraintEnd_toEndOf=\"parent\"\n+                        app:layout_constraintTop_toTopOf=\"parent\" />\n+\n+                    <TextView\n+                        android:id=\"@+id/tv_header\"\n+                        style=\"@style/bold_white_text\"\n+                        android:layout_width=\"0dp\"\n+                        android:layout_height=\"wrap_content\"\n+                        android:singleLine=\"true\"\n+                        android:text=\"@string/payments_info_header\"\n+                        android:textSize=\"@dimen/edx_large\"\n+                        app:layout_constraintBottom_toBottomOf=\"@+id/btn_close\"\n+                        app:layout_constraintEnd_toStartOf=\"@+id/btn_close\"\n+                        app:layout_constraintStart_toStartOf=\"parent\"\n+                        app:layout_constraintTop_toTopOf=\"@+id/btn_close\" />\n+\n+                    <TextView\n+                        android:id=\"@+id/textView\"\n+                        android:layout_width=\"0dp\"\n+                        android:layout_height=\"wrap_content\"\n+                        android:layout_marginTop=\"@dimen/edx_double_margin\"\n+                        android:layout_marginEnd=\"@dimen/edx_margin\"\n+                        android:text=\"@string/payments_info_details\"\n+                        android:textColor=\"@color/white\"\n+                        android:textSize=\"@dimen/edx_base\"\n+                        app:layout_constraintEnd_toStartOf=\"@id/certificate_slice\"\n+                        app:layout_constraintStart_toStartOf=\"parent\"\n+                        app:layout_constraintTop_toBottomOf=\"@id/btn_close\" />\n+\n+                    <ImageView\n+                        android:id=\"@+id/certificate_slice\"\n+                        android:layout_width=\"wrap_content\"\n+                        android:layout_height=\"250dp\"\n+                        android:layout_marginTop=\"@dimen/edx_margin\"\n+                        android:background=\"@drawable/ic_new_cert\"\n+                        android:contentDescription=\"@null\"\n+                        app:layout_constraintEnd_toEndOf=\"parent\"\n+                        app:layout_constraintTop_toBottomOf=\"@id/btn_close\" />", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxODE2MA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373518160", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:51:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwOTQ4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgxMDM5OQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372810399", "bodyText": "We have to use the following code instated of static height\n<ImageView\n\tandroid:id=\"@+id/certificate_slice\"\n\tandroid:layout_width=\"wrap_content\"\n\tandroid:layout_height=\"0dp\"\n        android:layout_marginTop=\"@dimen/edx_margin\"\n        android:background=\"@drawable/ic_new_cert\"\n        android:contentDescription=\"@null\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/btn_close\" />", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T08:21:41Z", "path": "OpenEdXMobile/res/layout/fragment_payments_info.xml", "diffHunk": "@@ -0,0 +1,106 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:orientation=\"vertical\">\n+\n+        <android.support.constraint.ConstraintLayout\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:background=\"#aa0075B4\"\n+            android:paddingStart=\"@dimen/edx_margin\"\n+            android:paddingTop=\"@dimen/edx_margin\"\n+            android:paddingBottom=\"@dimen/edx_margin\">\n+\n+            <ImageView\n+                android:id=\"@+id/btn_close\"\n+                android:layout_width=\"@dimen/fa_xxxx_large\"\n+                android:layout_height=\"@dimen/fa_xxxx_large\"\n+                android:layout_gravity=\"center\"\n+                android:layout_marginEnd=\"@dimen/edx_margin\"\n+                android:background=\"@drawable/selectable_box_overlay\"\n+                android:contentDescription=\"@string/close\"\n+                android:padding=\"@dimen/widget_margin\"\n+                android:src=\"@drawable/ic_close\"\n+                android:tint=\"@color/white\"\n+                app:layout_constraintEnd_toEndOf=\"parent\"\n+                app:layout_constraintTop_toTopOf=\"parent\" />\n+\n+            <TextView\n+                android:id=\"@+id/tv_header\"\n+                style=\"@style/bold_white_text\"\n+                android:layout_width=\"0dp\"\n+                android:layout_height=\"wrap_content\"\n+                android:singleLine=\"true\"\n+                android:text=\"@string/payments_info_header\"\n+                android:textSize=\"@dimen/edx_large\"\n+                app:layout_constraintBottom_toBottomOf=\"@+id/btn_close\"\n+                app:layout_constraintEnd_toStartOf=\"@+id/btn_close\"\n+                app:layout_constraintStart_toStartOf=\"parent\"\n+                app:layout_constraintTop_toTopOf=\"@+id/btn_close\" />\n+\n+            <TextView\n+                android:id=\"@+id/textView\"\n+                android:layout_width=\"0dp\"\n+                android:layout_height=\"wrap_content\"\n+                android:layout_marginTop=\"@dimen/edx_double_margin\"\n+                android:layout_marginEnd=\"@dimen/edx_margin\"\n+                android:text=\"@string/payments_info_details\"\n+                android:textColor=\"@color/white\"\n+                android:textSize=\"@dimen/edx_base\"\n+                app:layout_constraintEnd_toStartOf=\"@id/certificate_slice\"\n+                app:layout_constraintStart_toStartOf=\"parent\"\n+                app:layout_constraintTop_toBottomOf=\"@id/btn_close\" />\n+\n+            <ImageView\n+                android:id=\"@+id/certificate_slice\"\n+                android:layout_width=\"wrap_content\"\n+                android:layout_height=\"250dp\"\n+                android:layout_marginTop=\"@dimen/edx_margin\"\n+                android:background=\"@drawable/ic_new_cert\"\n+                android:contentDescription=\"@null\"\n+                app:layout_constraintEnd_toEndOf=\"parent\"\n+                app:layout_constraintTop_toBottomOf=\"@id/btn_close\" />", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxODA4Mw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373518083", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:51:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgxMDM5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgzNzk1Mw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372837953", "bodyText": "Need to add android:paddingEnd=\"@dimen/edx_margin\", to make the symmetry in case of RTL.", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T09:25:53Z", "path": "OpenEdXMobile/res/layout/fragment_payments_info.xml", "diffHunk": "@@ -0,0 +1,106 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:orientation=\"vertical\">\n+\n+        <android.support.constraint.ConstraintLayout\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:background=\"#aa0075B4\"\n+            android:paddingStart=\"@dimen/edx_margin\"\n+            android:paddingTop=\"@dimen/edx_margin\"", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwMzE5MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374603191", "bodyText": "not needed after setting up the layout direction.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:56:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgzNzk1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg1MjEzMQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372852131", "bodyText": "We have to use the blockId instated of and remove minifiedBlockId from the method definition as to make parity with SegmentAnalytics.", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T09:54:20Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/module/analytics/FirebaseAnalytics.java", "diffHunk": "@@ -184,6 +184,18 @@ public void trackDownloadComplete(String videoId, String courseId,\n         logFirebaseEvent(event.getName(), event.getBundle());\n     }\n \n+    @Override\n+    public void trackCourseUpgradeSuccess(String blockId, String courseId, String minifiedBlockId) {\n+        final FirebaseEvent event = new FirebaseEvent(Events.COURSE_UPGRADE_SUCCESS,\n+                Values.USER_COURSE_UPGRADE_SUCCESS);\n+        event.putCourseId(courseId);\n+        event.putString(Keys.BLOCK_ID, minifiedBlockId);", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxNzg1MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373517851", "bodyText": "Its in parity with trackCourseComponentViewed function.", "author": "farhan", "createdAt": "2020-01-31T14:50:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg1MjEzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg2NDAxNQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372864015", "bodyText": "After the parity of Firebase and Segment analytics need to remove the minifiedBlockId.", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T10:18:07Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/module/analytics/Analytics.java", "diffHunk": "@@ -131,6 +131,15 @@ void trackVideoSeek(String videoId, Double oldTime, Double newTime,\n     void trackDownloadComplete(String videoId, String courseId,\n                                String unitUrl);\n \n+    /**\n+     * Track user's successful course upgrade.\n+     *\n+     * @param blockId         ID of the locked course unit from which the user is redirected to upgrade screen.\n+     * @param courseId        ID of the course which user has upgraded.\n+     * @param minifiedBlockId Block ID of the locked course unit from which the user is redirected to upgrade screen.\n+     */\n+    void trackCourseUpgradeSuccess(String blockId, String courseId, String minifiedBlockId);", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxNzc4OA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373517788", "bodyText": "Its in parity with trackCourseComponentViewed function.", "author": "farhan", "createdAt": "2020-01-31T14:50:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg2NDAxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5MTMyNQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372891325", "bodyText": "There is no need to overload the method, the other method is not called from anywhere else.", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T11:16:03Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/Router.java", "diffHunk": "@@ -198,50 +203,43 @@ public void showCourseAnnouncementFromNotification(@NonNull Context context, @No\n                 .startActivities();\n     }\n \n-    public void showCourseContainerOutline(Activity activity, EnrolledCoursesResponse model,\n+    public void showCourseContainerOutline(Activity activity, EnrolledCoursesResponse courseData,", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxNjE3NQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373516175", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:47:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5MTMyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5NTA0Ng==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372895046", "bodyText": "code can be replaced by\nfinal CourseComponent courseUnit = (CourseComponent) getIntent().getSerializableExtra(Router.EXTRA_COURSE_UNIT);", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T11:25:30Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseUpgradeWebViewActivity.java", "diffHunk": "@@ -30,7 +39,13 @@ protected void onCreate(Bundle savedInstanceState) {\n \n     @Override\n     public Fragment getFirstFragment() {\n+        final EnrolledCoursesResponse courseData = (EnrolledCoursesResponse) getIntent().getSerializableExtra(Router.EXTRA_COURSE_DATA);\n+        final Serializable serializable = getIntent().getSerializableExtra(Router.EXTRA_COURSE_UNIT);\n+        CourseComponent courseUnit = null;\n+        if (serializable != null) {\n+            courseUnit = (CourseComponent) serializable;\n+        }", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxNTQwNQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373515405", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:46:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5NTA0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5ODA2Ng==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372898066", "bodyText": "can be replaced by\n                // Fire analytics\n                final CourseComponent courseUnit = (CourseComponent) arguments.getSerializable(Router.EXTRA_COURSE_UNIT);\n                if (courseUnit != null) {\n                    analyticsRegistry.trackCourseUpgradeSuccess(courseUnit.getId(),\n                            courseData.getCourse().getId(), courseUnit.getBlockId());\n                } else {\n                    analyticsRegistry.trackCourseUpgradeSuccess(null,\n                            courseData.getCourse().getId(), null);\n                }", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T11:32:19Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseUpgradeWebViewFragment.java", "diffHunk": "@@ -69,9 +90,40 @@ public void onStop() {\n         if (getActivity() != null && authWebView.getWebView() != null) {\n             final String url = authWebView.getWebView().getUrl();\n             if (url != null && url.contains(\"checkout/receipt\")) {\n-                getActivity().finish();\n+                onCoursePaymentSuccessful();\n             }\n+        }\n+    }\n \n+    public void onCoursePaymentSuccessful() {\n+        // Finish activity\n+        final Activity activity = getActivity();\n+        if( activity != null) {\n+            activity.finish();\n+        }\n+\n+        final Bundle arguments = getArguments();\n+        if (arguments != null) {\n+            final EnrolledCoursesResponse courseData =\n+                    (EnrolledCoursesResponse) arguments.getSerializable(Router.EXTRA_COURSE_DATA);\n+\n+            // Fire Course Upgraded event\n+            EventBus.getDefault().postSticky(new CourseUpgradedEvent(courseData.getCourse().getId()));\n+\n+            // Fire analytics\n+            final Serializable serializable = arguments.getSerializable(Router.EXTRA_COURSE_UNIT);\n+            CourseComponent courseUnit;\n+            if (serializable != null) {\n+                courseUnit = (CourseComponent) serializable;\n+                analyticsRegistry.trackCourseUpgradeSuccess(courseUnit.getId(),\n+                        courseData.getCourse().getId(), courseUnit.getBlockId());\n+            } else {\n+                analyticsRegistry.trackCourseUpgradeSuccess(null,\n+                        courseData.getCourse().getId(), null);\n+            }", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxNDg1Nw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373514857", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:45:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5ODA2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkxMTQzOQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372911439", "bodyText": "We can remove the let as we can put the null in putSerializable.", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T12:04:53Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/LockedCourseUnitFragment.kt", "diffHunk": "@@ -0,0 +1,77 @@\n+package org.edx.mobile.view\n+\n+import android.databinding.DataBindingUtil\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import com.google.inject.Inject\n+import de.greenrobot.event.EventBus\n+import org.edx.mobile.R\n+import org.edx.mobile.databinding.FragmentLockedCourseUnitBinding\n+import org.edx.mobile.event.CourseUpgradeDataReceivedEvent\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.model.course.CourseComponent\n+import org.edx.mobile.module.analytics.Analytics\n+import org.edx.mobile.module.analytics.AnalyticsRegistry\n+\n+class LockedCourseUnitFragment : CourseUnitFragment() {\n+    @Inject\n+    var analyticsRegistry: AnalyticsRegistry? = null\n+\n+    companion object {\n+        @JvmStatic\n+        fun newInstance(unit: CourseComponent,\n+                        courseData: EnrolledCoursesResponse,\n+                        courseUpgradeData: CourseUpgradeResponse?): LockedCourseUnitFragment {\n+            val fragment = LockedCourseUnitFragment()\n+            val bundle = Bundle()\n+            bundle.putSerializable(Router.EXTRA_COURSE_UNIT, unit)\n+            bundle.putSerializable(Router.EXTRA_COURSE_DATA, courseData)\n+            courseUpgradeData?.let {", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxNDQyNw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373514427", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:44:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkxMTQzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkxMzE4MA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r372913180", "bodyText": "code can be replaced by the followings line\n        val courseUpgradeData = arguments?.getSerializable(Router.EXTRA_COURSE_UPGRADE_DATA) as CourseUpgradeResponse?\n        if (courseUpgradeData != null) {\n            val courseData = arguments?.getSerializable(Router.EXTRA_COURSE_DATA) as EnrolledCoursesResponse\n            loadPaymentBannerFragment(courseData, courseUpgradeData)\n        }", "author": "farhan-arshad-dev", "createdAt": "2020-01-30T12:09:25Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/LockedCourseUnitFragment.kt", "diffHunk": "@@ -0,0 +1,77 @@\n+package org.edx.mobile.view\n+\n+import android.databinding.DataBindingUtil\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import com.google.inject.Inject\n+import de.greenrobot.event.EventBus\n+import org.edx.mobile.R\n+import org.edx.mobile.databinding.FragmentLockedCourseUnitBinding\n+import org.edx.mobile.event.CourseUpgradeDataReceivedEvent\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.model.course.CourseComponent\n+import org.edx.mobile.module.analytics.Analytics\n+import org.edx.mobile.module.analytics.AnalyticsRegistry\n+\n+class LockedCourseUnitFragment : CourseUnitFragment() {\n+    @Inject\n+    var analyticsRegistry: AnalyticsRegistry? = null\n+\n+    companion object {\n+        @JvmStatic\n+        fun newInstance(unit: CourseComponent,\n+                        courseData: EnrolledCoursesResponse,\n+                        courseUpgradeData: CourseUpgradeResponse?): LockedCourseUnitFragment {\n+            val fragment = LockedCourseUnitFragment()\n+            val bundle = Bundle()\n+            bundle.putSerializable(Router.EXTRA_COURSE_UNIT, unit)\n+            bundle.putSerializable(Router.EXTRA_COURSE_DATA, courseData)\n+            courseUpgradeData?.let {\n+                bundle.putSerializable(Router.EXTRA_COURSE_UPGRADE_DATA, courseUpgradeData)\n+            }\n+            fragment.arguments = bundle\n+            return fragment\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        val binding: FragmentLockedCourseUnitBinding =\n+                DataBindingUtil.inflate(inflater, R.layout.fragment_locked_course_unit, container, false)\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        val courseUpgradeData = arguments?.getSerializable(Router.EXTRA_COURSE_UPGRADE_DATA)\n+        if (courseUpgradeData != null) {\n+            val courseData = arguments?.getSerializable(Router.EXTRA_COURSE_DATA) as EnrolledCoursesResponse\n+            loadPaymentBannerFragment(courseData, courseUpgradeData as CourseUpgradeResponse)", "originalCommit": "7a476155b1cf27f6ee126d2a62687a6af4241012", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxNDIwNw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r373514207", "bodyText": "done", "author": "farhan", "createdAt": "2020-01-31T14:44:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkxMzE4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUxMDc5MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374510791", "bodyText": "removeStickyEvent should be called only on the CourseOutlineActivity otherwise other screens won't be closed.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T07:32:33Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseUnitNavigationActivity.java", "diffHunk": "@@ -276,4 +278,9 @@ public boolean showGoogleCastButton() {\n         }\n         return super.showGoogleCastButton();\n     }\n+\n+    public void onEvent(CourseUpgradedEvent event) {\n+        EventBus.getDefault().removeStickyEvent(CourseUpgradedEvent.class);", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUxMDk4NA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374510984", "bodyText": "removeStickyEvent should be called only on the CourseOutlineActivity otherwise other screens won't be closed.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T07:33:04Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -777,6 +778,16 @@ public void onEvent(CourseDashboardRefreshEvent e) {\n         fetchCourseComponent();\n     }\n \n+    public void onEvent(CourseUpgradedEvent event) {\n+        EventBus.getDefault().removeStickyEvent(CourseUpgradedEvent.class);", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUxMTY4NQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374511685", "bodyText": "removeStickyEvent should be called only on the CourseOutlineActivity otherwise other screens won't be closed.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T07:35:20Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/PaymentsInfoActivity.kt", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.edx.mobile.view\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.os.Bundle\n+import android.support.v4.app.Fragment\n+import de.greenrobot.event.EventBus\n+import org.edx.mobile.base.BaseSingleFragmentActivity\n+import org.edx.mobile.event.CourseUpgradedEvent\n+import org.edx.mobile.model.api.CourseUpgradeResponse\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.analytics.Analytics\n+import org.edx.mobile.view.Router.EXTRA_COURSE_DATA\n+import org.edx.mobile.view.Router.EXTRA_COURSE_UPGRADE_DATA\n+\n+class PaymentsInfoActivity : BaseSingleFragmentActivity() {\n+    companion object {\n+        fun newIntent(context: Context, courseData: EnrolledCoursesResponse, courseUpgrade: CourseUpgradeResponse): Intent {\n+            val intent = Intent(context, PaymentsInfoActivity::class.java)\n+            intent.putExtra(EXTRA_COURSE_DATA, courseData)\n+            intent.putExtra(EXTRA_COURSE_UPGRADE_DATA, courseUpgrade)\n+            return intent\n+        }\n+    }\n+\n+    override fun getToolbarLayoutId(): Int {\n+        return -1\n+    }\n+\n+    override fun getFirstFragment(): Fragment {\n+        val extras = intent.extras\n+        if (extras == null) {\n+            throw IllegalArgumentException()\n+        } else {\n+            return PaymentsInfoFragment.newInstance(extras)\n+        }\n+    }\n+\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        environment.analyticsRegistry.trackScreenView(Analytics.Screens.PAYMENTS_INFO_SCREEN)\n+    }\n+\n+    fun onEvent(event: CourseUpgradedEvent?) {\n+        finish()\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().removeStickyEvent(CourseUpgradedEvent::class.java)\n+    }", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUyNjc0Nw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374526747", "bodyText": "basketUrl can be null so this should be var basketUrl: String?", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T08:19:07Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/model/api/CourseUpgradeResponse.kt", "diffHunk": "@@ -0,0 +1,38 @@\n+package org.edx.mobile.model.api\n+\n+import android.os.Parcel\n+import android.os.Parcelable\n+import com.google.gson.annotations.SerializedName\n+\n+class CourseUpgradeResponse(source: Parcel) : Parcelable {\n+    @SerializedName(\"show_upsell\")\n+    var showUpsell: Boolean = false\n+\n+    @SerializedName(\"price\")\n+    var price: String? = null\n+\n+    @SerializedName(\"basket_url\")\n+    var basketUrl: String", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0OTgwNg==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374649806", "bodyText": "done", "author": "farhan", "createdAt": "2020-02-04T12:46:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUyNjc0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU2MDM0Mw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374560343", "bodyText": "IMO, this layout direction should be ltr, because we don't have the RTL design for now.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T09:32:43Z", "path": "OpenEdXMobile/res/layout/fragment_payments_info.xml", "diffHunk": "@@ -0,0 +1,124 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NDk0MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374644941", "bodyText": "done", "author": "farhan", "createdAt": "2020-02-04T12:36:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU2MDM0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3MDMzOA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374570338", "bodyText": "this anim need to removed not use anywhere.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T09:51:57Z", "path": "OpenEdXMobile/res/anim/slide_down.xml", "diffHunk": "@@ -0,0 +1,8 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0Mzk5OA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374643998", "bodyText": "done", "author": "farhan", "createdAt": "2020-02-04T12:34:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3MDMzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NjgwNA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374576804", "bodyText": "icon is different from the available design.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:04:16Z", "path": "OpenEdXMobile/res/layout/fragment_locked_course_unit.xml", "diffHunk": "@@ -0,0 +1,90 @@\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:background=\"@color/white\"\n+        android:gravity=\"center\"\n+        android:orientation=\"vertical\">\n+\n+        <ScrollView\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"0dp\"\n+            android:layout_weight=\"1\">\n+\n+            <LinearLayout\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:orientation=\"vertical\">\n+\n+                <android.support.constraint.ConstraintLayout\n+                    android:layout_width=\"match_parent\"\n+                    android:layout_height=\"wrap_content\"\n+                    android:background=\"@drawable/payment_blue_bg_2\"\n+                    android:paddingLeft=\"@dimen/edx_margin\"\n+                    android:paddingTop=\"@dimen/edx_double_margin\"\n+                    android:paddingRight=\"@dimen/edx_margin\"\n+                    android:paddingBottom=\"@dimen/edx_double_margin\">\n+\n+                    <org.edx.mobile.view.custom.IconImageViewXml\n+                        android:id=\"@+id/lock\"\n+                        android:layout_width=\"@dimen/fa_xxx_large\"\n+                        android:layout_height=\"@dimen/fa_xxx_large\"\n+                        app:iconColor=\"@color/white\"\n+                        app:iconName=\"fa-lock\"", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0MzU0Mg==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374643542", "bodyText": "Its acceptable on the story", "author": "farhan", "createdAt": "2020-02-04T12:33:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NjgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NzMxMw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374577313", "bodyText": "Need auto-formate.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:05:18Z", "path": "OpenEdXMobile/res/layout/fragment_locked_course_unit.xml", "diffHunk": "@@ -0,0 +1,90 @@\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0MzMzNQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374643335", "bodyText": "done", "author": "farhan", "createdAt": "2020-02-04T12:32:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NzMxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4MzA3Nw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374583077", "bodyText": "Need to remove extra line.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:16:23Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/module/analytics/Analytics.java", "diffHunk": "@@ -670,6 +682,8 @@ void trackCastDeviceConnectionChanged(@NonNull String eventName, @NonNull String\n         String REGISTRATION_SUCCESS = \"Registration Success\";\n         String COURSE_ENROLL_CLICKED = \"Course Enroll Clicked\";\n         String COURSE_ENROLL_SUCCESS = \"Course Enroll Success\";\n+        String COURSE_UPGRADE_SUCCESS = \"Course Upgrade Success\";\n+", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0MzE0MA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374643140", "bodyText": "done", "author": "farhan", "createdAt": "2020-02-04T12:32:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4MzA3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4ODQ0OA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374588448", "bodyText": "Need to remove redundant cast.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:26:51Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseBaseActivity.java", "diffHunk": "@@ -104,12 +106,14 @@ protected void onDestroy() {\n     public void onSaveInstanceState(Bundle outState) {\n         super.onSaveInstanceState(outState);\n         outState.putSerializable(Router.EXTRA_COURSE_DATA, courseData);\n+        outState.putParcelable(Router.EXTRA_COURSE_UPGRADE_DATA, courseUpgradeData);\n         outState.putString(Router.EXTRA_COURSE_COMPONENT_ID, courseComponentId);\n     }\n \n     protected void restore(Bundle savedInstanceState) {\n         blocksApiVersion = config.getApiUrlVersionConfig().getBlocksApiVersion();\n         courseData = (EnrolledCoursesResponse) savedInstanceState.getSerializable(Router.EXTRA_COURSE_DATA);\n+        courseUpgradeData = (CourseUpgradeResponse) savedInstanceState.getParcelable(Router.EXTRA_COURSE_UPGRADE_DATA);", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0MjkzOA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374642938", "bodyText": "done", "author": "farhan", "createdAt": "2020-02-04T12:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4ODQ0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4OTI5NA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374589294", "bodyText": "Need auto-format.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:28:26Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineActivity.java", "diffHunk": "@@ -1,30 +1,60 @@\n package org.edx.mobile.view;\n \n+import android.app.Activity;\n+import android.content.Intent;\n import android.os.Bundle;\n import android.support.v4.app.Fragment;\n \n import org.edx.mobile.base.BaseSingleFragmentActivity;\n+import org.edx.mobile.event.CourseUpgradedEvent;\n+import org.edx.mobile.model.api.CourseUpgradeResponse;\n import org.edx.mobile.model.api.EnrolledCoursesResponse;\n import org.edx.mobile.module.analytics.Analytics;\n \n+import de.greenrobot.event.EventBus;\n import roboguice.inject.InjectExtra;\n \n+import static org.edx.mobile.view.Router.EXTRA_BUNDLE;\n+import static org.edx.mobile.view.Router.EXTRA_COURSE_COMPONENT_ID;\n+import static org.edx.mobile.view.Router.EXTRA_COURSE_DATA;\n+import static org.edx.mobile.view.Router.EXTRA_COURSE_UPGRADE_DATA;\n+import static org.edx.mobile.view.Router.EXTRA_IS_VIDEOS_MODE;\n+import static org.edx.mobile.view.Router.EXTRA_LAST_ACCESSED_ID;\n+\n public class CourseOutlineActivity extends BaseSingleFragmentActivity {\n-    @InjectExtra(Router.EXTRA_BUNDLE)\n+    @InjectExtra(EXTRA_BUNDLE)\n     private Bundle courseBundle;\n \n-    @InjectExtra(value = Router.EXTRA_COURSE_COMPONENT_ID, optional = true)\n+    @InjectExtra(value = EXTRA_COURSE_COMPONENT_ID, optional = true)\n     private String courseComponentId = null;\n \n-    @InjectExtra(Router.EXTRA_IS_VIDEOS_MODE)\n+    @InjectExtra(EXTRA_IS_VIDEOS_MODE)\n     private boolean isVideoMode = false;\n \n+    public static Intent newIntent(Activity activity,\n+                             EnrolledCoursesResponse courseData,\n+                             CourseUpgradeResponse courseUpgradeData,\n+                             String courseComponentId, String lastAccessedId,\n+                             boolean isVideosMode) {\n+        Bundle courseBundle = new Bundle();\n+        courseBundle.putSerializable(EXTRA_COURSE_DATA, courseData);\n+        courseBundle.putParcelable(EXTRA_COURSE_UPGRADE_DATA, courseUpgradeData);\n+        courseBundle.putString(EXTRA_COURSE_COMPONENT_ID, courseComponentId);\n+\n+        final Intent intent = new Intent(activity, CourseOutlineActivity.class);\n+        intent.putExtra(EXTRA_BUNDLE, courseBundle);\n+        intent.putExtra(EXTRA_LAST_ACCESSED_ID, lastAccessedId);\n+        intent.putExtra(EXTRA_IS_VIDEOS_MODE, isVideosMode);\n+\n+        return intent;\n+    }\n+", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0MjQ2NA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374642464", "bodyText": "done", "author": "farhan", "createdAt": "2020-02-04T12:30:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4OTI5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4OTU2MA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374589560", "bodyText": "courseBundle should be final.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:28:55Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineActivity.java", "diffHunk": "@@ -1,30 +1,60 @@\n package org.edx.mobile.view;\n \n+import android.app.Activity;\n+import android.content.Intent;\n import android.os.Bundle;\n import android.support.v4.app.Fragment;\n \n import org.edx.mobile.base.BaseSingleFragmentActivity;\n+import org.edx.mobile.event.CourseUpgradedEvent;\n+import org.edx.mobile.model.api.CourseUpgradeResponse;\n import org.edx.mobile.model.api.EnrolledCoursesResponse;\n import org.edx.mobile.module.analytics.Analytics;\n \n+import de.greenrobot.event.EventBus;\n import roboguice.inject.InjectExtra;\n \n+import static org.edx.mobile.view.Router.EXTRA_BUNDLE;\n+import static org.edx.mobile.view.Router.EXTRA_COURSE_COMPONENT_ID;\n+import static org.edx.mobile.view.Router.EXTRA_COURSE_DATA;\n+import static org.edx.mobile.view.Router.EXTRA_COURSE_UPGRADE_DATA;\n+import static org.edx.mobile.view.Router.EXTRA_IS_VIDEOS_MODE;\n+import static org.edx.mobile.view.Router.EXTRA_LAST_ACCESSED_ID;\n+\n public class CourseOutlineActivity extends BaseSingleFragmentActivity {\n-    @InjectExtra(Router.EXTRA_BUNDLE)\n+    @InjectExtra(EXTRA_BUNDLE)\n     private Bundle courseBundle;\n \n-    @InjectExtra(value = Router.EXTRA_COURSE_COMPONENT_ID, optional = true)\n+    @InjectExtra(value = EXTRA_COURSE_COMPONENT_ID, optional = true)\n     private String courseComponentId = null;\n \n-    @InjectExtra(Router.EXTRA_IS_VIDEOS_MODE)\n+    @InjectExtra(EXTRA_IS_VIDEOS_MODE)\n     private boolean isVideoMode = false;\n \n+    public static Intent newIntent(Activity activity,\n+                             EnrolledCoursesResponse courseData,\n+                             CourseUpgradeResponse courseUpgradeData,\n+                             String courseComponentId, String lastAccessedId,\n+                             boolean isVideosMode) {\n+        Bundle courseBundle = new Bundle();", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0MjA3MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374642071", "bodyText": "done", "author": "farhan", "createdAt": "2020-02-04T12:29:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4OTU2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU5MDQ5Nw==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374590497", "bodyText": "IMO, first consume the event and then remove it.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:30:47Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineActivity.java", "diffHunk": "@@ -39,4 +69,9 @@ public Fragment getFirstFragment() {\n         fragment.setArguments(getIntent().getExtras());\n         return fragment;\n     }\n+\n+    public void onEvent(CourseUpgradedEvent event) {\n+        EventBus.getDefault().removeStickyEvent(CourseUpgradedEvent.class);", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY1NjI0Mg==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374656242", "bodyText": "as per discussion, code is equally good in this way", "author": "farhan", "createdAt": "2020-02-04T13:01:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU5MDQ5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwMDk0MA==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374600940", "bodyText": "courseData can be removed, this is used only to get the courseId that we can get through courseUnit like the following statement\ncourseUnit.getRoot().getCourseId();\n\nps: please remove the passing of courseData from the paranet activities/fragment too, if not necessory.", "author": "farhan-arshad-dev", "createdAt": "2020-02-04T10:52:12Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseUpgradeWebViewFragment.java", "diffHunk": "@@ -69,9 +88,38 @@ public void onStop() {\n         if (getActivity() != null && authWebView.getWebView() != null) {\n             final String url = authWebView.getWebView().getUrl();\n             if (url != null && url.contains(\"checkout/receipt\")) {\n-                getActivity().finish();\n+                onCoursePaymentSuccessful();\n             }\n+        }\n+    }\n \n+    public void onCoursePaymentSuccessful() {\n+        // Finish activity\n+        final Activity activity = getActivity();\n+        if( activity != null) {\n+            activity.finish();\n+        }\n+\n+        final Bundle arguments = getArguments();\n+        if (arguments != null) {\n+            final EnrolledCoursesResponse courseData =", "originalCommit": "395b5ab72403917ae45491412235f369abce3c48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY1NTg2MQ==", "url": "https://github.com/edx/edx-app-android/pull/1363#discussion_r374655861", "bodyText": "We need it when the user will be redirected from the Course Dashboard screen.", "author": "farhan", "createdAt": "2020-02-04T13:00:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwMDk0MA=="}], "type": "inlineReview"}, {"oid": "41c1a72dd3150bd5ddc586ecc0c016a51a2064d5", "url": "https://github.com/edx/edx-app-android/commit/41c1a72dd3150bd5ddc586ecc0c016a51a2064d5", "message": "Fix sticky notification issue", "committedDate": "2020-02-06T13:21:22Z", "type": "forcePushed"}, {"oid": "3c833d14dc7dd07d09e54b8584eef3e9f84b1b85", "url": "https://github.com/edx/edx-app-android/commit/3c833d14dc7dd07d09e54b8584eef3e9f84b1b85", "message": "Fix sticky notification issue", "committedDate": "2020-02-07T06:45:44Z", "type": "forcePushed"}, {"oid": "44f5ca2b621cc7b7140694fe9c36819d6d7ebca6", "url": "https://github.com/edx/edx-app-android/commit/44f5ca2b621cc7b7140694fe9c36819d6d7ebca6", "message": "Enhance feature based content locking and payment banner experience.\n\n- LEARNER-7549\n- LEARNER-7602", "committedDate": "2020-02-07T14:08:07Z", "type": "forcePushed"}, {"oid": "0a62838502a43612a6b82782314db0360e0bf117", "url": "https://github.com/edx/edx-app-android/commit/0a62838502a43612a6b82782314db0360e0bf117", "message": "Enhance feature based content locking and payment banner experience.\n\n- LEARNER-7549\n- LEARNER-7602\n- LEARNER-7608\ni", "committedDate": "2020-02-07T14:10:23Z", "type": "commit"}, {"oid": "0a62838502a43612a6b82782314db0360e0bf117", "url": "https://github.com/edx/edx-app-android/commit/0a62838502a43612a6b82782314db0360e0bf117", "message": "Enhance feature based content locking and payment banner experience.\n\n- LEARNER-7549\n- LEARNER-7602\n- LEARNER-7608\ni", "committedDate": "2020-02-07T14:10:23Z", "type": "forcePushed"}]}