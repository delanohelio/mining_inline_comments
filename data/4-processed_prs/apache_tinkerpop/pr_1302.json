{"pr_number": 1302, "pr_title": "TINKERPOP-2391 Remove GLV templating system", "pr_createdAt": "2020-07-09T01:47:00Z", "pr_url": "https://github.com/apache/tinkerpop/pull/1302", "timeline": [{"oid": "38ebd9beb7c9f8d71a661c90a1b66683c6c2448d", "url": "https://github.com/apache/tinkerpop/commit/38ebd9beb7c9f8d71a661c90a1b66683c6c2448d", "message": "TINKERPOP-2391 Remove GLV templating system", "committedDate": "2020-07-17T19:46:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExMzE0Ng==", "url": "https://github.com/apache/tinkerpop/pull/1302#discussion_r458113146", "bodyText": "We can do it like this, but I think that we can also just remove the elements FileVersion and AssemblyVersion from the csproj as they are optional and their default values are already what we set here explicitly, e.g., a Version of 3.5.0 leads to both FileVersion and AssemblyVersion being 3.5.0.0 and a Version of 3.5.0-SNAPSHOT also results in 3.5.0.0.\nSo, I think that there is no point in specifying them explicitly in the csproj which means that we don't have to take care off them here.\nFor reference: This blog post explains these version elements and their default values.\nBut we can also keep this as is from my side as it should be working like this. I just thought that I mention it in case you want to simplify this a bit.", "author": "FlorianHockmann", "createdAt": "2020-07-21T13:52:02Z", "path": "gremlin-dotnet/src/pom.xml", "diffHunk": "@@ -33,14 +33,43 @@ limitations under the License.\n \n     <build>\n         <plugins>\n-            <!-- Override the execution from gremlin-dotnet to disable code generation from happening a second time -->\n             <plugin>\n                 <groupId>org.codehaus.gmavenplus</groupId>\n                 <artifactId>gmavenplus-plugin</artifactId>\n+                <dependencies>\n+                    <dependency>\n+                        <groupId>org.codehaus.groovy</groupId>\n+                        <artifactId>groovy-all</artifactId>\n+                        <version>${groovy.version}</version>\n+                        <type>pom</type>\n+                        <scope>runtime</scope>\n+                    </dependency>\n+                </dependencies>\n                 <executions>\n                     <execution>\n-                        <id>generate-dsl</id>\n-                        <phase/>\n+                        <id>update-version</id>\n+                        <phase>generate-sources</phase>\n+                        <goals>\n+                            <goal>execute</goal>\n+                        </goals>\n+                        <configuration>\n+                            <scripts>\n+                                <script>\n+def mavenVersion = \"${project.version}\"\n+def rawVersion = mavenVersion.replace(\"-SNAPSHOT\", \"\")\n+def file = new File(\"${project.basedir}/Gremlin.Net/Gremlin.Net.csproj\")\n+file.write(file.getText(\"UTF-8\").replaceFirst(/&lt;Version&gt;(.*)&lt;\\/Version&gt;/, \"&lt;Version&gt;\" + mavenVersion + \"&lt;/Version&gt;\").\n+                                 replaceFirst(/&lt;FileVersion&gt;(.*)&lt;\\/FileVersion&gt;/, \"&lt;FileVersion&gt;\" + rawVersion + \".0&lt;/FileVersion&gt;\").", "originalCommit": "38ebd9beb7c9f8d71a661c90a1b66683c6c2448d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg1MTU2OQ==", "url": "https://github.com/apache/tinkerpop/pull/1302#discussion_r465851569", "bodyText": "thanks for the reference with that blog post. amazing how many \"versions\" .net has. wow. i opted to remove the two elements.", "author": "spmallette", "createdAt": "2020-08-05T16:27:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExMzE0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzMjI2NQ==", "url": "https://github.com/apache/tinkerpop/pull/1302#discussion_r458132265", "bodyText": "This looks good to me, but I'm still wondering about the generate-dsl execution at the bottom of this file as that is still using the *.template files.\nBut we can probably completely remove that part now as it seems to have only put the project.version back in the .NET project files in case a release candidate was deployed which might have used a .NET specific version like 3.5.0-rc1.", "author": "FlorianHockmann", "createdAt": "2020-07-21T14:17:30Z", "path": "gremlin-dotnet/src/pom.xml", "diffHunk": "@@ -33,14 +33,43 @@ limitations under the License.\n \n     <build>\n         <plugins>\n-            <!-- Override the execution from gremlin-dotnet to disable code generation from happening a second time -->\n             <plugin>\n                 <groupId>org.codehaus.gmavenplus</groupId>\n                 <artifactId>gmavenplus-plugin</artifactId>\n+                <dependencies>\n+                    <dependency>\n+                        <groupId>org.codehaus.groovy</groupId>\n+                        <artifactId>groovy-all</artifactId>\n+                        <version>${groovy.version}</version>\n+                        <type>pom</type>\n+                        <scope>runtime</scope>\n+                    </dependency>\n+                </dependencies>\n                 <executions>\n                     <execution>\n-                        <id>generate-dsl</id>\n-                        <phase/>\n+                        <id>update-version</id>", "originalCommit": "38ebd9beb7c9f8d71a661c90a1b66683c6c2448d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg1MTE1OA==", "url": "https://github.com/apache/tinkerpop/pull/1302#discussion_r465851158", "bodyText": "wow - i keep missing the template reference. thanks for noticing that. i suppose that my changes here get rid of the ability to do SNAPSHOT style releases to nuget. it doesn't appear as though we've ever done one and I'd venture to say that we never will. We would only ever do an \"rc\" version and we do that by way of a tag in git to capture the commit id from which we release that from (and we don't even bother to commit/push with the pom.xml updated to reflect the \"rc\").\nI think that by not worrying about SNAPSHOTs we can do as you say and remove that \"template\" code in the \"deploy\" segment of the pom. In place of that \"template\" code I've added something to stop the build if the version is in SNAPSHOT. That approach does put it at odds with other GLVs which can support a form of SNAPSHOT but for now I don't think that's a problem.", "author": "spmallette", "createdAt": "2020-08-05T16:27:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzMjI2NQ=="}], "type": "inlineReview"}, {"oid": "3c688c0caeae4e44da67b1555316b785adbb3953", "url": "https://github.com/apache/tinkerpop/commit/3c688c0caeae4e44da67b1555316b785adbb3953", "message": "TINKERPOP-2391 Remove GLV templating system", "committedDate": "2020-08-05T16:26:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk4MjgzOA==", "url": "https://github.com/apache/tinkerpop/pull/1302#discussion_r467982838", "bodyText": "Just a nit, but rawVersion isn't used anywhere so it can be removed here.", "author": "FlorianHockmann", "createdAt": "2020-08-10T15:25:13Z", "path": "gremlin-dotnet/src/pom.xml", "diffHunk": "@@ -33,14 +33,41 @@ limitations under the License.\n \n     <build>\n         <plugins>\n-            <!-- Override the execution from gremlin-dotnet to disable code generation from happening a second time -->\n             <plugin>\n                 <groupId>org.codehaus.gmavenplus</groupId>\n                 <artifactId>gmavenplus-plugin</artifactId>\n+                <dependencies>\n+                    <dependency>\n+                        <groupId>org.codehaus.groovy</groupId>\n+                        <artifactId>groovy-all</artifactId>\n+                        <version>${groovy.version}</version>\n+                        <type>pom</type>\n+                        <scope>runtime</scope>\n+                    </dependency>\n+                </dependencies>\n                 <executions>\n                     <execution>\n-                        <id>generate-dsl</id>\n-                        <phase/>\n+                        <id>update-version</id>\n+                        <phase>generate-sources</phase>\n+                        <goals>\n+                            <goal>execute</goal>\n+                        </goals>\n+                        <configuration>\n+                            <scripts>\n+                                <script>\n+def mavenVersion = \"${project.version}\"\n+def rawVersion = mavenVersion.replace(\"-SNAPSHOT\", \"\")", "originalCommit": "3c688c0caeae4e44da67b1555316b785adbb3953", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "612227f8df41138e0a96b156b22c1bcc26bbc943", "url": "https://github.com/apache/tinkerpop/commit/612227f8df41138e0a96b156b22c1bcc26bbc943", "message": "TINKERPOP-2391 Remove GLV templating system", "committedDate": "2020-08-20T13:14:51Z", "type": "commit"}, {"oid": "612227f8df41138e0a96b156b22c1bcc26bbc943", "url": "https://github.com/apache/tinkerpop/commit/612227f8df41138e0a96b156b22c1bcc26bbc943", "message": "TINKERPOP-2391 Remove GLV templating system", "committedDate": "2020-08-20T13:14:51Z", "type": "forcePushed"}]}