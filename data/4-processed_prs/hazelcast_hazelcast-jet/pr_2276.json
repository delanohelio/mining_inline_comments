{"pr_number": 2276, "pr_title": "Add mixins to all commands to configure address and cluster name", "pr_createdAt": "2020-05-27T14:39:55Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/2276", "timeline": [{"oid": "abf7a7b8d8fe9c1fa80e55d5557044d12d9605be", "url": "https://github.com/hazelcast/hazelcast-jet/commit/abf7a7b8d8fe9c1fa80e55d5557044d12d9605be", "message": "Initial implementation", "committedDate": "2020-05-26T21:46:27Z", "type": "commit"}, {"oid": "9dc722ead5d7a7d073e302eee54fc560791f8042", "url": "https://github.com/hazelcast/hazelcast-jet/commit/9dc722ead5d7a7d073e302eee54fc560791f8042", "message": "add targets mixin for cluster name and addresses", "committedDate": "2020-05-26T21:46:27Z", "type": "commit"}, {"oid": "35429bac42a0629c5d991fd8bf4541408cf3e8f0", "url": "https://github.com/hazelcast/hazelcast-jet/commit/35429bac42a0629c5d991fd8bf4541408cf3e8f0", "message": "test: target option precedence", "committedDate": "2020-05-26T22:10:45Z", "type": "commit"}, {"oid": "ad5872d3e979e19e6f84d9a973e19a66320e271a", "url": "https://github.com/hazelcast/hazelcast-jet/commit/ad5872d3e979e19e6f84d9a973e19a66320e271a", "message": "update description add value format validation", "committedDate": "2020-05-26T22:46:12Z", "type": "commit"}, {"oid": "b597ff130081c2575eef788aa5875041ba01f053", "url": "https://github.com/hazelcast/hazelcast-jet/commit/b597ff130081c2575eef788aa5875041ba01f053", "message": "fix style", "committedDate": "2020-05-27T14:39:20Z", "type": "commit"}, {"oid": "b597ff130081c2575eef788aa5875041ba01f053", "url": "https://github.com/hazelcast/hazelcast-jet/commit/b597ff130081c2575eef788aa5875041ba01f053", "message": "fix style", "committedDate": "2020-05-27T14:39:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MTYwMA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2276#discussion_r431671600", "bodyText": "I think we still need to keep these, as this is a breaking change. You can mark them as deprecated", "author": "cangencer", "createdAt": "2020-05-28T08:34:59Z", "path": "hazelcast-jet-all/src/main/java/com/hazelcast/jet/server/JetCommandLine.java", "diffHunk": "@@ -96,30 +99,14 @@\n     @Option(names = {\"-f\", \"--config\"},\n             description = \"Optional path to a client config XML/YAML file.\" +\n                     \" The default is to use config/hazelcast-client.yaml.\" +\n-                    \" If you set this option, Jet will ignore the --addresses and --cluster-name options.\",\n+                    \" If you set this option, Jet will ignore the --targets option.\",\n             order = 0\n     )\n     private File config;\n \n-    @Option(names = {\"-a\", \"--addresses\"},\n-            split = \",\",\n-            arity = \"1..*\",\n-            paramLabel = \"<hostname>:<port>\",\n-            description = \"Optional comma-separated list of Jet node addresses in the format\" +\n-                    \" <hostname>:<port>, if you want to connect to a cluster other than the\" +\n-                    \" one configured in the configuration file\",\n-            order = 1\n-    )\n-    private List<String> addresses;", "originalCommit": "b597ff130081c2575eef788aa5875041ba01f053", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4916f0c21ccaca02f003160cfde73b5beb9320fa", "url": "https://github.com/hazelcast/hazelcast-jet/commit/4916f0c21ccaca02f003160cfde73b5beb9320fa", "message": "keep deprecated options compatibility", "committedDate": "2020-06-02T12:17:25Z", "type": "commit"}, {"oid": "3d5d03a58277e2a57e3ccbdddf60360e799ca752", "url": "https://github.com/hazelcast/hazelcast-jet/commit/3d5d03a58277e2a57e3ccbdddf60360e799ca752", "message": "update references of options on docs", "committedDate": "2020-06-15T21:17:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwMTIyNg==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2276#discussion_r441601226", "bodyText": "Make cluster-name optional", "author": "frant-hartm", "createdAt": "2020-06-17T14:44:44Z", "path": "hazelcast-jet-all/src/main/java/com/hazelcast/jet/server/JetCommandLine.java", "diffHunk": "@@ -555,6 +590,59 @@ void merge(Verbosity other) {\n         }\n     }\n \n+    public static class TargetsMixin {\n+\n+        @Option(names = {\"-t\", \"--targets\"},\n+                description = \"The cluster name and addresses to use if you want to connect to a \"\n+                    + \"cluster other than the one configured in the configuration file.\",\n+                paramLabel = \"<cluster-name>@<hostname>:<port>[,<hostname>:<port>]\",", "originalCommit": "3d5d03a58277e2a57e3ccbdddf60360e799ca752", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwMjI0MQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2276#discussion_r441602241", "bodyText": "Use more descriptive name. It is not immediately obvious if the option before or after command takes precedence.", "author": "frant-hartm", "createdAt": "2020-06-17T14:46:02Z", "path": "hazelcast-jet-all/src/test/java/com/hazelcast/jet/server/JetCommandLineTest.java", "diffHunk": "@@ -483,6 +484,72 @@ public void test_submit_argsPassing() {\n         assertTrueEventually(() -> assertContains(captureOut(), \" with arguments [--jobOption, fooValue]\"));\n     }\n \n+    @Test\n+    public void testTargetsMixin() {\n+        String target = \"foobar@127.0.0.1:5701,127.0.0.1:5702\";\n+\n+        testTargetsCommand(\"cancel\", \"-t\", target, \"jobName\");\n+        testTargetsCommand(\"-t\", target, \"cancel\", \"jobName\");\n+\n+        testTargetsCommand(\"cluster\", \"-t\", target);\n+        testTargetsCommand(\"-t\", target, \"cluster\");\n+\n+        testTargetsCommand(\"delete-snapshot\", \"snapshotName\", \"-t\", target);\n+        testTargetsCommand(\"-t\", target, \"delete-snapshot\", \"snapshotName\");\n+\n+        testTargetsCommand(\"list-jobs\", \"-t\", target);\n+        testTargetsCommand(\"-t\", target, \"list-jobs\");\n+\n+        testTargetsCommand(\"list-snapshots\", \"-t\", target);\n+        testTargetsCommand(\"-t\", target, \"list-snapshots\");\n+\n+        testTargetsCommand(\"restart\", \"jobName\", \"-t\", target);\n+        testTargetsCommand(\"-t\", target, \"restart\", \"jobName\");\n+\n+        testTargetsCommand(\"resume\", \"jobName\", \"-t\", target);\n+        testTargetsCommand(\"-t\", target, \"resume\", \"jobName\");\n+\n+        testTargetsCommand(\"save-snapshot\", \"jobName\", \"snapshotName\", \"-t\", target);\n+        testTargetsCommand(\"-t\", target, \"save-snapshot\", \"jobName\", \"snapshotName\");\n+\n+        testTargetsCommand(\"submit\", \"-t\", target, testJobJarFile.toString());\n+        testTargetsCommand(\"-t\", target, \"submit\", testJobJarFile.toString());\n+\n+        testTargetsCommand(\"suspend\", \"jobName\", \"-t\", target);\n+        testTargetsCommand(\"-t\", target, \"suspend\", \"jobName\");\n+    }\n+\n+    @Test\n+    public void testTargetsPrecedence() {", "originalCommit": "3d5d03a58277e2a57e3ccbdddf60360e799ca752", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "424ddabeb18a8d5ddc52e85a7c1950380d3300e2", "url": "https://github.com/hazelcast/hazelcast-jet/commit/424ddabeb18a8d5ddc52e85a7c1950380d3300e2", "message": "Make cluster name optional", "committedDate": "2020-06-25T07:25:16Z", "type": "commit"}, {"oid": "5c443929cee13c17eb9c4d0838044e5a5074d25d", "url": "https://github.com/hazelcast/hazelcast-jet/commit/5c443929cee13c17eb9c4d0838044e5a5074d25d", "message": "Update docs", "committedDate": "2020-06-25T07:28:15Z", "type": "commit"}, {"oid": "32e1b3f773641038620d1c5dcbfa5d66fdd215d2", "url": "https://github.com/hazelcast/hazelcast-jet/commit/32e1b3f773641038620d1c5dcbfa5d66fdd215d2", "message": "Merge branch 'master' into pull/2276", "committedDate": "2020-06-25T07:28:37Z", "type": "commit"}, {"oid": "3e033b2cf261f5c7262db7526b2d152431154235", "url": "https://github.com/hazelcast/hazelcast-jet/commit/3e033b2cf261f5c7262db7526b2d152431154235", "message": "Update docker docs", "committedDate": "2020-06-25T07:36:07Z", "type": "commit"}, {"oid": "68c51b8e127dcd8b05395386113d55f4cd3e4a31", "url": "https://github.com/hazelcast/hazelcast-jet/commit/68c51b8e127dcd8b05395386113d55f4cd3e4a31", "message": "Merge branch 'master' into pull/2276", "committedDate": "2020-06-25T08:59:53Z", "type": "commit"}, {"oid": "93183069825c66e603cd81eae558612c978efa85", "url": "https://github.com/hazelcast/hazelcast-jet/commit/93183069825c66e603cd81eae558612c978efa85", "message": "Fix optional cluster name syntax in help", "committedDate": "2020-06-25T09:28:27Z", "type": "commit"}, {"oid": "6882d53a0e5cff46a3881581c50339e69862a103", "url": "https://github.com/hazelcast/hazelcast-jet/commit/6882d53a0e5cff46a3881581c50339e69862a103", "message": "Remove default cluster name from -t parameter in docs", "committedDate": "2020-06-25T09:31:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ0MjYzOA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2276#discussion_r445442638", "bodyText": "should point to the replaced command", "author": "cangencer", "createdAt": "2020-06-25T09:53:12Z", "path": "hazelcast-jet-all/src/main/java/com/hazelcast/jet/server/JetCommandLine.java", "diffHunk": "@@ -105,22 +109,25 @@\n             split = \",\",\n             arity = \"1..*\",\n             paramLabel = \"<hostname>:<port>\",\n-            description = \"Optional comma-separated list of Jet node addresses in the format\" +\n+            description = \"[DEPRECATED] Optional comma-separated list of Jet node addresses in the format\" +\n                     \" <hostname>:<port>, if you want to connect to a cluster other than the\" +\n                     \" one configured in the configuration file\",\n             order = 1\n     )\n     private List<String> addresses;\n \n     @Option(names = {\"-n\", \"--cluster-name\"},\n-            description = \"The cluster name to use when connecting to the cluster \" +\n-                    \"specified by the <addresses> parameter. \",\n-            defaultValue = \"jet\",\n-            showDefaultValue = Visibility.ALWAYS,\n-            order = 2\n+        description = \"[DEPRECATED] The cluster name to use when connecting to the cluster \" +\n+            \"specified by the <addresses> parameter. \",", "originalCommit": "6882d53a0e5cff46a3881581c50339e69862a103", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cc885b055397e552f40d23031f7f39f8deab6e44", "url": "https://github.com/hazelcast/hazelcast-jet/commit/cc885b055397e552f40d23031f7f39f8deab6e44", "message": "Point to the new option for deprecated options.", "committedDate": "2020-06-25T10:23:11Z", "type": "commit"}, {"oid": "0703b32fd8227d1854494dc751c467d18693baa1", "url": "https://github.com/hazelcast/hazelcast-jet/commit/0703b32fd8227d1854494dc751c467d18693baa1", "message": "Remove unused import", "committedDate": "2020-06-26T12:49:39Z", "type": "commit"}]}