{"pr_number": 2725, "pr_title": "Fix SqlResult.close when there are no rows", "pr_createdAt": "2020-12-02T16:50:41Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/2725", "timeline": [{"oid": "063a55daeda87d6e651534912a8ec7696711a597", "url": "https://github.com/hazelcast/hazelcast-jet/commit/063a55daeda87d6e651534912a8ec7696711a597", "message": "Fix SqlResult.close when there are no rows\n\nThe RootResultConsumerSink didn't check the status when it had no items\nin the inbox.", "committedDate": "2020-12-02T16:50:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDc5MDc4Mw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2725#discussion_r534790783", "bodyText": "Can't we use simply TestBatchSqlConnector with zero items?", "author": "gierlachg", "createdAt": "2020-12-03T07:18:51Z", "path": "hazelcast-jet-sql/src/test/java/com/hazelcast/jet/sql/impl/connector/test/TestEmptyStreamSqlConnector.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.sql.impl.connector.test;\n+\n+import com.hazelcast.jet.core.DAG;\n+import com.hazelcast.jet.core.TestProcessors.MockP;\n+import com.hazelcast.jet.core.Vertex;\n+import com.hazelcast.jet.sql.impl.connector.SqlConnector;\n+import com.hazelcast.jet.sql.impl.schema.JetTable;\n+import com.hazelcast.jet.sql.impl.schema.MappingField;\n+import com.hazelcast.spi.impl.NodeEngine;\n+import com.hazelcast.sql.impl.QueryException;\n+import com.hazelcast.sql.impl.expression.Expression;\n+import com.hazelcast.sql.impl.schema.ConstantTableStatistics;\n+import com.hazelcast.sql.impl.schema.Table;\n+import com.hazelcast.sql.impl.schema.TableField;\n+import com.hazelcast.sql.impl.type.QueryDataType;\n+\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static com.hazelcast.jet.impl.util.Util.toList;\n+import static java.util.Collections.singletonList;\n+\n+/**\n+ * A connector for SQL that has a single column `v` of type BIGINT, is a\n+ * streaming type, but never produces any items..\n+ */\n+public class TestEmptyStreamSqlConnector implements SqlConnector {", "originalCommit": "063a55daeda87d6e651534912a8ec7696711a597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDgyNDYyNQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2725#discussion_r534824625", "bodyText": "Nope, that would complete. I want it to get stuck waiting for more items.", "author": "viliam-durina", "createdAt": "2020-12-03T07:39:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDc5MDc4Mw=="}], "type": "inlineReview"}, {"oid": "1d496b531e006e540fef6d4f37a8b9bea00d6f0a", "url": "https://github.com/hazelcast/hazelcast-jet/commit/1d496b531e006e540fef6d4f37a8b9bea00d6f0a", "message": "Merge remote-tracking branch 'remotes/hazelcast/master' into sqlresult-close-fix", "committedDate": "2020-12-09T15:58:17Z", "type": "commit"}, {"oid": "aa8400f2fbabdd69c66cf492940d08933ac66920", "url": "https://github.com/hazelcast/hazelcast-jet/commit/aa8400f2fbabdd69c66cf492940d08933ac66920", "message": "Fix test failure", "committedDate": "2020-12-09T16:04:10Z", "type": "commit"}]}