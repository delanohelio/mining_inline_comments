{"pr_number": 1945, "pr_title": "Add test for durable subscriber", "pr_createdAt": "2020-02-07T16:12:00Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/1945", "timeline": [{"oid": "9f151736bbbe7f1371f1370c0e3ea8c58d6c5edb", "url": "https://github.com/hazelcast/hazelcast-jet/commit/9f151736bbbe7f1371f1370c0e3ea8c58d6c5edb", "message": "Add test for durable subscriber\n\nFixes #1930", "committedDate": "2020-02-07T16:10:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQ5NjA2Nw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1945#discussion_r376496067", "bodyText": "can this throw?", "author": "cangencer", "createdAt": "2020-02-07T16:50:46Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/StreamJmsP.java", "diffHunk": "@@ -230,8 +230,12 @@ protected void restoreFromSnapshot(@Nonnull Object key, @Nonnull Object value) {\n \n     @Override\n     public void close() throws Exception {\n-        consumer.close();\n-        session.close();\n+        if (consumer != null) {\n+            consumer.close();", "originalCommit": "9f151736bbbe7f1371f1370c0e3ea8c58d6c5edb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMzc5MQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1945#discussion_r376503791", "bodyText": "yes, \"due to some internal error\", as the javadoc says. If it throws, we won't throw the session, but we'll throw the connection in the PSupplier, which should close everything...", "author": "viliam-durina", "createdAt": "2020-02-07T17:06:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQ5NjA2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQ5Njg2MQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1945#discussion_r376496861", "bodyText": "I frequently see that we always keep adding parameters to test in this way and it makes it harder to read the test with a lot of conditional logic inside. It would be better if they were refactored in a way that would avoid conditional test logic.", "author": "cangencer", "createdAt": "2020-02-07T16:52:21Z", "path": "hazelcast-jet-core/src/test/java/com/hazelcast/jet/impl/connector/JmsIntegrationTestBase.java", "diffHunk": "@@ -383,33 +384,50 @@ public void sinkTopic_whenBuilder_withParameters() throws JMSException {\n \n     @Test\n     public void stressTest_exactlyOnce_forceful() throws Exception {\n-        stressTest(false, EXACTLY_ONCE);\n+        stressTest(false, EXACTLY_ONCE, false);\n     }\n \n     @Test\n     public void stressTest_exactlyOnce_graceful() throws Exception {\n-        stressTest(true, EXACTLY_ONCE);\n+        stressTest(true, EXACTLY_ONCE, false);\n     }\n \n     @Test\n     public void stressTest_atLeastOnce_forceful() throws Exception {\n-        stressTest(false, AT_LEAST_ONCE);\n+        stressTest(false, AT_LEAST_ONCE, false);\n     }\n \n     @Test\n     public void stressTest_noGuarantee_forceful() throws Exception {\n-        stressTest(false, NONE);\n+        stressTest(false, NONE, false);\n     }\n \n-    private void stressTest(boolean graceful, ProcessingGuarantee maxGuarantee)\n+    @Test\n+    public void stressTest_exactlyOnce_forceful_durableTopic() throws Exception {\n+        stressTest(false, EXACTLY_ONCE, true);\n+    }\n+\n+    private void stressTest(boolean graceful, ProcessingGuarantee maxGuarantee, boolean useTopic)", "originalCommit": "9f151736bbbe7f1371f1370c0e3ea8c58d6c5edb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}