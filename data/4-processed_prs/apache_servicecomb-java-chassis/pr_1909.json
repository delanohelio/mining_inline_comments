{"pr_number": 1909, "pr_title": "[SCB-2057] set the AppId, ServiceName, Version information by reading\u2026", "pr_createdAt": "2020-08-04T08:05:52Z", "pr_url": "https://github.com/apache/servicecomb-java-chassis/pull/1909", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMzM4MQ==", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1909#discussion_r465413381", "bodyText": "version check can be done in setter, or easily missed checking when setting. e.g. for environment, this check is missed.", "author": "liubao68", "createdAt": "2020-08-05T01:07:30Z", "path": "foundations/foundation-registry/src/main/java/org/apache/servicecomb/registry/api/registry/MicroserviceFactory.java", "diffHunk": "@@ -49,14 +54,33 @@ public Microservice create(MicroserviceDefinition microserviceDefinition) {\n \n   private Microservice createMicroserviceFromDefinition(Configuration configuration) {\n     Microservice microservice = new Microservice();\n-    microservice.setServiceName(configuration.getString(CONFIG_QUALIFIED_MICROSERVICE_NAME_KEY,\n-        DEFAULT_MICROSERVICE_NAME));\n-    microservice.setAppId(configuration.getString(CONFIG_APPLICATION_ID_KEY, DefinitionConst.DEFAULT_APPLICATION_ID));\n-    String version = configuration.getString(CONFIG_QUALIFIED_MICROSERVICE_VERSION_KEY,\n-        DefinitionConst.DEFAULT_MICROSERVICE_VERSION);\n-    // just check version format\n-    new Version(version);\n-    microservice.setVersion(version);\n+\n+    EnvironmentConfiguration envConfig = new EnvironmentConfiguration();\n+    if (!StringUtils.isEmpty(envConfig.getString(APP_MAPPING)) &&\n+        !StringUtils.isEmpty(envConfig.getString(envConfig.getString(APP_MAPPING)))) {\n+      microservice.setAppId(envConfig.getString(envConfig.getString(APP_MAPPING)));\n+    } else {\n+      microservice.setAppId(configuration\n+          .getString(CONFIG_APPLICATION_ID_KEY, DefinitionConst.DEFAULT_APPLICATION_ID));\n+    }\n+    if (!StringUtils.isEmpty(envConfig.getString(SERVICE_MAPPING)) &&\n+        !StringUtils.isEmpty(envConfig.getString(envConfig.getString(SERVICE_MAPPING)))) {\n+      microservice.setServiceName(envConfig.getString(envConfig.getString(SERVICE_MAPPING)));\n+    } else {\n+      microservice.setServiceName(configuration.getString(CONFIG_QUALIFIED_MICROSERVICE_NAME_KEY,\n+          DEFAULT_MICROSERVICE_NAME));\n+    }\n+    if (!StringUtils.isEmpty(envConfig.getString(VERSION_MAPPING)) &&\n+        !StringUtils.isEmpty(envConfig.getString(envConfig.getString(VERSION_MAPPING)))) {\n+      microservice.setVersion(envConfig.getString(envConfig.getString(VERSION_MAPPING)));\n+    } else {\n+      // just check version format\n+      String version = configuration.getString(CONFIG_QUALIFIED_MICROSERVICE_VERSION_KEY,\n+          DefinitionConst.DEFAULT_MICROSERVICE_VERSION);\n+      new Version(version);", "originalCommit": "a038981fd2ec2b9ff88bb1692bbfd9039b2d8486", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTU0Nzc4Nw==", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1909#discussion_r465547787", "bodyText": "done", "author": "GuoYL123", "createdAt": "2020-08-05T08:04:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMzM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjIxNjQ3Mw==", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1909#discussion_r466216473", "bodyText": "in setter will cause jackson parse failed", "author": "GuoYL123", "createdAt": "2020-08-06T07:56:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMzM4MQ=="}], "type": "inlineReview"}, {"oid": "315a5f6b119013fbb4943b09aa35198e80941226", "url": "https://github.com/apache/servicecomb-java-chassis/commit/315a5f6b119013fbb4943b09aa35198e80941226", "message": "[SCB-2057] set the AppId, ServiceName, Version information by reading the environment variable\n\n(cherry picked from commit 9f6c57220fa48cd2f53324124ae0271b5ddae16f)", "committedDate": "2020-08-05T08:02:47Z", "type": "forcePushed"}, {"oid": "4586e3a14383b06a5b16e7a9004d2387a4847a13", "url": "https://github.com/apache/servicecomb-java-chassis/commit/4586e3a14383b06a5b16e7a9004d2387a4847a13", "message": "[SCB-2057] set the AppId, ServiceName, Version information by reading the environment variable\n\n(cherry picked from commit 9f6c57220fa48cd2f53324124ae0271b5ddae16f)", "committedDate": "2020-08-06T07:55:24Z", "type": "commit"}, {"oid": "4586e3a14383b06a5b16e7a9004d2387a4847a13", "url": "https://github.com/apache/servicecomb-java-chassis/commit/4586e3a14383b06a5b16e7a9004d2387a4847a13", "message": "[SCB-2057] set the AppId, ServiceName, Version information by reading the environment variable\n\n(cherry picked from commit 9f6c57220fa48cd2f53324124ae0271b5ddae16f)", "committedDate": "2020-08-06T07:55:24Z", "type": "forcePushed"}]}