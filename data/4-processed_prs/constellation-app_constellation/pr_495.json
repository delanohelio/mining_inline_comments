{"pr_number": 495, "pr_title": "Save graph plugin to include a file path parameter #53", "pr_createdAt": "2020-05-11T04:34:10Z", "pr_url": "https://github.com/constellation-app/constellation/pull/495", "timeline": [{"oid": "6339927e6ac90658d99a7748275954b7e7cb4a4a", "url": "https://github.com/constellation-app/constellation/commit/6339927e6ac90658d99a7748275954b7e7cb4a4a", "message": "Update SaveGraphPlugin.java", "committedDate": "2020-05-11T04:28:55Z", "type": "commit"}, {"oid": "c7f10f6ba39cc067e5949764fbc631982a8379bf", "url": "https://github.com/constellation-app/constellation/commit/c7f10f6ba39cc067e5949764fbc631982a8379bf", "message": "Merge branch 'master' into SaveGraph-plugin-to-include-a-file-path-parameter-#53", "committedDate": "2020-05-11T04:29:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc5NTI1NQ==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r422795255", "bodyText": "More a personal preference but maybe naming it \"saveFilePath\"? Up to you there", "author": "antares1470", "createdAt": "2020-05-11T05:49:41Z", "path": "CoreInteractiveGraph/src/au/gov/asd/tac/constellation/graph/interaction/plugins/io/SaveGraphPlugin.java", "diffHunk": "@@ -42,30 +46,49 @@\n public class SaveGraphPlugin extends SimplePlugin {\n \n     public static final String GRAPH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, \"graphId\");\n+    public static final String FILE_PATH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, System.getProperty(\"user.home\"));\n \n     @Override\n     public PluginParameters createParameters() {\n         final PluginParameters parameters = new PluginParameters();\n \n         final PluginParameter<StringParameterValue> graphIdParameter = StringParameterType.build(GRAPH_PARAMETER);\n+        final PluginParameter<StringParameterValue> filePathParameter = StringParameterType.build(FILE_PATH_PARAMETER);\n         graphIdParameter.setName(\"graphId\");\n         graphIdParameter.setDescription(\"The Id of the graph\");\n         parameters.addParameter(graphIdParameter);\n+        filePathParameter.setName(\"SaveGraphPluginFilePath\");", "originalCommit": "c7f10f6ba39cc067e5949764fbc631982a8379bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk3MDEwMQ==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r422970101", "bodyText": "And separate it from graphIdParameter - they should be in distinct blocks for readablitily.", "author": "cygnus-x-1", "createdAt": "2020-05-11T11:22:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc5NTI1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk3MDQ1OQ==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r422970459", "bodyText": "It also doesn't look like you're adding it to the parameters object?", "author": "cygnus-x-1", "createdAt": "2020-05-11T11:22:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc5NTI1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc5NTU0Mg==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r422795542", "bodyText": "can be made final", "author": "antares1470", "createdAt": "2020-05-11T05:50:33Z", "path": "CoreInteractiveGraph/src/au/gov/asd/tac/constellation/graph/interaction/plugins/io/SaveGraphPlugin.java", "diffHunk": "@@ -42,30 +46,49 @@\n public class SaveGraphPlugin extends SimplePlugin {\n \n     public static final String GRAPH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, \"graphId\");\n+    public static final String FILE_PATH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, System.getProperty(\"user.home\"));\n \n     @Override\n     public PluginParameters createParameters() {\n         final PluginParameters parameters = new PluginParameters();\n \n         final PluginParameter<StringParameterValue> graphIdParameter = StringParameterType.build(GRAPH_PARAMETER);\n+        final PluginParameter<StringParameterValue> filePathParameter = StringParameterType.build(FILE_PATH_PARAMETER);\n         graphIdParameter.setName(\"graphId\");\n         graphIdParameter.setDescription(\"The Id of the graph\");\n         parameters.addParameter(graphIdParameter);\n+        filePathParameter.setName(\"SaveGraphPluginFilePath\");\n+        filePathParameter.setDescription(\"Save Graph Plugin File Path\");\n \n         return parameters;\n     }\n \n     @Override\n     protected void execute(PluginGraphs graphs, PluginInteraction interaction, PluginParameters parameters) throws InterruptedException, PluginException {\n         final Graph g = graphs.getAllGraphs().get(parameters.getStringValue(GRAPH_PARAMETER));\n+        final String filePath = parameters.getStringValue(FILE_PATH_PARAMETER);\n         final GraphNode gn = GraphNode.getGraphNode(g);\n-        SwingUtilities.invokeLater(() -> {\n-            try {\n-                ((VisualGraphTopComponent) gn.getTopComponent()).saveGraph();\n-            } catch (IOException ex) {\n-                Exceptions.printStackTrace(ex);\n+        try {\n+            File fileLocation = new File(filePath);", "originalCommit": "c7f10f6ba39cc067e5949764fbc631982a8379bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc5NTYxMg==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r422795612", "bodyText": "can also be made final", "author": "antares1470", "createdAt": "2020-05-11T05:50:48Z", "path": "CoreInteractiveGraph/src/au/gov/asd/tac/constellation/graph/interaction/plugins/io/SaveGraphPlugin.java", "diffHunk": "@@ -42,30 +46,49 @@\n public class SaveGraphPlugin extends SimplePlugin {\n \n     public static final String GRAPH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, \"graphId\");\n+    public static final String FILE_PATH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, System.getProperty(\"user.home\"));\n \n     @Override\n     public PluginParameters createParameters() {\n         final PluginParameters parameters = new PluginParameters();\n \n         final PluginParameter<StringParameterValue> graphIdParameter = StringParameterType.build(GRAPH_PARAMETER);\n+        final PluginParameter<StringParameterValue> filePathParameter = StringParameterType.build(FILE_PATH_PARAMETER);\n         graphIdParameter.setName(\"graphId\");\n         graphIdParameter.setDescription(\"The Id of the graph\");\n         parameters.addParameter(graphIdParameter);\n+        filePathParameter.setName(\"SaveGraphPluginFilePath\");\n+        filePathParameter.setDescription(\"Save Graph Plugin File Path\");\n \n         return parameters;\n     }\n \n     @Override\n     protected void execute(PluginGraphs graphs, PluginInteraction interaction, PluginParameters parameters) throws InterruptedException, PluginException {\n         final Graph g = graphs.getAllGraphs().get(parameters.getStringValue(GRAPH_PARAMETER));\n+        final String filePath = parameters.getStringValue(FILE_PATH_PARAMETER);\n         final GraphNode gn = GraphNode.getGraphNode(g);\n-        SwingUtilities.invokeLater(() -> {\n-            try {\n-                ((VisualGraphTopComponent) gn.getTopComponent()).saveGraph();\n-            } catch (IOException ex) {\n-                Exceptions.printStackTrace(ex);\n+        try {\n+            File fileLocation = new File(filePath);\n+            if (fileLocation.exists()) {\n+                DataFolder df = DataFolder.findFolder(FileUtil.createFolder(fileLocation));", "originalCommit": "c7f10f6ba39cc067e5949764fbc631982a8379bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc5NTkzOQ==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r422795939", "bodyText": "maybe change this to a log instead", "author": "antares1470", "createdAt": "2020-05-11T05:51:44Z", "path": "CoreInteractiveGraph/src/au/gov/asd/tac/constellation/graph/interaction/plugins/io/SaveGraphPlugin.java", "diffHunk": "@@ -42,30 +46,49 @@\n public class SaveGraphPlugin extends SimplePlugin {\n \n     public static final String GRAPH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, \"graphId\");\n+    public static final String FILE_PATH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, System.getProperty(\"user.home\"));\n \n     @Override\n     public PluginParameters createParameters() {\n         final PluginParameters parameters = new PluginParameters();\n \n         final PluginParameter<StringParameterValue> graphIdParameter = StringParameterType.build(GRAPH_PARAMETER);\n+        final PluginParameter<StringParameterValue> filePathParameter = StringParameterType.build(FILE_PATH_PARAMETER);\n         graphIdParameter.setName(\"graphId\");\n         graphIdParameter.setDescription(\"The Id of the graph\");\n         parameters.addParameter(graphIdParameter);\n+        filePathParameter.setName(\"SaveGraphPluginFilePath\");\n+        filePathParameter.setDescription(\"Save Graph Plugin File Path\");\n \n         return parameters;\n     }\n \n     @Override\n     protected void execute(PluginGraphs graphs, PluginInteraction interaction, PluginParameters parameters) throws InterruptedException, PluginException {\n         final Graph g = graphs.getAllGraphs().get(parameters.getStringValue(GRAPH_PARAMETER));\n+        final String filePath = parameters.getStringValue(FILE_PATH_PARAMETER);\n         final GraphNode gn = GraphNode.getGraphNode(g);\n-        SwingUtilities.invokeLater(() -> {\n-            try {\n-                ((VisualGraphTopComponent) gn.getTopComponent()).saveGraph();\n-            } catch (IOException ex) {\n-                Exceptions.printStackTrace(ex);\n+        try {\n+            File fileLocation = new File(filePath);\n+            if (fileLocation.exists()) {\n+                DataFolder df = DataFolder.findFolder(FileUtil.createFolder(fileLocation));\n+                //Move the GraphNode's data object to the location inputted by the user\n+                gn.getDataObject().move(df);\n+                SwingUtilities.invokeLater(() -> {\n+                    try {\n+                        ((VisualGraphTopComponent) gn.getTopComponent()).saveGraph();\n+                    } catch (IOException ex) {\n+                        Exceptions.printStackTrace(ex);\n+                    }\n+                });\n+            } else {\n+                JOptionPane.showMessageDialog(null, \"Error: Invalid file path parameter\");\n             }\n-        });\n+\n+        } catch (IOException ex) {\n+            Exceptions.printStackTrace(ex);", "originalCommit": "c7f10f6ba39cc067e5949764fbc631982a8379bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk3MTM4OQ==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r422971389", "bodyText": "The second argument here should be a parameter id, not a default value. You can set a default value below using Parameter.setStringValue.", "author": "cygnus-x-1", "createdAt": "2020-05-11T11:24:44Z", "path": "CoreInteractiveGraph/src/au/gov/asd/tac/constellation/graph/interaction/plugins/io/SaveGraphPlugin.java", "diffHunk": "@@ -42,30 +46,49 @@\n public class SaveGraphPlugin extends SimplePlugin {\n \n     public static final String GRAPH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, \"graphId\");\n+    public static final String FILE_PATH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, System.getProperty(\"user.home\"));", "originalCommit": "c7f10f6ba39cc067e5949764fbc631982a8379bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ba2ac47503e2af60b4a384cfb5326351f2a65f42", "url": "https://github.com/constellation-app/constellation/commit/ba2ac47503e2af60b4a384cfb5326351f2a65f42", "message": "Update with suggested changes", "committedDate": "2020-05-11T22:57:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM3MTAzMg==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r423371032", "bodyText": "I think I must have confused you so my apologies :). I was ok with the variable name being filePathParameter (makes sense and matches the string you were building with). I was thinking more changing the name set here from \"SaveGraphPluginFilePath\" to \"saveFilePath\". It keeps the plugin part out of the name which would be consistent with most plugin parameters.", "author": "antares1470", "createdAt": "2020-05-11T23:11:42Z", "path": "CoreInteractiveGraph/src/au/gov/asd/tac/constellation/graph/interaction/plugins/io/SaveGraphPlugin.java", "diffHunk": "@@ -45,20 +46,26 @@\n @NbBundle.Messages(\"SaveGraphPlugin=Save Graph\")\n public class SaveGraphPlugin extends SimplePlugin {\n \n+    private static final Logger LOGGER = Logger.getLogger(SaveGraphPlugin.class.getName());\n+\n     public static final String GRAPH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, \"graphId\");\n-    public static final String FILE_PATH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, System.getProperty(\"user.home\"));\n+    public static final String FILE_PATH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, \"saveFilePathId\");\n \n     @Override\n     public PluginParameters createParameters() {\n         final PluginParameters parameters = new PluginParameters();\n \n         final PluginParameter<StringParameterValue> graphIdParameter = StringParameterType.build(GRAPH_PARAMETER);\n-        final PluginParameter<StringParameterValue> filePathParameter = StringParameterType.build(FILE_PATH_PARAMETER);\n+        final PluginParameter<StringParameterValue> saveFilePath = StringParameterType.build(FILE_PATH_PARAMETER);\n+\n         graphIdParameter.setName(\"graphId\");\n         graphIdParameter.setDescription(\"The Id of the graph\");\n         parameters.addParameter(graphIdParameter);\n-        filePathParameter.setName(\"SaveGraphPluginFilePath\");\n-        filePathParameter.setDescription(\"Save Graph Plugin File Path\");\n+\n+        saveFilePath.setName(\"SaveGraphPluginFilePath\");", "originalCommit": "ba2ac47503e2af60b4a384cfb5326351f2a65f42", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM3MjA0Mw==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r423372043", "bodyText": "Oh right that makes more sense \ud83d\ude06 . I've literally just woken up so that's on me for misunderstanding.", "author": "formalhaut69", "createdAt": "2020-05-11T23:14:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM3MTAzMg=="}], "type": "inlineReview"}, {"oid": "fcf1a2ac3560762da8a3376a5de578aa8487ec32", "url": "https://github.com/constellation-app/constellation/commit/fcf1a2ac3560762da8a3376a5de578aa8487ec32", "message": "Renamed the filePathParameter", "committedDate": "2020-05-11T23:18:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQzMzg0NA==", "url": "https://github.com/constellation-app/constellation/pull/495#discussion_r423433844", "bodyText": "It doesn't matter too much in this case - but generally you want parameter names to be structured as human readable text, ie. \"Save File Path\".", "author": "cygnus-x-1", "createdAt": "2020-05-12T03:01:08Z", "path": "CoreInteractiveGraph/src/au/gov/asd/tac/constellation/graph/interaction/plugins/io/SaveGraphPlugin.java", "diffHunk": "@@ -41,31 +46,56 @@\n @NbBundle.Messages(\"SaveGraphPlugin=Save Graph\")\n public class SaveGraphPlugin extends SimplePlugin {\n \n+    private static final Logger LOGGER = Logger.getLogger(SaveGraphPlugin.class.getName());\n+\n     public static final String GRAPH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, \"graphId\");\n+    public static final String FILE_PATH_PARAMETER = PluginParameter.buildId(SaveGraphPlugin.class, \"saveFilePathId\");\n \n     @Override\n     public PluginParameters createParameters() {\n         final PluginParameters parameters = new PluginParameters();\n \n         final PluginParameter<StringParameterValue> graphIdParameter = StringParameterType.build(GRAPH_PARAMETER);\n+        final PluginParameter<StringParameterValue> filePathParameter = StringParameterType.build(FILE_PATH_PARAMETER);\n+\n         graphIdParameter.setName(\"graphId\");\n         graphIdParameter.setDescription(\"The Id of the graph\");\n         parameters.addParameter(graphIdParameter);\n \n+        filePathParameter.setName(\"saveFilePath\");", "originalCommit": "fcf1a2ac3560762da8a3376a5de578aa8487ec32", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}