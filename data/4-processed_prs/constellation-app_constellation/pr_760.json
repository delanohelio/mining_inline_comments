{"pr_number": 760, "pr_title": ":art: Implement quality categories", "pr_createdAt": "2020-08-04T03:57:57Z", "pr_url": "https://github.com/constellation-app/constellation/pull/760", "timeline": [{"oid": "b3da3b42233c09c5021ec2d6c53768b0879ca1d1", "url": "https://github.com/constellation-app/constellation/commit/b3da3b42233c09c5021ec2d6c53768b0879ca1d1", "message": ":art: Implement quality categories", "committedDate": "2020-08-04T02:18:33Z", "type": "commit"}, {"oid": "9eaef55cd21b690f68c832fe959049d110a8c203", "url": "https://github.com/constellation-app/constellation/commit/9eaef55cd21b690f68c832fe959049d110a8c203", "message": "remove unnecessary code from quality score", "committedDate": "2020-08-04T03:57:28Z", "type": "commit"}, {"oid": "c3ae9cc7c317b007d2669f4638d4c2a2ff0b3915", "url": "https://github.com/constellation-app/constellation/commit/c3ae9cc7c317b007d2669f4638d4c2a2ff0b3915", "message": ":bug: SQ Fixes", "committedDate": "2020-08-04T04:56:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA0MTg2OA==", "url": "https://github.com/constellation-app/constellation/pull/760#discussion_r465041868", "bodyText": "Running this in a static block like this means this bit of code must run when the class is loaded into memory (i.e when Constellation loads). This becomes problematic for a couple of reasons:\n\nConstellation load times will take longer.\nThere is actually a runtime exception that Java throws when there are too many things run in a static block like this and a while back I moved them to be called lazily instead which you can do in getPriorities() with something like:\n\nprivate static Map<QualityControlRule, QualityCategory> rulePriorities = null;\n...\n...\npublic static Map<QualityControlRule, QualityCategory> getPriorities() {\n    if(rulePriorities == null) {\n        for (final QualityControlRule rule : Lookup.getDefault().lookupAll(QualityControlRule.class)) {\n            rulePriorities.put(rule, rule.getCategory(0));\n        }\n    }\n}\n\nreturn rulePriorities;\nFYI the call to Lookup isn't super efficient. For instance I have been able to dramatically shave seconds off the execution just by caching the object returned by Lookup where as it was being called many times (like in for loops in other parts of the app).", "author": "arcturus2", "createdAt": "2020-08-04T13:16:17Z", "path": "CoreQualityControlView/src/au/gov/asd/tac/constellation/views/qualitycontrol/QualityControlViewPane.java", "diffHunk": "@@ -70,38 +79,44 @@\n })\n public final class QualityControlViewPane extends BorderPane {\n \n-    private final QualityControlViewTopComponent parent;\n-    private final TableView<QualityControlEvent> qualityTable;\n+    private static final Map<QualityControlRule, QualityCategory> rulePriorities = new HashMap<>();\n+    private static final List<ToggleGroup> toggleGroups = new ArrayList<>();\n     private final TableColumn<QualityControlEvent, QualityControlEvent> identifierColumn;\n     private final TableColumn<QualityControlEvent, QualityControlEvent> typeColumn;\n     private final TableColumn<QualityControlEvent, QualityControlEvent> qualityColumn;\n     private final TableColumn<QualityControlEvent, QualityControlEvent> reasonColumn;\n+    private final TableView<QualityControlEvent> qualityTable;\n     private final FlowPane optionsPane;\n \n-    public QualityControlViewPane(QualityControlViewTopComponent topComponent) {\n-        this.parent = topComponent;\n+    static {\n+        for (final QualityControlRule rule : Lookup.getDefault().lookupAll(QualityControlRule.class)) {\n+            rulePriorities.put(rule, rule.getCategory(0));\n+        }\n+    }", "originalCommit": "c3ae9cc7c317b007d2669f4638d4c2a2ff0b3915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQzNDMwMQ==", "url": "https://github.com/constellation-app/constellation/pull/760#discussion_r465434301", "bodyText": "Hi @arcturus2 , Thanks for all the feedback! \ud83d\udc4d\n\nWith the custom priorities radio option section, I don't believe this is being persisted into a Preferences object so it looks like changes will be lost after restarting Constellation.\n\nYou are correct, it doesn't currently.\nI've been looking to store it into a preferences object but have hit a snag. I want to store a map into the preferences but have not found a method to set an object into the preferences. it only takes String or numeric values.\nFrom this I've pivoted to converting the map to a json String. I've looked through the utils and haven't found anything out the box. Do you have any suggestions re this or another possible solution?\n\nIt didn't look like any of the \"Rule\" classes like UnknownTypeRule needed any changes; that's interesting and good actually.\n\nIdeally this was what I was going for so I'm glad it all works without needing further extensions to those classes.\n\nCan you please write some unit tests to cover the logic? If you want a hand just let me know and happy to help writing uni tests.\n\n\nThere should be a mention about this change to the users via the whatsnew.txt file informing them that scores are replaced by categories.\n\nI can do these. \ud83c\udf70\n\nRunning this in a static block like this means this bit of code must run when the class is loaded into memory (i.e when Constellation loads).\n\nOhh no worries, I think that should be an easy fix.\n\nFYI the call to Lookup isn't super efficient. For instance I have been able to dramatically shave seconds off the execution just by caching the object returned by Lookup\n\nI could store it into a class level variable, but when would i know to update it? only on instantiation of the view?\nI'll be a little while getting these changes in, and will re-request review once it's all wrapped up.\nOnce again, cheers for taking such an in-depth look at this. \ud83d\ude4f", "author": "aldebaran30701", "createdAt": "2020-08-05T02:25:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA0MTg2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ3MTU3OQ==", "url": "https://github.com/constellation-app/constellation/pull/760#discussion_r465471579", "bodyText": "...From this I've pivoted to converting the map to a json String. I've looked through the utils and haven't found anything out the box. Do you have any suggestions re this or another possible solution?\n\nYep that is how some other preferences work when you need to do more than a String. Have a look at your boostrap folder and then build\\testuserdir\\config\\Preferences\\au\\gov\\asd\\tac\\constellation\\plugins.properties. Its a json string which RecentParameterValues loads and saves.\n\nI could store it into a class level variable, but when would i know to update it? only on instantiation of the view?\nYep that's how I would do it. You should be fine to put it in the class where getPriorities gets called.", "author": "arcturus2", "createdAt": "2020-08-05T04:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA0MTg2OA=="}], "type": "inlineReview"}, {"oid": "30cf1298889d9e8fee4ae9c97a81059fe22f07f2", "url": "https://github.com/constellation-app/constellation/commit/30cf1298889d9e8fee4ae9c97a81059fe22f07f2", "message": "PR Review fixes\n\n *Implemented Preferences object for mapping of categories to rules\n *Added JSON Utilities for writing a Map to String and vice versa.\n *Added entry into `whatsnew.txt`\n *Lazy initialisation over rulePriorities Map\n *Lazy initialisation and caching of lookup object\n\nAdded unit tests for:\n *JSON Utilities\n *QualityControlEvent\n *Quality Control Rule", "committedDate": "2020-08-06T05:09:09Z", "type": "commit"}, {"oid": "b9120f8727f530df0d8f33868a954f03a6915136", "url": "https://github.com/constellation-app/constellation/commit/b9120f8727f530df0d8f33868a954f03a6915136", "message": "replace null check with empty check", "committedDate": "2020-08-07T00:20:48Z", "type": "commit"}, {"oid": "3286c673acfc07c481a381d907080ce0ecc25360", "url": "https://github.com/constellation-app/constellation/commit/3286c673acfc07c481a381d907080ce0ecc25360", "message": "add reset button and resize dialog", "committedDate": "2020-08-10T00:20:18Z", "type": "commit"}]}