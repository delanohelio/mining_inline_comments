{"pr_number": 647, "pr_title": "Feature/issue 574 invalid delimited import", "pr_createdAt": "2020-07-08T05:23:14Z", "pr_url": "https://github.com/constellation-app/constellation/pull/647", "timeline": [{"oid": "e3887b8db35ef88573c084806209da9a7d4bbfe8", "url": "https://github.com/constellation-app/constellation/commit/e3887b8db35ef88573c084806209da9a7d4bbfe8", "message": "Update SourcePane.java\n\nAdded checks for invalid file import selection.", "committedDate": "2020-07-07T01:54:48Z", "type": "commit"}, {"oid": "0fdf467c36c3e44a6dc7761632b8c5e6e47a8642", "url": "https://github.com/constellation-app/constellation/commit/0fdf467c36c3e44a6dc7761632b8c5e6e47a8642", "message": "Update SourcePane.java", "committedDate": "2020-07-07T01:56:52Z", "type": "commit"}, {"oid": "327592a821a9c05f8ef544004c0a1b0ef94b1d3f", "url": "https://github.com/constellation-app/constellation/commit/327592a821a9c05f8ef544004c0a1b0ef94b1d3f", "message": "Update SourcePane.java", "committedDate": "2020-07-07T01:58:45Z", "type": "commit"}, {"oid": "52ee68c0c5f66a016d907cbfa6778b08a1b0e52d", "url": "https://github.com/constellation-app/constellation/commit/52ee68c0c5f66a016d907cbfa6778b08a1b0e52d", "message": "Update SourcePane.java", "committedDate": "2020-07-07T02:04:37Z", "type": "commit"}, {"oid": "e00b11be1fd592f5bb70af5152aa77bc0a419f49", "url": "https://github.com/constellation-app/constellation/commit/e00b11be1fd592f5bb70af5152aa77bc0a419f49", "message": "As much as possible try to avoid issues when swapping between existing file list items if they have been corrupted/deleted under the covers.", "committedDate": "2020-07-07T22:47:18Z", "type": "commit"}, {"oid": "b6278e521866181f54695d863ceaa9687a3b6110", "url": "https://github.com/constellation-app/constellation/commit/b6278e521866181f54695d863ceaa9687a3b6110", "message": "Added common alert dialog handling to be used. Handle invalid files in source list when import is pressed.", "committedDate": "2020-07-08T04:47:27Z", "type": "commit"}, {"oid": "d0ed1241df96ddc172ce6a01c4af777aad3396d8", "url": "https://github.com/constellation-app/constellation/commit/d0ed1241df96ddc172ce6a01c4af777aad3396d8", "message": "Merge branch 'master' into feature/Issue_574-Invalid-Delimited-Import", "committedDate": "2020-07-08T05:24:46Z", "type": "commit"}, {"oid": "512236173af54168b8afcf45485d54c704187fcd", "url": "https://github.com/constellation-app/constellation/commit/512236173af54168b8afcf45485d54c704187fcd", "message": "SonarQube fixes.", "committedDate": "2020-07-08T06:00:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMzMzOQ==", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451303339", "bodyText": "Add Final String warningMsg", "author": "aldebaran30701", "createdAt": "2020-07-08T06:05:59Z", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportController.java", "diffHunk": "@@ -449,9 +470,19 @@ private void updateSampleData() {\n                 currentColumns = new String[columns.length + 1];\n                 System.arraycopy(columns, 0, currentColumns, 1, columns.length);\n                 currentColumns[0] = \"Row\";\n-            } catch (IOException ex) {\n-                final NotifyDescriptor nd = new NotifyDescriptor.Message(ex.getMessage(), NotifyDescriptor.WARNING_MESSAGE);\n-                DialogDisplayer.getDefault().notify(nd);\n+            } catch (FileNotFoundException ex) {\n+                String warningMsg = \"The following file could not be found and has been excluded from the import set:\\n  \" + sampleFile.getPath();", "originalCommit": "512236173af54168b8afcf45485d54c704187fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMzQwMQ==", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451303401", "bodyText": "Add a final", "author": "aldebaran30701", "createdAt": "2020-07-08T06:06:14Z", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportController.java", "diffHunk": "@@ -449,9 +470,19 @@ private void updateSampleData() {\n                 currentColumns = new String[columns.length + 1];\n                 System.arraycopy(columns, 0, currentColumns, 1, columns.length);\n                 currentColumns[0] = \"Row\";\n-            } catch (IOException ex) {\n-                final NotifyDescriptor nd = new NotifyDescriptor.Message(ex.getMessage(), NotifyDescriptor.WARNING_MESSAGE);\n-                DialogDisplayer.getDefault().notify(nd);\n+            } catch (FileNotFoundException ex) {\n+                String warningMsg = \"The following file could not be found and has been excluded from the import set:\\n  \" + sampleFile.getPath();\n+                LOGGER.log(Level.INFO, warningMsg);\n+                displayAlert(\"Invalid file selected\", warningMsg, Alert.AlertType.WARNING);\n+                files.remove(sampleFile);\n+                stage.getSourcePane().removeFile(sampleFile);\n+            }\n+            catch (IOException ex) {\n+                String warningMsg = \"The following file could not be parsed and has been excluded from the import set:\\n  \" + sampleFile.getPath();", "originalCommit": "512236173af54168b8afcf45485d54c704187fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMzkyOQ==", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451303929", "bodyText": "Make parameters final", "author": "aldebaran30701", "createdAt": "2020-07-08T06:07:49Z", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "diffHunk": "@@ -112,6 +115,58 @@ public PluginParameters createParameters() {\n \n         return params;\n     }\n+    \n+    /**\n+     * Build up an import summary dialog detailing successful and unsuccessful file imports.\n+     * \n+     * @param title Title to add to status dialog\n+     * @param importedRows Number of rows successfully imported (from valid files)\n+     * @param validFilenames List of filenames that were imported from\n+     * @param invalidFilenames List of files that couldn't be opened/parsed. We try to limit this possibility by pre-screening\n+     *                         files during the initial file selection.\n+     */\n+    private void displaySummaryAlert(int importedRows, List<String> validFilenames, List<String> invalidFilenames) {", "originalCommit": "512236173af54168b8afcf45485d54c704187fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNDc0OQ==", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451304749", "bodyText": "Make both lists final", "author": "aldebaran30701", "createdAt": "2020-07-08T06:10:23Z", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "diffHunk": "@@ -124,33 +179,50 @@ protected void edit(final GraphWriteMethods graph, final PluginInteraction inter\n         final PluginParameters parserParameters = (PluginParameters) parameters.getParameters().get(PARSER_PARAMETER_IDS_PARAMETER_ID).getObjectValue();\n         final List<Integer> newVertices = new ArrayList<>();\n         boolean positionalAtrributesExist = false;\n+        List<String> validFiles = new ArrayList<>();\n+        List<String> invalidFiles = new ArrayList<>();", "originalCommit": "512236173af54168b8afcf45485d54c704187fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNDg5Mg==", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451304892", "bodyText": "final", "author": "aldebaran30701", "createdAt": "2020-07-08T06:10:42Z", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "diffHunk": "@@ -124,33 +179,50 @@ protected void edit(final GraphWriteMethods graph, final PluginInteraction inter\n         final PluginParameters parserParameters = (PluginParameters) parameters.getParameters().get(PARSER_PARAMETER_IDS_PARAMETER_ID).getObjectValue();\n         final List<Integer> newVertices = new ArrayList<>();\n         boolean positionalAtrributesExist = false;\n+        List<String> validFiles = new ArrayList<>();\n+        List<String> invalidFiles = new ArrayList<>();\n+        int importRows = 0;\n \n         for (final File file : files) {\n             interaction.setProgress(0, 0, \"Reading File: \" + file.getName(), true);\n             List<String[]> data = null;\n+            \n             try {\n                 data = parser.parse(new InputSource(file), parserParameters);\n+                importRows = importRows + data.size() - 1;\n+                validFiles.add(file.getPath());\n+                LOGGER.log(Level.INFO, \"Imported {0} rows of data from file {1}. {2} total rows imported\", new Object[]{(data.size() - 1), file.getPath(), importRows});\n+            } catch (FileNotFoundException ex) {\n+                String errorMsg = file.getPath() + \" could not be found. Ignoring file during import.\";", "originalCommit": "512236173af54168b8afcf45485d54c704187fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNDk0MQ==", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451304941", "bodyText": "final", "author": "aldebaran30701", "createdAt": "2020-07-08T06:10:53Z", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "diffHunk": "@@ -124,33 +179,50 @@ protected void edit(final GraphWriteMethods graph, final PluginInteraction inter\n         final PluginParameters parserParameters = (PluginParameters) parameters.getParameters().get(PARSER_PARAMETER_IDS_PARAMETER_ID).getObjectValue();\n         final List<Integer> newVertices = new ArrayList<>();\n         boolean positionalAtrributesExist = false;\n+        List<String> validFiles = new ArrayList<>();\n+        List<String> invalidFiles = new ArrayList<>();\n+        int importRows = 0;\n \n         for (final File file : files) {\n             interaction.setProgress(0, 0, \"Reading File: \" + file.getName(), true);\n             List<String[]> data = null;\n+            \n             try {\n                 data = parser.parse(new InputSource(file), parserParameters);\n+                importRows = importRows + data.size() - 1;\n+                validFiles.add(file.getPath());\n+                LOGGER.log(Level.INFO, \"Imported {0} rows of data from file {1}. {2} total rows imported\", new Object[]{(data.size() - 1), file.getPath(), importRows});\n+            } catch (FileNotFoundException ex) {\n+                String errorMsg = file.getPath() + \" could not be found. Ignoring file during import.\";\n+                LOGGER.log(Level.INFO, errorMsg);\n+                invalidFiles.add(file.getPath());\n             } catch (IOException ex) {\n-                throw new PluginException(this, PluginNotificationLevel.ERROR, \"Error reading file: \" + file.getName(), ex);\n+                String errorMsg = file.getPath() + \" could not be parsed. Removing file during import.\";", "originalCommit": "512236173af54168b8afcf45485d54c704187fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNTk0MA==", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451305940", "bodyText": "May as well add a final here\nfor (final File file : newFiles) {", "author": "aldebaran30701", "createdAt": "2020-07-08T06:13:54Z", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/SourcePane.java", "diffHunk": "@@ -155,11 +161,24 @@ public SourcePane(final ImportController importController) {\n                     SourcePane.this.importFileParserComboBox.setDisable(true);\n                 }\n                 ObservableList<File> files = FXCollections.observableArrayList(fileListView.getItems());\n+                String warningMsg = \"The following files could not be parsed and have been excluded from import set:\";\n+                boolean foundInvalidFile = false;\n                 for (File file : newFiles) {", "originalCommit": "512236173af54168b8afcf45485d54c704187fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNjcwNQ==", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451306705", "bodyText": "I know this isn't your change but maybe adding a final here?", "author": "aldebaran30701", "createdAt": "2020-07-08T06:15:55Z", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/SourcePane.java", "diffHunk": "@@ -155,11 +161,24 @@ public SourcePane(final ImportController importController) {\n                     SourcePane.this.importFileParserComboBox.setDisable(true);\n                 }\n                 ObservableList<File> files = FXCollections.observableArrayList(fileListView.getItems());", "originalCommit": "512236173af54168b8afcf45485d54c704187fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzI1MA==", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451307250", "bodyText": "final", "author": "aldebaran30701", "createdAt": "2020-07-08T06:17:31Z", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/SourcePane.java", "diffHunk": "@@ -252,6 +268,16 @@ public void setParameters(final PluginParameters parameters) {\n             parametersPane.getChildren().add(pluginParametersPane);\n         }\n     }\n+    \n+    /** Allow a file to be removed from fileListView. This would be triggered by code in InputController if the file\n+     * was found to be missing or invalid - these checks are triggered when a new file is selected in the fileListView.\n+     * @param file The file to remove.\n+     */\n+    public void removeFile(File file) {\n+        ObservableList<File> files = fileListView.getItems();", "originalCommit": "512236173af54168b8afcf45485d54c704187fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9ba441a08914817bc793c64f644c2e0e6b6b749f", "url": "https://github.com/constellation-app/constellation/commit/9ba441a08914817bc793c64f644c2e0e6b6b749f", "message": "aldebaran review comments.", "committedDate": "2020-07-08T07:27:42Z", "type": "commit"}, {"oid": "e4b743b8418bdc2fe98c71027e543388a51485b2", "url": "https://github.com/constellation-app/constellation/commit/e4b743b8418bdc2fe98c71027e543388a51485b2", "message": "Fixed the help icon", "committedDate": "2020-07-09T01:32:02Z", "type": "commit"}, {"oid": "327c2fb2b8a8348e5e1d3955c8899102ebaadb17", "url": "https://github.com/constellation-app/constellation/commit/327c2fb2b8a8348e5e1d3955c8899102ebaadb17", "message": "Merge branch 'master' into feature/Issue_574-Invalid-Delimited-Import", "committedDate": "2020-07-10T12:27:34Z", "type": "commit"}]}