{"pr_number": 438, "pr_title": "Contact Request UI - Part 1", "pr_createdAt": "2020-06-10T15:28:35Z", "pr_url": "https://github.com/dashevo/dash-wallet/pull/438", "timeline": [{"oid": "9a3623ed561ba4d5784d3dc121833a6743fd5168", "url": "https://github.com/dashevo/dash-wallet/commit/9a3623ed561ba4d5784d3dc121833a6743fd5168", "message": "Contact Request UI - Part 1", "committedDate": "2020-06-10T15:27:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQyMTQyOA==", "url": "https://github.com/dashevo/dash-wallet/pull/438#discussion_r438421428", "bodyText": "In my PR the profileDocument is non-nullable and it is assigned a default \"empty\" profile if no profile exists.  In the database, we will be storing the username associated with a profile.\nThis does not need to be changed in this PR.", "author": "HashEngineering", "createdAt": "2020-06-10T21:35:12Z", "path": "wallet/src/de/schildbach/wallet/data/UsernameSearchResult.kt", "diffHunk": "@@ -9,8 +9,10 @@ import org.dashevo.dpp.document.Document\n \n data class UsernameSearchResult(val username: String,\n                                 val domainDocument: Document,\n+                                //TODO: Make non-nullable after profile creation is implemented in iOS\n+                                val profileDocument: Document?,", "originalCommit": "9a3623ed561ba4d5784d3dc121833a6743fd5168", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQyMTY2Mg==", "url": "https://github.com/dashevo/dash-wallet/pull/438#discussion_r438421662", "bodyText": "In my PR, I also renamed these, but I like these names better.", "author": "HashEngineering", "createdAt": "2020-06-10T21:35:43Z", "path": "wallet/src/de/schildbach/wallet/data/UsernameSearchResult.kt", "diffHunk": "@@ -9,8 +9,10 @@ import org.dashevo.dpp.document.Document\n \n data class UsernameSearchResult(val username: String,\n                                 val domainDocument: Document,\n+                                //TODO: Make non-nullable after profile creation is implemented in iOS\n+                                val profileDocument: Document?,\n                                 val toContactRequest: Document?,\n                                 val fromContactRequest: Document?) {\n-    val hasRequested = toContactRequest != null\n-    val hasAccepted = fromContactRequest != null\n+    val requestSent = toContactRequest != null\n+    val requestReceived = fromContactRequest != null", "originalCommit": "9a3623ed561ba4d5784d3dc121833a6743fd5168", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQyODczNw==", "url": "https://github.com/dashevo/dash-wallet/pull/438#discussion_r438428737", "bodyText": "This file might be useful in my Contact Request Row.", "author": "HashEngineering", "createdAt": "2020-06-10T21:52:07Z", "path": "ui-redesign/src/main/res/drawable/medium_gray_button.xml", "diffHunk": "@@ -0,0 +1,21 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<selector xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+    <item android:state_enabled=\"false\">\n+        <shape android:shape=\"rectangle\">\n+            <corners android:radius=\"10dp\" />\n+            <solid android:color=\"@color/dash_light_gray\" />\n+        </shape>\n+    </item>\n+    <item android:state_pressed=\"true\">\n+        <shape android:shape=\"rectangle\">\n+            <corners android:radius=\"10dp\" />\n+            <solid android:color=\"@color/dash_gray\" />\n+        </shape>\n+    </item>\n+    <item>\n+        <shape android:shape=\"rectangle\">\n+            <corners android:radius=\"10dp\" />\n+            <solid android:color=\"@color/dash_medium_gray\" />\n+        </shape>\n+    </item>\n+</selector>", "originalCommit": "9a3623ed561ba4d5784d3dc121833a6743fd5168", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQyOTY4NQ==", "url": "https://github.com/dashevo/dash-wallet/pull/438#discussion_r438429685", "bodyText": "On my PR, I added the username to the profile so there is an associated between userId and username.  I like the fromDocument method which will probably get used a lot.", "author": "HashEngineering", "createdAt": "2020-06-10T21:54:31Z", "path": "wallet/src/de/schildbach/wallet/data/DashPayProfile.kt", "diffHunk": "@@ -1,8 +1,25 @@\n package de.schildbach.wallet.data\n \n+import android.os.Parcelable\n import androidx.room.Entity\n import androidx.room.PrimaryKey\n+import kotlinx.android.parcel.Parcelize\n+import org.dashevo.dpp.document.Document\n \n+@Parcelize\n @Entity(tableName = \"dashpay_profile\")\n data class DashPayProfile(@PrimaryKey val userId: String, val displayName: String,\n-                          val publicMessage: String, val avatarUrl: String)\n\\ No newline at end of file\n+                          val publicMessage: String, val avatarUrl: String) : Parcelable {\n+    companion object {\n+        fun fromDocument(document: Document): DashPayProfile? {\n+            return try {\n+                DashPayProfile(document.userId,\n+                        document.data[\"displayName\"] as String,\n+                        document.data[\"publicMessage\"] as String,\n+                        document.data[\"avatarUrl\"] as String)\n+            } catch (e: Exception) {\n+                null\n+            }\n+        }\n+    }", "originalCommit": "9a3623ed561ba4d5784d3dc121833a6743fd5168", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQzMDQ5Ng==", "url": "https://github.com/dashevo/dash-wallet/pull/438#discussion_r438430496", "bodyText": "This will be used instead of my method in my PR.", "author": "HashEngineering", "createdAt": "2020-06-10T21:56:33Z", "path": "wallet/src/de/schildbach/wallet/ui/HeaderBalanceFragment.java", "diffHunk": "@@ -201,23 +201,8 @@ private void setDefaultUserAvatar(String letters) {\n             return;\n         }\n         dashpayUserAvatar.setVisibility(View.VISIBLE);\n-        float[] hsv = new float[3];\n-        //Ascii codes for A: 65 - Z: 90, 0: 48 - 9: 57\n-        float firstChar = letters.charAt(0);\n-        float charIndex;\n-        if (firstChar <= 57) { //57 == '9' in Ascii table\n-            charIndex = (firstChar - 48f) / 36f; // 48 == '0', 36 == total count of supported\n-        } else {\n-            charIndex = (firstChar - 65f + 10f) / 36f; // 65 == 'A', 10 == count of digits\n-        }\n-        hsv[0] = charIndex * 360f;\n-        hsv[1] = 0.3f;\n-        hsv[2] = 0.6f;\n-        int bgColor = Color.HSVToColor(hsv);\n-        final TextDrawable defaultAvatar = TextDrawable.builder().beginConfig().textColor(Color.WHITE)\n-                .useFont(ResourcesCompat.getFont(getContext(), R.font.montserrat_regular))\n-                .endConfig().buildRound(letters, bgColor);\n-        dashpayUserAvatar.setBackground(defaultAvatar);\n+        dashpayUserAvatar.setBackground(UserAvatarPlaceholderDrawable.getDrawable(getContext(),\n+                letters.charAt(0)));", "originalCommit": "9a3623ed561ba4d5784d3dc121833a6743fd5168", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQzMTA1MA==", "url": "https://github.com/dashevo/dash-wallet/pull/438#discussion_r438431050", "bodyText": "Good point on the 100 items.", "author": "HashEngineering", "createdAt": "2020-06-10T21:57:53Z", "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -96,7 +97,13 @@ class PlatformRepo(val walletApplication: WalletApplication) {\n             val creditFundingTx = wallet.getCreditFundingTransaction(wallet.getTransaction(blockchainIdentity!!.creditFundingTxId))\n             val userId = creditFundingTx.creditBurnIdentityIdentifier.toStringBase58()\n             // Names.search does support retrieving 100 names at a time if retrieveAll = false\n-            val nameDocuments = platform.names.search(text, Names.DEFAULT_PARENT_DOMAIN, true)\n+            //TODO: Maybe add pagination later? Is very unlikely that a user will scroll past 100 search results", "originalCommit": "9a3623ed561ba4d5784d3dc121833a6743fd5168", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQzMjE3OQ==", "url": "https://github.com/dashevo/dash-wallet/pull/438#discussion_r438432179", "bodyText": "I also changed this method in my PR, but I will realign it to match these changes.", "author": "HashEngineering", "createdAt": "2020-06-10T22:00:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQzMTA1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQzMTU5Nw==", "url": "https://github.com/dashevo/dash-wallet/pull/438#discussion_r438431597", "bodyText": "This could use DashPayProfile.fromDocument()", "author": "HashEngineering", "createdAt": "2020-06-10T21:59:24Z", "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -378,7 +387,7 @@ class PlatformRepo(val walletApplication: WalletApplication) {\n             // blockchainIdentity doesn't yet keep track of the profile, so we will load it\n             // into the database directly\n             val dashPayProfile = DashPayProfile(blockchainIdentity.uniqueIdString,\n-                    profile!!.data[\"displayName\"] as String,\n+                    profile.data[\"displayName\"] as String,\n                     profile.data[\"publicMessage\"] as String,\n                     profile.data[\"avatarUrl\"] as String)", "originalCommit": "9a3623ed561ba4d5784d3dc121833a6743fd5168", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6783a04d42461b98658f9f189f6ac791ffb53617", "url": "https://github.com/dashevo/dash-wallet/commit/6783a04d42461b98658f9f189f6ac791ffb53617", "message": "Manifest inclusion and repo small change\n\n- Added DashPayUserActivity in AndroidManifest.xml\n- Using DashPayProfile.fromDocument in PlatformRepo profile recovery method", "committedDate": "2020-06-12T16:59:59Z", "type": "commit"}, {"oid": "9ddbcf97a96e1e441f57d2d985886724f3ab1700", "url": "https://github.com/dashevo/dash-wallet/commit/9ddbcf97a96e1e441f57d2d985886724f3ab1700", "message": "Removing obsolete TODO\n\n- Profile creation will not be enforced.", "committedDate": "2020-06-12T17:13:13Z", "type": "commit"}, {"oid": "a5bcb9026cb5099adceba5d8c1519193ee97a7c2", "url": "https://github.com/dashevo/dash-wallet/commit/a5bcb9026cb5099adceba5d8c1519193ee97a7c2", "message": "Added TODO regarding contact request mocked states", "committedDate": "2020-06-12T17:18:17Z", "type": "commit"}]}