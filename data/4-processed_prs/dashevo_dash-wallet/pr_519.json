{"pr_number": 519, "pr_title": "NMA-615 | Contacts Page | Unregistered Users", "pr_createdAt": "2020-10-01T19:18:42Z", "pr_url": "https://github.com/dashevo/dash-wallet/pull/519", "timeline": [{"oid": "0698f10691401a2f64d22286107d2ef518ee5775", "url": "https://github.com/dashevo/dash-wallet/commit/0698f10691401a2f64d22286107d2ef518ee5775", "message": "Removing wallet fragment before recreating activity", "committedDate": "2020-07-29T03:29:45Z", "type": "commit"}, {"oid": "6f0887126c03331e63c5729290419fcbb5575141", "url": "https://github.com/dashevo/dash-wallet/commit/6f0887126c03331e63c5729290419fcbb5575141", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-07-30T13:41:11Z", "type": "commit"}, {"oid": "6bbb7598abab4ffc34bd3c578cda2496b50c0421", "url": "https://github.com/dashevo/dash-wallet/commit/6bbb7598abab4ffc34bd3c578cda2496b50c0421", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-08-05T17:08:30Z", "type": "commit"}, {"oid": "42c99c400b9faed66507cd112361e0eb460cd554", "url": "https://github.com/dashevo/dash-wallet/commit/42c99c400b9faed66507cd112361e0eb460cd554", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-08-06T18:55:08Z", "type": "commit"}, {"oid": "af16683d92f479f92f64fa02ef78592c37abbd44", "url": "https://github.com/dashevo/dash-wallet/commit/af16683d92f479f92f64fa02ef78592c37abbd44", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-08-18T00:28:48Z", "type": "commit"}, {"oid": "4dde9e07014e2e918d2f7efbb9b0fc71207c5778", "url": "https://github.com/dashevo/dash-wallet/commit/4dde9e07014e2e918d2f7efbb9b0fc71207c5778", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-09-08T01:25:25Z", "type": "commit"}, {"oid": "909ef0b512a0e9bc746c3f4936a3c8972d7fd476", "url": "https://github.com/dashevo/dash-wallet/commit/909ef0b512a0e9bc746c3f4936a3c8972d7fd476", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-09-11T03:25:05Z", "type": "commit"}, {"oid": "e4ce62cf12bccc17c7b3e3c89301788ec4bd0b16", "url": "https://github.com/dashevo/dash-wallet/commit/e4ce62cf12bccc17c7b3e3c89301788ec4bd0b16", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-09-21T15:26:17Z", "type": "commit"}, {"oid": "262c0bf6fd7c13751bea713a8b00ed1ba421f394", "url": "https://github.com/dashevo/dash-wallet/commit/262c0bf6fd7c13751bea713a8b00ed1ba421f394", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-09-24T20:38:27Z", "type": "commit"}, {"oid": "80e59323720417df7fe10d1c42b1faba92391335", "url": "https://github.com/dashevo/dash-wallet/commit/80e59323720417df7fe10d1c42b1faba92391335", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-09-29T16:50:21Z", "type": "commit"}, {"oid": "088bbbb359610f4e4e7c5df6c0a4dae3ef69ea2c", "url": "https://github.com/dashevo/dash-wallet/commit/088bbbb359610f4e4e7c5df6c0a4dae3ef69ea2c", "message": "Merge remote-tracking branch 'upstream/evonet-develop' into evonet-develop", "committedDate": "2020-10-01T18:42:52Z", "type": "commit"}, {"oid": "da1f349dc829fc9dbfb81c67d1807d8999022010", "url": "https://github.com/dashevo/dash-wallet/commit/da1f349dc829fc9dbfb81c67d1807d8999022010", "message": "Upgrade to Evolution page.", "committedDate": "2020-10-01T18:45:08Z", "type": "commit"}, {"oid": "de3d53e2ab7a86e9f8b9801a192abf49314d506d", "url": "https://github.com/dashevo/dash-wallet/commit/de3d53e2ab7a86e9f8b9801a192abf49314d506d", "message": "Removed commented code", "committedDate": "2020-10-01T19:17:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUzODM3NQ==", "url": "https://github.com/dashevo/dash-wallet/pull/519#discussion_r498538375", "bodyText": "blockchainIdentityDataDao was renamed blockchainIdentityDataDaoAsync.  This PR must be based on an older commit from the evonet-develop branch.\nNot sure why this doesn't have a merge conflict.", "author": "HashEngineering", "createdAt": "2020-10-01T22:13:19Z", "path": "wallet/src/de/schildbach/wallet/ui/MainActivity.kt", "diffHunk": "@@ -115,6 +134,32 @@ class MainActivity : AbstractBindServiceActivity(), ActivityCompat.OnRequestPerm\n         handleIntent(intent!!)\n     }\n \n+    override fun onWalletFragmentViewCreated() {\n+        AppDatabase.getAppDatabase().blockchainStateDao().load().observe(this, Observer {\n+            blockchainState = it\n+            walletFragment.setBlockchainState(blockchainState)\n+        })\n+        dashPayViewModel = ViewModelProvider(this)[DashPayViewModel::class.java]\n+        dashPayViewModel!!.isPlatformAvailableLiveData.observe(this, Observer<Resource<Boolean?>?> { status ->\n+            if (status?.status === Status.SUCCESS) {\n+                if (status.data != null) {\n+                    isPlatformAvailable = status.data\n+                }\n+            } else {\n+                isPlatformAvailable = false\n+            }\n+            walletFragment.setPlatformAvailability(isPlatformAvailable)\n+        })\n+        AppDatabase.getAppDatabase().blockchainIdentityDataDao().loadBase().observe(this,", "originalCommit": "de3d53e2ab7a86e9f8b9801a192abf49314d506d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUzODczNQ==", "url": "https://github.com/dashevo/dash-wallet/pull/519#discussion_r498538735", "bodyText": "blockchainIdentityDataDao() is now only to be used in suspend methods, while blockchainIdentityDataDaoAsync() is actually asynchronous.", "author": "HashEngineering", "createdAt": "2020-10-01T22:14:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUzODM3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU3OTAzNg==", "url": "https://github.com/dashevo/dash-wallet/pull/519#discussion_r498579036", "bodyText": "Fixed on https://github.com/sambarboza/dash-wallet/commit/964b74e840cd75422b5beaaee8e6c853f207c2c8", "author": "sambarboza", "createdAt": "2020-10-02T01:00:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUzODM3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU0MDk5Mw==", "url": "https://github.com/dashevo/dash-wallet/pull/519#discussion_r498540993", "bodyText": "My question is not related to this PR, but what happens when the user only has 0.01 DASH and they try to register.  Will it succeed or fail?  The reason for the question is that there is a fee that is required to send the transaction.  Though, in the case of sending all the value, then the fee may be taken out of the 0.01.  What if the balance is 0.01 - something less than the fee?  We can have QA figure this out and make a new ticket if there is a problem.", "author": "HashEngineering", "createdAt": "2020-10-01T22:21:29Z", "path": "wallet/src/de/schildbach/wallet/util/WalletExtensions.kt", "diffHunk": "@@ -0,0 +1,11 @@\n+package de.schildbach.wallet.util\n+\n+import de.schildbach.wallet.Constants\n+import org.bitcoinj.core.Coin\n+import org.bitcoinj.wallet.Wallet\n+\n+fun Wallet.canAffordIdentityCreation(): Boolean {\n+    val walletBalance: Coin = getBalance(Wallet.BalanceType.ESTIMATED)\n+    return (walletBalance.isGreaterThan(Constants.DASH_PAY_FEE)\n+            || walletBalance == Constants.DASH_PAY_FEE)\n+}", "originalCommit": "de3d53e2ab7a86e9f8b9801a192abf49314d506d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY5MzQ2NQ==", "url": "https://github.com/dashevo/dash-wallet/pull/519#discussion_r498693465", "bodyText": "@HashEngineering when I sent 0.01 to the new wallet and try to create an Identity it fails due to insufficient funds exception...", "author": "tomasz-ludek", "createdAt": "2020-10-02T08:46:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU0MDk5Mw=="}], "type": "inlineReview"}, {"oid": "964b74e840cd75422b5beaaee8e6c853f207c2c8", "url": "https://github.com/dashevo/dash-wallet/commit/964b74e840cd75422b5beaaee8e6c853f207c2c8", "message": "Using Async version of db fetch", "committedDate": "2020-10-02T00:59:46Z", "type": "commit"}, {"oid": "a50998a37768e18387caa24207f9b0606f60333f", "url": "https://github.com/dashevo/dash-wallet/commit/a50998a37768e18387caa24207f9b0606f60333f", "message": "Fixed stuck contacts icon", "committedDate": "2020-10-02T01:36:36Z", "type": "commit"}, {"oid": "ef6db8aabc49cef4ebfca621df5ca163ce24e5da", "url": "https://github.com/dashevo/dash-wallet/commit/ef6db8aabc49cef4ebfca621df5ca163ce24e5da", "message": "Replaced old school callbacks-based communication model between activity and fragments with modern one based on shared view model.", "committedDate": "2020-10-02T08:06:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY4NzQxMg==", "url": "https://github.com/dashevo/dash-wallet/pull/519#discussion_r498687412", "bodyText": "Those empty observers could be replaced by other way of triggering data loading but let's leave it as it is\nI'll fix it when working on \"JoinDash\" shortcut when #516 in merged (it will be merged after this PR)", "author": "tomasz-ludek", "createdAt": "2020-10-02T08:34:46Z", "path": "wallet/src/de/schildbach/wallet/ui/MainActivity.kt", "diffHunk": "@@ -102,6 +115,21 @@ class MainActivity : AbstractBindServiceActivity(), ActivityCompat.OnRequestPerm\n         setupBottomNavigation()\n     }\n \n+    fun initViewModel() {\n+        viewModel = ViewModelProvider(this)[MainActivityViewModel::class.java]\n+        viewModel.blockchainStateData.observe(this, Observer {\n+            // just to trigger data loading\n+        })\n+        viewModel.isPlatformAvailableData.observe(this, Observer {\n+            // just to trigger data loading\n+        })", "originalCommit": "ef6db8aabc49cef4ebfca621df5ca163ce24e5da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY4ODcyMA==", "url": "https://github.com/dashevo/dash-wallet/pull/519#discussion_r498688720", "bodyText": "this shouldn't be needed when using LiveDatas", "author": "tomasz-ludek", "createdAt": "2020-10-02T08:37:22Z", "path": "wallet/src/de/schildbach/wallet/ui/WalletFragment.kt", "diffHunk": "@@ -119,27 +132,7 @@ class WalletFragment : Fragment() {\n         showHideJoinDashPayAction()\n     }\n \n-    fun setBlockchainState(blockchainState: BlockchainState?) {\n-        this.blockchainState = blockchainState\n-        if (isDetached || !isVisible) {", "originalCommit": "ef6db8aabc49cef4ebfca621df5ca163ce24e5da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3cc66d32afe546523d074e6215bb63b195b9ce90", "url": "https://github.com/dashevo/dash-wallet/commit/3cc66d32afe546523d074e6215bb63b195b9ce90", "message": "Further improvements of MainActivityViewModel", "committedDate": "2020-10-02T10:34:39Z", "type": "commit"}, {"oid": "620cc9858f40d2b05116981a3d2025669f5564bd", "url": "https://github.com/dashevo/dash-wallet/commit/620cc9858f40d2b05116981a3d2025669f5564bd", "message": "Minor code refactoring", "committedDate": "2020-10-02T10:48:28Z", "type": "commit"}, {"oid": "cd1d505b5bb5d3f79755cf828133984f3982c588", "url": "https://github.com/dashevo/dash-wallet/commit/cd1d505b5bb5d3f79755cf828133984f3982c588", "message": "Merge branch 'master-into-evonet-develop' into dashpay-contacts-page-no-user\n\n# Conflicts:\n#\twallet/res/values-th/strings-extra.xml\n#\twallet/src/de/schildbach/wallet/ui/WalletFragment.kt", "committedDate": "2020-10-06T11:35:58Z", "type": "commit"}, {"oid": "5f7afd4f4989fc44a4350d5809068ca2f2c72b26", "url": "https://github.com/dashevo/dash-wallet/commit/5f7afd4f4989fc44a4350d5809068ca2f2c72b26", "message": "Merge branch 'evonet-develop' into dashpay-contacts-page-no-user", "committedDate": "2020-10-06T15:59:20Z", "type": "commit"}, {"oid": "b912e2c10c01ff186adb06a36d489a1a760e6979", "url": "https://github.com/dashevo/dash-wallet/commit/b912e2c10c01ff186adb06a36d489a1a760e6979", "message": "Final improvements of handling Join DashPay button visibility.\nMinor code refactoring.", "committedDate": "2020-10-06T17:03:18Z", "type": "commit"}]}