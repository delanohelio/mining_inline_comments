{"pr_number": 475, "pr_title": "DashPay: Send Payment | Frequent Contacts", "pr_createdAt": "2020-08-05T23:33:06Z", "pr_url": "https://github.com/dashevo/dash-wallet/pull/475", "timeline": [{"oid": "a7c892ff46748e86011ccf92c6f9eee9d42f1a83", "url": "https://github.com/dashevo/dash-wallet/commit/a7c892ff46748e86011ccf92c6f9eee9d42f1a83", "message": "Add frequent contacts to Payments Screen", "committedDate": "2020-08-05T20:55:39Z", "type": "commit"}, {"oid": "62e963fc7c3824ecb0c19c1efbc810cb0fdb0ae8", "url": "https://github.com/dashevo/dash-wallet/commit/62e963fc7c3824ecb0c19c1efbc810cb0fdb0ae8", "message": "Prioritize the contacts that payments are sent to", "committedDate": "2020-08-05T22:40:36Z", "type": "commit"}, {"oid": "086a8adcfdea08efa723778deced20e396580bf8", "url": "https://github.com/dashevo/dash-wallet/commit/086a8adcfdea08efa723778deced20e396580bf8", "message": "Cleanup code, add copyright information", "committedDate": "2020-08-05T23:32:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2MjUwMQ==", "url": "https://github.com/dashevo/dash-wallet/pull/475#discussion_r466062501", "bodyText": "This is commented out until I determine which contacts should be included.  Currently all payable contacts are included, even those we didn't accept.\nActually, the Live data should do this filter before it posts the results.", "author": "HashEngineering", "createdAt": "2020-08-05T23:39:06Z", "path": "wallet/src/de/schildbach/wallet/ui/PaymentsPayFragment.kt", "diffHunk": "@@ -195,4 +227,18 @@ class PaymentsPayFragment : Fragment() {\n         fun selectContactToPay()\n     }\n \n+    private fun processResults(data: List<UsernameSearchResult>) {\n+        val results = ArrayList<UsernameSearchResult>()\n+\n+        val contacts = data.filter { /*it.requestSent &&*/ it.requestReceived }", "originalCommit": "086a8adcfdea08efa723778deced20e396580bf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ0NTg1Nw==", "url": "https://github.com/dashevo/dash-wallet/pull/475#discussion_r466445857", "bodyText": "This has been resolved: 1cc68c7", "author": "HashEngineering", "createdAt": "2020-08-06T14:17:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2MjUwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2MjgxMQ==", "url": "https://github.com/dashevo/dash-wallet/pull/475#discussion_r466062811", "bodyText": "This is probably now in 3 adapter classes.  It can be refactored to a utility class.", "author": "HashEngineering", "createdAt": "2020-08-05T23:40:03Z", "path": "wallet/src/de/schildbach/wallet/ui/dashpay/FrequentContactsAdapter.kt", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Copyright 2020 Dash Core Group.\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package de.schildbach.wallet.ui.dashpay\n+\n+import android.view.LayoutInflater\n+import android.view.ViewGroup\n+/*\n+ * Copyright 2020 Dash Core Group\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import androidx.recyclerview.widget.RecyclerView\n+import de.schildbach.wallet.data.UsernameSearchResult\n+import org.dashevo.dpp.util.HashUtils\n+import java.math.BigInteger\n+\n+class FrequentContactsAdapter() :\n+        RecyclerView.Adapter<FrequentContactViewHolder>() {\n+\n+    init {\n+        setHasStableIds(true)\n+    }\n+\n+    var itemClickListener: OnContactItemClickListener? = null\n+    var results: ArrayList<UsernameSearchResult> = arrayListOf()\n+        set(value) {\n+            field = value\n+            notifyDataSetChanged()\n+        }\n+\n+    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): FrequentContactViewHolder {\n+         return FrequentContactViewHolder(LayoutInflater.from(parent.context), parent, itemClickListener)\n+    }\n+\n+    override fun getItemCount(): Int {\n+        return results.size\n+    }\n+\n+    private fun getLongValue(s: String): Long {\n+        val byteArray = HashUtils.byteArrayFromString(s)\n+        val bigInteger = BigInteger(byteArray)\n+        return bigInteger.toLong()\n+    }", "originalCommit": "086a8adcfdea08efa723778deced20e396580bf8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2MzIyMw==", "url": "https://github.com/dashevo/dash-wallet/pull/475#discussion_r466063223", "bodyText": "This is where the contactRequests.data should be filtered to only use the proper contacts for the rest of the \"calculations\"", "author": "HashEngineering", "createdAt": "2020-08-05T23:41:25Z", "path": "wallet/src/de/schildbach/wallet/ui/dashpay/FrequentContactsLiveData.kt", "diffHunk": "@@ -0,0 +1,113 @@\n+package de.schildbach.wallet.ui.dashpay\n+\n+import android.text.format.DateUtils\n+import androidx.lifecycle.LiveData\n+import de.schildbach.wallet.WalletApplication\n+import de.schildbach.wallet.data.UsernameSearchResult\n+import de.schildbach.wallet.data.UsernameSortOrderBy\n+import de.schildbach.wallet.livedata.Resource\n+import de.schildbach.wallet.livedata.Status\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+import org.dashevo.dashpay.BlockchainIdentity\n+import java.util.*\n+\n+class FrequentContactsLiveData(val walletApplication: WalletApplication, private val platformRepo: PlatformRepo) : LiveData<Resource<List<UsernameSearchResult>>>(), OnContactsUpdated {\n+\n+    companion object {\n+        const val TIMESPAN: Long = DateUtils.DAY_IN_MILLIS * 90 // 90 days\n+        const val TOP_CONTACT_COUNT = 4\n+    }\n+\n+    private var listening = false\n+\n+    override fun onActive() {\n+        maybeAddEventListener()\n+        onContactsUpdated()\n+    }\n+\n+    override fun onInactive() {\n+        maybeRemoveEventListener()\n+    }\n+\n+    private fun maybeAddEventListener() {\n+        if (!listening && hasActiveObservers()) {\n+            platformRepo.addContactsUpdatedListener(this)\n+            listening = true\n+        }\n+    }\n+\n+    private fun maybeRemoveEventListener() {\n+        if (listening) {\n+            platformRepo.removeContactsUpdatedListener(this)\n+            listening = false\n+        }\n+    }\n+\n+    override fun onContactsUpdated() {\n+        getFrequentContacts()\n+    }\n+\n+    fun getFrequentContacts() {\n+        GlobalScope.launch(Dispatchers.IO) {\n+            val contactRequests = platformRepo.searchContacts(\"\", UsernameSortOrderBy.DATE_ADDED)\n+            when (contactRequests.status) {\n+                Status.SUCCESS -> {\n+                    val blockchainIdentity = platformRepo.getBlockchainIdentity() ?: return@launch\n+                    val threeMonthsAgo = Date().time - TIMESPAN\n+", "originalCommit": "086a8adcfdea08efa723778deced20e396580bf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ0NjE0OQ==", "url": "https://github.com/dashevo/dash-wallet/pull/475#discussion_r466446149", "bodyText": "Resolved here: 1cc68c7", "author": "HashEngineering", "createdAt": "2020-08-06T14:18:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2MzIyMw=="}], "type": "inlineReview"}, {"oid": "132bbb299aab01fe08ca7f2ef8d22e78a0e5bcb1", "url": "https://github.com/dashevo/dash-wallet/commit/132bbb299aab01fe08ca7f2ef8d22e78a0e5bcb1", "message": "Adjust alignment", "committedDate": "2020-08-05T23:53:46Z", "type": "commit"}, {"oid": "1cc68c78496e0a2248c64dccb26bd8b16a617016", "url": "https://github.com/dashevo/dash-wallet/commit/1cc68c78496e0a2248c64dccb26bd8b16a617016", "message": "Use fully established contacts only", "committedDate": "2020-08-06T13:24:14Z", "type": "commit"}, {"oid": "aebe6f0e27eeb19a2eb02229c30432dbdbddba72", "url": "https://github.com/dashevo/dash-wallet/commit/aebe6f0e27eeb19a2eb02229c30432dbdbddba72", "message": "Refactor getLongValue out of all adapters", "committedDate": "2020-08-06T15:04:51Z", "type": "commit"}, {"oid": "155bbc770ee3fd61db73d4bc4487b684684408da", "url": "https://github.com/dashevo/dash-wallet/commit/155bbc770ee3fd61db73d4bc4487b684684408da", "message": "Handle case of no blockchain identity", "committedDate": "2020-08-10T14:43:21Z", "type": "commit"}, {"oid": "e3dbd1758afa13685c106fe99e99b4f2188549cb", "url": "https://github.com/dashevo/dash-wallet/commit/e3dbd1758afa13685c106fe99e99b4f2188549cb", "message": "Add scope to FrequentContactsLiveData", "committedDate": "2020-08-10T14:43:43Z", "type": "commit"}, {"oid": "47037af88393cca63952ffdeb5e9d5ebc574a07c", "url": "https://github.com/dashevo/dash-wallet/commit/47037af88393cca63952ffdeb5e9d5ebc574a07c", "message": "Change coroutine scope on notifications live data classes", "committedDate": "2020-08-10T20:09:09Z", "type": "commit"}, {"oid": "ca44ad8d8c323a02057938cef079c3d6069ed6d8", "url": "https://github.com/dashevo/dash-wallet/commit/ca44ad8d8c323a02057938cef079c3d6069ed6d8", "message": "Refactored NotificationsAdapter, moved ViewHolder's to separate classes, optimised code", "committedDate": "2020-08-10T20:10:43Z", "type": "commit"}, {"oid": "bd7dfccaf81d12e4b0aeeca6db222e470d2b88f5", "url": "https://github.com/dashevo/dash-wallet/commit/bd7dfccaf81d12e4b0aeeca6db222e470d2b88f5", "message": "Further refactoring of NotificationAdapter, replaced ContactViewHolder and ContactRequestViewHolder with a single class NotificationViewHolder", "committedDate": "2020-08-12T00:06:59Z", "type": "commit"}, {"oid": "ba0d599d340bc9a57b0cba9bfc392992880269ca", "url": "https://github.com/dashevo/dash-wallet/commit/ba0d599d340bc9a57b0cba9bfc392992880269ca", "message": "Final improvements of NotificationsAdapter and related data model", "committedDate": "2020-08-13T18:59:09Z", "type": "commit"}, {"oid": "c5a620c5c2e20b8cb0e0e221036701dac5614b2a", "url": "https://github.com/dashevo/dash-wallet/commit/c5a620c5c2e20b8cb0e0e221036701dac5614b2a", "message": "Changed the way of displaying TransactionDetailsDialogFragment", "committedDate": "2020-08-13T19:18:17Z", "type": "commit"}, {"oid": "5c9125288946d9b76ed2014017aac470731af40d", "url": "https://github.com/dashevo/dash-wallet/commit/5c9125288946d9b76ed2014017aac470731af40d", "message": "Code refactoring", "committedDate": "2020-08-13T19:32:32Z", "type": "commit"}, {"oid": "1d9dcc6c4af03169525e5302dabea096004ee2fa", "url": "https://github.com/dashevo/dash-wallet/commit/1d9dcc6c4af03169525e5302dabea096004ee2fa", "message": "Merge branch 'user-profile-transaction-history' of https://github.com/dashevo/dash-wallet into dashpay-frequent-contacts\n\n# Conflicts:\n#\twallet/src/de/schildbach/wallet/ui/dashpay/NotificationsAdapter.kt", "committedDate": "2020-08-14T00:50:12Z", "type": "commit"}, {"oid": "72a16ef467b088bcfcbf528f4239da402fb835e9", "url": "https://github.com/dashevo/dash-wallet/commit/72a16ef467b088bcfcbf528f4239da402fb835e9", "message": "Added a missing comment from https://github.com/dashevo/dash-wallet/pull/473", "committedDate": "2020-08-14T08:26:34Z", "type": "commit"}, {"oid": "8c550ffae0add9944b9539e3add515877bf75a37", "url": "https://github.com/dashevo/dash-wallet/commit/8c550ffae0add9944b9539e3add515877bf75a37", "message": "Removed debugging code", "committedDate": "2020-08-14T08:33:36Z", "type": "commit"}, {"oid": "cc9bb62c1d139b4b6f282881641341469f055e01", "url": "https://github.com/dashevo/dash-wallet/commit/cc9bb62c1d139b4b6f282881641341469f055e01", "message": "Code refactoring", "committedDate": "2020-08-14T08:37:49Z", "type": "commit"}, {"oid": "3a2a8a828e8b6ab38e8c99302a6611a9facfef8c", "url": "https://github.com/dashevo/dash-wallet/commit/3a2a8a828e8b6ab38e8c99302a6611a9facfef8c", "message": "Merge branch 'evonet-develop' into user-profile-transaction-history-bis\n\n# Conflicts:\n#\twallet/res/layout/receive_info_view.xml", "committedDate": "2020-08-14T08:39:25Z", "type": "commit"}, {"oid": "fc3dc0b2bbb2b92c3707934dde81a70d604fdd17", "url": "https://github.com/dashevo/dash-wallet/commit/fc3dc0b2bbb2b92c3707934dde81a70d604fdd17", "message": "Improved id generation for HeaderViewItem and ImageViewItem", "committedDate": "2020-08-14T09:00:00Z", "type": "commit"}, {"oid": "a29b1e39e46bad15b891b98e63cac61b7ae54f7f", "url": "https://github.com/dashevo/dash-wallet/commit/a29b1e39e46bad15b891b98e63cac61b7ae54f7f", "message": "Merge branch 'user-profile-transaction-history' into dashpay-frequent-contacts", "committedDate": "2020-08-14T09:08:14Z", "type": "commit"}, {"oid": "b09a186502740ad26689e2e4879c1ee0027c6cdb", "url": "https://github.com/dashevo/dash-wallet/commit/b09a186502740ad26689e2e4879c1ee0027c6cdb", "message": "Improved `NotificationsAdapter.getItemId` method for NOTIFICATION_HEADER and NOTIFICATION_EMPTY.", "committedDate": "2020-08-14T09:11:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDUyODI3MA==", "url": "https://github.com/dashevo/dash-wallet/pull/475#discussion_r470528270", "bodyText": "I'm wondering why this margin is 30dp wide, it adds awkward looking indentation:\n\nShouldn't it be 15dp as in @style/MenuRow?", "author": "tomasz-ludek", "createdAt": "2020-08-14T09:54:32Z", "path": "wallet/res/layout/fragment_payments_pay.xml", "diffHunk": "@@ -16,6 +16,13 @@\n         app:pb_sub_title=\"@string/payments_pay_to_contact_sub_title\"\n         app:pb_title=\"@string/payments_pay_to_contact_title\" />\n \n+    <androidx.recyclerview.widget.RecyclerView\n+        android:id=\"@+id/frequent_contacts_rv\"\n+        android:layout_marginStart=\"30dp\"", "originalCommit": "b09a186502740ad26689e2e4879c1ee0027c6cdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYzNDYzMg==", "url": "https://github.com/dashevo/dash-wallet/pull/475#discussion_r470634632", "bodyText": "That was a good question.  I am trying to copy this design, but there are many other differences that make it look differnet (no blue buttons, no rounded white rectangles for each MenuRow, etc.", "author": "HashEngineering", "createdAt": "2020-08-14T13:48:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDUyODI3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY0MzUyOQ==", "url": "https://github.com/dashevo/dash-wallet/pull/475#discussion_r470643529", "bodyText": "Let's merge it as it is and fix during the UI polishing stage if needed", "author": "tomasz-ludek", "createdAt": "2020-08-14T14:04:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDUyODI3MA=="}], "type": "inlineReview"}, {"oid": "8594d054a8e52b3a4791cabac38bf403bbdd10f8", "url": "https://github.com/dashevo/dash-wallet/commit/8594d054a8e52b3a4791cabac38bf403bbdd10f8", "message": "Fix issues with flickering and processing UUID strings", "committedDate": "2020-08-14T16:12:12Z", "type": "commit"}]}