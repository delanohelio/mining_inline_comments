{"pr_number": 406, "pr_title": "NMA-473 Payment Request from another app gets stuck on Transaction Result Screen", "pr_createdAt": "2020-05-13T16:03:04Z", "pr_url": "https://github.com/dashevo/dash-wallet/pull/406", "timeline": [{"oid": "fcefac8f9d44e831958189774c4f4b3925592b7d", "url": "https://github.com/dashevo/dash-wallet/commit/fcefac8f9d44e831958189774c4f4b3925592b7d", "message": "Added SendCoinsInternalActivity being not exported version of SendCoinsActivity extended with ability to be authorised internally.\nFinishing the app if it was launched from external.", "committedDate": "2020-05-13T16:01:35Z", "type": "commit"}, {"oid": "8f902ce322403065dc61261a6581cd0bbabbe9d8", "url": "https://github.com/dashevo/dash-wallet/commit/8f902ce322403065dc61261a6581cd0bbabbe9d8", "message": "If started from the shortcut, the app is closed after finishing the action", "committedDate": "2020-05-13T16:18:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyMTU4MA==", "url": "https://github.com/dashevo/dash-wallet/pull/406#discussion_r424621580", "bodyText": "This part doesn't seem to work.\nWhen using the secondary app that makes a payment request, the last screen of the payment process is the Transaction Result screen with a \"Close\" button.  Clicking the close button appears to execute the \"else\" clause here rather than the first clause that will finish() the activity.", "author": "HashEngineering", "createdAt": "2020-05-13T17:48:54Z", "path": "wallet/src/de/schildbach/wallet/ui/TransactionResultActivity.kt", "diffHunk": "@@ -77,10 +83,16 @@ class TransactionResultActivity : AbstractWalletActivity() {\n             transactionResultViewBinder.bind(tx, payeeName, payeeVerifiedBy)\n             view_on_explorer.setOnClickListener { viewOnExplorer(tx) }\n             transaction_close_btn.setOnClickListener {\n-                if (intent.getBooleanExtra(EXTRA_USER_AUTHORIZED_RESULT_EXTRA, false)) {\n-                    startActivity(WalletActivity.createIntent(this))\n-                } else {\n-                    startActivity(LockScreenActivity.createIntentAsNewTask(this))\n+                when {\n+                    intent.action == Intent.ACTION_VIEW -> {\n+                        finish()\n+                    }\n+                    intent.getBooleanExtra(EXTRA_USER_AUTHORIZED_RESULT_EXTRA, false) -> {\n+                        startActivity(WalletActivity.createIntent(this))\n+                    }\n+                    else -> {\n+                        startActivity(LockScreenActivity.createIntentAsNewTask(this))\n+                    }", "originalCommit": "8f902ce322403065dc61261a6581cd0bbabbe9d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzMDM2Mg==", "url": "https://github.com/dashevo/dash-wallet/pull/406#discussion_r424630362", "bodyText": "As we discussed on Slack the left button of the \"Hack\" app works in a hacky way so you should use the right button,", "author": "tomasz-ludek", "createdAt": "2020-05-13T18:03:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyMTU4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc1NDk0NA==", "url": "https://github.com/dashevo/dash-wallet/pull/406#discussion_r424754944", "bodyText": "Yes, this code is working under normal circumstances.", "author": "HashEngineering", "createdAt": "2020-05-13T21:58:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyMTU4MA=="}], "type": "inlineReview"}]}