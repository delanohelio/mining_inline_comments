{"pr_number": 5416, "pr_title": "GEODE-8382: Run Redis tests against Redis API for Geode", "pr_createdAt": "2020-07-30T18:53:51Z", "pr_url": "https://github.com/apache/geode/pull/5416", "timeline": [{"oid": "7d83e80a46d26f28c9321d9dd1e77fbcc4ca519c", "url": "https://github.com/apache/geode/commit/7d83e80a46d26f28c9321d9dd1e77fbcc4ca519c", "message": "GEODE-8382: Run Redis tests against Redis API for Geode", "committedDate": "2020-07-30T18:45:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0MDY4Mw==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464640683", "bodyText": "I looked at the resource usage for this heavy lifter, and we can safely take this down to 8GB ram, easy.", "author": "rhoughton-pivot", "createdAt": "2020-08-03T20:20:06Z", "path": "ci/pipelines/shared/jinja.variables.yml", "diffHunk": "@@ -140,6 +140,19 @@ tests:\n   PLATFORM: linux\n   RAM: '210'\n   name: Upgrade\n+- ARTIFACT_SLUG: redistests\n+  CALL_STACK_TIMEOUT: '1200'\n+  CPUS: '4'\n+  DUNIT_PARALLEL_FORKS: '0'\n+  EXECUTE_TEST_TIMEOUT: 30m\n+  GRADLE_TASK: ':geode-redis:redisAPITest'\n+  MAX_IN_FLIGHT: 1\n+  ONLY_JDK: 11\n+  PARALLEL_DUNIT: 'false'\n+  PARALLEL_GRADLE: 'true'\n+  PLATFORM: linux\n+  RAM: '16'", "originalCommit": "7d83e80a46d26f28c9321d9dd1e77fbcc4ca519c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NTMzMw==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464665333", "bodyText": "just changed it!", "author": "sabbey37", "createdAt": "2020-08-03T21:13:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0MDY4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0MTAwNg==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464641006", "bodyText": "I saw that this does fail-red when the count != 0. Looks good.", "author": "rhoughton-pivot", "createdAt": "2020-08-03T20:20:49Z", "path": "ci/scripts/execute_redis_tests.sh", "diffHunk": "@@ -0,0 +1,51 @@\n+#!/usr/bin/env bash\n+\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+cd ..\n+git clone --config transfer.fsckObjects=false https://github.com/prettyClouds/redis.git\n+cd redis\n+git checkout tests-geode-redis\n+\n+JAVA_HOME=\"/usr/lib/jvm/java-11-openjdk-amd64\"  \\\n+../geode-assembly/build/install/apache-geode/bin/gfsh start server \\\n+  --J=-Denable-redis-unsupported-commands=true \\\n+  --name=server1 \\\n+  --redis-port=6380 \\\n+  --redis-bind-address=127.0.0.1 \\\n+  --redis-password=foobar\n+\n+failCount=0\n+\n+./runtest --host 127.0.0.1 --port 6380 --single unit/auth\n+\n+((failCount+=$?))\n+\n+JAVA_HOME=\"/usr/lib/jvm/java-11-openjdk-amd64\" \\\n+../geode-assembly/build/install/apache-geode/bin/gfsh start server \\\n+  --J=-Denable-redis-unsupported-commands=true \\\n+  --name=server2 \\\n+  --server-port=0 \\\n+  --redis-port=6379 \\\n+  --redis-bind-address=127.0.0.1\n+\n+./runtest --host 127.0.0.1 --port 6379 --single unit/type/set --single unit/expire\n+\n+((failCount+=$?))\n+\n+exit $failCount", "originalCommit": "7d83e80a46d26f28c9321d9dd1e77fbcc4ca519c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NTUxNw==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464665517", "bodyText": "sweet, thanks for double checking!", "author": "sabbey37", "createdAt": "2020-08-03T21:14:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0MTAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NDE2Nw==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464644167", "bodyText": "you should not need to hardcode the JDK path.  The JDK you should be using is passed to you as ${JAVA_TEST_PATH} (see ci/scripts/execute_tests.sh)", "author": "onichols-pivotal", "createdAt": "2020-08-03T20:27:42Z", "path": "ci/scripts/execute_redis_tests.sh", "diffHunk": "@@ -0,0 +1,51 @@\n+#!/usr/bin/env bash\n+\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+cd ..\n+git clone --config transfer.fsckObjects=false https://github.com/prettyClouds/redis.git\n+cd redis\n+git checkout tests-geode-redis\n+\n+JAVA_HOME=\"/usr/lib/jvm/java-11-openjdk-amd64\"  \\", "originalCommit": "7d83e80a46d26f28c9321d9dd1e77fbcc4ca519c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NTk1MQ==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464665951", "bodyText": "I updated this, but I'm wondering if we'll have access to the JAVA_TEST_PATH variable in this script?  Attempting to check it now...", "author": "sabbey37", "createdAt": "2020-08-03T21:14:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE0ODU3Nw==", "url": "https://github.com/apache/geode/pull/5416#discussion_r465148577", "bodyText": "Just pushed an update to execute_tests.sh that sets the JAVA_TEST_PATH variable so it's accessible inside the execute_redis_tests script.  It passes here: https://concourse.gemfire-ci.info/teams/developer/pipelines/sabbeypivotal-new-pr-pr/jobs/RedisTestOpenJDK11/builds/6", "author": "sabbey37", "createdAt": "2020-08-04T15:45:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE1ODM2MQ==", "url": "https://github.com/apache/geode/pull/5416#discussion_r465158361", "bodyText": "If Robert were around today he might know a way to get it from gradle's testJVM property when gradle invokes the redis script, but this might work too.", "author": "onichols-pivotal", "createdAt": "2020-08-04T15:59:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NDE2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NjUxMQ==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464646511", "bodyText": "redundant as you have already set JAVA_HOME above", "author": "onichols-pivotal", "createdAt": "2020-08-03T20:32:41Z", "path": "ci/scripts/execute_redis_tests.sh", "diffHunk": "@@ -0,0 +1,51 @@\n+#!/usr/bin/env bash\n+\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+cd ..\n+git clone --config transfer.fsckObjects=false https://github.com/prettyClouds/redis.git\n+cd redis\n+git checkout tests-geode-redis\n+\n+JAVA_HOME=\"/usr/lib/jvm/java-11-openjdk-amd64\"  \\\n+../geode-assembly/build/install/apache-geode/bin/gfsh start server \\\n+  --J=-Denable-redis-unsupported-commands=true \\\n+  --name=server1 \\\n+  --redis-port=6380 \\\n+  --redis-bind-address=127.0.0.1 \\\n+  --redis-password=foobar\n+\n+failCount=0\n+\n+./runtest --host 127.0.0.1 --port 6380 --single unit/auth\n+\n+((failCount+=$?))\n+\n+JAVA_HOME=\"/usr/lib/jvm/java-11-openjdk-amd64\" \\", "originalCommit": "7d83e80a46d26f28c9321d9dd1e77fbcc4ca519c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NjE4OA==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464666188", "bodyText": "Just exported the variable and was able to remove this. Thanks for the suggestion!", "author": "sabbey37", "createdAt": "2020-08-03T21:15:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NjUxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NzMzNg==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464647336", "bodyText": "would a comment be appropriate here explaining why a personal fork is being used and the plan/timeline for eliminating dependency on a personal fork?", "author": "onichols-pivotal", "createdAt": "2020-08-03T20:34:19Z", "path": "ci/scripts/execute_redis_tests.sh", "diffHunk": "@@ -0,0 +1,51 @@\n+#!/usr/bin/env bash\n+\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+cd ..\n+git clone --config transfer.fsckObjects=false https://github.com/prettyClouds/redis.git", "originalCommit": "7d83e80a46d26f28c9321d9dd1e77fbcc4ca519c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2NjM2Mg==", "url": "https://github.com/apache/geode/pull/5416#discussion_r464666362", "bodyText": "Just added a comment.  Let me know if you think it explains the situation sufficiently.", "author": "sabbey37", "createdAt": "2020-08-03T21:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NzMzNg=="}], "type": "inlineReview"}, {"oid": "0c4df148e60f43d5cd99ca0cfa97dc7b200c262b", "url": "https://github.com/apache/geode/commit/0c4df148e60f43d5cd99ca0cfa97dc7b200c262b", "message": "PR review changes", "committedDate": "2020-08-03T21:13:09Z", "type": "commit"}, {"oid": "6a57d6634733ea2ede104a5331f5e1dd79576978", "url": "https://github.com/apache/geode/commit/6a57d6634733ea2ede104a5331f5e1dd79576978", "message": "Sets JAVA_TEST_PATH variable as part of ssh call", "committedDate": "2020-08-04T15:43:17Z", "type": "commit"}]}