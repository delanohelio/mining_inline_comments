{"pr_number": 5054, "pr_title": "GEODE-8071: Use daemon threads in RebalanceCommand", "pr_createdAt": "2020-05-05T16:56:19Z", "pr_url": "https://github.com/apache/geode/pull/5054", "timeline": [{"oid": "feb052e71cee12a5e7a2ca72809f9ad07a908e44", "url": "https://github.com/apache/geode/commit/feb052e71cee12a5e7a2ca72809f9ad07a908e44", "message": "GEODE-8071: Refactor RebalanceCommandDistributedTest.", "committedDate": "2020-05-05T16:19:01Z", "type": "commit"}, {"oid": "bd481554d8add576c885c675c2350474eb398939", "url": "https://github.com/apache/geode/commit/bd481554d8add576c885c675c2350474eb398939", "message": "GEODE-8071: Use daemon threads in RebalanceCommand\n\nChanged the ExecutorService within RebalanceCommand to use daemon\nthreads, otherwise the locator refuses to gracefully shutdown.\n\n- Fixed minor warnings.\n- Added distributed tests.", "committedDate": "2020-05-05T16:53:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4OTE4Ng==", "url": "https://github.com/apache/geode/pull/5054#discussion_r420289186", "bodyText": "Could the ints added to the keys and values be cleared up a bit? There doesn't seem to be any reason to add 200 to them here, and if the number of entries is extracted to a constant, then it can be used in the invocation on server2 to prevent overwriting the existing data.", "author": "DonalEvans", "createdAt": "2020-05-05T17:38:58Z", "path": "geode-dunit/src/main/java/org/apache/geode/management/internal/cli/commands/RebalanceCommandDistributedTest.java", "diffHunk": "@@ -35,40 +37,91 @@\n import org.apache.geode.test.dunit.rules.MemberVM;\n import org.apache.geode.test.junit.assertions.TabularResultModelAssert;\n import org.apache.geode.test.junit.rules.GfshCommandRule;\n+import org.apache.geode.test.junit.rules.MemberStarterRule;\n+\n+@RunWith(Parameterized.class)\n+public class RebalanceCommandDistributedTest {\n+  private static final String REGION_ONE_NAME = \"region-1\";\n+  private static final String REGION_TWO_NAME = \"region-2\";\n+  private static final String REGION_THREE_NAME = \"region-3\";\n+\n+  @Rule\n+  public GfshCommandRule gfsh = new GfshCommandRule();\n+\n+  @Rule\n+  public ClusterStartupRule cluster = new ClusterStartupRule();\n \n-@SuppressWarnings(\"serial\")\n-public class RebalanceCommandDistributedTestBase {\n+  protected MemberVM locator, server1, server2;\n \n-  @ClassRule\n-  public static ClusterStartupRule cluster = new ClusterStartupRule();\n+  @Parameterized.Parameters(name = \"ConnectionType:{0}\")\n+  public static GfshCommandRule.PortType[] connectionTypes() {\n+    return new GfshCommandRule.PortType[] {http, jmxManager};\n+  }\n \n-  @ClassRule\n-  public static GfshCommandRule gfsh = new GfshCommandRule();\n+  @Parameterized.Parameter\n+  public static GfshCommandRule.PortType portType;\n \n-  protected static MemberVM locator, server1, server2, server3;\n+  private void setUpRegions() {\n+    server1.invoke(() -> {\n+      Cache cache = ClusterStartupRule.getCache();\n+      assertThat(cache).isNotNull();\n+      RegionFactory<String, String> dataRegionFactory =\n+          cache.createRegionFactory(RegionShortcut.PARTITION);\n+      Region<String, String> region = dataRegionFactory.create(REGION_ONE_NAME);\n+      for (int i = 0; i < 10; i++) {\n+        region.put(\"key\" + (i + 200), \"value\" + (i + 200));\n+      }\n+      region = dataRegionFactory.create(REGION_TWO_NAME);\n+      for (int i = 0; i < 100; i++) {\n+        region.put(\"key\" + (i + 200), \"value\" + (i + 200));\n+      }", "originalCommit": "feb052e71cee12a5e7a2ca72809f9ad07a908e44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyMjQ5Mg==", "url": "https://github.com/apache/geode/pull/5054#discussion_r420622492", "bodyText": "I actually didn't add these tests and the entries looked a bit weird to me as well, I didn't want to change this but it makes sense, will do it, thanks.", "author": "jujoramos", "createdAt": "2020-05-06T08:25:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4OTE4Ng=="}], "type": "inlineReview"}, {"oid": "ae58e8e477ed63edf524a7bef7aa7560784e68f8", "url": "https://github.com/apache/geode/commit/ae58e8e477ed63edf524a7bef7aa7560784e68f8", "message": "GEODE-8071: Changes requested by reviewers.", "committedDate": "2020-05-06T08:40:09Z", "type": "commit"}]}