{"pr_number": 5297, "pr_title": "GEODE-8239 - Add gradle config to add 'Class-Path' and 'Dependent-Modules' attirbutes to manifest file", "pr_createdAt": "2020-06-24T17:22:44Z", "pr_url": "https://github.com/apache/geode/pull/5297", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA2MDMxOA==", "url": "https://github.com/apache/geode/pull/5297#discussion_r445060318", "bodyText": "Is Attributes.put() what avoids re-writing the entire block?", "author": "rhoughton-pivot", "createdAt": "2020-06-24T17:36:23Z", "path": "gradle/publish-java.gradle", "diffHunk": "@@ -28,3 +28,41 @@ publishing {\n     }\n   }\n }\n+\n+gradle.taskGraph.whenReady({ graph ->\n+  tasks.withType(Jar).each { jar ->\n+    jar.doFirst {\n+      def projectDependencies = []\n+      def runtimeList = []\n+\n+      configurations.runtimeClasspath\n+              .collect { it.name - \".jar\" }\n+              .each { dependency ->\n+                if (dependency.startsWith(\"geode-\")) {\n+                  projectDependencies.add(dependency)\n+                } else {\n+                  runtimeList.add(dependency)\n+                }\n+              }\n+\n+      projectDependencies.clone().each { projectDependency ->\n+        def geodeProject = projectDependency - \"-${version}.jar\"\n+        if (projectDependencies.contains(geodeProject)) {\n+          def parentProject = project(\":$geodeProject\" - \"-$version\")\n+          if (parentProject != null) {\n+            def collect = parentProject.configurations.runtimeClasspath.collect { it.name - \".jar\" }\n+            runtimeList.removeAll(collect)\n+            projectDependencies.removeAll(collect)\n+          }\n+        }\n+      }\n+\n+      manifest {\n+        attributes.put(\"Class-Path\", runtimeList.join(' '))", "originalCommit": "1933531aa044e0cca0f49306f6e5c62c803760d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA3NTE3Ng==", "url": "https://github.com/apache/geode/pull/5297#discussion_r445075176", "bodyText": "Yes", "author": "yozaner1324", "createdAt": "2020-06-24T18:02:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA2MDMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA3NTU1Nw==", "url": "https://github.com/apache/geode/pull/5297#discussion_r445075557", "bodyText": "yes..", "author": "kohlmu-pivotal", "createdAt": "2020-06-24T18:03:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA2MDMxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA2MTYxOQ==", "url": "https://github.com/apache/geode/pull/5297#discussion_r445061619", "bodyText": "Can we get a comment block on the logic of what is being pruned out from this list? I get it, but I also consulted on it in the first place", "author": "rhoughton-pivot", "createdAt": "2020-06-24T17:38:44Z", "path": "gradle/publish-java.gradle", "diffHunk": "@@ -28,3 +28,41 @@ publishing {\n     }\n   }\n }\n+\n+gradle.taskGraph.whenReady({ graph ->\n+  tasks.withType(Jar).each { jar ->\n+    jar.doFirst {\n+      def projectDependencies = []\n+      def runtimeList = []\n+\n+      configurations.runtimeClasspath\n+              .collect { it.name - \".jar\" }\n+              .each { dependency ->\n+                if (dependency.startsWith(\"geode-\")) {\n+                  projectDependencies.add(dependency)\n+                } else {\n+                  runtimeList.add(dependency)\n+                }\n+              }\n+\n+      projectDependencies.clone().each { projectDependency ->", "originalCommit": "1933531aa044e0cca0f49306f6e5c62c803760d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA3NTg0MQ==", "url": "https://github.com/apache/geode/pull/5297#discussion_r445075841", "bodyText": "ok.. we'll comment on what and how the pruning is happening.", "author": "kohlmu-pivotal", "createdAt": "2020-06-24T18:03:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA2MTYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyOTIzNw==", "url": "https://github.com/apache/geode/pull/5297#discussion_r445129237", "bodyText": "Perfect.", "author": "rhoughton-pivot", "createdAt": "2020-06-24T19:43:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA2MTYxOQ=="}], "type": "inlineReview"}, {"oid": "f268b4cddff4c3682a04ac443152f60e8838bf4f", "url": "https://github.com/apache/geode/commit/f268b4cddff4c3682a04ac443152f60e8838bf4f", "message": "GEODE-8239 - Add gradle config to add 'Class-Path' and 'Dependent-Modules' attirbutes to manifest file.", "committedDate": "2020-06-24T18:16:05Z", "type": "commit"}, {"oid": "f268b4cddff4c3682a04ac443152f60e8838bf4f", "url": "https://github.com/apache/geode/commit/f268b4cddff4c3682a04ac443152f60e8838bf4f", "message": "GEODE-8239 - Add gradle config to add 'Class-Path' and 'Dependent-Modules' attirbutes to manifest file.", "committedDate": "2020-06-24T18:16:05Z", "type": "forcePushed"}]}