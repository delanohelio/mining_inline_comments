{"pr_number": 5306, "pr_title": "GEODE-8195: ConcurrentModificationException from LocatorMembershipLis\u2026", "pr_createdAt": "2020-06-25T20:13:06Z", "pr_url": "https://github.com/apache/geode/pull/5306", "timeline": [{"oid": "37eed4e9e4ce3dcb334b63d3216dd7e0a04e5b90", "url": "https://github.com/apache/geode/commit/37eed4e9e4ce3dcb334b63d3216dd7e0a04e5b90", "message": "GEODE-8195: ConcurrentModificationException from LocatorMembershipListenerImpl\n\nI've replaced the \"for\" loop using an implicit Iterator with one using an\nexplicit Iterator so that its safe \"remove()\" method can be used.  The\nIterator method is stated as being the only safe way to modify the\ncollection while iterating over its contents.\n\nI've also modified a test to validate the fix.  The test forces a\nfailure to send two messages to an address.  The failures are then\nhandled in the code that was throwing the\nConcurrentModificationException and, since there are two failures,\nit causes two removals to be performedon the failedMessages collection.", "committedDate": "2020-06-25T20:03:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgzNjQyOQ==", "url": "https://github.com/apache/geode/pull/5306#discussion_r445836429", "bodyText": "If a sleep is interrupted we now bail out of run() entirely, rather than continuing on to attempt delivering the message to the next target. Why the change?", "author": "Bill", "createdAt": "2020-06-25T21:02:45Z", "path": "geode-wan/src/main/java/org/apache/geode/cache/client/internal/locator/wan/LocatorMembershipListenerImpl.java", "diffHunk": "@@ -328,6 +331,7 @@ public void run() {\n                   Thread.currentThread().interrupt();\n                   logger.warn(\n                       \"Locator Membership listener permanently failed to exchange locator information due to interruption.\");\n+                  return;", "originalCommit": "37eed4e9e4ce3dcb334b63d3216dd7e0a04e5b90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg0MDU5Nw==", "url": "https://github.com/apache/geode/pull/5306#discussion_r445840597", "bodyText": "The exception handler was leaving the interrupt bit set.  Nothing useful could happen after that.  Any I/O operations that it attempted would fail, resulting in the thread hanging around sleeping until it gave up;.", "author": "bschuchardt", "createdAt": "2020-06-25T21:11:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgzNjQyOQ=="}], "type": "inlineReview"}]}