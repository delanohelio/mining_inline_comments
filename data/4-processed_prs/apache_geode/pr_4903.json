{"pr_number": 4903, "pr_title": "GEODE-7098: Tomcat8SessionsClientServerDUnitTest Tests were getting bind failures", "pr_createdAt": "2020-04-03T16:31:19Z", "pr_url": "https://github.com/apache/geode/pull/4903", "timeline": [{"oid": "f0beac1f8688be02793f1ee2e8ec5d197035ebea", "url": "https://github.com/apache/geode/commit/f0beac1f8688be02793f1ee2e8ec5d197035ebea", "message": "GEODE-7098: Tests were getting bind failures using SocketUtils.getAvailableTCPPort\n\n- Moved tests to use AvailablePortHelper class\n- Added Sanity check to setup", "committedDate": "2020-04-03T05:01:03Z", "type": "commit"}, {"oid": "099ba3a2dff7258ee530bc440e9871838181c241", "url": "https://github.com/apache/geode/commit/099ba3a2dff7258ee530bc440e9871838181c241", "message": "GEODE-7098: spotless cleanup of tests.", "committedDate": "2020-04-03T16:34:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0NzQ4NA==", "url": "https://github.com/apache/geode/pull/4903#discussion_r403347484", "bodyText": "Did you mean to leave checkSanity() in the code?", "author": "kirklund", "createdAt": "2020-04-03T21:34:10Z", "path": "extensions/geode-modules-tomcat8/src/distributedTest/java/org/apache/geode/modules/session/Tomcat8SessionsDUnitTest.java", "diffHunk": "@@ -53,6 +53,7 @@ public void setUp() throws Exception {\n \n     sessionManager.getTheContext().setSessionTimeout(30);\n     region.clear();\n+    checkSanity();", "originalCommit": "099ba3a2dff7258ee530bc440e9871838181c241", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1MTAzNQ==", "url": "https://github.com/apache/geode/pull/4903#discussion_r403351035", "bodyText": "Yes.", "author": "mhansonp", "createdAt": "2020-04-03T21:43:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0NzQ4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1MjAwMA==", "url": "https://github.com/apache/geode/pull/4903#discussion_r403352000", "bodyText": "This assertion says \"The region should be empty\" but then it's asserted to be equalTo(1) which isn't empty. Should it be empty or one?", "author": "kirklund", "createdAt": "2020-04-03T21:46:21Z", "path": "extensions/geode-modules-tomcat8/src/distributedTest/java/org/apache/geode/modules/session/TestSessionsTomcat8Base.java", "diffHunk": "@@ -399,7 +407,7 @@ public void testExtraSessionsNotCreated() throws Exception {\n \n     WebResponse response = wc.getResponse(req);\n     assertThat(response.getText()).isEqualTo(\"done\");\n-    assertThat(region.size()).as(\"The region should be empty\").isEqualTo(0);\n+    assertThat(region.size()).as(\"The region should be empty\").isEqualTo(1);", "originalCommit": "099ba3a2dff7258ee530bc440e9871838181c241", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1NjM2MQ==", "url": "https://github.com/apache/geode/pull/4903#discussion_r403356361", "bodyText": "fixed.", "author": "mhansonp", "createdAt": "2020-04-03T21:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1MjAwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMzMjQ1Ng==", "url": "https://github.com/apache/geode/pull/4903#discussion_r403332456", "bodyText": "Did you intend to leave the logger and debug message in the test?", "author": "igodwin", "createdAt": "2020-04-03T20:59:04Z", "path": "extensions/geode-modules-tomcat8/src/distributedTest/java/org/apache/geode/modules/session/TestSessionsTomcat8Base.java", "diffHunk": "@@ -44,26 +45,33 @@\n \n   @Rule\n   public CacheRule cacheRule = new CacheRule();\n+  protected Logger logger = LogService.getLogger();\n \n-  VM vm0;\n   int port;\n   EmbeddedTomcat8 server;\n   StandardWrapper servlet;\n   Region<String, HttpSession> region;\n   DeltaSessionManager sessionManager;\n \n+  public void checkSanity() throws Exception {\n+    testSanity();\n+  }\n+\n   /**\n    * Check that the basics are working\n    */\n-  @Test\n   public void testSanity() throws Exception {\n     WebConversation wc = new WebConversation();\n+    assertThat(wc).describedAs(\"WebConversation was\").isNotNull();\n+    logger.debug(\"Sending request to http://localhost:{}/test\", port);", "originalCommit": "099ba3a2dff7258ee530bc440e9871838181c241", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0MTk4OA==", "url": "https://github.com/apache/geode/pull/4903#discussion_r403341988", "bodyText": "Would you either update the description or make it so that we're really testing for an empty region?", "author": "igodwin", "createdAt": "2020-04-03T21:20:52Z", "path": "extensions/geode-modules-tomcat8/src/distributedTest/java/org/apache/geode/modules/session/TestSessionsTomcat8Base.java", "diffHunk": "@@ -399,7 +407,7 @@ public void testExtraSessionsNotCreated() throws Exception {\n \n     WebResponse response = wc.getResponse(req);\n     assertThat(response.getText()).isEqualTo(\"done\");\n-    assertThat(region.size()).as(\"The region should be empty\").isEqualTo(0);\n+    assertThat(region.size()).as(\"The region should be empty\").isEqualTo(1);", "originalCommit": "099ba3a2dff7258ee530bc440e9871838181c241", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "acd732371ed1543cf4882d65fc68dd3dd7a8332d", "url": "https://github.com/apache/geode/commit/acd732371ed1543cf4882d65fc68dd3dd7a8332d", "message": "GEODE-7098: refactoring\n\n- rename checkSanity call to basicConnectivityCheck\n- inline testSanity", "committedDate": "2020-04-03T21:56:09Z", "type": "commit"}]}