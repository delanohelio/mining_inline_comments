{"pr_number": 5636, "pr_title": "GEODE-8622: Redis INCRBYFLOAT error messages are consistent with native Redis", "pr_createdAt": "2020-10-16T19:12:14Z", "pr_url": "https://github.com/apache/geode/pull/5636", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3NTgxNg==", "url": "https://github.com/apache/geode/pull/5636#discussion_r506675816", "bodyText": "It would be good to make this timeout the same as the one from awaitility:\nMath.toIntExact(GeodeAwaitility.getTimeout().toMillis());", "author": "sabbey37", "createdAt": "2020-10-16T19:18:14Z", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/executor/string/AbstractIncrByFloatIntegrationTest.java", "diffHunk": "@@ -15,24 +15,25 @@\n package org.apache.geode.redis.internal.executor.string;\n \n import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n \n-import java.util.Random;\n+import java.math.BigDecimal;\n \n import org.junit.After;\n import org.junit.Before;\n+import org.junit.Ignore;\n import org.junit.Test;\n import redis.clients.jedis.Jedis;\n+import redis.clients.jedis.Protocol;\n \n import org.apache.geode.test.dunit.rules.RedisPortSupplier;\n \n public abstract class AbstractIncrByFloatIntegrationTest implements RedisPortSupplier {\n \n   private Jedis jedis;\n-  private Random rand;\n \n   @Before\n   public void setUp() {\n-    rand = new Random();\n     jedis = new Jedis(\"localhost\", getPort(), 10000000);", "originalCommit": "45e882f3fd4ac9cb9790434c5201a3ff76498068", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgzNzEyMg==", "url": "https://github.com/apache/geode/pull/5636#discussion_r508837122", "bodyText": "Done", "author": "jdeppe-pivotal", "createdAt": "2020-10-20T21:02:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3NTgxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY5NzQyMQ==", "url": "https://github.com/apache/geode/pull/5636#discussion_r506697421", "bodyText": "Redis uses the methods isnan (https://en.cppreference.com/w/c/numeric/math/isnan) and isinf (https://en.cppreference.com/w/c/numeric/math/isinf) from the math library, which seem to check more than the string literals.  Also, not all strings that contain inf or nan would produce NaN or Infinity.  Some are just invalid floats.", "author": "sabbey37", "createdAt": "2020-10-16T20:08:23Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/string/IncrByFloatExecutor.java", "diffHunk": "@@ -46,15 +44,14 @@ public RedisResponse executeCommand(Command command,\n     byte[] incrArray = commandElems.get(INCREMENT_INDEX);\n     String doub = Coder.bytesToString(incrArray).toLowerCase();\n     if (doub.contains(\"inf\") || doub.contains(\"nan\")) {", "originalCommit": "45e882f3fd4ac9cb9790434c5201a3ff76498068", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgzNzAxMA==", "url": "https://github.com/apache/geode/pull/5636#discussion_r508837010", "bodyText": "Add a regex which should cover all options (I hope).", "author": "jdeppe-pivotal", "createdAt": "2020-10-20T21:01:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY5NzQyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcwMTA1OA==", "url": "https://github.com/apache/geode/pull/5636#discussion_r506701058", "bodyText": "It would be nice to add a test making sure the correct error is returned when we try to do INCRBYFLOAT on a key whose value is not a string.", "author": "sabbey37", "createdAt": "2020-10-16T20:17:05Z", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/executor/string/AbstractIncrByFloatIntegrationTest.java", "diffHunk": "@@ -15,24 +15,25 @@\n package org.apache.geode.redis.internal.executor.string;\n \n import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n \n-import java.util.Random;\n+import java.math.BigDecimal;\n \n import org.junit.After;\n import org.junit.Before;\n+import org.junit.Ignore;\n import org.junit.Test;\n import redis.clients.jedis.Jedis;\n+import redis.clients.jedis.Protocol;\n \n import org.apache.geode.test.dunit.rules.RedisPortSupplier;\n \n public abstract class AbstractIncrByFloatIntegrationTest implements RedisPortSupplier {", "originalCommit": "45e882f3fd4ac9cb9790434c5201a3ff76498068", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgwMzAxNQ==", "url": "https://github.com/apache/geode/pull/5636#discussion_r508803015", "bodyText": "I think I have that now. Let me know if you think it should cover other data types too.", "author": "jdeppe-pivotal", "createdAt": "2020-10-20T20:01:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcwMTA1OA=="}], "type": "inlineReview"}, {"oid": "e9de0e290f7a89015e21c30085b27472b3777e25", "url": "https://github.com/apache/geode/commit/e9de0e290f7a89015e21c30085b27472b3777e25", "message": "GEODE-8622: Redis INCRBYFLOAT error messages are consistent with native Redis\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>", "committedDate": "2020-10-19T13:33:50Z", "type": "commit"}, {"oid": "5a00d66adcfdb49bf213f103fef16cccb7b238c4", "url": "https://github.com/apache/geode/commit/5a00d66adcfdb49bf213f103fef16cccb7b238c4", "message": "Review updates", "committedDate": "2020-10-19T13:37:31Z", "type": "commit"}, {"oid": "5a00d66adcfdb49bf213f103fef16cccb7b238c4", "url": "https://github.com/apache/geode/commit/5a00d66adcfdb49bf213f103fef16cccb7b238c4", "message": "Review updates", "committedDate": "2020-10-19T13:37:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3MjM0OA==", "url": "https://github.com/apache/geode/pull/5636#discussion_r508572348", "bodyText": "Seems like this might've gotten duplicated in the merge.", "author": "sabbey37", "createdAt": "2020-10-20T14:45:54Z", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/executor/string/AbstractIncrByFloatIntegrationTest.java", "diffHunk": "@@ -30,15 +31,16 @@\n \n public abstract class AbstractIncrByFloatIntegrationTest implements RedisPortSupplier {\n \n+  private static final int JEDIS_TIMEOUT =\n+      Math.toIntExact(GeodeAwaitility.getTimeout().toMillis());\n+\n   private Jedis jedis;\n-  private Random rand;\n   private static final int REDIS_CLIENT_TIMEOUT =\n       Math.toIntExact(GeodeAwaitility.getTimeout().toMillis());", "originalCommit": "5a00d66adcfdb49bf213f103fef16cccb7b238c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgzNjgyMQ==", "url": "https://github.com/apache/geode/pull/5636#discussion_r508836821", "bodyText": "Thanks", "author": "jdeppe-pivotal", "createdAt": "2020-10-20T21:01:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3MjM0OA=="}], "type": "inlineReview"}, {"oid": "221521d8777e28aaa1a8f751076934f26be6d284", "url": "https://github.com/apache/geode/commit/221521d8777e28aaa1a8f751076934f26be6d284", "message": "Review updates", "committedDate": "2020-10-20T19:49:22Z", "type": "commit"}]}