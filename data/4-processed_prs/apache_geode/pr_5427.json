{"pr_number": 5427, "pr_title": "GEODE-8406: Enable early-return in CI scripts for CI-only changes", "pr_createdAt": "2020-08-05T21:05:17Z", "pr_url": "https://github.com/apache/geode/pull/5427", "timeline": [{"oid": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b", "url": "https://github.com/apache/geode/commit/61d3eedac7a350e9e99a9557e42119f5f8c43f0b", "message": "GEODE-8406: Enable early-return in CI scripts for CI-only changes\n\nCreates a function that tests the code changes to be:\n1) From a pull request in Geode\n2) Those changes are more than ci,  geode-book, geode-docs\n  ie: code changes, not non-testable changes", "committedDate": "2020-08-05T20:54:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjUzNg==", "url": "https://github.com/apache/geode/pull/5427#discussion_r466006536", "bodyText": "what about README.md, LICENSE, or NOTICE in the top level? or other LICENSE/NOTICE files?", "author": "onichols-pivotal", "createdAt": "2020-08-05T21:11:36Z", "path": "ci/scripts/delete_instance.sh", "diffHunk": "@@ -29,6 +29,11 @@ while [ -h \"$SOURCE\" ]; do # resolve $SOURCE until the file is no longer a symli\n done\n SCRIPTDIR=\"$( cd -P \"$( dirname \"$SOURCE\" )\" && pwd )\"\n \n+. ${SCRIPTDIR}/short_circuit_pr_tasks.sh\n+cd geode\n+  is_source_from_pr_testable \"ci\" \"dev-tools\" \"etc\" \"geode-book\" \"geode-docs\" || exit 0", "originalCommit": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNTM4Mg==", "url": "https://github.com/apache/geode/pull/5427#discussion_r466015382", "bodyText": "Yup, we can add those to the list. But based on number of times those are touched, they were low-priority for testing (and I didn't think about them)", "author": "rhoughton-pivot", "createdAt": "2020-08-05T21:30:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjUzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjgwNQ==", "url": "https://github.com/apache/geode/pull/5427#discussion_r466006805", "bodyText": "any way to avoid duplicating this list half-a-dozen places??", "author": "onichols-pivotal", "createdAt": "2020-08-05T21:12:10Z", "path": "ci/scripts/execute_tests.sh", "diffHunk": "@@ -34,6 +34,11 @@ if [[ -z \"${GRADLE_TASK}\" ]]; then\n   exit 1\n fi\n \n+. ${SCRIPTDIR}/short_circuit_pr_tasks.sh\n+cd geode\n+  is_source_from_pr_testable \"ci\" \"dev-tools\" \"etc\" \"geode-book\" \"geode-docs\" || exit 0", "originalCommit": "61d3eedac7a350e9e99a9557e42119f5f8c43f0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxMzg4Ng==", "url": "https://github.com/apache/geode/pull/5427#discussion_r466013886", "bodyText": "If you can think of one, I'm happy to. We could move the directory change into the function itself to make this a one-liner", "author": "rhoughton-pivot", "createdAt": "2020-08-05T21:26:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyMjQwOQ==", "url": "https://github.com/apache/geode/pull/5427#discussion_r466022409", "bodyText": "Is it necessary to have the arguments at all given that they are the same in every call? Seems you could whittle this down to a single line ${SCRIPTDIR}/short_circuit_pr_tasks.sh && exit 0, where short_circuit_pr_tasks.sh returns true if it should short circuit.", "author": "pivotal-jbarrett", "createdAt": "2020-08-05T21:45:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzMzIwNw==", "url": "https://github.com/apache/geode/pull/5427#discussion_r466033207", "bodyText": "I have little skin in this game but if it doesn't matter than I would make it simple but if its not going to change over time then its probably fine as it is.", "author": "pivotal-jbarrett", "createdAt": "2020-08-05T22:11:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA1MjE5OA==", "url": "https://github.com/apache/geode/pull/5427#discussion_r466052198", "bodyText": "I also have little skin in the game, but here are some options that jump out at me:\n\nLike Jake said, let short_circuit_pr_tasks be the source of truth for what directories are excluded.\nTake an arg list, and specify those args in the task's yml.  Jinja or yml anchoring could reduce duplication.\nGet exceedingly convoluted by having this check be an independent Concourse job which outputs a sentinel file, which test jobs use to determine whether or not to short-circuit to green.\n\nI feel like the first option is best for the first iteration.", "author": "PurelyApplied", "createdAt": "2020-08-05T23:07:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNjgwNQ=="}], "type": "inlineReview"}, {"oid": "bab549ca3e1d25ba69784bc6d56015dce486d153", "url": "https://github.com/apache/geode/commit/bab549ca3e1d25ba69784bc6d56015dce486d153", "message": "Applying fedback about default parameters.", "committedDate": "2020-08-05T23:19:23Z", "type": "commit"}, {"oid": "3752fb1e9435cd83806f941d3ad5be1417606b1b", "url": "https://github.com/apache/geode/commit/3752fb1e9435cd83806f941d3ad5be1417606b1b", "message": "fix the pushd/popd in script", "committedDate": "2020-08-06T16:59:27Z", "type": "commit"}, {"oid": "4d9cf4f7b757a154bd30517eb6a16a5d2e345340", "url": "https://github.com/apache/geode/commit/4d9cf4f7b757a154bd30517eb6a16a5d2e345340", "message": "populate exclude list only if we are in a PR", "committedDate": "2020-08-06T17:40:50Z", "type": "commit"}, {"oid": "bfd87c3e0fe1de3f3a2f40a6975b280c51b5aaa4", "url": "https://github.com/apache/geode/commit/bfd87c3e0fe1de3f3a2f40a6975b280c51b5aaa4", "message": "it is the caller's responsibility to ensure the cwd is the Geode repo", "committedDate": "2020-08-06T18:44:18Z", "type": "commit"}]}