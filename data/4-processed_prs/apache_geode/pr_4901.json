{"pr_number": 4901, "pr_title": "GEODE-7938: added keys query param to GET, PUT, and DELETE /{region} endpoints", "pr_createdAt": "2020-04-03T00:18:44Z", "pr_url": "https://github.com/apache/geode/pull/4901", "timeline": [{"oid": "37846a21a05d7222e1d0a4ac89f39b89317785c6", "url": "https://github.com/apache/geode/commit/37846a21a05d7222e1d0a4ac89f39b89317785c6", "message": "added keys query param to GET, PUT, and DELETE /{region} endpoints", "committedDate": "2020-04-03T00:16:44Z", "type": "commit"}, {"oid": "df3e53a6047cccbf82ff2d23213d6e8caa409ce9", "url": "https://github.com/apache/geode/commit/df3e53a6047cccbf82ff2d23213d6e8caa409ce9", "message": "WIP: need more testing of new endpoints\nneed to test that region name encoding is correct\nneed to verify the Content-Location is correct", "committedDate": "2020-04-04T00:36:09Z", "type": "commit"}, {"oid": "676ae358960159f374e6ef41b64f1124b150ff62", "url": "https://github.com/apache/geode/commit/676ae358960159f374e6ef41b64f1124b150ff62", "message": "* when getting multiple keys, results are now ordered as the request was ordered\n* the code that tests for missing keys now uses the getAll result instead of sending multiple messsages and having a race in which key is deleted after the old check but before getAll\n* the Content-Location is now set correctly when doing a get with encoded keys\n* added more tests for better coverage of the PdxBasedCrudController.", "committedDate": "2020-04-06T23:39:39Z", "type": "commit"}, {"oid": "fdd541bf587938ee3a926835bcbb4fe24278e1bb", "url": "https://github.com/apache/geode/commit/fdd541bf587938ee3a926835bcbb4fe24278e1bb", "message": "cleaned up swagger notes", "committedDate": "2020-04-06T23:59:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1Njk5MA==", "url": "https://github.com/apache/geode/pull/4901#discussion_r404456990", "bodyText": "This is less noisy and reads better:\nimport static org.hamcrest.Matchers.startsWith;\n...\nstartsWith(BASE_URL + \"/customers/\")", "author": "demery-pivotal", "createdAt": "2020-04-06T23:54:30Z", "path": "geode-web-api/src/integrationTest/java/org/apache/geode/rest/internal/web/controllers/RestAccessControllerTest.java", "diffHunk": "@@ -620,11 +639,13 @@ public void postRegions() throws Exception {\n   @SuppressWarnings(\"unchecked\")\n   @Test\n   @WithMockUser\n-  public void getCustomers() throws Exception {\n+  public void getAllCustomers() throws Exception {\n     putAll();\n     mockMvc.perform(get(\"/v1/customers?limit=ALL\")\n         .with(POST_PROCESSOR))\n         .andExpect(status().isOk())\n+        .andExpect(\n+            header().string(\"Content-Location\", new StringStartsWith(BASE_URL + \"/customers/\")))", "originalCommit": "676ae358960159f374e6ef41b64f1124b150ff62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE3Njc4MQ==", "url": "https://github.com/apache/geode/pull/4901#discussion_r405176781", "bodyText": "Yes! thank you", "author": "dschneider-pivotal", "createdAt": "2020-04-07T23:42:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1Njk5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1ODc5Mg==", "url": "https://github.com/apache/geode/pull/4901#discussion_r404458792", "bodyText": "I think you can use AssertJ's Map assertions on regions:\nassertThat(customerRegion)\n    .hasSize(60)\n    .containsKeys(\"2\", \"3\", \"4\", \"5\");\n\nThis will make the assertion failures more helpful.", "author": "demery-pivotal", "createdAt": "2020-04-07T00:00:07Z", "path": "geode-web-api/src/integrationTest/java/org/apache/geode/rest/internal/web/controllers/RestAccessControllerTest.java", "diffHunk": "@@ -740,12 +889,76 @@ public void deleteMultipleKeys() throws Exception {\n \n   @Test\n   @WithMockUser\n-  public void deleteMultipleKeysWithSlashes() throws Exception {\n-    putAllWithSlashes();\n-    mockMvc.perform(delete(\"/v1/customers/1\" + SLASH + \",2\" + SLASH + \",3\"\n-        + SLASH + \",4\" + SLASH + \",5\" + SLASH)\n-            .with(POST_PROCESSOR))\n+  public void deleteMultipleKeysWithQueryParam() throws Exception {\n+    putAll();\n+    assertThat(customerRegion.size()).isEqualTo(60);", "originalCommit": "676ae358960159f374e6ef41b64f1124b150ff62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE3OTU1OQ==", "url": "https://github.com/apache/geode/pull/4901#discussion_r405179559", "bodyText": "I changed over to hasSize.", "author": "dschneider-pivotal", "createdAt": "2020-04-07T23:51:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1ODc5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1OTU2OA==", "url": "https://github.com/apache/geode/pull/4901#discussion_r404459568", "bodyText": "I like the helper methods. They keep the test methods clean and focused.", "author": "demery-pivotal", "createdAt": "2020-04-07T00:02:48Z", "path": "geode-web-api/src/integrationTest/java/org/apache/geode/rest/internal/web/controllers/RestAccessControllerTest.java", "diffHunk": "@@ -110,6 +118,30 @@\n   private static Region<?, ?> orderRegion;\n   private static Region<String, PdxInstance> customerRegion;\n \n+  private static String createKey(int keyNumber) {\n+    return KEY_PREFIX + \"KEY\" + Integer.toString(keyNumber) + KEY_SUFFIX;\n+  }\n+\n+  private static String createEncodedKey(int keyNumber) {", "originalCommit": "676ae358960159f374e6ef41b64f1124b150ff62", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "82efbd1ad63ff8dfccb1196a80f92ea891d1d659", "url": "https://github.com/apache/geode/commit/82efbd1ad63ff8dfccb1196a80f92ea891d1d659", "message": "Added endpoint for PUT {region}?keys=encodedKey&op=CREATE.\nThis allows users to create entries that have an encodedKey.", "committedDate": "2020-04-07T23:36:56Z", "type": "commit"}, {"oid": "c8d8916d2a4b354e5e55666e9f7fce2af33f9be4", "url": "https://github.com/apache/geode/commit/c8d8916d2a4b354e5e55666e9f7fce2af33f9be4", "message": "changed test to use startsWith", "committedDate": "2020-04-07T23:44:06Z", "type": "commit"}, {"oid": "a1c2d45d6aefe79c30ab557789b43f77853b7baa", "url": "https://github.com/apache/geode/commit/a1c2d45d6aefe79c30ab557789b43f77853b7baa", "message": "test now uses hasSize", "committedDate": "2020-04-07T23:50:48Z", "type": "commit"}]}