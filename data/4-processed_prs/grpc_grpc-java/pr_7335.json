{"pr_number": 7335, "pr_title": "xds: add data type for ClusterStats", "pr_createdAt": "2020-08-18T15:47:50Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7335", "timeline": [{"oid": "030696cd265ce8ea5c77458ac61c4d7ba80cfe44", "url": "https://github.com/grpc/grpc-java/commit/030696cd265ce8ea5c77458ac61c4d7ba80cfe44", "message": "xds: add data type for ClusterStats", "committedDate": "2020-08-18T15:42:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM3ODQzOQ==", "url": "https://github.com/grpc/grpc-java/pull/7335#discussion_r472378439", "bodyText": "What about clusterServiceName? I remember there was a TODO in LoadStatsStoreImpl#generateLoadReport for setting clusterServiceName as well. You may want to complete that TODO as well.", "author": "voidzcy", "createdAt": "2020-08-18T17:53:58Z", "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -1226,4 +1230,511 @@ static ClusterWeight fromEnvoyProtoClusterWeight(\n       return new ClusterWeight(proto.getName(), proto.getWeight().getValue());\n     }\n   }\n+\n+  /**\n+   * See corresponding Envoy proto message {@link\n+   * io.envoyproxy.envoy.config.endpoint.v3.ClusterStats}.\n+   */\n+  static final class ClusterStats {\n+    private final String clusterName;\n+    @Nullable\n+    private final String clusterServiceName;\n+    private final List<UpstreamLocalityStats> upstreamLocalityStatsList;\n+    private final List<DroppedRequests> droppedRequestsList;\n+    private final long totalDroppedRequests;\n+    private final long loadReportIntervalNanos;\n+\n+    private ClusterStats(\n+        String clusterName,\n+        @Nullable String clusterServiceName,\n+        List<UpstreamLocalityStats> upstreamLocalityStatsList,\n+        List<DroppedRequests> droppedRequestsList,\n+        long totalDroppedRequests,\n+        long loadReportIntervalNanos) {\n+      this.clusterName = checkNotNull(clusterName, \"clusterName\");\n+      this.clusterServiceName = clusterServiceName;\n+      this.upstreamLocalityStatsList = Collections.unmodifiableList(\n+              checkNotNull(upstreamLocalityStatsList, \"upstreamLocalityStatsList\"));\n+      this.droppedRequestsList = Collections.unmodifiableList(\n+          checkNotNull(droppedRequestsList, \"dropRequestsList\"));\n+      this.totalDroppedRequests = totalDroppedRequests;\n+      this.loadReportIntervalNanos = loadReportIntervalNanos;\n+    }\n+\n+    String getClusterName() {\n+      return clusterName;\n+    }\n+\n+    @Nullable\n+    String getClusterServiceName() {\n+      return clusterServiceName;\n+    }\n+\n+    List<UpstreamLocalityStats> getUpstreamLocalityStatsList() {\n+      return upstreamLocalityStatsList;\n+    }\n+\n+    List<DroppedRequests> getDroppedRequestsList() {\n+      return droppedRequestsList;\n+    }\n+\n+    long getTotalDroppedRequests() {\n+      return totalDroppedRequests;\n+    }\n+\n+    long getLoadReportIntervalNanos() {\n+      return loadReportIntervalNanos;\n+    }\n+\n+    io.envoyproxy.envoy.config.endpoint.v3.ClusterStats toEnvoyProtoClusterStats() {\n+      io.envoyproxy.envoy.config.endpoint.v3.ClusterStats.Builder builder =\n+          io.envoyproxy.envoy.config.endpoint.v3.ClusterStats.newBuilder();\n+      builder.setClusterName(clusterName);", "originalCommit": "030696cd265ce8ea5c77458ac61c4d7ba80cfe44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM5MjAxMA==", "url": "https://github.com/grpc/grpc-java/pull/7335#discussion_r472392010", "bodyText": "Oops, I missed that. Done.", "author": "dapengzhang0", "createdAt": "2020-08-18T18:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM3ODQzOQ=="}], "type": "inlineReview"}, {"oid": "fe84f4ecfebdbfbf80e094788819a2c2c8e8e723", "url": "https://github.com/grpc/grpc-java/commit/fe84f4ecfebdbfbf80e094788819a2c2c8e8e723", "message": "fix missing builer.setClusterServiceName", "committedDate": "2020-08-18T18:14:47Z", "type": "commit"}, {"oid": "867a1045d58031a5ad8c0c0fb340fca253066ab7", "url": "https://github.com/grpc/grpc-java/commit/867a1045d58031a5ad8c0c0fb340fca253066ab7", "message": "set clusterServiceName if provided when generateLoadReport", "committedDate": "2020-08-18T18:16:38Z", "type": "commit"}]}