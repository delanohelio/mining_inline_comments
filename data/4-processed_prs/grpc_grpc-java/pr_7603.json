{"pr_number": 7603, "pr_title": "interop-testing: aggregate accumulated stats by RPC methods in xDS test client", "pr_createdAt": "2020-11-09T10:09:52Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7603", "timeline": [{"oid": "b0f7910a9621d0a9052a6fd5dab95af97885f655", "url": "https://github.com/grpc/grpc-java/commit/b0f7910a9621d0a9052a6fd5dab95af97885f655", "message": "Count accumulated RPC stats by methods.", "committedDate": "2020-11-09T02:22:54Z", "type": "commit"}, {"oid": "19a56ece4785148bc45d4625e1e3b373d21fd5bc", "url": "https://github.com/grpc/grpc-java/commit/19a56ece4785148bc45d4625e1e3b373d21fd5bc", "message": "Fix style", "committedDate": "2020-11-09T19:06:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkwNDA3MQ==", "url": "https://github.com/grpc/grpc-java/pull/7603#discussion_r520904071", "bodyText": "nit/optional: is this a standard way of working around Java 7's lack of getOrDefault? This seems slightly \"tricky\" to me in that it requires thinking to see that that value in the map later on will never be null when rpcsSucceededByMethod.put(rpcType.name(), succeededBase + 1);-type code is executing. Correctness here also requires knowing that no key is ever removed from these maps, which could be less obvious in the future.\nI would prefer dropping this block here and just doing the null check when incrementing the value each time, as it seems a bit clearer for future readers:\nint rpcsStarted = 0;\nif (rpcsStartedBymethod.containsKey(rpcType.name()) {\n    rpcsStarted = rpcsStartedByMethod.get(rpcType.name());\n}\nrpcsStartedByMethod.put(rpcType.name(), rpcsStarted + 1);\n\nBut then we have to use the ugly block above in several places as well, so will let you choose whether it's better as-is versus my proposal.", "author": "ericgribkoff", "createdAt": "2020-11-10T22:06:29Z", "path": "interop-testing/src/main/java/io/grpc/testing/integration/XdsTestClient.java", "diffHunk": "@@ -281,6 +280,15 @@ private void makeRpc(final RpcType rpcType, final Metadata headersToSend) {\n           currentRequestId += 1;\n           requestId = currentRequestId;\n           savedWatchers.addAll(watchers);\n+          if (!rpcsStartedByMethod.containsKey(rpcType.name())) {", "originalCommit": "19a56ece4785148bc45d4625e1e3b373d21fd5bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk0Mjg2Mg==", "url": "https://github.com/grpc/grpc-java/pull/7603#discussion_r520942862", "bodyText": "Yeah, Java 7 is cumbersome for updating map value. Updated to what you suggested.", "author": "voidzcy", "createdAt": "2020-11-10T23:37:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkwNDA3MQ=="}], "type": "inlineReview"}, {"oid": "5641cdeb35539a454742d1a00b1b9bc2925e3428", "url": "https://github.com/grpc/grpc-java/commit/5641cdeb35539a454742d1a00b1b9bc2925e3428", "message": "Improve code readability by delaying map entry null-check.", "committedDate": "2020-11-10T23:35:48Z", "type": "commit"}]}