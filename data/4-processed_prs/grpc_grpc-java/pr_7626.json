{"pr_number": 7626, "pr_title": "netty,xds: Plumb XdsClientWrapperForServerSds via eagAttributes", "pr_createdAt": "2020-11-16T21:44:40Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7626", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg0Njc0Mw==", "url": "https://github.com/grpc/grpc-java/pull/7626#discussion_r524846743", "bodyText": "Any\u00a0reason why the new param wasn't added to the end?", "author": "sanjaypujare", "createdAt": "2020-11-17T02:36:20Z", "path": "netty/src/main/java/io/grpc/netty/NettyServer.java", "diffHunk": "@@ -113,7 +115,7 @@\n       long maxConnectionIdleInNanos,\n       long maxConnectionAgeInNanos, long maxConnectionAgeGraceInNanos,\n       boolean permitKeepAliveWithoutCalls, long permitKeepAliveTimeInNanos,\n-      InternalChannelz channelz) {\n+      Attributes eagAttributes, InternalChannelz channelz) {", "originalCommit": "ec84cb31ef7134ee931fc6c3ec4e6a63b8d858ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQyOTczMw==", "url": "https://github.com/grpc/grpc-java/pull/7626#discussion_r525429733", "bodyText": "I actually went back-and-forth on it. Here it mirrors the NettyServerTransport and is more natural looking in NettyServerBuilder as channelz is not just a plain field in the builder. It doesn't matter much.", "author": "ejona86", "createdAt": "2020-11-17T19:28:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg0Njc0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NjgxOQ==", "url": "https://github.com/grpc/grpc-java/pull/7626#discussion_r524856819", "bodyText": "Remove the 2nd sentence in the comment since it doesn't \"get the getXdsClientWrapperForServerSds from the serverSdsProtocolNegotiator\". In any case with my PR this will be a non-public method so the whole comment can be removed.", "author": "sanjaypujare", "createdAt": "2020-11-17T03:11:01Z", "path": "xds/src/main/java/io/grpc/xds/internal/sds/XdsServerBuilder.java", "diffHunk": "@@ -199,26 +201,30 @@ public static XdsServerBuilder forPort(int port) {\n \n   @Override\n   public Server build() {\n+    XdsClientWrapperForServerSds xdsClient = new XdsClientWrapperForServerSds(port);\n+    ServerSdsProtocolNegotiator serverProtocolNegotiator = null;\n     if (fallbackProtocolNegotiator != null) {\n-      ServerSdsProtocolNegotiator serverProtocolNegotiator =\n-          SdsProtocolNegotiators.serverProtocolNegotiator(port, fallbackProtocolNegotiator);\n-      return buildServer(serverProtocolNegotiator);\n-    } else {\n-      return new ServerWrapperForXds(\n-          delegate.build(), new XdsClientWrapperForServerSds(port), errorNotifier);\n+      serverProtocolNegotiator =\n+          SdsProtocolNegotiators.serverProtocolNegotiator(fallbackProtocolNegotiator);\n     }\n+    return buildServer(xdsClient, serverProtocolNegotiator);\n   }\n \n   /**\n    * Creates a Server using the given serverSdsProtocolNegotiator: gets the", "originalCommit": "ec84cb31ef7134ee931fc6c3ec4e6a63b8d858ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQzMTAxMg==", "url": "https://github.com/grpc/grpc-java/pull/7626#discussion_r525431012", "bodyText": "Done. Also added a mention of xdsClient.", "author": "ejona86", "createdAt": "2020-11-17T19:30:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NjgxOQ=="}], "type": "inlineReview"}, {"oid": "403abf46e9f33cf851fd84b526f4380427f09ab6", "url": "https://github.com/grpc/grpc-java/commit/403abf46e9f33cf851fd84b526f4380427f09ab6", "message": "xds: Use eagAttributes to propagate XdsClientWrapperForServerSds\n\nThis is preparation for XdsServerCredentials, which must be created\nwithout knowledge of the server listening port.", "committedDate": "2020-11-17T19:30:45Z", "type": "forcePushed"}, {"oid": "84951d82d877c212e4b8285a650b3e2375cdd400", "url": "https://github.com/grpc/grpc-java/commit/84951d82d877c212e4b8285a650b3e2375cdd400", "message": "netty: Add plumbing for eagAttributes on server-side\n\nThis is to be used for xDS to inject configuration for the\nXdsServerCredentials. We'd like a cleaner approach, but they mostly seem\nto be more heavy-weight. We will probably address this at the same time\nwe handle the Executor being passed for TLS. In the mean time this is\neasy, doesn't hurt much, and can easily be changed in the future.", "committedDate": "2020-11-17T20:02:36Z", "type": "commit"}, {"oid": "4c62bbb7fc6cbd5531b26e48b1f6f710b68bcbb3", "url": "https://github.com/grpc/grpc-java/commit/4c62bbb7fc6cbd5531b26e48b1f6f710b68bcbb3", "message": "xds: Use eagAttributes to propagate XdsClientWrapperForServerSds\n\nThis is preparation for XdsServerCredentials, which must be created\nwithout knowledge of the server listening port.", "committedDate": "2020-11-17T20:09:29Z", "type": "commit"}, {"oid": "4c62bbb7fc6cbd5531b26e48b1f6f710b68bcbb3", "url": "https://github.com/grpc/grpc-java/commit/4c62bbb7fc6cbd5531b26e48b1f6f710b68bcbb3", "message": "xds: Use eagAttributes to propagate XdsClientWrapperForServerSds\n\nThis is preparation for XdsServerCredentials, which must be created\nwithout knowledge of the server listening port.", "committedDate": "2020-11-17T20:09:29Z", "type": "forcePushed"}]}