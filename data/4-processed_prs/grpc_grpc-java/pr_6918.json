{"pr_number": 6918, "pr_title": "netty: Reduce race window size between GOAWAY and new streams", "pr_createdAt": "2020-04-10T00:17:42Z", "pr_url": "https://github.com/grpc/grpc-java/pull/6918", "timeline": [{"oid": "7930ec5d5e1af78865d1c1bfe55ee9afacea7b6a", "url": "https://github.com/grpc/grpc-java/commit/7930ec5d5e1af78865d1c1bfe55ee9afacea7b6a", "message": "netty: Reduce race window size between GOAWAY and new streams\n\nThe race between new streams and transport shutdown is #2562, but it is still\nfar from being generally solved. This reduces the race window of new streams\nfrom (transport selection \u2192 stream created on network thread) to (transport\nselection \u2192 stream enqueued on network thread). Since only a single thread now\nneeds to do work in the stream creation race window, the window should be\ndramatically smaller.\n\nThis only reduces GOAWAY races when the server performs a graceful shutdown\n(using two GOAWAYs), as that is the only non-racy way on-the-wire to shutdown a\nconnection in HTTP/2.", "committedDate": "2020-04-10T00:03:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2NjI0OA==", "url": "https://github.com/grpc/grpc-java/pull/6918#discussion_r406866248", "bodyText": "s/Execute/Executes/", "author": "dapengzhang0", "createdAt": "2020-04-10T17:43:13Z", "path": "netty/src/main/java/io/grpc/netty/WriteQueue.java", "diffHunk": "@@ -101,6 +101,19 @@ void enqueue(Runnable runnable, boolean flush) {\n     }\n   }\n \n+  /**\n+   * Execute enqueued work directly on the current thread. This can be used to trigger writes before", "originalCommit": "7930ec5d5e1af78865d1c1bfe55ee9afacea7b6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3MzE4Nw==", "url": "https://github.com/grpc/grpc-java/pull/6918#discussion_r406873187", "bodyText": "Done. Hmm... the other methods are wrong as well. I'll leave them as-is.", "author": "ejona86", "createdAt": "2020-04-10T18:00:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2NjI0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2ODA5Ng==", "url": "https://github.com/grpc/grpc-java/pull/6918#discussion_r406868096", "bodyText": "This method should be final because initChannel() is final, also enqueue() is final.", "author": "dapengzhang0", "createdAt": "2020-04-10T17:47:57Z", "path": "netty/src/test/java/io/grpc/netty/NettyHandlerTestBase.java", "diffHunk": "@@ -203,6 +203,10 @@ public int compareTo(Delayed o) {\n     }\n   }\n \n+  protected final WriteQueue writeQueue() {", "originalCommit": "7930ec5d5e1af78865d1c1bfe55ee9afacea7b6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3MjMyMA==", "url": "https://github.com/grpc/grpc-java/pull/6918#discussion_r406872320", "bodyText": "This method is final...", "author": "ejona86", "createdAt": "2020-04-10T17:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2ODA5Ng=="}], "type": "inlineReview"}, {"oid": "40e2aa6ae8eafc5514ad02a5d9e70e999eb2437e", "url": "https://github.com/grpc/grpc-java/commit/40e2aa6ae8eafc5514ad02a5d9e70e999eb2437e", "message": "s/Execute/Executes/", "committedDate": "2020-04-10T18:02:15Z", "type": "commit"}]}