{"pr_number": 2582, "pr_title": "OpenAPI - vo manager implemented", "pr_createdAt": "2020-02-24T16:50:17Z", "pr_url": "https://github.com/CESNET/perun/pull/2582", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM5NjgxOA==", "url": "https://github.com/CESNET/perun/pull/2582#discussion_r383396818", "bodyText": "There is no need to have two separate methods deleteVo and deleteVoForce, the \"force\" parameter can be declared \"required: false\" which makes it optional. Keep just one deleteVo method with the optional parameter.", "author": "martin-kuba", "createdAt": "2020-02-24T17:10:44Z", "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -6832,11 +6868,104 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO deleteVo\n+  /urlinjsonout/vosManager/deleteVo/pure:\n+    post:\n+      tags:\n+        - VosManager\n+      operationId: deleteVo\n+      summary: Deletes a VO. If VO contain members, group or resources, it's not deleted and exception is thrown.\n+      parameters:\n+        - $ref: '#/components/parameters/voId'\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/VoidResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO createVo\n+  /urlinjsonout/vosManager/deleteVo/withAll:\n+    post:\n+      tags:\n+        - VosManager\n+      operationId: deleteVoForce\n+      summary: Deletes a VO. If <code>force == true</code> then VO is deleted including members, groups and resources.\n+               Otherwise only empty VO is deleted or exception is thrown.\n+      parameters:\n+        - $ref: '#/components/parameters/voId'\n+        - { name: force, description: \"Force must be true\", schema: { type: boolean },  in: query, required: true }", "originalCommit": "e959fa09acdd5ec6800352870caa3ace3afe4ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM5OTYzMg==", "url": "https://github.com/CESNET/perun/pull/2582#discussion_r383399632", "bodyText": "The operations /json/vosManager/findCandidates and /json/vosManager/findCandidates/withMaxNumberResults can be merged into one with optional parameter maxNumOfResults.", "author": "martin-kuba", "createdAt": "2020-02-24T17:15:53Z", "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -6866,11 +6995,126 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO findCandidates\n+  /json/vosManager/findCandidates:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: findCandidates\n+      summary: |\n+              Find candidates for VO. Candidates can be used to create new members. Candidates are searched\n+              in VOs external sources (if available). Candidates, which are already members of VO are never\n+              returned even if they match searchString.\n+      parameters:\n+        - $ref: '#/components/parameters/id'\n+        - { name: searchString, schema: { type: string}, in: query, required: true, description: 'Text to search by' }\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfCandidatesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO getCompleteCandidates\n+  /json/vosManager/findCandidates/withMaxNumberResults:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: findCandidatesWithMaximumNumberResults\n+      summary: |\n+              Find candidates for VO with specified maximum number of results. Candidates can be used to create new members.\n+              Candidates are searched in VOs external sources (if available). Candidates, which are already members of VO are never\n+              returned even if they match searchString.\n+      parameters:\n+        - $ref: '#/components/parameters/id'\n+        - { name: searchString, schema: { type: string}, in: query, required: true, description: 'Text to search by' }\n+        - { name: maxNumOfResults, schema: { type: integer}, in: query, required: true, description: 'Number of maximum results' }", "originalCommit": "e959fa09acdd5ec6800352870caa3ace3afe4ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQwMDYwNg==", "url": "https://github.com/CESNET/perun/pull/2582#discussion_r383400606", "bodyText": "Can be replaced with $ref: '#/components/parameters/attrNames'", "author": "martin-kuba", "createdAt": "2020-02-24T17:17:43Z", "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -6866,11 +6995,126 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO findCandidates\n+  /json/vosManager/findCandidates:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: findCandidates\n+      summary: |\n+              Find candidates for VO. Candidates can be used to create new members. Candidates are searched\n+              in VOs external sources (if available). Candidates, which are already members of VO are never\n+              returned even if they match searchString.\n+      parameters:\n+        - $ref: '#/components/parameters/id'\n+        - { name: searchString, schema: { type: string}, in: query, required: true, description: 'Text to search by' }\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfCandidatesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO getCompleteCandidates\n+  /json/vosManager/findCandidates/withMaxNumberResults:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: findCandidatesWithMaximumNumberResults\n+      summary: |\n+              Find candidates for VO with specified maximum number of results. Candidates can be used to create new members.\n+              Candidates are searched in VOs external sources (if available). Candidates, which are already members of VO are never\n+              returned even if they match searchString.\n+      parameters:\n+        - $ref: '#/components/parameters/id'\n+        - { name: searchString, schema: { type: string}, in: query, required: true, description: 'Text to search by' }\n+        - { name: maxNumOfResults, schema: { type: integer}, in: query, required: true, description: 'Number of maximum results' }\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfCandidatesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO getVosCount\n+  /json/vosManager/findCandidates/forGroup:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: findCandidatesForGroup\n+      summary: |\n+              Find candidates for Group. Candidates can be used to create new VO and Group members. Candidates are searched\n+              in Groups external sources (if available). Candidates, which are already members of VO are never\n+              returned even if they match searchString.\n+      parameters:\n+        - { name: group, schema: { type: integer}, in: query, required: true, description: 'group id' }\n+        - { name: searchString, schema: { type: string}, in: query, required: true, description: 'Text to search by' }\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfCandidatesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n+\n+  /json/vosManager/getCompleteCandidates/forVo:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: getCompleteCandidatesForVo\n+      summary: |\n+                Find MemberCandidates for VO. MemberCandidates can be used to create new members. They are made of Candidate,\n+                RichUser and Member objects. Candidates are searched in VO's external sources (if available). RichUsers are\n+                searched in given VO and are associated with appropriate candidate and member. RichUsers for MemberCandidates\n+                may also be searched in the whole Perun.\n+      parameters:\n+        - { name: vo, schema: { type: integer}, in: query, required: true, description: 'vo id' }\n+        - name: attrNames", "originalCommit": "e959fa09acdd5ec6800352870caa3ace3afe4ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQwMDc2OA==", "url": "https://github.com/CESNET/perun/pull/2582#discussion_r383400768", "bodyText": "dtto", "author": "martin-kuba", "createdAt": "2020-02-24T17:18:02Z", "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -6866,11 +6995,126 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO findCandidates\n+  /json/vosManager/findCandidates:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: findCandidates\n+      summary: |\n+              Find candidates for VO. Candidates can be used to create new members. Candidates are searched\n+              in VOs external sources (if available). Candidates, which are already members of VO are never\n+              returned even if they match searchString.\n+      parameters:\n+        - $ref: '#/components/parameters/id'\n+        - { name: searchString, schema: { type: string}, in: query, required: true, description: 'Text to search by' }\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfCandidatesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO getCompleteCandidates\n+  /json/vosManager/findCandidates/withMaxNumberResults:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: findCandidatesWithMaximumNumberResults\n+      summary: |\n+              Find candidates for VO with specified maximum number of results. Candidates can be used to create new members.\n+              Candidates are searched in VOs external sources (if available). Candidates, which are already members of VO are never\n+              returned even if they match searchString.\n+      parameters:\n+        - $ref: '#/components/parameters/id'\n+        - { name: searchString, schema: { type: string}, in: query, required: true, description: 'Text to search by' }\n+        - { name: maxNumOfResults, schema: { type: integer}, in: query, required: true, description: 'Number of maximum results' }\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfCandidatesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO getVosCount\n+  /json/vosManager/findCandidates/forGroup:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: findCandidatesForGroup\n+      summary: |\n+              Find candidates for Group. Candidates can be used to create new VO and Group members. Candidates are searched\n+              in Groups external sources (if available). Candidates, which are already members of VO are never\n+              returned even if they match searchString.\n+      parameters:\n+        - { name: group, schema: { type: integer}, in: query, required: true, description: 'group id' }\n+        - { name: searchString, schema: { type: string}, in: query, required: true, description: 'Text to search by' }\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfCandidatesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n+\n+  /json/vosManager/getCompleteCandidates/forVo:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: getCompleteCandidatesForVo\n+      summary: |\n+                Find MemberCandidates for VO. MemberCandidates can be used to create new members. They are made of Candidate,\n+                RichUser and Member objects. Candidates are searched in VO's external sources (if available). RichUsers are\n+                searched in given VO and are associated with appropriate candidate and member. RichUsers for MemberCandidates\n+                may also be searched in the whole Perun.\n+      parameters:\n+        - { name: vo, schema: { type: integer}, in: query, required: true, description: 'vo id' }\n+        - name: attrNames\n+          description: 'list with names of attributes that should be find'\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+          in: query\n+          required: true\n+        - { name: searchString, schema: { type: string}, in: query, required: true, description: 'Text to search by' }\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfMemberCandidatesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n+\n+  /json/vosManager/getCompleteCandidates/forGroup:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: getCompleteCandidatesForGroup\n+      summary: |\n+                Find MemberCandidates for GROUP. MemberCandidates can be used to create new members. They are made of Candidate,\n+                RichUser and Member objects. Candidates are searched in VO's or GROUP's (depends on privileges) external sources\n+                (if available). RichUsers are searched in given VO and are associated with appropriate candidate and member.\n+                RichUsers for appropriate Candidate are also searched in the whole Perun.\n+      parameters:\n+        - { name: group, schema: { type: integer}, in: query, required: true, description: 'group id' }\n+        - name: attrNames", "originalCommit": "e959fa09acdd5ec6800352870caa3ace3afe4ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQwNTY3OA==", "url": "https://github.com/CESNET/perun/pull/2582#discussion_r383405678", "bodyText": "The authorizedGroup parameter is repeated at methods addSponsorRoleToGroup, removeSponsorRoleFromGroup, addVoAdminGroup, removeVoAdminGroup, addFacilityAdminGroup, removeFacilityAdminGroup, addAdminToGroup, removeGroupAdminResource. Please declare it in #/components/parameters and use $ref to reference it.", "author": "martin-kuba", "createdAt": "2020-02-24T17:26:33Z", "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -6934,7 +7206,35 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n-  #TODO removeSponsorRole\n+  /urlinjsonout/vosManager/removeSponsorRole/user:\n+    post:\n+      tags:\n+        - VosManager\n+      operationId: removeSponsorRoleFromUser\n+      summary: Removes user as a sponsor. His or her sponsored members will be set as expired if the user was their last sponsor.\n+      parameters:\n+        - $ref: '#/components/parameters/voId'\n+        - $ref: '#/components/parameters/userId'\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/VoidResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n+\n+  /urlinjsonout/vosManager/removeSponsorRole/group:\n+    post:\n+      tags:\n+        - VosManager\n+      operationId: removeSponsorRoleFromGroup\n+      summary: Removes group as a sponsor. All group members will cease to be sponsors, and their sponsored members will be set as expired if the group member was their last sponsor.\n+      parameters:\n+        - $ref: '#/components/parameters/voId'\n+        - { name: authorizedGroup, schema: { type: integer}, in: query, required: true, description: 'Group id' }", "originalCommit": "e959fa09acdd5ec6800352870caa3ace3afe4ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQwODgzOA==", "url": "https://github.com/CESNET/perun/pull/2582#discussion_r383408838", "bodyText": "Please use the shorter \"flow mapping\" syntax as for the other parameters.", "author": "martin-kuba", "createdAt": "2020-02-24T17:32:24Z", "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -6972,8 +7272,34 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n-\n-  #TODO getRichAdmins\n+  /json/vosManager/getRichAdmins:\n+    get:\n+      tags:\n+        - VosManager\n+      operationId: getRichAdminsForVo\n+      description: |\n+        Get list of all richUser administrators for the vo and supported role with specific attributes.\n+        Supported roles: VOOBSERVER, TOPGROUPCREATOR, VOADMIN\n+        If \"onlyDirectAdmins\" is == true, return only direct admins of the vo for supported role with specific attributes.\n+        If \"allUserAttributes\" is == true, do not specify attributes through list and return them all in objects richUser. Ignoring list of specific attributes.\n+      parameters:\n+        - $ref: '#/components/parameters/voId'\n+        - { name: role, schema: { $ref: '#/components/schemas/VoAdminRoles' }, in: query, required: true, description: 'role name'}\n+        - name: specificAttributes\n+          description: 'list of specified attributes which are needed in object richUser'", "originalCommit": "e959fa09acdd5ec6800352870caa3ace3afe4ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3bd5f564bddb2a0d2ac9415359b03244953adf47", "url": "https://github.com/CESNET/perun/commit/3bd5f564bddb2a0d2ac9415359b03244953adf47", "message": "OpenAPI - vo manager implemented\n* implement openAPI methods for vosManager\n* added new schemas and responses", "committedDate": "2020-03-02T14:08:56Z", "type": "commit"}, {"oid": "92107fc02bd4411d51162c221dd03554c3b5a171", "url": "https://github.com/CESNET/perun/commit/92107fc02bd4411d51162c221dd03554c3b5a171", "message": "OpenAPI - vo manager implemented\n* changes according to review\n* added new parameters and used them in vo and facility managers", "committedDate": "2020-03-02T14:22:59Z", "type": "commit"}, {"oid": "92107fc02bd4411d51162c221dd03554c3b5a171", "url": "https://github.com/CESNET/perun/commit/92107fc02bd4411d51162c221dd03554c3b5a171", "message": "OpenAPI - vo manager implemented\n* changes according to review\n* added new parameters and used them in vo and facility managers", "committedDate": "2020-03-02T14:22:59Z", "type": "forcePushed"}]}