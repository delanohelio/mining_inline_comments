{"pr_number": 2930, "pr_title": "Sponsorship Expiration - cron", "pr_createdAt": "2020-10-13T11:33:23Z", "pr_url": "https://github.com/CESNET/perun/pull/2930", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4Nzk2Mg==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r503887962", "bodyText": "Is there a reason for adding this class here? You are not using it here.", "author": "stavamichal", "createdAt": "2020-10-13T11:52:55Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/MembersManagerBl.java", "diffHunk": "@@ -2,6 +2,7 @@\n \n import cz.metacentrum.perun.core.api.AttributeDefinition;\n import cz.metacentrum.perun.core.api.Candidate;\n+import cz.metacentrum.perun.core.api.EnrichedSponsorship;", "originalCommit": "78fe63fcafabb5cb6f99470e040aa633c460e92e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkyMTM3MQ==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r503921371", "bodyText": "You are right, I have removed it.", "author": "Vojtech-Sassmann", "createdAt": "2020-10-13T12:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4Nzk2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4ODM5OA==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r503888398", "bodyText": "You are not using EnrichedSponsorship in this manager either.", "author": "stavamichal", "createdAt": "2020-10-13T11:53:41Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "diffHunk": "@@ -21,11 +21,13 @@\n import cz.metacentrum.perun.core.api.BanOnVo;\n import cz.metacentrum.perun.core.api.BeansUtils;\n import cz.metacentrum.perun.core.api.Candidate;\n+import cz.metacentrum.perun.core.api.EnrichedSponsorship;", "originalCommit": "78fe63fcafabb5cb6f99470e040aa633c460e92e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkyMTQ3OA==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r503921478", "bodyText": "You are right, I have removed it.", "author": "Vojtech-Sassmann", "createdAt": "2020-10-13T12:47:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4ODM5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg5NDMzNQ==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r503894335", "bodyText": "You can add information about the lowest value for 'from' and highest value for 'to' (using MIN and MAX of date).", "author": "stavamichal", "createdAt": "2020-10-13T12:03:42Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/implApi/MembersManagerImplApi.java", "diffHunk": "@@ -367,4 +367,15 @@\n \t * @throws SponsorshipDoesNotExistException if the given user is not sponsor of the given member\n \t */\n \tvoid updateSponsorshipValidity(PerunSession sess, Member sponsoredMember, User sponsor, LocalDate newValidity) throws SponsorshipDoesNotExistException;\n+\n+\t/**\n+\t * Returns sponsorship, which have validityTo in range [from, to).\n+\t * (from is inclusive, to is exclusive).\n+\t *\n+\t * @param sess session\n+\t * @param from lower validityTo bound (inclusive)\n+\t * @param to upper validityTo bound (exclusive)\n+\t * @return list of sponsorships which have validityTo set in the given range", "originalCommit": "78fe63fcafabb5cb6f99470e040aa633c460e92e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkyMTc2OQ==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r503921769", "bodyText": "I have updated the javadoc.", "author": "Vojtech-Sassmann", "createdAt": "2020-10-13T12:47:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg5NDMzNQ=="}], "type": "inlineReview"}, {"oid": "435569ab068cc811509b30b863d9f7a3dd11d503", "url": "https://github.com/CESNET/perun/commit/435569ab068cc811509b30b863d9f7a3dd11d503", "message": "Sponsorship Expiration - cron\n\n* Implemented expiring of sponsorship. If some sponsorships have\nvalidityTo set in the past and are still active, they will be removed\nand a SponsorshipExpired event will me emitted.\n* Also, all incoming sponsorship expirations are audited. 1,7, and 14\ndays before the last day of validity, a SponsorspiExpirationInDays is\nemmited. 28 days before the last day of validity, a\nSponsorshipExpirationInDays is emitted.", "committedDate": "2020-10-13T12:46:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNjQ4Mw==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r504536483", "bodyText": "Nit: you can add the info about MIN and MAX value also to this layer.", "author": "balcirakpeter", "createdAt": "2020-10-14T09:31:23Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/MembersManagerBl.java", "diffHunk": "@@ -1686,4 +1686,15 @@\n \t * @throws SponsorshipDoesNotExistException if the given user is not sponsor of the given member\n \t */\n \tvoid updateSponsorshipValidity(PerunSession sess, Member sponsoredMember, User sponsor, LocalDate newValidity) throws SponsorshipDoesNotExistException;\n+\n+\t/**\n+\t * Returns sponsorship, which have validityTo in range [from, to).\n+\t * (from is inclusive, to is exclusive).\n+\t *\n+\t * @param sess session\n+\t * @param from lower validityTo bound (inclusive)", "originalCommit": "435569ab068cc811509b30b863d9f7a3dd11d503", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU4MTMyNQ==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r505581325", "bodyText": "Done.", "author": "Vojtech-Sassmann", "createdAt": "2020-10-15T14:19:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNjQ4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNjk5Mw==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r504536993", "bodyText": "Nit: You could add null checks for from and to variables.", "author": "balcirakpeter", "createdAt": "2020-10-14T09:32:15Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "diffHunk": "@@ -2487,6 +2487,11 @@ public void updateSponsorshipValidity(PerunSession sess, Member sponsoredMember,\n \t\tperunBl.getAuditer().log(sess, new SponsorshipValidityUpdated(sponsoredMember, sponsor, newValidity));\n \t}\n \n+\t@Override\n+\tpublic List<Sponsorship> getSponsorshipsExpiringInRange(PerunSession sess, LocalDate from, LocalDate to) {\n+\t\treturn membersManagerImpl.getSponsorshipsExpiringInRange(sess, from, to);", "originalCommit": "435569ab068cc811509b30b863d9f7a3dd11d503", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU4MTM4Mg==", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r505581382", "bodyText": "Done.", "author": "Vojtech-Sassmann", "createdAt": "2020-10-15T14:19:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNjk5Mw=="}], "type": "inlineReview"}, {"oid": "277c96c72fda76cd47f335540d295454e0c51d1d", "url": "https://github.com/CESNET/perun/commit/277c96c72fda76cd47f335540d295454e0c51d1d", "message": "Sponsorship Expiration - cron\n\n* Implemented expiring of sponsorship. If some sponsorships have\nvalidityTo set in the past and are still active, they will be removed\nand a SponsorshipExpired event will me emitted.\n* Also, all incoming sponsorship expirations are audited. 1,7, and 14\ndays before the last day of validity, a SponsorspiExpirationInDays is\nemmited. 28 days before the last day of validity, a\nSponsorshipExpirationInDays is emitted.", "committedDate": "2020-10-15T14:18:35Z", "type": "commit"}, {"oid": "277c96c72fda76cd47f335540d295454e0c51d1d", "url": "https://github.com/CESNET/perun/commit/277c96c72fda76cd47f335540d295454e0c51d1d", "message": "Sponsorship Expiration - cron\n\n* Implemented expiring of sponsorship. If some sponsorships have\nvalidityTo set in the past and are still active, they will be removed\nand a SponsorshipExpired event will me emitted.\n* Also, all incoming sponsorship expirations are audited. 1,7, and 14\ndays before the last day of validity, a SponsorspiExpirationInDays is\nemmited. 28 days before the last day of validity, a\nSponsorshipExpirationInDays is emitted.", "committedDate": "2020-10-15T14:18:35Z", "type": "forcePushed"}]}