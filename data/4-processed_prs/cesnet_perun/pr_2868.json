{"pr_number": 2868, "pr_title": "virtual attribute processing added to LDAPc", "pr_createdAt": "2020-08-24T09:39:13Z", "pr_url": "https://github.com/CESNET/perun/pull/2868", "timeline": [{"oid": "d991e210877e468f7477e346c70d4ec09680292a", "url": "https://github.com/CESNET/perun/commit/d991e210877e468f7477e346c70d4ec09680292a", "message": "definition of virtual attribute event processor", "committedDate": "2020-09-23T14:40:33Z", "type": "commit"}, {"oid": "d991e210877e468f7477e346c70d4ec09680292a", "url": "https://github.com/CESNET/perun/commit/d991e210877e468f7477e346c70d4ec09680292a", "message": "definition of virtual attribute event processor", "committedDate": "2020-09-23T14:40:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA3MDIwOA==", "url": "https://github.com/CESNET/perun/pull/2868#discussion_r494070208", "bodyText": "We recently changed member suspended message, so it should be suspended.$ just like the other member states.\nMember status within group is limited to VALID and EXPIRED states, hence we should react only on validated.$ (which is correct in above conditions) and expired.$ in here.", "author": "zlamalp", "createdAt": "2020-09-24T06:35:51Z", "path": "perun-ldapc/src/main/resources/perun-ldapc.xml", "diffHunk": "@@ -676,6 +676,105 @@ http://www.springframework.org/schema/aop http://www.springframework.org/schema/\n \t\t\t</list>\n \t\t</property>\n \t</bean>\n+\t\n+\t<!--  \n+\t  This bean processes events that would lead to change of virtual attribute and audit message\n+\t  \"virtual attribute changed\". It is here to off-load processing of the change from RPC to LDAPC.  \n+\t-->\n+\t<bean id=\"virtualAttributeEventProcessor\" class=\"cz.metacentrum.perun.ldapc.processor.impl.VirtualAttributeEventProcessor\">\n+\t\t<property name=\"dispatchConditions\">\n+\t\t\t<list>\n+\t\t\t\t<!-- group membership events -->\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" added to Group:\\[.*\\]\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" validated.$\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" was removed from Group:\\[.*\\] totally\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\"expired.$|disabled.$|invalidated.$|suspended #\"/>", "originalCommit": "d991e210877e468f7477e346c70d4ec09680292a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3NTc4NQ==", "url": "https://github.com/CESNET/perun/pull/2868#discussion_r494175785", "bodyText": "Fixed.", "author": "mvocu", "createdAt": "2020-09-24T09:36:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA3MDIwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA4OTc5Nw==", "url": "https://github.com/CESNET/perun/pull/2868#discussion_r494089797", "bodyText": "We recently changed member suspended message, so it should be suspended.$ just like the other member states.", "author": "zlamalp", "createdAt": "2020-09-24T07:16:17Z", "path": "perun-ldapc/src/main/resources/perun-ldapc.xml", "diffHunk": "@@ -676,6 +676,105 @@ http://www.springframework.org/schema/aop http://www.springframework.org/schema/\n \t\t\t</list>\n \t\t</property>\n \t</bean>\n+\t\n+\t<!--  \n+\t  This bean processes events that would lead to change of virtual attribute and audit message\n+\t  \"virtual attribute changed\". It is here to off-load processing of the change from RPC to LDAPC.  \n+\t-->\n+\t<bean id=\"virtualAttributeEventProcessor\" class=\"cz.metacentrum.perun.ldapc.processor.impl.VirtualAttributeEventProcessor\">\n+\t\t<property name=\"dispatchConditions\">\n+\t\t\t<list>\n+\t\t\t\t<!-- group membership events -->\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" added to Group:\\[.*\\]\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" validated.$\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" was removed from Group:\\[.*\\] totally\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\"expired.$|disabled.$|invalidated.$|suspended #\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" validated.$\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\"expired.$|disabled.$|invalidated.$|suspended #\"/>", "originalCommit": "d991e210877e468f7477e346c70d4ec09680292a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3NTk0MA==", "url": "https://github.com/CESNET/perun/pull/2868#discussion_r494175940", "bodyText": "Fixed.", "author": "mvocu", "createdAt": "2020-09-24T09:36:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA4OTc5Nw=="}], "type": "inlineReview"}, {"oid": "84e1bd0fb61a987d179864643b28963e6610416f", "url": "https://github.com/CESNET/perun/commit/84e1bd0fb61a987d179864643b28963e6610416f", "message": "fix handler conditions according to review", "committedDate": "2020-09-24T09:35:33Z", "type": "commit"}]}