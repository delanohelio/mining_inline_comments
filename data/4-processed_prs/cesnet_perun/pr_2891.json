{"pr_number": 2891, "pr_title": "Core - enrichedResource", "pr_createdAt": "2020-09-09T13:46:21Z", "pr_url": "https://github.com/CESNET/perun/pull/2891", "timeline": [{"oid": "bf7d8b2e295dac0e20664e267c9784e250787280", "url": "https://github.com/CESNET/perun/commit/bf7d8b2e295dac0e20664e267c9784e250787280", "message": "Core - enrichedResource\n\n* Before, we had to way how to retrieve resource objects with theirs\nattributes. Therefore, a new EnrichedResource object has been created.\n* Created methods `getEnrichedResourceById`,\n`getEnrichedResourcesForFacility` and\n`getEnrichedResourcesForedResourcesForVo`.", "committedDate": "2020-09-10T07:57:36Z", "type": "forcePushed"}, {"oid": "7b1c3636d34e96246d8548d63fb601ba5310b8b8", "url": "https://github.com/CESNET/perun/commit/7b1c3636d34e96246d8548d63fb601ba5310b8b8", "message": "Core - enrichedResource\n\n* Before, we had to way how to retrieve resource objects with theirs\nattributes. Therefore, a new EnrichedResource object has been created.\n* Created methods `getEnrichedResourceById`,\n`getEnrichedResourcesForFacility` and\n`getEnrichedResourcesForedResourcesForVo`.", "committedDate": "2020-09-10T08:20:47Z", "type": "forcePushed"}, {"oid": "8ed518a157b65af4932a3650b9e5e4c7780caba7", "url": "https://github.com/CESNET/perun/commit/8ed518a157b65af4932a3650b9e5e4c7780caba7", "message": "Core - enrichedResource\n\n* Before, we had to way how to retrieve resource objects with theirs\nattributes. Therefore, a new EnrichedResource object has been created.\n* Created methods `getEnrichedResourceById`,\n`getEnrichedResourcesForFacility` and\n`getEnrichedResourcesForedResourcesForVo`.", "committedDate": "2020-09-10T08:27:10Z", "type": "forcePushed"}, {"oid": "d51d8fdd41d943fc69886e57e8aee42dc2787770", "url": "https://github.com/CESNET/perun/commit/d51d8fdd41d943fc69886e57e8aee42dc2787770", "message": "Core - enrichedResource\n\n* Before, we had to way how to retrieve resource objects with theirs\nattributes. Therefore, a new EnrichedResource object has been created.\n* Created methods `getEnrichedResourceById`,\n`getEnrichedResourcesForFacility` and\n`getEnrichedResourcesForedResourcesForVo`.", "committedDate": "2020-09-10T08:28:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyMzE4Ng==", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487523186", "bodyText": "RESOURCEADMIN and RESOURCESELFSERVICE are connected also to Facility objects. Therefore, you can use it in this policy.", "author": "balcirakpeter", "createdAt": "2020-09-13T12:24:33Z", "path": "perun-base/src/main/resources/perun-roles.yml", "diffHunk": "@@ -2659,6 +2671,48 @@ perun_policies:\n     include_policies:\n       - default_policy\n \n+  getEnrichedResourcesForVo_Vo_policy:\n+    policy_roles:\n+      - FACILITYADMIN:\n+      - RESOURCESELFSERVICE: Vo\n+      - RESOURCEADMIN: Vo\n+      - VOADMIN: Vo\n+      - VOOBSERVER: Vo\n+      - PERUNOBSERVER:\n+    include_policies:\n+      - default_policy\n+\n+  filter-getEnrichedResourcesForVo_Vo_policy:\n+    policy_roles:\n+      - FACILITYADMIN: Facility\n+      - RESOURCESELFSERVICE: Resource\n+      - RESOURCEADMIN: Resource\n+      - VOADMIN: Vo\n+      - VOOBSERVER: Vo\n+      - PERUNOBSERVER:\n+    include_policies:\n+      - default_policy\n+\n+  getEnrichedResourcesForFacility_Facility_policy:\n+    policy_roles:\n+      - RESOURCEADMIN:", "originalCommit": "d51d8fdd41d943fc69886e57e8aee42dc2787770", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyODUzMA==", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487528530", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tSystem.out.println(CLASS_NAME + \"getEnrichedResourceByIdWithAllAttributes\");\n          \n          \n            \n            \t\tSystem.out.println(CLASS_NAME + \"getEnrichedResourceByIdWithGivenAttributes\");", "author": "balcirakpeter", "createdAt": "2020-09-13T13:16:47Z", "path": "perun-core/src/test/java/cz/metacentrum/perun/core/entry/ResourcesManagerEntryIntegrationTest.java", "diffHunk": "@@ -1917,6 +1921,99 @@ public void removeResourceSelfServiceGroup() throws Exception {\n \t\tassertFalse(roles.contains(\"RESOURCESELFSERVICE\"));\n \t}\n \n+\t@Test\n+\tpublic void getEnrichedResourceByIdWithAllAttributes() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"getEnrichedResourceByIdWithAllAttributes\");\n+\n+\t\tvo = setUpVo();\n+\t\tfacility = setUpFacility();\n+\t\tResource resource = setUpResource();\n+\n+\t\tEnrichedResource eResource = resourcesManager.getEnrichedResourceById(sess, resource.getId(), null);\n+\n+\t\tassertThat(eResource.getResource()).isEqualTo(resource);\n+\t\tassertThat(eResource.getAttributes()).isNotEmpty();\n+\t}\n+\n+\t@Test\n+\tpublic void getEnrichedResourceByIdWithGivenAttributes() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"getEnrichedResourceByIdWithAllAttributes\");", "originalCommit": "d51d8fdd41d943fc69886e57e8aee42dc2787770", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyODY2OA==", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487528668", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  operationId: getEnrichedResourcesForFacility\n          \n          \n            \n                  operationId: getEnrichedResourcesForVo", "author": "balcirakpeter", "createdAt": "2020-09-13T13:18:29Z", "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -10562,6 +10600,36 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n+  /json/resourcesManager/getEnrichedResourcesForVo:\n+    get:\n+      tags:\n+        - ResourcesManager\n+      operationId: getEnrichedResourcesForFacility", "originalCommit": "d51d8fdd41d943fc69886e57e8aee42dc2787770", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyODY4Nw==", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487528687", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  operationId: getEnrichedResourcesForVo\n          \n          \n            \n                  operationId: getEnrichedResourcesForFacility", "author": "balcirakpeter", "createdAt": "2020-09-13T13:18:47Z", "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -10562,6 +10600,36 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n+  /json/resourcesManager/getEnrichedResourcesForVo:\n+    get:\n+      tags:\n+        - ResourcesManager\n+      operationId: getEnrichedResourcesForFacility\n+      summary: Find resources for given vo and attributes for given names. If the attrNames are empty or null, return all attributes.\n+      parameters:\n+        - $ref: '#/components/parameters/voId'\n+        - $ref: '#/components/parameters/attrNamesOptional'\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfEnrichedResourcesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n+\n+  /json/resourcesManager/getEnrichedResourcesForFacility:\n+    get:\n+      tags:\n+        - ResourcesManager\n+      operationId: getEnrichedResourcesForVo", "originalCommit": "d51d8fdd41d943fc69886e57e8aee42dc2787770", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ce0079b70887a563805db230c93454409e04263d", "url": "https://github.com/CESNET/perun/commit/ce0079b70887a563805db230c93454409e04263d", "message": "Core - enrichedResource\n\n* Before, we had to way how to retrieve resource objects with theirs\nattributes. Therefore, a new EnrichedResource object has been created.\n* Created methods `getEnrichedResourceById`,\n`getEnrichedResourcesForFacility` and\n`getEnrichedResourcesForedResourcesForVo`.", "committedDate": "2020-09-14T07:07:13Z", "type": "forcePushed"}, {"oid": "e676c8eab6f6a474e99e536a8680ac2a3aa47b74", "url": "https://github.com/CESNET/perun/commit/e676c8eab6f6a474e99e536a8680ac2a3aa47b74", "message": "Core - enrichedResource\n\n* In the old implementation, there was no way how to retrieve resource\nobjects with theirs attributes. Therefore, a new EnrichedResource\nobject has been created.\n* Created methods `getEnrichedResourceById`,\n`getEnrichedResourcesForFacility` and\n`getEnrichedResourcesForedResourcesForVo`.", "committedDate": "2020-09-14T11:30:12Z", "type": "forcePushed"}, {"oid": "dfe66df878fb208b756746229e38ec5308763e16", "url": "https://github.com/CESNET/perun/commit/dfe66df878fb208b756746229e38ec5308763e16", "message": "Core - enrichedResource\n\n* In the old implementation, there was no way how to retrieve resource\nobjects with theirs attributes. Therefore, a new EnrichedResource\nobject has been created.\n* Created methods `getEnrichedResourceById`,\n`getEnrichedResourcesForFacility` and\n`getEnrichedResourcesForVo`.", "committedDate": "2020-09-14T11:32:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg0NDAyOQ==", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487844029", "bodyText": "This is not the right place for filtering. On the business logic layer, you need to get always all objects you could have. Filtrations need to be done on entry layer.", "author": "stavamichal", "createdAt": "2020-09-14T11:35:09Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ResourcesManagerBlImpl.java", "diffHunk": "@@ -93,6 +95,12 @@ public Resource getResourceById(PerunSession sess, int id) throws ResourceNotExi\n \t\treturn getResourcesManagerImpl().getResourceById(sess, id);\n \t}\n \n+\t@Override\n+\tpublic EnrichedResource getEnrichedResourceById(PerunSession sess, int id, List<String> attrNames) throws ResourceNotExistsException {\n+\t\tResource resource = getResourceById(sess, id);\n+\t\treturn filterOnlyAllowedAttributes(sess, convertToEnrichedResource(sess, resource, attrNames));", "originalCommit": "dfe66df878fb208b756746229e38ec5308763e16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b3686ba3b77af25723403ca251e2f5dad0d57c06", "url": "https://github.com/CESNET/perun/commit/b3686ba3b77af25723403ca251e2f5dad0d57c06", "message": "Core - enrichedResource\n\n* In the old implementation, there was no way how to retrieve resource\nobjects with theirs attributes. Therefore, a new EnrichedResource\nobject has been created.\n* Created methods `getEnrichedResourceById`,\n`getEnrichedResourcesForFacility` and\n`getEnrichedResourcesForVo`.", "committedDate": "2020-09-15T07:52:00Z", "type": "commit"}, {"oid": "b3686ba3b77af25723403ca251e2f5dad0d57c06", "url": "https://github.com/CESNET/perun/commit/b3686ba3b77af25723403ca251e2f5dad0d57c06", "message": "Core - enrichedResource\n\n* In the old implementation, there was no way how to retrieve resource\nobjects with theirs attributes. Therefore, a new EnrichedResource\nobject has been created.\n* Created methods `getEnrichedResourceById`,\n`getEnrichedResourcesForFacility` and\n`getEnrichedResourcesForVo`.", "committedDate": "2020-09-15T07:52:00Z", "type": "forcePushed"}]}