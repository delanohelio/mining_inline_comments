{"pr_number": 2974, "pr_title": "New attributes rpEnvironment and rpProtocol", "pr_createdAt": "2020-11-05T07:56:36Z", "pr_url": "https://github.com/CESNET/perun/pull/2974", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1MzA4Ng==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r517953086", "bodyText": "Can you add the attribute name and the invalid value to the error message?", "author": "mvocu", "createdAt": "2020-11-05T10:40:39Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_facility_attribute_def_def_rpEnvironment.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package cz.metacentrum.perun.core.impl.modules.attributes;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributeDefinition;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.Facility;\n+import cz.metacentrum.perun.core.api.exceptions.WrongAttributeValueException;\n+import cz.metacentrum.perun.core.impl.PerunSessionImpl;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityAttributesModuleAbstract;\n+\n+/**\n+ * Attribute module for rpEnvironment. Possible values are \"TESTING\", \"STAGING\" or \"PRODUCTION\".\n+ *\n+ * @author Radoslav \u010cerh\u00e1k <r.cerhak@gmail.com>\n+ */\n+public class urn_perun_facility_attribute_def_def_rpEnvironment extends FacilityAttributesModuleAbstract {\n+\n+\t@Override\n+\tpublic void checkAttributeSyntax(PerunSessionImpl perunSession, Facility facility, Attribute attribute) throws WrongAttributeValueException {\n+\t\tString attrValue = attribute.valueAsString();\n+\t\tif (attrValue == null) return;\n+\n+\t\tif (!attrValue.equals(\"TESTING\") && !attrValue.equals(\"STAGING\") && !attrValue.equals(\"PRODUCTION\")) {\n+\t\t\tthrow new WrongAttributeValueException(attribute, facility, \"Possible values for this attribute are 'TESTING', 'STAGING' or 'PRODUCTION'\");", "originalCommit": "3a107d6c60027a211416e2d8678ac5f089ebb3fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk4MzI5Mg==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r517983292", "bodyText": "I think both the name and the value are already in the message because the final error message is created from given attribute, facility and message like this: attribute.toString() + \" Set for: \" + attributeHolder + \" - \" + message...", "author": "metodej", "createdAt": "2020-11-05T11:33:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1MzA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk5Nzg5Nw==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r517997897", "bodyText": "OK.", "author": "mvocu", "createdAt": "2020-11-05T11:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1MzA4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1MzUyNA==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r517953524", "bodyText": "Can you add the attribute name and the invalid value to the error message?", "author": "mvocu", "createdAt": "2020-11-05T10:41:23Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_facility_attribute_def_def_rpProtocol.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package cz.metacentrum.perun.core.impl.modules.attributes;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributeDefinition;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.Facility;\n+import cz.metacentrum.perun.core.api.exceptions.WrongAttributeValueException;\n+import cz.metacentrum.perun.core.impl.PerunSessionImpl;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityAttributesModuleAbstract;\n+\n+/**\n+ * Attribute module for rpProtocol. Possible values are \"SAML\" or \"OIDC\".\n+ *\n+ * @author Radoslav \u010cerh\u00e1k <r.cerhak@gmail.com>\n+ */\n+public class urn_perun_facility_attribute_def_def_rpProtocol extends FacilityAttributesModuleAbstract {\n+\n+\t@Override\n+\tpublic void checkAttributeSyntax(PerunSessionImpl perunSession, Facility facility, Attribute attribute) throws WrongAttributeValueException {\n+\t\tString attrValue = attribute.valueAsString();\n+\t\tif (attrValue == null) return;\n+\n+\t\tif (!attrValue.equals(\"SAML\") && !attrValue.equals(\"OIDC\")) {\n+\t\t\tthrow new WrongAttributeValueException(attribute, facility, \"Possible values for this attribute are 'SAML' or 'OIDC'.\");", "originalCommit": "3a107d6c60027a211416e2d8678ac5f089ebb3fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk4MzMzOQ==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r517983339", "bodyText": "I think both the name and the value are already in the message because the final error message is created from given attribute, facility and message like this: attribute.toString() + \" Set for: \" + attributeHolder + \" - \" + message...", "author": "metodej", "createdAt": "2020-11-05T11:33:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1MzUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk5ODMwMg==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r517998302", "bodyText": "OK.", "author": "mvocu", "createdAt": "2020-11-05T11:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1MzUyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1NDUxNg==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r517954516", "bodyText": "This description is not very informative, there is no information what the attribute means.", "author": "mvocu", "createdAt": "2020-11-05T10:43:04Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_facility_attribute_def_def_rpEnvironment.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package cz.metacentrum.perun.core.impl.modules.attributes;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributeDefinition;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.Facility;\n+import cz.metacentrum.perun.core.api.exceptions.WrongAttributeValueException;\n+import cz.metacentrum.perun.core.impl.PerunSessionImpl;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityAttributesModuleAbstract;\n+\n+/**\n+ * Attribute module for rpEnvironment. Possible values are \"TESTING\", \"STAGING\" or \"PRODUCTION\".\n+ *\n+ * @author Radoslav \u010cerh\u00e1k <r.cerhak@gmail.com>\n+ */\n+public class urn_perun_facility_attribute_def_def_rpEnvironment extends FacilityAttributesModuleAbstract {\n+\n+\t@Override\n+\tpublic void checkAttributeSyntax(PerunSessionImpl perunSession, Facility facility, Attribute attribute) throws WrongAttributeValueException {\n+\t\tString attrValue = attribute.valueAsString();\n+\t\tif (attrValue == null) return;\n+\n+\t\tif (!attrValue.equals(\"TESTING\") && !attrValue.equals(\"STAGING\") && !attrValue.equals(\"PRODUCTION\")) {\n+\t\t\tthrow new WrongAttributeValueException(attribute, facility, \"Possible values for this attribute are 'TESTING', 'STAGING' or 'PRODUCTION'\");\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic AttributeDefinition getAttributeDefinition() {\n+\t\tAttributeDefinition attr = new AttributeDefinition();\n+\t\tattr.setNamespace(AttributesManager.NS_FACILITY_ATTR_DEF);\n+\t\tattr.setFriendlyName(\"rpEnvironment\");\n+\t\tattr.setDisplayName(\"rpEnvironment\");\n+\t\tattr.setType(String.class.getName());\n+\t\tattr.setDescription(\"rpEnvironment\");", "originalCommit": "3a107d6c60027a211416e2d8678ac5f089ebb3fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyNTI4NQ==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r518125285", "bodyText": "Done", "author": "cuadradek", "createdAt": "2020-11-05T15:11:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1NDUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1NTEwMQ==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r517955101", "bodyText": "This description is not very informative, there is no information about the attribute meaning.", "author": "mvocu", "createdAt": "2020-11-05T10:44:02Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_facility_attribute_def_def_rpProtocol.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package cz.metacentrum.perun.core.impl.modules.attributes;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributeDefinition;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.Facility;\n+import cz.metacentrum.perun.core.api.exceptions.WrongAttributeValueException;\n+import cz.metacentrum.perun.core.impl.PerunSessionImpl;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityAttributesModuleAbstract;\n+\n+/**\n+ * Attribute module for rpProtocol. Possible values are \"SAML\" or \"OIDC\".\n+ *\n+ * @author Radoslav \u010cerh\u00e1k <r.cerhak@gmail.com>\n+ */\n+public class urn_perun_facility_attribute_def_def_rpProtocol extends FacilityAttributesModuleAbstract {\n+\n+\t@Override\n+\tpublic void checkAttributeSyntax(PerunSessionImpl perunSession, Facility facility, Attribute attribute) throws WrongAttributeValueException {\n+\t\tString attrValue = attribute.valueAsString();\n+\t\tif (attrValue == null) return;\n+\n+\t\tif (!attrValue.equals(\"SAML\") && !attrValue.equals(\"OIDC\")) {\n+\t\t\tthrow new WrongAttributeValueException(attribute, facility, \"Possible values for this attribute are 'SAML' or 'OIDC'.\");\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic AttributeDefinition getAttributeDefinition() {\n+\t\tAttributeDefinition attr = new AttributeDefinition();\n+\t\tattr.setNamespace(AttributesManager.NS_FACILITY_ATTR_DEF);\n+\t\tattr.setFriendlyName(\"rpProtocol\");\n+\t\tattr.setDisplayName(\"rpProtocol\");\n+\t\tattr.setType(String.class.getName());\n+\t\tattr.setDescription(\"rpProtocol\");", "originalCommit": "3a107d6c60027a211416e2d8678ac5f089ebb3fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyNTQwOA==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r518125408", "bodyText": "Done", "author": "cuadradek", "createdAt": "2020-11-05T15:11:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1NTEwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk4Mzk5Ng==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r517983996", "bodyText": "Also please don't forget to update description here as well.", "author": "metodej", "createdAt": "2020-11-05T11:34:35Z", "path": "perun-utils/ldapc-scripts/schemas/perun-schema.ldif", "diffHunk": "@@ -63,12 +63,14 @@ olcAttributeTypes: {58}( 1.3.6.1.4.1.8057.2.80.64 NAME 'sponsoredMembershipInOrg\n olcAttributeTypes: {59}( 1.3.6.1.4.1.8057.2.80.65 NAME 'userIdentities' DESC 'All user ExtLogin for UserExtSource with Type IDP' EQUALITY caseIgnoreMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 )\n olcAttributeTypes: {60}( 1.3.6.1.4.1.8057.2.80.66 NAME 'schacPersonalUniqueCodes' DESC 'Unique codes of the user in Perun' EQUALITY caseIgnoreMatch SUBSTR caseIgnoreSubstringsMatch ORDERING caseIgnoreOrderingMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 )\n olcAttributeTypes: {61}( 1.3.6.1.4.1.8057.2.80.67 NAME 'rpIdentifier' DESC 'rpIdentifier of facility.' EQUALITY caseExactMatch SUBSTR caseExactSubstringsMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 )\n+olcAttributeTypes: {62}( 1.3.6.1.4.1.8057.2.80.68 NAME 'rpEnvironment' DESC 'rpEnvironment' EQUALITY caseExactMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 SINGLE-VALUE )\n+olcAttributeTypes: {63}( 1.3.6.1.4.1.8057.2.80.69 NAME 'rpProtocol' DESC 'rpProtocol' EQUALITY caseExactMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 SINGLE-VALUE )", "originalCommit": "3a107d6c60027a211416e2d8678ac5f089ebb3fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyNTU0OA==", "url": "https://github.com/CESNET/perun/pull/2974#discussion_r518125548", "bodyText": "Done", "author": "cuadradek", "createdAt": "2020-11-05T15:12:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk4Mzk5Ng=="}], "type": "inlineReview"}, {"oid": "e2eeca8d66b2f4927d22b42eb6b79f30792cc8fb", "url": "https://github.com/CESNET/perun/commit/e2eeca8d66b2f4927d22b42eb6b79f30792cc8fb", "message": "New attributes rpEnvironment and rpProtocol\n\n- Created modules for facility attributes rpEnvironment and rpProtocol.\n- Attributes were added to LDAP.", "committedDate": "2020-11-05T15:02:08Z", "type": "commit"}, {"oid": "e2eeca8d66b2f4927d22b42eb6b79f30792cc8fb", "url": "https://github.com/CESNET/perun/commit/e2eeca8d66b2f4927d22b42eb6b79f30792cc8fb", "message": "New attributes rpEnvironment and rpProtocol\n\n- Created modules for facility attributes rpEnvironment and rpProtocol.\n- Attributes were added to LDAP.", "committedDate": "2020-11-05T15:02:08Z", "type": "forcePushed"}]}