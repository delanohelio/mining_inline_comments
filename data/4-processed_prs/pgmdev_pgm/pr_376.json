{"pr_number": 376, "pr_title": "Small fixes for match stats", "pr_createdAt": "2020-03-25T21:14:47Z", "pr_url": "https://github.com/PGMDev/PGM/pull/376", "timeline": [{"oid": "1258a79e7efa0a10a67f1e5ca32399ff1de7c873", "url": "https://github.com/PGMDev/PGM/commit/1258a79e7efa0a10a67f1e5ca32399ff1de7c873", "message": "Fixes bug with displaying offline players.\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-03-26T11:06:34Z", "type": "forcePushed"}, {"oid": "f0085cfea6a7c48f3fac4b88e9d3a5b55a6e9b8e", "url": "https://github.com/PGMDev/PGM/commit/f0085cfea6a7c48f3fac4b88e9d3a5b55a6e9b8e", "message": "Fixes bug with displaying offline players.\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-03-26T19:28:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNDY0OA==", "url": "https://github.com/PGMDev/PGM/pull/376#discussion_r399324648", "bodyText": "Do you have these two methods mixed up? You're adding to cached on leave and removing on join?", "author": "Electroid", "createdAt": "2020-03-27T14:55:52Z", "path": "core/src/main/java/tc/oc/pgm/modules/StatsMatchModule.java", "diffHunk": "@@ -167,6 +173,19 @@ public void onMatchEnd(MatchFinishEvent event) {\n     }\n   }\n \n+  @EventHandler\n+  public void onPlayerLeave(PlayerQuitEvent event) {\n+    Player player = event.getPlayer();\n+    if (allPlayerStats.containsKey(player.getUniqueId()))\n+      cachedPlayers.put(player.getUniqueId(), player);\n+  }\n+\n+  @EventHandler\n+  public void onPlayerJoin(PlayerJoinEvent event) {\n+    UUID playerUUID = event.getPlayer().getUniqueId();\n+    cachedPlayers.remove(playerUUID);", "originalCommit": "f0085cfea6a7c48f3fac4b88e9d3a5b55a6e9b8e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ1NDM4Mg==", "url": "https://github.com/PGMDev/PGM/pull/376#discussion_r399454382", "bodyText": "I may have used \"cahce\" wrong. I need to store every player that has stats for each match that logs off in case they get a top stat, because Bukkit might lose track of them if too many new players join.\nIf they log back on i dont need to store them anymore.\nDo you have any suggestions for something else i could call this?", "author": "KingOfSquares", "createdAt": "2020-03-27T18:14:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU2MTc1Nw==", "url": "https://github.com/PGMDev/PGM/pull/376#discussion_r399561757", "bodyText": "We can't keep Player objects in-memory after someone leaves, this will cause memory leaks. Instead, you would need to store their username, as a string.", "author": "Electroid", "createdAt": "2020-03-27T22:12:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4ODc3OQ==", "url": "https://github.com/PGMDev/PGM/pull/376#discussion_r399588779", "bodyText": "Ok!", "author": "KingOfSquares", "createdAt": "2020-03-28T00:02:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4OTA4MA==", "url": "https://github.com/PGMDev/PGM/pull/376#discussion_r399589080", "bodyText": "But is there another more suitable name for the storage?", "author": "KingOfSquares", "createdAt": "2020-03-28T00:04:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU5NTUzMA==", "url": "https://github.com/PGMDev/PGM/pull/376#discussion_r399595530", "bodyText": "@KingOfSquares could do\nprivate final Map<UUID, String> cachedUsernames = new HashMap<>();", "author": "applenick", "createdAt": "2020-03-28T00:41:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY0MTY2MQ==", "url": "https://github.com/PGMDev/PGM/pull/376#discussion_r399641661", "bodyText": "Ok! I was just wondering if not to use \"cache\", thanks :)", "author": "KingOfSquares", "createdAt": "2020-03-28T09:33:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNDY0OA=="}], "type": "inlineReview"}, {"oid": "dfa11347743d75e4d769a6ae244fa2d041b086a5", "url": "https://github.com/PGMDev/PGM/commit/dfa11347743d75e4d769a6ae244fa2d041b086a5", "message": "Delay EOM message, bolden numbers.\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-03-28T00:01:39Z", "type": "forcePushed"}, {"oid": "a6dad53d642b42570212da5f86791671db8df52e", "url": "https://github.com/PGMDev/PGM/commit/a6dad53d642b42570212da5f86791671db8df52e", "message": "Persist usernames instead of UUID, fix a NPE.\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-04-01T13:42:20Z", "type": "forcePushed"}, {"oid": "f3cc63bccf81cfd7ecc36baf27f14eabbf2ca59f", "url": "https://github.com/PGMDev/PGM/commit/f3cc63bccf81cfd7ecc36baf27f14eabbf2ca59f", "message": "Persist usernames instead of UUID, fix a NPE.\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-04-07T19:01:49Z", "type": "forcePushed"}, {"oid": "4b73476fa95cd143b15b3b25a476759dce5f0b53", "url": "https://github.com/PGMDev/PGM/commit/4b73476fa95cd143b15b3b25a476759dce5f0b53", "message": "Display KD correctly, changed phrasing for \"stats.best\".\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-04-08T18:09:08Z", "type": "commit"}, {"oid": "e39edfa0a4160218d463ba5dc4efd80804284c4a", "url": "https://github.com/PGMDev/PGM/commit/e39edfa0a4160218d463ba5dc4efd80804284c4a", "message": "Fixes bug with displaying offline players.\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-04-08T18:09:08Z", "type": "commit"}, {"oid": "ce0bfdb0fe38ed4ab536c7a213745cd7d4e2efa0", "url": "https://github.com/PGMDev/PGM/commit/ce0bfdb0fe38ed4ab536c7a213745cd7d4e2efa0", "message": "Delay EOM message, bolden numbers.\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-04-08T18:09:08Z", "type": "commit"}, {"oid": "b427f276d5badf68a004a5ba9da60a613a45cbf3", "url": "https://github.com/PGMDev/PGM/commit/b427f276d5badf68a004a5ba9da60a613a45cbf3", "message": "Persist usernames instead of UUID, fix a NPE.\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-04-08T18:09:08Z", "type": "commit"}, {"oid": "d8139d64058921f371277f0976a8e032ac31e611", "url": "https://github.com/PGMDev/PGM/commit/d8139d64058921f371277f0976a8e032ac31e611", "message": "fix KD bug when deaths were 0\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-04-08T18:09:08Z", "type": "commit"}, {"oid": "d8139d64058921f371277f0976a8e032ac31e611", "url": "https://github.com/PGMDev/PGM/commit/d8139d64058921f371277f0976a8e032ac31e611", "message": "fix KD bug when deaths were 0\n\nSigned-off-by: KingOfSquares <simonmorland@gmail.com>", "committedDate": "2020-04-08T18:09:08Z", "type": "forcePushed"}]}