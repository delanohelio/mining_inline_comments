{"pr_number": 554, "pr_title": "Rework /vote logic", "pr_createdAt": "2020-07-07T08:38:47Z", "pr_url": "https://github.com/PGMDev/PGM/pull/554", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTMwMw==", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r450705303", "bodyText": "This is adding maps randomly, it'd be nice if it added maps based on the vote-selection logic of scores and weights", "author": "Pablete1234", "createdAt": "2020-07-07T08:44:48Z", "path": "core/src/main/java/tc/oc/pgm/rotation/VotingPool.java", "diffHunk": "@@ -119,6 +119,24 @@ public boolean addCustomVoteMap(MapInfo info) {\n     return false;\n   }\n \n+  public Set<MapInfo> fillCustomMapVote() {\n+    Set<MapInfo> selected = Sets.newHashSet();\n+    if (customVoteMaps.size() < MAX_VOTE_OPTIONS) {\n+      int needed = MAX_VOTE_OPTIONS - customVoteMaps.size();\n+      int maxRetrys = MAX_VOTE_OPTIONS;\n+      while (selected.size() < needed && maxRetrys > 0) {\n+        MapInfo random = getRandom();\n+        if (!isCustomMapSelected(random)) {\n+          selected.add(random);\n+          addCustomVoteMap(random);\n+        } else {\n+          maxRetrys--;\n+        }\n+      }\n+    }\n+    return selected;", "originalCommit": "4861686495a5ece44e079b486c74b00efb3738be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNjE3Nw==", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r450706177", "bodyText": "That\u2019s a really good idea. I\u2019ll look into switching this logic around later today \ud83d\udc4d", "author": "applenick", "createdAt": "2020-07-07T08:46:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTMwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkxMzIyNQ==", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r450913225", "bodyText": "Can we just auto-fill for the user? Why require them to fill?", "author": "Electroid", "createdAt": "2020-07-07T14:35:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTMwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2MjYzMQ==", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r450962631", "bodyText": "It's just an issue of how vote modifying commands were approached, it was discussed in #540 here. It would be expected that if you just add a map to the vote it would \"force\" one map and keep the other 4 random. Instead, what vote managing commands do, is expect you to select 2-5 options for the user to pick from. Some form of a \"setnext between this options\".\nI think vote commands should always replace options of whatever vote will be held next, and maybe optionally make it so it makes the vote only the maps added via command, but i heavily doubt that will ever be used (wich is what we currently have)", "author": "Pablete1234", "createdAt": "2020-07-07T15:42:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTMwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAxNjgyOA==", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r451016828", "bodyText": "I converted this PR to a draft and will work on adjusting the logic to handle vote management as you suggested @Pablete1234 \ud83d\udc4d", "author": "applenick", "createdAt": "2020-07-07T17:09:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTMwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEwMzM4OQ==", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r451103389", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                for (int i = 0; i < voteSize; i++) {\n          \n          \n            \n                for (int i = overrides.size(); i < voteSize; i++) {", "author": "Pablete1234", "createdAt": "2020-07-07T19:48:03Z", "path": "core/src/main/java/tc/oc/pgm/rotation/MapPoll.java", "diffHunk": "@@ -68,6 +70,9 @@ private void selectMaps() {\n     NavigableMap<Double, MapInfo> cumulativeScores = new TreeMap<>();\n     double maxWeight = cummulativeMap(0, sortedDist, cumulativeScores);\n \n+    // Add all override maps before selecting random\n+    overrides.forEach(map -> votes.put(map, new HashSet<>()));\n+\n     for (int i = 0; i < voteSize; i++) {", "originalCommit": "53f2dec997d804f408883e6f04d71f0bb909f5ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTExNTM4NQ==", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r451115385", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                      Sets.newHashSet(),\n          \n          \n            \n                                      Collections.emptySet(),", "author": "Pablete1234", "createdAt": "2020-07-07T20:11:32Z", "path": "core/src/main/java/tc/oc/pgm/rotation/VotingPool.java", "diffHunk": "@@ -98,12 +101,13 @@ public void matchEnded(Match match) {\n               // If there is a restart queued, don't start a vote\n               if (RestartManager.isQueued()) return;\n               currentPoll =\n-                  shouldCustomVote()\n+                  shouldOverride()\n                       ? new MapPoll(\n                           match,\n                           getCustomVoteMapWeighted(),\n+                          Sets.newHashSet(),", "originalCommit": "53f2dec997d804f408883e6f04d71f0bb909f5ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkwMTA3NA==", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r452901074", "bodyText": "Replace and override basically mean the same thing, can we use different terms that make it more clear?", "author": "Electroid", "createdAt": "2020-07-10T15:04:21Z", "path": "util/src/main/i18n/templates/map.properties", "diffHunk": "@@ -134,3 +134,13 @@ vote.limit = Selection limit for the vote has been reached\n \n vote.title.map = Selected Maps\n \n+# {0} = player name (who toggled mode)\n+# {1} = mode name\n+vote.toggle = {0} toggled vote mode to {1}\n+\n+vote.mode.replace = Replace\n+\n+vote.mode.override = Override", "originalCommit": "64352d4d9190f7e121dbfbc18946c3f4aab27a1a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyMjc2Nw==", "url": "https://github.com/PGMDev/PGM/pull/554#discussion_r453222767", "bodyText": "@AustinLMayes suggested create as an alternative for override \ud83c\udf89\nIf you have different terms you wanted just let me know and I\u2019ll be glad to adjust it.\nOtherwise should be good to go now \ud83d\udc4d", "author": "applenick", "createdAt": "2020-07-11T18:41:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkwMTA3NA=="}], "type": "inlineReview"}, {"oid": "c2751c640ec51071d2e1821f4720d3d7d444f2a8", "url": "https://github.com/PGMDev/PGM/commit/c2751c640ec51071d2e1821f4720d3d7d444f2a8", "message": "Switch override to create\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>", "committedDate": "2020-07-11T18:39:10Z", "type": "forcePushed"}, {"oid": "26f3c05bfb0f71a71793a4450cc731a3ee0dd476", "url": "https://github.com/PGMDev/PGM/commit/26f3c05bfb0f71a71793a4450cc731a3ee0dd476", "message": "Rework /vote logic\n* Added create & replace vote modes\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>", "committedDate": "2020-07-11T18:44:55Z", "type": "commit"}, {"oid": "26f3c05bfb0f71a71793a4450cc731a3ee0dd476", "url": "https://github.com/PGMDev/PGM/commit/26f3c05bfb0f71a71793a4450cc731a3ee0dd476", "message": "Rework /vote logic\n* Added create & replace vote modes\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>", "committedDate": "2020-07-11T18:44:55Z", "type": "forcePushed"}, {"oid": "07b9ce2ceb2b04c1b7fd9a9bead00ea210de3c80", "url": "https://github.com/PGMDev/PGM/commit/07b9ce2ceb2b04c1b7fd9a9bead00ea210de3c80", "message": "Fix duplicate translation key\n\nSigned-off-by: applenick <applenick@users.noreply.github.com>", "committedDate": "2020-07-11T19:20:55Z", "type": "commit"}]}