{"pr_number": 524, "pr_title": "Add names to posts. Add support for multiple posts for one flag.", "pr_createdAt": "2020-06-04T15:45:14Z", "pr_url": "https://github.com/PGMDev/PGM/pull/524", "timeline": [{"oid": "5fc3950e1cd25a61495ac1ea1185fcd9507b168f", "url": "https://github.com/PGMDev/PGM/commit/5fc3950e1cd25a61495ac1ea1185fcd9507b168f", "message": "Fixed issue that broke maps with more than one flag.\n\nSigned-off-by: mrcookie <athertonmook@gmail.com>", "committedDate": "2020-06-04T15:46:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM3MzQwMg==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435373402", "bodyText": "@Nullable?", "author": "KingOfSquares", "createdAt": "2020-06-04T16:02:18Z", "path": "core/src/main/java/tc/oc/pgm/flag/FlagParser.java", "diffHunk": "@@ -85,6 +86,7 @@ public Post parsePost(Element el) throws InvalidXMLException {\n     Post post =\n         new Post(\n             id,\n+            name,", "originalCommit": "5fc3950e1cd25a61495ac1ea1185fcd9507b168f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMDkyNg==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435620926", "bodyText": "I think it is, or at least it is in post.java at line 41 & 47. I might be misunderstanding what you mean though.", "author": "mrcookieunderscore13", "createdAt": "2020-06-04T23:59:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM3MzQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMDIxNQ==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435630215", "bodyText": "I meant you should probably annotate the variable with @Nullable such that people understand that a name is not required and can be null.", "author": "KingOfSquares", "createdAt": "2020-06-05T00:37:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM3MzQwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM3MzQ5MA==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435373490", "bodyText": "No reason to leave this in", "author": "KingOfSquares", "createdAt": "2020-06-04T16:02:27Z", "path": "core/src/main/java/tc/oc/pgm/flag/FlagParser.java", "diffHunk": "@@ -214,15 +219,20 @@ public FlagDefinition parseFlag(Element el) throws InvalidXMLException {\n     ProximityMetric netProximityMetric =\n         ProximityMetric.parse(\n             el, \"net\", new ProximityMetric(ProximityMetric.Type.CLOSEST_PLAYER, false));\n-\n     Post defaultPost;\n-    Element elPost = XMLUtils.getUniqueChild(el, \"post\");\n-    if (elPost != null) {\n+    List<Post> flagPosts = new ArrayList<>();\n+    for (Element elPost : el.getChildren(\"post\")) {\n+      flagPosts.add(this.parsePost(elPost));\n+    }\n+    // Element elPost = XMLUtils.getUniqueChild(el, \"post\");", "originalCommit": "5fc3950e1cd25a61495ac1ea1185fcd9507b168f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM3NjU0OQ==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435376549", "bodyText": "What about Post returnPost? temp sounds weird imo", "author": "KingOfSquares", "createdAt": "2020-06-04T16:06:56Z", "path": "core/src/main/java/tc/oc/pgm/flag/Flag.java", "diffHunk": "@@ -231,8 +232,32 @@ public boolean canDropAt(Location location) {\n     }\n   }\n \n+  private int sequentialPostCounter = 0;\n+  private Post returnPost;\n+\n+  public Post getReturnPost(Post post) {\n+    if (post.isSpecifiedPost()) {\n+      return post;\n+    }\n+    if (definition.isSequential()) {\n+      Post tempPost = definition.getPosts().get(sequentialPostCounter);", "originalCommit": "5fc3950e1cd25a61495ac1ea1185fcd9507b168f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU1MDI4Nw==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435550287", "bodyText": "The \"to\" will need to be translated as well, so I would separate this into 2 translation strings. One where post name is null and another where it is not.", "author": "EricZeiberg", "createdAt": "2020-06-04T21:09:32Z", "path": "util/src/main/i18n/templates/gamemode.properties", "diffHunk": "@@ -208,8 +208,9 @@ flag.captureDenied = {0} will be captured when allowed\n flag.return = {0} has been returned\n \n # {0} = flag name\n-# {1} = duration (e.g. \"5 seconds\")\n-flag.willRespawn = {0} will respawn in {1}\n+# {1} = \" to \" + flag post name. If post name is null, {1} = \"\"\n+# {2} = duration (e.g. \"5 seconds\")\n+flag.willRespawn = {0} will respawn{1} in {2}", "originalCommit": "5fc3950e1cd25a61495ac1ea1185fcd9507b168f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyOTk5Ng==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435629996", "bodyText": "Use TranslatableComponent.of() instead of PersonalizedTranslatable (Should've told you that earlier sorry)", "author": "KingOfSquares", "createdAt": "2020-06-05T00:37:05Z", "path": "core/src/main/java/tc/oc/pgm/flag/state/Respawning.java", "diffHunk": "@@ -55,22 +55,31 @@ public void enterState() {\n     if (!Duration.ZERO.equals(respawnTime)) {\n       // Respawn is delayed\n \n-      String displayPostName = \"\";\n+      // String displayPostName = \"\";\n       String postName = this.respawnToPost.getPostName();\n       if (postName != null) {\n-        displayPostName = \" to \" + net.md_5.bungee.api.ChatColor.AQUA + postName;\n+        // displayPostName = \" to \" + net.md_5.bungee.api.ChatColor.AQUA + postName;\n+        this.flag\n+            .getMatch()\n+            .sendMessage(\n+                new PersonalizedTranslatable(\n+                    \"flag.willRespawnNamed\",\n+                    this.flag.getComponentName(),\n+                    net.md_5.bungee.api.ChatColor.AQUA + postName,\n+                    new PersonalizedText(\n+                        PeriodFormats.briefNaturalApproximate(respawnTime),\n+                        net.md_5.bungee.api.ChatColor.AQUA)));\n+      } else {\n+        this.flag\n+            .getMatch()\n+            .sendMessage(\n+                new PersonalizedTranslatable(\n+                    \"flag.willRespawn\",\n+                    this.flag.getComponentName(),\n+                    new PersonalizedText(\n+                        PeriodFormats.briefNaturalApproximate(respawnTime),\n+                        net.md_5.bungee.api.ChatColor.AQUA)));", "originalCommit": "8c101eeb47c8c834f89a2e60a8de617563af924a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMDU3NA==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435630574", "bodyText": "The comments should be removed", "author": "KingOfSquares", "createdAt": "2020-06-05T00:39:31Z", "path": "core/src/main/java/tc/oc/pgm/flag/state/Respawning.java", "diffHunk": "@@ -52,15 +54,32 @@ public void enterState() {\n \n     if (!Duration.ZERO.equals(respawnTime)) {\n       // Respawn is delayed\n-      this.flag\n-          .getMatch()\n-          .sendMessage(\n-              new PersonalizedTranslatable(\n-                  \"flag.willRespawn\",\n-                  this.flag.getComponentName(),\n-                  new PersonalizedText(\n-                      PeriodFormats.briefNaturalApproximate(respawnTime),\n-                      net.md_5.bungee.api.ChatColor.AQUA)));\n+\n+      // String displayPostName = \"\";\n+      String postName = this.respawnToPost.getPostName();\n+      if (postName != null) {\n+        // displayPostName = \" to \" + net.md_5.bungee.api.ChatColor.AQUA + postName;", "originalCommit": "8c101eeb47c8c834f89a2e60a8de617563af924a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMTMxOQ==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435631319", "bodyText": "I think this comment is missing some words \ud83e\udd14", "author": "KingOfSquares", "createdAt": "2020-06-05T00:42:39Z", "path": "core/src/main/java/tc/oc/pgm/flag/Post.java", "diffHunk": "@@ -38,9 +38,13 @@\n   private final boolean permanent; // Flag enters Completed state when at this post\n   private final double pointsPerSecond; // Points awarded while any flag is at this post\n   private final Filter pickupFilter; // Filter players who can pickup a flag at this post\n+  private final @Nullable String postName; // The name of the post to displayed.", "originalCommit": "8c101eeb47c8c834f89a2e60a8de617563af924a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk3NTA5OA==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435975098", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            flag.willRespawnNamed = {0} will respawn to {1} in {2}\n          \n          \n            \n            flag.willRespawn.named = {0} will respawn to {1} in {2}", "author": "Electroid", "createdAt": "2020-06-05T14:52:45Z", "path": "util/src/main/i18n/templates/gamemode.properties", "diffHunk": "@@ -211,6 +211,11 @@ flag.return = {0} has been returned\n # {1} = duration (e.g. \"5 seconds\")\n flag.willRespawn = {0} will respawn in {1}\n \n+# {0} = flag name\n+# {1} = post name\n+# {2} = duration\n+flag.willRespawnNamed = {0} will respawn to {1} in {2}", "originalCommit": "e16c6f3a1874d163755dd732d024764a2131281e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk3NTQ1Mg==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435975452", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (flagPosts.size() != 0) {\n          \n          \n            \n                if (!flagPosts.isEmpty()) {", "author": "Electroid", "createdAt": "2020-06-05T14:53:15Z", "path": "core/src/main/java/tc/oc/pgm/flag/FlagParser.java", "diffHunk": "@@ -214,15 +219,19 @@ public FlagDefinition parseFlag(Element el) throws InvalidXMLException {\n     ProximityMetric netProximityMetric =\n         ProximityMetric.parse(\n             el, \"net\", new ProximityMetric(ProximityMetric.Type.CLOSEST_PLAYER, false));\n-\n     Post defaultPost;\n-    Element elPost = XMLUtils.getUniqueChild(el, \"post\");\n-    if (elPost != null) {\n+    List<Post> flagPosts = new ArrayList<>();\n+    for (Element elPost : el.getChildren(\"post\")) {\n+      flagPosts.add(this.parsePost(elPost));\n+    }\n+\n+    if (flagPosts.size() != 0) {", "originalCommit": "e16c6f3a1874d163755dd732d024764a2131281e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk3NTc1OA==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435975758", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  Post returnPost = definition.getPosts().get(sequentialPostCounter);\n          \n          \n            \n                  sequentialPostCounter++;\n          \n          \n            \n                  Post returnPost = definition.getPosts().get(sequentialPostCounter++);", "author": "Electroid", "createdAt": "2020-06-05T14:53:43Z", "path": "core/src/main/java/tc/oc/pgm/flag/Flag.java", "diffHunk": "@@ -231,8 +232,32 @@ public boolean canDropAt(Location location) {\n     }\n   }\n \n+  private int sequentialPostCounter = 0;\n+  private Post returnPost;\n+\n+  public Post getReturnPost(Post post) {\n+    if (post.isSpecifiedPost()) {\n+      return post;\n+    }\n+    if (definition.isSequential()) {\n+      Post returnPost = definition.getPosts().get(sequentialPostCounter);\n+      sequentialPostCounter++;", "originalCommit": "e16c6f3a1874d163755dd732d024764a2131281e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk3NjEzNw==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r435976137", "bodyText": "Use match.getRandom() instead", "author": "Electroid", "createdAt": "2020-06-05T14:54:16Z", "path": "core/src/main/java/tc/oc/pgm/flag/Flag.java", "diffHunk": "@@ -231,8 +232,32 @@ public boolean canDropAt(Location location) {\n     }\n   }\n \n+  private int sequentialPostCounter = 0;\n+  private Post returnPost;\n+\n+  public Post getReturnPost(Post post) {\n+    if (post.isSpecifiedPost()) {\n+      return post;\n+    }\n+    if (definition.isSequential()) {\n+      Post returnPost = definition.getPosts().get(sequentialPostCounter);\n+      sequentialPostCounter++;\n+      if (sequentialPostCounter == definition.getPosts().size()) {\n+        sequentialPostCounter = 0;\n+      }\n+      return returnPost;\n+    }\n+    Random random = new Random();", "originalCommit": "e16c6f3a1874d163755dd732d024764a2131281e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAyMzMyMg==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r436023322", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    TextComponent.of(net.md_5.bungee.api.ChatColor.AQUA + postName),\n          \n          \n            \n                                    TextComponent.of(postName, TextColor.AQUA),", "author": "Electroid", "createdAt": "2020-06-05T16:12:59Z", "path": "core/src/main/java/tc/oc/pgm/flag/state/Respawning.java", "diffHunk": "@@ -52,15 +56,30 @@ public void enterState() {\n \n     if (!Duration.ZERO.equals(respawnTime)) {\n       // Respawn is delayed\n-      this.flag\n-          .getMatch()\n-          .sendMessage(\n-              new PersonalizedTranslatable(\n-                  \"flag.willRespawn\",\n-                  this.flag.getComponentName(),\n-                  new PersonalizedText(\n-                      PeriodFormats.briefNaturalApproximate(respawnTime),\n-                      net.md_5.bungee.api.ChatColor.AQUA)));\n+\n+      String postName = this.respawnToPost.getPostName();\n+      Component timeComponent =\n+          new PersonalizedText(\n+              PeriodFormats.briefNaturalApproximate(respawnTime),\n+              net.md_5.bungee.api.ChatColor.AQUA);\n+      String timeStr = timeComponent.render().toLegacyText();\n+\n+      if (postName != null) {\n+        this.flag\n+            .getMatch()\n+            .sendMessage(\n+                TranslatableComponent.of(\"flag.willRespawn.named\")\n+                    .args(\n+                        this.flag.getTextName(),\n+                        TextComponent.of(net.md_5.bungee.api.ChatColor.AQUA + postName),", "originalCommit": "367b275c5b698d2c3208a3a0de28e1c0ae7f20a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAyNDU3Nw==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r436024577", "bodyText": "Also, should this be {0} will respawn at {1} in {2} ?", "author": "Electroid", "createdAt": "2020-06-05T16:15:22Z", "path": "util/src/main/i18n/templates/gamemode.properties", "diffHunk": "@@ -211,6 +211,11 @@ flag.return = {0} has been returned\n # {1} = duration (e.g. \"5 seconds\")\n flag.willRespawn = {0} will respawn in {1}\n \n+# {0} = flag name\n+# {1} = post name\n+# {2} = duration\n+flag.willRespawn.named = {0} will respawn to {1} in {2}", "originalCommit": "367b275c5b698d2c3208a3a0de28e1c0ae7f20a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA0Mzk0Nw==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r436043947", "bodyText": "I think so; I will change it", "author": "mrcookieunderscore13", "createdAt": "2020-06-05T16:53:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAyNDU3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE3NTM2MA==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r436175360", "bodyText": "You can just do TranslatableComponent.of(\"key\", arg1, arg2, arg3) instead of TranslatableComponent.of(\"key\").args(arg1, arg2, arg3)", "author": "KingOfSquares", "createdAt": "2020-06-05T21:37:38Z", "path": "core/src/main/java/tc/oc/pgm/flag/state/Respawning.java", "diffHunk": "@@ -52,15 +57,30 @@ public void enterState() {\n \n     if (!Duration.ZERO.equals(respawnTime)) {\n       // Respawn is delayed\n-      this.flag\n-          .getMatch()\n-          .sendMessage(\n-              new PersonalizedTranslatable(\n-                  \"flag.willRespawn\",\n-                  this.flag.getComponentName(),\n-                  new PersonalizedText(\n-                      PeriodFormats.briefNaturalApproximate(respawnTime),\n-                      net.md_5.bungee.api.ChatColor.AQUA)));\n+\n+      String postName = this.respawnToPost.getPostName();\n+      Component timeComponent =\n+          new PersonalizedText(\n+              PeriodFormats.briefNaturalApproximate(respawnTime),\n+              net.md_5.bungee.api.ChatColor.AQUA);\n+      String timeStr = timeComponent.render().toLegacyText();\n+\n+      if (postName != null) {\n+        this.flag\n+            .getMatch()\n+            .sendMessage(\n+                TranslatableComponent.of(\"flag.willRespawn.named\")\n+                    .args(\n+                        this.flag.getTextName(),\n+                        TextComponent.of(postName, TextColor.AQUA),\n+                        TextComponent.of(timeStr)));\n+      } else {\n+        this.flag\n+            .getMatch()\n+            .sendMessage(\n+                TranslatableComponent.of(\"flag.willRespawn\")\n+                    .args(this.flag.getTextName(), TextComponent.of(timeStr)));\n+      }", "originalCommit": "fd88acfd83ef44d9e145f879ffa58ddbdae7cca1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MTc0NQ==", "url": "https://github.com/PGMDev/PGM/pull/524#discussion_r436191745", "bodyText": "Got it. Changed it \ud83d\udc4d", "author": "mrcookieunderscore13", "createdAt": "2020-06-05T22:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE3NTM2MA=="}], "type": "inlineReview"}, {"oid": "f7e52a8f511d4e6ad630e9d6d7770026f99efe86", "url": "https://github.com/PGMDev/PGM/commit/f7e52a8f511d4e6ad630e9d6d7770026f99efe86", "message": "Say the name of the post that the flag is respawning to. Added a name attribute to post.\n\nAdded supprot for multiple posts.\nAdded a sequential attribute to <flag> that determines if the respawning flag randomly chooses a post to respawn to or if it cycles through posts.\nAdded the boolean of a specified post, which is when a net sets a new post for the flag to spawn to. If it is a specified post, it doesn't care if the original flag decleration has multiple flags. That means, if the flag respawns at a post with specifiedPost = true, respawning will remain at this post until a net changes it to a new post.\n\nSigned-off-by: mrcookie <athertonmook@gmail.com>", "committedDate": "2020-06-07T01:10:25Z", "type": "commit"}, {"oid": "f7e52a8f511d4e6ad630e9d6d7770026f99efe86", "url": "https://github.com/PGMDev/PGM/commit/f7e52a8f511d4e6ad630e9d6d7770026f99efe86", "message": "Say the name of the post that the flag is respawning to. Added a name attribute to post.\n\nAdded supprot for multiple posts.\nAdded a sequential attribute to <flag> that determines if the respawning flag randomly chooses a post to respawn to or if it cycles through posts.\nAdded the boolean of a specified post, which is when a net sets a new post for the flag to spawn to. If it is a specified post, it doesn't care if the original flag decleration has multiple flags. That means, if the flag respawns at a post with specifiedPost = true, respawning will remain at this post until a net changes it to a new post.\n\nSigned-off-by: mrcookie <athertonmook@gmail.com>", "committedDate": "2020-06-07T01:10:25Z", "type": "forcePushed"}]}