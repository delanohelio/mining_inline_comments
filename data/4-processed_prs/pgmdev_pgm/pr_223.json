{"pr_number": 223, "pr_title": "Play raindrop sounds", "pr_createdAt": "2020-01-11T22:33:56Z", "pr_url": "https://github.com/PGMDev/PGM/pull/223", "timeline": [{"oid": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8", "url": "https://github.com/PGMDev/PGM/commit/4573a64aaf4268b0609e9cb6b50d83f1793e22b8", "message": "Play raindrop sounds\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>", "committedDate": "2020-01-11T22:31:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0OTA5Ng==", "url": "https://github.com/PGMDev/PGM/pull/223#discussion_r365549096", "bodyText": "Will this play for touching a core? When touching cores you shouldn't get them until completion", "author": "Pablete1234", "createdAt": "2020-01-12T00:15:22Z", "path": "src/main/java/tc/oc/pgm/modules/RaindropSoundsMatchModule.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package tc.oc.pgm.modules;\n+\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.EventPriority;\n+import org.bukkit.event.Listener;\n+import tc.oc.pgm.api.chat.Sound;\n+import tc.oc.pgm.api.match.Match;\n+import tc.oc.pgm.api.match.MatchScope;\n+import tc.oc.pgm.api.match.event.MatchFinishEvent;\n+import tc.oc.pgm.api.party.Competitor;\n+import tc.oc.pgm.api.player.MatchPlayer;\n+import tc.oc.pgm.api.player.MatchPlayerState;\n+import tc.oc.pgm.api.player.ParticipantState;\n+import tc.oc.pgm.api.player.event.MatchPlayerDeathEvent;\n+import tc.oc.pgm.api.setting.SettingKey;\n+import tc.oc.pgm.api.setting.SettingValue;\n+import tc.oc.pgm.api.setting.Settings;\n+import tc.oc.pgm.events.ListenerScope;\n+import tc.oc.pgm.goals.events.GoalTouchEvent;\n+import tc.oc.pgm.match.MatchModule;\n+import tc.oc.pgm.match.MatchModuleFactory;\n+import tc.oc.pgm.module.ModuleLoadException;\n+import tc.oc.pgm.wool.PlayerWoolPlaceEvent;\n+\n+@ListenerScope(MatchScope.RUNNING)\n+public class RaindropSoundsMatchModule extends MatchModule implements Listener {\n+\n+  public static class Factory implements MatchModuleFactory<RaindropSoundsMatchModule> {\n+    @Override\n+    public RaindropSoundsMatchModule createMatchModule(Match match) throws ModuleLoadException {\n+      return new RaindropSoundsMatchModule(match);\n+    }\n+  }\n+\n+  private static final Sound SOUND = new Sound(\"random.levelup\", 1f, 1.5f);\n+\n+  public RaindropSoundsMatchModule(Match match) {\n+    super(match);\n+  }\n+\n+  private void play(MatchPlayer player) {\n+    Settings settings = player.getSettings();\n+    if (settings.getValue(SettingKey.RAINDROP_SOUNDS).equals(SettingValue.RAINDROP_SOUNDS_ON)) {\n+      player.playSound(SOUND);\n+    }\n+  }\n+\n+  private void play(MatchPlayerState playerState) {\n+    playerState.getPlayer().ifPresent(this::play);\n+  }\n+\n+  private void play(Competitor competitor) {\n+    competitor.getPlayers().forEach(this::play);\n+  }\n+\n+  @EventHandler(priority = EventPriority.MONITOR)\n+  public void onMatchPlayerDeath(MatchPlayerDeathEvent event) {\n+    ParticipantState killer = event.getKiller();\n+    if (killer != null) {\n+      play(killer);\n+    }\n+  }\n+\n+  @EventHandler(priority = EventPriority.MONITOR)\n+  public void onMatchFinish(MatchFinishEvent event) {\n+    event.getWinners().forEach(this::play);\n+  }\n+\n+  @EventHandler(priority = EventPriority.MONITOR)\n+  public void onGoalTouch(GoalTouchEvent event) {\n+    ParticipantState player = event.getPlayer();\n+    if (player != null) {\n+      play(player);", "originalCommit": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0OTE1Nw==", "url": "https://github.com/PGMDev/PGM/pull/223#discussion_r365549157", "bodyText": "Yes, this will play just for the first touch.", "author": "TheMolkaPL", "createdAt": "2020-01-12T00:17:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0OTA5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2MjA2NA==", "url": "https://github.com/PGMDev/PGM/pull/223#discussion_r365562064", "bodyText": "just sounds, want to make it expandable", "author": "Electroid", "createdAt": "2020-01-12T07:03:50Z", "path": "src/main/java/tc/oc/pgm/api/setting/SettingKey.java", "diffHunk": "@@ -30,6 +30,10 @@ public void update(MatchPlayer player) {\n       player.resetVisibility();\n     }\n   }, // Changes if observers are visible\n+  RAINDROP_SOUNDS(\n+      Arrays.asList(\"raindrop-sounds\", \"rds\"),\n+      RAINDROP_SOUNDS_ON,\n+      RAINDROP_SOUNDS_OFF), // Changes if raindrop sounds are played", "originalCommit": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2MjA3Mg==", "url": "https://github.com/PGMDev/PGM/pull/223#discussion_r365562072", "bodyText": "sounds", "author": "Electroid", "createdAt": "2020-01-12T07:03:57Z", "path": "src/main/java/tc/oc/pgm/api/setting/SettingValue.java", "diffHunk": "@@ -33,6 +33,9 @@\n \n   OBSERVERS_ON(\"observers\", \"on\"), // Show observers\n   OBSERVERS_OFF(\"observers\", \"off\"), // Hide observers\n+\n+  RAINDROP_SOUNDS_ON(\"raindrop_sounds\", \"on\"), // Always play raindrop sounds", "originalCommit": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU2MjEwMQ==", "url": "https://github.com/PGMDev/PGM/pull/223#discussion_r365562101", "bodyText": "There's no concept of \"raindrops\" anymore, should just be sounds.", "author": "Electroid", "createdAt": "2020-01-12T07:04:48Z", "path": "src/main/java/tc/oc/pgm/modules/RaindropSoundsMatchModule.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package tc.oc.pgm.modules;\n+\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.EventPriority;\n+import org.bukkit.event.Listener;\n+import tc.oc.pgm.api.chat.Sound;\n+import tc.oc.pgm.api.match.Match;\n+import tc.oc.pgm.api.match.MatchScope;\n+import tc.oc.pgm.api.match.event.MatchFinishEvent;\n+import tc.oc.pgm.api.party.Competitor;\n+import tc.oc.pgm.api.player.MatchPlayer;\n+import tc.oc.pgm.api.player.MatchPlayerState;\n+import tc.oc.pgm.api.player.ParticipantState;\n+import tc.oc.pgm.api.player.event.MatchPlayerDeathEvent;\n+import tc.oc.pgm.api.setting.SettingKey;\n+import tc.oc.pgm.api.setting.SettingValue;\n+import tc.oc.pgm.api.setting.Settings;\n+import tc.oc.pgm.events.ListenerScope;\n+import tc.oc.pgm.goals.events.GoalTouchEvent;\n+import tc.oc.pgm.match.MatchModule;\n+import tc.oc.pgm.match.MatchModuleFactory;\n+import tc.oc.pgm.module.ModuleLoadException;\n+import tc.oc.pgm.wool.PlayerWoolPlaceEvent;\n+\n+@ListenerScope(MatchScope.RUNNING)\n+public class RaindropSoundsMatchModule extends MatchModule implements Listener {", "originalCommit": "4573a64aaf4268b0609e9cb6b50d83f1793e22b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8f1c28c86454fd21a7d8a0952b9be43b3f4d13ef", "url": "https://github.com/PGMDev/PGM/commit/8f1c28c86454fd21a7d8a0952b9be43b3f4d13ef", "message": "Make sounds generic\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>", "committedDate": "2020-01-12T18:05:39Z", "type": "commit"}, {"oid": "8f1c28c86454fd21a7d8a0952b9be43b3f4d13ef", "url": "https://github.com/PGMDev/PGM/commit/8f1c28c86454fd21a7d8a0952b9be43b3f4d13ef", "message": "Make sounds generic\n\nSigned-off-by: TheMolkaPL <themolkapl@gmail.com>", "committedDate": "2020-01-12T18:05:39Z", "type": "forcePushed"}, {"oid": "6e223ebc6261a5032bc1c24f8e9f414de5b60b1b", "url": "https://github.com/PGMDev/PGM/commit/6e223ebc6261a5032bc1c24f8e9f414de5b60b1b", "message": "Merge branch 'master' into raindrop-sounds", "committedDate": "2020-01-13T17:11:30Z", "type": "commit"}]}