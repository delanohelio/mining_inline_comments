{"pr_number": 539, "pr_title": "JSSServerSocket to JSSSocket", "pr_createdAt": "2020-05-06T13:07:14Z", "pr_url": "https://github.com/dogtagpki/jss/pull/539", "timeline": [{"oid": "4e59b53df629090a63b7c567c6b0a179f5fd5f93", "url": "https://github.com/dogtagpki/jss/commit/4e59b53df629090a63b7c567c6b0a179f5fd5f93", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-06T13:21:29Z", "type": "forcePushed"}, {"oid": "63369aa717048af1195f4feee0b67456fe3ea70d", "url": "https://github.com/dogtagpki/jss/commit/63369aa717048af1195f4feee0b67456fe3ea70d", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-06T13:23:31Z", "type": "forcePushed"}, {"oid": "2219188308e82d47f98a997dcd441efef2de754e", "url": "https://github.com/dogtagpki/jss/commit/2219188308e82d47f98a997dcd441efef2de754e", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-06T13:31:31Z", "type": "forcePushed"}, {"oid": "b06629971d783065474814e4f0cfbf49329ac2da", "url": "https://github.com/dogtagpki/jss/commit/b06629971d783065474814e4f0cfbf49329ac2da", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-06T13:43:27Z", "type": "forcePushed"}, {"oid": "bc75bb55d1b62f86977b13aff8d23c1db2c80108", "url": "https://github.com/dogtagpki/jss/commit/bc75bb55d1b62f86977b13aff8d23c1db2c80108", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-06T18:27:48Z", "type": "forcePushed"}, {"oid": "656d12c7c4ee4be7d74ed1c00b4e8adbf745c752", "url": "https://github.com/dogtagpki/jss/commit/656d12c7c4ee4be7d74ed1c00b4e8adbf745c752", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-07T17:34:38Z", "type": "forcePushed"}, {"oid": "14d60fc5be53f158288312d54bd7565690adb970", "url": "https://github.com/dogtagpki/jss/commit/14d60fc5be53f158288312d54bd7565690adb970", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-07T20:04:30Z", "type": "forcePushed"}, {"oid": "c0475e5854c13fbc947dd27d2d616236c14d0d43", "url": "https://github.com/dogtagpki/jss/commit/c0475e5854c13fbc947dd27d2d616236c14d0d43", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-07T20:08:52Z", "type": "forcePushed"}, {"oid": "9792693927eb10fc167f20edbfd4c3f25d1161a6", "url": "https://github.com/dogtagpki/jss/commit/9792693927eb10fc167f20edbfd4c3f25d1161a6", "message": "Provide a JSSServerSocket implementation\n\nJSSServerSocket implements the javax.net.ssl.SSLServerSocket interface;\nthis is an interface over java.net.ServerSocket that, upon accept,\ncreates a JSSSocket and initializes it with configuration from the\nServerSocket. This allows child sockets to be used with minimal extra\nconfiguration beyond what the server itself has.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-07T20:12:06Z", "type": "commit"}, {"oid": "191de520d29b795d6d89cc0eca77d3463edf0efe", "url": "https://github.com/dogtagpki/jss/commit/191de520d29b795d6d89cc0eca77d3463edf0efe", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-07T20:12:06Z", "type": "commit"}, {"oid": "191de520d29b795d6d89cc0eca77d3463edf0efe", "url": "https://github.com/dogtagpki/jss/commit/191de520d29b795d6d89cc0eca77d3463edf0efe", "message": "Add JSSServerSocketChannel for JSSServerSocket\n\nJSSServerSocketChannel introduces the semantics of ServerSocketChannel\nto JSSServerSocket. Like JSSSocketChannel and JSSSocket, the server\nsocket always has a channel associated with it, even if the underlying\nsocket doesn't.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-05-07T20:12:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc3NTI3Mw==", "url": "https://github.com/dogtagpki/jss/pull/539#discussion_r421775273", "bodyText": "@edewata What do you think about this? It isn't technically right, but if we return null here, we could lose a client connection. Thoughts?", "author": "cipherboy", "createdAt": "2020-05-07T20:31:11Z", "path": "org/mozilla/jss/ssl/javax/JSSServerSocketChannel.java", "diffHunk": "@@ -0,0 +1,127 @@\n+package org.mozilla.jss.ssl.javax;\n+\n+import java.io.*;\n+import java.net.*;\n+import java.nio.ByteBuffer;\n+import java.nio.channels.*;\n+import java.security.*;\n+import java.util.*;\n+\n+import javax.net.ssl.*;\n+\n+public class JSSServerSocketChannel extends ServerSocketChannel {\n+    private JSSServerSocket sslSocket;\n+    private ServerSocketChannel parent;\n+    private ServerSocket parentSocket;\n+    private JSSEngine engine;\n+\n+    public JSSServerSocketChannel(JSSServerSocket sslSocket, ServerSocketChannel parent, JSSEngine engine) throws IOException {\n+        super(null);\n+\n+        this.sslSocket = sslSocket;\n+        this.parent = parent;\n+        this.parentSocket = parent.socket();\n+        this.engine = engine;\n+\n+        // Copy blocking mode from the parent channel.\n+        configureBlocking(parent.isBlocking());\n+    }\n+\n+    public JSSServerSocketChannel(JSSServerSocket sslSocket, ServerSocket parentSocket, JSSEngine engine) throws IOException {\n+        super(null);\n+\n+        this.sslSocket = sslSocket;\n+        this.parentSocket = parentSocket;\n+        this.engine = engine;\n+\n+        // When there is no parent channel, the channel must be in\n+        // blocking mode.\n+        configureBlocking(false);\n+    }\n+\n+    public JSSSocketChannel accept() throws IOException {\n+        if (parent == null) {\n+            // Have to be in blocking mode. Call up to sslSocket to handle\n+            // the accept. Note that JSSSocket always has a SocketChannel even\n+            // when the underlying socket doesn't so the call to getChannel()\n+            // will be non-null.\n+            JSSSocket acceptedSocket = sslSocket.accept();\n+            return acceptedSocket.getInternalChannel();", "originalCommit": "191de520d29b795d6d89cc0eca77d3463edf0efe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMxNjU2OA==", "url": "https://github.com/dogtagpki/jss/pull/539#discussion_r423316568", "bodyText": "I'm not quite sure about the implication of each option, but if we don't want to deal with parent == null case we probably can throw an exception (either here or maybe in the constructor). That way people using JSS will know that it's not a supported configuration. As long as we provide a clear error message we don't have to worry about losing a client connection.", "author": "edewata", "createdAt": "2020-05-11T21:00:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc3NTI3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM0MDI2NQ==", "url": "https://github.com/dogtagpki/jss/pull/539#discussion_r423340265", "bodyText": "Okie dokie, I'll add the exception as a later PR. Thanks!", "author": "cipherboy", "createdAt": "2020-05-11T21:49:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc3NTI3Mw=="}], "type": "inlineReview"}]}