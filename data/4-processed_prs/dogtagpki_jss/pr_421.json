{"pr_number": 421, "pr_title": "JSSProvider - java.security based loader", "pr_createdAt": "2020-03-05T23:49:31Z", "pr_url": "https://github.com/dogtagpki/jss/pull/421", "timeline": [{"oid": "98b6c72c0b17d8791196a101fd5b2f7ce4a605a1", "url": "https://github.com/dogtagpki/jss/commit/98b6c72c0b17d8791196a101fd5b2f7ce4a605a1", "message": "Convert test suite to JSSProviderLoader\n\nThis converts the test suite from the previous\nCryptoManager.initialize() based approach to the new java.security\napproach.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-06T13:34:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwNzk3Ng==", "url": "https://github.com/dogtagpki/jss/pull/421#discussion_r388907976", "bodyText": "@edewata We can't encapsulate JSSProviderLoader inside JSSProvider like this:\npublic final class JSSProvider extends java.security.Provider {\n    public final class Loader extends JSSProvider { }\n}\nBecause it complains about final:\ncd /home/ascheel/GitHub/c2/jss/build && /etc/alternatives/java_sdk/bin/javac -classpath /usr/share/java/slf4j/api.jar:/usr/share/java/apache-commons-lang.jar:/usr/share/java/jaxb-api.jar -sourcepath /home/ascheel/GitHub/c2/jss -target 1.8 -source 1.8 -g -d /home/ascheel/GitHub/c2/jss/build/classes/jss -h /home/ascheel/GitHub/c2/jss/build/include/jss/_jni @/home/ascheel/GitHub/c2/jss/build/.targets/java.sources && touch /home/ascheel/GitHub/c2/jss/build/.targets/finished_generate_java\n/home/ascheel/GitHub/c2/jss/org/mozilla/jss/JSSProvider.java:346: error: cannot inherit from final JSSProvider\n    public final static class JSSProviderLoader extends JSSProvider {\n                                                        ^\nNote: Some input files use or override a deprecated API.\nNote: Recompile with -Xlint:deprecation for details.\nNote: /home/ascheel/GitHub/c2/jss/org/mozilla/jss/ssl/SSLAlertDescription.java uses unchecked or unsafe operations.\nNote: Recompile with -Xlint:unchecked for details.\nMy preference would be to leave JSSProvider as final somehow. Should I try and add detection logic to JSSProvider to see if a CM has been initialized, and if not, call JSSProviderLoader's init(...) method? That way we can keep the config-parsing logic separate from the JSSProvider itself, and point to org.mozilla.jss.JSSProvider as the actual provider in the java.security file.", "author": "cipherboy", "createdAt": "2020-03-06T13:41:31Z", "path": "org/mozilla/jss/JSSProvider.java", "diffHunk": "@@ -3,7 +3,7 @@\n  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n package org.mozilla.jss;\n \n-public final class JSSProvider extends java.security.Provider {\n+public class JSSProvider extends java.security.Provider {", "originalCommit": "98b6c72c0b17d8791196a101fd5b2f7ce4a605a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1b0b34ba237eee9211157a01a619801aafa5d9cb", "url": "https://github.com/dogtagpki/jss/commit/1b0b34ba237eee9211157a01a619801aafa5d9cb", "message": "Convert test suite to JSSProviderLoader\n\nThis converts the test suite from the previous\nCryptoManager.initialize() based approach to the new java.security\napproach.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-09T15:51:12Z", "type": "forcePushed"}, {"oid": "d7ea9ffa80c0aa894f4c264d044e26051fd3e926", "url": "https://github.com/dogtagpki/jss/commit/d7ea9ffa80c0aa894f4c264d044e26051fd3e926", "message": "Convert test suite to JSSProviderLoader\n\nThis converts the test suite from the previous\nCryptoManager.initialize() based approach to the new java.security\napproach.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-09T17:15:43Z", "type": "forcePushed"}, {"oid": "eb859a3f267ace860c05dbbb65c213f86b990626", "url": "https://github.com/dogtagpki/jss/commit/eb859a3f267ace860c05dbbb65c213f86b990626", "message": "Convert test suite to JSSProviderLoader\n\nThis converts the test suite from the previous\nCryptoManager.initialize() based approach to the new java.security\napproach.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-09T17:20:24Z", "type": "forcePushed"}, {"oid": "29009e46f71ecd7af48889979e5f3e8d2a719270", "url": "https://github.com/dogtagpki/jss/commit/29009e46f71ecd7af48889979e5f3e8d2a719270", "message": "Convert test suite to JSSProviderLoader\n\nThis converts the test suite from the previous\nCryptoManager.initialize() based approach to the new java.security\napproach. This should work on most platforms. If this fails on your\nspecified platform, it is likely due to the providers contained in\ntools/java.security.in; make sure to update them to match your system's\nfile.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-09T17:25:02Z", "type": "forcePushed"}, {"oid": "7dc686cf68bafdc16e85bdc88d832feb72cfed08", "url": "https://github.com/dogtagpki/jss/commit/7dc686cf68bafdc16e85bdc88d832feb72cfed08", "message": "Document new JSSProviderLoader class\n\nThis describes in the corresponding javadocs what the mapping between\nthe JSS configuration file format and the InitializationValues members\nare.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-09T18:18:55Z", "type": "forcePushed"}, {"oid": "0cd67ecc6b328b014c6e11a2a53e2785871aea0c", "url": "https://github.com/dogtagpki/jss/commit/0cd67ecc6b328b014c6e11a2a53e2785871aea0c", "message": "Document new JSSProviderLoader class\n\nThis describes in the corresponding javadocs what the mapping between\nthe JSS configuration file format and the InitializationValues members\nare.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-11T17:49:12Z", "type": "forcePushed"}, {"oid": "68e52bee00db61452dfdd9c1462d225ea006a9c1", "url": "https://github.com/dogtagpki/jss/commit/68e52bee00db61452dfdd9c1462d225ea006a9c1", "message": "Convert test suite to JSSProviderLoader\n\nThis converts the test suite from the previous\nCryptoManager.initialize() based approach to the new java.security\napproach. This should work on most platforms. If this fails on your\nspecified platform, it is likely due to the providers contained in\ntools/java.security.in; make sure to update them to match your system's\nfile.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-11T20:31:23Z", "type": "forcePushed"}, {"oid": "2026be7c7d79a46fd5301c4cb8911263ee87bd94", "url": "https://github.com/dogtagpki/jss/commit/2026be7c7d79a46fd5301c4cb8911263ee87bd94", "message": "Add JSSProviderLoader implementation\n\nSimilar to the way the SunPKCS11 provider works, expose an alternative\nJSSProvider, JSSProviderLoader, which loads configuration from a path or\nInputStream, and configures our CryptoManager correctly. This allows us\nto inject the provider via the java.security interface, rather than via\nthe existing CryptoManager.initialize(...) method.\n\nCurrently this only supports using a single, fixed password. In the\nfuture, JSSProvider could be converted into an AuthProvider (which\nsupports logging-in to arbitrary tokens), or a more comprehensive\nFile-based PasswordCallback implementation added.\n\nAdditionally, this provider (unlike the JSSProvider it derives from)\nsupports the JDK9+ style of static initialization, accepting a path to a\nconfiguration file.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-12T16:09:08Z", "type": "commit"}, {"oid": "5a2bace2726af74d863dba43e583361399fa60cb", "url": "https://github.com/dogtagpki/jss/commit/5a2bace2726af74d863dba43e583361399fa60cb", "message": "Provision files for JSSProviderLoader\n\nThis allows the test suite to use the JSSProviderLoader system,\ninjecting the JSS Provider via a java.security override file. This\nincludes:\n\n - Updating the test framework\n - Introducing a java.security and jss.cfg configuration file\n - Updating run_test.sh to add the new parameter\n - Introducing the java.security.Provider service file in the JAR\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-12T16:09:08Z", "type": "commit"}, {"oid": "d4e3dee079ec630a59f250d5f124a433598f3d60", "url": "https://github.com/dogtagpki/jss/commit/d4e3dee079ec630a59f250d5f124a433598f3d60", "message": "Convert test suite to JSSProviderLoader\n\nThis converts the test suite from the previous\nCryptoManager.initialize() based approach to the new java.security\napproach. This should work on most platforms. If this fails on your\nspecified platform, it is likely due to the providers contained in\ntools/java.security.in; make sure to update them to match your system's\nfile.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-12T16:09:09Z", "type": "commit"}, {"oid": "d4e3dee079ec630a59f250d5f124a433598f3d60", "url": "https://github.com/dogtagpki/jss/commit/d4e3dee079ec630a59f250d5f124a433598f3d60", "message": "Convert test suite to JSSProviderLoader\n\nThis converts the test suite from the previous\nCryptoManager.initialize() based approach to the new java.security\napproach. This should work on most platforms. If this fails on your\nspecified platform, it is likely due to the providers contained in\ntools/java.security.in; make sure to update them to match your system's\nfile.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-03-12T16:09:09Z", "type": "forcePushed"}]}