{"pr_number": 2128, "pr_title": "Delay starting metric aggregation, reduce DDSketch relative accuracy, pick up changes from sketches-java 0.5.0", "pr_createdAt": "2020-11-27T14:43:19Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/2128", "timeline": [{"oid": "2238d836fafe426ce8e3b99ae19354323cb302ba", "url": "https://github.com/DataDog/dd-trace-java/commit/2238d836fafe426ce8e3b99ae19354323cb302ba", "message": "change DDSketch index mapping", "committedDate": "2020-11-27T14:46:11Z", "type": "forcePushed"}, {"oid": "96afd93c33e3ccc3ef6b40ebf699c7d1226d70ca", "url": "https://github.com/DataDog/dd-trace-java/commit/96afd93c33e3ccc3ef6b40ebf699c7d1226d70ca", "message": "change DDSketch index mapping", "committedDate": "2020-11-27T14:47:14Z", "type": "forcePushed"}, {"oid": "190cad866fa2ec38587058237f02619f2b5d099e", "url": "https://github.com/DataDog/dd-trace-java/commit/190cad866fa2ec38587058237f02619f2b5d099e", "message": "change DDSketch index mapping", "committedDate": "2020-11-27T14:49:36Z", "type": "forcePushed"}, {"oid": "aac467411531aff8b30111751ae6b1f2bfb77c0c", "url": "https://github.com/DataDog/dd-trace-java/commit/aac467411531aff8b30111751ae6b1f2bfb77c0c", "message": "change DDSketch index mapping", "committedDate": "2020-11-27T14:52:08Z", "type": "forcePushed"}, {"oid": "7d21de03ad0b2964fd4cae82379f32ad40073d46", "url": "https://github.com/DataDog/dd-trace-java/commit/7d21de03ad0b2964fd4cae82379f32ad40073d46", "message": "change DDSketch index mapping", "committedDate": "2020-11-27T15:18:57Z", "type": "forcePushed"}, {"oid": "08e394b19ab0a0f50016c54d65698d5077de69ac", "url": "https://github.com/DataDog/dd-trace-java/commit/08e394b19ab0a0f50016c54d65698d5077de69ac", "message": "change DDSketch index mapping", "committedDate": "2020-11-27T15:29:10Z", "type": "forcePushed"}, {"oid": "a247826041762f227e44c7c5f9a31eecdbba13bf", "url": "https://github.com/DataDog/dd-trace-java/commit/a247826041762f227e44c7c5f9a31eecdbba13bf", "message": "mitigate risk of tracers synchronising metrics delivery", "committedDate": "2020-11-30T10:37:04Z", "type": "commit"}, {"oid": "640bba6ba511aecfbb1bd2b50da22a8c2fada093", "url": "https://github.com/DataDog/dd-trace-java/commit/640bba6ba511aecfbb1bd2b50da22a8c2fada093", "message": "upgrade and change DDSketch storage", "committedDate": "2020-11-30T10:46:59Z", "type": "commit"}, {"oid": "2bc8215605e26d168a6d36c32a94594538c29d1c", "url": "https://github.com/DataDog/dd-trace-java/commit/2bc8215605e26d168a6d36c32a94594538c29d1c", "message": "clear sketches instead of reinitialising", "committedDate": "2020-11-30T10:52:44Z", "type": "commit"}, {"oid": "2bc8215605e26d168a6d36c32a94594538c29d1c", "url": "https://github.com/DataDog/dd-trace-java/commit/2bc8215605e26d168a6d36c32a94594538c29d1c", "message": "clear sketches instead of reinitialising", "committedDate": "2020-11-30T10:52:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUyNDEwNQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2128#discussion_r532524105", "bodyText": "I can't stand the Google formatting", "author": "richardstartin", "createdAt": "2020-11-30T11:21:42Z", "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "diffHunk": "@@ -244,7 +246,28 @@ private CoreTracer(\n     this.writer.start();\n \n     metricsAggregator = createMetricsAggregator(config);\n-    metricsAggregator.start();\n+    // schedule to start after geometrically distributed number of seconds expressed in\n+    // milliseconds, with p = 0.25, meaning the probability that the aggregator will not\n+    // have started by the nth second is 0.25(0.75)^n-1 (or a 1% chance of not having\n+    // started within 10 seconds, where a cap is applied) This avoids a fleet of traced\n+    // applications starting at the same time and sending metrics in sync\n+    long delayMillis =", "originalCommit": "2bc8215605e26d168a6d36c32a94594538c29d1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzMTEyMg==", "url": "https://github.com/DataDog/dd-trace-java/pull/2128#discussion_r532531122", "bodyText": "\ud83d\udc4d for the comment in the code and \ud83d\udcaf for disliking the auto formatting...", "author": "bantonsson", "createdAt": "2020-11-30T11:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUyNDEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcxMjQxOQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2128#discussion_r532712419", "bodyText": "This may not be your primary issue, but if you wrap these kind of comments in /** ... */ style comments, then google format does a bit nicer job with it.", "author": "tylerbenson", "createdAt": "2020-11-30T16:08:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUyNDEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjczNTkyMA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2128#discussion_r532735920", "bodyText": "the problem is the formatting of the code, not the comment", "author": "richardstartin", "createdAt": "2020-11-30T16:39:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUyNDEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc1NzcyNA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2128#discussion_r532757724", "bodyText": "Ah, ok... I see below.  Yes that is pretty ridiculous.", "author": "tylerbenson", "createdAt": "2020-11-30T17:08:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUyNDEwNQ=="}], "type": "inlineReview"}]}