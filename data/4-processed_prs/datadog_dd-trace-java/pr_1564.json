{"pr_number": 1564, "pr_title": "Circleci config cleanup", "pr_createdAt": "2020-06-09T15:22:09Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1564", "timeline": [{"oid": "2c4aa213fcc1ff0e2130eb892b1679ebb6c0ae60", "url": "https://github.com/DataDog/dd-trace-java/commit/2c4aa213fcc1ff0e2130eb892b1679ebb6c0ae60", "message": "Refactor circleci config", "committedDate": "2020-06-09T14:28:14Z", "type": "commit"}, {"oid": "8a0b0db827a4eec890fb151afba05a28fa2fceda", "url": "https://github.com/DataDog/dd-trace-java/commit/8a0b0db827a4eec890fb151afba05a28fa2fceda", "message": "split gradle lines up", "committedDate": "2020-06-09T14:49:20Z", "type": "commit"}, {"oid": "77a6275a11eb2df287abf04d0336395587d7c070", "url": "https://github.com/DataDog/dd-trace-java/commit/77a6275a11eb2df287abf04d0336395587d7c070", "message": "extract gradle flags", "committedDate": "2020-06-09T16:26:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NDEwMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1564#discussion_r437594101", "bodyText": "Any reason you made these UPPERCASE?", "author": "tylerbenson", "createdAt": "2020-06-09T17:20:10Z", "path": ".circleci/config.yml", "diffHunk": "@@ -229,99 +165,63 @@ jobs:\n \n       - run:\n           name: Gather muzzle tasks\n-          command: SKIP_BUILDSCAN=\"true\" ./gradlew writeMuzzleTasksToFile --stacktrace --no-daemon\n+          command: >-\n+            SKIP_BUILDSCAN=\"true\"\n+            ./gradlew writeMuzzleTasksToFile\n+            << pipeline.parameters.gradle_flags >>\n+            --max-workers=8\n+\n       - run:\n           name: Verify Muzzle\n           command: >-\n             SKIP_BUILDSCAN=\"true\"\n             GRADLE_OPTS=\"-Dorg.gradle.jvmargs='-Xmx4G -Xms64M' -Ddatadog.forkedMaxHeapSize=4G -Ddatadog.forkedMinHeapSize=64M\"\n-            ./gradlew `circleci tests split workspace/build/muzzleTasks | xargs` --parallel --stacktrace --no-daemon --max-workers=16\n+            ./gradlew `circleci tests split workspace/build/muzzleTasks | xargs`\n+            << pipeline.parameters.gradle_flags >>\n+            --max-workers=16\n \n workflows:\n-  version: 2\n   build_test_deploy:\n     jobs:\n       - build:\n           filters:\n             tags:\n               only: /.*/\n \n-      - test_7:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_8:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_latest8:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_ibm8:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_zulu8:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_11:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_zulu11:\n-          requires:\n-            - build\n-          filters:\n-            tags:\n-              only: /.*/\n-      - test_12:\n+      - default_test_job:\n           requires:\n             - build\n+          prefixTestTask: true\n+          name: test_<< matrix.testTask >>\n+          matrix:\n+            parameters:\n+              testTask: [\"7\", \"IBM8\", \"ZULU8\", \"11\", \"ZULU11\", \"12\", \"13\", \"ZULU13\", \"14\", \"ZULU14\" ]", "originalCommit": "77a6275a11eb2df287abf04d0336395587d7c070", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzNTY1MA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1564#discussion_r437635650", "bodyText": "Yes, they have to match the task names ( testJavaIBM8 , testJavaZULU11, etc).  The task names come the JAVA_*_HOME environment variables in the docker image.", "author": "randomanderson", "createdAt": "2020-06-09T18:31:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NDEwMQ=="}], "type": "inlineReview"}]}