{"pr_number": 2237, "pr_title": "Small test changes to make tests more robust", "pr_createdAt": "2020-12-23T09:53:33Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/2237", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg3NDU0NQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2237#discussion_r547874545", "bodyText": "If the task starts executing and is executing when we call taskCount, it will return 0.", "author": "bantonsson", "createdAt": "2020-12-23T09:57:03Z", "path": "internal-api/src/test/groovy/datadog/trace/util/AgentTaskSchedulerTest.groovy", "diffHunk": "@@ -39,12 +39,11 @@ class AgentTaskSchedulerTest extends DDSpecification {\n     !scheduler.isShutdown()\n \n     when:\n-    scheduler.scheduleAtFixedRate(task, latch, 10, 10, MILLISECONDS)\n+    scheduler.scheduleAtFixedRate(task, latch, 50, 10, MILLISECONDS)\n     scheduler.taskCount() == 1", "originalCommit": "37dbb4ef69e72a6095230103ea6e451a4a45d0b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg3NDgyMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2237#discussion_r547874821", "bodyText": "If the task is executing taskCount will return 0. I think it's enough that the task counts down the latch more than once.", "author": "bantonsson", "createdAt": "2020-12-23T09:57:37Z", "path": "internal-api/src/test/groovy/datadog/trace/util/AgentTaskSchedulerTest.groovy", "diffHunk": "@@ -39,12 +39,11 @@ class AgentTaskSchedulerTest extends DDSpecification {\n     !scheduler.isShutdown()\n \n     when:\n-    scheduler.scheduleAtFixedRate(task, latch, 10, 10, MILLISECONDS)\n+    scheduler.scheduleAtFixedRate(task, latch, 50, 10, MILLISECONDS)\n     scheduler.taskCount() == 1\n \n     then:\n     latch.await(500, MILLISECONDS)\n-    scheduler.taskCount() == 1", "originalCommit": "37dbb4ef69e72a6095230103ea6e451a4a45d0b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "873ca538517e47a9e6a0f4d1ba68378041a7d6da", "url": "https://github.com/DataDog/dd-trace-java/commit/873ca538517e47a9e6a0f4d1ba68378041a7d6da", "message": "Avoid small test races when reading scheduler queue size", "committedDate": "2020-12-23T13:01:26Z", "type": "forcePushed"}, {"oid": "38db60e031e232dc22d0e6ff1811f8e0b1e5ca36", "url": "https://github.com/DataDog/dd-trace-java/commit/38db60e031e232dc22d0e6ff1811f8e0b1e5ca36", "message": "Avoid small test races when reading scheduler queue size", "committedDate": "2020-12-23T14:44:52Z", "type": "forcePushed"}, {"oid": "337fef0499c60b3a1c3bdffabc5c0897b6229da1", "url": "https://github.com/DataDog/dd-trace-java/commit/337fef0499c60b3a1c3bdffabc5c0897b6229da1", "message": "Try to wait until the TestHttpServer has started properly", "committedDate": "2021-01-04T07:57:57Z", "type": "commit"}, {"oid": "69f86dbef87e0fc21b876b516073e08832d17e2c", "url": "https://github.com/DataDog/dd-trace-java/commit/69f86dbef87e0fc21b876b516073e08832d17e2c", "message": "Avoid small test races when reading scheduler queue size", "committedDate": "2021-01-04T07:58:18Z", "type": "commit"}, {"oid": "69f86dbef87e0fc21b876b516073e08832d17e2c", "url": "https://github.com/DataDog/dd-trace-java/commit/69f86dbef87e0fc21b876b516073e08832d17e2c", "message": "Avoid small test races when reading scheduler queue size", "committedDate": "2021-01-04T07:58:18Z", "type": "forcePushed"}]}