{"pr_number": 1248, "pr_title": "Avoid calling superclass matcher where possible", "pr_createdAt": "2020-02-21T19:02:31Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1248", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1NTQ2Mg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1248#discussion_r382755462", "bodyText": "I think some of these are safe, but many aren't.  For example, HystrixCommand is intended to be extended, so most usages of this won't match the package prefix.  I'm guessing many of these others have a similar issue.", "author": "tylerbenson", "createdAt": "2020-02-21T19:08:41Z", "path": "dd-java-agent/instrumentation/hystrix-1.4/src/main/java/datadog/trace/instrumentation/hystrix/HystrixInstrumentation.java", "diffHunk": "@@ -29,9 +30,11 @@ public HystrixInstrumentation() {\n \n   @Override\n   public ElementMatcher<TypeDescription> typeMatcher() {\n-    return safeExtendsClass(\n-        named(\"com.netflix.hystrix.HystrixCommand\")\n-            .or(named(\"com.netflix.hystrix.HystrixObservableCommand\")));\n+    return nameStartsWith(\"com.netflix.hystrix.\")\n+        .and(\n+            safeExtendsClass(\n+                named(\"com.netflix.hystrix.HystrixCommand\")\n+                    .or(named(\"com.netflix.hystrix.HystrixObservableCommand\"))));", "originalCommit": "dea85909044f0f5d3cf0f67d2d6852fc9e493259", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1Njc2NQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1248#discussion_r382756765", "bodyText": "I don't think this one can be done. I've seen custom Criteria classes before", "author": "devinsba", "createdAt": "2020-02-21T19:11:28Z", "path": "dd-java-agent/instrumentation/hibernate/core-3.3/src/main/java/datadog/trace/instrumentation/hibernate/core/v3_3/CriteriaInstrumentation.java", "diffHunk": "@@ -31,7 +32,9 @@\n \n   @Override\n   public ElementMatcher<TypeDescription> typeMatcher() {\n-    return not(isInterface()).and(safeHasInterface(named(\"org.hibernate.Criteria\")));\n+    return nameStartsWith(\"org.hibernate.\")", "originalCommit": "dea85909044f0f5d3cf0f67d2d6852fc9e493259", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2MzA5NA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1248#discussion_r382763094", "bodyText": "reverged whole hibernate and a few others", "author": "mar-kolya", "createdAt": "2020-02-21T19:25:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1Njc2NQ=="}], "type": "inlineReview"}, {"oid": "c3a41b65af66c4d75be39707392884b464b6e60d", "url": "https://github.com/DataDog/dd-trace-java/commit/c3a41b65af66c4d75be39707392884b464b6e60d", "message": "Avoid calling superclass matcher where possible\n\nSaves about 300ms of startup time on test app", "committedDate": "2020-02-21T19:18:41Z", "type": "forcePushed"}, {"oid": "2fd79fdfb1d5eba8864a5fd057b555cc13bb778f", "url": "https://github.com/DataDog/dd-trace-java/commit/2fd79fdfb1d5eba8864a5fd057b555cc13bb778f", "message": "Avoid calling superclass matcher where possible\n\nSaves about 300ms of startup time on test app", "committedDate": "2020-02-21T19:22:11Z", "type": "forcePushed"}, {"oid": "ef575a79369d7cfdf2a86104a35d1c95e7b0c331", "url": "https://github.com/DataDog/dd-trace-java/commit/ef575a79369d7cfdf2a86104a35d1c95e7b0c331", "message": "Avoid calling superclass matcher where possible\n\nSaves about 300ms of startup time on test app", "committedDate": "2020-02-21T19:25:02Z", "type": "forcePushed"}, {"oid": "91a56b3dcde05e2c72fe4aa22bf3365351de2db1", "url": "https://github.com/DataDog/dd-trace-java/commit/91a56b3dcde05e2c72fe4aa22bf3365351de2db1", "message": "Avoid calling superclass matcher where possible\n\nSaves about 100ms of startup time on test app", "committedDate": "2020-02-21T19:49:26Z", "type": "forcePushed"}, {"oid": "b6d374e3a0aaaffdcbdec4933c06888a198acc11", "url": "https://github.com/DataDog/dd-trace-java/commit/b6d374e3a0aaaffdcbdec4933c06888a198acc11", "message": "Avoid calling superclass matcher where possible\n\nSaves about 100ms of startup time on test app", "committedDate": "2020-02-21T20:08:39Z", "type": "commit"}, {"oid": "b6d374e3a0aaaffdcbdec4933c06888a198acc11", "url": "https://github.com/DataDog/dd-trace-java/commit/b6d374e3a0aaaffdcbdec4933c06888a198acc11", "message": "Avoid calling superclass matcher where possible\n\nSaves about 100ms of startup time on test app", "committedDate": "2020-02-21T20:08:39Z", "type": "forcePushed"}]}