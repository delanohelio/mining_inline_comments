{"pr_number": 1688, "pr_title": "Add DD tags to log instrumentations", "pr_createdAt": "2020-07-16T01:28:36Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1688", "timeline": [{"oid": "0b305ca28626208efb96915201e872d30948ca66", "url": "https://github.com/DataDog/dd-trace-java/commit/0b305ca28626208efb96915201e872d30948ca66", "message": "Add DD tags to log instrumentations", "committedDate": "2020-07-16T02:08:20Z", "type": "forcePushed"}, {"oid": "efa9a386cadc7bb46da1e57791bdfd4ec24bece9", "url": "https://github.com/DataDog/dd-trace-java/commit/efa9a386cadc7bb46da1e57791bdfd4ec24bece9", "message": "Add DD tags to log instrumentations", "committedDate": "2020-07-16T02:51:51Z", "type": "forcePushed"}, {"oid": "2a255ea585499a652c86e5cc8ed8996148c27573", "url": "https://github.com/DataDog/dd-trace-java/commit/2a255ea585499a652c86e5cc8ed8996148c27573", "message": "Add DD tags to log instrumentations", "committedDate": "2020-07-16T03:53:06Z", "type": "forcePushed"}, {"oid": "057d2916c0b20f2a6e248e104bc485e3361c5e71", "url": "https://github.com/DataDog/dd-trace-java/commit/057d2916c0b20f2a6e248e104bc485e3361c5e71", "message": "Add DD tags to log instrumentations", "committedDate": "2020-07-16T05:07:07Z", "type": "forcePushed"}, {"oid": "2a2d21ae374866aa10058cc6061372a2ecbd918f", "url": "https://github.com/DataDog/dd-trace-java/commit/2a2d21ae374866aa10058cc6061372a2ecbd918f", "message": "Add DD tags to log instrumentations", "committedDate": "2020-07-16T05:17:08Z", "type": "forcePushed"}, {"oid": "7ff119b6cd87ae37e01072a9b3951fd126ecb158", "url": "https://github.com/DataDog/dd-trace-java/commit/7ff119b6cd87ae37e01072a9b3951fd126ecb158", "message": "Add DD tags to log instrumentations", "committedDate": "2020-07-16T05:45:29Z", "type": "forcePushed"}, {"oid": "f99c506149a301c7946457ceb9660bb44e256920", "url": "https://github.com/DataDog/dd-trace-java/commit/f99c506149a301c7946457ceb9660bb44e256920", "message": "Add DD tags to log instrumentations", "committedDate": "2020-07-17T00:00:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE4ODQ5Nw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1688#discussion_r456188497", "bodyText": "This is just more debug logging not really related to this change", "author": "lpriima", "createdAt": "2020-07-17T02:48:24Z", "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/HelperInjector.java", "diffHunk": "@@ -204,6 +204,9 @@ private static void deleteTempDir(final File file) {\n     final boolean deleted = file.delete();\n     if (!deleted) {\n       file.deleteOnExit();\n+      log.debug(\"file '{}' added to shutdown delete hook\", file);\n+    } else {\n+      log.debug(\"file '{}' deleted\", file);", "originalCommit": "f99c506149a301c7946457ceb9660bb44e256920", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7aa02256a8d9f60ce58f467ef2730a072eed27b1", "url": "https://github.com/DataDog/dd-trace-java/commit/7aa02256a8d9f60ce58f467ef2730a072eed27b1", "message": "Add DD tags to log instrumentations", "committedDate": "2020-07-17T04:27:31Z", "type": "commit"}, {"oid": "7aa02256a8d9f60ce58f467ef2730a072eed27b1", "url": "https://github.com/DataDog/dd-trace-java/commit/7aa02256a8d9f60ce58f467ef2730a072eed27b1", "message": "Add DD tags to log instrumentations", "committedDate": "2020-07-17T04:27:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0NjkzNA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1688#discussion_r457546934", "bodyText": "I don't understand the point of this test.  Why would you want to assert the full name of these classes?", "author": "tylerbenson", "createdAt": "2020-07-20T16:40:20Z", "path": "dd-java-agent/agent-tooling/src/test/groovy/datadog/trace/agent/test/ClassLoaderMatcherTest.groovy", "diffHunk": "@@ -38,6 +40,12 @@ class ClassLoaderMatcherTest extends DDSpecification {\n     DatadogClassLoader.name == \"datadog.trace.bootstrap.DatadogClassLoader\"\n   }\n \n+  def \"helper class names are hardcoded in Log Instrumentations\"() {\n+    expect:\n+    LogContextScopeListener.name == \"datadog.trace.agent.tooling.log.LogContextScopeListener\"\n+    ThreadLocalWithDDTagsInitValue.name == \"datadog.trace.agent.tooling.log.ThreadLocalWithDDTagsInitValue\"\n+  }", "originalCommit": "7aa02256a8d9f60ce58f467ef2730a072eed27b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMxNzMyOA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1688#discussion_r458317328", "bodyText": "I would assume the purpose is to guard against automated refactoring changing the classes but not the class names hard coded in various places. i.e this test would fail if either of these classes were renamed.", "author": "richardstartin", "createdAt": "2020-07-21T18:52:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0NjkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM2NzE3Mg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1688#discussion_r458367172", "bodyText": "I believe most refactoring tools would actually detect this usage and also update the string since it's a fully qualified class name.", "author": "tylerbenson", "createdAt": "2020-07-21T20:26:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0NjkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyNDc4OQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1688#discussion_r458424789", "bodyText": "Yes, this is for possible class renaming and it's temporary solution.\nBetter solution should be running tests with actual classpath restricted by this method:\nhttps://github.com/DataDog/dd-trace-java/pull/1688/files#diff-ddc855d905a56896d1c42dfd404e8541R50-R53", "author": "lpriima", "createdAt": "2020-07-21T22:26:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0NjkzNA=="}], "type": "inlineReview"}]}