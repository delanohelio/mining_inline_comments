{"pr_number": 1729, "pr_title": "cache hystrix resource name", "pr_createdAt": "2020-07-31T10:38:41Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1729", "timeline": [{"oid": "ece1c1e0028f847896b2469ab340365ac77c0899", "url": "https://github.com/DataDog/dd-trace-java/commit/ece1c1e0028f847896b2469ab340365ac77c0899", "message": "reduce redundancy in hystrix tags, cache resource name", "committedDate": "2020-07-31T11:21:08Z", "type": "forcePushed"}, {"oid": "7c3c3db53dfbb36599e7ae673c53c590ce2644df", "url": "https://github.com/DataDog/dd-trace-java/commit/7c3c3db53dfbb36599e7ae673c53c590ce2644df", "message": "revapi", "committedDate": "2020-07-31T11:32:19Z", "type": "forcePushed"}, {"oid": "3d318fe9759c32acb1ec5f4a804d7adef770c4db", "url": "https://github.com/DataDog/dd-trace-java/commit/3d318fe9759c32acb1ec5f4a804d7adef770c4db", "message": "reduce redundancy in hystrix tags, cache resource name", "committedDate": "2020-07-31T13:25:23Z", "type": "commit"}, {"oid": "3d318fe9759c32acb1ec5f4a804d7adef770c4db", "url": "https://github.com/DataDog/dd-trace-java/commit/3d318fe9759c32acb1ec5f4a804d7adef770c4db", "message": "reduce redundancy in hystrix tags, cache resource name", "committedDate": "2020-07-31T13:25:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0Mjg3MA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1729#discussion_r463642870", "bodyText": "This seems reasonable for a size, is there a reason for this specific number?", "author": "devinsba", "createdAt": "2020-07-31T14:25:51Z", "path": "dd-java-agent/instrumentation/hystrix-1.4/src/main/java/datadog/trace/instrumentation/hystrix/HystrixDecorator.java", "diffHunk": "@@ -1,13 +1,56 @@\n package datadog.trace.instrumentation.hystrix;\n \n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.HYSTRIX_CIRCUIT_OPEN;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.HYSTRIX_COMMAND;\n+import static datadog.trace.bootstrap.instrumentation.api.InstrumentationTags.HYSTRIX_GROUP;\n+\n import com.netflix.hystrix.HystrixInvokableInfo;\n import datadog.trace.api.DDTags;\n import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.api.FixedSizeCache;\n import datadog.trace.bootstrap.instrumentation.decorator.BaseDecorator;\n+import java.util.Objects;\n \n public class HystrixDecorator extends BaseDecorator {\n   public static HystrixDecorator DECORATE = new HystrixDecorator();\n \n+  private static final FixedSizeCache<ResourceNameCacheKey, String> RESOURCE_NAME_CACHE =\n+      new FixedSizeCache<>(64);", "originalCommit": "3d318fe9759c32acb1ec5f4a804d7adef770c4db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0ODI2Mg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1729#discussion_r463648262", "bodyText": "It's a guess, we can't really know what the right size is, but I guess most users only have a single (default) group and there are probably around 10-20 commands in a typical application, and there is probably a 1:1 correspondence between command and method name. If it's too small, it will churn, but we can't use unbounded memory. It could be configurable, but I doubt anyone cares enough to configure it. The main thing I expect to get from this, once the dictionary encoding is merged, is that the resource name almost always has its hash code calculated by the time it's encoded.", "author": "richardstartin", "createdAt": "2020-07-31T14:35:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0Mjg3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0OTkxOA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1729#discussion_r463649918", "bodyText": "Cool works for me", "author": "devinsba", "createdAt": "2020-07-31T14:38:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0Mjg3MA=="}], "type": "inlineReview"}]}