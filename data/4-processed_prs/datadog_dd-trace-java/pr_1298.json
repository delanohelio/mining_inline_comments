{"pr_number": 1298, "pr_title": "ClassLoader matcher cleanup", "pr_createdAt": "2020-03-05T19:34:05Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1298", "timeline": [{"oid": "372ba221d20bf92ebc6e1238620f678430604d7c", "url": "https://github.com/DataDog/dd-trace-java/commit/372ba221d20bf92ebc6e1238620f678430604d7c", "message": "Invert the classloader matcher to remove the double negative.", "committedDate": "2020-03-05T18:14:33Z", "type": "commit"}, {"oid": "74ea734f81d498c9fc794b87c0adfc04a9d34113", "url": "https://github.com/DataDog/dd-trace-java/commit/74ea734f81d498c9fc794b87c0adfc04a9d34113", "message": "Add additional classLoaderMatchers.", "committedDate": "2020-03-05T18:45:59Z", "type": "commit"}, {"oid": "cb782fdd0ea43baf060cbce3368312f17f38164c", "url": "https://github.com/DataDog/dd-trace-java/commit/cb782fdd0ea43baf060cbce3368312f17f38164c", "message": "Fix muzzle for trace-annotation.", "committedDate": "2020-03-05T20:00:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYxOTkxNg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1298#discussion_r388619916", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // Avoid matching 3.x\n          \n          \n            \n                return not(hasClassesNamed(\"redis.clients.jedis.commands.ProtocolCommand\"));\n          \n          \n            \n                // Avoid matching 3.x\n          \n          \n            \n                return not(hasClassesNamed(\"redis.clients.jedis.commands.ProtocolCommand\"))\n          \n          \n            \n                    // Optimization for expensive typeMatcher.\n          \n          \n            \n                    .and(hasClassesNamed(\"rediis.clients.jedis.Protocol\"));\n          \n      \n    \n    \n  \n\nThe non-double-negative part is missing", "author": "randomanderson", "createdAt": "2020-03-05T23:10:46Z", "path": "dd-java-agent/instrumentation/jedis-1.4/src/main/java/datadog/trace/instrumentation/jedis/JedisInstrumentation.java", "diffHunk": "@@ -34,9 +34,8 @@ public JedisInstrumentation() {\n \n   @Override\n   public ElementMatcher<ClassLoader> classLoaderMatcher() {\n-    return classLoaderHasNoResources(\"redis/clients/jedis/commands/ProtocolCommand.class\")\n-        // Optimization for expensive typeMatcher.\n-        .and(not(classLoaderHasNoResources(\"redis/clients/jedis/Protocol.class\")));\n+    // Avoid matching 3.x\n+    return not(hasClassesNamed(\"redis.clients.jedis.commands.ProtocolCommand\"));", "originalCommit": "cb782fdd0ea43baf060cbce3368312f17f38164c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYzNjkyNQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1298#discussion_r388636925", "bodyText": "This is actually intentional.  JedisInstrumentation was doing a simple named matcher, so adding the classload matcher in unnecessary.  (It was added by accident.)", "author": "tylerbenson", "createdAt": "2020-03-06T00:08:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYxOTkxNg=="}], "type": "inlineReview"}]}