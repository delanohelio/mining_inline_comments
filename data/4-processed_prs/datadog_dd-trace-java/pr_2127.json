{"pr_number": 2127, "pr_title": "remove representative count tracking, and tie trace agent rate limiting to actual trace count ", "pr_createdAt": "2020-11-27T10:55:51Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/2127", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTUzNjI4NQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2127#discussion_r531536285", "bodyText": "tweak the log message to be \"{}. Dropping trace: {}\" if we're no longer counting them?", "author": "mcculls", "createdAt": "2020-11-27T11:09:18Z", "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/DDAgentWriter.java", "diffHunk": "@@ -143,14 +143,12 @@ public void write(final List<DDSpan> trace) {\n   }\n \n   private void handleDroppedTrace(final String reason, final List<DDSpan> trace) {\n-    incrementTraceCount();\n     log.debug(\"{}. Counted but dropping trace: {}\", reason, trace);", "originalCommit": "b0e90e9ba36edcaad415e36a2a354f5edcc3536c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTUzNzM0Ng==", "url": "https://github.com/DataDog/dd-trace-java/pull/2127#discussion_r531537346", "bodyText": "Actually they are counted via statsd", "author": "richardstartin", "createdAt": "2020-11-27T11:11:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTUzNjI4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTUzNjYyNg==", "url": "https://github.com/DataDog/dd-trace-java/pull/2127#discussion_r531536626", "bodyText": "as above, tweak log message to reflect we're not counting dropped traces any more", "author": "mcculls", "createdAt": "2020-11-27T11:09:59Z", "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/DDAgentWriter.java", "diffHunk": "@@ -143,14 +143,12 @@ public void write(final List<DDSpan> trace) {\n   }\n \n   private void handleDroppedTrace(final String reason, final List<DDSpan> trace) {\n-    incrementTraceCount();\n     log.debug(\"{}. Counted but dropping trace: {}\", reason, trace);\n     healthMetrics.onFailedPublish(UNSET);\n   }\n \n   private void handleDroppedTrace(\n       final String reason, final List<DDSpan> trace, final int samplingPriority) {\n-    incrementTraceCount();\n     log.debug(\"{}. Counted but dropping trace: {}\", reason, trace);", "originalCommit": "b0e90e9ba36edcaad415e36a2a354f5edcc3536c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7c0c7c9d9c6a5460193b8840e182127a9c96387c", "url": "https://github.com/DataDog/dd-trace-java/commit/7c0c7c9d9c6a5460193b8840e182127a9c96387c", "message": "remove representative count tracking", "committedDate": "2020-11-27T11:13:39Z", "type": "commit"}, {"oid": "7c0c7c9d9c6a5460193b8840e182127a9c96387c", "url": "https://github.com/DataDog/dd-trace-java/commit/7c0c7c9d9c6a5460193b8840e182127a9c96387c", "message": "remove representative count tracking", "committedDate": "2020-11-27T11:13:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM5NTkxMw==", "url": "https://github.com/DataDog/dd-trace-java/pull/2127#discussion_r532395913", "bodyText": "Not \"LoggingWritier\" anymore?", "author": "lpriima", "createdAt": "2020-11-30T07:40:44Z", "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/LoggingWriter.java", "diffHunk": "@@ -49,6 +44,9 @@ public void close() {\n     log.info(\"close()\");\n   }\n \n+  @Override\n+  public void incrementTraceCount() {}", "originalCommit": "7c0c7c9d9c6a5460193b8840e182127a9c96387c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzNDQyMg==", "url": "https://github.com/DataDog/dd-trace-java/pull/2127#discussion_r532534422", "bodyText": "I'll leave this open to see if anyone else considers this was serving a purpose", "author": "richardstartin", "createdAt": "2020-11-30T11:40:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM5NTkxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc3MjYzMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2127#discussion_r532772631", "bodyText": "Since these are now no-ops, I suggest we should either keep the API calls or remove the method entirely.", "author": "tylerbenson", "createdAt": "2020-11-30T17:30:19Z", "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/DDAgentWriter.java", "diffHunk": "@@ -143,14 +143,12 @@ public void write(final List<DDSpan> trace) {\n   }\n \n   private void handleDroppedTrace(final String reason, final List<DDSpan> trace) {\n-    incrementTraceCount();", "originalCommit": "7c0c7c9d9c6a5460193b8840e182127a9c96387c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc3NTg4MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2127#discussion_r532775881", "bodyText": "There's a comment in CoreTracer about why we can't (I did it).", "author": "richardstartin", "createdAt": "2020-11-30T17:35:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc3MjYzMQ=="}], "type": "inlineReview"}]}