{"pr_number": 1789, "pr_title": "CI-App: TestNG instrumentation", "pr_createdAt": "2020-08-20T11:26:10Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1789", "timeline": [{"oid": "bbc9a6d1a6ae353a261a3de801f54fd140fd56be", "url": "https://github.com/DataDog/dd-trace-java/commit/bbc9a6d1a6ae353a261a3de801f54fd140fd56be", "message": "Added TestNG instrumentation.", "committedDate": "2020-08-20T11:24:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk4MzExOQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1789#discussion_r473983119", "bodyText": "Would it be possible to setOutputDirectory to build/tmp/test-output? Then you wouldn't need to add the line in .gitignore.", "author": "bantonsson", "createdAt": "2020-08-20T13:38:40Z", "path": "dd-java-agent/instrumentation/testng-6.4/src/test/groovy/TestNGTest.groovy", "diffHunk": "@@ -0,0 +1,141 @@\n+import datadog.trace.agent.test.base.TestFrameworkTest\n+import datadog.trace.bootstrap.instrumentation.decorator.TestDecorator\n+import datadog.trace.instrumentation.testng.TestNGDecorator\n+import org.example.TestError\n+import org.example.TestFailed\n+import org.example.TestFailedWithSuccessPercentage\n+import org.example.TestInheritance\n+import org.example.TestSkipped\n+import org.example.TestSucceed\n+import org.testng.TestNG\n+\n+class TestNGTest extends TestFrameworkTest {\n+\n+  def \"test success generates spans\"() {\n+    setup:\n+    def testNG = new TestNG()\n+    testNG.setTestClasses(TestSucceed)", "originalCommit": "bbc9a6d1a6ae353a261a3de801f54fd140fd56be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQzMTY0Mg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1789#discussion_r475431642", "bodyText": "Changed \ud83d\udc4d", "author": "drodriguezhdez", "createdAt": "2020-08-24T08:40:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk4MzExOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAyNTU5Mw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1789#discussion_r474025593", "bodyText": "lol... every time I see this it looks like a typo for testing.", "author": "tylerbenson", "createdAt": "2020-08-20T14:27:42Z", "path": "dd-java-agent/instrumentation/testng-6.4/src/main/java/datadog/trace/instrumentation/testng/TestNGDecorator.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package datadog.trace.instrumentation.testng;\n+\n+import datadog.trace.api.DDTags;\n+import datadog.trace.bootstrap.instrumentation.api.AgentSpan;\n+import datadog.trace.bootstrap.instrumentation.decorator.TestDecorator;\n+import lombok.extern.slf4j.Slf4j;\n+import org.testng.ITestResult;\n+\n+@Slf4j\n+public class TestNGDecorator extends TestDecorator {\n+  public static final TestNGDecorator DECORATE = new TestNGDecorator();\n+\n+  @Override\n+  public String testFramework() {\n+    return \"testng\";", "originalCommit": "bbc9a6d1a6ae353a261a3de801f54fd140fd56be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAzNDM5Mw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1789#discussion_r474034393", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              return project.name == \"junit-4.10\" || project.name == \"testng-6.4\"\n          \n          \n            \n              return [ \"junit-4.10\", \"testng-6.4\" ].contains(project.name)\n          \n      \n    \n    \n  \n\n(or something like this... I assume there will be more testing projects.)", "author": "tylerbenson", "createdAt": "2020-08-20T14:39:12Z", "path": "gradle/java.gradle", "diffHunk": "@@ -278,7 +278,7 @@ def isJdkForced(String javaName) {\n }\n \n def isTestingInstrumentation(Project project) {\n-  return project.name == \"junit-4.10\"\n+  return project.name == \"junit-4.10\" || project.name == \"testng-6.4\"", "originalCommit": "bbc9a6d1a6ae353a261a3de801f54fd140fd56be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAzNDc0Mg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1789#discussion_r474034742", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            include 'dd-java-agent:instrumentation:testng-6.4'\n          \n          \n            \n            include ':dd-java-agent:instrumentation:testng-6.4'", "author": "tylerbenson", "createdAt": "2020-08-20T14:39:41Z", "path": "settings.gradle", "diffHunk": "@@ -156,6 +156,7 @@ include ':dd-java-agent:instrumentation:spring-scheduling-3.1'\n include ':dd-java-agent:instrumentation:spring-webmvc-3.1'\n include ':dd-java-agent:instrumentation:spring-webflux-5'\n include ':dd-java-agent:instrumentation:spymemcached-2.12'\n+include 'dd-java-agent:instrumentation:testng-6.4'", "originalCommit": "bbc9a6d1a6ae353a261a3de801f54fd140fd56be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8151071aa7f7ae97d08a3ac9ac3078d66f04ff76", "url": "https://github.com/DataDog/dd-trace-java/commit/8151071aa7f7ae97d08a3ac9ac3078d66f04ff76", "message": "Apply feedback suggestions from the review", "committedDate": "2020-08-24T08:37:15Z", "type": "commit"}, {"oid": "cd1e1428f136b18a2e7dfd672577fd49e87da9b2", "url": "https://github.com/DataDog/dd-trace-java/commit/cd1e1428f136b18a2e7dfd672577fd49e87da9b2", "message": "Apply feedback suggestions from code review.", "committedDate": "2020-08-24T09:02:08Z", "type": "commit"}]}