{"pr_number": 1263, "pr_title": "Introduce dd.tags", "pr_createdAt": "2020-02-27T11:27:48Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1263", "timeline": [{"oid": "0752b07d92baba9664356202e5287825a51fda5e", "url": "https://github.com/DataDog/dd-trace-java/commit/0752b07d92baba9664356202e5287825a51fda5e", "message": "Introduce dd.tags", "committedDate": "2020-02-27T11:26:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA3MzYwOQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1263#discussion_r385073609", "bodyText": "\ud83d\udc4f \ud83d\udc4f \ud83d\udc4f", "author": "dbenamydd", "createdAt": "2020-02-27T11:39:21Z", "path": "dd-trace-api/src/test/groovy/datadog/trace/api/ConfigTest.groovy", "diffHunk": "@@ -1033,4 +1038,65 @@ class ConfigTest extends DDSpecification {\n     then:\n     config.profilingApiKey == \"test-api-key\"\n   }\n+\n+  def \"verify dd.tags overrides global tags in properties\"() {\n+    setup:\n+    def prop = new Properties()\n+    prop.setProperty(TAGS, \"a:1\")\n+    prop.setProperty(GLOBAL_TAGS, \"b:2\")\n+    prop.setProperty(SPAN_TAGS, \"c:3\")\n+    prop.setProperty(JMX_TAGS, \"d:4\")\n+    prop.setProperty(HEADER_TAGS, \"e:5\")\n+    prop.setProperty(PROFILING_TAGS, \"f:6\")\n+\n+    when:\n+    Config config = Config.get(prop)\n+\n+    then:\n+    config.mergedSpanTags == [a: \"1\", c: \"3\"]\n+    config.mergedJmxTags == [a: \"1\", d: \"4\", (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName]\n+    config.headerTags == [e: \"5\"]\n+\n+    config.mergedProfilingTags == [a: \"1\", f: \"6\", (HOST_TAG): config.getHostName(), (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName, (LANGUAGE_TAG_KEY): LANGUAGE_TAG_VALUE]\n+  }\n+\n+  def \"verify dd.tags overrides global tags in system properties\"() {\n+    setup:\n+    System.setProperty(PREFIX + TAGS, \"a:1\")\n+    System.setProperty(PREFIX + GLOBAL_TAGS, \"b:2\")\n+    System.setProperty(PREFIX + SPAN_TAGS, \"c:3\")\n+    System.setProperty(PREFIX + JMX_TAGS, \"d:4\")\n+    System.setProperty(PREFIX + HEADER_TAGS, \"e:5\")\n+    System.setProperty(PREFIX + PROFILING_TAGS, \"f:6\")\n+\n+    when:\n+    Config config = new Config()\n+\n+    then:\n+    config.mergedSpanTags == [a: \"1\", c: \"3\"]\n+    config.mergedJmxTags == [a: \"1\", d: \"4\", (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName]\n+    config.headerTags == [e: \"5\"]\n+\n+    config.mergedProfilingTags == [a: \"1\", f: \"6\", (HOST_TAG): config.getHostName(), (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName, (LANGUAGE_TAG_KEY): LANGUAGE_TAG_VALUE]\n+  }\n+\n+  def \"verify dd.tags overrides global tags in env variables\"() {\n+    setup:\n+    environmentVariables.set(DD_TAGS_ENV, \"a:1\")\n+    environmentVariables.set(DD_GLOBAL_TAGS_ENV, \"b:2\")\n+    environmentVariables.set(DD_SPAN_TAGS_ENV, \"c:3\")\n+    environmentVariables.set(DD_JMX_TAGS_ENV, \"d:4\")\n+    environmentVariables.set(DD_HEADER_TAGS_ENV, \"e:5\")\n+    environmentVariables.set(DD_PROFILING_TAGS_ENV, \"f:6\")\n+\n+    when:\n+    Config config = new Config()\n+\n+    then:\n+    config.mergedSpanTags == [a: \"1\", c: \"3\"]\n+    config.mergedJmxTags == [a: \"1\", d: \"4\", (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName]\n+    config.headerTags == [e: \"5\"]\n+\n+    config.mergedProfilingTags == [a: \"1\", f: \"6\", (HOST_TAG): config.getHostName(), (RUNTIME_ID_TAG): config.getRuntimeId(), (SERVICE_TAG): config.serviceName, (LANGUAGE_TAG_KEY): LANGUAGE_TAG_VALUE]", "originalCommit": "0752b07d92baba9664356202e5287825a51fda5e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}