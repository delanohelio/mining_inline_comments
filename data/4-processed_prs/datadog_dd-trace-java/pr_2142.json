{"pr_number": 2142, "pr_title": "Select low and high version in every range for Muzzle", "pr_createdAt": "2020-12-01T15:54:34Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/2142", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzNjY1Ng==", "url": "https://github.com/DataDog/dd-trace-java/pull/2142#discussion_r533536656", "bodyText": "Why are we filtering after shuffling?", "author": "richardstartin", "createdAt": "2020-12-01T16:12:26Z", "path": "buildSrc/src/main/groovy/MuzzlePlugin.groovy", "diffHunk": "@@ -292,18 +292,25 @@ class MuzzlePlugin implements Plugin<Project> {\n   }\n \n   private static Set<Version> limitLargeRanges(VersionRangeResult result, Set<Version> versions, Set<String> skipVersions) {\n+    if (versions.size() <= 1) {\n+      return versions\n+    }\n+\n     List<Version> versionsCopy = new ArrayList<>(versions)\n-    Set<String> skipCopy = new HashSet<>(skipVersions)\n+    def beforeSize = versionsCopy.size()\n     versionsCopy.removeAll(skipVersions)\n+    VersionSet versionSet = new VersionSet(versionsCopy)\n+    versionsCopy = versionSet.lowAndHighForMajorMinor.toList()\n     Collections.shuffle(versionsCopy)\n     while (RANGE_COUNT_LIMIT <= versionsCopy.size()) {", "originalCommit": "721704482297c319eda7a649782ed437166ae2f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzOTAwOA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2142#discussion_r533539008", "bodyText": "To not get the same selection of RANGE_COUNT_LIMIT versions every time. Was probably more important when it selected random versions from the whole range.", "author": "bantonsson", "createdAt": "2020-12-01T16:15:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzNjY1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU1NzUxMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2142#discussion_r533557511", "bodyText": "Do we have an idea of how long this takes?", "author": "richardstartin", "createdAt": "2020-12-01T16:40:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzNjY1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk2MTA5Nw==", "url": "https://github.com/DataDog/dd-trace-java/pull/2142#discussion_r533961097", "bodyText": "Which part of this are you wondering about? The shuffling or the size call or the removing of elements?", "author": "bantonsson", "createdAt": "2020-12-02T07:55:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzNjY1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDEzMjA1NA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2142#discussion_r534132054", "bodyText": "the whole thing - this can be done a lot better with an algorithm related to reservoir sampling called algorithm D devised in the 80s for taking random samples from tapes (can't go backwards)", "author": "richardstartin", "createdAt": "2020-12-02T12:33:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzNjY1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcyMjQzMg==", "url": "https://github.com/DataDog/dd-trace-java/pull/2142#discussion_r533722432", "bodyText": "Thanks for adding some tests!", "author": "tylerbenson", "createdAt": "2020-12-01T21:08:39Z", "path": "buildSrc/src/test/groovy/VersionSetTest.groovy", "diffHunk": "@@ -0,0 +1,90 @@\n+import org.eclipse.aether.version.Version\n+import spock.lang.Specification\n+\n+import static VersionSet.ParsedVersion\n+\n+class VersionSetTest extends Specification {", "originalCommit": "721704482297c319eda7a649782ed437166ae2f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9eeeb51b3fe8e86e9cbe9f4bf817274ffd5081e1", "url": "https://github.com/DataDog/dd-trace-java/commit/9eeeb51b3fe8e86e9cbe9f4bf817274ffd5081e1", "message": "Select low and high version in every range for Muzzle", "committedDate": "2020-12-02T08:02:00Z", "type": "commit"}, {"oid": "9eeeb51b3fe8e86e9cbe9f4bf817274ffd5081e1", "url": "https://github.com/DataDog/dd-trace-java/commit/9eeeb51b3fe8e86e9cbe9f4bf817274ffd5081e1", "message": "Select low and high version in every range for Muzzle", "committedDate": "2020-12-02T08:02:00Z", "type": "forcePushed"}]}