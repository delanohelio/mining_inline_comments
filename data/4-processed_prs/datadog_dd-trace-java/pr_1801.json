{"pr_number": 1801, "pr_title": "Instrument Spring SessionAwareMessageListener", "pr_createdAt": "2020-08-25T13:37:36Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1801", "timeline": [{"oid": "ca4911baceb855a0d52f53a187f8f27448ff6675", "url": "https://github.com/DataDog/dd-trace-java/commit/ca4911baceb855a0d52f53a187f8f27448ff6675", "message": "Instrument Spring SpringSessionAwareMessageListener", "committedDate": "2020-08-26T08:11:03Z", "type": "forcePushed"}, {"oid": "bb34ca65753f7facdfdeae300ee45d2bd3776376", "url": "https://github.com/DataDog/dd-trace-java/commit/bb34ca65753f7facdfdeae300ee45d2bd3776376", "message": "Instrument Spring SessionAwareMessageListener", "committedDate": "2020-08-26T08:12:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0NzQzNg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1801#discussion_r477147436", "bodyText": "I think you need latest dependency expressions here", "author": "richardstartin", "createdAt": "2020-08-26T09:01:54Z", "path": "dd-java-agent/instrumentation/spring-jms-3.1/spring-jms-3.1.gradle", "diffHunk": "@@ -0,0 +1,24 @@\n+muzzle {\n+  pass {\n+    group = 'org.springframework'\n+    module = 'spring-jms'\n+    versions = \"[3.1.0.RELEASE,]\"\n+    extraDependency 'javax.jms:jms-api:1.1-rev-1'\n+  }\n+}\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+\n+dependencies {", "originalCommit": "bb34ca65753f7facdfdeae300ee45d2bd3776376", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE1MzQwNg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1801#discussion_r477153406", "bodyText": "Could you explain why, and how it's supposed to be used? I thought that is meant to run the test on the latest deps, and that doesn't seem to be done in all instrumentations.", "author": "bantonsson", "createdAt": "2020-08-26T09:12:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0NzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE5NDEyOA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1801#discussion_r477194128", "bodyText": "The idea is that the library can change and the instrumentation will stop working if it does. Downloading the latest dependency gives an early warning that a library breaking the instrumentation has been released, and that the instrumentation should be amended, or its applicability should be capped via muzzle, and a new instrumentation targeting the new library version should be implemented.", "author": "richardstartin", "createdAt": "2020-08-26T10:18:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0NzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIwODUxMg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1801#discussion_r477208512", "bodyText": "Yes, but I thought that muzzle was supposed to catch changes in APIs, which is what we are instrumenting here.\nAnyway, I can add a latestDeps test section as well. Some other projects reuse the test directory for that, is that ok to do?", "author": "bantonsson", "createdAt": "2020-08-26T10:47:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0NzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIxNzgxNA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1801#discussion_r477217814", "bodyText": "Muzzle verifies that classes and methods we expect to be present are present, it doesn't run any tests though.", "author": "richardstartin", "createdAt": "2020-08-26T11:06:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0NzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNTczMA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1801#discussion_r477225730", "bodyText": "What I meant was add some dependencies to the build file like this from e.g. spring-webflux\n  latestDepTestCompile group: 'org.springframework.boot', name: 'spring-boot-starter-webflux', version: '2.0.+'\n  latestDepTestCompile group: 'org.springframework.boot', name: 'spring-boot-starter-test', version: '2.0.+'\n  latestDepTestCompile group: 'org.springframework.boot', name: 'spring-boot-starter-reactor-netty', version: '2.0.+'", "author": "richardstartin", "createdAt": "2020-08-26T11:22:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0NzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI0OTA3NA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1801#discussion_r477249074", "bodyText": "Is that enough? I thought that we needed a new testSet with the org.unbroken-dome.test-sets plugin.", "author": "bantonsson", "createdAt": "2020-08-26T12:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0NzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI2OTg0MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1801#discussion_r477269841", "bodyText": "Yes that's necessary, as in the webflux example", "author": "richardstartin", "createdAt": "2020-08-26T12:43:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0NzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQyNDMyNg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1801#discussion_r477424326", "bodyText": "A latestDepTest have been added...", "author": "bantonsson", "createdAt": "2020-08-26T16:17:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0NzQzNg=="}], "type": "inlineReview"}, {"oid": "ac433e725761f3ed9b06737cf67b45b75036a251", "url": "https://github.com/DataDog/dd-trace-java/commit/ac433e725761f3ed9b06737cf67b45b75036a251", "message": "Instrument Spring SessionAwareMessageListener", "committedDate": "2020-08-26T16:06:16Z", "type": "forcePushed"}, {"oid": "e11ca69457f9b4aa77095d507fbdcc781d2e0249", "url": "https://github.com/DataDog/dd-trace-java/commit/e11ca69457f9b4aa77095d507fbdcc781d2e0249", "message": "Instrument Spring SessionAwareMessageListener", "committedDate": "2020-08-26T16:16:38Z", "type": "commit"}, {"oid": "e11ca69457f9b4aa77095d507fbdcc781d2e0249", "url": "https://github.com/DataDog/dd-trace-java/commit/e11ca69457f9b4aa77095d507fbdcc781d2e0249", "message": "Instrument Spring SessionAwareMessageListener", "committedDate": "2020-08-26T16:16:38Z", "type": "forcePushed"}]}