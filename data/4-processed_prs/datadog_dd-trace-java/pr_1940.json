{"pr_number": 1940, "pr_title": "Added CI/Git information to test spans for CI providers", "pr_createdAt": "2020-10-01T15:33:23Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1940", "timeline": [{"oid": "d45d49d4f749ac977ff50d1d50bb4bc1197c264d", "url": "https://github.com/DataDog/dd-trace-java/commit/d45d49d4f749ac977ff50d1d50bb4bc1197c264d", "message": "Add CI providers information for Test spans", "committedDate": "2020-10-02T07:07:54Z", "type": "commit"}, {"oid": "d45d49d4f749ac977ff50d1d50bb4bc1197c264d", "url": "https://github.com/DataDog/dd-trace-java/commit/d45d49d4f749ac977ff50d1d50bb4bc1197c264d", "message": "Add CI providers information for Test spans", "committedDate": "2020-10-02T07:07:54Z", "type": "forcePushed"}, {"oid": "e676aee2054c16bb35f545de46c9759cea86260a", "url": "https://github.com/DataDog/dd-trace-java/commit/e676aee2054c16bb35f545de46c9759cea86260a", "message": "Use setSpanType", "committedDate": "2020-10-02T07:11:00Z", "type": "commit"}, {"oid": "7548823e4c6b6c3aa4a560240b315dfcfe0f729b", "url": "https://github.com/DataDog/dd-trace-java/commit/7548823e4c6b6c3aa4a560240b315dfcfe0f729b", "message": "Remove unnecesary blank lines", "committedDate": "2020-10-02T07:42:31Z", "type": "commit"}, {"oid": "b9e29073eea9089eee89df8d405bf8c2628523c7", "url": "https://github.com/DataDog/dd-trace-java/commit/b9e29073eea9089eee89df8d405bf8c2628523c7", "message": "Clear discriminant CI env vars on test setup for TestDecoratorTest", "committedDate": "2020-10-02T07:58:32Z", "type": "commit"}, {"oid": "e78d8eaac18a31905d7c14520ee6be2e753166da", "url": "https://github.com/DataDog/dd-trace-java/commit/e78d8eaac18a31905d7c14520ee6be2e753166da", "message": "Check Test.BUILD_SOURCE_ROOT", "committedDate": "2020-10-02T08:12:11Z", "type": "commit"}, {"oid": "582b2969cd4d016df09efa80571ac3a7ce453987", "url": "https://github.com/DataDog/dd-trace-java/commit/582b2969cd4d016df09efa80571ac3a7ce453987", "message": "Check ci.pipeline.name in tests spans", "committedDate": "2020-10-02T08:28:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwODU4NA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1940#discussion_r498708584", "bodyText": "Do you want a hierarchy here instead?", "author": "richardstartin", "createdAt": "2020-10-02T09:16:26Z", "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/instrumentation/decorator/TestDecorator.java", "diffHunk": "@@ -69,6 +170,20 @@ public TestDecorator() {\n       setJenkinsData();\n     } else if (System.getenv(GITLAB) != null) {\n       setGitLabData();\n+    } else if (System.getenv(TRAVIS) != null) {", "originalCommit": "582b2969cd4d016df09efa80571ac3a7ce453987", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczMjc0OA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1940#discussion_r498732748", "bodyText": "I think it's fine to have it like this. A hierarchy for CI/Git decorators is too specific for the \"CiApp\" use case, and it will not be reusable for any other case. I'd not create a lot of decorators only for this case, IMHO.", "author": "drodriguezhdez", "createdAt": "2020-10-02T10:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwODU4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3NDE1MA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1940#discussion_r499374150", "bodyText": "I think the code would be easier to read if things were pulled apart a bit, so that you have one abstract CiInformation class that has all the methods that you need to implement, i.e. getProviderName(), getPipelineId et.c., and then have a specific subclass for each provider like gitlab, travis, et.c. As it's written right now, I can't really see if all the setter methods actually set all the fields they should.", "author": "bantonsson", "createdAt": "2020-10-05T06:46:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwODU4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUyMDA3Mg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1940#discussion_r499520072", "bodyText": "Refactored into different CIProviderInfo implementations.", "author": "drodriguezhdez", "createdAt": "2020-10-05T11:12:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwODU4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3NDMyOQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1940#discussion_r499374329", "bodyText": "Could this be a wildcard import?", "author": "bantonsson", "createdAt": "2020-10-05T06:46:56Z", "path": "dd-java-agent/agent-bootstrap/src/test/groovy/datadog/trace/bootstrap/instrumentation/decorator/TestDecoratorTest.groovy", "diffHunk": "@@ -6,7 +6,78 @@ import datadog.trace.bootstrap.instrumentation.api.AgentSpan\n import datadog.trace.bootstrap.instrumentation.api.Tags\n import org.junit.Rule\n import org.junit.contrib.java.lang.system.EnvironmentVariables\n+import spock.lang.Shared\n \n+import static datadog.trace.bootstrap.instrumentation.decorator.TestDecorator.APPVEYOR", "originalCommit": "582b2969cd4d016df09efa80571ac3a7ce453987", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3NzYxNQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1940#discussion_r499377615", "bodyText": "I think we could do it, but setting a smaller number in the Imports configuration in the IDE.\nNow, following the CONTRIBUTING.md, is set to 9999.\n* Editor > Code Style > Java/Groovy > Imports\n  * Class count to use import with '*': `9999` (some number sufficiently large that is unlikely to matter)\n  * Names count to use static import with '*': `9999`", "author": "drodriguezhdez", "createdAt": "2020-10-05T06:55:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3NDMyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUyMDMzNQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1940#discussion_r499520335", "bodyText": "As TestDecoratorTest has been refactored, this comment has been resolved.", "author": "drodriguezhdez", "createdAt": "2020-10-05T11:12:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3NDMyOQ=="}], "type": "inlineReview"}, {"oid": "5eb97bc9f1a4a9534f83acbc596a0a90407ab5df", "url": "https://github.com/DataDog/dd-trace-java/commit/5eb97bc9f1a4a9534f83acbc596a0a90407ab5df", "message": "Refactor into CIProviderInfo's", "committedDate": "2020-10-05T11:10:16Z", "type": "commit"}, {"oid": "dbf70c01fab2301c8453ec35178a32a67a64eab3", "url": "https://github.com/DataDog/dd-trace-java/commit/dbf70c01fab2301c8453ec35178a32a67a64eab3", "message": "Fix CodeNarc violations", "committedDate": "2020-10-05T11:22:53Z", "type": "commit"}]}