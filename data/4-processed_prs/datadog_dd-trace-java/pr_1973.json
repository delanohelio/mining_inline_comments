{"pr_number": 1973, "pr_title": "Instrument RunnableFuture and RejectedExecutionHandler", "pr_createdAt": "2020-10-12T13:06:03Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1973", "timeline": [{"oid": "62c5890bc229c4826cbdbb8420869454b488418e", "url": "https://github.com/DataDog/dd-trace-java/commit/62c5890bc229c4826cbdbb8420869454b488418e", "message": "add more testing for java executors", "committedDate": "2020-10-12T09:34:16Z", "type": "commit"}, {"oid": "a64da6d9f80d3e26d0e95c423c77d713bb4ba19c", "url": "https://github.com/DataDog/dd-trace-java/commit/a64da6d9f80d3e26d0e95c423c77d713bb4ba19c", "message": "AgentTracer.activeScope no longer deprecated", "committedDate": "2020-10-12T09:47:46Z", "type": "commit"}, {"oid": "1854b51ddb0b5e065a94957f84b2f760ad53aeee", "url": "https://github.com/DataDog/dd-trace-java/commit/1854b51ddb0b5e065a94957f84b2f760ad53aeee", "message": "replace instrumentation of Callable, Future, and ExecutorService methods returning a future with instrumentation of RunnableFuture", "committedDate": "2020-10-12T11:25:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyMzE5Mw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1973#discussion_r503323193", "bodyText": "println?", "author": "bantonsson", "createdAt": "2020-10-12T14:11:06Z", "path": "dd-java-agent/instrumentation/java-concurrent/src/test/java/SwallowingRejectedExecutionHandler.java", "diffHunk": "@@ -0,0 +1,9 @@\n+import java.util.concurrent.RejectedExecutionHandler;\n+import java.util.concurrent.ThreadPoolExecutor;\n+\n+public class SwallowingRejectedExecutionHandler implements RejectedExecutionHandler {\n+  @Override\n+  public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {\n+    System.out.println(executor + \" rejected \" + r);", "originalCommit": "d00a767f31d264f179a109210bbd3ecc379faf84", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyNTAyNg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1973#discussion_r503325026", "bodyText": "It's Java", "author": "richardstartin", "createdAt": "2020-10-12T14:13:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyMzE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyNjAzOQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1973#discussion_r503326039", "bodyText": "Sorry. I was wondering why there is a System.out.println(...) there at all.", "author": "bantonsson", "createdAt": "2020-10-12T14:15:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyMzE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyNjc5Ng==", "url": "https://github.com/DataDog/dd-trace-java/pull/1973#discussion_r503326796", "bodyText": "When tests fail it's nice to have some context, this seems relevant to me. I can change it to be a log statement if you like.", "author": "richardstartin", "createdAt": "2020-10-12T14:16:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyMzE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyNzcwOA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1973#discussion_r503327708", "bodyText": "Ok, just leave it there.", "author": "bantonsson", "createdAt": "2020-10-12T14:18:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyMzE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMzMTM2MA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1973#discussion_r503331360", "bodyText": "I removed it.", "author": "richardstartin", "createdAt": "2020-10-12T14:23:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyMzE5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyNzcxNQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1973#discussion_r503327715", "bodyText": "the async variable only appears to be used in the test name - is this right?", "author": "mcculls", "createdAt": "2020-10-12T14:18:19Z", "path": "dd-java-agent/instrumentation/java-concurrent/src/test/groovy/ForkJoinPoolPropagationTest.groovy", "diffHunk": "@@ -4,7 +4,7 @@ import datadog.trace.core.DDSpan\n import java.util.concurrent.ForkJoinPool\n \n class ForkJoinPoolPropagationTest extends AgentTestRunner {\n-  def \"test imbalanced recursive task propagation #parallelism FJP threads\" () {\n+  def \"test imbalanced recursive task propagation #parallelism FJP threads (async #async)\" () {", "originalCommit": "1c339813ba2a9000b026c816e9fec1ad444c8205", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyODMzNw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1973#discussion_r503328337", "bodyText": "good catch, it was supposed to go in to the FJP constructor...", "author": "richardstartin", "createdAt": "2020-10-12T14:19:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMyNzcxNQ=="}], "type": "inlineReview"}, {"oid": "792ad8b8b70065f073ece75ab07f72a1d62deac8", "url": "https://github.com/DataDog/dd-trace-java/commit/792ad8b8b70065f073ece75ab07f72a1d62deac8", "message": "resilience to rejected tasks in FJP and thread pools with RejectedExecutionHandlers", "committedDate": "2020-10-12T14:23:17Z", "type": "commit"}, {"oid": "9abc6bdd917757a8fad40003323012356d402859", "url": "https://github.com/DataDog/dd-trace-java/commit/9abc6bdd917757a8fad40003323012356d402859", "message": "add rejection tolerance to akka and scla FJP instrumentations", "committedDate": "2020-10-12T14:23:17Z", "type": "commit"}, {"oid": "9abc6bdd917757a8fad40003323012356d402859", "url": "https://github.com/DataDog/dd-trace-java/commit/9abc6bdd917757a8fad40003323012356d402859", "message": "add rejection tolerance to akka and scla FJP instrumentations", "committedDate": "2020-10-12T14:23:17Z", "type": "forcePushed"}]}