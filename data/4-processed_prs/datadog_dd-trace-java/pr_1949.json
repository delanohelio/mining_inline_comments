{"pr_number": 1949, "pr_title": "Test published dependencies", "pr_createdAt": "2020-10-05T13:02:18Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1949", "timeline": [{"oid": "ad8ddfedb70218b93a3d8039c90380b659ab2c2f", "url": "https://github.com/DataDog/dd-trace-java/commit/ad8ddfedb70218b93a3d8039c90380b659ab2c2f", "message": "Test published dependencies", "committedDate": "2020-10-05T13:01:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYyNzM3MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r499627371", "bodyText": "This shouldn't actually be published...", "author": "tylerbenson", "createdAt": "2020-10-05T14:10:07Z", "path": "test-published-dependencies/build.gradle", "diffHunk": "@@ -0,0 +1,62 @@\n+plugins {\n+\tid 'java'\n+\tid 'application'\n+\n+\tid 'com.diffplug.gradle.spotless' version '4.3.0'\n+\tid 'pl.allegro.tech.build.axion-release' version '1.10.3'\n+}\n+\n+repositories {\n+\tmavenLocal()\n+\tjcenter()\n+\tmavenCentral()\n+}\n+\n+spotless {\n+\tjava {\n+\t\tgoogleJavaFormat()\n+\t}\n+\tgroovyGradle {\n+\t\ttarget '*.gradle'\n+\t\tgreclipse()\n+\t}\n+\tformat 'misc', {\n+\t\ttarget '.gitignore'\n+\t\tindentWithSpaces(2)\n+\t\ttrimTrailingWhitespace()\n+\t\tendWithNewline()\n+\t}\n+}\n+task formatCode(dependsOn: ['spotlessApply'])\n+\n+scmVersion {\n+\ttag {\n+\t\tprefix = 'v'\n+\t\tversionSeparator = ''\n+\t}\n+\n+\tversionIncrementer 'incrementMinor'\n+\n+\tchecks {\n+\t\tuncommittedChanges = false\n+\t\taheadOfRemote = true\n+\t\tsnapshotDependencies = false\n+\t}\n+\n+\trepository {\n+\t\tdirectory = project.rootProject.file('../')\n+\t}\n+}\n+\n+def dd_trace_version = scmVersion.version\n+\n+dependencies {\n+\timplementation \"com.datadoghq:dd-java-agent:${dd_trace_version}\"\n+\timplementation \"com.datadoghq:dd-trace-api:${dd_trace_version}\"\n+\timplementation \"com.datadoghq:dd-trace-java:${dd_trace_version}\"", "originalCommit": "ad8ddfedb70218b93a3d8039c90380b659ab2c2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAzNjMwMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r500036301", "bodyText": "Good to know. I kind of assumed that the things being published now where the things that should be published.", "author": "bantonsson", "createdAt": "2020-10-06T06:36:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYyNzM3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzMDY3Nw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r499630677", "bodyText": "is it worth explicitly referencing some of the included classes so that the compile fails if the dependency link fails somehow?", "author": "tylerbenson", "createdAt": "2020-10-05T14:14:56Z", "path": "test-published-dependencies/src/main/java/test/published/dependencies/App.java", "diffHunk": "@@ -0,0 +1,7 @@\n+package test.published.dependencies;\n+\n+public class App {\n+  public static void main(String[] args) {\n+    System.out.println(\"Test published dependencies!\");", "originalCommit": "ad8ddfedb70218b93a3d8039c90380b659ab2c2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA0MTcxMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r500041711", "bodyText": "So the immediate purpose of this standalone project was just to test that we didn't leak transitive dependencies, and just building the code will fail if not all dependencies can be found, even if they're not referenced in code. We could expand this in the future to actually both build and test run the agent, but I think that is for another PR.", "author": "bantonsson", "createdAt": "2020-10-06T06:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzMDY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM5NzIyMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r500397221", "bodyText": "Yes, I think this is an excellent start.  If there are some quick refinements, I'm open to adding them.  However, I think is solid progress on its own, and I wouldn't delay merging for those refinements whatever they may be.", "author": "dougqh", "createdAt": "2020-10-06T15:35:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzMDY3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzMTQ3Ng==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r499631476", "bodyText": "It might be better to remove these to ensure the dependency only comes from the install", "author": "tylerbenson", "createdAt": "2020-10-05T14:16:04Z", "path": "test-published-dependencies/build.gradle", "diffHunk": "@@ -0,0 +1,62 @@\n+plugins {\n+\tid 'java'\n+\tid 'application'\n+\n+\tid 'com.diffplug.gradle.spotless' version '4.3.0'\n+\tid 'pl.allegro.tech.build.axion-release' version '1.10.3'\n+}\n+\n+repositories {\n+\tmavenLocal()\n+\tjcenter()\n+\tmavenCentral()", "originalCommit": "ad8ddfedb70218b93a3d8039c90380b659ab2c2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA0NDMzNg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r500044336", "bodyText": "That is unfortunately not possible since our published dd-trace-ot artifact depends on a number of external things.", "author": "bantonsson", "createdAt": "2020-10-06T06:54:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzMTQ3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzMjY5Mw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r499632693", "bodyText": "can you just apply the ../gradle/spotless.gradle file instead?", "author": "tylerbenson", "createdAt": "2020-10-05T14:17:46Z", "path": "test-published-dependencies/build.gradle", "diffHunk": "@@ -0,0 +1,62 @@\n+plugins {\n+\tid 'java'\n+\tid 'application'\n+\n+\tid 'com.diffplug.gradle.spotless' version '4.3.0'\n+\tid 'pl.allegro.tech.build.axion-release' version '1.10.3'\n+}\n+\n+repositories {\n+\tmavenLocal()\n+\tjcenter()\n+\tmavenCentral()\n+}\n+\n+spotless {", "originalCommit": "ad8ddfedb70218b93a3d8039c90380b659ab2c2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA2MzI1OA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r500063258", "bodyText": "Not straight away, since it references the project root for config files (and this project is a standalone project). I'll reuse that and the scm config.", "author": "bantonsson", "createdAt": "2020-10-06T07:32:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzMjY5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzNDQ4Mg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r499634482", "bodyText": "If referencing the spotless file works, perhaps this code should be pulled out of dd-trace-java.gradle and referenced the same way.", "author": "tylerbenson", "createdAt": "2020-10-05T14:20:16Z", "path": "test-published-dependencies/build.gradle", "diffHunk": "@@ -0,0 +1,62 @@\n+plugins {\n+\tid 'java'\n+\tid 'application'\n+\n+\tid 'com.diffplug.gradle.spotless' version '4.3.0'\n+\tid 'pl.allegro.tech.build.axion-release' version '1.10.3'\n+}\n+\n+repositories {\n+\tmavenLocal()\n+\tjcenter()\n+\tmavenCentral()\n+}\n+\n+spotless {\n+\tjava {\n+\t\tgoogleJavaFormat()\n+\t}\n+\tgroovyGradle {\n+\t\ttarget '*.gradle'\n+\t\tgreclipse()\n+\t}\n+\tformat 'misc', {\n+\t\ttarget '.gitignore'\n+\t\tindentWithSpaces(2)\n+\t\ttrimTrailingWhitespace()\n+\t\tendWithNewline()\n+\t}\n+}\n+task formatCode(dependsOn: ['spotlessApply'])\n+\n+scmVersion {", "originalCommit": "ad8ddfedb70218b93a3d8039c90380b659ab2c2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA2MzQ4NQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r500063485", "bodyText": "Yes, I'll do that.", "author": "bantonsson", "createdAt": "2020-10-06T07:32:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzNDQ4Mg=="}], "type": "inlineReview"}, {"oid": "41b029920762ebf4f158b1f194501af1be66257c", "url": "https://github.com/DataDog/dd-trace-java/commit/41b029920762ebf4f158b1f194501af1be66257c", "message": "Apply spotless to root project", "committedDate": "2020-10-06T07:57:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE0OTAwMA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r500149000", "bodyText": "nitpick: mvn_local_repo would be more accurate as a variable name - mvn_home is typically used to refer to where the maven binary is installed", "author": "mcculls", "createdAt": "2020-10-06T09:52:19Z", "path": ".circleci/config.yml", "diffHunk": "@@ -146,6 +146,16 @@ jobs:\n             << pipeline.parameters.gradle_flags >>\n             --max-workers=8\n \n+      - run:\n+          name: Test Published Dependencies\n+          command: |\n+            mvn_home=$(mvn help:evaluate -Dexpression=settings.localRepository -q -DforceStdout)", "originalCommit": "6053721fe0f2886c2334097f7b5792942842022d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE0OTcwMg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r500149702", "bodyText": "Good point. I'll change it.", "author": "bantonsson", "createdAt": "2020-10-06T09:53:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE0OTAwMA=="}], "type": "inlineReview"}, {"oid": "5ce91be250fafb440b56927f791e9c9df2fa25d8", "url": "https://github.com/DataDog/dd-trace-java/commit/5ce91be250fafb440b56927f791e9c9df2fa25d8", "message": "Test published dependencies", "committedDate": "2020-10-06T09:59:34Z", "type": "commit"}, {"oid": "f1743fbe1cea91d6181b6dbda452373a87440713", "url": "https://github.com/DataDog/dd-trace-java/commit/f1743fbe1cea91d6181b6dbda452373a87440713", "message": "Apply spotless to root project", "committedDate": "2020-10-06T09:59:44Z", "type": "commit"}, {"oid": "f1743fbe1cea91d6181b6dbda452373a87440713", "url": "https://github.com/DataDog/dd-trace-java/commit/f1743fbe1cea91d6181b6dbda452373a87440713", "message": "Apply spotless to root project", "committedDate": "2020-10-06T09:59:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM5ODU1Ng==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r500398556", "bodyText": "Who has access to mark this check as required? We should do that", "author": "devinsba", "createdAt": "2020-10-06T15:37:00Z", "path": ".circleci/config.yml", "diffHunk": "@@ -146,6 +146,16 @@ jobs:\n             << pipeline.parameters.gradle_flags >>\n             --max-workers=8\n \n+      - run:\n+          name: Test Published Dependencies", "originalCommit": "f1743fbe1cea91d6181b6dbda452373a87440713", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgzNDc0MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r501834741", "bodyText": "I can do that.", "author": "tylerbenson", "createdAt": "2020-10-08T15:59:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM5ODU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgzNjI2Mw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1949#discussion_r501836263", "bodyText": "Actually, this is an additional task on the check job which is already required, not a separate job.", "author": "tylerbenson", "createdAt": "2020-10-08T16:01:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM5ODU1Ng=="}], "type": "inlineReview"}]}