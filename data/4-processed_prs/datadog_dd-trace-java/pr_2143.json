{"pr_number": 2143, "pr_title": "avoid excessive thread creation when trace agent is down", "pr_createdAt": "2020-12-01T16:59:56Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/2143", "timeline": [{"oid": "760e95ed752446099b7453c64bf70ba678105aeb", "url": "https://github.com/DataDog/dd-trace-java/commit/760e95ed752446099b7453c64bf70ba678105aeb", "message": "avoid excessive thread creation when trace agent is down", "committedDate": "2020-12-01T17:00:31Z", "type": "commit"}, {"oid": "760e95ed752446099b7453c64bf70ba678105aeb", "url": "https://github.com/DataDog/dd-trace-java/commit/760e95ed752446099b7453c64bf70ba678105aeb", "message": "avoid excessive thread creation when trace agent is down", "committedDate": "2020-12-01T17:00:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU5OTc2MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2143#discussion_r533599761", "bodyText": "I assume this is the main fix that avoids creating new threads?", "author": "tylerbenson", "createdAt": "2020-12-01T17:39:59Z", "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/ddagent/DDAgentApi.java", "diffHunk": "@@ -89,9 +90,10 @@ public DDAgentApi(\n       final boolean metricsReportingEnabled,\n       final Monitoring monitoring) {\n     this.agentUrl = agentUrl;\n-    this.unixDomainSocketPath = unixDomainSocketPath;\n+    this.usingUnixDomainSockets = unixDomainSocketPath != null;\n     this.timeoutMillis = timeoutMillis;\n     this.metricsReportingEnabled = metricsReportingEnabled;\n+    this.httpClient = buildHttpClient(HttpUrl.get(agentUrl), unixDomainSocketPath, timeoutMillis);", "originalCommit": "760e95ed752446099b7453c64bf70ba678105aeb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYwMzYwMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2143#discussion_r533603601", "bodyText": "Yes. Some other stuff changed because variables were no longer used, and unfortunately CoreTracerTest was reaching in and using them. Groovy problems.", "author": "richardstartin", "createdAt": "2020-12-01T17:45:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU5OTc2MQ=="}], "type": "inlineReview"}]}