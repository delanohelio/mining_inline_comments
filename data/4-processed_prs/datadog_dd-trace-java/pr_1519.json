{"pr_number": 1519, "pr_title": "OpenTracing no longer automatically added in `dd-java-agent`. Registers GlobalTracer instance via instrumentation if necessary.", "pr_createdAt": "2020-06-01T21:41:16Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1519", "timeline": [{"oid": "77fe8a3dea096f22ce7cfc269387e451277541a9", "url": "https://github.com/DataDog/dd-trace-java/commit/77fe8a3dea096f22ce7cfc269387e451277541a9", "message": "Fix build", "committedDate": "2020-06-02T14:19:25Z", "type": "forcePushed"}, {"oid": "529bb1dad996a4fd9a32da9e0af59d5a4150a318", "url": "https://github.com/DataDog/dd-trace-java/commit/529bb1dad996a4fd9a32da9e0af59d5a4150a318", "message": "Update dd-trace-ot to use internal api instead of dd-trace-core where possible.", "committedDate": "2020-06-02T17:22:45Z", "type": "commit"}, {"oid": "c5288e126dcea8ae99eb02c8e88b802c5bc1ec2a", "url": "https://github.com/DataDog/dd-trace-java/commit/c5288e126dcea8ae99eb02c8e88b802c5bc1ec2a", "message": "Remove OpenTracing dependency", "committedDate": "2020-06-02T17:22:45Z", "type": "commit"}, {"oid": "b52ec52841b0b37b6bb76dfe663bee988b5541b9", "url": "https://github.com/DataDog/dd-trace-java/commit/b52ec52841b0b37b6bb76dfe663bee988b5541b9", "message": "Add OpenTracing instrumentation for GlobalTracer", "committedDate": "2020-06-02T17:22:45Z", "type": "commit"}, {"oid": "1ea1927f62a5c51908280780fbb672aacf8ff094", "url": "https://github.com/DataDog/dd-trace-java/commit/1ea1927f62a5c51908280780fbb672aacf8ff094", "message": "Fix build", "committedDate": "2020-06-02T17:22:45Z", "type": "commit"}, {"oid": "1ea1927f62a5c51908280780fbb672aacf8ff094", "url": "https://github.com/DataDog/dd-trace-java/commit/1ea1927f62a5c51908280780fbb672aacf8ff094", "message": "Fix build", "committedDate": "2020-06-02T17:22:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA2ODA5MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1519#discussion_r434068091", "bodyText": "I'm not sure this is necessary.  We already test delegation to the bootstrap for DD classes", "author": "randomanderson", "createdAt": "2020-06-02T17:59:48Z", "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/ClassLoaderMatcher.java", "diffHunk": "@@ -86,7 +86,7 @@ private static boolean shouldSkipClass(final ClassLoader loader) {\n      */\n     private static boolean delegatesToBootstrap(final ClassLoader loader) {\n       boolean delegates = true;\n-      if (!loadsExpectedClass(loader, GlobalTracer.class)) {\n+      if (!loadsExpectedClass(loader, Tracer.class)) {", "originalCommit": "1ea1927f62a5c51908280780fbb672aacf8ff094", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyNTgzMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1519#discussion_r434125831", "bodyText": "yeah, I understand the test is probably no longer necessary.  I just didn't feel it was important to remove.", "author": "tylerbenson", "createdAt": "2020-06-02T19:28:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA2ODA5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzOTM2MA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1519#discussion_r434139360", "bodyText": "We can leave it.  One's a bootstrap class, the other is an API class.  There's some value.", "author": "randomanderson", "createdAt": "2020-06-02T19:54:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA2ODA5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA3MzQwNw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1519#discussion_r434073407", "bodyText": "Is this necessary?  Also, why is it 0.31.0 when we're using 0.32.0 everywhere else", "author": "randomanderson", "createdAt": "2020-06-02T18:05:50Z", "path": "dd-java-agent/dd-java-agent.gradle", "diffHunk": "@@ -97,16 +114,15 @@ modifyPom {\n dependencies {\n   testCompile project(':dd-java-agent:agent-bootstrap')\n   testCompile project(':dd-trace-api')\n-  testCompile project(':dd-trace-ot')\n   testCompile project(':dd-trace-core')\n   testCompile project(':utils:test-utils')\n \n   testCompile deps.testLogging\n   testCompile deps.guava\n+  testCompile group: 'io.opentracing', name: 'opentracing-util', version: '0.31.0'", "originalCommit": "1ea1927f62a5c51908280780fbb672aacf8ff094", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyNjgxNQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1519#discussion_r434126815", "bodyText": "This is to enable OpenTracingTest.  I don't remember why I went with 31 instead of 32, but I don't think it matters.  I can change if you like.", "author": "tylerbenson", "createdAt": "2020-06-02T19:30:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA3MzQwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzOTUzMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1519#discussion_r434139531", "bodyText": "I would argue that this test belongs with the OT instrumentation.  It's directly testing that the OT instrumentation is enabled and works.  None of the other tests at the dd-java-agent level are that specific.\nI don't feel strongly about it though.", "author": "randomanderson", "createdAt": "2020-06-02T19:54:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA3MzQwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE4Mjk0MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1519#discussion_r434182941", "bodyText": "I already have similar tests at the OT instrumentation level.  I felt this was a bit more core behavior and warranted a test at the agent level.", "author": "tylerbenson", "createdAt": "2020-06-02T21:22:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA3MzQwNw=="}], "type": "inlineReview"}]}