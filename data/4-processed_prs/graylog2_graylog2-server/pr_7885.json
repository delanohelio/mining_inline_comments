{"pr_number": 7885, "pr_title": "Enable/disable auto-completion in query input based on user preference.", "pr_createdAt": "2020-04-15T15:09:36Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/7885", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAzMjgwNA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409032804", "bodyText": "Should probably keep these to the defaultProps instead of potentially resetting what the default is here.", "author": "kyleknighted", "createdAt": "2020-04-15T18:03:06Z", "path": "graylog2-web-interface/src/views/components/SearchBar.jsx", "diffHunk": "@@ -21,90 +23,100 @@ import HorizontalSpacer from 'views/components/horizontalspacer/HorizontalSpacer\n import { QueriesActions } from 'views/stores/QueriesStore';\n import { CurrentQueryStore } from 'views/stores/CurrentQueryStore';\n import { StreamsStore } from 'views/stores/StreamsStore';\n-import { QueryFiltersActions, QueryFiltersStore } from 'views/stores/QueryFiltersStore';\n+import { QueryFiltersStore } from 'views/stores/QueryFiltersStore';\n+import Query, { createElasticsearchQueryString, filtersForQuery, filtersToStreamSet } from 'views/logic/queries/Query';\n+import type { FilterType, QueryId, TimeRange } from 'views/logic/queries/Query';\n+import SearchBarForm from './searchbar/SearchBarForm';\n \n type Props = {\n   availableStreams: Array<*>,\n   config: any,\n-  currentQuery: {\n-    id: string,\n-    timerange: any,\n-    query: {\n-      query_string: string,\n-    },\n-  },\n+  currentQuery: Query,\n   disableSearch: boolean,\n-  onExecute: () => void,\n-  queryFilters: Immutable.Map<any, any>,\n+  onSubmit: ({ timerange: TimeRange, streams: Array<string>, queryString: string }, Query) => Promise<any>,\n+  queryFilters: Immutable.Map<QueryId, FilterType>,\n+};\n+\n+const defaultOnSubmit = ({ timerange, streams, queryString }, currentQuery: Query) => {\n+  const newQuery = currentQuery.toBuilder()\n+    .timerange(timerange)\n+    .filter(filtersForQuery(streams))\n+    .query(createElasticsearchQueryString(queryString))\n+    .build();\n+\n+  return QueriesActions.update(newQuery.id, newQuery);\n };\n \n-const SearchBar = ({ availableStreams, config, currentQuery, disableSearch = false, onExecute: performSearch, queryFilters }: Props) => {\n+const SearchBar = ({ availableStreams, config, currentQuery, disableSearch = false, queryFilters, onSubmit = defaultOnSubmit }: Props) => {", "originalCommit": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUzMzE5Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409533196", "bodyText": "The benefit of using default values is that flow is doing proper type checks, while the PropTypes type specs only do check very basic things (in this case if onSubmit is a function or not). Otoh, having runtime checks potentially helps us debugging issues caused by untested integration code.\nThe remaining risk is that someone could change one, but not the other, so they deviate. To address this, I created a defaultProps object which we are referencing in both places. I am not sure if it improves things or makes it more verbose.", "author": "dennisoelkers", "createdAt": "2020-04-16T12:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAzMjgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NzUyNw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409057527", "bodyText": "Since you're not using the Theme here, you can just pass void instead of ThemeInterface\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`\n          \n          \n            \n            const DirtyButton: StyledComponent<{}, void, any> = styled(Button)`", "author": "kyleknighted", "createdAt": "2020-04-15T18:45:25Z", "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';\n \n-const SearchButton = ({ running, disabled, glyph }) => (\n-  <Button type=\"submit\" bsStyle={running ? 'warning' : 'success'} disabled={disabled} className=\"pull-left search-button-execute\">\n-    {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} /> }\n-  </Button>\n-);\n+const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`", "originalCommit": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1OTA2Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409059066", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import styled from 'styled-components';\n          \n          \n            \n            import type { StyledComponent } from 'styled-components';\n          \n          \n            \n            import styled, { type StyledComponent } from 'styled-components';", "author": "kyleknighted", "createdAt": "2020-04-15T18:48:06Z", "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';", "originalCommit": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1OTU2NA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7885#discussion_r409059564", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { ThemeInterface } from 'theme/index';", "author": "kyleknighted", "createdAt": "2020-04-15T18:48:58Z", "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';", "originalCommit": "f33c5d83d4ff8388433ccc4910b7c51d43a15e1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "facbc5934098c6d6877f0b9c87f129be77f5ae3d", "url": "https://github.com/Graylog2/graylog2-server/commit/facbc5934098c6d6877f0b9c87f129be77f5ae3d", "message": "Updating `QueryInput` tests.", "committedDate": "2020-04-16T11:20:23Z", "type": "forcePushed"}, {"oid": "87fb148f089815e7b368fd26f1378a0323163d1d", "url": "https://github.com/Graylog2/graylog2-server/commit/87fb148f089815e7b368fd26f1378a0323163d1d", "message": "Using shared `defaultProps` object.", "committedDate": "2020-04-16T14:51:50Z", "type": "forcePushed"}, {"oid": "c08292fa37c60c803bf82c58cfe0915362aa1938", "url": "https://github.com/Graylog2/graylog2-server/commit/c08292fa37c60c803bf82c58cfe0915362aa1938", "message": "Using shared `defaultProps` object.", "committedDate": "2020-04-16T15:03:29Z", "type": "forcePushed"}, {"oid": "4fd08bb0614b20dc7add4396643b189dda69f70e", "url": "https://github.com/Graylog2/graylog2-server/commit/4fd08bb0614b20dc7add4396643b189dda69f70e", "message": "Using shared `defaultProps` object.", "committedDate": "2020-04-17T08:03:58Z", "type": "forcePushed"}, {"oid": "586f56189bb735bd2ea1ff9db5eb62270ec7a2cf", "url": "https://github.com/Graylog2/graylog2-server/commit/586f56189bb735bd2ea1ff9db5eb62270ec7a2cf", "message": "Using shared `defaultProps` object.", "committedDate": "2020-04-17T10:37:47Z", "type": "forcePushed"}, {"oid": "bdf355a772f485fb8e6bbfd8213189b96f7df4c7", "url": "https://github.com/Graylog2/graylog2-server/commit/bdf355a772f485fb8e6bbfd8213189b96f7df4c7", "message": "Updating snapshots.", "committedDate": "2020-04-17T12:36:38Z", "type": "commit"}, {"oid": "ef47a4feca86cbf05db8dcb920c30d4eed5fd26a", "url": "https://github.com/Graylog2/graylog2-server/commit/ef47a4feca86cbf05db8dcb920c30d4eed5fd26a", "message": "Replacing homebrewn placeholder with ace feature.", "committedDate": "2020-04-17T12:36:39Z", "type": "commit"}, {"oid": "c41641a22ca61d87a3293299a78794cdfa4be2f0", "url": "https://github.com/Graylog2/graylog2-server/commit/c41641a22ca61d87a3293299a78794cdfa4be2f0", "message": "Refactoring `QueryInput` to functional component.", "committedDate": "2020-04-17T12:36:39Z", "type": "commit"}, {"oid": "d50bbe6358a5fdfd3c91cf9d98dc018e35028f55", "url": "https://github.com/Graylog2/graylog2-server/commit/d50bbe6358a5fdfd3c91cf9d98dc018e35028f55", "message": "Enable/disable auto completion based on user preference.", "committedDate": "2020-04-17T12:36:39Z", "type": "commit"}, {"oid": "a41206a5d9752be4564fd13eedf740f5a6fc873d", "url": "https://github.com/Graylog2/graylog2-server/commit/a41206a5d9752be4564fd13eedf740f5a6fc873d", "message": "Updating `QueryInput` tests.", "committedDate": "2020-04-17T12:36:39Z", "type": "commit"}, {"oid": "66dc4372ff490d5d47ebac7867a7bd52c3254a22", "url": "https://github.com/Graylog2/graylog2-server/commit/66dc4372ff490d5d47ebac7867a7bd52c3254a22", "message": "Fixing linter hint.", "committedDate": "2020-04-17T12:36:39Z", "type": "commit"}, {"oid": "7c3b3ba0940a551a55eca0ccaf2a197b10e1be52", "url": "https://github.com/Graylog2/graylog2-server/commit/7c3b3ba0940a551a55eca0ccaf2a197b10e1be52", "message": "Using shared `defaultProps` object.", "committedDate": "2020-04-17T12:36:40Z", "type": "commit"}, {"oid": "7c3b3ba0940a551a55eca0ccaf2a197b10e1be52", "url": "https://github.com/Graylog2/graylog2-server/commit/7c3b3ba0940a551a55eca0ccaf2a197b10e1be52", "message": "Using shared `defaultProps` object.", "committedDate": "2020-04-17T12:36:40Z", "type": "forcePushed"}]}