{"pr_number": 9423, "pr_title": "Hide indices on cloud", "pr_createdAt": "2020-11-10T13:34:41Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/9423", "timeline": [{"oid": "fa3d29a42124893ea60de1c39c586992956b7fe3", "url": "https://github.com/Graylog2/graylog2-server/commit/fa3d29a42124893ea60de1c39c586992956b7fe3", "message": "hide indices page component in cloud", "committedDate": "2020-11-10T13:15:36Z", "type": "commit"}, {"oid": "bd490b664ca9be90516a0c19307c054a9756f91c", "url": "https://github.com/Graylog2/graylog2-server/commit/bd490b664ca9be90516a0c19307c054a9756f91c", "message": "abstract conditional away to component", "committedDate": "2020-11-10T13:21:07Z", "type": "commit"}, {"oid": "19be6992b2b2279b1e6d6af482047e048df8d756", "url": "https://github.com/Graylog2/graylog2-server/commit/19be6992b2b2279b1e6d6af482047e048df8d756", "message": "hide indices menu item on cloud", "committedDate": "2020-11-10T13:22:14Z", "type": "commit"}, {"oid": "343bc150cea170f4fb0948768598529207800275", "url": "https://github.com/Graylog2/graylog2-server/commit/343bc150cea170f4fb0948768598529207800275", "message": "hide indices failures", "committedDate": "2020-11-10T13:27:47Z", "type": "commit"}, {"oid": "61ee8277bc0b920099cf7699ca2a1da3a9ae3d93", "url": "https://github.com/Graylog2/graylog2-server/commit/61ee8277bc0b920099cf7699ca2a1da3a9ae3d93", "message": "rename jsx", "committedDate": "2020-11-10T15:21:30Z", "type": "commit"}, {"oid": "c85d3eebb89f464dd0cfc9c3ee3a6e22d4cf2f68", "url": "https://github.com/Graylog2/graylog2-server/commit/c85d3eebb89f464dd0cfc9c3ee3a6e22d4cf2f68", "message": "update mocks for settings", "committedDate": "2020-11-10T15:31:42Z", "type": "commit"}, {"oid": "dfa9e00587fcba252d6c1910acb20f264b13c543", "url": "https://github.com/Graylog2/graylog2-server/commit/dfa9e00587fcba252d6c1910acb20f264b13c543", "message": "hide index pages", "committedDate": "2020-11-11T08:23:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI4OTgwMQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#discussion_r521289801", "bodyText": "I suggest moving these checks into AppRouter, so that react-router will not have the route configuration for routes that should be hidden. This helps us by not having to modify each page that should be hidden, and the behaviour is more consistent with other routes that do not exist.\nSomething like this should do the trick:\n--- a/graylog2-web-interface/src/routing/AppRouter.jsx\n+++ b/graylog2-web-interface/src/routing/AppRouter.jsx\n@@ -87,6 +87,7 @@ import {\n } from 'pages';\n \n import RouterErrorBoundary from 'components/errors/RouterErrorBoundary';\n+import withHideOnCloud from '../util/conditional/withHideOnCloud';\n \n const AppRouter = () => {\n   const pluginRoutes = PluginStore.exports('routes');\n@@ -162,7 +163,7 @@ const AppRouter = () => {\n                      component={EditContentPackPage} />\n               <Route path={Routes.SYSTEM.CONTENTPACKS.show(':contentPackId')} component={ShowContentPackPage} />\n               <Route path={Routes.SYSTEM.GROKPATTERNS} component={GrokPatternsPage} />\n-              <Route path={Routes.SYSTEM.INDICES.LIST} component={IndicesPage} />\n+              {withHideOnCloud(<Route path={Routes.SYSTEM.INDICES.LIST} component={IndicesPage} />)}\n               <Route path={Routes.SYSTEM.INDEX_SETS.CREATE} component={IndexSetCreationPage} />\n               <Route path={Routes.SYSTEM.INDEX_SETS.SHOW(':indexSetId')} component={IndexSetPage} />\n               <Route path={Routes.SYSTEM.INDEX_SETS.CONFIGURATION(':indexSetId')}", "author": "edmundoa", "createdAt": "2020-11-11T11:21:29Z", "path": "graylog2-web-interface/src/pages/IndicesPage.jsx", "diffHunk": "@@ -48,4 +49,4 @@ class IndicesPage extends React.Component {\n   }\n }\n \n-export default IndicesPage;\n+export default withHideOnCloud(IndicesPage);", "originalCommit": "dfa9e00587fcba252d6c1910acb20f264b13c543", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI5NjU5MQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#discussion_r521296591", "bodyText": "I was thinking the exact same thing earlier. Makes it a lot safer too. Will change the PRs to reflect this.", "author": "Gaya", "createdAt": "2020-11-11T11:34:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI4OTgwMQ=="}], "type": "inlineReview"}, {"oid": "a0852800fa9271ac52cda83304ce880d912087a4", "url": "https://github.com/Graylog2/graylog2-server/commit/a0852800fa9271ac52cda83304ce880d912087a4", "message": "do not register indices routes", "committedDate": "2020-11-11T15:44:42Z", "type": "commit"}, {"oid": "64858cb992e3ac2bc5c7e668949c75ed9f14f683", "url": "https://github.com/Graylog2/graylog2-server/commit/64858cb992e3ac2bc5c7e668949c75ed9f14f683", "message": "disable indexes pages", "committedDate": "2020-11-11T15:47:48Z", "type": "commit"}, {"oid": "6fba17b1bc503bf447f06bfa2744ec78e31aa515", "url": "https://github.com/Graylog2/graylog2-server/commit/6fba17b1bc503bf447f06bfa2744ec78e31aa515", "message": "remove withHideOnCloud HOCs", "committedDate": "2020-11-11T15:48:03Z", "type": "commit"}, {"oid": "0caba56051efcd828cb1124a621f13e4ca1169ec", "url": "https://github.com/Graylog2/graylog2-server/commit/0caba56051efcd828cb1124a621f13e4ca1169ec", "message": "whoops, typo", "committedDate": "2020-11-11T15:49:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDA0Njk1OA==", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#discussion_r524046958", "bodyText": "These three lines have an eslint error:\nESLint: Missing parentheses around multilines JSX(react/jsx-wrap-multilines)", "author": "edmundoa", "createdAt": "2020-11-16T09:51:20Z", "path": "graylog2-web-interface/src/routing/AppRouter.jsx", "diffHunk": "@@ -162,12 +165,15 @@ const AppRouter = () => {\n                      component={EditContentPackPage} />\n               <Route path={Routes.SYSTEM.CONTENTPACKS.show(':contentPackId')} component={ShowContentPackPage} />\n               <Route path={Routes.SYSTEM.GROKPATTERNS} component={GrokPatternsPage} />\n-              <Route path={Routes.SYSTEM.INDICES.LIST} component={IndicesPage} />\n-              <Route path={Routes.SYSTEM.INDEX_SETS.CREATE} component={IndexSetCreationPage} />\n-              <Route path={Routes.SYSTEM.INDEX_SETS.SHOW(':indexSetId')} component={IndexSetPage} />\n-              <Route path={Routes.SYSTEM.INDEX_SETS.CONFIGURATION(':indexSetId')}\n-                     component={IndexSetConfigurationPage} />\n-              <Route path={Routes.SYSTEM.INDICES.FAILURES} component={IndexerFailuresPage} />\n+\n+              {!isCloud && <Route path={Routes.SYSTEM.INDEX_SETS.CREATE}\n+                                  component={IndexSetCreationPage} />}\n+              {!isCloud && <Route path={Routes.SYSTEM.INDEX_SETS.SHOW(':indexSetId')}\n+                                  component={IndexSetPage} />}\n+              {!isCloud && <Route path={Routes.SYSTEM.INDEX_SETS.CONFIGURATION(':indexSetId')}", "originalCommit": "0caba56051efcd828cb1124a621f13e4ca1169ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDExNTIxNA==", "url": "https://github.com/Graylog2/graylog2-server/pull/9423#discussion_r524115214", "bodyText": "Good catch. I improved that part and grouped the routes into one fragment", "author": "Gaya", "createdAt": "2020-11-16T10:52:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDA0Njk1OA=="}], "type": "inlineReview"}, {"oid": "48b444762ecaee79206efbb9afa3ca1cb5b84a42", "url": "https://github.com/Graylog2/graylog2-server/commit/48b444762ecaee79206efbb9afa3ca1cb5b84a42", "message": "fix eslint and group routes to hide on cloud", "committedDate": "2020-11-16T10:51:57Z", "type": "commit"}]}