{"pr_number": 9316, "pr_title": "Fail graciously when cannot get node metrics", "pr_createdAt": "2020-10-30T11:42:44Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/9316", "timeline": [{"oid": "e9d758210b581f7fce3df74780082dff893b5aee", "url": "https://github.com/Graylog2/graylog2-server/commit/e9d758210b581f7fce3df74780082dff893b5aee", "message": "Fail graciously when cannot get node metrics\n\nEnsure we can load the node metrics page, also when it was not possible\ngetting node metrics.\n\nFixes #9315", "committedDate": "2020-11-03T09:12:30Z", "type": "commit"}, {"oid": "e9d758210b581f7fce3df74780082dff893b5aee", "url": "https://github.com/Graylog2/graylog2-server/commit/e9d758210b581f7fce3df74780082dff893b5aee", "message": "Fail graciously when cannot get node metrics\n\nEnsure we can load the node metrics page, also when it was not possible\ngetting node metrics.\n\nFixes #9315", "committedDate": "2020-11-03T09:12:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg==", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r516659812", "bodyText": "We are returning error from the promise handler there. Do we want to make use of that in the error handling part of the ShowMetricsPage and show the error there?", "author": "dennisoelkers", "createdAt": "2020-11-03T13:20:06Z", "path": "graylog2-web-interface/src/stores/metrics/MetricsStore.js", "diffHunk": "@@ -169,6 +170,11 @@ const MetricsStore = Reflux.createStore({\n \n       return fetch('GET', url).then((response) => {\n         return { nodeId: nodeId, names: response.metrics };\n+      }, (error) => {\n+        UserNotification.error(`Fetching metrics for node [${nodeId}] failed with: ${error}.`,\n+          'Could not fetch node metrics');\n+        // When fetching metrics fails, keep previous available metrics around, letting user see them\n+        return { nodeId: nodeId, names: this.metricsNames[nodeId], error: error };", "originalCommit": "e9d758210b581f7fce3df74780082dff893b5aee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY3MDg5Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r516670897", "bodyText": "I guess we could replace the toastr error notification with something less annoying, will take a quick look \ud83d\udc4d", "author": "edmundoa", "createdAt": "2020-11-03T13:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI4ODg2NA==", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r517288864", "bodyText": "@dennisoelkers I reworked the UI a bit to display a text error next to the filter, instead of possibly multiple toaster notifications. I'll re-request for your review, let me know what you think :)", "author": "edmundoa", "createdAt": "2020-11-04T11:50:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMwNzYzOQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r517307639", "bodyText": "When I am going to the node metrics page with your patch applied, I end up here (ShowMetricsPage.jsx:66), which does not show the error message of the error that occurred. Maybe we should centralize error handling in one of the two components (ShowMetricsPage vs. MetricsComponent) instead of doing it in both?", "author": "dennisoelkers", "createdAt": "2020-11-04T12:27:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMxNjI4NA==", "url": "https://github.com/Graylog2/graylog2-server/pull/9316#discussion_r517316284", "bodyText": "I think you refer to the change in the page header for ShowMetricsPage (the link takes me somewhere else, somehow). I was thinking about putting the error message in the page header, but decided against it since it may take quite a bit of space and the error message will be displayed below anyway.\nRight now all of the error handling is done in MetricsComponent, since it's the component rendering the page content and seemed cleaner that way (less imports and need to move stuff around). The only exception is the page header in ShowMetricsPage, and only because we indicate the number of metrics the node is reporting.", "author": "edmundoa", "createdAt": "2020-11-04T12:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1OTgxMg=="}], "type": "inlineReview"}, {"oid": "348346cd989b903c0b1a8bb2d98073ba47877d80", "url": "https://github.com/Graylog2/graylog2-server/commit/348346cd989b903c0b1a8bb2d98073ba47877d80", "message": "Improve feedback when cannot fetch metrics\n\nWhen the web interface cannot get node metrics, avoid using excessive\ntoastr notifications, and replace them with something more useful. Also\nensure the contents don't jump, avoiding users to lose track of metrics\nthey may be observing.", "committedDate": "2020-11-04T11:46:51Z", "type": "commit"}, {"oid": "fe6128749d26b50dc3b9e224f818efdec251500d", "url": "https://github.com/Graylog2/graylog2-server/commit/fe6128749d26b50dc3b9e224f818efdec251500d", "message": "Use right property to get colors", "committedDate": "2020-11-04T13:21:20Z", "type": "commit"}, {"oid": "2be51283075c55f85453b73fd0dcbde182afc33d", "url": "https://github.com/Graylog2/graylog2-server/commit/2be51283075c55f85453b73fd0dcbde182afc33d", "message": "Display error and make text clearer", "committedDate": "2020-11-04T13:21:34Z", "type": "commit"}, {"oid": "938a679b9bcf0446cdce6d2fc78a17dbfd26d9bf", "url": "https://github.com/Graylog2/graylog2-server/commit/938a679b9bcf0446cdce6d2fc78a17dbfd26d9bf", "message": "Remove error handling from ShowMetricsPage", "committedDate": "2020-11-04T13:28:35Z", "type": "commit"}]}