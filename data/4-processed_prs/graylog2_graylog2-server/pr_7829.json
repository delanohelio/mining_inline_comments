{"pr_number": 7829, "pr_title": "Improve triggering search executions from search bar.", "pr_createdAt": "2020-04-03T15:22:30Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/7829", "timeline": [{"oid": "792e2f3288d123de4d712790747ebb69ed2901fc", "url": "https://github.com/Graylog2/graylog2-server/commit/792e2f3288d123de4d712790747ebb69ed2901fc", "message": "Updating `ace-builds` to 1.4.9.", "committedDate": "2020-04-07T11:55:21Z", "type": "forcePushed"}, {"oid": "bb2d44af0720a95cf0ea284bc7303a56949b684a", "url": "https://github.com/Graylog2/graylog2-server/commit/bb2d44af0720a95cf0ea284bc7303a56949b684a", "message": "Fixing tests for `AbsoluteTimeRangeSelector`.", "committedDate": "2020-04-07T14:49:36Z", "type": "forcePushed"}, {"oid": "560a0ba83bee054b0af52107fc23a2280235a4f8", "url": "https://github.com/Graylog2/graylog2-server/commit/560a0ba83bee054b0af52107fc23a2280235a4f8", "message": "Changing relative time range does not execute search.", "committedDate": "2020-04-14T12:14:03Z", "type": "forcePushed"}, {"oid": "841e891f78cc3b4c5aa5c749efe13c4631018949", "url": "https://github.com/Graylog2/graylog2-server/commit/841e891f78cc3b4c5aa5c749efe13c4631018949", "message": "Changing relative time range does not execute search.", "committedDate": "2020-04-15T14:14:59Z", "type": "forcePushed"}, {"oid": "cea25d4b47af90646704ff825d59e420e966c69d", "url": "https://github.com/Graylog2/graylog2-server/commit/cea25d4b47af90646704ff825d59e420e966c69d", "message": "Returning promise in onChange handlers to prevent exception.", "committedDate": "2020-04-15T15:07:12Z", "type": "forcePushed"}, {"oid": "07016a0ec018fda96775cbb3782ca6ca2e122595", "url": "https://github.com/Graylog2/graylog2-server/commit/07016a0ec018fda96775cbb3782ca6ca2e122595", "message": "Cache timerange state in `SearchBar` component.", "committedDate": "2020-04-16T08:02:38Z", "type": "commit"}, {"oid": "ae58ba2a4e5016055c9a7d85f684fe8d06401a93", "url": "https://github.com/Graylog2/graylog2-server/commit/ae58ba2a4e5016055c9a7d85f684fe8d06401a93", "message": "Reusing `filtersToStreamSet`.", "committedDate": "2020-04-16T08:02:38Z", "type": "commit"}, {"oid": "2b0ecb2669e9f694a121ae266d82ddfc84b62f97", "url": "https://github.com/Graylog2/graylog2-server/commit/2b0ecb2669e9f694a121ae266d82ddfc84b62f97", "message": "Adding `onSubmit` to time range inputs.", "committedDate": "2020-04-16T08:02:39Z", "type": "commit"}, {"oid": "e6c7f246651b23a743b4ad32e259f690a461cd8c", "url": "https://github.com/Graylog2/graylog2-server/commit/e6c7f246651b23a743b4ad32e259f690a461cd8c", "message": "Performing search only when pressing enter in absolute time range input.", "committedDate": "2020-04-16T08:02:39Z", "type": "commit"}, {"oid": "7e26dfa3ca23cb19de87c1a6ebe739af564cad14", "url": "https://github.com/Graylog2/graylog2-server/commit/7e26dfa3ca23cb19de87c1a6ebe739af564cad14", "message": "Extracting reducer function.", "committedDate": "2020-04-16T08:02:39Z", "type": "commit"}, {"oid": "4b2a2bc1968a41dcd03421d35e1c749ca483c1f1", "url": "https://github.com/Graylog2/graylog2-server/commit/4b2a2bc1968a41dcd03421d35e1c749ca483c1f1", "message": "Making keyword input only submit when pressing enter.", "committedDate": "2020-04-16T08:02:39Z", "type": "commit"}, {"oid": "be765aad4788953e2e9badb7958cc3b5ca3d11b9", "url": "https://github.com/Graylog2/graylog2-server/commit/be765aad4788953e2e9badb7958cc3b5ca3d11b9", "message": "Replacing custom form logic with formik.", "committedDate": "2020-04-16T08:02:39Z", "type": "commit"}, {"oid": "342b839ed3a1842d8715b18e65c6257214c2c188", "url": "https://github.com/Graylog2/graylog2-server/commit/342b839ed3a1842d8715b18e65c6257214c2c188", "message": "Wrapping controls in one formik instance.", "committedDate": "2020-04-16T08:02:39Z", "type": "commit"}, {"oid": "c11a09eca961ff03bad9c8de6387068981c04ab1", "url": "https://github.com/Graylog2/graylog2-server/commit/c11a09eca961ff03bad9c8de6387068981c04ab1", "message": "Fixing relative type and active handling.", "committedDate": "2020-04-16T08:02:39Z", "type": "commit"}, {"oid": "7febb42a5c77e1d6ebeb20d9843e8622d6cd611f", "url": "https://github.com/Graylog2/graylog2-server/commit/7febb42a5c77e1d6ebeb20d9843e8622d6cd611f", "message": "Correcting return type for `onSubmit`.", "committedDate": "2020-04-16T08:02:39Z", "type": "commit"}, {"oid": "a69ab84363ee8e19a81da3ad7cf464a240be592e", "url": "https://github.com/Graylog2/graylog2-server/commit/a69ab84363ee8e19a81da3ad7cf464a240be592e", "message": "Widening parameter type for builder method.", "committedDate": "2020-04-16T08:02:39Z", "type": "commit"}, {"oid": "fee658f945262f593df18ca42b5264ad9b08be8e", "url": "https://github.com/Graylog2/graylog2-server/commit/fee658f945262f593df18ca42b5264ad9b08be8e", "message": "Minor fixes.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "8810769074521ffa7ee0305e30c1d3b7c2339263", "url": "https://github.com/Graylog2/graylog2-server/commit/8810769074521ffa7ee0305e30c1d3b7c2339263", "message": "Moving render prop to children.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "f62b1e54ea3aaa9e23fd8ddd10b32d0423124b6a", "url": "https://github.com/Graylog2/graylog2-server/commit/f62b1e54ea3aaa9e23fd8ddd10b32d0423124b6a", "message": "Wiring `WidgetQueryControls` again.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "e1b3967c99e9e1df1eb0ccdddf54775af778dd75", "url": "https://github.com/Graylog2/graylog2-server/commit/e1b3967c99e9e1df1eb0ccdddf54775af778dd75", "message": "Removing unused id.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "a5b65c86cff418eacb06a01bc3df3fbd1cb4b78c", "url": "https://github.com/Graylog2/graylog2-server/commit/a5b65c86cff418eacb06a01bc3df3fbd1cb4b78c", "message": "Consolidating form boilerplate in `SearchBarForm`.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "5a213637c648e16af8aaa0e04ca643552db4baa7", "url": "https://github.com/Graylog2/graylog2-server/commit/5a213637c648e16af8aaa0e04ca643552db4baa7", "message": "Allow updating initial values.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "d09e06ef207050e4f6308418082f880deee6dcea", "url": "https://github.com/Graylog2/graylog2-server/commit/d09e06ef207050e4f6308418082f880deee6dcea", "message": "Adding `dirty` indicator to search button`.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "d64b53edcd18b9df58d1759fc16f7ff1929fa90b", "url": "https://github.com/Graylog2/graylog2-server/commit/d64b53edcd18b9df58d1759fc16f7ff1929fa90b", "message": "Adding workaround for field validation.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "1a4fdc98682ec476568b17bd47def8e70d1b8e2e", "url": "https://github.com/Graylog2/graylog2-server/commit/1a4fdc98682ec476568b17bd47def8e70d1b8e2e", "message": "Fixing linter hints.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "0ebac76dc444a3e60a6afc0cc2e7ff045b7a3b54", "url": "https://github.com/Graylog2/graylog2-server/commit/0ebac76dc444a3e60a6afc0cc2e7ff045b7a3b54", "message": "Fixing flow hints.", "committedDate": "2020-04-16T08:02:40Z", "type": "commit"}, {"oid": "e74f8915ef0496d72c96c67fe8d1e2a7e32df23d", "url": "https://github.com/Graylog2/graylog2-server/commit/e74f8915ef0496d72c96c67fe8d1e2a7e32df23d", "message": "Updating snapshots.", "committedDate": "2020-04-16T08:03:06Z", "type": "commit"}, {"oid": "4fa574347a2007511a92061e959f87fc8aced574", "url": "https://github.com/Graylog2/graylog2-server/commit/4fa574347a2007511a92061e959f87fc8aced574", "message": "Removing now unneeded eslint directive.", "committedDate": "2020-04-16T08:03:09Z", "type": "commit"}, {"oid": "67003d08ec445e2f0153f80ddb48e2f10da63b07", "url": "https://github.com/Graylog2/graylog2-server/commit/67003d08ec445e2f0153f80ddb48e2f10da63b07", "message": "Updating tests for `KeywordTimeRangeSelector`.", "committedDate": "2020-04-16T08:03:09Z", "type": "commit"}, {"oid": "2741367d06c9340d6fc76fa0ce5d8c68a5e98d96", "url": "https://github.com/Graylog2/graylog2-server/commit/2741367d06c9340d6fc76fa0ce5d8c68a5e98d96", "message": "Updating `ace-builds` to 1.4.9.", "committedDate": "2020-04-16T08:03:09Z", "type": "commit"}, {"oid": "fc77d323cc37830fc029a2d7b851e431a18ff1ca", "url": "https://github.com/Graylog2/graylog2-server/commit/fc77d323cc37830fc029a2d7b851e431a18ff1ca", "message": "Updating `WidgetQueryControls` tests.", "committedDate": "2020-04-16T08:03:09Z", "type": "commit"}, {"oid": "07c0f6e27ab2d4d0f8dab58f0e065bb1efa97ea0", "url": "https://github.com/Graylog2/graylog2-server/commit/07c0f6e27ab2d4d0f8dab58f0e065bb1efa97ea0", "message": "Allowing to pass optional `onSubmit` prop.", "committedDate": "2020-04-16T08:03:09Z", "type": "commit"}, {"oid": "3b7d734ec031d221066d3e890d63d6d34f113f98", "url": "https://github.com/Graylog2/graylog2-server/commit/3b7d734ec031d221066d3e890d63d6d34f113f98", "message": "Fixing `SearchBar` test.", "committedDate": "2020-04-16T08:03:09Z", "type": "commit"}, {"oid": "2576214898671ff33a0fe8548c9d5b5de280a5f7", "url": "https://github.com/Graylog2/graylog2-server/commit/2576214898671ff33a0fe8548c9d5b5de280a5f7", "message": "Using consistent format for timestamps in `DateInputWithPicker`.", "committedDate": "2020-04-16T08:03:09Z", "type": "commit"}, {"oid": "a86a109d1bd900253e117502d400cc1e7c85463c", "url": "https://github.com/Graylog2/graylog2-server/commit/a86a109d1bd900253e117502d400cc1e7c85463c", "message": "Adding ids to elements in `DateInputWithPicker`.", "committedDate": "2020-04-16T08:03:09Z", "type": "commit"}, {"oid": "8e11046a007edc62c78e8a37c59bb251bc2571f5", "url": "https://github.com/Graylog2/graylog2-server/commit/8e11046a007edc62c78e8a37c59bb251bc2571f5", "message": "Typing and reordering validation function in `KeywordTimeRangeSelector`.", "committedDate": "2020-04-16T08:03:10Z", "type": "commit"}, {"oid": "c8ab7ec87293507f348c8f0db13cbcffac9e3d5f", "url": "https://github.com/Graylog2/graylog2-server/commit/c8ab7ec87293507f348c8f0db13cbcffac9e3d5f", "message": "Making tests for `KeywordTimeRangeSelector` handle asynchronicity.", "committedDate": "2020-04-16T08:03:10Z", "type": "commit"}, {"oid": "9b131dfe9424323d3cce3abca314904b5cfd6023", "url": "https://github.com/Graylog2/graylog2-server/commit/9b131dfe9424323d3cce3abca314904b5cfd6023", "message": "Extracting onChange function in `RelativeTimeRangeSelector`.", "committedDate": "2020-04-16T08:03:10Z", "type": "commit"}, {"oid": "5355f50d0deabe020929f72d2607c47cf1f4565b", "url": "https://github.com/Graylog2/graylog2-server/commit/5355f50d0deabe020929f72d2607c47cf1f4565b", "message": "Turning `range` parameter into number when submitting.", "committedDate": "2020-04-16T08:03:10Z", "type": "commit"}, {"oid": "b8e0dc5e39cd05495a06296a8dcdcab17a0e0f8e", "url": "https://github.com/Graylog2/graylog2-server/commit/b8e0dc5e39cd05495a06296a8dcdcab17a0e0f8e", "message": "Adding id to dropdown button element in `TimeRangeTypeSelector`.", "committedDate": "2020-04-16T08:03:10Z", "type": "commit"}, {"oid": "ffb8cf185403b17c83aa077827fac0d2f9998e60", "url": "https://github.com/Graylog2/graylog2-server/commit/ffb8cf185403b17c83aa077827fac0d2f9998e60", "message": "Fixing tests for `AbsoluteTimeRangeSelector`.", "committedDate": "2020-04-16T08:03:10Z", "type": "commit"}, {"oid": "55f410b85113f4f3244ac9803937b4d78d3805fe", "url": "https://github.com/Graylog2/graylog2-server/commit/55f410b85113f4f3244ac9803937b4d78d3805fe", "message": "Validating upon mount.", "committedDate": "2020-04-16T08:03:11Z", "type": "commit"}, {"oid": "f1aaaffda7e1d221138ee8c513364bf9d4b3993c", "url": "https://github.com/Graylog2/graylog2-server/commit/f1aaaffda7e1d221138ee8c513364bf9d4b3993c", "message": "Parse integer in `RelativeTimeRangeSelector` already.", "committedDate": "2020-04-16T08:03:11Z", "type": "commit"}, {"oid": "91497a922ed2792ce3c18406a48a2d92d91628d6", "url": "https://github.com/Graylog2/graylog2-server/commit/91497a922ed2792ce3c18406a48a2d92d91628d6", "message": "Adding missing comma.", "committedDate": "2020-04-16T08:03:11Z", "type": "commit"}, {"oid": "c816cb696e1a5995deae1c078e32b4a1195f0a02", "url": "https://github.com/Graylog2/graylog2-server/commit/c816cb696e1a5995deae1c078e32b4a1195f0a02", "message": "Fixing flow hints.", "committedDate": "2020-04-16T08:03:11Z", "type": "commit"}, {"oid": "178c03e4e36f1decaf82d7cae1c70a17aabdac7d", "url": "https://github.com/Graylog2/graylog2-server/commit/178c03e4e36f1decaf82d7cae1c70a17aabdac7d", "message": "Check if defined to satisfy flow.", "committedDate": "2020-04-16T08:03:11Z", "type": "commit"}, {"oid": "6078f1d59870d58daf8aac2786fbd40ff809d47b", "url": "https://github.com/Graylog2/graylog2-server/commit/6078f1d59870d58daf8aac2786fbd40ff809d47b", "message": "Updating formik typedef.", "committedDate": "2020-04-16T08:03:11Z", "type": "commit"}, {"oid": "08101f029aea97d53ec5efa1a9c302e3eb40a55f", "url": "https://github.com/Graylog2/graylog2-server/commit/08101f029aea97d53ec5efa1a9c302e3eb40a55f", "message": "Unifying date string handling for absolute time range input.", "committedDate": "2020-04-16T08:03:11Z", "type": "commit"}, {"oid": "a505ab224e2002870f53c5735f78d63e45b22be7", "url": "https://github.com/Graylog2/graylog2-server/commit/a505ab224e2002870f53c5735f78d63e45b22be7", "message": "Making react-ace testable.", "committedDate": "2020-04-16T08:03:11Z", "type": "commit"}, {"oid": "afb021d6bb4339509e3a88d29f7b29db2759e84f", "url": "https://github.com/Graylog2/graylog2-server/commit/afb021d6bb4339509e3a88d29f7b29db2759e84f", "message": "Add action to set new timerange & query for global override together.", "committedDate": "2020-04-16T08:03:11Z", "type": "commit"}, {"oid": "dee08251c47aa6b23d3a7671f99b52dfcfd125cb", "url": "https://github.com/Graylog2/graylog2-server/commit/dee08251c47aa6b23d3a7671f99b52dfcfd125cb", "message": "Set timerange & query together from `DashboardSearchBar`.", "committedDate": "2020-04-16T08:03:12Z", "type": "commit"}, {"oid": "860059cded1303f73c0c47ed28e445781d161c54", "url": "https://github.com/Graylog2/graylog2-server/commit/860059cded1303f73c0c47ed28e445781d161c54", "message": "Add dirty flags to search buttons.", "committedDate": "2020-04-16T08:03:12Z", "type": "commit"}, {"oid": "92a0bdaa2dde5b1ef03afb0d09f7642f77251fab", "url": "https://github.com/Graylog2/graylog2-server/commit/92a0bdaa2dde5b1ef03afb0d09f7642f77251fab", "message": "Removing now unneeded ace setting.", "committedDate": "2020-04-16T08:03:12Z", "type": "commit"}, {"oid": "968d9688ca2d82d3e0905be841e0991a87f6de39", "url": "https://github.com/Graylog2/graylog2-server/commit/968d9688ca2d82d3e0905be841e0991a87f6de39", "message": "Inlining field handling, extracting timerange migration function.", "committedDate": "2020-04-16T08:03:12Z", "type": "commit"}, {"oid": "7f96fb9edde563f6625f4559e1e23f52a73ae6a5", "url": "https://github.com/Graylog2/graylog2-server/commit/7f96fb9edde563f6625f4559e1e23f52a73ae6a5", "message": "Adding tests for `DashboardSearchForm`.", "committedDate": "2020-04-16T08:03:12Z", "type": "commit"}, {"oid": "dd9d4e4f43cafbd2affcd125449eb3c7d48140f3", "url": "https://github.com/Graylog2/graylog2-server/commit/dd9d4e4f43cafbd2affcd125449eb3c7d48140f3", "message": "Fixing linter hints.", "committedDate": "2020-04-16T08:03:12Z", "type": "commit"}, {"oid": "95ed22d2da59aa485625f7c1fccc589431f30936", "url": "https://github.com/Graylog2/graylog2-server/commit/95ed22d2da59aa485625f7c1fccc589431f30936", "message": "Removing unused store actions.", "committedDate": "2020-04-16T08:03:12Z", "type": "commit"}, {"oid": "bf5639f4cb3909ddde26fe08937e6a8ec7b8f513", "url": "https://github.com/Graylog2/graylog2-server/commit/bf5639f4cb3909ddde26fe08937e6a8ec7b8f513", "message": "Adding tests for `DateInputWithPicker`.", "committedDate": "2020-04-16T08:03:12Z", "type": "commit"}, {"oid": "29b467308c6bb9fcda19cfa87844d6803e83bc26", "url": "https://github.com/Graylog2/graylog2-server/commit/29b467308c6bb9fcda19cfa87844d6803e83bc26", "message": "Fixing linter hints.", "committedDate": "2020-04-16T08:03:13Z", "type": "commit"}, {"oid": "1c47b834df199c0402d3845acc2e50b3e5585a60", "url": "https://github.com/Graylog2/graylog2-server/commit/1c47b834df199c0402d3845acc2e50b3e5585a60", "message": "Change test title.", "committedDate": "2020-04-16T08:03:13Z", "type": "commit"}, {"oid": "e04aa96bb3ed9dc0bbfcc86a31ba3768bf43caa6", "url": "https://github.com/Graylog2/graylog2-server/commit/e04aa96bb3ed9dc0bbfcc86a31ba3768bf43caa6", "message": "Consider timezone in tests.", "committedDate": "2020-04-16T08:03:13Z", "type": "commit"}, {"oid": "94f7d213076ea5c89dba623eac33e971bbaf036b", "url": "https://github.com/Graylog2/graylog2-server/commit/94f7d213076ea5c89dba623eac33e971bbaf036b", "message": "Fixing the expectation.", "committedDate": "2020-04-16T08:03:13Z", "type": "commit"}, {"oid": "c47448a5f641b823dd023186082ed652b6cc4809", "url": "https://github.com/Graylog2/graylog2-server/commit/c47448a5f641b823dd023186082ed652b6cc4809", "message": "Changing relative time range does not execute search.", "committedDate": "2020-04-16T08:03:13Z", "type": "commit"}, {"oid": "98892582d3d72cabdcbbbf2652f08b4c097d4ace", "url": "https://github.com/Graylog2/graylog2-server/commit/98892582d3d72cabdcbbbf2652f08b4c097d4ace", "message": "Returning promise in onChange handlers to prevent exception.", "committedDate": "2020-04-16T08:03:13Z", "type": "commit"}, {"oid": "1dc43f51b0ce679f6d7e33f0f66ed2b6a51170e0", "url": "https://github.com/Graylog2/graylog2-server/commit/1dc43f51b0ce679f6d7e33f0f66ed2b6a51170e0", "message": "Updating snapshots after rebase.", "committedDate": "2020-04-16T08:39:55Z", "type": "commit"}, {"oid": "423cf9f52d54c790237edf67430f89b85360f332", "url": "https://github.com/Graylog2/graylog2-server/commit/423cf9f52d54c790237edf67430f89b85360f332", "message": "Fixing sync with query parameters.", "committedDate": "2020-04-16T09:07:17Z", "type": "commit"}, {"oid": "9545526c61e75471bebf803242d336cc0d006fef", "url": "https://github.com/Graylog2/graylog2-server/commit/9545526c61e75471bebf803242d336cc0d006fef", "message": "Replacing deprecated glyph names.", "committedDate": "2020-04-16T09:26:51Z", "type": "commit"}, {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "url": "https://github.com/Graylog2/graylog2-server/commit/1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "message": "Updating test for `useSyncWithQueryParameters`.", "committedDate": "2020-04-16T09:43:00Z", "type": "commit"}, {"oid": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "url": "https://github.com/Graylog2/graylog2-server/commit/1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "message": "Updating test for `useSyncWithQueryParameters`.", "committedDate": "2020-04-16T09:43:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4NDA2Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409484067", "bodyText": "values can be typed as well.", "author": "linuspahl", "createdAt": "2020-04-16T11:29:57Z", "path": "graylog2-web-interface/src/views/components/WidgetQueryControls.jsx", "diffHunk": "@@ -105,56 +68,77 @@ const ResetOverrideHint = () => (\n   </CenteredBox>\n );\n \n+const onSubmit = (values, widget: Widget) => {", "originalCommit": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4NjM3Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409486377", "bodyText": "The propTypes can be removed.", "author": "linuspahl", "createdAt": "2020-04-16T11:34:34Z", "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeOverrideTypeSelector.jsx", "diffHunk": "@@ -1,42 +1,48 @@\n-import React from 'react';\n+// @flow strict\n+import * as React from 'react';\n+import { useCallback } from 'react';\n+import { useField } from 'formik';\n \n import { ButtonToolbar, DropdownButton, MenuItem } from 'components/graylog';\n import { Icon } from 'components/common';\n-import PropTypes from 'views/components/CustomPropTypes';\n+import { migrateTimeRangeToNewType } from '../TimerangeForForm';\n \n-const TimeRangeOverrideTypeSelector = ({ onSelect, value }) => (\n-  <ButtonToolbar className=\"extended-search-timerange-chooser pull-left\">\n-    <DropdownButton bsStyle=\"info\"\n-                    title={<Icon name=\"clock-o\" />}\n-                    onSelect={onSelect}\n-                    id=\"dropdown-timerange-selector\">\n-      <MenuItem eventKey=\"disabled\"\n-                active={value === undefined}>\n-        No Override\n-      </MenuItem>\n-      <MenuItem eventKey=\"relative\"\n-                active={value === 'relative'}>\n-        Relative\n-      </MenuItem>\n-      <MenuItem eventKey=\"absolute\"\n-                active={value === 'absolute'}>\n-        Absolute\n-      </MenuItem>\n-      <MenuItem eventKey=\"keyword\"\n-                active={value === 'keyword'}>\n-        Keyword\n-      </MenuItem>\n-    </DropdownButton>\n-  </ButtonToolbar>\n-);\n-\n-TimeRangeOverrideTypeSelector.propTypes = {\n-  onSelect: PropTypes.func.isRequired,\n-  value: PropTypes.TimeRangeType,\n+const TimeRangeOverrideTypeSelector = () => {\n+  const [{ value, onChange, name }] = useField('timerange');\n+  const { type } = value || {};\n+  const onSelect = useCallback((newType) => onChange({\n+    target: {\n+      value: migrateTimeRangeToNewType(value, newType),\n+      name,\n+    },\n+  }), [onChange, value]);\n+  return (\n+    <ButtonToolbar className=\"extended-search-timerange-chooser pull-left\">\n+      <DropdownButton bsStyle=\"info\"\n+                      title={<Icon name=\"clock\" />}\n+                      onSelect={onSelect}\n+                      id=\"dropdown-timerange-selector\">\n+        <MenuItem eventKey=\"disabled\"\n+                  active={type === undefined}>\n+          No Override\n+        </MenuItem>\n+        <MenuItem eventKey=\"relative\"\n+                  active={type === 'relative'}>\n+          Relative\n+        </MenuItem>\n+        <MenuItem eventKey=\"absolute\"\n+                  active={type === 'absolute'}>\n+          Absolute\n+        </MenuItem>\n+        <MenuItem eventKey=\"keyword\"\n+                  active={type === 'keyword'}>\n+          Keyword\n+        </MenuItem>\n+      </DropdownButton>\n+    </ButtonToolbar>\n+  );\n };\n \n-TimeRangeOverrideTypeSelector.defaultProps = {\n-  value: undefined,\n-};\n+TimeRangeOverrideTypeSelector.propTypes = {};", "originalCommit": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYxNzg5OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409617899", "bodyText": "\u2705", "author": "dennisoelkers", "createdAt": "2020-04-16T14:48:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4NjM3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4ODE5Mg==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409488192", "bodyText": "We could extract the default options relative, absolute and keyword in a component which can be used for TimeRangeOverrideTypeSelector and TimeRangeTypeSelector", "author": "linuspahl", "createdAt": "2020-04-16T11:38:14Z", "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeOverrideTypeSelector.jsx", "diffHunk": "@@ -1,42 +1,48 @@\n-import React from 'react';\n+// @flow strict\n+import * as React from 'react';\n+import { useCallback } from 'react';\n+import { useField } from 'formik';\n \n import { ButtonToolbar, DropdownButton, MenuItem } from 'components/graylog';\n import { Icon } from 'components/common';\n-import PropTypes from 'views/components/CustomPropTypes';\n+import { migrateTimeRangeToNewType } from '../TimerangeForForm';\n \n-const TimeRangeOverrideTypeSelector = ({ onSelect, value }) => (\n-  <ButtonToolbar className=\"extended-search-timerange-chooser pull-left\">\n-    <DropdownButton bsStyle=\"info\"\n-                    title={<Icon name=\"clock-o\" />}\n-                    onSelect={onSelect}\n-                    id=\"dropdown-timerange-selector\">\n-      <MenuItem eventKey=\"disabled\"\n-                active={value === undefined}>\n-        No Override\n-      </MenuItem>\n-      <MenuItem eventKey=\"relative\"\n-                active={value === 'relative'}>\n-        Relative\n-      </MenuItem>\n-      <MenuItem eventKey=\"absolute\"\n-                active={value === 'absolute'}>\n-        Absolute\n-      </MenuItem>\n-      <MenuItem eventKey=\"keyword\"\n-                active={value === 'keyword'}>\n-        Keyword\n-      </MenuItem>\n-    </DropdownButton>\n-  </ButtonToolbar>\n-);\n-\n-TimeRangeOverrideTypeSelector.propTypes = {\n-  onSelect: PropTypes.func.isRequired,\n-  value: PropTypes.TimeRangeType,\n+const TimeRangeOverrideTypeSelector = () => {\n+  const [{ value, onChange, name }] = useField('timerange');\n+  const { type } = value || {};\n+  const onSelect = useCallback((newType) => onChange({\n+    target: {\n+      value: migrateTimeRangeToNewType(value, newType),\n+      name,\n+    },\n+  }), [onChange, value]);\n+  return (\n+    <ButtonToolbar className=\"extended-search-timerange-chooser pull-left\">\n+      <DropdownButton bsStyle=\"info\"\n+                      title={<Icon name=\"clock\" />}\n+                      onSelect={onSelect}\n+                      id=\"dropdown-timerange-selector\">\n+        <MenuItem eventKey=\"disabled\"\n+                  active={type === undefined}>\n+          No Override\n+        </MenuItem>\n+        <MenuItem eventKey=\"relative\"\n+                  active={type === 'relative'}>\n+          Relative\n+        </MenuItem>\n+        <MenuItem eventKey=\"absolute\"\n+                  active={type === 'absolute'}>\n+          Absolute\n+        </MenuItem>\n+        <MenuItem eventKey=\"keyword\"\n+                  active={type === 'keyword'}>\n+          Keyword\n+        </MenuItem>", "originalCommit": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYxNzgxOQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409617819", "bodyText": "\u2705", "author": "dennisoelkers", "createdAt": "2020-04-16T14:48:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4ODE5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MTYzOQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409491639", "bodyText": "This check is not really necessary, because timerangeStrategies[undefined] is falsy as well. Or do you just prefer being explicit?", "author": "linuspahl", "createdAt": "2020-04-16T11:44:51Z", "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeInput.jsx", "diffHunk": "@@ -1,31 +1,50 @@\n-import React from 'react';\n+// @flow strict\n+import * as React from 'react';\n import PropTypes from 'prop-types';\n+import { useField } from 'formik';\n \n-import RelativeTimeRangeSelector from 'views/components/searchbar/RelativeTimeRangeSelector';\n+import type { SearchesConfig } from 'components/search/SearchConfig';\n import AbsoluteTimeRangeSelector from 'views/components/searchbar/AbsoluteTimeRangeSelector';\n import KeywordTimeRangeSelector from 'views/components/searchbar/KeywordTimeRangeSelector';\n+import RelativeTimeRangeSelector from 'views/components/searchbar/RelativeTimeRangeSelector';\n+import DisabledTimeRangeSelector from './DisabledTimeRangeSelector';\n \n-export default function TimeRangeInput({ disabled, rangeType, rangeParams, config, onChange }) {\n-  switch (rangeType) {\n-    case 'relative':\n-      return <RelativeTimeRangeSelector disabled={disabled} value={rangeParams} config={config} onChange={onChange} />;\n-    case 'absolute':\n-      return <AbsoluteTimeRangeSelector disabled={disabled} value={rangeParams} onChange={onChange} />;\n-    case 'keyword':\n-      return <KeywordTimeRangeSelector disabled={disabled} value={rangeParams} onChange={onChange} />;\n-    default:\n-      throw new Error(`Unsupported range type ${rangeType}`);\n+type Props = {\n+  disabled: boolean,\n+  config: SearchesConfig,\n+};\n+\n+const timerangeStrategies = {\n+  absolute: {\n+    component: AbsoluteTimeRangeSelector,\n+  },\n+  relative: {\n+    component: RelativeTimeRangeSelector,\n+  },\n+  keyword: {\n+    component: KeywordTimeRangeSelector,\n+  },\n+};\n+\n+const timerangeStrategy = (type) => {\n+  if (type === undefined) {\n+    return { component: DisabledTimeRangeSelector };\n   }", "originalCommit": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwMjU2Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409502566", "bodyText": "We can type the param type here as well.", "author": "linuspahl", "createdAt": "2020-04-16T12:05:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MTYzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYyMzk5MA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409623990", "bodyText": "\u2705", "author": "dennisoelkers", "createdAt": "2020-04-16T14:56:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MTYzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwNDc2OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409504769", "bodyText": "We are checking if the provided type exists in comparable cases, let's check it here as well.", "author": "linuspahl", "createdAt": "2020-04-16T12:09:29Z", "path": "graylog2-web-interface/src/views/components/TimerangeForForm.js", "diffHunk": "@@ -0,0 +1,66 @@\n+// @flow strict\n+import moment from 'moment';\n+\n+import DateTime from 'logic/datetimes/DateTime';\n+import type { TimeRange } from 'views/logic/queries/Query';\n+\n+const formatDatetime = (datetime) => datetime.toString(DateTime.Formats.TIMESTAMP);\n+\n+export const onSubmittingTimerange = (timerange: TimeRange): TimeRange => {\n+  switch (timerange.type) {\n+    case 'absolute':\n+      return {\n+        type: timerange.type,\n+        from: DateTime.parseFromString(timerange.from).toISOString(),\n+        to: DateTime.parseFromString(timerange.to).toISOString(),\n+      };\n+    case 'relative':\n+      return {\n+        type: timerange.type,\n+        range: timerange.range,\n+      };\n+    case 'keyword':\n+      return timerange;\n+    default: throw new Error(`Invalid time range type: ${timerange.type}`);\n+  }\n+};\n+\n+export const onInitializingTimerange = (timerange: TimeRange): TimeRange => {\n+  switch (timerange.type) {\n+    case 'absolute':\n+      return {\n+        type: timerange.type,\n+        from: formatDatetime(DateTime.parseFromString(timerange.from)),\n+        to: formatDatetime(DateTime.parseFromString(timerange.to)),\n+      };\n+    case 'relative':\n+      return {\n+        type: timerange.type,\n+        range: timerange.range,\n+      };\n+    case 'keyword':\n+      return timerange;\n+    default: throw new Error(`Invalid time range type: ${timerange.type}`);\n+  }\n+};\n+\n+const migrationStrategies = {\n+  absolute: (oldTimerange: ?TimeRange) => ({\n+    type: 'absolute',\n+    from: formatDatetime(new DateTime(moment().subtract((oldTimerange && oldTimerange.type === 'relative') ? oldTimerange.range : 300, 'seconds'))),\n+    to: formatDatetime(new DateTime(moment())),\n+  }),\n+  relative: () => ({ type: 'relative', range: 300 }),\n+  keyword: () => ({ type: 'keyword', keyword: 'Last five minutes' }),\n+  disabled: () => undefined,\n+};\n+\n+export const migrateTimeRangeToNewType = (oldTimerange: ?TimeRange, type: string): ?TimeRange => {\n+  const oldType = oldTimerange ? oldTimerange.type : 'disabled';\n+\n+  if (type === oldType) {\n+    return oldTimerange;\n+  }\n+\n+  return migrationStrategies[type](oldTimerange);", "originalCommit": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYxNDc4OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409614789", "bodyText": "\u2705", "author": "dennisoelkers", "createdAt": "2020-04-16T14:45:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwNDc2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwNzY2Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409507666", "bodyText": "Something for a follow up PR: We should add this color to our theme.", "author": "linuspahl", "createdAt": "2020-04-16T12:14:44Z", "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';\n \n-const SearchButton = ({ running, disabled, glyph }) => (\n-  <Button type=\"submit\" bsStyle={running ? 'warning' : 'success'} disabled={disabled} className=\"pull-left search-button-execute\">\n-    {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} /> }\n-  </Button>\n-);\n+const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`\n+  position: relative;\n+\n+  ::after {\n+    position: absolute;\n+    content: '';\n+    height: 16px;\n+    width: 16px;\n+    top: -5px;\n+    right: -6px;\n+    border-radius: 50%;\n+    background-color: #ffc107;", "originalCommit": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUxMTcwMA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409511700", "bodyText": "Not related to this PR, but we are never defining the running prop. Are we not using the button loading state, because of to the global loading indicator?", "author": "linuspahl", "createdAt": "2020-04-16T12:21:31Z", "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';\n \n-const SearchButton = ({ running, disabled, glyph }) => (\n-  <Button type=\"submit\" bsStyle={running ? 'warning' : 'success'} disabled={disabled} className=\"pull-left search-button-execute\">\n-    {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} /> }\n-  </Button>\n-);\n+const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`\n+  position: relative;\n+\n+  ::after {\n+    position: absolute;\n+    content: '';\n+    height: 16px;\n+    width: 16px;\n+    top: -5px;\n+    right: -6px;\n+    border-radius: 50%;\n+    background-color: #ffc107;\n+  }\n+`;\n+\n+type Props = {\n+  running: boolean,\n+  disabled: boolean,\n+  glyph: string,\n+  dirty: boolean,\n+};\n+\n+const SearchButton = ({ running, disabled, glyph, dirty }: Props) => {\n+  const ButtonComponent = dirty ? DirtyButton : Button;\n+  const title = dirty ? 'Perform search (changes were made after last search execution)' : 'Perform search';\n+  return (\n+    <ButtonComponent type=\"submit\"\n+                     bsStyle={running ? 'warning' : 'success'}\n+                     disabled={disabled}\n+                     title={title}\n+                     className=\"pull-left search-button-execute\">\n+      {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} />}", "originalCommit": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYyNTY0Mg==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409625642", "bodyText": "We never really used it, so I removed it.", "author": "dennisoelkers", "createdAt": "2020-04-16T14:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUxMTcwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUxNjU4OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409516589", "bodyText": "There is no immediate benefit, but any can be replaces with HTMLButtonElement", "author": "linuspahl", "createdAt": "2020-04-16T12:29:45Z", "path": "graylog2-web-interface/src/views/components/searchbar/SearchButton.jsx", "diffHunk": "@@ -1,24 +1,60 @@\n+// @flow strict\n import React from 'react';\n import PropTypes from 'prop-types';\n+import styled from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n \n import { Button } from 'components/graylog';\n import { Spinner, Icon } from 'components/common';\n+import type { ThemeInterface } from 'theme/index';\n \n-const SearchButton = ({ running, disabled, glyph }) => (\n-  <Button type=\"submit\" bsStyle={running ? 'warning' : 'success'} disabled={disabled} className=\"pull-left search-button-execute\">\n-    {running ? <Spinner fixedWidth pulse text=\"\" /> : <Icon name={glyph} /> }\n-  </Button>\n-);\n+const DirtyButton: StyledComponent<{}, ThemeInterface, any> = styled(Button)`", "originalCommit": "1ff2800a1843b1249e9b2ea555edcecaf29ad0bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYwNzg3Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7829#discussion_r409607877", "bodyText": "Actually there is, because if we make wrappedTestingLibrary return a properly typed function, we will need explicit element types in tests.", "author": "dennisoelkers", "createdAt": "2020-04-16T14:36:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUxNjU4OQ=="}], "type": "inlineReview"}, {"oid": "ceecead2158c750530a8fe46468a5572fb35f4d5", "url": "https://github.com/Graylog2/graylog2-server/commit/ceecead2158c750530a8fe46468a5572fb35f4d5", "message": "Removing obsolete `running` prop.", "committedDate": "2020-04-16T14:42:17Z", "type": "commit"}, {"oid": "74de1f26b5502a41217b014c39500f9c31e2cc2e", "url": "https://github.com/Graylog2/graylog2-server/commit/74de1f26b5502a41217b014c39500f9c31e2cc2e", "message": "Throwing exception for invalid time range type.", "committedDate": "2020-04-16T14:45:00Z", "type": "commit"}, {"oid": "1ebf08d7c7bdf92344d9192eb72f224d6c731787", "url": "https://github.com/Graylog2/graylog2-server/commit/1ebf08d7c7bdf92344d9192eb72f224d6c731787", "message": "Extracting shared time range type selector menu items.", "committedDate": "2020-04-16T14:48:37Z", "type": "commit"}, {"oid": "78f1016ef71d526f270e2b1d8c024edfa398a96b", "url": "https://github.com/Graylog2/graylog2-server/commit/78f1016ef71d526f270e2b1d8c024edfa398a96b", "message": "Removing unused imports.", "committedDate": "2020-04-16T14:49:52Z", "type": "commit"}, {"oid": "9fdf87812150bdd17d65b75c7686a5ce61f5c464", "url": "https://github.com/Graylog2/graylog2-server/commit/9fdf87812150bdd17d65b75c7686a5ce61f5c464", "message": "Cleaning up styled components type annotations.", "committedDate": "2020-04-16T14:51:26Z", "type": "commit"}, {"oid": "b7017b9f02b6ce8f5e23298da4855d4e44bdf4bd", "url": "https://github.com/Graylog2/graylog2-server/commit/b7017b9f02b6ce8f5e23298da4855d4e44bdf4bd", "message": "Typing parameter properly.", "committedDate": "2020-04-16T14:56:07Z", "type": "commit"}, {"oid": "e5d665dd34b768437dc4211dd272234a50643fce", "url": "https://github.com/Graylog2/graylog2-server/commit/e5d665dd34b768437dc4211dd272234a50643fce", "message": "Replacing React component for shared type selector items with function.\n\nIn a previous commit, commonly used time range type selector items were\nextracted into a component named `TimeRangeTypeMenuItems`. Unfortunately,\nwrapping children of the `DropdownButton` in an intermediate component\nbreaks adding event handlers to them through the parent component.\nTherefore, this commit is turning the component into a function that is\nreturning the shared menu items.", "committedDate": "2020-04-17T07:55:59Z", "type": "commit"}, {"oid": "5b2094af17e303d3d12cbc15c3af1d03bb7b76a6", "url": "https://github.com/Graylog2/graylog2-server/commit/5b2094af17e303d3d12cbc15c3af1d03bb7b76a6", "message": "Typing map result explicitly.", "committedDate": "2020-04-17T10:32:05Z", "type": "commit"}]}