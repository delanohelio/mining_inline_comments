{"pr_number": 8848, "pr_title": "Set font size defined in theme for query input", "pr_createdAt": "2020-08-21T15:31:19Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8848", "timeline": [{"oid": "ac178653f875f56ea326e847808824303252411d", "url": "https://github.com/Graylog2/graylog2-server/commit/ac178653f875f56ea326e847808824303252411d", "message": "Define query input font size as react ace prop", "committedDate": "2020-08-24T07:31:32Z", "type": "commit"}, {"oid": "ac178653f875f56ea326e847808824303252411d", "url": "https://github.com/Graylog2/graylog2-server/commit/ac178653f875f56ea326e847808824303252411d", "message": "Define query input font size as react ace prop", "committedDate": "2020-08-24T07:31:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwNTIxMg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r475405212", "bodyText": "Initially I wrapped QueryInput with withTheme,  but it results in a flow error I can't fix easily:\nCannot call withPluginEntities because property completers is missing in object type [1] in the first argument.\n[prop-missing]\n\n     src/views/components/searchbar/QueryInput.jsx\n     105\u2502   placeholder: '',\n     106\u2502 };\n     107\u2502\n     108\u2502 export default withPluginEntities(withTheme(QueryInput), { completers: 'views.completers' });\n     109\u2502\n\n     flow-typed/npm/styled-components_v4.x.x.js\n [1] 175\u2502   declare export function withTheme<Theme, Config: {...}, Instance>(Component: React$AbstractComponent<Config, Instance>): React$AbstractComponent<$Diff<Config, ThemeProps<Theme | void>>, Instance>\n\nI prefer the above structure and we do it similar in comparable cases where we use withPluginEntities  (e.g. in combination with withRouter), but I see no other disadvantage regarding the current structure.", "author": "linuspahl", "createdAt": "2020-08-24T07:50:50Z", "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "diffHunk": "@@ -104,4 +104,4 @@ QueryInput.defaultProps = {\n   placeholder: '',\n };\n \n-export default withPluginEntities(QueryInput, { completers: 'views.completers' });\n+export default withTheme(withPluginEntities(QueryInput, { completers: 'views.completers' }));", "originalCommit": "ac178653f875f56ea326e847808824303252411d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQyMzc3MA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r475423770", "bodyText": "It is fine this way, imo. It should work both ways around though, so I took a quick look into the issue. There are two things:\na) we are still using styled-components for v4. They do not work with functional components (like QueryInput is), so the type inference for the component does not work. I was able to force it by passing explicit types for the generics like this:\nwithPluginEntities(withTheme<ThemeInterface, Props, typeof undefined>(QueryInput), { completers: 'views.completers' })\n\nb) updating the typedefs to v5 fixed this issue and made it work with withPluginEntities(withTheme(QueryInput) out of the box. Can you do the typedef update either in this or a separate PR?\nHope this helps.", "author": "dennisoelkers", "createdAt": "2020-08-24T08:26:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwNTIxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEwMTIxMw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r477101213", "bodyText": "Thanks again for the feedback, I've tested solution b) locally by using #8866 and I am still receiving the flow type error with the styled-components v5 interface definition:\nError \u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508 src/views/components/searchbar/QueryInput.jsx:108:16\n\nCannot call withPluginEntities because property completers is missing in object type [1] in the first argument.\n[prop-missing]\n\n     src/views/components/searchbar/QueryInput.jsx\n     105\u2502   placeholder: '',\n     106\u2502 };\n     107\u2502\n     108\u2502 export default withPluginEntities(withTheme(QueryInput), { completers: 'views.completers' });\n     109\u2502\n\n     flow-typed/npm/styled-components_v5.x.x.js\n [1] 223\u2502   declare export function withTheme<Theme, Config: { ... }, Instance>(\n\n\nDo you have an idea, why this behaves differently?\nI also Implemented solution a) and realised we need to define explicit types when using withPluginEntities. Under these circumstances I prefer the following solution:\nconst mapping = { completers: 'views.completers' };\n\nexport default withPluginEntities<$Rest<Props, {| theme: ThemeInterface |}>, typeof mapping>(withTheme(QueryInput), mapping);", "author": "linuspahl", "createdAt": "2020-08-26T07:47:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwNTIxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU4MjI3Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r475582276", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { ThemeInterface } from 'theme';\n          \n          \n            \n            import { themePropTypes, type ThemeInterface } from 'theme';", "author": "kyleknighted", "createdAt": "2020-08-24T12:59:49Z", "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "diffHunk": "@@ -1,8 +1,10 @@\n // @flow strict\n import * as React from 'react';\n import { useCallback, useMemo } from 'react';\n+import { withTheme } from 'styled-components';\n import PropTypes from 'prop-types';\n \n+import type { ThemeInterface } from 'theme';", "originalCommit": "ac178653f875f56ea326e847808824303252411d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU4MjcyMQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8848#discussion_r475582721", "bodyText": "Could we add theme: themePropTypes.isRequired to the propTypes object as well?", "author": "kyleknighted", "createdAt": "2020-08-24T13:00:33Z", "path": "graylog2-web-interface/src/views/components/searchbar/QueryInput.jsx", "diffHunk": "@@ -12,19 +14,20 @@ import SearchBarAutoCompletions from './SearchBarAutocompletions';\n import type { Completer } from './SearchBarAutocompletions';\n \n type Props = {|\n-  disabled: boolean,\n-  value: string,\n-  completers: Array<Completer>,\n   completerFactory: (Array<Completer>) => AutoCompleter,\n+  completers: Array<Completer>,\n+  disabled: boolean,\n   onBlur?: (string) => void,\n   onChange: (string) => Promise<string>,\n   onExecute: (string) => void,\n   placeholder: string,\n+  theme: ThemeInterface,", "originalCommit": "ac178653f875f56ea326e847808824303252411d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0d24b855a7412798e93747b6c4c2dffc27c73ede", "url": "https://github.com/Graylog2/graylog2-server/commit/0d24b855a7412798e93747b6c4c2dffc27c73ede", "message": "Add prop type definition for QueryInoput theme prop", "committedDate": "2020-08-26T06:49:20Z", "type": "commit"}, {"oid": "0d24b855a7412798e93747b6c4c2dffc27c73ede", "url": "https://github.com/Graylog2/graylog2-server/commit/0d24b855a7412798e93747b6c4c2dffc27c73ede", "message": "Add prop type definition for QueryInoput theme prop", "committedDate": "2020-08-26T06:49:20Z", "type": "forcePushed"}, {"oid": "5cfaf4a4d89faee4923ec9485af5f7946c96f95f", "url": "https://github.com/Graylog2/graylog2-server/commit/5cfaf4a4d89faee4923ec9485af5f7946c96f95f", "message": "Wrap QueryInput with withTheme and define explicit types for this function call", "committedDate": "2020-08-26T07:27:32Z", "type": "commit"}, {"oid": "f79e13c772051adcf78c93fd2fccddb4271fb874", "url": "https://github.com/Graylog2/graylog2-server/commit/f79e13c772051adcf78c93fd2fccddb4271fb874", "message": "Define expicit type definitions for withPluginEntities call in QueryInput", "committedDate": "2020-08-26T07:43:55Z", "type": "commit"}]}