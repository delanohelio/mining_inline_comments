{"pr_number": 8882, "pr_title": "Wrap app with GlobalStylesProvider to amend global css in-flight", "pr_createdAt": "2020-08-27T19:55:51Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8882", "timeline": [{"oid": "fbb3c310553adda21b9d3f1c5995cecd46cf4f0f", "url": "https://github.com/Graylog2/graylog2-server/commit/fbb3c310553adda21b9d3f1c5995cecd46cf4f0f", "message": "Move Scratchpad provider to same directory as others", "committedDate": "2020-08-27T18:37:47Z", "type": "commit"}, {"oid": "f967c27bafab1f25557da8c254485c1f6fe4036b", "url": "https://github.com/Graylog2/graylog2-server/commit/f967c27bafab1f25557da8c254485c1f6fe4036b", "message": "GlobalStylesProvider to avoid double rendered styles", "committedDate": "2020-08-27T18:47:51Z", "type": "commit"}, {"oid": "f7f4370711ef7e2f04da787c4388fc7817b828f8", "url": "https://github.com/Graylog2/graylog2-server/commit/f7f4370711ef7e2f04da787c4388fc7817b828f8", "message": "tests, lint, & flow", "committedDate": "2020-08-27T19:54:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA2NzUyOA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8882#discussion_r479067528", "bodyText": "We need to reset the additional styles here as well.", "author": "linuspahl", "createdAt": "2020-08-28T10:07:47Z", "path": "graylog2-web-interface/src/pages/LoadingPage.jsx", "diffHunk": "@@ -1,15 +1,20 @@\n import PropTypes from 'prop-types';\n-import React from 'react';\n+import React, { useContext, useEffect } from 'react';\n \n import { DocumentTitle, Spinner, Icon } from 'components/common';\n import LoginBox from 'components/login/LoginBox';\n import authStyles from 'theme/styles/authStyles';\n-import GlobalThemeStyles from 'theme/GlobalThemeStyles';\n+import { GlobalStylesContext } from 'contexts/GlobalStylesProvider';\n \n const LoadingPage = ({ text }) => {\n+  const { addGlobalStyles } = useContext(GlobalStylesContext);\n+\n+  useEffect(() => {\n+    addGlobalStyles(authStyles);\n+  }, []);", "originalCommit": "f7f4370711ef7e2f04da787c4388fc7817b828f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTM1MjQyNg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8882#discussion_r479352426", "bodyText": "Reset in LoggedInPage during useEffect mount", "author": "kyleknighted", "createdAt": "2020-08-28T14:44:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA2NzUyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA3MTk1Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8882#discussion_r479071957", "bodyText": "This should be (?CSSRules) => void", "author": "linuspahl", "createdAt": "2020-08-28T10:11:33Z", "path": "graylog2-web-interface/src/contexts/GlobalStylesProvider.jsx", "diffHunk": "@@ -1,6 +1,31 @@\n-import { createGlobalStyle, css } from 'styled-components';\n-\n-const GlobalThemeStyles = createGlobalStyle(({ additionalStyles, theme }) => css`\n+// @flow strict\n+import * as React from 'react';\n+import { createContext, useState } from 'react';\n+import PropTypes from 'prop-types';\n+import { createGlobalStyle, css, type CSSRules } from 'styled-components';\n+\n+type Props = {\n+  children: React.Node,\n+};\n+\n+type StyleTypes = {\n+  addGlobalStyles: (?CSSRules) => ?string,", "originalCommit": "f7f4370711ef7e2f04da787c4388fc7817b828f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA3NjgxNg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8882#discussion_r479076816", "bodyText": "Let's unify this type with the type used in line 12 and define the type like this: const [additionalStyles, addGlobalStyles] = useState<?string>();", "author": "linuspahl", "createdAt": "2020-08-28T10:15:14Z", "path": "graylog2-web-interface/src/contexts/GlobalStylesProvider.jsx", "diffHunk": "@@ -1,6 +1,31 @@\n-import { createGlobalStyle, css } from 'styled-components';\n-\n-const GlobalThemeStyles = createGlobalStyle(({ additionalStyles, theme }) => css`\n+// @flow strict\n+import * as React from 'react';\n+import { createContext, useState } from 'react';\n+import PropTypes from 'prop-types';\n+import { createGlobalStyle, css, type CSSRules } from 'styled-components';\n+\n+type Props = {\n+  children: React.Node,\n+};\n+\n+type StyleTypes = {\n+  addGlobalStyles: (?CSSRules) => ?string,\n+};\n+\n+export const GlobalStylesContext = createContext<StyleTypes>({ addGlobalStyles: () => {} });\n+\n+const GlobalStylesProvider = ({ children }: Props) => {\n+  const [additionalStyles: string, addGlobalStyles] = useState();", "originalCommit": "f7f4370711ef7e2f04da787c4388fc7817b828f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "38278aec8ed834aa5c6acf3171518636dd3fd984", "url": "https://github.com/Graylog2/graylog2-server/commit/38278aec8ed834aa5c6acf3171518636dd3fd984", "message": "Reset background on logged in pages", "committedDate": "2020-08-28T14:33:02Z", "type": "commit"}, {"oid": "aad84ef19d28789443bcea71160695a717efccc4", "url": "https://github.com/Graylog2/graylog2-server/commit/aad84ef19d28789443bcea71160695a717efccc4", "message": "flow", "committedDate": "2020-08-28T14:35:46Z", "type": "commit"}, {"oid": "14e568e97c866971608a9a28ad77b18fa0bb3cd7", "url": "https://github.com/Graylog2/graylog2-server/commit/14e568e97c866971608a9a28ad77b18fa0bb3cd7", "message": "flow", "committedDate": "2020-08-28T14:44:03Z", "type": "commit"}]}