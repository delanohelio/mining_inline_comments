{"pr_number": 8590, "pr_title": "Teams edit", "pr_createdAt": "2020-07-21T14:03:33Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8590", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzOTIzNw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r458339237", "bodyText": "Could the user be added to a Context Provider so that we do not have to pass it to every component?", "author": "kyleknighted", "createdAt": "2020-07-21T19:33:40Z", "path": "graylog2-web-interface/src/components/users/UserDetails/UserDetails.jsx", "diffHunk": "@@ -28,8 +29,8 @@ const UserDetails = ({ user }: Props) => {\n           <SettingsSection user={user} />\n         </div>\n         <div>\n-          <SectionComponent title=\"Teams\">Children</SectionComponent>\n           <RolesSection user={user} />\n+          <TeamsSection user={user} />", "originalCommit": "6f85d7cd5533566eb0ff10972a8487417e104e05", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxMzI4NQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r459313285", "bodyText": "I will discuss this with @linuspahl on monday", "author": "kmerz", "createdAt": "2020-07-23T09:08:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzOTIzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc4OTg5OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r460789899", "bodyText": "The advantages are not huge, but I agree we could something like a UserDetailsContext.", "author": "linuspahl", "createdAt": "2020-07-27T10:16:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMzOTIzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM0MDkzNQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r458340935", "bodyText": "This looks to be the same as src/components/users/UserDetails/TeamSection.jsx:18\nCan we add a link to /system/enterprise so that users can sign up for Enterprise?", "author": "kyleknighted", "createdAt": "2020-07-21T19:37:08Z", "path": "graylog2-web-interface/src/components/users/UserEdit/TeamsSection.jsx", "diffHunk": "@@ -0,0 +1,41 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { PluginStore } from 'graylog-web-plugin/plugin';\n+\n+import User from 'logic/users/User';\n+\n+import SectionComponent from '../SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+const Header = styled.h4`\n+  margin-bottom: 5px;\n+`;\n+\n+const NoEnterpriseComponent = () => (", "originalCommit": "6f85d7cd5533566eb0ff10972a8487417e104e05", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxMzc5Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r459313796", "bodyText": "No because there is not /system/enterprise since there is no Enterprise Plugin installed", "author": "kmerz", "createdAt": "2020-07-23T09:09:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM0MDkzNQ=="}], "type": "inlineReview"}, {"oid": "c60a91dc430dc1f0ae9401a12e36a946a3aa39a4", "url": "https://github.com/Graylog2/graylog2-server/commit/c60a91dc430dc1f0ae9401a12e36a946a3aa39a4", "message": "List all teams of the user in User Details", "committedDate": "2020-07-24T08:55:29Z", "type": "forcePushed"}, {"oid": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078", "url": "https://github.com/Graylog2/graylog2-server/commit/6eb7c8a1cf7b39811247e958496a9eb26fbe5078", "message": "List all teams of the user in User Details", "committedDate": "2020-07-27T10:09:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5MjYzMw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r460792633", "bodyText": "I should have mentioned it in the roles select PR, but let's return the function here onChange={(role) => onChange({ target: { value: role, name } }). Just in case the related component needs to work with the return value of onChange in the future.", "author": "linuspahl", "createdAt": "2020-07-27T10:22:08Z", "path": "graylog2-web-interface/src/components/users/UserEdit/RolesSelector.jsx", "diffHunk": "@@ -0,0 +1,123 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useState } from 'react';\n+import { Formik, Form, Field } from 'formik';\n+import styled, { css } from 'styled-components';\n+import type { StyledComponent } from 'styled-components';\n+\n+import { AuthzRolesActions, type PaginatedListType } from 'stores/roles/AuthzRolesStore';\n+import { type ThemeInterface } from 'theme';\n+import { Button } from 'components/graylog';\n+import { Select } from 'components/common';\n+import User from 'logic/users/User';\n+\n+type Props = {\n+  onSubmit: ({ roles: string[] }) => Promise<void>,\n+  user: User,\n+};\n+\n+const SubmitButton = styled(Button)`\n+  margin-left: 15px;\n+`;\n+\n+const FormElements = styled.div`\n+  display: flex;\n+`;\n+\n+const Errors: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div(({ theme }) => css`\n+  width: 100%;\n+  margin-top: 3px;\n+  color: ${theme.colors.variant.danger};\n+\n+  > * {\n+    margin-right: 5px;\n+\n+    :last-child {\n+      margin-right: 0;\n+    }\n+  }\n+`);\n+\n+const RoleSelectOption = styled.div`\n+  display: flex;\n+  align-items: center;\n+`;\n+\n+const StyledSelect = styled(Select)`\n+  flex: 1;\n+`;\n+\n+const _renderRoleOption = ({ label }: { label: string }) => (\n+  <RoleSelectOption>{label}</RoleSelectOption>\n+);\n+\n+const _isRequired = (field) => (value) => (!value ? `The ${field} is required` : undefined);\n+\n+const RolesSelector = ({ user, onSubmit }: Props) => {\n+  const [roles, setRoles] = useState([]);\n+\n+  const onUpdate = ({ role }: { role: string }, { resetForm }) => {\n+    const userRoles = user.roles;\n+    const newRoles = userRoles.push(role).toJS();\n+\n+    onSubmit({ roles: newRoles }).then(() => {\n+      resetForm();\n+    });\n+  };\n+\n+  useEffect(() => {\n+    const getUnlimited = [1, 0, ''];\n+\n+    AuthzRolesActions.loadPaginated(...getUnlimited)\n+      .then((response: PaginatedListType) => {\n+        const { list } = response;\n+\n+        const resultRoles = list\n+          .filter((r) => !user.roles.includes(r.name))\n+          .toArray()\n+          .map((r) => ({ label: r.name, value: r.name }));\n+        setRoles(resultRoles);\n+      });\n+  }, [user]);\n+\n+  return (\n+    <div>\n+      <Formik onSubmit={onUpdate}\n+              initialValues={{ role: undefined }}>\n+        {({ isSubmitting, isValid, errors }) => (\n+          <Form>\n+            <FormElements>\n+              <Field name=\"role\" validate={_isRequired('role')}>\n+                {({ field: { name, value, onChange } }) => (\n+                  <StyledSelect inputProps={{ 'arial-label': 'Search for roles ' }}\n+                                onChange={(role) => {\n+                                  onChange({ target: { value: role, name } });", "originalCommit": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwOTc4Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8590#discussion_r460809787", "bodyText": "*you need to install", "author": "linuspahl", "createdAt": "2020-07-27T10:57:05Z", "path": "graylog2-web-interface/src/components/users/UserDetails/TeamSection.jsx", "diffHunk": "@@ -0,0 +1,41 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { PluginStore } from 'graylog-web-plugin/plugin';\n+\n+import User from 'logic/users/User';\n+\n+import SectionComponent from '../SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+const Header = styled.h4`\n+  margin-bottom: 5px;\n+`;\n+\n+const NoEnterpriseComponent = () => (\n+  <SectionComponent title=\"Teams\">\n+    <Header>No enterprise plugin found</Header>\n+    <p>To use the <b>Teams</b> functionality you install the Graylog <b>Enterprise</b> plugin.</p>", "originalCommit": "6eb7c8a1cf7b39811247e958496a9eb26fbe5078", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "396bfae3852765fbab84999ab6b6e0d7f437144e", "url": "https://github.com/Graylog2/graylog2-server/commit/396bfae3852765fbab84999ab6b6e0d7f437144e", "message": "Fix annotations from @linuspahl", "committedDate": "2020-07-27T12:56:05Z", "type": "forcePushed"}, {"oid": "a5562650e0b314eed3b5cc289f978ef9dbe2b91e", "url": "https://github.com/Graylog2/graylog2-server/commit/a5562650e0b314eed3b5cc289f978ef9dbe2b91e", "message": "Add TeamsSection", "committedDate": "2020-07-27T13:43:39Z", "type": "commit"}, {"oid": "3f7058c5d93ef5d9be75a1d3c64db2cf057d6188", "url": "https://github.com/Graylog2/graylog2-server/commit/3f7058c5d93ef5d9be75a1d3c64db2cf057d6188", "message": "List all teams of the user in User Details", "committedDate": "2020-07-27T13:43:39Z", "type": "commit"}, {"oid": "607b8b3691070189251d0f42b297dce38d6980d4", "url": "https://github.com/Graylog2/graylog2-server/commit/607b8b3691070189251d0f42b297dce38d6980d4", "message": "Fix annotations from @linuspahl", "committedDate": "2020-07-27T13:43:39Z", "type": "commit"}, {"oid": "607b8b3691070189251d0f42b297dce38d6980d4", "url": "https://github.com/Graylog2/graylog2-server/commit/607b8b3691070189251d0f42b297dce38d6980d4", "message": "Fix annotations from @linuspahl", "committedDate": "2020-07-27T13:43:39Z", "type": "forcePushed"}]}