{"pr_number": 9165, "pr_title": "Expose `isCloud` to frontend", "pr_createdAt": "2020-10-15T09:20:03Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/9165", "timeline": [{"oid": "5e160918b2d52e291c89a1014adf385466b94bbc", "url": "https://github.com/Graylog2/graylog2-server/commit/5e160918b2d52e291c89a1014adf385466b94bbc", "message": "Expose `isCloud` to frontend\n\nStill needs cleaning up and will probably fail if the cloud plugin is\nnot loaded.", "committedDate": "2020-10-14T12:52:44Z", "type": "commit"}, {"oid": "4fb91b370d507181fbf2328bb39af16455543162", "url": "https://github.com/Graylog2/graylog2-server/commit/4fb91b370d507181fbf2328bb39af16455543162", "message": "Don't use environment variable to transport value for isCloud", "committedDate": "2020-10-15T09:08:24Z", "type": "commit"}, {"oid": "d00a48ceed4bcd37a063cc95064ac3551e3c1656", "url": "https://github.com/Graylog2/graylog2-server/commit/d00a48ceed4bcd37a063cc95064ac3551e3c1656", "message": "new approach: don't use template but webpack define plugin instead", "committedDate": "2020-10-15T12:43:17Z", "type": "commit"}, {"oid": "ce684bdaf99bc0bff88b2073182cd546731cbf2c", "url": "https://github.com/Graylog2/graylog2-server/commit/ce684bdaf99bc0bff88b2073182cd546731cbf2c", "message": "Fix ESLint warnings", "committedDate": "2020-10-15T12:53:26Z", "type": "commit"}, {"oid": "addd0fa6191b55be710439149509f38b09026e7c", "url": "https://github.com/Graylog2/graylog2-server/commit/addd0fa6191b55be710439149509f38b09026e7c", "message": "Add \"CLOUD\" to dev badge also for narrow screens", "committedDate": "2020-10-15T13:08:51Z", "type": "commit"}, {"oid": "03f5eda80af62415798b5d59b156c4e4558fdfc3", "url": "https://github.com/Graylog2/graylog2-server/commit/03f5eda80af62415798b5d59b156c4e4558fdfc3", "message": "Add missing parentheses", "committedDate": "2020-10-16T09:57:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwNjIxNg==", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507506216", "bodyText": "I'd remove the prefix space here\nThere is already a space before DEV so I think we can leave it out of the 'CLOUD ' string, or remove the space before DEV\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      && <Badge bsStyle=\"danger\" className=\"small-scrn-badge dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''} DEV</Badge>\n          \n          \n            \n                      && <Badge bsStyle=\"danger\" className=\"small-scrn-badge dev-badge\">{AppConfig.isCloud() ? 'CLOUD' : ''} DEV</Badge>", "author": "Gaya", "createdAt": "2020-10-19T06:40:30Z", "path": "graylog2-web-interface/src/components/navigation/Navigation.jsx", "diffHunk": "@@ -90,7 +90,7 @@ const Navigation = ({ permissions, fullName, location, loginName }) => {\n \n         {\n         AppConfig.gl2DevMode()\n-          && <Badge bsStyle=\"danger\" className=\"small-scrn-badge dev-badge\">DEV</Badge>\n+          && <Badge bsStyle=\"danger\" className=\"small-scrn-badge dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''} DEV</Badge>", "originalCommit": "03f5eda80af62415798b5d59b156c4e4558fdfc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwNjMxOA==", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507506318", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            <Badge bsStyle=\"danger\" className=\"dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''} DEV</Badge>\n          \n          \n            \n                            <Badge bsStyle=\"danger\" className=\"dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''}DEV</Badge>", "author": "Gaya", "createdAt": "2020-10-19T06:40:48Z", "path": "graylog2-web-interface/src/components/navigation/Navigation.jsx", "diffHunk": "@@ -124,7 +124,7 @@ const Navigation = ({ permissions, fullName, location, loginName }) => {\n           AppConfig.gl2DevMode()\n             && (\n               <InactiveNavItem className=\"dev-badge-wrap\">\n-                <Badge bsStyle=\"danger\" className=\"dev-badge\">DEV</Badge>\n+                <Badge bsStyle=\"danger\" className=\"dev-badge\">{AppConfig.isCloud() ? 'CLOUD ' : ''} DEV</Badge>", "originalCommit": "03f5eda80af62415798b5d59b156c4e4558fdfc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwODQyNw==", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507508427", "bodyText": "You can remove the parenthesis after typeof\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (typeof (IS_CLOUD) !== 'undefined') {\n          \n          \n            \n                if (typeof IS_CLOUD !== 'undefined') {", "author": "Gaya", "createdAt": "2020-10-19T06:45:48Z", "path": "graylog2-web-interface/src/util/AppConfig.js", "diffHunk": "@@ -30,6 +30,15 @@ const AppConfig = {\n     return this.appConfig().rootTimeZone;\n   },\n \n+  isCloud() {\n+    if (typeof (IS_CLOUD) !== 'undefined') {", "originalCommit": "03f5eda80af62415798b5d59b156c4e4558fdfc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwOTk5Mw==", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507509993", "bodyText": "Array.some() will return true if there is any element which matches the condition. So no need to filter and then count the amount of elements.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            if (pluginConfigs.filter((config) => config.includes('graylog-plugin-cloud/server-plugin')).length > 0) {\n          \n          \n            \n            if (pluginConfigs.some((config) => config.includes('graylog-plugin-cloud/server-plugin'))) {", "author": "Gaya", "createdAt": "2020-10-19T06:49:20Z", "path": "graylog2-web-interface/webpack.combined.config.js", "diffHunk": "@@ -16,7 +16,11 @@ const globOptions = {\n   nodir: true,\n };\n \n-const pluginConfigs = process.env.disable_plugins === 'true' ? [] : glob.sync(pluginConfigPattern, globOptions).map(config => `${globCwd}/${config}`);\n+const pluginConfigs = process.env.disable_plugins === 'true' ? [] : glob.sync(pluginConfigPattern, globOptions).map((config) => `${globCwd}/${config}`);\n+\n+if (pluginConfigs.filter((config) => config.includes('graylog-plugin-cloud/server-plugin')).length > 0) {", "originalCommit": "03f5eda80af62415798b5d59b156c4e4558fdfc3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2Nzg4OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507667889", "bodyText": "Thanks!", "author": "thll", "createdAt": "2020-10-19T11:20:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwOTk5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUxMDQxOA==", "url": "https://github.com/Graylog2/graylog2-server/pull/9165#discussion_r507510418", "bodyText": "Much better indeed!", "author": "Gaya", "createdAt": "2020-10-19T06:50:23Z", "path": "graylog2-web-interface/webpack.combined.config.js", "diffHunk": "@@ -29,10 +33,9 @@ function getPluginName(pluginConfig) {\n     // If a package.json file exists (should normally be the case) use the package name for pluginName\n     const pkg = JSON.parse(fs.readFileSync(packageConfig, 'utf8'));\n     return pkg.name.replace(/\\s+/g, '');\n-  } else {\n-    // Otherwise just use the directory name of the webpack config file\n-    return path.basename(path.dirname(pluginConfig));\n   }\n+  // Otherwise just use the directory name of the webpack config file", "originalCommit": "03f5eda80af62415798b5d59b156c4e4558fdfc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8607388d79abc54c5859e31bf5c9b134d035b1b4", "url": "https://github.com/Graylog2/graylog2-server/commit/8607388d79abc54c5859e31bf5c9b134d035b1b4", "message": "Remove extra space from badge\n\nCo-authored-by: Gaya Kessler <gaya@theclevernode.com>", "committedDate": "2020-10-19T11:05:42Z", "type": "commit"}, {"oid": "a07e3b37c8234a0f4dc5fc50a90f892e863a5963", "url": "https://github.com/Graylog2/graylog2-server/commit/a07e3b37c8234a0f4dc5fc50a90f892e863a5963", "message": "Simplify expression\n\nCo-authored-by: Gaya Kessler <gaya@theclevernode.com>", "committedDate": "2020-10-19T11:20:36Z", "type": "commit"}, {"oid": "9c55b7886f3c7de2ca355ed8956848de20f3bdc6", "url": "https://github.com/Graylog2/graylog2-server/commit/9c55b7886f3c7de2ca355ed8956848de20f3bdc6", "message": "Remove parentheses\n\nCo-authored-by: Gaya Kessler <gaya@theclevernode.com>", "committedDate": "2020-10-19T11:23:54Z", "type": "commit"}]}