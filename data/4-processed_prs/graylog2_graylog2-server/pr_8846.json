{"pr_number": 8846, "pr_title": "Add user preferences section for UserDetails and UserEdit page", "pr_createdAt": "2020-08-21T12:35:28Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8846", "timeline": [{"oid": "aa043ff0179accc0b43aa368ab34cfd867593330", "url": "https://github.com/Graylog2/graylog2-server/commit/aa043ff0179accc0b43aa368ab34cfd867593330", "message": "Rename UserDetails TeamSection to TeamsSection", "committedDate": "2020-08-21T12:19:37Z", "type": "commit"}, {"oid": "32e8c2054d7dc61b4caa7615331eba8a894506a0", "url": "https://github.com/Graylog2/graylog2-server/commit/32e8c2054d7dc61b4caa7615331eba8a894506a0", "message": "Add PreferencesSection for UserEdit and UserDetails page", "committedDate": "2020-08-21T12:19:37Z", "type": "commit"}, {"oid": "591e380d5572fb1c342e39396952af34847769ac", "url": "https://github.com/Graylog2/graylog2-server/commit/591e380d5572fb1c342e39396952af34847769ac", "message": "Refactor PreferencesStore usage", "committedDate": "2020-08-21T12:19:37Z", "type": "commit"}, {"oid": "4aee4f91027a3c8846f01a1a3e93666d3f8a1616", "url": "https://github.com/Graylog2/graylog2-server/commit/4aee4f91027a3c8846f01a1a3e93666d3f8a1616", "message": "Smaller fixes", "committedDate": "2020-08-21T12:26:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3MDM2NQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#discussion_r474670365", "bodyText": "This is a perfect example for code I would like to centralise, but don't really know a good place for. It is clearly presentation logic which means it should not be part of the PreferenceStore nor the directory logic/users", "author": "linuspahl", "createdAt": "2020-08-21T12:39:18Z", "path": "graylog2-web-interface/src/components/users/UserDetails/PreferencesSection.jsx", "diffHunk": "@@ -0,0 +1,52 @@\n+// @flow strict\n+import * as React from 'react';\n+\n+import { PREFERENCES_THEME_MODE } from 'theme/constants';\n+import Store from 'logic/local-storage/Store';\n+import User from 'logic/users/User';\n+import ReadOnlyFormGroup from 'components/common/ReadOnlyFormGroup';\n+import SectionComponent from 'components/common/Section/SectionComponent';\n+\n+type Props = {\n+  user: User,\n+};\n+\n+export const getPreferenceValueLabel = (preferenceType: string, preferenceValue: mixed): string => {\n+  if (preferenceType === 'boolean') {\n+    return preferenceValue ? 'yes' : 'no';\n+  }\n+\n+  return String(preferenceValue);\n+};", "originalCommit": "4aee4f91027a3c8846f01a1a3e93666d3f8a1616", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5ODAwNg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#discussion_r475398006", "bodyText": "I would move it to ReadOnlyFormGroup. It is quite certain the only place which ever needs it. In addition I would set a prop which is configuring it: <ReadOnlyFormGroup label=\"Search autocompletion\" value={enableSmartSearch}  valueConverter=\"boolean\" /> something like this.", "author": "kmerz", "createdAt": "2020-08-24T07:37:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3MDM2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcxMjA2Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#discussion_r475712067", "bodyText": "I moved the getPreferenceValueLabel logic to the ReadOnlyFormGroup, instead of a valueConverter prop I used typeof and made sure the provided values are a boolean.\nI like the suggestion regarding the visual presentation.", "author": "linuspahl", "createdAt": "2020-08-24T15:45:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3MDM2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcxMjgxMA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#discussion_r475712810", "bodyText": "I thought about increasing the icon size, but in my opinion it looks better this way.", "author": "linuspahl", "createdAt": "2020-08-24T15:46:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3MDM2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwOTU2Mg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#discussion_r475409562", "bodyText": "Since we now exactly know what in the PreferenceMap is, we should do the real type here. So if someone is adding a new entry and accessing it he get's informed that it is not in the type.", "author": "kmerz", "createdAt": "2020-08-24T07:58:50Z", "path": "graylog2-web-interface/src/stores/users/PreferencesStore.js", "diffHunk": "@@ -13,49 +13,38 @@ export type Preference = {\n   value: any,\n };\n \n-type PreferencesMap = {\n+export type PreferencesMap = {", "originalCommit": "4aee4f91027a3c8846f01a1a3e93666d3f8a1616", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcwOTI1OA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8846#discussion_r475709258", "bodyText": "I had to adjust the existing type definitions a lot, but it was worth it! E.g. I added a UserOverviewJSON type definitions.", "author": "linuspahl", "createdAt": "2020-08-24T15:41:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQwOTU2Mg=="}], "type": "inlineReview"}, {"oid": "09dbdf04267a0d780812633f096818e3c980ca59", "url": "https://github.com/Graylog2/graylog2-server/commit/09dbdf04267a0d780812633f096818e3c980ca59", "message": "Add icon for boolean values of ReadOnlyFormField", "committedDate": "2020-08-24T15:03:43Z", "type": "commit"}, {"oid": "179def0299c0b304c86dea3fd40203518ca1e752", "url": "https://github.com/Graylog2/graylog2-server/commit/179def0299c0b304c86dea3fd40203518ca1e752", "message": "Define real type definition for PreferencesMap", "committedDate": "2020-08-24T15:05:32Z", "type": "commit"}, {"oid": "610c403124e2e7bdf5f805fe5b34f060d1fa14f3", "url": "https://github.com/Graylog2/graylog2-server/commit/610c403124e2e7bdf5f805fe5b34f060d1fa14f3", "message": "Update UserOverview and preferences type definitions", "committedDate": "2020-08-24T15:36:41Z", "type": "commit"}, {"oid": "022ef2bb92729e7345bc687cdbc17b85037ea7f2", "url": "https://github.com/Graylog2/graylog2-server/commit/022ef2bb92729e7345bc687cdbc17b85037ea7f2", "message": "Remove empty line", "committedDate": "2020-08-24T15:48:28Z", "type": "commit"}]}