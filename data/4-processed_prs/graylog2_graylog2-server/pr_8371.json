{"pr_number": 8371, "pr_title": "Display error message for search bar time range inputs", "pr_createdAt": "2020-06-18T11:02:53Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8371", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE1MjQxNw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#discussion_r442152417", "bodyText": "The biggest problem I faced while implementing these changes:\nI had to check here if the \"from\" date is a valid date string, which is also part of the AbsoluteTimeRangeSelector validation . Imagine the following scenario:\nStart date: 2020-06-18 11:04:34.82 (invalid date because last number is missing)\nEnd date: 2020-06-10 11:04:34.823\nIn this case the error message would be \"Start date must be before end date\" instead of \"Format must be: YYYY-MM-DD HH:mm:ss\", without the mentioned date string check in the form validation.\nAt one point I've created a SearchBarFormValidation file, but it was way more complex than the current implementation and I really prefer the component based validation approach. Unfortunately I could not find a way to give the field validation a higher priority than the form validation.", "author": "linuspahl", "createdAt": "2020-06-18T11:18:04Z", "path": "graylog2-web-interface/src/views/components/searchbar/SearchBarForm.jsx", "diffHunk": "@@ -21,6 +22,16 @@ type Props = {\n   children: ((props: FormikProps<Values>) => React$Node) | React$Node,\n };\n \n+const validate = (values) => {\n+  const errors = {};\n+  if (values.timerange.type === 'absolute' && DateTime.isValidDateString(values.timerange.from) && values.timerange.from > values.timerange.to) {", "originalCommit": "5cf02ab0693687ea775683e750c5143db0770080", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY4NjY3OA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#discussion_r442686678", "bodyText": "During testing, I noticed that we have a slight inconsistency. The message says Format must be: YYYY-MM-DD HH:mm:ss, but we do allow specifying milliseconds. So the message should be Format must be: YYYY-MM-DD HH:mm:ss[.SSS]. This would mean not being able to reuse the DateTime.Formats.DATETIME constant, but this is okay, as we should support a couple of formats and use a combined format for the error message.\nA suggestion for a future improvement: I think we should be a bit more relaxed when parsing the date. Right now we expect to specify all units going down to seconds. Imo seconds should be optional, maybe it should even be possible to make hours & minutes optional as well.", "author": "dennisoelkers", "createdAt": "2020-06-19T07:47:06Z", "path": "graylog2-web-interface/src/views/components/searchbar/AbsoluteTimeRangeSelector.jsx", "diffHunk": "@@ -36,7 +36,7 @@ const _isValidDateString = (dateString: string) => {\n   }\n   return DateTime.isValidDateString(dateString)\n     ? undefined\n-    : `Invalid date: ${dateString}`;\n+    : `Format must be: ${DateTime.Formats.DATETIME}`;", "originalCommit": "5cf02ab0693687ea775683e750c5143db0770080", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ3OTYzOQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#discussion_r443479639", "bodyText": "Good point, I've updated the error message.", "author": "linuspahl", "createdAt": "2020-06-22T11:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY4NjY3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAzNjUyMQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#discussion_r444036521", "bodyText": "This is now YYYY-MM-DD HH:mm:ss.SSS. It should be YYYY-MM-DD HH:mm:ss[.SSS] to indicate that milliseconds are optional. As mentioned in a previous comment, I think we cannot reuse an existing date format string, as we do combine multiple of them (two at the moment, more if we also make e.g. seconds optional).", "author": "dennisoelkers", "createdAt": "2020-06-23T08:01:52Z", "path": "graylog2-web-interface/src/views/components/searchbar/AbsoluteTimeRangeSelector.jsx", "diffHunk": "@@ -36,7 +36,7 @@ const _isValidDateString = (dateString: string) => {\n   }\n   return DateTime.isValidDateString(dateString)\n     ? undefined\n-    : `Invalid date: ${dateString}`;\n+    : `Format must be: ${DateTime.Formats.TIMESTAMP}`;", "originalCommit": "452e88ca22e46e3fc51fddb79c560df48c377e7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDExODAzNg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#discussion_r444118036", "bodyText": "I thought the parentheses mark the difference, but I like the idea.\nBut when we mark a part as optional, shouldn't we display a message like YYYY-MM-DD [HH:mm:ss[.SSS]] since you can enter 2020-06-23 in the same way like 2020-06-23 10:10:37?", "author": "linuspahl", "createdAt": "2020-06-23T10:18:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAzNjUyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg4OTI5Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8371#discussion_r444889297", "bodyText": "Yes, absolutely. I was not aware of being able to leave out the time, I only tested leaving out seconds, which unfortunately does not work yet :/", "author": "dennisoelkers", "createdAt": "2020-06-24T13:23:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAzNjUyMQ=="}], "type": "inlineReview"}, {"oid": "30b8582e61402ec6b95875deb7b04df0c5ee5187", "url": "https://github.com/Graylog2/graylog2-server/commit/30b8582e61402ec6b95875deb7b04df0c5ee5187", "message": "Add Tooltip for DateInputWithTimePicker which displays errors", "committedDate": "2020-06-25T15:13:10Z", "type": "commit"}, {"oid": "f35f553fbdbc0eae55e8ca9cdb77e24a1f654535", "url": "https://github.com/Graylog2/graylog2-server/commit/f35f553fbdbc0eae55e8ca9cdb77e24a1f654535", "message": "Add SearchbarForm validation to validate relation between timerange from and to values", "committedDate": "2020-06-25T15:13:10Z", "type": "commit"}, {"oid": "cf431e84a984e9b120038802a6662076fdb09782", "url": "https://github.com/Graylog2/graylog2-server/commit/cf431e84a984e9b120038802a6662076fdb09782", "message": "Display required format in absolute timerange selection error message", "committedDate": "2020-06-25T15:13:10Z", "type": "commit"}, {"oid": "917ddcc631d5853191da36d5468c25ae9b3553b9", "url": "https://github.com/Graylog2/graylog2-server/commit/917ddcc631d5853191da36d5468c25ae9b3553b9", "message": "Display keyword timerange selector error in tooltip", "committedDate": "2020-06-25T15:13:11Z", "type": "commit"}, {"oid": "458e2e272c49b1ff040b31bd0dc30a67ec959197", "url": "https://github.com/Graylog2/graylog2-server/commit/458e2e272c49b1ff040b31bd0dc30a67ec959197", "message": "Remove Tooltip prop allowLineBreak, because it got added to the DOM", "committedDate": "2020-06-25T15:13:11Z", "type": "commit"}, {"oid": "6e9b56ddde6afd24e185a01149e84747b4395e44", "url": "https://github.com/Graylog2/graylog2-server/commit/6e9b56ddde6afd24e185a01149e84747b4395e44", "message": "Add test for keyword timerange selector error message", "committedDate": "2020-06-25T15:13:11Z", "type": "commit"}, {"oid": "c4bb54efff37ab270c2509408b8df7a764f96921", "url": "https://github.com/Graylog2/graylog2-server/commit/c4bb54efff37ab270c2509408b8df7a764f96921", "message": "Add test for SearchBarForm validation", "committedDate": "2020-06-25T15:13:11Z", "type": "commit"}, {"oid": "a5ae7677c22813e26a5e096b21cfb08f5ed70c4f", "url": "https://github.com/Graylog2/graylog2-server/commit/a5ae7677c22813e26a5e096b21cfb08f5ed70c4f", "message": "Improve SearchBarForm test description", "committedDate": "2020-06-25T15:13:11Z", "type": "commit"}, {"oid": "e3da1466e4fe16020406649d5a661ff897a8c400", "url": "https://github.com/Graylog2/graylog2-server/commit/e3da1466e4fe16020406649d5a661ff897a8c400", "message": "Fix typo", "committedDate": "2020-06-25T15:13:11Z", "type": "commit"}, {"oid": "762b08def6c993bd40114be79bedd5f06da912a7", "url": "https://github.com/Graylog2/graylog2-server/commit/762b08def6c993bd40114be79bedd5f06da912a7", "message": "Change date format for absolute time range selector error message", "committedDate": "2020-06-25T15:13:11Z", "type": "commit"}, {"oid": "2ebdcf70294402781b69b9470509edfcb1fbac62", "url": "https://github.com/Graylog2/graylog2-server/commit/2ebdcf70294402781b69b9470509edfcb1fbac62", "message": "Add tests for AbsoluteTimeRangeSelector", "committedDate": "2020-06-25T15:13:11Z", "type": "commit"}, {"oid": "825cfc8fb9471f190a74ce896a0e2cfd7a917b73", "url": "https://github.com/Graylog2/graylog2-server/commit/825cfc8fb9471f190a74ce896a0e2cfd7a917b73", "message": "Fix linting", "committedDate": "2020-06-25T15:13:12Z", "type": "commit"}, {"oid": "d51ff4bc9a52244fcd2bd9ebc62100f32f460480", "url": "https://github.com/Graylog2/graylog2-server/commit/d51ff4bc9a52244fcd2bd9ebc62100f32f460480", "message": "Disable autocomplete for DateInputWithPicker", "committedDate": "2020-06-25T15:13:12Z", "type": "commit"}, {"oid": "ffe1a7199185ce637a03403bacf7d942e7158131", "url": "https://github.com/Graylog2/graylog2-server/commit/ffe1a7199185ce637a03403bacf7d942e7158131", "message": "Change absolute timerange error message and fix padding-line-between-statements linter errors", "committedDate": "2020-06-25T15:17:48Z", "type": "commit"}, {"oid": "ffe1a7199185ce637a03403bacf7d942e7158131", "url": "https://github.com/Graylog2/graylog2-server/commit/ffe1a7199185ce637a03403bacf7d942e7158131", "message": "Change absolute timerange error message and fix padding-line-between-statements linter errors", "committedDate": "2020-06-25T15:17:48Z", "type": "forcePushed"}]}