{"pr_number": 8718, "pr_title": "Graylog Noir", "pr_createdAt": "2020-08-06T15:50:45Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8718", "timeline": [{"oid": "07faa5bb64839d43c65ead725e9e04248a4e4952", "url": "https://github.com/Graylog2/graylog2-server/commit/07faa5bb64839d43c65ead725e9e04248a4e4952", "message": "Rename", "committedDate": "2020-08-10T14:22:02Z", "type": "forcePushed"}, {"oid": "4e4232af07297492d6bf74d074b525355345ca58", "url": "https://github.com/Graylog2/graylog2-server/commit/4e4232af07297492d6bf74d074b525355345ca58", "message": "Implementing Dark Mode Toggle", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "1351cf4a19230d01c48567d4ec72a50eb2efb124", "url": "https://github.com/Graylog2/graylog2-server/commit/1351cf4a19230d01c48567d4ec72a50eb2efb124", "message": "Keep preferences after set", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "576c5211371dc91ee506ec1102cf42133c6ef0fd", "url": "https://github.com/Graylog2/graylog2-server/commit/576c5211371dc91ee506ec1102cf42133c6ef0fd", "message": "Toggle Icon Color", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "a5bd6baeda8371fdefa800a4ee5388cf15e73380", "url": "https://github.com/Graylog2/graylog2-server/commit/a5bd6baeda8371fdefa800a4ee5388cf15e73380", "message": "no themeModes in theme", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "dc033b1ba4fe44b6dafd72b2b16610690ebb203b", "url": "https://github.com/Graylog2/graylog2-server/commit/dc033b1ba4fe44b6dafd72b2b16610690ebb203b", "message": "Updated Colors documentation", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "7a546bc9eaaaa174472f64068e56012b540a68fd", "url": "https://github.com/Graylog2/graylog2-server/commit/7a546bc9eaaaa174472f64068e56012b540a68fd", "message": "Updated variant color ratios", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "807ebf149c734cdd3f59d5e67ee0584423b9ed5b", "url": "https://github.com/Graylog2/graylog2-server/commit/807ebf149c734cdd3f59d5e67ee0584423b9ed5b", "message": "Flow typing", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "1f17b7a374b89c00b18f0b57e6b4a46066b2b481", "url": "https://github.com/Graylog2/graylog2-server/commit/1f17b7a374b89c00b18f0b57e6b4a46066b2b481", "message": "Rename", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "a54de0c6ddf559a06983aaebb8f976879ad1129f", "url": "https://github.com/Graylog2/graylog2-server/commit/a54de0c6ddf559a06983aaebb8f976879ad1129f", "message": "Stop flash of teint while using noir", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "13ee8b13479212e8f7fcf1cd4e51d5cc197bafff", "url": "https://github.com/Graylog2/graylog2-server/commit/13ee8b13479212e8f7fcf1cd4e51d5cc197bafff", "message": "Scratchpad styles adjustment", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "7967e6e0d61937ee0404306e119272808f1478e4", "url": "https://github.com/Graylog2/graylog2-server/commit/7967e6e0d61937ee0404306e119272808f1478e4", "message": "Implementing Dark Mode Toggle", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "95672a0675c19bf20cf9f1fa5a2f76036c85ce10", "url": "https://github.com/Graylog2/graylog2-server/commit/95672a0675c19bf20cf9f1fa5a2f76036c85ce10", "message": "Updated variant color ratios", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "54bda04be486491cacc5aa9d64902077e512a3a0", "url": "https://github.com/Graylog2/graylog2-server/commit/54bda04be486491cacc5aa9d64902077e512a3a0", "message": "Rename", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "5529c7f230087b175c73f2f9b00adedc3256561e", "url": "https://github.com/Graylog2/graylog2-server/commit/5529c7f230087b175c73f2f9b00adedc3256561e", "message": "Auto-update theme mode from browser/os options", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "b160a1cec08792b72ff57e44c6a5d0928fa75631", "url": "https://github.com/Graylog2/graylog2-server/commit/b160a1cec08792b72ff57e44c6a5d0928fa75631", "message": "Adding doc link to useMatchMedia hook", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "f8b683e034f64d099ed56eb76d50103724caca19", "url": "https://github.com/Graylog2/graylog2-server/commit/f8b683e034f64d099ed56eb76d50103724caca19", "message": "Admin can toggle themes", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "936dbc5f5491a268b6f87f3a613cf8323854d3a5", "url": "https://github.com/Graylog2/graylog2-server/commit/936dbc5f5491a268b6f87f3a613cf8323854d3a5", "message": "LoginBox styles", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "4ee443ebb949ab57005f138c0dc44d838598605c", "url": "https://github.com/Graylog2/graylog2-server/commit/4ee443ebb949ab57005f138c0dc44d838598605c", "message": "Theme toggle colors", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "ecf6edb9bcde0d6ca8ee290a0b59f9232d17dce6", "url": "https://github.com/Graylog2/graylog2-server/commit/ecf6edb9bcde0d6ca8ee290a0b59f9232d17dce6", "message": "deprecated Icon name", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "e2207a8dd499aba41e1f590622ca9f2cd3aa014a", "url": "https://github.com/Graylog2/graylog2-server/commit/e2207a8dd499aba41e1f590622ca9f2cd3aa014a", "message": "Theme styles for Well", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "b0598c19623ccf096157b1c9213d3d17645c113f", "url": "https://github.com/Graylog2/graylog2-server/commit/b0598c19623ccf096157b1c9213d3d17645c113f", "message": "usePrefersColorScheme hook", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "1368a9afd8283c9a8e15db1db04f6c05ed8d54ee", "url": "https://github.com/Graylog2/graylog2-server/commit/1368a9afd8283c9a8e15db1db04f6c05ed8d54ee", "message": "Updating WrappingContainer to stub out ThemeProvider directly", "committedDate": "2020-08-12T10:52:26Z", "type": "commit"}, {"oid": "1368a9afd8283c9a8e15db1db04f6c05ed8d54ee", "url": "https://github.com/Graylog2/graylog2-server/commit/1368a9afd8283c9a8e15db1db04f6c05ed8d54ee", "message": "Updating WrappingContainer to stub out ThemeProvider directly", "committedDate": "2020-08-12T10:52:26Z", "type": "forcePushed"}, {"oid": "de8b100a248dac8b4e1c010674e257851dd6300a", "url": "https://github.com/Graylog2/graylog2-server/commit/de8b100a248dac8b4e1c010674e257851dd6300a", "message": "snapshots", "committedDate": "2020-08-12T10:54:11Z", "type": "commit"}, {"oid": "4c6e25abd9228cfc687139bce970cb548a9b77df", "url": "https://github.com/Graylog2/graylog2-server/commit/4c6e25abd9228cfc687139bce970cb548a9b77df", "message": "one test issue", "committedDate": "2020-08-12T11:05:40Z", "type": "commit"}, {"oid": "5f513df9be406826311d97012409dd5cc40c5edd", "url": "https://github.com/Graylog2/graylog2-server/commit/5f513df9be406826311d97012409dd5cc40c5edd", "message": "Fix tests for NavigationLink, ShowMessagePage, AggregationControls and GenericPlot", "committedDate": "2020-08-12T14:39:33Z", "type": "commit"}, {"oid": "01d8b52f2f75e06541b0971d8a22b62cc3d3dabe", "url": "https://github.com/Graylog2/graylog2-server/commit/01d8b52f2f75e06541b0971d8a22b62cc3d3dabe", "message": "Moving Popover mock to __mocks__", "committedDate": "2020-08-12T15:03:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg0MjM2Mg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8718#discussion_r469842362", "bodyText": "ThemeModeToggle does not take a username as props. Or am I wrong?", "author": "kmerz", "createdAt": "2020-08-13T10:05:40Z", "path": "graylog2-web-interface/src/components/navigation/UserMenu.jsx", "diffHunk": "@@ -29,6 +31,10 @@ class UserMenu extends React.Component {\n                    noCaret>\n         <MenuItem header>{fullName}</MenuItem>\n         <MenuItem divider />\n+        <MenuItem header>\n+          <ThemeModeToggle username={loginName} />", "originalCommit": "01d8b52f2f75e06541b0971d8a22b62cc3d3dabe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg0MzU3Mw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8718#discussion_r469843573", "bodyText": "useBrowserColorScheme ???", "author": "kmerz", "createdAt": "2020-08-13T10:07:57Z", "path": "graylog2-web-interface/src/hooks/usePrefersColorScheme.js", "diffHunk": "@@ -0,0 +1,50 @@\n+import { useState, useEffect } from 'react';\n+\n+import { THEME_MODE_DARK, THEME_MODE_LIGHT } from 'theme/constants';\n+\n+// * https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia\n+// * https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList\n+// * https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Testing_media_queries\n+// * https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme\n+\n+const usePrefersColorScheme = () => {", "originalCommit": "01d8b52f2f75e06541b0971d8a22b62cc3d3dabe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTkxOTQ5OA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8718#discussion_r469919498", "bodyText": "It is called prefers-color-scheme.\nI feel it makes the most sense to use the actual name of the property.", "author": "kyleknighted", "createdAt": "2020-08-13T12:38:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg0MzU3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3OTc2Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/8718#discussion_r469879766", "bodyText": "I guess it is a matter of taste, but I would rather have a deconstructed import of useState and co.", "author": "kmerz", "createdAt": "2020-08-13T11:20:58Z", "path": "graylog2-web-interface/src/theme/GraylogThemeProvider.jsx", "diffHunk": "@@ -1,30 +1,112 @@\n-import React from 'react';\n+// @flow strict\n+import * as React from 'react';\n import PropTypes from 'prop-types';\n import { ThemeProvider } from 'styled-components';\n \n+import { useStore } from 'stores/connect';\n+import Store from 'logic/local-storage/Store';\n import { breakpoints, colors, fonts, utils } from 'theme';\n+import type { ThemeInterface } from 'theme';\n+import usePrefersColorScheme from 'hooks/usePrefersColorScheme';\n import buttonStyles from 'components/graylog/styles/buttonStyles';\n import aceEditorStyles from 'components/graylog/styles/aceEditorStyles';\n+import StoreProvider from 'injection/StoreProvider';\n+import CombinedProvider from 'injection/CombinedProvider';\n \n-/* NOTE: mode will eventually need to come from User Preferences */\n-const THEME_MODE = 'teinte';\n-\n-const GraylogThemeProvider = ({ children }) => {\n-  return (\n-    <ThemeProvider theme={{\n-      mode: THEME_MODE,\n-      breakpoints,\n-      colors,\n-      fonts,\n-      components: {\n-        button: buttonStyles({ colors, utils }),\n-        aceEditor: aceEditorStyles({ colors }),\n-      },\n-      utils,\n-    }}>\n+import { PREFERENCES_THEME_MODE, DEFAULT_THEME_MODE, THEME_MODE_DARK, THEME_MODE_LIGHT } from './constants';\n+\n+type Props = {\n+  children: React.Node,\n+};\n+\n+const { CurrentUserStore } = CombinedProvider.get('CurrentUser');\n+const PreferencesStore = StoreProvider.getStore('Preferences');\n+\n+const GraylogThemeProvider = ({ children }: Props) => {\n+  const colorScheme = usePrefersColorScheme();\n+  const [theme, setTheme] = React.useState();", "originalCommit": "01d8b52f2f75e06541b0971d8a22b62cc3d3dabe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2421f5b735804d1953dd28ac32528d652cca1703", "url": "https://github.com/Graylog2/graylog2-server/commit/2421f5b735804d1953dd28ac32528d652cca1703", "message": "Fixing annotations from @kmerz", "committedDate": "2020-08-13T12:50:18Z", "type": "commit"}]}