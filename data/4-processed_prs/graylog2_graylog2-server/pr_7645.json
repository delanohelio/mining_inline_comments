{"pr_number": 7645, "pr_title": "Implement sorting options for message table widget", "pr_createdAt": "2020-03-06T09:57:32Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/7645", "timeline": [{"oid": "250b4028e8d049d75619949f54b98b812998e518", "url": "https://github.com/Graylog2/graylog2-server/commit/250b4028e8d049d75619949f54b98b812998e518", "message": "Fix MessageConfigGenerator test", "committedDate": "2020-03-06T10:53:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0MzA3NA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r388843074", "bodyText": "I've tried to add some meaningful tests for the FieldSortSelect, but I could not really find a way to test e.g. the select menu and the selection of an option. It looks like this was also a problem in the SeriesSelect test.", "author": "linuspahl", "createdAt": "2020-03-06T11:05:34Z", "path": "graylog2-web-interface/src/views/components/widgets/FieldSortSelect.test.jsx", "diffHunk": "@@ -0,0 +1,40 @@\n+// @flow strict\n+import React from 'react';\n+import { render, cleanup, fireEvent, waitForElement } from 'wrappedTestingLibrary';\n+import { List } from 'immutable';\n+\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import FieldType from 'views/logic/fieldtypes/FieldType';\n+import FieldTypeMapping from 'views/logic/fieldtypes/FieldTypeMapping';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+\n+import FieldSortSelect from './FieldSortSelect';\n+\n+\n+describe('FieldSortSelect', () => {\n+  afterEach(cleanup);\n+\n+  const properties = ['enumerable'];\n+  const fieldType1 = new FieldType('string', properties, []);\n+  const fieldTypeMapping1 = new FieldTypeMapping('date', fieldType1);\n+  const fieldType2 = new FieldType('string', properties, []);\n+  const fieldTypeMapping2 = new FieldTypeMapping('http_method', fieldType2);\n+  const fields = List([fieldTypeMapping1, fieldTypeMapping2]);\n+  const sort = [new SortConfig('pivot', 'http_method', Direction.Ascending)];\n+\n+  it('should render minimal', () => {\n+    const { getByText } = render(<FieldSortSelect fields={fields} onChange={() => {}} sort={sort} />);\n+    expect(getByText('http_method')).not.toBeNull();\n+  });\n+\n+  it('should display current sort as selected option', () => {\n+    const { getByText } = render(<FieldSortSelect fields={fields} onChange={() => {}} sort={sort} />);\n+    expect(getByText('http_method')).not.toBeNull();\n+  });\n+\n+  it('should open menu when focused', async () => {\n+    const { getByText, container } = render(<FieldSortSelect fields={fields} onChange={() => {}} sort={sort} />);\n+    fireEvent.focus(container.getElementsByTagName('input')[0]);\n+    await waitForElement(() => getByText(/2 results available./));\n+  });\n+});", "originalCommit": "250b4028e8d049d75619949f54b98b812998e518", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0NjEyOQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r388846129", "bodyText": "Would you implement useMemo for these two functions or are the not complex enough?", "author": "linuspahl", "createdAt": "2020-03-06T11:13:01Z", "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -0,0 +1,101 @@\n+// @flow strict\n+import React from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import PropTypes from 'prop-types';\n+\n+import MessagesWidgetConfig, { defaultSortDirection } from 'views/logic/widgets/MessagesWidgetConfig';\n+import Direction, { type DirectionJson } from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+import CustomPropTypes from 'views/components/CustomPropTypes';\n+\n+import { Icon } from 'components/common';\n+\n+type Props = {\n+  config: MessagesWidgetConfig,\n+  fieldName: string,\n+  onConfigChange: (MessagesWidgetConfig) => Promise<void>,\n+  setLoadingState: (loading: boolean) => void,\n+}\n+\n+const SortIcon: StyledComponent<{fieldSortActive: boolean}, {}, HTMLButtonElement> = styled.button(({ fieldSortActive }) => {\n+  const color = fieldSortActive ? '#333' : '#bdbdbd';\n+\n+  return css`\n+    border: 0;\n+    background: transparent;\n+    color: ${color};\n+\n+    padding: 5px;\n+\n+    cursor: pointer;\n+  `;\n+});\n+\n+const _newSort = (config, fieldName, currentSortDirectioName) => {\n+  switch (currentSortDirectioName) {\n+    case Direction.Ascending.direction:\n+      return config.sort.map(sort => sort.toBuilder().direction(Direction.Descending).build());\n+    case Direction.Descending.direction:\n+      return config.sort.map(sort => sort.toBuilder().direction(Direction.Ascending).build());\n+    default:\n+      return [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, defaultSortDirection)];\n+  }\n+};\n+\n+const _changeSort = (config: MessagesWidgetConfig, fieldName: string, sortDirectionName: ?DirectionJson, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+  setLoadingState(true);\n+  const newSort = _newSort(config, fieldName, sortDirectionName);\n+  const newConfig = config.toBuilder().sort(newSort).build();\n+  onConfigChange(newConfig).then(() => {\n+    setLoadingState(false);\n+  });\n+};\n+\n+const _sortDirectionName = (config: MessagesWidgetConfig, fieldName: string) => {\n+  const currentSort = config.sort && config.sort.length > 0 ? config.sort[0] : null;\n+  if (currentSort && currentSort.field === fieldName) {\n+    return currentSort.direction.direction;\n+  }\n+  return null;\n+};\n+\n+const _newSortDescription = (fielName: string, sortDirectionName: ?DirectionJson) => {\n+  let newDirection;\n+  if (sortDirectionName && sortDirectionName === Direction.Ascending) {\n+    newDirection = Direction.Descending.direction;\n+  } else {\n+    newDirection = Direction.Ascending.direction;\n+  }\n+  return `Sort ${fielName} ${newDirection}`;\n+};\n+\n+const _sortIcon = (fieldSortDirection: ?DirectionJson) => {\n+  if (fieldSortDirection && fieldSortDirection === Direction.Ascending.direction) {\n+    return 'sort-amount-asc';\n+  }\n+  return 'sort-amount-desc';\n+};\n+\n+\n+const FieldSortIcon = ({ fieldName, config, onConfigChange, setLoadingState }: Props) => {\n+  const sortDirectionName = _sortDirectionName(config, fieldName);\n+  const newSortDescription = _newSortDescription(fieldName, sortDirectionName);", "originalCommit": "2e2331f2728d5772371db5bd43ac918deab01d72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzMTU5Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389631597", "bodyText": "Answer: These functions are not complex", "author": "linuspahl", "createdAt": "2020-03-09T12:34:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0NjEyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0Njg4OA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r388846888", "bodyText": "I've had some inconsistent behaviour when I tried to compare e.g. Direction.Ascending with the direction of a widget config sort and decided to use the direction name instead of the class.", "author": "linuspahl", "createdAt": "2020-03-06T11:15:02Z", "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -0,0 +1,101 @@\n+// @flow strict\n+import React from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import PropTypes from 'prop-types';\n+\n+import MessagesWidgetConfig, { defaultSortDirection } from 'views/logic/widgets/MessagesWidgetConfig';\n+import Direction, { type DirectionJson } from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+import CustomPropTypes from 'views/components/CustomPropTypes';\n+\n+import { Icon } from 'components/common';\n+\n+type Props = {\n+  config: MessagesWidgetConfig,\n+  fieldName: string,\n+  onConfigChange: (MessagesWidgetConfig) => Promise<void>,\n+  setLoadingState: (loading: boolean) => void,\n+}\n+\n+const SortIcon: StyledComponent<{fieldSortActive: boolean}, {}, HTMLButtonElement> = styled.button(({ fieldSortActive }) => {\n+  const color = fieldSortActive ? '#333' : '#bdbdbd';\n+\n+  return css`\n+    border: 0;\n+    background: transparent;\n+    color: ${color};\n+\n+    padding: 5px;\n+\n+    cursor: pointer;\n+  `;\n+});\n+\n+const _newSort = (config, fieldName, currentSortDirectioName) => {", "originalCommit": "2e2331f2728d5772371db5bd43ac918deab01d72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0OTQyNQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r388849425", "bodyText": "@dennisoelkers we talked about the usage of an extra class to transform the message sort configs when calling the api. I've tried to create a class which is as simple as possible, but it would be great to hear your opinion on how to define the relation with the SortConfig class. It feels a bit wrong to use e.g. the SortConfig Builder for the fromJSON method.", "author": "linuspahl", "createdAt": "2020-03-06T11:21:02Z", "path": "graylog2-web-interface/src/views/logic/searchtypes/messages/MessageSortConifg.js", "diffHunk": "@@ -0,0 +1,36 @@\n+// @flow strict\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig, { Builder } from 'views/logic/aggregationbuilder/SortConfig';\n+\n+export type MessageSortConifgJson = {\n+  field: string,\n+  order: 'ASC' | 'DESC',\n+};\n+\n+export default class MessageSortConifg {", "originalCommit": "9913f2dbb0394998a162229980fb7a4d217b9716", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU0MTg1MA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389541850", "bodyText": "I think we should extract a common base class that is used by both MessageSortConfig and SortConfig. Maybe it would make sense to rename SortConfig to AggregateSortConfig and use SortConfig as the name for the base class. Shared code would go in there and the two specialized classes would use it internally to hold their state, but customize construction & (de-)serialization.", "author": "dennisoelkers", "createdAt": "2020-03-09T09:25:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0OTQyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUyNDU3Mg==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389524572", "bodyText": "This test case is identical to the next one, so I think we should remove it.", "author": "dennisoelkers", "createdAt": "2020-03-09T08:48:10Z", "path": "graylog2-web-interface/src/views/components/widgets/FieldSortSelect.test.jsx", "diffHunk": "@@ -0,0 +1,39 @@\n+// @flow strict\n+import React from 'react';\n+import { render, cleanup, fireEvent, waitForElement } from 'wrappedTestingLibrary';\n+import { List } from 'immutable';\n+\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import FieldType from 'views/logic/fieldtypes/FieldType';\n+import FieldTypeMapping from 'views/logic/fieldtypes/FieldTypeMapping';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+\n+import FieldSortSelect from './FieldSortSelect';\n+\n+describe('FieldSortSelect', () => {\n+  const properties = ['enumerable'];\n+  const fieldType1 = new FieldType('string', properties, []);\n+  const fieldTypeMapping1 = new FieldTypeMapping('date', fieldType1);\n+  const fieldType2 = new FieldType('string', properties, []);\n+  const fieldTypeMapping2 = new FieldTypeMapping('http_method', fieldType2);\n+  const fields = List([fieldTypeMapping1, fieldTypeMapping2]);\n+  const sort = [new SortConfig('pivot', 'http_method', Direction.Ascending)];\n+\n+  afterEach(cleanup);\n+\n+  it('should render minimal', () => {", "originalCommit": "9913f2dbb0394998a162229980fb7a4d217b9716", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUzODEwNg==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389538106", "bodyText": "I guess we need to wrap that in an <IfInteractive>...</IfInteractive> block?", "author": "dennisoelkers", "createdAt": "2020-03-09T09:17:37Z", "path": "graylog2-web-interface/src/views/components/widgets/MessageTable.jsx", "diffHunk": "@@ -220,6 +229,12 @@ class MessageTable extends React.Component<Props, State> {\n                     <Field type={this._fieldTypeFor(selectedFieldName, fields)}\n                            name={selectedFieldName}\n                            queryId={activeQueryId} />\n+                    {editing && (", "originalCommit": "9913f2dbb0394998a162229980fb7a4d217b9716", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzODMwNw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389638307", "bodyText": "We are using <IfInteractive> only to differentiate between the big display mode. I could create a wrapper like <IfEditing> but we are using the edit check just a few times.", "author": "linuspahl", "createdAt": "2020-03-09T12:48:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUzODEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUzODcxMQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389538711", "bodyText": "There is a typo in the class, file and type names: MessageSortConifg -> MessageSortConfig", "author": "dennisoelkers", "createdAt": "2020-03-09T09:18:46Z", "path": "graylog2-web-interface/src/views/logic/searchtypes/messages/MessageSortConifg.js", "diffHunk": "@@ -0,0 +1,36 @@\n+// @flow strict\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig, { Builder } from 'views/logic/aggregationbuilder/SortConfig';\n+\n+export type MessageSortConifgJson = {", "originalCommit": "9913f2dbb0394998a162229980fb7a4d217b9716", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzOTMyMA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r389639320", "bodyText": "Good catch, thanks.", "author": "linuspahl", "createdAt": "2020-03-09T12:50:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUzODcxMQ=="}], "type": "inlineReview"}, {"oid": "33671b9a937bf8b09b9bd5e94b888cf48db07b42", "url": "https://github.com/Graylog2/graylog2-server/commit/33671b9a937bf8b09b9bd5e94b888cf48db07b42", "message": "Add sort attribute for MessageListConfig", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "e5ebb238a80b4c26100f3dfeea47a36cc2446470", "url": "https://github.com/Graylog2/graylog2-server/commit/e5ebb238a80b4c26100f3dfeea47a36cc2446470", "message": "Add custom sort select for EditMessageList modal", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "a184cfeddf857c14ea2ebef6414c94aa63d2ab76", "url": "https://github.com/Graylog2/graylog2-server/commit/a184cfeddf857c14ea2ebef6414c94aa63d2ab76", "message": "Refactor FieldSortSelect code style", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "f15c210e5155dc2d6bbbee11aaa5bf368bfb0005", "url": "https://github.com/Graylog2/graylog2-server/commit/f15c210e5155dc2d6bbbee11aaa5bf368bfb0005", "message": "Fix EditMessageList fields flow type definition but using Immutable.List instead of Set", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "605014e5135769a3866bb99627b93272264c79b1", "url": "https://github.com/Graylog2/graylog2-server/commit/605014e5135769a3866bb99627b93272264c79b1", "message": "Add FieldSortSelect for EditMessageList component\n\n* Add sort icons for fields in message table head\n* Disable maessage table sort icons for default non-edit view\n* Set timestamp asc as default MessageWidgetConfigSort\n* Show loading spinner when changing sort", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "274a6fa270ee525fa3e58c15f2ee832f7205e3ac", "url": "https://github.com/Graylog2/graylog2-server/commit/274a6fa270ee525fa3e58c15f2ee832f7205e3ac", "message": "Change position of FieldSortSelect in message list edit modal", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "e628958795e90ac9b613090aef90a37a607823b8", "url": "https://github.com/Graylog2/graylog2-server/commit/e628958795e90ac9b613090aef90a37a607823b8", "message": "Change direction of default MessageList sort", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "cae7ab41aebc444198d7a5affd248129655bfdd3", "url": "https://github.com/Graylog2/graylog2-server/commit/cae7ab41aebc444198d7a5affd248129655bfdd3", "message": "Create directory for all message related search type files", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "14ba059ba62b0137635465665429672fb8314c3c", "url": "https://github.com/Graylog2/graylog2-server/commit/14ba059ba62b0137635465665429672fb8314c3c", "message": "Create MessageSortConfig to convert SortConfigs for MessageConfigGenerator", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "3126ceb5c970e8dee3919e690cc9eb7b96b75e17", "url": "https://github.com/Graylog2/graylog2-server/commit/3126ceb5c970e8dee3919e690cc9eb7b96b75e17", "message": "Remove empty line", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "76fd9a6ef223df298dca8ed31892263ad709e674", "url": "https://github.com/Graylog2/graylog2-server/commit/76fd9a6ef223df298dca8ed31892263ad709e674", "message": "Move FieldSortSelect to views components widget directory", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "3394c6681d9eb37f481aeb9d5fbba65d4dd94a98", "url": "https://github.com/Graylog2/graylog2-server/commit/3394c6681d9eb37f481aeb9d5fbba65d4dd94a98", "message": "Move SortDirectionSelect from views components aggregationbuilder to widgets directory", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "366b1edb99e5361dca2d7ff9a7b5f5bef75fb3d7", "url": "https://github.com/Graylog2/graylog2-server/commit/366b1edb99e5361dca2d7ff9a7b5f5bef75fb3d7", "message": "Add basic FieldSortSelect test", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "b45c9b4c03884e8cf6db282a719438ac9bf882b5", "url": "https://github.com/Graylog2/graylog2-server/commit/b45c9b4c03884e8cf6db282a719438ac9bf882b5", "message": "Add title attribute for field sort buttons", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "bd1e2b29a7e8ed9de532af61c252194e90040538", "url": "https://github.com/Graylog2/graylog2-server/commit/bd1e2b29a7e8ed9de532af61c252194e90040538", "message": "Create separate component for message list sort icon", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "fa39219df66aec22a766bec945fcbb7ff2415966", "url": "https://github.com/Graylog2/graylog2-server/commit/fa39219df66aec22a766bec945fcbb7ff2415966", "message": "Remove empty row and fix indentation", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "a873ae0d7063e105fece9fe1bc0a553c2379efb3", "url": "https://github.com/Graylog2/graylog2-server/commit/a873ae0d7063e105fece9fe1bc0a553c2379efb3", "message": "Fix sort direction check when changing direction of default sort", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "10de801ffb4187b34027e13973c2b83eef463617", "url": "https://github.com/Graylog2/graylog2-server/commit/10de801ffb4187b34027e13973c2b83eef463617", "message": "Add test for MessagesSortIcon", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "a93fab67ae6a591723065a59da94283c096acfd2", "url": "https://github.com/Graylog2/graylog2-server/commit/a93fab67ae6a591723065a59da94283c096acfd2", "message": "Rename MessagesSortIcon to FieldSortIcon", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "e0def2b6a40b80bf34e25b4fcaa2c8ce39be6a58", "url": "https://github.com/Graylog2/graylog2-server/commit/e0def2b6a40b80bf34e25b4fcaa2c8ce39be6a58", "message": "Remove not needed sort attribute in MessageListHandler", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "34d52fe46afc2b8c3e82c364a1c389c0efdf1cc1", "url": "https://github.com/Graylog2/graylog2-server/commit/34d52fe46afc2b8c3e82c364a1c389c0efdf1cc1", "message": "Use direaction name instead of full object for consistent comparison", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "c4687cae29c5dc6390aa2f6c470518457faa0221", "url": "https://github.com/Graylog2/graylog2-server/commit/c4687cae29c5dc6390aa2f6c470518457faa0221", "message": "Fix MessageConfigGenerator test", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "80a5f5411d4e4b3c796f1659c335b64f55343f49", "url": "https://github.com/Graylog2/graylog2-server/commit/80a5f5411d4e4b3c796f1659c335b64f55343f49", "message": "Improve usage of default message config sort direction", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "24b581b39f32cddf6fab03adea3610b0f9daf671", "url": "https://github.com/Graylog2/graylog2-server/commit/24b581b39f32cddf6fab03adea3610b0f9daf671", "message": "Remove empty line", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "674f3710ad7018508062ee3a00bf2b239c87eb94", "url": "https://github.com/Graylog2/graylog2-server/commit/674f3710ad7018508062ee3a00bf2b239c87eb94", "message": "Add PropTypes for FieldSortSelect", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "9dfebe0c7bb5cb9bc484dd54fb3a00b145deb6d2", "url": "https://github.com/Graylog2/graylog2-server/commit/9dfebe0c7bb5cb9bc484dd54fb3a00b145deb6d2", "message": "Remove empty row", "committedDate": "2020-03-09T12:24:18Z", "type": "commit"}, {"oid": "9dfebe0c7bb5cb9bc484dd54fb3a00b145deb6d2", "url": "https://github.com/Graylog2/graylog2-server/commit/9dfebe0c7bb5cb9bc484dd54fb3a00b145deb6d2", "message": "Remove empty row", "committedDate": "2020-03-09T12:24:18Z", "type": "forcePushed"}, {"oid": "0188fd7a2b090259a09ef249e571d654d187e2de", "url": "https://github.com/Graylog2/graylog2-server/commit/0188fd7a2b090259a09ef249e571d654d187e2de", "message": "Remove redundant test", "committedDate": "2020-03-09T12:35:42Z", "type": "commit"}, {"oid": "b9dd3d87d7084f55323eacbc781e61e5b702163d", "url": "https://github.com/Graylog2/graylog2-server/commit/b9dd3d87d7084f55323eacbc781e61e5b702163d", "message": "Fix typo by renaming MessageSortConifg to MessageSortConfig", "committedDate": "2020-03-09T12:56:21Z", "type": "commit"}, {"oid": "b9dd3d87d7084f55323eacbc781e61e5b702163d", "url": "https://github.com/Graylog2/graylog2-server/commit/b9dd3d87d7084f55323eacbc781e61e5b702163d", "message": "Fix typo by renaming MessageSortConifg to MessageSortConfig", "committedDate": "2020-03-09T12:56:21Z", "type": "forcePushed"}, {"oid": "6df405569fae17f6231fce71cc51f3cd1fd49ffe", "url": "https://github.com/Graylog2/graylog2-server/commit/6df405569fae17f6231fce71cc51f3cd1fd49ffe", "message": "Add missing prop in MessageList test", "committedDate": "2020-03-09T14:51:20Z", "type": "commit"}, {"oid": "01fa0d4710635ed7ad2ce1439948f813fd59ef1f", "url": "https://github.com/Graylog2/graylog2-server/commit/01fa0d4710635ed7ad2ce1439948f813fd59ef1f", "message": "Refactor FieldSortIcon code style", "committedDate": "2020-03-10T08:19:52Z", "type": "commit"}, {"oid": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "url": "https://github.com/Graylog2/graylog2-server/commit/90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "message": "Disable delay for widget header loading spinner", "committedDate": "2020-03-10T08:26:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NDUwNQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390294505", "bodyText": "Instead of doing this, you could implement equals in the Direction class and use it to compare them. So it would looks like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              icon: defaultSortDirection.direction === Direction.Descending.direction ? StateDesc.icon : StateAsc.icon,\n          \n          \n            \n              icon: Direction.Descending.equals(defaultSortDirection) ? StateDesc.icon : StateAsc.icon,\n          \n      \n    \n    \n  \n\nThe benefit is that we want to find out if they are equal, but do not care about their internal structure.", "author": "dennisoelkers", "createdAt": "2020-03-10T13:00:21Z", "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -31,61 +38,66 @@ const SortIcon: StyledComponent<{fieldSortActive: boolean}, {}, HTMLButtonElemen\n   `;\n });\n \n-const _newSort = (config, fieldName, currentSortDirectioName) => {\n-  switch (currentSortDirectioName) {\n-    case Direction.Ascending.direction:\n-      return config.sort.map(sort => sort.toBuilder().direction(Direction.Descending).build());\n-    case Direction.Descending.direction:\n-      return config.sort.map(sort => sort.toBuilder().direction(Direction.Ascending).build());\n-    default:\n-      return [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, defaultSortDirection)];\n-  }\n+const _tooltip = (fieldName: string, newDirection: Direction) => {\n+  return `Sort ${fieldName} ${newDirection.direction}`;\n };\n \n-const _changeSort = (config: MessagesWidgetConfig, fieldName: string, sortDirectionName: ?DirectionJson, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+const _changeSort = (nextDirection: Direction, config: MessagesWidgetConfig, fieldName: string, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+  const nextSort = [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, nextDirection)];\n+  const newConfig = config.toBuilder().sort(nextSort).build();\n   setLoadingState(true);\n-  const newSort = _newSort(config, fieldName, sortDirectionName);\n-  const newConfig = config.toBuilder().sort(newSort).build();\n   onConfigChange(newConfig).then(() => {\n     setLoadingState(false);\n   });\n };\n \n-const _sortDirectionName = (config: MessagesWidgetConfig, fieldName: string) => {\n-  const currentSort = config.sort && config.sort.length > 0 ? config.sort[0] : null;\n-  if (currentSort && currentSort.field === fieldName) {\n-    return currentSort.direction.direction;\n-  }\n-  return null;\n+const _isFieldSortActive = (config: MessagesWidgetConfig, fieldName: string) => {\n+  return config.sort && config.sort.length > 0 && config.sort[0].field === fieldName;\n };\n \n-const _newSortDescription = (fielName: string, sortDirectionName: ?DirectionJson) => {\n-  let newDirection;\n-  if (sortDirectionName && sortDirectionName === Direction.Ascending) {\n-    newDirection = Direction.Descending.direction;\n-  } else {\n-    newDirection = Direction.Ascending.direction;\n-  }\n-  return `Sort ${fielName} ${newDirection}`;\n+const StateAsc: CurrentState = {\n+  icon: 'sort-amount-asc',\n+  tooltip: (fieldName: string) => _tooltip(fieldName, Direction.Descending),\n+  onSortChange: changeSort => changeSort(Direction.Descending),\n+  sortActive: true,\n };\n \n-const _sortIcon = (fieldSortDirection: ?DirectionJson) => {\n-  if (fieldSortDirection && fieldSortDirection === Direction.Ascending.direction) {\n-    return 'sort-amount-asc';\n+const StateDesc: CurrentState = {\n+  icon: 'sort-amount-desc',\n+  tooltip: (fieldName: string) => _tooltip(fieldName, Direction.Ascending),\n+  onSortChange: changeSort => changeSort(Direction.Ascending),\n+  sortActive: true,\n+};\n+\n+const StateNoSort: CurrentState = {\n+  icon: defaultSortDirection.direction === Direction.Descending.direction ? StateDesc.icon : StateAsc.icon,", "originalCommit": "01fa0d4710635ed7ad2ce1439948f813fd59ef1f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NjI3Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390296276", "bodyText": "This should be a non-static instance method that just returns the inversion of the current Direction.\nIt could look like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              static invert(direction: Direction) {\n          \n          \n            \n              invert(): Direction {\n          \n          \n            \n                return Descending.equals(this) ? this.Ascending : this.Descending;\n          \n          \n            \n              }", "author": "dennisoelkers", "createdAt": "2020-03-10T13:03:35Z", "path": "graylog2-web-interface/src/views/logic/aggregationbuilder/Direction.js", "diffHunk": "@@ -20,6 +20,10 @@ export default class Direction {\n     return this._direction;\n   }\n \n+  static invert(direction: Direction) {", "originalCommit": "01fa0d4710635ed7ad2ce1439948f813fd59ef1f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5NjY3MA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390296670", "bodyText": "There is a typo: fielSortDirection -> fieldSortDirection", "author": "dennisoelkers", "createdAt": "2020-03-10T13:04:17Z", "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -31,61 +38,66 @@ const SortIcon: StyledComponent<{fieldSortActive: boolean}, {}, HTMLButtonElemen\n   `;\n });\n \n-const _newSort = (config, fieldName, currentSortDirectioName) => {\n-  switch (currentSortDirectioName) {\n-    case Direction.Ascending.direction:\n-      return config.sort.map(sort => sort.toBuilder().direction(Direction.Descending).build());\n-    case Direction.Descending.direction:\n-      return config.sort.map(sort => sort.toBuilder().direction(Direction.Ascending).build());\n-    default:\n-      return [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, defaultSortDirection)];\n-  }\n+const _tooltip = (fieldName: string, newDirection: Direction) => {\n+  return `Sort ${fieldName} ${newDirection.direction}`;\n };\n \n-const _changeSort = (config: MessagesWidgetConfig, fieldName: string, sortDirectionName: ?DirectionJson, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+const _changeSort = (nextDirection: Direction, config: MessagesWidgetConfig, fieldName: string, onConfigChange: (MessagesWidgetConfig) => Promise<void>, setLoadingState: (loading: boolean) => void) => {\n+  const nextSort = [new SortConfig(SortConfig.PIVOT_TYPE, fieldName, nextDirection)];\n+  const newConfig = config.toBuilder().sort(nextSort).build();\n   setLoadingState(true);\n-  const newSort = _newSort(config, fieldName, sortDirectionName);\n-  const newConfig = config.toBuilder().sort(newSort).build();\n   onConfigChange(newConfig).then(() => {\n     setLoadingState(false);\n   });\n };\n \n-const _sortDirectionName = (config: MessagesWidgetConfig, fieldName: string) => {\n-  const currentSort = config.sort && config.sort.length > 0 ? config.sort[0] : null;\n-  if (currentSort && currentSort.field === fieldName) {\n-    return currentSort.direction.direction;\n-  }\n-  return null;\n+const _isFieldSortActive = (config: MessagesWidgetConfig, fieldName: string) => {\n+  return config.sort && config.sort.length > 0 && config.sort[0].field === fieldName;\n };\n \n-const _newSortDescription = (fielName: string, sortDirectionName: ?DirectionJson) => {\n-  let newDirection;\n-  if (sortDirectionName && sortDirectionName === Direction.Ascending) {\n-    newDirection = Direction.Descending.direction;\n-  } else {\n-    newDirection = Direction.Ascending.direction;\n-  }\n-  return `Sort ${fielName} ${newDirection}`;\n+const StateAsc: CurrentState = {\n+  icon: 'sort-amount-asc',\n+  tooltip: (fieldName: string) => _tooltip(fieldName, Direction.Descending),\n+  onSortChange: changeSort => changeSort(Direction.Descending),\n+  sortActive: true,\n };\n \n-const _sortIcon = (fieldSortDirection: ?DirectionJson) => {\n-  if (fieldSortDirection && fieldSortDirection === Direction.Ascending.direction) {\n-    return 'sort-amount-asc';\n+const StateDesc: CurrentState = {\n+  icon: 'sort-amount-desc',\n+  tooltip: (fieldName: string) => _tooltip(fieldName, Direction.Ascending),\n+  onSortChange: changeSort => changeSort(Direction.Ascending),\n+  sortActive: true,\n+};\n+\n+const StateNoSort: CurrentState = {\n+  icon: defaultSortDirection.direction === Direction.Descending.direction ? StateDesc.icon : StateAsc.icon,\n+  tooltip: (fieldName: string) => _tooltip(fieldName, defaultSortDirection),\n+  onSortChange: changeSort => changeSort(defaultSortDirection),\n+  sortActive: false,\n+};\n+\n+const _currentState = (config: MessagesWidgetConfig, fieldName: string) => {\n+  const fielSortDirection = _isFieldSortActive(config, fieldName) ? config.sort[0].direction.direction : null;", "originalCommit": "01fa0d4710635ed7ad2ce1439948f813fd59ef1f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMxOTk4MQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390319981", "bodyText": "An alternative that avoids using Immutable (which is used only for first() here):\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const sortDirection = Immutable.Set(sort.map(s => s.direction)).first();\n          \n          \n            \n              const [sortDirection] = sort.map(s => s.direction);\n          \n      \n    \n    \n  \n\nIf sort could be undefined, it would need to be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const sortDirection = Immutable.Set(sort.map(s => s.direction)).first();\n          \n          \n            \n              const [sortDirection] = (sort || []).map(s => s.direction);\n          \n      \n    \n    \n  \n\nOr we could assign a default in the line above.", "author": "dennisoelkers", "createdAt": "2020-03-10T13:41:34Z", "path": "graylog2-web-interface/src/views/components/widgets/EditMessageList.jsx", "diffHunk": "@@ -34,14 +38,26 @@ const _onShowMessageRowChanged = (config, onChange) => {\n   return onChange(newConfig);\n };\n \n+const _onSortChange = (sort: $PropertyType<AggregationWidgetConfig, 'sort'>, config, onChange) => {\n+  const newConfig = config.toBuilder().sort(sort).build();\n+  return onChange(newConfig);\n+};\n+\n+const _onSortDirectionChange = (direction: $PropertyType<AggregationWidgetConfig, 'direction'>, config, onChange) => {\n+  const newConfig = config.toBuilder().sort(config.sort.map(sort => sort.toBuilder().direction(direction).build())).build();\n+  return onChange(newConfig);\n+};\n+\n type Props = {\n   children: React.Node,\n   config: MessagesWidgetConfig,\n-  fields: Immutable.Set<FieldTypeMapping>,\n+  fields: Immutable.List<FieldTypeMapping>,\n   onChange: (MessagesWidgetConfig) => void,\n };\n \n const EditMessageList = ({ children, config, fields, onChange }: Props) => {\n+  const { sort } = config;\n+  const sortDirection = Immutable.Set(sort.map(s => s.direction)).first();", "originalCommit": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyMjQwMw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390322403", "bodyText": "CurrentState is too generic. Maybe DirectionStrategy is better? Same for the other *State namings in this component.", "author": "dennisoelkers", "createdAt": "2020-03-10T13:45:01Z", "path": "graylog2-web-interface/src/views/components/widgets/FieldSortIcon.jsx", "diffHunk": "@@ -0,0 +1,112 @@\n+// @flow strict\n+import React from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import PropTypes from 'prop-types';\n+\n+import MessagesWidgetConfig, { defaultSortDirection } from 'views/logic/widgets/MessagesWidgetConfig';\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig from 'views/logic/aggregationbuilder/SortConfig';\n+import CustomPropTypes from 'views/components/CustomPropTypes';\n+\n+import { Icon } from 'components/common';\n+\n+type Props = {\n+  config: MessagesWidgetConfig,\n+  fieldName: string,\n+  onConfigChange: (MessagesWidgetConfig) => Promise<void>,\n+  setLoadingState: (loading: boolean) => void,\n+}\n+\n+type CurrentState = {", "originalCommit": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyNjA2OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390326069", "bodyText": "The indentation is off here. I don't know why ESLint does not complain about this, seems like it is  not enforcing it for flow types.", "author": "dennisoelkers", "createdAt": "2020-03-10T13:50:21Z", "path": "graylog2-web-interface/src/views/components/widgets/MessageList.jsx", "diffHunk": "@@ -42,35 +42,39 @@ type State = {\n }\n \n type Props = {\n-  fields: FieldTypeMappingsList,\n-  pageSize: number,\n   config: MessagesWidgetConfig,\n+    currentView: {", "originalCommit": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyODIwNA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390328204", "bodyText": "Maybe it makes sense to use a onSortChange function instead, which returns the new set of sort configs? This way the MessageTable widget does not need to know how to change the structure of the message widget config.", "author": "dennisoelkers", "createdAt": "2020-03-10T13:53:21Z", "path": "graylog2-web-interface/src/views/components/widgets/MessageList.jsx", "diffHunk": "@@ -42,35 +42,39 @@ type State = {\n }\n \n type Props = {\n-  fields: FieldTypeMappingsList,\n-  pageSize: number,\n   config: MessagesWidgetConfig,\n+    currentView: {\n+      activeQuery: string,\n+      view: {\n+        id: number,\n+      },\n+    },\n   data: { messages: Array<Object>, total: number, id: string },\n-  selectedFields?: Immutable.Set<string>,\n+  editing: boolean,\n+  fields: FieldTypeMappingsList,\n+  onConfigChange: (MessagesWidgetConfig) => Promise<void>,", "originalCommit": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5ODE5NQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390898195", "bodyText": "I've created a onSortChange method inside the MessageList, so FieldSortIcon does not need to know how to change the config. But I did not changed onConfigChange in Widget.jsx because all widgets are receiving this function and I thought onSortChange` would be too specific.", "author": "linuspahl", "createdAt": "2020-03-11T11:10:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyODIwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyODgxNg==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390328816", "bodyText": "Having to add that in all the tests could have been prevented by using a default value for the prop.", "author": "dennisoelkers", "createdAt": "2020-03-10T13:54:12Z", "path": "graylog2-web-interface/src/views/components/widgets/MessageList.test.jsx", "diffHunk": "@@ -108,6 +108,7 @@ describe('MessageList', () => {\n     const wrapper1 = mount(<MessageList editing\n                                         data={data}\n                                         config={config}\n+                                        onConfigChange={() => {}}", "originalCommit": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4Nzc3Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390887776", "bodyText": "I've implemented this change, but out of interest: When we define a default prop for onConfigChange we need to remove the .isRequired PropType definition. And is it worth it? Without onConfigChange the component would not work properly and I would expect a PropType error, when using the component without all necessary attributes.", "author": "linuspahl", "createdAt": "2020-03-11T10:51:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyODgxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkyMzM3Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390923377", "bodyText": "I think it does still work properly. You just cannot change its config, turning it into a read-only component.\nGenerally: If we consider it to be a bigger risk that we are forgetting to add the new prop in a place and therefore want to be warned about it (either by flow or through a prop types warning), then we should not add a default prop. In this case the number of places where we are reusing the component is very small, so chances are small that we are forgetting it.\nAlso, coming back to the original issue of having to add new props in lots of places in a test suite: Another pattern might be to define a central place in the test suite where the component is rendered, something like this:\nconst renderMessageList = (props} => mount(<MessageList editing data={data} .... {...props />);\n\nThis way you can have a central set of default props where you are adding a new one, but you can still override individual ones in the individual tests.", "author": "dennisoelkers", "createdAt": "2020-03-11T12:02:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMyODgxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MzQ5NQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390343495", "bodyText": "I think there is no benefit reusing SortConfig here. Instead, we could just store the field/direction values in internal fields (we do not even need getters for them) and just define the JSON (de-)serialization format in here.", "author": "dennisoelkers", "createdAt": "2020-03-10T14:14:36Z", "path": "graylog2-web-interface/src/views/logic/searchtypes/messages/MessageSortConfig.js", "diffHunk": "@@ -0,0 +1,36 @@\n+// @flow strict\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig, { Builder } from 'views/logic/aggregationbuilder/SortConfig';\n+\n+export type MessageSortConfigJson = {\n+  field: string,\n+  order: 'ASC' | 'DESC',\n+};\n+\n+export default class MessageSortConfig {\n+  _value: SortConfig\n+\n+  constructor(type: string, field: string, direction: Direction) {\n+    this._value = new SortConfig(type, field, direction);", "originalCommit": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0MzcwNA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7645#discussion_r390343704", "bodyText": "This actually returns a SortConfig instead of a MessageSortConfig.", "author": "dennisoelkers", "createdAt": "2020-03-10T14:14:53Z", "path": "graylog2-web-interface/src/views/logic/searchtypes/messages/MessageSortConfig.js", "diffHunk": "@@ -0,0 +1,36 @@\n+// @flow strict\n+import Direction from 'views/logic/aggregationbuilder/Direction';\n+import SortConfig, { Builder } from 'views/logic/aggregationbuilder/SortConfig';\n+\n+export type MessageSortConfigJson = {\n+  field: string,\n+  order: 'ASC' | 'DESC',\n+};\n+\n+export default class MessageSortConfig {\n+  _value: SortConfig\n+\n+  constructor(type: string, field: string, direction: Direction) {\n+    this._value = new SortConfig(type, field, direction);\n+  }\n+\n+  toJSON(): MessageSortConfigJson {\n+    const { field, direction } = this._value;\n+\n+    return {\n+      field,\n+      order: direction === Direction.Ascending ? 'ASC' : 'DESC',\n+    };\n+  }\n+\n+  static fromJSON(value: MessageSortConfigJson) {\n+    const { field, order } = value;\n+\n+    // eslint-disable-next-line no-use-before-define\n+    return new Builder()", "originalCommit": "90c514bccb38baf5d1d4b6c1d575d7d0795d93ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "20611b85d11e1bae8ce11ff329cb6a975ff0c997", "url": "https://github.com/Graylog2/graylog2-server/commit/20611b85d11e1bae8ce11ff329cb6a975ff0c997", "message": "Remove not needed Direction invert method", "committedDate": "2020-03-11T09:55:48Z", "type": "commit"}, {"oid": "103aa5176269cd42214d0c43b51c980b6aeabbdf", "url": "https://github.com/Graylog2/graylog2-server/commit/103aa5176269cd42214d0c43b51c980b6aeabbdf", "message": "Implement equals method for Direction class", "committedDate": "2020-03-11T10:03:01Z", "type": "commit"}, {"oid": "bab4c48bb660d6f0d7c96f33ca8a1a76b1100571", "url": "https://github.com/Graylog2/graylog2-server/commit/bab4c48bb660d6f0d7c96f33ca8a1a76b1100571", "message": "Fix typo", "committedDate": "2020-03-11T10:05:01Z", "type": "commit"}, {"oid": "c1800417edda753322d8ee090f53a9aa93a21f0e", "url": "https://github.com/Graylog2/graylog2-server/commit/c1800417edda753322d8ee090f53a9aa93a21f0e", "message": "Improve extraction of current sort direction in EditMessageList", "committedDate": "2020-03-11T10:07:30Z", "type": "commit"}, {"oid": "fe9bda1ae3f7fd2a1999cf58b3e3b724142d0a33", "url": "https://github.com/Graylog2/graylog2-server/commit/fe9bda1ae3f7fd2a1999cf58b3e3b724142d0a33", "message": "Use DirectionStrategy instead of CurrentState for FieldSortIcon strategy", "committedDate": "2020-03-11T10:10:34Z", "type": "commit"}, {"oid": "60447e416a8ddafae291720cb42e2c01baddccd5", "url": "https://github.com/Graylog2/graylog2-server/commit/60447e416a8ddafae291720cb42e2c01baddccd5", "message": "Fix indentation", "committedDate": "2020-03-11T10:11:32Z", "type": "commit"}, {"oid": "192bd74ff0e6f984b2b6509f373168abe6ce58ff", "url": "https://github.com/Graylog2/graylog2-server/commit/192bd74ff0e6f984b2b6509f373168abe6ce58ff", "message": "Use default prop for MessageList onConfigChange", "committedDate": "2020-03-11T10:14:38Z", "type": "commit"}, {"oid": "eb97cfe5bb0b12b2b00a2a5e5c13c7524dce6127", "url": "https://github.com/Graylog2/graylog2-server/commit/eb97cfe5bb0b12b2b00a2a5e5c13c7524dce6127", "message": "Only use MessageWidgetConfig for de-/serialization", "committedDate": "2020-03-11T10:28:10Z", "type": "commit"}, {"oid": "c3748b9d8c0ca8b372f7dca6ecf50d1195141ba5", "url": "https://github.com/Graylog2/graylog2-server/commit/c3748b9d8c0ca8b372f7dca6ecf50d1195141ba5", "message": "Extract sort config change from FieldSortIcon and move logic to MessageList", "committedDate": "2020-03-11T11:00:35Z", "type": "commit"}, {"oid": "0080d3462284efdf277b957307e325857ed669aa", "url": "https://github.com/Graylog2/graylog2-server/commit/0080d3462284efdf277b957307e325857ed669aa", "message": "Add and remove row", "committedDate": "2020-03-11T11:03:02Z", "type": "commit"}]}