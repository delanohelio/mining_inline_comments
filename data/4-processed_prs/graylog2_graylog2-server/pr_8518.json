{"pr_number": 8518, "pr_title": "Implement dependency permission check", "pr_createdAt": "2020-07-09T13:26:14Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8518", "timeline": [{"oid": "51619ebccc4230038263d6f5d8e887e592e05e70", "url": "https://github.com/Graylog2/graylog2-server/commit/51619ebccc4230038263d6f5d8e887e592e05e70", "message": "Implement dependency permission check", "committedDate": "2020-07-09T13:08:18Z", "type": "commit"}, {"oid": "095fb53b18e281a2fa896854cac8d4c4fa6533e2", "url": "https://github.com/Graylog2/graylog2-server/commit/095fb53b18e281a2fa896854cac8d4c4fa6533e2", "message": "Rename \"missing_dependencies\" to \"missing_permissions_on_dependencies\"\n\nThe previous name was wrong.", "committedDate": "2020-07-09T13:12:57Z", "type": "commit"}, {"oid": "5ac8c7f1989201a3f33ef2201154cb5bb7508a99", "url": "https://github.com/Graylog2/graylog2-server/commit/5ac8c7f1989201a3f33ef2201154cb5bb7508a99", "message": "Move GRN classes into org.graylog.grn package\n\nAlso add GRNType to GRN and remove permissionPrefix from GRN. (it's\nalready in GRNType)", "committedDate": "2020-07-10T07:50:36Z", "type": "commit"}, {"oid": "e16985676e28e4e2a9eff40e6803b19b6744dec8", "url": "https://github.com/Graylog2/graylog2-server/commit/e16985676e28e4e2a9eff40e6803b19b6744dec8", "message": "Add GRN descriptor service\n\nThis can be used to get a descriptor with metadata for a given GRN.\n(e.g. the entity title)", "committedDate": "2020-07-10T07:51:55Z", "type": "commit"}, {"oid": "940e49c095045291e39444d70ef950102354b4da", "url": "https://github.com/Graylog2/graylog2-server/commit/940e49c095045291e39444d70ef950102354b4da", "message": "Lookup owners for entity dependencies", "committedDate": "2020-07-10T08:32:53Z", "type": "commit"}, {"oid": "4b9b312d8b5abe7b2b832a616fc676c32f4c9ef3", "url": "https://github.com/Graylog2/graylog2-server/commit/4b9b312d8b5abe7b2b832a616fc676c32f4c9ef3", "message": "Merge branch 'feature/permissions' into share-dependency-permission-check", "committedDate": "2020-07-10T12:54:03Z", "type": "commit"}, {"oid": "e29ebd21f0bb9f3fa9f2c331a582fc03c939cfd3", "url": "https://github.com/Graylog2/graylog2-server/commit/e29ebd21f0bb9f3fa9f2c331a582fc03c939cfd3", "message": "Add GRN type for event definitions", "committedDate": "2020-07-14T07:37:20Z", "type": "commit"}, {"oid": "4f342ca6f5af07f817ab171cf496d445bda2008e", "url": "https://github.com/Graylog2/graylog2-server/commit/4f342ca6f5af07f817ab171cf496d445bda2008e", "message": "Also register EVENT_DEFINITION in GRNModule", "committedDate": "2020-07-14T07:50:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE5MzY2Nw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8518#discussion_r454193667", "bodyText": "This will potentially build a \"user\" with the principal of a team..\nWe need to solve this sooner or later..", "author": "mpfz0r", "createdAt": "2020-07-14T08:32:42Z", "path": "graylog2-server/src/main/java/org/graylog/security/UserAuthorizer.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog.security;\n+\n+import com.google.inject.assistedinject.Assisted;\n+import org.apache.shiro.mgt.DefaultSecurityManager;\n+import org.apache.shiro.subject.SimplePrincipalCollection;\n+import org.apache.shiro.subject.Subject;\n+import org.graylog.grn.GRN;\n+\n+import javax.inject.Inject;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static org.apache.commons.lang3.StringUtils.isNotBlank;\n+\n+public class UserAuthorizer {\n+    public interface Factory {\n+        UserAuthorizer create(GRN grantee);\n+    }\n+\n+    private final Subject subject;\n+\n+    @Inject\n+    public UserAuthorizer(DefaultSecurityManager securityManager, @Assisted GRN grantee) {\n+        this.subject = new Subject.Builder(securityManager)\n+                .principals(new SimplePrincipalCollection(grantee.entity(), \"UserAuthorizer\"))", "originalCommit": "4f342ca6f5af07f817ab171cf496d445bda2008e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg2ODIwMw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8518#discussion_r454868203", "bodyText": "I refactored the code to also handle teams in the future.", "author": "bernd", "createdAt": "2020-07-15T08:05:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE5MzY2Nw=="}], "type": "inlineReview"}, {"oid": "cc3272f8f242ffd790350a0d613ccca0be80afd6", "url": "https://github.com/Graylog2/graylog2-server/commit/cc3272f8f242ffd790350a0d613ccca0be80afd6", "message": "Refactor authorizer and permission resolver to handle generic principals\n\nPreviously it handled only users, not it's possible to authorize teams\nand the global team as well.", "committedDate": "2020-07-15T08:03:55Z", "type": "commit"}]}