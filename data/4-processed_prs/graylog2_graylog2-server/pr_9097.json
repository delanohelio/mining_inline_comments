{"pr_number": 9097, "pr_title": "Moving Date Picker to Popover", "pr_createdAt": "2020-10-06T14:35:56Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/9097", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk0NDQ1NQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/9097#discussion_r501944455", "bodyText": "Happy to discuss if there better options for this!", "author": "kyleknighted", "createdAt": "2020-10-08T18:56:34Z", "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeDisplay.jsx", "diffHunk": "@@ -0,0 +1,101 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useRef, useState } from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import moment from 'moment';\n+\n+import { type ThemeInterface } from 'theme';\n+import { type TimeRange } from 'views/logic/queries/Query';\n+import StoreProvider from 'injection/StoreProvider';\n+\n+type Props = {|\n+  timerange: ?TimeRange,\n+|};\n+\n+const EMPTY_RANGE = '----/--/-- --:--:--.---';\n+const EMPTY_OUTPUT = { from: EMPTY_RANGE, until: EMPTY_RANGE };\n+\n+const ToolsStore = StoreProvider.getStore('Tools');\n+\n+const TimeRangeWrapper: StyledComponent<{}, ThemeInterface, HTMLParagraphElement> = styled.p(({ theme }) => css`\n+  width: 100%;\n+  padding: 3px 9px;\n+  margin: 0 12px;\n+  display: flex;\n+  justify-content: space-around;\n+  background-color: ${theme.colors.variant.lightest.primary};\n+  align-items: center;\n+  border-radius: 4px;\n+  \n+  > span {\n+    flex: 1;\n+  }\n+  \n+  code {\n+    color: ${theme.colors.variant.dark.primary};\n+    background: transparent;\n+    font-size: ${theme.fonts.size.body};\n+  }\n+`);\n+\n+const dateOutput = (timerange: TimeRange) => {\n+  let from = EMPTY_RANGE;\n+\n+  switch (timerange.type) {\n+    case 'relative':\n+      from = !timerange.range ? 'All Time' : moment()\n+        .subtract(timerange.range * 1000)\n+        .fromNow();\n+\n+      return {\n+        from,\n+        until: 'Now',\n+      };\n+\n+    case 'absolute':\n+    case 'keyword':\n+      return { from: timerange.from, until: timerange.to };\n+    default:\n+      return { from, until: from };\n+  }\n+};\n+\n+const TimeRangeDisplay = ({ timerange }: Props) => {\n+  const [{ from, until }, setTimeOutput] = useState(EMPTY_OUTPUT);\n+  const dateTested = useRef(false);\n+\n+  useEffect(() => {\n+    if (timerange?.type === 'keyword' && !timerange.from) {\n+      if (!dateTested.current) {\n+        ToolsStore.testNaturalDate(timerange.keyword)\n+          .then((response) => {\n+            dateTested.current = true;\n+\n+            setTimeOutput({\n+              from: response.from,\n+              until: response.to,\n+            });\n+          }, () => {\n+            setTimeOutput(EMPTY_OUTPUT);\n+          });\n+      }\n+    } else if (timerange?.type) {\n+      setTimeOutput(dateOutput(timerange));\n+    }\n+  }, [dateTested, timerange]);", "originalCommit": "88496adc607b21685a37b7d67f054078aa94b640", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExMTk4Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/9097#discussion_r503111986", "bodyText": "If I am not mistaken default should throw an error. If someone is adding a new timerange type he would be thankful if the code is leading him to the places where he needs to insert the new type. And the current default should never occur otherwise.", "author": "kmerz", "createdAt": "2020-10-12T08:08:27Z", "path": "graylog2-web-interface/src/views/components/searchbar/TimeRangeDisplay.jsx", "diffHunk": "@@ -0,0 +1,101 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useEffect, useRef, useState } from 'react';\n+import styled, { css, type StyledComponent } from 'styled-components';\n+import moment from 'moment';\n+\n+import { type ThemeInterface } from 'theme';\n+import { type TimeRange } from 'views/logic/queries/Query';\n+import StoreProvider from 'injection/StoreProvider';\n+\n+type Props = {|\n+  timerange: ?TimeRange,\n+|};\n+\n+const EMPTY_RANGE = '----/--/-- --:--:--.---';\n+const EMPTY_OUTPUT = { from: EMPTY_RANGE, until: EMPTY_RANGE };\n+\n+const ToolsStore = StoreProvider.getStore('Tools');\n+\n+const TimeRangeWrapper: StyledComponent<{}, ThemeInterface, HTMLParagraphElement> = styled.p(({ theme }) => css`\n+  width: 100%;\n+  padding: 3px 9px;\n+  margin: 0 12px;\n+  display: flex;\n+  justify-content: space-around;\n+  background-color: ${theme.colors.variant.lightest.primary};\n+  align-items: center;\n+  border-radius: 4px;\n+  \n+  > span {\n+    flex: 1;\n+  }\n+  \n+  code {\n+    color: ${theme.colors.variant.dark.primary};\n+    background: transparent;\n+    font-size: ${theme.fonts.size.body};\n+  }\n+`);\n+\n+const dateOutput = (timerange: TimeRange) => {\n+  let from = EMPTY_RANGE;\n+\n+  switch (timerange.type) {\n+    case 'relative':\n+      from = !timerange.range ? 'All Time' : moment()\n+        .subtract(timerange.range * 1000)\n+        .fromNow();\n+\n+      return {\n+        from,\n+        until: 'Now',\n+      };\n+\n+    case 'absolute':\n+    case 'keyword':\n+      return { from: timerange.from, until: timerange.to };\n+    default:", "originalCommit": "88496adc607b21685a37b7d67f054078aa94b640", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDkxNTgxNw==", "url": "https://github.com/Graylog2/graylog2-server/pull/9097#discussion_r504915817", "bodyText": "Updated!", "author": "kyleknighted", "createdAt": "2020-10-14T19:20:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExMTk4Ng=="}], "type": "inlineReview"}, {"oid": "5e102223309435cff4465a427379316103f84bd0", "url": "https://github.com/Graylog2/graylog2-server/commit/5e102223309435cff4465a427379316103f84bd0", "message": "Migrating original range options to Popover", "committedDate": "2020-10-22T17:57:03Z", "type": "commit"}, {"oid": "640096b000e85b5cfb72ada27e72075284baa8f7", "url": "https://github.com/Graylog2/graylog2-server/commit/640096b000e85b5cfb72ada27e72075284baa8f7", "message": "Converting existing DateTimePicker to Popover", "committedDate": "2020-10-22T17:57:03Z", "type": "commit"}, {"oid": "d6fa8e3e25cf6603593ba638b5957f0795f9d435", "url": "https://github.com/Graylog2/graylog2-server/commit/d6fa8e3e25cf6603593ba638b5957f0795f9d435", "message": "Styling TimeRangeDisplay", "committedDate": "2020-10-22T17:57:03Z", "type": "commit"}, {"oid": "2cebfa5a66514bbdfe5074bbd984c6285775c932", "url": "https://github.com/Graylog2/graylog2-server/commit/2cebfa5a66514bbdfe5074bbd984c6285775c932", "message": "Flow Tests", "committedDate": "2020-10-22T17:57:03Z", "type": "commit"}, {"oid": "ac35859933fd37d27b6040895d057f677c7d65ff", "url": "https://github.com/Graylog2/graylog2-server/commit/ac35859933fd37d27b6040895d057f677c7d65ff", "message": "Some Cleanup", "committedDate": "2020-10-22T17:57:03Z", "type": "commit"}, {"oid": "25112b1e7dbef5ad6dc0da649911ec1682ace5cf", "url": "https://github.com/Graylog2/graylog2-server/commit/25112b1e7dbef5ad6dc0da649911ec1682ace5cf", "message": "temp -> tempTimeRange", "committedDate": "2020-10-22T17:57:04Z", "type": "commit"}, {"oid": "9e009404c1bec47b91264f839d5928af7c7e347c", "url": "https://github.com/Graylog2/graylog2-server/commit/9e009404c1bec47b91264f839d5928af7c7e347c", "message": "Linting", "committedDate": "2020-10-22T17:57:04Z", "type": "commit"}, {"oid": "86688606af936dd08f485400ab5f8bc6b7adc551", "url": "https://github.com/Graylog2/graylog2-server/commit/86688606af936dd08f485400ab5f8bc6b7adc551", "message": "Keyword output", "committedDate": "2020-10-22T17:57:04Z", "type": "commit"}, {"oid": "c037d11c9c01417be177e6c0fba47f38b4d255f6", "url": "https://github.com/Graylog2/graylog2-server/commit/c037d11c9c01417be177e6c0fba47f38b4d255f6", "message": "All time ranges loading properly", "committedDate": "2020-10-22T17:57:04Z", "type": "commit"}, {"oid": "63ccc2381306ed2d42961ceacae743bc17e867ce", "url": "https://github.com/Graylog2/graylog2-server/commit/63ccc2381306ed2d42961ceacae743bc17e867ce", "message": "react hook linting", "committedDate": "2020-10-22T17:57:04Z", "type": "commit"}, {"oid": "082af7acca570773fb673f66300a25caa8fe44ef", "url": "https://github.com/Graylog2/graylog2-server/commit/082af7acca570773fb673f66300a25caa8fe44ef", "message": "lint weak objects", "committedDate": "2020-10-22T17:57:04Z", "type": "commit"}, {"oid": "92d1e3ac551832c94925c2fa6ae07648794c47b2", "url": "https://github.com/Graylog2/graylog2-server/commit/92d1e3ac551832c94925c2fa6ae07648794c47b2", "message": "Error on TimeRangeDisplay default type", "committedDate": "2020-10-22T17:57:04Z", "type": "commit"}, {"oid": "92d1e3ac551832c94925c2fa6ae07648794c47b2", "url": "https://github.com/Graylog2/graylog2-server/commit/92d1e3ac551832c94925c2fa6ae07648794c47b2", "message": "Error on TimeRangeDisplay default type", "committedDate": "2020-10-22T17:57:04Z", "type": "forcePushed"}]}