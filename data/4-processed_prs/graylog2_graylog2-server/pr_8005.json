{"pr_number": 8005, "pr_title": "Sidecar Clone Configuration option", "pr_createdAt": "2020-04-29T18:12:22Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8005", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyNDY3NQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419424675", "bodyText": "The validation parameter will not always have those fields, and it may even be an empty object. Trying to destructure it will result in an error.\nUnhandled rejection TypeError: Invalid attempt to destructure non-iterable instance\nat _nonIterableRest (http://localhost:8080/7c9d6ab7-32.js:1273:37)\nat _slicedToArray (http://localhost:8080/7c9d6ab7-32.js:1271:99)\nat http://localhost:8080/7c9d6ab7-32.js:1392:37", "author": "edmundoa", "createdAt": "2020-05-04T13:13:02Z", "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyCollectorModal.jsx", "diffHunk": "@@ -44,52 +43,40 @@ class CopyCollectorModal extends React.Component {\n   };\n \n   _save = () => {\n-    const collector = this.state;\n+    const { errorMessage, id, name } = this.state;\n+    const { copyCollector } = this.props;\n \n-    if (!collector.error) {\n-      this.props.copyCollector(this.state.id, this.state.name, this._saved);\n+    if (!errorMessage) {\n+      copyCollector(id, name, this._saved);\n     }\n   };\n \n   _changeName = (event) => {\n-    const nextName = event.target.value;\n-    this.setState({ name: nextName });\n+    const { collector, validateCollector } = this.props;\n+    const name = event.target.value;\n+    this.setState({ name, errorMessage: undefined });\n \n-    const nextCollector = lodash.cloneDeep(this.props.collector);\n-    nextCollector.name = nextName;\n+    const nextCollector = lodash.cloneDeep(collector);\n+    nextCollector.name = name;\n     nextCollector.id = '';\n \n-    this.props.validateCollector(nextCollector).then((validation) => {\n-      let errorMessage = '';\n-      if (validation.errors.name) {\n-        errorMessage = validation.errors.name[0];\n-      }\n-      this.setState({ error: validation.failed, error_message: errorMessage });\n+    validateCollector(nextCollector).then((validation) => {\n+      const [errorMessage] = validation.errors.name;", "originalCommit": "65bbbaa364ce87284092a8511066b53a3d73fb10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyNDg0Mw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419424843", "bodyText": "Same as above.", "author": "edmundoa", "createdAt": "2020-05-04T13:13:18Z", "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "diffHunk": "@@ -43,47 +42,37 @@ class CopyConfigurationModal extends React.Component {\n   };\n \n   _save = () => {\n-    const configuration = this.state;\n+    const { copyConfiguration } = this.props;\n+    const { errorMessage, id, name } = this.state;\n \n-    if (!configuration.error) {\n-      this.props.copyConfiguration(this.state.id, this.state.name, this._saved);\n+    if (errorMessage) {\n+      copyConfiguration(id, name, this._saved);\n     }\n   };\n \n   _changeName = (event) => {\n-    const nextName = event.target.value;\n-    this.setState({ name: nextName });\n-    this.props.validateConfiguration({ name: nextName }).then((validation) => {\n-      let errorMessage = '';\n-      if (validation.errors.name) {\n-        errorMessage = validation.errors.name[0];\n-      }\n-      this.setState({ error: validation.failed, error_message: errorMessage });\n+    const { validateConfiguration } = this.props;\n+    const name = event.target.value;\n+    this.setState({ name, errorMessage: undefined });\n+\n+    validateConfiguration({ name }).then((validation) => {\n+      const [errorMessage] = validation.errors.name;", "originalCommit": "65bbbaa364ce87284092a8511066b53a3d73fb10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyNjAyMg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419426022", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (errorMessage) {\n          \n          \n            \n                if (!errorMessage) {\n          \n      \n    \n    \n  \n\nOtherwise will do the opposite of what we want.", "author": "edmundoa", "createdAt": "2020-05-04T13:15:03Z", "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "diffHunk": "@@ -43,47 +42,37 @@ class CopyConfigurationModal extends React.Component {\n   };\n \n   _save = () => {\n-    const configuration = this.state;\n+    const { copyConfiguration } = this.props;\n+    const { errorMessage, id, name } = this.state;\n \n-    if (!configuration.error) {\n-      this.props.copyConfiguration(this.state.id, this.state.name, this._saved);\n+    if (errorMessage) {", "originalCommit": "65bbbaa364ce87284092a8511066b53a3d73fb10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "32b746ae92b031f7e114a8504cd2ecf44bd54e9b", "url": "https://github.com/Graylog2/graylog2-server/commit/32b746ae92b031f7e114a8504cd2ecf44bd54e9b", "message": "pr feedback", "committedDate": "2020-05-04T13:50:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk0MjMyNA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8005#discussion_r419942324", "bodyText": "I saw this in my browser console, I think this prop needs a default value here or make the prop not required:\nWarning: Failed prop type: The prop `error` is marked as required in `CloneMenuItem`, but its value is `undefined`.\n    in CloneMenuItem (created by CopyConfigurationModal)\n    in CopyConfigurationModal (created by ConfigurationRow)\n    in ul (created by DropdownMenu)\n    in RootCloseWrapper (created by DropdownMenu)\n    in DropdownMenu (created by Dropdown)", "author": "edmundoa", "createdAt": "2020-05-05T08:25:29Z", "path": "graylog2-web-interface/src/components/sidecars/configurations/CopyConfigurationModal.jsx", "diffHunk": "@@ -43,47 +42,37 @@ class CopyConfigurationModal extends React.Component {\n   };\n \n   _save = () => {\n-    const configuration = this.state;\n+    const { copyConfiguration } = this.props;\n+    const { errorMessage, id, name } = this.state;\n \n-    if (!configuration.error) {\n-      this.props.copyConfiguration(this.state.id, this.state.name, this._saved);\n+    if (!errorMessage) {\n+      copyConfiguration(id, name, this._saved);\n     }\n   };\n \n   _changeName = (event) => {\n-    const nextName = event.target.value;\n-    this.setState({ name: nextName });\n-    this.props.validateConfiguration({ name: nextName }).then((validation) => {\n-      let errorMessage = '';\n+    const { validateConfiguration } = this.props;\n+    const name = event.target.value;\n+    this.setState({ name, errorMessage: undefined });\n+\n+    validateConfiguration({ name }).then((validation) => {\n       if (validation.errors.name) {\n-        errorMessage = validation.errors.name[0];\n+        this.setState({ errorMessage: validation.errors.name[0] });\n       }\n-      this.setState({ error: validation.failed, error_message: errorMessage });\n     });\n   };\n \n   render() {\n+    const { errorMessage, name } = this.state;\n+\n     return (\n-      <span>\n-        <MenuItem className={style.menuItem} onSelect={this.openModal}>Clone</MenuItem>\n-        <BootstrapModalForm ref=\"modal\"\n-                            title=\"Clone\"\n-                            onSubmitForm={this._save}\n-                            submitButtonDisabled={this.state.error}\n-                            submitButtonText=\"Done\">\n-          <fieldset>\n-            <Input type=\"text\"\n-                   id={this._getId('configuration-name')}\n-                   label=\"Name\"\n-                   defaultValue={this.state.name}\n-                   onChange={this._changeName}\n-                   bsStyle={this.state.error ? 'error' : null}\n-                   help={this.state.error ? this.state.error_message : 'Type a name for the new configuration'}\n-                   autoFocus\n-                   required />\n-          </fieldset>\n-        </BootstrapModalForm>\n-      </span>\n+      <CloneMenuItem onSelect={this.openModal}\n+                     onSave={this._save}\n+                     id={this._getId('configuration-name')}\n+                     onChange={this._changeName}\n+                     error={errorMessage}", "originalCommit": "32b746ae92b031f7e114a8504cd2ecf44bd54e9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a918c554ae13802116921d76cd206d937a2b679b", "url": "https://github.com/Graylog2/graylog2-server/commit/a918c554ae13802116921d76cd206d937a2b679b", "message": "CloneMenuItem", "committedDate": "2020-05-06T18:14:57Z", "type": "commit"}, {"oid": "a6abcc895c4693da1eea1d9e9d9735529efc854b", "url": "https://github.com/Graylog2/graylog2-server/commit/a6abcc895c4693da1eea1d9e9d9735529efc854b", "message": "cleanup implementation", "committedDate": "2020-05-06T18:14:57Z", "type": "commit"}, {"oid": "fedad119a7843e5935cc727916d814d9fc005d84", "url": "https://github.com/Graylog2/graylog2-server/commit/fedad119a7843e5935cc727916d814d9fc005d84", "message": "pr feedback", "committedDate": "2020-05-06T18:14:57Z", "type": "commit"}, {"oid": "78601f74d28e18b3834cf60555e244cba5e64e6d", "url": "https://github.com/Graylog2/graylog2-server/commit/78601f74d28e18b3834cf60555e244cba5e64e6d", "message": "error prop not required", "committedDate": "2020-05-06T18:14:58Z", "type": "commit"}, {"oid": "78601f74d28e18b3834cf60555e244cba5e64e6d", "url": "https://github.com/Graylog2/graylog2-server/commit/78601f74d28e18b3834cf60555e244cba5e64e6d", "message": "error prop not required", "committedDate": "2020-05-06T18:14:58Z", "type": "forcePushed"}]}