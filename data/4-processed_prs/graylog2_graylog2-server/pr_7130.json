{"pr_number": 7130, "pr_title": "Enforce system wide TLS protocol settings", "pr_createdAt": "2020-01-09T15:29:05Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/7130", "timeline": [{"oid": "8a4a19fee31e64eac4ae086e9bda4b204e0b145d", "url": "https://github.com/Graylog2/graylog2-server/commit/8a4a19fee31e64eac4ae086e9bda4b204e0b145d", "message": "Enforce system wide TLS protocol settings\n\nWith the introduction of netty 4 in Graylog 3.0, we changed the default\nSslProvider to OpenSSL.\nWhile this gives a better performance, it lacks the ability to disable\nTLS protocols that are considered flawed.\nChanges to the java security properties are only respected by jdk based\nSslProviders (jersey / grizzly in our case).\n\nIntroduce a system wide default setting for supported TLS protocols,\nwith a sane default to TLSv1.2 (and TLSv1.3 if the jdk supports it).\nThese protocol settings are applied to netty based inputs and\nto the webserver.\n\nChanges can be made with a new server setting:\n`#enabled_tls_protocols = TLSv1.2,TLSv1.3`\n\nFixes #6444", "committedDate": "2020-01-09T15:26:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgxMzQyOA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7130#discussion_r364813428", "bodyText": "We should add an entry to misc/graylog.conf including a comment that describes the available options.", "author": "bernd", "createdAt": "2020-01-09T15:47:16Z", "path": "graylog2-server/src/main/java/org/graylog2/Configuration.java", "diffHunk": "@@ -158,6 +159,11 @@\n     @Parameter(value = \"deactivated_builtin_authentication_providers\", converter = StringSetConverter.class)\n     private Set<String> deactivatedBuiltinAuthenticationProviders = Collections.emptySet();\n \n+    // Defaults to TLS protocols that are currently considered secure\n+    @Parameter(value = \"enabled_tls_protocols\", converter = StringSetConverter.class)", "originalCommit": "8a4a19fee31e64eac4ae086e9bda4b204e0b145d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg0NzU2MQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7130#discussion_r364847561", "bodyText": "I noticed that the default we use in 3.1 and earlier is TLSv1.0, TLSv1.1 and TLSv1.2. Changing this to TLSv1.2 and TLSv1.3 only would be a breaking change and might result in broken user and customer setups. So I think we need to enable all previous defaults to avoid any issues.\nWe should probably document that people should switch to more secure ones. With the next major release (v4) we can change the default.", "author": "bernd", "createdAt": "2020-01-09T16:46:34Z", "path": "graylog2-server/src/main/java/org/graylog2/Configuration.java", "diffHunk": "@@ -158,6 +159,11 @@\n     @Parameter(value = \"deactivated_builtin_authentication_providers\", converter = StringSetConverter.class)\n     private Set<String> deactivatedBuiltinAuthenticationProviders = Collections.emptySet();\n \n+    // Defaults to TLS protocols that are currently considered secure\n+    @Parameter(value = \"enabled_tls_protocols\", converter = StringSetConverter.class)\n+    private Set<String> enabledTlsProtocols = ImmutableSet.of(\"TLSv1.2\", \"TLSv1.3\");", "originalCommit": "8a4a19fee31e64eac4ae086e9bda4b204e0b145d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTEzNDUyMQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7130#discussion_r365134521", "bodyText": "I disagree. TLS 1.0 and 1.1 are known to have security issues. We should be shipping with a secure default.\nTLS 1.2 is supported in major browsers since ~2013 and is the de-facto standard. 94% global usage in 2018. https://www.ixiacom.com/company/blog/current-state-tls\nI think the fallout will be very small. We can make the change (and workaround) prominent in the 3.2 release notes.\nAt the very least, we should disable TLS 1.0 (since that one is not even PCI DSS compliant anymore)\nhttps://blog.pcisecuritystandards.org/are-you-ready-for-30-june-2018-sayin-goodbye-to-ssl-early-tls", "author": "mpfz0r", "createdAt": "2020-01-10T09:11:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg0NzU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTEzNTc0OA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7130#discussion_r365135748", "bodyText": "cf https://portswigger.net/daily-swig/the-end-is-nigh-browser-makers-ditch-support-for-aging-tls-1-0-1-1-protocols", "author": "mpfz0r", "createdAt": "2020-01-10T09:14:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg0NzU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE1ODU5NA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7130#discussion_r365158594", "bodyText": "Okay, we talked about this offline. I assumed this changes should be backported to 3.1, but that isn't the case because there is a workaround. (will be documented in #6444)\nFor the upcoming 3.2 we will document the change in the upgrade notes.", "author": "bernd", "createdAt": "2020-01-10T10:05:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg0NzU2MQ=="}], "type": "inlineReview"}, {"oid": "446186978e04848f8e8e61f48d5e87bdb0d80883", "url": "https://github.com/Graylog2/graylog2-server/commit/446186978e04848f8e8e61f48d5e87bdb0d80883", "message": "Add enabled_tls_protocols setting to example graylog.conf", "committedDate": "2020-01-10T13:17:47Z", "type": "commit"}]}