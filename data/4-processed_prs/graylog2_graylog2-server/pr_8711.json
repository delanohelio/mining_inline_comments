{"pr_number": 8711, "pr_title": "Implement new roles overview", "pr_createdAt": "2020-08-06T10:21:41Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8711", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM0NzgxNw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#discussion_r466347817", "bodyText": "The type for the response string[] is based on deleteUser. When the api route exists, we may need to adjust this.", "author": "linuspahl", "createdAt": "2020-08-06T11:31:32Z", "path": "graylog2-web-interface/src/actions/roles/AuthzRolesActions.js", "diffHunk": "@@ -6,6 +6,7 @@ import { singletonActions } from 'views/logic/singleton';\n import type { RefluxActions } from 'stores/StoreTypes';\n \n type AuthzRolesActionsType = RefluxActions<{\n+  deleteRole: (roleId: string) => Promise<string[]>,", "originalCommit": "d18610e6cfd01791bab7245530d04fa3648a889b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a", "url": "https://github.com/Graylog2/graylog2-server/commit/2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a", "message": "Rename ROLES routes key", "committedDate": "2020-08-07T08:34:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAxMzg5NA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#discussion_r467013894", "bodyText": "I will update this in a follow-up PR", "author": "linuspahl", "createdAt": "2020-08-07T12:39:15Z", "path": "graylog2-web-interface/src/components/roles/RolesOverview/ActionsCell.jsx", "diffHunk": "@@ -0,0 +1,71 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { LinkContainer } from 'react-router-bootstrap';\n+\n+import UserNotification from 'util/UserNotification';\n+import { AuthzRolesActions } from 'stores/roles/AuthzRolesStore';\n+import Routes from 'routing/Routes';\n+import Role from 'logic/roles/Role';\n+import { Button } from 'components/graylog';\n+import { IfPermitted } from 'components/common';\n+\n+type Props = {\n+  readOnly: $PropertyType<Role, 'readOnly'>,\n+  roleId: $PropertyType<Role, 'id'>,\n+  roleName: $PropertyType<Role, 'name'>,\n+};\n+\n+const ActtionsWrapper = styled.div`\n+  display: flex;\n+  justify-content: flex-end;\n+`;\n+\n+const ActionsCell = ({ roleId, roleName, readOnly }: Props) => {\n+  const _deleteRole = () => {\n+    // eslint-disable-next-line no-alert\n+    if (window.confirm(`Do you really want to delete role ${roleName}?`)) {\n+      AuthzRolesActions.deleteRole(roleId).then(() => {\n+        UserNotification.success(`Role \"${roleName}\" was deleted successfully`);\n+      }, () => {\n+        UserNotification.error(`There was an error deleting the role \"${roleName}\"`);\n+      });\n+\n+      // AuthzRolesActions.getMembers(roleName).then((membership) => {\n+      //   if (membership.users.length !== 0) {\n+      //     UserNotification.error(`Cannot delete role ${roleName}. It is still assigned to ${membership.users.length} users.`);\n+      //   } else {\n+      //     AuthzRolesActions.deleteRole(roleId).then(() => {\n+      //       UserNotification.success(`Role \"${roleName}\" was deleted successfully`);\n+      //     }, () => {\n+      //       UserNotification.error(`There was an error deleting the role \"${roleName}\"`);\n+      //     });\n+      //   }\n+      // });", "originalCommit": "2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzczNDkzOA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8711#discussion_r467734938", "bodyText": ".edit() should take the id of the role and not the role name", "author": "kmerz", "createdAt": "2020-08-10T07:42:56Z", "path": "graylog2-web-interface/src/components/roles/RolesOverview/ActionsCell.jsx", "diffHunk": "@@ -0,0 +1,71 @@\n+// @flow strict\n+import * as React from 'react';\n+import styled from 'styled-components';\n+import { LinkContainer } from 'react-router-bootstrap';\n+\n+import UserNotification from 'util/UserNotification';\n+import { AuthzRolesActions } from 'stores/roles/AuthzRolesStore';\n+import Routes from 'routing/Routes';\n+import Role from 'logic/roles/Role';\n+import { Button } from 'components/graylog';\n+import { IfPermitted } from 'components/common';\n+\n+type Props = {\n+  readOnly: $PropertyType<Role, 'readOnly'>,\n+  roleId: $PropertyType<Role, 'id'>,\n+  roleName: $PropertyType<Role, 'name'>,\n+};\n+\n+const ActtionsWrapper = styled.div`\n+  display: flex;\n+  justify-content: flex-end;\n+`;\n+\n+const ActionsCell = ({ roleId, roleName, readOnly }: Props) => {\n+  const _deleteRole = () => {\n+    // eslint-disable-next-line no-alert\n+    if (window.confirm(`Do you really want to delete role ${roleName}?`)) {\n+      AuthzRolesActions.deleteRole(roleId).then(() => {\n+        UserNotification.success(`Role \"${roleName}\" was deleted successfully`);\n+      }, () => {\n+        UserNotification.error(`There was an error deleting the role \"${roleName}\"`);\n+      });\n+\n+      // AuthzRolesActions.getMembers(roleName).then((membership) => {\n+      //   if (membership.users.length !== 0) {\n+      //     UserNotification.error(`Cannot delete role ${roleName}. It is still assigned to ${membership.users.length} users.`);\n+      //   } else {\n+      //     AuthzRolesActions.deleteRole(roleId).then(() => {\n+      //       UserNotification.success(`Role \"${roleName}\" was deleted successfully`);\n+      //     }, () => {\n+      //       UserNotification.error(`There was an error deleting the role \"${roleName}\"`);\n+      //     });\n+      //   }\n+      // });\n+    }\n+  };\n+\n+  return (\n+    <td>\n+      <ActtionsWrapper>\n+        <IfPermitted permissions={[`roles:edit:${roleName}`]}>\n+          <LinkContainer to={Routes.SYSTEM.AUTHZROLES.edit(encodeURIComponent(roleName))}>", "originalCommit": "2b31c76dfbdd2dd28680ab22a3cffbc6bd6e1f6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "de4a535d23eab34f0026ce40af2e4534da6f94c0", "url": "https://github.com/Graylog2/graylog2-server/commit/de4a535d23eab34f0026ce40af2e4534da6f94c0", "message": "Fix permissions check for role delete and edit button", "committedDate": "2020-08-10T07:52:20Z", "type": "forcePushed"}, {"oid": "a7b5cad803bb134e0dcce75a38171dd568ba9094", "url": "https://github.com/Graylog2/graylog2-server/commit/a7b5cad803bb134e0dcce75a38171dd568ba9094", "message": "Unify RolesOverview pagination handling", "committedDate": "2020-08-12T07:14:58Z", "type": "forcePushed"}, {"oid": "a7dc777e28ad60aa11c977072b662390584e3916", "url": "https://github.com/Graylog2/graylog2-server/commit/a7dc777e28ad60aa11c977072b662390584e3916", "message": "Add RolesOverview\n\n* Including route, page, and nav item", "committedDate": "2020-08-12T14:48:05Z", "type": "commit"}, {"oid": "f69568c2be08fa76383c70afab1a5e81ad58d4d6", "url": "https://github.com/Graylog2/graylog2-server/commit/f69568c2be08fa76383c70afab1a5e81ad58d4d6", "message": "Extract RolesQueryHelper", "committedDate": "2020-08-12T14:48:05Z", "type": "commit"}, {"oid": "aa51d2da67de2245113ee43e38a9ce6fac9e5081", "url": "https://github.com/Graylog2/graylog2-server/commit/aa51d2da67de2245113ee43e38a9ce6fac9e5081", "message": "Add route for role edit", "committedDate": "2020-08-12T14:48:05Z", "type": "commit"}, {"oid": "0aeccdbb6ea2bb995011b355aea0b61f969d5573", "url": "https://github.com/Graylog2/graylog2-server/commit/0aeccdbb6ea2bb995011b355aea0b61f969d5573", "message": "Fix SystemMenu test", "committedDate": "2020-08-12T14:48:05Z", "type": "commit"}, {"oid": "98221c0cf1e6ddf263d7dc00f41f597d65261ae8", "url": "https://github.com/Graylog2/graylog2-server/commit/98221c0cf1e6ddf263d7dc00f41f597d65261ae8", "message": "Rename ROLES routes key", "committedDate": "2020-08-12T14:48:05Z", "type": "commit"}, {"oid": "675f0518fdb130841b31825068c710f7edee7eb8", "url": "https://github.com/Graylog2/graylog2-server/commit/675f0518fdb130841b31825068c710f7edee7eb8", "message": "Fix permissions check for role delete and edit button", "committedDate": "2020-08-12T14:48:05Z", "type": "commit"}, {"oid": "af5471621cfe4bf21c8ac8461d6094c9637f85e3", "url": "https://github.com/Graylog2/graylog2-server/commit/af5471621cfe4bf21c8ac8461d6094c9637f85e3", "message": "Unify RolesOverview pagination handling", "committedDate": "2020-08-12T14:48:05Z", "type": "commit"}, {"oid": "97e861b27ea66bf86ef06df2c8f50b9c56734263", "url": "https://github.com/Graylog2/graylog2-server/commit/97e861b27ea66bf86ef06df2c8f50b9c56734263", "message": "Fix role edit and delete permission check and edit role link", "committedDate": "2020-08-12T14:54:54Z", "type": "commit"}, {"oid": "97e861b27ea66bf86ef06df2c8f50b9c56734263", "url": "https://github.com/Graylog2/graylog2-server/commit/97e861b27ea66bf86ef06df2c8f50b9c56734263", "message": "Fix role edit and delete permission check and edit role link", "committedDate": "2020-08-12T14:54:54Z", "type": "forcePushed"}]}