{"pr_number": 8344, "pr_title": "Refactor field list component", "pr_createdAt": "2020-06-15T13:13:20Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8344", "timeline": [{"oid": "740bf903699393493061267df3b5c452fb4cf197", "url": "https://github.com/Graylog2/graylog2-server/commit/740bf903699393493061267df3b5c452fb4cf197", "message": "Add flow-typed stub for react-window", "committedDate": "2020-06-15T12:59:32Z", "type": "commit"}, {"oid": "27df46a6374d8af0703a31043b2748c1e282e838", "url": "https://github.com/Graylog2/graylog2-server/commit/27df46a6374d8af0703a31043b2748c1e282e838", "message": "Refactor field list component\n- remove usage of createReactClass by using a functional component\n- splitting up the component in multiple components\n- use styled component instead of css file\n- Adding flow types\n- Remove usage of not needed ViewMetadata store", "committedDate": "2020-06-15T13:00:21Z", "type": "commit"}, {"oid": "69553ffd195642cf6a83a19654dc98beac4deb48", "url": "https://github.com/Graylog2/graylog2-server/commit/69553ffd195642cf6a83a19654dc98beac4deb48", "message": "Use styled components instead of inline style", "committedDate": "2020-06-15T13:11:08Z", "type": "commit"}, {"oid": "c9d9872227da064f68c0bc33feabb34fd3446091", "url": "https://github.com/Graylog2/graylog2-server/commit/c9d9872227da064f68c0bc33feabb34fd3446091", "message": "Disable eslint warning for dependency cycle in sidebar index file", "committedDate": "2020-06-15T14:06:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM4NjQ3OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441386479", "bodyText": "Using a reducer here overcomplicates things, as the field category and the filter are not related. They could be handled by using two separate, independent states.", "author": "dennisoelkers", "createdAt": "2020-06-17T08:49:58Z", "path": "graylog2-web-interface/src/views/components/sidebar/fields/FieldsOverview.jsx", "diffHunk": "@@ -0,0 +1,125 @@\n+// @flow strict\n+import * as React from 'react';\n+import { useReducer } from 'react';\n+import PropTypes from 'prop-types';\n+import { List as ImmutableList } from 'immutable';\n+import styled, { type StyledComponent } from 'styled-components';\n+\n+import type { ViewMetaData as ViewMetadata } from 'views/stores/ViewMetadataStore';\n+import FieldTypeMapping from 'views/logic/fieldtypes/FieldTypeMapping';\n+import { type ThemeInterface } from 'theme';\n+\n+import { Button } from 'components/graylog';\n+import List from './List';\n+import ChangeMode from './ChangeMode';\n+\n+type Props = {\n+  viewMetadata: ViewMetadata,\n+  listHeight: number,\n+  fields: ImmutableList<FieldTypeMapping>,\n+  allFields: ImmutableList<FieldTypeMapping>,\n+};\n+\n+const Container: StyledComponent<{}, ThemeInterface, HTMLDivElement> = styled.div`\n+  white-space: break-spaces;\n+`;\n+\n+const FilterForm = styled.form`\n+  display: flex;\n+`;\n+\n+const FilterInputWrapper = styled.div`\n+  flex-grow: 1;\n+  margin-right: 5px;\n+`;\n+\n+const FilterInput = styled.input`\n+  width: 100%;\n+`;\n+\n+const FieldListModes = styled.div`\n+  margin-top: 5px;\n+  margin-bottom: 0;\n+`;\n+\n+const reducer = (state, action: {type: string, payload?: { mode?: string, filter?: string }}): { filter: ?string, currentMode: string } => {\n+  const { payload = {} } = action;\n+  const { mode, filter } = payload;\n+  switch (action.type) {\n+    case 'search':\n+      return { ...state, filter: filter };\n+    case 'searchReset':\n+      return { ...state, filter: undefined };\n+    case 'changeMode':\n+      return mode ? { ...state, currentMode: mode } : state;\n+    default:\n+      return state;\n+  }\n+};\n+\n+const FieldsOverview = ({ allFields, fields, viewMetadata, listHeight }: Props) => {\n+  const [{ filter, currentMode }, dispatch] = useReducer(reducer, { filter: undefined, currentMode: 'current' });", "originalCommit": "c9d9872227da064f68c0bc33feabb34fd3446091", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM4ODU5NA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441388594", "bodyText": "ChangeMode is not an ideal name, it is not really giving away what it is doing. Maybe something like FieldGroup?\nI think we can also align props naming with React standards. Instead of changeMode using onSelect or onClick would give away what it's doing, instead of currentMode, we can use a boolean selected prop, allowing the user of the component to determine if it should be shown as selected or not.", "author": "dennisoelkers", "createdAt": "2020-06-17T08:53:01Z", "path": "graylog2-web-interface/src/views/components/sidebar/fields/ChangeMode.jsx", "diffHunk": "@@ -0,0 +1,26 @@\n+// @flow strict\n+import * as React from 'react';\n+\n+type Props = {\n+  changeMode: (newMode: string) => void,\n+  currentMode: string,\n+  mode: string,\n+  text: string,\n+  title: string,\n+};\n+\n+const ChangeMode = ({ changeMode, currentMode, mode, text, title }: Props) => {", "originalCommit": "c9d9872227da064f68c0bc33feabb34fd3446091", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5Njc2NA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441596764", "bodyText": "Alright, I only see one disadvantage with the select prop, we need to define the group (previously mode) twice for each FieldGroup. For the group and the select prop.", "author": "linuspahl", "createdAt": "2020-06-17T14:38:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM4ODU5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE5NjY2NQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r442196665", "bodyText": "Agreed, it's not ideal.", "author": "dennisoelkers", "createdAt": "2020-06-18T12:43:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM4ODU5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5MDMzMQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441390331", "bodyText": "It might make sense to move a file instead of deleting it (especially in this case, where we are still keeping lots from the component, just under a new name), so we retain its history.", "author": "dennisoelkers", "createdAt": "2020-06-17T08:55:29Z", "path": "graylog2-web-interface/src/views/components/sidebar/FieldList.jsx", "diffHunk": "@@ -1,184 +0,0 @@\n-import React from 'react';", "originalCommit": "c9d9872227da064f68c0bc33feabb34fd3446091", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5MzQwMw==", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441593403", "bodyText": "That is a good point I did not thought about. I named the component FieldsOverview because I wanted to avoid confusion with the List component in the same directory.", "author": "linuspahl", "createdAt": "2020-06-17T14:34:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5MDMzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYyMDA1OA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441620058", "bodyText": "It looks like I have to create a new PR to tell git I moved the file and changed the name. At least this seems to be the easiest way", "author": "linuspahl", "createdAt": "2020-06-17T15:08:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5MDMzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYyNzQzMg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8344#discussion_r441627432", "bodyText": "I created a new branch and used git mv to move the and rename the file. This seems to work when looking at the commit: a74d2e4\nBut not when looking at the PR..\nhttps://github.com/Graylog2/graylog2-server/compare/refactor-field-list-v2?expand=1", "author": "linuspahl", "createdAt": "2020-06-17T15:17:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5MDMzMQ=="}], "type": "inlineReview"}, {"oid": "422bf914689c04894c0e5c6de67114f74c4ba709", "url": "https://github.com/Graylog2/graylog2-server/commit/422bf914689c04894c0e5c6de67114f74c4ba709", "message": "Rename FieldsOverview to FieldList", "committedDate": "2020-06-17T13:46:09Z", "type": "commit"}, {"oid": "0cc6523bfdfbc0de32e989c652db878102f0fa9d", "url": "https://github.com/Graylog2/graylog2-server/commit/0cc6523bfdfbc0de32e989c652db878102f0fa9d", "message": "Change naming from mode to field group", "committedDate": "2020-06-17T14:28:10Z", "type": "commit"}, {"oid": "44995e39f0d132463b0a5f26e3f46119e6f86963", "url": "https://github.com/Graylog2/graylog2-server/commit/44995e39f0d132463b0a5f26e3f46119e6f86963", "message": "Replace useReducer with useState in FieldList", "committedDate": "2020-06-17T14:38:23Z", "type": "commit"}, {"oid": "7495d72a98c33d3639d921e0577d8d65397bc149", "url": "https://github.com/Graylog2/graylog2-server/commit/7495d72a98c33d3639d921e0577d8d65397bc149", "message": "Tell git that the field list moved (1/2)", "committedDate": "2020-06-17T14:45:10Z", "type": "commit"}, {"oid": "6010081322af2f2472dc2e53eb88b374533f558c", "url": "https://github.com/Graylog2/graylog2-server/commit/6010081322af2f2472dc2e53eb88b374533f558c", "message": "Tell git that the field list moved (2/2)", "committedDate": "2020-06-17T14:46:57Z", "type": "commit"}, {"oid": "ad7177bcd68185e7f0bf9661d2ff607fedb71116", "url": "https://github.com/Graylog2/graylog2-server/commit/ad7177bcd68185e7f0bf9661d2ff607fedb71116", "message": "Rename FieldList to FieldsOverview", "committedDate": "2020-06-17T15:05:28Z", "type": "commit"}, {"oid": "ad7177bcd68185e7f0bf9661d2ff607fedb71116", "url": "https://github.com/Graylog2/graylog2-server/commit/ad7177bcd68185e7f0bf9661d2ff607fedb71116", "message": "Rename FieldList to FieldsOverview", "committedDate": "2020-06-17T15:05:28Z", "type": "forcePushed"}]}