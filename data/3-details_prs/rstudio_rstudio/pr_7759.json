{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzMTk3NzYz", "number": 7759, "title": "Improve cursor and output visibility in embedded editors", "bodyText": "Intent\nThis change fixes a couple of issues in which the cursor and/or output of code execution could be offscreen in embedded Ace editors in visual mode.\nFixes #7739.\nApproach\n\nWhen the cursor moves in an embedded Ace editor, we compute whether the cursor element is sufficiently visible using bounding boxes, and scroll it into view if it isn't. This computation is somewhat expensive, so we only do it when moving to a new row (i.e. it won't fire while typing in a line) and only after releasing the mouse/keyboard.\nWhen a chunk finishes executing, we ensure that the output it created is visible. This is handled on on the panmirror side via zenscroll, and invoked from GWT-land.\n\nQA Notes\nThe intent here is for you to always be able to see what you're typing and executing, so check around the edges of those scenarios in visual mode.", "createdAt": "2020-09-09T23:18:53Z", "url": "https://github.com/rstudio/rstudio/pull/7759", "merged": true, "mergeCommit": {"oid": "5839fa4c7d2b7365d18f917de88112709cf68b8e"}, "closed": true, "closedAt": "2020-09-11T17:32:12Z", "author": {"login": "jmcphers"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHAK67AH2gAyNDgzMTk3NzYzOjI2YWMyZTI3YTMzNjM1ZTRiM2Q2ZTg0MWQ3YjJhNWUzODVhMWJlNjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHkz2HgH2gAyNDgzMTk3NzYzOjZkMmRjMzQwNTg5MDVhMWFjNmRlYmU2ODJmNWM3NzI5NjNmOGJkNTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "26ac2e27a33635e4b3d6e841d7b2a5e385a1be66", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/26ac2e27a33635e4b3d6e841d7b2a5e385a1be66", "committedDate": "2020-09-08T23:26:38Z", "message": "scroll cursor into view if necessary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6957f6545d5270feadf8b8d28bcc4d1e2859487", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/f6957f6545d5270feadf8b8d28bcc4d1e2859487", "committedDate": "2020-09-09T22:53:42Z", "message": "use zenscroll to make output visible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e1a197eef12f528379dd9c9babddbcee6c0ddfd", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/3e1a197eef12f528379dd9c9babddbcee6c0ddfd", "committedDate": "2020-09-09T23:00:54Z", "message": "cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDc0Mzgy", "url": "https://github.com/rstudio/rstudio/pull/7759#pullrequestreview-485474382", "createdAt": "2020-09-09T23:45:25Z", "commit": {"oid": "3e1a197eef12f528379dd9c9babddbcee6c0ddfd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMzo0NToyNVrOHPd78Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMzo0NToyNVrOHPd78Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk4MTE2OQ==", "bodyText": "Is listening for beforeEndOperation signals from the editor instance itself an option here? This is basically where Ace itself looks and tries to scroll into view after a command is executed:\nhttps://github.com/ajaxorg/ace/blob/3ebb0c34dc023aff3b6a951dd116a702510369fe/lib/ace/editor.js#L175", "url": "https://github.com/rstudio/rstudio/pull/7759#discussion_r485981169", "createdAt": "2020-09-09T23:45:25Z", "author": {"login": "kevinushey"}, "path": "src/gwt/panmirror/src/editor/src/optional/ace/ace.ts", "diffHunk": "@@ -455,6 +501,16 @@ export class AceNodeView implements NodeView {\n       }\n     });\n \n+    // If the cursor moves and we're in focus, ensure that the cursor is\n+    // visible. Ace's own cursor visiblity mechanisms don't work in embedded\n+    // editors.\n+    this.editSession.getSelection().on('changeCursor', () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e1a197eef12f528379dd9c9babddbcee6c0ddfd"}, "originalPosition": 90}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d2dc34058905a1ac6debe682f5c772963f8bd58", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/6d2dc34058905a1ac6debe682f5c772963f8bd58", "committedDate": "2020-09-10T18:07:55Z", "message": "detect operation end instead of waiting for key/mouse"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4972, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}