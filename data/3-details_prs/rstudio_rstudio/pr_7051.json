{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4ODM2MDY1", "number": 7051, "title": "Ensure toolbar updates when changing YAML to notebook", "bodyText": "This change fixes an issue in which modifying the YAML header to change html_document to/from html_notebook in an R Markdown document doesn't trigger the right updates to the toolbar.\nThe issue is that we no longer rebuild the toolbars on every file save (#6442). We used to do this but in addition to being wasteful it also made autosave very unpleasant to use.\nWe do rebuild the toolbars when the extended type changes, though, so the fix is to give Notebooks their own extended type. This causes us to rebuild the toolbars when a document is switched into or out of Notebook mode.\nFixes #6643.", "createdAt": "2020-06-05T23:10:23Z", "url": "https://github.com/rstudio/rstudio/pull/7051", "merged": true, "mergeCommit": {"oid": "f20e2f2eff8c35f546368b6759afd09f44cd7714"}, "closed": true, "closedAt": "2020-06-16T16:23:36Z", "author": {"login": "jmcphers"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpo75OAFqTQyNzQwNzA3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr3oDOgBqjM0NDk3OTI4Njg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NDA3MDc1", "url": "https://github.com/rstudio/rstudio/pull/7051#pullrequestreview-427407075", "createdAt": "2020-06-09T17:56:03Z", "commit": {"oid": "e7b1f109c846560f71942a99b762fe63921186eb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzo1NjowNFrOGhV6UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzo1NjowNFrOGhV6UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxNTE4NQ==", "bodyText": "I think we should be a bit more careful in this check, since IIUC this would trigger if html_notebook were mentioned anywhere in the document (even outside the YAML header).\n\n\nCould we parse and check the YAML directly for the output type? (Can we assume the document's YAML header is in a \"good\" / parseable state here?) This would also protect us from the myriad of ways users might decide to encode the YAML string here (quoted vs unquoted and so on).\n\n\nCould we use a regular expression to more specifically check for output: html_notebook in the document (handling the arbitrary whitespace separating the tokens)? That would at least be safer than just checking for this string only. We might also want to be robust against usages like output: rmarkdown::html_notebook or output: \"html_notebook\".", "url": "https://github.com/rstudio/rstudio/pull/7051#discussion_r437615185", "createdAt": "2020-06-09T17:56:04Z", "author": {"login": "kevinushey"}, "path": "src/cpp/session/modules/rmarkdown/SessionRMarkdown.cpp", "diffHunk": "@@ -928,7 +928,14 @@ std::string onDetectRmdSourceType(\n                                        \"<!-- rmarkdown v1 -->\") &&\n           rmarkdownPackageAvailable())\n       {\n-         return \"rmarkdown\";\n+         if (boost::algorithm::icontains(pDoc->contents(), \"html_notebook\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7b1f109c846560f71942a99b762fe63921186eb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMTQ0Mjk2", "url": "https://github.com/rstudio/rstudio/pull/7051#pullrequestreview-431144296", "createdAt": "2020-06-16T04:03:07Z", "commit": {"oid": "40aaa9fa48075e29b64a975e9102b58ed5c2a9b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e95a019ea0335ae9f19acad3266f59c4dfa4b50", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/3e95a019ea0335ae9f19acad3266f59c4dfa4b50", "committedDate": "2020-06-16T15:59:24Z", "message": "Merge remote-tracking branch 'origin/master' into bugfix/notebook-toolbar-update"}, "afterCommit": {"oid": "c01af95b9125976130f651348e64b08479bc7db1", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/c01af95b9125976130f651348e64b08479bc7db1", "committedDate": "2020-06-16T16:01:45Z", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c01af95b9125976130f651348e64b08479bc7db1", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/c01af95b9125976130f651348e64b08479bc7db1", "committedDate": "2020-06-16T16:01:45Z", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header"}, "afterCommit": {"oid": "b9a49a0624e1242f31779e0d65ea8ee0afe14787", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/b9a49a0624e1242f31779e0d65ea8ee0afe14787", "committedDate": "2020-06-16T16:03:45Z", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65772ce3005f0bee20884b0210aff8b13f4ec35c", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/65772ce3005f0bee20884b0210aff8b13f4ec35c", "committedDate": "2020-06-16T16:13:10Z", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b9a49a0624e1242f31779e0d65ea8ee0afe14787", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/b9a49a0624e1242f31779e0d65ea8ee0afe14787", "committedDate": "2020-06-16T16:03:45Z", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header"}, "afterCommit": {"oid": "65772ce3005f0bee20884b0210aff8b13f4ec35c", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/65772ce3005f0bee20884b0210aff8b13f4ec35c", "committedDate": "2020-06-16T16:13:10Z", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 176, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}