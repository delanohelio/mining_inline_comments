{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNjMzMDI2", "number": 6170, "title": "Add stop button within job output display", "bodyText": "Closes #5794\nThis PR adds a stop button to the toolbar within the job's output display so that the user doesn't need to return to the job list to stop it.\nI did not add a stop button the to the progress toolbar shown in the Console tab (second screenshot) as this potentially represents more than one job. If the user wants to stop multiple jobs they need to return to the Job's tab and stop each one manually.", "createdAt": "2020-02-05T23:17:05Z", "url": "https://github.com/rstudio/rstudio/pull/6170", "merged": true, "mergeCommit": {"oid": "8468b33ceac3af982eb64f56112a0f3417f7e328"}, "closed": true, "closedAt": "2020-02-06T18:17:03Z", "author": {"login": "melissa-barca"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBeKlPgH2gAyMzcxNjMzMDI2OjU1ZTA1ZDMyNDgxNjAyNDdlMWJlMTUzNjE1YTI1OTFlNDdlMTQ1NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBu2i2gH2gAyMzcxNjMzMDI2OmJhNDg5MDc0Njc2NzJmNWEzM2ZmNDI2NjY2NjQwMWRlNmM3ZDY2Njc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "55e05d3248160247e1be153615a2591e47e14549", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/55e05d3248160247e1be153615a2591e47e14549", "committedDate": "2020-02-05T22:48:43Z", "message": "Add stop button to job output display\n- move JobResources from JobItem to new class\n- add stop button to JobProgress displayed with job output\n- add eventBus to JobProgress so it can stop the job"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTE1MDE4", "url": "https://github.com/rstudio/rstudio/pull/6170#pullrequestreview-354115018", "createdAt": "2020-02-05T23:33:51Z", "commit": {"oid": "55e05d3248160247e1be153615a2591e47e14549"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTIxOTA0", "url": "https://github.com/rstudio/rstudio/pull/6170#pullrequestreview-354121904", "createdAt": "2020-02-05T23:52:43Z", "commit": {"oid": "55e05d3248160247e1be153615a2591e47e14549"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1Mjo0M1rOFmLMsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1Mjo0M1rOFmLMsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3MzY4MQ==", "bodyText": "Minor style thing: new code can use lambda syntax instead of anonymous class, so:\nstop_.addClickHandler(clickEvent -> eventBus_.fireEvent(new JobExecuteActionEvent(job.id, JobConstants.ACTION_STOP));", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375573681", "createdAt": "2020-02-05T23:52:43Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -63,26 +77,39 @@ public void showJob(Job job)\n       name_.setText(job.name);\n       progress_.setLabel(job.name);\n       String status = JobConstants.stateDescription(job.state);\n+      stop_.addClickHandler(new ClickHandler()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e05d3248160247e1be153615a2591e47e14549"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a", "committedDate": "2020-02-06T00:17:35Z", "message": "switch anonymous class for lambda syntax"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTMxNjMz", "url": "https://github.com/rstudio/rstudio/pull/6170#pullrequestreview-354131633", "createdAt": "2020-02-06T00:20:58Z", "commit": {"oid": "ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDoyMDo1OFrOFmLrjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDoyMDo1OFrOFmLrjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MTU4Mg==", "bodyText": "Whether or not a job is stoppable is independent of whether or not it has a progress bar. I think we should make the button visible based on whether or not the job implements the stop action.", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375581582", "createdAt": "2020-02-06T00:20:58Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -63,26 +76,33 @@ public void showJob(Job job)\n       name_.setText(job.name);\n       progress_.setLabel(job.name);\n       String status = JobConstants.stateDescription(job.state);\n+      stop_.addClickHandler(clickEvent ->\n+         eventBus_.fireEvent(new JobExecuteActionEvent(job.id, JobConstants.ACTION_STOP)));\n+\n       if (job.completed > 0)\n       {\n          // Job is not running; show its completion status and time\n          progress_.setVisible(false);\n          status += \" \" + StringUtil.friendlyDateTime(new Date(job.completed * 1000));\n          elapsed_.setText(StringUtil.conciseElaspedTime(job.completed - job.started));\n          status_.setVisible(true);\n+         stop_.setVisible(false);\n       }\n       else if (job.max > 0)\n       {\n-         // Job is running and has a progress bar; show it and hide the status indicator\n+         // Job is running and has a progress bar;\n+         // show it with stop button and hide the status indicator\n          progress_.setVisible(true);\n          progress_.setProgress(job.progress, job.max);\n          status_.setVisible(false);\n+         stop_.setVisible(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6", "committedDate": "2020-02-06T01:51:33Z", "message": "show stop button when job is not complete and implements the stop action\nremove code showing stop button based on progress bar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NjMzMzUx", "url": "https://github.com/rstudio/rstudio/pull/6170#pullrequestreview-354633351", "createdAt": "2020-02-06T17:24:22Z", "commit": {"oid": "1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzoyNDoyMlrOFmjpdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzoyNDoyMlrOFmjpdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk3NDI2Mg==", "bodyText": "No need for this test since it's inside an if statement that already guarantees the condition.", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375974262", "createdAt": "2020-02-06T17:24:22Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -89,6 +106,15 @@ else if (job.max > 0)\n             status = job.status;\n          }\n       }\n+\n+      // show stop button if job has a \"stop\" action, and is not completed\n+      if (job.completed == 0)\n+         stop_.setVisible(\n+               JsArrayUtil.jsArrayStringContains(job.actions, JobConstants.ACTION_STOP) &&\n+               job.completed == 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "853075174051af3a8af45af55994f1b7b2216556", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/853075174051af3a8af45af55994f1b7b2216556", "committedDate": "2020-02-06T17:46:02Z", "message": "remove redundant comparison"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NjU5NTQ1", "url": "https://github.com/rstudio/rstudio/pull/6170#pullrequestreview-354659545", "createdAt": "2020-02-06T18:04:34Z", "commit": {"oid": "853075174051af3a8af45af55994f1b7b2216556"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b3c6ea41c43301f5b7c86dc20185719e5780238", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/7b3c6ea41c43301f5b7c86dc20185719e5780238", "committedDate": "2020-02-06T18:12:11Z", "message": "Merge branch 'v1.4' of https://github.com/rstudio/rstudio into feature/interrupt-job-output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba48907467672f5a33ff4266666401de6c7d6667", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/ba48907467672f5a33ff4266666401de6c7d6667", "committedDate": "2020-02-06T18:15:13Z", "message": "Update NEWS-1.4.md stop button added to job output"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 349, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}