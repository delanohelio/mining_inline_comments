{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MDUyODk0", "number": 7830, "title": "Add build pane clear button, Fix build pane working with virtual scroller", "bodyText": "Does as advertised on the tin. :)\nFixes #6636\nFixes #7725\nIntent\nProvide a nice clear button like we have on the console so the user can clear their build pane if it's too overloaded.\nApproach\nThe button itself is self explanatory, basically a copy paste of the console clear button.\nThe other fixes were a bit more intensive in figuring out. The build pane works fairly differently from the console pane unfortunately. Content comes in giant chunks that are printed as one monolithic piece that the virtual scroller can't split up easily. Especially since we clear the build pane every time a build is triggered there is pretty much no way the virtual scroller will ever meaningfully interact with the build pane so I added and override for features that want to use the VirtualConsole but not the VirtualScroller (even when it's turned on).\nI also found a small bug in the VirtualScroller itself that was exposed by fixing the Build Pane interaction and fixed that as well.\nQA Notes\nJust ensuring that the Virtual Scroller functionality works as expected in the console with the option turned on/off and the clear button works fine for the Build Pane should be thorough enough.", "createdAt": "2020-09-18T03:54:36Z", "url": "https://github.com/rstudio/rstudio/pull/7830", "merged": true, "mergeCommit": {"oid": "214492d968a9daccee7e6397417906842afad05d"}, "closed": true, "closedAt": "2020-09-21T22:45:37Z", "author": {"login": "adamconroy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ9RM0gH2gAyNDg5MDUyODk0OjU0MzQ0YWJlMzE0ODkyMzAzM2M1OWNlZjdlMDUzYzU2YTViZmVhZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLK8roAFqTQ5MzAxODQyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "54344abe3148923033c59cef7e053c56a5bfeaf8", "author": {"user": {"login": "adamconroy", "name": null}}, "url": "https://github.com/rstudio/rstudio/commit/54344abe3148923033c59cef7e053c56a5bfeaf8", "committedDate": "2020-09-18T03:45:33Z", "message": "add build pane clear button, fix build pane working with virtual scroller, various virtual scroller bugs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjIyMTYy", "url": "https://github.com/rstudio/rstudio/pull/7830#pullrequestreview-491622162", "createdAt": "2020-09-18T16:40:14Z", "commit": {"oid": "54344abe3148923033c59cef7e053c56a5bfeaf8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjo0MDoxNVrOHUUZQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjo0MjowOVrOHUUdLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA2NzcxMw==", "bodyText": "Since this command isn't on a menu you don't need a menuLabel. If this is ever added to the main menu it won't build because there is no access key (\"_\"). So, suggest just removing menuLabel.", "url": "https://github.com/rstudio/rstudio/pull/7830#discussion_r491067713", "createdAt": "2020-09-18T16:40:15Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "diffHunk": "@@ -2471,6 +2471,13 @@ well as menu structures (for main menu and popup menus).\n         windowMode=\"main\"\n         desc=\"Clear console\"/>\n \n+   <cmd id=\"buildClear\"\n+        buttonLabel=\"\"\n+        label=\"Clear Build\"\n+        menuLabel=\"Clear Build\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54344abe3148923033c59cef7e053c56a5bfeaf8"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA2ODcxNg==", "bodyText": "Do you need a custom class for this? The terminal pane has a clear button, and it just does it with a straight ToolbarButton like this:\n      clearButton_ = commands_.clearTerminalScrollbackBuffer().createToolbarButton();\n      clearButton_.addStyleName(ThemeStyles.INSTANCE.terminalClearButton());\n      toolbar.addRightWidget(clearButton_);", "url": "https://github.com/rstudio/rstudio/pull/7830#discussion_r491068716", "createdAt": "2020-09-18T16:42:09Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildClearButton.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * ConsoleClearButton.java\n+ *\n+ * Copyright (C) 2020 by RStudio, PBC\n+ *\n+ * Unless you have received this program directly from RStudio pursuant\n+ * to the terms of a commercial license agreement with RStudio, then\n+ * this program is licensed to you under the terms of version 3 of the\n+ * GNU Affero General Public License. This program is distributed WITHOUT\n+ * ANY EXPRESS OR IMPLIED WARRANTY, INCLUDING THOSE OF NON-INFRINGEMENT,\n+ * MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Please refer to the\n+ * AGPL (http://www.gnu.org/licenses/agpl-3.0.txt) for more details.\n+ *\n+ */\n+package org.rstudio.studio.client.workbench.views.buildtools;\n+\n+import com.google.gwt.dom.client.Style.Position;\n+import com.google.gwt.resources.client.ImageResource;\n+import com.google.gwt.user.client.ui.Composite;\n+import com.google.gwt.user.client.ui.SimplePanel;\n+import com.google.inject.Inject;\n+import org.rstudio.core.client.command.AppCommand;\n+import org.rstudio.core.client.theme.res.ThemeStyles;\n+import org.rstudio.core.client.widget.ToolbarButton;\n+import org.rstudio.studio.client.workbench.commands.Commands;\n+\n+public class BuildClearButton extends Composite", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54344abe3148923033c59cef7e053c56a5bfeaf8"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aab799ada1519c34e4631d3637752cd13ee85b0f", "author": {"user": {"login": "adamconroy", "name": null}}, "url": "https://github.com/rstudio/rstudio/commit/aab799ada1519c34e4631d3637752cd13ee85b0f", "committedDate": "2020-09-18T16:50:59Z", "message": "remove superfluous menuLabel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbc5addfe98a780f8efc5bf423cdeaf6e77bef8b", "author": {"user": {"login": "adamconroy", "name": null}}, "url": "https://github.com/rstudio/rstudio/commit/fbc5addfe98a780f8efc5bf423cdeaf6e77bef8b", "committedDate": "2020-09-21T20:54:41Z", "message": "use the simpler toolbar.addWidget(command) for build clear button instead of a whole new widget"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyOTk3Nzkz", "url": "https://github.com/rstudio/rstudio/pull/7830#pullrequestreview-492997793", "createdAt": "2020-09-21T21:36:11Z", "commit": {"oid": "fbc5addfe98a780f8efc5bf423cdeaf6e77bef8b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQyMTozNjoxMlrOHVjRKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQyMTo0Mzo1NVrOHVjeNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM1OTk3OA==", "bodyText": "Suggest adding context=\"packageDevelopment\" to this command to match other build-pane related commands. This controls grouping in the keyboard shortcut reference panel, and appears in the command-palette.", "url": "https://github.com/rstudio/rstudio/pull/7830#discussion_r492359978", "createdAt": "2020-09-21T21:36:12Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "diffHunk": "@@ -2471,6 +2471,12 @@ well as menu structures (for main menu and popup menus).\n         windowMode=\"main\"\n         desc=\"Clear console\"/>\n \n+   <cmd id=\"clearBuild\"\n+        buttonLabel=\"\"\n+        label=\"Clear Build\"\n+        windowMode=\"main\"\n+        desc=\"Clear build\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbc5addfe98a780f8efc5bf423cdeaf6e77bef8b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM2MDc0MA==", "bodyText": "This label appears in the Command Palette; probably should be a bit more descriptive? Maybe: \"Clear Build Pane Output\"?", "url": "https://github.com/rstudio/rstudio/pull/7830#discussion_r492360740", "createdAt": "2020-09-21T21:37:55Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "diffHunk": "@@ -2471,6 +2471,12 @@ well as menu structures (for main menu and popup menus).\n         windowMode=\"main\"\n         desc=\"Clear console\"/>\n \n+   <cmd id=\"clearBuild\"\n+        buttonLabel=\"\"\n+        label=\"Clear Build\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbc5addfe98a780f8efc5bf423cdeaf6e77bef8b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM2MzMxNg==", "bodyText": "Should hide this command when Build pane is not available. Do this in BuildCommands.java in setBuildCommandState() in same branch that hides activateBuild.", "url": "https://github.com/rstudio/rstudio/pull/7830#discussion_r492363316", "createdAt": "2020-09-21T21:43:55Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.java", "diffHunk": "@@ -535,6 +535,7 @@\n    public abstract AppCommand loadServerHome();\n \n    // Build\n+   public abstract AppCommand clearBuild();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbc5addfe98a780f8efc5bf423cdeaf6e77bef8b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8934a36dff722bed6ac3077f49466d856d49adb2", "author": {"user": {"login": "adamconroy", "name": null}}, "url": "https://github.com/rstudio/rstudio/commit/8934a36dff722bed6ac3077f49466d856d49adb2", "committedDate": "2020-09-21T22:05:25Z", "message": "clarified build clear commands"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDE4NDIz", "url": "https://github.com/rstudio/rstudio/pull/7830#pullrequestreview-493018423", "createdAt": "2020-09-21T22:15:44Z", "commit": {"oid": "8934a36dff722bed6ac3077f49466d856d49adb2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4989, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}