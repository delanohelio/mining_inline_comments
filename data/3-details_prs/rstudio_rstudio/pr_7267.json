{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzODAyNDk5", "number": 7267, "title": "Parallelize Windows Builds", "bodyText": "This PR changes our make program from nmake to ninja in our windows builds to allow use to compile multiple files in parallel. It also sets the Windows SDK version to ensure we're building with the desired SDK version (based on the Dockerfile).", "createdAt": "2020-07-03T01:09:47Z", "url": "https://github.com/rstudio/rstudio/pull/7267", "merged": true, "mergeCommit": {"oid": "46662d3404adbc58dc8081630ebe4038dda83836"}, "closed": true, "closedAt": "2020-07-08T01:27:43Z", "author": {"login": "MariaSemple"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxEfbPgH2gAyNDQzODAyNDk5OjU2NTUyMGVkY2UxMTZkYTgzZTdiN2ViZTBkYzUzYmM3M2NiOTYxMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyvUjagFqTQ0NDMzNjI4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "565520edce116da83e7b7ebe0dc53bc73cb96126", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/565520edce116da83e7b7ebe0dc53bc73cb96126", "committedDate": "2020-07-02T20:02:19Z", "message": "install ninja in the windows docker container"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41a7975ef3e008cf0569537951d50cf2bad93d35", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/41a7975ef3e008cf0569537951d50cf2bad93d35", "committedDate": "2020-07-02T21:46:36Z", "message": "install ninja on the windows docker image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f53eeeb694b2823e4672802b31e3a0fbd5829292", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/f53eeeb694b2823e4672802b31e3a0fbd5829292", "committedDate": "2020-07-02T21:47:05Z", "message": "change the generation tool and build with ninja instead of nmake"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8feca9b4f9af546332af1a69ab1f2339d561925", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/d8feca9b4f9af546332af1a69ab1f2339d561925", "committedDate": "2020-07-03T01:02:57Z", "message": "correctly invoke the vsdevcmd.bat script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTUxNzc5", "url": "https://github.com/rstudio/rstudio/pull/7267#pullrequestreview-442151779", "createdAt": "2020-07-03T05:21:18Z", "commit": {"oid": "d8feca9b4f9af546332af1a69ab1f2339d561925"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToyMToxOFrOGskBYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToyMzo1NVrOGskDwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4MDcwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              choco install -y ninja --verion \"Ninja 1.10.0\"\n          \n          \n            \n              choco install -y ninja --version \"Ninja 1.10.0\"", "url": "https://github.com/rstudio/rstudio/pull/7267#discussion_r449380704", "createdAt": "2020-07-03T05:21:18Z", "author": {"login": "kevinushey"}, "path": "docker/jenkins/Dockerfile.windows", "diffHunk": "@@ -22,11 +22,12 @@ RUN choco install -y cmake --installargs 'ADD_CMAKE_TO_PATH=\"\"System\"\"' --fail-o\n   choco install -y -i ant; `\n   choco install -y windows-sdk-10.1 --version 10.1.17134.12; `\n   choco install -y 7zip; `\n-  choco install -y nsis\n-  \n+  choco install -y nsis; `\n+  choco install -y ninja --verion \"Ninja 1.10.0\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8feca9b4f9af546332af1a69ab1f2339d561925"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4MTE3Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            cmake --build . %MAKEFLAGS% --config %CMAKE_BUILD_TYPE% --target install || goto :error\n          \n          \n            \n            cmake --build . --config %CMAKE_BUILD_TYPE% --target install -- %MAKEFLAGS% || goto :error\n          \n      \n    \n    \n  \n\nIIRC, CMake usually expects flags that will be passed to the underlying build tool at the end, following --.", "url": "https://github.com/rstudio/rstudio/pull/7267#discussion_r449381172", "createdAt": "2020-07-03T05:23:09Z", "author": {"login": "kevinushey"}, "path": "package/win32/make-install-win32.bat", "diffHunk": "@@ -18,14 +18,17 @@ cd %WIN32_BUILD_PATH%\n if exist CMakeCache.txt del CMakeCache.txt\n \n REM Build the project\n-cmake -G\"Visual Studio 15 2017\" ^\n-      -T host=x86 ^\n+call \"%ProgramFiles(x86)%\\Microsoft Visual Studio\\2017\\BuildTools\\Common7\\Tools\\VsDevCmd.bat\" -clean_env -no_logo || goto :error\n+call \"%ProgramFiles(x86)%\\Microsoft Visual Studio\\2017\\BuildTools\\Common7\\Tools\\VsDevCmd.bat\" -arch=x86 -startdir=none -host_arch=x86 -winsdk=10.0.17134.0 -no_logo || goto :error\n+cmake -G \"Ninja\" ^\n       -DCMAKE_INSTALL_PREFIX:String=%INSTALL_PATH% ^\n       -DCMAKE_BUILD_TYPE=%CMAKE_BUILD_TYPE% ^\n       -DRSTUDIO_TARGET=SessionWin32 ^\n       -DRSTUDIO_PACKAGE_BUILD=1 ^\n+      -DCMAKE_C_COMPILER=cl.exe ^\n+      -DCMAKE_CXX_COMPILER=cl.exe ^\n       ..\\..\\.. || goto :error\n-cmake --build . --config %CMAKE_BUILD_TYPE% --target install || goto :error\n+cmake --build . %MAKEFLAGS% --config %CMAKE_BUILD_TYPE% --target install || goto :error", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8feca9b4f9af546332af1a69ab1f2339d561925"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4MTMxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            cmake --build . %MAKEFLAGS% --config %CMAKE_BUILD_TYPE% || goto :error\n          \n          \n            \n            cmake --build . --config %CMAKE_BUILD_TYPE% -- %MAKEFLAGS% || goto :error", "url": "https://github.com/rstudio/rstudio/pull/7267#discussion_r449381314", "createdAt": "2020-07-03T05:23:55Z", "author": {"login": "kevinushey"}, "path": "package/win32/make-package.bat", "diffHunk": "@@ -39,21 +39,22 @@ if exist \"%BUILD_DIR%/_CPack_Packages\" rmdir /s /q \"%BUILD_DIR%\\_CPack_Packages\"\n \n REM Configure and build the project. (Note that Windows / MSVC builds require\n REM that we specify the build type both at configure time and at build time)\n-cmake -G\"Visual Studio 15 2017 Win64\" ^\n-      -T host=x64 ^\n+call \"%ProgramFiles(x86)%\\Microsoft Visual Studio\\2017\\BuildTools\\Common7\\Tools\\VsDevCmd.bat\" -clean_env -no_logo || goto :error\n+call \"%ProgramFiles(x86)%\\Microsoft Visual Studio\\2017\\BuildTools\\Common7\\Tools\\VsDevCmd.bat\" -arch=amd64 -startdir=none -host_arch=amd64 -winsdk=10.0.17134.0 -no_logo || goto :error\n+cmake -G \"Ninja\" ^\n       -DRSTUDIO_TARGET=Desktop ^\n       -DCMAKE_BUILD_TYPE=%CMAKE_BUILD_TYPE% ^\n       -DRSTUDIO_PACKAGE_BUILD=1 ^\n+      -DCMAKE_C_COMPILER=cl ^\n+      -DCMAKE_CXX_COMPILER=cl ^\n       ..\\..\\.. || goto :error\n-cmake --build . --config %CMAKE_BUILD_TYPE% || goto :error\n+cmake --build . %MAKEFLAGS% --config %CMAKE_BUILD_TYPE% || goto :error", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8feca9b4f9af546332af1a69ab1f2339d561925"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzU3Nzg5", "url": "https://github.com/rstudio/rstudio/pull/7267#pullrequestreview-442757789", "createdAt": "2020-07-06T03:44:38Z", "commit": {"oid": "d8feca9b4f9af546332af1a69ab1f2339d561925"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMzQwMjg2", "url": "https://github.com/rstudio/rstudio/pull/7267#pullrequestreview-443340286", "createdAt": "2020-07-06T19:10:59Z", "commit": {"oid": "d8feca9b4f9af546332af1a69ab1f2339d561925"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1101d801f8997c3710c06a97ec5d289bc014395c", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/1101d801f8997c3710c06a97ec5d289bc014395c", "committedDate": "2020-07-06T19:27:31Z", "message": "Update package/win32/make-install-win32.bat\n\nCo-authored-by: Kevin Ushey <kevin@rstudio.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd84eb374561c6f42c40cb40ddbed42421e6bd34", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/cd84eb374561c6f42c40cb40ddbed42421e6bd34", "committedDate": "2020-07-06T19:27:55Z", "message": "move makeflags after --\n\nCo-authored-by: Kevin Ushey <kevin@rstudio.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c42dca5bbfc339b19f1da7d2e39ddf8462fa462", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/6c42dca5bbfc339b19f1da7d2e39ddf8462fa462", "committedDate": "2020-07-06T19:28:17Z", "message": "fix a type (verion -> version)\n\nCo-authored-by: Kevin Ushey <kevin@rstudio.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4bf41c00c39d1942a2b441f9a227ab94359c0be", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/e4bf41c00c39d1942a2b441f9a227ab94359c0be", "committedDate": "2020-07-08T00:28:45Z", "message": "also look for community tools"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6ab8136acd3990cd581955d2acb0a878424a256", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/c6ab8136acd3990cd581955d2acb0a878424a256", "committedDate": "2020-07-08T00:28:59Z", "message": "Merge remote-tracking branch 'origin/feature/parallel-windows-builds' into feature/parallel-windows-builds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzM2Mjg2", "url": "https://github.com/rstudio/rstudio/pull/7267#pullrequestreview-444336286", "createdAt": "2020-07-08T00:30:17Z", "commit": {"oid": "c6ab8136acd3990cd581955d2acb0a878424a256"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 93, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}