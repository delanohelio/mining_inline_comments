{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5Njc1NDQ1", "number": 7606, "title": "index R6 class method definitions; add to fuzzy finder", "bodyText": "Intent\nAdd R6Class method definitions to the fuzzy finder (Ctrl + .), making them more easily navigable in large projects.\n\nApproach\nThe R source indexer is augmented specifically to allow indexing of function definitions found within an R6Class() call.\nQA Notes\nTry creating your own R6Class() definitions, and testing how the fuzzy finder locates those functions. You may need to install the R6 package via:\ninstall.packages(\"R6\")\n\nYou can also read the documentation in ?R6Class for more details.\nIt would be worth validating that previously-indexed results are still available (ie: I didn't accidentally break indexing of other types of objects).", "createdAt": "2020-08-18T18:50:10Z", "url": "https://github.com/rstudio/rstudio/pull/7606", "merged": true, "mergeCommit": {"oid": "09280e09ebca5f9597c1b32a0fe3645d8e81f1e6"}, "closed": true, "closedAt": "2020-08-31T20:45:49Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdALjdFgH2gAyNDY5Njc1NDQ1OjQ0ZTE4YjFjNzBkNzYxYjRhODFmZmQ2ZGQxYTI0MWIyYjBjN2IxOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCed57AH2gAyNDY5Njc1NDQ1OjViZDRjOWY5MmMwODg4NmY1NzBjNjQzYzc4NzVmNDFjOTczNDZhNmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "44e18b1c70d761b4a81ffd6dd1a241b2b0c7b195", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/44e18b1c70d761b4a81ffd6dd1a241b2b0c7b195", "committedDate": "2020-08-18T18:44:55Z", "message": "add R6Class method definitions to indexer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09f64822186c6041fbf1b7fe2c5fbf258dd74e95", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/09f64822186c6041fbf1b7fe2c5fbf258dd74e95", "committedDate": "2020-08-18T18:45:24Z", "message": "update NEWS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0ODgzOTIx", "url": "https://github.com/rstudio/rstudio/pull/7606#pullrequestreview-474883921", "createdAt": "2020-08-25T20:58:25Z", "commit": {"oid": "09f64822186c6041fbf1b7fe2c5fbf258dd74e95"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMDo1ODoyNVrOHGpfHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMDo1ODoyNVrOHGpfHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjczMzIxMw==", "bodyText": "What happens to this if the nesting is incorrect? e.g. with the code {( }), encountering the first } would seem to pop the ) off the stack even though it doesn't match.", "url": "https://github.com/rstudio/rstudio/pull/7606#discussion_r476733213", "createdAt": "2020-08-25T20:58:25Z", "author": {"login": "jmcphers"}, "path": "src/cpp/core/r_util/RSourceIndex.cpp", "diffHunk": "@@ -219,57 +219,76 @@ bool isMethodOrClassDefinition(const RToken& token)\n \n class IndexStatus\n {\n+   \n public:\n    \n-   IndexStatus()\n-      : braceLevel_(0),\n-        parenLevel_(0),\n-        bracketLevel_(0),\n-        doubleBracketLevel_(0)\n-   {}\n+   IndexStatus(const RTokens& tokens)\n+      : tokens_(tokens)\n+   {\n+   }\n    \n+   // The indexer maintains a vector of indices, recording\n+   // the indices at which brackets were discovered. Tokens\n+   // are popped off the stack as right brackets are discovered.\n    void update(const RTokenCursor& cursor)\n    {\n       switch (cursor.type())\n       {\n       \n-      case RToken::LBRACE: ++braceLevel_; break;\n-      case RToken::LPAREN: ++parenLevel_; break;\n-      case RToken::LBRACKET: ++bracketLevel_; break;\n-      case RToken::LDBRACKET: ++doubleBracketLevel_; break;\n-         \n-      case RToken::RBRACE: --braceLevel_; break;\n-      case RToken::RPAREN: --parenLevel_; break;\n-      case RToken::RBRACKET: --bracketLevel_; break;\n-      case RToken::RDBRACKET: --doubleBracketLevel_; break;\n+      // Left brackets\n+      case RToken::LPAREN:\n+      case RToken::LBRACE:\n+      case RToken::LBRACKET:\n+      case RToken::LDBRACKET:\n+      {\n+         stack_.push_back(cursor.offset());\n+         break;\n+      }\n+      \n+      // Right brackets\n+      case RToken::RBRACE:\n+      case RToken::RPAREN:\n+      case RToken::RBRACKET:\n+      case RToken::RDBRACKET:\n+      {\n+         stack_.pop_back();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09f64822186c6041fbf1b7fe2c5fbf258dd74e95"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0521ebf76c18b9115f77c85e00920c8add8f8669", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/0521ebf76c18b9115f77c85e00920c8add8f8669", "committedDate": "2020-08-25T21:18:41Z", "message": "validate stack non-empty before popping back"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0d353e642d8dc77b65df84a823b420b3dafb02b", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/a0d353e642d8dc77b65df84a823b420b3dafb02b", "committedDate": "2020-08-25T21:47:47Z", "message": "use token cursor (more robust)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bd4c9f92c08886f570c643c7875f41c97346a6c", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/5bd4c9f92c08886f570c643c7875f41c97346a6c", "committedDate": "2020-08-25T21:54:54Z", "message": "double-check token type before pop"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 57, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}