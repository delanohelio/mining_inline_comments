{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwMjA3NDAz", "number": 7738, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQxNToxMzoyNlrOEgm_TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQxNToxMzoyNlrOEgm_TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNjI4Njg0OnYy", "diffSide": "RIGHT", "path": "src/gwt/panmirror/src/editor/src/editor/editor.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQxNToxMzoyNlrOHNijRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQxNToxMzoyNlrOHNijRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk1OTYyMw==", "bodyText": "In order to preserve the selection's marks here you want to do this:\nconst tr = this.view.state.tr;\nconst selectionMarks = tr.selection.$from.marks();\ntr.replaceSelectionWith(state.schema.text(value, selectionMarks), false);\nthis.view.dispatch(tr);", "url": "https://github.com/rstudio/rstudio/pull/7738#discussion_r483959623", "createdAt": "2020-09-05T15:13:26Z", "author": {"login": "jjallaire"}, "path": "src/gwt/panmirror/src/editor/src/editor/editor.ts", "diffHunk": "@@ -627,6 +627,33 @@ export class Editor {\n     return this.getMarkdownCode(tr, options);\n   }\n \n+  public getSelectedText(): string {\n+    \n+    return this.state.doc.textBetween(\n+      this.state.selection.from,\n+      this.state.selection.to\n+    );\n+\n+  }\n+\n+  public replaceSelection(value: string): void {\n+\n+    // retrieve properties we need from selection\n+    let {from, empty} = this.view.state.selection;\n+\n+    // insert text", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f21f621d83233184052d6c6aa56ba4e743af1bc"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4181, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}