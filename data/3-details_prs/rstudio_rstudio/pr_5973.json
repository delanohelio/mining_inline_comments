{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMjA1OTI0", "number": 5973, "title": "Scan R Markdown YAML header for dependencies", "bodyText": "This change extends the package dependency scanner for R Markdown documents so that it looks in the YAML header in addition to the R code in the body of the document.\n\nIt currently understands three types of dependencies:\n\nA dependency on an output format supplied by an R package, given as pkg::output_format\nAn explicit dependency on the shiny package via runtime: shiny or similar\nAn implicit dependency on the shiny package via parameterization\n\nAlso adds unit tests for this feature.\nCloses #4779.", "createdAt": "2020-01-07T22:44:50Z", "url": "https://github.com/rstudio/rstudio/pull/5973", "merged": true, "mergeCommit": {"oid": "fcd3f07b0f8be252f468b957bdd314d886f830ad"}, "closed": true, "closedAt": "2020-01-07T23:10:22Z", "author": {"login": "jmcphers"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4IrKAAH2gAyMzYwMjA1OTI0OjY2MzE0NDU2OWQ4ZjhiNDQxNTBjNzMyYmM4ZDJhOWQ1MDMwNTIyMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4I7FiAFqTMzOTU2MDQ2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "663144569d8f8b44150c732bc8d2a9d50305221e", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/663144569d8f8b44150c732bc8d2a9d50305221e", "committedDate": "2020-01-07T22:41:04Z", "message": "scan R Markdown YAML header for dependencies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTYwNDYx", "url": "https://github.com/rstudio/rstudio/pull/5973#pullrequestreview-339560461", "createdAt": "2020-01-07T22:56:52Z", "commit": {"oid": "663144569d8f8b44150c732bc8d2a9d50305221e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMjo1Njo1MlrOFbIVTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMjo1Njo1MlrOFbIVTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MjM5OQ==", "bodyText": "Is it possible that some users might want to reference unexported functions here; e.g. pkg:::bar?", "url": "https://github.com/rstudio/rstudio/pull/5973#discussion_r363992399", "createdAt": "2020-01-07T22:56:52Z", "author": {"login": "kevinushey"}, "path": "src/cpp/session/modules/SessionCodeTools.R", "diffHunk": "@@ -2122,8 +2114,58 @@\n       return(character())\n \n    }\n-   \n+\n    discoveries <- new.env(parent = emptyenv())\n+\n+   # for R Markdown docs, scan the YAML header (requires the YAML package, a dependency of\n+   # rmarkdown)\n+   if (requireNamespace(\"yaml\", quietly = TRUE))\n+   {\n+      # split document into sections based on the YAML header delimter\n+      sections <- unlist(strsplit(contents, \"---\", fixed = TRUE))\n+      if (length(sections) > 2)\n+      {\n+         front <- yaml::read_yaml(text = sections[[2]])\n+\n+         # start with an empty output\n+         output <- NULL\n+\n+         if (!is.null(names(front$output)))\n+         {\n+            # if the output key has children, it will appear as a list name\n+            # output:\n+            #   pkg_name::out_fmt:\n+            #     foo: bar\n+            output <- names(front$output)[[1]]\n+         }\n+         else if (is.character(front$output))\n+         {\n+            # if the output key doesn't have children, it will appear as a plain character\n+            #\n+            # output: pkg_name::out_fmt\n+            output <- front$output\n+         }\n+\n+         # check for references to an R package in output format\n+         if (!is.null(output))\n+         {\n+            format <- unlist(strsplit(output, \"::\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "663144569d8f8b44150c732bc8d2a9d50305221e"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 417, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}