{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2ODM5NDk4", "number": 8478, "title": "be compatible with UCRT builds of R", "bodyText": "Intent\nAllow RStudio to run with development builds of R build using the UCRT. Closes #8461.\nApproach\nRather than try to set R_max_memory via cmdlineoptions(), set it by finding the R_max_memory symbol and setting it explicitly.\nQA Notes\nTest that RStudio works with the UCRT builds of R published here: https://www.r-project.org/nosvn/winutf8/R-devel-win.exe\nAlso check that memory.limit() reports something \"sane\" -- e.g. I see on a machine with 8GB on RAM:\n> memory.limit()\n[1] 8169\n\nNote that, when launching RStudio, you can hold the Ctrl key down to tell RStudio you'd like to pick a specific version of R before launch.", "createdAt": "2020-11-24T23:07:25Z", "url": "https://github.com/rstudio/rstudio/pull/8478", "merged": true, "mergeCommit": {"oid": "8e421b9ebcaa8e937ff0dc466d954e16d0c6498c"}, "closed": true, "closedAt": "2020-12-01T23:21:55Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh-zorgFqTU0MjIwODg3OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiCboVgBqjQwNTk2NzIzMTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMjA4ODc5", "url": "https://github.com/rstudio/rstudio/pull/8478#pullrequestreview-542208879", "createdAt": "2020-12-01T19:04:26Z", "commit": {"oid": "f09e8a739448e109a4de58c02d2ae25e711be37a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxOTowNDoyN1rOH87lFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxOTowNDoyN1rOH87lFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1Mjc1Ng==", "bodyText": "\ud83e\udd2e", "url": "https://github.com/rstudio/rstudio/pull/8478#discussion_r533652756", "createdAt": "2020-12-01T19:04:27Z", "author": {"login": "jmcphers"}, "path": "src/cpp/r/session/REmbeddedWin32.cpp", "diffHunk": "@@ -104,6 +106,74 @@ int askYesNoCancel(const char* question)\n    }\n }\n \n+bool initializeMaxMemoryDangerously()\n+{\n+   Error error;\n+\n+   void* pLibrary = nullptr;\n+   error = core::system::loadLibrary(\"R.dll\", &pLibrary);\n+   if (error)\n+      return false;\n+\n+   // first, see if we can load the 'R_max_memory' symbol directly\n+   size_t* p_R_max_memory = nullptr;\n+   error = core::system::loadSymbol(\n+            pLibrary,\n+            \"R_max_memory\",\n+            (void**) &p_R_max_memory);\n+\n+   if (error)\n+   {\n+      // terrible, terrible hack -- for typical builds of R from CRAN,\n+      // the memory address for R_max_memory lies just before the\n+      // Rwin_graphicsx symbol, so find that symbol, and compute the\n+      // position of R_max_memory offset from that\n+      char* p_Rwin_graphicsx = nullptr;\n+      error = core::system::loadSymbol(\n+               pLibrary,\n+               \"Rwin_graphicsx\",\n+               (void**) &p_Rwin_graphicsx);\n+\n+      if (error)\n+         return false;\n+\n+      // get memory address for R_max_memory\n+      p_R_max_memory = (size_t*) (p_Rwin_graphicsx - sizeof(size_t));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f09e8a739448e109a4de58c02d2ae25e711be37a"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "902d98f0325f54e58584d074913bcc245302e91c", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/902d98f0325f54e58584d074913bcc245302e91c", "committedDate": "2020-12-01T23:20:25Z", "message": "be compatible with UCRT builds of R"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f09e8a739448e109a4de58c02d2ae25e711be37a", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/f09e8a739448e109a4de58c02d2ae25e711be37a", "committedDate": "2020-11-24T23:04:53Z", "message": "be compatible with UCRT builds of R"}, "afterCommit": {"oid": "902d98f0325f54e58584d074913bcc245302e91c", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/902d98f0325f54e58584d074913bcc245302e91c", "committedDate": "2020-12-01T23:20:25Z", "message": "be compatible with UCRT builds of R"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4909, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}