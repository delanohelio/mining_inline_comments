{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1ODg3NzQ5", "number": 7432, "title": "tweak reporting of autosave errors", "bodyText": "This PR tweaks the reporting of save and autosave errors.\nWhen an autosave error occurs, a one-time dialog is shown indicating roughly that \"something bad happened\".\n\nAfter this point, RStudio will no longer report subsequent autosave errors to the user.\nAttempts to explicitly save files will still be reported, with a somewhat clearer error message:\n\nThis \"An internal error occurred\" message indicates that we were unable to retrieve the document from our source database. (not sure if we want to surface more information here?)\nNote that this PR doesn't do anything to recover from this state; it just adjusts how this state is reported to the user.\nSmall bandaid for #7427.", "createdAt": "2020-07-23T18:40:04Z", "url": "https://github.com/rstudio/rstudio/pull/7432", "merged": true, "mergeCommit": {"oid": "ce231fcb8aa85ca3d507983234ae76b2db9172fb"}, "closed": true, "closedAt": "2020-07-27T18:19:25Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3z4kmAH2gAyNDU1ODg3NzQ5OjQ0MjUyYWFlN2U3MmRmNmE3ZmYyNmI3MTBiMGI0NjFiNjAwNWNkYTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4MC5cAFqTQ1NTIyMjIzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "44252aae7e72df6a7ff26b710b0b461b6005cda0", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/44252aae7e72df6a7ff26b710b0b461b6005cda0", "committedDate": "2020-07-23T18:38:52Z", "message": "tweak reporting of autosave errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "807ad362cf6a33d9681308700e86407cd3dad9d5", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/807ad362cf6a33d9681308700e86407cd3dad9d5", "committedDate": "2020-07-23T18:43:58Z", "message": "update docs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af18b8d0c940cbe93f96cb76c821929c2e9110ec", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/af18b8d0c940cbe93f96cb76c821929c2e9110ec", "committedDate": "2020-07-23T18:34:08Z", "message": "tweak reporting of autosave errors"}, "afterCommit": {"oid": "807ad362cf6a33d9681308700e86407cd3dad9d5", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/807ad362cf6a33d9681308700e86407cd3dad9d5", "committedDate": "2020-07-23T18:43:58Z", "message": "update docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NDQ1ODY3", "url": "https://github.com/rstudio/rstudio/pull/7432#pullrequestreview-454445867", "createdAt": "2020-07-23T19:48:58Z", "commit": {"oid": "807ad362cf6a33d9681308700e86407cd3dad9d5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTo0ODo1OVrOG2ZLhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTo1MjowNVrOG2ZRYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY4ODgzOQ==", "bodyText": "Nit: should follow member variable convention (_).", "url": "https://github.com/rstudio/rstudio/pull/7432#discussion_r459688839", "createdAt": "2020-07-23T19:48:59Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/model/DocUpdateSentinel.java", "diffHunk": "@@ -867,7 +904,10 @@ protected void execute()\n    private HandlerRegistration lastChanceSaveHandlerReg_;\n    private final HashMap<String, ValueChangeHandlerManager<String>> \n                  propertyChangeHandlers_;\n+   private boolean loggedAutosaveError = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "807ad362cf6a33d9681308700e86407cd3dad9d5"}, "originalPosition": 144}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY5MDMzNg==", "bodyText": "Not sure about treating this as a completion. One consequence of this is that the rest of the code is going to think that changes are backed up when they aren't. Will this cause the user to not get the \"you haven't saved your changes\" warning when they attempt to navigate away with unsaved changes?", "url": "https://github.com/rstudio/rstudio/pull/7432#discussion_r459690336", "createdAt": "2020-07-23T19:52:05Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/model/DocUpdateSentinel.java", "diffHunk": "@@ -470,20 +475,52 @@ private boolean doSaveImpl(final String path,\n                @Override\n                public void onError(ServerError error)\n                {\n+                  // Always log save errors.\n                   Debug.logError(error);\n+                  \n+                  // Inform the user once if this was an autosave failure.\n+                  if (isAutosave && !loggedAutosaveError)\n+                  {\n+                     loggedAutosaveError = true;\n+\n+                     RStudioGinjector.INSTANCE.getGlobalDisplay().showErrorMessage(\n+                           \"Error Autosaving File\",\n+                           \"RStudio was unable to autosave this file. You may need \" +\n+                           \"to restart RStudio.\");\n+                  }\n+                 \n+                  // Avoid reporting auto-save errors to the user via the indicator,\n+                  // as this could lead to a relentless cascade of errors while the\n+                  // user attempts to edit the document.\n                   if (progress != null)\n-                     progress.onError(error.getUserMessage());\n+                  {\n+                     if (isAutosave)\n+                     {\n+                        progress_.onCompleted();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "807ad362cf6a33d9681308700e86407cd3dad9d5"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69349b61191caf441ba98ea5611765b3b8f0cb05", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/69349b61191caf441ba98ea5611765b3b8f0cb05", "committedDate": "2020-07-23T20:13:39Z", "message": "missed trailing underscore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c2453eba051ad2e026c44a8b9de6cdc69a93a67", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/4c2453eba051ad2e026c44a8b9de6cdc69a93a67", "committedDate": "2020-07-23T20:20:35Z", "message": "use custom progress indicator for autosaves"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbce46a511d24949dad288be48fd4ba2556b742a", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/dbce46a511d24949dad288be48fd4ba2556b742a", "committedDate": "2020-07-23T20:21:10Z", "message": "update comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3453c6c07965468f8cfb1f7ac74dffc28241a3c0", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/3453c6c07965468f8cfb1f7ac74dffc28241a3c0", "committedDate": "2020-07-23T20:23:46Z", "message": "no longer necessary to wire 'isAutosave' around"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MjIyMjM5", "url": "https://github.com/rstudio/rstudio/pull/7432#pullrequestreview-455222239", "createdAt": "2020-07-24T22:47:52Z", "commit": {"oid": "3453c6c07965468f8cfb1f7ac74dffc28241a3c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 148, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}