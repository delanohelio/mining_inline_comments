{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1Mjc1Mjky", "number": 7006, "title": "handle raw strings in backend tokenizer", "bodyText": "Part of #6788.\nNote that this only updates the backend tokenizer, not the front-end tokenizer. This implies that while code won't be \"colored\" directly in the Ace editor instance, the diagnostics should nonetheless be correct.\nNote: R's raw string literals are described within ?Quotes. Here's an example:\nr\"---(abc)---\"\n\nR's raw string literals basically have the following format:\n\nCan start with r or R,\nCan be quoted via ' or \",\nCan have an optional number of hyphens,\nCan have an opening bracket (, [ or {,\nRaw string literal text,\nClosing complement for opening bracket,\nSame number of hyphens,\nMatching closing quote.\n\ncc: @adamconroy, in case this is relevant for the front-end tokenizer.", "createdAt": "2020-05-29T19:06:41Z", "url": "https://github.com/rstudio/rstudio/pull/7006", "merged": true, "mergeCommit": {"oid": "275964ec5f5c338daf848168e161922fdd14f627"}, "closed": true, "closedAt": "2020-05-29T22:16:55Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmHMz8AH2gAyNDI1Mjc1MjkyOjdjYjFlN2ZiNjFlZjdjNDU0MmE3ZTY2NTk5ODk4YTgwY2JhNzE1ZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmHx-2AFqTQyMTIzODU1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7cb1e7fb61ef7c4542a7e66599898a80cba715ed", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/7cb1e7fb61ef7c4542a7e66599898a80cba715ed", "committedDate": "2020-05-29T18:58:32Z", "message": "handle raw strings in backend tokenizer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dae0f9dfefe0a07298c9326b5458eb2607c4ea77", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/dae0f9dfefe0a07298c9326b5458eb2607c4ea77", "committedDate": "2020-05-29T19:22:04Z", "message": "restore iterator state on error; avoid case fall-through"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjM4NTU0", "url": "https://github.com/rstudio/rstudio/pull/7006#pullrequestreview-421238554", "createdAt": "2020-05-29T19:38:32Z", "commit": {"oid": "dae0f9dfefe0a07298c9326b5458eb2607c4ea77"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOTozODozMlrOGcpn1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOTozODozMlrOGcpn1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5NTI1NA==", "bodyText": "\ud83d\ude31", "url": "https://github.com/rstudio/rstudio/pull/7006#discussion_r432695254", "createdAt": "2020-05-29T19:38:32Z", "author": {"login": "jmcphers"}, "path": "src/cpp/core/r_util/RTokenizer.cpp", "diffHunk": "@@ -217,6 +238,113 @@ RToken RTokenizer::matchWhitespace()\n    return consumeToken(RToken::WHITESPACE, tokenLength(tokenPatterns().WHITESPACE));\n }\n \n+Error RTokenizer::matchRawStringLiteral(RToken* pToken)\n+{\n+   auto start = pos_;\n+   \n+   // consume leading 'r' or 'R'\n+   wchar_t firstChar = eat();\n+   if (!(firstChar == L'r' || firstChar == L'R'))\n+   {\n+      pos_ = start;\n+      return tokenizeError(\n+               \"expected 'r' or 'R' at start of raw string literal\",\n+               ERROR_LOCATION);\n+   }\n+   \n+   // consume quote character\n+   wchar_t quoteChar = eat();\n+   if (!(quoteChar == L'\"' || quoteChar == L'\\''))\n+   {\n+      pos_ = start;\n+      return tokenizeError(\n+               \"expected quote character at start of raw string literal\",\n+               ERROR_LOCATION);\n+   }\n+   \n+   // consume an optional number of hyphens\n+   int hyphenCount = 0;\n+   wchar_t ch = eat();\n+   while (ch == L'-')\n+   {\n+      hyphenCount++;\n+      ch = eat();\n+   }\n+   \n+   // okay, we're now sitting on open parenthesis\n+   wchar_t lhs = ch;\n+   \n+   // form right boundary character based on consumed parenthesis.\n+   // if it wasn't a parenthesis, just look for the associated closing quote\n+   wchar_t rhs;\n+   if (lhs == L'(')\n+   {\n+      rhs = L')';\n+   }\n+   else if (lhs == L'{')\n+   {\n+      rhs = L'}';\n+   }\n+   else if (lhs == L'[')\n+   {\n+      rhs = L']';\n+   }\n+   else\n+   {\n+      pos_ = start;\n+      return tokenizeError(\n+               \"expected opening bracket at start of raw string literal\",\n+               ERROR_LOCATION);\n+   }\n+   \n+   // start searching for the end of the raw string\n+   bool valid = false;\n+   \n+   while (true)\n+   {\n+      // i know, i know -- a label!? we use that here just because\n+      // we need to 'break' out of a nested loop below, and just\n+      // using a simple goto is cleaner than having e.g. an extra\n+      // boolean flag tracking whether we should 'continue'\n+      LOOP:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dae0f9dfefe0a07298c9326b5458eb2607c4ea77"}, "originalPosition": 122}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 164, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}