{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzODczNjYz", "number": 6040, "title": "Add Package Source to Find In Files include options", "bodyText": "Fixes #2934\n\nThis PR adds \"Package Source\" as an include option to the Find In Files pane. When selected the find will only take place in package source directories: /src, /R, and /tests. This option is only available when the Find: directory path is a package directory. Aside from 'All Files', it is the only include option that can be combined with the 'Standard Git Exclusions' exclude option as it doesn't require the --include grep argument. The existing code to not allow any include options is simpler than the code to not allow some include options so FindInFilesDialog.java required some refactoring.", "createdAt": "2020-01-16T22:16:49Z", "url": "https://github.com/rstudio/rstudio/pull/6040", "merged": true, "mergeCommit": {"oid": "2f5eee048dce4a0986da64c8940c96b721a4526e"}, "closed": true, "closedAt": "2020-01-27T22:54:48Z", "author": {"login": "melissa-barca"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4diKbgH2gAyMzYzODczNjYzOjc4MDNhNGRkYWU0M2IyODgzZjY3YzE4MmU0OWZiZTU2MWE5YmYwMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-k1ybAH2gAyMzYzODczNjYzOjE1OTlmNDUwNmI2YTg2Mzk5NWIwOGViODcwZjZlMTQ2NWM1ODg1NGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7803a4ddae43b2883f67c182e49fbe561a9bf002", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/7803a4ddae43b2883f67c182e49fbe561a9bf002", "committedDate": "2020-01-08T22:59:15Z", "message": "update the UI so a user cannot input file patterns when using git exclusions\nas git grep doesn't have an equivalent to grep's --include"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d7059c81c36c388ef67ecffd4533b63d13d5581", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/2d7059c81c36c388ef67ecffd4533b63d13d5581", "committedDate": "2020-01-09T02:06:09Z", "message": "add include option for R packages (R/ src/ tests/)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23c69b18ec6a9104853731e0c4b50c1b18c9161f", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/23c69b18ec6a9104853731e0c4b50c1b18c9161f", "committedDate": "2020-01-09T20:17:09Z", "message": "fix spacing and add error checking for when a user tries to search a package while not in a\npackage session"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ee1ca83af5561bbc2ebd1dcf479d9b79adb4bd3", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/9ee1ca83af5561bbc2ebd1dcf479d9b79adb4bd3", "committedDate": "2020-01-10T01:49:03Z", "message": "update state name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cac983631da2f51d35b5cfe5568c6e4cb5f1b8c4", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/cac983631da2f51d35b5cfe5568c6e4cb5f1b8c4", "committedDate": "2020-01-14T00:02:30Z", "message": "update the UI so a user cannot input file patterns when using git exclusions\nas git grep doesn't have an equivalent to grep's --include"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b446c85fe3bc8c31ddf7611f5343bafb219960af", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/b446c85fe3bc8c31ddf7611f5343bafb219960af", "committedDate": "2020-01-14T00:03:50Z", "message": "rename functions using retrieve because we are not fetching\nupdate include/exclude file patterns to use enums for readability\ndisable the Git option when git is not installed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b02744c1a5292e0403f0a32965f4dbde8535c629", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/b02744c1a5292e0403f0a32965f4dbde8535c629", "committedDate": "2020-01-14T00:03:50Z", "message": "fix issue where in rare cases ReplaceOperationEndedEvent wasn't getting called and the progress bar\nwas visible after the replace had completed\n- removed code unnsuccesfully trying to fix this"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8988227b65a5ac2f92cadbaaccdfd84887c02a29", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/8988227b65a5ac2f92cadbaaccdfd84887c02a29", "committedDate": "2020-01-14T00:03:50Z", "message": "disable Standard Git Exclusions selection when git is not installed or a git repo isn't selected\nadd value change handler to Find In Files directory chooser, on changes check if the new directory\nis a git repository and if git is installed\nadd new Files Server operation to check if a directory is a git directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4da19f30bc83bba7f492781e0c9aefafb450c028", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/4da19f30bc83bba7f492781e0c9aefafb450c028", "committedDate": "2020-01-14T00:03:50Z", "message": "add include option for user to filter by package source code\nadd new RPC to check if a directory is a package, only display the package source option for package\ndirectories"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c158214d1b7cb337026bed8baeedf2ec2d92da4", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/1c158214d1b7cb337026bed8baeedf2ec2d92da4", "committedDate": "2020-01-14T21:32:54Z", "message": "only allow includes that don't require the grep --include parameter when filtering with git"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceb218b2a0b36ad4fd47aa3863e6226b2d166f7a", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/ceb218b2a0b36ad4fd47aa3863e6226b2d166f7a", "committedDate": "2020-01-15T00:38:38Z", "message": "allow user to filter by package source and follow standard git exclusions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d277db4376dd4c482af64f88967829db017b46b", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/0d277db4376dd4c482af64f88967829db017b46b", "committedDate": "2020-01-16T00:00:05Z", "message": "Merge branch 'feature/replace-git-ignore' of https://github.com/rstudio/rstudio into feature/find-in-package-src"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "852c6e6d5c7b731110d97e3345240b2a68efc2ae", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/852c6e6d5c7b731110d97e3345240b2a68efc2ae", "committedDate": "2020-01-16T00:51:42Z", "message": "rename enums for readability\nfix issue where Git and Package states weren't preserved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "285a581ac72308a9a0ac541889b2a4d84324568d", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/285a581ac72308a9a0ac541889b2a4d84324568d", "committedDate": "2020-01-16T20:55:22Z", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/find-in-package-src"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26bf1c7db70f8685b96ab5675632b3dbd25a2448", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/26bf1c7db70f8685b96ab5675632b3dbd25a2448", "committedDate": "2020-01-16T22:02:08Z", "message": "add include options to GrepOptions class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0Nzg4OTQ0", "url": "https://github.com/rstudio/rstudio/pull/6040#pullrequestreview-344788944", "createdAt": "2020-01-17T19:19:41Z", "commit": {"oid": "26bf1c7db70f8685b96ab5675632b3dbd25a2448"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxOToxOTo0MlrOFfCx9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxOTozOTo0NFrOFfDTEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODA5NTczMg==", "bodyText": "Nit: This should only happen if there's a bug in the front-end, right? If that's the case I think LOG_DEBUG_MESSAGE makes sense more than LOG_WARNING_MESSAGE. (The same for above in processExcludeFlags)", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368095732", "createdAt": "2020-01-17T19:19:42Z", "author": {"login": "MariaSemple"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1074,6 +1089,23 @@ class GrepOptions : public boost::noncopyable\n          }\n       }\n    }\n+\n+   void processIncludeFilePatterns()\n+   {\n+      packageFlag_ = false;\n+      for (json::Value filePattern : includeFilePatterns_)\n+      {\n+         if (filePattern.getType() != json::Type::STRING)\n+            LOG_WARNING_MESSAGE(\"Include files contain non-string value\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26bf1c7db70f8685b96ab5675632b3dbd25a2448"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODA5ODAyNw==", "bodyText": "Do you intend to go back to EscapeAll before you add all the directories to the command? Why switch to EscapeFilesOnly at all? If you just wanted -- to not be escaped, I think it would read clearer if you changed EscapeFilesOnly to EscapeNone (assuming that's an option - if not maybe a comment would help).", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368098027", "createdAt": "2020-01-17T19:24:58Z", "author": {"login": "MariaSemple"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1095,6 +1127,23 @@ struct ReplaceOptions\n    const std::string replacePattern;\n };\n \n+void addPackageDirectoriesToCommand(const FilePath& directoryPath, shell_utils::ShellCommand* pCmd)\n+{\n+   FilePath rPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/R\"));\n+   FilePath srcPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/src\"));\n+   FilePath testsPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/tests\"));\n+\n+   *pCmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26bf1c7db70f8685b96ab5675632b3dbd25a2448"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEwMDM5OA==", "bodyText": "How would you feel about it if this function was called addDirectoriesToCommand and took bool packageFlag, const FilePath& dirPath, ShellCommand* pCmd as parameters and handled the if so you only need that cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll; line in one place?", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368100398", "createdAt": "2020-01-17T19:30:18Z", "author": {"login": "MariaSemple"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1191,14 +1240,18 @@ core::Error runGrepOperation(const GrepOptions& grepOptions, const ReplaceOption\n       cmd << tempFile;\n       if (!grepOptions.asRegex())\n          cmd << \"-F\";\n-\n-      for (json::Value filePattern : grepOptions.includeFilePatterns())\n-         cmd << \"--include=\" + filePattern.getString();\n+      for (std::string arg : grepOptions.includeArgs())\n+         cmd << arg;\n       for (std::string arg : grepOptions.excludeArgs())\n          cmd << arg;\n \n-      cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n-      cmd << string_utils::utf8ToSystem(dirPath.getAbsolutePath());\n+      if (grepOptions.packageFlag())\n+         addPackageDirectoriesToCommand(dirPath, &cmd);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26bf1c7db70f8685b96ab5675632b3dbd25a2448"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEwNDIwOA==", "bodyText": "Is it not possible to both set the search directories and add include arguments when using git grep? What does the UI look like in that case?", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368104208", "createdAt": "2020-01-17T19:39:44Z", "author": {"login": "MariaSemple"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1169,11 +1218,11 @@ core::Error runGrepOperation(const GrepOptions& grepOptions, const ReplaceOption\n       cmd << tempFile;\n       if (!grepOptions.asRegex())\n          cmd << \"-F\";\n-      for (json::Value filePattern : grepOptions.includeFilePatterns())\n-      {\n-         cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n-         cmd << filePattern.getString();\n-      }\n+      if (grepOptions.packageFlag())\n+         addPackageDirectoriesToCommand(dirPath, &cmd);\n+      else\n+         for (std::string arg : grepOptions.includeArgs())\n+            cmd << arg;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26bf1c7db70f8685b96ab5675632b3dbd25a2448"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/e2054d70781b71d76ff46d659f70987b3c0c3c5b", "committedDate": "2020-01-17T22:22:25Z", "message": "change warning to debug messages since they should be prevented by the frontend\nrefactor addDirectories function to avoid repeating code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NTA0MTMw", "url": "https://github.com/rstudio/rstudio/pull/6040#pullrequestreview-347504130", "createdAt": "2020-01-23T18:11:47Z", "commit": {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODoxMTo0N1rOFhHzpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODoyNjozMlrOFhIOvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NTIzOQ==", "bodyText": "We don't typically commit TODOs since we have no mechanism for ensuring that they get resolved. If the PR contains unfinished work items, open an issue to track them instead (and optionally refer to it in a comment).", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370275239", "createdAt": "2020-01-23T18:11:47Z", "author": {"login": "jmcphers"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1095,6 +1127,30 @@ struct ReplaceOptions\n    const std::string replacePattern;\n };\n \n+void addDirectoriesToCommand(\n+   bool packageFlag, const FilePath& directoryPath, shell_utils::ShellCommand* pCmd)\n+{\n+   // TODO: review if switching to EscapeFilesOnly is necessay", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NjI5OA==", "bodyText": "I think this should just be a warning, and should include the directory in which we expected to find package folders but didn't.", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370276298", "createdAt": "2020-01-23T18:14:11Z", "author": {"login": "jmcphers"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1095,6 +1127,30 @@ struct ReplaceOptions\n    const std::string replacePattern;\n };\n \n+void addDirectoriesToCommand(\n+   bool packageFlag, const FilePath& directoryPath, shell_utils::ShellCommand* pCmd)\n+{\n+   // TODO: review if switching to EscapeFilesOnly is necessay\n+   *pCmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n+   if (!packageFlag)\n+      *pCmd << string_utils::utf8ToSystem(directoryPath.getAbsolutePath());\n+   else\n+   {\n+      FilePath rPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/R\"));\n+      FilePath srcPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/src\"));\n+      FilePath testsPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/tests\"));\n+   \n+      if (rPath.exists())\n+         *pCmd << rPath; \n+      if (srcPath.exists())\n+         *pCmd << srcPath;\n+      if (testsPath.exists())\n+         *pCmd << testsPath;\n+      else if (!rPath.exists() && !srcPath.exists())\n+         LOG_ERROR_MESSAGE(\"Package directories not found\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3ODAyMw==", "bodyText": "Here and elsewhere: this is verbose and somewhat difficult to read. How about adding something like DomUtils.setOptionDisabled(element, ordinal, disabled)?", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370278023", "createdAt": "2020-01-23T18:17:41Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/output/find/FindInFilesDialog.java", "diffHunk": "@@ -249,32 +265,58 @@ private void manageExcludeFilePattern()\n       if (!gitStatus_ ||\n           !session_.getSessionInfo().isVcsAvailable(VCSConstants.GIT_ID))\n       {\n-         ((Element) listPresetExcludeFilePatterns_.getElement().getChild(1))\n+         ((Element) listPresetExcludeFilePatterns_.getElement().getChild(\n+               Exclude.StandardGit.ordinal()))\n             .setAttribute(\"disabled\", \"disabled\");\n          if (listPresetExcludeFilePatterns_.getSelectedIndex() ==\n-             ExcludeFilePatterns.StandardGit.ordinal())\n-            listPresetExcludeFilePatterns_.setSelectedIndex(ExcludeFilePatterns.None.ordinal());\n+             Exclude.StandardGit.ordinal())\n+            listPresetExcludeFilePatterns_.setSelectedIndex(Exclude.None.ordinal());\n       }\n       else\n-         ((Element) listPresetExcludeFilePatterns_.getElement().getChild(1))\n-            .removeAttribute(\"disabled\");\n-\n+         ((Element) listPresetExcludeFilePatterns_.getElement().getChild(\n+            Exclude.StandardGit.ordinal())).removeAttribute(\"disabled\");\n \n       // disable custom filter text box when 'Custom Filter' is not selected\n       divExcludeCustomFilter_.getStyle().setDisplay(\n             listPresetExcludeFilePatterns_.getSelectedIndex() == \n-            ExcludeFilePatterns.CustomFilter.ordinal()\n+            Exclude.CustomFilter.ordinal()\n             ? Style.Display.BLOCK\n             : Style.Display.NONE);\n \n       // user cannot specify include patterns when using git grep\n       if (listPresetExcludeFilePatterns_.getSelectedIndex() != \n-          ExcludeFilePatterns.StandardGit.ordinal())\n-         listPresetFilePatterns_.setEnabled(true);\n+          Exclude.StandardGit.ordinal())\n+      {\n+         ((Element) listPresetFilePatterns_.getElement().getChild(\n+            Include.CommonRSourceFiles.ordinal())).removeAttribute(\"disabled\");\n+         ((Element) listPresetFilePatterns_.getElement().getChild(\n+            Include.RScripts.ordinal())).removeAttribute(\"disabled\");\n+         ((Element) listPresetFilePatterns_.getElement().getChild(\n+            Include.CustomFilter.ordinal())).removeAttribute(\"disabled\");\n+      }\n       else\n       {\n-         listPresetFilePatterns_.setEnabled(false);\n-         listPresetFilePatterns_.setSelectedIndex(IncludeFilePatterns.AllFiles.ordinal());\n+         // when using standard git exclusions we don't have the option to search recursively and\n+         // specify file types\n+         ((Element) listPresetFilePatterns_.getElement().getChild(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MTI4MQ==", "bodyText": "This is also very verbose. I think all that's needed to simplify this is a method to select the index with the given value. I feel like we already have something like this (and if we don't it should be pretty easy to add!)", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370281281", "createdAt": "2020-01-23T18:24:32Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/output/find/FindInFilesDialog.java", "diffHunk": "@@ -374,28 +416,41 @@ public void setState(State dialogState)\n       checkboxRegex_.setValue(dialogState.isRegex());\n       dirChooser_.setText(dialogState.getPath());\n \n-      // indexes refer to corresponding enums, but left as ints for readability\n       String includeFilePatterns = StringUtil.join(\n             Arrays.asList(dialogState.getFilePatterns()), \", \");\n-      if (listPresetFilePatterns_.getValue(0) == includeFilePatterns)\n-         listPresetFilePatterns_.setSelectedIndex(0);\n-      else if (listPresetFilePatterns_.getValue(1) == includeFilePatterns)\n-         listPresetFilePatterns_.setSelectedIndex(1);\n-      else if (listPresetFilePatterns_.getValue(2) == includeFilePatterns)\n-         listPresetFilePatterns_.setSelectedIndex(2);\n+      if (includeFilePatterns == \n+          listPresetFilePatterns_.getValue(Include.AllFiles.ordinal()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MTk3Nw==", "bodyText": "(For reference, and this should be clearer in the coding standards, you typically only log an error when an operation cannot proceed. In this case we're clearly proceeding as though nothing happened, so it's a warning.)", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370281977", "createdAt": "2020-01-23T18:26:04Z", "author": {"login": "jmcphers"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1095,6 +1127,30 @@ struct ReplaceOptions\n    const std::string replacePattern;\n };\n \n+void addDirectoriesToCommand(\n+   bool packageFlag, const FilePath& directoryPath, shell_utils::ShellCommand* pCmd)\n+{\n+   // TODO: review if switching to EscapeFilesOnly is necessay\n+   *pCmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n+   if (!packageFlag)\n+      *pCmd << string_utils::utf8ToSystem(directoryPath.getAbsolutePath());\n+   else\n+   {\n+      FilePath rPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/R\"));\n+      FilePath srcPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/src\"));\n+      FilePath testsPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/tests\"));\n+   \n+      if (rPath.exists())\n+         *pCmd << rPath; \n+      if (srcPath.exists())\n+         *pCmd << srcPath;\n+      if (testsPath.exists())\n+         *pCmd << testsPath;\n+      else if (!rPath.exists() && !srcPath.exists())\n+         LOG_ERROR_MESSAGE(\"Package directories not found\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NjI5OA=="}, "originalCommit": {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MjE3Mg==", "bodyText": "Maybe worth logging what arguments we received that we didn't expect?", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370282172", "createdAt": "2020-01-23T18:26:32Z", "author": {"login": "jmcphers"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1169,11 +1225,10 @@ core::Error runGrepOperation(const GrepOptions& grepOptions, const ReplaceOption\n       cmd << tempFile;\n       if (!grepOptions.asRegex())\n          cmd << \"-F\";\n-      for (json::Value filePattern : grepOptions.includeFilePatterns())\n-      {\n-         cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n-         cmd << filePattern.getString();\n-      }\n+      addDirectoriesToCommand(grepOptions.packageFlag(), dirPath, &cmd);\n+\n+      if (grepOptions.packageFlag() && !grepOptions.includeArgs().empty())\n+         LOG_DEBUG_MESSAGE(\"Unknown include argument(s)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b"}, "originalPosition": 112}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f301b22a1a8d2cb1d7d761b244e82397ea2c410", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/5f301b22a1a8d2cb1d7d761b244e82397ea2c410", "committedDate": "2020-01-23T22:07:25Z", "message": "clean up warning message\nimplement and use dom utility to disable or an enable an option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a2d90e7930a464661cfe6ffdc7a1638dfd11245", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/5a2d90e7930a464661cfe6ffdc7a1638dfd11245", "committedDate": "2020-01-23T22:15:32Z", "message": "add specifics to debug message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4OTg2MzA4", "url": "https://github.com/rstudio/rstudio/pull/6040#pullrequestreview-348986308", "createdAt": "2020-01-27T21:26:40Z", "commit": {"oid": "5a2d90e7930a464661cfe6ffdc7a1638dfd11245"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMToyNjo0MVrOFiSCFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMToyNzo1NFrOFiSERA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MTM1MA==", "bodyText": "Makes sense but I think it's unlikely in practice. We usually use TODO as a way to help flag things that need to be resolved before commit, so having TODO in committed code adds noise. Let's leave the comment and rephrase it without TODO.", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371491350", "createdAt": "2020-01-27T21:26:41Z", "author": {"login": "jmcphers"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1095,6 +1127,30 @@ struct ReplaceOptions\n    const std::string replacePattern;\n };\n \n+void addDirectoriesToCommand(\n+   bool packageFlag, const FilePath& directoryPath, shell_utils::ShellCommand* pCmd)\n+{\n+   // TODO: review if switching to EscapeFilesOnly is necessay", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NTIzOQ=="}, "originalCommit": {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MTkwOA==", "bodyText": "Doxygen style params should be either documented (i.e. explain what each one is) or omitted.", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371491908", "createdAt": "2020-01-27T21:27:54Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/core/client/dom/DomUtils.java", "diffHunk": "@@ -1152,6 +1152,21 @@ public static void setPlaceholder(TextBox w, String placeholder)\n       setPlaceholder(w.getElement(), placeholder);\n    }\n \n+   /**\n+    * Set disabled attribute on an element's child\n+    * @param element\n+    * @param ordinal\n+    * @param disable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a2d90e7930a464661cfe6ffdc7a1638dfd11245"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce40ab9d46b2dfec6143eaf33610d18646b3b27e", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/ce40ab9d46b2dfec6143eaf33610d18646b3b27e", "committedDate": "2020-01-27T22:16:50Z", "message": "move getIndexFromValue to FormListBox and switch find in files dialog to use FormListBox.\nWhen Package Source is selected and the user selects a non-package directory,\nswitch include option to All Files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdcf2da42727e147f7535ab2ab55208d7ceaec81", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/bdcf2da42727e147f7535ab2ab55208d7ceaec81", "committedDate": "2020-01-27T22:22:07Z", "message": "comment the parameters in function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f0982867404b8f22f0fd19fe9cc8aaea7d3005d", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/3f0982867404b8f22f0fd19fe9cc8aaea7d3005d", "committedDate": "2020-01-27T22:24:08Z", "message": "change TODO to normal comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MDIwODE0", "url": "https://github.com/rstudio/rstudio/pull/6040#pullrequestreview-349020814", "createdAt": "2020-01-27T22:29:07Z", "commit": {"oid": "3f0982867404b8f22f0fd19fe9cc8aaea7d3005d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MDI5MDE3", "url": "https://github.com/rstudio/rstudio/pull/6040#pullrequestreview-349029017", "createdAt": "2020-01-27T22:46:00Z", "commit": {"oid": "3f0982867404b8f22f0fd19fe9cc8aaea7d3005d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMjo0NjowMFrOFiUHpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMjo0NjowMFrOFiUHpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUyNTU0MQ==", "bodyText": "Nit: to avoid cluttering the logs for each unexpected argument, could it make sense to log \"Unknown include argument(s): \" + boost::join(grepOptions.includeArgs(), \", \") instead?", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371525541", "createdAt": "2020-01-27T22:46:00Z", "author": {"login": "MariaSemple"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1169,10 +1225,12 @@ core::Error runGrepOperation(const GrepOptions& grepOptions, const ReplaceOption\n       cmd << tempFile;\n       if (!grepOptions.asRegex())\n          cmd << \"-F\";\n-      for (json::Value filePattern : grepOptions.includeFilePatterns())\n+      addDirectoriesToCommand(grepOptions.packageFlag(), dirPath, &cmd);\n+\n+      if (grepOptions.packageFlag() && !grepOptions.includeArgs().empty())\n       {\n-         cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n-         cmd << filePattern.getString();\n+         for (std::string arg : grepOptions.includeArgs())\n+            LOG_DEBUG_MESSAGE(\"Unknown include argument: \" + arg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0982867404b8f22f0fd19fe9cc8aaea7d3005d"}, "originalPosition": 112}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1599f4506b6a863995b08eb870f6e1465c58854b", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/1599f4506b6a863995b08eb870f6e1465c58854b", "committedDate": "2020-01-27T22:53:34Z", "message": "simplify comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 426, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}