{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExOTE5Mzkz", "number": 6787, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjoxNDoyOVrOD4TAkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMjowNDozN1rOD4fzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzU4MjkwOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/display/DefaultChunkOptionsPopupPanel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjoxNDoyOVrOGPDASQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMTo1NTo1N1rOGPWw5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMTA0OQ==", "bodyText": "I think you could re-use chunkLabel here. (I realize this is just coming up in the diff as part of the refactor but worth changing while you're in this code)", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418431049", "createdAt": "2020-05-01T06:14:29Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/display/DefaultChunkOptionsPopupPanel.java", "diffHunk": "@@ -194,9 +162,9 @@ else if (modeId == \"mode/rhtml\")\n       String extracted = match.getGroup(1);\n       chunkPreamble_ = extractChunkPreamble(extracted, modeId);\n       \n-      String chunkLabel = extractChunkLabel(extracted);\n+      String chunkLabel = ChunkContextUi.extractChunkLabel(extracted);\n       if (!StringUtil.isNullOrEmpty(chunkLabel))\n-         tbChunkLabel_.setText(extractChunkLabel(extracted));\n+         tbChunkLabel_.setText(ChunkContextUi.extractChunkLabel(extracted));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NDc5MA==", "bodyText": "You're right, I fixed this.", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418754790", "createdAt": "2020-05-01T21:55:57Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/display/DefaultChunkOptionsPopupPanel.java", "diffHunk": "@@ -194,9 +162,9 @@ else if (modeId == \"mode/rhtml\")\n       String extracted = match.getGroup(1);\n       chunkPreamble_ = extractChunkPreamble(extracted, modeId);\n       \n-      String chunkLabel = extractChunkLabel(extracted);\n+      String chunkLabel = ChunkContextUi.extractChunkLabel(extracted);\n       if (!StringUtil.isNullOrEmpty(chunkLabel))\n-         tbChunkLabel_.setText(extractChunkLabel(extracted));\n+         tbChunkLabel_.setText(ChunkContextUi.extractChunkLabel(extracted));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMTA0OQ=="}, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzU4NDk3OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjoxNjoxM1rOGPDBeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMTo1ODozMlrOGPW0Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMTM1NA==", "bodyText": "nit: as a matter of style, I think it's better to either always include braces on each branch of an if-else, or to never include them. (Otherwise it's easy to miss things in a refactor)", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418431354", "createdAt": "2020-05-01T06:16:13Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "diffHunk": "@@ -944,6 +944,40 @@ public static String getExtension(String string)\n       return getExtension(string, 1);\n    }\n    \n+   public static String getCssIdentifier(String string)\n+   {\n+      // Each character must be one of the following:\n+      // alphanumeric, an ISO 10646 character U+00A0 or higher, a hyphen, or an underscore.\n+      // Identifiers cannot start with a hyphen, two hyphens, or a hyphen followed by a digit.\n+      // This implementation considers escaped characters invalid.\n+      // If an invalid character is found, it is replaced with an 'x'.\n+      \n+\n+      // return the string if it's already valid,\n+      // otherwise replace invalid characters with 'x'\n+      Pattern pattern =\n+         Pattern.create(\"(^[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)|(^-[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)\");\n+      if (pattern.test(string))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NTYzMQ==", "bodyText": "Hm, I tend to disagree with this. I try to write if statements so that the one liners are on top and rely on that to make them stand out.", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418755631", "createdAt": "2020-05-01T21:58:32Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "diffHunk": "@@ -944,6 +944,40 @@ public static String getExtension(String string)\n       return getExtension(string, 1);\n    }\n    \n+   public static String getCssIdentifier(String string)\n+   {\n+      // Each character must be one of the following:\n+      // alphanumeric, an ISO 10646 character U+00A0 or higher, a hyphen, or an underscore.\n+      // Identifiers cannot start with a hyphen, two hyphens, or a hyphen followed by a digit.\n+      // This implementation considers escaped characters invalid.\n+      // If an invalid character is found, it is replaced with an 'x'.\n+      \n+\n+      // return the string if it's already valid,\n+      // otherwise replace invalid characters with 'x'\n+      Pattern pattern =\n+         Pattern.create(\"(^[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)|(^-[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)\");\n+      if (pattern.test(string))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMTM1NA=="}, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzU5MzE0OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/ChunkContextToolbar.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjoyMDo1NlrOGPDFlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMTo1Njo0OFrOGPWyDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMjQwNw==", "bodyText": "nit: GWT element objects should have a setId() method, which does the same thing here but is more succinct", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418432407", "createdAt": "2020-05-01T06:20:56Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/ChunkContextToolbar.java", "diffHunk": "@@ -106,6 +107,12 @@ public void setEngine(String engine)\n       chunkTypeLabel_.setText(engine);\n    }\n    \n+   public void setId(String id)\n+   {\n+      this.getElement().setPropertyString(\"id\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NTA4Ng==", "bodyText": "Ah, good to know. In the latest version this function no longer exists :)", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418755086", "createdAt": "2020-05-01T21:56:48Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/ChunkContextToolbar.java", "diffHunk": "@@ -106,6 +107,12 @@ public void setEngine(String engine)\n       chunkTypeLabel_.setText(engine);\n    }\n    \n+   public void setId(String id)\n+   {\n+      this.getElement().setPropertyString(\"id\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMjQwNw=="}, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDYyMDUyOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNToyMTozM1rOGPMpQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNzozODo0NVrOGPQbrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU4ODk5Mw==", "bodyText": "I think this regex would be more simply expressed with a leading -? (then it won't be necessary to duplicate the whole alphanumeric test)", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418588993", "createdAt": "2020-05-01T15:21:33Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "diffHunk": "@@ -944,6 +944,40 @@ public static String getExtension(String string)\n       return getExtension(string, 1);\n    }\n    \n+   public static String getCssIdentifier(String string)\n+   {\n+      // Each character must be one of the following:\n+      // alphanumeric, an ISO 10646 character U+00A0 or higher, a hyphen, or an underscore.\n+      // Identifiers cannot start with a hyphen, two hyphens, or a hyphen followed by a digit.\n+      // This implementation considers escaped characters invalid.\n+      // If an invalid character is found, it is replaced with an 'x'.\n+      \n+\n+      // return the string if it's already valid,\n+      // otherwise replace invalid characters with 'x'\n+      Pattern pattern =\n+         Pattern.create(\"(^[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)|(^-[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY1MTA1NQ==", "bodyText": "Ah good idea, that's much nicer.", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418651055", "createdAt": "2020-05-01T17:38:45Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "diffHunk": "@@ -944,6 +944,40 @@ public static String getExtension(String string)\n       return getExtension(string, 1);\n    }\n    \n+   public static String getCssIdentifier(String string)\n+   {\n+      // Each character must be one of the following:\n+      // alphanumeric, an ISO 10646 character U+00A0 or higher, a hyphen, or an underscore.\n+      // Identifiers cannot start with a hyphen, two hyphens, or a hyphen followed by a digit.\n+      // This implementation considers escaped characters invalid.\n+      // If an invalid character is found, it is replaced with an 'x'.\n+      \n+\n+      // return the string if it's already valid,\n+      // otherwise replace invalid characters with 'x'\n+      Pattern pattern =\n+         Pattern.create(\"(^[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)|(^-[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU4ODk5Mw=="}, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDYyMzM5OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNToyMjo0MFrOGPMrHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNzo0MDozMFrOGPQfBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU4OTQ2OQ==", "bodyText": "I think we should replace with a - or _ for readability reasons in the calling code; e.g., exercise_six is much easier to read than exercisexsix.", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418589469", "createdAt": "2020-05-01T15:22:40Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "diffHunk": "@@ -944,6 +944,40 @@ public static String getExtension(String string)\n       return getExtension(string, 1);\n    }\n    \n+   public static String getCssIdentifier(String string)\n+   {\n+      // Each character must be one of the following:\n+      // alphanumeric, an ISO 10646 character U+00A0 or higher, a hyphen, or an underscore.\n+      // Identifiers cannot start with a hyphen, two hyphens, or a hyphen followed by a digit.\n+      // This implementation considers escaped characters invalid.\n+      // If an invalid character is found, it is replaced with an 'x'.\n+      \n+\n+      // return the string if it's already valid,\n+      // otherwise replace invalid characters with 'x'\n+      Pattern pattern =\n+         Pattern.create(\"(^[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)|(^-[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)\");\n+      if (pattern.test(string))\n+         return string;\n+      else\n+      {\n+         StringBuilder builder = new StringBuilder();\n+         for (int i = 0; i < string.length(); i++)\n+         {\n+            char c = string.charAt(i);\n+            if (c == '_' ||\n+                c > 0x00A0 ||\n+                (c >= 'a' && c <= 'z') ||\n+                (c >= 'A' && c <= 'Z') ||\n+                (i > 0 && (c == '-' || (c >= '0' && c <= '9'))))\n+               builder.append(c);\n+            else\n+               builder.append(\"x\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY1MTkxMQ==", "bodyText": "Agreed - I didn't use a hyphen because it wouldn't protect against a string starting with -- but an underscore works!", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418651911", "createdAt": "2020-05-01T17:40:30Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "diffHunk": "@@ -944,6 +944,40 @@ public static String getExtension(String string)\n       return getExtension(string, 1);\n    }\n    \n+   public static String getCssIdentifier(String string)\n+   {\n+      // Each character must be one of the following:\n+      // alphanumeric, an ISO 10646 character U+00A0 or higher, a hyphen, or an underscore.\n+      // Identifiers cannot start with a hyphen, two hyphens, or a hyphen followed by a digit.\n+      // This implementation considers escaped characters invalid.\n+      // If an invalid character is found, it is replaced with an 'x'.\n+      \n+\n+      // return the string if it's already valid,\n+      // otherwise replace invalid characters with 'x'\n+      Pattern pattern =\n+         Pattern.create(\"(^[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)|(^-[a-zA-Z][a-zA-Z0-9\\\\-\\\\_]+$)\");\n+      if (pattern.test(string))\n+         return string;\n+      else\n+      {\n+         StringBuilder builder = new StringBuilder();\n+         for (int i = 0; i < string.length(); i++)\n+         {\n+            char c = string.charAt(i);\n+            if (c == '_' ||\n+                c > 0x00A0 ||\n+                (c >= 'a' && c <= 'z') ||\n+                (c >= 'A' && c <= 'Z') ||\n+                (i > 0 && (c == '-' || (c >= '0' && c <= '9'))))\n+               builder.append(c);\n+            else\n+               builder.append(\"x\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU4OTQ2OQ=="}, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDYzMDMyOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ChunkOutputWidget.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNToyNTowMlrOGPMvVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODo1NjoxOFrOGPSlew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5MDU1MA==", "bodyText": "We should use CSS class names rather than IDs, for two reasons:\n\nAn element can only have one ID, but it can have multiple classes. So once we use the element's ID for this addressability feature, we can't use the ID for anything else.\nIt is considered best practice for a document to have only one element with a given ID, but as chunk names can be duplicated we could also wind up with duplicate IDs. It's normal (and expected) for the same CSS class to be assigned to multiple elements.", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418590550", "createdAt": "2020-05-01T15:25:02Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ChunkOutputWidget.java", "diffHunk": "@@ -242,6 +243,12 @@ public int getState()\n       return state_;\n    }\n \n+   public void setId(String id)\n+   {\n+      this.getElement().setPropertyString(\"id\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4NjMzMQ==", "bodyText": "Ok, that makes sense. I've updated this.", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418686331", "createdAt": "2020-05-01T18:56:18Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ChunkOutputWidget.java", "diffHunk": "@@ -242,6 +243,12 @@ public int getState()\n       return state_;\n    }\n \n+   public void setId(String id)\n+   {\n+      this.getElement().setPropertyString(\"id\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5MDU1MA=="}, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDYzMzI1OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNToyNjowM1rOGPMxGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMDozODo0MlrOGPVGng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5MTAwMw==", "bodyText": "This function would be a great candidate for a unit test.", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418591003", "createdAt": "2020-05-01T15:26:03Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "diffHunk": "@@ -944,6 +944,40 @@ public static String getExtension(String string)\n       return getExtension(string, 1);\n    }\n    \n+   public static String getCssIdentifier(String string)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcyNzU4Mg==", "bodyText": "Added \ud83d\udc4d (I even found a tiny bug while adding it).", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418727582", "createdAt": "2020-05-01T20:38:42Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/core/client/StringUtil.java", "diffHunk": "@@ -944,6 +944,40 @@ public static String getExtension(String string)\n       return getExtension(string, 1);\n    }\n    \n+   public static String getCssIdentifier(String string)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5MTAwMw=="}, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDYzNDQwOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/ChunkContextUi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNToyNjoyM1rOGPMxzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMTo1NDowOFrOGPWuug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5MTE4MA==", "bodyText": "Realize you're just moving this, but adding a unit test for this would be helpful!", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418591180", "createdAt": "2020-05-01T15:26:23Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/ChunkContextUi.java", "diffHunk": "@@ -55,6 +55,41 @@ public ChunkContextUi(TextEditingTarget target, int renderPass,\n       createToolbar(preambleRow);\n    }\n    \n+   // Public static methods ---------------------------------------------------\n+\n+   public static String extractChunkLabel(String extractedChunkHeader)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NDIzNA==", "bodyText": "Added.", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418754234", "createdAt": "2020-05-01T21:54:08Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/ChunkContextUi.java", "diffHunk": "@@ -55,6 +55,41 @@ public ChunkContextUi(TextEditingTarget target, int renderPass,\n       createToolbar(preambleRow);\n    }\n    \n+   // Public static methods ---------------------------------------------------\n+\n+   public static String extractChunkLabel(String extractedChunkHeader)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5MTE4MA=="}, "originalCommit": {"oid": "a9e6141045be99413d4c57a442a22f29ac775f09"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNTY2MjY5OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ChunkOutputWidget.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMTo1Njo0MFrOGPWx1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMzoyOToxMFrOGPYMcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NTAyOQ==", "bodyText": "Nit: this needs indent fixed (should be 3 spaces)", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418755029", "createdAt": "2020-05-01T21:56:40Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ChunkOutputWidget.java", "diffHunk": "@@ -242,6 +244,26 @@ public int getState()\n       return state_;\n    }\n \n+   public void setLabelClass(String value)\n+   {\n+      // ensure value has the correct prefix\n+      if (!value.startsWith(ChunkContextToolbar.CHUNK_CLASS_PREFIX + CHUNK_OUTPUT_PREFIX))\n+               value = new String(ChunkContextToolbar.CHUNK_CLASS_PREFIX +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525fa399e8d60ebe91efa3952fc3cb449a4c10c6"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3ODIyNg==", "bodyText": "Fixed", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418778226", "createdAt": "2020-05-01T23:29:10Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ChunkOutputWidget.java", "diffHunk": "@@ -242,6 +244,26 @@ public int getState()\n       return state_;\n    }\n \n+   public void setLabelClass(String value)\n+   {\n+      // ensure value has the correct prefix\n+      if (!value.startsWith(ChunkContextToolbar.CHUNK_CLASS_PREFIX + CHUNK_OUTPUT_PREFIX))\n+               value = new String(ChunkContextToolbar.CHUNK_CLASS_PREFIX +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NTAyOQ=="}, "originalCommit": {"oid": "525fa399e8d60ebe91efa3952fc3cb449a4c10c6"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNTY2NjA4OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ChunkOutputWidget.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMTo1ODoxNlrOGPWz0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMTo1ODoxNlrOGPWz0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NTUzNw==", "bodyText": "Nit: use StringUtil.equal for comparing strings. Believe it or not GWT has made breaking changes in str1 == str2 in the past (in particular when one of them is null, it can throw an exception).", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418755537", "createdAt": "2020-05-01T21:58:16Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ChunkOutputWidget.java", "diffHunk": "@@ -242,6 +244,26 @@ public int getState()\n       return state_;\n    }\n \n+   public void setLabelClass(String value)\n+   {\n+      // ensure value has the correct prefix\n+      if (!value.startsWith(ChunkContextToolbar.CHUNK_CLASS_PREFIX + CHUNK_OUTPUT_PREFIX))\n+               value = new String(ChunkContextToolbar.CHUNK_CLASS_PREFIX +\n+                                  CHUNK_OUTPUT_PREFIX +\n+                                  value);\n+      value = StringUtil.getCssIdentifier(value);\n+\n+      if (value != label_)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525fa399e8d60ebe91efa3952fc3cb449a4c10c6"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNTY3NDcwOnYy", "diffSide": "RIGHT", "path": "src/gwt/test/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/ChunkContextUiTests.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMjowMjozMVrOGPW43A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMzoyOTowMFrOGPYMTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NjgyOA==", "bodyText": "Let's add a couple more here to increase code coverage -- maybe one in which there's no label, and another in which there are no options?\n{r echo=TRUE}\n{r thisisalabel}", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418756828", "createdAt": "2020-05-01T22:02:31Z", "author": {"login": "jmcphers"}, "path": "src/gwt/test/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/ChunkContextUiTests.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * ChunkContextUiTests.java\n+ *\n+ * Copyright (C) 2009-20 by RStudio, PBC\n+ *\n+ * Unless you have received this program directly from RStudio pursuant\n+ * to the terms of a commercial license agreement with RStudio, then\n+ * this program is licensed to you under the terms of version 3 of the\n+ * GNU Affero General Public License. This program is distributed WITHOUT\n+ * ANY EXPRESS OR IMPLIED WARRANTY, INCLUDING THOSE OF NON-INFRINGEMENT,\n+ * MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Please refer to the\n+ * AGPL (http://www.gnu.org/licenses/agpl-3.0.txt) for more details.\n+ *\n+ */\n+package org.rstudio.studio.client.workbench.views.source.editors.text.rmd;\n+\n+import com.google.gwt.junit.client.GWTTestCase;\n+\n+\n+public class ChunkContextUiTests extends GWTTestCase\n+{\n+   @Override\n+   public String getModuleName()\n+   {\n+      return \"org.rstudio.studio.RStudioTests\";\n+   }\n+   \n+   public void testExtractChunkLabel()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525fa399e8d60ebe91efa3952fc3cb449a4c10c6"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3ODE4OA==", "bodyText": "Updated", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418778188", "createdAt": "2020-05-01T23:29:00Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/test/org/rstudio/studio/client/workbench/views/source/editors/text/rmd/ChunkContextUiTests.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * ChunkContextUiTests.java\n+ *\n+ * Copyright (C) 2009-20 by RStudio, PBC\n+ *\n+ * Unless you have received this program directly from RStudio pursuant\n+ * to the terms of a commercial license agreement with RStudio, then\n+ * this program is licensed to you under the terms of version 3 of the\n+ * GNU Affero General Public License. This program is distributed WITHOUT\n+ * ANY EXPRESS OR IMPLIED WARRANTY, INCLUDING THOSE OF NON-INFRINGEMENT,\n+ * MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Please refer to the\n+ * AGPL (http://www.gnu.org/licenses/agpl-3.0.txt) for more details.\n+ *\n+ */\n+package org.rstudio.studio.client.workbench.views.source.editors.text.rmd;\n+\n+import com.google.gwt.junit.client.GWTTestCase;\n+\n+\n+public class ChunkContextUiTests extends GWTTestCase\n+{\n+   @Override\n+   public String getModuleName()\n+   {\n+      return \"org.rstudio.studio.RStudioTests\";\n+   }\n+   \n+   public void testExtractChunkLabel()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NjgyOA=="}, "originalCommit": {"oid": "525fa399e8d60ebe91efa3952fc3cb449a4c10c6"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNTY3ODY1OnYy", "diffSide": "RIGHT", "path": "src/gwt/test/org/rstudio/core/client/StringUtilTests.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMjowNDozN1rOGPW7Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMzoyODo1MlrOGPYMKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NzQ3NA==", "bodyText": "Nit: I think this might be frustrating to update since you have to remember to increase the pass count here whenever you add a pass below. How about just putting the input/expected values in arrays, and looping over the arrays?", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418757474", "createdAt": "2020-05-01T22:04:37Z", "author": {"login": "jmcphers"}, "path": "src/gwt/test/org/rstudio/core/client/StringUtilTests.java", "diffHunk": "@@ -238,6 +238,40 @@ public void testConciseElapsedTime()\n       assertEquals(\"2:02:01:01\", days);\n    }\n   \n+   public void testGetCssIdentifier()\n+   {\n+      for (int pass = 0; pass < 5; pass++)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "525fa399e8d60ebe91efa3952fc3cb449a4c10c6"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3ODE1Mw==", "bodyText": "Updated!", "url": "https://github.com/rstudio/rstudio/pull/6787#discussion_r418778153", "createdAt": "2020-05-01T23:28:52Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/test/org/rstudio/core/client/StringUtilTests.java", "diffHunk": "@@ -238,6 +238,40 @@ public void testConciseElapsedTime()\n       assertEquals(\"2:02:01:01\", days);\n    }\n   \n+   public void testGetCssIdentifier()\n+   {\n+      for (int pass = 0; pass < 5; pass++)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NzQ3NA=="}, "originalCommit": {"oid": "525fa399e8d60ebe91efa3952fc3cb449a4c10c6"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3939, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}