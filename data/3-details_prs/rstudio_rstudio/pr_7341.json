{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NTY3NTg3", "number": 7341, "title": "Pop out navigated URL if known", "bodyText": "This is a drive-by fix for #6967. The bug is effectively that navigating in the Viewer pane causes the pop-out button to not work (it pops out the URL that initially loaded in the pane, not the one you're looking at).\nThe reason we don't pop out the current URL is that the current URL has a bunch of goo on it that we don't want to include in the popped out URL (&viewer_pane=1, etc. etc). There are also circumstances where we can't read the current URL.\nSo the fix is a little more subtle than just using the current URL. We now attempt to figure out whether you've navigated based on whether or not the current URL has changed from the original one. If it has, we show you the new URL instead of the one you were originally looking at.\nFixes #6967.", "createdAt": "2020-07-14T00:02:59Z", "url": "https://github.com/rstudio/rstudio/pull/7341", "merged": true, "mergeCommit": {"oid": "e9780aea067bf0d2c9170c8f144dee49b8eaf30e"}, "closed": true, "closedAt": "2020-07-14T19:56:01Z", "author": {"login": "jmcphers"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0qfUfAH2gAyNDQ4NTY3NTg3OjQ2OTVlYTc4YWI1ZDBhMGJkYTQ3OGM1Y2Y3M2ExYzQ2YzVjNDM0Y2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc07baUgFqTQ0ODQxMTQ5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4695ea78ab5d0a0bda478c5cf73a1c46c5c434cd", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/4695ea78ab5d0a0bda478c5cf73a1c46c5c434cd", "committedDate": "2020-07-14T00:00:22Z", "message": "pop out navigated URL if known"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4Mjk2Mzky", "url": "https://github.com/rstudio/rstudio/pull/7341#pullrequestreview-448296392", "createdAt": "2020-07-14T17:02:07Z", "commit": {"oid": "4695ea78ab5d0a0bda478c5cf73a1c46c5c434cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzowMjowN1rOGxc3PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzowMjowN1rOGxc3PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUwNjMwMQ==", "bodyText": "Wouldn't this imply an attempt to open a null URL if we couldn't get the IFrame URL (e.g. because of DOM restrictions)?", "url": "https://github.com/rstudio/rstudio/pull/7341#discussion_r454506301", "createdAt": "2020-07-14T17:02:07Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/viewer/ViewerPane.java", "diffHunk": "@@ -232,6 +232,15 @@ public void popout()\n       {\n          globalDisplay_.showHtmlFile(rmdPreviewParams_.getOutputFile());\n       }\n+      else if (frame_ != null &&\n+          !StringUtil.equals(frame_.getIFrame().getCurrentUrl(), getUrl()))\n+      {\n+         // Typically we navigate to the unmodified URL (i.e. without the\n+         // viewer_pane=1 query params, etc.) However, if the URL currently\n+         // loaded in the frame is different, the user probably navigated away\n+         // from original URL, so load that URL as-is.\n+         globalDisplay_.openWindow(frame_.getIFrame().getCurrentUrl());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4695ea78ab5d0a0bda478c5cf73a1c46c5c434cd"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc20fdf48237a9abfbaf50d0dc40d3b2ecfa7abf", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/cc20fdf48237a9abfbaf50d0dc40d3b2ecfa7abf", "committedDate": "2020-07-14T19:26:42Z", "message": "add null check for current URL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f185f0d59c0902c2a95fc02d0ccef778d903933", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/1f185f0d59c0902c2a95fc02d0ccef778d903933", "committedDate": "2020-07-14T19:28:27Z", "message": "update NEWS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NDExNDkz", "url": "https://github.com/rstudio/rstudio/pull/7341#pullrequestreview-448411493", "createdAt": "2020-07-14T19:44:29Z", "commit": {"oid": "1f185f0d59c0902c2a95fc02d0ccef778d903933"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 114, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}