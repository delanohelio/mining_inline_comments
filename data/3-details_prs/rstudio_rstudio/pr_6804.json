{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMDc0MjQ4", "number": 6804, "title": "Fix HTML widget viewing on R 4.0 for Windows", "bodyText": "In RStudio Desktop, we currently use R's HTTP server to serve files from the session temp folder, including HTML widgets. There appears to be a bug in this server in R 4.0 for Windows, which causes the widgets not to display and burns a bunch of CPU until R is restarted. See #6737 for the gory details.\nThis change is a minimal fix for the issue which is intended to work around this specific problem; it is intended for the RStudio 1.3 release. Consequently it only touches this specific combination (R 4.0, Windows). Since we already have a mechanism for serving these files in RStudio Server, we just use it in desktop mode when necessary.\nWe might consider a follow-up to change (for RStudio 1.4) which simplifies all this code by using our internal server all the time; I don't see any immediate advantage to proxying these requests to R but I could be missing something.\nI also couldn't resist cleaning up some old tests for R < 3.0 which we no longer support.\nFixes #6737.", "createdAt": "2020-05-04T17:09:52Z", "url": "https://github.com/rstudio/rstudio/pull/6804", "merged": true, "mergeCommit": {"oid": "e33101baa674a4674b05ecf2de310b0892370908"}, "closed": true, "closedAt": "2020-05-04T17:58:19Z", "author": {"login": "jmcphers"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceC4RWgFqTQwNTE5MTM4MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABceDV-uABqjMzMDEwMzc0OTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MTkxMzgx", "url": "https://github.com/rstudio/rstudio/pull/6804#pullrequestreview-405191381", "createdAt": "2020-05-04T17:23:00Z", "commit": {"oid": "de58aed1ee2d764330636d87f3064c5481f3fa6a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNzoyMzowMFrOGQKTKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNzoyMzowMFrOGQKTKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU5OTE0Ng==", "bodyText": "nit: would it be worth making this a static and initialize it from a helper function? (since the value won't ever change in a given session)", "url": "https://github.com/rstudio/rstudio/pull/6804#discussion_r419599146", "createdAt": "2020-05-04T17:23:00Z", "author": {"login": "kevinushey"}, "path": "src/cpp/session/SessionModuleContext.cpp", "diffHunk": "@@ -2390,7 +2390,24 @@ bool isSessionTempPath(FilePath filePath)\n \n std::string sessionTempDirUrl(const std::string& sessionTempPath)\n {\n-   if (session::options().programMode() == kSessionProgramModeDesktop)\n+   // In desktop mode we can have R itself handle requests for content in\n+   // the session temporary folder.\n+   bool useRHelpServer = session::options().programMode() == kSessionProgramModeDesktop;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de58aed1ee2d764330636d87f3064c5481f3fa6a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bd458049260650ed0f2c82ca8bdf8a6a5a0a70e", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/8bd458049260650ed0f2c82ca8bdf8a6a5a0a70e", "committedDate": "2020-05-04T17:57:17Z", "message": "use internal file server for session temp files on Windows"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de58aed1ee2d764330636d87f3064c5481f3fa6a", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/de58aed1ee2d764330636d87f3064c5481f3fa6a", "committedDate": "2020-05-04T17:02:08Z", "message": "use internal file server for session temp files on Windows"}, "afterCommit": {"oid": "8bd458049260650ed0f2c82ca8bdf8a6a5a0a70e", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/8bd458049260650ed0f2c82ca8bdf8a6a5a0a70e", "committedDate": "2020-05-04T17:57:17Z", "message": "use internal file server for session temp files on Windows"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 243, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}