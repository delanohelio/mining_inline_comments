{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0NjE4MTI0", "number": 7401, "title": "Properly resize buffer during group enumeration", "bodyText": "Fix bug where user group enumeration was not properly checking return code of getgrouplist to resize the buffer when needed.\nFixes rstudio/rstudio-pro#1796", "createdAt": "2020-07-21T16:32:20Z", "url": "https://github.com/rstudio/rstudio/pull/7401", "merged": true, "mergeCommit": {"oid": "a30b0d477f55da2a27ecf636bf7889aca2b21cc3"}, "closed": true, "closedAt": "2020-07-21T21:35:08Z", "author": {"login": "kfeinauer"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3I2DiAH2gAyNDU0NjE4MTI0OjQwYmYwMDEzZmJhMjRhYWVjZTA3NGVkNTJjYmVkOGYyNTY3Yzk1NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3NMufgH2gAyNDU0NjE4MTI0OmRlYjc2NDFiYWM1NWEyODE1MzkwODZkM2Q2M2JkYzBjNmU1NGJhNDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "40bf0013fba24aaece074ed52cbed8f2567c9549", "author": {"user": {"login": "kfeinauer", "name": "Karl Feinauer"}}, "url": "https://github.com/rstudio/rstudio/commit/40bf0013fba24aaece074ed52cbed8f2567c9549", "committedDate": "2020-07-21T16:30:12Z", "message": "Fix bug where user group enumeration was not properly checking return code of getgrouplist to resize the buffer when needed. Fixes https://github.com/rstudio/rstudio-pro/issues/1796"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjczNTIw", "url": "https://github.com/rstudio/rstudio/pull/7401#pullrequestreview-452673520", "createdAt": "2020-07-21T17:22:52Z", "commit": {"oid": "40bf0013fba24aaece074ed52cbed8f2567c9549"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzoyMjo1MlrOG1COVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzoyMjo1MlrOG1COVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI2NDE1MQ==", "bodyText": "FWIW I think we can remove the while loop here and just have two explicit calls to getgrouplist(). If I'm reading the documentation correctly, if the function returns -1, then the real required number of groups will be written to &numGroups and we can just make one more call with that value. (It also gives us a chance to sanity-check the second call to getgrouplist(), which should in theory never fail)", "url": "https://github.com/rstudio/rstudio/pull/7401#discussion_r458264151", "createdAt": "2020-07-21T17:22:52Z", "author": {"login": "kevinushey"}, "path": "src/cpp/core/system/PosixGroup.cpp", "diffHunk": "@@ -121,13 +117,12 @@ Error userGroups(const std::string& userName, std::vector<Group>* pGroups)\n    typedef int GIDTYPE;\n #endif\n \n-   boost::shared_ptr<GIDTYPE> pGids(new GIDTYPE[100]);\n-   while (!getgrouplist(userName.c_str(), user.getGroupId(), pGids.get(), &numGroups))\n+   // get the groups for the user - we start with 100 groups which should be enough for most cases\n+   // if it is not, resize the buffer with the correct amount of groups and try again\n+   int numGroups = 100;\n+   boost::shared_ptr<GIDTYPE> pGids(new GIDTYPE[numGroups]);\n+   while (getgrouplist(userName.c_str(), user.getGroupId(), pGids.get(), &numGroups) == -1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bf0013fba24aaece074ed52cbed8f2567c9549"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNzY4ODgz", "url": "https://github.com/rstudio/rstudio/pull/7401#pullrequestreview-452768883", "createdAt": "2020-07-21T19:35:10Z", "commit": {"oid": "40bf0013fba24aaece074ed52cbed8f2567c9549"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNzk5NzUx", "url": "https://github.com/rstudio/rstudio/pull/7401#pullrequestreview-452799751", "createdAt": "2020-07-21T20:21:49Z", "commit": {"oid": "40bf0013fba24aaece074ed52cbed8f2567c9549"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODAwNjQ2", "url": "https://github.com/rstudio/rstudio/pull/7401#pullrequestreview-452800646", "createdAt": "2020-07-21T20:23:12Z", "commit": {"oid": "40bf0013fba24aaece074ed52cbed8f2567c9549"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a412d42e3823342291430e20bbacfd7c6b51569", "author": {"user": {"login": "kfeinauer", "name": "Karl Feinauer"}}, "url": "https://github.com/rstudio/rstudio/commit/1a412d42e3823342291430e20bbacfd7c6b51569", "committedDate": "2020-07-21T21:33:47Z", "message": "Update NEWS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deb7641bac55a281539086d3d63bdc0c6e54ba42", "author": {"user": {"login": "kfeinauer", "name": "Karl Feinauer"}}, "url": "https://github.com/rstudio/rstudio/commit/deb7641bac55a281539086d3d63bdc0c6e54ba42", "committedDate": "2020-07-21T21:34:35Z", "message": "Merge branch 'v1.3' into bugfix/user-groups-resize"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 129, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}