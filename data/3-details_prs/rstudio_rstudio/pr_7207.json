{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4ODAwMjU4", "number": 7207, "title": "ensure sequential setup for parallel clusters", "bodyText": "Band-aid for #6692.", "createdAt": "2020-06-23T20:25:08Z", "url": "https://github.com/rstudio/rstudio/pull/7207", "merged": true, "mergeCommit": {"oid": "2ddc0ade774a459620e699686bc1fed3612c4bf3"}, "closed": true, "closedAt": "2020-06-23T21:03:42Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuLaGqAH2gAyNDM4ODAwMjU4OjM1M2U2OGFiZjNjZTkwYjM4NDRhNWI5NzdkYjE5MTdmMDExYWY0ZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuL9LxgFqTQzNjE1NTQzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "353e68abf3ce90b3844a5b977db1917f011af4e0", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/353e68abf3ce90b3844a5b977db1917f011af4e0", "committedDate": "2020-06-23T20:24:04Z", "message": "prefer sequential setup strategy with parallel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTQyNzk4", "url": "https://github.com/rstudio/rstudio/pull/7207#pullrequestreview-436142798", "createdAt": "2020-06-23T20:47:22Z", "commit": {"oid": "353e68abf3ce90b3844a5b977db1917f011af4e0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDo0NzoyMlrOGn58ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDo0NzoyMlrOGn58ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5Njk5Nw==", "bodyText": "Should we only do this if R >= 4.0?", "url": "https://github.com/rstudio/rstudio/pull/7207#discussion_r444496997", "createdAt": "2020-06-23T20:47:22Z", "author": {"login": "jmcphers"}, "path": "src/cpp/session/modules/SessionPatches.R", "diffHunk": "@@ -13,24 +13,42 @@\n #\n #\n \n-setHook(\n-   packageEvent(\"rstudioapi\", \"onLoad\"),\n-   function(...) {\n+# NOTE: registered hooks will be run immediately if the\n+# package has already been loaded.\n+.rs.addFunction(\"registerPackageLoadHook\", function(package, hook)\n+{\n+   # if the package is already loaded, run the hook;\n+   # otherwise, register a load hook\n+   if (package %in% loadedNamespaces())\n+      hook()\n+   else\n+      setHook(packageEvent(package, \"onLoad\"), hook)\n+})\n \n-      # bail if we're not version 0.7\n-      if (packageVersion(\"rstudioapi\") != \"0.7\")\n-         return()\n+.rs.registerPackageLoadHook(\"rstudioapi\", function(...)\n+{\n+   # bail if we're not version 0.7\n+   if (packageVersion(\"rstudioapi\") != \"0.7\")\n+      return()\n+   \n+   # re-assign the 'selectDirectory()' function\n+   rstudioapi <- asNamespace(\"rstudioapi\")\n+   override <- function(caption = \"Select Directory\",\n+                        label = \"Select\",\n+                        path = rstudioapi::getActiveProject())\n+   {\n+      callFun(\"selectDirectory\", caption, label, path)\n+   }\n+   environment(override) <- rstudioapi\n+   \n+   .rs.replaceBinding(\"selectDirectory\", \"rstudioapi\", override)\n+})\n \n-      # re-assign the 'selectDirectory()' function\n-      rstudioapi <- asNamespace(\"rstudioapi\")\n-      override <- function(caption = \"Select Directory\",\n-                           label = \"Select\",\n-                           path = rstudioapi::getActiveProject())\n-      {\n-         callFun(\"selectDirectory\", caption, label, path)\n-      }\n-      environment(override) <- rstudioapi\n+.rs.registerPackageLoadHook(\"parallel\", function(...)\n+{\n+   # enforce sequential setup of cluster on macOS\n+   # https://github.com/rstudio/rstudio/issues/6692\n+   if (Sys.info()[[\"sysname\"]] == \"Darwin\")\n+      parallel:::setDefaultClusterOptions(setup_strategy = \"sequential\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "353e68abf3ce90b3844a5b977db1917f011af4e0"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTU1NDM2", "url": "https://github.com/rstudio/rstudio/pull/7207#pullrequestreview-436155436", "createdAt": "2020-06-23T21:02:24Z", "commit": {"oid": "353e68abf3ce90b3844a5b977db1917f011af4e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 83, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}