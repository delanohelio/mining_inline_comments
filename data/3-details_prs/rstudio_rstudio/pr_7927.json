{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NzE3ODY1", "number": 7927, "title": "allow 'getSourceEditorContext()', 'replaceRange()' to work within visual mode chunks", "bodyText": "Intent\nCurrently, rstudioapi::getSourceEditorContext() and rstudioapi::replaceRanges() (and so, addins that depend on these functions) require the editor to be switched to text mode. However, such addins would fail to function, as we currently cannot map the cursor between text + visual mode.\nApproach\nThis PR basically allows these APIs to treat the embedded Ace instances as a whole \"source\" document. This allows addins that use these APIs to operate on the current selection (for example, styler) to function as they would in a regular text editor.\nQA Notes\nTest by using the styler package to reformat R code both within source-mode R Markdown chunks, and also visual-mode R Markdown chunks.", "createdAt": "2020-09-30T18:58:05Z", "url": "https://github.com/rstudio/rstudio/pull/7927", "merged": true, "mergeCommit": {"oid": "51cc201d7e278baa6fb3120c3a98038d8b1dffd5"}, "closed": true, "closedAt": "2020-09-30T20:29:09Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOBeSrAH2gAyNDk1NzE3ODY1OmExOWY5ZGQ0OTcwNzg1OTBjZjEyOWIxMDkxOTYyZmY1NTE3ODhlZmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOCyv8gH2gAyNDk1NzE3ODY1Ojg3NWVmZWRiNGRiYzVlOTM1OTM4MGIyYmI4Y2Q5ZDNjMTZiYTFkZjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a19f9dd497078590cf129b1091962ff551788efc", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/a19f9dd497078590cf129b1091962ff551788efc", "committedDate": "2020-09-30T18:55:10Z", "message": "allow 'getSourceEditorContext()', 'replaceRange()' to work within visual mode chunks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzQ4MTAw", "url": "https://github.com/rstudio/rstudio/pull/7927#pullrequestreview-499748100", "createdAt": "2020-09-30T19:32:25Z", "commit": {"oid": "a19f9dd497078590cf129b1091962ff551788efc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOTozMjoyNlrOHasVRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOTo0MjoyMlrOHasqLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1MTM2NQ==", "bodyText": "Nit: copy paste error?", "url": "https://github.com/rstudio/rstudio/pull/7927#discussion_r497751365", "createdAt": "2020-09-30T19:32:26Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java", "diffHunk": "@@ -76,6 +76,22 @@ public PanmirrorUIChunks uiChunks()\n       return chunks;\n    }\n    \n+   /**\n+    * Finds the current visual mode chunk editor.\n+    * \n+    * @return A visual mode chunk editor at the given row, or null if one was", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a19f9dd497078590cf129b1091962ff551788efc"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1NjcxNw==", "bodyText": "An embedded editor is only considered active if it currently has keyboard focus (i.e. it becomes inactive on blur). Is this what you want here? (if you're looking for the last focused instance, these are real AceEditors so that class's static last focused instance method will work)", "url": "https://github.com/rstudio/rstudio/pull/7927#discussion_r497756717", "createdAt": "2020-09-30T19:42:22Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java", "diffHunk": "@@ -76,6 +76,22 @@ public PanmirrorUIChunks uiChunks()\n       return chunks;\n    }\n    \n+   /**\n+    * Finds the current visual mode chunk editor.\n+    * \n+    * @return A visual mode chunk editor at the given row, or null if one was\n+    *   not found.\n+    */\n+   public VisualModeChunk getCurrentChunk()\n+   {\n+      for (VisualModeChunk chunk : chunks_)\n+         if (chunk.isActive())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a19f9dd497078590cf129b1091962ff551788efc"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "663868983320da4739d4adfc22c7f7f66d259c68", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/663868983320da4739d4adfc22c7f7f66d259c68", "committedDate": "2020-09-30T20:21:53Z", "message": "clear last-active editor when panmirror focused"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c656833deda44eb73b712f126b2bc3a234c28c69", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/c656833deda44eb73b712f126b2bc3a234c28c69", "committedDate": "2020-09-30T20:25:23Z", "message": "clean up warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "875efedb4dbc5e9359380b2bb8cd9d3c16ba1df1", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/875efedb4dbc5e9359380b2bb8cd9d3c16ba1df1", "committedDate": "2020-09-30T20:27:25Z", "message": "null checks"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}