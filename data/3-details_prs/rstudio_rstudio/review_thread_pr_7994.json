{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MzcxOTk1", "number": 7994, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTowMzoxOVrOErW0bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjoxODozN1rOErsJjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODk4MDkyOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTowMzoxOVrOHeFcdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTo1OTo0MVrOHeHAqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMwODUzMw==", "bodyText": "On Mac (maybe others, didn't check) conflicts with toggleDocumentOutline shortcut.", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501308533", "createdAt": "2020-10-07T21:03:19Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "diffHunk": "@@ -777,6 +778,10 @@ well as menu structures (for main menu and popup menus).\n          <shortcut refid=\"openSourceDoc\" value=\"Ctrl+O\" disableModes=\"emacs\"/>\n          <shortcut refid=\"openSourceDoc\" value=\"Meta+O\" if=\"org.rstudio.core.client.BrowseCap.isMacintosh()\"/>\n \n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Ctrl+X Ctrl+C\" disableModes=\"default,vim,sublime\"/>\n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Ctrl+Shift+O\" disableModes=\"emacs\"/>\n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Meta+Shift+O\" if=\"org.rstudio.core.client.BrowseCap.isMacintosh()\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9da39447e9fede110542bf7d838e66d181d67415"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMzNDE4NA==", "bodyText": "Thanks! I've changed it.", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501334184", "createdAt": "2020-10-07T21:59:41Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "diffHunk": "@@ -777,6 +778,10 @@ well as menu structures (for main menu and popup menus).\n          <shortcut refid=\"openSourceDoc\" value=\"Ctrl+O\" disableModes=\"emacs\"/>\n          <shortcut refid=\"openSourceDoc\" value=\"Meta+O\" if=\"org.rstudio.core.client.BrowseCap.isMacintosh()\"/>\n \n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Ctrl+X Ctrl+C\" disableModes=\"default,vim,sublime\"/>\n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Ctrl+Shift+O\" disableModes=\"emacs\"/>\n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Meta+Shift+O\" if=\"org.rstudio.core.client.BrowseCap.isMacintosh()\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMwODUzMw=="}, "originalCommit": {"oid": "9da39447e9fede110542bf7d838e66d181d67415"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzOTQxOTc4OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMzo1NDo1NFrOHeJe3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNToyODoxOFrOHekM-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3NDY4NQ==", "bodyText": "This command needs to be disabled, and probably hidden, when the allowSourceColumns preference prevents it from working. I'd suggest handling that in the source column manager (i.e. bind a preference listener that sets the command to be enabled/visible based on the value of the pref).", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501374685", "createdAt": "2020-10-07T23:54:54Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -674,18 +675,51 @@ public void onFocusPreviousPane()\n    }\n \n    @Handler\n-    public void onNewSourceColumn()\n-    {\n-       if (!userPrefs_.allowSourceColumns().getValue())\n-          pGlobalDisplay_.get().showMessage(GlobalDisplay.MSG_INFO, \"Cannot Add Column\",\n-             \"Allow Source Columns preference is disabled.\");\n-       else if (additionalSourceCount_ >= MAX_COLUMN_COUNT)\n-          pGlobalDisplay_.get().showMessage(GlobalDisplay.MSG_INFO, \"Cannot Add Column\",\n-             \"You can't add more than \" + MAX_COLUMN_COUNT + \" columns.\");\n-       else\n-          createSourceColumn();\n-    }\n+   public void onNewSourceColumn()\n+   {\n+      if (validateNewColumnRequest())\n+         createAndDisplaySourceColumn();\n+   }\n+   \n+   @Handler\n+   public void onOpenSourceDocNewColumn()\n+   {\n+      if (validateNewColumnRequest())\n+      {\n+         ColumnName name = createSourceColumn();\n+         SourceColumn column = sourceColumnManager_.getByName(name.getName());\n+         column.incrementNewTabPending();\n+         panel_.addLeftWidget(\n+            createSourceColumnWindow(name.getName(),\n+               name.getAccessibleName()));\n+         sourceColumnManager_.setActive(column);\n+         Command onCancelled = () ->\n+         {\n+            column.decrementNewTabPending();\n+            closeSourceWindow(name.getName());\n+         };\n+         Command onCompleted = () -> column.decrementNewTabPending();\n+         source_.openSourceDoc(onCancelled, onCompleted);\n+      }\n+   }\n \n+   private boolean validateNewColumnRequest()\n+   {\n+      if (!userPrefs_.allowSourceColumns().getValue())\n+      {\n+         pGlobalDisplay_.get().showMessage(GlobalDisplay.MSG_INFO, \"Cannot Add Column\",\n+            \"Allow Source Columns preference is disabled.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc805bee952488dac9dfd5573086e7780f094295"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxMjQ3NQ==", "bodyText": "Good point, I've added a listener to SourceColumnManager to handle this as well as updated PaneManager to hide the commands when the max column count is reached.", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501812475", "createdAt": "2020-10-08T15:28:18Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -674,18 +675,51 @@ public void onFocusPreviousPane()\n    }\n \n    @Handler\n-    public void onNewSourceColumn()\n-    {\n-       if (!userPrefs_.allowSourceColumns().getValue())\n-          pGlobalDisplay_.get().showMessage(GlobalDisplay.MSG_INFO, \"Cannot Add Column\",\n-             \"Allow Source Columns preference is disabled.\");\n-       else if (additionalSourceCount_ >= MAX_COLUMN_COUNT)\n-          pGlobalDisplay_.get().showMessage(GlobalDisplay.MSG_INFO, \"Cannot Add Column\",\n-             \"You can't add more than \" + MAX_COLUMN_COUNT + \" columns.\");\n-       else\n-          createSourceColumn();\n-    }\n+   public void onNewSourceColumn()\n+   {\n+      if (validateNewColumnRequest())\n+         createAndDisplaySourceColumn();\n+   }\n+   \n+   @Handler\n+   public void onOpenSourceDocNewColumn()\n+   {\n+      if (validateNewColumnRequest())\n+      {\n+         ColumnName name = createSourceColumn();\n+         SourceColumn column = sourceColumnManager_.getByName(name.getName());\n+         column.incrementNewTabPending();\n+         panel_.addLeftWidget(\n+            createSourceColumnWindow(name.getName(),\n+               name.getAccessibleName()));\n+         sourceColumnManager_.setActive(column);\n+         Command onCancelled = () ->\n+         {\n+            column.decrementNewTabPending();\n+            closeSourceWindow(name.getName());\n+         };\n+         Command onCompleted = () -> column.decrementNewTabPending();\n+         source_.openSourceDoc(onCancelled, onCompleted);\n+      }\n+   }\n \n+   private boolean validateNewColumnRequest()\n+   {\n+      if (!userPrefs_.allowSourceColumns().getValue())\n+      {\n+         pGlobalDisplay_.get().showMessage(GlobalDisplay.MSG_INFO, \"Cannot Add Column\",\n+            \"Allow Source Columns preference is disabled.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3NDY4NQ=="}, "originalCommit": {"oid": "dc805bee952488dac9dfd5573086e7780f094295"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzOTQyNTc4OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMzo1ODowMVrOHeJiVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMzo0MDowM1rOHefGCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3NTU3NA==", "bodyText": "If this is meant to be an Emacs-like keybinding for the command, maybe we should use the closest emacs keybinding? I think C-x C-c means something else in Emacs, and we should use something like C-x 5 f for this command (but we should check with @kevinushey).", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501375574", "createdAt": "2020-10-07T23:58:01Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "diffHunk": "@@ -777,6 +778,10 @@ well as menu structures (for main menu and popup menus).\n          <shortcut refid=\"openSourceDoc\" value=\"Ctrl+O\" disableModes=\"emacs\"/>\n          <shortcut refid=\"openSourceDoc\" value=\"Meta+O\" if=\"org.rstudio.core.client.BrowseCap.isMacintosh()\"/>\n \n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Ctrl+X Ctrl+C\" disableModes=\"default,vim,sublime\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc805bee952488dac9dfd5573086e7780f094295"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTcyODc3OQ==", "bodyText": "it looks like C-x 5 f is taken in emacs as well. @kevinushey  do you have a recommendation?", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501728779", "createdAt": "2020-10-08T13:40:03Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "diffHunk": "@@ -777,6 +778,10 @@ well as menu structures (for main menu and popup menus).\n          <shortcut refid=\"openSourceDoc\" value=\"Ctrl+O\" disableModes=\"emacs\"/>\n          <shortcut refid=\"openSourceDoc\" value=\"Meta+O\" if=\"org.rstudio.core.client.BrowseCap.isMacintosh()\"/>\n \n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Ctrl+X Ctrl+C\" disableModes=\"default,vim,sublime\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3NTU3NA=="}, "originalCommit": {"oid": "dc805bee952488dac9dfd5573086e7780f094295"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjQ2OTU0OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjoxNzowM1rOHemRiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjozODozOFrOHenHIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NjQwOQ==", "bodyText": "Here and below: it makes sense to disable the first two commands if we're already maxed out for columns (since they create columns), but it seems to me like the third shouldn't be affected. What do you think?", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501846409", "createdAt": "2020-10-08T16:17:03Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -382,6 +382,14 @@ else if (numDocs > 0 && window.getState() == WindowState.HIDE)\n          hiddenTabs_ = tabNamesToTabs(evt.getValue().getHiddenTabSet());\n          populateTabPanel(hiddenTabs_, hiddenTabSetTabPanel_, hiddenTabSetMinPanel_);\n \n+         // manage source column commands\n+         boolean visible = userPrefs.allowSourceColumns().getValue() &&\n+            (userPrefs.panes().getValue().getAdditionalSourceColumns() < MAX_COLUMN_COUNT);\n+         \n+         commands_.newSourceColumn().setVisible(visible);\n+         commands_.openSourceDocNewColumn().setVisible(visible);\n+         commands_.focusSourceColumnSeparator().setVisible(visible);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e29ad4f3d7d2288b26436236916793dabf021af5"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg2MDEzMQ==", "bodyText": "You're right, fixed it.", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501860131", "createdAt": "2020-10-08T16:38:38Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -382,6 +382,14 @@ else if (numDocs > 0 && window.getState() == WindowState.HIDE)\n          hiddenTabs_ = tabNamesToTabs(evt.getValue().getHiddenTabSet());\n          populateTabPanel(hiddenTabs_, hiddenTabSetTabPanel_, hiddenTabSetMinPanel_);\n \n+         // manage source column commands\n+         boolean visible = userPrefs.allowSourceColumns().getValue() &&\n+            (userPrefs.panes().getValue().getAdditionalSourceColumns() < MAX_COLUMN_COUNT);\n+         \n+         commands_.newSourceColumn().setVisible(visible);\n+         commands_.openSourceDocNewColumn().setVisible(visible);\n+         commands_.focusSourceColumnSeparator().setVisible(visible);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NjQwOQ=="}, "originalCommit": {"oid": "e29ad4f3d7d2288b26436236916793dabf021af5"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjQ3NTY1OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumnManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjoxODozN1rOHemVUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjozMjoyMVrOHem3uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzM3Ng==", "bodyText": "It's not totally clear to me why we need this code in both places ... doesn't this handler run at startup? (if not, maybe make a function that's called both at startup and in the value change handler?)", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501847376", "createdAt": "2020-10-08T16:18:37Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumnManager.java", "diffHunk": "@@ -242,6 +243,23 @@ public void onSwitchToDoc(SwitchToDocEvent event)\n          }\n       });\n \n+      userPrefs.allowSourceColumns().addValueChangeHandler(event ->\n+      {\n+         // PaneManager helps manage these commands so when modifying this code, update ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e29ad4f3d7d2288b26436236916793dabf021af5"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg1NjE4NA==", "bodyText": "PaneManager just needs to help with commands that need to be adjusted based on the max column count. It tracks this because it's actually responsible for adding and removing the windows that contain the columns. I'll update the comment to be more specific. I was grouping all the commands into that category when I shouldn't have been.", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501856184", "createdAt": "2020-10-08T16:32:21Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumnManager.java", "diffHunk": "@@ -242,6 +243,23 @@ public void onSwitchToDoc(SwitchToDocEvent event)\n          }\n       });\n \n+      userPrefs.allowSourceColumns().addValueChangeHandler(event ->\n+      {\n+         // PaneManager helps manage these commands so when modifying this code, update ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzM3Ng=="}, "originalCommit": {"oid": "e29ad4f3d7d2288b26436236916793dabf021af5"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4236, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}