{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MDY3ODQy", "number": 7831, "title": "add 'documentPath' API", "bodyText": "Intent\nPreviously, the only way for users to determine the path associated with a document open in the IDE was via rstudioapi::getSourceEditorContext(). This has the downside of not being viable in visual mode, and so would force documents open in visual mode to switch back to source mode.\nThis PR adds a documentPath() API that can be used to retrieve the path on disk (if any) associated with an open document. It also uses this API in documentSave() and documentClose(), so that these APIs can be used in visual mode as well.\nApproach\nRequest the ID of the currently-open document from the client, and then use that to resolve the document's path from the source properties database.\nQA Notes\nYou can test by calling:\n.rs.api.documentPath()\n\nValidate that the returned path matches the path on disk for the currently-open document. Also validate that this returns NULL for Untitled documents.", "createdAt": "2020-09-18T04:48:08Z", "url": "https://github.com/rstudio/rstudio/pull/7831", "merged": true, "mergeCommit": {"oid": "36c44519d23a74c8e4f847d520ba8e46d42996fd"}, "closed": true, "closedAt": "2020-09-18T19:23:05Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ-CkAAH2gAyNDg5MDY3ODQyOmFmNzZhOTQ0MmRmM2M1MDExYzU2Zjg2NTAxYTkyNTcyNjA3MTE4NGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKJQdUAH2gAyNDg5MDY3ODQyOjlkN2QxNmQ5MDdlNGY4YTExNzIxOTEyOGY3NTdjMjc4ODlkOWM4ZTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af76a9442df3c5011c56f86501a925726071184c", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/af76a9442df3c5011c56f86501a925726071184c", "committedDate": "2020-09-18T04:39:28Z", "message": "add 'documentPath' API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e011b701a527dc5f9998d78ef1679e02261ab6da", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/e011b701a527dc5f9998d78ef1679e02261ab6da", "committedDate": "2020-09-18T04:42:34Z", "message": "determine path from source doc props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcf269f3c8e02d5e9524e9ab8a544073b365e495", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/bcf269f3c8e02d5e9524e9ab8a544073b365e495", "committedDate": "2020-09-18T04:56:15Z", "message": "also route events to console as appropriate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa7d04fc365fda45c669f4451cea868c2a019e35", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/aa7d04fc365fda45c669f4451cea868c2a019e35", "committedDate": "2020-09-18T05:03:06Z", "message": "better manage exceptions, console targets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89604abb883fabe0e125ed421056cfd5c2633f63", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/89604abb883fabe0e125ed421056cfd5c2633f63", "committedDate": "2020-09-18T05:13:28Z", "message": "fix payload cast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05bd73428dd54e8d87a86af93bc2115c6399fa9c", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/05bd73428dd54e8d87a86af93bc2115c6399fa9c", "committedDate": "2020-09-18T05:16:34Z", "message": "clarity in naming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2888b05317e22c59b4dd4f86814ecc0219ef5a6", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/e2888b05317e22c59b4dd4f86814ecc0219ef5a6", "committedDate": "2020-09-18T05:17:33Z", "message": "comma fixups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaf38c16c0b53ffb19c6f9c0ef6151cd581cc82f", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/eaf38c16c0b53ffb19c6f9c0ef6151cd581cc82f", "committedDate": "2020-09-18T05:18:18Z", "message": "fixups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "920f4ec305fcf116f9de557be985744fa137d06c", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/920f4ec305fcf116f9de557be985744fa137d06c", "committedDate": "2020-09-18T05:24:45Z", "message": "use plain old 'file.edit()' for navigateToFile when line, col unset"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjMxMjcz", "url": "https://github.com/rstudio/rstudio/pull/7831#pullrequestreview-491631273", "createdAt": "2020-09-18T16:53:54Z", "commit": {"oid": "920f4ec305fcf116f9de557be985744fa137d06c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjo1Mzo1NFrOHUU0sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjo1Mzo1NFrOHUU0sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA3NDczOQ==", "bodyText": "Should this raise an R error (so that the return value isn't \"null\" w/o apparent cause from the R caller's point of view?)", "url": "https://github.com/rstudio/rstudio/pull/7831#discussion_r491074739", "createdAt": "2020-09-18T16:53:54Z", "author": {"login": "jmcphers"}, "path": "src/cpp/session/modules/RStudioAPI.cpp", "diffHunk": "@@ -233,6 +234,30 @@ SEXP rs_systemUsername()\n    return r::sexp::create(core::system::username(), &protect);\n }\n \n+SEXP rs_documentProperties(SEXP idSEXP,\n+                           SEXP includeContentsSEXP)\n+{\n+   // resolve params\n+   std::string id = r::sexp::asString(idSEXP);\n+   bool includeContents = r::sexp::asLogical(includeContentsSEXP);\n+\n+   // retrieve document\n+   using session::source_database::SourceDocument;\n+   boost::shared_ptr<SourceDocument> pDoc(new SourceDocument);\n+   Error error = source_database::get(id, pDoc);\n+   if (error)\n+   {\n+      LOG_ERROR(error);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "920f4ec305fcf116f9de557be985744fa137d06c"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d7d16d907e4f8a117219128f757c27889d9c8e9", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/9d7d16d907e4f8a117219128f757c27889d9c8e9", "committedDate": "2020-09-18T17:43:36Z", "message": "log warning if we fail to retrieve document properties"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4992, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}