{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNjMzMDI2", "number": 6170, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1Mjo0M1rODdhajg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzoyNDoyMlrODdxFCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjgyNzY2OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1Mjo0M1rOFmLMsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDoxODoyMFrOFmLo4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3MzY4MQ==", "bodyText": "Minor style thing: new code can use lambda syntax instead of anonymous class, so:\nstop_.addClickHandler(clickEvent -> eventBus_.fireEvent(new JobExecuteActionEvent(job.id, JobConstants.ACTION_STOP));", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375573681", "createdAt": "2020-02-05T23:52:43Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -63,26 +77,39 @@ public void showJob(Job job)\n       name_.setText(job.name);\n       progress_.setLabel(job.name);\n       String status = JobConstants.stateDescription(job.state);\n+      stop_.addClickHandler(new ClickHandler()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e05d3248160247e1be153615a2591e47e14549"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MDg5OQ==", "bodyText": "Thanks Gary, made the change \ud83d\udc4d", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375580899", "createdAt": "2020-02-06T00:18:20Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -63,26 +77,39 @@ public void showJob(Job job)\n       name_.setText(job.name);\n       progress_.setLabel(job.name);\n       String status = JobConstants.stateDescription(job.state);\n+      stop_.addClickHandler(new ClickHandler()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3MzY4MQ=="}, "originalCommit": {"oid": "55e05d3248160247e1be153615a2591e47e14549"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjg3ODE1OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDoyMDo1OFrOFmLrjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMTo1MzoyMVrOFmNHDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MTU4Mg==", "bodyText": "Whether or not a job is stoppable is independent of whether or not it has a progress bar. I think we should make the button visible based on whether or not the job implements the stop action.", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375581582", "createdAt": "2020-02-06T00:20:58Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -63,26 +76,33 @@ public void showJob(Job job)\n       name_.setText(job.name);\n       progress_.setLabel(job.name);\n       String status = JobConstants.stateDescription(job.state);\n+      stop_.addClickHandler(clickEvent ->\n+         eventBus_.fireEvent(new JobExecuteActionEvent(job.id, JobConstants.ACTION_STOP)));\n+\n       if (job.completed > 0)\n       {\n          // Job is not running; show its completion status and time\n          progress_.setVisible(false);\n          status += \" \" + StringUtil.friendlyDateTime(new Date(job.completed * 1000));\n          elapsed_.setText(StringUtil.conciseElaspedTime(job.completed - job.started));\n          status_.setVisible(true);\n+         stop_.setVisible(false);\n       }\n       else if (job.max > 0)\n       {\n-         // Job is running and has a progress bar; show it and hide the status indicator\n+         // Job is running and has a progress bar;\n+         // show it with stop button and hide the status indicator\n          progress_.setVisible(true);\n          progress_.setProgress(job.progress, job.max);\n          status_.setVisible(false);\n+         stop_.setVisible(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYwNTAwNg==", "bodyText": "Thanks for pointing this out! I reverted the original comments and updated the stop button logic.", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375605006", "createdAt": "2020-02-06T01:53:21Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -63,26 +76,33 @@ public void showJob(Job job)\n       name_.setText(job.name);\n       progress_.setLabel(job.name);\n       String status = JobConstants.stateDescription(job.state);\n+      stop_.addClickHandler(clickEvent ->\n+         eventBus_.fireEvent(new JobExecuteActionEvent(job.id, JobConstants.ACTION_STOP)));\n+\n       if (job.completed > 0)\n       {\n          // Job is not running; show its completion status and time\n          progress_.setVisible(false);\n          status += \" \" + StringUtil.friendlyDateTime(new Date(job.completed * 1000));\n          elapsed_.setText(StringUtil.conciseElaspedTime(job.completed - job.started));\n          status_.setVisible(true);\n+         stop_.setVisible(false);\n       }\n       else if (job.max > 0)\n       {\n-         // Job is running and has a progress bar; show it and hide the status indicator\n+         // Job is running and has a progress bar;\n+         // show it with stop button and hide the status indicator\n          progress_.setVisible(true);\n          progress_.setProgress(job.progress, job.max);\n          status_.setVisible(false);\n+         stop_.setVisible(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MTU4Mg=="}, "originalCommit": {"oid": "ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNTM5NDAzOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzoyNDoyMlrOFmjpdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzo1MDo0MVrOFmkfEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk3NDI2Mg==", "bodyText": "No need for this test since it's inside an if statement that already guarantees the condition.", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375974262", "createdAt": "2020-02-06T17:24:22Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -89,6 +106,15 @@ else if (job.max > 0)\n             status = job.status;\n          }\n       }\n+\n+      // show stop button if job has a \"stop\" action, and is not completed\n+      if (job.completed == 0)\n+         stop_.setVisible(\n+               JsArrayUtil.jsArrayStringContains(job.actions, JobConstants.ACTION_STOP) &&\n+               job.completed == 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk4Nzk4Nw==", "bodyText": "Fixed \ud83d\udc4d", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375987987", "createdAt": "2020-02-06T17:50:41Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -89,6 +106,15 @@ else if (job.max > 0)\n             status = job.status;\n          }\n       }\n+\n+      // show stop button if job has a \"stop\" action, and is not completed\n+      if (job.completed == 0)\n+         stop_.setVisible(\n+               JsArrayUtil.jsArrayStringContains(job.actions, JobConstants.ACTION_STOP) &&\n+               job.completed == 0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk3NDI2Mg=="}, "originalCommit": {"oid": "1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4043, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}