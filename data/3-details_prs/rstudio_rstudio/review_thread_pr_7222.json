{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMTM3NzA3", "number": 7222, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOToxMDo1M1rOEJPNLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOToxNDo1M1rOEJPRqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTIxNzc0OnYy", "diffSide": "RIGHT", "path": "src/cpp/server/ServerSessionManager.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOToxMDo1M1rOGpr1XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOToxMDo1M1rOGpr1XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2Mjk3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               // we use a modified configured home directory to provide a realiable temp dir that can be written to\n          \n          \n            \n               // we use a modified configured home directory to provide a reliable temp dir that can be written to", "url": "https://github.com/rstudio/rstudio/pull/7222#discussion_r446362972", "createdAt": "2020-06-26T19:10:53Z", "author": {"login": "jmcphers"}, "path": "src/cpp/server/ServerSessionManager.cpp", "diffHunk": "@@ -382,12 +382,33 @@ Error launchSession(const r_util::SessionContext& context,\n                     PidType* pPid)\n {\n    // launch the session\n+   // we use a modified configured home directory to provide a realiable temp dir that can be written to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e74ad7a046c4caf36c2774d951138ebff5a67898"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTIyOTIyOnYy", "diffSide": "RIGHT", "path": "src/cpp/server/ServerSessionManager.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOToxNDo1M1rOGpr8Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOToxNjozNVrOGpr_Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2NDc1NQ==", "bodyText": "Should this use setenv (so that it overrides any existing XDG_CONFIG_HOME)?", "url": "https://github.com/rstudio/rstudio/pull/7222#discussion_r446364755", "createdAt": "2020-06-26T19:14:53Z", "author": {"login": "jmcphers"}, "path": "src/cpp/server/ServerSessionManager.cpp", "diffHunk": "@@ -382,12 +382,33 @@ Error launchSession(const r_util::SessionContext& context,\n                     PidType* pPid)\n {\n    // launch the session\n+   // we use a modified configured home directory to provide a realiable temp dir that can be written to\n+   // as the server (service) user most likely does not have a home directory configured\n    std::string username = context.username;\n    std::string rsessionPath = server::options().rsessionPath();\n    std::string runAsUser = core::system::realUserIsRoot() ? username : \"\";\n    core::system::ProcessConfig config = sessionProcessConfig(context,\n                                                              extraArgs);\n \n+   FilePath tmpDir;\n+   Error error = FilePath::tempFilePath(tmpDir);\n+   if (error)\n+   {\n+      LOG_ERROR(error);\n+   }\n+   else\n+   {\n+      error = tmpDir.ensureDirectory();\n+      if (error)\n+      {\n+         LOG_ERROR(error);\n+      }\n+      else\n+      {\n+         config.environment.push_back(std::make_pair(\"XDG_CONFIG_HOME\", tmpDir.getAbsolutePath()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e74ad7a046c4caf36c2774d951138ebff5a67898"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2NTQ5OA==", "bodyText": "Good catch, will fix that.", "url": "https://github.com/rstudio/rstudio/pull/7222#discussion_r446365498", "createdAt": "2020-06-26T19:16:35Z", "author": {"login": "kfeinauer"}, "path": "src/cpp/server/ServerSessionManager.cpp", "diffHunk": "@@ -382,12 +382,33 @@ Error launchSession(const r_util::SessionContext& context,\n                     PidType* pPid)\n {\n    // launch the session\n+   // we use a modified configured home directory to provide a realiable temp dir that can be written to\n+   // as the server (service) user most likely does not have a home directory configured\n    std::string username = context.username;\n    std::string rsessionPath = server::options().rsessionPath();\n    std::string runAsUser = core::system::realUserIsRoot() ? username : \"\";\n    core::system::ProcessConfig config = sessionProcessConfig(context,\n                                                              extraArgs);\n \n+   FilePath tmpDir;\n+   Error error = FilePath::tempFilePath(tmpDir);\n+   if (error)\n+   {\n+      LOG_ERROR(error);\n+   }\n+   else\n+   {\n+      error = tmpDir.ensureDirectory();\n+      if (error)\n+      {\n+         LOG_ERROR(error);\n+      }\n+      else\n+      {\n+         config.environment.push_back(std::make_pair(\"XDG_CONFIG_HOME\", tmpDir.getAbsolutePath()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2NDc1NQ=="}, "originalCommit": {"oid": "e74ad7a046c4caf36c2774d951138ebff5a67898"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4294, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}