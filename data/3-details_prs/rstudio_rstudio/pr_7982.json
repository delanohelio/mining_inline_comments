{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4ODE3OTI4", "number": 7982, "title": "make it possible to interrupt readLines(stdin())", "bodyText": "Intent\nCurrently, when R requests input from the user via readline() or readLines(stdin()), there is no way to interrupt the read -- the R session is effectively stuck and the user is forced to restart the session.\nThis PR makes it possible to exit that state.\nCloses #3448.\nApproach\nPreviously, we tried to \"guess\" whether the appropriate action was to send a \"true\" process interrupt, or to try and send a \"console\" interrupt, based on the state of the prompt. This fails when R attempts to read input from the user without setting a prompt, as in readLines(stdin()).\nTo properly handle this, we now:\n\nAlways send a so-called \"interrupt\" RPC;\nIf the R session appears to be busy, then we interrupt it; if not, then we send a console-level interrupt.\n\nQA Notes\nTest that the following states can all be interrupted (by pressing Escape while the Console has focus) on different platforms:\nSys.sleep(10)\nsystem(\"sleep 10\")\nreadLines(stdin())\nreadline()\nreadline(\"Enter input: \")", "createdAt": "2020-10-06T20:30:48Z", "url": "https://github.com/rstudio/rstudio/pull/7982", "merged": true, "mergeCommit": {"oid": "43a66709fb5bc6566362f6361039ca934359b9b1"}, "closed": true, "closedAt": "2020-10-09T18:24:08Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP-YkdgH2gAyNDk4ODE3OTI4OmY0ODdmYTI3YWVlOGZkOWFhMzBkMzM5YmEyMjcxMGI1MjEwZWFmODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQ6bCbgFqTUwNTg5OTYzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f487fa27aee8fd9aa30d339ba22710b5210eaf85", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/f487fa27aee8fd9aa30d339ba22710b5210eaf85", "committedDate": "2020-10-06T20:27:03Z", "message": "make it possible to interrupt readLines(stdin())"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e7b7ab2c1a0172c26bcf2a6be618509e26037f2", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/7e7b7ab2c1a0172c26bcf2a6be618509e26037f2", "committedDate": "2020-10-06T20:32:16Z", "message": "reformat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe5ffb18a6c1d05c84a914551a530f023e6f9744", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/fe5ffb18a6c1d05c84a914551a530f023e6f9744", "committedDate": "2020-10-06T21:20:46Z", "message": "remove output suppression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a615a0b85e8d201ee4352def2f2babd1c83755e", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/1a615a0b85e8d201ee4352def2f2babd1c83755e", "committedDate": "2020-10-06T22:09:09Z", "message": "document motivation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "047ddc91bad2dca590b919aeb4d3c1b0b698512c", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/047ddc91bad2dca590b919aeb4d3c1b0b698512c", "committedDate": "2020-10-06T22:11:15Z", "message": "update NEWS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f239473babc0182c780d937239179fbf86da1a3", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/3f239473babc0182c780d937239179fbf86da1a3", "committedDate": "2020-10-06T22:25:48Z", "message": "suppress newlines printed by Rf_onintr"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNTMzODgx", "url": "https://github.com/rstudio/rstudio/pull/7982#pullrequestreview-503533881", "createdAt": "2020-10-07T05:26:05Z", "commit": {"oid": "3f239473babc0182c780d937239179fbf86da1a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwNToyNjowNVrOHdjDVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwNToyNjowNVrOHdjDVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc0NTA0Nw==", "bodyText": "This is sort of a hack based on how we draw the prompt. In a regular R session, when an interrupt is issued, R writes a single newline:\nhttps://github.com/wch/r-source/blob/819477cd6dbefb8fae61a07fc13064faa29a2714/src/main/errors.c#L188\nwith the intention of having that ensure the input prompt is then drawn on its own line. The net result is that interrupting a command gives you a \"new\" prompt to work on.\nRStudio instead tries a little harder to ensure the prompt is always shown on its own line, which means an extraneous newline is written to the console history in these cases. Hence, this is ultimately a hack to ensure that RStudio's output more closely mimics that of R.", "url": "https://github.com/rstudio/rstudio/pull/7982#discussion_r500745047", "createdAt": "2020-10-07T05:26:05Z", "author": {"login": "kevinushey"}, "path": "src/cpp/r/session/RStdCallbacks.cpp", "diffHunk": "@@ -426,8 +426,20 @@ void RWriteConsoleEx (const char *buf, int buflen, int otype)\n    {\n       if (!s_suppressOutput)\n       {\n+         bool isInterruptOutput =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f239473babc0182c780d937239179fbf86da1a3"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1ODk5NjMy", "url": "https://github.com/rstudio/rstudio/pull/7982#pullrequestreview-505899632", "createdAt": "2020-10-09T18:24:03Z", "commit": {"oid": "3f239473babc0182c780d937239179fbf86da1a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 19, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}