{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzOTEyMzk5", "number": 6969, "title": "Bring various changes from Pro", "bodyText": "This PR has a number of items that seem to have been missed or purposely not brought into open source. The goal here is to determine what should be part of open source.", "createdAt": "2020-05-27T14:57:26Z", "url": "https://github.com/rstudio/rstudio/pull/6969", "merged": true, "mergeCommit": {"oid": "9c7f5a6bad26a91af2c91b0f2fe47c24e925999a"}, "closed": true, "closedAt": "2020-05-27T20:18:50Z", "author": {"login": "ricardofandrade"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclan87gFqTQxOTMxMDEzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABclePYdAH2gAyNDIzOTEyMzk5OmFhNDYyYTAxMmIzMDk2MjM1YWQ5ZDYwNDY0YTBmMTNjN2ZhMWI0Nzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MzEwMTMy", "url": "https://github.com/rstudio/rstudio/pull/6969#pullrequestreview-419310132", "createdAt": "2020-05-27T14:58:29Z", "commit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDo1ODoyOVrOGbOtAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNTowMTo1NVrOGbO9Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwNTYzNQ==", "bodyText": "Due to Event.hpp including <gsl/gsl>", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431205635", "createdAt": "2020-05-27T14:58:29Z", "author": {"login": "ricardofandrade"}, "path": "src/cpp/server/CMakeLists.txt", "diffHunk": "@@ -151,6 +151,7 @@ include_directories(\n    ${SERVER_SYSTEM_INCLUDE_DIRS}\n    ${CORE_INCLUDE_DIRS}\n    ${MONITOR_SOURCE_DIR}/include\n+   ${EXT_SOURCE_DIR}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwNjIyOQ==", "bodyText": "New code. Trying to minimize changes between open source and pro via overlay.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431206229", "createdAt": "2020-05-27T14:58:58Z", "author": {"login": "ricardofandrade"}, "path": "src/cpp/server/ServerOptions.cpp", "diffHunk": "@@ -288,7 +288,7 @@ ProgramStatus Options::read(int argc,\n          value<std::string>(&rsessionWhichR_)->default_value(\"\"),\n          \"path to main R program (e.g. /usr/bin/R)\")\n       (\"rsession-path\", \n-         value<std::string>(&rsessionPath_)->default_value(\"rsession\"),\n+         value<std::string>(&rsessionPath_)->default_value(rsessionExecutable()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwNjU2Mg==", "bodyText": "New code.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431206562", "createdAt": "2020-05-27T14:59:13Z", "author": {"login": "ricardofandrade"}, "path": "src/cpp/server/ServerOptionsOverlay.cpp", "diffHunk": "@@ -50,5 +50,10 @@ void sessionProcessConfigOverlay(core::system::Options* pArgs,\n {\n }\n \n+std::string Options::rsessionExecutable() const", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwNjkxMw==", "bodyText": "To minimize differences with Pro. Implementation omitted.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431206913", "createdAt": "2020-05-27T14:59:33Z", "author": {"login": "ricardofandrade"}, "path": "src/cpp/server/ServerSessionProxy.cpp", "diffHunk": "@@ -358,6 +377,13 @@ void handleLocalhostResponse(\n    }\n }\n \n+bool handleLicenseError(\n+      boost::shared_ptr<http::AsyncConnection> ptrConnection,\n+      const Error& error)\n+{\n+   return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwODA3NA==", "bodyText": "Minimizing differences with Pro. Many occurrences.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431208074", "createdAt": "2020-05-27T15:00:23Z", "author": {"login": "ricardofandrade"}, "path": "src/cpp/server/extras/admin/rstudio-server.in", "diffHunk": "@@ -72,42 +71,45 @@ case \"$1\" in\n         if [ -n \"$2\" ]; then\n            kill -s USR1 $3 $4 $5 $6 $7 $8 $9 $2\n         else\n-           echo \"Must specify PID of session to suspend\"\n+           argType=\"PID\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwODk0Mg==", "bodyText": "We could always return this value instead.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431208942", "createdAt": "2020-05-27T15:01:10Z", "author": {"login": "ricardofandrade"}, "path": "src/cpp/session/SessionClientInit.cpp", "diffHunk": "@@ -88,6 +88,15 @@ namespace session {\n namespace client_init {\n namespace {\n \n+std::string userIdentityDisplay(const http::Request& request)\n+{\n+   std::string userIdentity = request.headerValue(kRStudioUserIdentityDisplay);\n+   if (!userIdentity.empty())\n+      return userIdentity;\n+   else\n+      return session::options().userIdentity();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwOTI0Ng==", "bodyText": "I missed this one myself.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431209246", "createdAt": "2020-05-27T15:01:25Z", "author": {"login": "ricardofandrade"}, "path": "src/cpp/session/include/session/SessionConstants.hpp", "diffHunk": "@@ -85,7 +85,7 @@\n \n #define kUseSecureCookiesSessionOption    \"session-use-secure-cookies\"\n #define kIFrameEmbeddingSessionOption     \"session-iframe-embedding\"\n-#define kLegacyCookiesSessionOption       \"legacy-cookies\"\n+#define kLegacyCookiesSessionOption       \"session-legacy-cookies\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwOTgxOA==", "bodyText": "There's an else here in Pro.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431209818", "createdAt": "2020-05-27T15:01:55Z", "author": {"login": "ricardofandrade"}, "path": "src/gwt/src/org/rstudio/studio/client/application/Application.java", "diffHunk": "@@ -222,8 +222,19 @@ public void onError(ServerError error)\n             Debug.logError(error);\n             dismissLoadingProgress.execute();\n \n-            globalDisplay_.showErrorMessage(\"RStudio Initialization Error\",\n-                                            error.getUserMessage());\n+            if (!StringUtil.isNullOrEmpty(error.getRedirectUrl()))\n+            {\n+               // error is informing us that we should redirect\n+               // redirect to the specified URL (as a sub URL of the site's root)\n+               String redirectUrl = ApplicationUtils.getHostPageBaseURLWithoutContext(false) + \n+            \t\t   error.getRedirectUrl();\n+               navigateWindowWithDelay(redirectUrl);\n+            }\n+            else\n+            {\n+               globalDisplay_.showErrorMessage(\"RStudio Initialization Error\",\n+                                               error.getUserMessage());\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MzEyNjA5", "url": "https://github.com/rstudio/rstudio/pull/6969#pullrequestreview-419312609", "createdAt": "2020-05-27T15:00:40Z", "commit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNTowMDo0MVrOGbO3xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNTowMDo0MVrOGbO3xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwODM5MQ==", "bodyText": "None of these changes should come to open source for this file.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431208391", "createdAt": "2020-05-27T15:00:41Z", "author": {"login": "kfeinauer"}, "path": "src/cpp/core/include/core/system/UserObfuscation.hpp", "diffHunk": "@@ -13,6 +13,20 @@\n  *\n  */\n \n+// these macros obfuscate user IDs, with the goal of making it difficult to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da79642e4625eacee3bc2b898472c46e884fa0ae", "author": {"user": {"login": "ricardofandrade", "name": "Ricardo Andrade"}}, "url": "https://github.com/rstudio/rstudio/commit/da79642e4625eacee3bc2b898472c46e884fa0ae", "committedDate": "2020-05-27T15:23:28Z", "message": "Backport pro fixes and changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a75525be6b2982105c64ca8497a92ef6d89c00b1", "author": {"user": {"login": "ricardofandrade", "name": "Ricardo Andrade"}}, "url": "https://github.com/rstudio/rstudio/commit/a75525be6b2982105c64ca8497a92ef6d89c00b1", "committedDate": "2020-05-27T14:53:12Z", "message": "Merge branch 'master' of github.com:rstudio/rstudio into bugfix/pro-fixes"}, "afterCommit": {"oid": "da79642e4625eacee3bc2b898472c46e884fa0ae", "author": {"user": {"login": "ricardofandrade", "name": "Ricardo Andrade"}}, "url": "https://github.com/rstudio/rstudio/commit/da79642e4625eacee3bc2b898472c46e884fa0ae", "committedDate": "2020-05-27T15:23:28Z", "message": "Backport pro fixes and changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5Mzg3MzI0", "url": "https://github.com/rstudio/rstudio/pull/6969#pullrequestreview-419387324", "createdAt": "2020-05-27T16:11:31Z", "commit": {"oid": "da79642e4625eacee3bc2b898472c46e884fa0ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5Mzk1MjE0", "url": "https://github.com/rstudio/rstudio/pull/6969#pullrequestreview-419395214", "createdAt": "2020-05-27T16:20:41Z", "commit": {"oid": "da79642e4625eacee3bc2b898472c46e884fa0ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjoyMDo0MVrOGbS0Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjoyMDo0MVrOGbS0Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI3Mjk4Mg==", "bodyText": "Is this really intentional?", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431272982", "createdAt": "2020-05-27T16:20:41Z", "author": {"login": "ricardofandrade"}, "path": "src/cpp/session/modules/environment/SessionEnvironment.cpp", "diffHunk": "@@ -1291,7 +1291,7 @@ Error initialize()\n       (bind(registerRpcMethod, \"remove_objects\", removeObjects))\n       (bind(registerRpcMethod, \"remove_all_objects\", removeAllObjects))\n       (bind(registerRpcMethod, \"get_environment_state\", getEnv))\n-      (bind(registerRpcMethod, \"get_object_contents\", getObjectContents))\n+      (bind(registerRpcMethod, \"getObjectect_contents\", getObjectContents))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da79642e4625eacee3bc2b898472c46e884fa0ae"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0965366ed2acda351e31a976ac81bfb494d644dc", "author": {"user": {"login": "ricardofandrade", "name": "Ricardo Andrade"}}, "url": "https://github.com/rstudio/rstudio/commit/0965366ed2acda351e31a976ac81bfb494d644dc", "committedDate": "2020-05-27T16:26:01Z", "message": "Revert unintentional change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NDQ1OTY2", "url": "https://github.com/rstudio/rstudio/pull/6969#pullrequestreview-419445966", "createdAt": "2020-05-27T17:19:54Z", "commit": {"oid": "0965366ed2acda351e31a976ac81bfb494d644dc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNzoxOTo1NFrOGbVNRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNzoyOToxNFrOGbVjMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMxMjE5Nw==", "bodyText": "Is this change intentional? It looks odd -- it seems to me the intention really is to negate the whole expression and not just the first piece.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431312197", "createdAt": "2020-05-27T17:19:54Z", "author": {"login": "kevinushey"}, "path": "src/cpp/core/markdown/sundown/html_blocks.h", "diffHunk": "@@ -2,7 +2,7 @@\n /* Command-line: gperf -N find_block_tag -H hash_block_tag -C -c -E --ignore-case html_block_names.txt  */\n /* Computed positions: -k'1-2' */\n \n-#if !((' ' == 32) && ('!' == 33) && ('\"' == 34) && ('#' == 35) \\\n+#if (!(' ' == 32) && ('!' == 33) && ('\"' == 34) && ('#' == 35) \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0965366ed2acda351e31a976ac81bfb494d644dc"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMxMjY5MA==", "bodyText": "This also seems odd?", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431312690", "createdAt": "2020-05-27T17:20:45Z", "author": {"login": "kevinushey"}, "path": "src/cpp/core/zlib/zutil.h", "diffHunk": "@@ -22,7 +22,7 @@\n #include \"zlib.h\"\n \n #if defined(STDC) && !defined(Z_SOLO)\n-#  if !(defined(_WIN32_WCE) && defined(_MSC_VER))\n+#  if (!defined(_WIN32_WCE) && defined(_MSC_VER))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0965366ed2acda351e31a976ac81bfb494d644dc"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMxNjYwMw==", "bodyText": "Can we please document with a comment why we choose 32 here? (If I understand correctly this is because it's the maximum username length on Linux.)", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431316603", "createdAt": "2020-05-27T17:27:17Z", "author": {"login": "kevinushey"}, "path": "src/cpp/monitor/include/monitor/events/Event.hpp", "diffHunk": "@@ -46,48 +47,46 @@ enum EventScope\n #define kSessionAdminSuspend     2006\n #define kSessionAdminTerminate   2007\n \n-class Event\n+#define kMaxEventDataSize     32", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0965366ed2acda351e31a976ac81bfb494d644dc"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMxNzgxMA==", "bodyText": "Should we check and warn if we're truncating the username / data here? I also worry that we would fail to write the null terminator in these cases. That shouldn't be an issue since we memset everything and avoid writing over the final null byte.", "url": "https://github.com/rstudio/rstudio/pull/6969#discussion_r431317810", "createdAt": "2020-05-27T17:29:14Z", "author": {"login": "kevinushey"}, "path": "src/cpp/monitor/events/Event.cpp", "diffHunk": "@@ -24,6 +24,24 @@\n namespace rstudio {\n namespace monitor {\n \n+Event::Event(int scope,\n+             int id,\n+             const std::string& data,\n+             const std::string& username,\n+             PidType pid,\n+             boost::posix_time::ptime timestamp)\n+   : empty_(false),\n+     scope_(scope),\n+     id_(id),\n+     pid_(pid),\n+     timestamp_(core::date_time::millisecondsSinceEpoch(timestamp))\n+{\n+   ::memset(&username_, 0, kMaxEventDataSize+1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0965366ed2acda351e31a976ac81bfb494d644dc"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "440d6c7d4f71b7e33e14e5d0ef24a52f85825a9e", "author": {"user": {"login": "ricardofandrade", "name": "Ricardo Andrade"}}, "url": "https://github.com/rstudio/rstudio/commit/440d6c7d4f71b7e33e14e5d0ef24a52f85825a9e", "committedDate": "2020-05-27T18:08:13Z", "message": "Revert unintentional changes on external code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfb87869514c1007d68d23823f5e999aab45f7e7", "author": {"user": {"login": "ricardofandrade", "name": "Ricardo Andrade"}}, "url": "https://github.com/rstudio/rstudio/commit/bfb87869514c1007d68d23823f5e999aab45f7e7", "committedDate": "2020-05-27T18:09:41Z", "message": "clarifying comment for event size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa462a012b3096235ad9d60464a0f13c7fa1b478", "author": {"user": {"login": "ricardofandrade", "name": "Ricardo Andrade"}}, "url": "https://github.com/rstudio/rstudio/commit/aa462a012b3096235ad9d60464a0f13c7fa1b478", "committedDate": "2020-05-27T19:15:14Z", "message": "Add warning logs for truncated event data"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 152, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}