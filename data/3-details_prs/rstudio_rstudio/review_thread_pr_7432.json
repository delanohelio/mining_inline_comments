{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1ODg3NzQ5", "number": 7432, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTo0ODo1OVrOERl5dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTo1MjowNVrOERl9Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2ODgyMTY1OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/model/DocUpdateSentinel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTo0ODo1OVrOG2ZLhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTo0ODo1OVrOG2ZLhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY4ODgzOQ==", "bodyText": "Nit: should follow member variable convention (_).", "url": "https://github.com/rstudio/rstudio/pull/7432#discussion_r459688839", "createdAt": "2020-07-23T19:48:59Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/model/DocUpdateSentinel.java", "diffHunk": "@@ -867,7 +904,10 @@ protected void execute()\n    private HandlerRegistration lastChanceSaveHandlerReg_;\n    private final HashMap<String, ValueChangeHandlerManager<String>> \n                  propertyChangeHandlers_;\n+   private boolean loggedAutosaveError = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "807ad362cf6a33d9681308700e86407cd3dad9d5"}, "originalPosition": 144}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2ODgzMTM5OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/model/DocUpdateSentinel.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTo1MjowNVrOG2ZRYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMDoxNToxNlrOG2Z_qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY5MDMzNg==", "bodyText": "Not sure about treating this as a completion. One consequence of this is that the rest of the code is going to think that changes are backed up when they aren't. Will this cause the user to not get the \"you haven't saved your changes\" warning when they attempt to navigate away with unsaved changes?", "url": "https://github.com/rstudio/rstudio/pull/7432#discussion_r459690336", "createdAt": "2020-07-23T19:52:05Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/model/DocUpdateSentinel.java", "diffHunk": "@@ -470,20 +475,52 @@ private boolean doSaveImpl(final String path,\n                @Override\n                public void onError(ServerError error)\n                {\n+                  // Always log save errors.\n                   Debug.logError(error);\n+                  \n+                  // Inform the user once if this was an autosave failure.\n+                  if (isAutosave && !loggedAutosaveError)\n+                  {\n+                     loggedAutosaveError = true;\n+\n+                     RStudioGinjector.INSTANCE.getGlobalDisplay().showErrorMessage(\n+                           \"Error Autosaving File\",\n+                           \"RStudio was unable to autosave this file. You may need \" +\n+                           \"to restart RStudio.\");\n+                  }\n+                 \n+                  // Avoid reporting auto-save errors to the user via the indicator,\n+                  // as this could lead to a relentless cascade of errors while the\n+                  // user attempts to edit the document.\n                   if (progress != null)\n-                     progress.onError(error.getUserMessage());\n+                  {\n+                     if (isAutosave)\n+                     {\n+                        progress_.onCompleted();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "807ad362cf6a33d9681308700e86407cd3dad9d5"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcwMTExNw==", "bodyText": "This is only for the progress indicator, not for any logic related to successful document save (ie: we don't touch the onCompleted_ callback). This change ensures that the progress indicator is dismissed followed a failed save.", "url": "https://github.com/rstudio/rstudio/pull/7432#discussion_r459701117", "createdAt": "2020-07-23T20:13:02Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/model/DocUpdateSentinel.java", "diffHunk": "@@ -470,20 +475,52 @@ private boolean doSaveImpl(final String path,\n                @Override\n                public void onError(ServerError error)\n                {\n+                  // Always log save errors.\n                   Debug.logError(error);\n+                  \n+                  // Inform the user once if this was an autosave failure.\n+                  if (isAutosave && !loggedAutosaveError)\n+                  {\n+                     loggedAutosaveError = true;\n+\n+                     RStudioGinjector.INSTANCE.getGlobalDisplay().showErrorMessage(\n+                           \"Error Autosaving File\",\n+                           \"RStudio was unable to autosave this file. You may need \" +\n+                           \"to restart RStudio.\");\n+                  }\n+                 \n+                  // Avoid reporting auto-save errors to the user via the indicator,\n+                  // as this could lead to a relentless cascade of errors while the\n+                  // user attempts to edit the document.\n                   if (progress != null)\n-                     progress.onError(error.getUserMessage());\n+                  {\n+                     if (isAutosave)\n+                     {\n+                        progress_.onCompleted();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY5MDMzNg=="}, "originalCommit": {"oid": "807ad362cf6a33d9681308700e86407cd3dad9d5"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcwMjE4NA==", "bodyText": "Sorry, I'm wrong: different kinds of progress indicators get used in different calls here. Still, it seems like we need a way to indicate an indicator error without always notifying the user.", "url": "https://github.com/rstudio/rstudio/pull/7432#discussion_r459702184", "createdAt": "2020-07-23T20:15:16Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/model/DocUpdateSentinel.java", "diffHunk": "@@ -470,20 +475,52 @@ private boolean doSaveImpl(final String path,\n                @Override\n                public void onError(ServerError error)\n                {\n+                  // Always log save errors.\n                   Debug.logError(error);\n+                  \n+                  // Inform the user once if this was an autosave failure.\n+                  if (isAutosave && !loggedAutosaveError)\n+                  {\n+                     loggedAutosaveError = true;\n+\n+                     RStudioGinjector.INSTANCE.getGlobalDisplay().showErrorMessage(\n+                           \"Error Autosaving File\",\n+                           \"RStudio was unable to autosave this file. You may need \" +\n+                           \"to restart RStudio.\");\n+                  }\n+                 \n+                  // Avoid reporting auto-save errors to the user via the indicator,\n+                  // as this could lead to a relentless cascade of errors while the\n+                  // user attempts to edit the document.\n                   if (progress != null)\n-                     progress.onError(error.getUserMessage());\n+                  {\n+                     if (isAutosave)\n+                     {\n+                        progress_.onCompleted();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY5MDMzNg=="}, "originalCommit": {"oid": "807ad362cf6a33d9681308700e86407cd3dad9d5"}, "originalPosition": 101}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4345, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}