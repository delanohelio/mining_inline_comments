{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4Njk5NzM5", "number": 8334, "title": "Fix jumpy scroll/cursor/selection action with large code chunks", "bodyText": "Intent\nThis change addresses an issue in which clicking inside a large code chunk (when the cursor is offscreen) in the visual editor can generate unwanted scroll jumping/selection.\nFixes #8332.\nApproach\nThere are two small changes necessary to resolve this issue:\n\nFirst, we were formerly obtaining the cursor geometry from the focused element, a hidden <textarea>. However, the cursor the user actually sees is a painted-on ace_cursor element, so now we get more accurate geometry from there.\nSecond, we were scrolling the document while Ace considered the mouse to be down. Ace treats this as a selection-generating event. We now avoid trying to auto-scroll the cursor into view while the mouse is down.\n\nQA Notes\nThe code affected here is intended to help keep the cursor in view when navigating with the keyboard, so ensure that still works correctly.", "createdAt": "2020-11-10T18:58:28Z", "url": "https://github.com/rstudio/rstudio/pull/8334", "merged": true, "mergeCommit": {"oid": "f39fa552e0ae34efe2057f7ef07975a2b062bf98"}, "closed": true, "closedAt": "2020-11-10T22:07:18Z", "author": {"login": "jmcphers"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbN7SjgH2gAyNTE4Njk5NzM5OjU1YWIyMmNkZjA3ODYwZjhlYmU4MzhkNWI5NDI1ZmU1MDU2Y2IyNjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbOVnIAH2gAyNTE4Njk5NzM5OjE0ZDU4Y2RhY2JkOGNmNGVhMjdmZWE2MTA3M2JlY2QzYjU5OTI4NzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "55ab22cdf07860f8ebe838d5b9425fe5056cb263", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/55ab22cdf07860f8ebe838d5b9425fe5056cb263", "committedDate": "2020-11-10T18:46:43Z", "message": "obtain cursor geometry from virtual cursor; ignore mouse"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTIxNjA1", "url": "https://github.com/rstudio/rstudio/pull/8334#pullrequestreview-527521605", "createdAt": "2020-11-10T19:05:37Z", "commit": {"oid": "55ab22cdf07860f8ebe838d5b9425fe5056cb263"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTowNTozN1rOHwrjsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTowNTozN1rOHwrjsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgwNzM0Ng==", "bodyText": "What happens if you initiate a click / mousedown within the visual editor surface, but then later mouseup somewhere else? Does this event handler still see the mouseup event?", "url": "https://github.com/rstudio/rstudio/pull/8334#discussion_r520807346", "createdAt": "2020-11-10T19:05:37Z", "author": {"login": "kevinushey"}, "path": "src/gwt/panmirror/src/editor/src/optional/ace/ace.ts", "diffHunk": "@@ -711,6 +716,15 @@ export class AceNodeView implements NodeView {\n         this.scrollRow = -1;\n       }),\n     );\n+\n+    // Keep track of mouse state so we can avoid e.g., autoscrolling while the\n+    // mouse is down\n+    this.dom.addEventListener(\"mousedown\", (evt) => {\n+      this.mouseDown = true;\n+    });\n+    this.dom.addEventListener(\"mouseup\", (evt) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55ab22cdf07860f8ebe838d5b9425fe5056cb263"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14d58cdacbd8cf4ea27fea61073becd3b5992874", "author": {"user": {"login": "jmcphers", "name": "Jonathan"}}, "url": "https://github.com/rstudio/rstudio/commit/14d58cdacbd8cf4ea27fea61073becd3b5992874", "committedDate": "2020-11-10T19:15:28Z", "message": "clear mousedown flag when mouse leaves"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4894, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}