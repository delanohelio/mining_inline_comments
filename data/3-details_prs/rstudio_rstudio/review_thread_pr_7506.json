{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwNTQ3NzU1", "number": 7506, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjozMzozNFrOEUOL7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjozMzozNFrOEUOL7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NjM5NDA0OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjozMzozNFrOG6Ylyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjo0Mzo1NVrOG6YvZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg3MzQ4Mw==", "bodyText": "isVisualModeActivated() is a logical state (should it be active) whereas the actual load state (and presence of the panmirror_ member variable that you access in focus()) is different (i.e. it could be logically \"activated\" but still in the process of loading, so panmirror_ is null). I think you probably want to wrap this call in ensureVisualModeActive().", "url": "https://github.com/rstudio/rstudio/pull/7506#discussion_r463873483", "createdAt": "2020-07-31T22:33:34Z", "author": {"login": "jjallaire"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "diffHunk": "@@ -2456,7 +2471,14 @@ public void execute() {\n \n    public void focus()\n    {\n-      view_.editorContainer().focus();\n+      if (isVisualModeActivated())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66cec22c35f0eee23e53d908ae93d1975076d007"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg3NDA0OQ==", "bodyText": "Actually, I don't even know if that would be correct. Here is another effort I made to get focus working when a visual mode document is opened as part of navigation: \n  \n    \n      rstudio/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualMode.java\n    \n    \n        Lines 628 to 640\n      in\n      66cec22\n    \n    \n    \n    \n\n        \n          \n           // when interactively adding a visual mode doc, make sure we set the focus \n        \n\n        \n          \n           // (special handling required b/c initialization of visual mode docs is \n        \n\n        \n          \n           // async so can miss the normal setting of focus) \n        \n\n        \n          \n           if (e.getMode() == Source.OPEN_INTERACTIVE &&  isActivated() && target_.isActiveDocument()) \n        \n\n        \n          \n           { \n        \n\n        \n          \n              if (panmirror_ != null)  \n        \n\n        \n          \n              { \n        \n\n        \n          \n                 panmirror_.focus(); \n        \n\n        \n          \n              } \n        \n\n        \n          \n              else if (isLoading_) \n        \n\n        \n          \n              { \n        \n\n        \n          \n                 onReadyHandlers_.add(() -> panmirror_.focus()); \n        \n\n        \n          \n              }", "url": "https://github.com/rstudio/rstudio/pull/7506#discussion_r463874049", "createdAt": "2020-07-31T22:35:47Z", "author": {"login": "jjallaire"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "diffHunk": "@@ -2456,7 +2471,14 @@ public void execute() {\n \n    public void focus()\n    {\n-      view_.editorContainer().focus();\n+      if (isVisualModeActivated())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg3MzQ4Mw=="}, "originalCommit": {"oid": "66cec22c35f0eee23e53d908ae93d1975076d007"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg3NDExNg==", "bodyText": "I think we should talk realtime about all of this on Monday. I'll send a schedule item.", "url": "https://github.com/rstudio/rstudio/pull/7506#discussion_r463874116", "createdAt": "2020-07-31T22:36:04Z", "author": {"login": "jjallaire"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "diffHunk": "@@ -2456,7 +2471,14 @@ public void execute() {\n \n    public void focus()\n    {\n-      view_.editorContainer().focus();\n+      if (isVisualModeActivated())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg3MzQ4Mw=="}, "originalCommit": {"oid": "66cec22c35f0eee23e53d908ae93d1975076d007"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg3NTk0MQ==", "bodyText": "Would it make sense to first check isActivated() and then next ensureVisualModeActivated() so the command is properly registered if we are indeed still loading?", "url": "https://github.com/rstudio/rstudio/pull/7506#discussion_r463875941", "createdAt": "2020-07-31T22:43:55Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "diffHunk": "@@ -2456,7 +2471,14 @@ public void execute() {\n \n    public void focus()\n    {\n-      view_.editorContainer().focus();\n+      if (isVisualModeActivated())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg3MzQ4Mw=="}, "originalCommit": {"oid": "66cec22c35f0eee23e53d908ae93d1975076d007"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4253, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}