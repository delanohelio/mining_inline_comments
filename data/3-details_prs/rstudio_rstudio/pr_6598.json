{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5ODYyMzE4", "number": 6598, "title": "improve handling of UNC paths on Windows", "bodyText": "This PR fixes an issue where attempts to modify files within the home directory, when that directory is referenced with a UNC path, could fail.\nBackground: On Windows, while \\ is the canonical path separator, most Windows APIs still accept / and translate all forward slashes to backslashes behind the scenes. However, we do not normalize separators up-front when creating FilePath objects, and some Boost filesystem APIs are indeed sensitive to mismatched separators -- presumedly because \\ is a legal path component on POSIX.\nSo, when we accept and create FilePath objects, we create it with the underlying path as-is. On Windows, we probably should normalize separators (e.g. always use / or \\), but making that change is somewhat aggressive.\nSo, as a slightly smaller change, this PR instead:\n\n\nConverts separators explicitly within getRelativePath() via generic_path(), which converts \\ to /;\n\n\nChecks generic paths for equality within createAliasedPath(), as well.\n\n\nI believe we should consider backporting this to the v1.3 branch, because it fixes an issue that will be seen quite commonly when RStudio Desktop is used in Windows enterprise environments.\nWe may want to consider a more aggressive fix (always canonicalize path separators when creating FilePath objects) for v1.4, and any consequences of doing so.\nFixes #6587.", "createdAt": "2020-04-06T19:37:40Z", "url": "https://github.com/rstudio/rstudio/pull/6598", "merged": true, "mergeCommit": {"oid": "3bddf4bbab08341c66476cb1593066e5267efd47"}, "closed": true, "closedAt": "2020-04-07T16:44:38Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVDPxXAH2gAyMzk5ODYyMzE4OjNiN2RkZTVjMmYxNjE2MTk2MDhkZGI2NWNmMGFmZjJmMmUzZTcxMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVWEc-AFqTM4OTI5ODk4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b7dde5c2f161619608ddb65cf0aff2f2e3e7132", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/3b7dde5c2f161619608ddb65cf0aff2f2e3e7132", "committedDate": "2020-04-06T18:45:26Z", "message": "convert separators when computing relative path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "437f60e72d851975121a80158c93cd6ac735a1eb", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/437f60e72d851975121a80158c93cd6ac735a1eb", "committedDate": "2020-04-06T18:57:07Z", "message": "normalize separators when making aliased path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc31b57aca88e69bf6ab8721ec901316fc832ea0", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/bc31b57aca88e69bf6ab8721ec901316fc832ea0", "committedDate": "2020-04-06T18:57:17Z", "message": "make FilePath tests run on Windows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTYyMzY2", "url": "https://github.com/rstudio/rstudio/pull/6598#pullrequestreview-388562366", "createdAt": "2020-04-06T19:44:00Z", "commit": {"oid": "bc31b57aca88e69bf6ab8721ec901316fc832ea0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOTo0NDowMFrOGBnK6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOTo0NDowMFrOGBnK6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM0MzUyOA==", "bodyText": "Nit: these tests could still fail on anyone's local machine where the RStudio git drive isn't C:. This is really minor, but if there's a way to check the current drive letter, or maybe just compare against a regex (e.g. [A-Z]), or maybe by stripping ^[^:]+: from the start of the actual paths in the tests it could allow the tests to pass regardless of the drive name.", "url": "https://github.com/rstudio/rstudio/pull/6598#discussion_r404343528", "createdAt": "2020-04-06T19:44:00Z", "author": {"login": "MariaSemple"}, "path": "src/cpp/core/FilePathTests.cpp", "diffHunk": "@@ -13,15 +13,18 @@\n  *\n  */\n \n-// All of these tests presume Unix-style paths\n-#ifndef _WIN32\n-\n #define RSTUDIO_NO_TESTTHAT_ALIASES\n #include <tests/TestThat.hpp>\n \n #include <shared_core/Error.hpp>\n #include <shared_core/FilePath.hpp>\n \n+#ifdef _WIN32\n+# define kRootPrefix \"C:/\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc31b57aca88e69bf6ab8721ec901316fc832ea0"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fca3319400566caca111cf579879c8cec2429ab", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/2fca3319400566caca111cf579879c8cec2429ab", "committedDate": "2020-04-06T21:42:09Z", "message": "use same drive as current executable for tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NjQxMDcw", "url": "https://github.com/rstudio/rstudio/pull/6598#pullrequestreview-388641070", "createdAt": "2020-04-06T21:46:04Z", "commit": {"oid": "2fca3319400566caca111cf579879c8cec2429ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "298a02bd666d6f03751d5390e9a0e68d4143ede8", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/298a02bd666d6f03751d5390e9a0e68d4143ede8", "committedDate": "2020-04-06T21:46:37Z", "message": "tweaks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd7e24f769f3f69b07a975e90e187963e53369d5", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/dd7e24f769f3f69b07a975e90e187963e53369d5", "committedDate": "2020-04-06T21:47:48Z", "message": "tweak comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5Mjk4OTgw", "url": "https://github.com/rstudio/rstudio/pull/6598#pullrequestreview-389298980", "createdAt": "2020-04-07T16:41:16Z", "commit": {"oid": "dd7e24f769f3f69b07a975e90e187963e53369d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 320, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}