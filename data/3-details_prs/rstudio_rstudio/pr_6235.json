{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NTk5NTgz", "number": 6235, "title": "Fix global replace on Windows", "bodyText": "This PR fixes two bugs that caused global replace to not work on Windows and a bug that prevented the correct error message from being displayed when this happened.\nI updated the call to completeFileReplace to include an errorMessage set so it not only returns the system error, but also the errors we are using to send to the backend to be displayed in the Find in Files tab. With this the Windows error was properly displayed. The second issue is that the testWritePermissions function always failed on Windows after we opened inputStream_ (even though it's only used for reading) - to prevent this from happening I only call this function for the second time on non-Windows systems.", "createdAt": "2020-02-14T22:28:50Z", "url": "https://github.com/rstudio/rstudio/pull/6235", "merged": true, "mergeCommit": {"oid": "bd25d87eb0102702fe49d18ff8747c425fa85314"}, "closed": true, "closedAt": "2020-02-15T03:15:27Z", "author": {"login": "melissa-barca"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEWP5JgH2gAyMzc1NTk5NTgzOmIxNGU5ZWM3M2M0NmQ2ZTE4Y2E0NjQwMDE2MWFlYjMzNGU2YjEzYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEawf2gFqTM1OTI5ODE0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b14e9ec73c46d6e18ca46400161aeb334e6b13bf", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/b14e9ec73c46d6e18ca46400161aeb334e6b13bf", "committedDate": "2020-02-14T21:17:03Z", "message": "show error message if completeFileReplace fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "594c424949d499f42f92886d391ba2256f3e610c", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/594c424949d499f42f92886d391ba2256f3e610c", "committedDate": "2020-02-14T22:21:06Z", "message": "Do not perform final testWritePermissions on Windows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MjYwOTc5", "url": "https://github.com/rstudio/rstudio/pull/6235#pullrequestreview-359260979", "createdAt": "2020-02-14T22:45:50Z", "commit": {"oid": "594c424949d499f42f92886d391ba2256f3e610c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMjo0NTo1MFrOFqFucg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMjo0NTo1MFrOFqFucg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY3ODMyMg==", "bodyText": "I think we should wrap the whole test in the ifndef; the rest of the code is a guaranteed no-op on other platforms since there will never be an error.", "url": "https://github.com/rstudio/rstudio/pull/6235#discussion_r379678322", "createdAt": "2020-02-14T22:45:50Z", "author": {"login": "jmcphers"}, "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -517,17 +517,27 @@ class GrepOperation : public boost::enable_shared_from_this<GrepOperation>\n       }\n    }\n \n-   Error completeFileReplace()\n+   Error completeFileReplace(std::set<std::string>* pErrorMessage)\n    {\n       if (fileSuccess_)\n       {\n          if (!currentFile_.empty() &&\n              !tempReplaceFile_.getAbsolutePath().empty() &&\n              outputStream_->good())\n          {\n-            Error error = FilePath(currentFile_).testWritePermissions();\n+             Error error;\n+             // For Windows we ignore this additional safety check\n+             // it will always fail because we have inputStream_ reading the file\n+#ifndef _WIN32", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "594c424949d499f42f92886d391ba2256f3e610c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69ed8e500078f3cd854a3a725812d356dabc8e81", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/69ed8e500078f3cd854a3a725812d356dabc8e81", "committedDate": "2020-02-14T23:18:59Z", "message": "wrap full testWritePermissions test in ifndef, return errors if the move command fails"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Mjc2ODc0", "url": "https://github.com/rstudio/rstudio/pull/6235#pullrequestreview-359276874", "createdAt": "2020-02-14T23:43:35Z", "commit": {"oid": "69ed8e500078f3cd854a3a725812d356dabc8e81"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Mjk4MTQx", "url": "https://github.com/rstudio/rstudio/pull/6235#pullrequestreview-359298141", "createdAt": "2020-02-15T02:32:17Z", "commit": {"oid": "69ed8e500078f3cd854a3a725812d356dabc8e81"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 382, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}