{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNDYyOTAz", "number": 8226, "title": "handle UTF-8 paths when opening projects via API", "bodyText": "Intent\nWhen creating projects, users might specify paths using characters not representable in the current locale. To properly handle such paths, we need to ensure the paths are UTF-8 encoded.\nApproach\nMostly straightforward asString() -> asUtf8String(), as well as a workaround for the behavior of list.files() with UTF-8 paths.\nQA Notes\nTest via notes in #8225 and r-lib/usethis#1231.\nCloses #8225.", "createdAt": "2020-10-29T18:04:54Z", "url": "https://github.com/rstudio/rstudio/pull/8226", "merged": true, "mergeCommit": {"oid": "fa9f6dd450e410caf397325d0266b9d051b0da09"}, "closed": true, "closedAt": "2020-10-30T21:12:37Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXWFx1gH2gAyNTEyNDYyOTAzOjFlN2UwZjI2NTQwZTNlYjk3OThkYjI4MGM0ZGYxNTU3MjA2OWEwYTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXa0KYAH2gAyNTEyNDYyOTAzOmE4NjQzY2E3ZDQ2ODM4YjMwNTA1Njg4N2Q3YjExYjRjNDVkNzllMzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1e7e0f26540e3eb9798db280c4df15572069a0a8", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/1e7e0f26540e3eb9798db280c4df15572069a0a8", "committedDate": "2020-10-29T18:01:43Z", "message": "handle UTF-8 paths when opening projects via API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMTAwOTQ4", "url": "https://github.com/rstudio/rstudio/pull/8226#pullrequestreview-520100948", "createdAt": "2020-10-29T21:26:42Z", "commit": {"oid": "1e7e0f26540e3eb9798db280c4df15572069a0a8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMToyNjo0MlrOHqvV1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMToyNjo0MlrOHqvV1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU3Nzg3OQ==", "bodyText": "nit: should we do this in an on.exit so that an error condition doesn't leave the altered path as a side effect?", "url": "https://github.com/rstudio/rstudio/pull/8226#discussion_r514577879", "createdAt": "2020-10-29T21:26:42Z", "author": {"login": "jmcphers"}, "path": "src/cpp/r/R/Api.R", "diffHunk": "@@ -65,11 +65,14 @@\n    # attempt to initialize a project within that directory\n    .rs.ensureDirectory(path)\n    \n-   # check to see if a .Rproj file already exists in that directory;\n-   # if so, then we don't need to re-initialize\n-   rProjFiles <- list.files(path, \n-                            pattern = \"[.]Rproj$\",\n-                            full.names = TRUE)\n+   # NOTE: list.files() will fail on Windows for paths containing\n+   # characters not representable in the current locale, so we instead\n+   # change to the requested directory, list files, and then build the\n+   # full paths\n+   owd <- setwd(path)\n+   rProjFiles <- list.files(pattern = \"[.]Rproj$\")\n+   rProjFiles <- normalizePath(rProjFiles, winslash = \"/\", mustWork = TRUE)\n+   setwd(owd)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e7e0f26540e3eb9798db280c4df15572069a0a8"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8643ca7d46838b305056887d7b11b4c45d79e37", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/a8643ca7d46838b305056887d7b11b4c45d79e37", "committedDate": "2020-10-29T23:32:00Z", "message": "use on.exit() to ensure working directory restored"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4954, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}