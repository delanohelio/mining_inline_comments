{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MjM3NzE0", "number": 6849, "reviewThreads": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyNToyOFrOD8JJYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyMzoyMlrOD8L0-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MzkxMDExOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyNToyOFrOGU5szw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODozNTo1NVrOGU-kxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3MDA2Mw==", "bodyText": "update file copyright year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424570063", "createdAt": "2020-05-13T16:25:28Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java", "diffHunk": "@@ -120,6 +120,11 @@ public DocTabLayoutPanel(boolean closeableTabs,\n       events_.addHandler(DocTabDragStartedEvent.TYPE, dragManager_);\n       commands_ = RStudioGinjector.INSTANCE.getCommands();\n \n+   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0OTkyNg==", "bodyText": "Done.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424649926", "createdAt": "2020-05-13T18:35:55Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java", "diffHunk": "@@ -120,6 +120,11 @@ public DocTabLayoutPanel(boolean closeableTabs,\n       events_.addHandler(DocTabDragStartedEvent.TYPE, dragManager_);\n       commands_ = RStudioGinjector.INSTANCE.getCommands();\n \n+   }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3MDA2Mw=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MzkyNjg5OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/application/Application.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyOTo0NVrOGU53rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODozOTo0OVrOGU-tbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3Mjg0Nw==", "bodyText": "Can you elaborate on how/why this might be? Maybe it's obvious as I read more of the code.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424572847", "createdAt": "2020-05-13T16:29:45Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/application/Application.java", "diffHunk": "@@ -206,7 +207,18 @@ public void run()\n             MathJaxLoader.ensureMathJaxLoaded();\n \n             // initialize workbench\n-            initializeWorkbench();\n+            // refresh prefs incase they were loaded without sessionInfo", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1MjE0Mg==", "bodyText": "This happens exclusively in desktop mode, I was able to track down the issue enough to find that userPrefs were being loaded before sessionInfo but couldn't find when this was happening or if it was truly necessary. I updated the comment with that clarification.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424652142", "createdAt": "2020-05-13T18:39:49Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/application/Application.java", "diffHunk": "@@ -206,7 +207,18 @@ public void run()\n             MathJaxLoader.ensureMathJaxLoaded();\n \n             // initialize workbench\n-            initializeWorkbench();\n+            // refresh prefs incase they were loaded without sessionInfo", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3Mjg0Nw=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0Mzk1NDEwOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/application/Application.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjozNjozM1rOGU6I5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo0Njo0MlrOGU-9rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3NzI1Mg==", "bodyText": "Using lambdas you can tidy this up to:\n            userState_.get().writeState(boolArg ->\n            {\n               userPrefs_.get().writeUserPrefs(boolArg1 ->\n               {\n                     initializeWorkbench();\n               });\n            });\n         }\n\nYou could drop the braces and make it more compact, but I personally find that harder to read especially when there are multiple lambda happening at once (but that's just me):\n            userState_.get().writeState(boolArg ->\n               userPrefs_.get().writeUserPrefs(boolArg1 ->\n                  initializeWorkbench()));", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424577252", "createdAt": "2020-05-13T16:36:33Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/application/Application.java", "diffHunk": "@@ -206,7 +207,18 @@ public void run()\n             MathJaxLoader.ensureMathJaxLoaded();\n \n             // initialize workbench\n-            initializeWorkbench();\n+            // refresh prefs incase they were loaded without sessionInfo\n+            userState_.get().writeState(\n+                  new CommandWithArg<Boolean>() {\n+                     public void execute(Boolean arg) {\n+                        userPrefs_.get().writeUserPrefs(\n+                              new CommandWithArg<Boolean>() {\n+                                 public void execute(Boolean arg) {\n+                                    initializeWorkbench();\n+                                 }\n+                              });\n+                        }\n+                  });\n          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1NjMwMQ==", "bodyText": "Thanks, I left the braces.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424656301", "createdAt": "2020-05-13T18:46:42Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/application/Application.java", "diffHunk": "@@ -206,7 +207,18 @@ public void run()\n             MathJaxLoader.ensureMathJaxLoaded();\n \n             // initialize workbench\n-            initializeWorkbench();\n+            // refresh prefs incase they were loaded without sessionInfo\n+            userState_.get().writeState(\n+                  new CommandWithArg<Boolean>() {\n+                     public void execute(Boolean arg) {\n+                        userPrefs_.get().writeUserPrefs(\n+                              new CommandWithArg<Boolean>() {\n+                                 public void execute(Boolean arg) {\n+                                    initializeWorkbench();\n+                                 }\n+                              });\n+                        }\n+                  });\n          }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3NzI1Mg=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0Mzk3MTY4OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo0MTowOFrOGU6Ugw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo0MDoxOVrOGU-uqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MDIyNw==", "bodyText": "update file copyright year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424580227", "createdAt": "2020-05-13T16:41:08Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java", "diffHunk": "@@ -65,7 +65,6 @@\n import org.rstudio.studio.client.workbench.prefs.events.UserPrefsChangedEvent;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1MjQ1Nw==", "bodyText": "Done", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424652457", "createdAt": "2020-05-13T18:40:19Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java", "diffHunk": "@@ -65,7 +65,6 @@\n import org.rstudio.studio.client.workbench.prefs.events.UserPrefsChangedEvent;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MDIyNw=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0Mzk4MDQ3OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/viewer/ViewerPresenter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo0MzoyOVrOGU6aRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo0MzoyOVrOGU6aRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MTcwMQ==", "bodyText": "update file copyright year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424581701", "createdAt": "2020-05-13T16:43:29Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/viewer/ViewerPresenter.java", "diffHunk": "@@ -63,7 +63,6 @@\n import org.rstudio.studio.client.workbench.prefs.model.UserState;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0Mzk5MzM0OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserState.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo0Njo1M1rOGU6ijQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo0Njo1M1rOGU6ijQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MzgyMQ==", "bodyText": "update file copyright year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424583821", "createdAt": "2020-05-13T16:46:53Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserState.java", "diffHunk": "@@ -18,6 +18,7 @@\n import com.google.inject.Inject;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDAwODY3OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1MDo0MlrOGU6sQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1MDo0MlrOGU6sQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NjMwNg==", "bodyText": "not needed", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424586306", "createdAt": "2020-05-13T16:50:42Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java", "diffHunk": "@@ -23,7 +23,9 @@\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n+import com.google.gwt.core.client.JsArrayString;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDAwOTIzOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1MDo0OFrOGU6snA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1MDo0OFrOGU6snA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NjM5Ng==", "bodyText": "not needed", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424586396", "createdAt": "2020-05-13T16:50:48Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java", "diffHunk": "@@ -23,7 +23,9 @@\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n+import com.google.gwt.core.client.JsArrayString;\n import com.google.gwt.core.client.JsArray;\n+import org.rstudio.core.client.JsArrayUtil;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDAxMjE3OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1MTo0MFrOGU6umQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1MTo0MFrOGU6umQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NjkwNQ==", "bodyText": "delete this extra line", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424586905", "createdAt": "2020-05-13T16:51:40Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -277,6 +279,7 @@ public PaneManager(Provider<MainSplitPanel> pSplitPanel,\n       left_ = createSplitWindow(panes_.get(0), panes_.get(1), LEFT_COLUMN, 0.4, splitterSize);\n       right_ = createSplitWindow(panes_.get(2), panes_.get(3), RIGHT_COLUMN, 0.6, splitterSize);\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDAxMzc0OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1MjoxMVrOGU6vrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1MjoxMVrOGU6vrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NzE4MQ==", "bodyText": "update file copyright year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424587181", "createdAt": "2020-05-13T16:52:11Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "diffHunk": "@@ -64,7 +64,7 @@\n import org.rstudio.studio.client.workbench.views.console.events.WorkingDirChangedHandler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDAzMjgyOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1NzoyNFrOGU68pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo0OToyMVrOGU_DrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5MDUwMw==", "bodyText": "While you're touching this... could be lambda-fied. Braces and newlines as you see fit:\n      source_.withSaveFilesBeforeCommand(() ->\n      {\n         withDevtoolsLoadAllPath(loadAllPath ->\n         {\n            sendLoadCommandToConsole(\"devtools::load_all(\\\"\" + loadAllPath + \"\\\")\");\n         });\n      }, () -> {}, \"Build\");", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424590503", "createdAt": "2020-05-13T16:57:24Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "diffHunk": "@@ -309,7 +309,7 @@ void onBuildAll()\n    \n    void onDevtoolsLoadAll()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1NzgzNg==", "bodyText": "Done.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424657836", "createdAt": "2020-05-13T18:49:21Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "diffHunk": "@@ -309,7 +309,7 @@ void onBuildAll()\n    \n    void onDevtoolsLoadAll()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5MDUwMw=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDA0MDU3OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1OToxOVrOGU7Bpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjo1OToxOVrOGU7Bpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5MTc4Mw==", "bodyText": "Another lambda-ing opportunity:\n      source_.withSaveFilesBeforeCommand(() ->\n      {\n         server_.startBuild(type, subType, new SimpleRequestCallback<Boolean>() {\n            @Override\n            public void onResponseReceived(Boolean response)\n            {\n            }\n\n            @Override\n            public void onError(ServerError error)\n            {\n               super.onError(error);\n               workbenchContext_.setBuildInProgress(false);\n            }\n         });\n      }, () -> {}, \"Build\");", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424591783", "createdAt": "2020-05-13T16:59:19Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "diffHunk": "@@ -442,7 +448,13 @@ public void onError(ServerError error)\n \n             });\n          }\n-      }, \"Build\");\n+      },\n+      new Command() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDA1Nzk3OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzowNDowNlrOGU7NIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzowNDowNlrOGU7NIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5NDcyMA==", "bodyText": "update file copyright year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424594720", "createdAt": "2020-05-13T17:04:06Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java", "diffHunk": "@@ -83,7 +83,6 @@\n import org.rstudio.studio.client.workbench.views.environment.model.RObject;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDA2MTA2OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzowNDo1OVrOGU7PNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzowNDo1OVrOGU7PNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5NTI1Mw==", "bodyText": "not used", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424595253", "createdAt": "2020-05-13T17:04:59Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -14,6 +14,7 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n+import com.google.gwt.core.client.GWT;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDA3NDM1OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzowOTowMlrOGU7YRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMToyMzoxOVrOGVEB2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5NzU3NQ==", "bodyText": "Doesn't this trigger an infinite recursive loop? (onNewDocumentWithCode calling itself?).", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424597575", "createdAt": "2020-05-13T17:09:02Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -409,40 +413,48 @@ public Source(Commands commands,\n          command.setVisible(false);\n          command.setEnabled(false);\n       }\n-\n-      // fake shortcuts for commands which we handle at a lower level\n-      commands.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n-      commands.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n-\n-      // If tab has been disabled for auto complete by the user, set the \"shortcut\" to ctrl-space instead.\n-      if (userPrefs_.tabCompletion().getValue() && !userPrefs_.tabKeyMoveFocus().getValue())\n-         commands.codeCompletion().setShortcut(new KeyboardShortcut(\"Tab\", KeyCodes.KEY_TAB, KeyboardShortcut.NONE));\n-      else\n-      {\n-         KeySequence sequence = new KeySequence();\n-         sequence.add(new KeyCombination(\"Ctrl+Space\", KeyCodes.KEY_SPACE, KeyCodes.KEY_CTRL));\n-         commands.codeCompletion().setShortcut(new KeyboardShortcut(sequence));\n-      }\n-      \n-      events.addHandler(ShowContentEvent.TYPE, this);\n-      events.addHandler(ShowDataEvent.TYPE, this);\n-      events.addHandler(OpenObjectExplorerEvent.TYPE, this);\n-\n-      events.addHandler(CodeBrowserNavigationEvent.TYPE, this);\n       \n-      events.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n+      vimCommands_ = new SourceVimCommands();\n \n-      events.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n+      view_.addTabClosingHandler(this);\n+      view_.addTabCloseHandler(this);\n+      view_.addTabClosedHandler(this);\n+      view_.addTabReorderHandler(this);\n+      view_.addSelectionHandler(this);\n+      view_.addBeforeShowHandler(this);\n \n-      events.addHandler(FileTypeChangedEvent.TYPE, new FileTypeChangedHandler()\n+      events_.addHandler(EditPresentationSourceEvent.TYPE, this);\n+      events_.addHandler(FileEditEvent.TYPE, this);\n+      events_.addHandler(InsertSourceEvent.TYPE, this);\n+      events_.addHandler(ShowContentEvent.TYPE, this);\n+      events_.addHandler(ShowDataEvent.TYPE, this);\n+      events_.addHandler(OpenObjectExplorerEvent.TYPE, this);\n+      events_.addHandler(OpenPresentationSourceFileEvent.TYPE, this);\n+      events_.addHandler(OpenSourceFileEvent.TYPE, this);\n+      events_.addHandler(CodeBrowserNavigationEvent.TYPE, this);\n+      events_.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n+      events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n+      events_.addHandler(SnippetsChangedEvent.TYPE, this);\n+      events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n+\n+      events_.addHandler(FileTypeChangedEvent.TYPE, new FileTypeChangedHandler()\n       {\n          public void onFileTypeChanged(FileTypeChangedEvent event)\n          {\n             manageCommands();\n          }\n       });\n       \n-      events.addHandler(SourceOnSaveChangedEvent.TYPE, \n+      events_.addHandler(NewDocumentWithCodeEvent.TYPE,\n+                         new NewDocumentWithCodeEvent.Handler() {\n+         @Override\n+         public void onNewDocumentWithCode(NewDocumentWithCodeEvent event)\n+         {\n+            onNewDocumentWithCode(event);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 221}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczOTI5MQ==", "bodyText": "You're right and we've already added the handler on +438 so I've removed this.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424739291", "createdAt": "2020-05-13T21:23:19Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -409,40 +413,48 @@ public Source(Commands commands,\n          command.setVisible(false);\n          command.setEnabled(false);\n       }\n-\n-      // fake shortcuts for commands which we handle at a lower level\n-      commands.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n-      commands.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n-\n-      // If tab has been disabled for auto complete by the user, set the \"shortcut\" to ctrl-space instead.\n-      if (userPrefs_.tabCompletion().getValue() && !userPrefs_.tabKeyMoveFocus().getValue())\n-         commands.codeCompletion().setShortcut(new KeyboardShortcut(\"Tab\", KeyCodes.KEY_TAB, KeyboardShortcut.NONE));\n-      else\n-      {\n-         KeySequence sequence = new KeySequence();\n-         sequence.add(new KeyCombination(\"Ctrl+Space\", KeyCodes.KEY_SPACE, KeyCodes.KEY_CTRL));\n-         commands.codeCompletion().setShortcut(new KeyboardShortcut(sequence));\n-      }\n-      \n-      events.addHandler(ShowContentEvent.TYPE, this);\n-      events.addHandler(ShowDataEvent.TYPE, this);\n-      events.addHandler(OpenObjectExplorerEvent.TYPE, this);\n-\n-      events.addHandler(CodeBrowserNavigationEvent.TYPE, this);\n       \n-      events.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n+      vimCommands_ = new SourceVimCommands();\n \n-      events.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n+      view_.addTabClosingHandler(this);\n+      view_.addTabCloseHandler(this);\n+      view_.addTabClosedHandler(this);\n+      view_.addTabReorderHandler(this);\n+      view_.addSelectionHandler(this);\n+      view_.addBeforeShowHandler(this);\n \n-      events.addHandler(FileTypeChangedEvent.TYPE, new FileTypeChangedHandler()\n+      events_.addHandler(EditPresentationSourceEvent.TYPE, this);\n+      events_.addHandler(FileEditEvent.TYPE, this);\n+      events_.addHandler(InsertSourceEvent.TYPE, this);\n+      events_.addHandler(ShowContentEvent.TYPE, this);\n+      events_.addHandler(ShowDataEvent.TYPE, this);\n+      events_.addHandler(OpenObjectExplorerEvent.TYPE, this);\n+      events_.addHandler(OpenPresentationSourceFileEvent.TYPE, this);\n+      events_.addHandler(OpenSourceFileEvent.TYPE, this);\n+      events_.addHandler(CodeBrowserNavigationEvent.TYPE, this);\n+      events_.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n+      events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n+      events_.addHandler(SnippetsChangedEvent.TYPE, this);\n+      events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n+\n+      events_.addHandler(FileTypeChangedEvent.TYPE, new FileTypeChangedHandler()\n       {\n          public void onFileTypeChanged(FileTypeChangedEvent event)\n          {\n             manageCommands();\n          }\n       });\n       \n-      events.addHandler(SourceOnSaveChangedEvent.TYPE, \n+      events_.addHandler(NewDocumentWithCodeEvent.TYPE,\n+                         new NewDocumentWithCodeEvent.Handler() {\n+         @Override\n+         public void onNewDocumentWithCode(NewDocumentWithCodeEvent event)\n+         {\n+            onNewDocumentWithCode(event);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5NzU3NQ=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 221}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDEwODMzOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoxODoyMlrOGU7t-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoxODoyMlrOGU7t-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwMzEzMA==", "bodyText": "extra whitespace", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424603130", "createdAt": "2020-05-13T17:18:22Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -464,15 +476,15 @@ public void onSwitchToDoc(SwitchToDocEvent event)\n          }\n       });\n \n-      events.addHandler(SourceFileSavedEvent.TYPE, new SourceFileSavedHandler()\n+      events_.addHandler(SourceFileSavedEvent.TYPE, new SourceFileSavedHandler()\n       {\n          public void onSourceFileSaved(SourceFileSavedEvent event)\n          {\n             pMruList_.get().add(event.getPath());\n          }\n       });\n-      \n-      events.addHandler(SourcePathChangedEvent.TYPE, \n+         ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 252}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDEwOTI3OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoxODozMlrOGU7ugA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoxODozMlrOGU7ugA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwMzI2NA==", "bodyText": "extra whitespace", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424603264", "createdAt": "2020-05-13T17:18:32Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -518,8 +530,8 @@ public void onSourceNavigation(SourceNavigationEvent event)\n          }\n       });\n       \n-      events.addHandler(SourceExtendedTypeDetectedEvent.TYPE, this);\n-      \n+      events_.addHandler(SourceExtendedTypeDetectedEvent.TYPE, this);\n+         ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 273}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDExNjgwOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyMDoyNFrOGU7zEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOTozODowNFrOGVAtOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNDQzMg==", "bodyText": "Why is this added here?", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424604432", "createdAt": "2020-05-13T17:20:24Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -688,14 +727,61 @@ else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDIN\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         openProjectDocs(session);\n+         openProjectDocs(session_);\n          openEditPublishedDocs();\n       }\n       \n       // add vim commands\n       initVimCommands();\n+      ensureVisible(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 441}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY4NDg1Ng==", "bodyText": "Original thought process was that at this point we don't need to be visible but there's no need to ensure it so I've removed.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424684856", "createdAt": "2020-05-13T19:38:04Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -688,14 +727,61 @@ else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDIN\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         openProjectDocs(session);\n+         openProjectDocs(session_);\n          openEditPublishedDocs();\n       }\n       \n       // add vim commands\n       initVimCommands();\n+      ensureVisible(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNDQzMg=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 441}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDEyMDg1OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyMToyNVrOGU71jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOTozNjo1MVrOGVAqnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNTA3MA==", "bodyText": "Brief JavaDoc comment about method's purpose would be good.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424605070", "createdAt": "2020-05-13T17:21:25Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -688,14 +727,61 @@ else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDIN\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         openProjectDocs(session);\n+         openProjectDocs(session_);\n          openEditPublishedDocs();\n       }\n       \n       // add vim commands\n       initVimCommands();\n+      ensureVisible(false);\n    }\n    \n+   public void withSaveFilesBeforeCommand(final Command command,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 444}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY4NDE4OQ==", "bodyText": "Added.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424684189", "createdAt": "2020-05-13T19:36:51Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -688,14 +727,61 @@ else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDIN\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         openProjectDocs(session);\n+         openProjectDocs(session_);\n          openEditPublishedDocs();\n       }\n       \n       // add vim commands\n       initVimCommands();\n+      ensureVisible(false);\n    }\n    \n+   public void withSaveFilesBeforeCommand(final Command command,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNTA3MA=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 444}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDEzMjYwOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyNDozNlrOGU79HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyNDozNlrOGU79HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNzAwNA==", "bodyText": "lambda:\n            new UnsavedChangesDialog(\n                  commandSource,\n                  alwaysSaveOption,\n                  unsavedSourceDocs,\n                  dialogResult ->\n                  {\n                     if (dialogResult.getAlwaysSave())\n                     {\n                        userPrefs_.saveFilesBeforeBuild().setGlobalValue(true);\n                        userPrefs_.writeUserPrefs();\n                     }\n   \n                     handleUnsavedChangesBeforeExit(\n                                           dialogResult.getSaveTargets(),\n                                           command);\n   \n                  },\n                  cancelCommand\n            ).showModal();", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424607004", "createdAt": "2020-05-13T17:24:36Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -688,14 +727,61 @@ else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDIN\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         openProjectDocs(session);\n+         openProjectDocs(session_);\n          openEditPublishedDocs();\n       }\n       \n       // add vim commands\n       initVimCommands();\n+      ensureVisible(false);\n    }\n    \n+   public void withSaveFilesBeforeCommand(final Command command,\n+                                          final Command cancelCommand,\n+                                          String commandSource)\n+   {\n+      if (userPrefs_.saveFilesBeforeBuild().getValue())\n+      {\n+         saveUnsavedDocuments(command);\n+      }\n+      else\n+      {\n+         String alwaysSaveOption = !userPrefs_.saveFilesBeforeBuild().getValue() ?\n+                                    \"Always save files before build\" : null;\n+\n+         ArrayList<UnsavedChangesTarget> unsavedSourceDocs = getUnsavedChanges(TYPE_FILE_BACKED);\n+\n+         if (unsavedSourceDocs.size() > 0)\n+         {\n+            new UnsavedChangesDialog(\n+                  commandSource,\n+                  alwaysSaveOption,\n+                  unsavedSourceDocs,\n+                  new OperationWithInput<UnsavedChangesDialog.Result>() {\n+                     public void execute(UnsavedChangesDialog.Result result)\n+                     {\n+                        if (result.getAlwaysSave())\n+                        {\n+                           userPrefs_.saveFilesBeforeBuild().setGlobalValue(true);\n+                           userPrefs_.writeUserPrefs();\n+                        }\n+\n+                        handleUnsavedChangesBeforeExit(\n+                                              result.getSaveTargets(),\n+                                              command);\n+\n+                     }\n+                   },\n+                   cancelCommand\n+            ).showModal();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 481}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDE0MzE5OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyNzoxNlrOGU8Dhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyNzoxNlrOGU8Dhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwODY0Nw==", "bodyText": "Reduce this whole method to:\n public Command revertUnsavedChangesBeforeExitCommand(final Command onCompleted)\n   {\n      return () -> handleUnsavedChangesBeforeExit(new ArrayList<>(), onCompleted);\n   }", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424608647", "createdAt": "2020-05-13T17:27:16Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -2577,6 +2662,21 @@ public void saveWithPrompt(UnsavedChangesTarget target,\n          editingTarget.saveWithPrompt(onCompleted, onCancelled);\n    }\n    \n+   public Command revertUnsavedChangesBeforeExitCommand(\n+                                               final Command onCompleted)\n+   {\n+      return new Command()\n+      {\n+         @Override\n+         public void execute()\n+         {\n+            handleUnsavedChangesBeforeExit(\n+                                 new ArrayList<UnsavedChangesTarget>(),\n+                                 onCompleted);\n+         }\n+\n+      };\n+   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 607}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDE0OTk2OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatellitePresenter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyODo1OFrOGU8HpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyODo1OFrOGU8HpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwOTcwMQ==", "bodyText": "update file copyright year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424609701", "createdAt": "2020-05-13T17:28:58Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatellitePresenter.java", "diffHunk": "@@ -29,7 +29,7 @@\n    {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDE1MTcxOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatelliteWindow.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyOToyNlrOGU8Ipg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyOToyNlrOGU8Ipg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwOTk1OA==", "bodyText": "update file copyright year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424609958", "createdAt": "2020-05-13T17:29:26Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatelliteWindow.java", "diffHunk": "@@ -49,6 +49,7 @@ public SourceSatelliteWindow(Provider<EventBus> pEventBus,\n                                 Provider<SourceWindow> pSourceWindow,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDE1OTUyOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindow.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzozMToxOFrOGU8NUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzozMToxOFrOGU8NUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMTE1NQ==", "bodyText": "update file copyright year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424611155", "createdAt": "2020-05-13T17:31:18Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindow.java", "diffHunk": "@@ -69,12 +69,12 @@ public SourceWindow(\n          Provider<DesktopHooks> pDesktopHooks,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDE2MzY4OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzozMjoyNFrOGU8P8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzozMjoyNFrOGU8P8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMTgyNA==", "bodyText": "update file header year", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424611824", "createdAt": "2020-05-13T17:32:24Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java", "diffHunk": "@@ -102,7 +102,7 @@ public SourceWindowManager(\n          EventBus events,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDE2OTEzOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzozMzo1NVrOGU8Teg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzozMzo1NVrOGU8Teg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMjczMA==", "bodyText": "labmda: () -> {}", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424612730", "createdAt": "2020-05-13T17:33:55Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "diffHunk": "@@ -5574,24 +5574,36 @@ public void execute()\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      },\n+      new Command() {\n+         public void execute()\n+         {\n+         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDE3MDAzOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzozNDoxMVrOGU8UHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzozNDoxMVrOGU8UHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMjg5Mg==", "bodyText": "lambda: () -> {}", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424612892", "createdAt": "2020-05-13T17:34:11Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "diffHunk": "@@ -5574,24 +5574,36 @@ public void execute()\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      },\n+      new Command() {\n+         public void execute()\n+         {\n+         }\n+      },\n+      \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      },\n+      new Command() {\n+         public void execute()\n+         {\n+         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDMyNDI1OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoxNjozN1rOGU93Og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMzowODozMFrOGVGmAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzODI2Ng==", "bodyText": "This might not be safe -- if I understand correctly, this call will load Ace concurrently, but it seems like since we're about to initialize tabs (which might require Ace to be available) we would want to ensure Ace has really been loaded.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424638266", "createdAt": "2020-05-13T18:16:37Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -586,17 +598,57 @@ public void onNewWorkingCopy(NewWorkingCopyEvent event)\n          }\n       });\n       \n-      events.addHandler(PopoutDocEvent.TYPE, this);\n-      events.addHandler(DocWindowChangedEvent.TYPE, this);\n-      events.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n-      events.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n-      events.addHandler(DebugModeChangedEvent.TYPE, this);\n-      events.addHandler(ReplaceRangesEvent.TYPE, this);\n-      events.addHandler(GetEditorContextEvent.TYPE, this);\n-      events.addHandler(SetSelectionRangesEvent.TYPE, this);\n-      events.addHandler(OpenProfileEvent.TYPE, this);\n-      events.addHandler(RequestDocumentSaveEvent.TYPE, this);\n-      events.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      events_.addHandler(PopoutDocEvent.TYPE, this);\n+      events_.addHandler(DocWindowChangedEvent.TYPE, this);\n+      events_.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n+      events_.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n+      events_.addHandler(DebugModeChangedEvent.TYPE, this);\n+      events_.addHandler(ReplaceRangesEvent.TYPE, this);\n+      events_.addHandler(GetEditorContextEvent.TYPE, this);\n+      events_.addHandler(SetSelectionRangesEvent.TYPE, this);\n+      events_.addHandler(OpenProfileEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentSaveEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      \n+      initialized_ = true;\n+   }\n+\n+   public void loadFullSource()\n+   {\n+      AceEditor.preload();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 349}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc4MTMxNQ==", "bodyText": "Good catch. I updated the code with a new method that loads Ace and calls loadFullSource (now private) in its callback.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424781315", "createdAt": "2020-05-13T23:08:30Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -586,17 +598,57 @@ public void onNewWorkingCopy(NewWorkingCopyEvent event)\n          }\n       });\n       \n-      events.addHandler(PopoutDocEvent.TYPE, this);\n-      events.addHandler(DocWindowChangedEvent.TYPE, this);\n-      events.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n-      events.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n-      events.addHandler(DebugModeChangedEvent.TYPE, this);\n-      events.addHandler(ReplaceRangesEvent.TYPE, this);\n-      events.addHandler(GetEditorContextEvent.TYPE, this);\n-      events.addHandler(SetSelectionRangesEvent.TYPE, this);\n-      events.addHandler(OpenProfileEvent.TYPE, this);\n-      events.addHandler(RequestDocumentSaveEvent.TYPE, this);\n-      events.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      events_.addHandler(PopoutDocEvent.TYPE, this);\n+      events_.addHandler(DocWindowChangedEvent.TYPE, this);\n+      events_.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n+      events_.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n+      events_.addHandler(DebugModeChangedEvent.TYPE, this);\n+      events_.addHandler(ReplaceRangesEvent.TYPE, this);\n+      events_.addHandler(GetEditorContextEvent.TYPE, this);\n+      events_.addHandler(SetSelectionRangesEvent.TYPE, this);\n+      events_.addHandler(OpenProfileEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentSaveEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      \n+      initialized_ = true;\n+   }\n+\n+   public void loadFullSource()\n+   {\n+      AceEditor.preload();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzODI2Ng=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 349}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDMzMDAwOnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoxODowNVrOGU962w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo0Mjo0N1rOGU-0qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzOTE5NQ==", "bodyText": "nit: method name should be camelCase?", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424639195", "createdAt": "2020-05-13T18:18:05Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java", "diffHunk": "@@ -100,6 +100,7 @@ public void writeUserPrefs()\n \n    public void writeUserPrefs(CommandWithArg<Boolean> onCompleted)\n    {\n+      UpdatePrefs(session_.getSessionInfo().getPrefs());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0MTA1OQ==", "bodyText": "(realize this is a pre-existing method but maybe worth changing while you're working with this code)", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424641059", "createdAt": "2020-05-13T18:21:09Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java", "diffHunk": "@@ -100,6 +100,7 @@ public void writeUserPrefs()\n \n    public void writeUserPrefs(CommandWithArg<Boolean> onCompleted)\n    {\n+      UpdatePrefs(session_.getSessionInfo().getPrefs());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzOTE5NQ=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1Mzk5Mg==", "bodyText": "Done.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424653992", "createdAt": "2020-05-13T18:42:47Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java", "diffHunk": "@@ -100,6 +100,7 @@ public void writeUserPrefs()\n \n    public void writeUserPrefs(CommandWithArg<Boolean> onCompleted)\n    {\n+      UpdatePrefs(session_.getSessionInfo().getPrefs());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzOTE5NQ=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDM0OTM4OnYy", "diffSide": "RIGHT", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyMzoyMlrOGU-HMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTowNDoyM1rOGVDdtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0MjM1NA==", "bodyText": "Can we document the intent here? (why do we need to fire this \"empty\" DocTabsChangedEvent?)", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424642354", "createdAt": "2020-05-13T18:23:22Z", "author": {"login": "kevinushey"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -586,17 +598,57 @@ public void onNewWorkingCopy(NewWorkingCopyEvent event)\n          }\n       });\n       \n-      events.addHandler(PopoutDocEvent.TYPE, this);\n-      events.addHandler(DocWindowChangedEvent.TYPE, this);\n-      events.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n-      events.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n-      events.addHandler(DebugModeChangedEvent.TYPE, this);\n-      events.addHandler(ReplaceRangesEvent.TYPE, this);\n-      events.addHandler(GetEditorContextEvent.TYPE, this);\n-      events.addHandler(SetSelectionRangesEvent.TYPE, this);\n-      events.addHandler(OpenProfileEvent.TYPE, this);\n-      events.addHandler(RequestDocumentSaveEvent.TYPE, this);\n-      events.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      events_.addHandler(PopoutDocEvent.TYPE, this);\n+      events_.addHandler(DocWindowChangedEvent.TYPE, this);\n+      events_.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n+      events_.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n+      events_.addHandler(DebugModeChangedEvent.TYPE, this);\n+      events_.addHandler(ReplaceRangesEvent.TYPE, this);\n+      events_.addHandler(GetEditorContextEvent.TYPE, this);\n+      events_.addHandler(SetSelectionRangesEvent.TYPE, this);\n+      events_.addHandler(OpenProfileEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentSaveEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      \n+      initialized_ = true;\n+   }\n+\n+   public void loadFullSource()\n+   {\n+      AceEditor.preload();\n+\n+      // sync UI prefs with shortcut manager\n+      userPrefs_ = RStudioGinjector.INSTANCE.getUserPrefs();\n+\n+      if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDINGS_VIM)\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_VIM);\n+      else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDINGS_EMACS)\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_EMACS);\n+      else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDINGS_SUBLIME)\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_SUBLIME);\n+      else\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_DEFAULT);\n+   \n+      events_.fireEvent(new DocTabsChangedEvent(null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 363}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczMDAzOA==", "bodyText": "IIRC this code is needed for future work when we have multiple source columns. I've removed it from this branch and added a comment to the other to document it.", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424730038", "createdAt": "2020-05-13T21:04:23Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -586,17 +598,57 @@ public void onNewWorkingCopy(NewWorkingCopyEvent event)\n          }\n       });\n       \n-      events.addHandler(PopoutDocEvent.TYPE, this);\n-      events.addHandler(DocWindowChangedEvent.TYPE, this);\n-      events.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n-      events.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n-      events.addHandler(DebugModeChangedEvent.TYPE, this);\n-      events.addHandler(ReplaceRangesEvent.TYPE, this);\n-      events.addHandler(GetEditorContextEvent.TYPE, this);\n-      events.addHandler(SetSelectionRangesEvent.TYPE, this);\n-      events.addHandler(OpenProfileEvent.TYPE, this);\n-      events.addHandler(RequestDocumentSaveEvent.TYPE, this);\n-      events.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      events_.addHandler(PopoutDocEvent.TYPE, this);\n+      events_.addHandler(DocWindowChangedEvent.TYPE, this);\n+      events_.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n+      events_.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n+      events_.addHandler(DebugModeChangedEvent.TYPE, this);\n+      events_.addHandler(ReplaceRangesEvent.TYPE, this);\n+      events_.addHandler(GetEditorContextEvent.TYPE, this);\n+      events_.addHandler(SetSelectionRangesEvent.TYPE, this);\n+      events_.addHandler(OpenProfileEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentSaveEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      \n+      initialized_ = true;\n+   }\n+\n+   public void loadFullSource()\n+   {\n+      AceEditor.preload();\n+\n+      // sync UI prefs with shortcut manager\n+      userPrefs_ = RStudioGinjector.INSTANCE.getUserPrefs();\n+\n+      if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDINGS_VIM)\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_VIM);\n+      else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDINGS_EMACS)\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_EMACS);\n+      else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDINGS_SUBLIME)\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_SUBLIME);\n+      else\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_DEFAULT);\n+   \n+      events_.fireEvent(new DocTabsChangedEvent(null,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0MjM1NA=="}, "originalCommit": {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb"}, "originalPosition": 363}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3957, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}