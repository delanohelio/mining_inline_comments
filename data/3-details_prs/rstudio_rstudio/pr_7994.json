{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MzcxOTk1", "number": 7994, "title": "Open source doc in new column", "bodyText": "Intent\nAllow user to open a document in a new column, rather than columns always opening with a blank doc. This is based on #7920.\nApproach\nI added a new command openSourceDocNewColumn that mimics the existing openSourceDoc command. When opening the file chooser the command creates a new column and sets it to the active column, when the user selects a file the process is the same as with openSourceDoc where the file is opened in the active column. If the user cancels out of the file chooser, the new column is removed.\nI looked into what it would take to open files in a new columns from the Files Pane and it ends up being more complicated as it revolves around open file events which differ between file types. I implemented being able to Shift+Click a file to open it in a new column on a separate branch but ultimately decided that feature is too risky for this to make it into 1.4.\nI also included some general code clean up (removed unused functions and parameters, fixed spacing)\nQA Notes\nYou should be able to open any file type in a new column, but there should only ever be three columns open at a time. An error will be displayed if the user attempts to open a fourth column.", "createdAt": "2020-10-07T16:25:11Z", "url": "https://github.com/rstudio/rstudio/pull/7994", "merged": true, "mergeCommit": {"oid": "4e97d89747bc46f815663b860e808a66e1cd63ee"}, "closed": true, "closedAt": "2020-10-12T17:34:16Z", "author": {"login": "melissa-barca"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP5uoGgH2gAyNDk5MzcxOTk1OjBhZTUyMjFiNmY4ODJmZTVlNWM2ZDhjZTY2MjM4NDFiNWIzYTFmYTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR3fn2AH2gAyNDk5MzcxOTk1OjA4MjI5NjUyMTA5MWEyODUyNTFkYTY4MzllOGY1ODQ3ZmZhZWQzNzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0ae5221b6f882fe5e5c6d8ce6623841b5b3a1fa0", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/0ae5221b6f882fe5e5c6d8ce6623841b5b3a1fa0", "committedDate": "2020-10-06T15:01:37Z", "message": "add command to open source doc in new column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43c8648eb37828cb697b6e24c8221f67cb773348", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/43c8648eb37828cb697b6e24c8221f67cb773348", "committedDate": "2020-10-06T15:14:14Z", "message": "code clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9da39447e9fede110542bf7d838e66d181d67415", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/9da39447e9fede110542bf7d838e66d181d67415", "committedDate": "2020-10-06T16:04:09Z", "message": "fix exceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjY1Mzgz", "url": "https://github.com/rstudio/rstudio/pull/7994#pullrequestreview-504265383", "createdAt": "2020-10-07T21:03:19Z", "commit": {"oid": "9da39447e9fede110542bf7d838e66d181d67415"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTowMzoxOVrOHeFcdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTowMzoxOVrOHeFcdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMwODUzMw==", "bodyText": "On Mac (maybe others, didn't check) conflicts with toggleDocumentOutline shortcut.", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501308533", "createdAt": "2020-10-07T21:03:19Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "diffHunk": "@@ -777,6 +778,10 @@ well as menu structures (for main menu and popup menus).\n          <shortcut refid=\"openSourceDoc\" value=\"Ctrl+O\" disableModes=\"emacs\"/>\n          <shortcut refid=\"openSourceDoc\" value=\"Meta+O\" if=\"org.rstudio.core.client.BrowseCap.isMacintosh()\"/>\n \n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Ctrl+X Ctrl+C\" disableModes=\"default,vim,sublime\"/>\n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Ctrl+Shift+O\" disableModes=\"emacs\"/>\n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Meta+Shift+O\" if=\"org.rstudio.core.client.BrowseCap.isMacintosh()\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9da39447e9fede110542bf7d838e66d181d67415"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc805bee952488dac9dfd5573086e7780f094295", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/dc805bee952488dac9dfd5573086e7780f094295", "committedDate": "2020-10-07T21:59:04Z", "message": "change keyboard command to fix conflict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MzA3MTU1", "url": "https://github.com/rstudio/rstudio/pull/7994#pullrequestreview-504307155", "createdAt": "2020-10-07T22:18:57Z", "commit": {"oid": "dc805bee952488dac9dfd5573086e7780f094295"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MzQ0NDQw", "url": "https://github.com/rstudio/rstudio/pull/7994#pullrequestreview-504344440", "createdAt": "2020-10-07T23:54:53Z", "commit": {"oid": "dc805bee952488dac9dfd5573086e7780f094295"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMzo1NDo1NFrOHeJe3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMzo1ODowMVrOHeJiVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3NDY4NQ==", "bodyText": "This command needs to be disabled, and probably hidden, when the allowSourceColumns preference prevents it from working. I'd suggest handling that in the source column manager (i.e. bind a preference listener that sets the command to be enabled/visible based on the value of the pref).", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501374685", "createdAt": "2020-10-07T23:54:54Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -674,18 +675,51 @@ public void onFocusPreviousPane()\n    }\n \n    @Handler\n-    public void onNewSourceColumn()\n-    {\n-       if (!userPrefs_.allowSourceColumns().getValue())\n-          pGlobalDisplay_.get().showMessage(GlobalDisplay.MSG_INFO, \"Cannot Add Column\",\n-             \"Allow Source Columns preference is disabled.\");\n-       else if (additionalSourceCount_ >= MAX_COLUMN_COUNT)\n-          pGlobalDisplay_.get().showMessage(GlobalDisplay.MSG_INFO, \"Cannot Add Column\",\n-             \"You can't add more than \" + MAX_COLUMN_COUNT + \" columns.\");\n-       else\n-          createSourceColumn();\n-    }\n+   public void onNewSourceColumn()\n+   {\n+      if (validateNewColumnRequest())\n+         createAndDisplaySourceColumn();\n+   }\n+   \n+   @Handler\n+   public void onOpenSourceDocNewColumn()\n+   {\n+      if (validateNewColumnRequest())\n+      {\n+         ColumnName name = createSourceColumn();\n+         SourceColumn column = sourceColumnManager_.getByName(name.getName());\n+         column.incrementNewTabPending();\n+         panel_.addLeftWidget(\n+            createSourceColumnWindow(name.getName(),\n+               name.getAccessibleName()));\n+         sourceColumnManager_.setActive(column);\n+         Command onCancelled = () ->\n+         {\n+            column.decrementNewTabPending();\n+            closeSourceWindow(name.getName());\n+         };\n+         Command onCompleted = () -> column.decrementNewTabPending();\n+         source_.openSourceDoc(onCancelled, onCompleted);\n+      }\n+   }\n \n+   private boolean validateNewColumnRequest()\n+   {\n+      if (!userPrefs_.allowSourceColumns().getValue())\n+      {\n+         pGlobalDisplay_.get().showMessage(GlobalDisplay.MSG_INFO, \"Cannot Add Column\",\n+            \"Allow Source Columns preference is disabled.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc805bee952488dac9dfd5573086e7780f094295"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3NTU3NA==", "bodyText": "If this is meant to be an Emacs-like keybinding for the command, maybe we should use the closest emacs keybinding? I think C-x C-c means something else in Emacs, and we should use something like C-x 5 f for this command (but we should check with @kevinushey).", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501375574", "createdAt": "2020-10-07T23:58:01Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/commands/Commands.cmd.xml", "diffHunk": "@@ -777,6 +778,10 @@ well as menu structures (for main menu and popup menus).\n          <shortcut refid=\"openSourceDoc\" value=\"Ctrl+O\" disableModes=\"emacs\"/>\n          <shortcut refid=\"openSourceDoc\" value=\"Meta+O\" if=\"org.rstudio.core.client.BrowseCap.isMacintosh()\"/>\n \n+         <shortcut refid=\"openSourceDocNewColumn\" value=\"Ctrl+X Ctrl+C\" disableModes=\"default,vim,sublime\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc805bee952488dac9dfd5573086e7780f094295"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e29ad4f3d7d2288b26436236916793dabf021af5", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/e29ad4f3d7d2288b26436236916793dabf021af5", "committedDate": "2020-10-08T15:26:26Z", "message": "disable and hide multiple source column commands when `Allow Source Columns` is off."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ca69c40b31564e15f89b44bb6b0352e92d30bed", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/9ca69c40b31564e15f89b44bb6b0352e92d30bed", "committedDate": "2020-10-08T15:27:00Z", "message": "add image for Open In New Column command"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0OTUwNzg2", "url": "https://github.com/rstudio/rstudio/pull/7994#pullrequestreview-504950786", "createdAt": "2020-10-08T16:17:03Z", "commit": {"oid": "e29ad4f3d7d2288b26436236916793dabf021af5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjoxNzowM1rOHemRiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjoxODozN1rOHemVUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NjQwOQ==", "bodyText": "Here and below: it makes sense to disable the first two commands if we're already maxed out for columns (since they create columns), but it seems to me like the third shouldn't be affected. What do you think?", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501846409", "createdAt": "2020-10-08T16:17:03Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -382,6 +382,14 @@ else if (numDocs > 0 && window.getState() == WindowState.HIDE)\n          hiddenTabs_ = tabNamesToTabs(evt.getValue().getHiddenTabSet());\n          populateTabPanel(hiddenTabs_, hiddenTabSetTabPanel_, hiddenTabSetMinPanel_);\n \n+         // manage source column commands\n+         boolean visible = userPrefs.allowSourceColumns().getValue() &&\n+            (userPrefs.panes().getValue().getAdditionalSourceColumns() < MAX_COLUMN_COUNT);\n+         \n+         commands_.newSourceColumn().setVisible(visible);\n+         commands_.openSourceDocNewColumn().setVisible(visible);\n+         commands_.focusSourceColumnSeparator().setVisible(visible);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e29ad4f3d7d2288b26436236916793dabf021af5"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzM3Ng==", "bodyText": "It's not totally clear to me why we need this code in both places ... doesn't this handler run at startup? (if not, maybe make a function that's called both at startup and in the value change handler?)", "url": "https://github.com/rstudio/rstudio/pull/7994#discussion_r501847376", "createdAt": "2020-10-08T16:18:37Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumnManager.java", "diffHunk": "@@ -242,6 +243,23 @@ public void onSwitchToDoc(SwitchToDocEvent event)\n          }\n       });\n \n+      userPrefs.allowSourceColumns().addValueChangeHandler(event ->\n+      {\n+         // PaneManager helps manage these commands so when modifying this code, update ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e29ad4f3d7d2288b26436236916793dabf021af5"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15d03041a4b6c9fb89057886b90e434abd44ac06", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/15d03041a4b6c9fb89057886b90e434abd44ac06", "committedDate": "2020-10-08T16:37:55Z", "message": "don't adjust command when source column max is reached"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1OTAyMDE3", "url": "https://github.com/rstudio/rstudio/pull/7994#pullrequestreview-505902017", "createdAt": "2020-10-09T18:27:55Z", "commit": {"oid": "15d03041a4b6c9fb89057886b90e434abd44ac06"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "082296521091a285251da6839e8f5847ffaed372", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/082296521091a285251da6839e8f5847ffaed372", "committedDate": "2020-10-12T17:33:16Z", "message": "remove keyboard shortcut"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 22, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}