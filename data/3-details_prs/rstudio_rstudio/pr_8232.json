{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNTg5OTEw", "number": 8232, "title": "always enable save commands for new source docs", "bodyText": "Intent\nEnsure that newly-opened R Markdown documents can be saved.\nApproach\nThe newDoc() function tried to enable / disable the Save command depending on whether the IDE already had an active editor. However, creation of a new document (usually) implies that a new editor will be created and become active, so we should check that state only after the document has been created.\nQA Notes\nTest via notes in #8228.\nCloses #8228.", "createdAt": "2020-10-29T21:48:44Z", "url": "https://github.com/rstudio/rstudio/pull/8232", "merged": true, "mergeCommit": {"oid": "d07dae99f455b7f46fa2c158ca63d33495ceabfd"}, "closed": true, "closedAt": "2020-10-30T13:58:59Z", "author": {"login": "kevinushey"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXZUhSAH2gAyNTEyNTg5OTEwOjRjNDYzYjc5YzdhNzZhMjAwY2JiMTU5ZGY2YjY4ZjQzZGM3NjViMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXnNxZAFqTUyMDY5Mzg3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4c463b79c7a76a200cbb159df6b68f43dc765b31", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/4c463b79c7a76a200cbb159df6b68f43dc765b31", "committedDate": "2020-10-29T21:47:32Z", "message": "manage save commands after opening new doc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aaf9bf74ce93c44f5e3d5c407f6535f5c2e416fb", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/aaf9bf74ce93c44f5e3d5c407f6535f5c2e416fb", "committedDate": "2020-10-29T21:40:15Z", "message": "always enable save commands for new source docs"}, "afterCommit": {"oid": "4c463b79c7a76a200cbb159df6b68f43dc765b31", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/4c463b79c7a76a200cbb159df6b68f43dc765b31", "committedDate": "2020-10-29T21:47:32Z", "message": "manage save commands after opening new doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMTMwNjAy", "url": "https://github.com/rstudio/rstudio/pull/8232#pullrequestreview-520130602", "createdAt": "2020-10-29T22:21:51Z", "commit": {"oid": "4c463b79c7a76a200cbb159df6b68f43dc765b31"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyMTo1MVrOHqwxLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyMTo1MVrOHqwxLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMTI2Mg==", "bodyText": "The active parameter actually represents whether or not this is this column is the current active column. (activeEditor_ is only populated for the active column) You'll see in manageSaveCommands we use getNextActiveEditor() instead of directly accessing the active editor, this is a function that will return the editor that would become active if the column became active.\nWhen you open a new doc it gets set to the active editor so this code works fine except in the very unlikely case where this function gets called after the user has moved on and is working with a different file. Really it doesn't make a difference, but I think we should pass this == manager.getActive() here.", "url": "https://github.com/rstudio/rstudio/pull/8232#discussion_r514601262", "createdAt": "2020-10-29T22:21:51Z", "author": {"login": "melissa-barca"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumn.java", "diffHunk": "@@ -979,13 +978,14 @@ public void onResponseReceived(SourceDocument newDoc)\n                   // apply (dynamic) doc property defaults\n                   SourceColumn.applyDocPropertyDefaults(newDoc, true, userPrefs_);\n \n-                  EditingTarget target =\n-                     addTab(newDoc, Source.OPEN_INTERACTIVE);\n+                  EditingTarget target = addTab(newDoc, Source.OPEN_INTERACTIVE);\n \n-                  if (contents != null)\n+                  // toggle save commands after the editor has been opened,\n+                  // in case this action has created and focused a new editor\n+                  if (activeEditor_ != null)\n                   {\n                      target.forceSaveCommandActive();\n-                     manageSaveCommands(active);\n+                     manageSaveCommands(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c463b79c7a76a200cbb159df6b68f43dc765b31"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99db6f6839ccf146674d40fdc306c0df097b6ecf", "author": {"user": {"login": "kevinushey", "name": "Kevin Ushey"}}, "url": "https://github.com/rstudio/rstudio/commit/99db6f6839ccf146674d40fdc306c0df097b6ecf", "committedDate": "2020-10-29T23:21:26Z", "message": "check if source column associated with new doc is active"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjkzODcw", "url": "https://github.com/rstudio/rstudio/pull/8232#pullrequestreview-520693870", "createdAt": "2020-10-30T13:58:50Z", "commit": {"oid": "99db6f6839ccf146674d40fdc306c0df097b6ecf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4957, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}