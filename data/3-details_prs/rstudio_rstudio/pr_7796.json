{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NDM3ODkz", "number": 7796, "title": "Fix issue with zoom column commands", "bodyText": "Intent\nFixes #7687\nThe main purpose of this PR is to fix an issue affecting the Zoom Left Column and Zoom Right Column commands when user has additional source columns open. The issue is primarily caused by the fact that the \"left column\" is no longer the left column with additional source columns.\nThis also fixes and issue whereWindowEnsureVisibleEvent was never updated to handle multiple source windows but was being initiated by source columns.\nApproach\nThis PR only ensure both commands work as they used to (zooming on the right column or left/center column). Another one will need to be created to have the wording of the commands updated and commands to zoom on the additional source columns.\nThe majority of the new logic is to ensure clean animation when transitioning to/from a zoomed state. Existing logic was only for the right side which always has one panel. For the left side, I need to calculate the total size to be displayed and then allocate those pixels so that they loaded left -> right or right -> left.\nQA Notes\nThese issues only happen when using additional source columns. We should make sure different orderings of the zoom commands work as they did in 1.3.", "createdAt": "2020-09-15T17:12:02Z", "url": "https://github.com/rstudio/rstudio/pull/7796", "merged": true, "mergeCommit": {"oid": "21f8832ab905b4a7d7a3c5e897ab9998111ff25f"}, "closed": true, "closedAt": "2020-09-15T22:30:06Z", "author": {"login": "melissa-barca"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEpq7qAH2gAyNDg3NDM3ODkzOmJjNTlmZDM2YmY1ZDIxMzBiOGY4ZDZmZGY5ZTI5YzFjOThlZjNjMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJPhpigH2gAyNDg3NDM3ODkzOjZlNzM2ZTg4NTkxMWQ3MWQ5OGIyYzhjN2JhMzk4YzAwOGM3OWUwYWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bc59fd36bf5d2130b8f8d6fdf9e29c1c98ef3c2a", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/bc59fd36bf5d2130b8f8d6fdf9e29c1c98ef3c2a", "committedDate": "2020-09-01T16:05:56Z", "message": "Hide and show columns when zooming on a specified tab"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b15d9db9774e6d46921ab7c782003dd1827d7a3", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/1b15d9db9774e6d46921ab7c782003dd1827d7a3", "committedDate": "2020-09-01T17:03:36Z", "message": "rename methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca7b2aaf0788792dfb6f68461b180f20dd83d914", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/ca7b2aaf0788792dfb6f68461b180f20dd83d914", "committedDate": "2020-09-01T22:39:17Z", "message": "hide additional source columns when zooming on left or right column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51d328121e50bbd809944e6c60270c2cff8c008d", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/51d328121e50bbd809944e6c60270c2cff8c008d", "committedDate": "2020-09-02T17:28:56Z", "message": "fix bug where left column wouldn't resize properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d740759ed30d39e0d2182351c33fa0ea2b785e4", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/1d740759ed30d39e0d2182351c33fa0ea2b785e4", "committedDate": "2020-09-03T22:01:44Z", "message": "restore correct widths of source columns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af48084a94253d331655b9e965096ad9895b0b0e", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/af48084a94253d331655b9e965096ad9895b0b0e", "committedDate": "2020-09-08T17:22:30Z", "message": "remove unneeded code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da1f2b1a53af886edf8f21ccf12bec49870b3440", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/da1f2b1a53af886edf8f21ccf12bec49870b3440", "committedDate": "2020-09-08T17:24:10Z", "message": "rename variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "859c3d719607d8ef2a4eb521d601b6e43f6e96fa", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/859c3d719607d8ef2a4eb521d601b6e43f6e96fa", "committedDate": "2020-09-08T19:42:50Z", "message": "code clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7825906bf81e0dc1ce777825df114c9e06bd290a", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/7825906bf81e0dc1ce777825df114c9e06bd290a", "committedDate": "2020-09-08T23:35:05Z", "message": "ensure the correct source is made visible on ensureVisible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23db03ce6cade3242092b1be37eec0d20ef6c3ce", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/23db03ce6cade3242092b1be37eec0d20ef6c3ce", "committedDate": "2020-09-15T14:54:30Z", "message": "set a state for source columns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d201ec7e373393cdc957225eba696c9ca36d2fb", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/1d201ec7e373393cdc957225eba696c9ca36d2fb", "committedDate": "2020-09-15T16:54:05Z", "message": "code clean up and add comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eed99b8dff3d4cd4265d31202c76b2a0c229b8fe", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/eed99b8dff3d4cd4265d31202c76b2a0c229b8fe", "committedDate": "2020-09-15T17:05:32Z", "message": "update command name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDM4MTgy", "url": "https://github.com/rstudio/rstudio/pull/7796#pullrequestreview-489038182", "createdAt": "2020-09-15T20:17:46Z", "commit": {"oid": "eed99b8dff3d4cd4265d31202c76b2a0c229b8fe"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDoxNzo0NlrOHSTAdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDoxOToxNFrOHSTDWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0NzgzMQ==", "bodyText": "Do we have an issue open on this?", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r488947831", "createdAt": "2020-09-15T20:17:46Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -577,10 +590,12 @@ public void onLayoutConsoleOnRight()\n       }\n    }\n \n+   // The following commands need to be updated to fit the new layout with additional source \n+   // columns. The mismatched names/actions are temporarily intentional until this is handled.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eed99b8dff3d4cd4265d31202c76b2a0c229b8fe"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0ODU2OA==", "bodyText": "Nit: addAll will do this in one line", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r488948568", "createdAt": "2020-09-15T20:19:14Z", "author": {"login": "jmcphers"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -946,7 +1106,26 @@ private void restoreSavedLayout()\n          window.onWindowStateChange(new WindowStateChangeEvent(WindowState.NORMAL, true));\n \n       maximizedWindow_.onWindowStateChange(new WindowStateChangeEvent(WindowState.NORMAL, true));\n-      resizeHorizontally(panel_.getWidgetSize(right_), widgetSizePriorToZoom_);\n+      \n+      ArrayList<Double> leftStart = new ArrayList<>();\n+      ArrayList<Double> leftEnd = new ArrayList<>();\n+      if (leftList_.size() > 0)\n+      {\n+         for (int i = 0; i < leftList_.size(); i++)\n+            leftStart.add(0.0);\n+\n+         if (leftWidgetSizePriorToZoom_.size() != leftList_.size())\n+            leftEnd = getValidColumnWidths(leftList_, leftWidgetSizePriorToZoom_, false);\n+         else\n+         {\n+            // Copy leftWidgetSizePriorToZoom_ rather than passing it directly because it may be\n+            // cleared before animation completes\n+            for (Double size : leftWidgetSizePriorToZoom_)\n+               leftEnd.add(size);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eed99b8dff3d4cd4265d31202c76b2a0c229b8fe"}, "originalPosition": 419}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTM5MzEz", "url": "https://github.com/rstudio/rstudio/pull/7796#pullrequestreview-489139313", "createdAt": "2020-09-15T22:02:57Z", "commit": {"oid": "eed99b8dff3d4cd4265d31202c76b2a0c229b8fe"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjowMjo1N1rOHSWz0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjowMjo1N1rOHSWz0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAxMDEzMQ==", "bodyText": "IntelliJ also recommends replacing with addAll.", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r489010131", "createdAt": "2020-09-15T22:02:57Z", "author": {"login": "gtritchie"}, "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -946,7 +1106,26 @@ private void restoreSavedLayout()\n          window.onWindowStateChange(new WindowStateChangeEvent(WindowState.NORMAL, true));\n \n       maximizedWindow_.onWindowStateChange(new WindowStateChangeEvent(WindowState.NORMAL, true));\n-      resizeHorizontally(panel_.getWidgetSize(right_), widgetSizePriorToZoom_);\n+      \n+      ArrayList<Double> leftStart = new ArrayList<>();\n+      ArrayList<Double> leftEnd = new ArrayList<>();\n+      if (leftList_.size() > 0)\n+      {\n+         for (int i = 0; i < leftList_.size(); i++)\n+            leftStart.add(0.0);\n+\n+         if (leftWidgetSizePriorToZoom_.size() != leftList_.size())\n+            leftEnd = getValidColumnWidths(leftList_, leftWidgetSizePriorToZoom_, false);\n+         else\n+         {\n+            // Copy leftWidgetSizePriorToZoom_ rather than passing it directly because it may be\n+            // cleared before animation completes\n+            for (Double size : leftWidgetSizePriorToZoom_)\n+               leftEnd.add(size);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0ODU2OA=="}, "originalCommit": {"oid": "eed99b8dff3d4cd4265d31202c76b2a0c229b8fe"}, "originalPosition": 419}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e736e885911d71d98b2c8c7ba398c008c79e0ad", "author": {"user": {"login": "melissa-barca", "name": "Melissa Barca"}}, "url": "https://github.com/rstudio/rstudio/commit/6e736e885911d71d98b2c8c7ba398c008c79e0ad", "committedDate": "2020-09-15T22:27:53Z", "message": "simplify code"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4978, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}