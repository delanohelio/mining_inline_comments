{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwNTcwNjY4", "number": 7742, "title": "Improve User Experience with XDG directory permissions issues", "bodyText": "Intent\nFixes #4505\nThis PR intends to improve the user experience when ~/.local/share/rstudio and ~/.config/rstudio are not owned by the correct user.\nApproach\n\n\nOn pref save, likely the most common problem for an end user, modify the error message that will be returned to be more descriptive:\n\n\n\nIn SessionMain, test dirs for write access. If the files exist and the user doesn't have write access, attempt to repair permissions. Log messages on failures:\n\n\n\nRStudio on session start up failure (happens when ~/.local/share/rstudio is not accessible by the current user):\n\nDownside: Repairing permissions generally fails for the same reason the user cannot write to these files.\nQA Notes\nTo reproduce this issue, do one of the following:\n\nStart RStudio Desktop as root on a system on which RStudio Desktop has never been started.\nOn a system where RStudio Desktop has already been run, execute chown -R root:root ~/.local/share/rstudio and/or chown -R root:root ~/.config/rstudio to emulate the issue caused by (1).\n\nThen, start RStudio Desktop as your regular user and attempt to modify and save something in your global preferences. Prior to this change you should see an error that says \"No such file or directory\".\nMore considerations:\n\nThe session should still start if ~/.config/rstudio is inaccessible, but it won't start if ~/.local/share/rstudio is inaccessible.\nThis should still work (and the logs should be correct) if the XDG paths are changed.\nRepairing the permissions (e.g. chown -R myuser:myuser ~/.config/rstudio) should resolve the issue completely (i.e. no more logs about it either).", "createdAt": "2020-09-05T19:20:12Z", "url": "https://github.com/rstudio/rstudio/pull/7742", "merged": true, "mergeCommit": {"oid": "549d5dcbd1ad326f57275509bf382c27bad6f188"}, "closed": true, "closedAt": "2020-10-20T20:04:20Z", "author": {"login": "MariaSemple"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFrBC7gH2gAyNDgwNTcwNjY4OjE2NGU0ODY1MGE0ZDI3N2VmNDExZjhjNjdiZjhjMzM2N2M4OTc5ZGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUeX-0AH2gAyNDgwNTcwNjY4OjA5YjY2ZDljNThlZmIxMWRmNDcwZWI1MGQyYWQ2YjE2YTE0OWJlMzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "164e48650a4d277ef411f8c67bf8c3367c8979db", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/164e48650a4d277ef411f8c67bf8c3367c8979db", "committedDate": "2020-09-04T20:13:55Z", "message": "improve error message for saving prefs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af13022096475c0b49077f1dc2ffb84400b3565f", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/af13022096475c0b49077f1dc2ffb84400b3565f", "committedDate": "2020-09-05T18:52:40Z", "message": "Merge remote-tracking branch 'origin/master' into feature/improve-perm-error-messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "257fdd3a61ec2e98386120fb617ce2e1b1b9cd00", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/257fdd3a61ec2e98386120fb617ce2e1b1b9cd00", "committedDate": "2020-09-05T18:55:24Z", "message": "Merge remote-tracking branch 'origin/master' into feature/improve-perm-error-messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b103326564fb06c234d98268a2a0a6b5e410c57", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/9b103326564fb06c234d98268a2a0a6b5e410c57", "committedDate": "2020-09-05T19:04:36Z", "message": "add a check for writeability to userConfigDir"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MzI5NTIz", "url": "https://github.com/rstudio/rstudio/pull/7742#pullrequestreview-484329523", "createdAt": "2020-09-08T16:58:07Z", "commit": {"oid": "9b103326564fb06c234d98268a2a0a6b5e410c57"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNjo1ODowOFrOHOmHDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzowMDowMlrOHOmLdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NjUxMQ==", "bodyText": "We call userConfigDir all the time and it's expected to be a fast, read-only operation -- probably not the right place to add a write test. This test should be done only once early at startup.", "url": "https://github.com/rstudio/rstudio/pull/7742#discussion_r485066511", "createdAt": "2020-09-08T16:58:08Z", "author": {"login": "jmcphers"}, "path": "src/cpp/core/system/Xdg.cpp", "diffHunk": "@@ -108,17 +109,53 @@ FilePath resolveXdgDir(const std::string& envVar,\n } // anonymous namespace\n \n FilePath userConfigDir(\n-        const boost::optional<std::string>& user,\n-        const boost::optional<FilePath>& homeDir)\n+   const boost::optional<std::string>& user,\n+   const boost::optional<FilePath>& homeDir)\n {\n-   return resolveXdgDir(\"XDG_CONFIG_HOME\", \n+   FilePath confDir = resolveXdgDir(\"XDG_CONFIG_HOME\", \n #ifdef _WIN32\n          FOLDERID_RoamingAppData,\n #endif\n          \"~/.config\",\n          user,\n          homeDir\n    );\n+\n+   Error permError;\n+   Error error = confDir.ensureDirectory();\n+   if (!error)\n+   {\n+      // Test permissions here.\n+      error = confDir.testWritePermissions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b103326564fb06c234d98268a2a0a6b5e410c57"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NzYzOA==", "bodyText": "For a non-technical audience, how about \"the folder X and all the files inside it\"?", "url": "https://github.com/rstudio/rstudio/pull/7742#discussion_r485067638", "createdAt": "2020-09-08T17:00:02Z", "author": {"login": "jmcphers"}, "path": "src/cpp/session/prefs/UserPrefsLayer.cpp", "diffHunk": "@@ -109,6 +109,19 @@ Error UserPrefsLayer::writePrefs(const core::json::Object &prefs)\n       lastSync_ = prefsFile_.getLastWriteTime();\n    }\n \n+   // Modify the error to be more descriptive\n+   if (isFileNotFoundError(error) && prefsFile_.getParent().exists())\n+   {\n+      error = Error(\n+         error.getName(),\n+         error.getCode(),\n+         \"Unable to save preferences. Please verify that \" + \n+            prefsFile_.getParent().getAbsolutePath() +\n+            \" exists and it and all its children are owned by the user '\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b103326564fb06c234d98268a2a0a6b5e410c57"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc2a3ae57d0adccf4d8e12b1342b71d50bb50819", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/fc2a3ae57d0adccf4d8e12b1342b71d50bb50819", "committedDate": "2020-09-09T06:08:34Z", "message": "check for write access to xdg folders once at session start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c05a203b4164c95d50b6a67b092409a9d87a61a", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/9c05a203b4164c95d50b6a67b092409a9d87a61a", "committedDate": "2020-09-09T06:08:45Z", "message": "improve error message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MjM1NDk0", "url": "https://github.com/rstudio/rstudio/pull/7742#pullrequestreview-485235494", "createdAt": "2020-09-09T17:14:36Z", "commit": {"oid": "9b103326564fb06c234d98268a2a0a6b5e410c57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNzoxNDozNlrOHPSDfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNzoxNDozNlrOHPSDfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc4NjQ5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  message.append(\"Encounterd an issue while testing config dir \\\"\")\n          \n          \n            \n                  message.append(\"Encountered an issue while testing config dir \\\"\")", "url": "https://github.com/rstudio/rstudio/pull/7742#discussion_r485786494", "createdAt": "2020-09-09T17:14:36Z", "author": {"login": "kevinushey"}, "path": "src/cpp/core/system/Xdg.cpp", "diffHunk": "@@ -108,17 +109,53 @@ FilePath resolveXdgDir(const std::string& envVar,\n } // anonymous namespace\n \n FilePath userConfigDir(\n-        const boost::optional<std::string>& user,\n-        const boost::optional<FilePath>& homeDir)\n+   const boost::optional<std::string>& user,\n+   const boost::optional<FilePath>& homeDir)\n {\n-   return resolveXdgDir(\"XDG_CONFIG_HOME\", \n+   FilePath confDir = resolveXdgDir(\"XDG_CONFIG_HOME\", \n #ifdef _WIN32\n          FOLDERID_RoamingAppData,\n #endif\n          \"~/.config\",\n          user,\n          homeDir\n    );\n+\n+   Error permError;\n+   Error error = confDir.ensureDirectory();\n+   if (!error)\n+   {\n+      // Test permissions here.\n+      error = confDir.testWritePermissions();\n+      if (error)\n+      {\n+         permError = Error(\n+            error.getName(),\n+            error.getCode(),\n+            \"Missing write permissions to \" + confDir.getAbsolutePath() + \". Some features may not work correctly.\",\n+            ERROR_LOCATION);\n+\n+         system::User currUser;\n+         error = system::User::getUserFromIdentifier(system::username(), currUser);\n+         if (!error)\n+            error = confDir.changeOwnership(currUser, true);\n+      }\n+   }\n+\n+   if (error)\n+   {\n+      std::string message;\n+      message.append(\"Encounterd an issue while testing config dir \\\"\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b103326564fb06c234d98268a2a0a6b5e410c57"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "457faa7cf792d38e52edea6ffc632d5dac618b87", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/457faa7cf792d38e52edea6ffc632d5dac618b87", "committedDate": "2020-09-13T18:12:43Z", "message": "remove unused code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5ODM5Mzk0", "url": "https://github.com/rstudio/rstudio/pull/7742#pullrequestreview-489839394", "createdAt": "2020-09-16T17:22:04Z", "commit": {"oid": "457faa7cf792d38e52edea6ffc632d5dac618b87"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNzoyMjowNFrOHS607g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNzoyNzozMVrOHS7Bdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwMDIzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // It should be invoked once. Any issues with these directories will be emmitted to the session log.\n          \n          \n            \n            // It should be invoked once. Any issues with these directories will be emitted to the session log.", "url": "https://github.com/rstudio/rstudio/pull/7742#discussion_r489600238", "createdAt": "2020-09-16T17:22:04Z", "author": {"login": "kevinushey"}, "path": "src/cpp/core/include/core/system/Xdg.hpp", "diffHunk": "@@ -62,6 +62,12 @@ FilePath userConfigDir(const boost::optional<std::string>& user = boost::none,\n // On Windows, this is 'FOLDERID_LocalAppData' (typically 'AppData/Local').\n FilePath userDataDir(const boost::optional<std::string>& user = boost::none,\n                      const boost::optional<FilePath>& homeDir = boost::none);\n+                     \n+// This function verifies that the userConfigDir() and userDataDir() exist and are owned by the running user.\n+// \n+// It should be invoked once. Any issues with these directories will be emmitted to the session log.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "457faa7cf792d38e52edea6ffc632d5dac618b87"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwMjM2OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .append(\":\\n  \")\n          \n          \n            \n                        .append(\"\\\":\\n  \")", "url": "https://github.com/rstudio/rstudio/pull/7742#discussion_r489602369", "createdAt": "2020-09-16T17:25:37Z", "author": {"login": "kevinushey"}, "path": "src/cpp/core/system/Xdg.cpp", "diffHunk": "@@ -135,6 +136,52 @@ FilePath userDataDir(\n    );\n }\n \n+void verifyUserDirs(\n+   const boost::optional<std::string>& user,\n+   const boost::optional<FilePath>& homeDir)\n+{\n+   auto testDir = [](const FilePath& dir, const ErrorLocation& errorLoc)\n+   {\n+      Error permError;\n+      Error error = dir.ensureDirectory();\n+      if (error)\n+         error.addOrUpdateProperty(\"path\", dir.getAbsolutePath());\n+      else\n+      {\n+         error = dir.testWritePermissions();\n+         if (error)\n+         {\n+            permError = Error(\n+               error.getName(),\n+               error.getCode(),\n+               \"Missing write permissions to \" + dir.getAbsolutePath() + \". Some features may not work correctly.\",\n+               ERROR_LOCATION);\n+\n+            system::User currUser;\n+            error = system::User::getUserFromIdentifier(system::username(), currUser);\n+            if (!error)\n+               error = dir.changeOwnership(currUser, true);\n+         }\n+      }\n+\n+      if (error)\n+      {\n+         std::string message;\n+         message.append(\"Unable to access \\\"\")\n+            .append(dir.getAbsolutePath())\n+            .append(\":\\n  \")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "457faa7cf792d38e52edea6ffc632d5dac618b87"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwMzQ0Nw==", "bodyText": "I wonder if we should instead amend the existing error's properties here, rather than creating a whole new error object? (Since in theory some properties of interest on the original error could be lost)", "url": "https://github.com/rstudio/rstudio/pull/7742#discussion_r489603447", "createdAt": "2020-09-16T17:27:31Z", "author": {"login": "kevinushey"}, "path": "src/cpp/session/prefs/UserPrefsLayer.cpp", "diffHunk": "@@ -109,6 +109,19 @@ Error UserPrefsLayer::writePrefs(const core::json::Object &prefs)\n       lastSync_ = prefsFile_.getLastWriteTime();\n    }\n \n+   // Modify the error to be more descriptive\n+   if (isFileNotFoundError(error) && prefsFile_.exists())\n+   {\n+      error = Error(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "457faa7cf792d38e52edea6ffc632d5dac618b87"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5ODQ4NDM4", "url": "https://github.com/rstudio/rstudio/pull/7742#pullrequestreview-489848438", "createdAt": "2020-09-16T17:34:41Z", "commit": {"oid": "457faa7cf792d38e52edea6ffc632d5dac618b87"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "541874723879dc8fd3bddc9aa85fe653a317bb0f", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/541874723879dc8fd3bddc9aa85fe653a317bb0f", "committedDate": "2020-09-16T17:49:52Z", "message": "Update src/cpp/core/include/core/system/Xdg.hpp\n\nCo-authored-by: Kevin Ushey <kevin@rstudio.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff36378bd84cc4eef8c8e012382fd3a9cae9d7e9", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/ff36378bd84cc4eef8c8e012382fd3a9cae9d7e9", "committedDate": "2020-09-16T17:50:12Z", "message": "Update src/cpp/core/system/Xdg.cpp\n\nCo-authored-by: Kevin Ushey <kevin@rstudio.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1a1780215ba007f687b9c1805439a5e2db0fd81", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/b1a1780215ba007f687b9c1805439a5e2db0fd81", "committedDate": "2020-09-16T20:05:47Z", "message": "preserve original error as the cause"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d67d1efede37280ba5d16173edfe0af83bfe1527", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/d67d1efede37280ba5d16173edfe0af83bfe1527", "committedDate": "2020-09-16T20:10:56Z", "message": "Merge branch 'feature/improve-perm-error-messages' of github.com:rstudio/rstudio into feature/improve-perm-error-messages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjQzOTU3", "url": "https://github.com/rstudio/rstudio/pull/7742#pullrequestreview-491643957", "createdAt": "2020-09-18T17:12:34Z", "commit": {"oid": "d67d1efede37280ba5d16173edfe0af83bfe1527"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNzoxMjozNFrOHUVYzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNzoxMjozNFrOHUVYzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA4Mzk4MA==", "bodyText": "I think this might cause trouble later because there is some first-run logic that checks for the existence of these directories to figure out if we need to do certain kinds of initialization (or migration from old folders). Since the pathological case is generally that these directories exist but are unwritable, how would you feel about having this test function do nothing if the directory isn't in place yet?", "url": "https://github.com/rstudio/rstudio/pull/7742#discussion_r491083980", "createdAt": "2020-09-18T17:12:34Z", "author": {"login": "jmcphers"}, "path": "src/cpp/core/system/Xdg.cpp", "diffHunk": "@@ -135,6 +136,52 @@ FilePath userDataDir(\n    );\n }\n \n+void verifyUserDirs(\n+   const boost::optional<std::string>& user,\n+   const boost::optional<FilePath>& homeDir)\n+{\n+   auto testDir = [](const FilePath& dir, const ErrorLocation& errorLoc)\n+   {\n+      Error permError;\n+      Error error = dir.ensureDirectory();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d67d1efede37280ba5d16173edfe0af83bfe1527"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45df9dfbeefbaca76bcec3b9d564939486e48c2c", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/45df9dfbeefbaca76bcec3b9d564939486e48c2c", "committedDate": "2020-10-13T21:28:00Z", "message": "only test write permissions if the directory exists"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5ODU0NDg3", "url": "https://github.com/rstudio/rstudio/pull/7742#pullrequestreview-509854487", "createdAt": "2020-10-15T22:33:44Z", "commit": {"oid": "45df9dfbeefbaca76bcec3b9d564939486e48c2c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMjozMzo0NFrOHidyVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMjozMzo0NFrOHidyVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkwMTY1NQ==", "bodyText": "On Linux you need to be root to change ownership, so I think that this is very unlikely to succeed. In the pathological case (your settings/data dir is owned by someone else), the effect here will be that we log \"Unable to access [dir]: Operation not permitted\" which isn't super helpful. Maybe we should just figure out who the owner is and log it if we can? Or have a different error message for the attempted ownership change?", "url": "https://github.com/rstudio/rstudio/pull/7742#discussion_r505901655", "createdAt": "2020-10-15T22:33:44Z", "author": {"login": "jmcphers"}, "path": "src/cpp/core/system/Xdg.cpp", "diffHunk": "@@ -135,6 +136,49 @@ FilePath userDataDir(\n    );\n }\n \n+void verifyUserDirs(\n+   const boost::optional<std::string>& user,\n+   const boost::optional<FilePath>& homeDir)\n+{\n+   auto testDir = [](const FilePath& dir, const ErrorLocation& errorLoc)\n+   {\n+      Error error, permError;\n+      if (dir.exists())\n+      {\n+         error = dir.testWritePermissions();\n+         if (error)\n+         {\n+            permError = Error(\n+               error.getName(),\n+               error.getCode(),\n+               \"Missing write permissions to \" + dir.getAbsolutePath() + \". Some features may not work correctly.\",\n+               ERROR_LOCATION);\n+\n+            system::User currUser;\n+            error = system::User::getUserFromIdentifier(system::username(), currUser);\n+            if (!error)\n+               error = dir.changeOwnership(currUser, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45df9dfbeefbaca76bcec3b9d564939486e48c2c"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyODkyNTYy", "url": "https://github.com/rstudio/rstudio/pull/7742#pullrequestreview-512892562", "createdAt": "2020-10-20T15:58:08Z", "commit": {"oid": "45df9dfbeefbaca76bcec3b9d564939486e48c2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09b66d9c58efb11df470eb50d2ad6b16a149be32", "author": {"user": {"login": "MariaSemple", "name": "Maria Semple"}}, "url": "https://github.com/rstudio/rstudio/commit/09b66d9c58efb11df470eb50d2ad6b16a149be32", "committedDate": "2020-10-20T19:59:04Z", "message": "add an explanatory comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4967, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}