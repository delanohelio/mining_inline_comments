{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MjA3NjIw", "number": 3863, "title": "In `updateFromReturn`, remove Java expressions that contain local variables", "bodyText": "updateFromReturn transfers a type from a return expression to a method return type.  References to local variables make sense within the method body but not in the method signature.\nSimilar standardization might be necessary elsewhere.\nReinstate Javadoc checking after merging.", "createdAt": "2020-11-05T17:03:58Z", "url": "https://github.com/typetools/checker-framework/pull/3863", "merged": true, "mergeCommit": {"oid": "62cf9545e959501849f05a0d8d3d7ac7ec376749"}, "closed": true, "closedAt": "2020-11-06T17:42:05Z", "author": {"login": "mernst"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZefEpAH2gAyNTE2MjA3NjIwOmZjYmI1MjA3NzlhMzgwZjMxMzljNmExMWQ3ZjI4YmEyYjdlNWE3MTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ6Z5FgFqTUyNTM1Mzg0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fcbb520779a380f3139c6a11d7f28ba2b7e5a717", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/fcbb520779a380f3139c6a11d7f28ba2b7e5a717", "committedDate": "2020-11-05T08:56:26Z", "message": "Add formal parameter removeErroneousExpressions to dependent type standardization routines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f245ff7ca63a4f503db0534ea08e5e3bf58f3de", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/3f245ff7ca63a4f503db0534ea08e5e3bf58f3de", "committedDate": "2020-11-05T09:01:26Z", "message": "Formatting tweak"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28770a84c88c067e9ffdfbaea553309638600655", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/28770a84c88c067e9ffdfbaea553309638600655", "committedDate": "2020-11-05T15:33:34Z", "message": "Merge ../checker-framework-branch-master into standardize-removeErroneousExpressions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8b7ab4eedec5c018277a6ca59a363e71010511e", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/f8b7ab4eedec5c018277a6ca59a363e71010511e", "committedDate": "2020-11-05T16:22:29Z", "message": "Add Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a961649a81cb4adbbe77de06ab99b70098e5ba48", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/a961649a81cb4adbbe77de06ab99b70098e5ba48", "committedDate": "2020-11-05T16:22:35Z", "message": "Add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4db4a59da40d84e94be96c27e39b2f0d720ef54d", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/4db4a59da40d84e94be96c27e39b2f0d720ef54d", "committedDate": "2020-11-05T16:24:55Z", "message": "Add hack for \"<self>\" expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3293be5a460d7e156e62763a207d94cea15c343", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/b3293be5a460d7e156e62763a207d94cea15c343", "committedDate": "2020-11-05T16:28:39Z", "message": "Skip Javadoc checking for this pull request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e216e365fc3273e2f79be892f82e08cda20aa74", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/1e216e365fc3273e2f79be892f82e08cda20aa74", "committedDate": "2020-11-05T16:44:45Z", "message": "Undo hack, ensure that correct version of method is overridden"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NzQwMDA5", "url": "https://github.com/typetools/checker-framework/pull/3863#pullrequestreview-524740009", "createdAt": "2020-11-05T23:01:53Z", "commit": {"oid": "1e216e365fc3273e2f79be892f82e08cda20aa74"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMzowMTo1M1rOHuaADQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMzowMjoxOVrOHuaAzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQyMjU0MQ==", "bodyText": "This should only return null if removeErroneousExpressions is true.", "url": "https://github.com/typetools/checker-framework/pull/3863#discussion_r518422541", "createdAt": "2020-11-05T23:01:53Z", "author": {"login": "smillst"}, "path": "checker/src/main/java/org/checkerframework/checker/lock/LockAnnotatedTypeFactory.java", "diffHunk": "@@ -170,9 +170,10 @@ protected String standardizeString(\n                     String expression,\n                     FlowExpressionContext context,\n                     TreePath localScope,\n-                    boolean useLocalScope) {\n+                    boolean useLocalScope,\n+                    boolean removeErroneousExpressions) {\n                 if (DependentTypesError.isExpressionError(expression)) {\n-                    return expression;\n+                    return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e216e365fc3273e2f79be892f82e08cda20aa74"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQyMjczMg==", "bodyText": "Instead of passing removeErroneousExpressions to standardizeString, this if statement could check if standardized is an error string via DependentTypesError#isExpressionError.", "url": "https://github.com/typetools/checker-framework/pull/3863#discussion_r518422732", "createdAt": "2020-11-05T23:02:19Z", "author": {"login": "smillst"}, "path": "framework/src/main/java/org/checkerframework/framework/util/dependenttypes/DependentTypesHelper.java", "diffHunk": "@@ -600,8 +684,18 @@ private AnnotationMirror standardizeDependentTypeAnnotation(\n                     AnnotationUtils.getElementValueArray(anno, value, String.class, true);\n             List<String> standardizedStrings = new ArrayList<>();\n             for (String expression : expressionStrings) {\n-                standardizedStrings.add(\n-                        standardizeString(expression, context, localScope, useLocalScope));\n+                String standardized =\n+                        standardizeString(\n+                                expression,\n+                                context,\n+                                localScope,\n+                                useLocalScope,\n+                                removeErroneousExpressions);\n+                if (standardized == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e216e365fc3273e2f79be892f82e08cda20aa74"}, "originalPosition": 205}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21c9408945af4ec18e4042e31a37a2a9f8c2abd3", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/21c9408945af4ec18e4042e31a37a2a9f8c2abd3", "committedDate": "2020-11-06T00:05:03Z", "message": "Remove removeErroneousExpressions formal parameter from standardizeString"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6970d811f720fbe8cd9704e314d3424b2c00a41", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/e6970d811f720fbe8cd9704e314d3424b2c00a41", "committedDate": "2020-11-06T00:05:34Z", "message": "Merge ../checker-framework-branch-master into standardize-removeErroneousExpressions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MzUzODQ2", "url": "https://github.com/typetools/checker-framework/pull/3863#pullrequestreview-525353846", "createdAt": "2020-11-06T17:28:07Z", "commit": {"oid": "e6970d811f720fbe8cd9704e314d3424b2c00a41"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2488, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}