{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyNjg1MjQ0", "number": 3481, "title": "Validate instanceof types (Fixes #3033 and #762)", "bodyText": "This PR is a fix to issue#3033 (#3033) and issue#762 (#762), regarding specific type rules for the instanceof tree. In case of the Nullness Checker, the added code will issue an error if the type of the instanceof is explicitly annotated as @nullable and will issue a warning if it is explicitly annotated as @nonnull. For other checkers, the Framework would issue a warning if the reference type is a subtype of the expression type.\nFixes #3033 and #762.", "createdAt": "2020-07-19T17:48:25Z", "url": "https://github.com/typetools/checker-framework/pull/3481", "merged": true, "mergeCommit": {"oid": "22d028603311b23b97ad9da4a972926a5fd34fd2"}, "closed": true, "closedAt": "2020-09-10T18:25:14Z", "author": {"login": "aditya3434"}, "timelineItems": {"totalCount": 35, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2LXrugH2gAyNDUyNjg1MjQ0OmFhODMxYTRlYzQ5YjBiZTQ0YTY3ZDA1OGVmZmZkYzhhMzVmNDZhZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdG8lOugFqTQ4NDQyMzk0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa831a4ec49b0be44a67d058efffdc8a35f46afe", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/aa831a4ec49b0be44a67d058efffdc8a35f46afe", "committedDate": "2020-07-18T16:52:49Z", "message": "Introducing errors and warnings for use of instanceof in Nullness Checker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0037c3a33ce532d074de5641e86d36f7101b2acd", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/0037c3a33ce532d074de5641e86d36f7101b2acd", "committedDate": "2020-07-19T06:07:19Z", "message": "Applying checks only for annotated classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d59c6ca2d2b265c7c18373a97e2a4634ed550c8", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/1d59c6ca2d2b265c7c18373a97e2a4634ed550c8", "committedDate": "2020-07-19T10:34:04Z", "message": "Fixing errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "416aaf0018a4343240fef9a46edde30755215b02", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/416aaf0018a4343240fef9a46edde30755215b02", "committedDate": "2020-07-19T17:28:53Z", "message": "Removing import *"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMDQ0MTEx", "url": "https://github.com/typetools/checker-framework/pull/3481#pullrequestreview-452044111", "createdAt": "2020-07-21T00:22:24Z", "commit": {"oid": "416aaf0018a4343240fef9a46edde30755215b02"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwMDoyMjoyNFrOG0jr6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwMDoyMjoyNFrOG0jr6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MzgxOA==", "bodyText": "Could you:\n\ncall TreeUtils.annotationsFromTree()\nuse AnnotationUtils.containsSame to look for the annotations\n\nThen you don't need to change the visibility below.", "url": "https://github.com/typetools/checker-framework/pull/3481#discussion_r457763818", "createdAt": "2020-07-21T00:22:24Z", "author": {"login": "wmdietl"}, "path": "checker/src/main/java/org/checkerframework/checker/nullness/NullnessVisitor.java", "diffHunk": "@@ -380,6 +381,20 @@ public Void visitIf(IfTree node, Void p) {\n         return super.visitIf(node, p);\n     }\n \n+    @Override\n+    public Void visitInstanceOf(InstanceOfTree node, Void p) {\n+        if (node.getType().getKind() == Kind.ANNOTATED_TYPE) {\n+            AnnotatedTypeMirror type = atypeFactory.fromExpression((ExpressionTree) node.getType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "416aaf0018a4343240fef9a46edde30755215b02"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edec7f72c4db977cbab0577d966cd1e012ee3879", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/edec7f72c4db977cbab0577d966cd1e012ee3879", "committedDate": "2020-07-21T07:43:09Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb4d4afa13a8d7cb9bb954b4c093110b82948920", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/cb4d4afa13a8d7cb9bb954b4c093110b82948920", "committedDate": "2020-07-21T07:44:11Z", "message": "Requested changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb2f36f33044fbd9c662dc59230e15171d43bda6", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/fb2f36f33044fbd9c662dc59230e15171d43bda6", "committedDate": "2020-07-21T08:34:23Z", "message": "Removing import *"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODkwNzY5", "url": "https://github.com/typetools/checker-framework/pull/3481#pullrequestreview-452890769", "createdAt": "2020-07-21T23:10:38Z", "commit": {"oid": "fb2f36f33044fbd9c662dc59230e15171d43bda6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bb83f218bf81e4452ac8490a1e76ab714d47589", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/1bb83f218bf81e4452ac8490a1e76ab714d47589", "committedDate": "2020-07-22T07:57:58Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5027ea45e997957b08d56d3ce43607991538fa8b", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/5027ea45e997957b08d56d3ce43607991538fa8b", "committedDate": "2020-07-22T07:58:23Z", "message": "Adding test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9258b91685f5f44013c19bc6e5b7ef0f0f76ec3f", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/9258b91685f5f44013c19bc6e5b7ef0f0f76ec3f", "committedDate": "2020-07-27T08:01:23Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NzgwNTY0", "url": "https://github.com/typetools/checker-framework/pull/3481#pullrequestreview-457780564", "createdAt": "2020-07-29T18:26:58Z", "commit": {"oid": "9258b91685f5f44013c19bc6e5b7ef0f0f76ec3f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6f9cf8fe5a135b9c0006cbb622c5c7087e934df", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/f6f9cf8fe5a135b9c0006cbb622c5c7087e934df", "committedDate": "2020-07-31T06:33:06Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27e5621fcfd386a85ce3976c766dcb0e922eb8f3", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/27e5621fcfd386a85ce3976c766dcb0e922eb8f3", "committedDate": "2020-07-31T08:57:14Z", "message": "Adding general checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4483f786d4a75ac565b6497bd7c5aa5be0323b83", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/4483f786d4a75ac565b6497bd7c5aa5be0323b83", "committedDate": "2020-08-03T08:09:52Z", "message": "Adding test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78254a512b40095845e5f9f805b7a1367588e86f", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/78254a512b40095845e5f9f805b7a1367588e86f", "committedDate": "2020-08-03T08:11:01Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd9ed4f24b9509f7610a740ddea8785257668894", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/cd9ed4f24b9509f7610a740ddea8785257668894", "committedDate": "2020-08-03T09:09:30Z", "message": "Formatting changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3fde1548cec8e41efadb6554575dc260ce45cd7", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/f3fde1548cec8e41efadb6554575dc260ce45cd7", "committedDate": "2020-08-09T10:09:16Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9affb635d0fde6d71657c04d4f5fc015b0153b1", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/e9affb635d0fde6d71657c04d4f5fc015b0153b1", "committedDate": "2020-08-09T15:14:24Z", "message": "Fixing merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f664c8cf7845baf95125e266b137e3adac8b8b31", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/f664c8cf7845baf95125e266b137e3adac8b8b31", "committedDate": "2020-08-10T11:32:31Z", "message": "Removing .*"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "429a06a84cf6e1103b3e6350dc478b7fc6a4e40c", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/429a06a84cf6e1103b3e6350dc478b7fc6a4e40c", "committedDate": "2020-08-11T08:28:04Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzQ2NDcw", "url": "https://github.com/typetools/checker-framework/pull/3481#pullrequestreview-466346470", "createdAt": "2020-08-12T23:38:19Z", "commit": {"oid": "429a06a84cf6e1103b3e6350dc478b7fc6a4e40c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMzozODoyMFrOG_2dAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMzozODoyNlrOG_2dKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYwNTYzMw==", "bodyText": "\".error\" makes this key longer without making it more informative.  I suggest shortening the key.", "url": "https://github.com/typetools/checker-framework/pull/3481#discussion_r469605633", "createdAt": "2020-08-12T23:38:20Z", "author": {"login": "mernst"}, "path": "checker/src/main/java/org/checkerframework/checker/nullness/messages.properties", "diffHunk": "@@ -16,3 +16,5 @@ new.class.type.invalid=the annotations %s do not need be applied in object creat\n toArray.nullable.elements.not.newarray=call of toArray on collection of non-null elements yields an array of possibly-null elements; omit the argument to toArray or make it an explicit array constructor\n toArray.nullable.elements.mismatched.size=call of toArray on collection of non-null elements yields an array of possibly-null elements; cannot determine that the argument array has the same size as the receiver collection\n clear.system.property=call might clear a predefined system property; pass -Alint=permitClearProperty to permit it\n+instanceof.nullable.error=instanceof is only true for a non-null expression", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "429a06a84cf6e1103b3e6350dc478b7fc6a4e40c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYwNTY3NQ==", "bodyText": "I find this error message confusing.  The only point of performing x instanceof C is when C is a subtype of x's compile-time type, so it's weird for the message to say only that.\nI think this message is trying to say that, at run time, instanceof will not check the annotations.  Please make it do so.  That is similar to the \"cast.unsafe\" message earlier in the file.  You could make the error key \"instanceof.unsafe\" for parallelism.\nAlso, please use standard terms in the diagnostic message.  The JLS uses \"expression\" where you use \"operand\"", "url": "https://github.com/typetools/checker-framework/pull/3481#discussion_r469605675", "createdAt": "2020-08-12T23:38:26Z", "author": {"login": "mernst"}, "path": "framework/src/main/java/org/checkerframework/common/basetype/messages.properties", "diffHunk": "@@ -111,3 +111,4 @@ field.invariant.not.found.superclass=the field invariant annotation is missing f\n field.invariant.not.subtype.superclass=the qualifier for field %s is not a subtype of the qualifier in the superclass field invariant%nfound: %s%nsuperclass type: %s\n \n invalid.annotation.location.bytecode=found annotation in unexpected location in bytecode on element: %s %nUse -AignoreInvalidAnnotationLocations to suppress this warning\n+operand.instanceof.subtype=reference type is a subtype of the operand type.%nOperand Type : %s%nReference Type : %s", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "429a06a84cf6e1103b3e6350dc478b7fc6a4e40c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb26e9460d35050390e71df87fdbe2d003ec5700", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/fb26e9460d35050390e71df87fdbe2d003ec5700", "committedDate": "2020-08-13T09:03:30Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34bba132086f751fac0d5d772440eb6a380e402f", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/34bba132086f751fac0d5d772440eb6a380e402f", "committedDate": "2020-08-13T12:11:07Z", "message": "Changing error messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fd5bffcb0b4428a73b96fb4c99dda92477f7d08", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/9fd5bffcb0b4428a73b96fb4c99dda92477f7d08", "committedDate": "2020-08-13T19:32:29Z", "message": "Merge ../checker-framework-branch-master into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df8a8de343370fb84c3cf21c75d296a10cb4f35a", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/df8a8de343370fb84c3cf21c75d296a10cb4f35a", "committedDate": "2020-08-14T10:36:23Z", "message": "Merge branch 'issue3033' of https://github.com/aditya3434/checker-framework into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daad1e9bce16f8e54525e86793ac422375b85658", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/daad1e9bce16f8e54525e86793ac422375b85658", "committedDate": "2020-08-15T04:14:33Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6a881d56e72ac49f3458c2d00bf160ec484ef39", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/e6a881d56e72ac49f3458c2d00bf160ec484ef39", "committedDate": "2020-08-21T05:25:52Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93c7201610620b8025b584bb5408409a959693e8", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/93c7201610620b8025b584bb5408409a959693e8", "committedDate": "2020-08-26T09:02:29Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab6f6f980fb5a241cd723b4c51bd75fd68504009", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/ab6f6f980fb5a241cd723b4c51bd75fd68504009", "committedDate": "2020-08-29T06:15:51Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c50faabf06523defdf41bd3d1ce9c7431ae08c2c", "author": {"user": {"login": "aditya3434", "name": null}}, "url": "https://github.com/typetools/checker-framework/commit/c50faabf06523defdf41bd3d1ce9c7431ae08c2c", "committedDate": "2020-08-30T11:36:31Z", "message": "Merge branch 'master' into issue3033"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6804f3056f8b03bc0d07389b7e82f3c91d7dbe04", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/6804f3056f8b03bc0d07389b7e82f3c91d7dbe04", "committedDate": "2020-09-08T19:13:49Z", "message": "Tweak variable names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa8a97e3bef53336ce4896d93a28caed2576bfc0", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/fa8a97e3bef53336ce4896d93a28caed2576bfc0", "committedDate": "2020-09-08T19:14:44Z", "message": "Merge ../checker-framework-branch-master into issue3033"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDIzOTQw", "url": "https://github.com/typetools/checker-framework/pull/3481#pullrequestreview-484423940", "createdAt": "2020-09-08T19:15:45Z", "commit": {"oid": "fa8a97e3bef53336ce4896d93a28caed2576bfc0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2692, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}