{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NDkxNjA1", "number": 3395, "title": "Improve CFGVisualizer.", "bodyText": "Improve the logic of visualizeBlockNode().\nAs graphviz suggested: We should add \\\\l to the end of each line. Adding to the start of the line will make the logic unclear. Also, two \\\\ls together will create a new line in DOT, which will make the generated graph looks bad. I tried to avoid and remove all the two \\\\ls in this PR.\nImprove code and logic.\nRemove extra blanks from the generated graph.", "createdAt": "2020-06-21T03:53:25Z", "url": "https://github.com/typetools/checker-framework/pull/3395", "merged": true, "mergeCommit": {"oid": "b076873364e07f8d2e42de0048a340d7975ac807"}, "closed": true, "closedAt": "2020-07-01T14:23:53Z", "author": {"login": "xingweitian"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctS9lfAH2gAyNDM3NDkxNjA1OjIzZTZjY2YzYTViZDdjOGNiMmEwMDk5NjdlM2ZmZTM2ZTA5Zjg1ODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwazUdAH2gAyNDM3NDkxNjA1OmI4MzYzYTkzMjhkZTcwNDFkNTM2ZWE3ZDFkOWEwZjVjZGQ0YzNhMzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "23e6ccf3a5bd7c8cb2a009967e3ffe36e09f8589", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/23e6ccf3a5bd7c8cb2a009967e3ffe36e09f8589", "committedDate": "2020-06-21T02:38:14Z", "message": "Extract common logic of visualizeBlockNode() into a helper method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cc25a38ecb0ed34f30487eb26f3209f9c174819", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/4cc25a38ecb0ed34f30487eb26f3209f9c174819", "committedDate": "2020-06-24T15:38:46Z", "message": "Update StringCFGVisualizer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b7397a63dabbed8f6b36fc74c8bfefdebd12747", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/3b7397a63dabbed8f6b36fc74c8bfefdebd12747", "committedDate": "2020-06-24T15:39:37Z", "message": "Update DOTCFGVisualizer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "737b6c4307bfaa56b87558d7c37bf0bdb200e33a", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/737b6c4307bfaa56b87558d7c37bf0bdb200e33a", "committedDate": "2020-06-24T18:50:34Z", "message": "Merge remote-tracking branch 'typetools/master' into typetools-improve-visualizer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04d724da1b184d115b1e8591c27bbeecee1b7657", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/04d724da1b184d115b1e8591c27bbeecee1b7657", "committedDate": "2020-06-24T19:01:15Z", "message": "Merge remote-tracking branch 'origin/typetools-improve-visualizer' into typetools-improve-visualizer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f6c1a64f241e25d809b70c22eee0a2baf986c8e", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/0f6c1a64f241e25d809b70c22eee0a2baf986c8e", "committedDate": "2020-06-24T19:53:02Z", "message": "Resolve comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83d1fb23367b18ab3c652df442d67dfeefa2def3", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/83d1fb23367b18ab3c652df442d67dfeefa2def3", "committedDate": "2020-06-25T06:23:34Z", "message": "Merge remote-tracking branch 'typetools/master' into typetools-improve-visualizer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NDYzOTIy", "url": "https://github.com/typetools/checker-framework/pull/3395#pullrequestreview-437463922", "createdAt": "2020-06-25T12:55:33Z", "commit": {"oid": "0f6c1a64f241e25d809b70c22eee0a2baf986c8e"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMjo1NTozNFrOGo5WDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMjo1OToxNVrOGo5eiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUzNTc1Nw==", "bodyText": "The two escape methods can stay private, right?", "url": "https://github.com/typetools/checker-framework/pull/3395#discussion_r445535757", "createdAt": "2020-06-25T12:55:34Z", "author": {"login": "wmdietl"}, "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/DOTCFGVisualizer.java", "diffHunk": "@@ -284,7 +277,7 @@ public String visualizeStoreKeyVal(String keyName, Object value) {\n      * @param str the string to be escaped\n      * @return the escaped version of the string\n      */\n-    private String escapeDoubleQuotes(final String str) {\n+    protected String escapeDoubleQuotes(final String str) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f6c1a64f241e25d809b70c22eee0a2baf986c8e"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUzNzkyOA==", "bodyText": "How about Format the given object as a String suitable for the output format, i.e. with format-specific characters escaped.", "url": "https://github.com/typetools/checker-framework/pull/3395#discussion_r445537928", "createdAt": "2020-06-25T12:59:15Z", "author": {"login": "wmdietl"}, "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/AbstractCFGVisualizer.java", "diffHunk": "@@ -261,6 +261,33 @@ protected String loopOverBlockContents(\n         }\n     }\n \n+    /**\n+     * Format the given object into a String.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f6c1a64f241e25d809b70c22eee0a2baf986c8e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "082878c0e568a01bd2f5b72fdb48c2a7efec711e", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/082878c0e568a01bd2f5b72fdb48c2a7efec711e", "committedDate": "2020-06-25T20:42:59Z", "message": "Pull the latest code. Resolve comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODQ5Mzcz", "url": "https://github.com/typetools/checker-framework/pull/3395#pullrequestreview-437849373", "createdAt": "2020-06-25T20:51:41Z", "commit": {"oid": "082878c0e568a01bd2f5b72fdb48c2a7efec711e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDo1MTo0MVrOGpLXMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDo1MTo0MVrOGpLXMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgzMDk2MA==", "bodyText": "Now that the two visualizeBlockNode methods are exactly the same, should we just remove them and make the Helper the real implementation in AbstractCFGVisualizer?", "url": "https://github.com/typetools/checker-framework/pull/3395#discussion_r445830960", "createdAt": "2020-06-25T20:51:41Z", "author": {"login": "wmdietl"}, "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/DOTCFGVisualizer.java", "diffHunk": "@@ -206,21 +206,14 @@ protected String dotOutputFileName(UnderlyingAST ast) {\n         return outFileName;\n     }\n \n+    @Override\n+    protected String format(Object obj) {\n+        return escapeDoubleQuotes(obj);\n+    }\n+\n     @Override\n     public String visualizeBlockNode(Node t, @Nullable Analysis<V, S, T> analysis) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "082878c0e568a01bd2f5b72fdb48c2a7efec711e"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e0ee51b71aa12aca81a2b16b2e04ddbf2f5eecf", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/4e0ee51b71aa12aca81a2b16b2e04ddbf2f5eecf", "committedDate": "2020-06-26T01:15:26Z", "message": "Resolve comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f614780715da9ab08deba3aa4c2a78f830841be5", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/f614780715da9ab08deba3aa4c2a78f830841be5", "committedDate": "2020-06-26T18:00:57Z", "message": "Improve visualizer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b336186edc370098ad2a92c7d2ca50a42b071b5", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/8b336186edc370098ad2a92c7d2ca50a42b071b5", "committedDate": "2020-06-26T22:40:21Z", "message": "Improve code."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjU5ODIw", "url": "https://github.com/typetools/checker-framework/pull/3395#pullrequestreview-438659820", "createdAt": "2020-06-27T01:15:40Z", "commit": {"oid": "8b336186edc370098ad2a92c7d2ca50a42b071b5"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMToxNTo0MFrOGpyI7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMToyMDozNlrOGpyK2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2NjI4Ng==", "bodyText": "What happens if analysis is null? Before, it looks like an escapeString is appended when it is a SPECIAL_BLOCK.\nIs that missing now? Is that a problem or intended?", "url": "https://github.com/typetools/checker-framework/pull/3395#discussion_r446466286", "createdAt": "2020-06-27T01:15:40Z", "author": {"login": "wmdietl"}, "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/AbstractCFGVisualizer.java", "diffHunk": "@@ -204,20 +201,17 @@ protected String visualizeBlockHelper(\n                     @SuppressWarnings(\"nullness:contracts.precondition.not.satisfied\")\n                     S store = analysis.getResult().getStoreAfter(lastNode);\n                     StringBuilder sbStore = new StringBuilder();\n-                    sbStore.append(escapeString).append(\"~~~~~~~~~\").append(escapeString);\n+                    sbStore.append(\"~~~~~~~~~\").append(escapeString);\n                     sbStore.append(\"After: \");\n                     if (store != null) {\n                         sbStore.append(visualizeStore(store));\n                     } else {\n-                        sbStore.append(\"null store\");\n+                        sbStore.append(\"null store\").append(escapeString);\n                     }\n                     sbBlock.append(sbStore);\n                 }\n             }\n         }\n-        if (!centered) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b336186edc370098ad2a92c7d2ca50a42b071b5"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2NjY0NQ==", "bodyText": "Let's not use wildcard imports.", "url": "https://github.com/typetools/checker-framework/pull/3395#discussion_r446466645", "createdAt": "2020-06-27T01:19:35Z", "author": {"login": "wmdietl"}, "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/StringCFGVisualizer.java", "diffHunk": "@@ -1,10 +1,6 @@\n package org.checkerframework.dataflow.cfg;\n \n-import java.util.HashMap;\n-import java.util.IdentityHashMap;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b336186edc370098ad2a92c7d2ca50a42b071b5"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2Njc3OQ==", "bodyText": "Would it be hard to track down where the trailing spaces are coming from and make the output proper by construction?", "url": "https://github.com/typetools/checker-framework/pull/3395#discussion_r446466779", "createdAt": "2020-06-27T01:20:36Z", "author": {"login": "wmdietl"}, "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/StringCFGVisualizer.java", "diffHunk": "@@ -25,7 +20,7 @@\n     @Override\n     public Map<String, Object> visualize(\n             ControlFlowGraph cfg, Block entry, @Nullable Analysis<V, S, T> analysis) {\n-        String stringGraph = visualizeGraph(cfg, entry, analysis);\n+        String stringGraph = visualizeGraph(cfg, entry, analysis).trim();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b336186edc370098ad2a92c7d2ca50a42b071b5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35de3da62ca2b620ff875cdb490670355852f96f", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/35de3da62ca2b620ff875cdb490670355852f96f", "committedDate": "2020-06-27T02:05:36Z", "message": "Resolve comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "126bc36a6ba68e0cc1b48128f953d79863844519", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/126bc36a6ba68e0cc1b48128f953d79863844519", "committedDate": "2020-06-27T02:53:10Z", "message": "Resolve comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDYxNTg4", "url": "https://github.com/typetools/checker-framework/pull/3395#pullrequestreview-439061588", "createdAt": "2020-06-29T11:50:32Z", "commit": {"oid": "126bc36a6ba68e0cc1b48128f953d79863844519"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMTo1MDozMlrOGqNOdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMTo1MDozMlrOGqNOdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkxMDA2OA==", "bodyText": "Can you add a comment why the lineSeparator is only needed in this case?\nWasn't it nicer before with the Helper method that reduced duplication?", "url": "https://github.com/typetools/checker-framework/pull/3395#discussion_r446910068", "createdAt": "2020-06-29T11:50:32Z", "author": {"login": "wmdietl"}, "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/StringCFGVisualizer.java", "diffHunk": "@@ -73,15 +65,25 @@ public String visualizeBlock(Block bb, @Nullable Analysis<V, S, T> analysis) {\n \n     @Override\n     public String visualizeSpecialBlock(SpecialBlock sbb) {\n-        return super.visualizeSpecialBlockHelper(sbb, lineSeparator);\n+        switch (sbb.getSpecialType()) {\n+            case ENTRY:\n+                return \"<entry>\" + lineSeparator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "126bc36a6ba68e0cc1b48128f953d79863844519"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a58a7aa7ffd74e6d49f2d8a82d5a406d9f954edc", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/a58a7aa7ffd74e6d49f2d8a82d5a406d9f954edc", "committedDate": "2020-06-30T01:01:04Z", "message": "Revert \"Resolve comments.\"\n\nThis reverts commit 126bc36a"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1b06c3e44846318f643d84b98c8d390257f11fd", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/c1b06c3e44846318f643d84b98c8d390257f11fd", "committedDate": "2020-06-30T01:26:44Z", "message": "A better solution."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a85e0fb44b0e93aa484d2953c8f6cbfd9f7e6a3", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/5a85e0fb44b0e93aa484d2953c8f6cbfd9f7e6a3", "committedDate": "2020-06-30T01:27:16Z", "message": "Merge remote-tracking branch 'typetools/master' into typetools-improve-visualizer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4a985050e4b1d6505654cd9a1aaefc9f43b7b82", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/d4a985050e4b1d6505654cd9a1aaefc9f43b7b82", "committedDate": "2020-06-30T01:32:46Z", "message": "Remove trim()."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8363a9328de7041d536ea7d1d9a0f5cdd4c3a35", "author": {"user": {"login": "xingweitian", "name": "Weitian Xing"}}, "url": "https://github.com/typetools/checker-framework/commit/b8363a9328de7041d536ea7d1d9a0f5cdd4c3a35", "committedDate": "2020-06-30T19:28:02Z", "message": "Pull the lasted code."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2848, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}