{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMjUzMjgw", "number": 3193, "title": "Rename AnnotatedTypeMerger to AnnotatedTypeReplacer", "bodyText": "There was already a class named AnnotatedTypeReplacer, so also renamed that.\nBoth had names that were somewhat confusing:\n\nAnnotatedTypeMerger suggests that information from both types will be merged. In fact, it replaces the contents of one annotated type with the contents of another. I therefore renamed it to AnnotatedTypeReplacer, especially because its documentation already used the phrase \"replace\" extensively.\nthe old AnnotatedTypeReplacer copies an annotated type and makes replacements based on a separate map. I therefore renamed it to AnnotatedTypeCopierWithReplacement. As far as I can tell, it isn't used anywhere, so we may want to just delete it.\n\nRationale: I accidentally used AnnotatedTypeMerger when I wanted to merge two types, and got surprising results. I'll add a new class that actually merges two classes using the GLB as part of #2871, which requires that feature.", "createdAt": "2020-03-24T21:00:34Z", "url": "https://github.com/typetools/checker-framework/pull/3193", "merged": true, "mergeCommit": {"oid": "23840cc854ed8b80316121f55427bd44995b197e"}, "closed": true, "closedAt": "2020-03-26T15:59:55Z", "author": {"login": "kelloggm"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ5S6ZgH2gAyMzkzMjUzMjgwOjA5MmExZjA0MGRhODBkMzI0ZmVkZWZjZGJmMDg0M2JkMmU0NmEyOWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRlIxmAFqTM4MjQ5NTkxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "092a1f040da80d324fedefcdbf0843bd2e46a29d", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/092a1f040da80d324fedefcdbf0843bd2e46a29d", "committedDate": "2020-03-24T20:54:07Z", "message": "rename AnnotatedTypeMerger and AnnotatedTypeReplacer to names that are less confusing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a58b4633f83dc91b9f4548425abe13f877ac7c30", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/a58b4633f83dc91b9f4548425abe13f877ac7c30", "committedDate": "2020-03-24T20:56:19Z", "message": "add changelog entry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f497f4f1926ecba63d5ace8945d67e82e81b6d4f", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/f497f4f1926ecba63d5ace8945d67e82e81b6d4f", "committedDate": "2020-03-24T21:15:04Z", "message": "Merge branch 'master' of github.com:typetools/checker-framework into rename-annotated-type-merger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b8e26705f4fdb95c8e731440eb5a6a82c99d060", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/0b8e26705f4fdb95c8e731440eb5a6a82c99d060", "committedDate": "2020-03-24T21:32:42Z", "message": "add missing javadoc in keyforpropagator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaec0d04926543c46884c20a4149b74e02fc1b95", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/eaec0d04926543c46884c20a4149b74e02fc1b95", "committedDate": "2020-03-24T21:56:30Z", "message": "hopefully fix javadoc weirdness"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10230e995ccbfc08798027822ede5ba58a9ebd5c", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/10230e995ccbfc08798027822ede5ba58a9ebd5c", "committedDate": "2020-03-26T15:07:04Z", "message": "Merge ../checker-framework-branch-master into rename-annotated-type-merger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/8d6e012067947b03ee09d0eab0c1a764b2b9bf22", "committedDate": "2020-03-26T15:10:07Z", "message": "Put all renamings together in changelog.txt"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMTA3MDk0", "url": "https://github.com/typetools/checker-framework/pull/3193#pullrequestreview-382107094", "createdAt": "2020-03-26T15:10:36Z", "commit": {"oid": "eaec0d04926543c46884c20a4149b74e02fc1b95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDk1OTE4", "url": "https://github.com/typetools/checker-framework/pull/3193#pullrequestreview-382495918", "createdAt": "2020-03-26T23:49:17Z", "commit": {"oid": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzo0OToxN1rOF8eebw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzo1ODoxMVrOF8epVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk1ODE5MQ==", "bodyText": "The line above this one should now refer to AnnotatedTypeReplacer.", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398958191", "createdAt": "2020-03-26T23:49:17Z", "author": {"login": "wmdietl"}, "path": "framework/src/main/java/org/checkerframework/framework/stub/StubParser.java", "diffHunk": "@@ -1965,9 +1965,9 @@ private void putNew(\n                 // annotation exist in both types in the same location for the same hierarchy.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk1OTAyNg==", "bodyText": "The line above talks about merge. It also says that it does that instead of replacing them. So it is confusing that this now uses a replacer.", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398959026", "createdAt": "2020-03-26T23:51:57Z", "author": {"login": "wmdietl"}, "path": "framework/src/main/java/org/checkerframework/framework/type/TypeFromExpressionVisitor.java", "diffHunk": "@@ -353,10 +353,11 @@ public AnnotatedTypeMirror visitWildcard(WildcardTree node, AnnotatedTypeFactory\n         // This ensures that the structure of the wildcard will match that created by", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2MDIyNw==", "bodyText": "This comment still refers to merger.", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398960227", "createdAt": "2020-03-26T23:55:41Z", "author": {"login": "wmdietl"}, "path": "checker/src/main/java/org/checkerframework/checker/nullness/KeyForPropagator.java", "diffHunk": "@@ -178,23 +178,30 @@ public void propagateNewClassTree(\n      * An annotated type merger that merges @KeyFor annotations and only if the type that is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2MDUzNQ==", "bodyText": "The PR would be nicer if these parameter renamings happened separately, to focus on the essential changes.", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398960535", "createdAt": "2020-03-26T23:56:47Z", "author": {"login": "wmdietl"}, "path": "checker/src/main/java/org/checkerframework/checker/nullness/KeyForPropagator.java", "diffHunk": "@@ -178,23 +178,30 @@ public void propagateNewClassTree(\n      * An annotated type merger that merges @KeyFor annotations and only if the type that is\n      * receiving an annotation has an @UnknownKeyFor annotation or NO key for annotations.\n      */\n-    private class KeyForPropagationMerger extends AnnotatedTypeMerger {\n+    private class KeyForPropagationReplacer extends AnnotatedTypeReplacer {\n+\n+        /** The processing environment. */\n         private final ProcessingEnvironment env;\n \n-        private KeyForPropagationMerger(ProcessingEnvironment env) {\n+        /**\n+         * Create a new replacer.\n+         *\n+         * @param env the processing environment\n+         */\n+        private KeyForPropagationReplacer(ProcessingEnvironment env) {\n             this.env = env;\n         }\n \n         @Override\n-        protected void replaceAnnotations(AnnotatedTypeMirror from, AnnotatedTypeMirror to) {\n-            final AnnotationMirror fromKeyFor = from.getAnnotationInHierarchy(UNKNOWN_KEYFOR);\n-            final AnnotationMirror toKeyFor = to.getAnnotationInHierarchy(UNKNOWN_KEYFOR);\n+        protected void replaceAnnotations(AnnotatedTypeMirror src, AnnotatedTypeMirror dst) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2MDk4MQ==", "bodyText": "It would have been more consistent to rename to from and to, like in the earlier methods.", "url": "https://github.com/typetools/checker-framework/pull/3193#discussion_r398960981", "createdAt": "2020-03-26T23:58:11Z", "author": {"login": "wmdietl"}, "path": "framework/src/main/java/org/checkerframework/framework/type/visitor/AnnotatedTypeReplacer.java", "diffHunk": "@@ -69,14 +84,20 @@ protected Void combineRs(Void r1, Void r2) {\n         return r1;\n     }\n \n+    /**\n+     * Replace the annotations in dst with the annotations in src\n+     *\n+     * @param src the source of the annotations\n+     * @param dst the destination of the annotations\n+     */\n     protected void replaceAnnotations(\n-            final AnnotatedTypeMirror one, final AnnotatedTypeMirror two) {\n+            final AnnotatedTypeMirror src, final AnnotatedTypeMirror dst) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d6e012067947b03ee09d0eab0c1a764b2b9bf22"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2909, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}