{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NjA4MDI1", "number": 3726, "title": "Split getValueWithSameAnnotations() into getWidenedValue() and getNarrowedValue()", "bodyText": "", "createdAt": "2020-10-01T23:58:28Z", "url": "https://github.com/typetools/checker-framework/pull/3726", "merged": true, "mergeCommit": {"oid": "fd24374d3e38ed0f2c1818c2ccc28677cb53cfdb"}, "closed": true, "closedAt": "2020-10-03T02:17:13Z", "author": {"login": "mernst"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOTzV3gH2gAyNDk2NjA4MDI1OjAyZjhkMTE3ZmE2Y2YzNzQ0N2IyOTFhZWZhM2EyN2M5MjQ3Y2VlODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOrCJJAH2gAyNDk2NjA4MDI1OjdiODEzZjkzZmZjZGFmODJmYjcwNzNiNGU3NjVmYzlmYTZlNmYxYWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "02f8d117fa6cf37447b291aefa3a27c9247cee84", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/02f8d117fa6cf37447b291aefa3a27c9247cee84", "committedDate": "2020-10-01T16:16:27Z", "message": "Split getValueWithSameAnnotations() into getNarrowedValue() and getWidenedValue()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "881cb09519e1d059b0ca25416c130c10c8c6d6f5", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/881cb09519e1d059b0ca25416c130c10c8c6d6f5", "committedDate": "2020-10-01T18:26:00Z", "message": "Simplify CharCast test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b915467c4eef79d54516af159b96eba8f054b22", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/1b915467c4eef79d54516af159b96eba8f054b22", "committedDate": "2020-10-01T18:29:01Z", "message": "Further simplify CharCast test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16175bf7c242b6ac0ced38dced0bb97aaec8be83", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/16175bf7c242b6ac0ced38dced0bb97aaec8be83", "committedDate": "2020-10-01T18:31:33Z", "message": "Further simplify CharCast test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a1a965f548b86ce50213aa0f22ce1c7cf030ed6", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/7a1a965f548b86ce50213aa0f22ce1c7cf030ed6", "committedDate": "2020-10-01T18:33:55Z", "message": "Merge ../checker-framework-fork-mernst-branch-simplify-charcast-test into split-getValueWithSameAnnotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e729e1a4a0912c3c5286a8bf2e11ef3a6e1c82a", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/1e729e1a4a0912c3c5286a8bf2e11ef3a6e1c82a", "committedDate": "2020-10-01T19:50:08Z", "message": "Checkpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1499b0d971ea57cc2cfd34bf574f604c95a05998", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/1499b0d971ea57cc2cfd34bf574f604c95a05998", "committedDate": "2020-10-01T23:30:26Z", "message": "Only call getWidenedPrimitive if appropriate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "641f5ce16cfbae11647fc0e3e4739f92d8f2877e", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/641f5ce16cfbae11647fc0e3e4739f92d8f2877e", "committedDate": "2020-10-01T23:32:13Z", "message": "Merge ../checker-framework-branch-master into split-getValueWithSameAnnotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77aa867e19742ee600487d20a4f853a41312f69f", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/77aa867e19742ee600487d20a4f853a41312f69f", "committedDate": "2020-10-01T23:38:14Z", "message": "Augment documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc8679b206e23e4b5e60476245a2ed0d9a3e9ac3", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/cc8679b206e23e4b5e60476245a2ed0d9a3e9ac3", "committedDate": "2020-10-01T23:53:48Z", "message": "Mention widening before narrowing, consistent with the JLS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb215dfd3778604b36a3509ad7ebac2688590aa9", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/eb215dfd3778604b36a3509ad7ebac2688590aa9", "committedDate": "2020-10-01T23:59:05Z", "message": "Swap order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "584f071bbe5aee0966b9a543f51b87262eaef008", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/584f071bbe5aee0966b9a543f51b87262eaef008", "committedDate": "2020-10-02T00:01:15Z", "message": "Merge ../checker-framework-fork-mernst-branch-widening-before-narrowing into split-getValueWithSameAnnotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "355f6bfe1eba4f468ed65b6eb1fd6c99c3b79560", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/355f6bfe1eba4f468ed65b6eb1fd6c99c3b79560", "committedDate": "2020-10-02T00:21:01Z", "message": "Don't require Javadoc for whole file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af054742ebaa289ae9b3457dd1e60871cac22225", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/af054742ebaa289ae9b3457dd1e60871cac22225", "committedDate": "2020-10-02T00:28:36Z", "message": "Merge ../checker-framework-fork-mernst-branch-widening-before-narrowing into split-getValueWithSameAnnotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03cda54f4b0ef8d3c48b32df970f3049f37e3aa7", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/03cda54f4b0ef8d3c48b32df970f3049f37e3aa7", "committedDate": "2020-10-02T01:03:45Z", "message": "Add test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d725bc3d47bad4d8e60c0e775eef934cccb61043", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/d725bc3d47bad4d8e60c0e775eef934cccb61043", "committedDate": "2020-10-02T01:56:57Z", "message": "Merge ../checker-framework-branch-master into split-getValueWithSameAnnotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b959bd374fadba27c71b2cc915d0ea899c941207", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/b959bd374fadba27c71b2cc915d0ea899c941207", "committedDate": "2020-10-02T02:42:19Z", "message": "Merge ../checker-framework-branch-master into split-getValueWithSameAnnotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01cf64f14276573cc0e6d8bd4f77d855ce45e2d9", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/01cf64f14276573cc0e6d8bd4f77d855ce45e2d9", "committedDate": "2020-10-02T03:50:09Z", "message": "Fix bad merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b61580793b0f9b055ad9e36dae96fd4525f03432", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/b61580793b0f9b055ad9e36dae96fd4525f03432", "committedDate": "2020-10-02T03:50:34Z", "message": "Merge ../checker-framework-branch-master into split-getValueWithSameAnnotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c4caceb73270cd7370cbaa0274e452b34076123", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/7c4caceb73270cd7370cbaa0274e452b34076123", "committedDate": "2020-10-02T05:00:12Z", "message": "Merge ../checker-framework-branch-master into split-getValueWithSameAnnotations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzAwODY3", "url": "https://github.com/typetools/checker-framework/pull/3726#pullrequestreview-501300867", "createdAt": "2020-10-02T17:00:34Z", "commit": {"oid": "7c4caceb73270cd7370cbaa0274e452b34076123"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNzowMDozNVrOHb08Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNzoxMTowM1rOHb1P6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDk3NQ==", "bodyText": "Should this be reverted?", "url": "https://github.com/typetools/checker-framework/pull/3726#discussion_r498940975", "createdAt": "2020-10-02T17:00:35Z", "author": {"login": "smillst"}, "path": "checker/bin-devel/test-misc.sh", "diffHunk": "@@ -21,7 +21,7 @@ source \"$SCRIPTDIR\"/build.sh\n # Javadoc documentation\n # Uncomment this line temporarily for refactorings that touch a lot of code that\n # you don't understand.  Then, recomment it as soon as the pull request is merged.\n-# SKIPJAVADOC=1\n+SKIPJAVADOC=1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c4caceb73270cd7370cbaa0274e452b34076123"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0NDU2Ng==", "bodyText": "Should widenedTypeKind be renamed to narrowedTypeKind?", "url": "https://github.com/typetools/checker-framework/pull/3726#discussion_r498944566", "createdAt": "2020-10-02T17:08:03Z", "author": {"login": "smillst"}, "path": "checker/src/main/java/org/checkerframework/checker/signedness/SignednessAnnotatedTypeFactory.java", "diffHunk": "@@ -184,28 +188,39 @@ private void addSignednessGlbAnnotation(Tree tree, AnnotatedTypeMirror type) {\n             Set<AnnotationMirror> annos, TypeKind typeKind, TypeKind widenedTypeKind) {\n         assert annos.size() == 1;\n \n-        if (TypeKindUtils.isNarrower(typeKind, widenedTypeKind)) {\n-            Set<AnnotationMirror> result = AnnotationUtils.createAnnotationSet();\n-            if (TypeKindUtils.isFloatingPoint(widenedTypeKind)) {\n-                result.add(SIGNED);\n-                return result;\n-            }\n-            if (getQualifierHierarchy().isSubtype(annos.iterator().next(), UNSIGNED)) {\n-                result.add(SIGNED_POSITIVE_FROM_UNSIGNED);\n-                return result;\n-            } else {\n-                result.add(SIGNEDNESS_GLB);\n-                return result;\n-            }\n+        Set<AnnotationMirror> result = AnnotationUtils.createAnnotationSet();\n+        if (TypeKindUtils.isFloatingPoint(widenedTypeKind)) {\n+            result.add(SIGNED);\n+            return result;\n         }\n         if (widenedTypeKind == TypeKind.CHAR) {\n-            // It's a non-widening cast to char.  Make it @Unsigned.\n-            Set<AnnotationMirror> result = AnnotationUtils.createAnnotationSet();\n             result.add(UNSIGNED);\n             return result;\n         }\n-        if (widenedTypeKind == TypeKind.FLOAT || widenedTypeKind == TypeKind.DOUBLE) {\n-            Set<AnnotationMirror> result = AnnotationUtils.createAnnotationSet();\n+        AnnotationMirror anno = annos.iterator().next();\n+        if (AnnotationUtils.areSame(anno, POLY_SIGNED)) {\n+            return annos;\n+        } else if (getQualifierHierarchy().isSubtype(anno, UNSIGNED)) {\n+            // TODO: A future enhancement will make the widened type indicate the unsigned basetype\n+            // from which it was widened.\n+            result.add(SIGNED_POSITIVE_FROM_UNSIGNED);\n+            return result;\n+        } else {\n+            // TODO: A future enhancement will make the widened type indicate the signed basetype\n+            // from which it was widened.\n+            result.add(SIGNEDNESS_GLB);\n+            return result;\n+        }\n+    }\n+\n+    @Override\n+    public Set<AnnotationMirror> getNarrowedAnnotations(\n+            Set<AnnotationMirror> annos, TypeKind typeKind, TypeKind widenedTypeKind) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c4caceb73270cd7370cbaa0274e452b34076123"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0NjAyNw==", "bodyText": "I wouldn't call this a renaming.  CFAbstractTransfer.getValueWithSameAnnotations() was removed.  Also, we don't necessarily need to remove that method.  If we keep it in, then this change wouldn't be a breaking change.", "url": "https://github.com/typetools/checker-framework/pull/3726#discussion_r498946027", "createdAt": "2020-10-02T17:11:03Z", "author": {"login": "smillst"}, "path": "changelog.txt", "diffHunk": "@@ -1,3 +1,10 @@\n+Version 3.8.0, November 2, 2020\n+\n+Renamed CFAbstractTransfer.getValueWithSameAnnotations() to two methods", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c4caceb73270cd7370cbaa0274e452b34076123"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad47c3e34071f1d729d2a590af62c33e45a8591b", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/ad47c3e34071f1d729d2a590af62c33e45a8591b", "committedDate": "2020-10-02T17:33:11Z", "message": "Address code review feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdd72f363788bd893fe66d4791fee03b7ee9d2c4", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/bdd72f363788bd893fe66d4791fee03b7ee9d2c4", "committedDate": "2020-10-02T18:13:41Z", "message": "Update version number"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdbb074b7c09cd115f2119ff5ff57fe91b88d097", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/bdbb074b7c09cd115f2119ff5ff57fe91b88d097", "committedDate": "2020-10-02T18:29:49Z", "message": "Deprecate, don't remove"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "189f4cdc47114975e98b81edddd87611b1a8a9b4", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/189f4cdc47114975e98b81edddd87611b1a8a9b4", "committedDate": "2020-10-02T19:18:36Z", "message": "Add test case for #3710"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df9c3b7bcb558d19fca99a5e0f2b8292c2a9217b", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/df9c3b7bcb558d19fca99a5e0f2b8292c2a9217b", "committedDate": "2020-10-02T19:18:47Z", "message": "Add Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b813f93ffcdaf82fb7073b4e765fc9fa6e6f1ad", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/7b813f93ffcdaf82fb7073b4e765fc9fa6e6f1ad", "committedDate": "2020-10-02T19:20:26Z", "message": "Merge ../checker-framework-branch-master into split-getValueWithSameAnnotations"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2559, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}