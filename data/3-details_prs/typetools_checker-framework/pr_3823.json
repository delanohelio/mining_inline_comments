{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NTI3ODk0", "number": 3823, "title": "Enrich treatment of `@PolyNull`; fixes #3614", "bodyText": "", "createdAt": "2020-10-22T20:01:59Z", "url": "https://github.com/typetools/checker-framework/pull/3823", "merged": true, "mergeCommit": {"oid": "1a0712f39d12806a78b324ed17d281fc7a7d468b"}, "closed": true, "closedAt": "2020-10-29T19:52:08Z", "author": {"login": "mernst"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVFjs9AH2gAyNTA4NTI3ODk0OjM3ZjU0NmRlM2Q2NzlkZmMxMWUzOTNiYmQ4YmRmMTM1M2Q1NDVmMWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXWm67gH2gAyNTA4NTI3ODk0OjM0MjRlZjQxMWQxZWMyMmE0NzIyMGVlMDE0YzkwMzExYzEwYzA1NDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "37f546de3d679dfc11e393bbd8bdf1353d545f1f", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/37f546de3d679dfc11e393bbd8bdf1353d545f1f", "committedDate": "2020-10-22T17:38:10Z", "message": "Checkpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "539f56855ac95a1d033796b25b8c3c8239f36877", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/539f56855ac95a1d033796b25b8c3c8239f36877", "committedDate": "2020-10-22T17:39:28Z", "message": "Merge ../checker-framework-branch-master into issue3614"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb0baf0fa81d47166211c6aa06ab34cd407a5ec9", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/bb0baf0fa81d47166211c6aa06ab34cd407a5ec9", "committedDate": "2020-10-22T17:39:59Z", "message": "Merge ../checker-framework-branch-master into issue3614"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79314d55d72e030a4d1df684c40c4ba12b7416ad", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/79314d55d72e030a4d1df684c40c4ba12b7416ad", "committedDate": "2020-10-22T17:52:43Z", "message": "Override both versions of finishValue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e23b3d964f4219766dfaba5288d7f0d5877db919", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/e23b3d964f4219766dfaba5288d7f0d5877db919", "committedDate": "2020-10-22T17:59:21Z", "message": "Add new method Annotationutils.toStringSimple"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ad8426b3a9138c418c91eeb249190021d91068e", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/4ad8426b3a9138c418c91eeb249190021d91068e", "committedDate": "2020-10-22T18:12:56Z", "message": "Add Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "848e96f3cabaf838e035ae5547d369824ae62701", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/848e96f3cabaf838e035ae5547d369824ae62701", "committedDate": "2020-10-22T18:13:49Z", "message": "Remove diagnostic output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6784fa9d95e583a4e541fab4190564ee0c64502", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/a6784fa9d95e583a4e541fab4190564ee0c64502", "committedDate": "2020-10-22T18:59:38Z", "message": "Avoid NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01d33420d2070b9ca737f6760b0ba0bc981c5ae7", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/01d33420d2070b9ca737f6760b0ba0bc981c5ae7", "committedDate": "2020-10-22T19:01:35Z", "message": "Update a test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32de936c83830ebf07810ea67359dacfd4fb2eb9", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/32de936c83830ebf07810ea67359dacfd4fb2eb9", "committedDate": "2020-10-22T19:10:23Z", "message": "Merge ../checker-framework-fork-mernst-branch-nullnesstransfer-finishvalue into issue3614-precursors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2594596331066a5c653c823469c4f7881fe1ac11", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/2594596331066a5c653c823469c4f7881fe1ac11", "committedDate": "2020-10-22T19:12:04Z", "message": "Merge ../checker-framework-fork-mernst-branch-issue3614-precursors into issue3614"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d510fb26f9a5f7a0fd9f6cc6f72d5c09ca104772", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/d510fb26f9a5f7a0fd9f6cc6f72d5c09ca104772", "committedDate": "2020-10-22T19:13:45Z", "message": "Enable test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d73d8d5ca27e3e80d41fb704f99155e05b0f0c32", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/d73d8d5ca27e3e80d41fb704f99155e05b0f0c32", "committedDate": "2020-10-22T19:59:15Z", "message": "Update tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1941ee6ffce8c78997e2d5ec9d4cda6f265cb7f", "author": {"user": {"login": "smillst", "name": "Suzanne Millstein"}}, "url": "https://github.com/typetools/checker-framework/commit/b1941ee6ffce8c78997e2d5ec9d4cda6f265cb7f", "committedDate": "2020-10-22T20:14:25Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into issue3614\n\n# Conflicts:\n#\tchecker/src/main/java/org/checkerframework/checker/nullness/NullnessTransfer.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDg2Mjgx", "url": "https://github.com/typetools/checker-framework/pull/3823#pullrequestreview-515086281", "createdAt": "2020-10-22T20:17:37Z", "commit": {"oid": "b1941ee6ffce8c78997e2d5ec9d4cda6f265cb7f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMDoxNzozN1rOHmyQ-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMDoxNzozN1rOHmyQ-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQzMTQ4Mw==", "bodyText": "This needs to be updated.", "url": "https://github.com/typetools/checker-framework/pull/3823#discussion_r510431483", "createdAt": "2020-10-22T20:17:37Z", "author": {"login": "smillst"}, "path": "checker/src/main/java/org/checkerframework/checker/nullness/NullnessValue.java", "diffHunk": "@@ -3,18 +3,26 @@\n import java.util.Set;\n import javax.lang.model.element.AnnotationMirror;\n import javax.lang.model.type.TypeMirror;\n+import org.checkerframework.checker.nullness.qual.NonNull;\n import org.checkerframework.checker.nullness.qual.Nullable;\n import org.checkerframework.checker.nullness.qual.PolyNull;\n+import org.checkerframework.dataflow.qual.Pure;\n+import org.checkerframework.dataflow.qual.SideEffectFree;\n import org.checkerframework.framework.flow.CFAbstractAnalysis;\n import org.checkerframework.framework.flow.CFAbstractValue;\n import org.checkerframework.framework.flow.CFValue;\n+import org.checkerframework.javacutil.AnnotationUtils;\n+import org.checkerframework.javacutil.TypesUtils;\n \n /**\n  * Behaves just like {@link CFValue}, but additionally tracks whether at this point {@link PolyNull}\n  * is known to be {@link Nullable}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1941ee6ffce8c78997e2d5ec9d4cda6f265cb7f"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64ccae9e0090403bd9c99747f0129ed94ced2645", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/64ccae9e0090403bd9c99747f0129ed94ced2645", "committedDate": "2020-10-22T20:26:17Z", "message": "Update documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1b0b85ec1176c73e99f3c5d43fc54d22cb6f4ce", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/e1b0b85ec1176c73e99f3c5d43fc54d22cb6f4ce", "committedDate": "2020-10-22T20:43:24Z", "message": "Merge ../checker-framework-branch-master into issue3614"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b1f6d10e951d2131f16c2191a9ac4f05e807189", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/7b1f6d10e951d2131f16c2191a9ac4f05e807189", "committedDate": "2020-10-23T15:03:27Z", "message": "Merge ../checker-framework-branch-master into issue3614"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "132025055bfa573e3841b328903c3d8dfb3d1835", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/132025055bfa573e3841b328903c3d8dfb3d1835", "committedDate": "2020-10-24T13:01:05Z", "message": "Abstract out method ForwardAnalysisImpl.getParameters()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97794ddff0e131e87179a4ed657df143c6313b18", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/97794ddff0e131e87179a4ed657df143c6313b18", "committedDate": "2020-10-24T13:49:19Z", "message": "Checkpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9388345fb254506709f5e3ae29f08a30e9acd90", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/d9388345fb254506709f5e3ae29f08a30e9acd90", "committedDate": "2020-10-27T17:37:59Z", "message": "Merge ../checker-framework-branch-master into issue3614"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55539a40bbee7c74f3fd7250112b91c157d562bd", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/55539a40bbee7c74f3fd7250112b91c157d562bd", "committedDate": "2020-10-27T18:41:09Z", "message": "Complete polyNullIsNonNull, remove debugging output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e3067dccfa6a5f482bbc436532c844ce0140a34", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/7e3067dccfa6a5f482bbc436532c844ce0140a34", "committedDate": "2020-10-27T20:40:46Z", "message": "Can't determine if component `@PolyNull` tyes are actually `@NonNull`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84837e0ffc8b2ba4a042ebfb83ce5e22fd6aa115", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/84837e0ffc8b2ba4a042ebfb83ce5e22fd6aa115", "committedDate": "2020-10-27T21:29:36Z", "message": "Javadoc fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28d33cc35c447bdc068d6484071cfcef5c20b3a7", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/28d33cc35c447bdc068d6484071cfcef5c20b3a7", "committedDate": "2020-10-27T21:37:08Z", "message": "Handle type variables and wildcards conservatively"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4OTUyMTYx", "url": "https://github.com/typetools/checker-framework/pull/3823#pullrequestreview-518952161", "createdAt": "2020-10-28T18:08:46Z", "commit": {"oid": "28d33cc35c447bdc068d6484071cfcef5c20b3a7"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxODowODo0N1rOHp3R4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxODoyMjozN1rOHp3zng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY1OTM2MQ==", "bodyText": "te -> to", "url": "https://github.com/typetools/checker-framework/pull/3823#discussion_r513659361", "createdAt": "2020-10-28T18:08:47Z", "author": {"login": "smillst"}, "path": "checker/src/main/java/org/checkerframework/checker/nullness/NullnessStore.java", "diffHunk": "@@ -44,22 +48,26 @@ public NullnessStore(\n             CFAbstractAnalysis<NullnessValue, NullnessStore, ?> analysis,\n             boolean sequentialSemantics) {\n         super(analysis, sequentialSemantics);\n+        isPolyNullNonNull = false;\n         isPolyNullNull = false;\n     }\n \n+    /**\n+     * Create a NullnessStore (copy constructor).\n+     *\n+     * @param s a store te copy", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28d33cc35c447bdc068d6484071cfcef5c20b3a7"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY2MjcyMA==", "bodyText": "You can do this by using a SimpleAnnotatedTypeScanner:\nnew SimpleAnnotatedTypeScanner<>(\n                    (type, p) ->\n                            type.hasAnnotation(POLYNULL),\n                    Boolean::logicalOr,\n                    false);", "url": "https://github.com/typetools/checker-framework/pull/3823#discussion_r513662720", "createdAt": "2020-10-28T18:14:15Z", "author": {"login": "smillst"}, "path": "checker/src/main/java/org/checkerframework/checker/nullness/NullnessTransfer.java", "diffHunk": "@@ -205,6 +225,78 @@ protected NullnessValue finishValue(\n         return res;\n     }\n \n+    /**\n+     * Returns true if every formal parameter that is declared as @PolyNull is currently known to be\n+     * non-null.\n+     *\n+     * @param method a method\n+     * @param s a store\n+     * @return true if every formal parameter declared as @PolyNull is non-null\n+     */\n+    private boolean polyNullIsNonNull(ExecutableElement method, NullnessStore s) {\n+        // No need to check the receiver, which is always non-null.\n+        for (VariableElement var : method.getParameters()) {\n+            AnnotatedTypeMirror varType = atypeFactory.fromElement(var);\n+\n+            if (containsPolyNullNotAtTopLevel(varType)) {\n+                return false;\n+            }\n+\n+            if (varType.hasAnnotation(POLYNULL)) {\n+                NullnessValue v = s.getValue(new LocalVariable(var));\n+                if (!AnnotationUtils.containsSameByName(v.getAnnotations(), NONNULL)) {\n+                    return false;\n+                }\n+            }\n+        }\n+        return true;\n+    }\n+\n+    /**\n+     * Returns true if there is an occurrence of @PolyNull that is not at the top level.\n+     *\n+     * @param t a type\n+     * @return true if there is an occurrence of @PolyNull that is not at the top level\n+     */\n+    private boolean containsPolyNullNotAtTopLevel(AnnotatedTypeMirror t) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28d33cc35c447bdc068d6484071cfcef5c20b3a7"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY2Nzk5OA==", "bodyText": "Should this change be reverted?  You can call getTypeFactory() to access this field.", "url": "https://github.com/typetools/checker-framework/pull/3823#discussion_r513667998", "createdAt": "2020-10-28T18:22:37Z", "author": {"login": "smillst"}, "path": "framework/src/main/java/org/checkerframework/framework/flow/CFAbstractAnalysis.java", "diffHunk": "@@ -51,7 +51,7 @@\n     protected final DependentTypesHelper dependentTypesHelper;\n \n     /** A type factory that can provide static type annotations for AST Trees. */\n-    protected final GenericAnnotatedTypeFactory<V, S, T, ? extends CFAbstractAnalysis<V, S, T>>\n+    public final GenericAnnotatedTypeFactory<V, S, T, ? extends CFAbstractAnalysis<V, S, T>>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28d33cc35c447bdc068d6484071cfcef5c20b3a7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62ffa7a61f7dec63a8bbbbe2d3f83b30fc64815a", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/62ffa7a61f7dec63a8bbbbe2d3f83b30fc64815a", "committedDate": "2020-10-28T22:02:49Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13cd08a970d7ea42ff0b3e1c40918bde59919967", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/13cd08a970d7ea42ff0b3e1c40918bde59919967", "committedDate": "2020-10-28T22:10:52Z", "message": "Use getter, not field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3424ef411d1ec22a47220ee014c90311c10c0548", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/3424ef411d1ec22a47220ee014c90311c10c0548", "committedDate": "2020-10-29T18:37:55Z", "message": "Use a Scanner"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2460, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}