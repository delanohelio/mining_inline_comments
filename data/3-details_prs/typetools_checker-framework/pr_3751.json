{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NjAyMTAz", "number": 3751, "title": "`@MatchesRegex` annotation for Constant Value Checker", "bodyText": "", "createdAt": "2020-10-08T01:31:12Z", "url": "https://github.com/typetools/checker-framework/pull/3751", "merged": true, "mergeCommit": {"oid": "7668070293ba893f1070f0765c9587fa0d36a6c4"}, "closed": true, "closedAt": "2020-10-17T14:26:04Z", "author": {"login": "kelloggm"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQT8NVgH2gAyNDk5NjAyMTAzOmUzMDY2ZTA1MGZlNmIzNTg2M2YyMDkxNjkxMzAzNmYxNTdkMmQ5NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTbzKbgFqTUxMDk4OTUyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e3066e050fe6b35863f20916913036f157d2d95e", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/e3066e050fe6b35863f20916913036f157d2d95e", "committedDate": "2020-10-07T21:33:59Z", "message": "docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cfeb295ad3efaa04e6a8ae728a357480235b9f7", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/3cfeb295ad3efaa04e6a8ae728a357480235b9f7", "committedDate": "2020-10-08T00:01:17Z", "message": "intentionally failing test + annotation def"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb10a1d39a80f6ead9a2e43fea26d156876e5509", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/fb10a1d39a80f6ead9a2e43fea26d156876e5509", "committedDate": "2020-10-08T01:27:05Z", "message": "working draft of @MatchesRegex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9f24e11bc3742c8dab5eee04f17d3c53e93c7e2", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/d9f24e11bc3742c8dab5eee04f17d3c53e93c7e2", "committedDate": "2020-10-08T01:30:11Z", "message": "small simplification to make it prettier"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8439e61f8f40a2336a052f65e7540f3b58c6dcb2", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/8439e61f8f40a2336a052f65e7540f3b58c6dcb2", "committedDate": "2020-10-08T18:40:16Z", "message": "add note to changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f5a338396128605e957b31e30fc1d598984af89", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/8f5a338396128605e957b31e30fc1d598984af89", "committedDate": "2020-10-09T02:56:20Z", "message": "Merge ../checker-framework-branch-master into matches-regex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88e87dd0927003d85adc54a687a60f8e04aaae8d", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/88e87dd0927003d85adc54a687a60f8e04aaae8d", "committedDate": "2020-10-09T03:09:03Z", "message": "Documentation improvements and a failing test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MzI4ODE5", "url": "https://github.com/typetools/checker-framework/pull/3751#pullrequestreview-505328819", "createdAt": "2020-10-09T03:00:46Z", "commit": {"oid": "8439e61f8f40a2336a052f65e7540f3b58c6dcb2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMzowMDo0NlrOHe5URA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMzowMTo0OFrOHe5VPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjE1ODQwNA==", "bodyText": "This code does not do that.  To achieve this, you would need to call Pattern.quote and also add ^ and $ anchors.\nAlso note that the strings are not necessarily legal regular expressions.", "url": "https://github.com/typetools/checker-framework/pull/3751#discussion_r502158404", "createdAt": "2020-10-09T03:00:46Z", "author": {"login": "mernst"}, "path": "framework/src/main/java/org/checkerframework/common/value/ValueAnnotatedTypeFactory.java", "diffHunk": "@@ -936,6 +953,19 @@ public AnnotationMirror createArrayLenRangeAnnotation(Range range) {\n         return createArrayLenAnnotation(ValueCheckerUtils.getLengthsForStringValues(values));\n     }\n \n+    /**\n+     * Converts an {@code StringVal} annotation to an {@code MatchesRegex} annotation that matches\n+     * exactly the string values listed in the {@code StringVal}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8439e61f8f40a2336a052f65e7540f3b58c6dcb2"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjE1ODY1Mg==", "bodyText": "Please add a @Regex annotation.  That would have caught the problem I noted above.", "url": "https://github.com/typetools/checker-framework/pull/3751#discussion_r502158652", "createdAt": "2020-10-09T03:01:48Z", "author": {"login": "mernst"}, "path": "framework/src/main/java/org/checkerframework/common/value/ValueAnnotatedTypeFactory.java", "diffHunk": "@@ -917,6 +922,18 @@ public AnnotationMirror createArrayLenRangeAnnotation(Range range) {\n         }\n     }\n \n+    /**\n+     * Creates an {@code MatchesRegex} annotation for the given regular expressions.\n+     *\n+     * @param regexes a list of Java regular expressions\n+     * @return a MatchesRegex annotation with those values\n+     */\n+    private AnnotationMirror createMatchesRegexAnnotation(List<String> regexes) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8439e61f8f40a2336a052f65e7540f3b58c6dcb2"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deac1ff9cab3a4ab28fc436d16d4fbc4c14c7032", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/deac1ff9cab3a4ab28fc436d16d4fbc4c14c7032", "committedDate": "2020-10-09T19:13:43Z", "message": "fix handling of malformed regexes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "310accaa60b3e324ef0e17b91104ba1f7a79bdc1", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/310accaa60b3e324ef0e17b91104ba1f7a79bdc1", "committedDate": "2020-10-09T21:27:13Z", "message": "document some methods that are unrelated to this PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41be934b33212fe76f27e26b481e96776d632b67", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/41be934b33212fe76f27e26b481e96776d632b67", "committedDate": "2020-10-10T05:24:24Z", "message": "Merge ../checker-framework-branch-master into matches-regex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6dcd7699863056cd17eee591438c531b12e832d", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/d6dcd7699863056cd17eee591438c531b12e832d", "committedDate": "2020-10-10T05:44:40Z", "message": "Add a test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a842df72c813f899976faccd5a4f934b526ebc23", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/a842df72c813f899976faccd5a4f934b526ebc23", "committedDate": "2020-10-10T05:45:11Z", "message": "Merge branch 'matches-regex' of github.com:kelloggm/checker-framework into matches-regex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80a6d70588debb5e5c2f7a18d2d00f3c883964e3", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/80a6d70588debb5e5c2f7a18d2d00f3c883964e3", "committedDate": "2020-10-10T05:47:45Z", "message": "More tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9872092a5b1d9caa2630369933e289244eedb14", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/b9872092a5b1d9caa2630369933e289244eedb14", "committedDate": "2020-10-10T05:58:52Z", "message": "Tweaks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDY4ODA0", "url": "https://github.com/typetools/checker-framework/pull/3751#pullrequestreview-506068804", "createdAt": "2020-10-10T05:41:44Z", "commit": {"oid": "310accaa60b3e324ef0e17b91104ba1f7a79bdc1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwNTo0MTo0NFrOHfdbzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwNjowMDowN1rOHfdhGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MDE1Nw==", "bodyText": "Does \"match\" mean that the regular expression matches the entire expression, with implicit anchoring at the beginning and end, or that the regex  matches somewhere in the string (some subset of the string)?  Please be explicit about the meaning.", "url": "https://github.com/typetools/checker-framework/pull/3751#discussion_r502750157", "createdAt": "2020-10-10T05:41:44Z", "author": {"login": "mernst"}, "path": "docs/manual/constant-value-checker.tex", "diffHunk": "@@ -72,11 +74,17 @@\n only the minimum and maximum lengths are used in \\<@ArrayLenRange>,\n giving a range of possible lengths of the string.\n \n-The \\<@StringVal> annotation may be applied to a char array.  Although byte\n-arrays are often converted to/from strings, the \\<@StringVal> annotation may\n+The \\<@StringVal> and \\<@MatchesRegex> annotations may be applied to char arrays.  Although byte\n+arrays are often converted to/from strings, these annotations may\n not be applied to them.  This is because the conversion depends on the\n platform's character set.\n \n+The \\<@MatchesRegex> annotation uses the standard Java regular expression syntax.\n+\\<@MatchesRegex(A)> is only a subtype of \\<@MatchesRegex(B)> if the set of regular\n+expressions \\<A> is a subset of the set of regular expressions \\<B>. An \\<@StringVal> annotation is\n+a subtype of an \\<@MatchesRegex> annotation if each string matches at least one of the regular", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "310accaa60b3e324ef0e17b91104ba1f7a79bdc1"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MDMyNA==", "bodyText": "Please be explicit about the meaning of \"matches\":  whether the regex must match the entire string (the regex is implicitly anchored at the beginning and end) or is permitted to match a substring.\nGiving some examples would be helpful too:  adding either anchoring or .* to obtain the other behavior than what is the default.  Please add tests like that too.", "url": "https://github.com/typetools/checker-framework/pull/3751#discussion_r502750324", "createdAt": "2020-10-10T05:44:12Z", "author": {"login": "mernst"}, "path": "framework/src/main/java/org/checkerframework/common/value/qual/MatchesRegex.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.checkerframework.common.value.qual;\n+\n+import java.lang.annotation.Documented;\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+import org.checkerframework.framework.qual.SubtypeOf;\n+\n+/**\n+ * An annotation indicating the possible values for a String type. If an expression's type has this\n+ * annotation, then at run time, the expression evaluates to a string that matches at least one of", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "310accaa60b3e324ef0e17b91104ba1f7a79bdc1"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MTUxMg==", "bodyText": "Because your implementation uses matches rather than Matcher.find, you do not need these anchors.  The tests all pass without them.", "url": "https://github.com/typetools/checker-framework/pull/3751#discussion_r502751512", "createdAt": "2020-10-10T06:00:07Z", "author": {"login": "mernst"}, "path": "framework/src/main/java/org/checkerframework/common/value/ValueAnnotatedTypeFactory.java", "diffHunk": "@@ -936,7 +968,30 @@ public AnnotationMirror createArrayLenRangeAnnotation(Range range) {\n         return createArrayLenAnnotation(ValueCheckerUtils.getLengthsForStringValues(values));\n     }\n \n-    /** Converts an {@code @ArrayLen} annotation to an {@code @ArrayLenRange} annotation. */\n+    /**\n+     * Converts an {@code StringVal} annotation to an {@code MatchesRegex} annotation that matches\n+     * exactly the string values listed in the {@code StringVal}.\n+     *\n+     * @param stringValAnno a StringVal annotation\n+     * @return an equivalent MatchesReges annotation\n+     */\n+    /* package-private */ AnnotationMirror convertStringValToMatchesRegex(\n+            AnnotationMirror stringValAnno) {\n+        List<String> values = getStringValues(stringValAnno);\n+        List<@Regex String> valuesAsRegexes = new ArrayList<>();\n+        for (String value : values) {\n+            // Quote the String, and surround it with start-of-string and end-of-string markers.\n+            valuesAsRegexes.add(\"^\" + Pattern.quote(value) + \"$\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9872092a5b1d9caa2630369933e289244eedb14"}, "originalPosition": 141}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61528f0386fc8e57c19be06955a1855919769ef", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/e61528f0386fc8e57c19be06955a1855919769ef", "committedDate": "2020-10-13T22:03:01Z", "message": "Merge branch 'master' of github.com:typetools/checker-framework into matches-regex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4abab483a858e7929299fa9a7f31d918f5e2172a", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/4abab483a858e7929299fa9a7f31d918f5e2172a", "committedDate": "2020-10-13T23:38:11Z", "message": "address feedback from PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbc137eaebeb861ac38e66a143669fd9635084e3", "author": {"user": {"login": "kelloggm", "name": "Martin Kellogg"}}, "url": "https://github.com/typetools/checker-framework/commit/cbc137eaebeb861ac38e66a143669fd9635084e3", "committedDate": "2020-10-14T00:31:33Z", "message": "escape hashtags in latex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3b17c01daf5bfeebf4f309ef16a462b6edce02a", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/a3b17c01daf5bfeebf4f309ef16a462b6edce02a", "committedDate": "2020-10-16T04:08:04Z", "message": "Merge ../checker-framework-branch-master into matches-regex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f4e025973482313672db6d4dcc8bcdbbe6c6fbf", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/2f4e025973482313672db6d4dcc8bcdbbe6c6fbf", "committedDate": "2020-10-17T04:54:12Z", "message": "Merge ../checker-framework-branch-master into matches-regex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7c69d0babf7a25c06162deadf90dad0d5b01555", "author": {"user": {"login": "mernst", "name": "Michael Ernst"}}, "url": "https://github.com/typetools/checker-framework/commit/c7c69d0babf7a25c06162deadf90dad0d5b01555", "committedDate": "2020-10-17T05:05:01Z", "message": "Code review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTg5NTI3", "url": "https://github.com/typetools/checker-framework/pull/3751#pullrequestreview-510989527", "createdAt": "2020-10-17T14:25:07Z", "commit": {"oid": "c7c69d0babf7a25c06162deadf90dad0d5b01555"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2568, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}