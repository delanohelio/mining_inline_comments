{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NjY5NDY0", "number": 776, "title": "PLANNER-1978 Score-related deprecations", "bodyText": "Some of these changes are just a little bit invasive. Please see code review comments.", "createdAt": "2020-05-12T11:39:59Z", "url": "https://github.com/kiegroup/optaplanner/pull/776", "merged": true, "mergeCommit": {"oid": "faa1ff1738c8bd922119a311acbab6a8ce58b235"}, "closed": true, "closedAt": "2020-05-13T06:44:58Z", "author": {"login": "triceo"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgi95FAFqTQwOTk2NTUzNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgysouAH2gAyNDE2NjY5NDY0OjUwMGY1MDUxY2RhMzIwNzQyMWFkMmY5YTJlZWM2ODFjYzk0NTQ5ODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTY1NTM0", "url": "https://github.com/kiegroup/optaplanner/pull/776#pullrequestreview-409965534", "createdAt": "2020-05-12T11:56:02Z", "commit": {"oid": "cd2c6a9b7806a20370b5288379d60fe2d318b088"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTo1NjowMlrOGUDCcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTo1NjowMlrOGUDCcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3NDQ4Mw==", "bodyText": "I was able to replace methods on the individual Score implementations with this one.", "url": "https://github.com/kiegroup/optaplanner/pull/776#discussion_r423674483", "createdAt": "2020-05-12T11:56:02Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/api/score/Score.java", "diffHunk": "@@ -60,15 +63,22 @@\n      * For example {@code -7init/0hard/-8soft} returns {@code 0hard/-8soft}.\n      *\n      * @return equal score except that {@link #getInitScore()} is {@code 0}.\n+     * @deprecated Use {@link #withInitScore(int)} with 0 as the argument.\n      */\n-    Score_ toInitializedScore();\n+    @Deprecated\n+    default Score_ toInitializedScore() {\n+        if (isSolutionInitialized()) {\n+            return (Score_) this;\n+        } else {\n+            return withInitScore(0);\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd2c6a9b7806a20370b5288379d60fe2d318b088"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTY1NzM5", "url": "https://github.com/kiegroup/optaplanner/pull/776#pullrequestreview-409965739", "createdAt": "2020-05-12T11:56:22Z", "commit": {"oid": "cd2c6a9b7806a20370b5288379d60fe2d318b088"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTo1NjoyMlrOGUDDBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTo1NjoyMlrOGUDDBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3NDYzMQ==", "bodyText": "Noteworthy, I anticipate comments here.", "url": "https://github.com/kiegroup/optaplanner/pull/776#discussion_r423674631", "createdAt": "2020-05-12T11:56:22Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/api/score/Score.java", "diffHunk": "@@ -155,6 +165,22 @@\n      */\n     boolean isCompatibleArithmeticArgument(Score otherScore);\n \n+    /**\n+     * A {@link PlanningSolution} is feasible if it has no broken hard constraints\n+     * and {@link #isSolutionInitialized()} is true.\n+     *\n+     * Simple scores ({@link SimpleScore}, {@link SimpleLongScore}, {@link SimpleBigDecimalScore}) are always feasible.\n+     *\n+     * @return true if the hard score is 0 or higher and the {@link #getInitScore()} is 0.\n+     */\n+    default boolean isFeasible() {\n+        /*\n+         * This exception will only be thrown for custom scores that did not implement FeasibilityScore.\n+         * TODO Safe to remove this default implementation once FeasibilityScore has been removed in 8.0.\n+         */\n+        throw new UnsupportedOperationException();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd2c6a9b7806a20370b5288379d60fe2d318b088"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTY2MDQ1", "url": "https://github.com/kiegroup/optaplanner/pull/776#pullrequestreview-409966045", "createdAt": "2020-05-12T11:56:48Z", "commit": {"oid": "cd2c6a9b7806a20370b5288379d60fe2d318b088"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTo1Njo0OFrOGUDD5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTo1Njo0OFrOGUDD5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3NDg1NA==", "bodyText": "Technically this is a backwards incompatible change. Used to throw, doesn't anymore. I think it should be fine.", "url": "https://github.com/kiegroup/optaplanner/pull/776#discussion_r423674854", "createdAt": "2020-05-12T11:56:48Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/api/score/Score.java", "diffHunk": "@@ -60,15 +63,22 @@\n      * For example {@code -7init/0hard/-8soft} returns {@code 0hard/-8soft}.\n      *\n      * @return equal score except that {@link #getInitScore()} is {@code 0}.\n+     * @deprecated Use {@link #withInitScore(int)} with 0 as the argument.\n      */\n-    Score_ toInitializedScore();\n+    @Deprecated\n+    default Score_ toInitializedScore() {\n+        if (isSolutionInitialized()) {\n+            return (Score_) this;\n+        } else {\n+            return withInitScore(0);\n+        }\n+    }\n \n     /**\n      * For example {@code 0hard/-8soft} with {@code -7} returns {@code -7init/0hard/-8soft}.\n      *\n      * @param newInitScore always negative (except in statistical calculations), 0 if all planning variables are initialized\n      * @return equals score except that {@link #getInitScore()} is set to {@code newInitScore}\n-     * @throws IllegalStateException if the original {@link #getInitScore()} is not 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd2c6a9b7806a20370b5288379d60fe2d318b088"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd2c6a9b7806a20370b5288379d60fe2d318b088", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/cd2c6a9b7806a20370b5288379d60fe2d318b088", "committedDate": "2020-05-12T11:52:50Z", "message": "Fix compilation"}, "afterCommit": {"oid": "a7ebb05d5d6c7a0712a1ba35c41f8d98c48a9cc8", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/a7ebb05d5d6c7a0712a1ba35c41f8d98c48a9cc8", "committedDate": "2020-05-12T11:57:56Z", "message": "Fix compilation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8db27a3612e13e6c7c647dc7608f24b634db4f29", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/8db27a3612e13e6c7c647dc7608f24b634db4f29", "committedDate": "2020-05-12T12:04:14Z", "message": "Deprecate FeasibilityScore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a2d00bbbef0d8a9111da71e558804f3db00ac99", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/4a2d00bbbef0d8a9111da71e558804f3db00ac99", "committedDate": "2020-05-12T12:04:30Z", "message": "Remove FeasibilityScoreDefinition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "646b73a7205189ae50b3b06b1724296d76d4b558", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/646b73a7205189ae50b3b06b1724296d76d4b558", "committedDate": "2020-05-12T12:04:31Z", "message": "toInitializedScore() is deprecated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f0cc118f0527dfb90a5806e48f77c4506884997", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/8f0cc118f0527dfb90a5806e48f77c4506884997", "committedDate": "2020-05-12T12:04:31Z", "message": "Deprecate various comparators"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f044ef1d4a0fe3646bf20e26c892b73231017bf", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/4f044ef1d4a0fe3646bf20e26c892b73231017bf", "committedDate": "2020-05-12T12:02:20Z", "message": "Merge branch 'master' into PLANNER-1978"}, "afterCommit": {"oid": "8f0cc118f0527dfb90a5806e48f77c4506884997", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/8f0cc118f0527dfb90a5806e48f77c4506884997", "committedDate": "2020-05-12T12:04:31Z", "message": "Deprecate various comparators"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/55296c27897b7a14a9fd8a1791953133ead2d9b3", "committedDate": "2020-05-12T12:49:39Z", "message": "Fix Sonar code smell"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTQzMDU2", "url": "https://github.com/kiegroup/optaplanner/pull/776#pullrequestreview-410143056", "createdAt": "2020-05-12T15:09:39Z", "commit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNTowOTo0MFrOGULcNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNTowOTo0MFrOGULcNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgxMjE1MQ==", "bodyText": "not sure if it's worth adding, but \"(unless their {@link #getInitScore()} isn't 0)\"", "url": "https://github.com/kiegroup/optaplanner/pull/776#discussion_r423812151", "createdAt": "2020-05-12T15:09:40Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/api/score/Score.java", "diffHunk": "@@ -155,6 +165,22 @@\n      */\n     boolean isCompatibleArithmeticArgument(Score otherScore);\n \n+    /**\n+     * A {@link PlanningSolution} is feasible if it has no broken hard constraints\n+     * and {@link #isSolutionInitialized()} is true.\n+     *\n+     * Simple scores ({@link SimpleScore}, {@link SimpleLongScore}, {@link SimpleBigDecimalScore}) are always feasible.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTQ5MTcx", "url": "https://github.com/kiegroup/optaplanner/pull/776#pullrequestreview-410149171", "createdAt": "2020-05-12T15:16:02Z", "commit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNToxNjowMlrOGULvQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNToxNjowMlrOGULvQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgxNzAyNw==", "bodyText": "\"it is trivial to implement\" says the rocket engineer on how to build a V2 missle :)\nMaybe mention how to build a comparator on natural comparison? Especially in the upgrade recipe, to save users from have to look that up on SO.", "url": "https://github.com/kiegroup/optaplanner/pull/776#discussion_r423817027", "createdAt": "2020-05-12T15:16:02Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/api/score/comparator/NaturalScoreComparator.java", "diffHunk": "@@ -23,7 +23,10 @@\n \n /**\n  * Compares by the natural order of {@link Score}s.\n+ * \n+ * @deprecated If you need this, it is trivial to implement.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTUyNzAw", "url": "https://github.com/kiegroup/optaplanner/pull/776#pullrequestreview-410152700", "createdAt": "2020-05-12T15:19:38Z", "commit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNToxOTozOFrOGUL5zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNToxOTozOFrOGUL5zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgxOTcyNg==", "bodyText": "AbstractScoreDefinition implements ScoreDefinition, no need to mention it twice. Remove the \"implements\".\nSame in other files.", "url": "https://github.com/kiegroup/optaplanner/pull/776#discussion_r423819726", "createdAt": "2020-05-12T15:19:38Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/score/buildin/hardmediumsoft/HardMediumSoftScoreDefinition.java", "diffHunk": "@@ -21,11 +21,13 @@\n import org.optaplanner.core.api.score.buildin.hardmediumsoft.HardMediumSoftScore;\n import org.optaplanner.core.api.score.buildin.hardmediumsoft.HardMediumSoftScoreHolder;\n import org.optaplanner.core.config.score.trend.InitializingScoreTrendLevel;\n-import org.optaplanner.core.impl.score.definition.AbstractFeasibilityScoreDefinition;\n+import org.optaplanner.core.impl.score.definition.AbstractScoreDefinition;\n+import org.optaplanner.core.impl.score.definition.ScoreDefinition;\n import org.optaplanner.core.impl.score.inliner.ScoreInliner;\n import org.optaplanner.core.impl.score.trend.InitializingScoreTrend;\n \n-public class HardMediumSoftScoreDefinition extends AbstractFeasibilityScoreDefinition<HardMediumSoftScore> {\n+public class HardMediumSoftScoreDefinition extends AbstractScoreDefinition<HardMediumSoftScore>\n+        implements ScoreDefinition<HardMediumSoftScore> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTUzNjI4", "url": "https://github.com/kiegroup/optaplanner/pull/776#pullrequestreview-410153628", "createdAt": "2020-05-12T15:20:33Z", "commit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNToyMDozM1rOGUL8qQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNToyMDozM1rOGUL8qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgyMDQ1Nw==", "bodyText": "same here, AbstractScoreDefinition already implements it", "url": "https://github.com/kiegroup/optaplanner/pull/776#discussion_r423820457", "createdAt": "2020-05-12T15:20:33Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/score/definition/AbstractBendableScoreDefinition.java", "diffHunk": "@@ -18,8 +18,8 @@\n \n import org.optaplanner.core.api.score.FeasibilityScore;\n \n-public abstract class AbstractBendableScoreDefinition<S extends FeasibilityScore<S>>\n-        extends AbstractFeasibilityScoreDefinition<S> {\n+public abstract class AbstractBendableScoreDefinition<S extends FeasibilityScore<S>> extends AbstractScoreDefinition<S>\n+        implements ScoreDefinition<S> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTU3MDU2", "url": "https://github.com/kiegroup/optaplanner/pull/776#pullrequestreview-410157056", "createdAt": "2020-05-12T15:24:01Z", "commit": {"oid": "55296c27897b7a14a9fd8a1791953133ead2d9b3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4664976d20074526600c10ae2b99bd39895c5572", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/4664976d20074526600c10ae2b99bd39895c5572", "committedDate": "2020-05-13T06:00:54Z", "message": "Fix SimpleScore feasibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "159409465003138be0c494ea745970ed2152f3fe", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/159409465003138be0c494ea745970ed2152f3fe", "committedDate": "2020-05-13T06:03:31Z", "message": "Better deprecation message for Comparators"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f229ff0b7311b4f18da776f5c361ca3a2dfd492", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/2f229ff0b7311b4f18da776f5c361ca3a2dfd492", "committedDate": "2020-05-13T06:07:10Z", "message": "AbstractScoreDefinition already implements ScoreDefinition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "500f5051cda3207421ad2f9a2eec681cc9454989", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/500f5051cda3207421ad2f9a2eec681cc9454989", "committedDate": "2020-05-13T06:15:40Z", "message": "Restore fail fast in score directors"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2977, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}