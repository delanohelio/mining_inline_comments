{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MDcxNTE4", "number": 928, "title": "Add generic type Score to SolverManager, SE, CMT, CM and Indictment", "bodyText": "Merge these together:\n\n#928\nkiegroup/optaplanner-quickstarts#3\nkiegroup/optaplanner-website#279", "createdAt": "2020-09-16T15:29:56Z", "url": "https://github.com/kiegroup/optaplanner/pull/928", "merged": true, "mergeCommit": {"oid": "fe6f48eb46eb5a201964b9ac2fff7e00057ea43c"}, "closed": true, "closedAt": "2020-09-17T09:19:46Z", "author": {"login": "ge0ffrey"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIxpS6gH2gAyNDg4MDcxNTE4OjBlMDk5N2U4Y2ZmOGU1YzMzNzMxYWE2Y2JhMTNmNDg4ZTAxM2NiZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJsmu6gH2gAyNDg4MDcxNTE4OmQwMjMyYWQ3ODIxZDUwOGI4NjIwMDE5ZDBkZTM3MWU3NTQ3MDBjOGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e0997e8cff8e5c33731aa6cba13f488e013cbef", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/0e0997e8cff8e5c33731aa6cba13f488e013cbef", "committedDate": "2020-09-14T11:39:05Z", "message": "PLANNER-2151 Add generic score type to various APIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa95fcfdda31c0ff48e95c233b8cd680cc5a2c0c", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/aa95fcfdda31c0ff48e95c233b8cd680cc5a2c0c", "committedDate": "2020-09-14T12:10:33Z", "message": "PLANNER-2151 Add generic score type to various APIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df", "author": {"user": {"login": "ge0ffrey", "name": "Geoffrey De Smet"}}, "url": "https://github.com/kiegroup/optaplanner/commit/16472047f635da11fbbba62e3c700d944f99b2df", "committedDate": "2020-09-16T15:27:48Z", "message": "PLANNER-2151 Add generic Score type to ScoreManager, ScoreExplanation, Indictment, ConstraintMatchTotal and ConstraintMatch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5OTQwMTIw", "url": "https://github.com/kiegroup/optaplanner/pull/928#pullrequestreview-489940120", "createdAt": "2020-09-16T19:04:09Z", "commit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "state": "APPROVED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOTowNDoxMFrOHS_q-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOToxNjozOFrOHTAjgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY3OTYxMA==", "bodyText": "I'm not exactly sure of what this method does, but shouldn't the first argument rather be Class<? extends AbstractBendableScore<?>>?", "url": "https://github.com/kiegroup/optaplanner/pull/928#discussion_r489679610", "createdAt": "2020-09-16T19:04:10Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/api/score/AbstractBendableScore.java", "diffHunk": "@@ -28,13 +28,13 @@\n  *\n  * @see BendableScore\n  */\n-public abstract class AbstractBendableScore<S extends Score<S>> extends AbstractScore<S> {\n+public abstract class AbstractBendableScore<Score_ extends AbstractBendableScore<Score_>> extends AbstractScore<Score_> {\n \n     protected static final String HARD_LABEL = \"hard\";\n     protected static final String SOFT_LABEL = \"soft\";\n     protected static final String[] LEVEL_SUFFIXES = new String[] { HARD_LABEL, SOFT_LABEL };\n \n-    protected static String[][] parseBendableScoreTokens(Class<? extends Score> scoreClass, String scoreString) {\n+    protected static String[][] parseBendableScoreTokens(Class<? extends Score<?>> scoreClass, String scoreString) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY4MDcxMw==", "bodyText": "Class<? extends AbstractScore<?>>?\nI'm thinking if we should just make an instance method, and use Score_ instead.\n(Likewise for other similar methods on this class.)", "url": "https://github.com/kiegroup/optaplanner/pull/928#discussion_r489680713", "createdAt": "2020-09-16T19:05:00Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/api/score/AbstractScore.java", "diffHunk": "@@ -27,16 +27,16 @@\n  * <p>\n  * Subclasses must be immutable.\n  *\n- * @param <S> the actual score type\n+ * @param <Score_> the actual score type\n  * @see Score\n  * @see HardSoftScore\n  */\n-public abstract class AbstractScore<S extends Score> implements Score<S>,\n+public abstract class AbstractScore<Score_ extends AbstractScore<Score_>> implements Score<Score_>,\n         Serializable {\n \n     protected static final String INIT_LABEL = \"init\";\n \n-    protected static String[] parseScoreTokens(Class<? extends Score> scoreClass,\n+    protected static String[] parseScoreTokens(Class<? extends Score<?>> scoreClass,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY4MzMzNQ==", "bodyText": "Now wouldn't it be nice if SolutionDescriptor also had a Score_? But maybe that'd just go too far.", "url": "https://github.com/kiegroup/optaplanner/pull/928#discussion_r489683335", "createdAt": "2020-09-16T19:07:17Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/domain/solution/descriptor/SolutionDescriptor.java", "diffHunk": "@@ -679,8 +683,8 @@ private void determineGlobalShadowOrder() {\n     /**\n      * @return the {@link Class} of {@link PlanningScore}\n      */\n-    public Class<? extends Score> extractScoreClass() {\n-        return (Class<? extends Score>) scoreMemberAccessor.getType();\n+    public Class<? extends Score<?>> extractScoreClass() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY4NjAxMA==", "bodyText": "First of all, <Supply_ extends Supply> Supply_ should work, right?\nSecond, wouldn't it make sense to do SupplyManager<Supply_> directly?", "url": "https://github.com/kiegroup/optaplanner/pull/928#discussion_r489686010", "createdAt": "2020-09-16T19:09:33Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/domain/variable/supply/SupplyManager.java", "diffHunk": "@@ -22,13 +22,15 @@\n public interface SupplyManager {\n \n     /**\n-     * Returns the {@link Supply} for a {@link Demand}, preferably an existing one.\n-     * If the {@link Supply} doesn't exist yet (as part of the domain model or externalized), it creates and attaches it.\n+     * Returns the {@link org.optaplanner.core.impl.domain.variable.supply.Supply} for a {@link Demand}, preferably an existing\n+     * one.\n+     * If the {@link org.optaplanner.core.impl.domain.variable.supply.Supply} doesn't exist yet (as part of the domain model or\n+     * externalized), it creates and attaches it.\n      *\n      * @param demand never null\n-     * @param <S> Subclass of {@link Supply}\n+     * @param <Supply> Subclass of {@link org.optaplanner.core.impl.domain.variable.supply.Supply}\n      * @return never null\n      */\n-    <S extends Supply> S demand(Demand<S> demand);\n+    <Supply extends org.optaplanner.core.impl.domain.variable.supply.Supply> Supply demand(Demand<Supply> demand);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY4NzA5Mg==", "bodyText": "This was missing all the time?", "url": "https://github.com/kiegroup/optaplanner/pull/928#discussion_r489687092", "createdAt": "2020-09-16T19:10:26Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/score/ScoreUtils.java", "diffHunk": "@@ -56,6 +57,8 @@ public static Score parseScore(Class<? extends Score> scoreClass, String scoreSt\n             return HardMediumSoftScore.parseScore(scoreString);\n         } else if (HardMediumSoftLongScore.class.equals(scoreClass)) {\n             return HardMediumSoftLongScore.parseScore(scoreString);\n+        } else if (HardMediumSoftBigDecimalScore.class.equals(scoreClass)) {\n+            return HardMediumSoftBigDecimalScore.parseScore(scoreString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY4OTE2NQ==", "bodyText": "Now wouldn't it be lovely if AbstractScoreDirector had a generic <Score_> type? :-) Inner and Abstract score directors, and their subclasses, are officially private code in 8, so adding more generics there does not affect users.", "url": "https://github.com/kiegroup/optaplanner/pull/928#discussion_r489689165", "createdAt": "2020-09-16T19:12:22Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/score/director/AbstractScoreDirector.java", "diffHunk": "@@ -378,8 +378,12 @@ public static String explainScore(Score workingScore,\n     }\n \n     @Override\n-    public String explainScore() {\n-        return explainScore(calculateScore(), getConstraintMatchTotalMap().values(), getIndictmentMap().values());\n+    public <Score_ extends Score<Score_>> String explainScore() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5MTQ3MQ==", "bodyText": "IMO InnerScoreDirector is really screaming for a <Score_> generic type.", "url": "https://github.com/kiegroup/optaplanner/pull/928#discussion_r489691471", "createdAt": "2020-09-16T19:14:20Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/score/director/InnerScoreDirector.java", "diffHunk": "@@ -76,8 +76,9 @@\n      *         (to create one, use {@link ConstraintMatchTotal#composeConstraintId(String, String)}).\n      * @throws IllegalStateException if {@link #isConstraintMatchEnabled()} returns false\n      * @see #getIndictmentMap()\n+     * @param <Score_> the actual score type\n      */\n-    Map<String, ConstraintMatchTotal> getConstraintMatchTotalMap();\n+    <Score_ extends Score<Score_>> Map<String, ConstraintMatchTotal<Score_>> getConstraintMatchTotalMap();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5MjUwNQ==", "bodyText": "The cast should not be necessary, as ScoreDefinition also has <Score_>.", "url": "https://github.com/kiegroup/optaplanner/pull/928#discussion_r489692505", "createdAt": "2020-09-16T19:15:10Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/score/director/incremental/IncrementalScoreDirector.java", "diffHunk": "@@ -99,38 +99,41 @@ public boolean isConstraintMatchEnabled() {\n     }\n \n     @Override\n-    public Map<String, ConstraintMatchTotal> getConstraintMatchTotalMap() {\n+    public <Score_ extends Score<Score_>> Map<String, ConstraintMatchTotal<Score_>> getConstraintMatchTotalMap() {\n         if (!isConstraintMatchEnabled()) {\n             throw new IllegalStateException(\"When constraintMatchEnabled (\" + isConstraintMatchEnabled()\n                     + \") is disabled in the constructor, this method should not be called.\");\n         }\n         // Notice that we don't trigger the variable listeners\n-        return ((ConstraintMatchAwareIncrementalScoreCalculator<Solution_>) incrementalScoreCalculator)\n+        return ((ConstraintMatchAwareIncrementalScoreCalculator<Solution_, Score_>) incrementalScoreCalculator)\n                 .getConstraintMatchTotals()\n                 .stream()\n-                .collect(toMap(ConstraintMatchTotal::getConstraintId, identity()));\n+                .collect(toMap(ConstraintMatchTotal<Score_>::getConstraintId, identity()));\n     }\n \n     @Override\n-    public Map<Object, Indictment> getIndictmentMap() {\n+    public <Score_ extends Score<Score_>> Map<Object, Indictment<Score_>> getIndictmentMap() {\n         if (!isConstraintMatchEnabled()) {\n             throw new IllegalStateException(\"When constraintMatchEnabled (\" + isConstraintMatchEnabled()\n                     + \") is disabled in the constructor, this method should not be called.\");\n         }\n-        Map<Object, Indictment> incrementalIndictmentMap =\n-                ((ConstraintMatchAwareIncrementalScoreCalculator<Solution_>) incrementalScoreCalculator).getIndictmentMap();\n+        Map<Object, Indictment<Score_>> incrementalIndictmentMap =\n+                ((ConstraintMatchAwareIncrementalScoreCalculator<Solution_, Score_>) incrementalScoreCalculator)\n+                        .getIndictmentMap();\n         if (incrementalIndictmentMap != null) {\n             return incrementalIndictmentMap;\n         }\n-        Map<Object, Indictment> indictmentMap = new LinkedHashMap<>(); // TODO use entitySize\n-        Score zeroScore = getScoreDefinition().getZeroScore();\n-        for (ConstraintMatchTotal constraintMatchTotal : getConstraintMatchTotalMap().values()) {\n-            for (ConstraintMatch constraintMatch : constraintMatchTotal.getConstraintMatchSet()) {\n+        Map<Object, Indictment<Score_>> indictmentMap = new LinkedHashMap<>(); // TODO use entitySize\n+        Score_ zeroScore = (Score_) getScoreDefinition().getZeroScore();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5NDA4MA==", "bodyText": "Considering how often these two methods (constraint match total map, indictment map) repeat in various unrelated interfaces, perhaps these should be extracted into their own interface, which the other interfaces would then extend?", "url": "https://github.com/kiegroup/optaplanner/pull/928#discussion_r489694080", "createdAt": "2020-09-16T19:16:38Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/score/stream/ConstraintSession.java", "diffHunk": "@@ -40,15 +40,17 @@\n      * As defined by {@link InnerScoreDirector#getConstraintMatchTotalMap()}.\n      *\n      * @return never null\n+     * @param <Score_> the {@link Score} type\n      */\n-    Map<String, ConstraintMatchTotal> getConstraintMatchTotalMap();\n+    <Score_ extends Score<Score_>> Map<String, ConstraintMatchTotal<Score_>> getConstraintMatchTotalMap();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16472047f635da11fbbba62e3c700d944f99b2df"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0232ad7821d508b8620019d0de371e754700c8d", "author": {"user": {"login": "ge0ffrey", "name": "Geoffrey De Smet"}}, "url": "https://github.com/kiegroup/optaplanner/commit/d0232ad7821d508b8620019d0de371e754700c8d", "committedDate": "2020-09-17T08:20:41Z", "message": "PLANNER-2151 PR feedback (thanks Lukas)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3205, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}