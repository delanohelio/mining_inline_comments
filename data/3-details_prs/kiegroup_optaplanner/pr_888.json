{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5OTUyMTE4", "number": 888, "title": "PLANNER-1771 Make Quarkus extension exit if no OptaPlanner annotated classes are found", "bodyText": "", "createdAt": "2020-08-19T06:30:30Z", "url": "https://github.com/kiegroup/optaplanner/pull/888", "merged": true, "mergeCommit": {"oid": "85f7676d0d8c93d2c15d09763a0d4d0ec7d49f9a"}, "closed": true, "closedAt": "2020-08-19T12:04:10Z", "author": {"login": "ge0ffrey"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAVot9gH2gAyNDY5OTUyMTE4OjdkODA5MGY4MmQyYTNjM2JkYzEyMmMzMzIwZTFiNGQxZjc4MWFjZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAaJK5gFqTQ3MDM3NjEwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7d8090f82d2a3c3bdc122c3320e1b4d1f781acd7", "author": {"user": {"login": "ge0ffrey", "name": "Geoffrey De Smet"}}, "url": "https://github.com/kiegroup/optaplanner/commit/7d8090f82d2a3c3bdc122c3320e1b4d1f781acd7", "committedDate": "2020-08-19T06:29:43Z", "message": "PLANNER-1771 Make Quarkus extension exit if no OptaPlanner annotated classes are found"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMTg4NTE3", "url": "https://github.com/kiegroup/optaplanner/pull/888#pullrequestreview-470188517", "createdAt": "2020-08-19T07:22:08Z", "commit": {"oid": "7d8090f82d2a3c3bdc122c3320e1b4d1f781acd7"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNzoyMjowOFrOHC5TrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNzoyMjowOFrOHC5TrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjc5ODEyNA==", "bodyText": "Do we care about DRL (less than about easy score calculation)?", "url": "https://github.com/kiegroup/optaplanner/pull/888#discussion_r472798124", "createdAt": "2020-08-19T07:22:08Z", "author": {"login": "rsynek"}, "path": "optaplanner-quarkus-integration/optaplanner-quarkus/deployment/src/main/java/org/optaplanner/quarkus/deployment/OptaPlannerProcessor.java", "diffHunk": "@@ -81,18 +86,37 @@ HotDeploymentWatchedFileBuildItem watchScoreDrl() {\n     }\n \n     @BuildStep\n-    void registerAdditionalBeans(BuildProducer<AdditionalBeanBuildItem> additionalBeans) {\n+    void registerAdditionalBeans(CombinedIndexBuildItem combinedIndex,\n+            BuildProducer<AdditionalBeanBuildItem> additionalBeans) {\n+        IndexView indexView = combinedIndex.getIndex();\n+        if (hasNoOptaPlannerContent(indexView)) {\n+            return;\n+        }\n         // The bean encapsulating the SolverFactory\n         additionalBeans.produce(new AdditionalBeanBuildItem(OptaPlannerBeanProvider.class));\n     }\n \n+    private boolean hasNoOptaPlannerContent(IndexView indexView) {\n+        // Only skip this extension if everything is missing. Otherwise, if some parts are missing, fail fast later.\n+        return indexView.getAnnotations(DotNames.PLANNING_SOLUTION).isEmpty()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d8090f82d2a3c3bdc122c3320e1b4d1f781acd7"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMjc2NzUw", "url": "https://github.com/kiegroup/optaplanner/pull/888#pullrequestreview-470276750", "createdAt": "2020-08-19T09:20:16Z", "commit": {"oid": "7d8090f82d2a3c3bdc122c3320e1b4d1f781acd7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b298b3407492113978eb0a238b59ca828bd3c23", "author": {"user": {"login": "ge0ffrey", "name": "Geoffrey De Smet"}}, "url": "https://github.com/kiegroup/optaplanner/commit/9b298b3407492113978eb0a238b59ca828bd3c23", "committedDate": "2020-08-19T11:11:46Z", "message": "Switch the default classloader from optaplanner-core.jar's classloader to Thread.currentThread().getContextClassLoader()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfd6db689db35d7ddc10bcd03fd7834e2db2e31d", "author": {"user": {"login": "ge0ffrey", "name": "Geoffrey De Smet"}}, "url": "https://github.com/kiegroup/optaplanner/commit/bfd6db689db35d7ddc10bcd03fd7834e2db2e31d", "committedDate": "2020-08-19T11:29:47Z", "message": "Remove use of deprecated method recorderContext.classProxy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMzc2MTA0", "url": "https://github.com/kiegroup/optaplanner/pull/888#pullrequestreview-470376104", "createdAt": "2020-08-19T11:44:47Z", "commit": {"oid": "bfd6db689db35d7ddc10bcd03fd7834e2db2e31d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3406, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}