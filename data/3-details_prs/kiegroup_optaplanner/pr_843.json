{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzNjI0NjYz", "number": 843, "title": "PLANNER-1960: Use Thread.currentThread().getContextClassLoader() when loading Drools for Quarkus", "bodyText": "See quarkusio/quarkus#2531 for details:\nResources inside the deployment are not on the system class path in dev mode, as we need a new class loader to enable hot deployment.\nTODO:\nLook for other instances of getClass().getClassLoader() and replace with Thread.currentThread().getContextClassLoader()", "createdAt": "2020-07-20T16:37:50Z", "url": "https://github.com/kiegroup/optaplanner/pull/843", "merged": true, "mergeCommit": {"oid": "99fa1f82daffcd1d3c081e71cf214234a52ecc81"}, "closed": true, "closedAt": "2020-07-28T05:16:25Z", "author": {"login": "Christopher-Chianelli"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3bR-LgFqTQ1MzM0NTA4OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3eOKIABqjM1NzY4MDcxNzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMzQ1MDg5", "url": "https://github.com/kiegroup/optaplanner/pull/843#pullrequestreview-453345089", "createdAt": "2020-07-22T13:58:59Z", "commit": {"oid": "20c8474c04a7bec32e6d381b9cdfad75f29ace03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMzo1ODo1OVrOG1jvoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMzo1ODo1OVrOG1jvoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgxMzM0NA==", "bodyText": "We do indeed need to use the Thread.currentThread().getContextClassLoader() in quarkus (Stuart Douglas did a simiar change a few months ago for the quarkus extension). Great that you've find the fix.\nI'd rather not change the default ScoreDirectorFactoryConfig logic for that - it can have side effects in other enviromnents, but instead we need to make sure that quarkus extension passes it's classloader.", "url": "https://github.com/kiegroup/optaplanner/pull/843#discussion_r458813344", "createdAt": "2020-07-22T13:58:59Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/config/score/director/ScoreDirectorFactoryConfig.java", "diffHunk": "@@ -421,7 +421,8 @@ public ScoreDirectorFactoryConfig withAssertionScoreDirectorFactory(\n             KieResources kieResources = kieServices.getResources();\n             KieFileSystem kieFileSystem = kieServices.newKieFileSystem();\n             if (!ConfigUtils.isEmptyCollection(scoreDrlList)) {\n-                ClassLoader actualClassLoader = (classLoader != null) ? classLoader : getClass().getClassLoader();\n+                ClassLoader actualClassLoader =\n+                        (classLoader != null) ? classLoader : Thread.currentThread().getContextClassLoader();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20c8474c04a7bec32e6d381b9cdfad75f29ace03"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5438e3da3967e43a743f67b0f3dec7042bb6bd9", "author": {"user": {"login": "Christopher-Chianelli", "name": "Christopher Chianelli"}}, "url": "https://github.com/kiegroup/optaplanner/commit/c5438e3da3967e43a743f67b0f3dec7042bb6bd9", "committedDate": "2020-07-22T14:05:38Z", "message": "PLANNER-1960: Use Thread.currentThread().getContextClassLoader() when loading Drools for Quarkus\n\nSee https://github.com/quarkusio/quarkus/issues/2531 for details:\nResources inside the deployment are not on the system class path in dev mode, as we need a new class loader to enable hot deployment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53fc0238a893b9a3e06ef36c9f5f22441ac8e55f", "author": {"user": {"login": "Christopher-Chianelli", "name": "Christopher Chianelli"}}, "url": "https://github.com/kiegroup/optaplanner/commit/53fc0238a893b9a3e06ef36c9f5f22441ac8e55f", "committedDate": "2020-07-22T17:21:45Z", "message": "Set Classloader in OptaPlannerBeanProvider\n\nNote: for Drools to work, you need\nto add the following exclusion to optaplanner-quarkus:\n\n        <exclusion>\n          <groupId>org.kie.kogito</groupId>\n          <artifactId>drools-core-static</artifactId>\n        </exclusion>\n\nand add the following dependency to your project:\n\n    <dependency>\n      <groupId>org.kie.kogito</groupId>\n      <artifactId>drools-core-dynamic</artifactId>\n    </dependency>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20c8474c04a7bec32e6d381b9cdfad75f29ace03", "author": {"user": {"login": "Christopher-Chianelli", "name": "Christopher Chianelli"}}, "url": "https://github.com/kiegroup/optaplanner/commit/20c8474c04a7bec32e6d381b9cdfad75f29ace03", "committedDate": "2020-07-20T16:35:13Z", "message": "PLANNER-1960: Use Thread.currentThread().getContextClassLoader() when loading Drools for Quarkus\n\nSee https://github.com/quarkusio/quarkus/issues/2531 for details:\nResources inside the deployment are not on the system class path in dev mode, as we need a new class loader to enable hot deployment."}, "afterCommit": {"oid": "53fc0238a893b9a3e06ef36c9f5f22441ac8e55f", "author": {"user": {"login": "Christopher-Chianelli", "name": "Christopher Chianelli"}}, "url": "https://github.com/kiegroup/optaplanner/commit/53fc0238a893b9a3e06ef36c9f5f22441ac8e55f", "committedDate": "2020-07-22T17:21:45Z", "message": "Set Classloader in OptaPlannerBeanProvider\n\nNote: for Drools to work, you need\nto add the following exclusion to optaplanner-quarkus:\n\n        <exclusion>\n          <groupId>org.kie.kogito</groupId>\n          <artifactId>drools-core-static</artifactId>\n        </exclusion>\n\nand add the following dependency to your project:\n\n    <dependency>\n      <groupId>org.kie.kogito</groupId>\n      <artifactId>drools-core-dynamic</artifactId>\n    </dependency>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3348, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}