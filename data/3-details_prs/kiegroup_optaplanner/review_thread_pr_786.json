{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNDUxNzQ2", "number": 786, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMTo0NzowMFrOECHjog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNjoyMjo0NFrOECa5_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNjU2NDE4OnYy", "diffSide": "RIGHT", "path": "optaplanner-persistence/optaplanner-persistence-jpa/pom.xml", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMTo0NzowMFrOGeYK4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMTowMTo1MlrOGfAq1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ==", "bodyText": "By default, locally the test should run with h2.\nReq: When I do \"mvn clean install\" for this module, it needs to run the tests and not require me to start up a database. So it must use an in memory database.\nWe can have a maven profile that adds postegresql and that is activated for this CI workflow.", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r434506465", "createdAt": "2020-06-03T11:47:00Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-persistence/optaplanner-persistence-jpa/pom.xml", "diffHunk": "@@ -22,6 +22,22 @@\n   </description>\n   <url>https://www.optaplanner.org</url>\n \n+  <properties>\n+    <java.module.name>org.optaplanner.persistence.jpa</java.module.name>\n+    <version.org.postgresql>42.2.12</version.org.postgresql>\n+  </properties>\n+\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>org.postgresql</groupId>\n+        <artifactId>postgresql</artifactId>\n+        <version>${version.org.postgresql}</version>\n+        <scope>test</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgyMDA4Ng==", "bodyText": "Everything you described is indeed the current behaviour of this PR. Doing a fresh mvn clean install here runs the tests in an in-memory h2 database (notice that the h2 profile has activeByDefault set to true). This PR also adds a postgresql profile, which is activated when the user runs builds with -Ppostgresql like the GitHub workflow does (this requires a PostgreSQL server running in the background).", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r434820086", "createdAt": "2020-06-03T19:59:55Z", "author": {"login": "cuijulian"}, "path": "optaplanner-persistence/optaplanner-persistence-jpa/pom.xml", "diffHunk": "@@ -22,6 +22,22 @@\n   </description>\n   <url>https://www.optaplanner.org</url>\n \n+  <properties>\n+    <java.module.name>org.optaplanner.persistence.jpa</java.module.name>\n+    <version.org.postgresql>42.2.12</version.org.postgresql>\n+  </properties>\n+\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>org.postgresql</groupId>\n+        <artifactId>postgresql</artifactId>\n+        <version>${version.org.postgresql}</version>\n+        <scope>test</scope>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ=="}, "originalCommit": {"oid": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAyMDQ4NQ==", "bodyText": "Maybe I would just move this dependencyManagement to the top-level pom.xml, so that it's clear what versions we declare atop of the kie-parent pom.", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435020485", "createdAt": "2020-06-04T06:30:49Z", "author": {"login": "rsynek"}, "path": "optaplanner-persistence/optaplanner-persistence-jpa/pom.xml", "diffHunk": "@@ -22,6 +22,22 @@\n   </description>\n   <url>https://www.optaplanner.org</url>\n \n+  <properties>\n+    <java.module.name>org.optaplanner.persistence.jpa</java.module.name>\n+    <version.org.postgresql>42.2.12</version.org.postgresql>\n+  </properties>\n+\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>org.postgresql</groupId>\n+        <artifactId>postgresql</artifactId>\n+        <version>${version.org.postgresql}</version>\n+        <scope>test</scope>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ=="}, "originalCommit": {"oid": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE2OTI2MQ==", "bodyText": "Good point @cuijulian - I missed that", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435169261", "createdAt": "2020-06-04T11:00:26Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-persistence/optaplanner-persistence-jpa/pom.xml", "diffHunk": "@@ -22,6 +22,22 @@\n   </description>\n   <url>https://www.optaplanner.org</url>\n \n+  <properties>\n+    <java.module.name>org.optaplanner.persistence.jpa</java.module.name>\n+    <version.org.postgresql>42.2.12</version.org.postgresql>\n+  </properties>\n+\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>org.postgresql</groupId>\n+        <artifactId>postgresql</artifactId>\n+        <version>${version.org.postgresql}</version>\n+        <scope>test</scope>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ=="}, "originalCommit": {"oid": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE3MDAwNA==", "bodyText": "+1 to declare this in the top level pom. Ideally kie-parent in the 7.x series. Can be a separate PR pair.", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435170004", "createdAt": "2020-06-04T11:01:52Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-persistence/optaplanner-persistence-jpa/pom.xml", "diffHunk": "@@ -22,6 +22,22 @@\n   </description>\n   <url>https://www.optaplanner.org</url>\n \n+  <properties>\n+    <java.module.name>org.optaplanner.persistence.jpa</java.module.name>\n+    <version.org.postgresql>42.2.12</version.org.postgresql>\n+  </properties>\n+\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>org.postgresql</groupId>\n+        <artifactId>postgresql</artifactId>\n+        <version>${version.org.postgresql}</version>\n+        <scope>test</scope>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ=="}, "originalCommit": {"oid": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwOTczNDM4OnYy", "diffSide": "RIGHT", "path": ".github/workflows/jpa_integration_ci.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNjoyMjo0NFrOGe3Wzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMToxNToxOFrOGfBFIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxNzQyMg==", "bodyText": "Was this the reason why it didn't work?", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435017422", "createdAt": "2020-06-04T06:22:44Z", "author": {"login": "rsynek"}, "path": ".github/workflows/jpa_integration_ci.yml", "diffHunk": "@@ -0,0 +1,42 @@\n+# Runs optaplanner-persistence-jpa module tests in a PostgreSQL container\n+\n+name: OptaPlanner Persistence JPA CI\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+  pull_request:\n+    branches:\n+      - master\n+\n+jobs:\n+  jpa-postgresql-container:\n+    runs-on: ubuntu-latest\n+    services:\n+      postgres:\n+        image: postgres\n+        env:\n+          POSTGRES_PASSWORD: postgres\n+        # Set health checks to wait until postgres has started\n+        options: >-\n+          --health-cmd pg_isready\n+          --health-interval 10s\n+          --health-timeout 5s\n+          --health-retries 5\n+        ports:\n+          # Maps tcp port 5432 on service container to the host\n+          - 5432:5432", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE3NjczOQ==", "bodyText": "Yes, exactly.", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435176739", "createdAt": "2020-06-04T11:15:18Z", "author": {"login": "cuijulian"}, "path": ".github/workflows/jpa_integration_ci.yml", "diffHunk": "@@ -0,0 +1,42 @@\n+# Runs optaplanner-persistence-jpa module tests in a PostgreSQL container\n+\n+name: OptaPlanner Persistence JPA CI\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+  pull_request:\n+    branches:\n+      - master\n+\n+jobs:\n+  jpa-postgresql-container:\n+    runs-on: ubuntu-latest\n+    services:\n+      postgres:\n+        image: postgres\n+        env:\n+          POSTGRES_PASSWORD: postgres\n+        # Set health checks to wait until postgres has started\n+        options: >-\n+          --health-cmd pg_isready\n+          --health-interval 10s\n+          --health-timeout 5s\n+          --health-retries 5\n+        ports:\n+          # Maps tcp port 5432 on service container to the host\n+          - 5432:5432", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxNzQyMg=="}, "originalCommit": {"oid": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4544, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}