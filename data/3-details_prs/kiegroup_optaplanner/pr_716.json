{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NTczMDM1", "number": 716, "title": "PLANNER-1871 Merge consecutive filter()s into a single predicate", "bodyText": "", "createdAt": "2020-03-09T12:56:22Z", "url": "https://github.com/kiegroup/optaplanner/pull/716", "merged": true, "mergeCommit": {"oid": "6bb8b8acc9117977136b4f320435e37724fc76f9"}, "closed": true, "closedAt": "2020-03-09T15:45:06Z", "author": {"login": "triceo"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL9ifiAFqTM3MTE1MTA4Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcL-kp6ABqjMxMTA4MDEwNTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMTUxMDg3", "url": "https://github.com/kiegroup/optaplanner/pull/716#pullrequestreview-371151087", "createdAt": "2020-03-09T13:01:08Z", "commit": {"oid": "1e6fa10c90c65de7188a75d64b0b6926a1ce23c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMzowMTowOFrOFzmA2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMzowMTowOFrOFzmA2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY0NDUwNA==", "bodyText": "There is a problem here.\nOriginally, the order of joiners in this code was joiner, lessThan(planningIdGetter). However, that breaks if the user wants to do:\nfromUniquePair(..., Joiners.filtering(...))\n\nBecause we fail fast when filtering() joiner is anything but last. This could be considered a bug that I only just now found out about.\nHowever, the other way around (putting lessThan() before filtering()) breaks Bavet, as Bavet only supports lessThan() when it's the last joiner.\nThe fail-fasts of filtering() and lessThan() in Bavet are mutually incompatible. Drools is fine.\nWhat do we want to do about this?", "url": "https://github.com/kiegroup/optaplanner/pull/716#discussion_r389644504", "createdAt": "2020-03-09T13:01:08Z", "author": {"login": "triceo"}, "path": "optaplanner-core/src/main/java/org/optaplanner/core/impl/score/stream/InnerConstraintFactory.java", "diffHunk": "@@ -41,6 +49,19 @@\n         return stream;\n     }\n \n+    @Override\n+    default <A> BiConstraintStream<A, A> fromUniquePair(Class<A> fromClass, BiJoiner<A, A> joiner) {\n+        MemberAccessor planningIdMemberAccessor = ConfigUtils.findPlanningIdMemberAccessor(fromClass);\n+        if (planningIdMemberAccessor == null) {\n+            throw new IllegalArgumentException(\"The fromClass (\" + fromClass + \") has no member with a @\"\n+                    + PlanningId.class.getSimpleName() + \" annotation,\"\n+                    + \" so the pairs can not be made unique ([A,B] vs [B,A]).\");\n+        }\n+        // TODO In Bavet breaks node sharing + involves unneeded indirection\n+        Function<A, Comparable> planningIdGetter = (fact) -> (Comparable<?>) planningIdMemberAccessor.executeGetter(fact);\n+        return from(fromClass).join(fromClass, lessThan(planningIdGetter), joiner);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e6fa10c90c65de7188a75d64b0b6926a1ce23c4"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMTY2MTkw", "url": "https://github.com/kiegroup/optaplanner/pull/716#pullrequestreview-371166190", "createdAt": "2020-03-09T13:14:06Z", "commit": {"oid": "1e6fa10c90c65de7188a75d64b0b6926a1ce23c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fda6d55f3ea16786316b44a0c0610706ae3680c3", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/fda6d55f3ea16786316b44a0c0610706ae3680c3", "committedDate": "2020-03-09T14:13:02Z", "message": "Implement filter reuse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "247fb3d5b597f2a694aa61c47fad3ac9fbd8960c", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/247fb3d5b597f2a694aa61c47fad3ac9fbd8960c", "committedDate": "2020-03-09T14:13:02Z", "message": "Naming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "764412505e00f26d01872f062cb71564bc525a08", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/764412505e00f26d01872f062cb71564bc525a08", "committedDate": "2020-03-09T14:13:02Z", "message": "Add test coverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "392db9ea01ab5c109cd71224d2d29d9b6a8502a2", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/392db9ea01ab5c109cd71224d2d29d9b6a8502a2", "committedDate": "2020-03-09T14:13:02Z", "message": "Share some code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d65cc190626756b207a58a19d762ea6b77738ee9", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/d65cc190626756b207a58a19d762ea6b77738ee9", "committedDate": "2020-03-09T14:13:03Z", "message": "Address Bavet and Drools incompatibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e8c040163462de7bec5e3b0ad874312092fb182", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/9e8c040163462de7bec5e3b0ad874312092fb182", "committedDate": "2020-03-09T14:13:03Z", "message": "Address Sonar issue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db8bbc9c2592323f69ce8bd44aa7f5c898b75f7c", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/db8bbc9c2592323f69ce8bd44aa7f5c898b75f7c", "committedDate": "2020-03-09T13:45:34Z", "message": "Address Sonar issue"}, "afterCommit": {"oid": "9e8c040163462de7bec5e3b0ad874312092fb182", "author": {"user": {"login": "triceo", "name": "Luk\u00e1\u0161 Petrovick\u00fd"}}, "url": "https://github.com/kiegroup/optaplanner/commit/9e8c040163462de7bec5e3b0ad874312092fb182", "committedDate": "2020-03-09T14:13:03Z", "message": "Address Sonar issue"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2892, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}