{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1OTIyOTA4", "number": 976, "title": "PLANNER-2142 Make OptaPlanner 8 a part of kogito release pipeline", "bodyText": "JIRA\n\n\nhttps://issues.redhat.com/browse/PLANNER-2142\nReferenced pull requests\nkiegroup/kogito-pipelines#69\nkiegroup/kogito-examples#402\n\n\nChecklist\n\n Documentation updated if applicable.\n Upgrade recipe provided if applicable.\n\n\n\nHow to retest this PR or trigger a specific build:\n\n\nfor a pull request build please add comment: Jenkins retest this\nfor a full downstream build please add comment: Jenkins run fdb\nfor a compile downstream build please add comment: Jenkins run cdb\nfor a full production downstream build please add comment: Jenkins execute product fdb\nfor an upstream build please add comment: Jenkins run upstream", "createdAt": "2020-10-19T12:17:12Z", "url": "https://github.com/kiegroup/optaplanner/pull/976", "merged": true, "mergeCommit": {"oid": "f1a6ef51c621bcfbb0aa98e7a82cce492146dd27"}, "closed": true, "closedAt": "2020-10-23T09:46:42Z", "author": {"login": "rsynek"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUDNp4gFqTUxMTY5OTYzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVRdUHgFqTUxNTQxMDA4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjk5NjM2", "url": "https://github.com/kiegroup/optaplanner/pull/976#pullrequestreview-511699636", "createdAt": "2020-10-19T12:20:20Z", "commit": {"oid": "e9ed3729a02067197bff2e4f6bf4457dfa159ad8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoyMDoyMVrOHkLlSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoyMDoyMVrOHkLlSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwMDU1Mw==", "bodyText": "May be worth moving to a shared library (after parametrization).", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r507700553", "createdAt": "2020-10-19T12:20:21Z", "author": {"login": "rsynek"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -129,6 +247,55 @@ void runMaven(String goals, String directory, boolean skipTests = false, List pr\n         mvnCmd += \" ${extraArgs}\"\n     }\n     dir(directory) {\n-        maven.runMavenWithSubmarineSettings(mvnCmd, skipTests)\n+        if(isRelease()){\n+            // In case of release, we already have the settings.xml\n+            maven.runMaven(mvnCmd, skipTests, ['-fae'])\n+        } else {\n+            maven.runMavenWithSubmarineSettings(mvnCmd, skipTests)\n+        }\n+    }\n+}\n+\n+void updateKogitoVersion(String newVersion) {\n+    sh \"mvn versions:set-property -Dproperty=version.org.kie.kogito -DnewVersion=$newVersion -DallowSnapshots=true -DgenerateBackupPoms=false\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9ed3729a02067197bff2e4f6bf4457dfa159ad8"}, "originalPosition": 220}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzAxNzMw", "url": "https://github.com/kiegroup/optaplanner/pull/976#pullrequestreview-511701730", "createdAt": "2020-10-19T12:23:02Z", "commit": {"oid": "e9ed3729a02067197bff2e4f6bf4457dfa159ad8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoyMzowMlrOHkLr5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoyMzowMlrOHkLr5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwMjI0NQ==", "bodyText": "Required just for testing the pipeline. Enforcer fails the build due to the http:// protocol of the testing Nexus server (https:// required).", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r507702245", "createdAt": "2020-10-19T12:23:02Z", "author": {"login": "rsynek"}, "path": "pom.xml", "diffHunk": "@@ -34,6 +34,8 @@\n   </licenses>\n \n   <properties>\n+    <!-- TODO: remove before merging -->\n+    <enforcer.skip>true</enforcer.skip>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9ed3729a02067197bff2e4f6bf4457dfa159ad8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzEyMDkw", "url": "https://github.com/kiegroup/optaplanner/pull/976#pullrequestreview-511712090", "createdAt": "2020-10-19T12:35:50Z", "commit": {"oid": "71611aedb229a76f3b2d66d547518483b42c6171"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjozNTo1MFrOHkMK3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjo0MDo0N1rOHkMWzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxMDE3NA==", "bodyText": "maybe add KOGITO_VERSION as well in deployment.properties, as you will need it in promote pipeline", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r507710174", "createdAt": "2020-10-19T12:35:50Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -42,37 +56,118 @@ pipeline {\n                     if (params.DISPLAY_NAME != '') {\n                         currentBuild.displayName = params.DISPLAY_NAME\n                     }\n+\n+                    if (isRelease()) {\n+                        assert getProjectVersion() != ''\n+                    }\n                 }\n             }\n             post {\n                 success {\n                     script {\n                         setDeployPropertyIfNeeded('git.branch', getBuildBranch())\n                         setDeployPropertyIfNeeded('git.author', getGitAuthor())\n+                        setDeployPropertyIfNeeded('project.version', getProjectVersion())\n+                        setDeployPropertyIfNeeded('release', isRelease())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71611aedb229a76f3b2d66d547518483b42c6171"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxMDg3MQ==", "bodyText": "this parameter should not be mandatory. runtimes could have been released already. thus this pipeline would not need any MAVEN_DEPENDENCIES_REPOSITORY", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r507710871", "createdAt": "2020-10-19T12:36:52Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -42,37 +56,118 @@ pipeline {\n                     if (params.DISPLAY_NAME != '') {\n                         currentBuild.displayName = params.DISPLAY_NAME\n                     }\n+\n+                    if (isRelease()) {\n+                        assert getProjectVersion() != ''\n+                    }\n                 }\n             }\n             post {\n                 success {\n                     script {\n                         setDeployPropertyIfNeeded('git.branch', getBuildBranch())\n                         setDeployPropertyIfNeeded('git.author', getGitAuthor())\n+                        setDeployPropertyIfNeeded('project.version', getProjectVersion())\n+                        setDeployPropertyIfNeeded('release', isRelease())\n                     }\n                 }\n             }\n         }\n+\n         stage('Clone repositories') {\n             steps {\n                 checkoutRepo('optaplanner')\n             }\n         }\n+\n+        stage('Prepare for PR'){\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                prepareForPR('optaplanner')\n+            }\n+        }\n+\n+        stage('Setup Maven release config'){\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                echo 'Setup Maven release config'\n+                configFileProvider([configFile(fileId: maven.getSubmarineSettingsXmlId(), targetLocation: 'maven-settings.xml', variable: 'MAVEN_SETTINGS_FILE')]){\n+                    sh \"echo '-B -s ${MAVEN_SETTINGS_FILE}' | tee optaplanner/.mvn/maven.config\"\n+                    // TODO: figure out why the assert does not work\n+                    // assert params.MAVEN_DEPENDENCIES_REPOSITORY != '' // OptaPlanner depends on Kogito Runtimes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71611aedb229a76f3b2d66d547518483b42c6171"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxMTM4Mg==", "bodyText": "just thinking I need to update that as well on examples that we should check params.MAVEN_DEPENDENCIES_REPOSITORY is not empty before doing the change ...", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r507711382", "createdAt": "2020-10-19T12:37:44Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -42,37 +56,118 @@ pipeline {\n                     if (params.DISPLAY_NAME != '') {\n                         currentBuild.displayName = params.DISPLAY_NAME\n                     }\n+\n+                    if (isRelease()) {\n+                        assert getProjectVersion() != ''\n+                    }\n                 }\n             }\n             post {\n                 success {\n                     script {\n                         setDeployPropertyIfNeeded('git.branch', getBuildBranch())\n                         setDeployPropertyIfNeeded('git.author', getGitAuthor())\n+                        setDeployPropertyIfNeeded('project.version', getProjectVersion())\n+                        setDeployPropertyIfNeeded('release', isRelease())\n                     }\n                 }\n             }\n         }\n+\n         stage('Clone repositories') {\n             steps {\n                 checkoutRepo('optaplanner')\n             }\n         }\n+\n+        stage('Prepare for PR'){\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                prepareForPR('optaplanner')\n+            }\n+        }\n+\n+        stage('Setup Maven release config'){\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                echo 'Setup Maven release config'\n+                configFileProvider([configFile(fileId: maven.getSubmarineSettingsXmlId(), targetLocation: 'maven-settings.xml', variable: 'MAVEN_SETTINGS_FILE')]){\n+                    sh \"echo '-B -s ${MAVEN_SETTINGS_FILE}' | tee optaplanner/.mvn/maven.config\"\n+                    // TODO: figure out why the assert does not work\n+                    // assert params.MAVEN_DEPENDENCIES_REPOSITORY != '' // OptaPlanner depends on Kogito Runtimes", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxMDg3MQ=="}, "originalCommit": {"oid": "71611aedb229a76f3b2d66d547518483b42c6171"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxMTY0MQ==", "bodyText": "what happen if KOGITO_VERSION is empty ?", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r507711641", "createdAt": "2020-10-19T12:38:05Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -42,37 +56,118 @@ pipeline {\n                     if (params.DISPLAY_NAME != '') {\n                         currentBuild.displayName = params.DISPLAY_NAME\n                     }\n+\n+                    if (isRelease()) {\n+                        assert getProjectVersion() != ''\n+                    }\n                 }\n             }\n             post {\n                 success {\n                     script {\n                         setDeployPropertyIfNeeded('git.branch', getBuildBranch())\n                         setDeployPropertyIfNeeded('git.author', getGitAuthor())\n+                        setDeployPropertyIfNeeded('project.version', getProjectVersion())\n+                        setDeployPropertyIfNeeded('release', isRelease())\n                     }\n                 }\n             }\n         }\n+\n         stage('Clone repositories') {\n             steps {\n                 checkoutRepo('optaplanner')\n             }\n         }\n+\n+        stage('Prepare for PR'){\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                prepareForPR('optaplanner')\n+            }\n+        }\n+\n+        stage('Setup Maven release config'){\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                echo 'Setup Maven release config'\n+                configFileProvider([configFile(fileId: maven.getSubmarineSettingsXmlId(), targetLocation: 'maven-settings.xml', variable: 'MAVEN_SETTINGS_FILE')]){\n+                    sh \"echo '-B -s ${MAVEN_SETTINGS_FILE}' | tee optaplanner/.mvn/maven.config\"\n+                    // TODO: figure out why the assert does not work\n+                    // assert params.MAVEN_DEPENDENCIES_REPOSITORY != '' // OptaPlanner depends on Kogito Runtimes\n+                    echo \"MAVEN_DEPENDENCIES_REPOSITORY passed: ${params.MAVEN_DEPENDENCIES_REPOSITORY}\"\n+                    sh \"sed -i 's|<repositories>|<repositories><repository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></repository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                    sh \"sed -i 's|<pluginRepositories>|<pluginRepositories><pluginRepository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></pluginRepository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                    sh \"sed -i 's|external:\\\\*|external:*,!staging|g' ${MAVEN_SETTINGS_FILE}\" // Done to allow Maven to download release artifacts from MAVEN_DEPENDENCIES_REPOSITORY\n+\n+                    echo 'Resulting maven settings.xml:'\n+                    sh \"cat ${MAVEN_SETTINGS_FILE}\"\n+                }\n+            }\n+        }\n+\n+        stage('Update project version'){\n+            when {\n+                expression { return getProjectVersion() != '' }\n+            }\n+            steps {\n+                script {\n+                    // To make sure that the project will resolve during version upgrade.\n+                    mavenCleanInstall('optaplanner', true, [], '-U')\n+                    dir('optaplanner') {\n+                        maven.mvnVersionsSet(getProjectVersion())\n+                        updateKogitoVersion(getKogitoVersion())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71611aedb229a76f3b2d66d547518483b42c6171"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxMTk3NQ==", "bodyText": "I do agree", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r507711975", "createdAt": "2020-10-19T12:38:37Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -129,6 +247,55 @@ void runMaven(String goals, String directory, boolean skipTests = false, List pr\n         mvnCmd += \" ${extraArgs}\"\n     }\n     dir(directory) {\n-        maven.runMavenWithSubmarineSettings(mvnCmd, skipTests)\n+        if(isRelease()){\n+            // In case of release, we already have the settings.xml\n+            maven.runMaven(mvnCmd, skipTests, ['-fae'])\n+        } else {\n+            maven.runMavenWithSubmarineSettings(mvnCmd, skipTests)\n+        }\n+    }\n+}\n+\n+void updateKogitoVersion(String newVersion) {\n+    sh \"mvn versions:set-property -Dproperty=version.org.kie.kogito -DnewVersion=$newVersion -DallowSnapshots=true -DgenerateBackupPoms=false\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcwMDU1Mw=="}, "originalCommit": {"oid": "e9ed3729a02067197bff2e4f6bf4457dfa159ad8"}, "originalPosition": 220}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxMzIzMA==", "bodyText": "here is the needed kogito.version from deployment.properties", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r507713230", "createdAt": "2020-10-19T12:40:47Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.promote", "diffHunk": "@@ -0,0 +1,282 @@\n+import org.jenkinsci.plugins.workflow.libs.Library\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+deployProperties = [:]\n+pipelineProperties = [:]\n+\n+pipeline {\n+    agent {\n+        label 'kie-rhel7'\n+    }\n+\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    \n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '10')\n+    }\n+\n+    parameters {\n+        string(name: 'DISPLAY_NAME', defaultValue: '', description: 'Setup a specific build display name')\n+        \n+        // Deploy job url to retrieve deployment.properties\n+        string(name: 'DEPLOY_BUILD_URL', defaultValue: '', description: 'URL to jenkins deploy build to retrieve the `deployment.properties` file. If base parameters are defined, they will override the `deployment.properties` information')\n+        \n+        // Git information which can override `deployment.properties`\n+        string(name: 'BUILD_BRANCH_NAME', defaultValue: '', description: 'Override `deployment.properties`. Which branch to build? Set if you are not on a multibranch pipeline.')\n+        string(name: 'GIT_AUTHOR', defaultValue: '', description: 'Override `deployment.properties`. Which Git author repository ?')\n+        \n+        // Release information which can override `deployment.properties`\n+        booleanParam(name: 'RELEASE', defaultValue: false, description: 'Override `deployment.properties`. Is this build for a release?')\n+\n+        string(name: 'PROJECT_VERSION', defaultValue: '', description: 'Override `deployment.properties`. Optional if not RELEASE. If RELEASE, cannot be empty.')\n+        string(name: 'KOGITO_VERSION', defaultValue: '', description: 'Optional if not RELEASE. If RELEASE, cannot be empty.')\n+\n+        string(name: 'STAGING_REPO_URL', defaultValue: '', description: 'Override `deployment.properties`.')\n+        string(name: 'GIT_TAG', defaultValue: '', description: 'Git tag to set, if different from PROJECT_VERSION')\n+\n+        // Bot author information. Set as params for easy testing.\n+        string(name: 'BOT_CREDENTIALS_ID', defaultValue: 'bsig-gh-bot', description: 'Credentials for PR creation')\n+\n+        // Main author creds\n+        string(name: 'AUTHOR_CREDS_ID', defaultValue: 'kie-ci', description: 'Credentials for PR merge')\n+        string(name: 'GITHUB_TOKEN_CREDS_ID', defaultValue: 'kie-ci2-token', description: 'GH token to be used with GH CLI')\n+    }\n+\n+    environment {\n+        PROPERTIES_FILE_NAME = 'deployment.properties'\n+        BOT_BRANCH_HASH = \"${util.generateHash(10)}\"\n+        GITHUB_CLI_VERSION = '0.11.1'\n+    }\n+\n+    stages {\n+        stage('Initialization') {\n+            steps {\n+                script {\n+                    cleanWs()\n+                    \n+                    if (params.DISPLAY_NAME != '') {\n+                        currentBuild.displayName = params.DISPLAY_NAME\n+                    }\n+\n+                    readDeployProperties()\n+\n+                    if (isRelease()) {\n+                        assert getProjectVersion() != ''\n+                    }\n+\n+                    installGithubCLI()\n+                }\n+            }\n+        }\n+\n+        stage('Merge OptaPlanner deploy PR and tag') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    dir('optaplanner') {\n+                        checkoutRepo('optaplanner')\n+                        mergeAndPush('optaplanner', getDeployPrLink('optaplanner'))\n+                        tagLatest()\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Set OptaPlanner next snapshot version'){\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    dir('optaplanner-bot') {\n+                        prepareForPR('optaplanner')\n+\n+                        maven.mvnVersionsSet(getNextSnapshotVersion(getProjectVersion()), true)\n+                        updateKogitoVersion(getNextSnapshotVersion(getKogitoVersion()))\n+\n+                        commitAndCreatePR('optaplanner')\n+                    }\n+                    dir('optaplanner') {\n+                        sh \"git checkout ${getBuildBranch()}\"\n+                        mergeAndPush('optaplanner', getPipelinePrLink('optaplanner'))\n+                    }\n+                }\n+            }\n+        }\n+    }\n+    post {\n+        always {\n+            cleanWs()\n+        }\n+    }\n+}\n+\n+//////////////////////////////////////////////////////////////////////////////\n+// Deployment properties\n+//////////////////////////////////////////////////////////////////////////////\n+\n+void readDeployProperties(){\n+    String deployUrl = params.DEPLOY_BUILD_URL\n+    if (deployUrl != ''){\n+        if(!deployUrl.endsWith('/')){\n+            deployUrl += '/'\n+        }\n+        sh \"wget ${deployUrl}artifact/${PROPERTIES_FILE_NAME} -O ${PROPERTIES_FILE_NAME}\"\n+        deployProperties = readProperties file: PROPERTIES_FILE_NAME\n+        // echo all properties\n+        echo deployProperties.collect{ entry -> \"${entry.key}=${entry.value}\" }.join('\\n')\n+    }\n+}\n+\n+boolean hasDeployProperty(String key){\n+    return deployProperties[key] != null\n+}\n+\n+String getDeployProperty(String key){\n+    if(hasDeployProperty(key)){\n+        return deployProperties[key]\n+    }\n+    return ''\n+}\n+\n+String getParamOrDeployProperty(String paramKey, String deployPropertyKey){\n+    if (params[paramKey] != ''){\n+        return params[paramKey]\n+    }\n+    return getDeployProperty(deployPropertyKey)\n+}\n+\n+//////////////////////////////////////////////////////////////////////////////\n+// Getter / Setter\n+//////////////////////////////////////////////////////////////////////////////\n+\n+boolean isRelease() {\n+    return params.RELEASE || (getDeployProperty('release') == 'true')\n+}\n+\n+String getProjectVersion() {\n+    return getParamOrDeployProperty('PROJECT_VERSION', 'project.version')\n+}\n+\n+String getKogitoVersion() {\n+    return getParamOrDeployProperty('KOGITO_VERSION', 'kogito.version')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71611aedb229a76f3b2d66d547518483b42c6171"}, "originalPosition": 167}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad6e0f17301a12d2b6056aeccf4c7cb10fb4e29b", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/ad6e0f17301a12d2b6056aeccf4c7cb10fb4e29b", "committedDate": "2020-10-20T08:57:56Z", "message": "Create a first draft of release pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57de985291154225a5ee79cef8c39d4b8b43c4ba", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/57de985291154225a5ee79cef8c39d4b8b43c4ba", "committedDate": "2020-10-20T08:57:56Z", "message": "Update the promote pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f40dbd8a54582297c4030671d4d0971ff6dbc40a", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/f40dbd8a54582297c4030671d4d0971ff6dbc40a", "committedDate": "2020-10-20T08:57:56Z", "message": "Fix the maven setup step"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9feb30c1f077d1c7084bc135c5db001de6ea7fa5", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/9feb30c1f077d1c7084bc135c5db001de6ea7fa5", "committedDate": "2020-10-20T08:57:56Z", "message": "Accept version with suffix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7880dea72ac1c6e7af2f45af8146548399d30bf2", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/7880dea72ac1c6e7af2f45af8146548399d30bf2", "committedDate": "2020-10-20T08:57:56Z", "message": "Print the dependencies repository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b29410adb4fc2b8bbff151aba29699433ee362a5", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/b29410adb4fc2b8bbff151aba29699433ee362a5", "committedDate": "2020-10-20T08:57:56Z", "message": "Fix path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3d952516d05c40e6210bf058ff0f47d6d18f98d", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/e3d952516d05c40e6210bf058ff0f47d6d18f98d", "committedDate": "2020-10-20T08:57:56Z", "message": "Print content of the merged settings.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ca56dabde51651c9341ba9e425b34008d595d09", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/1ca56dabde51651c9341ba9e425b34008d595d09", "committedDate": "2020-10-20T08:57:56Z", "message": "Use submarine settings.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae2481cb7a445ff1647a708ee1bec722b1e8f2fb", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/ae2481cb7a445ff1647a708ee1bec722b1e8f2fb", "committedDate": "2020-10-20T08:57:56Z", "message": "Unify settings.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd46d5ac980c61476788a9c21ec3e81eeb226307", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/bd46d5ac980c61476788a9c21ec3e81eeb226307", "committedDate": "2020-10-20T08:57:56Z", "message": "Don't save junit reports if tests are skipped"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88cfad39239543ab02cbc7886d950c2b48cdf0d8", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/88cfad39239543ab02cbc7886d950c2b48cdf0d8", "committedDate": "2020-10-20T08:57:56Z", "message": "Comment out unnecessary build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "702f2dfb993748b9a223ba9a9efe92f554653771", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/702f2dfb993748b9a223ba9a9efe92f554653771", "committedDate": "2020-10-20T08:57:56Z", "message": "Skip enforcer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85704daa45ea3ce2fb8e192ce32390088ddea939", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/85704daa45ea3ce2fb8e192ce32390088ddea939", "committedDate": "2020-10-20T08:57:56Z", "message": "Remove unnecessary maven build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f37bb2503e23bea26327613e6151d5a8236b56dd", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/f37bb2503e23bea26327613e6151d5a8236b56dd", "committedDate": "2020-10-20T08:57:56Z", "message": "Use set-property instead of update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf3accaff8333533fc82cd8e14ccb267aef5678e", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/bf3accaff8333533fc82cd8e14ccb267aef5678e", "committedDate": "2020-10-20T08:57:56Z", "message": "Parametrize git credentials"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a8b4a9c60770a70fdbbd2908491cb0416ebe5eb", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/0a8b4a9c60770a70fdbbd2908491cb0416ebe5eb", "committedDate": "2020-10-20T08:57:56Z", "message": "Put back the enforcer plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf350954f3d2491ae9b73bee719f2a6a7ffe7199", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/cf350954f3d2491ae9b73bee719f2a6a7ffe7199", "committedDate": "2020-10-20T08:57:56Z", "message": "Remove a workaround for parsing versions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "697e0db06e1dd390cfee6acdaa0796a135dfc229", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/697e0db06e1dd390cfee6acdaa0796a135dfc229", "committedDate": "2020-10-20T08:57:56Z", "message": "Remove obsolete TODO note"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "815b5e4704d3d43b3efa2abe5ac691ef32e0fa59", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/815b5e4704d3d43b3efa2abe5ac691ef32e0fa59", "committedDate": "2020-10-20T08:57:56Z", "message": "Address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9f40c64eef8a810eb165564193800c39e737c5f", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/c9f40c64eef8a810eb165564193800c39e737c5f", "committedDate": "2020-10-20T08:57:56Z", "message": "Wrap step content in a script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17f2d13e01b3f9c59aa0559c68053ce063e9d6bb", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/17f2d13e01b3f9c59aa0559c68053ce063e9d6bb", "committedDate": "2020-10-20T08:26:04Z", "message": "Wrap step content in a script"}, "afterCommit": {"oid": "c9f40c64eef8a810eb165564193800c39e737c5f", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/c9f40c64eef8a810eb165564193800c39e737c5f", "committedDate": "2020-10-20T08:57:56Z", "message": "Wrap step content in a script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "670f1f186bafbeb9a1fa2591a36fd354cb914e6a", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/670f1f186bafbeb9a1fa2591a36fd354cb914e6a", "committedDate": "2020-10-20T09:24:04Z", "message": "Make sure kogito version is not empty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e21c9be346d8fd07664964024e79ccee8b910b98", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/e21c9be346d8fd07664964024e79ccee8b910b98", "committedDate": "2020-10-20T09:17:47Z", "message": "Make sure kogito version is not empty"}, "afterCommit": {"oid": "670f1f186bafbeb9a1fa2591a36fd354cb914e6a", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/670f1f186bafbeb9a1fa2591a36fd354cb914e6a", "committedDate": "2020-10-20T09:24:04Z", "message": "Make sure kogito version is not empty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "859944a644e72731f6e7e4122479dad9ae52fefe", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/859944a644e72731f6e7e4122479dad9ae52fefe", "committedDate": "2020-10-20T13:46:39Z", "message": "Update versions maven plugin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyODQ5Nzkz", "url": "https://github.com/kiegroup/optaplanner/pull/976#pullrequestreview-512849793", "createdAt": "2020-10-20T15:18:44Z", "commit": {"oid": "859944a644e72731f6e7e4122479dad9ae52fefe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "227c484cabfe3bdec55b1cb9e7c266158cc92c61", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/227c484cabfe3bdec55b1cb9e7c266158cc92c61", "committedDate": "2020-10-22T10:08:11Z", "message": "Deploy new OptaPlanner snapshots"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NjMxNjM2", "url": "https://github.com/kiegroup/optaplanner/pull/976#pullrequestreview-514631636", "createdAt": "2020-10-22T11:39:09Z", "commit": {"oid": "227c484cabfe3bdec55b1cb9e7c266158cc92c61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTozOToxMFrOHmdf5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTozOToxMFrOHmdf5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5MTIzOQ==", "bodyText": "should add also here the sh \"echo '\\n-Denforcer.skip=true' | tee -a .mvn/maven.config\" command or ?", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r510091239", "createdAt": "2020-10-22T11:39:10Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -99,7 +99,7 @@ pipeline {\n                 script {\n                     echo 'Setup Maven release config'\n                     configFileProvider([configFile(fileId: maven.getSubmarineSettingsXmlId(), targetLocation: 'maven-settings.xml', variable: 'MAVEN_SETTINGS_FILE')]) {\n-                        sh \"echo '-B -s ${MAVEN_SETTINGS_FILE}' | tee optaplanner/.mvn/maven.config\"\n+                        sh \"echo '\\n-B -s ${MAVEN_SETTINGS_FILE}' | tee -a optaplanner/.mvn/maven.config\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "227c484cabfe3bdec55b1cb9e7c266158cc92c61"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9d65f17ea1aa0f4338064b278d8c1fcb2f0cfe9", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/b9d65f17ea1aa0f4338064b278d8c1fcb2f0cfe9", "committedDate": "2020-10-22T15:20:53Z", "message": "Add enforcer.skip to maven setup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e705a1e9d363e78e7f591b1e61f2b8c489a80743", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/e705a1e9d363e78e7f591b1e61f2b8c489a80743", "committedDate": "2020-10-22T14:03:51Z", "message": "Add enforcer.skip to maven setup"}, "afterCommit": {"oid": "b9d65f17ea1aa0f4338064b278d8c1fcb2f0cfe9", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/b9d65f17ea1aa0f4338064b278d8c1fcb2f0cfe9", "committedDate": "2020-10-22T15:20:53Z", "message": "Add enforcer.skip to maven setup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09fa83625304198106cea3f5cc91a92d6aaa4117", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/09fa83625304198106cea3f5cc91a92d6aaa4117", "committedDate": "2020-10-23T06:45:51Z", "message": "Setup maven config for nightly build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MzgzOTcz", "url": "https://github.com/kiegroup/optaplanner/pull/976#pullrequestreview-515383973", "createdAt": "2020-10-23T06:43:11Z", "commit": {"oid": "b9d65f17ea1aa0f4338064b278d8c1fcb2f0cfe9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjo0Mzo1OFrOHnAr_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjo0Mzo1OFrOHnAr_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2Nzc3NA==", "bodyText": "similar here for the change. See https://github.com/kiegroup/kogito-examples/pull/416/files#diff-102df37262fd32095c3c8ccc12daad8face4939c97eb4a207fba25c1aa0be4a1L285-R284", "url": "https://github.com/kiegroup/optaplanner/pull/976#discussion_r510667774", "createdAt": "2020-10-23T06:43:58Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -129,6 +249,55 @@ void runMaven(String goals, String directory, boolean skipTests = false, List pr\n         mvnCmd += \" ${extraArgs}\"\n     }\n     dir(directory) {\n-        maven.runMavenWithSubmarineSettings(mvnCmd, skipTests)\n+        if(isRelease()){\n+            // In case of release, we already have the settings.xml\n+            maven.runMaven(mvnCmd, skipTests, ['-fae'])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9d65f17ea1aa0f4338064b278d8c1fcb2f0cfe9"}, "originalPosition": 223}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "566a72aa96af8ab34b8821c2f611357ffe5c215d", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/566a72aa96af8ab34b8821c2f611357ffe5c215d", "committedDate": "2020-10-23T07:11:36Z", "message": "Remove the enforcer skip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa17a9286c9203a7769be3fa5d59505971953fda", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/aa17a9286c9203a7769be3fa5d59505971953fda", "committedDate": "2020-10-23T07:12:43Z", "message": "Use correct maven settings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1NDEwMDgy", "url": "https://github.com/kiegroup/optaplanner/pull/976#pullrequestreview-515410082", "createdAt": "2020-10-23T07:30:03Z", "commit": {"oid": "aa17a9286c9203a7769be3fa5d59505971953fda"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3261, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}