{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyOTcwMTkw", "number": 998, "title": "PLANNER-2217 Automate release of OptaPlanner documentation and distribution", "bodyText": "First step: add a script that will be called from the release pipeline. The script uploads the docs and distribution.\nTODO:\n\nprovide documentation for the release process\n\n\nJIRA\nhttps://issues.redhat.com/browse/PLANNER-2217\n\n\nReferenced pull requests\nkiegroup/optaplanner-website#295\n\n\nChecklist\n\n Documentation updated if applicable.\n Upgrade recipe provided if applicable.\n\n\n\nHow to retest this PR or trigger a specific build:\n\n\nfor a pull request build please add comment: Jenkins retest this\nfor a full downstream build please add comment: Jenkins run fdb\nfor a compile downstream build please add comment: Jenkins run cdb\nfor a full production downstream build please add comment: Jenkins execute product fdb\nfor an upstream build please add comment: Jenkins run upstream", "createdAt": "2020-10-30T12:45:13Z", "url": "https://github.com/kiegroup/optaplanner/pull/998", "merged": true, "mergeCommit": {"oid": "45f3aa8afd637df7468f68e5d452370620bcc9a0"}, "closed": true, "closedAt": "2020-11-04T19:03:33Z", "author": {"login": "rsynek"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXmlF4AFqTUyMDY1MzE1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZSOgugBqjM5NTg5Njg0Mzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjUzMTUx", "url": "https://github.com/kiegroup/optaplanner/pull/998#pullrequestreview-520653151", "createdAt": "2020-10-30T13:13:53Z", "commit": {"oid": "c41a730bfeb4fe8ac3d8454aa49c589caeb126fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzoxMzo1M1rOHrOZLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzoxMzo1M1rOHrOZLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4NjYzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              echo \"Make sure the OptaPlanner project has been build with the full profile enabled before calling this script.\"\n          \n          \n            \n              echo \"Make sure the OptaPlanner project has been built with the full profile enabled before calling this script.\"", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r515086638", "createdAt": "2020-10-30T13:13:53Z", "author": {"login": "triceo"}, "path": "build/release/upload_distribution.sh", "diffHunk": "@@ -0,0 +1,78 @@\n+#!/bin/bash\n+\n+function display_help() {\n+  readonly script_name=\"./$(basename \"$0\")\"\n+\n+  echo \"This script uploads the documentation, javadocs and distribution.zip to the filemgmt.jboss.org.\"\n+  echo \"Make sure the OptaPlanner project has been build with the full profile enabled before calling this script.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c41a730bfeb4fe8ac3d8454aa49c589caeb126fe"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "107e2268f6afd80b9360d01639c6f34325b3f1a8", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/107e2268f6afd80b9360d01639c6f34325b3f1a8", "committedDate": "2020-10-30T14:23:04Z", "message": "Fix a typo\n\nCo-authored-by: Luk\u00e1\u0161 Petrovick\u00fd <lukas@petrovicky.net>"}, "afterCommit": {"oid": "e6036e299c8e2dbfbc9c1756b873ab96e0fc17f5", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/e6036e299c8e2dbfbc9c1756b873ab96e0fc17f5", "committedDate": "2020-10-30T15:57:38Z", "message": "PLANNER-2217 Add script for uploading distribution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6036e299c8e2dbfbc9c1756b873ab96e0fc17f5", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/e6036e299c8e2dbfbc9c1756b873ab96e0fc17f5", "committedDate": "2020-10-30T15:57:38Z", "message": "PLANNER-2217 Add script for uploading distribution"}, "afterCommit": {"oid": "06116fee718db8bae2566df2025a61add7dc22a1", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/06116fee718db8bae2566df2025a61add7dc22a1", "committedDate": "2020-10-30T16:36:35Z", "message": "PLANNER-2217 Add script for uploading distribution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ddc112a2566071b374468b19a6550b4abc2cbac3", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/ddc112a2566071b374468b19a6550b4abc2cbac3", "committedDate": "2020-11-03T19:24:48Z", "message": "Fix mavenCleanInstall call"}, "afterCommit": {"oid": "2cbe73508961e3c3a6d881ed4a18e125cf8e0056", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/2cbe73508961e3c3a6d881ed4a18e125cf8e0056", "committedDate": "2020-11-03T19:40:12Z", "message": "Fix mavenCleanInstall call"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2748a1dd16d88d645dde8bbe8c6c941d05b7a762", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/2748a1dd16d88d645dde8bbe8c6c941d05b7a762", "committedDate": "2020-11-03T20:16:53Z", "message": "Fix checkout"}, "afterCommit": {"oid": "d79aac4c924572d31821c44b8fd1c14ec5dbc751", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/d79aac4c924572d31821c44b8fd1c14ec5dbc751", "committedDate": "2020-11-03T20:31:26Z", "message": "Fix checkout"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53fe89ee2320ab1282916fef37078981652b1e64", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/53fe89ee2320ab1282916fef37078981652b1e64", "committedDate": "2020-11-03T21:25:16Z", "message": "Fix shell call"}, "afterCommit": {"oid": "a9e98f508452c3bc16399729691143e91fbbabc5", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/a9e98f508452c3bc16399729691143e91fbbabc5", "committedDate": "2020-11-04T11:06:44Z", "message": "PLANNER-2217 Upload docs and distribution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMzQ4NTY1", "url": "https://github.com/kiegroup/optaplanner/pull/998#pullrequestreview-523348565", "createdAt": "2020-11-04T13:16:44Z", "commit": {"oid": "a9e98f508452c3bc16399729691143e91fbbabc5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMzQ5NzQ2", "url": "https://github.com/kiegroup/optaplanner/pull/998#pullrequestreview-523349746", "createdAt": "2020-11-04T13:18:15Z", "commit": {"oid": "a9e98f508452c3bc16399729691143e91fbbabc5"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMzoxODoxNlrOHtXpuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMzoxOTowOVrOHtXruA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMzNTQ4Mw==", "bodyText": "-8.xsd suffixes are for version 8.x explicitly ?", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r517335483", "createdAt": "2020-11-04T13:18:16Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.promote", "diffHunk": "@@ -92,6 +92,53 @@ pipeline {\n             }\n         }\n \n+        stage('Upload documentation and distribution') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    mavenCleanInstall('optaplanner', true, ['full'])\n+                    dir('optaplanner') {\n+                        withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n+                                             keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n+                            // For testing, simulate connection via SSH:\n+                            // sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Update OptaPlanner website') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    final String websiteRepository = 'optaplanner-website'\n+                    dir(websiteRepository) {\n+                        String prBranchName = createWebsitePrBranch(websiteRepository)\n+\n+                        // Update versions in links on the website.\n+                        String nextMinorSnapshot = util.getNextVersion(getProjectVersion(), 'minor')\n+                        sh \"./build/update-versions.sh ${getProjectVersion()} $nextMinorSnapshot\"\n+\n+                        // Update the XSDs. OptaPlanner must be cloned and build with the full profile before.\n+                        String optaplannerRoot = \"$WORKSPACE/optaplanner\"\n+                        sh \"cp $optaplannerRoot/optaplanner-core/target/classes/solver.xsd xsd/solver/solver-8.xsd\"\n+                        sh \"cp $optaplannerRoot/optaplanner-benchmark/target/classes/benchmark.xsd xsd/benchmark/benchmark-8.xsd\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e98f508452c3bc16399729691143e91fbbabc5"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMzNTk5Mg==", "bodyText": "why not using getNextSnapshot method ?", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r517335992", "createdAt": "2020-11-04T13:19:09Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.promote", "diffHunk": "@@ -92,6 +92,53 @@ pipeline {\n             }\n         }\n \n+        stage('Upload documentation and distribution') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    mavenCleanInstall('optaplanner', true, ['full'])\n+                    dir('optaplanner') {\n+                        withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n+                                             keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n+                            // For testing, simulate connection via SSH:\n+                            // sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Update OptaPlanner website') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    final String websiteRepository = 'optaplanner-website'\n+                    dir(websiteRepository) {\n+                        String prBranchName = createWebsitePrBranch(websiteRepository)\n+\n+                        // Update versions in links on the website.\n+                        String nextMinorSnapshot = util.getNextVersion(getProjectVersion(), 'minor')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9e98f508452c3bc16399729691143e91fbbabc5"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a9e98f508452c3bc16399729691143e91fbbabc5", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/a9e98f508452c3bc16399729691143e91fbbabc5", "committedDate": "2020-11-04T11:06:44Z", "message": "PLANNER-2217 Upload docs and distribution"}, "afterCommit": {"oid": "cc28e60dd1bade4f0aade7bddb32ff885bec2f1b", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/cc28e60dd1bade4f0aade7bddb32ff885bec2f1b", "committedDate": "2020-11-04T15:15:22Z", "message": "PLANNER-2217 Upload docs and distribution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b5f5ed24f54f94b82d15728653f0822db92a69c", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/6b5f5ed24f54f94b82d15728653f0822db92a69c", "committedDate": "2020-11-04T18:39:14Z", "message": "PLANNER-2217 Add script for uploading distribution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cb7a87432fbf04c5da4712d81693bcefdfede08", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/1cb7a87432fbf04c5da4712d81693bcefdfede08", "committedDate": "2020-11-04T18:39:14Z", "message": "PLANNER-2217 Upload docs and distribution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc28e60dd1bade4f0aade7bddb32ff885bec2f1b", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/cc28e60dd1bade4f0aade7bddb32ff885bec2f1b", "committedDate": "2020-11-04T15:15:22Z", "message": "PLANNER-2217 Upload docs and distribution"}, "afterCommit": {"oid": "1cb7a87432fbf04c5da4712d81693bcefdfede08", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/1cb7a87432fbf04c5da4712d81693bcefdfede08", "committedDate": "2020-11-04T18:39:14Z", "message": "PLANNER-2217 Upload docs and distribution"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3104, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}