{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MTQ1NTA5", "number": 955, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMTozNjozM1rOEp9Ilg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNzowNDozNVrOEqLyLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNDI4Njk0OnYy", "diffSide": "RIGHT", "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/test/java/org/optaplanner/persistence/jackson/impl/domain/solution/JsonSolutionFileIOTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMTozNjozM1rOHb8QUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxNjo1MDoxOFrOHcChHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2MDgxNg==", "bodyText": "This was the only assertion that this SolutionFileIO unit test had.\nI am not sure how to make these the same objects with Jackson", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499060816", "createdAt": "2020-10-02T21:36:33Z", "author": {"login": "cemnura"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/test/java/org/optaplanner/persistence/jackson/impl/domain/solution/JsonSolutionFileIOTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.optaplanner.core.impl.testdata.util.PlannerAssert.assertAllCodesOfIterator;\n+import static org.optaplanner.core.impl.testdata.util.PlannerAssert.assertCode;\n+\n+import java.io.File;\n+import java.util.Arrays;\n+\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.optaplanner.core.api.score.buildin.simple.SimpleScore;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataEntity;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataSolution;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataValue;\n+\n+public class JsonSolutionFileIOTest {\n+\n+    private static File solutionTestDir;\n+\n+    @BeforeAll\n+    public static void setup() {\n+        solutionTestDir = new File(\"target/solutionTest/\");\n+        solutionTestDir.mkdirs();\n+    }\n+\n+    @Test\n+    public void readAndWrite() {\n+        JsonSolutionFileIO<JacksonTestdataSolution> solutionFileIO = new JsonSolutionFileIO<>();\n+        File file = new File(solutionTestDir, \"testdataSolution.json\");\n+\n+        JacksonTestdataSolution original = new JacksonTestdataSolution(\"s1\");\n+        JacksonTestdataValue originalV1 = new JacksonTestdataValue(\"v1\");\n+        original.setValueList(Arrays.asList(originalV1, new JacksonTestdataValue(\"v2\")));\n+        original.setEntityList(Arrays.asList(\n+                new JacksonTestdataEntity(\"e1\"), new JacksonTestdataEntity(\"e2\", originalV1), new JacksonTestdataEntity(\"e3\")));\n+        original.setScore(SimpleScore.of(-321));\n+        solutionFileIO.write(original, file);\n+        JacksonTestdataSolution copy = solutionFileIO.read(file);\n+\n+        assertThat(copy).isNotSameAs(original);\n+        assertCode(\"s1\", copy);\n+        assertAllCodesOfIterator(copy.getValueList().iterator(), \"v1\", \"v2\");\n+        assertAllCodesOfIterator(copy.getEntityList().iterator(), \"e1\", \"e2\", \"e3\");\n+        JacksonTestdataValue copyV1 = copy.getValueList().get(0);\n+        JacksonTestdataEntity copyE2 = copy.getEntityList().get(1);\n+        assertCode(\"v1\", copyE2.getValue());\n+        //        assertThat(copyE2.getValue()).isSameAs(copyV1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f54e3081b0aaba03ee83fbbe32c3a5884522bc9"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MzQyMA==", "bodyText": "@ge0ffrey would this assertion in the unit test be of any importance?", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499163420", "createdAt": "2020-10-03T16:50:18Z", "author": {"login": "cemnura"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/test/java/org/optaplanner/persistence/jackson/impl/domain/solution/JsonSolutionFileIOTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.optaplanner.core.impl.testdata.util.PlannerAssert.assertAllCodesOfIterator;\n+import static org.optaplanner.core.impl.testdata.util.PlannerAssert.assertCode;\n+\n+import java.io.File;\n+import java.util.Arrays;\n+\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.optaplanner.core.api.score.buildin.simple.SimpleScore;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataEntity;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataSolution;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataValue;\n+\n+public class JsonSolutionFileIOTest {\n+\n+    private static File solutionTestDir;\n+\n+    @BeforeAll\n+    public static void setup() {\n+        solutionTestDir = new File(\"target/solutionTest/\");\n+        solutionTestDir.mkdirs();\n+    }\n+\n+    @Test\n+    public void readAndWrite() {\n+        JsonSolutionFileIO<JacksonTestdataSolution> solutionFileIO = new JsonSolutionFileIO<>();\n+        File file = new File(solutionTestDir, \"testdataSolution.json\");\n+\n+        JacksonTestdataSolution original = new JacksonTestdataSolution(\"s1\");\n+        JacksonTestdataValue originalV1 = new JacksonTestdataValue(\"v1\");\n+        original.setValueList(Arrays.asList(originalV1, new JacksonTestdataValue(\"v2\")));\n+        original.setEntityList(Arrays.asList(\n+                new JacksonTestdataEntity(\"e1\"), new JacksonTestdataEntity(\"e2\", originalV1), new JacksonTestdataEntity(\"e3\")));\n+        original.setScore(SimpleScore.of(-321));\n+        solutionFileIO.write(original, file);\n+        JacksonTestdataSolution copy = solutionFileIO.read(file);\n+\n+        assertThat(copy).isNotSameAs(original);\n+        assertCode(\"s1\", copy);\n+        assertAllCodesOfIterator(copy.getValueList().iterator(), \"v1\", \"v2\");\n+        assertAllCodesOfIterator(copy.getEntityList().iterator(), \"e1\", \"e2\", \"e3\");\n+        JacksonTestdataValue copyV1 = copy.getValueList().get(0);\n+        JacksonTestdataEntity copyE2 = copy.getEntityList().get(1);\n+        assertCode(\"v1\", copyE2.getValue());\n+        //        assertThat(copyE2.getValue()).isSameAs(copyV1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2MDgxNg=="}, "originalCommit": {"oid": "5f54e3081b0aaba03ee83fbbe32c3a5884522bc9"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNDI4ODY0OnYy", "diffSide": "RIGHT", "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JsonSolutionFileIO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMTozNzoyMlrOHb8RVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMTozNzoyMlrOHb8RVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2MTA3Nw==", "bodyText": "Could provide more documentation to explain the construction with Jackson ObjectMapper", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499061077", "createdAt": "2020-10-02T21:37:22Z", "author": {"login": "cemnura"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JsonSolutionFileIO.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.optaplanner.core.api.domain.solution.PlanningSolution;\n+import org.optaplanner.persistence.common.api.domain.solution.SolutionFileIO;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.SerializationFeature;\n+import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\n+\n+/**\n+ *\n+ * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f54e3081b0aaba03ee83fbbe32c3a5884522bc9"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNDk2ODE2OnYy", "diffSide": "RIGHT", "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JsonSolutionFileIO.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxNDoyNzowN1rOHcB16g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxNzoxNDoxNlrOHcCoJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE1MjM2Mg==", "bodyText": "Naming wise, let's use the word Jackson in here, in case we build a Jsonb version too.", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499152362", "createdAt": "2020-10-03T14:27:07Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JsonSolutionFileIO.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.optaplanner.core.api.domain.solution.PlanningSolution;\n+import org.optaplanner.persistence.common.api.domain.solution.SolutionFileIO;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.SerializationFeature;\n+import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\n+\n+/**\n+ *\n+ * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation\n+ */\n+public class JsonSolutionFileIO<Solution_> implements SolutionFileIO<Solution_> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f54e3081b0aaba03ee83fbbe32c3a5884522bc9"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE1MjU2Mg==", "bodyText": "So JacksonSolutionFileIO? And ...Test.", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499152562", "createdAt": "2020-10-03T14:29:41Z", "author": {"login": "ge0ffrey"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JsonSolutionFileIO.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.optaplanner.core.api.domain.solution.PlanningSolution;\n+import org.optaplanner.persistence.common.api.domain.solution.SolutionFileIO;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.SerializationFeature;\n+import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\n+\n+/**\n+ *\n+ * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation\n+ */\n+public class JsonSolutionFileIO<Solution_> implements SolutionFileIO<Solution_> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE1MjM2Mg=="}, "originalCommit": {"oid": "5f54e3081b0aaba03ee83fbbe32c3a5884522bc9"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NTIyMQ==", "bodyText": "I changed the class JsonSolutionFileIO to JacksonSolutionFileIO which is much more appropriate.", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499165221", "createdAt": "2020-10-03T17:14:16Z", "author": {"login": "cemnura"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JsonSolutionFileIO.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.optaplanner.core.api.domain.solution.PlanningSolution;\n+import org.optaplanner.persistence.common.api.domain.solution.SolutionFileIO;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.SerializationFeature;\n+import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\n+\n+/**\n+ *\n+ * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation\n+ */\n+public class JsonSolutionFileIO<Solution_> implements SolutionFileIO<Solution_> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE1MjM2Mg=="}, "originalCommit": {"oid": "5f54e3081b0aaba03ee83fbbe32c3a5884522bc9"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjY2OTM0OnYy", "diffSide": "RIGHT", "path": "optaplanner-docs/src/main/asciidoc/BenchmarkingAndTweaking/BenchmarkingAndTweaking-chapter.adoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjo1Nzo1MlrOHcPpFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjo1Nzo1MlrOHcPpFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3ODQ1Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the JSON file requires specific Jackson modules and features to be enabled/disabled.\n          \n          \n            \n            You could create your desired object mapper as an dependency to the JacksonSolutionFileIO as the following.\n          \n          \n            \n            \n          \n          \n            \n            If the JSON file requires specific Jackson modules and features to be enabled/disabled.\n          \n          \n            \n            You could create your desired object mapper as a dependency to the JacksonSolutionFileIO as follows:", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499378452", "createdAt": "2020-10-05T06:57:52Z", "author": {"login": "triceo"}, "path": "optaplanner-docs/src/main/asciidoc/BenchmarkingAndTweaking/BenchmarkingAndTweaking-chapter.adoc", "diffHunk": "@@ -240,6 +240,47 @@ Regardless, XML is still a very verbose format.\n Reading or writing large datasets in this format can cause an `OutOfMemoryError`, `StackOverflowError`\n or large performance degradation.\n \n+[[JacksonSolutionFileIO]]\n+==== `JacksonSolutionFileIO`: serialize to and from an JSON format\n+\n+To read and write solutions in JSON format via Jackson, extend the `JacksonSolutionFileIO`:\n+\n+[source,java,options=\"nowrap\"]\n+----\n+public class NQueensJsonSolutionFileIO extends JacksonSolutionFileIO<NQueens> {\n+    public NQueensJsonSolutionFileIO() {\n+        // NQueens is the @PlanningSolution class.\n+        super(NQueens.class);\n+    }\n+}\n+----\n+If the JSON file requires specific Jackson modules and features to be enabled/disabled.\n+You could create your desired object mapper as an dependency to the JacksonSolutionFileIO as the following.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc62e916d5d21265676fc25e11d70975d5477f"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjY3MDEzOnYy", "diffSide": "RIGHT", "path": "optaplanner-docs/src/main/asciidoc/BenchmarkingAndTweaking/BenchmarkingAndTweaking-chapter.adoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjo1ODoxMVrOHcPpkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjo1ODoxMVrOHcPpkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3ODU3OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            and use it in the benchmark configuration:\n          \n          \n            \n            Then use it in the benchmark configuration like so:", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499378578", "createdAt": "2020-10-05T06:58:11Z", "author": {"login": "triceo"}, "path": "optaplanner-docs/src/main/asciidoc/BenchmarkingAndTweaking/BenchmarkingAndTweaking-chapter.adoc", "diffHunk": "@@ -240,6 +240,47 @@ Regardless, XML is still a very verbose format.\n Reading or writing large datasets in this format can cause an `OutOfMemoryError`, `StackOverflowError`\n or large performance degradation.\n \n+[[JacksonSolutionFileIO]]\n+==== `JacksonSolutionFileIO`: serialize to and from an JSON format\n+\n+To read and write solutions in JSON format via Jackson, extend the `JacksonSolutionFileIO`:\n+\n+[source,java,options=\"nowrap\"]\n+----\n+public class NQueensJsonSolutionFileIO extends JacksonSolutionFileIO<NQueens> {\n+    public NQueensJsonSolutionFileIO() {\n+        // NQueens is the @PlanningSolution class.\n+        super(NQueens.class);\n+    }\n+}\n+----\n+If the JSON file requires specific Jackson modules and features to be enabled/disabled.\n+You could create your desired object mapper as an dependency to the JacksonSolutionFileIO as the following.\n+[source,java,options=\"nowrap\"]\n+----\n+public class NQueensJsonSolutionFileIO extends JacksonSolutionFileIO<NQueens> {\n+    public NQueensJsonSolutionFileIO() {\n+        // NQueens is the @PlanningSolution class.\n+        super(NQueens.class,\n+                new ObjectMapper()\n+                        .registerModule(new JavaTimeModule())\n+                        .disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS)\n+        );\n+    }\n+\n+}\n+----\n+\n+and use it in the benchmark configuration:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc62e916d5d21265676fc25e11d70975d5477f"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjY4MzAzOnYy", "diffSide": "RIGHT", "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JacksonSolutionFileIO.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNzowMzowMVrOHcPxUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxOTozNTo0MFrOHcq95A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM4MDU2MA==", "bodyText": "Please make the class final, the fields private final.", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499380560", "createdAt": "2020-10-05T07:03:01Z", "author": {"login": "triceo"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JacksonSolutionFileIO.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.optaplanner.core.api.domain.solution.PlanningSolution;\n+import org.optaplanner.persistence.common.api.domain.solution.SolutionFileIO;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+/**\n+ *\n+ * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation\n+ */\n+public class JacksonSolutionFileIO<Solution_> implements SolutionFileIO<Solution_> {\n+\n+    protected Class<Solution_> clazz;\n+    protected ObjectMapper mapper;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc62e916d5d21265676fc25e11d70975d5477f"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyMDk5Mw==", "bodyText": "Sure thing i could convert the fields to be private final. Since the clazz and the mapper should never be changed after initialization.\nHowever, wouldn't making the class final prevent clients from extending this SolutionFileIO implementation for there own planning solution.\nTherefore, clients would not be able to use the SolutionFileIO as explained in the documentation similar to XStreamSolutionFIleIO.\nI made fields private final and waiting for your feedback on making the class final.", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499820993", "createdAt": "2020-10-05T19:25:49Z", "author": {"login": "cemnura"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JacksonSolutionFileIO.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.optaplanner.core.api.domain.solution.PlanningSolution;\n+import org.optaplanner.persistence.common.api.domain.solution.SolutionFileIO;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+/**\n+ *\n+ * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation\n+ */\n+public class JacksonSolutionFileIO<Solution_> implements SolutionFileIO<Solution_> {\n+\n+    protected Class<Solution_> clazz;\n+    protected ObjectMapper mapper;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM4MDU2MA=="}, "originalCommit": {"oid": "e0bc62e916d5d21265676fc25e11d70975d5477f"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyNDM4Ng==", "bodyText": "Good point on the class. I forgot we would be extending it. Nevermind then.", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499824386", "createdAt": "2020-10-05T19:32:26Z", "author": {"login": "triceo"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JacksonSolutionFileIO.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.optaplanner.core.api.domain.solution.PlanningSolution;\n+import org.optaplanner.persistence.common.api.domain.solution.SolutionFileIO;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+/**\n+ *\n+ * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation\n+ */\n+public class JacksonSolutionFileIO<Solution_> implements SolutionFileIO<Solution_> {\n+\n+    protected Class<Solution_> clazz;\n+    protected ObjectMapper mapper;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM4MDU2MA=="}, "originalCommit": {"oid": "e0bc62e916d5d21265676fc25e11d70975d5477f"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyNTAwNQ==", "bodyText": "Great! Should I mark as resolved?", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499825005", "createdAt": "2020-10-05T19:33:38Z", "author": {"login": "cemnura"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JacksonSolutionFileIO.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.optaplanner.core.api.domain.solution.PlanningSolution;\n+import org.optaplanner.persistence.common.api.domain.solution.SolutionFileIO;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+/**\n+ *\n+ * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation\n+ */\n+public class JacksonSolutionFileIO<Solution_> implements SolutionFileIO<Solution_> {\n+\n+    protected Class<Solution_> clazz;\n+    protected ObjectMapper mapper;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM4MDU2MA=="}, "originalCommit": {"oid": "e0bc62e916d5d21265676fc25e11d70975d5477f"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyNjE0OA==", "bodyText": "Resolving.", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499826148", "createdAt": "2020-10-05T19:35:40Z", "author": {"login": "triceo"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/main/java/org/optaplanner/persistence/jackson/impl/domain/solution/JacksonSolutionFileIO.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.optaplanner.core.api.domain.solution.PlanningSolution;\n+import org.optaplanner.persistence.common.api.domain.solution.SolutionFileIO;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+/**\n+ *\n+ * @param <Solution_> the solution type, the class with the {@link PlanningSolution} annotation\n+ */\n+public class JacksonSolutionFileIO<Solution_> implements SolutionFileIO<Solution_> {\n+\n+    protected Class<Solution_> clazz;\n+    protected ObjectMapper mapper;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM4MDU2MA=="}, "originalCommit": {"oid": "e0bc62e916d5d21265676fc25e11d70975d5477f"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjY4NzE2OnYy", "diffSide": "RIGHT", "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/test/java/org/optaplanner/persistence/jackson/impl/domain/solution/JacksonSolutionFileIOTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNzowNDozNVrOHcPzsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMDowNjo1MlrOHcr8OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM4MTE2OQ==", "bodyText": "I would like to see a proof of concept that this actually works. The following article suggests that it is possible with some extra annotations on the data model:\nhttps://stackoverflow.com/questions/18306040/jackson-deserialize-jsonidentityreference-alwaysasid-true/29742035#29742035\nYou may need to adapt JacksonTestdataSolution to get it done.", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499381169", "createdAt": "2020-10-05T07:04:35Z", "author": {"login": "triceo"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/test/java/org/optaplanner/persistence/jackson/impl/domain/solution/JacksonSolutionFileIOTest.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.optaplanner.core.impl.testdata.util.PlannerAssert.assertAllCodesOfIterator;\n+import static org.optaplanner.core.impl.testdata.util.PlannerAssert.assertCode;\n+\n+import java.io.File;\n+import java.util.Arrays;\n+\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.optaplanner.core.api.score.buildin.simple.SimpleScore;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataEntity;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataSolution;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataValue;\n+\n+public class JacksonSolutionFileIOTest {\n+\n+    private static File solutionTestDir;\n+\n+    @BeforeAll\n+    public static void setup() {\n+        solutionTestDir = new File(\"target/solutionTest/\");\n+        solutionTestDir.mkdirs();\n+    }\n+\n+    @Test\n+    public void readAndWrite() {\n+        JacksonSolutionFileIO<JacksonTestdataSolution> solutionFileIO =\n+                new JacksonSolutionFileIO<>(JacksonTestdataSolution.class);\n+        File file = new File(solutionTestDir, \"testdataSolution.json\");\n+\n+        JacksonTestdataSolution original = new JacksonTestdataSolution(\"s1\");\n+        JacksonTestdataValue originalV1 = new JacksonTestdataValue(\"v1\");\n+        original.setValueList(Arrays.asList(originalV1, new JacksonTestdataValue(\"v2\")));\n+        original.setEntityList(Arrays.asList(\n+                new JacksonTestdataEntity(\"e1\"), new JacksonTestdataEntity(\"e2\", originalV1), new JacksonTestdataEntity(\"e3\")));\n+        original.setScore(SimpleScore.of(-321));\n+        solutionFileIO.write(original, file);\n+        JacksonTestdataSolution copy = solutionFileIO.read(file);\n+\n+        assertThat(copy).isNotSameAs(original);\n+        assertCode(\"s1\", copy);\n+        assertAllCodesOfIterator(copy.getValueList().iterator(), \"v1\", \"v2\");\n+        assertAllCodesOfIterator(copy.getEntityList().iterator(), \"e1\", \"e2\", \"e3\");\n+        JacksonTestdataValue copyV1 = copy.getValueList().get(0);\n+        JacksonTestdataEntity copyE2 = copy.getEntityList().get(1);\n+        assertCode(\"v1\", copyE2.getValue());\n+        //        assertThat(copyE2.getValue()).isSameAs(copyV1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc62e916d5d21265676fc25e11d70975d5477f"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg0MjEwNQ==", "bodyText": "I tried the article you provided. However, I was unable to find any success.\nI stumbled upon the following suggestion:\nhttps://stackoverflow.com/questions/37640985/jackson-referencing-the-same-object\nThis way I was able de-serialize the objects string values as one object. Therefore, assertion that theJacksonTestdataValue code field are the same objects.\nHowever, this assertion seems to be a Jackson feature rather then enabling loading an JSON input solution file with jackson.\nI added the the code to enable this assertion to be successful so you could observe. Would reorganize upon your approval.", "url": "https://github.com/kiegroup/optaplanner/pull/955#discussion_r499842105", "createdAt": "2020-10-05T20:06:52Z", "author": {"login": "cemnura"}, "path": "optaplanner-persistence/optaplanner-persistence-jackson/src/test/java/org/optaplanner/persistence/jackson/impl/domain/solution/JacksonSolutionFileIOTest.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.optaplanner.persistence.jackson.impl.domain.solution;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.optaplanner.core.impl.testdata.util.PlannerAssert.assertAllCodesOfIterator;\n+import static org.optaplanner.core.impl.testdata.util.PlannerAssert.assertCode;\n+\n+import java.io.File;\n+import java.util.Arrays;\n+\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.optaplanner.core.api.score.buildin.simple.SimpleScore;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataEntity;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataSolution;\n+import org.optaplanner.persistence.jackson.impl.testdata.domain.JacksonTestdataValue;\n+\n+public class JacksonSolutionFileIOTest {\n+\n+    private static File solutionTestDir;\n+\n+    @BeforeAll\n+    public static void setup() {\n+        solutionTestDir = new File(\"target/solutionTest/\");\n+        solutionTestDir.mkdirs();\n+    }\n+\n+    @Test\n+    public void readAndWrite() {\n+        JacksonSolutionFileIO<JacksonTestdataSolution> solutionFileIO =\n+                new JacksonSolutionFileIO<>(JacksonTestdataSolution.class);\n+        File file = new File(solutionTestDir, \"testdataSolution.json\");\n+\n+        JacksonTestdataSolution original = new JacksonTestdataSolution(\"s1\");\n+        JacksonTestdataValue originalV1 = new JacksonTestdataValue(\"v1\");\n+        original.setValueList(Arrays.asList(originalV1, new JacksonTestdataValue(\"v2\")));\n+        original.setEntityList(Arrays.asList(\n+                new JacksonTestdataEntity(\"e1\"), new JacksonTestdataEntity(\"e2\", originalV1), new JacksonTestdataEntity(\"e3\")));\n+        original.setScore(SimpleScore.of(-321));\n+        solutionFileIO.write(original, file);\n+        JacksonTestdataSolution copy = solutionFileIO.read(file);\n+\n+        assertThat(copy).isNotSameAs(original);\n+        assertCode(\"s1\", copy);\n+        assertAllCodesOfIterator(copy.getValueList().iterator(), \"v1\", \"v2\");\n+        assertAllCodesOfIterator(copy.getEntityList().iterator(), \"e1\", \"e2\", \"e3\");\n+        JacksonTestdataValue copyV1 = copy.getValueList().get(0);\n+        JacksonTestdataEntity copyE2 = copy.getEntityList().get(1);\n+        assertCode(\"v1\", copyE2.getValue());\n+        //        assertThat(copyE2.getValue()).isSameAs(copyV1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM4MTE2OQ=="}, "originalCommit": {"oid": "e0bc62e916d5d21265676fc25e11d70975d5477f"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4280, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}