{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1OTM1OTg3", "number": 1045, "title": "PLANNER-2216 Add Optawebs to the release pipeline", "bodyText": "Tested with https://rhba-jenkins.rhev-ci-vms.eng.rdu2.redhat.com/job/custom/job/rsynek/job/releasePipeline/job/kogito-release/28/.\n\nJIRA\nhttps://issues.redhat.com/browse/PLANNER-2216\n\n\nReferenced pull requests\nkiegroup/kogito-pipelines#90\n\n\nChecklist\n\n Documentation updated if applicable.\n Upgrade recipe provided if applicable.\n\n\n\nHow to retest this PR or trigger a specific build:\n\n\nfor a pull request build please add comment: Jenkins retest this\nfor a full downstream build please add comment: Jenkins run fdb\nfor a compile downstream build please add comment: Jenkins run cdb\nfor a full production downstream build please add comment: Jenkins execute product fdb\nfor an upstream build please add comment: Jenkins run upstream", "createdAt": "2020-11-23T19:06:15Z", "url": "https://github.com/kiegroup/optaplanner/pull/1045", "merged": true, "mergeCommit": {"oid": "54de380a58d0fe38ce5a980f65af73b2a0bf7b1e"}, "closed": true, "closedAt": "2020-11-25T13:20:04Z", "author": {"login": "rsynek"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfaAj_AFqTUzNjc2Njc1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdf9ukrABqjQwMzc5MDI0Mzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NzY2NzU2", "url": "https://github.com/kiegroup/optaplanner/pull/1045#pullrequestreview-536766756", "createdAt": "2020-11-23T19:07:01Z", "commit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOTowNzowMlrOH4bgfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOTowNzowMlrOH4bgfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkzMjk4OA==", "bodyText": "TODO: return back after testing.", "url": "https://github.com/kiegroup/optaplanner/pull/1045#discussion_r528932988", "createdAt": "2020-11-23T19:07:02Z", "author": {"login": "rsynek"}, "path": "Jenkinsfile.promote", "diffHunk": "@@ -77,34 +81,126 @@ pipeline {\n             }\n         }\n \n+        stage('Setup global Maven arguments') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    if (isSpecificMavenConfig()) {\n+                        echo 'Setup Maven release config'\n+                        configFileProvider([configFile(fileId: maven.getSubmarineSettingsXmlId(), targetLocation: 'maven-settings.xml', variable: 'MAVEN_SETTINGS_FILE')]){\n+                            // expose the temp file via a global environment variable for other stages\n+                            env.GLOBAL_MAVEN_ARGS = \"-B -s ${MAVEN_SETTINGS_FILE} -Denforcer.skip=true\"\n+\n+                            sh \"sed -i 's|<repositories>|<repositories><repository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></repository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                            sh \"sed -i 's|<pluginRepositories>|<pluginRepositories><pluginRepository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></pluginRepository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                            sh \"sed -i 's|external:\\\\*|external:*,!staging|g' ${MAVEN_SETTINGS_FILE}\" // Done to allow Maven to download release artifacts from MAVEN_DEPENDENCIES_REPOSITORY\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n         stage('Merge OptaPlanner deploy PR and tag') {\n             when {\n                 expression { return isRelease() }\n             }\n             steps{\n                 script {\n-                    dir('optaplanner') {\n-                        checkoutRepo('optaplanner')\n-                        mergeAndPush('optaplanner', getDeployPrLink('optaplanner'))\n+                    dir(optaplannerRepository) {\n+                        checkoutRepo(optaplannerRepository)\n+                        mergeAndPush(getDeployPrLink(optaplannerRepository))\n+                        tagLatest()\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Merge Optaweb Vehicle Routing deploy PR and tag') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    dir(vehicleRoutingRepository) {\n+                        checkoutRepo(vehicleRoutingRepository)\n+                        mergeAndPush(getDeployPrLink(vehicleRoutingRepository))\n+                        tagLatest()\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Merge Optaweb Employee Rostering deploy PR and tag') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    dir(employeeRosteringRepository) {\n+                        checkoutRepo(employeeRosteringRepository)\n+                        mergeAndPush(getDeployPrLink(employeeRosteringRepository))\n                         tagLatest()\n                     }\n                 }\n             }\n         }\n \n-        stage('Upload documentation and distribution') {\n+        stage('Upload OptaPlanner documentation and distribution') {\n             when {\n                 expression { return isRelease() }\n             }\n             steps {\n                 script {\n-                    mavenCleanInstall('optaplanner', true, [], '-Dfull')\n-                    dir('optaplanner') {\n+                    dir(optaplannerRepository) {\n+                        mavenCleanInstall(true, [], '-Dfull')\n                         withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n                                              keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n                             // For testing, simulate connection via SSH:\n-                            // sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n-                            sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                            sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            // TODO: return back", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "originalPosition": 101}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NzY2ODI5", "url": "https://github.com/kiegroup/optaplanner/pull/1045#pullrequestreview-536766829", "createdAt": "2020-11-23T19:07:08Z", "commit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOTowNzowOFrOH4bgsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOTowNzowOFrOH4bgsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkzMzA0Mg==", "bodyText": "TODO: return back after testing.", "url": "https://github.com/kiegroup/optaplanner/pull/1045#discussion_r528933042", "createdAt": "2020-11-23T19:07:08Z", "author": {"login": "rsynek"}, "path": "Jenkinsfile.promote", "diffHunk": "@@ -77,34 +81,126 @@ pipeline {\n             }\n         }\n \n+        stage('Setup global Maven arguments') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    if (isSpecificMavenConfig()) {\n+                        echo 'Setup Maven release config'\n+                        configFileProvider([configFile(fileId: maven.getSubmarineSettingsXmlId(), targetLocation: 'maven-settings.xml', variable: 'MAVEN_SETTINGS_FILE')]){\n+                            // expose the temp file via a global environment variable for other stages\n+                            env.GLOBAL_MAVEN_ARGS = \"-B -s ${MAVEN_SETTINGS_FILE} -Denforcer.skip=true\"\n+\n+                            sh \"sed -i 's|<repositories>|<repositories><repository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></repository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                            sh \"sed -i 's|<pluginRepositories>|<pluginRepositories><pluginRepository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></pluginRepository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                            sh \"sed -i 's|external:\\\\*|external:*,!staging|g' ${MAVEN_SETTINGS_FILE}\" // Done to allow Maven to download release artifacts from MAVEN_DEPENDENCIES_REPOSITORY\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n         stage('Merge OptaPlanner deploy PR and tag') {\n             when {\n                 expression { return isRelease() }\n             }\n             steps{\n                 script {\n-                    dir('optaplanner') {\n-                        checkoutRepo('optaplanner')\n-                        mergeAndPush('optaplanner', getDeployPrLink('optaplanner'))\n+                    dir(optaplannerRepository) {\n+                        checkoutRepo(optaplannerRepository)\n+                        mergeAndPush(getDeployPrLink(optaplannerRepository))\n+                        tagLatest()\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Merge Optaweb Vehicle Routing deploy PR and tag') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    dir(vehicleRoutingRepository) {\n+                        checkoutRepo(vehicleRoutingRepository)\n+                        mergeAndPush(getDeployPrLink(vehicleRoutingRepository))\n+                        tagLatest()\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Merge Optaweb Employee Rostering deploy PR and tag') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    dir(employeeRosteringRepository) {\n+                        checkoutRepo(employeeRosteringRepository)\n+                        mergeAndPush(getDeployPrLink(employeeRosteringRepository))\n                         tagLatest()\n                     }\n                 }\n             }\n         }\n \n-        stage('Upload documentation and distribution') {\n+        stage('Upload OptaPlanner documentation and distribution') {\n             when {\n                 expression { return isRelease() }\n             }\n             steps {\n                 script {\n-                    mavenCleanInstall('optaplanner', true, [], '-Dfull')\n-                    dir('optaplanner') {\n+                    dir(optaplannerRepository) {\n+                        mavenCleanInstall(true, [], '-Dfull')\n                         withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n                                              keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n                             // For testing, simulate connection via SSH:\n-                            // sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n-                            sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                            sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            // TODO: return back\n+                            //sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Upload Vehicle Routing documentation and distribution') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    dir(vehicleRoutingRepository) {\n+                        mavenCleanInstall(true)\n+                        withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n+                                keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n+                            // For testing, simulate connection via SSH:\n+                            sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            // TODO: return back", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "originalPosition": 121}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NzY2ODg0", "url": "https://github.com/kiegroup/optaplanner/pull/1045#pullrequestreview-536766884", "createdAt": "2020-11-23T19:07:12Z", "commit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOTowNzoxMlrOH4bg2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOTowNzoxMlrOH4bg2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkzMzA4Mg==", "bodyText": "TODO: return back after testing.", "url": "https://github.com/kiegroup/optaplanner/pull/1045#discussion_r528933082", "createdAt": "2020-11-23T19:07:12Z", "author": {"login": "rsynek"}, "path": "Jenkinsfile.promote", "diffHunk": "@@ -77,34 +81,126 @@ pipeline {\n             }\n         }\n \n+        stage('Setup global Maven arguments') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    if (isSpecificMavenConfig()) {\n+                        echo 'Setup Maven release config'\n+                        configFileProvider([configFile(fileId: maven.getSubmarineSettingsXmlId(), targetLocation: 'maven-settings.xml', variable: 'MAVEN_SETTINGS_FILE')]){\n+                            // expose the temp file via a global environment variable for other stages\n+                            env.GLOBAL_MAVEN_ARGS = \"-B -s ${MAVEN_SETTINGS_FILE} -Denforcer.skip=true\"\n+\n+                            sh \"sed -i 's|<repositories>|<repositories><repository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></repository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                            sh \"sed -i 's|<pluginRepositories>|<pluginRepositories><pluginRepository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></pluginRepository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                            sh \"sed -i 's|external:\\\\*|external:*,!staging|g' ${MAVEN_SETTINGS_FILE}\" // Done to allow Maven to download release artifacts from MAVEN_DEPENDENCIES_REPOSITORY\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n         stage('Merge OptaPlanner deploy PR and tag') {\n             when {\n                 expression { return isRelease() }\n             }\n             steps{\n                 script {\n-                    dir('optaplanner') {\n-                        checkoutRepo('optaplanner')\n-                        mergeAndPush('optaplanner', getDeployPrLink('optaplanner'))\n+                    dir(optaplannerRepository) {\n+                        checkoutRepo(optaplannerRepository)\n+                        mergeAndPush(getDeployPrLink(optaplannerRepository))\n+                        tagLatest()\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Merge Optaweb Vehicle Routing deploy PR and tag') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    dir(vehicleRoutingRepository) {\n+                        checkoutRepo(vehicleRoutingRepository)\n+                        mergeAndPush(getDeployPrLink(vehicleRoutingRepository))\n+                        tagLatest()\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Merge Optaweb Employee Rostering deploy PR and tag') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    dir(employeeRosteringRepository) {\n+                        checkoutRepo(employeeRosteringRepository)\n+                        mergeAndPush(getDeployPrLink(employeeRosteringRepository))\n                         tagLatest()\n                     }\n                 }\n             }\n         }\n \n-        stage('Upload documentation and distribution') {\n+        stage('Upload OptaPlanner documentation and distribution') {\n             when {\n                 expression { return isRelease() }\n             }\n             steps {\n                 script {\n-                    mavenCleanInstall('optaplanner', true, [], '-Dfull')\n-                    dir('optaplanner') {\n+                    dir(optaplannerRepository) {\n+                        mavenCleanInstall(true, [], '-Dfull')\n                         withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n                                              keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n                             // For testing, simulate connection via SSH:\n-                            // sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n-                            sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                            sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            // TODO: return back\n+                            //sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Upload Vehicle Routing documentation and distribution') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    dir(vehicleRoutingRepository) {\n+                        mavenCleanInstall(true)\n+                        withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n+                                keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n+                            // For testing, simulate connection via SSH:\n+                            sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            // TODO: return back\n+                            // sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Upload Employee Rostering documentation and distribution') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    dir(employeeRosteringRepository) {\n+                        mavenCleanInstall(true)\n+                        withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n+                                keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n+                            // For testing, simulate connection via SSH:\n+                            sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            // TODO: return back", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "originalPosition": 141}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NzcwNDIx", "url": "https://github.com/kiegroup/optaplanner/pull/1045#pullrequestreview-536770421", "createdAt": "2020-11-23T19:12:35Z", "commit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOToxMjozNVrOH4bsSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOToxMjozNVrOH4bsSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkzNjAwOQ==", "bodyText": "Changes in package-lock.json should not be ignored.", "url": "https://github.com/kiegroup/optaplanner/pull/1045#discussion_r528936009", "createdAt": "2020-11-23T19:12:35Z", "author": {"login": "yurloc"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -263,6 +277,13 @@ void commitAndCreatePR(String repo) {\n     }\n }\n \n+void commitAndCreatePRIgnoringPackageLock(String repo) {\n+    dir(repo) {\n+        sh 'git checkout -- */package-lock.json'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MTU5Nzcx", "url": "https://github.com/kiegroup/optaplanner/pull/1045#pullrequestreview-537159771", "createdAt": "2020-11-24T08:00:06Z", "commit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwODowMDowN1rOH4wHkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwODowMDowN1rOH4wHkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI3MDY3Mw==", "bodyText": "I say this (ssh + script call) could be factorized as you are executing 3 times the same or ?\neven better as you are also using the creds part", "url": "https://github.com/kiegroup/optaplanner/pull/1045#discussion_r529270673", "createdAt": "2020-11-24T08:00:07Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.promote", "diffHunk": "@@ -77,34 +81,126 @@ pipeline {\n             }\n         }\n \n+        stage('Setup global Maven arguments') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    if (isSpecificMavenConfig()) {\n+                        echo 'Setup Maven release config'\n+                        configFileProvider([configFile(fileId: maven.getSubmarineSettingsXmlId(), targetLocation: 'maven-settings.xml', variable: 'MAVEN_SETTINGS_FILE')]){\n+                            // expose the temp file via a global environment variable for other stages\n+                            env.GLOBAL_MAVEN_ARGS = \"-B -s ${MAVEN_SETTINGS_FILE} -Denforcer.skip=true\"\n+\n+                            sh \"sed -i 's|<repositories>|<repositories><repository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></repository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                            sh \"sed -i 's|<pluginRepositories>|<pluginRepositories><pluginRepository><id>staging</id><name>Staging Repository</name><url>${params.MAVEN_DEPENDENCIES_REPOSITORY}</url><layout>default</layout><snapshots><enabled>true</enabled></snapshots><releases><enabled>true</enabled></releases></pluginRepository>|g' ${MAVEN_SETTINGS_FILE}\"\n+                            sh \"sed -i 's|external:\\\\*|external:*,!staging|g' ${MAVEN_SETTINGS_FILE}\" // Done to allow Maven to download release artifacts from MAVEN_DEPENDENCIES_REPOSITORY\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n         stage('Merge OptaPlanner deploy PR and tag') {\n             when {\n                 expression { return isRelease() }\n             }\n             steps{\n                 script {\n-                    dir('optaplanner') {\n-                        checkoutRepo('optaplanner')\n-                        mergeAndPush('optaplanner', getDeployPrLink('optaplanner'))\n+                    dir(optaplannerRepository) {\n+                        checkoutRepo(optaplannerRepository)\n+                        mergeAndPush(getDeployPrLink(optaplannerRepository))\n+                        tagLatest()\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Merge Optaweb Vehicle Routing deploy PR and tag') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    dir(vehicleRoutingRepository) {\n+                        checkoutRepo(vehicleRoutingRepository)\n+                        mergeAndPush(getDeployPrLink(vehicleRoutingRepository))\n+                        tagLatest()\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Merge Optaweb Employee Rostering deploy PR and tag') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps{\n+                script {\n+                    dir(employeeRosteringRepository) {\n+                        checkoutRepo(employeeRosteringRepository)\n+                        mergeAndPush(getDeployPrLink(employeeRosteringRepository))\n                         tagLatest()\n                     }\n                 }\n             }\n         }\n \n-        stage('Upload documentation and distribution') {\n+        stage('Upload OptaPlanner documentation and distribution') {\n             when {\n                 expression { return isRelease() }\n             }\n             steps {\n                 script {\n-                    mavenCleanInstall('optaplanner', true, [], '-Dfull')\n-                    dir('optaplanner') {\n+                    dir(optaplannerRepository) {\n+                        mavenCleanInstall(true, [], '-Dfull')\n                         withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n                                              keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n                             // For testing, simulate connection via SSH:\n-                            // sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n-                            sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                            sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            // TODO: return back\n+                            //sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a0fd8e1e3e941e51aab4702f29f4cde89e15ede"}, "originalPosition": 102}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0f15e1db4299c0a61fa75213b570deafc2e914e", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/a0f15e1db4299c0a61fa75213b570deafc2e914e", "committedDate": "2020-11-24T12:38:48Z", "message": "Create a method for uploading the distribution"}, "afterCommit": {"oid": "76fa2a8ac57352e2cbb61f26cca3973e5a9429a2", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/76fa2a8ac57352e2cbb61f26cca3973e5a9429a2", "committedDate": "2020-11-24T15:49:30Z", "message": "PLANNER-2116 Add Optawebs to the release pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bbd22179801eb7606b8db97c39bb47df542cb02", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/2bbd22179801eb7606b8db97c39bb47df542cb02", "committedDate": "2020-11-24T16:53:40Z", "message": "PLANNER-2116 Add Optawebs to the release pipeline"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76fa2a8ac57352e2cbb61f26cca3973e5a9429a2", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/76fa2a8ac57352e2cbb61f26cca3973e5a9429a2", "committedDate": "2020-11-24T15:49:30Z", "message": "PLANNER-2116 Add Optawebs to the release pipeline"}, "afterCommit": {"oid": "2bbd22179801eb7606b8db97c39bb47df542cb02", "author": {"user": {"login": "rsynek", "name": "Radovan Synek"}}, "url": "https://github.com/kiegroup/optaplanner/commit/2bbd22179801eb7606b8db97c39bb47df542cb02", "committedDate": "2020-11-24T16:53:40Z", "message": "PLANNER-2116 Add Optawebs to the release pipeline"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3130, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}