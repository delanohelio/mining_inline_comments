{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MzM4OTAx", "number": 1411, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjo1NTozNVrODy49ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjo1NTozNVrODy49ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0Njg4NjEzOnYy", "diffSide": "RIGHT", "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjo1NTozNVrOGHMziA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQxNDozOTozNVrOGMFdaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg==", "bodyText": "That's a really ugly band-aid. Have you checked the PR without it?", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r410203016", "createdAt": "2020-04-17T12:55:35Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2643,7 +2643,11 @@ public void testStarImports() throws Exception {\n \t\t\t\"}\\n\");\n \t\t\t//@formatter:on\n \t\t\tint[] loc = findCompletionLocation(unit, \"new ArrayL\");\n+\t\t\tJob.getJobManager().join(DocumentLifeCycleHandler.DOCUMENT_LIFE_CYCLE_JOBS, new NullProgressMonitor());\n \t\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\t\t\tif (list.isIncomplete()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ece2928a15eb1435b772a7c4cf4c2116a7516595"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQwODUyMg==", "bodyText": "I have started 12 jenkins builds.\n\n6 builds without the PR - 1 fails\n6 builds with the PR - 0 fails\n\nThe issue happens because of the completion timeout - https://github.com/eclipse/eclipse.jdt.ls/blob/master/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandler.java#L132", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r410408522", "createdAt": "2020-04-17T18:49:14Z", "author": {"login": "snjeza"}, "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2643,7 +2643,11 @@ public void testStarImports() throws Exception {\n \t\t\t\"}\\n\");\n \t\t\t//@formatter:on\n \t\t\tint[] loc = findCompletionLocation(unit, \"new ArrayL\");\n+\t\t\tJob.getJobManager().join(DocumentLifeCycleHandler.DOCUMENT_LIFE_CYCLE_JOBS, new NullProgressMonitor());\n \t\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\t\t\tif (list.isIncomplete()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}, "originalCommit": {"oid": "ece2928a15eb1435b772a7c4cf4c2116a7516595"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyMTY2Mw==", "bodyText": "Are we waiting for the indexing to finish? Could we ensure it's done before running the completion tests?\nAlso the tests could control the timeout value with a system property", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r410421663", "createdAt": "2020-04-17T19:16:54Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2643,7 +2643,11 @@ public void testStarImports() throws Exception {\n \t\t\t\"}\\n\");\n \t\t\t//@formatter:on\n \t\t\tint[] loc = findCompletionLocation(unit, \"new ArrayL\");\n+\t\t\tJob.getJobManager().join(DocumentLifeCycleHandler.DOCUMENT_LIFE_CYCLE_JOBS, new NullProgressMonitor());\n \t\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\t\t\tif (list.isIncomplete()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}, "originalCommit": {"oid": "ece2928a15eb1435b772a7c4cf4c2116a7516595"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyNjUyMg==", "bodyText": "Are we waiting for the indexing to finish?\n\nYes, we are. See https://github.com/eclipse/eclipse.jdt.ls/blob/master/org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/managers/AbstractProjectsManagerBasedTest.java#L231\n\nAlso the tests could control the timeout value with a system property\n\nThe timeout value is hardcoded\n\nhttps://github.com/eclipse/eclipse.jdt.ls/blob/master/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandler.java#L132\n10e0a06", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r410426522", "createdAt": "2020-04-17T19:27:38Z", "author": {"login": "snjeza"}, "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2643,7 +2643,11 @@ public void testStarImports() throws Exception {\n \t\t\t\"}\\n\");\n \t\t\t//@formatter:on\n \t\t\tint[] loc = findCompletionLocation(unit, \"new ArrayL\");\n+\t\t\tJob.getJobManager().join(DocumentLifeCycleHandler.DOCUMENT_LIFE_CYCLE_JOBS, new NullProgressMonitor());\n \t\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\t\t\tif (list.isIncomplete()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}, "originalCommit": {"oid": "ece2928a15eb1435b772a7c4cf4c2116a7516595"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0OTQ0Mw==", "bodyText": "Yes so it needs to be changed to something like\nprivate static long TIMEOUT  = Long.getLong(\"completion.timeout\", 5000);", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r415249443", "createdAt": "2020-04-26T08:10:52Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2643,7 +2643,11 @@ public void testStarImports() throws Exception {\n \t\t\t\"}\\n\");\n \t\t\t//@formatter:on\n \t\t\tint[] loc = findCompletionLocation(unit, \"new ArrayL\");\n+\t\t\tJob.getJobManager().join(DocumentLifeCycleHandler.DOCUMENT_LIFE_CYCLE_JOBS, new NullProgressMonitor());\n \t\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\t\t\tif (list.isIncomplete()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}, "originalCommit": {"oid": "ece2928a15eb1435b772a7c4cf4c2116a7516595"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMyNTU0NA==", "bodyText": "Done.", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r415325544", "createdAt": "2020-04-26T14:39:35Z", "author": {"login": "snjeza"}, "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2643,7 +2643,11 @@ public void testStarImports() throws Exception {\n \t\t\t\"}\\n\");\n \t\t\t//@formatter:on\n \t\t\tint[] loc = findCompletionLocation(unit, \"new ArrayL\");\n+\t\t\tJob.getJobManager().join(DocumentLifeCycleHandler.DOCUMENT_LIFE_CYCLE_JOBS, new NullProgressMonitor());\n \t\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\t\t\tif (list.isIncomplete()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}, "originalCommit": {"oid": "ece2928a15eb1435b772a7c4cf4c2116a7516595"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3538, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}