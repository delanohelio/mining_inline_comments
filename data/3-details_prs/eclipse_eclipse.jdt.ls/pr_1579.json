{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NjUyNjYz", "number": 1579, "title": "Link .settings directory to 'invisible project'", "bodyText": "Fixes redhat-developer/vscode-java#1657\nRequires redhat-developer/vscode-java#1847\nSigned-off-by: Snjezana Peco snjezana.peco@redhat.com", "createdAt": "2020-10-21T15:45:46Z", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1579", "merged": true, "mergeCommit": {"oid": "1400ad5d47aec41a1fbbeb1b680a7ef690691c04"}, "closed": true, "closedAt": "2021-04-09T15:38:55Z", "author": {"login": "snjeza"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddwf4HAFqTUzMzYxMDk0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABeLOMhNAFqTYzMTg4MTMwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjEwOTQy", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1579#pullrequestreview-533610942", "createdAt": "2020-11-18T16:11:18Z", "commit": {"oid": "f7915bd3230f0c634b0609abd5a4f43b0410c8c9"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7915bd3230f0c634b0609abd5a4f43b0410c8c9", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/f7915bd3230f0c634b0609abd5a4f43b0410c8c9", "committedDate": "2020-10-21T15:44:31Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "a94936c8e8e19d71091f9ba68184e0f1bfd04793", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/a94936c8e8e19d71091f9ba68184e0f1bfd04793", "committedDate": "2021-03-24T22:27:26Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a94936c8e8e19d71091f9ba68184e0f1bfd04793", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/a94936c8e8e19d71091f9ba68184e0f1bfd04793", "committedDate": "2021-03-24T22:27:26Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "36375f7c44485c3aa399978fd53f3099158193ad", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/36375f7c44485c3aa399978fd53f3099158193ad", "committedDate": "2021-03-25T02:15:04Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36375f7c44485c3aa399978fd53f3099158193ad", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/36375f7c44485c3aa399978fd53f3099158193ad", "committedDate": "2021-03-25T02:15:04Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "d983694b4e5fb36915805d0e8704482cfac890de", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/d983694b4e5fb36915805d0e8704482cfac890de", "committedDate": "2021-03-25T17:27:40Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjIyNTM2Mjkw", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1579#pullrequestreview-622536290", "createdAt": "2021-03-26T21:10:45Z", "commit": {"oid": "d983694b4e5fb36915805d0e8704482cfac890de"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQyMToxMDo0NVrOI-rCow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQyMToyOTo1NVrOI-rhDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjU4NzgxMQ==", "bodyText": "I  noticed here that the uri coming from the client had the form file:///.... while the settingsUri was file:/.... I wasn't able to delete the global settings file because of another issue but I would check if this equals gets satisfied when needed.", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1579#discussion_r602587811", "createdAt": "2021-03-26T21:10:45Z", "author": {"login": "rgrunber"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/StandardProjectsManager.java", "diffHunk": "@@ -215,6 +220,16 @@ public void fileChanged(String uriString, CHANGE_TYPE changeType) {\n \t\tif (resource == null) {\n \t\t\treturn;\n \t\t}\n+\t\tURI settingsUri = preferenceManager.getPreferences().getSettingsAsURI();\n+\t\tif (settingsUri != null) {\n+\t\t\tURI uri = JDTUtils.toURI(uriString);\n+\t\t\tif (uri != null && uri.equals(settingsUri) && JavaLanguageServerPlugin.getInstance().getProtocol() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d983694b4e5fb36915805d0e8704482cfac890de"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjU5NTU5Nw==", "bodyText": "If sources from above has something like /home/rgrunber/Scripts/org.eclipse.jdt.core.prefs in the list then toGlobPattern seems to produce /home/rgrunber/Scripts/org.eclipse.jdt.core.prefs/** which I'm guessing means the file doesn't get watched.", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1579#discussion_r602595597", "createdAt": "2021-03-26T21:29:55Z", "author": {"login": "rgrunber"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/StandardProjectsManager.java", "diffHunk": "@@ -358,15 +409,9 @@ public void registerWatchers(boolean runInJob) {\n \t\t\t}\n \t\t\tList<FileSystemWatcher> fileWatchers = new ArrayList<>();\n \t\t\tURI formatter = preferenceManager.getPreferences().getFormatterAsURI();\n-\t\t\tif (formatter != null && \"file\".equals(formatter.getScheme())) {\n-\t\t\t\tFile file = new File(formatter);\n-\t\t\t\tif (file != null && file.isFile()) {\n-\t\t\t\t\tIPath formatterPath = new Path(file.getAbsolutePath());\n-\t\t\t\t\tif (!isContainedIn(formatterPath, sources)) {\n-\t\t\t\t\t\tsources.add(formatterPath);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n+\t\t\taddWatcher(formatter, sources);\n+\t\t\tURI settings = preferenceManager.getPreferences().getSettingsAsURI();\n+\t\t\taddWatcher(settings, sources);\n \t\t\tpatterns.addAll(sources.stream().map(ResourceUtils::toGlobPattern).collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d983694b4e5fb36915805d0e8704482cfac890de"}, "originalPosition": 114}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d983694b4e5fb36915805d0e8704482cfac890de", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/d983694b4e5fb36915805d0e8704482cfac890de", "committedDate": "2021-03-25T17:27:40Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "e3ff31d8bcdddced176f4651e8fcf447eb4e2419", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/e3ff31d8bcdddced176f4651e8fcf447eb4e2419", "committedDate": "2021-03-26T23:05:45Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3ff31d8bcdddced176f4651e8fcf447eb4e2419", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/e3ff31d8bcdddced176f4651e8fcf447eb4e2419", "committedDate": "2021-03-26T23:05:45Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "a447bf556f3a0dab0494f653efbaf02ac1258a27", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/a447bf556f3a0dab0494f653efbaf02ac1258a27", "committedDate": "2021-03-30T22:52:27Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a447bf556f3a0dab0494f653efbaf02ac1258a27", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/a447bf556f3a0dab0494f653efbaf02ac1258a27", "committedDate": "2021-03-30T22:52:27Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "470933d105f65fec6a0f3a4ef2274ea7fcd74e53", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/470933d105f65fec6a0f3a4ef2274ea7fcd74e53", "committedDate": "2021-04-01T20:58:09Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "733e4e1946f211306ed1c5eba8bcf1a2ce048aa7", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/733e4e1946f211306ed1c5eba8bcf1a2ce048aa7", "committedDate": "2021-04-06T21:48:32Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "470933d105f65fec6a0f3a4ef2274ea7fcd74e53", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/470933d105f65fec6a0f3a4ef2274ea7fcd74e53", "committedDate": "2021-04-01T20:58:09Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "733e4e1946f211306ed1c5eba8bcf1a2ce048aa7", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/733e4e1946f211306ed1c5eba8bcf1a2ce048aa7", "committedDate": "2021-04-06T21:48:32Z", "message": "Link .settings directory to 'invisible project'\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjMwNzQ0Mzk5", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1579#pullrequestreview-630744399", "createdAt": "2021-04-07T22:49:14Z", "commit": {"oid": "733e4e1946f211306ed1c5eba8bcf1a2ce048aa7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QyMjo0OToxNFrOJE5rsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wN1QyMzowNDoxNFrOJE6LLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTExOTE1Mg==", "bodyText": "Do you have an example where this is needed ? The closest I could find in a properties file was instance/org.eclipse.core.net/org.eclipse.core.net.hasMigrated=true .", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1579#discussion_r609119152", "createdAt": "2021-04-07T22:49:14Z", "author": {"login": "rgrunber"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/StandardProjectsManager.java", "diffHunk": "@@ -257,6 +293,57 @@ public void fileChanged(String uriString, CHANGE_TYPE changeType) {\n \t\t}\n \t}\n \n+\tpublic static void configureSettings(Preferences preferences) {\n+\t\tURI settingsUri = preferences.getSettingsAsURI();\n+\t\tProperties properties = null;\n+\t\tif (settingsUri != null) {\n+\t\t\ttry (InputStream inputStream = settingsUri.toURL().openStream()) {\n+\t\t\t\tproperties = new Properties();\n+\t\t\t\tproperties.load(inputStream);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tJavaLanguageServerPlugin.logException(e.getMessage(), e);\n+\t\t\t\treturn;\n+\t\t\t}\n+\t\t}\n+\t\tinitializeDefaultOptions(preferences);\n+\t\tHashtable<String, String> javaOptions = JavaCore.getOptions();\n+\t\tif (properties != null && !properties.isEmpty()) {\n+\t\t\tproperties.forEach((k, v) -> {\n+\t\t\t\tif (k instanceof String && v instanceof String) {\n+\t\t\t\t\tk = ((String) k).replace(\"/instance/\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "733e4e1946f211306ed1c5eba8bcf1a2ce048aa7"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTEyNzIxMw==", "bodyText": "Just curious if you know why we also set them in https://github.com/eclipse/eclipse.jdt.ls/blob/master/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/JavaLanguageServerPlugin.java#L254", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1579#discussion_r609127213", "createdAt": "2021-04-07T23:04:14Z", "author": {"login": "rgrunber"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/preferences/PreferenceManager.java", "diffHunk": "@@ -88,6 +89,7 @@ public static void initialize() {\n \t\tdefEclipsePrefs.put(\"org.eclipse.jdt.ui.typefilter.enabled\", \"\");\n \t\tdefEclipsePrefs.put(CodeStyleConfiguration.ORGIMPORTS_IMPORTORDER, String.join(\";\", Preferences.JAVA_IMPORT_ORDER_DEFAULT));\n \t\tdefEclipsePrefs.put(MembersOrderPreferenceCacheCommon.APPEARANCE_MEMBER_SORT_ORDER, \"T,SF,SI,SM,F,I,C,M\"); //$NON-NLS-1$\n+\t\tdefEclipsePrefs.put(CodeGenerationSettingsConstants.CODEGEN_USE_OVERRIDE_ANNOTATION, Boolean.TRUE.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "733e4e1946f211306ed1c5eba8bcf1a2ce048aa7"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjMxODgxMzAw", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1579#pullrequestreview-631881300", "createdAt": "2021-04-08T22:13:54Z", "commit": {"oid": "733e4e1946f211306ed1c5eba8bcf1a2ce048aa7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1026, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}