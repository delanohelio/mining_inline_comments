{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzODE0ODE5", "number": 1479, "title": "Performance issue on large project", "bodyText": "Fixes #1469\nSigned-off-by: Snjezana Peco snjezana.peco@redhat.com", "createdAt": "2020-06-12T17:57:35Z", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479", "merged": true, "mergeCommit": {"oid": "9519b764acfc8390311433ed48ff5afaae276a08"}, "closed": true, "closedAt": "2020-06-16T17:41:11Z", "author": {"login": "snjeza"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrRkRlABqjM0NDE5ODgxNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr4Wh1gBqjM0NTAwMDc5Njc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3add6f45b991bcf1e207a983f7f6953c26d4ca5c", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/3add6f45b991bcf1e207a983f7f6953c26d4ca5c", "committedDate": "2020-06-12T17:55:00Z", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "2da94de8b20a5404c9aae2e871307958e37667db", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/2da94de8b20a5404c9aae2e871307958e37667db", "committedDate": "2020-06-14T19:52:22Z", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjc1MzQz", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#pullrequestreview-431675343", "createdAt": "2020-06-16T16:17:05Z", "commit": {"oid": "2da94de8b20a5404c9aae2e871307958e37667db"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjoxNzowNlrOGkjFrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjoxNzoxN1rOGkjGLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3NjgxMg==", "bodyText": "delete unused code directly", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440976812", "createdAt": "2020-06-16T16:17:06Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/BaseDocumentLifeCycleHandler.java", "diffHunk": "@@ -105,7 +109,7 @@ public boolean belongsTo(Object family) {\n \t\t\t\t\treturn PUBLISH_DIAGNOSTICS_JOBS.equals(family);\n \t\t\t\t}\n \t\t\t};\n-\t\t\tthis.validationTimer.setRule(ResourcesPlugin.getWorkspace().getRoot());\n+\t\t\t// this.validationTimer.setRule(ResourcesPlugin.getWorkspace().getRoot());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2da94de8b20a5404c9aae2e871307958e37667db"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3Njg3NA==", "bodyText": "delete unused code directly", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440976874", "createdAt": "2020-06-16T16:17:12Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/BaseDocumentLifeCycleHandler.java", "diffHunk": "@@ -90,7 +94,7 @@ public boolean belongsTo(Object family) {\n \t\t\t\t\treturn DOCUMENT_LIFE_CYCLE_JOBS.equals(family);\n \t\t\t\t}\n \t\t\t};\n-\t\t\tthis.validationTimer.setRule(ResourcesPlugin.getWorkspace().getRoot());\n+\t\t\t// this.validationTimer.setRule(ResourcesPlugin.getWorkspace().getRoot());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2da94de8b20a5404c9aae2e871307958e37667db"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3Njk0MQ==", "bodyText": "cancelled", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440976941", "createdAt": "2020-06-16T16:17:17Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/HoverInfoProvider.java", "diffHunk": "@@ -140,6 +150,15 @@ public HoverInfoProvider(ITypeRoot aUnit, PreferenceManager preferenceManager) {\n \t\t} catch (Exception e) {\n \t\t\tJavaLanguageServerPlugin.logException(\"Error computing hover\", e);\n \t\t}\n+\t\tif (monitor.isCanceled()) {\n+\t\t\treturn canceled(res);\n+\t\t}\n+\t\treturn res;\n+\t}\n+\n+\tprivate List<Either<String, MarkedString>> canceled(List<Either<String, MarkedString>> res) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2da94de8b20a5404c9aae2e871307958e37667db"}, "originalPosition": 54}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2da94de8b20a5404c9aae2e871307958e37667db", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/2da94de8b20a5404c9aae2e871307958e37667db", "committedDate": "2020-06-14T19:52:22Z", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "b2cf718558a7948b29db1b8898225b27306681a0", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/b2cf718558a7948b29db1b8898225b27306681a0", "committedDate": "2020-06-16T16:28:28Z", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzA0NzM2", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#pullrequestreview-431704736", "createdAt": "2020-06-16T16:50:24Z", "commit": {"oid": "b2cf718558a7948b29db1b8898225b27306681a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo1MDoyNFrOGkkbQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo1MDoyNFrOGkkbQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5ODcyMQ==", "bodyText": "new ArrayList<>(toReconcile.size())", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440998721", "createdAt": "2020-06-16T16:50:24Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/BaseDocumentLifeCycleHandler.java", "diffHunk": "@@ -129,30 +131,53 @@ protected void triggerValidation(ICompilationUnit cu, long delay) throws JavaMod\n \t\t}\n \t\tif (validationTimer != null) {\n \t\t\tvalidationTimer.cancel();\n+\t\t\tISchedulingRule rule = getRule(toReconcile);\n \t\t\tif (publishDiagnosticsJob != null) {\n \t\t\t\tpublishDiagnosticsJob.cancel();\n+\t\t\t\tpublishDiagnosticsJob.setRule(rule);\n \t\t\t}\n+\t\t\tvalidationTimer.setRule(rule);\n \t\t\tvalidationTimer.schedule(delay);\n \t\t} else {\n \t\t\tperformValidation(new NullProgressMonitor());\n \t\t}\n \t}\n \n+\tprivate ISchedulingRule getRule(Set<ICompilationUnit> units) {\n+\t\tISchedulingRule result = null;\n+\t\tIResourceRuleFactory ruleFactory = ResourcesPlugin.getWorkspace().getRuleFactory();\n+\t\tfor (ICompilationUnit unit : units) {\n+\t\t\tif (unit.getResource() != null) {\n+\t\t\t\tISchedulingRule rule = ruleFactory.createRule(unit.getResource());\n+\t\t\t\tresult = MultiRule.combine(rule, result);\n+\t\t\t}\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n \tprivate IStatus performValidation(IProgressMonitor monitor) throws JavaModelException {\n \t\tlong start = System.currentTimeMillis();\n \n-\t\tList<ICompilationUnit> cusToReconcile = new ArrayList<>();\n+\t\tList<ICompilationUnit> cusToReconcile;\n \t\tsynchronized (toReconcile) {\n+\t\t\tif (toReconcile.isEmpty()) {\n+\t\t\t\treturn Status.OK_STATUS;\n+\t\t\t}\n+\t\t\tcusToReconcile = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2cf718558a7948b29db1b8898225b27306681a0"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62cf45ac246ad3d55158c68c9213e98ab3785a00", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/62cf45ac246ad3d55158c68c9213e98ab3785a00", "committedDate": "2020-06-16T17:03:41Z", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2cf718558a7948b29db1b8898225b27306681a0", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/b2cf718558a7948b29db1b8898225b27306681a0", "committedDate": "2020-06-16T16:28:28Z", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}, "afterCommit": {"oid": "62cf45ac246ad3d55158c68c9213e98ab3785a00", "author": {"user": {"login": "snjeza", "name": "Snjeza"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/62cf45ac246ad3d55158c68c9213e98ab3785a00", "committedDate": "2020-06-16T17:03:41Z", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1152, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}