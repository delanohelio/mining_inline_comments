{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1NjQ0NTYw", "number": 1575, "title": "Hide inline constant commands when no reference found", "bodyText": "hide meaningless refactor commands when a constant has no reference. The following gifs show the effect of this PR.\nBefore:\n\nAfter:", "createdAt": "2020-10-19T03:02:35Z", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1575", "merged": true, "mergeCommit": {"oid": "29a74ad0c934b0e5eed337b13144c820d2175bae"}, "closed": true, "closedAt": "2020-10-19T08:48:28Z", "author": {"login": "CsCherrYY"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdT6jOfAH2gAyNTA1NjQ0NTYwOjk3MWRjYzVhMTgwNGI5N2VkY2MyODA4ZjI2NGE1Njk5M2QxZGY3NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUAX0MAFqTUxMTU1MjQ1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "971dcc5a1804b97edcc2808f264a56993d1df757", "author": {"user": {"login": "CsCherrYY", "name": "Shi Chen"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/971dcc5a1804b97edcc2808f264a56993d1df757", "committedDate": "2020-10-19T02:14:46Z", "message": "Hide inline constant commands when no reference found\n\nSigned-off-by: schenqce <chenshi@microsoft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e958eb3eac8eab3bf37af362bdb41b59f923934", "author": {"user": {"login": "CsCherrYY", "name": "Shi Chen"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/1e958eb3eac8eab3bf37af362bdb41b59f923934", "committedDate": "2020-10-19T02:53:50Z", "message": "Update condition\n\nSigned-off-by: schenqce <chenshi@microsoft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNTUyNDU4", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1575#pullrequestreview-511552458", "createdAt": "2020-10-19T09:01:44Z", "commit": {"oid": "1e958eb3eac8eab3bf37af362bdb41b59f923934"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTowMTo0NFrOHkEmUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTowMTo0NFrOHkEmUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4NjEzMA==", "bodyText": "@CsCherrYY Below is a corner case. The change group will be 2 (1 for remove imports, 1 for remove the declaration) even though no references are using the constant field. The \"Inline\" menu won't be hidden.\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class Hello {\n    public static final Map map = new HashMap<>();\n}", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1575#discussion_r507586130", "createdAt": "2020-10-19T09:01:44Z", "author": {"login": "testforstephen"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/corrections/RefactorProcessor.java", "diffHunk": "@@ -327,6 +330,15 @@ private boolean getInlineProposal(IInvocationContext context, ASTNode node, Coll\n \t\t\t\t\t\t\tCheckConditionsOperation check = new CheckConditionsOperation(refactoring, CheckConditionsOperation.FINAL_CONDITIONS);\n \t\t\t\t\t\t\tfinal CreateChangeOperation create = new CreateChangeOperation(check, RefactoringStatus.FATAL);\n \t\t\t\t\t\t\tcreate.run(new NullProgressMonitor());\n+\t\t\t\t\t\t\tint referenceCount = 0;\n+\t\t\t\t\t\t\tChange change = create.getChange();\n+\t\t\t\t\t\t\tChange[] refactoringChanges = ((DynamicValidationRefactoringChange)change).getChildren();\n+\t\t\t\t\t\t\tfor (Change refactoringChange : refactoringChanges) {\n+\t\t\t\t\t\t\t\treferenceCount += ((CompilationUnitChange)refactoringChange).getChangeGroups().length;\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\tif (referenceCount <= 1 && refactoring.isDeclarationSelected()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e958eb3eac8eab3bf37af362bdb41b59f923934"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1020, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}