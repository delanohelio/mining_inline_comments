{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MTg4Njc5", "number": 1395, "title": "Add record snippet", "bodyText": "Fixes #1393", "createdAt": "2020-03-26T14:00:43Z", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1395", "merged": true, "mergeCommit": {"oid": "1d3583d0362285571e3b1a8e885260f9e6049ad9"}, "closed": true, "closedAt": "2020-03-30T14:14:36Z", "author": {"login": "fbricon"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRcq-ygBqjMxNjg0MTE2NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSvCJSAFqTM4Mzg4NzcwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65f9e69eeb8ac0fea6d9d7d26f19903bf4468ca4", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/65f9e69eeb8ac0fea6d9d7d26f19903bf4468ca4", "committedDate": "2020-03-26T13:59:36Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}, "afterCommit": {"oid": "e1fc9d16b3b54572278e827e42df481a2c04707f", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/e1fc9d16b3b54572278e827e42df481a2c04707f", "committedDate": "2020-03-26T14:06:51Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1fc9d16b3b54572278e827e42df481a2c04707f", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/e1fc9d16b3b54572278e827e42df481a2c04707f", "committedDate": "2020-03-26T14:06:51Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}, "afterCommit": {"oid": "a3a2e4e252199e757d76e759818e63bb7c286278", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/a3a2e4e252199e757d76e759818e63bb7c286278", "committedDate": "2020-03-26T14:19:43Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMDU4MTY3", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1395#pullrequestreview-382058167", "createdAt": "2020-03-26T14:22:56Z", "commit": {"oid": "a3a2e4e252199e757d76e759818e63bb7c286278"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNDoyMjo1NlrOF8JVCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNDoyMjo1NlrOF8JVCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxMTcyMg==", "bodyText": "@snjeza for some reason the tests with inner records fail, do you mind taking a look at them?", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1395#discussion_r398611722", "createdAt": "2020-03-26T14:22:56Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -1343,6 +1344,108 @@ public void testSnippet_nested_inner_class() throws JavaModelException {\n \t\tassertEquals(\"/**\\n * ${1:InnerTest_1}\\n */\\npublic class ${1:InnerTest_1} {\\n\\n\\t${0}\\n}\", te);\n \t}\n \n+\t@Test\n+\tpublic void testSnippet_record() throws JavaModelException {\n+\t\tICompilationUnit unit = getWorkingCopy(\"src/org/sample/Test.java\", \"\");\n+\t\tint[] loc = findCompletionLocation(unit, \"\");\n+\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\n+\t\tassertNotNull(list);\n+\t\tList<CompletionItem> items = new ArrayList<>(list.getItems());\n+\t\tassertFalse(items.isEmpty());\n+\t\titems.sort((i1, i2) -> (i1.getSortText().compareTo(i2.getSortText())));\n+\n+\t\tCompletionItem item = items.get(10);\n+\t\tassertEquals(\"record\", item.getLabel());\n+\t\tString te = item.getInsertText();\n+\t\tassertEquals(\"package org.sample;\\n\\n/**\\n * Test\\n */\\npublic record Test(${0}) {\\n}\", te);\n+\n+\t\t//check resolution doesn't blow up (https://github.com/eclipse/eclipse.jdt.ls/issues/675)\n+\t\tassertSame(item, server.resolveCompletionItem(item).join());\n+\t}\n+\n+\t@Test\n+\tpublic void testSnippet_record_with_package() throws JavaModelException {\n+\t\tICompilationUnit unit = getWorkingCopy(\"src/org/sample/Test.java\", \"package org.sample;\\n\");\n+\t\tint[] loc = findCompletionLocation(unit, \"package org.sample;\\n\");\n+\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\n+\t\tassertNotNull(list);\n+\t\tList<CompletionItem> items = new ArrayList<>(list.getItems());\n+\t\tassertFalse(items.isEmpty());\n+\t\titems.sort((i1, i2) -> (i1.getSortText().compareTo(i2.getSortText())));\n+\n+\t\tCompletionItem item = items.get(9);\n+\t\tassertEquals(\"record\", item.getLabel());\n+\t\tString te = item.getInsertText();\n+\t\tassertEquals(\"/**\\n * Test\\n */\\npublic record Test(${0}) {\\n}\", te);\n+\t}\n+\n+\t@Ignore(value = \"When running tests, in SnippetCompletionProposal.getSnippetContent(), cu.getAllTypes() returns en empty array, so inner record name is not computed\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3a2e4e252199e757d76e759818e63bb7c286278"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3a2e4e252199e757d76e759818e63bb7c286278", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/a3a2e4e252199e757d76e759818e63bb7c286278", "committedDate": "2020-03-26T14:19:43Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}, "afterCommit": {"oid": "fc36bb8e11ffd065c2fe0a599196249d1520fe76", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/fc36bb8e11ffd065c2fe0a599196249d1520fe76", "committedDate": "2020-03-29T14:28:58Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNDE3NzM5", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1395#pullrequestreview-383417739", "createdAt": "2020-03-29T14:31:17Z", "commit": {"oid": "fc36bb8e11ffd065c2fe0a599196249d1520fe76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQxNDozMToxN1rOF9SNlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQxNDozMToxN1rOF9SNlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgwNTg0NA==", "bodyText": "@snjeza lemme know if there's a better way to do this", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1395#discussion_r399805844", "createdAt": "2020-03-29T14:31:17Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/contentassist/SnippetCompletionProposal.java", "diffHunk": "@@ -311,6 +367,39 @@ private static CompletionItem getInterfaceSnippet(ICompilationUnit cu, Completio\n \t\treturn interfaceSnippetItem;\n \t}\n \n+\tprivate static CompletionItem getRecordSnippet(SnippetCompletionContext scc, IProgressMonitor monitor) {\n+\t\tICompilationUnit cu = scc.getCompilationUnit();\n+\t\tIJavaProject javaProject = cu.getJavaProject();\n+\t\tif (javaProject == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tAST ast = AST.newAST(javaProject.getOptions(true));\n+\t\tif (ast.apiLevel() < AST.JLS14) {//TODO is there a better way to check JDK version?\n+\t\t\t//not checking if preview features are enabled, as Java 14+ might support records without preview flag\n+\t\t\treturn null;\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc36bb8e11ffd065c2fe0a599196249d1520fe76"}, "originalPosition": 357}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc36bb8e11ffd065c2fe0a599196249d1520fe76", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/fc36bb8e11ffd065c2fe0a599196249d1520fe76", "committedDate": "2020-03-29T14:28:58Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}, "afterCommit": {"oid": "efc8bc09c4529a07264a065266ed061a3a15878c", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/efc8bc09c4529a07264a065266ed061a3a15878c", "committedDate": "2020-03-29T17:47:26Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "efc8bc09c4529a07264a065266ed061a3a15878c", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/efc8bc09c4529a07264a065266ed061a3a15878c", "committedDate": "2020-03-29T17:47:26Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}, "afterCommit": {"oid": "1bef7deeacb28ef3e9aaaa66c19fe98fc05aaf77", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/1bef7deeacb28ef3e9aaaa66c19fe98fc05aaf77", "committedDate": "2020-03-29T17:49:36Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNDM3MjQw", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1395#pullrequestreview-383437240", "createdAt": "2020-03-29T17:52:03Z", "commit": {"oid": "1bef7deeacb28ef3e9aaaa66c19fe98fc05aaf77"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQxNzo1MjowM1rOF9TvIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQxNzo1MjowM1rOF9TvIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgzMDgxOQ==", "bodyText": "at least the version comparison is more consistent with the rest of the codebase", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1395#discussion_r399830819", "createdAt": "2020-03-29T17:52:03Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/contentassist/SnippetCompletionProposal.java", "diffHunk": "@@ -311,6 +367,39 @@ private static CompletionItem getInterfaceSnippet(ICompilationUnit cu, Completio\n \t\treturn interfaceSnippetItem;\n \t}\n \n+\tprivate static CompletionItem getRecordSnippet(SnippetCompletionContext scc, IProgressMonitor monitor) {\n+\t\tICompilationUnit cu = scc.getCompilationUnit();\n+\t\tIJavaProject javaProject = cu.getJavaProject();\n+\t\tif (javaProject == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tString version = javaProject.getOption(JavaCore.COMPILER_COMPLIANCE, true);\n+\t\tif (JavaModelUtil.isVersionLessThan(version, JavaCore.VERSION_14)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bef7deeacb28ef3e9aaaa66c19fe98fc05aaf77"}, "originalPosition": 355}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bef7deeacb28ef3e9aaaa66c19fe98fc05aaf77", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/1bef7deeacb28ef3e9aaaa66c19fe98fc05aaf77", "committedDate": "2020-03-29T17:49:36Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}, "afterCommit": {"oid": "1beae12fa77cce9497c5db5bc1319ae655bcd30f", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/1beae12fa77cce9497c5db5bc1319ae655bcd30f", "committedDate": "2020-03-30T09:19:18Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1415524ba90c4e13ffa0e86f1c8434a3fff4e834", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/1415524ba90c4e13ffa0e86f1c8434a3fff4e834", "committedDate": "2020-03-30T09:50:40Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1beae12fa77cce9497c5db5bc1319ae655bcd30f", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/1beae12fa77cce9497c5db5bc1319ae655bcd30f", "committedDate": "2020-03-30T09:19:18Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}, "afterCommit": {"oid": "1415524ba90c4e13ffa0e86f1c8434a3fff4e834", "author": {"user": {"login": "fbricon", "name": "Fred Bricon"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/1415524ba90c4e13ffa0e86f1c8434a3fff4e834", "committedDate": "2020-03-30T09:50:40Z", "message": "Add record snippet\n\nSigned-off-by: Fred Bricon <fbricon@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzODg3NzAy", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1395#pullrequestreview-383887702", "createdAt": "2020-03-30T14:04:36Z", "commit": {"oid": "1415524ba90c4e13ffa0e86f1c8434a3fff4e834"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1085, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}