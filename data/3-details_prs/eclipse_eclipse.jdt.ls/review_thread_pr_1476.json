{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyODcxMjg2", "number": 1476, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjo0ODozOVrOEEj7tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMToxMzozOVrOEFfkBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjE4NDg3OnYy", "diffSide": "RIGHT", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommand.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjo0ODozOVrOGiQkzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNzozMzozN1rOGinm4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3NjMzNQ==", "bodyText": "That's too broad. You'll wait for unrelated jobs to finish", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1476#discussion_r438576335", "createdAt": "2020-06-11T06:48:39Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommand.java", "diffHunk": "@@ -108,8 +110,10 @@\n \t *         modulepaths.\n \t * @throws CoreException\n \t * @throws URISyntaxException\n+\t * @throws InterruptedException\n \t */\n-\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException {\n+\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException, InterruptedException {\n+\t\tJobHelpers.waitForJobsToComplete(new NullProgressMonitor());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf97d944bcae579999694e5d0f7c155a29e3e3a9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYwOTk2OA==", "bodyText": "Can I narrow to:\nJobHelpers.waitForJobs(IConstants.UPDATE_PROJECT_FAMILY, new NullProgressMonitor());\nJobHelpers.waitForBuildJobs(10 * 1000);\nAlso wait for build jobs since update request will also trigger a clean build in MavenBuilder. But return the result no matter build finishes or not after 10 secs.", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1476#discussion_r438609968", "createdAt": "2020-06-11T07:59:17Z", "author": {"login": "jdneo"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommand.java", "diffHunk": "@@ -108,8 +110,10 @@\n \t *         modulepaths.\n \t * @throws CoreException\n \t * @throws URISyntaxException\n+\t * @throws InterruptedException\n \t */\n-\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException {\n+\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException, InterruptedException {\n+\t\tJobHelpers.waitForJobsToComplete(new NullProgressMonitor());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3NjMzNQ=="}, "originalCommit": {"oid": "bf97d944bcae579999694e5d0f7c155a29e3e3a9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYyMDQ0Mg==", "bodyText": "I don't think you need to wait for build jobs. During a build all the classpaths are supposed to have been set already, so building projects won't change anything to that", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1476#discussion_r438620442", "createdAt": "2020-06-11T08:19:29Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommand.java", "diffHunk": "@@ -108,8 +110,10 @@\n \t *         modulepaths.\n \t * @throws CoreException\n \t * @throws URISyntaxException\n+\t * @throws InterruptedException\n \t */\n-\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException {\n+\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException, InterruptedException {\n+\t\tJobHelpers.waitForJobsToComplete(new NullProgressMonitor());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3NjMzNQ=="}, "originalCommit": {"oid": "bf97d944bcae579999694e5d0f7c155a29e3e3a9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY4MDI2MQ==", "bodyText": "Yes you are right. I found out that the case will fail after the invocation of JavaCore.setClasspathContainer(), which will trigger SetContainerOperation\nI'm deciding to add following code:\nIWorkspace workspace = ResourcesPlugin.getWorkspace();\nworkspace.run(new IWorkspaceRunnable() {\n    @Override\n        public void run(IProgressMonitor monitor) {\n    }\n}, workspace.getRoot(), 0, new NullProgressMonitor());\nto wait for it. (JavaModeChangeOperation will lock the workspace tree). Does this make sense?", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1476#discussion_r438680261", "createdAt": "2020-06-11T10:07:38Z", "author": {"login": "jdneo"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommand.java", "diffHunk": "@@ -108,8 +110,10 @@\n \t *         modulepaths.\n \t * @throws CoreException\n \t * @throws URISyntaxException\n+\t * @throws InterruptedException\n \t */\n-\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException {\n+\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException, InterruptedException {\n+\t\tJobHelpers.waitForJobsToComplete(new NullProgressMonitor());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3NjMzNQ=="}, "originalCommit": {"oid": "bf97d944bcae579999694e5d0f7c155a29e3e3a9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY4MTc0Mw==", "bodyText": "@snjeza your opinion on that?", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1476#discussion_r438681743", "createdAt": "2020-06-11T10:10:35Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommand.java", "diffHunk": "@@ -108,8 +110,10 @@\n \t *         modulepaths.\n \t * @throws CoreException\n \t * @throws URISyntaxException\n+\t * @throws InterruptedException\n \t */\n-\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException {\n+\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException, InterruptedException {\n+\t\tJobHelpers.waitForJobsToComplete(new NullProgressMonitor());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3NjMzNQ=="}, "originalCommit": {"oid": "bf97d944bcae579999694e5d0f7c155a29e3e3a9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcyOTc2OQ==", "bodyText": "Just add more background here: The cases might fail with a very high possibility after BuildPathManager#mavenProjectChanged(), where the SetContainerOperation will be triggered.", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1476#discussion_r438729769", "createdAt": "2020-06-11T11:55:07Z", "author": {"login": "jdneo"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommand.java", "diffHunk": "@@ -108,8 +110,10 @@\n \t *         modulepaths.\n \t * @throws CoreException\n \t * @throws URISyntaxException\n+\t * @throws InterruptedException\n \t */\n-\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException {\n+\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException, InterruptedException {\n+\t\tJobHelpers.waitForJobsToComplete(new NullProgressMonitor());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3NjMzNQ=="}, "originalCommit": {"oid": "bf97d944bcae579999694e5d0f7c155a29e3e3a9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk1MzY5Ng==", "bodyText": "you can try\nIWorkspace workspace = ResourcesPlugin.getWorkspace();\nworkspace.run(new IWorkspaceRunnable() {\n    @Override\n        public void run(IProgressMonitor monitor) {\n    }\n}, workspace.getRoot(), IWorkspace.AVOID_UPDATE, new NullProgressMonitor());", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1476#discussion_r438953696", "createdAt": "2020-06-11T17:33:37Z", "author": {"login": "snjeza"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommand.java", "diffHunk": "@@ -108,8 +110,10 @@\n \t *         modulepaths.\n \t * @throws CoreException\n \t * @throws URISyntaxException\n+\t * @throws InterruptedException\n \t */\n-\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException {\n+\tpublic static ClasspathResult getClasspaths(String uri, ClasspathOptions options) throws CoreException, URISyntaxException, InterruptedException {\n+\t\tJobHelpers.waitForJobsToComplete(new NullProgressMonitor());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3NjMzNQ=="}, "originalCommit": {"oid": "bf97d944bcae579999694e5d0f7c155a29e3e3a9"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MTk1NDYzOnYy", "diffSide": "RIGHT", "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommandTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMToxMzozOVrOGjtucA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMToxMzozOVrOGjtucA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEwMjUxMg==", "bodyText": "move out of loop", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1476#discussion_r440102512", "createdAt": "2020-06-15T11:13:39Z", "author": {"login": "fbricon"}, "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/commands/ProjectCommandTest.java", "diffHunk": "@@ -116,6 +116,27 @@ public void testGetClasspathsForMaven() throws Exception {\n         assertTrue(containsJunit);\n     }\n \n+    @Test\n+    public void testGetClasspathsForMavenWhenUpdating() throws Exception {\n+        importProjects(\"maven/classpathtest\");\n+        IProject project = WorkspaceHelper.getProject(\"classpathtest\");\n+        String uriString = project.getFile(\"src/main/java/main/App.java\").getLocationURI().toString();\n+        ClasspathOptions options = new ClasspathOptions();\n+\n+        projectsManager.updateProject(project, true);\n+\n+        for (int i = 0; i < 10; i++) {\n+            options.scope = \"test\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "901d0af112c4e3ce748886ca5dcbf979f5bc6d3c"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3578, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}