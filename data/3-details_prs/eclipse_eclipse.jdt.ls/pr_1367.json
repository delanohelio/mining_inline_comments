{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwMjIzNjg5", "number": 1367, "title": "match filterText with textEdit", "bodyText": "This PR is an option to fix issue #1348 .", "createdAt": "2020-02-26T12:42:10Z", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1367", "merged": true, "mergeCommit": {"oid": "59b223a9018e70374ca83079ab64f773adc91df2"}, "closed": true, "closedAt": "2020-02-28T10:22:50Z", "author": {"login": "Eskibear"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIGCjrAH2gAyMzgwMjIzNjg5Ojk3NWFhY2RlMjFmMTI2NWJlMTg5NGQ3YmQxZWRmM2Y4NzM1ZDQxNTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIdplugFqTM2NTc4OTY2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "975aacde21f1265be1894d7bd1edf3f8735d4154", "author": {"user": {"login": "Eskibear", "name": "Yan Zhang"}}, "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/975aacde21f1265be1894d7bd1edf3f8735d4154", "committedDate": "2020-02-26T12:39:42Z", "message": "match filterText with textEdit\n\nSigned-off-by: Yan Zhang <yanzh@microsoft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0ODcwOTY2", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1367#pullrequestreview-364870966", "createdAt": "2020-02-26T12:51:15Z", "commit": {"oid": "975aacde21f1265be1894d7bd1edf3f8735d4154"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxMjo1MToxNlrOFuqRag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxMjo1MToxNlrOFuqRag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ3MTQwMg==", "bodyText": "This case was to ensure that label is of the format \"SimpleName - PackageName\", nothing to do with filterText. Now since InsertText is set to the SimpleName as a fallback, I'm simply using it instead.\nIn the below line, I add a case to ensure filterText starts with the prefix, which is calculated from textEdit.range", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1367#discussion_r384471402", "createdAt": "2020-02-26T12:51:16Z", "author": {"login": "Eskibear"}, "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -237,7 +237,8 @@ public void testCompletion_object() throws Exception{\n \t\t\tassertTrue(isNotBlank(item.getInsertText()));\n \t\t\tassertNotNull(item.getFilterText());\n \t\t\tassertFalse(item.getFilterText().contains(\" \"));\n-\t\t\tassertTrue(item.getLabel().startsWith(item.getFilterText()));\n+\t\t\tassertTrue(item.getLabel().startsWith(item.getInsertText()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "975aacde21f1265be1894d7bd1edf3f8735d4154"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1Nzg5NjYy", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1367#pullrequestreview-365789662", "createdAt": "2020-02-27T16:10:08Z", "commit": {"oid": "975aacde21f1265be1894d7bd1edf3f8735d4154"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjoxMDowOVrOFvXU8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjoxMDowOVrOFvXU8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIwOTU4Nw==", "bodyText": "Here to minimize the risk and avoid unexpected behaviors, I only apply it to TYPE_REF kind. In fact, if I remove proposal.getKind() == CompletionProposal.TYPE_REF condition, and update the filterText for all items, current test cases are also passed.", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1367#discussion_r385209587", "createdAt": "2020-02-27T16:10:09Z", "author": {"login": "Eskibear"}, "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/contentassist/CompletionProposalRequestor.java", "diffHunk": "@@ -266,6 +266,11 @@ public CompletionItem toCompletionItem(CompletionProposal proposal, int index) {\n \t\t\t}\n \t\t}\n \t\tproposalProvider.updateReplacement(proposal, $, '\\0');\n+\t\t// Make sure `filterText` matches `textEdit`\n+\t\t// See https://github.com/eclipse/eclipse.jdt.ls/issues/1348\n+\t\tif (proposal.getKind() == CompletionProposal.TYPE_REF && $.getTextEdit() != null && $.getTextEdit().getRange() != null && $.getTextEdit().getNewText() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "975aacde21f1265be1894d7bd1edf3f8735d4154"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1077, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}