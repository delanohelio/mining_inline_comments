{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxODI4Nzc4", "number": 1603, "title": "Use TypeParser in ProfileCallbackImpl#sendUpdate for StringType state", "bodyText": "Adding a call to the TypeParser in ProfileCallbackImpl#sendUpdate if the provided state is a StringType (which is what transform profiles return) and the linked item is not a StringItem. This should enable transform profiles to be used with other item types.\nFixes #1565\nSigned-off-by: Anders Alfredsson andersb86@gmail.com", "createdAt": "2020-08-21T19:54:12Z", "url": "https://github.com/openhab/openhab-core/pull/1603", "merged": true, "mergeCommit": {"oid": "184366a1a5bc80ce0852096491bef8b03367158f"}, "closed": true, "closedAt": "2020-08-24T21:49:20Z", "author": {"login": "pacive"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBJhXcgH2gAyNDcxODI4Nzc4OjAzYzdmNjZkMjE5OTdhYmZhOGYzZWUzOWQ2Y2U5NmNhMjA4MTQwMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCJyPFAFqTQ3Mzg4MDg4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "03c7f66d21997abfa8f3ee39d6ce96ca20814027", "author": {"user": {"login": "pacive", "name": "Anders Alfredsson"}}, "url": "https://github.com/openhab/openhab-core/commit/03c7f66d21997abfa8f3ee39d6ce96ca20814027", "committedDate": "2020-08-21T18:56:45Z", "message": "Use TypeParser in ProfileCallbackImpl#sendUpdate for StringType state\n\nSigned-off-by: Anders Alfredsson <andersb86@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTYyNzc1", "url": "https://github.com/openhab/openhab-core/pull/1603#pullrequestreview-472962775", "createdAt": "2020-08-22T21:23:23Z", "commit": {"oid": "03c7f66d21997abfa8f3ee39d6ce96ca20814027"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQyMToyMzoyM1rOHFIOIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQyMToyMzoyM1rOHFIOIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzOTYxNw==", "bodyText": "If the TypeParser fails, it returns null while the itemStateConverter keeps the state as is if it fails converting it.\nThe following code (the eventPublisher.post) expects a non-null value, so we need to make sure to set something here as well. To be in sync with the other case, it probably is best to also keep the original state (knowing that the sent command will not be valid for the resp. item).", "url": "https://github.com/openhab/openhab-core/pull/1603#discussion_r475139617", "createdAt": "2020-08-22T21:23:23Z", "author": {"login": "kaikreuzer"}, "path": "bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/profiles/ProfileCallbackImpl.java", "diffHunk": "@@ -131,7 +134,12 @@ public void sendCommand(Command command) {\n     @Override\n     public void sendUpdate(State state) {\n         Item item = itemProvider.apply(link.getItemName());\n-        State acceptedState = itemStateConverter.convertToAcceptedState(state, item);\n+        State acceptedState;\n+        if (state instanceof StringType && !(item instanceof StringItem)) {\n+            acceptedState = TypeParser.parseState(item.getAcceptedDataTypes(), state.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03c7f66d21997abfa8f3ee39d6ce96ca20814027"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9386d876f9e77400f13479fb94d368c4576a9dd8", "author": {"user": {"login": "pacive", "name": "Anders Alfredsson"}}, "url": "https://github.com/openhab/openhab-core/commit/9386d876f9e77400f13479fb94d368c4576a9dd8", "committedDate": "2020-08-23T07:03:44Z", "message": "Add null check\n\nSigned-off-by: Anders Alfredsson <andersb86@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczODgwODg4", "url": "https://github.com/openhab/openhab-core/pull/1603#pullrequestreview-473880888", "createdAt": "2020-08-24T21:49:06Z", "commit": {"oid": "9386d876f9e77400f13479fb94d368c4576a9dd8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4734, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}