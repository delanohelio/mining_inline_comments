{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMzc5MTcy", "number": 1496, "title": "Swagger: support injection of ReaderListener, add OAuth2 annotations", "bodyText": "This is another attempt at #1483 without any blatant (but inadvertent!) third-party code borrowing & relicensing this time.\nThis introduces the ability to customize the Swagger Definition in a way supported directly by swagger-jaxrs by providing ReaderListener implementations with DI. Two of them are implemented in this PR: one to add general information and the other to add the OAuth2 security definition (which will only be injected if the auth bundle is installed).\nAdditionally the enumeration of resources has been simplified for openHAB's purposes as they all implement RESTResource and there is only one Application, so they can be looked up and fed to the Swagger Reader easily.\nIt seems to work, with no change in functionality, therefore the dependency to  jaxrswb-swagger1-gen can be removed, in line with the current push to remove unneeded dependencies, as well as mitigating the risk of relying on third-party libraries when the functionality they offer can be easily replaced with first-party code (nothing personal against @maggu2810! And thanks for the valuable insight here).\nThere was also a problem with a conflict between Guava versions (as discussed here), solved by fixing the org.reflections:reflections dependency to version 0.9.12 (swagger-jaxrs depends on version 0.9.11) because this recent release removes the dependency to an outdated release of Guava. This seems to do the trick without side effects and apparently solves resolutions problems in both the demo app and Karaf. This allows in turn to remove the personal fork of this lib (de.maggu2810.thirdparty.modified.org.reflections/reflections/0.9.10.v20160429-1435), in favor of an official version.\nThe OAuth2 flow in Swagger UI depends on openhab/openhab-webui#257 to work correctly.\n\nSigned-off-by: Yannick Schaus github@schaus.net", "createdAt": "2020-05-24T08:03:51Z", "url": "https://github.com/openhab/openhab-core/pull/1496", "merged": true, "mergeCommit": {"oid": "aac4ca2f791ee718de432c0bc891c353d1b0dee1"}, "closed": true, "closedAt": "2020-07-24T20:30:07Z", "author": {"login": "ghys"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckYOuvAFqTQxNzM0MjQ4OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4KER7AFqTQ1NTE2NzI0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzQyNDg4", "url": "https://github.com/openhab/openhab-core/pull/1496#pullrequestreview-417342488", "createdAt": "2020-05-24T09:41:09Z", "commit": {"oid": "4b33ec06118a565258ca1c77ab191b48e11cffb2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwOTo0MToxMFrOGZtzUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwOTo0MToxMFrOGZtzUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYxODAwMw==", "bodyText": "Do you know if it also compiles with the older version? If that's the case it's better to use older versions here. That way a broader version range is generated by Bnd and the framework will be more compatible with older Swagger versions. That way you don't force framework users to upgrade dependencies or use multiple versions, i.e. it could result in similar issues as we often have with guava and the org.reflections artifact.", "url": "https://github.com/openhab/openhab-core/pull/1496#discussion_r429618003", "createdAt": "2020-05-24T09:41:10Z", "author": {"login": "wborn"}, "path": "bom/compile/pom.xml", "diffHunk": "@@ -238,13 +238,14 @@\n     <dependency>\n       <groupId>io.swagger</groupId>\n       <artifactId>swagger-annotations</artifactId>\n-      <version>1.5.5</version>\n+      <version>1.6.1</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b33ec06118a565258ca1c77ab191b48e11cffb2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzQ2ODc5", "url": "https://github.com/openhab/openhab-core/pull/1496#pullrequestreview-417346879", "createdAt": "2020-05-24T10:49:17Z", "commit": {"oid": "4b33ec06118a565258ca1c77ab191b48e11cffb2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxMDo0OToxOFrOGZuIgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxMDo0OToxOFrOGZuIgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYyMzQyNQ==", "bodyText": "I'm not too happy with openhab-core-io-rest-auth depending on openhab.tp-swagger-jaxrs after all, if there's a better suggestion (make it optional? bring the ReaderListener back to org.openhab.core.io.rest.swagger? ...) I'll gladly take it.", "url": "https://github.com/openhab/openhab-core/pull/1496#discussion_r429623425", "createdAt": "2020-05-24T10:49:18Z", "author": {"login": "ghys"}, "path": "features/karaf/openhab-core/src/main/feature/feature.xml", "diffHunk": "@@ -155,7 +155,9 @@\n \t\t<feature>openhab-core-auth-jaas</feature>\n \t\t<bundle>mvn:org.openhab.core.bundles/org.openhab.core.io.rest.auth/${project.version}</bundle>\n \t\t<requirement>openhab.tp;filter:=\"(feature=jose4j)\"</requirement>\n+\t\t<requirement>openhab.tp;filter:=\"(feature=swagger-jaxrs)\"</requirement>\n \t\t<feature dependency=\"true\">openhab.tp-jose4j</feature>\n+\t\t<feature dependency=\"true\">openhab.tp-swagger-jaxrs</feature>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b33ec06118a565258ca1c77ab191b48e11cffb2"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca44726fa622e1bb856f584541e275511aef99bb", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/ca44726fa622e1bb856f584541e275511aef99bb", "committedDate": "2020-07-24T17:32:35Z", "message": "Add Swagger ReaderListener support, OAuth2 definitions\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dec6f57ace2b814cc3e904572779fb8dcb9d5541", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/dec6f57ace2b814cc3e904572779fb8dcb9d5541", "committedDate": "2020-07-24T17:34:51Z", "message": "Add authorization information to admin operations\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5796428448d9ccddcff4a102941e551b2355209", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/f5796428448d9ccddcff4a102941e551b2355209", "committedDate": "2020-07-24T17:34:51Z", "message": "Fix imports, force reflections dependency to 0.9.12\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36fcce57368e99640c8e47e50c31fba9c758de9e", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/36fcce57368e99640c8e47e50c31fba9c758de9e", "committedDate": "2020-07-24T17:34:52Z", "message": "Add InfoSwaggerReaderListener, bump swagger libs to 1.6.1\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24bc8b473fa05d82050af8b14b947770d0dc4f21", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/24bc8b473fa05d82050af8b14b947770d0dc4f21", "committedDate": "2020-07-24T17:34:52Z", "message": "Fix spotless error in feature.xml\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e19aa08041cf76995fefc638110186f297e8016b", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/e19aa08041cf76995fefc638110186f297e8016b", "committedDate": "2020-07-24T17:34:52Z", "message": "Revert back to io.swagger 1.5.5 in compile BOM\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58f9cfa1eb08450fa5ba92529329d019abaac4ce", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/58f9cfa1eb08450fa5ba92529329d019abaac4ce", "committedDate": "2020-07-24T17:42:53Z", "message": "Add authorizations to AddonResource\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b030e770c735a04e2a35667f4fd3c8961b8cc81d", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/b030e770c735a04e2a35667f4fd3c8961b8cc81d", "committedDate": "2020-07-24T17:47:39Z", "message": "Move API version to RESTContants\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5846552ee7c5a2ed55d8f296cd444496d21067b0", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/5846552ee7c5a2ed55d8f296cd444496d21067b0", "committedDate": "2020-07-24T17:48:20Z", "message": "Add contact name, current API version to Swagger info\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04b53d262454bebef7ec6c01bd1fced313bfd3f8", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/04b53d262454bebef7ec6c01bd1fced313bfd3f8", "committedDate": "2020-07-24T17:49:38Z", "message": "Remove auth feature dependency to Swagger\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bedc8a87e7153114bfa22f3c85672e7d2f740c4d", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/bedc8a87e7153114bfa22f3c85672e7d2f740c4d", "committedDate": "2020-05-24T10:47:08Z", "message": "Revert back to io.swagger 1.5.5 in compile BOM\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}, "afterCommit": {"oid": "04b53d262454bebef7ec6c01bd1fced313bfd3f8", "author": {"user": {"login": "ghys", "name": "Yannick Schaus"}}, "url": "https://github.com/openhab/openhab-core/commit/04b53d262454bebef7ec6c01bd1fced313bfd3f8", "committedDate": "2020-07-24T17:49:38Z", "message": "Remove auth feature dependency to Swagger\n\nSigned-off-by: Yannick Schaus <github@schaus.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MTY3MjQ0", "url": "https://github.com/openhab/openhab-core/pull/1496#pullrequestreview-455167244", "createdAt": "2020-07-24T20:29:34Z", "commit": {"oid": "04b53d262454bebef7ec6c01bd1fced313bfd3f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4806, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}