{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNzU2Mjcw", "number": 1837, "title": "[automation] Pass script context to script engines", "bodyText": "Pass explicit script context to script engines. Context initially includes only engine identifier.\nSigned-off-by: Jonathan Gilbert jpg@trillica.com", "createdAt": "2020-11-19T08:05:31Z", "url": "https://github.com/openhab/openhab-core/pull/1837", "merged": true, "mergeCommit": {"oid": "60edebc111d4f19abe5858a4d23d996e13041634"}, "closed": true, "closedAt": "2020-11-22T09:52:23Z", "author": {"login": "jpg0"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeF2k3AFqTUzNDY2MTU5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABde9eTIAFqTUzNjA0NTMwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjYxNTkz", "url": "https://github.com/openhab/openhab-core/pull/1837#pullrequestreview-534661593", "createdAt": "2020-11-19T17:04:00Z", "commit": {"oid": "fed910adca46326344629e3ee2c0150a5ffb5c40"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzowNDowMVrOH2ooCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzowNDowMVrOH2ooCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1MDc2MA==", "bodyText": "Is it safe to set that here? Couldn't the script engine have already set up some initial context?\nI'm especially concerned about the DSLScriptEngine, where I recently had a lot of trouble getting the handling of the context stable... Would be good if you could test that there's no issue by this on DSL rules.", "url": "https://github.com/openhab/openhab-core/pull/1837#discussion_r527050760", "createdAt": "2020-11-19T17:04:01Z", "author": {"login": "kaikreuzer"}, "path": "bundles/org.openhab.core.automation.module.script/src/main/java/org/openhab/core/automation/module/script/internal/ScriptEngineManagerImpl.java", "diffHunk": "@@ -129,6 +134,11 @@ private boolean isCustomFactory(ScriptEngineFactory engineFactory) {\n                     loadedScriptEngineInstances.put(engineIdentifier, result);\n                     logger.debug(\"Added ScriptEngine for language '{}' with identifier: {}\", scriptType,\n                             engineIdentifier);\n+\n+                    SimpleScriptContext scriptContext = new SimpleScriptContext();\n+                    scriptContext.setAttribute(CONTEXT_KEY_ENGINE_IDENTIFIER, engineIdentifier, ScriptContext.ENGINE_SCOPE);\n+                    engine.setContext(scriptContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fed910adca46326344629e3ee2c0150a5ffb5c40"}, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fed910adca46326344629e3ee2c0150a5ffb5c40", "author": {"user": {"login": "jpg0", "name": "Jonathan Gilbert"}}, "url": "https://github.com/openhab/openhab-core/commit/fed910adca46326344629e3ee2c0150a5ffb5c40", "committedDate": "2020-11-19T08:04:47Z", "message": "Pass script context to script engines\n\nSigned-off-by: Jonathan Gilbert <jpg@trillica.com>"}, "afterCommit": {"oid": "fd261bb1410563189d8f18247a1dd513acbb8195", "author": {"user": {"login": "jpg0", "name": "Jonathan Gilbert"}}, "url": "https://github.com/openhab/openhab-core/commit/fd261bb1410563189d8f18247a1dd513acbb8195", "committedDate": "2020-11-19T22:29:37Z", "message": "Pass script context to script engines\n\nSigned-off-by: Jonathan Gilbert <jpg@trillica.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82a286f108fda7677f320573eb7a8858b06b2bdc", "author": {"user": {"login": "jpg0", "name": "Jonathan Gilbert"}}, "url": "https://github.com/openhab/openhab-core/commit/82a286f108fda7677f320573eb7a8858b06b2bdc", "committedDate": "2020-11-21T22:39:22Z", "message": "Pass script context to script engines\n\nSigned-off-by: Jonathan Gilbert <jpg@trillica.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd261bb1410563189d8f18247a1dd513acbb8195", "author": {"user": {"login": "jpg0", "name": "Jonathan Gilbert"}}, "url": "https://github.com/openhab/openhab-core/commit/fd261bb1410563189d8f18247a1dd513acbb8195", "committedDate": "2020-11-19T22:29:37Z", "message": "Pass script context to script engines\n\nSigned-off-by: Jonathan Gilbert <jpg@trillica.com>"}, "afterCommit": {"oid": "82a286f108fda7677f320573eb7a8858b06b2bdc", "author": {"user": {"login": "jpg0", "name": "Jonathan Gilbert"}}, "url": "https://github.com/openhab/openhab-core/commit/82a286f108fda7677f320573eb7a8858b06b2bdc", "committedDate": "2020-11-21T22:39:22Z", "message": "Pass script context to script engines\n\nSigned-off-by: Jonathan Gilbert <jpg@trillica.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDQ1MzA0", "url": "https://github.com/openhab/openhab-core/pull/1837#pullrequestreview-536045304", "createdAt": "2020-11-22T09:52:16Z", "commit": {"oid": "82a286f108fda7677f320573eb7a8858b06b2bdc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4673, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}