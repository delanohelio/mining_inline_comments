{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MDE1NzY5", "number": 1700, "title": "Make ExecUtil more robust", "bodyText": "Ever since I first read this code I've been waiting for an excuse to rewrite it.\nI went ahead and got rid of the @@ delimiter usage since it seems silly to not just take the arguments as an additional parameter.\nFixes #1677\nSigned-off-by: Connor Petty mistercpp2000+gitsignoff@gmail.com", "createdAt": "2020-10-07T06:31:02Z", "url": "https://github.com/openhab/openhab-core/pull/1700", "merged": true, "mergeCommit": {"oid": "0dfda1e7f60880899e20f8f799b1ca5ed105f0bc"}, "closed": true, "closedAt": "2020-10-08T16:38:05Z", "author": {"login": "cpmeister"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQG4yigH2gAyNDk5MDE1NzY5OmNkMmNlM2NhMGZhNWIwM2RiMWM5ZmVmNmFiYjZkMjdkZjcyN2MwNzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQjtEuAFqTUwNDkzMjExMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd2ce3ca0fa5b03db1c9fef6abb6d27df727c070", "author": {"user": null}, "url": "https://github.com/openhab/openhab-core/commit/cd2ce3ca0fa5b03db1c9fef6abb6d27df727c070", "committedDate": "2020-10-07T06:21:29Z", "message": "Make ExecUtil more robust\n\nSigned-off-by: Connor Petty <mistercpp2000+gitsignoff@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5739fa22a62cffce52507b86485462b4fa6c76c", "author": {"user": null}, "url": "https://github.com/openhab/openhab-core/commit/a5739fa22a62cffce52507b86485462b4fa6c76c", "committedDate": "2020-10-07T16:53:59Z", "message": "Adjusted according to code review\n\nSigned-off-by: Connor Petty <mistercpp2000+gitsignoff@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f467089103cd0450cc24becf177fd8b91154ac1d", "author": {"user": null}, "url": "https://github.com/openhab/openhab-core/commit/f467089103cd0450cc24becf177fd8b91154ac1d", "committedDate": "2020-10-07T17:06:48Z", "message": "Fix script Exec class.\n\nSigned-off-by: Connor Petty <mistercpp2000+gitsignoff@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjE4Njg3", "url": "https://github.com/openhab/openhab-core/pull/1700#pullrequestreview-504218687", "createdAt": "2020-10-07T19:55:47Z", "commit": {"oid": "f467089103cd0450cc24becf177fd8b91154ac1d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTo1NTo0OFrOHeDPFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTo1NjowOVrOHeDPxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI3MjM0MA==", "bodyText": "This JavaDoc still needs to be updated for the latest changes.", "url": "https://github.com/openhab/openhab-core/pull/1700#discussion_r501272340", "createdAt": "2020-10-07T19:55:48Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.core.io.net/src/main/java/org/openhab/core/io/net/exec/ExecUtil.java", "diffHunk": "@@ -28,87 +35,101 @@\n  *\n  * @author Pauli Anttila - Initial contribution\n  * @author Kai Kreuzer - added exception logging\n+ * @author Connor Petty - rewrote\n  */\n+@NonNullByDefault\n public class ExecUtil {\n \n     private static Logger logger = LoggerFactory.getLogger(ExecUtil.class);\n \n-    /**\n-     * Use this to separate between command and parameter, and also between parameters.\n-     */\n-    public static final String CMD_LINE_DELIMITER = \"@@\";\n+    private static ExecutorService executor = ThreadPoolManager.getPool(\"ExecUtil\");\n \n     /**\n      * <p>\n-     * Executes <code>commandLine</code>. Sometimes (especially observed on MacOS) the commandLine isn't executed\n-     * properly. In that cases another exec-method is to be used. To accomplish this please use the special delimiter\n-     * '<code>@@</code>'. If <code>commandLine</code> contains this delimiter it is split into a String list and the\n-     * special exec-method is used.\n+     * Executes <code>commandLine</code>.\n      *\n      * <p>\n      * A possible {@link IOException} gets logged but no further processing is done.\n      *\n      * @param commandLine the command line to execute\n      */\n-    public static void executeCommandLine(String commandLine) {\n-        internalExecute(commandLine);\n+    public static void executeCommandLine(String... commandLine) {\n+        try {\n+            new ProcessBuilder(commandLine).redirectError(Redirect.DISCARD).redirectOutput(Redirect.DISCARD).start();\n+        } catch (IOException e) {\n+            logger.warn(\"Error occurred when executing commandLine '{}'\", commandLine, e);\n+        }\n     }\n \n     /**\n      * <p>\n-     * Executes <code>commandLine</code> and return its result. Sometimes (especially observed on MacOS) the commandLine\n-     * isn't executed properly. In that cases another exec-method is to be used. To accomplish this please use the\n-     * special delimiter '<code>@@</code>'. If <code>commandLine</code> contains this delimiter it is split into a\n-     * String list and the special exec-method is used.\n+     * Executes <code>commandLine</code> and return its result.\n      *\n      * <p>\n      * A possible {@link IOException} gets logged but no further processing is done.\n      *\n+     * @param timeout timeout for execution in milliseconds, 0 to wait indefinitely", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f467089103cd0450cc24becf177fd8b91154ac1d"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI3MjUxNg==", "bodyText": "Can you  be a bit more specific?", "url": "https://github.com/openhab/openhab-core/pull/1700#discussion_r501272516", "createdAt": "2020-10-07T19:56:09Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.core.io.net/src/main/java/org/openhab/core/io/net/exec/ExecUtil.java", "diffHunk": "@@ -28,87 +35,101 @@\n  *\n  * @author Pauli Anttila - Initial contribution\n  * @author Kai Kreuzer - added exception logging\n+ * @author Connor Petty - rewrote", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f467089103cd0450cc24becf177fd8b91154ac1d"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7a47bcd6540ae3d50cfdecf7188dd1bb18d1c3a", "author": {"user": null}, "url": "https://github.com/openhab/openhab-core/commit/c7a47bcd6540ae3d50cfdecf7188dd1bb18d1c3a", "committedDate": "2020-10-07T21:01:01Z", "message": "Fixed javadoc\n\nSigned-off-by: Connor Petty <mistercpp2000+gitsignoff@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NDc5NTY3", "url": "https://github.com/openhab/openhab-core/pull/1700#pullrequestreview-504479567", "createdAt": "2020-10-08T07:01:25Z", "commit": {"oid": "c7a47bcd6540ae3d50cfdecf7188dd1bb18d1c3a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwNzowMToyNVrOHeQibg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwNzowMToyNVrOHeQibg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ5MDI4Ng==", "bodyText": "The timeout is only used when it is not null:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param timeout the max time to wait for a process to finish, 0 to wait indefinitely\n          \n          \n            \n                 * @param timeout the max time to wait for a process to finish, null to wait indefinitely", "url": "https://github.com/openhab/openhab-core/pull/1700#discussion_r501490286", "createdAt": "2020-10-08T07:01:25Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.core.io.net/src/main/java/org/openhab/core/io/net/exec/ExecUtil.java", "diffHunk": "@@ -28,87 +35,101 @@\n  *\n  * @author Pauli Anttila - Initial contribution\n  * @author Kai Kreuzer - added exception logging\n+ * @author Connor Petty - replaced delimiter usage with argument array\n  */\n+@NonNullByDefault\n public class ExecUtil {\n \n     private static Logger logger = LoggerFactory.getLogger(ExecUtil.class);\n \n-    /**\n-     * Use this to separate between command and parameter, and also between parameters.\n-     */\n-    public static final String CMD_LINE_DELIMITER = \"@@\";\n+    private static ExecutorService executor = ThreadPoolManager.getPool(\"ExecUtil\");\n \n     /**\n      * <p>\n-     * Executes <code>commandLine</code>. Sometimes (especially observed on MacOS) the commandLine isn't executed\n-     * properly. In that cases another exec-method is to be used. To accomplish this please use the special delimiter\n-     * '<code>@@</code>'. If <code>commandLine</code> contains this delimiter it is split into a String list and the\n-     * special exec-method is used.\n+     * Executes <code>commandLine</code>.\n      *\n      * <p>\n      * A possible {@link IOException} gets logged but no further processing is done.\n      *\n      * @param commandLine the command line to execute\n      */\n-    public static void executeCommandLine(String commandLine) {\n-        internalExecute(commandLine);\n+    public static void executeCommandLine(String... commandLine) {\n+        try {\n+            new ProcessBuilder(commandLine).redirectError(Redirect.DISCARD).redirectOutput(Redirect.DISCARD).start();\n+        } catch (IOException e) {\n+            logger.warn(\"Error occurred when executing commandLine '{}'\", commandLine, e);\n+        }\n     }\n \n     /**\n      * <p>\n-     * Executes <code>commandLine</code> and return its result. Sometimes (especially observed on MacOS) the commandLine\n-     * isn't executed properly. In that cases another exec-method is to be used. To accomplish this please use the\n-     * special delimiter '<code>@@</code>'. If <code>commandLine</code> contains this delimiter it is split into a\n-     * String list and the special exec-method is used.\n+     * Executes <code>commandLine</code> and return its result.\n      *\n      * <p>\n      * A possible {@link IOException} gets logged but no further processing is done.\n      *\n+     * @param timeout the max time to wait for a process to finish, 0 to wait indefinitely", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7a47bcd6540ae3d50cfdecf7188dd1bb18d1c3a"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38168e34c8929ff6b0dacfb2885d9c0cfd8b33ca", "author": {"user": null}, "url": "https://github.com/openhab/openhab-core/commit/38168e34c8929ff6b0dacfb2885d9c0cfd8b33ca", "committedDate": "2020-10-08T15:33:27Z", "message": "Fix javadoc\n\nSigned-off-by: Connor Petty <mistercpp2000+gitsignoff@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0OTMyMTEx", "url": "https://github.com/openhab/openhab-core/pull/1700#pullrequestreview-504932111", "createdAt": "2020-10-08T15:55:56Z", "commit": {"oid": "38168e34c8929ff6b0dacfb2885d9c0cfd8b33ca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4757, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}