{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4OTcwMTYy", "number": 1649, "title": "Increase StartlevelEvent delay to 15 seconds", "bodyText": "The rules are often not instantiated within 5 seconds.\nOn a Raspberry Pi 3B it can take 12 seconds before rules are instantiated.\nThe code has also been improved with proper null annotations.\nRelated to #1637", "createdAt": "2020-09-17T22:48:39Z", "url": "https://github.com/openhab/openhab-core/pull/1649", "merged": true, "mergeCommit": {"oid": "5919f923d55f5ec693ecd64f47f54752dcf17a30"}, "closed": true, "closedAt": "2020-09-18T21:27:57Z", "author": {"login": "wborn"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ5AX4gH2gAyNDg4OTcwMTYyOjFkOGQ2MDMyY2VhZTIyMzQ1YWU0YTU4OTc2NjY1OWZlNmRlOTRiNGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKALDWgFqTQ5MTIwMjgxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1d8d6032ceae22345ae4a589766659fe6de94b4b", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-core/commit/1d8d6032ceae22345ae4a589766659fe6de94b4b", "committedDate": "2020-09-17T22:47:33Z", "message": "Increase StartlevelEvent delay to 15 seconds\n\nThe rules are often not instantiated within 5 seconds.\nOn a Raspberry Pi 3B it can take 12 seconds before rules are instantiated.\nThe code has also been improved with proper null annotations.\n\nRelated to #1637\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMDY5MjU4", "url": "https://github.com/openhab/openhab-core/pull/1649#pullrequestreview-491069258", "createdAt": "2020-09-18T00:14:37Z", "commit": {"oid": "1d8d6032ceae22345ae4a589766659fe6de94b4b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMjAyNzQ4", "url": "https://github.com/openhab/openhab-core/pull/1649#pullrequestreview-491202748", "createdAt": "2020-09-18T07:08:25Z", "commit": {"oid": "1d8d6032ceae22345ae4a589766659fe6de94b4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNzowODoyNVrOHUAuxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNzowODoyNVrOHUAuxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc0NTU0Mw==", "bodyText": "Oh, that's a worthwhile improvement - creating a new listener on every marker event was indeed a very bad idea. I'd bet that this change alone will make the RPi to only need 5 secs to be ready for rules now ;-)", "url": "https://github.com/openhab/openhab-core/pull/1649#discussion_r490745543", "createdAt": "2020-09-18T07:08:25Z", "author": {"login": "kaikreuzer"}, "path": "bundles/org.openhab.core.model.rule/src/org/openhab/core/model/rule/jvmmodel/RulesRefresher.java", "diffHunk": "@@ -50,30 +51,65 @@\n  * @author Maoliang Huang - refactor\n  */\n @Component(immediate = true, service = {})\n+@NonNullByDefault\n public class RulesRefresher implements ReadyTracker {\n \n-    // delay in ms before rule resources are refreshed after items or services have changed\n-    private static final long REFRESH_DELAY = 5000;\n+    // delay in seconds before rule resources are refreshed after items or services have changed\n+    private static final long REFRESH_DELAY = 5;\n \n     private static final String POOL_NAME = \"automation\";\n     public static final String RULES_REFRESH = \"rules_refresh\";\n \n     private final Logger logger = LoggerFactory.getLogger(RulesRefresher.class);\n \n-    private ScheduledFuture<?> job;\n-    private ScheduledExecutorService scheduler = ThreadPoolManager.getScheduledPool(POOL_NAME);\n+    private @Nullable ScheduledFuture<?> job;\n+    private final ScheduledExecutorService scheduler = ThreadPoolManager.getScheduledPool(POOL_NAME);\n     private boolean started;\n-    private ReadyMarker marker = new ReadyMarker(\"dsl\", RULES_REFRESH);\n-\n-    private ItemRegistryChangeListener itemRegistryChangeListener;\n-    private ThingRegistryChangeListener thingRegistryChangeListener;\n+    private final ReadyMarker marker = new ReadyMarker(\"dsl\", RULES_REFRESH);\n \n     private final ModelRepository modelRepository;\n     private final ItemRegistry itemRegistry;\n     private final ThingRegistry thingRegistry;\n     private final EventPublisher eventPublisher;\n     private final ReadyService readyService;\n \n+    private final ItemRegistryChangeListener itemRegistryChangeListener = new ItemRegistryChangeListener() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d8d6032ceae22345ae4a589766659fe6de94b4b"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMjAyODE0", "url": "https://github.com/openhab/openhab-core/pull/1649#pullrequestreview-491202814", "createdAt": "2020-09-18T07:08:33Z", "commit": {"oid": "1d8d6032ceae22345ae4a589766659fe6de94b4b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4748, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}