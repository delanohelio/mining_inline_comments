{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NDk3Njkw", "number": 1750, "title": "[automation] Allow dashes in rule file names", "bodyText": "Fixes #1728\nSigned-off-by: Kai Kreuzer kai@openhab.org", "createdAt": "2020-10-24T21:31:47Z", "url": "https://github.com/openhab/openhab-core/pull/1750", "merged": true, "mergeCommit": {"oid": "749b8f17fef8e8c8ac602be8d2a43925b11310fd"}, "closed": true, "closedAt": "2020-10-25T19:19:01Z", "author": {"login": "kaikreuzer"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVyFcvgH2gAyNTA5NDk3NjkwOjFmNDlkMWY2ZTEyN2Q2ZmNmM2JkN2VmMjQ0ZmYxYTVjY2JiMDVlZTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWEe-EgFqTUxNjM4NzUyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f49d1f6e127d6fcf3bd7ef244ff1a5ccbb05ee9", "author": {"user": {"login": "kaikreuzer", "name": "Kai Kreuzer"}}, "url": "https://github.com/openhab/openhab-core/commit/1f49d1f6e127d6fcf3bd7ef244ff1a5ccbb05ee9", "committedDate": "2020-10-24T21:30:51Z", "message": "Allow dashes in rule file names\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MzM4MTI1", "url": "https://github.com/openhab/openhab-core/pull/1750#pullrequestreview-516338125", "createdAt": "2020-10-25T09:05:41Z", "commit": {"oid": "1f49d1f6e127d6fcf3bd7ef244ff1a5ccbb05ee9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MzQwNTAz", "url": "https://github.com/openhab/openhab-core/pull/1750#pullrequestreview-516340503", "createdAt": "2020-10-25T09:36:31Z", "commit": {"oid": "1f49d1f6e127d6fcf3bd7ef244ff1a5ccbb05ee9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQwOTozNjozMVrOHn33zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQwOTozNjozMVrOHn33zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU3MTkxNw==", "bodyText": "We can store contextString.lastIndexOf('-') in a local variable and reuse it:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (contextString.contains(\"-\")) {\n          \n          \n            \n                                modelName = contextString.substring(0, contextString.lastIndexOf('-'));\n          \n          \n            \n                                String ruleIndex = contextString.substring(contextString.lastIndexOf('-') + 1);\n          \n          \n            \n                            int index = contextString.lastIndexOf('-');\n          \n          \n            \n                            if (index != -1) {\n          \n          \n            \n                                modelName = contextString.substring(0, index);\n          \n          \n            \n                                String ruleIndex = contextString.substring(index + 1);", "url": "https://github.com/openhab/openhab-core/pull/1750#discussion_r511571917", "createdAt": "2020-10-25T09:36:31Z", "author": {"login": "cweitkamp"}, "path": "bundles/org.openhab.core.model.script.runtime/src/org/openhab/core/model/script/runtime/internal/engine/DSLScriptEngine.java", "diffHunk": "@@ -87,10 +87,9 @@ public Object eval(String script) throws ScriptException {\n             if (script.stripLeading().startsWith(DSLScriptContextProvider.CONTEXT_IDENTIFIER)) {\n                 String contextString = script.stripLeading().substring(\n                         DSLScriptContextProvider.CONTEXT_IDENTIFIER.length(), script.stripLeading().indexOf('\\n'));\n-                String[] segments = contextString.split(\"-\");\n-                if (segments.length == 2) {\n-                    modelName = segments[0];\n-                    String ruleIndex = segments[1];\n+                if (contextString.contains(\"-\")) {\n+                    modelName = contextString.substring(0, contextString.lastIndexOf('-'));\n+                    String ruleIndex = contextString.substring(contextString.lastIndexOf('-') + 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f49d1f6e127d6fcf3bd7ef244ff1a5ccbb05ee9"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dec28445444f0a314ee7105d780543d26e269f41", "author": {"user": {"login": "kaikreuzer", "name": "Kai Kreuzer"}}, "url": "https://github.com/openhab/openhab-core/commit/dec28445444f0a314ee7105d780543d26e269f41", "committedDate": "2020-10-25T13:17:36Z", "message": "addressed review comment\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mzg1OTMx", "url": "https://github.com/openhab/openhab-core/pull/1750#pullrequestreview-516385931", "createdAt": "2020-10-25T18:35:32Z", "commit": {"oid": "dec28445444f0a314ee7105d780543d26e269f41"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQxODozNTozMlrOHn7ktA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQxODozNTozMlrOHn7ktA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYzMjU2NA==", "bodyText": "Thanks. But I could be improved a little bit more. It is possible to skip the contains(\"-\") check when calculation the indexLastDash = lastIndexOf(\"-\") first and check for -1 on it.", "url": "https://github.com/openhab/openhab-core/pull/1750#discussion_r511632564", "createdAt": "2020-10-25T18:35:32Z", "author": {"login": "cweitkamp"}, "path": "bundles/org.openhab.core.model.script.runtime/src/org/openhab/core/model/script/runtime/internal/engine/DSLScriptEngine.java", "diffHunk": "@@ -87,10 +87,10 @@ public Object eval(String script) throws ScriptException {\n             if (script.stripLeading().startsWith(DSLScriptContextProvider.CONTEXT_IDENTIFIER)) {\n                 String contextString = script.stripLeading().substring(\n                         DSLScriptContextProvider.CONTEXT_IDENTIFIER.length(), script.stripLeading().indexOf('\\n'));\n-                String[] segments = contextString.split(\"-\");\n-                if (segments.length == 2) {\n-                    modelName = segments[0];\n-                    String ruleIndex = segments[1];\n+                if (contextString.contains(\"-\")) {\n+                    int indexLastDash = contextString.lastIndexOf('-');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dec28445444f0a314ee7105d780543d26e269f41"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mzg3NTI2", "url": "https://github.com/openhab/openhab-core/pull/1750#pullrequestreview-516387526", "createdAt": "2020-10-25T18:57:01Z", "commit": {"oid": "dec28445444f0a314ee7105d780543d26e269f41"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4649, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}