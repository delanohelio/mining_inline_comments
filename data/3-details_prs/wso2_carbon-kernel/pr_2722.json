{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1NTYxMzI4", "number": 2722, "title": "Add role and group separation changes", "bodyText": "Resolves wso2/product-is#9040", "createdAt": "2020-07-23T08:42:39Z", "url": "https://github.com/wso2/carbon-kernel/pull/2722", "merged": true, "mergeCommit": {"oid": "c497e4f6b0a42eb1b2a7ff772a68b6cd62e8b9f3"}, "closed": true, "closedAt": "2020-08-07T05:55:09Z", "author": {"login": "ashensw"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7R2pEgBqjM2MTU4NjcwMjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8dpMngBqjM2MzE4MDg2NzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e0bf3c6e6cf08a19ef29c2d0cea2478a4643dad", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/3e0bf3c6e6cf08a19ef29c2d0cea2478a4643dad", "committedDate": "2020-07-23T08:39:42Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "b258be18547fe413bd111784fb28bb49dcadfc53", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/b258be18547fe413bd111784fb28bb49dcadfc53", "committedDate": "2020-08-03T13:15:24Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b258be18547fe413bd111784fb28bb49dcadfc53", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/b258be18547fe413bd111784fb28bb49dcadfc53", "committedDate": "2020-08-03T13:15:24Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "21355ce233d3d978073155ad9b24d45a65fd7caa", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/21355ce233d3d978073155ad9b24d45a65fd7caa", "committedDate": "2020-08-03T19:51:30Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21355ce233d3d978073155ad9b24d45a65fd7caa", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/21355ce233d3d978073155ad9b24d45a65fd7caa", "committedDate": "2020-08-03T19:51:30Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "fae7c8570d6b6753a4841e194e47a6f7713f25f8", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/fae7c8570d6b6753a4841e194e47a6f7713f25f8", "committedDate": "2020-08-04T09:24:34Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fae7c8570d6b6753a4841e194e47a6f7713f25f8", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/fae7c8570d6b6753a4841e194e47a6f7713f25f8", "committedDate": "2020-08-04T09:24:34Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "dcacfe4ba37dfb05e66388fcab390f50c0393e74", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/dcacfe4ba37dfb05e66388fcab390f50c0393e74", "committedDate": "2020-08-04T09:41:08Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dcacfe4ba37dfb05e66388fcab390f50c0393e74", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/dcacfe4ba37dfb05e66388fcab390f50c0393e74", "committedDate": "2020-08-04T09:41:08Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "f7e1598650cede7bc4ef6bdacb8bc2068cf5cf0e", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/f7e1598650cede7bc4ef6bdacb8bc2068cf5cf0e", "committedDate": "2020-08-04T11:55:26Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7e1598650cede7bc4ef6bdacb8bc2068cf5cf0e", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/f7e1598650cede7bc4ef6bdacb8bc2068cf5cf0e", "committedDate": "2020-08-04T11:55:26Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "4328a533a409ed03266619b7e69f6ebbce8c3af3", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/4328a533a409ed03266619b7e69f6ebbce8c3af3", "committedDate": "2020-08-04T19:20:43Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4328a533a409ed03266619b7e69f6ebbce8c3af3", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/4328a533a409ed03266619b7e69f6ebbce8c3af3", "committedDate": "2020-08-04T19:20:43Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "5317bf35c93f7de27bf47e3f8d13d22439fb4ee5", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/5317bf35c93f7de27bf47e3f8d13d22439fb4ee5", "committedDate": "2020-08-05T04:01:07Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5317bf35c93f7de27bf47e3f8d13d22439fb4ee5", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/5317bf35c93f7de27bf47e3f8d13d22439fb4ee5", "committedDate": "2020-08-05T04:01:07Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "197f6c44f7251c77bcf440b552a8cda0ff032b3e", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/197f6c44f7251c77bcf440b552a8cda0ff032b3e", "committedDate": "2020-08-05T07:25:10Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "197f6c44f7251c77bcf440b552a8cda0ff032b3e", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/197f6c44f7251c77bcf440b552a8cda0ff032b3e", "committedDate": "2020-08-05T07:25:10Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/d302bc96513f99869f7271e0eaa575ff20de2154", "committedDate": "2020-08-05T08:08:22Z", "message": "Add role and group separation changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTkzMTk1", "url": "https://github.com/wso2/carbon-kernel/pull/2722#pullrequestreview-461993195", "createdAt": "2020-08-05T20:18:47Z", "commit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDoxODo0N1rOG8ZI0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDoxODo0N1rOG8ZI0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk3OTYwMA==", "bodyText": "why can't we do this using prepStmt?", "url": "https://github.com/wso2/carbon-kernel/pull/2722#discussion_r465979600", "createdAt": "2020-08-05T20:18:47Z", "author": {"login": "IsuraD"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/hybrid/HybridRoleManager.java", "diffHunk": "@@ -632,6 +714,66 @@ private String truncateInternalDomainFromFilter(String filter) {\n         return hybridRoleListOfUsers;\n     }\n \n+    /**\n+     * Get hybrid role list of groups.\n+     *\n+     * @param groupNames group name list.\n+     * @return map of hybrid role list of groups.\n+     * @throws UserStoreException userStoreException.\n+     */\n+    public Map<String, List<String>> getHybridRoleListOfGroups(List<String> groupNames, String domainName)\n+            throws UserStoreException {\n+\n+        Map<String, List<String>> hybridRoleListOfGroups = new HashMap<>();\n+        String sqlStmt = realmConfig.getRealmProperty(HybridJDBCConstants.GET_ROLE_LIST_OF_GROUPS);\n+        StringBuilder groupNameParameter = new StringBuilder();\n+\n+        if (StringUtils.isEmpty(sqlStmt)) {\n+            sqlStmt = HybridJDBCConstants.GET_INTERNAL_ROLE_LIST_OF_GROUPS_SQL;\n+        }\n+        for (int i = 0; i < groupNames.size(); i++) {\n+\n+            groupNames.set(i, groupNames.get(i).replaceAll(\"'\", \"''\"));\n+            groupNameParameter.append(\"'\").append(groupNames.get(i)).append(\"'\");\n+\n+            if (i != groupNames.size() - 1) {\n+                groupNameParameter.append(\",\");\n+            }\n+        }\n+\n+        sqlStmt = sqlStmt.replaceFirst(\"\\\\?\", Matcher.quoteReplacement(groupNameParameter.toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154"}, "originalPosition": 143}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTk4NzQw", "url": "https://github.com/wso2/carbon-kernel/pull/2722#pullrequestreview-461998740", "createdAt": "2020-08-05T20:27:24Z", "commit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDoyNzoyNFrOG8ZaiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDoyNzoyNFrOG8ZaiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4NDEzNw==", "bodyText": "unnecessary line.", "url": "https://github.com/wso2/carbon-kernel/pull/2722#discussion_r465984137", "createdAt": "2020-08-05T20:27:24Z", "author": {"login": "IsuraD"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/hybrid/HybridRoleManager.java", "diffHunk": "@@ -632,6 +714,66 @@ private String truncateInternalDomainFromFilter(String filter) {\n         return hybridRoleListOfUsers;\n     }\n \n+    /**\n+     * Get hybrid role list of groups.\n+     *\n+     * @param groupNames group name list.\n+     * @return map of hybrid role list of groups.\n+     * @throws UserStoreException userStoreException.\n+     */\n+    public Map<String, List<String>> getHybridRoleListOfGroups(List<String> groupNames, String domainName)\n+            throws UserStoreException {\n+\n+        Map<String, List<String>> hybridRoleListOfGroups = new HashMap<>();\n+        String sqlStmt = realmConfig.getRealmProperty(HybridJDBCConstants.GET_ROLE_LIST_OF_GROUPS);\n+        StringBuilder groupNameParameter = new StringBuilder();\n+\n+        if (StringUtils.isEmpty(sqlStmt)) {\n+            sqlStmt = HybridJDBCConstants.GET_INTERNAL_ROLE_LIST_OF_GROUPS_SQL;\n+        }\n+        for (int i = 0; i < groupNames.size(); i++) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154"}, "originalPosition": 134}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDA0MzA2", "url": "https://github.com/wso2/carbon-kernel/pull/2722#pullrequestreview-462004306", "createdAt": "2020-08-05T20:35:51Z", "commit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDozNTo1MVrOG8Zq-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDozNTo1MVrOG8Zq-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4ODM0NQ==", "bodyText": "Is this a common requirement to use as a Util? Better use as a private method.", "url": "https://github.com/wso2/carbon-kernel/pull/2722#discussion_r465988345", "createdAt": "2020-08-05T20:35:51Z", "author": {"login": "IsuraD"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/util/UserCoreUtil.java", "diffHunk": "@@ -120,6 +121,21 @@\n         return (String[]) h.toArray(new String[h.size()]);\n     }\n \n+    /**\n+     * Convert a map of lists to a list with unique elements.\n+     *\n+     * @param mapOfLists Map of lists.\n+     * @return list with unique elements.\n+     */\n+    public static Set<String> getList(Map<String, List<String>> mapOfLists) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDA5MjQ2", "url": "https://github.com/wso2/carbon-kernel/pull/2722#pullrequestreview-462009246", "createdAt": "2020-08-05T20:43:38Z", "commit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDo0MzozOFrOG8Z6Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDo0MzozOFrOG8Z6Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5MjI3MQ==", "bodyText": "Why the table name is UM_HYBRID_GROUP_ROLE? We don't have HYBRID_GROUP... prefer UM_GROUP_ROLE", "url": "https://github.com/wso2/carbon-kernel/pull/2722#discussion_r465992271", "createdAt": "2020-08-05T20:43:38Z", "author": {"login": "IsuraD"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/hybrid/HybridJDBCConstants.java", "diffHunk": "@@ -107,6 +128,12 @@\n             + \".UM_TENANT_ID=? AND UM_HYBRID_USER_ROLE.UM_DOMAIN_ID=(SELECT UM_DOMAIN_ID FROM UM_DOMAIN WHERE \"\n             + \"UM_TENANT_ID=? AND UM_DOMAIN_NAME=?)\";\n \n+    public static final String GET_INTERNAL_ROLE_LIST_OF_GROUPS_SQL = \"SELECT UM_GROUP_NAME, UM_ROLE_NAME FROM \"\n+            + \"UM_HYBRID_GROUP_ROLE, UM_HYBRID_ROLE WHERE UM_GROUP_NAME IN (?) AND UM_HYBRID_GROUP_ROLE\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d302bc96513f99869f7271e0eaa575ff20de2154", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/d302bc96513f99869f7271e0eaa575ff20de2154", "committedDate": "2020-08-05T08:08:22Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "55386bddf2c16fdd730757a9170d80e3d8079f66", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/55386bddf2c16fdd730757a9170d80e3d8079f66", "committedDate": "2020-08-06T07:42:13Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55386bddf2c16fdd730757a9170d80e3d8079f66", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/55386bddf2c16fdd730757a9170d80e3d8079f66", "committedDate": "2020-08-06T07:42:13Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "78b857d7adb9345fe8f0761f0d542cc4fa6d7b4c", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/78b857d7adb9345fe8f0761f0d542cc4fa6d7b4c", "committedDate": "2020-08-06T09:03:49Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78b857d7adb9345fe8f0761f0d542cc4fa6d7b4c", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/78b857d7adb9345fe8f0761f0d542cc4fa6d7b4c", "committedDate": "2020-08-06T09:03:49Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "aceb76895294c3d5b2645e1e7cd56122012506ed", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/aceb76895294c3d5b2645e1e7cd56122012506ed", "committedDate": "2020-08-06T09:05:43Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aceb76895294c3d5b2645e1e7cd56122012506ed", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/aceb76895294c3d5b2645e1e7cd56122012506ed", "committedDate": "2020-08-06T09:05:43Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "7c734dbe5ab45fa4834944351e906e18556f3a41", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/7c734dbe5ab45fa4834944351e906e18556f3a41", "committedDate": "2020-08-07T04:45:15Z", "message": "Add role and group separation changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMDM1ODkx", "url": "https://github.com/wso2/carbon-kernel/pull/2722#pullrequestreview-463035891", "createdAt": "2020-08-07T05:04:13Z", "commit": {"oid": "7c734dbe5ab45fa4834944351e906e18556f3a41"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNTowNDoxM1rOG9MlHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNTowNDoxM1rOG9MlHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMjQyOA==", "bodyText": "why is this primaryDomainName? Can be differ", "url": "https://github.com/wso2/carbon-kernel/pull/2722#discussion_r466822428", "createdAt": "2020-08-07T05:04:13Z", "author": {"login": "IsuraD"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/hybrid/HybridRoleManager.java", "diffHunk": "@@ -433,6 +434,87 @@ public void updateUserListOfHybridRole(String roleName, String[] deletedUsers, S\n         }\n     }\n \n+    /**\n+     * Update group list of role.\n+     *\n+     * @param roleName      Role name.\n+     * @param deletedGroups Deleted groups.\n+     * @param newGroups     New groups.\n+     * @throws UserStoreException UserStoreException.\n+     */\n+    public void updateGroupListOfHybridRole(String roleName, String[] deletedGroups, String[] newGroups)\n+            throws UserStoreException {\n+\n+        String sqlStmt1 = HybridJDBCConstants.REMOVE_GROUP_FROM_ROLE_SQL;\n+        String sqlStmt2 = HybridJDBCConstants.ADD_GROUP_TO_ROLE_SQL;\n+\n+        try (Connection dbConnection = DatabaseUtil.getDBConnection(dataSource)) {\n+\n+            String primaryDomainName = getMyDomainName();\n+            if (primaryDomainName != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c734dbe5ab45fa4834944351e906e18556f3a41"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMDM2MDE0", "url": "https://github.com/wso2/carbon-kernel/pull/2722#pullrequestreview-463036014", "createdAt": "2020-08-07T05:04:40Z", "commit": {"oid": "7c734dbe5ab45fa4834944351e906e18556f3a41"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNTowNDo0MVrOG9MlfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNTowNDo0MVrOG9MlfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMjUyNQ==", "bodyText": "what is OPENEDGE_TYPE ?", "url": "https://github.com/wso2/carbon-kernel/pull/2722#discussion_r466822525", "createdAt": "2020-08-07T05:04:41Z", "author": {"login": "IsuraD"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/hybrid/HybridRoleManager.java", "diffHunk": "@@ -433,6 +434,87 @@ public void updateUserListOfHybridRole(String roleName, String[] deletedUsers, S\n         }\n     }\n \n+    /**\n+     * Update group list of role.\n+     *\n+     * @param roleName      Role name.\n+     * @param deletedGroups Deleted groups.\n+     * @param newGroups     New groups.\n+     * @throws UserStoreException UserStoreException.\n+     */\n+    public void updateGroupListOfHybridRole(String roleName, String[] deletedGroups, String[] newGroups)\n+            throws UserStoreException {\n+\n+        String sqlStmt1 = HybridJDBCConstants.REMOVE_GROUP_FROM_ROLE_SQL;\n+        String sqlStmt2 = HybridJDBCConstants.ADD_GROUP_TO_ROLE_SQL;\n+\n+        try (Connection dbConnection = DatabaseUtil.getDBConnection(dataSource)) {\n+\n+            String primaryDomainName = getMyDomainName();\n+            if (primaryDomainName != null) {\n+                primaryDomainName = primaryDomainName.toUpperCase();\n+            }\n+\n+            String type = DatabaseCreator.getDatabaseType(dbConnection);\n+            if (UserCoreConstants.MSSQL_TYPE.equals(type)) {\n+                sqlStmt2 = HybridJDBCConstants.ADD_GROUP_TO_ROLE_SQL_MSSQL;\n+            }\n+\n+            if (ArrayUtils.isNotEmpty(deletedGroups)) {\n+                DatabaseUtil.udpateUserRoleMappingInBatchModeForInternalRoles(dbConnection, sqlStmt1, primaryDomainName,\n+                        deletedGroups, roleName, tenantId, tenantId, tenantId);\n+            }\n+\n+            if (ArrayUtils.isNotEmpty(newGroups)) {\n+                if (UserCoreConstants.OPENEDGE_TYPE.equals(type)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c734dbe5ab45fa4834944351e906e18556f3a41"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMDQxNzc2", "url": "https://github.com/wso2/carbon-kernel/pull/2722#pullrequestreview-463041776", "createdAt": "2020-08-07T05:25:17Z", "commit": {"oid": "7c734dbe5ab45fa4834944351e906e18556f3a41"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e6586e113afc30eaf9738a98adc869ef869fa3a", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/2e6586e113afc30eaf9738a98adc869ef869fa3a", "committedDate": "2020-08-07T05:33:19Z", "message": "Add role and group separation changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c734dbe5ab45fa4834944351e906e18556f3a41", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/7c734dbe5ab45fa4834944351e906e18556f3a41", "committedDate": "2020-08-07T04:45:15Z", "message": "Add role and group separation changes"}, "afterCommit": {"oid": "2e6586e113afc30eaf9738a98adc869ef869fa3a", "author": {"user": {"login": "ashensw", "name": "Ashen Weerathunga"}}, "url": "https://github.com/wso2/carbon-kernel/commit/2e6586e113afc30eaf9738a98adc869ef869fa3a", "committedDate": "2020-08-07T05:33:19Z", "message": "Add role and group separation changes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2049, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}