{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0OTUxMTg2", "number": 2661, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTo1NDozN1rOD0DrLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNzowNjo1MFrOD0FPoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1OTEyNzUwOnYy", "diffSide": "RIGHT", "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/ConfigurableLoggerAccessLogValve.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTo1NDozN1rOGIzw8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNzowMToyMFrOGI1y2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg4OTkwNw==", "bodyText": "Let's add Licence ..", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411889907", "createdAt": "2020-04-21T05:54:37Z", "author": {"login": "hasinthaindrajee"}, "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/ConfigurableLoggerAccessLogValve.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package org.wso2.carbon.tomcat.ext.valves;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyMzE2Mg==", "bodyText": "+1\nDone", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411923162", "createdAt": "2020-04-21T07:01:20Z", "author": {"login": "ruwanta"}, "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/ConfigurableLoggerAccessLogValve.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package org.wso2.carbon.tomcat.ext.valves;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg4OTkwNw=="}, "originalCommit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1OTE0MjE5OnYy", "diffSide": "RIGHT", "path": "distribution/kernel/carbon-home/repository/resources/conf/templates/repository/conf/tomcat/catalina-server.xml.j2", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTo1OToxOFrOGIz44w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNzowMjozOFrOGI11gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg5MTkzOQ==", "bodyText": "would it be better if we add this to default.json? WDYT @pulasthi7", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411891939", "createdAt": "2020-04-21T05:59:18Z", "author": {"login": "Buddhimah"}, "path": "distribution/kernel/carbon-home/repository/resources/conf/templates/repository/conf/tomcat/catalina-server.xml.j2", "diffHunk": "@@ -66,7 +66,13 @@\n                 <Valve className=\"org.wso2.carbon.tomcat.ext.valves.RequestCorrelationIdValve\"\n                        headerToCorrelationIdMapping=\"{'activityid':'Correlation-ID'}\" queryToCorrelationIdMapping=\"{'RelayState':'Correlation-ID'}\"/>\n                 <Valve className=\"org.wso2.carbon.tomcat.ext.valves.CarbonContextCreatorValve\"/>\n+                {% if http_access_log.useLogger is sameas true %}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg5MjE2Ng==", "bodyText": "[http_access_log]\nuseLogger = false", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411892166", "createdAt": "2020-04-21T05:59:54Z", "author": {"login": "Buddhimah"}, "path": "distribution/kernel/carbon-home/repository/resources/conf/templates/repository/conf/tomcat/catalina-server.xml.j2", "diffHunk": "@@ -66,7 +66,13 @@\n                 <Valve className=\"org.wso2.carbon.tomcat.ext.valves.RequestCorrelationIdValve\"\n                        headerToCorrelationIdMapping=\"{'activityid':'Correlation-ID'}\" queryToCorrelationIdMapping=\"{'RelayState':'Correlation-ID'}\"/>\n                 <Valve className=\"org.wso2.carbon.tomcat.ext.valves.CarbonContextCreatorValve\"/>\n+                {% if http_access_log.useLogger is sameas true %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg5MTkzOQ=="}, "originalCommit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyMzg0MQ==", "bodyText": "@Buddhimah It is not need to add this to default.json as the default is always taken as false when not explicitly defined as \"true\"", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411923841", "createdAt": "2020-04-21T07:02:38Z", "author": {"login": "ruwanta"}, "path": "distribution/kernel/carbon-home/repository/resources/conf/templates/repository/conf/tomcat/catalina-server.xml.j2", "diffHunk": "@@ -66,7 +66,13 @@\n                 <Valve className=\"org.wso2.carbon.tomcat.ext.valves.RequestCorrelationIdValve\"\n                        headerToCorrelationIdMapping=\"{'activityid':'Correlation-ID'}\" queryToCorrelationIdMapping=\"{'RelayState':'Correlation-ID'}\"/>\n                 <Valve className=\"org.wso2.carbon.tomcat.ext.valves.CarbonContextCreatorValve\"/>\n+                {% if http_access_log.useLogger is sameas true %}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg5MTkzOQ=="}, "originalCommit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1OTM4NDY0OnYy", "diffSide": "LEFT", "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/RequestCorrelationIdValve.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNzowNjo1MFrOGI1--Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwODo0Mzo0OFrOGI6CrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyNjI2NQ==", "bodyText": "Basically with the change of this line, there is no behaviour change. It's the same thing you have done which was done in associateToThread private method. Either you can keep this as it was or remove the private method associateToThread which is no longer used :)", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411926265", "createdAt": "2020-04-21T07:06:50Z", "author": {"login": "hasinthaindrajee"}, "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/RequestCorrelationIdValve.java", "diffHunk": "@@ -104,11 +106,16 @@ public void invoke(Request request, Response response) throws IOException, Servl\n             }\n \n             if (associateToThreadMap.size() == 0) {\n-                associateToThread(UUID.randomUUID().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91260661474c44837e8c1f93e8edd71b45e21416"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkzMzMxNQ==", "bodyText": "Also we can eliminate two if blocks with same condition  if (associateToThreadMap.size() == 0) {", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411933315", "createdAt": "2020-04-21T07:18:30Z", "author": {"login": "hasinthaindrajee"}, "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/RequestCorrelationIdValve.java", "diffHunk": "@@ -104,11 +106,16 @@ public void invoke(Request request, Response response) throws IOException, Servl\n             }\n \n             if (associateToThreadMap.size() == 0) {\n-                associateToThread(UUID.randomUUID().toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyNjI2NQ=="}, "originalCommit": {"oid": "91260661474c44837e8c1f93e8edd71b45e21416"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkzNTg0MA==", "bodyText": "+1", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411935840", "createdAt": "2020-04-21T07:22:27Z", "author": {"login": "ruwanta"}, "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/RequestCorrelationIdValve.java", "diffHunk": "@@ -104,11 +106,16 @@ public void invoke(Request request, Response response) throws IOException, Servl\n             }\n \n             if (associateToThreadMap.size() == 0) {\n-                associateToThread(UUID.randomUUID().toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyNjI2NQ=="}, "originalCommit": {"oid": "91260661474c44837e8c1f93e8edd71b45e21416"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkzODQ4Mg==", "bodyText": "Even there are two blocks Also we can element two if blocks with same condition if (associateToThreadMap.size() == 0) {\nthey evaluate to different result at different times.\nFirst one tries to read correlation ID from query params, if headers does not contain one.\nSecond one is the fall back when it does not find correlation ID from previous step.\nThat logic is intentional.", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411938482", "createdAt": "2020-04-21T07:26:18Z", "author": {"login": "ruwanta"}, "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/RequestCorrelationIdValve.java", "diffHunk": "@@ -104,11 +106,16 @@ public void invoke(Request request, Response response) throws IOException, Servl\n             }\n \n             if (associateToThreadMap.size() == 0) {\n-                associateToThread(UUID.randomUUID().toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyNjI2NQ=="}, "originalCommit": {"oid": "91260661474c44837e8c1f93e8edd71b45e21416"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk5Mjc0OA==", "bodyText": "+1", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411992748", "createdAt": "2020-04-21T08:43:48Z", "author": {"login": "hasinthaindrajee"}, "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/RequestCorrelationIdValve.java", "diffHunk": "@@ -104,11 +106,16 @@ public void invoke(Request request, Response response) throws IOException, Servl\n             }\n \n             if (associateToThreadMap.size() == 0) {\n-                associateToThread(UUID.randomUUID().toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyNjI2NQ=="}, "originalCommit": {"oid": "91260661474c44837e8c1f93e8edd71b45e21416"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2211, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}