{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MjUzMzMw", "number": 2791, "title": "Make groupDN OU qualified", "bodyText": "Resolves wso2/product-is#9156\nDescription\nAfter the fix introduced with [1], the below error is observed in the wso2carbon log file, when assigning a role to a user.\nTID: [-1234] [] [2020-08-07 15:02:34,235] DEBUG {org.wso2.carbon.user.core.ldap.ReadWriteLDAPUserStoreManager} -  Modifying role: cn=aaauserrole1 with type: 1 user: CN=abcsub1,CN=Users,DC=wso2,DC=test in search base: DC=wso2,DC=testTID: [-1234] [] [2020-08-07 15:02:35,667] DEBUG {org.wso2.carbon.user.core.ldap.ReadWriteLDAPUserStoreManager} -  Error occurred while modifying user entry: CN=abcsub1,CN=Users,DC=wso2,DC=test in LDAP role: cn=aaauserrole1 javax.naming.NameNotFoundException: [LDAP: error code 32 - 0000208D: NameErr: DSID-03100238, problem 2001 (NO_OBJECT), data 0, best match of:\t'DC=wso2,DC=test']; remaining name 'cn=aaauserrole1'\n\tat com.sun.jndi.ldap.LdapCtx.mapErrorCode(LdapCtx.java:3179)\n\tat com.sun.jndi.ldap.LdapCtx.processReturnCode(LdapCtx.java:3100)\n\tat com.sun.jndi.ldap.LdapCtx.processReturnCode(LdapCtx.java:2891)\n\tat com.sun.jndi.ldap.LdapCtx.c_modifyAttributes(LdapCtx.java:1408)\n\tat com.sun.jndi.toolkit.ctx.ComponentDirContext.p_modifyAttributes(ComponentDirContext.java:257)\n\tat com.sun.jndi.toolkit.ctx.PartialCompositeDirContext.modifyAttributes(PartialCompositeDirContext.java:167)\n\tat com.sun.jndi.toolkit.ctx.PartialCompositeDirContext.modifyAttributes(PartialCompositeDirContext.java:156)\n\tat org.wso2.carbon.user.core.ldap.ReadWriteLDAPUserStoreManager.modifyUserInRole(ReadWriteLDAPUserStoreManager.java:1755)\n\tat org.wso2.carbon.user.core.ldap.ReadWriteLDAPUserStoreManager.doUpdateRoleListOfUser(ReadWriteLDAPUserStoreManager.java:1552)\n\tat org.wso2.carbon.user.core.common.AbstractUserStoreManager.updateRoleListOfUserInternal(AbstractUserStoreManager.java:3561)\n\nThe reason for this is with [1], groupDN is not getting OU qualified. We can overcome this by making the groupDN OU qualified with the fix introduced in this PR.\n[1] https://github.com/wso2/carbon-kernel/pull/2738/files#diff-dd3eb39f6e29d8c53955192cc66f8cbdR1524", "createdAt": "2020-10-06T04:24:03Z", "url": "https://github.com/wso2/carbon-kernel/pull/2791", "merged": true, "mergeCommit": {"oid": "bf35a50e10457a6f71be032b95a5369563c80446"}, "closed": true, "closedAt": "2020-10-07T01:55:52Z", "author": {"login": "sachiniWettasinghe"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPwk4zAH2gAyNDk4MjUzMzMwOjlhMzZhMmYzYTM4YmUzMDZiZjc2M2U3NzQyYzliZDEzYjY2MmM3NTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP5M9zgFqTUwMzAyMjU4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a36a2f3a38be306bf763e7742c9bd13b662c750", "author": {"user": {"login": "sachiniWettasinghe", "name": "Sachini"}}, "url": "https://github.com/wso2/carbon-kernel/commit/9a36a2f3a38be306bf763e7742c9bd13b662c750", "committedDate": "2020-10-06T04:21:50Z", "message": "Make groupDN OU qualified"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyODE4MzMx", "url": "https://github.com/wso2/carbon-kernel/pull/2791#pullrequestreview-502818331", "createdAt": "2020-10-06T10:57:59Z", "commit": {"oid": "9a36a2f3a38be306bf763e7742c9bd13b662c750"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDo1ODowMFrOHdA20A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDo1ODowMFrOHdA20A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE4NDc4NA==", "bodyText": "Are we using the returning MEMBERSHIP_ATTRIBUTE attribute? If not, why do we request it?", "url": "https://github.com/wso2/carbon-kernel/pull/2791#discussion_r500184784", "createdAt": "2020-10-06T10:58:00Z", "author": {"login": "IsuraD"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ReadWriteLDAPUserStoreManager.java", "diffHunk": "@@ -1458,6 +1458,41 @@ public void doUpdateRoleListOfUser(String userName, String[] deletedRoles, Strin\n         }\n     }\n \n+    /**\n+     * Resolves groupDN which is used in doUpdateRoleListOfUser method to modify the roles of the user.\n+     *\n+     * @param searchFilter Search filter.\n+     * @param role         Role to be assigned to a user.\n+     * @param context      LDAPRoleContext.\n+     * @return String groupDN.\n+     * @throws UserStoreException Error in resolving groupDN.\n+     */\n+    private String resolveGroupDN(String searchFilter, String role, LDAPRoleContext context) throws UserStoreException {\n+\n+        String roleSearchFilter = searchFilter.replace(\"?\", escapeSpecialCharactersForFilter(role));\n+        String membershipAttribute = realmConfig.getUserStoreProperty(LDAPConstants.MEMBERSHIP_ATTRIBUTE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a36a2f3a38be306bf763e7742c9bd13b662c750"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dedca0f31a6b1d54e45cc15d78aeec9a394d6116", "author": {"user": {"login": "sachiniWettasinghe", "name": "Sachini"}}, "url": "https://github.com/wso2/carbon-kernel/commit/dedca0f31a6b1d54e45cc15d78aeec9a394d6116", "committedDate": "2020-10-06T14:21:06Z", "message": "Address PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMDIyNTg4", "url": "https://github.com/wso2/carbon-kernel/pull/2791#pullrequestreview-503022588", "createdAt": "2020-10-06T14:24:51Z", "commit": {"oid": "dedca0f31a6b1d54e45cc15d78aeec9a394d6116"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2022, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}