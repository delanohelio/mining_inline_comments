{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0OTUxMTg2", "number": 2661, "title": "Allow HTTP accesslog to be configured with Log4J", "bodyText": "Purpose\nAddress #2660\nUser stories\nThis will allow HTTP access log to be written to sys-out or using any remote publisher supported by Log4J system.\nHelps to use the HTTP Access Log in container native way. and eliminate the use of shared volume to write log file.\nRelease note\nAvailable in next kernel release\nDocumentation\nReplace \" <Valve className=\"org.apache.catalina.valves.AccessLogValve\" \"section in \"catalina-server.xml.j2\" with following. This will allow the previous logger to be the default, while allowing someone to use the new logger via the config.\n                {% if http_access_log.useLogger is sameas true %}\n                <Valve className=\"org.wso2.carbon.tomcat.ext.valves.ConfigurableLoggerAccessLogValve\"\n                    pattern=\"{{http_access_log.pattern}}\"/>\n                {% else %}\n                <Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"${carbon.home}/repository/logs\"\n                    prefix=\"http_access_\" suffix=\".log\" pattern=\"{{http_access_log.pattern}}\"/>\n                {% endif %}\n\nAdd following to \"deployment.toml\"\n[http_access_log]\nuseLogger = true", "createdAt": "2020-04-17T06:40:39Z", "url": "https://github.com/wso2/carbon-kernel/pull/2661", "merged": true, "mergeCommit": {"oid": "519b47876bd9a345fb795be8d7fe36126ee3541e"}, "closed": true, "closedAt": "2020-04-21T10:40:19Z", "author": {"login": "ruwanta"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYbUUtAH2gAyNDA0OTUxMTg2OjZmZDBhMjU2N2E3NjY3MDBkODM4NGJkOTk0NDM0N2QyNTcwMjdiZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZxIMMgFqTM5NzE5ODUzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8", "author": {"user": {"login": "ruwanta", "name": "Ruwan Abeykoon"}}, "url": "https://github.com/wso2/carbon-kernel/commit/6fd0a2567a766700d8384bd9944347d257027bf8", "committedDate": "2020-04-17T06:29:54Z", "message": "Allow HTTP accesslog to be configured with Log4J\nhttps://github.com/wso2/carbon-kernel/issues/2660"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MDA2Mzgx", "url": "https://github.com/wso2/carbon-kernel/pull/2661#pullrequestreview-397006381", "createdAt": "2020-04-21T05:54:36Z", "commit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTo1NDozN1rOGIzw8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTo1NDozN1rOGIzw8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg4OTkwNw==", "bodyText": "Let's add Licence ..", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411889907", "createdAt": "2020-04-21T05:54:37Z", "author": {"login": "hasinthaindrajee"}, "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/ConfigurableLoggerAccessLogValve.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package org.wso2.carbon.tomcat.ext.valves;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MDA3OTcx", "url": "https://github.com/wso2/carbon-kernel/pull/2661#pullrequestreview-397007971", "createdAt": "2020-04-21T05:58:19Z", "commit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MDA4MzU1", "url": "https://github.com/wso2/carbon-kernel/pull/2661#pullrequestreview-397008355", "createdAt": "2020-04-21T05:59:18Z", "commit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTo1OToxOFrOGIz44w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTo1OToxOFrOGIz44w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg5MTkzOQ==", "bodyText": "would it be better if we add this to default.json? WDYT @pulasthi7", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411891939", "createdAt": "2020-04-21T05:59:18Z", "author": {"login": "Buddhimah"}, "path": "distribution/kernel/carbon-home/repository/resources/conf/templates/repository/conf/tomcat/catalina-server.xml.j2", "diffHunk": "@@ -66,7 +66,13 @@\n                 <Valve className=\"org.wso2.carbon.tomcat.ext.valves.RequestCorrelationIdValve\"\n                        headerToCorrelationIdMapping=\"{'activityid':'Correlation-ID'}\" queryToCorrelationIdMapping=\"{'RelayState':'Correlation-ID'}\"/>\n                 <Valve className=\"org.wso2.carbon.tomcat.ext.valves.CarbonContextCreatorValve\"/>\n+                {% if http_access_log.useLogger is sameas true %}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fd0a2567a766700d8384bd9944347d257027bf8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91260661474c44837e8c1f93e8edd71b45e21416", "author": {"user": {"login": "ruwanta", "name": "Ruwan Abeykoon"}}, "url": "https://github.com/wso2/carbon-kernel/commit/91260661474c44837e8c1f93e8edd71b45e21416", "committedDate": "2020-04-21T07:00:01Z", "message": "Added copyright"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MDQzMzkx", "url": "https://github.com/wso2/carbon-kernel/pull/2661#pullrequestreview-397043391", "createdAt": "2020-04-21T07:06:50Z", "commit": {"oid": "91260661474c44837e8c1f93e8edd71b45e21416"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNzowNjo1MFrOGI1--Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNzowNjo1MFrOGI1--Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyNjI2NQ==", "bodyText": "Basically with the change of this line, there is no behaviour change. It's the same thing you have done which was done in associateToThread private method. Either you can keep this as it was or remove the private method associateToThread which is no longer used :)", "url": "https://github.com/wso2/carbon-kernel/pull/2661#discussion_r411926265", "createdAt": "2020-04-21T07:06:50Z", "author": {"login": "hasinthaindrajee"}, "path": "core/org.wso2.carbon.tomcat.ext/src/main/java/org/wso2/carbon/tomcat/ext/valves/RequestCorrelationIdValve.java", "diffHunk": "@@ -104,11 +106,16 @@ public void invoke(Request request, Response response) throws IOException, Servl\n             }\n \n             if (associateToThreadMap.size() == 0) {\n-                associateToThread(UUID.randomUUID().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91260661474c44837e8c1f93e8edd71b45e21416"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c4fe1f0f97b6ce4d2d42bd96a26f6266d4da604", "author": {"user": {"login": "ruwanta", "name": "Ruwan Abeykoon"}}, "url": "https://github.com/wso2/carbon-kernel/commit/5c4fe1f0f97b6ce4d2d42bd96a26f6266d4da604", "committedDate": "2020-04-21T07:21:25Z", "message": "Removed unused private method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MTk4NTMw", "url": "https://github.com/wso2/carbon-kernel/pull/2661#pullrequestreview-397198530", "createdAt": "2020-04-21T10:28:29Z", "commit": {"oid": "5c4fe1f0f97b6ce4d2d42bd96a26f6266d4da604"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2104, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}