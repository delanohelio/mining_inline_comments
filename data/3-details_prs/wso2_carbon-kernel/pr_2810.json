{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NTEyMTA4", "number": 2810, "title": " Fix the issue of reaching the system to an inconsistent state", "bodyText": "Description\nFix the issue of reaching the system to an inconsistent state when SQL Exception occurs during SCIM User Delete Operation.\nResolves: wso2/product-is#9507\nApproach\nInvoked connection rollback during error flows.", "createdAt": "2020-10-16T03:03:13Z", "url": "https://github.com/wso2/carbon-kernel/pull/2810", "merged": true, "mergeCommit": {"oid": "3740b55a5b37b4cbbc328f91f807e3a50043c8b8"}, "closed": true, "closedAt": "2020-10-19T04:17:28Z", "author": {"login": "GANGANI"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdS9XYOgH2gAyNTA0NTEyMTA4OjVjM2VhNDg1MTI0YTUwYThjMTJkMWE5MzIyOTQ4OWQ4YjFjYzIzNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdT8Id-gFqTUxMTM5ODY4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5c3ea485124a50a8c12d1a93229489d8b1cc2378", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-kernel/commit/5c3ea485124a50a8c12d1a93229489d8b1cc2378", "committedDate": "2020-10-16T02:57:37Z", "message": " Fix the issue of reaching the system to an inconsistent state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMjk0NDk5", "url": "https://github.com/wso2/carbon-kernel/pull/2810#pullrequestreview-510294499", "createdAt": "2020-10-16T09:15:45Z", "commit": {"oid": "5c3ea485124a50a8c12d1a93229489d8b1cc2378"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOToxNTo0NVrOHiwdlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOToxNjo1OFrOHiwhTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIwNzYzNg==", "bodyText": "Can we add a comment here stating the reason for both logging and throwing the exception?", "url": "https://github.com/wso2/carbon-kernel/pull/2810#discussion_r506207636", "createdAt": "2020-10-16T09:15:45Z", "author": {"login": "mevan-karu"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/jdbc/JDBCUserStoreManager.java", "diffHunk": "@@ -1840,10 +1843,9 @@ public void doDeleteUser(String userName) throws UserStoreException {\n             }\n             dbConnection.commit();\n         } catch (SQLException e) {\n+            DatabaseUtil.rollBack(dbConnection);\n             String msg = \"Error occurred while deleting user : \" + userName;\n-            if (log.isDebugEnabled()) {\n-                log.debug(msg, e);\n-            }\n+            log.error(msg, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c3ea485124a50a8c12d1a93229489d8b1cc2378"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIwODU5MQ==", "bodyText": "In here also, put a comment stating the reason.", "url": "https://github.com/wso2/carbon-kernel/pull/2810#discussion_r506208591", "createdAt": "2020-10-16T09:16:58Z", "author": {"login": "mevan-karu"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/jdbc/JDBCUserStoreManager.java", "diffHunk": "@@ -2568,10 +2576,9 @@ private void updateStringValuesToDatabase(Connection dbConnection, String sqlStm\n                 dbConnection.commit();\n             }\n         } catch (SQLException e) {\n+            DatabaseUtil.rollBack(dbConnection);\n             String msg = \"Error occurred while updating string values to database.\";\n-            if (log.isDebugEnabled()) {\n-                log.debug(msg, e);\n-            }\n+            log.error(msg, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c3ea485124a50a8c12d1a93229489d8b1cc2378"}, "originalPosition": 94}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66bfa2016cccc221cb3ad7fbcd1a354bd6ab6cb2", "author": {"user": {"login": "GANGANI", "name": "Gangani Chamika"}}, "url": "https://github.com/wso2/carbon-kernel/commit/66bfa2016cccc221cb3ad7fbcd1a354bd6ab6cb2", "committedDate": "2020-10-19T03:10:20Z", "message": "Add comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMzk4Njgx", "url": "https://github.com/wso2/carbon-kernel/pull/2810#pullrequestreview-511398681", "createdAt": "2020-10-19T04:05:21Z", "commit": {"oid": "66bfa2016cccc221cb3ad7fbcd1a354bd6ab6cb2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2029, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}