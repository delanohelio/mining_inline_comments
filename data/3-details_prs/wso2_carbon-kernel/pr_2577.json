{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMTI1Njkx", "number": 2577, "title": "Handle exceptions during scheduled cache cleanup", "bodyText": "Fix wso2/product-is#7400\nApproach\nCatch IllegalStateException and Throwable inside the loop itself and log an error with the name of the specific cache that got failed. Therefore the CacheCleanupTask will continue with the remaining caches in the list.", "createdAt": "2020-02-03T05:19:45Z", "url": "https://github.com/wso2/carbon-kernel/pull/2577", "merged": true, "mergeCommit": {"oid": "476a3b5a3fad8f337438bd9c982e375757d5c9f5"}, "closed": true, "closedAt": "2020-02-03T07:19:53Z", "author": {"login": "pamodaaw"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAnZInAFqTM1MjA0OTQ4OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAnrZjgFqTM1MjA1NTU3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDQ5NDg5", "url": "https://github.com/wso2/carbon-kernel/pull/2577#pullrequestreview-352049489", "createdAt": "2020-02-03T06:59:49Z", "commit": {"oid": "d8b3e9182a4bd3cfea22136920737337ddc1be65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNjo1OTo0OVrOFkn0Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNjo1OTo0OVrOFkn0Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk0NTQyMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    log.debug(\"Cache expiry completed for cache \" + cache.getName());\n          \n          \n            \n                                    log.debug(\"Cache expiry completed for cache : \" + cache.getName());\n          \n      \n    \n    \n  \n\nTo improve readability? kindly check other places as well...", "url": "https://github.com/wso2/carbon-kernel/pull/2577#discussion_r373945423", "createdAt": "2020-02-03T06:59:49Z", "author": {"login": "tharindu-bandara"}, "path": "core/javax.cache/src/main/java/org/wso2/carbon/caching/impl/CacheCleanupTask.java", "diffHunk": "@@ -58,15 +58,19 @@ public synchronized void run() {\n             cc.setTenantId(MultitenantConstants.SUPER_TENANT_ID);\n             cc.setTenantDomain(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n             for (CacheImpl cache : caches) {\n-                cache.runCacheExpiry();\n-                if (log.isDebugEnabled()) {\n-                    log.debug(\"Cache expiry completed for cache \" + cache.getName());\n+                try {\n+                    cache.runCacheExpiry();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Cache expiry completed for cache \" + cache.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8b3e9182a4bd3cfea22136920737337ddc1be65"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b61055971351cae8cae91e39e1572da3d169068f", "author": {"user": {"login": "pamodaaw", "name": "Pamoda Wimalasiri"}}, "url": "https://github.com/wso2/carbon-kernel/commit/b61055971351cae8cae91e39e1572da3d169068f", "committedDate": "2020-02-03T07:02:44Z", "message": "Handle exceptions during scheduled cache cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDUwMzY5", "url": "https://github.com/wso2/carbon-kernel/pull/2577#pullrequestreview-352050369", "createdAt": "2020-02-03T07:02:47Z", "commit": {"oid": "d8b3e9182a4bd3cfea22136920737337ddc1be65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNzowMjo0N1rOFkn27g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNzowMjo0N1rOFkn27g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk0NjA5NA==", "bodyText": "Since we are consuming the exception, shall we add an error log? We can skip adding the exception in the error log, but in the debug log as this code does.", "url": "https://github.com/wso2/carbon-kernel/pull/2577#discussion_r373946094", "createdAt": "2020-02-03T07:02:47Z", "author": {"login": "tharindu-bandara"}, "path": "core/javax.cache/src/main/java/org/wso2/carbon/caching/impl/CacheCleanupTask.java", "diffHunk": "@@ -58,15 +58,19 @@ public synchronized void run() {\n             cc.setTenantId(MultitenantConstants.SUPER_TENANT_ID);\n             cc.setTenantDomain(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n             for (CacheImpl cache : caches) {\n-                cache.runCacheExpiry();\n-                if (log.isDebugEnabled()) {\n-                    log.debug(\"Cache expiry completed for cache \" + cache.getName());\n+                try {\n+                    cache.runCacheExpiry();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Cache expiry completed for cache \" + cache.getName());\n+                    }\n+                } catch (IllegalStateException e) {\n+                    if (log.isDebugEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8b3e9182a4bd3cfea22136920737337ddc1be65"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDUxMDEz", "url": "https://github.com/wso2/carbon-kernel/pull/2577#pullrequestreview-352051013", "createdAt": "2020-02-03T07:05:04Z", "commit": {"oid": "d8b3e9182a4bd3cfea22136920737337ddc1be65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNzowNTowNFrOFkn40A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNzowNTowNFrOFkn40A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk0NjU3Ng==", "bodyText": "We can omit this catch block and just catch the throwable?", "url": "https://github.com/wso2/carbon-kernel/pull/2577#discussion_r373946576", "createdAt": "2020-02-03T07:05:04Z", "author": {"login": "tharindu-bandara"}, "path": "core/javax.cache/src/main/java/org/wso2/carbon/caching/impl/CacheCleanupTask.java", "diffHunk": "@@ -58,15 +58,19 @@ public synchronized void run() {\n             cc.setTenantId(MultitenantConstants.SUPER_TENANT_ID);\n             cc.setTenantDomain(MultitenantConstants.SUPER_TENANT_DOMAIN_NAME);\n             for (CacheImpl cache : caches) {\n-                cache.runCacheExpiry();\n-                if (log.isDebugEnabled()) {\n-                    log.debug(\"Cache expiry completed for cache \" + cache.getName());\n+                try {\n+                    cache.runCacheExpiry();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Cache expiry completed for cache \" + cache.getName());\n+                    }\n+                } catch (IllegalStateException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8b3e9182a4bd3cfea22136920737337ddc1be65"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d8b3e9182a4bd3cfea22136920737337ddc1be65", "author": {"user": {"login": "pamodaaw", "name": "Pamoda Wimalasiri"}}, "url": "https://github.com/wso2/carbon-kernel/commit/d8b3e9182a4bd3cfea22136920737337ddc1be65", "committedDate": "2020-02-03T05:16:52Z", "message": "Handle exceptions during scheduled cache cleanup"}, "afterCommit": {"oid": "b61055971351cae8cae91e39e1572da3d169068f", "author": {"user": {"login": "pamodaaw", "name": "Pamoda Wimalasiri"}}, "url": "https://github.com/wso2/carbon-kernel/commit/b61055971351cae8cae91e39e1572da3d169068f", "committedDate": "2020-02-03T07:02:44Z", "message": "Handle exceptions during scheduled cache cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDU1NTcw", "url": "https://github.com/wso2/carbon-kernel/pull/2577#pullrequestreview-352055570", "createdAt": "2020-02-03T07:19:47Z", "commit": {"oid": "b61055971351cae8cae91e39e1572da3d169068f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2065, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}