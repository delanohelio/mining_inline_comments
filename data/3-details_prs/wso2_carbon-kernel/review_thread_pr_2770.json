{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3ODkzNjgy", "number": 2770, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwMzozMTozMVrOEkWAwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNjoyNzo1OVrOEkYpJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NTQ0ODMyOnYy", "diffSide": "RIGHT", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwMzozMTozMVrOHTPEYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwMzozMTozMVrOHTPEYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkzMTg3Mw==", "bodyText": "Why do we need to apply transactions for SELECT statements?", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489931873", "createdAt": "2020-09-17T03:31:31Z", "author": {"login": "ashensw"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -165,7 +167,7 @@ public void setDomainForUserId(String userId, String userDomain, int tenantId) t\n     private String getDomainFromDB(String userId, int tenantId) throws UserStoreException {\n \n         String domainName = null;\n-        try (Connection dbConnection = getDBConnection();\n+        try (Connection dbConnection = getDBConnection(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fe5a32c023739ddd3f0031b3a236f956212ec75"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NTQ2MTU5OnYy", "diffSide": "RIGHT", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwMzozNToxMlrOHTPM8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNDowNjoyNVrOHTQXOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkzNDA2NQ==", "bodyText": "We need to handle the rollback as well.", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489934065", "createdAt": "2020-09-17T03:35:12Z", "author": {"login": "ashensw"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -209,6 +212,7 @@ private void persistDomainAgainstUserId(String userId, String userDomain, int te\n                     preparedStatement.setInt(3, tenantId);\n                     preparedStatement.setInt(4, tenantId);\n                     preparedStatement.execute();\n+                    commitTransaction(dbConnection);\n                 }\n             }\n         } catch (SQLException ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fe5a32c023739ddd3f0031b3a236f956212ec75"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkzNzQzMQ==", "bodyText": "Rollback handled https://github.com/wso2/carbon-kernel/pull/2770/files#diff-64f4ebd98c48b6db56341e6f89eb219dR253 in here", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489937431", "createdAt": "2020-09-17T03:41:10Z", "author": {"login": "Buddhimah"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -209,6 +212,7 @@ private void persistDomainAgainstUserId(String userId, String userDomain, int te\n                     preparedStatement.setInt(3, tenantId);\n                     preparedStatement.setInt(4, tenantId);\n                     preparedStatement.execute();\n+                    commitTransaction(dbConnection);\n                 }\n             }\n         } catch (SQLException ex) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkzNDA2NQ=="}, "originalCommit": {"oid": "1fe5a32c023739ddd3f0031b3a236f956212ec75"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkzODg5NQ==", "bodyText": "But there can be SQLExceptions before comes to the commitTransaction..", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489938895", "createdAt": "2020-09-17T03:43:28Z", "author": {"login": "ashensw"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -209,6 +212,7 @@ private void persistDomainAgainstUserId(String userId, String userDomain, int te\n                     preparedStatement.setInt(3, tenantId);\n                     preparedStatement.setInt(4, tenantId);\n                     preparedStatement.execute();\n+                    commitTransaction(dbConnection);\n                 }\n             }\n         } catch (SQLException ex) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkzNDA2NQ=="}, "originalCommit": {"oid": "1fe5a32c023739ddd3f0031b3a236f956212ec75"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk1MzA4MA==", "bodyText": "done", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489953080", "createdAt": "2020-09-17T04:06:25Z", "author": {"login": "Buddhimah"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -209,6 +212,7 @@ private void persistDomainAgainstUserId(String userId, String userDomain, int te\n                     preparedStatement.setInt(3, tenantId);\n                     preparedStatement.setInt(4, tenantId);\n                     preparedStatement.execute();\n+                    commitTransaction(dbConnection);\n                 }\n             }\n         } catch (SQLException ex) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkzNDA2NQ=="}, "originalCommit": {"oid": "1fe5a32c023739ddd3f0031b3a236f956212ec75"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NTc1MjY0OnYy", "diffSide": "RIGHT", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNTozNDo0N1rOHTSErg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNTo0MjowOFrOHTSNqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk4MTEwMg==", "bodyText": "Should check whether autocommit is false here", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489981102", "createdAt": "2020-09-17T05:34:47Z", "author": {"login": "omindu"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            rollbackTransaction(dbConnection);\n+            log.error(\"An error occurred while commit transactions. \", e);\n+        }\n+    }\n+\n+    /**\n+     * Revoke the transaction when catch then sql transaction errors.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void rollbackTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06425238d57a94735f8229806a622dce96b1dace"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk4MzQwMQ==", "bodyText": "done", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489983401", "createdAt": "2020-09-17T05:42:08Z", "author": {"login": "Buddhimah"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            rollbackTransaction(dbConnection);\n+            log.error(\"An error occurred while commit transactions. \", e);\n+        }\n+    }\n+\n+    /**\n+     * Revoke the transaction when catch then sql transaction errors.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void rollbackTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk4MTEwMg=="}, "originalCommit": {"oid": "06425238d57a94735f8229806a622dce96b1dace"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NTc1NTkyOnYy", "diffSide": "RIGHT", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNTozNjoxOFrOHTSGiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNTo0NDo0NFrOHTSQcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk4MTU3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        rollbackTransaction(dbConnection);\n          \n          \n            \n                        log.error(\"An error occurred while commit transactions. \", e);\n          \n          \n            \n                        log.error(\"An error occurred while commit transactions.\", e);\n          \n          \n            \n                        rollbackTransaction(dbConnection);", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489981577", "createdAt": "2020-09-17T05:36:18Z", "author": {"login": "omindu"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            rollbackTransaction(dbConnection);\n+            log.error(\"An error occurred while commit transactions. \", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06425238d57a94735f8229806a622dce96b1dace"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk4NDExNQ==", "bodyText": "done", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489984115", "createdAt": "2020-09-17T05:44:44Z", "author": {"login": "Buddhimah"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            rollbackTransaction(dbConnection);\n+            log.error(\"An error occurred while commit transactions. \", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk4MTU3Nw=="}, "originalCommit": {"oid": "06425238d57a94735f8229806a622dce96b1dace"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NTg3MjMzOnYy", "diffSide": "RIGHT", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNjoyNTo0NVrOHTTKMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNjo0MjozN1rOHTTmWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk5ODg5Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.error(\"An error occurred while commit transactions. \", e);\n          \n          \n            \n                        log.error(\"An error occurred while transaction commit.\", e);", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489998897", "createdAt": "2020-09-17T06:25:45Z", "author": {"login": "omindu"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            log.error(\"An error occurred while commit transactions. \", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c564e6b50720f3652cd8ea4ab843b99385b8d8"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAwNjEwNg==", "bodyText": "done", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r490006106", "createdAt": "2020-09-17T06:42:37Z", "author": {"login": "Buddhimah"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            log.error(\"An error occurred while commit transactions. \", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk5ODg5Nw=="}, "originalCommit": {"oid": "70c564e6b50720f3652cd8ea4ab843b99385b8d8"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NTg3NjQyOnYy", "diffSide": "RIGHT", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNjoyNzowOFrOHTTMgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNjo0Mjo0MlrOHTTmew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk5OTQ5MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Revoke the transaction when catch then sql transaction errors.\n          \n          \n            \n                 * Rollback a transaction.", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489999490", "createdAt": "2020-09-17T06:27:08Z", "author": {"login": "omindu"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            log.error(\"An error occurred while commit transactions. \", e);\n+            rollbackTransaction(dbConnection);\n+        }\n+    }\n+\n+    /**\n+     * Revoke the transaction when catch then sql transaction errors.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c564e6b50720f3652cd8ea4ab843b99385b8d8"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAwNjEzOQ==", "bodyText": "done", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r490006139", "createdAt": "2020-09-17T06:42:42Z", "author": {"login": "Buddhimah"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            log.error(\"An error occurred while commit transactions. \", e);\n+            rollbackTransaction(dbConnection);\n+        }\n+    }\n+\n+    /**\n+     * Revoke the transaction when catch then sql transaction errors.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk5OTQ5MA=="}, "originalCommit": {"oid": "70c564e6b50720f3652cd8ea4ab843b99385b8d8"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NTg3ODY5OnYy", "diffSide": "RIGHT", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNjoyNzo0NlrOHTTNyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNjo0Mjo0N1rOHTTmnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk5OTgxOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.error(\"An error occurred while rolling back transactions.\", e);\n          \n          \n            \n                        log.error(\"An error occurred while transaction rollback.\", e);", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489999819", "createdAt": "2020-09-17T06:27:46Z", "author": {"login": "omindu"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            log.error(\"An error occurred while commit transactions. \", e);\n+            rollbackTransaction(dbConnection);\n+        }\n+    }\n+\n+    /**\n+     * Revoke the transaction when catch then sql transaction errors.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void rollbackTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.rollback();\n+            }\n+        } catch (SQLException e) {\n+            log.error(\"An error occurred while rolling back transactions.\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c564e6b50720f3652cd8ea4ab843b99385b8d8"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAwNjE3Mg==", "bodyText": "done", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r490006172", "createdAt": "2020-09-17T06:42:47Z", "author": {"login": "Buddhimah"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void commitTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.commit();\n+            }\n+        } catch (SQLException e) {\n+            log.error(\"An error occurred while commit transactions. \", e);\n+            rollbackTransaction(dbConnection);\n+        }\n+    }\n+\n+    /**\n+     * Revoke the transaction when catch then sql transaction errors.\n+     *\n+     * @param dbConnection database connection.\n+     */\n+    private void rollbackTransaction(Connection dbConnection) {\n+\n+        try {\n+            if (dbConnection != null && !dbConnection.getAutoCommit()) {\n+                dbConnection.rollback();\n+            }\n+        } catch (SQLException e) {\n+            log.error(\"An error occurred while rolling back transactions.\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk5OTgxOQ=="}, "originalCommit": {"oid": "70c564e6b50720f3652cd8ea4ab843b99385b8d8"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NTg3OTQxOnYy", "diffSide": "RIGHT", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNjoyNzo1OVrOHTTOMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNjo0Mjo1MlrOHTTmuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk5OTkyMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Commit the transaction.\n          \n          \n            \n                 * Commit a transaction.", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r489999921", "createdAt": "2020-09-17T06:27:59Z", "author": {"login": "omindu"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c564e6b50720f3652cd8ea4ab843b99385b8d8"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAwNjIwMA==", "bodyText": "done", "url": "https://github.com/wso2/carbon-kernel/pull/2770#discussion_r490006200", "createdAt": "2020-09-17T06:42:52Z", "author": {"login": "Buddhimah"}, "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/UserUniqueIDDomainResolver.java", "diffHunk": "@@ -233,4 +240,37 @@ private Connection getDBConnection() throws SQLException, UserStoreException {\n         }\n         return dataSource.getConnection();\n     }\n+\n+    /**\n+     * Commit the transaction.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk5OTkyMQ=="}, "originalCommit": {"oid": "70c564e6b50720f3652cd8ea4ab843b99385b8d8"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2156, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}