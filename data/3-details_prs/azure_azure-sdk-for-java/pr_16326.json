{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNzE5MTAw", "number": 16326, "title": "Multiple fixes", "bodyText": "This PR fixes the following issues\n\nSinglepartition queries going to gateway instead of direct path in directMode. Fixes #16065\nreadMany not working in gateway Mode. Fixes #15833\nQueryMetrics failing to parse request charge in a non US locale. Fixes #9136", "createdAt": "2020-10-15T00:00:37Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326", "merged": true, "mergeCommit": {"oid": "fb85cabda52816cc8dafffebb57cffedeaab15ce"}, "closed": true, "closedAt": "2020-10-16T08:09:18Z", "author": {"login": "mbhaskar"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSlvqOgH2gAyNTAzNzE5MTAwOjNiODVlMmU1N2JlODFjNDE3OTFiYjFhNmU0YTM2MThjZjVjYjFkOGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS4L1egH2gAyNTAzNzE5MTAwOmE0MGFhMDcxZjdiYmZiMDEzODhmNWViZDRkMjY4ZWM3ZmQ1ZjJjNjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b85e2e57be81c41791bb1a6e4a3618cf5cb1d8a", "author": {"user": {"login": "mbhaskar", "name": "Bhaskar Mallapragada"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3b85e2e57be81c41791bb1a6e4a3618cf5cb1d8a", "committedDate": "2020-10-14T23:26:25Z", "message": "This PR fixes multiple issues\n- Singlepartition queries going to gateway instead of directMode in directMode\n- readMany not working in gateway Mode\n- QueryMetricsUtils failing to parse request charge in a non US locale"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f8697576fe7e72c5a2f0222afc468f31db61e76", "author": {"user": {"login": "mbhaskar", "name": "Bhaskar Mallapragada"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5f8697576fe7e72c5a2f0222afc468f31db61e76", "committedDate": "2020-10-14T23:51:31Z", "message": "Refactor the fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69193dad82997ef9d3f2c7d01395968d07cc9ffb", "author": {"user": {"login": "mbhaskar", "name": "Bhaskar Mallapragada"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/69193dad82997ef9d3f2c7d01395968d07cc9ffb", "committedDate": "2020-10-14T23:57:56Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd", "author": {"user": {"login": "mbhaskar", "name": "Bhaskar Mallapragada"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5111ce5fc01fd1a9d448f6759d4cf27915da46cd", "committedDate": "2020-10-14T23:59:20Z", "message": "Cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODU1MTk2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#pullrequestreview-508855196", "createdAt": "2020-10-15T00:16:31Z", "commit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDoxNjozMVrOHhsZGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDoxNjozMVrOHhsZGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA5MjM3Nw==", "bodyText": "NIT line break after &&", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#discussion_r505092377", "createdAt": "2020-10-15T00:16:31Z", "author": {"login": "FabianMeiswinkel"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "diffHunk": "@@ -3566,7 +3567,8 @@ private RxStoreModel getStoreProxy(RxDocumentServiceRequest request) {\n         } else {\n             if ((request.getOperationType() == OperationType.Query || request.getOperationType() == OperationType.SqlQuery) &&\n                     Utils.isCollectionChild(request.getResourceType())) {\n-                if (request.getPartitionKeyRangeIdentity() == null) {\n+                // Go to gateway only if there is no partition key range or partition key set. This should be very rare\n+                if (request.getPartitionKeyRangeIdentity() == null && request.getHeaders().get(HttpConstants.HttpHeaders.PARTITION_KEY) == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODU3NTQ5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#pullrequestreview-508857549", "createdAt": "2020-10-15T00:24:01Z", "commit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDoyNDowMlrOHhshUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDoyNDowMlrOHhshUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA5NDQ4Mw==", "bodyText": "Just to double-check my understanding is correct - instead of changing the place where we were Parsing the Double you decided to normalize the locale here because for all other content where we parse floating point numbers the content is created by our backend and we own the locale/formatting, correct?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#discussion_r505094483", "createdAt": "2020-10-15T00:24:02Z", "author": {"login": "FabianMeiswinkel"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/query/DocumentProducer.java", "diffHunk": "@@ -65,7 +66,10 @@\n         void populatePartitionedQueryMetrics() {\n             String queryMetricsDelimitedString = pageResult.getResponseHeaders().get(HttpConstants.HttpHeaders.QUERY_METRICS);\n             if (!StringUtils.isEmpty(queryMetricsDelimitedString)) {\n-                queryMetricsDelimitedString += String.format(\";%s=%.2f\", QueryMetricsConstants.RequestCharge, pageResult.getRequestCharge());\n+                queryMetricsDelimitedString += String.format(Locale.ROOT,\n+                                                             \";%s=%.2f\",\n+                                                             QueryMetricsConstants.RequestCharge,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODU3OTMz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#pullrequestreview-508857933", "createdAt": "2020-10-15T00:25:12Z", "commit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTMzNDk1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#pullrequestreview-509533495", "createdAt": "2020-10-15T15:57:50Z", "commit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTY0NjEz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#pullrequestreview-509564613", "createdAt": "2020-10-15T16:32:22Z", "commit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NjQ0MTU5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#pullrequestreview-509644159", "createdAt": "2020-10-15T18:09:42Z", "commit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6f494bb66ef2ba0c3b70fc3f2e428caa3e8c963", "author": {"user": {"login": "mbhaskar", "name": "Bhaskar Mallapragada"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b6f494bb66ef2ba0c3b70fc3f2e428caa3e8c963", "committedDate": "2020-10-15T18:14:53Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a40aa071f7bbfb01388f5ebd4d268ec7fd5f2c65", "author": {"user": {"login": "mbhaskar", "name": "Bhaskar Mallapragada"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a40aa071f7bbfb01388f5ebd4d268ec7fd5f2c65", "committedDate": "2020-10-15T20:55:29Z", "message": "Fixing failing test. Since one of the test changes the locale, that might have caused the string format in ParallelDocumentQueryTest to use different locale and fail parsing."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2093, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}