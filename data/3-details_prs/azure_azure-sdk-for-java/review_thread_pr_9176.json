{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMTA2Mjg5", "number": 9176, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMjo0NDo0OFrODo6fAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMjo1OTo0NVrODo6sIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MjI3ODQzOnYy", "diffSide": "RIGHT", "path": "sdk/search/azure-search/src/main/java/com/azure/search/SearchApiKeyCredential.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMjo0NDo0OFrOF3wrxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMzoyMjo0MlrOF3xdDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxMzYzOA==", "bodyText": "Should this be made atomic to prevent race conditions if this credential is being shared? AtomicReference<String>?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9176#discussion_r394013638", "createdAt": "2020-03-17T22:44:48Z", "author": {"login": "alzimmermsft"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/SearchApiKeyCredential.java", "diffHunk": "@@ -11,7 +11,7 @@\n  * @see SearchServiceClientBuilder\n  */\n public final class SearchApiKeyCredential {\n-    private final String apiKey;\n+    private String apiKey;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0b68d9195fda5f7476922cc7c0deef27edd3f84"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxNzc1MQ==", "bodyText": "@schaabs @g2vinay Any convention on this?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9176#discussion_r394017751", "createdAt": "2020-03-17T22:56:44Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/SearchApiKeyCredential.java", "diffHunk": "@@ -11,7 +11,7 @@\n  * @see SearchServiceClientBuilder\n  */\n public final class SearchApiKeyCredential {\n-    private final String apiKey;\n+    private String apiKey;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxMzYzOA=="}, "originalCommit": {"oid": "e0b68d9195fda5f7476922cc7c0deef27edd3f84"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAyNjI1Mw==", "bodyText": "Talked offline. As the api-key is at instance level. Rotate the credential for clients is thread safe.\nWill leave as it is.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9176#discussion_r394026253", "createdAt": "2020-03-17T23:22:42Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/SearchApiKeyCredential.java", "diffHunk": "@@ -11,7 +11,7 @@\n  * @see SearchServiceClientBuilder\n  */\n public final class SearchApiKeyCredential {\n-    private final String apiKey;\n+    private String apiKey;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxMzYzOA=="}, "originalCommit": {"oid": "e0b68d9195fda5f7476922cc7c0deef27edd3f84"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MjI4NDA5OnYy", "diffSide": "RIGHT", "path": "sdk/search/azure-search/src/main/java/com/azure/search/SearchApiKeyCredential.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMjo0NzowOFrOF3wvLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMjo0NzowOFrOF3wvLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxNDUwOA==", "bodyText": "Credentials may be shared across clients, so this will affect all clients using this credential.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Rotates the credential on the same Search Client.\n          \n          \n            \n                 * Rotates the Search credential.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9176#discussion_r394014508", "createdAt": "2020-03-17T22:47:08Z", "author": {"login": "alzimmermsft"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/SearchApiKeyCredential.java", "diffHunk": "@@ -30,4 +30,15 @@ public SearchApiKeyCredential(String apiKey) {\n     public String getApiKey() {\n         return apiKey;\n     }\n+\n+    /**\n+     * Rotates the credential on the same Search Client.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0b68d9195fda5f7476922cc7c0deef27edd3f84"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MjI4NjY2OnYy", "diffSide": "RIGHT", "path": "sdk/search/azure-search/src/main/java/com/azure/search/SearchApiKeyPipelinePolicy.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMjo0ODozMlrOF3wwxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMjo1NToyMVrOF3w52A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxNDkxNg==", "bodyText": "Is this using the same exception message as credentials in AAD use? It would be nice to turn it into a proper sentence here and file an issue for the other locations.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9176#discussion_r394014916", "createdAt": "2020-03-17T22:48:32Z", "author": {"login": "alzimmermsft"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/SearchApiKeyPipelinePolicy.java", "diffHunk": "@@ -32,6 +32,9 @@ public SearchApiKeyPipelinePolicy(SearchApiKeyCredential apiKey) {\n \n     @Override\n     public Mono<HttpResponse> process(HttpPipelineCallContext context, HttpPipelineNextPolicy next) {\n+        if (\"http\".equals(context.getHttpRequest().getUrl().getProtocol())) {\n+            return Mono.error(new RuntimeException(\"token credentials require a URL using the HTTPS protocol scheme\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0b68d9195fda5f7476922cc7c0deef27edd3f84"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxNzI0MA==", "bodyText": "Thanks for catching this.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9176#discussion_r394017240", "createdAt": "2020-03-17T22:55:21Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/SearchApiKeyPipelinePolicy.java", "diffHunk": "@@ -32,6 +32,9 @@ public SearchApiKeyPipelinePolicy(SearchApiKeyCredential apiKey) {\n \n     @Override\n     public Mono<HttpResponse> process(HttpPipelineCallContext context, HttpPipelineNextPolicy next) {\n+        if (\"http\".equals(context.getHttpRequest().getUrl().getProtocol())) {\n+            return Mono.error(new RuntimeException(\"token credentials require a URL using the HTTPS protocol scheme\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxNDkxNg=="}, "originalCommit": {"oid": "e0b68d9195fda5f7476922cc7c0deef27edd3f84"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MjMxMjAzOnYy", "diffSide": "RIGHT", "path": "sdk/search/azure-search/src/main/java/com/azure/search/implementation/SearchApiKeyPipelinePolicy.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMjo1OTo0NVrOF3xAUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMzoyMTowNFrOF3xbGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxODg5OA==", "bodyText": "We shouldn't move this into implementation as a user may want to use this to create their own custom pipeline. Also, this is going to trigger a CheckStyle rule to fail that validates all HttpPipelinePolicy implementations are in the public API.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9176#discussion_r394018898", "createdAt": "2020-03-17T22:59:45Z", "author": {"login": "alzimmermsft"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/implementation/SearchApiKeyPipelinePolicy.java", "diffHunk": "@@ -1,12 +1,13 @@\n // Copyright (c) Microsoft Corporation. All rights reserved.\n // Licensed under the MIT License.\n \n-package com.azure.search;\n+package com.azure.search.implementation;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b46c8f4344f27a09049ff5424aa9cce6ad8274af"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxOTk4NA==", "bodyText": "We made this class final. How do customer make use of the policy?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9176#discussion_r394019984", "createdAt": "2020-03-17T23:03:09Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/implementation/SearchApiKeyPipelinePolicy.java", "diffHunk": "@@ -1,12 +1,13 @@\n // Copyright (c) Microsoft Corporation. All rights reserved.\n // Licensed under the MIT License.\n \n-package com.azure.search;\n+package com.azure.search.implementation;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxODg5OA=="}, "originalCommit": {"oid": "b46c8f4344f27a09049ff5424aa9cce6ad8274af"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAyNTc1Mw==", "bodyText": "They may want to create their own pipeline and code such as this:\nHttpPipeline myCustomSearchPipeline = new HttpPipelineBuilder()\n    .addPolicy(new SearchApiKeyPipelinePolicy(myCredentials)\n    .addPolicy(myOtherPolicies)\n    .build()\nThis is completely allowed and in some cases expected for a customer to roll their own custom pipeline to handle specific cases they want to cover, remove policies our builders add that they don't want, etc.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9176#discussion_r394025753", "createdAt": "2020-03-17T23:21:04Z", "author": {"login": "alzimmermsft"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/implementation/SearchApiKeyPipelinePolicy.java", "diffHunk": "@@ -1,12 +1,13 @@\n // Copyright (c) Microsoft Corporation. All rights reserved.\n // Licensed under the MIT License.\n \n-package com.azure.search;\n+package com.azure.search.implementation;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxODg5OA=="}, "originalCommit": {"oid": "b46c8f4344f27a09049ff5424aa9cce6ad8274af"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 128, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}