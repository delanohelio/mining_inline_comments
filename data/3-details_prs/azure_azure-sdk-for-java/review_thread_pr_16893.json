{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMDI0MDA3", "number": 16893, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDozODoxOVrOEyi1Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDozODoxOVrOEyi1Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNDM0OTIzOnYy", "diffSide": "RIGHT", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobClientBase.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDozODoxOVrOHpP7RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDo0MToyNFrOHpQCMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAxNDU5Ng==", "bodyText": "I think we should also check that there aren't existing etag conditions. If they pass in an old etag that they want to target, and we just got a new one possibly after some updates, we might not be reading the version they requested.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16893#discussion_r513014596", "createdAt": "2020-10-27T20:38:19Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobClientBase.java", "diffHunk": "@@ -247,11 +247,18 @@ public final BlobInputStream openInputStream(BlobRange range, BlobRequestConditi\n      */\n     public BlobInputStream openInputStream(BlobInputStreamOptions options) {\n         options = options == null ? new BlobInputStreamOptions() : options;\n+\n+        BlobProperties properties = getProperties();\n+\n         BlobRange range = options.getRange() == null ? new BlobRange(0) : options.getRange();\n         int chunkSize = options.getBlockSize() == null ? 4 * Constants.MB : options.getBlockSize();\n \n+        BlobRequestConditions requestConditions = options.getRequestConditions() == null\n+            ? new BlobRequestConditions() : options.getRequestConditions();\n+        requestConditions.setIfMatch(properties.getETag());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b9192f61fc7c1788cc4a48e02f38baf34fb56eb"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAxNTE1Mw==", "bodyText": "Yeah makes sense", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16893#discussion_r513015153", "createdAt": "2020-10-27T20:39:18Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobClientBase.java", "diffHunk": "@@ -247,11 +247,18 @@ public final BlobInputStream openInputStream(BlobRange range, BlobRequestConditi\n      */\n     public BlobInputStream openInputStream(BlobInputStreamOptions options) {\n         options = options == null ? new BlobInputStreamOptions() : options;\n+\n+        BlobProperties properties = getProperties();\n+\n         BlobRange range = options.getRange() == null ? new BlobRange(0) : options.getRange();\n         int chunkSize = options.getBlockSize() == null ? 4 * Constants.MB : options.getBlockSize();\n \n+        BlobRequestConditions requestConditions = options.getRequestConditions() == null\n+            ? new BlobRequestConditions() : options.getRequestConditions();\n+        requestConditions.setIfMatch(properties.getETag());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAxNDU5Ng=="}, "originalCommit": {"oid": "3b9192f61fc7c1788cc4a48e02f38baf34fb56eb"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAxNjM3MA==", "bodyText": "Fixed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16893#discussion_r513016370", "createdAt": "2020-10-27T20:41:24Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobClientBase.java", "diffHunk": "@@ -247,11 +247,18 @@ public final BlobInputStream openInputStream(BlobRange range, BlobRequestConditi\n      */\n     public BlobInputStream openInputStream(BlobInputStreamOptions options) {\n         options = options == null ? new BlobInputStreamOptions() : options;\n+\n+        BlobProperties properties = getProperties();\n+\n         BlobRange range = options.getRange() == null ? new BlobRange(0) : options.getRange();\n         int chunkSize = options.getBlockSize() == null ? 4 * Constants.MB : options.getBlockSize();\n \n+        BlobRequestConditions requestConditions = options.getRequestConditions() == null\n+            ? new BlobRequestConditions() : options.getRequestConditions();\n+        requestConditions.setIfMatch(properties.getETag());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAxNDU5Ng=="}, "originalCommit": {"oid": "3b9192f61fc7c1788cc4a48e02f38baf34fb56eb"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3881, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}