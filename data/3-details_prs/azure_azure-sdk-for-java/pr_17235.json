{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MjkyMzQ1", "number": 17235, "title": "75 tags", "bodyText": "", "createdAt": "2020-11-05T19:32:36Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235", "merged": true, "mergeCommit": {"oid": "4cb2508bd6280619d8299c5856573283d51277db"}, "closed": true, "closedAt": "2020-11-06T19:42:35Z", "author": {"login": "jaschrep-msft"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY-QMOgH2gAyNTE2MjkyMzQ1OjM5N2M3Zjc0OWVlYTc1ZmM5YjQzODcwZTMzNWMzYzBjOTEzMDY5NzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ77E0AH2gAyNTE2MjkyMzQ1OmQ0MDFmY2UxODYyZTlhYmQ2NWEzMzZlM2Y0MWNhMGYzNTQ2OTRkNmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "397c7f749eea75fc9b43870e335c3c0c91306972", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/397c7f749eea75fc9b43870e335c3c0c91306972", "committedDate": "2020-11-03T19:23:13Z", "message": "Generated code for 75 tags updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79692d2a4bad9431570637a3287803556168e292", "author": {"user": {"login": "jaschrep-msft", "name": "James"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/79692d2a4bad9431570637a3287803556168e292", "committedDate": "2020-11-05T01:10:49Z", "message": "stg 75 blob tags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "695385e61db1bfd0ad85343b48985c5cb210e060", "author": {"user": {"login": "jaschrep-msft", "name": "James"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/695385e61db1bfd0ad85343b48985c5cb210e060", "committedDate": "2020-11-05T02:10:38Z", "message": "Test fixes & docstring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8", "author": {"user": {"login": "jaschrep-msft", "name": "James"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/937c1a5916c5a42e6b718b5aaeb7782d22a00bd8", "committedDate": "2020-11-05T19:04:46Z", "message": "Recordings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjA2ODYx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#pullrequestreview-524606861", "createdAt": "2020-11-05T19:39:50Z", "commit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxOTozOTo1MVrOHuTpPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxOTo0Mjo1N1rOHuTv0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMxODM5Ng==", "bodyText": "Should we use Collections.emptyMap() here to use a singleton instead of creating a new instance?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#discussion_r518318396", "createdAt": "2020-11-05T19:39:51Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/models/TaggedBlobItem.java", "diffHunk": "@@ -15,8 +18,19 @@\n      * @param name The blob name\n      */\n     public TaggedBlobItem(String containerName, String name) {\n+        this(containerName, name, new HashMap<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMyMDA4Mw==", "bodyText": "Thoughts on deferring instantiation of a new map until we know the FilterBlobItem has tags, if it doesn't use the singleton Collections.emptyMap().", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#discussion_r518320083", "createdAt": "2020-11-05T19:42:57Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/implementation/util/ModelHelper.java", "diffHunk": "@@ -259,6 +261,17 @@ public static BlobItem populateBlobItem(BlobItemInternal blobItemInternal) {\n         return blobItem;\n     }\n \n+    public static TaggedBlobItem populateTaggedBlobItem(FilterBlobItem filterBlobItem) {\n+        Map<String, String> tags = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjE5MzQ5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#pullrequestreview-524619349", "createdAt": "2020-11-05T19:57:26Z", "commit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxOTo1NzoyNlrOHuUOzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxOTo1NzoyNlrOHuUOzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMyODAxNA==", "bodyText": "Could we consolidate this logic (BlobTagSet -> Map of tags) into another method in ModelHelper? There's some duplicate logic in BlobAsyncClient.getTagsWithResponse and ModelHelper.populateBlobItem,", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#discussion_r518328014", "createdAt": "2020-11-05T19:57:26Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/implementation/util/ModelHelper.java", "diffHunk": "@@ -259,6 +261,17 @@ public static BlobItem populateBlobItem(BlobItemInternal blobItemInternal) {\n         return blobItem;\n     }\n \n+    public static TaggedBlobItem populateTaggedBlobItem(FilterBlobItem filterBlobItem) {\n+        Map<String, String> tags = new HashMap<>();\n+        if (filterBlobItem.getTags() != null && filterBlobItem.getTags().getBlobTagSet() != null) {\n+            for (BlobTag tag : filterBlobItem.getTags().getBlobTagSet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjIwOTY3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#pullrequestreview-524620967", "createdAt": "2020-11-05T19:59:47Z", "commit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxOTo1OTo0N1rOHuUTtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxOTo1OTo0N1rOHuUTtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMyOTI3MA==", "bodyText": "Just a reminder to eventually revert this when the swagger has been merged", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#discussion_r518329270", "createdAt": "2020-11-05T19:59:47Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/swagger/README.md", "diffHunk": "@@ -15,7 +15,7 @@ autorest --use=@microsoft.azure/autorest.java@3.0.4 --use=jianghaolu/autorest.mo\n \n ### Code generation settings\n ``` yaml\n-input-file: https://raw.githubusercontent.com/Azure/azure-rest-api-specs/storage-dataplane-preview/specification/storage/data-plane/Microsoft.BlobStorage/preview/2020-02-10/blob.json\n+input-file: https://raw.githubusercontent.com/seanmcc-msft/azure-rest-api-specs/feature/storage/blobTags75/specification/storage/data-plane/Microsoft.BlobStorage/preview/2020-04-08/blob.json", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjIxNjY0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#pullrequestreview-524621664", "createdAt": "2020-11-05T20:00:41Z", "commit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMDowMDo0MVrOHuUV5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMDowMDo0MVrOHuUV5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMyOTgyOQ==", "bodyText": "is there a reason why we're specifically checking against the service version here? We generally always run tests against the latest version, so this may not be necessary", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#discussion_r518329829", "createdAt": "2020-11-05T20:00:41Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/storage/blob/ServiceAPITest.groovy", "diffHunk": "@@ -278,6 +278,11 @@ class ServiceAPITest extends APISpec {\n \n         then:\n         results.size() == 1\n+        if (primaryBlobServiceClient.getServiceVersion() >= BlobServiceVersion.V2020_04_08) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjIyMTY3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#pullrequestreview-524622167", "createdAt": "2020-11-05T20:01:19Z", "commit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjI0NjE2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#pullrequestreview-524624616", "createdAt": "2020-11-05T20:04:50Z", "commit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMDowNDo1MFrOHuUerg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMDowNDo1MFrOHuUerg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMzMjA3OA==", "bodyText": "I think we don't do things like that in java. tests run with latest version.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#discussion_r518332078", "createdAt": "2020-11-05T20:04:50Z", "author": {"login": "kasobol-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/storage/blob/ServiceAPITest.groovy", "diffHunk": "@@ -278,6 +278,11 @@ class ServiceAPITest extends APISpec {\n \n         then:\n         results.size() == 1\n+        if (primaryBlobServiceClient.getServiceVersion() >= BlobServiceVersion.V2020_04_08) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "937c1a5916c5a42e6b718b5aaeb7782d22a00bd8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8961969c41c2a502cb85291f7e94b2a45d586760", "author": {"user": {"login": "jaschrep-msft", "name": "James"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8961969c41c2a502cb85291f7e94b2a45d586760", "committedDate": "2020-11-05T20:13:41Z", "message": "Addressed minor PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjM1NjA0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#pullrequestreview-524635604", "createdAt": "2020-11-05T20:20:42Z", "commit": {"oid": "8961969c41c2a502cb85291f7e94b2a45d586760"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMDoyMDo0M1rOHuU_xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMDoyMDo0M1rOHuU_xQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM0MDU0OQ==", "bodyText": "if (blobTags ==null || blobTags.getBlobTagSet() == null || blobTags.getBlobTagsSet().isEmpty()) {\n return Collections.emptyMap();\n} else {\n   tags = new HashMap<>();\n   for (BlobTag tag : blobTags.getBlobTagSet()) {\n       tags.put(tag.getKey(), tag.getValue());\n  }\n  return tags;\n}\n\ngives much less branches and might make future reader happier.\nYou can also try streams API to reduce this even more see https://mkyong.com/java8/java-8-convert-list-to-map/", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#discussion_r518340549", "createdAt": "2020-11-05T20:20:43Z", "author": {"login": "kasobol-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/implementation/util/ModelHelper.java", "diffHunk": "@@ -245,20 +249,38 @@ public static BlobItem populateBlobItem(BlobItemInternal blobItemInternal) {\n         blobItem.setCurrentVersion(blobItemInternal.isCurrentVersion());\n         blobItem.setIsPrefix(blobItemInternal.isPrefix());\n \n-        Map<String, String> tags = new HashMap<>();\n-        if (blobItemInternal.getBlobTags() != null && blobItemInternal.getBlobTags().getBlobTagSet() != null) {\n-            for (BlobTag tag : blobItemInternal.getBlobTags().getBlobTagSet()) {\n-                tags.put(tag.getKey(), tag.getValue());\n-            }\n-        }\n-        blobItem.setTags(tags);\n+        blobItem.setTags(tagMapFromBlobTags(blobItemInternal.getBlobTags()));\n \n         blobItem.setObjectReplicationSourcePolicies(\n             transformObjectReplicationMetadata(blobItemInternal.getObjectReplicationMetadata()));\n \n         return blobItem;\n     }\n \n+    public static TaggedBlobItem populateTaggedBlobItem(FilterBlobItem filterBlobItem) {\n+        return new TaggedBlobItem(filterBlobItem.getContainerName(), filterBlobItem.getName(),\n+            tagMapFromBlobTags(filterBlobItem.getTags()));\n+    }\n+\n+    private static Map<String, String> tagMapFromBlobTags(BlobTags blobTags) {\n+        Map<String, String> tags;\n+        if (blobTags != null && blobTags.getBlobTagSet() != null) {\n+            if (blobTags.getBlobTagSet().size() == 0){\n+                return Collections.emptyMap();\n+            }\n+\n+            tags = new HashMap<>();\n+            for (BlobTag tag : blobTags.getBlobTagSet()) {\n+                tags.put(tag.getKey(), tag.getValue());\n+            }\n+        }\n+        else {\n+            tags = Collections.emptyMap();\n+        }\n+\n+        return tags;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8961969c41c2a502cb85291f7e94b2a45d586760"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjM5NzM3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17235#pullrequestreview-524639737", "createdAt": "2020-11-05T20:26:46Z", "commit": {"oid": "8961969c41c2a502cb85291f7e94b2a45d586760"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36ddbce30ee9f42894682d6b01f32500f3f741f1", "author": {"user": {"login": "jaschrep-msft", "name": "James"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/36ddbce30ee9f42894682d6b01f32500f3f741f1", "committedDate": "2020-11-05T20:30:20Z", "message": "PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e288958c0a39380e27ded2e21ae58d15e64646ea", "author": {"user": {"login": "jaschrep-msft", "name": "James"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e288958c0a39380e27ded2e21ae58d15e64646ea", "committedDate": "2020-11-05T20:48:22Z", "message": "Cleaned unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "316182f4f5d75fba3a47b5c273002d237747a99c", "author": {"user": {"login": "jaschrep-msft", "name": "James"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/316182f4f5d75fba3a47b5c273002d237747a99c", "committedDate": "2020-11-05T21:33:11Z", "message": "changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d401fce1862e9abd65a336e3f41ca0f354694d6d", "author": {"user": {"login": "jaschrep-msft", "name": "James"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d401fce1862e9abd65a336e3f41ca0f354694d6d", "committedDate": "2020-11-06T19:14:16Z", "message": "Changed swagger source"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 281, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}