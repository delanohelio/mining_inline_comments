{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNzM1ODQ2", "number": 9212, "title": "DO NOT MERGE | Cosmos 4.X | Address memory leak in Direct TCP transport client", "bodyText": "Repro\nmkdir azure-cosmos.results\ngit checkout master\nprofile=direct\nmvn -P$profile -DargLine=\"-Dio.netty.leakDetectionLevel=paranoid -Dio.netty.leakDetection.targetRecords=255\" verify | tee azure-cosmos.results/Verify-P$profile.output\nObserve\nA number of leak detections that implicate the Direct TCP reference counting code:\n\n<TODO: sample logger output>\n\nFix\nThis is a port from v2. See Azure/azure-cosmosdb-java#326 for a description of the change.\nTODO\nAttach evidence of issue and issue resolution. This is to enable a comparison of test results with paranoid leak detection before and after the fix.", "createdAt": "2020-03-19T00:44:41Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9212", "merged": true, "mergeCommit": {"oid": "e39ff2b28009f4c88aaa22b24bc30f5cbdd5f68b"}, "closed": true, "closedAt": "2020-03-31T18:37:57Z", "author": {"login": "David-Noble-at-work"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbkQmrkAH2gAyMzkwNzM1ODQ2Ojg0YTM3YWIzMjk1MjVhZTUyZDdjMWFkYzZlN2JhM2MzMzYyNWM1Yzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcS0q6JgH2gAyMzkwNzM1ODQ2OmNjZWU0YzAyMzdmNDM4YzhmZTMxNjc2ZDk4ZTY1NWMwMTZjMzIyNjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "84a37ab329525ae52d7c1adc6e7ba3c33625c5c7", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/84a37ab329525ae52d7c1adc6e7ba3c33625c5c7", "committedDate": "2019-11-07T04:36:56Z", "message": "Port from v4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d218925e1dff21266697a27e4271d34dfcc3b6a7", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d218925e1dff21266697a27e4271d34dfcc3b6a7", "committedDate": "2019-11-08T01:46:09Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11cbbf37bf63bf50e94f67fe30300ac39c72ed4f", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/11cbbf37bf63bf50e94f67fe30300ac39c72ed4f", "committedDate": "2019-11-08T03:20:35Z", "message": "Merge branch 'master' of github.com:David-Noble-at-work/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05c7e0551ffb6fd1ed80c15d1068cb32e734007e", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/05c7e0551ffb6fd1ed80c15d1068cb32e734007e", "committedDate": "2019-11-09T00:07:30Z", "message": "Corrected package misspelling in log4j.properties and removed System.exit from Main.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dfa3dbf03ae2addeddcb34ffc67c362670a164c", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8dfa3dbf03ae2addeddcb34ffc67c362670a164c", "committedDate": "2019-11-09T00:07:47Z", "message": "Merge branch 'master' of github.com:David-Noble-at-work/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6e71f5e6b292cac17b6a9687d04ad858f02a8a1", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e6e71f5e6b292cac17b6a9687d04ad858f02a8a1", "committedDate": "2019-11-09T18:42:20Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e082d817a13d64ed57e5243cbc1da5b4ef0ab58e", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e082d817a13d64ed57e5243cbc1da5b4ef0ab58e", "committedDate": "2019-11-17T00:51:11Z", "message": "Merge branch 'master' of github.com:David-Noble-at-work/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "069c822e997087f384cf1a1864e7efec331e69f8", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/069c822e997087f384cf1a1864e7efec331e69f8", "committedDate": "2019-11-23T22:36:47Z", "message": "Merge branch 'master' of github.com:David-Noble-at-work/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ead1cca230e56b61e5376e73bd1481f7a7b81e6", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3ead1cca230e56b61e5376e73bd1481f7a7b81e6", "committedDate": "2019-12-03T18:58:37Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "669ba8b28ed6ae321fda445e0e167ff027cc6481", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/669ba8b28ed6ae321fda445e0e167ff027cc6481", "committedDate": "2019-12-04T19:34:26Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "735f57269d45a3497a66d47d594b7efac88179ff", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/735f57269d45a3497a66d47d594b7efac88179ff", "committedDate": "2019-12-04T19:36:31Z", "message": "Responded to code review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6db330d843c4cdbb80b90c6f734f69a59afb9183", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6db330d843c4cdbb80b90c6f734f69a59afb9183", "committedDate": "2020-01-04T00:31:23Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48855b55564f6f216ee6a156f7a64ff5991ee2e6", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/48855b55564f6f216ee6a156f7a64ff5991ee2e6", "committedDate": "2020-01-04T02:07:38Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2367f50dd69e8f4d1ba123c3b42ad4388caeaa66", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2367f50dd69e8f4d1ba123c3b42ad4388caeaa66", "committedDate": "2020-01-17T20:51:14Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb9cac0c12e21f09e3c45580bf324bef7733b8c1", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fb9cac0c12e21f09e3c45580bf324bef7733b8c1", "committedDate": "2020-01-23T01:18:46Z", "message": "Updated sdk/cosmos/README.md with info on using system properties to modify default Direct TCP options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dd708ef9e753607040a6bb1f2b69c863dda8a0a", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1dd708ef9e753607040a6bb1f2b69c863dda8a0a", "committedDate": "2020-01-23T01:21:11Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "203507a249705593b04dec3e36566537d15da4e2", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/203507a249705593b04dec3e36566537d15da4e2", "committedDate": "2020-03-16T00:12:48Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "368b10f9893cdf49e95545e8ae4ec5ff03450f60", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/368b10f9893cdf49e95545e8ae4ec5ff03450f60", "committedDate": "2020-03-16T17:10:04Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7544aa31e210fe20d9939c26b17c9dbb4d7d72f", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f7544aa31e210fe20d9939c26b17c9dbb4d7d72f", "committedDate": "2020-03-17T01:24:39Z", "message": "Ported memory leak from v2.6.X and bumped version number."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cd3a139255f258d20b3c56ce9d00462add02b2b", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4cd3a139255f258d20b3c56ce9d00462add02b2b", "committedDate": "2020-03-18T01:32:58Z", "message": "Removed a file that was mistakenly committed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f58a9c7b813cc0f1d39071c8dd64e667681e2ec", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8f58a9c7b813cc0f1d39071c8dd64e667681e2ec", "committedDate": "2020-03-18T05:41:03Z", "message": "Space adjustments for readability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49baa6abd3e5ee01571b05c776ef43ff6efe7620", "author": {"user": {"login": "David-Noble-at-work", "name": "David Noble"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/49baa6abd3e5ee01571b05c776ef43ff6efe7620", "committedDate": "2020-03-19T00:30:26Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into issue/cosmos-4.X/direct-tcp/memory-leak"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c89928a0e347e7aae125566eedfe3807a3530740", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c89928a0e347e7aae125566eedfe3807a3530740", "committedDate": "2020-03-30T19:54:37Z", "message": "Merge branch 'master' into issue/cosmos-4.X/direct-tcp/memory-leak"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTgwMzE2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9212#pullrequestreview-384180316", "createdAt": "2020-03-30T19:53:07Z", "commit": {"oid": "49baa6abd3e5ee01571b05c776ef43ff6efe7620"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTo1MzowN1rOF95xfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTo1NDozM1rOF950uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NDAxNQ==", "bodyText": "why are we adding Readme file as part of this file?\nDis this come as part of merging v3 branch to v4?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9212#discussion_r400454015", "createdAt": "2020-03-30T19:53:07Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/README.md", "diffHunk": "@@ -0,0 +1,295 @@\n+\ufeff# Java SDK for SQL API of Azure Cosmos DB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49baa6abd3e5ee01571b05c776ef43ff6efe7620"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NDE2Nw==", "bodyText": "v3 version. this is v4 repo.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9212#discussion_r400454167", "createdAt": "2020-03-30T19:53:23Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/README.md", "diffHunk": "@@ -0,0 +1,295 @@\n+\ufeff# Java SDK for SQL API of Azure Cosmos DB\n+\n+[![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-cosmos.svg)](https://search.maven.org/artifact/com.microsoft.azure/azure-cosmos)\n+[![Known Vulnerabilities](https://snyk.io/test/github/Azure/azure-cosmosdb-java/badge.svg?targetFile=sdk%2Fpom.xml)](https://snyk.io/test/github/Azure/azure-cosmosdb-java?targetFile=sdk%2Fpom.xml)\n+\n+<!--[![Coverage Status](https://img.shields.io/codecov/c/github/Azure/azure-cosmos-java.svg)](https://codecov.io/gh/Azure/azure-cosmosdb-java)\n+![](https://img.shields.io/github/issues/azure/azure-cosmosdb-java.svg)\n+ -->\n+\n+<!-- TOC depthFrom:2 depthTo:2 withLinks:1 updateOnSave:1 orderedList:0 -->\n+\n+- [Consuming the official Microsoft Azure Cosmos DB Java SDK](#consuming-the-official-microsoft-azure-cosmos-db-java-sdk)\n+- [Prerequisites](#prerequisites)\n+- [API Documentation](#api-documentation)\n+- [Usage Code Sample](#usage-code-sample)\n+- [Guide for Prod](#guide-for-prod)\n+- [FAQ](#faq)\n+- [Release changes](#release-changes)\n+- [Contribution and Feedback](#contribution-and-feedback)\n+- [License](#license)\n+\n+<!-- /TOC -->\n+\n+## Example\n+\n+See the complete code for the above sample in [`HelloWorldDemo.java`](./microsoft-azure-cosmos-examples/src/main/java/com/azure/data/cosmos/examples/HelloWorldDemo.java)\n+\n+```java\n+import com.azure.data.cosmos.*;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.IOException;\n+\n+// ...\n+\n+    // Create a new CosmosClient via the builder\n+    // It only requires endpoint and key, but other useful settings are available\n+    CosmosClient client = CosmosClient.builder()\n+        .endpoint(\"<YOUR ENDPOINT HERE>\")\n+        .key(\"<YOUR KEY HERE>\")\n+        .build();\n+\n+    // Get a reference to the container\n+    // This will create (or read) a database and its container.\n+    CosmosContainer container = client.createDatabaseIfNotExists(\"contoso-travel\")\n+        // TIP: Our APIs are Reactor Core based, so try to chain your calls\n+        .flatMap(response -> response.database()\n+                .createContainerIfNotExists(\"passengers\", \"/id\"))\n+        .flatMap(response -> Mono.just(response.container()))\n+        .block(); // Blocking for demo purposes (avoid doing this in production unless you must)\n+\n+    // Create an item\n+    container.createItem(new Passenger(\"carla.davis@outlook.com\", \"Carla Davis\", \"SEA\", \"IND\"))\n+        .flatMap(response -> {\n+            System.out.println(\"Created item: \" + response.properties().toJson());\n+            // Read that item\n+            return response.item().read();\n+        })\n+        .flatMap(response -> {\n+            System.out.println(\"Read item: \" + response.properties().toJson());\n+            // Replace that item\n+            try {\n+                Passenger p = response.properties().getObject(Passenger.class);\n+                p.setDestination(\"SFO\");\n+                return response.item().replace(p);\n+            } catch (IOException e) {\n+                System.err.println(e);\n+                return Mono.error(e);\n+            }\n+        })\n+        // delete that item\n+        .flatMap(response -> response.item().delete())\n+        .block(); // Blocking for demo purposes (avoid doing this in production unless you must)\n+// ...\n+```\n+\n+We have a get started sample app available [here](https://github.com/Azure-Samples/azure-cosmos-db-sql-api-async-java-getting-started).\n+\n+Also We have more examples in form of standalone unit tests in [examples project](examples/src/test/java/com/microsoft/azure/cosmosdb/rx/examples).\n+\n+## Consuming the official Microsoft Azure Cosmos DB Java SDK\n+\n+This project provides a SDK library in Java for interacting with [SQL API](https://docs.microsoft.com/en-us/azure/cosmos-db/sql-api-sql-query) of [Azure Cosmos DB\n+Database Service](https://azure.microsoft.com/en-us/services/cosmos-db/). This project also includes samples, tools, and utilities.\n+\n+Jar dependency binary information for maven and gradle can be found here at [maven](https://mvnrepository.com/artifact/com.microsoft.azure/azure-cosmos).\n+\n+For example, using maven, you can add the following dependency to your maven pom file:\n+\n+[//]: # ({x-version-update-start;com.microsoft.azure:azure-cosmos;current})\n+```xml\n+<dependency>\n+  <groupId>com.microsoft.azure</groupId>\n+  <artifactId>azure-cosmos</artifactId>\n+  <version>3.6.0</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49baa6abd3e5ee01571b05c776ef43ff6efe7620"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NDg0MA==", "bodyText": "This is an automated process for release version bump.\nalso we haven't released 4.0.1-beta.2 I think.\nhttps://mvnrepository.com/artifact/com.azure/azure-cosmos", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9212#discussion_r400454840", "createdAt": "2020-03-30T19:54:33Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/pom.xml", "diffHunk": "@@ -14,7 +14,7 @@ Licensed under the MIT License.\n \n   <groupId>com.azure</groupId>\n   <artifactId>azure-cosmos-benchmark</artifactId>\n-  <version>4.0.1-beta.1</version> <!-- {x-version-update;com.azure:azure-cosmos-benchmark;current} -->\n+  <version>4.0.1-beta.3</version> <!-- {x-version-update;com.azure:azure-cosmos-benchmark;current} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49baa6abd3e5ee01571b05c776ef43ff6efe7620"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTgzMDE2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9212#pullrequestreview-384183016", "createdAt": "2020-03-30T19:57:03Z", "commit": {"oid": "c89928a0e347e7aae125566eedfe3807a3530740"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MjA2Nzc2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9212#pullrequestreview-384206776", "createdAt": "2020-03-30T20:31:11Z", "commit": {"oid": "c89928a0e347e7aae125566eedfe3807a3530740"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dede58c2b88fe6e575862b66a39fa9cab647e0a", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5dede58c2b88fe6e575862b66a39fa9cab647e0a", "committedDate": "2020-03-30T20:35:24Z", "message": "Fixed version issues, and removed readme from parent folder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccee4c0237f438c8fe31676d98e655c016c32266", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ccee4c0237f438c8fe31676d98e655c016c32266", "committedDate": "2020-03-30T20:38:39Z", "message": "Fixed benchmark and examples version"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 734, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}