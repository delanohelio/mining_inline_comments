{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2Njc2NzY2", "number": 18392, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wM1QwNjoxNjozNlrOGqTVsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQyMDoyMzowMVrOGuxCOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ3MDEwMjI1OnYy", "diffSide": "RIGHT", "path": "eng/pipelines/templates/jobs/ci.tests.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wM1QwNjoxNjozNlrOKdHAFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wM1QwNjoxNjozNlrOKdHAFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTYxMjA1Mw==", "bodyText": "This seems wrong. Artifacts is the list of things built that should be published, not a list of destinations to publish to.\nIf the goal is to publish the .hprof as a pipeline artifact, retained in Azure DevOps, you should replace inputs with something like:\n  condition: eq(variables.FILEEXISTS, 'true')\n  inputs:\n    targetPath: $(Pipeline.Workspace)/sdk/${{ parameters.ServiceDirectory }}/${{ artifact.name }}/target/oom.hprof\n    artifactType: pipeline   #this line isn't necessary as pipeline is the default\n    artifactName: '${{ artifact.name }}.oom.hprof'\nwhere FILEEXISTS is set to true if the .hprof exists:\n- pwsh: Write-Output \"##vso[task.setVariable variable=FILEEXISTS]$((Test-Path $pathToHprof) ? \"true\" : \"false\")\"    \nIf the oom.hprof is a memory dump and we have reason to believe it may contain sensitive information, e.g. credentials, we should consider more secure destinations for the files, like blob storage.\nfilepath base artifact publishing appears to be targeting DevOps users with private, network connected agents with fileshare access, i.e.   \\\\someserver\\share\\", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r701612053", "createdAt": "2021-09-03T06:16:36Z", "author": {"login": "hallipr"}, "path": "eng/pipelines/templates/jobs/ci.tests.yml", "diffHunk": "@@ -163,6 +163,13 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - ${{ each artifact in parameters.Artifacts }}:\n+        - task: PublishPipelineArtifact@1\n+          inputs:\n+            targetPath: '$(Pipeline.Workspace)/sdk/${{ parameters.ServiceDirectory }}/${{ artifact.name }}/target/oom.hprof'\n+            artifactType: 'filepath'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7abba402682b458596dbd1ff54aa59f936810c5"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDUxMTUyNDI4OnYy", "diffSide": "RIGHT", "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xM1QyMjo1NToyOVrOKi_HsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xM1QyMzowOTowN1rOKi_cYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NDM4NQ==", "bodyText": "How large are these files? Should we move them instead of copy?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707774385", "createdAt": "2021-09-13T22:55:29Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Copy-Item $fileFullName $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3OTY4MQ==", "bodyText": "It'll be variable, and somewhat dependent on the max heap size, but I'd expect them to be in the high MBs, low GBs range. Moving them would likely be the better option in this case.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707779681", "createdAt": "2021-09-13T23:09:07Z", "author": {"login": "alzimmermsft"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Copy-Item $fileFullName $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NDM4NQ=="}, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDUxMTUyNzM3OnYy", "diffSide": "RIGHT", "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xM1QyMjo1NjoyOFrOKi_JXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNjozMjowNlrOKjoCSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NDgxNA==", "bodyText": "In general creating a zip file make uploading less efficient as Devops already does compression on the server side and can optimize the chunks of these files better across all files uploaded instead of us.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707774814", "createdAt": "2021-09-13T22:56:28Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Copy-Item $fileFullName $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NzgxMA==", "bodyText": "I'd like to see how that plays out for real OOM dumps.   The test dumps were highly compressible  2gb -> 8mb I think.  If they're not compressing on upload, then the build's waiting on a 2gb file transfer.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707777810", "createdAt": "2021-09-13T23:04:08Z", "author": {"login": "hallipr"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Copy-Item $fileFullName $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NDgxNA=="}, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc4MDMxOQ==", "bodyText": "I'm less concerned on the DevOps slow down for uploading and more on the downloading when the dev loop includes troubleshooting an OOM. Overall, OOMs should rarely happen and I want to focus on the developer experience when they do.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707780319", "createdAt": "2021-09-13T23:10:40Z", "author": {"login": "alzimmermsft"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Copy-Item $fileFullName $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NDgxNA=="}, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 10}, {"id": "PRRC_kwDOACyxNM4qOf6m", "bodyText": "From a download prospective Devops always has the artifacts in a compressed download format so I'd expect them to be downloaded in a zip file regardless of how you upload them. In fact if you upload a zip you will likely end up with a zip inside of a zip.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708443814", "createdAt": "2021-09-14T16:30:54Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Copy-Item $fileFullName $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NDgxNA=="}, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 10}, {"id": "PRRC_kwDOACyxNM4qOgJL", "bodyText": "However with that said I'm fine testing out either approach and we can make adjustments as necessary.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708444747", "createdAt": "2021-09-14T16:32:06Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Copy-Item $fileFullName $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NDgxNA=="}, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 10}]}}, {"id": "PRRT_kwDOACyxNM4a5FOA", "diffSide": "RIGHT", "path": "sdk/core/azure-core-tracing-opentelemetry/pom.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQwMDowMToxNVrOKjA0qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQwMTozNDoxOFrOKjDEOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qMDSo", "bodyText": "We should standardize using 11 and above for these profiles to be consistent with all modules.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707802280", "createdAt": "2021-09-14T00:01:15Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-tracing-opentelemetry/pom.xml", "diffHunk": "@@ -126,20 +126,11 @@\n       <activation>\n         <jdk>[9,)</jdk>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 2}, {"id": "PRRC_kwDOACyxNM4qML60", "bodyText": "I've actually wondered if this should be Java 9 or Java 11, I know our CI uses Java 11 but technically this is for Java 9+. Given that I've actually been thinking this should switch on in Java 9.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707837620", "createdAt": "2021-09-14T01:29:58Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core-tracing-opentelemetry/pom.xml", "diffHunk": "@@ -126,20 +126,11 @@\n       <activation>\n         <jdk>[9,)</jdk>", "state": "SUBMITTED", "replyTo": {"id": "PRRC_kwDOACyxNM4qMDSo"}, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 2}, {"id": "PRRC_kwDOACyxNM4qMMQ5", "bodyText": "There is a pre-existing tracking item for this: #19273", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707839033", "createdAt": "2021-09-14T01:34:18Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core-tracing-opentelemetry/pom.xml", "diffHunk": "@@ -126,20 +126,11 @@\n       <activation>\n         <jdk>[9,)</jdk>", "state": "SUBMITTED", "replyTo": {"id": "PRRC_kwDOACyxNM4qMDSo"}, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 2}]}}, {"id": "PRRT_kwDOACyxNM4a5FZs", "diffSide": "RIGHT", "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQwMDowMjo0MVrOKjA5iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQwMTozMDo1NFrOKjC_xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qMDmJ", "bodyText": "Since this is not used anywhere, we can add this when required.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707803529", "createdAt": "2021-09-14T00:02:41Z", "author": {"login": "srnagar"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -107,7 +106,35 @@\n     <jacoco.min.linecoverage>0.40</jacoco.min.linecoverage>\n     <jacoco.min.branchcoverage>0.30</jacoco.min.branchcoverage>\n     <jacoco.skip.coverage.check>false</jacoco.skip.coverage.check>\n+\n+    <!-- This property determines the relative path from a pom.xml to the eng/ folder. -->\n     <relative.path.to.eng.folder>../../..</relative.path.to.eng.folder>\n+\n+    <!-- This property determines the max heap size of the Surefire JVM. By default 3GB, or 3096MB, is used. -->\n+    <surefireXmx>3096m</surefireXmx>\n+\n+    <!-- This property configures the max heap size of the Surefire JVM. -->\n+    <surefireJvmXmx>-Xmx${surefireXmx}</surefireJvmXmx>\n+\n+    <!-- This property configures creating a heap dump if the Surefire JVM fails with an OutOfMemoryError. -->\n+    <heapDumpOnOom>\n+      -XX:+HeapDumpOnOutOfMemoryError\n+      -XX:HeapDumpPath=${packageOutputDirectory}${file.separator}${project.artifactId}-oom.hprof\n+    </heapDumpOnOom>\n+\n+    <!-- Reserved for general Surefire JVM arguments that affect all SDKs. -->\n+    <defaultSurefireArgLine>\n+      ${surefireJvmXmx}\n+      ${heapDumpOnOom}\n+    </defaultSurefireArgLine>\n+\n+    <!-- Reserved for SDK specific JVM arguments to export, open, or read modules in testing. -->\n+    <javaModulesSurefireArgLine>\n+    </javaModulesSurefireArgLine>\n+\n+    <!-- Reserved for either general or SDK specific JVM arguments that are optional. -->\n+    <additionalSurefireArgLine>\n+    </additionalSurefireArgLine>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 42}, {"id": "PRRC_kwDOACyxNM4qML_H", "bodyText": "I'd rather add it now as a path forward for SDK specific hooks that haven't been updated in the PR (if they exist).", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707837895", "createdAt": "2021-09-14T01:30:54Z", "author": {"login": "alzimmermsft"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -107,7 +106,35 @@\n     <jacoco.min.linecoverage>0.40</jacoco.min.linecoverage>\n     <jacoco.min.branchcoverage>0.30</jacoco.min.branchcoverage>\n     <jacoco.skip.coverage.check>false</jacoco.skip.coverage.check>\n+\n+    <!-- This property determines the relative path from a pom.xml to the eng/ folder. -->\n     <relative.path.to.eng.folder>../../..</relative.path.to.eng.folder>\n+\n+    <!-- This property determines the max heap size of the Surefire JVM. By default 3GB, or 3096MB, is used. -->\n+    <surefireXmx>3096m</surefireXmx>\n+\n+    <!-- This property configures the max heap size of the Surefire JVM. -->\n+    <surefireJvmXmx>-Xmx${surefireXmx}</surefireJvmXmx>\n+\n+    <!-- This property configures creating a heap dump if the Surefire JVM fails with an OutOfMemoryError. -->\n+    <heapDumpOnOom>\n+      -XX:+HeapDumpOnOutOfMemoryError\n+      -XX:HeapDumpPath=${packageOutputDirectory}${file.separator}${project.artifactId}-oom.hprof\n+    </heapDumpOnOom>\n+\n+    <!-- Reserved for general Surefire JVM arguments that affect all SDKs. -->\n+    <defaultSurefireArgLine>\n+      ${surefireJvmXmx}\n+      ${heapDumpOnOom}\n+    </defaultSurefireArgLine>\n+\n+    <!-- Reserved for SDK specific JVM arguments to export, open, or read modules in testing. -->\n+    <javaModulesSurefireArgLine>\n+    </javaModulesSurefireArgLine>\n+\n+    <!-- Reserved for either general or SDK specific JVM arguments that are optional. -->\n+    <additionalSurefireArgLine>\n+    </additionalSurefireArgLine>", "state": "SUBMITTED", "replyTo": {"id": "PRRC_kwDOACyxNM4qMDmJ"}, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 42}]}}, {"id": "PRRT_kwDOACyxNM4a6r7N", "diffSide": "RIGHT", "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNjo0MDoxNFrOKjoaXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNjo0MDoxNFrOKjoaXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qOhpd", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                condition: always()\n          \n          \n            \n                condition: succeededOrFailed()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708450909", "createdAt": "2021-09-14T16:40:14Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Move-Item -Path $fileFullName -Destination $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")\n+    displayName: 'Copy OOM hprofs'\n+    condition: always()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6850e358d2fcfdc549484345e8a1cd0669f65388"}, "originalPosition": 12}]}}, {"id": "PRRT_kwDOACyxNM4a6tIw", "diffSide": "RIGHT", "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNjo1MDowNVrOKjo4ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNjo1MDowNVrOKjo4ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qOjie", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                condition: always()\n          \n          \n            \n                condition: succeededOrFailed()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708458654", "createdAt": "2021-09-14T16:50:05Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Move-Item -Path $fileFullName -Destination $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")\n+    displayName: 'Copy OOM hprofs'\n+    condition: always()\n+\n+  - publish: $(Build.ArtifactStagingDirectory)/oom-hprofs.zip\n+    displayName: 'Publish OOM hprofs'\n+    artifact: oom-hprofs-$(System.StageName)-$(System.JobName)-$(System.JobAttempt)\n+    condition: always()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6850e358d2fcfdc549484345e8a1cd0669f65388"}, "originalPosition": 17}]}}, {"id": "PRRT_kwDOACyxNM4a6x45", "diffSide": "RIGHT", "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNzozNDowM1rOKjqyDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNzo1OToxOFrOKjr3SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qOrIM", "bodyText": "looks like this full name isn't used.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708489740", "createdAt": "2021-09-14T17:34:03Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "036002bb2b81a394b1af1205ba1120d908fc07cb"}, "originalPosition": 6}, {"id": "PRRC_kwDOACyxNM4qOvYC", "bodyText": "It's used two lines below in the Move-Item command \ud83d\ude03", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708507138", "createdAt": "2021-09-14T17:58:52Z", "author": {"login": "alzimmermsft"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName", "state": "SUBMITTED", "replyTo": {"id": "PRRC_kwDOACyxNM4qOrIM"}, "originalCommit": {"oid": "036002bb2b81a394b1af1205ba1120d908fc07cb"}, "originalPosition": 6}, {"id": "PRRC_kwDOACyxNM4qOvdJ", "bodyText": "https://github.com/Azure/azure-sdk-for-java/pull/18392/files/036002bb2b81a394b1af1205ba1120d908fc07cb#diff-c0636fb18157703f77203332e4169a450ca3084e7a26a3285bceca46e3e19152R8", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708507465", "createdAt": "2021-09-14T17:59:18Z", "author": {"login": "alzimmermsft"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName", "state": "SUBMITTED", "replyTo": {"id": "PRRC_kwDOACyxNM4qOrIM"}, "originalCommit": {"oid": "036002bb2b81a394b1af1205ba1120d908fc07cb"}, "originalPosition": 6}]}}, {"id": "PRRT_kwDOACyxNM4a7EI6", "diffSide": "RIGHT", "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQyMDoyMzowMVrOKjxzNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQyMDoyNzoyOVrOKjx-tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qPHM3", "bodyText": "can this collide with \n  \n    \n      azure-sdk-for-java/sdk/storage/azure-storage-blob/pom.xml\n    \n    \n        Lines 236 to 238\n      in\n      da6337e\n    \n    \n    \n    \n\n        \n          \n           <argLine> \n        \n\n        \n          \n             -Xmx6g \n        \n\n        \n          \n           </argLine> \n        \n    \n  \n\n\n?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708604727", "createdAt": "2021-09-14T20:23:01Z", "author": {"login": "kasobol-msft"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -107,7 +106,35 @@\n     <jacoco.min.linecoverage>0.40</jacoco.min.linecoverage>\n     <jacoco.min.branchcoverage>0.30</jacoco.min.branchcoverage>\n     <jacoco.skip.coverage.check>false</jacoco.skip.coverage.check>\n+\n+    <!-- This property determines the relative path from a pom.xml to the eng/ folder. -->\n     <relative.path.to.eng.folder>../../..</relative.path.to.eng.folder>\n+\n+    <!-- This property determines the max heap size of the Surefire JVM. By default 3GB, or 3096MB, is used. -->\n+    <surefireXmx>3096m</surefireXmx>\n+\n+    <!-- This property configures the max heap size of the Surefire JVM. -->\n+    <surefireJvmXmx>-Xmx${surefireXmx}</surefireJvmXmx>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44689fbb9d09a2ce47d5eec3d14a932081122fd5"}, "originalPosition": 22}, {"id": "PRRC_kwDOACyxNM4qPH61", "bodyText": "Yes, this can collide with that. The thought behind the new pattern is to override <surefireXmx>3096m</surefireXmx> to a new value in the child POM, so in this case it would be <surefireXmx>6g</surefireXmx> in azure-storage-blob/pom.xml. This will then be rolled into the <surefireJvmXmx> value and passed into the maven-surefire-plugin argLine.\nOverall, the changes are to use more composition-esque styling by overriding property values instead of overriding plugin configurations (as these have shown to be much more brittle).", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708607669", "createdAt": "2021-09-14T20:27:29Z", "author": {"login": "alzimmermsft"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -107,7 +106,35 @@\n     <jacoco.min.linecoverage>0.40</jacoco.min.linecoverage>\n     <jacoco.min.branchcoverage>0.30</jacoco.min.branchcoverage>\n     <jacoco.skip.coverage.check>false</jacoco.skip.coverage.check>\n+\n+    <!-- This property determines the relative path from a pom.xml to the eng/ folder. -->\n     <relative.path.to.eng.folder>../../..</relative.path.to.eng.folder>\n+\n+    <!-- This property determines the max heap size of the Surefire JVM. By default 3GB, or 3096MB, is used. -->\n+    <surefireXmx>3096m</surefireXmx>\n+\n+    <!-- This property configures the max heap size of the Surefire JVM. -->\n+    <surefireJvmXmx>-Xmx${surefireXmx}</surefireJvmXmx>", "state": "SUBMITTED", "replyTo": {"id": "PRRC_kwDOACyxNM4qPHM3"}, "originalCommit": {"oid": "44689fbb9d09a2ce47d5eec3d14a932081122fd5"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1764, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}