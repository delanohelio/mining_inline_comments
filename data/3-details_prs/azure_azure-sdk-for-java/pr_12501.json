{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NTY1NDk2", "number": 12501, "title": "add more logging info", "bodyText": "adds requestUri to the Exception#toString\nimprovements in Exception logging in GoneAndRetryWithRetryPolicy", "createdAt": "2020-06-24T23:11:18Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501", "merged": true, "mergeCommit": {"oid": "e664e5f7892ed2ed159c9daaf3e85b1b27019af5"}, "closed": true, "closedAt": "2020-06-25T19:32:41Z", "author": {"login": "moderakh"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuiX1KAH2gAyNDM5NTY1NDk2OjIxZGZjYzQ0MjEzYmQwNmQ0N2VkZGY0ZTAwNDFiYTRmNTRkMzhiNjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuyFlUgH2gAyNDM5NTY1NDk2OmYzNTc1Zjg1ZTc3MTkxOTdkYWYzYWI4YjIzZTE2NDAwYTIxNjM5NmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "21dfcc44213bd06d47eddf4e0041ba4f54d38b64", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/21dfcc44213bd06d47eddf4e0041ba4f54d38b64", "committedDate": "2020-06-24T23:09:24Z", "message": "add more logging info"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MDY3NzM1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#pullrequestreview-437067735", "createdAt": "2020-06-24T23:14:13Z", "commit": {"oid": "21dfcc44213bd06d47eddf4e0041ba4f54d38b64"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMzoxNDoxM1rOGomKgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMzoxNzo1OFrOGomPKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMTUwNQ==", "bodyText": "Why is this logger.warn() and not logger.info(), is this intentional?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#discussion_r445221505", "createdAt": "2020-06-24T23:14:13Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/GoneAndRetryWithRetryPolicy.java", "diffHunk": "@@ -83,11 +84,10 @@ public GoneAndRetryWithRetryPolicy(RxDocumentServiceRequest request, Integer wai\n                                 exception, this.lastRetryWithException);\n                         exceptionToThrow = this.lastRetryWithException;\n                     } else {\n-                        logger.warn(\"Received gone exception after backoff/retry. Will fail the request. {}\",\n-                                exception.toString());\n+                        logger.warn(\"Received gone exception after backoff/retry. Will fail the request. {}, short stackTrace = [{}]\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21dfcc44213bd06d47eddf4e0041ba4f54d38b64"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMTg1MA==", "bodyText": "It would be better if we can have this as a JVM parameter as well defined in Configs.java\nSo that if we want the customer to increase the depth size, we don't have to change the code, release and ask them to upgrade.\nWith JVM params, they can just update the param value and they can re-start their application.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#discussion_r445221850", "createdAt": "2020-06-24T23:15:21Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/GoneAndRetryWithRetryPolicy.java", "diffHunk": "@@ -23,8 +24,8 @@\n import java.time.Duration;\n \n public class GoneAndRetryWithRetryPolicy extends RetryPolicyWithDiagnostics {\n-\n     private final static Logger logger = LoggerFactory.getLogger(GoneAndRetryWithRetryPolicy.class);\n+    private final static int LIMITED_STACK_TRACE_FAILURE_DEPTH = 3;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21dfcc44213bd06d47eddf4e0041ba4f54d38b64"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMjY5Nw==", "bodyText": "We should put these in a try with finally block to close both StringWriter and PrintWriter in case there is any issue serializing the exception.\nJust as a safety check so that we don't have memory leaks.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#discussion_r445222697", "createdAt": "2020-06-24T23:17:58Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/Utils.java", "diffHunk": "@@ -646,4 +648,23 @@ public static String toJson(ObjectMapper mapper, ObjectNode object) {\n             throw new IllegalStateException(\"Unable to convert JSON to STRING\", e);\n         }\n     }\n+\n+    public static String limitedStackTrace(Exception e, int depth) {\n+        StackTraceElement[] stacktrace = e.getStackTrace();\n+        if (stacktrace == null) {\n+            return \"null\";\n+        } else {\n+            StringWriter strWriter = new StringWriter();\n+            PrintWriter writer = new PrintWriter(strWriter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21dfcc44213bd06d47eddf4e0041ba4f54d38b64"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3863647c6431466a1965e5ccf887f3139fa7a59", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c3863647c6431466a1965e5ccf887f3139fa7a59", "committedDate": "2020-06-24T23:32:36Z", "message": "addressed comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ee74052d86e6f9acf50bba88a6316267ea49880", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3ee74052d86e6f9acf50bba88a6316267ea49880", "committedDate": "2020-06-24T23:36:11Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff1230e2efae4bc85d59f94a38283f23559afadb", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ff1230e2efae4bc85d59f94a38283f23559afadb", "committedDate": "2020-06-24T23:44:28Z", "message": "updated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MDc4Nzc1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#pullrequestreview-437078775", "createdAt": "2020-06-24T23:44:59Z", "commit": {"oid": "ff1230e2efae4bc85d59f94a38283f23559afadb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6af79f7f968ec49e3afd7b2dc8aac554ce03d2c5", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6af79f7f968ec49e3afd7b2dc8aac554ce03d2c5", "committedDate": "2020-06-25T17:04:47Z", "message": "cleanup, removed some earlier stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45a1c16e7317f12b0a04567357d4679deff38190", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/45a1c16e7317f12b0a04567357d4679deff38190", "committedDate": "2020-06-25T17:05:43Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e723df394a004c6f00e7b1ed9431e914a84bf316", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e723df394a004c6f00e7b1ed9431e914a84bf316", "committedDate": "2020-06-25T17:06:08Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3575f85e7719197daf3ab8b23e16400a216396b", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f3575f85e7719197daf3ab8b23e16400a216396b", "committedDate": "2020-06-25T17:27:57Z", "message": "cleanup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2920, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}