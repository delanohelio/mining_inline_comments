{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5OTgxMTg5", "number": 11302, "title": "mgmt update default subscription logic", "bodyText": "This PR is to update how we handle default subscription when user didn't provide subscription info.\nThe main logic:\n\nfetch list of subscriptions from the user's tenant\n\nIf size is 0, throw exception with link to ask user to create a subscription first.\nIf size is larger than 1, throw exception with the names & ids of subscriptions to ask user which one is desired to use. They can set in Azure profile or use withSubscription().\nIf there is only 1 subscription found, we take it as default subscription and go to next step.", "createdAt": "2020-05-19T09:05:05Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302", "merged": true, "mergeCommit": {"oid": "0d6a3c582b5935cd27583a0ce0be842d2088e27d"}, "closed": true, "closedAt": "2020-05-25T10:14:23Z", "author": {"login": "xseeseesee"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciwif_AH2gAyNDE5OTgxMTg5OmQ4NGIzYmNlOGIwYTM3ZmRiMTQzMDM4NGU0Y2QxODhkMjIxODJhNDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjBzHTAFqTQxNDk5MjM4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d84b3bce8b0a37fdb1430384e4cd188d22182a49", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d84b3bce8b0a37fdb1430384e4cd188d22182a49", "committedDate": "2020-05-19T08:52:38Z", "message": "mgmt update default subscription logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c693a51fa3cfc754f52dfe44e99de31378c53530", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c693a51fa3cfc754f52dfe44e99de31378c53530", "committedDate": "2020-05-19T08:58:24Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f97d7f9b1859df2c3b7eceab12f76fcf48b2de5", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f97d7f9b1859df2c3b7eceab12f76fcf48b2de5", "committedDate": "2020-05-19T09:05:52Z", "message": "fix comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MjUzMjA5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302#pullrequestreview-414253209", "createdAt": "2020-05-19T09:12:08Z", "commit": {"oid": "3f97d7f9b1859df2c3b7eceab12f76fcf48b2de5"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToxMjowOFrOGXXOGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToxMzozMlrOGXXRnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1MDg3Mw==", "bodyText": "Is it possible to find a more specific exception type? RuntimeException is generally only viewed as abstract base class. Maybe IllegalStateException, or InvalidArgumentException (if we take that defaultSubscription only works for 1 subscription).", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302#discussion_r427150873", "createdAt": "2020-05-19T09:12:08Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/management/azure/src/main/java/com/azure/management/Azure.java", "diffHunk": "@@ -325,8 +331,25 @@ public Azure withSubscription(String subscriptionId) {\n         @Override\n         public Azure withDefaultSubscription() {\n             if (profile.subscriptionId() == null) {\n-                throw logger.logExceptionAsError(\n-                    new IllegalArgumentException(\"Please specify the subscription ID for resource management.\"));\n+                List<Subscription> subscriptions = new ArrayList<>();\n+                this.subscriptions().list().forEach(subscription -> {\n+                    subscriptions.add(subscription);\n+                });\n+                if (subscriptions.size() == 0) {\n+                    throw logger.logExceptionAsError(\n+                        new RuntimeException(\"Please create a subscription before you start resource management. \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f97d7f9b1859df2c3b7eceab12f76fcf48b2de5"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1MTc3Mg==", "bodyText": "Is it possible to share some code?\nMaybe Azure could call some util method in Resources?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302#discussion_r427151772", "createdAt": "2020-05-19T09:13:32Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/resources/mgmt/src/main/java/com/azure/management/resources/implementation/ResourceManager.java", "diffHunk": "@@ -192,8 +198,25 @@ public ResourceManager withSubscription(String subscriptionId) {\n         @Override\n         public ResourceManager withDefaultSubscription() {\n             if (profile.subscriptionId() == null) {\n-                throw logger.logExceptionAsError(\n-                    new IllegalArgumentException(\"Please specify the subscription ID for resource management.\"));\n+                List<Subscription> subscriptions = new ArrayList<>();\n+                this.subscriptions().list().forEach(subscription -> {\n+                    subscriptions.add(subscription);\n+                });\n+                if (subscriptions.size() == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f97d7f9b1859df2c3b7eceab12f76fcf48b2de5"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f250c98bc9fc591c0cb29f5945e5c4c9ce82ff9", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9f250c98bc9fc591c0cb29f5945e5c4c9ce82ff9", "committedDate": "2020-05-20T02:22:18Z", "message": "Merge branch 'master' into update-azure-client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6195ffdeb86e644721914fb71d15595483cb094d", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6195ffdeb86e644721914fb71d15595483cb094d", "committedDate": "2020-05-20T03:09:01Z", "message": "use IllegalStateException instead of RuntimeException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e94f2f550586ed04f70c496411da916c6437b4a9", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e94f2f550586ed04f70c496411da916c6437b4a9", "committedDate": "2020-05-20T04:53:24Z", "message": "update description"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0OTkyMzg5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302#pullrequestreview-414992389", "createdAt": "2020-05-20T04:59:10Z", "commit": {"oid": "e94f2f550586ed04f70c496411da916c6437b4a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4127, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}