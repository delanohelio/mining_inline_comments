{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5OTE1NzU5", "number": 10564, "title": "Artifact grouping", "bodyText": "This PR replaces #10490 ... I merged that one onto a feature branch so that I could do some end-to-end testing of how the pipeline copes with the segregated artifacts. There were a few tweaks that needed to be made which caused me to break my artifact staging logic out into a reusable template.\n@JimSuplizio this should address your concerns. Here is the template artifact released:\nhttps://repo.maven.apache.org/maven2/com/azure/azure-sdk-template/1.0.4-beta.14/", "createdAt": "2020-04-28T06:42:35Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564", "merged": true, "mergeCommit": {"oid": "f3fdd21d4a710c2dbb305d5a19472f992375c80f"}, "closed": true, "closedAt": "2020-07-15T03:11:08Z", "author": {"login": "mitchdenny"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccgdcWgFqTQwMzA5MjIwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0_pgdAFqTQ0ODU1NTE1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDkyMjA0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#pullrequestreview-403092204", "createdAt": "2020-04-29T22:45:05Z", "commit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjo0NTowNVrOGOTtEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjo0NTowNVrOGOTtEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NjA4MQ==", "bodyText": "comment on the end can be deleted as it no longer applies.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r417656081", "createdAt": "2020-04-29T22:45:05Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI\n+          goals: 'deploy'\n+          options: '$(DefaultOptions) -DskipTests -Dinject-codesnippets -Dgenerate-overview -Dspotbugs.skip=true -Dcheckstyle.skip=true -Drevapi.skip=true -pl $(ProjectList) -am -DaltDeploymentRepository=id::default::file://$(Build.ArtifactStagingDirectory)' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDk0Nzc2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#pullrequestreview-403094776", "createdAt": "2020-04-29T22:51:27Z", "commit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjo1MToyN1rOGOT1Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjo1MToyN1rOGOT1Xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1ODIwNg==", "bodyText": "We probably should also remove the packageOutputDirectory property and the ant copy step after we make this switch to deploy.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r417658206", "createdAt": "2020-04-29T22:51:27Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c4b97d58073198522f8e8257281371fdbf6ada2", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9c4b97d58073198522f8e8257281371fdbf6ada2", "committedDate": "2020-05-08T12:43:57Z", "message": "Merge branch 'master' into feature/artifact-grouping"}, "afterCommit": {"oid": "82efc4c2a3385d1a4d5847dcbece95300e6a8f82", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/82efc4c2a3385d1a4d5847dcbece95300e6a8f82", "committedDate": "2020-06-01T05:34:12Z", "message": "Tweak staging logic."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "82efc4c2a3385d1a4d5847dcbece95300e6a8f82", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/82efc4c2a3385d1a4d5847dcbece95300e6a8f82", "committedDate": "2020-06-01T05:34:12Z", "message": "Tweak staging logic."}, "afterCommit": {"oid": "d0005c26781251195193a3f7fb2d87e32a89ca71", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d0005c26781251195193a3f7fb2d87e32a89ca71", "committedDate": "2020-07-13T00:18:08Z", "message": "Tweak staging logic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40181aeab2f5af531650e4ff5215395e4114929a", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/40181aeab2f5af531650e4ff5215395e4114929a", "committedDate": "2020-07-13T06:09:58Z", "message": "Artifact segregation (#10490)\n\n* Do a deployment into the staging directory to segregate artifacts.\n\n* Add skips for checkstyle, spotbugs and rev API since we now do deploy during build.\n\nTweak staging logic.\n\nTweak changelog.\n\nIncrement package version after release of com.azure azure-sdk-template (#13065)\n\nAdd recursive copy to stage artifacts.\n\nFix changelog\n\nIncrement package version after release of com.azure azure-sdk-template (#13066)\n\nAnother run through the pipeline.\n\nIncrement package version after release of com.azure azure-sdk-template (#13067)\n\nFlatten artifacts.\n\nIncrement package version after release of com.azure azure-sdk-template (#13068)\n\nMore debugging.\n\nTweak filtering."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc3f0a843f25beed100dd8d33b3cdc88b960defb", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fc3f0a843f25beed100dd8d33b3cdc88b960defb", "committedDate": "2020-07-13T05:39:29Z", "message": "Tweak filtering."}, "afterCommit": {"oid": "40181aeab2f5af531650e4ff5215395e4114929a", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/40181aeab2f5af531650e4ff5215395e4114929a", "committedDate": "2020-07-13T06:09:58Z", "message": "Artifact segregation (#10490)\n\n* Do a deployment into the staging directory to segregate artifacts.\n\n* Add skips for checkstyle, spotbugs and rev API since we now do deploy during build.\n\nTweak staging logic.\n\nTweak changelog.\n\nIncrement package version after release of com.azure azure-sdk-template (#13065)\n\nAdd recursive copy to stage artifacts.\n\nFix changelog\n\nIncrement package version after release of com.azure azure-sdk-template (#13066)\n\nAnother run through the pipeline.\n\nIncrement package version after release of com.azure azure-sdk-template (#13067)\n\nFlatten artifacts.\n\nIncrement package version after release of com.azure azure-sdk-template (#13068)\n\nMore debugging.\n\nTweak filtering."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb3c4c2093e361f6615c22c7de7d51fff3308b6", "author": {"user": {"login": "azure-sdk", "name": "Azure SDK Bot"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8eb3c4c2093e361f6615c22c7de7d51fff3308b6", "committedDate": "2020-07-13T06:17:34Z", "message": "Increment version for template releases (#13072)\n\n* Artifact segregation (#10490)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NTQ5OTY3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#pullrequestreview-448549967", "createdAt": "2020-07-15T00:21:36Z", "commit": {"oid": "8eb3c4c2093e361f6615c22c7de7d51fff3308b6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDoyMTozNlrOGxpztg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDoyMTozNlrOGxpztg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcxODM5MA==", "bodyText": "we've hardcoded template here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r454718390", "createdAt": "2020-07-15T00:21:36Z", "author": {"login": "scbedd"}, "path": "eng/pipelines/templates/steps/stage-artifacts.yml", "diffHunk": "@@ -6,5 +6,10 @@ parameters:\n steps:\n   - pwsh: |\n       New-Item -Force -Type Directory -Name ${{parameters.TargetFolder}} -Path $(Pipeline.Workspace)\n-      Copy-Item $(Pipeline.Workspace)/${{parameters.SourceFolder}}/${{parameters.PackageName}}-[0-9]*.[0-9]*.[0-9]* $(Pipeline.Workspace)/${{parameters.TargetFolder}}\n-    displayName: Stage artifacts\n\\ No newline at end of file\n+      $items = Get-ChildItem -Recurse -Path $(Pipeline.Workspace)/${{parameters.SourceFolder}} \n+      Write-Host \"Found $($items.Count) total items in source folder\"\n+      $filteredItems = $items | Where-Object -FilterScript { $_.Name -like \"azure-sdk-template-[0-9]*.[0-9]*.[0-9]*-*\" }      ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eb3c4c2093e361f6615c22c7de7d51fff3308b6"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d5128cdbf861dd02fe2526a51f1994d1267e475", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7d5128cdbf861dd02fe2526a51f1994d1267e475", "committedDate": "2020-07-15T00:37:19Z", "message": "Fixing the bug that Scott identified."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NTU1MTA4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#pullrequestreview-448555108", "createdAt": "2020-07-15T00:39:22Z", "commit": {"oid": "7d5128cdbf861dd02fe2526a51f1994d1267e475"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDozOToyMlrOGxqGAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDozOToyMlrOGxqGAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyMzA3NQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r454723075", "createdAt": "2020-07-15T00:39:22Z", "author": {"login": "scbedd"}, "path": "eng/pipelines/templates/steps/stage-artifacts.yml", "diffHunk": "@@ -6,5 +6,10 @@ parameters:\n steps:\n   - pwsh: |\n       New-Item -Force -Type Directory -Name ${{parameters.TargetFolder}} -Path $(Pipeline.Workspace)\n-      Copy-Item $(Pipeline.Workspace)/${{parameters.SourceFolder}}/${{parameters.PackageName}}-[0-9]*.[0-9]*.[0-9]* $(Pipeline.Workspace)/${{parameters.TargetFolder}}\n-    displayName: Stage artifacts\n\\ No newline at end of file\n+      $items = Get-ChildItem -Recurse -Path $(Pipeline.Workspace)/${{parameters.SourceFolder}} \n+      Write-Host \"Found $($items.Count) total items in source folder\"\n+      $filteredItems = $items | Where-Object -FilterScript { $_.Name -like \"${{parameters.PackageName}}-[0-9]*.[0-9]*.[0-9]*-*\" }      ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d5128cdbf861dd02fe2526a51f1994d1267e475"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NTU1MTU1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#pullrequestreview-448555155", "createdAt": "2020-07-15T00:39:30Z", "commit": {"oid": "7d5128cdbf861dd02fe2526a51f1994d1267e475"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4617, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}