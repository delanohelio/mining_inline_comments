{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzOTg4MjQw", "number": 11473, "title": "Allow data libraries to have 'beta' as well as 'beta.X' prerelease", "bodyText": "Track 1, or data track, libraries were given the exception where they don't have to release beta versions as \"-beta.X\" but instead can just be \"-beta\". The following updates were required to allow this\n\neng\\versioning\\scan_for_unreleased_dependencies.ps1 will now match \"-beta.X\" and \"-beta\" as beta libraries and dependencies.\neng\\versioning\\set_versions.py needed similar surgical changes in two different code paths. Both the verify and increment version needed to be able to handle prerelease tags that were -beta. This change was specifically scoped to data track libraries which can no be of either form \"-beta.X\" or \"-beta\"\neng\\versioning\\utils.py added an additional prerelease version regex for data only which only matches \"beta\". No other prerelease tag is allowed.", "createdAt": "2020-05-27T16:58:58Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11473", "merged": true, "mergeCommit": {"oid": "3847d7bf6319ff8b7964f89f559ffef0bd5bdbb9"}, "closed": true, "closedAt": "2020-05-28T16:15:17Z", "author": {"login": "JimSuplizio"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclb-IjgH2gAyNDIzOTg4MjQwOjQ1Zjk2Y2ZlNDgwYmVmNmE3ZDAzZmRkNWE1NDdjNTliYzAwMWE2M2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclupDKgH2gAyNDIzOTg4MjQwOjc2NjgxNDE1ZDhlNWZiZjRkMmM5MDQ0ZjFiOWVkY2FlYWU4MDFhNzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "45f96cfe480bef6a7d03fdd5a547c59bc001a63a", "author": {"user": {"login": "JimSuplizio", "name": "James Suplizio"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/45f96cfe480bef6a7d03fdd5a547c59bc001a63a", "committedDate": "2020-05-27T16:36:35Z", "message": "allow data libraries to have 'beta' as well as 'beta.X' prerelease"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzQxNTc1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11473#pullrequestreview-419741575", "createdAt": "2020-05-28T02:49:01Z", "commit": {"oid": "45f96cfe480bef6a7d03fdd5a547c59bc001a63a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwMjo0OTowMVrOGbj30A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwMjo0OTowMVrOGbj30A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU1MjQ2NA==", "bodyText": "While this works you could also change it to -match '.*-beta(\\.\\d*)?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11473#discussion_r431552464", "createdAt": "2020-05-28T02:49:01Z", "author": {"login": "weshaggard"}, "path": "eng/versioning/scan_for_unreleased_dependencies.ps1", "diffHunk": "@@ -34,7 +34,7 @@ Get-ChildItem -Path $serviceDirectory -Filter pom*.xml -Recurse -File | ForEach-\n         $script:FoundPomFile = $true\n         Write-Host \"Found pom file with matching groupId($($inputGroupId))/artifactId($($inputArtifactId)), pomFile=$($pomFile)\"\n         $version = $xmlPomFile.project.version\n-        if ($version -like '*-beta.*')\n+        if ($version -like '*-beta.*' -or $version -like '*-beta')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f96cfe480bef6a7d03fdd5a547c59bc001a63a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzQyOTUz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11473#pullrequestreview-419742953", "createdAt": "2020-05-28T02:53:43Z", "commit": {"oid": "45f96cfe480bef6a7d03fdd5a547c59bc001a63a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwMjo1Mzo0M1rOGbj8IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwMjo1Mzo0M1rOGbj8IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU1MzU2OA==", "bodyText": "Do we even know if this is the pattern then want for track 1? I kind of feel like if they don't want to follow the full guidance then we should simply not have support for incrementing their versions. Maybe we should just ignore version increments for those.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11473#discussion_r431553568", "createdAt": "2020-05-28T02:53:43Z", "author": {"login": "weshaggard"}, "path": "eng/versioning/set_versions.py", "diffHunk": "@@ -249,10 +251,21 @@ def increment_library_version(build_type, artifact_id, group_id):\n                         # This is the case where, somehow, the versioning verification has failed and\n                         # the prerelease verification doesn't match \"beta.X\"\n                         if prever is None:\n-                            raise ValueError('library_to_update ({}:{}) has an invalid prerelease version ({}) which should be of the format beta.X'.format(library_to_update, module.current, vmatch.group('prerelease')))\n-                        rev = int(prever.group('revision'))\n-                        rev += 1\n-                        new_version = '{}.{}.{}-beta.{}'.format(vmatch.group('major'), vmatch.group('minor'), vmatch.group('patch'), str(rev))\n+                            # if the build_type isn't data then error\n+                            if build_type.name.lower() != 'data':\n+                                raise ValueError('library_to_update ({}:{}) has an invalid prerelease version ({}) which should be of the format beta.X'.format(library_to_update, module.current, vmatch.group('prerelease')))\n+                            else:\n+                                # verify that prerelease is \"beta\"\n+                                if prerelease_data_regex.match(vmatch.group('prerelease')) is None:\n+                                    raise ValueError('library_to_update ({}:{}) has an invalid prerelease version ({}) which should be of the format (beta) or (beta.X)'.format(library_to_update, module.current, vmatch.group('prerelease')))\n+                                # in the case there the prerelease version is just \"beta\", increment the minor and set the patch to 0\n+                                minor = int(vmatch.group('minor'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f96cfe480bef6a7d03fdd5a547c59bc001a63a"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzQzMjIy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11473#pullrequestreview-419743222", "createdAt": "2020-05-28T02:54:38Z", "commit": {"oid": "45f96cfe480bef6a7d03fdd5a547c59bc001a63a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzY4MDcz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11473#pullrequestreview-419768073", "createdAt": "2020-05-28T04:25:41Z", "commit": {"oid": "45f96cfe480bef6a7d03fdd5a547c59bc001a63a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76681415d8e5fbf4d2c9044f1b9edcaeae801a78", "author": {"user": {"login": "JimSuplizio", "name": "James Suplizio"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/76681415d8e5fbf4d2c9044f1b9edcaeae801a78", "committedDate": "2020-05-28T14:21:45Z", "message": "change -like to -match for beta detection"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3951, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}