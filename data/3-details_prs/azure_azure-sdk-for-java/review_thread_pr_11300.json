{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5ODkxNTI3", "number": 11300, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMTozMjowOVrOETADMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjo0OToyMlrOETdH_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzU5MjE3OnYy", "diffSide": "RIGHT", "path": "sdk/e2e/src/main/java/com/azure/endtoend/identity/MultiTenantTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMTozMjowOVrOG4fqiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMTozNDozOVrOG4fvBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg5MjIzMg==", "bodyText": "so, your instructions cover to disable 2FA for the username ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#discussion_r461892232", "createdAt": "2020-07-28T21:32:09Z", "author": {"login": "g2vinay"}, "path": "sdk/e2e/src/main/java/com/azure/endtoend/identity/MultiTenantTest.java", "diffHunk": "@@ -0,0 +1,164 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.endtoend.identity;\n+\n+import com.azure.core.credential.AccessToken;\n+import com.azure.core.credential.TokenRequestContext;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.ClientSecretCredential;\n+import com.azure.identity.ClientSecretCredentialBuilder;\n+import com.azure.identity.UsernamePasswordCredential;\n+import com.azure.identity.UsernamePasswordCredentialBuilder;\n+import com.microsoft.azure.AzureEnvironment;\n+import com.microsoft.azure.credentials.AzureTokenCredentials;\n+import com.microsoft.azure.management.graphrbac.ActiveDirectoryUser;\n+import com.microsoft.azure.management.graphrbac.implementation.GraphRbacManager;\n+\n+import java.io.IOException;\n+import java.util.Locale;\n+\n+/**\n+ * Runs Identity tests across multiple tests.\n+ */\n+class MultiTenantTest {\n+    private static final String AZURE_MULTI_TENANT_TEST_MODE = \"AZURE_MULTI_TENANT_TEST_MODE\";\n+    private static final String AZURE_USER_NAME = \"AZURE_USER_NAME\";\n+    private static final String AZURE_USER_PASSWORD = \"AZURE_USER_PASSWORD\";\n+    private static final String AZURE_CLIENT_ID = \"AZURE_CLIENT_ID\";\n+    private static final String AZURE_CLIENT_SECRET = \"AZURE_CLIENT_SECRET\";\n+    private static final String AZURE_TENANT_ID = \"AZURE_TENANT_ID\";\n+    private static final Configuration CONFIGURATION = Configuration.getGlobalConfiguration().clone();\n+    private final ClientLogger logger = new ClientLogger(MultiTenantTest.class);\n+\n+    /**\n+     * Runs the multi tenant identity tests\n+     * @throws IllegalStateException if AZURE_MULTI_TENANT_TEST_MODE is not set to \"user\" or \"sp\"\n+     */\n+    void run() throws IllegalStateException {\n+        if (CoreUtils.isNullOrEmpty(CONFIGURATION.get(AZURE_MULTI_TENANT_TEST_MODE))) {\n+            throw logger.logExceptionAsError(new IllegalStateException(\"Test mode is not set. Set environment \"\n+                                                + \"variable AZURE_MULTI_TENANT_TEST_MODE to user or sp\"));\n+        }\n+\n+        String mode = CONFIGURATION.get(AZURE_MULTI_TENANT_TEST_MODE).toLowerCase(Locale.ENGLISH);\n+        switch (mode) {\n+            case \"user\":\n+                testUserPasswordCanAccessGraph();\n+                break;\n+            case \"sp\":\n+                testServicePrincipalCanAccessGraph();\n+                break;\n+            default:\n+                throw logger.logExceptionAsError(\n+                    new IllegalStateException(\"Invalid Test mode is configured AZURE_MULTI_TENANT_TEST_MODE. \"\n+                                                    + \"Possible values are user or sp.\"));\n+        }\n+    }\n+\n+    private void testUserPasswordCanAccessGraph() {\n+        assertConfigPresence(AZURE_CLIENT_ID,\n+            \"testUserPasswordCanAccessGraph - AZURE_CLIENT_ID not configured in the environment.\");\n+        assertConfigPresence(AZURE_TENANT_ID,\n+            \"testUserPasswordCanAccessGraph - AZURE_TENANT_ID not configured in the environment.\");\n+        assertConfigPresence(AZURE_USER_NAME,\n+            \"testUserPasswordCanAccessGraph - AZURE_USER_NAME not configured in the environment.\");\n+        assertConfigPresence(AZURE_USER_PASSWORD,\n+            \"testUserPasswordCanAccessGraph - AZURE_USER_PASSWORD not configured in the environment.\");\n+        String clientId = CONFIGURATION.get(AZURE_CLIENT_ID);\n+        String tenantId = CONFIGURATION.get(AZURE_TENANT_ID);\n+        String username = CONFIGURATION.get(AZURE_USER_NAME);\n+        String password = CONFIGURATION.get(AZURE_USER_PASSWORD);\n+\n+        UsernamePasswordCredential credential = new UsernamePasswordCredentialBuilder()\n+            .clientId(clientId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39bded1e251a8e38dff25eeeac5cf60d2a121be7"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg5MzM4Mw==", "bodyText": "This has to be done in a separate tenant - cannot be done from the Microsoft corporate tenant. By default 2FA is turned off in any new tenant.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#discussion_r461893383", "createdAt": "2020-07-28T21:34:39Z", "author": {"login": "jianghaolu"}, "path": "sdk/e2e/src/main/java/com/azure/endtoend/identity/MultiTenantTest.java", "diffHunk": "@@ -0,0 +1,164 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.endtoend.identity;\n+\n+import com.azure.core.credential.AccessToken;\n+import com.azure.core.credential.TokenRequestContext;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.ClientSecretCredential;\n+import com.azure.identity.ClientSecretCredentialBuilder;\n+import com.azure.identity.UsernamePasswordCredential;\n+import com.azure.identity.UsernamePasswordCredentialBuilder;\n+import com.microsoft.azure.AzureEnvironment;\n+import com.microsoft.azure.credentials.AzureTokenCredentials;\n+import com.microsoft.azure.management.graphrbac.ActiveDirectoryUser;\n+import com.microsoft.azure.management.graphrbac.implementation.GraphRbacManager;\n+\n+import java.io.IOException;\n+import java.util.Locale;\n+\n+/**\n+ * Runs Identity tests across multiple tests.\n+ */\n+class MultiTenantTest {\n+    private static final String AZURE_MULTI_TENANT_TEST_MODE = \"AZURE_MULTI_TENANT_TEST_MODE\";\n+    private static final String AZURE_USER_NAME = \"AZURE_USER_NAME\";\n+    private static final String AZURE_USER_PASSWORD = \"AZURE_USER_PASSWORD\";\n+    private static final String AZURE_CLIENT_ID = \"AZURE_CLIENT_ID\";\n+    private static final String AZURE_CLIENT_SECRET = \"AZURE_CLIENT_SECRET\";\n+    private static final String AZURE_TENANT_ID = \"AZURE_TENANT_ID\";\n+    private static final Configuration CONFIGURATION = Configuration.getGlobalConfiguration().clone();\n+    private final ClientLogger logger = new ClientLogger(MultiTenantTest.class);\n+\n+    /**\n+     * Runs the multi tenant identity tests\n+     * @throws IllegalStateException if AZURE_MULTI_TENANT_TEST_MODE is not set to \"user\" or \"sp\"\n+     */\n+    void run() throws IllegalStateException {\n+        if (CoreUtils.isNullOrEmpty(CONFIGURATION.get(AZURE_MULTI_TENANT_TEST_MODE))) {\n+            throw logger.logExceptionAsError(new IllegalStateException(\"Test mode is not set. Set environment \"\n+                                                + \"variable AZURE_MULTI_TENANT_TEST_MODE to user or sp\"));\n+        }\n+\n+        String mode = CONFIGURATION.get(AZURE_MULTI_TENANT_TEST_MODE).toLowerCase(Locale.ENGLISH);\n+        switch (mode) {\n+            case \"user\":\n+                testUserPasswordCanAccessGraph();\n+                break;\n+            case \"sp\":\n+                testServicePrincipalCanAccessGraph();\n+                break;\n+            default:\n+                throw logger.logExceptionAsError(\n+                    new IllegalStateException(\"Invalid Test mode is configured AZURE_MULTI_TENANT_TEST_MODE. \"\n+                                                    + \"Possible values are user or sp.\"));\n+        }\n+    }\n+\n+    private void testUserPasswordCanAccessGraph() {\n+        assertConfigPresence(AZURE_CLIENT_ID,\n+            \"testUserPasswordCanAccessGraph - AZURE_CLIENT_ID not configured in the environment.\");\n+        assertConfigPresence(AZURE_TENANT_ID,\n+            \"testUserPasswordCanAccessGraph - AZURE_TENANT_ID not configured in the environment.\");\n+        assertConfigPresence(AZURE_USER_NAME,\n+            \"testUserPasswordCanAccessGraph - AZURE_USER_NAME not configured in the environment.\");\n+        assertConfigPresence(AZURE_USER_PASSWORD,\n+            \"testUserPasswordCanAccessGraph - AZURE_USER_PASSWORD not configured in the environment.\");\n+        String clientId = CONFIGURATION.get(AZURE_CLIENT_ID);\n+        String tenantId = CONFIGURATION.get(AZURE_TENANT_ID);\n+        String username = CONFIGURATION.get(AZURE_USER_NAME);\n+        String password = CONFIGURATION.get(AZURE_USER_PASSWORD);\n+\n+        UsernamePasswordCredential credential = new UsernamePasswordCredentialBuilder()\n+            .clientId(clientId)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg5MjIzMg=="}, "originalCommit": {"oid": "39bded1e251a8e38dff25eeeac5cf60d2a121be7"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4ODM1NTgwOnYy", "diffSide": "RIGHT", "path": "sdk/e2e/pom.xml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjo0OToyMlrOG5M8sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMDoyNzo0NFrOG5Oycg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYzNDE2MA==", "bodyText": "You need to add a version tag here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#discussion_r462634160", "createdAt": "2020-07-29T22:49:22Z", "author": {"login": "weshaggard"}, "path": "sdk/e2e/pom.xml", "diffHunk": "@@ -55,6 +55,11 @@\n       <artifactId>slf4j-api</artifactId>\n       <version>1.7.28</version> <!-- {x-version-update;org.slf4j:slf4j-api;external_dependency} -->\n     </dependency>\n+    <dependency>\n+      <groupId>com.microsoft.azure</groupId>\n+      <artifactId>azure-mgmt-graph-rbac</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "435e649bc985fbb492c158276a56b9b151e2b64c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY0MjQzNg==", "bodyText": "Thanks - is there a reason why no pipeline job is running on this PR?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#discussion_r462642436", "createdAt": "2020-07-29T23:14:22Z", "author": {"login": "jianghaolu"}, "path": "sdk/e2e/pom.xml", "diffHunk": "@@ -55,6 +55,11 @@\n       <artifactId>slf4j-api</artifactId>\n       <version>1.7.28</version> <!-- {x-version-update;org.slf4j:slf4j-api;external_dependency} -->\n     </dependency>\n+    <dependency>\n+      <groupId>com.microsoft.azure</groupId>\n+      <artifactId>azure-mgmt-graph-rbac</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYzNDE2MA=="}, "originalCommit": {"oid": "435e649bc985fbb492c158276a56b9b151e2b64c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY2NDMwNg==", "bodyText": "This particular path doesn't have a pipeline setup for it. I suggest either adding one or adding it to run the core pipeline.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#discussion_r462664306", "createdAt": "2020-07-30T00:27:44Z", "author": {"login": "weshaggard"}, "path": "sdk/e2e/pom.xml", "diffHunk": "@@ -55,6 +55,11 @@\n       <artifactId>slf4j-api</artifactId>\n       <version>1.7.28</version> <!-- {x-version-update;org.slf4j:slf4j-api;external_dependency} -->\n     </dependency>\n+    <dependency>\n+      <groupId>com.microsoft.azure</groupId>\n+      <artifactId>azure-mgmt-graph-rbac</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYzNDE2MA=="}, "originalCommit": {"oid": "435e649bc985fbb492c158276a56b9b151e2b64c"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4173, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}