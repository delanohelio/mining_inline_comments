{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMzM2MTUw", "number": 14282, "title": "Performance: +3.4% avoid expensive unescape when not needed", "bodyText": "StringEscapeUtils.unescapeJava is very expensive taking ~2.25% CPU samples.\nThe code path us only if the item has escape characters. The optimization by-passes for ids with-out escape characters.\n\nWith-out fix :  82, 79, 80, 81, 79 = AVG = 80.2\nWith fix        : 78, 77, 78, 77, 77 = AVG = 77.4", "createdAt": "2020-08-19T18:24:44Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14282", "merged": true, "mergeCommit": {"oid": "9b1db332d15533a4c8ba32b52520c44a0820e035"}, "closed": true, "closedAt": "2020-08-25T16:49:36Z", "author": {"login": "kirankumarkolli"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_uO3hgH2gAyNDcwMzM2MTUwOmIxZWM5NDVlNWIxZWIzNTUxMTUzZjk4MmEwOWViNWFlOTZlMjA0NGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCVuzsgH2gAyNDcwMzM2MTUwOmY1YjQyNDc0MDQyNDYyNWM4YTgyZGQyNzk1MTgyMWJhZjRhYWY4MDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b1ec945e5b1eb3551153f982a09eb5ae96e2044a", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b1ec945e5b1eb3551153f982a09eb5ae96e2044a", "committedDate": "2020-08-17T08:35:11Z", "message": "Optimied implementation to extract the resourceId.\n\nnew implementation avoid expensive StringUtils.Split"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44bb449e702474293567ad0e52cfdb242555bf95", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/44bb449e702474293567ad0e52cfdb242555bf95", "committedDate": "2020-08-17T08:55:35Z", "message": "Some more extra validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcd3f2a485cb0681646d767e91ab1aee285adf13", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fcd3f2a485cb0681646d767e91ab1aee285adf13", "committedDate": "2020-08-17T12:09:47Z", "message": "Substring endindex bug fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8e5f7904a2353fcb51bd2f1d358ada789a71910", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d8e5f7904a2353fcb51bd2f1d358ada789a71910", "committedDate": "2020-08-19T02:30:09Z", "message": "Merge branch 'master' into users/kirankk/dsr_extract_id_fromUri"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e0c20f947d6c7d184a742ac0492b971e3a3529b", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5e0c20f947d6c7d184a742ac0492b971e3a3529b", "committedDate": "2020-08-19T03:23:27Z", "message": "Remove some more dead code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcd70ee714edf66dbc5bf243785baf159ffc7bcc", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/dcd70ee714edf66dbc5bf243785baf159ffc7bcc", "committedDate": "2020-08-19T05:26:24Z", "message": "Some more escape optimizations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fe702116b7ba869fec94249d631421a2dea17cb", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8fe702116b7ba869fec94249d631421a2dea17cb", "committedDate": "2020-08-19T17:29:04Z", "message": "Merge branch 'master' into users/kirankk/users/kirankk/dsr_extract_id_fromUri_1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f0b45dd4b3ea790c0f5ad7d08487d6aba511c7a", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f0b45dd4b3ea790c0f5ad7d08487d6aba511c7a", "committedDate": "2020-08-19T17:44:01Z", "message": "Reverting an unrelated change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNzMwODYy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14282#pullrequestreview-470730862", "createdAt": "2020-08-19T18:28:07Z", "commit": {"oid": "1f0b45dd4b3ea790c0f5ad7d08487d6aba511c7a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODoyODowOFrOHDUGgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODoyODowOFrOHDUGgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzNzEyMA==", "bodyText": "Any specific reason why are we not using primitive types here -> char ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14282#discussion_r473237120", "createdAt": "2020-08-19T18:28:08Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/Paths.java", "diffHunk": "@@ -8,6 +8,8 @@\n  */\n public class Paths {\n     static final String ROOT = \"/\";\n+    static final Character ROOT_CHAR = '/';\n+    static final Character ESCAPE_CHAR = '\\\\';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f0b45dd4b3ea790c0f5ad7d08487d6aba511c7a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNzMxNTI0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14282#pullrequestreview-470731524", "createdAt": "2020-08-19T18:29:03Z", "commit": {"oid": "1f0b45dd4b3ea790c0f5ad7d08487d6aba511c7a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODoyOTowM1rOHDUIiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODoyOTowM1rOHDUIiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzNzY0Mw==", "bodyText": "Because using Character class here will result in auto-boxing later in your code below.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14282#discussion_r473237643", "createdAt": "2020-08-19T18:29:03Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/Paths.java", "diffHunk": "@@ -8,6 +8,8 @@\n  */\n public class Paths {\n     static final String ROOT = \"/\";\n+    static final Character ROOT_CHAR = '/';\n+    static final Character ESCAPE_CHAR = '\\\\';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzNzEyMA=="}, "originalCommit": {"oid": "1f0b45dd4b3ea790c0f5ad7d08487d6aba511c7a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNzMwOTgx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14282#pullrequestreview-470730981", "createdAt": "2020-08-19T18:28:19Z", "commit": {"oid": "1f0b45dd4b3ea790c0f5ad7d08487d6aba511c7a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODoyOTo0OFrOHDUKEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODoyOTo0OFrOHDUKEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzODAzNA==", "bodyText": "please also consider a unit test for unescapeJavaAndTrim() implementation when escaping or not escaping case.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14282#discussion_r473238034", "createdAt": "2020-08-19T18:29:48Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/PathsHelper.java", "diffHunk": "@@ -441,24 +439,57 @@ public static PathInfo parseNameSegments(String resourceUrl, String[] segments)\n         if (segments.length % 2 == 0) {\n             // even number, assume it is individual resource\n             if (isResourceType(segments[segments.length - 2])) {\n-                return new PathInfo(false, segments[segments.length - 2],\n-                        StringEscapeUtils.unescapeJava(StringUtils.strip(resourceUrl, Paths.ROOT)), true);\n+                return new PathInfo(false,\n+                                    segments[segments.length - 2],\n+                                    unescapeJavaAndTrim(resourceUrl),\n+                         true);\n             }\n         } else {\n             // odd number, assume it is feed request\n             if (isResourceType(segments[segments.length - 1])) {\n-                return new PathInfo(true, segments[segments.length - 1],\n-                        StringEscapeUtils.unescapeJava(StringUtils.strip(\n-                                resourceUrl.substring(0,\n-                                        StringUtils.removeEnd(resourceUrl, Paths.ROOT).lastIndexOf(Paths.ROOT)),\n-                                Paths.ROOT)),\n-                        true);\n+                return new PathInfo(true,\n+                                    segments[segments.length - 1],\n+                                    unescapeJavaAndTrim(\n+                                        resourceUrl.substring(0,\n+                                                StringUtils.removeEnd(resourceUrl, Paths.ROOT).lastIndexOf(Paths.ROOT))),\n+                         true);\n             }\n         }\n \n         return null;\n     }\n \n+    private static String unescapeJavaAndTrim(String resourceUrl) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f0b45dd4b3ea790c0f5ad7d08487d6aba511c7a"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bd41053fd983f484364081ccca134009250454c", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9bd41053fd983f484364081ccca134009250454c", "committedDate": "2020-08-19T18:52:28Z", "message": "Move to primitive types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNzY0NDgw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14282#pullrequestreview-470764480", "createdAt": "2020-08-19T19:17:54Z", "commit": {"oid": "9bd41053fd983f484364081ccca134009250454c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "807bf4cba64f4a943413f5119983a2b068610cd9", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/807bf4cba64f4a943413f5119983a2b068610cd9", "committedDate": "2020-08-20T16:45:39Z", "message": "Merge branch 'master' into users/kirankk/path_helper_opt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5b424740424625c8a82dd27951821baf4aaf801", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f5b424740424625c8a82dd27951821baf4aaf801", "committedDate": "2020-08-25T11:44:13Z", "message": "Adding unittests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 299, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}