{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NjgwNDEx", "number": 17183, "title": "Added support for key export.", "bodyText": "Fixes #14806.\nTests are pending.", "createdAt": "2020-11-04T22:43:21Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183", "merged": true, "mergeCommit": {"oid": "ec65c91f2d1e1fca70e20af8ecf02c2619c792fd"}, "closed": true, "closedAt": "2020-11-11T19:29:41Z", "author": {"login": "vcolin7"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZVjJIAH2gAyNTE1NjgwNDExOjUxMTdiZDk4ZDg3Mjk5NzUyMTdiYjdlYWUzNDlhZTExOTU3NjQwNWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbi5CoAFqTUyODQ2MDYyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5117bd98d8729975217bb7eae349ae119576405f", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5117bd98d8729975217bb7eae349ae119576405f", "committedDate": "2020-11-04T22:31:44Z", "message": "Added support for exporting keys from an Azure Key Vault."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ca8083392497a466e74c8584cc34ba2e645e83c", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6ca8083392497a466e74c8584cc34ba2e645e83c", "committedDate": "2020-11-04T22:41:14Z", "message": "Removed ExportKeyOptions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "245304177be4a2bd2d0d4aa4d4de62620b41d0cf", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/245304177be4a2bd2d0d4aa4d4de62620b41d0cf", "committedDate": "2020-11-05T07:35:41Z", "message": "Fixed build error."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78aed4e478fe5efc436361f205c731648bb25ed0", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/78aed4e478fe5efc436361f205c731648bb25ed0", "committedDate": "2020-11-05T08:18:28Z", "message": "Added samples."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05ad9d3c8d715dedbdc8915c1cfa9ae006b3a449", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/05ad9d3c8d715dedbdc8915c1cfa9ae006b3a449", "committedDate": "2020-11-05T08:30:57Z", "message": "Fixed test issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1c0f4edd3aa1226a0476c0533e3b239d6e72b3a", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a1c0f4edd3aa1226a0476c0533e3b239d6e72b3a", "committedDate": "2020-11-05T08:46:36Z", "message": "Fixed samples issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73dd7654da488a5b4a7ba28e3b604bd9b9df3b42", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/73dd7654da488a5b4a7ba28e3b604bd9b9df3b42", "committedDate": "2020-11-05T10:10:02Z", "message": "Fixed checkstyle issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4f594cb5994168c5264fa59521b12ea3f4a77bdd", "committedDate": "2020-11-05T10:56:49Z", "message": "Fixed spotbugs issues."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0ODA4ODI1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#pullrequestreview-524808825", "createdAt": "2020-11-06T02:07:37Z", "commit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwMjowNzozN1rOHudnkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwMjowNzozN1rOHudnkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ4MTgxMQ==", "bodyText": "Was this missing from previous versions?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#discussion_r518481811", "createdAt": "2020-11-06T02:07:37Z", "author": {"login": "heaths"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/KeyRequestAttributes.java", "diffHunk": "@@ -74,6 +76,12 @@\n     @JsonProperty(value = \"updated\", access = JsonProperty.Access.WRITE_ONLY)\n     private Long updated;\n \n+    /**\n+     * Indicates if the private key can be exported.\n+     */\n+    @JsonProperty(value = \"exportable\")\n+    private Boolean exportable;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTcxMTY5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#pullrequestreview-525571169", "createdAt": "2020-11-07T00:42:25Z", "commit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMDo0MjoyNVrOHvBg3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMDo0MjoyNVrOHvBg3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA2OTkxOQ==", "bodyText": "Version is not actually required, but you send it as an empty string? Wouldn't null make more sense, or is that not idiomatic with Java? If null is okay, I wouldn't validate that it's non-null in the overload. If they use that one and still pass null, it should be as acceptable as calling this overload.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#discussion_r519069919", "createdAt": "2020-11-07T00:42:25Z", "author": {"login": "heaths"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/KeyAsyncClient.java", "diffHunk": "@@ -492,14 +496,108 @@ Duration getDefaultPollingInterval() {\n         KeyImportRequestParameters parameters = new KeyImportRequestParameters()\n             .setKey(importKeyOptions.getKey())\n             .setHsm(importKeyOptions.isHardwareProtected())\n-            .setKeyAttributes(new KeyRequestAttributes(importKeyOptions));\n+            .setKeyAttributes(new KeyRequestAttributes(importKeyOptions))\n+            .setKeyReleasePolicy(importKeyOptions.getKeyReleasePolicy());\n         return service.importKey(vaultUrl, importKeyOptions.getName(), apiVersion, ACCEPT_LANGUAGE, parameters,\n             CONTENT_TYPE_HEADER_VALUE, context.addData(AZ_TRACING_NAMESPACE_KEY, KEYVAULT_TRACING_NAMESPACE_VALUE))\n             .doOnRequest(ignored -> logger.info(\"Importing key - {}\", importKeyOptions.getName()))\n             .doOnSuccess(response -> logger.info(\"Imported key - {}\", response.getValue().getName()))\n             .doOnError(error -> logger.warning(\"Failed to import key - {}\", importKeyOptions.getName(), error));\n     }\n \n+    /**\n+     * Exports the latest version of a key from the key vault. The export key operation may be used to import any key\n+     * from the Azure Key Vault as long as it is marked as exportable and its release policy is satisfied.\n+     *\n+     * <p><strong>Code Samples</strong></p>\n+     * <p>Exports a key from a key vault. Subscribes to the call asynchronously and prints out the newly exported key\n+     * details when a response has been received.</p>\n+     *\n+     * {@codesnippet com.azure.security.keyvault.keys.keyasyncclient.exportKey#String-String}\n+     *\n+     * @param name The name of the key to be exported.\n+     * @param environment The target environment assertion.\n+     * @return A {@link Mono} containing the {@link KeyVaultKey exported key}.\n+     * @throws NullPointerException If the specified {@code name} or {@code environment} are {@code null}.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<KeyVaultKey> exportKey(String name, String environment) {\n+        try {\n+            return exportKeyWithResponse(name, \"\", environment).flatMap(FluxUtil::toMono);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTczMTg4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#pullrequestreview-525573188", "createdAt": "2020-11-07T00:53:40Z", "commit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMDo1Mzo0MFrOHvBolA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMDo1Mzo0MFrOHvBolA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA3MTg5Mg==", "bodyText": "Given the swagger is \"release_policy\", I think these should actually be ReleasePolicy instead of KeyReleasePolicy. That was in the original bug as well.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#discussion_r519071892", "createdAt": "2020-11-07T00:53:40Z", "author": {"login": "heaths"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/KeyAsyncClient.java", "diffHunk": "@@ -213,7 +213,8 @@ Duration getDefaultPollingInterval() {\n         KeyRequestParameters parameters = new KeyRequestParameters()\n             .setKty(createKeyOptions.getKeyType())\n             .setKeyOps(createKeyOptions.getKeyOperations())\n-            .setKeyAttributes(new KeyRequestAttributes(createKeyOptions));\n+            .setKeyAttributes(new KeyRequestAttributes(createKeyOptions))\n+            .setKeyReleasePolicy(createKeyOptions.getKeyReleasePolicy());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTc1NDU0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#pullrequestreview-525575454", "createdAt": "2020-11-07T01:08:07Z", "commit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMTowODowOFrOHvBxlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMTowODowOFrOHvBxlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA3NDE5Ng==", "bodyText": "You also might not want to encode this. It's tight coupling. Sending null is fine (not required), in which case this is what the server should default to.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#discussion_r519074196", "createdAt": "2020-11-07T01:08:08Z", "author": {"login": "heaths"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/models/KeyReleasePolicy.java", "diffHunk": "@@ -0,0 +1,67 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.security.keyvault.keys.models;\n+\n+import com.azure.core.annotation.Fluent;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+/**\n+ * Class that contains the policy rules under which the key can be exported.\n+ */\n+@Fluent\n+public class KeyReleasePolicy {\n+    /**\n+     * Content type and version of key release policy. The default value is:\n+     * 'application/json; charset=utf-8; version=1.0'.\n+     */\n+    @JsonProperty(value = \"contentType\")\n+    private String contentType = \"application/json; charset=utf-8; version=1.0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTgxNDUy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#pullrequestreview-525581452", "createdAt": "2020-11-07T01:57:49Z", "commit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMTo1Nzo0OVrOHvCK7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwMTo1Nzo0OVrOHvCK7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA4MDY4NQ==", "bodyText": "Given you're copying this around and because KeyProperties needs it anyway, perhaps we should just define it on KeyProperties, which means KeyVaultBundle.properties.releasePolicy is where'd you get it.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#discussion_r519080685", "createdAt": "2020-11-07T01:57:49Z", "author": {"login": "heaths"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/KeyAsyncClient.java", "diffHunk": "@@ -659,7 +757,8 @@ Duration getDefaultPollingInterval() {\n         context = context == null ? Context.NONE : context;\n         KeyRequestParameters parameters = new KeyRequestParameters()\n             .setTags(keyProperties.getTags())\n-            .setKeyAttributes(new KeyRequestAttributes(keyProperties));\n+            .setKeyAttributes(new KeyRequestAttributes(keyProperties))\n+            .setKeyReleasePolicy(keyProperties.getKeyReleasePolicy());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f594cb5994168c5264fa59521b12ea3f4a77bdd"}, "originalPosition": 147}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "971ac37de3c2aaea534b5a1c832c0e1dd37f48b5", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/971ac37de3c2aaea534b5a1c832c0e1dd37f48b5", "committedDate": "2020-11-07T03:02:04Z", "message": "Applied PR feedback: renamed KeyReleasePolicy to ReleasePolicy and removed it from KeyVaultKey."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efa5120033d92502e13282bfe132ccea3449913f", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/efa5120033d92502e13282bfe132ccea3449913f", "committedDate": "2020-11-07T03:20:51Z", "message": "Fixed spotbugs issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "575190ddb8a754bcc3175365ad54b59faf366f2d", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/575190ddb8a754bcc3175365ad54b59faf366f2d", "committedDate": "2020-11-09T20:41:44Z", "message": "Added unit tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21decf5289c8089f25606556cda8375b6ecaac17", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/21decf5289c8089f25606556cda8375b6ecaac17", "committedDate": "2020-11-11T11:07:52Z", "message": "Renamed ReleasePolicy to KeyReleasePolicy. Added tests for creating an RSA key with publicExponent."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NDYwNjIz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17183#pullrequestreview-528460623", "createdAt": "2020-11-11T19:12:16Z", "commit": {"oid": "21decf5289c8089f25606556cda8375b6ecaac17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 235, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}