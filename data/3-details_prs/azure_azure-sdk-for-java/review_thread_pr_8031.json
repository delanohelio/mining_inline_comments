{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNTY0ODEz", "number": 8031, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxOTo1OToxMlrODeInUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMTowNDoyN1rODeJpQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyOTI1MDA5OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/microsoft-azure-cosmos/src/test/java/com/azure/data/cosmos/rx/LogLevelTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxOTo1OToxMlrOFnIo7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxOTo1OToxMlrOFnIo7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MDMzMw==", "bodyText": "ditto", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376580333", "createdAt": "2020-02-07T19:59:12Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/microsoft-azure-cosmos/src/test/java/com/azure/data/cosmos/rx/LogLevelTest.java", "diffHunk": "@@ -197,16 +235,16 @@ public void createDocumentWithDebugLevelAtRoot() throws Exception {\n     /**\n      * This test will try to create document with netty wire ERROR logging and\n      * validate it.\n-     * \n+     *\n      * @throws Exception\n      */\n     @Test(groups = { \"simple\" }, timeOut = TIMEOUT)\n     public void createDocumentWithErrorClient() throws Exception {\n-        LogManager.getRootLogger().setLevel(Level.INFO);\n-        LogManager.getLogger(NETWORK_LOGGING_CATEGORY).setLevel(Level.ERROR);\n-        StringWriter consoleWriter = new StringWriter();\n-        WriterAppender appender = new WriterAppender(new PatternLayout(), consoleWriter);\n-        Logger.getLogger(NETWORK_LOGGING_CATEGORY).addAppender(appender);\n+        final StringWriter consoleWriter = new StringWriter();\n+\n+        addAppenderAndLogger(NETWORK_LOGGING_CATEGORY, Level.ERROR, APPENDER_NAME, consoleWriter);\n+        Logger logger = LoggerFactory.getLogger(NETWORK_LOGGING_CATEGORY);\n+        Assert.assertTrue(logger.isErrorEnabled());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361"}, "originalPosition": 206}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyOTI1ODgzOnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/microsoft-azure-cosmos-benchmark/src/test/java/com/azure/data/cosmos/benchmark/LoggerConfigurationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMDowMjozMVrOFnIuWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMDowMjozMVrOFnIuWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MTcyMg==", "bodyText": "We are using assertj for assertion, please use this instead:\nimport static org.assertj.core.api.Assertions.assertThat;\n\nassertThat(logger.isErrorEnabled()).isTrue()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376581722", "createdAt": "2020-02-07T20:02:31Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/microsoft-azure-cosmos-benchmark/src/test/java/com/azure/data/cosmos/benchmark/LoggerConfigurationTest.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package com.azure.data.cosmos.benchmark;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+public class LoggerConfigurationTest {\n+    /**\n+     * Netty logging is off. We expect error logging to be disabled.\n+     */\n+    @Test(groups = {\"unit\"})\n+    public void nettyIsDisabled() {\n+        final Logger logger = LoggerFactory.getLogger(\"io.netty\");\n+        final Logger logger2 = LoggerFactory.getLogger(\"io.netty.channel\");\n+\n+        Assert.assertFalse(logger.isErrorEnabled());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyOTI1OTkwOnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/microsoft-azure-cosmos-benchmark/src/test/java/com/azure/data/cosmos/benchmark/LoggerConfigurationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMDowMjo1NlrOFnIu-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMDowMjo1NlrOFnIu-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MTg4Mw==", "bodyText": "ditto\nWe are using assertj for assertion, please use this instead:\nimport static org.assertj.core.api.Assertions.assertThat;\n\nassertThat(logger.isErrorEnabled()).isFase()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376581883", "createdAt": "2020-02-07T20:02:56Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/microsoft-azure-cosmos-benchmark/src/test/java/com/azure/data/cosmos/benchmark/LoggerConfigurationTest.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package com.azure.data.cosmos.benchmark;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+public class LoggerConfigurationTest {\n+    /**\n+     * Netty logging is off. We expect error logging to be disabled.\n+     */\n+    @Test(groups = {\"unit\"})\n+    public void nettyIsDisabled() {\n+        final Logger logger = LoggerFactory.getLogger(\"io.netty\");\n+        final Logger logger2 = LoggerFactory.getLogger(\"io.netty.channel\");\n+\n+        Assert.assertFalse(logger.isErrorEnabled());\n+        Assert.assertFalse(logger2.isErrorEnabled());\n+    }\n+\n+    /**\n+     * Loggers in the cosmos package should inherit root configuration and log at info.\n+     */\n+    @Test(groups = {\"unit\"})\n+    public void defaultLoggersAtInfo() {\n+        final Logger logger = LoggerFactory.getLogger(\"com.azure.cosmos.internal.query.aggregation\");\n+        final Logger logger2 = LoggerFactory.getLogger(\"com.azure.cosmos\");\n+\n+        Assert.assertTrue(logger.isInfoEnabled());\n+        Assert.assertTrue(logger2.isInfoEnabled());\n+\n+        Assert.assertFalse(logger.isDebugEnabled());\n+        Assert.assertFalse(logger2.isDebugEnabled());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyOTI2MDg1OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/microsoft-azure-cosmos/src/test/java/com/azure/data/cosmos/rx/LogLevelTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMDowMzoxN1rOFnIvjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMDowMzoxN1rOFnIvjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MjAzMA==", "bodyText": "here and everywhere else please,\nditto", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376582030", "createdAt": "2020-02-07T20:03:17Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/microsoft-azure-cosmos/src/test/java/com/azure/data/cosmos/rx/LogLevelTest.java", "diffHunk": "@@ -50,18 +60,30 @@ public void beforeClass() {\n         createdCollection = getSharedMultiPartitionCosmosContainer(client);\n     }\n \n+    @AfterMethod(groups = { \"simple\" })\n+    public void afterMethod() {\n+        resetLoggingConfiguration();\n+    }\n+\n+    @AfterClass(groups = { \"simple\" }, timeOut = SHUTDOWN_TIMEOUT)\n+    public void afterClass() {\n+        resetLoggingConfiguration();\n+    }\n+\n     /**\n      * This test will try to create document with netty wire DEBUG logging and\n      * validate it.\n-     * \n+     *\n      * @throws Exception\n      */\n     @Test(groups = { \"simple\" }, timeOut = TIMEOUT)\n     public void createDocumentWithDebugLevel() throws Exception {\n-        LogManager.getLogger(NETWORK_LOGGING_CATEGORY).setLevel(Level.DEBUG);\n-        StringWriter consoleWriter = new StringWriter();\n-        WriterAppender appender = new WriterAppender(new PatternLayout(), consoleWriter);\n-        LogManager.getLogger(NETWORK_LOGGING_CATEGORY).addAppender(appender);\n+        final StringWriter consoleWriter = new StringWriter();\n+\n+        addAppenderAndLogger(NETWORK_LOGGING_CATEGORY, Level.DEBUG, APPENDER_NAME, consoleWriter);\n+\n+        Logger logger = LoggerFactory.getLogger(NETWORK_LOGGING_CATEGORY);\n+        Assert.assertTrue(logger.isDebugEnabled());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyOTQxODg5OnYy", "diffSide": "LEFT", "path": "eng/versioning/external_dependencies.txt", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMTowNDoyN1rOFnKQMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMTowNDoyN1rOFnKQMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwNjc2OA==", "bodyText": "Removing this makes me very, very happy...log4j:log4j:1.2.17 is 8 years old.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376606768", "createdAt": "2020-02-07T21:04:27Z", "author": {"login": "JimSuplizio"}, "path": "eng/versioning/external_dependencies.txt", "diffHunk": "@@ -66,7 +66,6 @@ io.opentelemetry:opentelemetry-api;0.2.0\n io.opentelemetry:opentelemetry-sdk;0.2.0\n io.projectreactor:reactor-test;3.3.0.RELEASE\n junit:junit;4.13-beta-3\n-log4j:log4j;1.2.17", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0349e616cf71aaa03aed7b7ca539023ddc10d6c"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3254, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}