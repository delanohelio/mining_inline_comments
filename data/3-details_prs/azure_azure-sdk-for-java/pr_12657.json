{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMjA4NDYz", "number": 12657, "title": "Update to BOM publishing", "bodyText": "Once more with feeling...a rebase horked up the original PR.\nThe BOM release process isn't currently working because it uses the same release process as a library. The changes in this PR are as follows:\n\nCreated azure-sdk-template-bom which is a BOM file that can be used for testing purposes. The only library in that BOM file is the azure-sdk-template file.\nCreated archetype-java-release-pom-only.yml which removes the following steps:\n\n\nVersion verification - BOM files do not have an artifact version and are not subject to this step\nDoc publishing - BOM files do not have sources or javadoc and neither are they required to publish to Maven. There's nothing to publish to msdoc or github.io.\nVersion increment - Same as the first item in the list, no version control or version to increment.\nThe main reason a separate yml file was created was due to the fact that you can't skip steps that other steps depenOn without it being counted as a failure. Also, this is vastly simpler than the library publishing since it's literally sign->tag->publish\n\n\nSmall updates to existing BOM pom files.\n\n\nSpring's BOM file needed the the library artifact update tags removed (one of them didn't even have the correct version anyways).\nAdded the copy package to Spring's BOM file\nAdded the artifact update tag for dependencyChecker-maven-plugin to the azure-sdk-bom's pom file.\n\n\nThe updates to Publish-MavenPackages.ps1 are relatively simple. There doesn't have to be javadoc or sources jars, the way the logic was it was passing in -Djavadoc and -Dsources every time which was causing \"soft failures\" when they didn't exist (I say soft failure because it still published everything else, it just 'failed' because there was nothing to gpg sign).\nThe changes to eng/pipelines/templates/steps/java-publishing.yml were opportunistic. Tasks using powershell/pwsh end up getting wrapped in a wrapper script and you never see the arguments. The changes here follow a pattern that we've started adopting to change the task type which has a separate arguments that end up getting print out as part of a \"Formatted command: \" line instead of being swallowed by the generated script.\n\nIt's worth noting that any output that would or could print something out that's a secret is **'d out. All output is scanned and if something matches a secret it's starred. Examples, right from the logs are:\n\"-Drepo.password=\"\"***\"\"\" and -RepositoryPassword ***", "createdAt": "2020-06-30T18:06:07Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657", "merged": true, "mergeCommit": {"oid": "2336b055047989bf36bb7d122ddf825bcc650b08"}, "closed": true, "closedAt": "2020-06-30T23:16:41Z", "author": {"login": "JimSuplizio"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwZmWrAH2gAyNDQyMjA4NDYzOjJmMmNhNjk1ZDhiY2Y2YzVlYzQ3YzBmMmM2YzczMDI4NTJiNzRjZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2tjpBgFqTQ1MTQwODcwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2f2ca695d8bcf6c5ec47c0f2c6c7302852b74ce0", "author": {"user": {"login": "JimSuplizio", "name": "James Suplizio"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2f2ca695d8bcf6c5ec47c0f2c6c7302852b74ce0", "committedDate": "2020-06-30T18:03:58Z", "message": "Update to BOM publishing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe39fc4fe690b376b118c99276cfa110becc1363", "author": {"user": {"login": "JimSuplizio", "name": "James Suplizio"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fe39fc4fe690b376b118c99276cfa110becc1363", "committedDate": "2020-06-30T18:14:07Z", "message": "Missing beginning plugins tag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMzUzNjU1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#pullrequestreview-440353655", "createdAt": "2020-06-30T20:17:07Z", "commit": {"oid": "fe39fc4fe690b376b118c99276cfa110becc1363"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoxNzowOFrOGrM5wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoxODoxNFrOGrM7-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MzM0Ng==", "bodyText": "Should this write the password?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447953346", "createdAt": "2020-06-30T20:17:08Z", "author": {"login": "alzimmermsft"}, "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -266,18 +280,21 @@ foreach ($packageDetail in $packageDetails) {\n \n   if ($RepositoryUrl -match \"https://pkgs.dev.azure.com/azure-sdk/\\b(internal|public)\\b/*\") {\n     Write-Information \"GPG Signing and deploying package in one step to devops feed: $RepositoryUrl\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"-Durl=$RepositoryUrl`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"-Drepo.password=$RepositoryPassword`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe39fc4fe690b376b118c99276cfa110becc1363"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MzY2Ng==", "bodyText": "Should this write $gpgexeOption? This would include the password.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447953666", "createdAt": "2020-06-30T20:17:49Z", "author": {"login": "alzimmermsft"}, "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -266,18 +280,21 @@ foreach ($packageDetail in $packageDetails) {\n \n   if ($RepositoryUrl -match \"https://pkgs.dev.azure.com/azure-sdk/\\b(internal|public)\\b/*\") {\n     Write-Information \"GPG Signing and deploying package in one step to devops feed: $RepositoryUrl\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"-Durl=$RepositoryUrl`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"-Drepo.password=$RepositoryPassword`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n     mvn gpg:sign-and-deploy-file \"--batch-mode\" \"$pomOption\" \"$fileOption\" \"$javadocOption\" \"$sourcesOption\" \"$filesOption\" $classifiersOption \"$typesOption\" \"-Durl=$RepositoryUrl\" \"$gpgexeOption\" \"-DrepositoryId=target-repo\" \"-Drepo.password=$RepositoryPassword\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n   }\n   elseif ($RepositoryUrl -like \"https://oss.sonatype.org/service/local/staging/deploy/maven2/\") {\n     Write-Information \"Signing and deploying package to $localRepositoryDirectoryUri\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"$urlOption`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe39fc4fe690b376b118c99276cfa110becc1363"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1Mzc4OA==", "bodyText": "Same question about printing password.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447953788", "createdAt": "2020-06-30T20:18:01Z", "author": {"login": "alzimmermsft"}, "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -266,18 +280,21 @@ foreach ($packageDetail in $packageDetails) {\n \n   if ($RepositoryUrl -match \"https://pkgs.dev.azure.com/azure-sdk/\\b(internal|public)\\b/*\") {\n     Write-Information \"GPG Signing and deploying package in one step to devops feed: $RepositoryUrl\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"-Durl=$RepositoryUrl`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"-Drepo.password=$RepositoryPassword`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n     mvn gpg:sign-and-deploy-file \"--batch-mode\" \"$pomOption\" \"$fileOption\" \"$javadocOption\" \"$sourcesOption\" \"$filesOption\" $classifiersOption \"$typesOption\" \"-Durl=$RepositoryUrl\" \"$gpgexeOption\" \"-DrepositoryId=target-repo\" \"-Drepo.password=$RepositoryPassword\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n   }\n   elseif ($RepositoryUrl -like \"https://oss.sonatype.org/service/local/staging/deploy/maven2/\") {\n     Write-Information \"Signing and deploying package to $localRepositoryDirectoryUri\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"$urlOption`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n     mvn gpg:sign-and-deploy-file \"--batch-mode\" \"$pomOption\" \"$fileOption\" \"$javadocOption\" \"$sourcesOption\" \"$filesOption\" $classifiersOption \"$typesOption\" \"$urlOption\" \"$gpgexeOption\" \"-DrepositoryId=target-repo\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n-  \n+\n     Write-Information \"Staging package to Maven Central\"\n+    Write-Information \"mvn org.sonatype.plugins:nexus-staging-maven-plugin:deploy-staged-repository `\"--batch-mode`\" `\"-DnexusUrl=https://oss.sonatype.org`\" `\"$repositoryDirectoryOption`\" `\"$stagingProfileIdOption`\" `\"$stagingDescriptionOption`\" `\"-DrepositoryId=target-repo`\" `\"-DserverId=target-repo`\" `\"-Drepo.username=$RepositoryUsername`\" `\"-Drepo.password=`\"`\"$RepositoryPassword`\"`\"`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe39fc4fe690b376b118c99276cfa110becc1363"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MzkxMw==", "bodyText": "One last time about password.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447953913", "createdAt": "2020-06-30T20:18:14Z", "author": {"login": "alzimmermsft"}, "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -289,11 +306,12 @@ foreach ($packageDetail in $packageDetails) {\n     }\n     else {\n       Write-Information \"Releasing staging repostiory $stagedRepositoryId\"\n-      mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release \"-DstagingRepositoryId=$stagedRepositoryId\" \"-DnexusUrl=https://oss.sonatype.org\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"  \n+      Write-Information \"mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release `\"-DstagingRepositoryId=$stagedRepositoryId`\" `\"-DnexusUrl=https://oss.sonatype.org`\" `\"-DrepositoryId=target-repo`\" `\"-DserverId=target-repo`\" `\"-Drepo.username=$RepositoryUsername`\" `\"-Drepo.password=`\"`\"$RepositoryPassword`\"`\"`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n+      mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release \"-DstagingRepositoryId=$stagedRepositoryId\" \"-DnexusUrl=https://oss.sonatype.org\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe39fc4fe690b376b118c99276cfa110becc1363"}, "originalPosition": 120}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMzg4MTQ3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#pullrequestreview-440388147", "createdAt": "2020-06-30T21:10:17Z", "commit": {"oid": "fe39fc4fe690b376b118c99276cfa110becc1363"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c43da6981f982bccad21e5c9c515e3467d2223f2", "author": {"user": {"login": "JimSuplizio", "name": "James Suplizio"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c43da6981f982bccad21e5c9c515e3467d2223f2", "committedDate": "2020-06-30T22:17:43Z", "message": "Update test bom version to the next unreleased version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDQ4MDMz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#pullrequestreview-440448033", "createdAt": "2020-06-30T23:16:38Z", "commit": {"oid": "c43da6981f982bccad21e5c9c515e3467d2223f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNDA4NzA4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#pullrequestreview-451408708", "createdAt": "2020-07-20T08:42:38Z", "commit": {"oid": "c43da6981f982bccad21e5c9c515e3467d2223f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwODo0MjozOVrOG0ARgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwODo0MjozOVrOG0ARgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE4MzYxNw==", "bodyText": "Hi, @JimSuplizio ,\nSplit line is not supported. i.e:\n<version>1.8\n</version> <!-- {x-version-update;org.apache.maven.plugins:maven-antrun-plugin;external_dependency} -->\n\nshould be\n<version>1.8 </version> <!-- {x-version-update;org.apache.maven.plugins:maven-antrun-plugin;external_dependency} -->\n\nRefs: https://github.com/Azure/azure-sdk-for-java/blob/master/eng/versioning/update_versions.py#L60", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r457183617", "createdAt": "2020-07-20T08:42:39Z", "author": {"login": "chenrujun"}, "path": "sdk/boms/azure-sdk-template-bom/pom.xml", "diffHunk": "@@ -0,0 +1,80 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+  <groupId>com.azure</groupId>\n+  <artifactId>azure-sdk-template-bom</artifactId>\n+  <version>1.0.0-beta.5</version>\n+  <packaging>pom</packaging>\n+  <name>Azure Java SDK Template BOM (Bill of Materials)</name>\n+  <description>BOM used for testing the release pipeline and nothing else.</description>\n+  <url>https://github.com/azure/azure-sdk-for-java</url>\n+\n+  <licenses>\n+    <license>\n+      <name>The MIT License (MIT)</name>\n+      <url>http://opensource.org/licenses/MIT</url>\n+      <distribution>repo</distribution>\n+    </license>\n+  </licenses>\n+\n+  <developers>\n+    <developer>\n+      <id>microsoft</id>\n+      <name>Microsoft Corporation</name>\n+    </developer>\n+  </developers>\n+\n+  <scm>\n+    <connection>scm:git:git://github.com/azure/azure-sdk-for-java</connection>\n+    <developerConnection>scm:git:git://github.com/azure/azure-sdk-for-java</developerConnection>\n+    <url>https://github.com/azure/azure-sdk-for-java</url>\n+  </scm>\n+\n+  <properties>\n+    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+    <packageOutputDirectory>${project.build.directory}</packageOutputDirectory>\n+  </properties>\n+\n+  <issueManagement>\n+    <system>GitHub</system>\n+    <url>https://github.com/azure/azure-sdk-for-java/issues</url>\n+  </issueManagement>\n+\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>com.azure</groupId>\n+        <artifactId>azure-sdk-template</artifactId>\n+        <version>1.0.4-beta.19</version>\n+      </dependency>\n+    </dependencies>\n+  </dependencyManagement>\n+\n+  <build>\n+    <plugins>\n+      <!-- Copy the pom file to output -->\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-antrun-plugin</artifactId>\n+        <version>1.8\n+        </version> <!-- {x-version-update;org.apache.maven.plugins:maven-antrun-plugin;external_dependency} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c43da6981f982bccad21e5c9c515e3467d2223f2"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2881, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}