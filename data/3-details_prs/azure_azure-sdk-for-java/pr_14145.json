{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MTgwMjM2", "number": 14145, "title": "Performance: Optimizing the Rntbdtoken codec look-up O(n) -> O(1)", "bodyText": "Current implementation doing a for-loop, i,e, for any fromId() invocation results in 16times CPU loop.\nNew implementation pre-caches them and used index lookup.\nJHM results below\n\n\n\nBenchmark\nMode\nCnt\nScore\nError\nUnits\n\n\n\n\nMyBenchmark.current(last-entry)\nthrpt\n25\n22000729.476\n\u00b1  444587.766\nops/s\n\n\nMyBenchmark.optimized(last-entry)\nthrpt\n25\n500388199.392\n\u00b1 1068858.996\nops/s\n\n\nMyBenchmark.current(first-entry)\nthrpt\n25\n35150618.211\n\u00b1  184202.541\nops/s\n\n\nMyBenchmark.optimized(first-entry)\nthrpt\n25\n505749163.599\n\u00b1 1320707.249\nops/s", "createdAt": "2020-08-14T20:58:15Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145", "merged": true, "mergeCommit": {"oid": "40d7655c17e492e487a260e2369a0cbce5cdbcce"}, "closed": true, "closedAt": "2020-08-15T06:56:15Z", "author": {"login": "kirankumarkolli"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-7CbJAH2gAyNDY4MTgwMjM2OjI3NGFlYjAyNjVjMTg5ZTdkYjkxNjhmZDIxNTk5NTUwMGFkM2IwMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-_27SAH2gAyNDY4MTgwMjM2OjkzMDI4ZDcyZDRlZWRiZTE3OGNhMzFkNzViYTE2YWYxNjBiMWU1N2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "274aeb0265c189e7db9168fd215995500ad3b035", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/274aeb0265c189e7db9168fd215995500ad3b035", "committedDate": "2020-08-14T20:56:26Z", "message": "Performance: Optimizing the Rntbdtoken codec look-up O(n) -> O(1)\n\nCurrent implementation doing a for-loop, i,e, for any fromId() invocation results in 16times CPU loop.\nNew implementation pre-caches them and used index lookup."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3ODcyMDUx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#pullrequestreview-467872051", "createdAt": "2020-08-14T21:00:02Z", "commit": {"oid": "274aeb0265c189e7db9168fd215995500ad3b035"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3ODkyNTgy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#pullrequestreview-467892582", "createdAt": "2020-08-14T21:48:29Z", "commit": {"oid": "274aeb0265c189e7db9168fd215995500ad3b035"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMTo0ODoyOVrOHBENGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMTo0ODoyOVrOHBENGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg3OTUxMw==", "bodyText": "we don't use \"test\" as prefix nor suffix as a test code style.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void testAllTokenTypes() {\n          \n          \n            \n                public void allTokenTypes() {", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#discussion_r470879513", "createdAt": "2020-08-14T21:48:29Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.azure.cosmos.implementation.directconnectivity.rntbd;\n+\n+import org.testng.annotations.Test;\n+\n+import static org.assertj.core.api.AssertionsForClassTypes.assertThat;\n+\n+public class RntbdTokenTypeTests {\n+\n+    @Test(groups = { \"unit\" })\n+    public void testAllTokenTypes() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "274aeb0265c189e7db9168fd215995500ad3b035"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3ODkyNjQx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#pullrequestreview-467892641", "createdAt": "2020-08-14T21:48:40Z", "commit": {"oid": "274aeb0265c189e7db9168fd215995500ad3b035"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMTo0ODo0MFrOHBENRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMTo0ODo0MFrOHBENRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg3OTU1Ng==", "bodyText": "header filing is missing. please add.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#discussion_r470879556", "createdAt": "2020-08-14T21:48:40Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.azure.cosmos.implementation.directconnectivity.rntbd;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "274aeb0265c189e7db9168fd215995500ad3b035"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92bdef38910144fa68371d1d450ecf3ca18fdb0f", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/92bdef38910144fa68371d1d450ecf3ca18fdb0f", "committedDate": "2020-08-14T22:02:27Z", "message": "Update sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java\n\nCo-authored-by: Mohammad Derakhshani <moderakh@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTE3ODUw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#pullrequestreview-467917850", "createdAt": "2020-08-14T23:16:10Z", "commit": {"oid": "92bdef38910144fa68371d1d450ecf3ca18fdb0f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMzoxNjoxMFrOHBFipw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMzoxNjoxMFrOHBFipw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkwMTQxNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for(int i=0; i< maxByteValue; i++) {\n          \n          \n            \n                    for(int i = 0; i < maxByteValue; i++) {", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#discussion_r470901415", "createdAt": "2020-08-14T23:16:10Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenType.java", "diffHunk": "@@ -42,6 +42,24 @@\n     Invalid((byte)0xFF, RntbdNone.codec);             // no data\n \n     // region Implementation\n+    private static final RntbdTokenType[] allTokens = getAllTokens();\n+\n+    private static  RntbdTokenType[] getAllTokens() {\n+        final int maxByteValue = 0xFF + 1;\n+        final RntbdTokenType[] allPossibleTokens = new RntbdTokenType[maxByteValue]; // one byte RNTBD limit\n+        for(int i=0; i< maxByteValue; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92bdef38910144fa68371d1d450ecf3ca18fdb0f"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6b8c57964ddff0e24781c949bdf70ed2aafdaf1", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e6b8c57964ddff0e24781c949bdf70ed2aafdaf1", "committedDate": "2020-08-15T01:47:04Z", "message": "Update sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenType.java\n\nCo-authored-by: Mohammad Derakhshani <moderakh@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTQxMDI0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#pullrequestreview-467941024", "createdAt": "2020-08-15T02:33:16Z", "commit": {"oid": "e6b8c57964ddff0e24781c949bdf70ed2aafdaf1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMjozMzoxNlrOHBHG7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMjozMzoxNlrOHBHG7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkyNzA4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            package com.azure.cosmos.implementation.directconnectivity.rntbd;\n          \n          \n            \n            // Copyright (c) Microsoft Corporation. All rights reserved.\n          \n          \n            \n            // Licensed under the MIT License.\n          \n          \n            \n            \n          \n          \n            \n            package com.azure.cosmos.implementation.directconnectivity.rntbd;", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#discussion_r470927087", "createdAt": "2020-08-15T02:33:16Z", "author": {"login": "kirankumarkolli"}, "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.azure.cosmos.implementation.directconnectivity.rntbd;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6b8c57964ddff0e24781c949bdf70ed2aafdaf1"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93028d72d4eedbe178ca31d75ba16af160b1e57a", "author": {"user": {"login": "kirankumarkolli", "name": "Kiran Kumar Kolli"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/93028d72d4eedbe178ca31d75ba16af160b1e57a", "committedDate": "2020-08-15T02:33:24Z", "message": "Update sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 381, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}