{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NDUzNTg2", "number": 16039, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxODo1OTowN1rOErUP-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTo0NzowMlrOErXoEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODU1OTk1OnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/autorest.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxODo1OTowN1rOHeBYYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxODo1OTowN1rOHeBYYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI0MTk1Mw==", "bodyText": "By declaring these as custom types, they are moved to the appropriate namespace so that we can use them in our convenience layer APIs. Note that some options classes aren't here on purpose since we have to create wrapper classes for some of them instead in order to add more options to them", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501241953", "createdAt": "2020-10-07T18:59:07Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/autorest.md", "diffHunk": "@@ -40,4 +40,5 @@ java:\n     context-client-method-parameter: true\n     custom-types-subpackage: models\n     required-fields-as-ctor-args: true\n+    custom-types: DigitalTwinModelsAddOptions,DigitalTwinModelsDeleteOptions,DigitalTwinModelsGetByIdOptions,DigitalTwinModelsUpdateOptions,DigitalTwinsAddOptions,DigitalTwinsAddRelationshipOptions,DigitalTwinsDeleteOptions,DigitalTwinsDeleteRelationshipOptions,DigitalTwinsGetByIdOptions,DigitalTwinsGetComponentOptions,DigitalTwinsGetRelationshipByIdOptions,DigitalTwinsListIncomingRelationshipsOptions,DigitalTwinsListRelationshipsOptions,DigitalTwinsUpdateComponentOptions,DigitalTwinsUpdateOptions,DigitalTwinsUpdateRelationshipOptions,EventRoutesAddOptions,EventRoutesDeleteOptions,EventRoutesGetByIdOptions,EventRoutesListOptions,QueryTwinsOptions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59cb8403dbcdc760cbf92189df6fed988cf40ffe"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODU2Mzc5OnYy", "diffSide": "LEFT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/implementation/converters/EventRouteListOptionsConverter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTowMDoxMVrOHeBa1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTowMDoxMVrOHeBa1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI0MjU4Mg==", "bodyText": "We no longer need a wrapper class for EventRouteListOptions, so the the converter from wrapper to generated is no longer needed", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501242582", "createdAt": "2020-10-07T19:00:11Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/implementation/converters/EventRouteListOptionsConverter.java", "diffHunk": "@@ -1,33 +0,0 @@\n-package com.azure.digitaltwins.core.implementation.converters;\n-\n-import com.azure.digitaltwins.core.models.EventRoute;\n-import com.azure.digitaltwins.core.models.EventRoutesListOptions;\n-\n-/**\n- * A converter between {@link com.azure.digitaltwins.core.implementation.models.EventRoutesListOptions} and\n- * {@link EventRoutesListOptions}.\n- */\n-public final class EventRouteListOptionsConverter {\n-\n-    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59cb8403dbcdc760cbf92189df6fed988cf40ffe"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODU3MTI0OnYy", "diffSide": "LEFT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/implementation/models/EventRoute.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTowMjoxMVrOHeBfZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTowMjoxMVrOHeBfZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI0Mzc1MQ==", "bodyText": "This field became mandatory in the latest swagger, so it is taken in at constructor time only", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501243751", "createdAt": "2020-10-07T19:02:11Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/implementation/models/EventRoute.java", "diffHunk": "@@ -70,17 +74,6 @@ public String getFilter() {\n         return this.filter;\n     }\n \n-    /**\n-     * Set the filter property: An expression which describes the events which are routed to the endpoint.\n-     *\n-     * @param filter the filter value to set.\n-     * @return the EventRoute object itself.\n-     */\n-    public EventRoute setFilter(String filter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59cb8403dbcdc760cbf92189df6fed988cf40ffe"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODU3NDIyOnYy", "diffSide": "LEFT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/models/DeleteDigitalTwinRequestOptions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTowMzowMFrOHeBhQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTowMzowMFrOHeBhQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI0NDIyNw==", "bodyText": "We get this type generated for free, so no need for this manually defined type anymore", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501244227", "createdAt": "2020-10-07T19:03:00Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/models/DeleteDigitalTwinRequestOptions.java", "diffHunk": "@@ -1,25 +0,0 @@\n-// Copyright (c) Microsoft Corporation. All rights reserved.\n-// Licensed under the MIT License.\n-\n-package com.azure.digitaltwins.core.models;\n-\n-import com.azure.digitaltwins.core.DigitalTwinsClient;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59cb8403dbcdc760cbf92189df6fed988cf40ffe"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODU3NTIyOnYy", "diffSide": "LEFT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/models/DeleteRelationshipRequestOptions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTowMzoxNVrOHeBh5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTowMzoxNVrOHeBh5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI0NDM4OA==", "bodyText": "We get this type generated for free, so no need for this manually defined type anymore", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501244388", "createdAt": "2020-10-07T19:03:15Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/models/DeleteRelationshipRequestOptions.java", "diffHunk": "@@ -1,29 +0,0 @@\n-// Copyright (c) Microsoft Corporation. All rights reserved.\n-// Licensed under the MIT License.\n-\n-package com.azure.digitaltwins.core.models;\n-\n-\n-import com.azure.digitaltwins.core.DigitalTwinsClient;\n-\n-import java.util.List;\n-\n-/**\n- * Optional settings that are specific to calls to {@link DigitalTwinsClient#updateComponent(String, String, List)} and its overloads.\n- */\n-public final class DeleteRelationshipRequestOptions extends DigitalTwinsRequestOptions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59cb8403dbcdc760cbf92189df6fed988cf40ffe"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzOTA2MzE5OnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTozMDoyM1rOHeGOgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMjowMDoxN1rOHeHBvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMTM0Nw==", "bodyText": "so we are defaulting options to null? is there a scenario where we would want these options to have a default value instead?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501321347", "createdAt": "2020-10-07T21:30:23Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -115,7 +113,7 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public <T> Mono<T> createDigitalTwin(String digitalTwinId, T digitalTwin, Class<T> clazz)\n     {\n-        return createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz)\n+        return createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMjQ3Nw==", "bodyText": "Since they are optional, it is always allowed. It saves us from instantiating new options classes on each call. I didn't see any particular cases where it made more sense to create a default options object instead.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501322477", "createdAt": "2020-10-07T21:32:55Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -115,7 +113,7 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public <T> Mono<T> createDigitalTwin(String digitalTwinId, T digitalTwin, Class<T> clazz)\n     {\n-        return createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz)\n+        return createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, null)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMTM0Nw=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMzNDQ2MQ==", "bodyText": "If \"null\" is the expected value, then yes, I like leaving it as is. I was thinking of the scenario where we have some request Id in options, which we would want to have a default value, rather than null. But if that is not relevant for our API calls, then what we have is good.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501334461", "createdAt": "2020-10-07T22:00:17Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -115,7 +113,7 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public <T> Mono<T> createDigitalTwin(String digitalTwinId, T digitalTwin, Class<T> clazz)\n     {\n-        return createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz)\n+        return createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, null)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMTM0Nw=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzOTA2ODA2OnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTozMjowNFrOHeGRZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTozMzo1NVrOHeGUww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMjA4NQ==", "bodyText": "q - do we have the update operations util from azure-core available for us to use here?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501322085", "createdAt": "2020-10-07T21:32:04Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -244,14 +244,14 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      * {@codesnippet com.azure.digitaltwins.core.asyncClient.updateDigitalTwin#String-List}\n      *\n      * @param digitalTwinId The Id of the digital twin.\n-     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin.\n+     * @param jsonPatch The JSON patch to apply to the specified digital twin.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMjk0Nw==", "bodyText": "It is still in azure core's experimental package, so not yet. Hopefully they will have it out before we GA though", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501322947", "createdAt": "2020-10-07T21:33:55Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -244,14 +244,14 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      * {@codesnippet com.azure.digitaltwins.core.asyncClient.updateDigitalTwin#String-List}\n      *\n      * @param digitalTwinId The Id of the digital twin.\n-     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin.\n+     * @param jsonPatch The JSON patch to apply to the specified digital twin.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMjA4NQ=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 119}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzOTA5NDcxOnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTo0MDo0MFrOHeGgxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMjo1NTo1NlrOHeIWBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNjAyMw==", "bodyText": "q - what is the default value of OffsetDateTime?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501326023", "createdAt": "2020-10-07T21:40:40Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -1392,30 +1419,47 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      *\n      * <p>A strongly typed object such as {@link java.util.Hashtable} can be provided as the input parameter for the telemetry payload.</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#Object}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#Object}\n      *\n      * <p>Or alternatively String can be used as input type to construct the json string telemetry payload:</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#String}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#String}\n      *\n      * The result is then consumed by one or many destination endpoints (subscribers) defined under {@link EventRoute}\n      * These event routes need to be set before publishing a telemetry message, in order for the telemetry message to be consumed.\n      * @param digitalTwinId The Id of the digital twin.\n+     * @param messageId A unique message identifier (within the scope of the digital twin id) that is commonly used for de-duplicating messages. Defaults to a random UUID if argument is null.\n      * @param payload The application/json telemetry payload to be sent. payload can be a raw json string or a strongly typed object like a Dictionary.\n-     * @param publishTelemetryRequestOptions The additional information to be used when processing a telemetry request.\n+     * @param options The optional parameters for this request. If null, the default option values will be used.\n      * @return A {@link Response} containing an empty mono.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions) {\n-        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, payload, publishTelemetryRequestOptions, context));\n+    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options) {\n+        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, messageId, payload, options, context));\n     }\n \n-    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions, Context context) {\n+    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options, Context context) {\n+        if (messageId == null || messageId.isEmpty()) {\n+            messageId = UUID.randomUUID().toString();\n+        }\n+\n+        com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions protocolLayerOptions;\n+        if (options == null) {\n+            options = new DigitalTwinsSendTelemetryOptions();\n+            protocolLayerOptions = null;\n+        }\n+        else {\n+            protocolLayerOptions = new com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions()\n+                .setTraceparent(options.getTraceparent())\n+                .setTracestate(options.getTracestate());\n+        }\n+\n         return protocolLayer.getDigitalTwins().sendTelemetryWithResponseAsync(\n             digitalTwinId,\n-            publishTelemetryRequestOptions.getMessageId(),\n+            messageId,\n             payload,\n-            publishTelemetryRequestOptions.getTimestamp().toString(),\n+            options.getTimestamp().toString(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 1134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNjc3MQ==", "bodyText": "this feels like another parameter that we should send a default value (current timestamp), if the user doesn't supply a value", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501326771", "createdAt": "2020-10-07T21:42:24Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -1392,30 +1419,47 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      *\n      * <p>A strongly typed object such as {@link java.util.Hashtable} can be provided as the input parameter for the telemetry payload.</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#Object}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#Object}\n      *\n      * <p>Or alternatively String can be used as input type to construct the json string telemetry payload:</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#String}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#String}\n      *\n      * The result is then consumed by one or many destination endpoints (subscribers) defined under {@link EventRoute}\n      * These event routes need to be set before publishing a telemetry message, in order for the telemetry message to be consumed.\n      * @param digitalTwinId The Id of the digital twin.\n+     * @param messageId A unique message identifier (within the scope of the digital twin id) that is commonly used for de-duplicating messages. Defaults to a random UUID if argument is null.\n      * @param payload The application/json telemetry payload to be sent. payload can be a raw json string or a strongly typed object like a Dictionary.\n-     * @param publishTelemetryRequestOptions The additional information to be used when processing a telemetry request.\n+     * @param options The optional parameters for this request. If null, the default option values will be used.\n      * @return A {@link Response} containing an empty mono.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions) {\n-        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, payload, publishTelemetryRequestOptions, context));\n+    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options) {\n+        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, messageId, payload, options, context));\n     }\n \n-    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions, Context context) {\n+    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options, Context context) {\n+        if (messageId == null || messageId.isEmpty()) {\n+            messageId = UUID.randomUUID().toString();\n+        }\n+\n+        com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions protocolLayerOptions;\n+        if (options == null) {\n+            options = new DigitalTwinsSendTelemetryOptions();\n+            protocolLayerOptions = null;\n+        }\n+        else {\n+            protocolLayerOptions = new com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions()\n+                .setTraceparent(options.getTraceparent())\n+                .setTracestate(options.getTracestate());\n+        }\n+\n         return protocolLayer.getDigitalTwins().sendTelemetryWithResponseAsync(\n             digitalTwinId,\n-            publishTelemetryRequestOptions.getMessageId(),\n+            messageId,\n             payload,\n-            publishTelemetryRequestOptions.getTimestamp().toString(),\n+            options.getTimestamp().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNjAyMw=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 1134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNzM0NQ==", "bodyText": "OffsetDateTime.now(ZoneOffset.UTC);", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501327345", "createdAt": "2020-10-07T21:43:49Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -1392,30 +1419,47 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      *\n      * <p>A strongly typed object such as {@link java.util.Hashtable} can be provided as the input parameter for the telemetry payload.</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#Object}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#Object}\n      *\n      * <p>Or alternatively String can be used as input type to construct the json string telemetry payload:</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#String}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#String}\n      *\n      * The result is then consumed by one or many destination endpoints (subscribers) defined under {@link EventRoute}\n      * These event routes need to be set before publishing a telemetry message, in order for the telemetry message to be consumed.\n      * @param digitalTwinId The Id of the digital twin.\n+     * @param messageId A unique message identifier (within the scope of the digital twin id) that is commonly used for de-duplicating messages. Defaults to a random UUID if argument is null.\n      * @param payload The application/json telemetry payload to be sent. payload can be a raw json string or a strongly typed object like a Dictionary.\n-     * @param publishTelemetryRequestOptions The additional information to be used when processing a telemetry request.\n+     * @param options The optional parameters for this request. If null, the default option values will be used.\n      * @return A {@link Response} containing an empty mono.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions) {\n-        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, payload, publishTelemetryRequestOptions, context));\n+    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options) {\n+        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, messageId, payload, options, context));\n     }\n \n-    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions, Context context) {\n+    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options, Context context) {\n+        if (messageId == null || messageId.isEmpty()) {\n+            messageId = UUID.randomUUID().toString();\n+        }\n+\n+        com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions protocolLayerOptions;\n+        if (options == null) {\n+            options = new DigitalTwinsSendTelemetryOptions();\n+            protocolLayerOptions = null;\n+        }\n+        else {\n+            protocolLayerOptions = new com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions()\n+                .setTraceparent(options.getTraceparent())\n+                .setTracestate(options.getTracestate());\n+        }\n+\n         return protocolLayer.getDigitalTwins().sendTelemetryWithResponseAsync(\n             digitalTwinId,\n-            publishTelemetryRequestOptions.getMessageId(),\n+            messageId,\n             payload,\n-            publishTelemetryRequestOptions.getTimestamp().toString(),\n+            options.getTimestamp().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNjAyMw=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 1134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNzUxMg==", "bodyText": "It's possible that we could make the default value null, and just not send that header though", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501327512", "createdAt": "2020-10-07T21:44:16Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -1392,30 +1419,47 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      *\n      * <p>A strongly typed object such as {@link java.util.Hashtable} can be provided as the input parameter for the telemetry payload.</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#Object}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#Object}\n      *\n      * <p>Or alternatively String can be used as input type to construct the json string telemetry payload:</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#String}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#String}\n      *\n      * The result is then consumed by one or many destination endpoints (subscribers) defined under {@link EventRoute}\n      * These event routes need to be set before publishing a telemetry message, in order for the telemetry message to be consumed.\n      * @param digitalTwinId The Id of the digital twin.\n+     * @param messageId A unique message identifier (within the scope of the digital twin id) that is commonly used for de-duplicating messages. Defaults to a random UUID if argument is null.\n      * @param payload The application/json telemetry payload to be sent. payload can be a raw json string or a strongly typed object like a Dictionary.\n-     * @param publishTelemetryRequestOptions The additional information to be used when processing a telemetry request.\n+     * @param options The optional parameters for this request. If null, the default option values will be used.\n      * @return A {@link Response} containing an empty mono.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions) {\n-        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, payload, publishTelemetryRequestOptions, context));\n+    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options) {\n+        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, messageId, payload, options, context));\n     }\n \n-    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions, Context context) {\n+    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options, Context context) {\n+        if (messageId == null || messageId.isEmpty()) {\n+            messageId = UUID.randomUUID().toString();\n+        }\n+\n+        com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions protocolLayerOptions;\n+        if (options == null) {\n+            options = new DigitalTwinsSendTelemetryOptions();\n+            protocolLayerOptions = null;\n+        }\n+        else {\n+            protocolLayerOptions = new com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions()\n+                .setTraceparent(options.getTraceparent())\n+                .setTracestate(options.getTracestate());\n+        }\n+\n         return protocolLayer.getDigitalTwins().sendTelemetryWithResponseAsync(\n             digitalTwinId,\n-            publishTelemetryRequestOptions.getMessageId(),\n+            messageId,\n             payload,\n-            publishTelemetryRequestOptions.getTimestamp().toString(),\n+            options.getTimestamp().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNjAyMw=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 1134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMzMzIxNQ==", "bodyText": "Oh, I actually prefer sending the current time as default value. Why do you feel sending null is better?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501333215", "createdAt": "2020-10-07T21:57:18Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -1392,30 +1419,47 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      *\n      * <p>A strongly typed object such as {@link java.util.Hashtable} can be provided as the input parameter for the telemetry payload.</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#Object}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#Object}\n      *\n      * <p>Or alternatively String can be used as input type to construct the json string telemetry payload:</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#String}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#String}\n      *\n      * The result is then consumed by one or many destination endpoints (subscribers) defined under {@link EventRoute}\n      * These event routes need to be set before publishing a telemetry message, in order for the telemetry message to be consumed.\n      * @param digitalTwinId The Id of the digital twin.\n+     * @param messageId A unique message identifier (within the scope of the digital twin id) that is commonly used for de-duplicating messages. Defaults to a random UUID if argument is null.\n      * @param payload The application/json telemetry payload to be sent. payload can be a raw json string or a strongly typed object like a Dictionary.\n-     * @param publishTelemetryRequestOptions The additional information to be used when processing a telemetry request.\n+     * @param options The optional parameters for this request. If null, the default option values will be used.\n      * @return A {@link Response} containing an empty mono.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions) {\n-        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, payload, publishTelemetryRequestOptions, context));\n+    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options) {\n+        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, messageId, payload, options, context));\n     }\n \n-    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions, Context context) {\n+    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options, Context context) {\n+        if (messageId == null || messageId.isEmpty()) {\n+            messageId = UUID.randomUUID().toString();\n+        }\n+\n+        com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions protocolLayerOptions;\n+        if (options == null) {\n+            options = new DigitalTwinsSendTelemetryOptions();\n+            protocolLayerOptions = null;\n+        }\n+        else {\n+            protocolLayerOptions = new com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions()\n+                .setTraceparent(options.getTraceparent())\n+                .setTracestate(options.getTracestate());\n+        }\n+\n         return protocolLayer.getDigitalTwins().sendTelemetryWithResponseAsync(\n             digitalTwinId,\n-            publishTelemetryRequestOptions.getMessageId(),\n+            messageId,\n             payload,\n-            publishTelemetryRequestOptions.getTimestamp().toString(),\n+            options.getTimestamp().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNjAyMw=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 1134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM0MDg1Nw==", "bodyText": "I prefer sending the timestamp header with the default value by default, not omitting the header. The current implementation sends the timestamp by default. The only value I'd see in not sending the timestamp by default is to save on bytes over the wire", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501340857", "createdAt": "2020-10-07T22:16:06Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -1392,30 +1419,47 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      *\n      * <p>A strongly typed object such as {@link java.util.Hashtable} can be provided as the input parameter for the telemetry payload.</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#Object}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#Object}\n      *\n      * <p>Or alternatively String can be used as input type to construct the json string telemetry payload:</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#String}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#String}\n      *\n      * The result is then consumed by one or many destination endpoints (subscribers) defined under {@link EventRoute}\n      * These event routes need to be set before publishing a telemetry message, in order for the telemetry message to be consumed.\n      * @param digitalTwinId The Id of the digital twin.\n+     * @param messageId A unique message identifier (within the scope of the digital twin id) that is commonly used for de-duplicating messages. Defaults to a random UUID if argument is null.\n      * @param payload The application/json telemetry payload to be sent. payload can be a raw json string or a strongly typed object like a Dictionary.\n-     * @param publishTelemetryRequestOptions The additional information to be used when processing a telemetry request.\n+     * @param options The optional parameters for this request. If null, the default option values will be used.\n      * @return A {@link Response} containing an empty mono.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions) {\n-        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, payload, publishTelemetryRequestOptions, context));\n+    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options) {\n+        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, messageId, payload, options, context));\n     }\n \n-    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions, Context context) {\n+    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options, Context context) {\n+        if (messageId == null || messageId.isEmpty()) {\n+            messageId = UUID.randomUUID().toString();\n+        }\n+\n+        com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions protocolLayerOptions;\n+        if (options == null) {\n+            options = new DigitalTwinsSendTelemetryOptions();\n+            protocolLayerOptions = null;\n+        }\n+        else {\n+            protocolLayerOptions = new com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions()\n+                .setTraceparent(options.getTraceparent())\n+                .setTracestate(options.getTracestate());\n+        }\n+\n         return protocolLayer.getDigitalTwins().sendTelemetryWithResponseAsync(\n             digitalTwinId,\n-            publishTelemetryRequestOptions.getMessageId(),\n+            messageId,\n             payload,\n-            publishTelemetryRequestOptions.getTimestamp().toString(),\n+            options.getTimestamp().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNjAyMw=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 1134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM0MjEwMA==", "bodyText": "Sure, but for this case, I'd say that the timestamp information is valuable. My vote is to send the current timestamp, if user doesn't provide it.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501342100", "createdAt": "2020-10-07T22:19:13Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -1392,30 +1419,47 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      *\n      * <p>A strongly typed object such as {@link java.util.Hashtable} can be provided as the input parameter for the telemetry payload.</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#Object}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#Object}\n      *\n      * <p>Or alternatively String can be used as input type to construct the json string telemetry payload:</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#String}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#String}\n      *\n      * The result is then consumed by one or many destination endpoints (subscribers) defined under {@link EventRoute}\n      * These event routes need to be set before publishing a telemetry message, in order for the telemetry message to be consumed.\n      * @param digitalTwinId The Id of the digital twin.\n+     * @param messageId A unique message identifier (within the scope of the digital twin id) that is commonly used for de-duplicating messages. Defaults to a random UUID if argument is null.\n      * @param payload The application/json telemetry payload to be sent. payload can be a raw json string or a strongly typed object like a Dictionary.\n-     * @param publishTelemetryRequestOptions The additional information to be used when processing a telemetry request.\n+     * @param options The optional parameters for this request. If null, the default option values will be used.\n      * @return A {@link Response} containing an empty mono.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions) {\n-        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, payload, publishTelemetryRequestOptions, context));\n+    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options) {\n+        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, messageId, payload, options, context));\n     }\n \n-    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions, Context context) {\n+    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options, Context context) {\n+        if (messageId == null || messageId.isEmpty()) {\n+            messageId = UUID.randomUUID().toString();\n+        }\n+\n+        com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions protocolLayerOptions;\n+        if (options == null) {\n+            options = new DigitalTwinsSendTelemetryOptions();\n+            protocolLayerOptions = null;\n+        }\n+        else {\n+            protocolLayerOptions = new com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions()\n+                .setTraceparent(options.getTraceparent())\n+                .setTracestate(options.getTracestate());\n+        }\n+\n         return protocolLayer.getDigitalTwins().sendTelemetryWithResponseAsync(\n             digitalTwinId,\n-            publishTelemetryRequestOptions.getMessageId(),\n+            messageId,\n             payload,\n-            publishTelemetryRequestOptions.getTimestamp().toString(),\n+            options.getTimestamp().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNjAyMw=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 1134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM1NjAzNg==", "bodyText": "Then I'll keep the implementation as is. If the user passes in a null options object, we will send the current timestamp for them", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501356036", "createdAt": "2020-10-07T22:55:56Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -1392,30 +1419,47 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n      *\n      * <p>A strongly typed object such as {@link java.util.Hashtable} can be provided as the input parameter for the telemetry payload.</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#Object}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#Object}\n      *\n      * <p>Or alternatively String can be used as input type to construct the json string telemetry payload:</p>\n      *\n-     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-Object-Options#String}\n+     * {@codesnippet com.azure.digitaltwins.core.asyncClient.publishTelemetryWithResponse#String-String-Object-Options#String}\n      *\n      * The result is then consumed by one or many destination endpoints (subscribers) defined under {@link EventRoute}\n      * These event routes need to be set before publishing a telemetry message, in order for the telemetry message to be consumed.\n      * @param digitalTwinId The Id of the digital twin.\n+     * @param messageId A unique message identifier (within the scope of the digital twin id) that is commonly used for de-duplicating messages. Defaults to a random UUID if argument is null.\n      * @param payload The application/json telemetry payload to be sent. payload can be a raw json string or a strongly typed object like a Dictionary.\n-     * @param publishTelemetryRequestOptions The additional information to be used when processing a telemetry request.\n+     * @param options The optional parameters for this request. If null, the default option values will be used.\n      * @return A {@link Response} containing an empty mono.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions) {\n-        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, payload, publishTelemetryRequestOptions, context));\n+    public Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options) {\n+        return withContext(context -> publishTelemetryWithResponse(digitalTwinId, messageId, payload, options, context));\n     }\n \n-    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, Object payload, PublishTelemetryRequestOptions publishTelemetryRequestOptions, Context context) {\n+    Mono<Response<Void>> publishTelemetryWithResponse(String digitalTwinId, String messageId, Object payload, DigitalTwinsSendTelemetryOptions options, Context context) {\n+        if (messageId == null || messageId.isEmpty()) {\n+            messageId = UUID.randomUUID().toString();\n+        }\n+\n+        com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions protocolLayerOptions;\n+        if (options == null) {\n+            options = new DigitalTwinsSendTelemetryOptions();\n+            protocolLayerOptions = null;\n+        }\n+        else {\n+            protocolLayerOptions = new com.azure.digitaltwins.core.implementation.models.DigitalTwinsSendTelemetryOptions()\n+                .setTraceparent(options.getTraceparent())\n+                .setTracestate(options.getTracestate());\n+        }\n+\n         return protocolLayer.getDigitalTwins().sendTelemetryWithResponseAsync(\n             digitalTwinId,\n-            publishTelemetryRequestOptions.getMessageId(),\n+            messageId,\n             payload,\n-            publishTelemetryRequestOptions.getTimestamp().toString(),\n+            options.getTimestamp().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyNjAyMw=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 1134}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzOTExMzEyOnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/implementation/DigitalTwinModelsImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTo0NzowMlrOHeGrfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMjowMzoxNVrOHeHGbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyODc2NQ==", "bodyText": "Do we call out these error types in our CL? They might be helpful for customers, since they get a list of expected errors. Might be worth adding a link to any documentation that the service team maintains.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501328765", "createdAt": "2020-10-07T21:47:02Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/implementation/DigitalTwinModelsImpl.java", "diffHunk": "@@ -105,43 +117,67 @@\n         @UnexpectedResponseExceptionType(ErrorResponseException.class)\n         Mono<Response<Void>> delete(\n                 @HostParam(\"$host\") String host,\n+                @HeaderParam(\"traceparent\") String traceparent,\n+                @HeaderParam(\"tracestate\") String tracestate,\n                 @PathParam(\"id\") String id,\n                 @QueryParam(\"api-version\") String apiVersion,\n                 Context context);\n \n         @Get(\"{nextLink}\")\n         @ExpectedResponses({200})\n         @UnexpectedResponseExceptionType(ErrorResponseException.class)\n-        Mono<Response<PagedModelDataCollection>> listNext(\n+        Mono<Response<PagedDigitalTwinsModelDataCollection>> listNext(\n                 @PathParam(value = \"nextLink\", encoded = true) String nextLink,\n                 @HostParam(\"$host\") String host,\n-                @HeaderParam(\"x-ms-max-item-count\") Integer maxItemCount,\n+                @HeaderParam(\"traceparent\") String traceparent,\n+                @HeaderParam(\"tracestate\") String tracestate,\n+                @HeaderParam(\"max-items-per-page\") Integer maxItemsPerPage,\n                 Context context);\n     }\n \n     /**\n-     * Uploads one or more models. When any error occurs, no models are uploaded. Status codes: 200 (OK): Success. 400\n-     * (Bad Request): The request is invalid. 409 (Conflict): One or more of the provided models already exist.\n+     * Uploads one or more models. When any error occurs, no models are uploaded. Status codes: * 201 Created * 400 Bad\n+     * Request * DTDLParserError - The models provided are not valid DTDL. * InvalidArgument - The model id is invalid.\n+     * * LimitExceeded - The maximum number of model ids allowed in 'dependenciesFor' has been reached. *\n+     * ModelVersionNotSupported - The version of DTDL used is not supported. * 409 Conflict * ModelAlreadyExists - The\n+     * model provided already exists.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMzMTM5OQ==", "bodyText": "We don't explicitly call these out in our CL, which does feel odd considering the swagger has that information. I'm not sure what the appropriate way to call this out would be. I'd rather not copy the comments from the PL into the CL since they would get out of date quickly", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501331399", "createdAt": "2020-10-07T21:52:58Z", "author": {"login": "timtay-microsoft"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/implementation/DigitalTwinModelsImpl.java", "diffHunk": "@@ -105,43 +117,67 @@\n         @UnexpectedResponseExceptionType(ErrorResponseException.class)\n         Mono<Response<Void>> delete(\n                 @HostParam(\"$host\") String host,\n+                @HeaderParam(\"traceparent\") String traceparent,\n+                @HeaderParam(\"tracestate\") String tracestate,\n                 @PathParam(\"id\") String id,\n                 @QueryParam(\"api-version\") String apiVersion,\n                 Context context);\n \n         @Get(\"{nextLink}\")\n         @ExpectedResponses({200})\n         @UnexpectedResponseExceptionType(ErrorResponseException.class)\n-        Mono<Response<PagedModelDataCollection>> listNext(\n+        Mono<Response<PagedDigitalTwinsModelDataCollection>> listNext(\n                 @PathParam(value = \"nextLink\", encoded = true) String nextLink,\n                 @HostParam(\"$host\") String host,\n-                @HeaderParam(\"x-ms-max-item-count\") Integer maxItemCount,\n+                @HeaderParam(\"traceparent\") String traceparent,\n+                @HeaderParam(\"tracestate\") String tracestate,\n+                @HeaderParam(\"max-items-per-page\") Integer maxItemsPerPage,\n                 Context context);\n     }\n \n     /**\n-     * Uploads one or more models. When any error occurs, no models are uploaded. Status codes: 200 (OK): Success. 400\n-     * (Bad Request): The request is invalid. 409 (Conflict): One or more of the provided models already exist.\n+     * Uploads one or more models. When any error occurs, no models are uploaded. Status codes: * 201 Created * 400 Bad\n+     * Request * DTDLParserError - The models provided are not valid DTDL. * InvalidArgument - The model id is invalid.\n+     * * LimitExceeded - The maximum number of model ids allowed in 'dependenciesFor' has been reached. *\n+     * ModelVersionNotSupported - The version of DTDL used is not supported. * 409 Conflict * ModelAlreadyExists - The\n+     * model provided already exists.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyODc2NQ=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMzNTY2MQ==", "bodyText": "Yeah, maintaining copies is definitely cumbersome. We could ask the service team to upload this info to some MS doc, which we could link from our CL. (if they haven't already). They might not want to maintain this solely in a swagger doc anyway.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16039#discussion_r501335661", "createdAt": "2020-10-07T22:03:15Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/implementation/DigitalTwinModelsImpl.java", "diffHunk": "@@ -105,43 +117,67 @@\n         @UnexpectedResponseExceptionType(ErrorResponseException.class)\n         Mono<Response<Void>> delete(\n                 @HostParam(\"$host\") String host,\n+                @HeaderParam(\"traceparent\") String traceparent,\n+                @HeaderParam(\"tracestate\") String tracestate,\n                 @PathParam(\"id\") String id,\n                 @QueryParam(\"api-version\") String apiVersion,\n                 Context context);\n \n         @Get(\"{nextLink}\")\n         @ExpectedResponses({200})\n         @UnexpectedResponseExceptionType(ErrorResponseException.class)\n-        Mono<Response<PagedModelDataCollection>> listNext(\n+        Mono<Response<PagedDigitalTwinsModelDataCollection>> listNext(\n                 @PathParam(value = \"nextLink\", encoded = true) String nextLink,\n                 @HostParam(\"$host\") String host,\n-                @HeaderParam(\"x-ms-max-item-count\") Integer maxItemCount,\n+                @HeaderParam(\"traceparent\") String traceparent,\n+                @HeaderParam(\"tracestate\") String tracestate,\n+                @HeaderParam(\"max-items-per-page\") Integer maxItemsPerPage,\n                 Context context);\n     }\n \n     /**\n-     * Uploads one or more models. When any error occurs, no models are uploaded. Status codes: 200 (OK): Success. 400\n-     * (Bad Request): The request is invalid. 409 (Conflict): One or more of the provided models already exist.\n+     * Uploads one or more models. When any error occurs, no models are uploaded. Status codes: * 201 Created * 400 Bad\n+     * Request * DTDLParserError - The models provided are not valid DTDL. * InvalidArgument - The model id is invalid.\n+     * * LimitExceeded - The maximum number of model ids allowed in 'dependenciesFor' has been reached. *\n+     * ModelVersionNotSupported - The version of DTDL used is not supported. * 409 Conflict * ModelAlreadyExists - The\n+     * model provided already exists.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyODc2NQ=="}, "originalCommit": {"oid": "07a2983e33a8d3f4d40214eb063f2e7a3863d526"}, "originalPosition": 95}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3550, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}