{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMDI1Nzk5", "number": 15574, "title": "Bugfix rntbd diagnostics to include rntbd timeline on the failure", "bodyText": "previously Request Timeline was missing where there is a rntbd failure. This PR fixes that to populate the timeline on the rntbd failure.\n{\n\t\"userAgent\": \"azsdk-java-cosmos/4.6.0-beta.1 MacOSX/10.15.6 JRE/11.0.6\",\n\t\"requestLatencyInMs\": 5100,\n\t\"requestStartTimeUTC\": \"23 Sep 2020 20:28:39.607\",\n\t\"requestEndTimeUTC\": \"23 Sep 2020 20:28:44.707\",\n\t\"connectionMode\": \"DIRECT\",\n\t\"responseStatisticsList\": [{\n\t\t\"storeResult\": {\n\t\t\t\"storePhysicalAddress\": null,\n\t\t\t\"lsn\": -1,\n\t\t\t\"globalCommittedLsn\": -1,\n\t\t\t\"partitionKeyRangeId\": null,\n\t\t\t\"isValid\": true,\n\t\t\t\"statusCode\": 408,\n\t\t\t\"subStatusCode\": 0,\n\t\t\t\"isGone\": false,\n\t\t\t\"isNotFound\": false,\n\t\t\t\"isInvalidPartition\": false,\n\t\t\t\"requestCharge\": 0.0,\n\t\t\t\"itemLSN\": -1,\n\t\t\t\"sessionToken\": null,\n\t\t\t\"exception\": \"AsyncRntbdRequestRecord({\\\"args\\\":{\\\"transportRequestId\\\":23335,\\\"activityId\\\":\\\"5d78954a-fddb-11ea-8b39-4d7696684a21\\\",\\\"origin\\\":\\\"rntbd://10.37.129.3:10253\\\",\\\"replicaPath\\\":\\\"/apps/DocDbApp/services/DocDbServer10/partitions/a4cb4956-38c8-11e6-8106-8cdcd42c33be/replicas/1p\\\",\\\"timeCreated\\\":\\\"2020-09-23T20:28:39.612219Z\\\",\\\"lifetime\\\":\\\"PT5.095147383S\\\"},\\\"requestLength\\\":414,\\\"responseLength\\\":-1,\\\"status\\\":{\\\"done\\\":false,\\\"cancelled\\\":false,\\\"completedExceptionally\\\":false},\\\"timeline\\\":[{\\\"eventName\\\":\\\"created\\\",\\\"durationInMicroSec\\\":\\\"69\\\",\\\"startTime\\\":\\\"2020-09-23T20:28:39.612219Z\\\"},{\\\"eventName\\\":\\\"queued\\\",\\\"durationInMicroSec\\\":\\\"196\\\",\\\"startTime\\\":\\\"2020-09-23T20:28:39.612288Z\\\"},{\\\"eventName\\\":\\\"pipelined\\\",\\\"durationInMicroSec\\\":\\\"121\\\",\\\"startTime\\\":\\\"2020-09-23T20:28:39.612484Z\\\"},{\\\"eventName\\\":\\\"transitTime\\\",\\\"durationInMicroSec\\\":\\\"5094901\\\",\\\"startTime\\\":\\\"2020-09-23T20:28:39.612605Z\\\"},{\\\"eventName\\\":\\\"received\\\",\\\"durationInMicroSec\\\":\\\"0\\\",\\\"startTime\\\":null},{\\\"eventName\\\":\\\"completed\\\",\\\"durationInMicroSec\\\":\\\"0\\\",\\\"startTime\\\":null}]})\",\n\t\t\t\"transportRequestTimeline\": [{\n\t\t\t\t\"eventName\": \"created\",\n\t\t\t\t\"durationInMicroSec\": \"69\",\n\t\t\t\t\"startTime\": \"2020-09-23T20:28:39.612219Z\"\n\t\t\t}, {\n\t\t\t\t\"eventName\": \"queued\",\n\t\t\t\t\"durationInMicroSec\": \"196\",\n\t\t\t\t\"startTime\": \"2020-09-23T20:28:39.612288Z\"\n\t\t\t}, {\n\t\t\t\t\"eventName\": \"pipelined\",\n\t\t\t\t\"durationInMicroSec\": \"121\",\n\t\t\t\t\"startTime\": \"2020-09-23T20:28:39.612484Z\"\n\t\t\t}, {\n\t\t\t\t\"eventName\": \"transitTime\",\n\t\t\t\t\"durationInMicroSec\": \"5095051\",\n\t\t\t\t\"startTime\": \"2020-09-23T20:28:39.612605Z\"\n\t\t\t}, {\n\t\t\t\t\"eventName\": \"received\",\n\t\t\t\t\"durationInMicroSec\": \"0\",\n\t\t\t\t\"startTime\": null\n\t\t\t}, {\n\t\t\t\t\"eventName\": \"completed\",\n\t\t\t\t\"durationInMicroSec\": \"181\",\n\t\t\t\t\"startTime\": \"2020-09-23T20:28:44.707656Z\"\n\t\t\t}]\n\t\t},\n\t\t\"requestResponseTimeUTC\": \"23 Sep 2020 20:28:44.707\",\n\t\t\"requestResourceType\": \"Document\",\n\t\t\"requestOperationType\": \"Read\"\n\t}],\n\t\"supplementalResponseStatisticsList\": [],\n\t\"addressResolutionStatistics\": {},\n\t\"regionsContacted\": [\"https://10.37.129.3:8081/\"],\n\t\"retryContext\": {\n\t\t\"retryCount\": 0,\n\t\t\"statusAndSubStatusCodes\": null,\n\t\t\"retryLatency\": 0\n\t},\n\t\"metadataDiagnosticsContext\": {\n\t\t\"metadataDiagnosticList\": null\n\t},\n\t\"serializationDiagnosticsContext\": {\n\t\t\"serializationDiagnosticsList\": null\n\t},\n\t\"gatewayStatistics\": null,\n\t\"systemInformation\": {\n\t\t\"usedMemory\": \"330433 KB\",\n\t\t\"availableMemory\": \"16446783 KB\",\n\t\t\"systemCpuLoad\": \"(2020-09-23T20:25:56.641107Z 24.1%), (2020-09-23T20:26:01.641921Z 17.6%), (2020-09-23T20:26:06.642183Z 8.5%), (2020-09-23T20:28:39.607013Z 7.0%), (2020-09-23T20:28:41.644180Z 6.1%), (2020-09-23T20:28:47.186529Z 10.5%)\"\n\t}\n}\nwhereas previously the rntbd transportRequestTimeline was null in the request diagnostics for the failed operations.", "createdAt": "2020-09-23T20:35:28Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15574", "merged": true, "mergeCommit": {"oid": "c2d7dfcc4a547c5bccb660fa00098013d1761717"}, "closed": true, "closedAt": "2020-09-24T05:33:56Z", "author": {"login": "moderakh"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLynMeAH2gAyNDkyMDI1Nzk5OmNmNDJlNWExMmUyZTBiZmY5Y2RhNTE4OTY0OTMzNDZmNDk5NDkzNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL5tIOgH2gAyNDkyMDI1Nzk5OmYxYjQ3YTU1OTcxMzA4YzFhMGM4YTIwOGQzMmE1ODBkOTZhNGQ0MWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cf42e5a12e2e0bff9cda51896493346f49949360", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cf42e5a12e2e0bff9cda51896493346f49949360", "committedDate": "2020-09-23T20:28:28Z", "message": "fixes diagnostics to include rntbd timeline on the failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MDU4Mjgy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15574#pullrequestreview-495058282", "createdAt": "2020-09-23T21:22:07Z", "commit": {"oid": "cf42e5a12e2e0bff9cda51896493346f49949360"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMjowN1rOHXBcYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyMjowN1rOHXBcYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMjk0Nw==", "bodyText": "Can we add a small test case by getting error and checking for request timeline in diagnostics. 404 or wrong Pk will do the work ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15574#discussion_r493902947", "createdAt": "2020-09-23T21:22:07Z", "author": {"login": "simplynaveen20"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/StoreResult.java", "diffHunk": "@@ -196,7 +196,9 @@ public void serialize(StoreResult storeResult,\n             jsonGenerator.writeNumberField(\"itemLSN\", storeResult.itemLSN);\n             jsonGenerator.writeStringField(\"sessionToken\", (storeResult.sessionToken != null ? storeResult.sessionToken.convertToString() : null));\n             jsonGenerator.writeStringField(\"exception\", BridgeInternal.getInnerErrorMessage(storeResult.exception));\n-            jsonGenerator.writeObjectField(\"transportRequestTimeline\", storeResult.storeResponse != null ? storeResult.storeResponse.getRequestTimeline() : null);\n+            jsonGenerator.writeObjectField(\"transportRequestTimeline\", storeResult.storeResponse != null ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf42e5a12e2e0bff9cda51896493346f49949360"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MDU4Nzg1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15574#pullrequestreview-495058785", "createdAt": "2020-09-23T21:23:00Z", "commit": {"oid": "cf42e5a12e2e0bff9cda51896493346f49949360"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MDcxOTM3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15574#pullrequestreview-495071937", "createdAt": "2020-09-23T21:46:42Z", "commit": {"oid": "cf42e5a12e2e0bff9cda51896493346f49949360"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MDc5MDE1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15574#pullrequestreview-495079015", "createdAt": "2020-09-23T22:00:08Z", "commit": {"oid": "cf42e5a12e2e0bff9cda51896493346f49949360"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1b47a55971308c1a0c8a208d32a580d96a4d41e", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f1b47a55971308c1a0c8a208d32a580d96a4d41e", "committedDate": "2020-09-24T04:44:17Z", "message": "added a test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3280, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}