{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NDM1OTQ4", "number": 17856, "title": "Add simulate user login behavior test", "bodyText": "Add simulate user login behavior test", "createdAt": "2020-11-27T07:05:52Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17856", "merged": true, "mergeCommit": {"oid": "108e9005bd19619d50105ae1aee2cf752bd74263"}, "closed": true, "closedAt": "2020-12-02T08:37:54Z", "author": {"login": "lu-cheng"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgh8EAgH2gAyNTI4NDM1OTQ4Ojk2M2JiNjFlOGQ3ODdmMWRmNGM0ZWNiOTU4MjU3NDdjZmMzODhlMWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiKSaEgFqTU0MjU5NjA1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "963bb61e8d787f1df4c4ecb95825747cfc388e1c", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/963bb61e8d787f1df4c4ecb95825747cfc388e1c", "committedDate": "2020-11-27T06:55:17Z", "message": "Add simulate user login behavior test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3296d08ade893509231871d1d49aa219afdf87b8", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3296d08ade893509231871d1d49aa219afdf87b8", "committedDate": "2020-11-27T07:04:23Z", "message": "Add simulate user login behavior test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNTUyMTI4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17856#pullrequestreview-540552128", "createdAt": "2020-11-30T01:34:51Z", "commit": {"oid": "3296d08ade893509231871d1d49aa219afdf87b8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwMTozNDo1MVrOH7pT4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwMTo0MTozMVrOH7pZVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjMwNDg2Ng==", "bodyText": "Add\nelse {\n    throw new IllegalStateException(\"Can not recognize osName. osName = \" + osName);\n}", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17856#discussion_r532304866", "createdAt": "2020-11-30T01:34:51Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/login/AADLoginIT.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.login;\n+\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.chrome.ChromeDriver;\n+import org.openqa.selenium.chrome.ChromeDriverService;\n+import org.openqa.selenium.support.ui.WebDriverWait;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.config.annotation.web.builders.HttpSecurity;\n+import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\n+import org.springframework.security.oauth2.client.oidc.userinfo.OidcUserRequest;\n+import org.springframework.security.oauth2.client.userinfo.OAuth2UserService;\n+import org.springframework.security.oauth2.core.oidc.user.OidcUser;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.function.Consumer;\n+import java.util.regex.Pattern;\n+\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_ID;\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_SECRET;\n+import static com.azure.test.oauth.OAuthUtils.AAD_TENANT_ID_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_NAME_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_PASSWORD_1;\n+import static org.openqa.selenium.support.ui.ExpectedConditions.presenceOfElementLocated;\n+\n+public class AADLoginIT {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AADLoginIT.class);\n+\n+    static {\n+        final String chromedriverLinux = \"src/test/resources/driver/chromedriver_linux64\";\n+        final String chromedriverWin32 = \"src/test/resources/driver/chromedriver_win32.exe\";\n+        final String chromedriverMac = \"src/test/resources/driver/chromedriver_mac64\";\n+        String osName = System.getProperty(\"os.name\").toLowerCase();\n+        if (Pattern.matches(\"linux.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverLinux);\n+        } else if (Pattern.matches(\"windows.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverWin32);\n+        } else if (Pattern.matches(\"mac.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverMac);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3296d08ade893509231871d1d49aa219afdf87b8"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjMwNDkzMQ==", "bodyText": "When can we enable it?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17856#discussion_r532304931", "createdAt": "2020-11-30T01:35:09Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/login/AADLoginIT.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.login;\n+\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.chrome.ChromeDriver;\n+import org.openqa.selenium.chrome.ChromeDriverService;\n+import org.openqa.selenium.support.ui.WebDriverWait;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.config.annotation.web.builders.HttpSecurity;\n+import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\n+import org.springframework.security.oauth2.client.oidc.userinfo.OidcUserRequest;\n+import org.springframework.security.oauth2.client.userinfo.OAuth2UserService;\n+import org.springframework.security.oauth2.core.oidc.user.OidcUser;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.function.Consumer;\n+import java.util.regex.Pattern;\n+\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_ID;\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_SECRET;\n+import static com.azure.test.oauth.OAuthUtils.AAD_TENANT_ID_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_NAME_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_PASSWORD_1;\n+import static org.openqa.selenium.support.ui.ExpectedConditions.presenceOfElementLocated;\n+\n+public class AADLoginIT {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AADLoginIT.class);\n+\n+    static {\n+        final String chromedriverLinux = \"src/test/resources/driver/chromedriver_linux64\";\n+        final String chromedriverWin32 = \"src/test/resources/driver/chromedriver_win32.exe\";\n+        final String chromedriverMac = \"src/test/resources/driver/chromedriver_mac64\";\n+        String osName = System.getProperty(\"os.name\").toLowerCase();\n+        if (Pattern.matches(\"linux.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverLinux);\n+        } else if (Pattern.matches(\"windows.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverWin32);\n+        } else if (Pattern.matches(\"mac.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverMac);\n+        }\n+    }\n+\n+//    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3296d08ade893509231871d1d49aa219afdf87b8"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjMwNTMzOQ==", "bodyText": "Use variable instead of String.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17856#discussion_r532305339", "createdAt": "2020-11-30T01:37:06Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/login/AADLoginIT.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.login;\n+\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.chrome.ChromeDriver;\n+import org.openqa.selenium.chrome.ChromeDriverService;\n+import org.openqa.selenium.support.ui.WebDriverWait;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.config.annotation.web.builders.HttpSecurity;\n+import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\n+import org.springframework.security.oauth2.client.oidc.userinfo.OidcUserRequest;\n+import org.springframework.security.oauth2.client.userinfo.OAuth2UserService;\n+import org.springframework.security.oauth2.core.oidc.user.OidcUser;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.function.Consumer;\n+import java.util.regex.Pattern;\n+\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_ID;\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_SECRET;\n+import static com.azure.test.oauth.OAuthUtils.AAD_TENANT_ID_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_NAME_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_PASSWORD_1;\n+import static org.openqa.selenium.support.ui.ExpectedConditions.presenceOfElementLocated;\n+\n+public class AADLoginIT {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AADLoginIT.class);\n+\n+    static {\n+        final String chromedriverLinux = \"src/test/resources/driver/chromedriver_linux64\";\n+        final String chromedriverWin32 = \"src/test/resources/driver/chromedriver_win32.exe\";\n+        final String chromedriverMac = \"src/test/resources/driver/chromedriver_mac64\";\n+        String osName = System.getProperty(\"os.name\").toLowerCase();\n+        if (Pattern.matches(\"linux.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverLinux);\n+        } else if (Pattern.matches(\"windows.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverWin32);\n+        } else if (Pattern.matches(\"mac.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverMac);\n+        }\n+    }\n+\n+//    @Test\n+    public void loginTest() {\n+        this.runTest(app -> {\n+            WebDriver driver = new ChromeDriver();\n+            WebDriverWait wait = new WebDriverWait(driver, 10);\n+            driver.get(app.root() + \"api/group1\");\n+            wait.until(presenceOfElementLocated(By.name(\"loginfmt\")))\n+                .sendKeys(System.getenv(AAD_USER_NAME_1) + Keys.ENTER);\n+            wait.until(presenceOfElementLocated(By.name(\"passwd\")))\n+                .sendKeys(System.getenv(AAD_USER_PASSWORD_1));\n+\n+            try {\n+                Thread.sleep(3000);\n+                driver.findElement(By.cssSelector(\"input[type='submit']\")).click();\n+                Thread.sleep(3000);\n+                driver.findElement(By.cssSelector(\"input[type='submit']\")).click();\n+                Thread.sleep(3000);\n+                Assert.assertEquals(\"group1\", driver.findElement(By.tagName(\"body\")).getText());\n+            } catch (InterruptedException e) {\n+                throw new RuntimeException(e);\n+            } finally {\n+                driver.quit();\n+            }\n+        });\n+    }\n+\n+    public void runTest(Consumer<AppRunner> command) {\n+        try (AppRunner app = new AppRunner(AADLoginIT.DumbApp.class)) {\n+            app.property(\"spring.security.oauth2.client.registration.azure.tenant-id\",\n+                System.getenv(\"AAD_TENANT_ID_1\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3296d08ade893509231871d1d49aa219afdf87b8"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjMwNTc3Mw==", "bodyText": "Add // TODO here, just remind us to delete old configuration item after new aad implementation start to work.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17856#discussion_r532305773", "createdAt": "2020-11-30T01:39:19Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/login/AADLoginIT.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.login;\n+\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.chrome.ChromeDriver;\n+import org.openqa.selenium.chrome.ChromeDriverService;\n+import org.openqa.selenium.support.ui.WebDriverWait;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.config.annotation.web.builders.HttpSecurity;\n+import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\n+import org.springframework.security.oauth2.client.oidc.userinfo.OidcUserRequest;\n+import org.springframework.security.oauth2.client.userinfo.OAuth2UserService;\n+import org.springframework.security.oauth2.core.oidc.user.OidcUser;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.function.Consumer;\n+import java.util.regex.Pattern;\n+\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_ID;\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_SECRET;\n+import static com.azure.test.oauth.OAuthUtils.AAD_TENANT_ID_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_NAME_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_PASSWORD_1;\n+import static org.openqa.selenium.support.ui.ExpectedConditions.presenceOfElementLocated;\n+\n+public class AADLoginIT {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AADLoginIT.class);\n+\n+    static {\n+        final String chromedriverLinux = \"src/test/resources/driver/chromedriver_linux64\";\n+        final String chromedriverWin32 = \"src/test/resources/driver/chromedriver_win32.exe\";\n+        final String chromedriverMac = \"src/test/resources/driver/chromedriver_mac64\";\n+        String osName = System.getProperty(\"os.name\").toLowerCase();\n+        if (Pattern.matches(\"linux.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverLinux);\n+        } else if (Pattern.matches(\"windows.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverWin32);\n+        } else if (Pattern.matches(\"mac.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverMac);\n+        }\n+    }\n+\n+//    @Test\n+    public void loginTest() {\n+        this.runTest(app -> {\n+            WebDriver driver = new ChromeDriver();\n+            WebDriverWait wait = new WebDriverWait(driver, 10);\n+            driver.get(app.root() + \"api/group1\");\n+            wait.until(presenceOfElementLocated(By.name(\"loginfmt\")))\n+                .sendKeys(System.getenv(AAD_USER_NAME_1) + Keys.ENTER);\n+            wait.until(presenceOfElementLocated(By.name(\"passwd\")))\n+                .sendKeys(System.getenv(AAD_USER_PASSWORD_1));\n+\n+            try {\n+                Thread.sleep(3000);\n+                driver.findElement(By.cssSelector(\"input[type='submit']\")).click();\n+                Thread.sleep(3000);\n+                driver.findElement(By.cssSelector(\"input[type='submit']\")).click();\n+                Thread.sleep(3000);\n+                Assert.assertEquals(\"group1\", driver.findElement(By.tagName(\"body\")).getText());\n+            } catch (InterruptedException e) {\n+                throw new RuntimeException(e);\n+            } finally {\n+                driver.quit();\n+            }\n+        });\n+    }\n+\n+    public void runTest(Consumer<AppRunner> command) {\n+        try (AppRunner app = new AppRunner(AADLoginIT.DumbApp.class)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3296d08ade893509231871d1d49aa219afdf87b8"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjMwNjA0OA==", "bodyText": "Can we use String instead of ResponseEntity?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17856#discussion_r532306048", "createdAt": "2020-11-30T01:40:26Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/login/AADLoginIT.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.login;\n+\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.chrome.ChromeDriver;\n+import org.openqa.selenium.chrome.ChromeDriverService;\n+import org.openqa.selenium.support.ui.WebDriverWait;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.config.annotation.web.builders.HttpSecurity;\n+import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\n+import org.springframework.security.oauth2.client.oidc.userinfo.OidcUserRequest;\n+import org.springframework.security.oauth2.client.userinfo.OAuth2UserService;\n+import org.springframework.security.oauth2.core.oidc.user.OidcUser;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.function.Consumer;\n+import java.util.regex.Pattern;\n+\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_ID;\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_SECRET;\n+import static com.azure.test.oauth.OAuthUtils.AAD_TENANT_ID_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_NAME_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_PASSWORD_1;\n+import static org.openqa.selenium.support.ui.ExpectedConditions.presenceOfElementLocated;\n+\n+public class AADLoginIT {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AADLoginIT.class);\n+\n+    static {\n+        final String chromedriverLinux = \"src/test/resources/driver/chromedriver_linux64\";\n+        final String chromedriverWin32 = \"src/test/resources/driver/chromedriver_win32.exe\";\n+        final String chromedriverMac = \"src/test/resources/driver/chromedriver_mac64\";\n+        String osName = System.getProperty(\"os.name\").toLowerCase();\n+        if (Pattern.matches(\"linux.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverLinux);\n+        } else if (Pattern.matches(\"windows.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverWin32);\n+        } else if (Pattern.matches(\"mac.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverMac);\n+        }\n+    }\n+\n+//    @Test\n+    public void loginTest() {\n+        this.runTest(app -> {\n+            WebDriver driver = new ChromeDriver();\n+            WebDriverWait wait = new WebDriverWait(driver, 10);\n+            driver.get(app.root() + \"api/group1\");\n+            wait.until(presenceOfElementLocated(By.name(\"loginfmt\")))\n+                .sendKeys(System.getenv(AAD_USER_NAME_1) + Keys.ENTER);\n+            wait.until(presenceOfElementLocated(By.name(\"passwd\")))\n+                .sendKeys(System.getenv(AAD_USER_PASSWORD_1));\n+\n+            try {\n+                Thread.sleep(3000);\n+                driver.findElement(By.cssSelector(\"input[type='submit']\")).click();\n+                Thread.sleep(3000);\n+                driver.findElement(By.cssSelector(\"input[type='submit']\")).click();\n+                Thread.sleep(3000);\n+                Assert.assertEquals(\"group1\", driver.findElement(By.tagName(\"body\")).getText());\n+            } catch (InterruptedException e) {\n+                throw new RuntimeException(e);\n+            } finally {\n+                driver.quit();\n+            }\n+        });\n+    }\n+\n+    public void runTest(Consumer<AppRunner> command) {\n+        try (AppRunner app = new AppRunner(AADLoginIT.DumbApp.class)) {\n+            app.property(\"spring.security.oauth2.client.registration.azure.tenant-id\",\n+                System.getenv(\"AAD_TENANT_ID_1\"));\n+            app.property(\"spring.security.oauth2.client.registration.azure.client-id\",\n+                System.getenv(AAD_MULTI_TENANT_CLIENT_ID));\n+            app.property(\"spring.security.oauth2.client.registration.azure.client-secret\",\n+                System.getenv(AAD_MULTI_TENANT_CLIENT_SECRET));\n+\n+            app.property(\"azure.activedirectory.tenant-id\", System.getenv(AAD_TENANT_ID_1));\n+            app.property(\"azure.activedirectory.client-id\", System.getenv(AAD_MULTI_TENANT_CLIENT_ID));\n+            app.property(\"azure.activedirectory.client-secret\", System.getenv(AAD_MULTI_TENANT_CLIENT_SECRET));\n+            app.property(\"azure.activedirectory.user-group.allowed-groups\", \"group1\");\n+\n+            app.start();\n+            command.accept(app);\n+        }\n+    }\n+\n+    @EnableGlobalMethodSecurity(securedEnabled = true, prePostEnabled = true)\n+    @SpringBootApplication\n+    @RestController\n+    public static class DumbApp extends WebSecurityConfigurerAdapter {\n+\n+        @Autowired\n+        private OAuth2UserService<OidcUserRequest, OidcUser> oidcUserService;\n+\n+        @PreAuthorize(\"hasRole('ROLE_group1')\")\n+        @GetMapping(value = \"/api/group1\")\n+        public ResponseEntity<String> getRoleGroup1() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3296d08ade893509231871d1d49aa219afdf87b8"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjMwNjI2MQ==", "bodyText": "Now we tested /api/group. Could you please add the following 2 apis and test them?\n\n/api/home\napi/group2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17856#discussion_r532306261", "createdAt": "2020-11-30T01:41:31Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/login/AADLoginIT.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.login;\n+\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.chrome.ChromeDriver;\n+import org.openqa.selenium.chrome.ChromeDriverService;\n+import org.openqa.selenium.support.ui.WebDriverWait;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.config.annotation.web.builders.HttpSecurity;\n+import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\n+import org.springframework.security.oauth2.client.oidc.userinfo.OidcUserRequest;\n+import org.springframework.security.oauth2.client.userinfo.OAuth2UserService;\n+import org.springframework.security.oauth2.core.oidc.user.OidcUser;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.function.Consumer;\n+import java.util.regex.Pattern;\n+\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_ID;\n+import static com.azure.test.oauth.OAuthUtils.AAD_MULTI_TENANT_CLIENT_SECRET;\n+import static com.azure.test.oauth.OAuthUtils.AAD_TENANT_ID_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_NAME_1;\n+import static com.azure.test.oauth.OAuthUtils.AAD_USER_PASSWORD_1;\n+import static org.openqa.selenium.support.ui.ExpectedConditions.presenceOfElementLocated;\n+\n+public class AADLoginIT {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AADLoginIT.class);\n+\n+    static {\n+        final String chromedriverLinux = \"src/test/resources/driver/chromedriver_linux64\";\n+        final String chromedriverWin32 = \"src/test/resources/driver/chromedriver_win32.exe\";\n+        final String chromedriverMac = \"src/test/resources/driver/chromedriver_mac64\";\n+        String osName = System.getProperty(\"os.name\").toLowerCase();\n+        if (Pattern.matches(\"linux.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverLinux);\n+        } else if (Pattern.matches(\"windows.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverWin32);\n+        } else if (Pattern.matches(\"mac.*\", osName)) {\n+            System.setProperty(ChromeDriverService.CHROME_DRIVER_EXE_PROPERTY, chromedriverMac);\n+        }\n+    }\n+\n+//    @Test\n+    public void loginTest() {\n+        this.runTest(app -> {\n+            WebDriver driver = new ChromeDriver();\n+            WebDriverWait wait = new WebDriverWait(driver, 10);\n+            driver.get(app.root() + \"api/group1\");\n+            wait.until(presenceOfElementLocated(By.name(\"loginfmt\")))\n+                .sendKeys(System.getenv(AAD_USER_NAME_1) + Keys.ENTER);\n+            wait.until(presenceOfElementLocated(By.name(\"passwd\")))\n+                .sendKeys(System.getenv(AAD_USER_PASSWORD_1));\n+\n+            try {\n+                Thread.sleep(3000);\n+                driver.findElement(By.cssSelector(\"input[type='submit']\")).click();\n+                Thread.sleep(3000);\n+                driver.findElement(By.cssSelector(\"input[type='submit']\")).click();\n+                Thread.sleep(3000);\n+                Assert.assertEquals(\"group1\", driver.findElement(By.tagName(\"body\")).getText());\n+            } catch (InterruptedException e) {\n+                throw new RuntimeException(e);\n+            } finally {\n+                driver.quit();\n+            }\n+        });\n+    }\n+\n+    public void runTest(Consumer<AppRunner> command) {\n+        try (AppRunner app = new AppRunner(AADLoginIT.DumbApp.class)) {\n+            app.property(\"spring.security.oauth2.client.registration.azure.tenant-id\",\n+                System.getenv(\"AAD_TENANT_ID_1\"));\n+            app.property(\"spring.security.oauth2.client.registration.azure.client-id\",\n+                System.getenv(AAD_MULTI_TENANT_CLIENT_ID));\n+            app.property(\"spring.security.oauth2.client.registration.azure.client-secret\",\n+                System.getenv(AAD_MULTI_TENANT_CLIENT_SECRET));\n+\n+            app.property(\"azure.activedirectory.tenant-id\", System.getenv(AAD_TENANT_ID_1));\n+            app.property(\"azure.activedirectory.client-id\", System.getenv(AAD_MULTI_TENANT_CLIENT_ID));\n+            app.property(\"azure.activedirectory.client-secret\", System.getenv(AAD_MULTI_TENANT_CLIENT_SECRET));\n+            app.property(\"azure.activedirectory.user-group.allowed-groups\", \"group1\");\n+\n+            app.start();\n+            command.accept(app);\n+        }\n+    }\n+\n+    @EnableGlobalMethodSecurity(securedEnabled = true, prePostEnabled = true)\n+    @SpringBootApplication\n+    @RestController\n+    public static class DumbApp extends WebSecurityConfigurerAdapter {\n+\n+        @Autowired\n+        private OAuth2UserService<OidcUserRequest, OidcUser> oidcUserService;\n+\n+        @PreAuthorize(\"hasRole('ROLE_group1')\")\n+        @GetMapping(value = \"/api/group1\")\n+        public ResponseEntity<String> getRoleGroup1() {\n+            return new ResponseEntity<>(\"group1\", HttpStatus.OK);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3296d08ade893509231871d1d49aa219afdf87b8"}, "originalPosition": 116}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d05e9673d6c4f93f0b6b9cc0900c80ebf9ffc04", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8d05e9673d6c4f93f0b6b9cc0900c80ebf9ffc04", "committedDate": "2020-11-30T01:53:50Z", "message": "Merge branch 'master' of github.com:Azure/azure-sdk-for-java into dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd8f06d9b53b36622bfa8d60129b32f2b572f659", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cd8f06d9b53b36622bfa8d60129b32f2b572f659", "committedDate": "2020-11-30T02:18:52Z", "message": "modify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bcc10c90e8a548ae19e04835418b96ffdf74099", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9bcc10c90e8a548ae19e04835418b96ffdf74099", "committedDate": "2020-11-30T05:51:42Z", "message": "modify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53a5fe1048cea72989857bca7dedffa2137fd9fe", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/53a5fe1048cea72989857bca7dedffa2137fd9fe", "committedDate": "2020-11-30T10:15:06Z", "message": "modify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e9eea12f9fc044f8a2c0416d771954e8c137fd6", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9e9eea12f9fc044f8a2c0416d771954e8c137fd6", "committedDate": "2020-12-01T03:16:22Z", "message": "modify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef0df75d00b7ceba0361f1b9afab87045efe6a89", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ef0df75d00b7ceba0361f1b9afab87045efe6a89", "committedDate": "2020-12-01T04:05:39Z", "message": "Add judgment to the login process"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0398d3864cce252d0167226313695a2aff2d8c8", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d0398d3864cce252d0167226313695a2aff2d8c8", "committedDate": "2020-12-01T06:46:37Z", "message": "modify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d9414e465d340cd154d2e67f4e9aa1c16092fd9", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9d9414e465d340cd154d2e67f4e9aa1c16092fd9", "committedDate": "2020-12-01T08:52:45Z", "message": "modify sleep time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "322efb2c526152a902e94b4ef61ed2d767e7fe32", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/322efb2c526152a902e94b4ef61ed2d767e7fe32", "committedDate": "2020-12-02T02:31:45Z", "message": "add log to print principal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e23253c652ce3ae0d9f58402d59b92c6fd78a211", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e23253c652ce3ae0d9f58402d59b92c6fd78a211", "committedDate": "2020-12-02T03:07:04Z", "message": "Merge branch 'master' of github.com:Azure/azure-sdk-for-java into dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "640ea2d71ac234f29102a6f38c1f72ad268d3da5", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/640ea2d71ac234f29102a6f38c1f72ad268d3da5", "committedDate": "2020-12-02T07:41:47Z", "message": "modify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53106b2b47e905ce97c8220a28649212ec517130", "author": {"user": {"login": "lu-cheng", "name": "Jack Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/53106b2b47e905ce97c8220a28649212ec517130", "committedDate": "2020-12-02T07:42:12Z", "message": "modify"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTk2MDUw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17856#pullrequestreview-542596050", "createdAt": "2020-12-02T08:29:49Z", "commit": {"oid": "53106b2b47e905ce97c8220a28649212ec517130"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1527, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}