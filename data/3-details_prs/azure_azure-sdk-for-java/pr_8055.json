{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNzkzOTcy", "number": 8055, "title": "Deep copy buffer", "bodyText": "", "createdAt": "2020-02-09T05:54:23Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055", "merged": true, "mergeCommit": {"oid": "dd9e1360e0990c6b7654eb93be4d886e70bda586"}, "closed": true, "closedAt": "2020-02-11T03:26:20Z", "author": {"login": "srnagar"}, "timelineItems": {"totalCount": 42, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCbWN1AH2gAyMzcyNzkzOTcyOmFhNGZmZTUwMWU5OTY1ZGJkN2QwYmUwZTM3Y2ZhODZjMTQwOGYwZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDI1B0gFqTM1NjM5ODAyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa4ffe501e9965dbd7d0be0e37cfa86c1408f0fe", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/aa4ffe501e9965dbd7d0be0e37cfa86c1408f0fe", "committedDate": "2020-02-08T22:05:38Z", "message": "Deep copy buffer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTg2MDA5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355586009", "createdAt": "2020-02-09T06:11:21Z", "commit": {"oid": "aa4ffe501e9965dbd7d0be0e37cfa86c1408f0fe"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwNjoxMToyMVrOFnTfYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwNjoxMjo0NlrOFnTfqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc1ODExNQ==", "bodyText": "Could this be static?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376758115", "createdAt": "2020-02-09T06:11:21Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core-http-netty/src/main/java/com/azure/core/http/netty/NettyAsyncHttpClient.java", "diffHunk": "@@ -190,7 +195,24 @@ public HttpHeaders getHeaders() {\n                 if (!reactorNettyConnection.isDisposed()) {\n                     reactorNettyConnection.channel().eventLoop().execute(reactorNettyConnection::dispose);\n                 }\n-            }).map(ByteBuf::nioBuffer);\n+            }).map(byteBuf -> {\n+                if (this.disableBufferCopy) {\n+                    return byteBuf.nioBuffer();\n+                }\n+                return deepCopyBuffer(byteBuf);\n+            });\n+        }\n+\n+        private ByteBuffer deepCopyBuffer(ByteBuf byteBuf) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa4ffe501e9965dbd7d0be0e37cfa86c1408f0fe"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc1ODE3NA==", "bodyText": "Should the name be inverse and take a boolean to allow for this to be flipped back?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376758174", "createdAt": "2020-02-09T06:12:30Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core-http-netty/src/main/java/com/azure/core/http/netty/NettyAsyncHttpClientBuilder.java", "diffHunk": "@@ -203,4 +204,9 @@ private ProxyHandler getProxyHandler(AuthorizationChallengeHandler challengeHand\n                     String.format(INVALID_PROXY_MESSAGE, proxyOptions.getType())));\n         }\n     }\n+\n+    public NettyAsyncHttpClientBuilder disableBufferCopy() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa4ffe501e9965dbd7d0be0e37cfa86c1408f0fe"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc1ODE4NA==", "bodyText": "Missing Javadoc", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376758184", "createdAt": "2020-02-09T06:12:46Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core-http-netty/src/main/java/com/azure/core/http/netty/NettyAsyncHttpClientBuilder.java", "diffHunk": "@@ -203,4 +204,9 @@ private ProxyHandler getProxyHandler(AuthorizationChallengeHandler challengeHand\n                     String.format(INVALID_PROXY_MESSAGE, proxyOptions.getType())));\n         }\n     }\n+\n+    public NettyAsyncHttpClientBuilder disableBufferCopy() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa4ffe501e9965dbd7d0be0e37cfa86c1408f0fe"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTg2NTY4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355586568", "createdAt": "2020-02-09T06:27:03Z", "commit": {"oid": "aa4ffe501e9965dbd7d0be0e37cfa86c1408f0fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwNjoyNzowM1rOFnTiJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwNjoyNzowM1rOFnTiJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc1ODgyMA==", "bodyText": "Should this be in the bodyIntern method instead?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376758820", "createdAt": "2020-02-09T06:27:03Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core-http-netty/src/main/java/com/azure/core/http/netty/NettyAsyncHttpClient.java", "diffHunk": "@@ -190,7 +195,24 @@ public HttpHeaders getHeaders() {\n                 if (!reactorNettyConnection.isDisposed()) {\n                     reactorNettyConnection.channel().eventLoop().execute(reactorNettyConnection::dispose);\n                 }\n-            }).map(ByteBuf::nioBuffer);\n+            }).map(byteBuf -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa4ffe501e9965dbd7d0be0e37cfa86c1408f0fe"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c77ddb1c8728be9d2c82f3c0c671d61840ef56f4", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c77ddb1c8728be9d2c82f3c0c671d61840ef56f4", "committedDate": "2020-02-09T06:40:30Z", "message": "Merge branch 'master' into netty-buffer-copy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6260400bfa3bd8193efc06a538dd8073d1f28aaf", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6260400bfa3bd8193efc06a538dd8073d1f28aaf", "committedDate": "2020-02-09T07:48:06Z", "message": "Disable buffer copy to support sync client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec548c331fe62230817486bccf780d09df718dea", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ec548c331fe62230817486bccf780d09df718dea", "committedDate": "2020-02-09T08:01:10Z", "message": "Add another overload to http client send"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTkwMTM2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355590136", "createdAt": "2020-02-09T08:03:21Z", "commit": {"oid": "ec548c331fe62230817486bccf780d09df718dea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwODowMzoyMVrOFnTz6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwODowMzoyMVrOFnTz6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc2MzM2OQ==", "bodyText": "can this be package private? given HttpPipeline type calls HttpClient::send()?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376763369", "createdAt": "2020-02-09T08:03:21Z", "author": {"login": "anuchandy"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/http/HttpPipelineCallContext.java", "diffHunk": "@@ -85,4 +85,8 @@ public HttpPipelineCallContext setHttpRequest(HttpRequest request) {\n         this.httpRequest = request;\n         return this;\n     }\n+\n+    public Context getContext() {\n+        return this.getContext();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec548c331fe62230817486bccf780d09df718dea"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0019a56f06c4ac8f332311d8cfba0bb0f1a7d3f0", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0019a56f06c4ac8f332311d8cfba0bb0f1a7d3f0", "committedDate": "2020-02-09T08:14:59Z", "message": "Update download overloads with context"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f03f41fb7d7f2acdd588fa1ceb4864147447a55", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7f03f41fb7d7f2acdd588fa1ceb4864147447a55", "committedDate": "2020-02-09T08:49:09Z", "message": "Clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b", "committedDate": "2020-02-09T09:00:18Z", "message": "Update versions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTkyOTUw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355592950", "createdAt": "2020-02-09T09:03:25Z", "commit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwOTowMzoyNVrOFnUBSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwOTowMzoyNVrOFnUBSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc2Njc5Mg==", "bodyText": "minor; maybe not now, but we could have a static empty ByteBuffer in class level and if size == 0, we can just return that, instead of creating a new empty duplicate reference every time.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376766792", "createdAt": "2020-02-09T09:03:25Z", "author": {"login": "anuchandy"}, "path": "sdk/core/azure-core-http-netty/src/main/java/com/azure/core/http/netty/NettyAsyncHttpClient.java", "diffHunk": "@@ -235,5 +258,17 @@ private ByteBufFlux bodyIntern() {\n         Connection internConnection() {\n             return reactorNettyConnection;\n         }\n+\n+        private static ByteBuffer deepCopyBuffer(ByteBuf byteBuf) {\n+            ByteBuffer buffer = byteBuf.nioBuffer();\n+            int offset = buffer.position();\n+            int size = buffer.remaining();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 127}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTkzMzU2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355593356", "createdAt": "2020-02-09T09:12:36Z", "commit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwOToxMjozNlrOFnUDWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwOToxMjozNlrOFnUDWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc2NzMyMQ==", "bodyText": "nit: commented code.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376767321", "createdAt": "2020-02-09T09:12:36Z", "author": {"login": "anuchandy"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/http/HttpPipelineNextPolicy.java", "diffHunk": "@@ -41,7 +41,8 @@\n \n         this.currentPolicyIndex++;\n         if (this.currentPolicyIndex == size) {\n-            return this.pipeline.getHttpClient().send(this.context.getHttpRequest());\n+            return this.pipeline.getHttpClient().send(this.context.getHttpRequest(), this.context.getContext());\n+            // return this.pipeline.getHttpClient().send(this.context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTkzNDY4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355593468", "createdAt": "2020-02-09T09:14:41Z", "commit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwOToxNDo0MVrOFnUD3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwOToxNDo0MVrOFnUD3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc2NzQ1NQ==", "bodyText": "nit; good to add bit more context on this const.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376767455", "createdAt": "2020-02-09T09:14:41Z", "author": {"login": "anuchandy"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/CoreConstants.java", "diffHunk": "@@ -0,0 +1,19 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+/**\n+ * Class to hold commonly used constants.\n+ */\n+public final class CoreConstants {\n+\n+    /**\n+     * This constant is used as key in {@link Context}.\n+     */\n+    public static final String DISABLE_BUFFER_COPY = \"disable-buffer-copy\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTkzNTEy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355593512", "createdAt": "2020-02-09T09:15:29Z", "commit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwOToxNToyOVrOFnUEFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQwOToxNToyOVrOFnUEFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc2NzUwOA==", "bodyText": "nit; Context.NONE.addData(CoreConstants.DISABLE_BUFFER_COPY, true)", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376767508", "createdAt": "2020-02-09T09:15:29Z", "author": {"login": "anuchandy"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobClientBase.java", "diffHunk": "@@ -549,8 +554,11 @@ public BlobProperties downloadToFile(String filePath, boolean overwrite) {\n         ParallelTransferOptions parallelTransferOptions, DownloadRetryOptions downloadRetryOptions,\n         BlobRequestConditions requestConditions, boolean rangeGetContentMd5, Set<OpenOption> openOptions,\n         Duration timeout, Context context) {\n+        Context updatedContext = context == null ? Context.NONE.addData(CoreConstants.DISABLE_BUFFER_COPY, true)\n+            : context.addData(\"disable-buffer-copy\", true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjIzMDY1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355623065", "createdAt": "2020-02-09T18:05:37Z", "commit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxODowNTozOFrOFnWOJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxODowNTozOFrOFnWOJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwMjg1Mg==", "bodyText": "Shouldn't the version of Netty be updated as well?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376802852", "createdAt": "2020-02-09T18:05:38Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/azure-storage-common/pom.xml", "diffHunk": "@@ -41,7 +41,7 @@\n     <dependency>\n       <groupId>com.azure</groupId>\n       <artifactId>azure-core</artifactId>\n-      <version>1.2.0</version> <!-- {x-version-update;com.azure:azure-core;dependency} -->\n+      <version>1.3.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core;current} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjMwMDYw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355630060", "createdAt": "2020-02-09T20:10:46Z", "commit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQyMDoxMDo0NlrOFnWv1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQyMDoyNTo0OVrOFnW0GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxMTQ3Nw==", "bodyText": "Reduce this to a one-liner: return disableBufferCopy ? byteBuf.nioBuffer() : deepCopyBuffer(byteBuf);", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376811477", "createdAt": "2020-02-09T20:10:46Z", "author": {"login": "JonathanGiles"}, "path": "sdk/core/azure-core-http-netty/src/main/java/com/azure/core/http/netty/NettyAsyncHttpClient.java", "diffHunk": "@@ -190,7 +208,12 @@ public HttpHeaders getHeaders() {\n                 if (!reactorNettyConnection.isDisposed()) {\n                     reactorNettyConnection.channel().eventLoop().execute(reactorNettyConnection::dispose);\n                 }\n-            }).map(ByteBuf::nioBuffer);\n+            }).map(byteBuf -> {\n+                if (this.disableBufferCopy) {\n+                    return byteBuf.nioBuffer();\n+                }\n+                return deepCopyBuffer(byteBuf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxMTY0NQ==", "bodyText": "It would be good to include code here to demonstrate how to use the buffer correctly if the user chooses to disable this, and to also talk about how this will benefit throughput and memory pressure.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376811645", "createdAt": "2020-02-09T20:13:14Z", "author": {"login": "JonathanGiles"}, "path": "sdk/core/azure-core-http-netty/src/main/java/com/azure/core/http/netty/NettyAsyncHttpClientBuilder.java", "diffHunk": "@@ -180,6 +182,22 @@ public NettyAsyncHttpClientBuilder configuration(Configuration configuration) {\n         return this;\n     }\n \n+    /**\n+     * Disables deep copy of response {@link ByteBuffer} into a heap location that is managed by this client as\n+     * opposed to the underlying netty library which may use direct buffer pool.\n+     * <br>\n+     * <b>\n+     * Caution: Disabling this is not recommended as it can lead to data corruption if the downstream consumers\n+     * of the response do not handle the byte buffers before netty releases them.\n+     * </b>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxMjQxMw==", "bodyText": "nit: Unnecessary newline", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376812413", "createdAt": "2020-02-09T20:23:36Z", "author": {"login": "JonathanGiles"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobClientBase.java", "diffHunk": "@@ -385,6 +386,7 @@ public String copyFromUrl(String copySource) {\n      */\n     public void download(OutputStream stream) {\n         downloadWithResponse(stream, null, null, null, false, null, Context.NONE);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxMjQ5Mw==", "bodyText": "I'd like to see this kind of repetitive (and verbose) code moved into a utility method.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376812493", "createdAt": "2020-02-09T20:24:55Z", "author": {"login": "JonathanGiles"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobClientBase.java", "diffHunk": "@@ -412,9 +414,12 @@ public void download(OutputStream stream) {\n     public BlobDownloadResponse downloadWithResponse(OutputStream stream, BlobRange range,\n         DownloadRetryOptions options, BlobRequestConditions requestConditions, boolean getRangeContentMd5,\n         Duration timeout, Context context) {\n+        Context updatedContext = context == null ? Context.NONE.addData(CoreConstants.DISABLE_BUFFER_COPY, true)\n+            : context.addData(CoreConstants.DISABLE_BUFFER_COPY, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxMjU2OQ==", "bodyText": "I feel a little uneasy with making this public API right now. I would rather it be impl to start with?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376812569", "createdAt": "2020-02-09T20:25:49Z", "author": {"login": "JonathanGiles"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/CoreConstants.java", "diffHunk": "@@ -0,0 +1,19 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+/**\n+ * Class to hold commonly used constants.\n+ */\n+public final class CoreConstants {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a5f8e509a1e722b6b40f67d3b85dd73b7a3c0b"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c429c1006e2f9c90fc450181699a9ba25c8e2b9a", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c429c1006e2f9c90fc450181699a9ba25c8e2b9a", "committedDate": "2020-02-09T21:17:45Z", "message": "Move context update to utility method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee15bbeede181df7cdbab65ec8dea64f5a2d9868", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ee15bbeede181df7cdbab65ec8dea64f5a2d9868", "committedDate": "2020-02-09T22:27:07Z", "message": "Updated design for sync clients"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjM5MTkz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355639193", "createdAt": "2020-02-09T22:33:50Z", "commit": {"oid": "ee15bbeede181df7cdbab65ec8dea64f5a2d9868"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQyMjozMzo1MFrOFnXZDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQyMjozMzo1MFrOFnXZDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgyMjAzMA==", "bodyText": "This class looks like it can now be reverted", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r376822030", "createdAt": "2020-02-09T22:33:50Z", "author": {"login": "JonathanGiles"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobClientBase.java", "diffHunk": "@@ -550,7 +551,8 @@ public BlobProperties downloadToFile(String filePath, boolean overwrite) {\n         BlobRequestConditions requestConditions, boolean rangeGetContentMd5, Set<OpenOption> openOptions,\n         Duration timeout, Context context) {\n         Mono<Response<BlobProperties>> download = client.downloadToFileWithResponse(filePath, range,\n-            parallelTransferOptions, downloadRetryOptions, requestConditions, rangeGetContentMd5, openOptions, context);\n+            parallelTransferOptions, downloadRetryOptions, requestConditions, rangeGetContentMd5, openOptions,\n+            context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee15bbeede181df7cdbab65ec8dea64f5a2d9868"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7d7e79dfcd6dc50adbc4225ab6e6503ae6f8689", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b7d7e79dfcd6dc50adbc4225ab6e6503ae6f8689", "committedDate": "2020-02-10T01:19:55Z", "message": "Added tests to verify deep copying and preventing deep copying"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b253bf397b0a5d69203f12041e70c0c7fd8a2b31", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b253bf397b0a5d69203f12041e70c0c7fd8a2b31", "committedDate": "2020-02-10T01:23:01Z", "message": "Update client to allow setting context just once"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d94b747e1c9af6b2f3d8a6c03f6cb37a424c1d6", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4d94b747e1c9af6b2f3d8a6c03f6cb37a424c1d6", "committedDate": "2020-02-10T01:59:53Z", "message": "Additional tests for context based configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f99f0b4e6278cd9d2fe86286accf1f3621e4c49a", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f99f0b4e6278cd9d2fe86286accf1f3621e4c49a", "committedDate": "2020-02-10T02:54:47Z", "message": "Update all builders to use deep copy context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjczOTUy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355673952", "createdAt": "2020-02-10T03:16:48Z", "commit": {"oid": "f99f0b4e6278cd9d2fe86286accf1f3621e4c49a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3eca57631b0d8cb006af7044e5dd7ba7019ed6f", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c3eca57631b0d8cb006af7044e5dd7ba7019ed6f", "committedDate": "2020-02-10T04:14:48Z", "message": "Update ShareClientBuilder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1Njg4ODc3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-355688877", "createdAt": "2020-02-10T04:43:00Z", "commit": {"oid": "c3eca57631b0d8cb006af7044e5dd7ba7019ed6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61666e55abe3b7953990309063e6f58c666366ec", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/61666e55abe3b7953990309063e6f58c666366ec", "committedDate": "2020-02-10T08:40:59Z", "message": "Fix checkstyles and spotbugs issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MTA4NTc5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-356108579", "createdAt": "2020-02-10T17:05:31Z", "commit": {"oid": "61666e55abe3b7953990309063e6f58c666366ec"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzowNTozMlrOFnuJcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzoxNzowOVrOFnujAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE5NDg2Ng==", "bodyText": "Since these two methods deepCopyBufferConfiguredInBuilder and ignoreDeepCopyBufferConfiguredInBuilder  only differs in boolean values for disableBufferCopy. Could we use dataprovider to pass the Boolean and just have one method which test both use cases ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r377194866", "createdAt": "2020-02-10T17:05:32Z", "author": {"login": "hemanttanwar"}, "path": "sdk/core/azure-core-http-netty/src/test/java/com/azure/core/http/netty/ReactorNettyClientTests.java", "diffHunk": "@@ -281,6 +291,102 @@ public void testConcurrentRequests() {\n         Assertions.fail(\"Method needs to be reimplemented\");\n     }\n \n+    /**\n+     * Tests that deep copying the buffers returned by Netty will make the stream returned to the customer resilient to\n+     * Netty reclaiming them once the 'onNext' operator chain has completed.\n+     */\n+    @Test\n+    public void deepCopyBufferConfiguredInBuilder() {\n+        HttpClient client = new NettyAsyncHttpClientBuilder().disableBufferCopy(false).build();\n+\n+        HttpResponse response = client.send(new HttpRequest(HttpMethod.GET, url(server, LONG_BODY_PATH))).block();\n+        assertNotNull(response);\n+        assertEquals(200, response.getStatusCode());\n+\n+        DelayWriteStream delayWriteStream = new DelayWriteStream();\n+        response.getBody().doOnNext(delayWriteStream::write).blockLast();\n+        assertEquals(LONG_BODY, delayWriteStream.aggregateAsString());\n+    }\n+\n+    /**\n+     * Tests that preventing deep copying the buffers returned by Netty won't make the stream returned to the customer\n+     * resilient to Netty reclaiming them once the 'onNext' operator chain has completed.\n+     */\n+    @Test\n+    public void ignoreDeepCopyBufferConfiguredInBuilder() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61666e55abe3b7953990309063e6f58c666366ec"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE5NTYwMg==", "bodyText": "Same comment , dataprovider for Boolean value ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r377195602", "createdAt": "2020-02-10T17:06:48Z", "author": {"login": "hemanttanwar"}, "path": "sdk/core/azure-core-http-netty/src/test/java/com/azure/core/http/netty/ReactorNettyClientTests.java", "diffHunk": "@@ -281,6 +291,102 @@ public void testConcurrentRequests() {\n         Assertions.fail(\"Method needs to be reimplemented\");\n     }\n \n+    /**\n+     * Tests that deep copying the buffers returned by Netty will make the stream returned to the customer resilient to\n+     * Netty reclaiming them once the 'onNext' operator chain has completed.\n+     */\n+    @Test\n+    public void deepCopyBufferConfiguredInBuilder() {\n+        HttpClient client = new NettyAsyncHttpClientBuilder().disableBufferCopy(false).build();\n+\n+        HttpResponse response = client.send(new HttpRequest(HttpMethod.GET, url(server, LONG_BODY_PATH))).block();\n+        assertNotNull(response);\n+        assertEquals(200, response.getStatusCode());\n+\n+        DelayWriteStream delayWriteStream = new DelayWriteStream();\n+        response.getBody().doOnNext(delayWriteStream::write).blockLast();\n+        assertEquals(LONG_BODY, delayWriteStream.aggregateAsString());\n+    }\n+\n+    /**\n+     * Tests that preventing deep copying the buffers returned by Netty won't make the stream returned to the customer\n+     * resilient to Netty reclaiming them once the 'onNext' operator chain has completed.\n+     */\n+    @Test\n+    public void ignoreDeepCopyBufferConfiguredInBuilder() {\n+        HttpClient client = new NettyAsyncHttpClientBuilder().disableBufferCopy(true).build();\n+\n+        HttpResponse response = client.send(new HttpRequest(HttpMethod.GET, url(server, LONG_BODY_PATH))).block();\n+        assertNotNull(response);\n+        assertEquals(200, response.getStatusCode());\n+\n+        DelayWriteStream delayWriteStream = new DelayWriteStream();\n+        response.getBody().doOnNext(delayWriteStream::write).blockLast();\n+        assertNotEquals(LONG_BODY, delayWriteStream.aggregateAsString());\n+    }\n+\n+    /**\n+     * Tests that deep copying of buffers is able to be configured via {@link Context}.\n+     */\n+    @Test\n+    public void deepCopyBufferConfiguredByContext() {\n+        HttpClient client = new ReactorNettyClientProvider().createInstance()\n+            .initContext(new Context(CoreConstants.DISABLE_BUFFER_COPY, false));\n+\n+        HttpResponse response = client.send(new HttpRequest(HttpMethod.GET, url(server, LONG_BODY_PATH))).block();\n+        assertNotNull(response);\n+        assertEquals(200, response.getStatusCode());\n+\n+        DelayWriteStream delayWriteStream = new DelayWriteStream();\n+        response.getBody().doOnNext(delayWriteStream::write).blockLast();\n+        assertEquals(LONG_BODY, delayWriteStream.aggregateAsString());\n+    }\n+\n+    /**\n+     * Tests that deep copying of buffers is able to be suppressed via {@link Context}.\n+     */\n+    @Test\n+    public void ignoreDeepCopyBufferConfiguredByContext() {\n+        HttpClient client = new ReactorNettyClientProvider().createInstance()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61666e55abe3b7953990309063e6f58c666366ec"}, "originalPosition": 160}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwMTQwOQ==", "bodyText": "Also This would be a good candidate to add sample in samples\\README.md showing how user can use this.\nAlso changelog entry for this change.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r377201409", "createdAt": "2020-02-10T17:17:09Z", "author": {"login": "hemanttanwar"}, "path": "sdk/core/azure-core-http-netty/src/main/java/com/azure/core/http/netty/NettyAsyncHttpClientBuilder.java", "diffHunk": "@@ -180,6 +182,24 @@ public NettyAsyncHttpClientBuilder configuration(Configuration configuration) {\n         return this;\n     }\n \n+    /**\n+     * Disables deep copy of response {@link ByteBuffer} into a heap location that is managed by this client as\n+     * opposed to the underlying netty library which may use direct buffer pool.\n+     * <br>\n+     * <b>\n+     * Caution: Disabling this is not recommended as it can lead to data corruption if the downstream consumers\n+     * of the response do not handle the byte buffers before netty releases them.\n+     * </b>\n+     *\n+     * @param disableBufferCopy If set to {@code true}, the client built from this builder will not deep-copy\n+     * response {@link ByteBuffer ByteBuffers}.\n+     * @return The updated {@link NettyAsyncHttpClientBuilder} object.\n+     */\n+    public NettyAsyncHttpClientBuilder disableBufferCopy(boolean disableBufferCopy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61666e55abe3b7953990309063e6f58c666366ec"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3df1acbb6844aa0ca5f334e3d5768701ad3370bf", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3df1acbb6844aa0ca5f334e3d5768701ad3370bf", "committedDate": "2020-02-10T19:20:04Z", "message": "Tests for buffering response in download to file tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MjI5NzI2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-356229726", "createdAt": "2020-02-10T20:11:59Z", "commit": {"oid": "3df1acbb6844aa0ca5f334e3d5768701ad3370bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDoxMTo1OVrOFnz_SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDoxMTo1OVrOFnz_SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5MDU2OQ==", "bodyText": "Can you add some sort of comment here that mentions this method should be called when building any sync clients because the underlying issue is not a problem in those cases? I think it'll help document why we default to using this in a bunch of our builders.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r377290569", "createdAt": "2020-02-10T20:11:59Z", "author": {"login": "rickle-msft"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/CoreUtils.java", "diffHunk": "@@ -183,4 +184,17 @@ public static boolean isNullOrEmpty(CharSequence charSequence) {\n         }\n         return Collections.emptyMap();\n     }\n+\n+    /**\n+     * Convenience method to update the input context to disable copying of HTTP response byte buffers. If the input\n+     * context is null, a new instance of context is created with a single entry to disable copying of HTTP response\n+     * byte buffers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3df1acbb6844aa0ca5f334e3d5768701ad3370bf"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05a89f7caf856bfee80fdedf46c3708e1de82636", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/05a89f7caf856bfee80fdedf46c3708e1de82636", "committedDate": "2020-02-10T21:43:09Z", "message": "Sync clients will deep copy by default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ab444657ec38fda45db1bb980963476550f62bd", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ab444657ec38fda45db1bb980963476550f62bd", "committedDate": "2020-02-10T21:59:25Z", "message": "Add code snippets and more documentation for disabled copy buffer option"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2Mjk4MjU5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-356298259", "createdAt": "2020-02-10T22:03:56Z", "commit": {"oid": "5ab444657ec38fda45db1bb980963476550f62bd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMjowMzo1NlrOFn3QAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMjowNDowNVrOFn3QXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM0NDAwMA==", "bodyText": "nit: Random newline change", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r377344000", "createdAt": "2020-02-10T22:03:56Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/http/HttpPipelineBuilder.java", "diffHunk": "@@ -40,7 +40,6 @@\n     private HttpClient httpClient;\n     private List<HttpPipelinePolicy> pipelinePolicies;\n \n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab444657ec38fda45db1bb980963476550f62bd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM0NDA5NQ==", "bodyText": "nit: Random newline change", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r377344095", "createdAt": "2020-02-10T22:04:05Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/implementation/http/HttpClientProviders.java", "diffHunk": "@@ -32,7 +32,6 @@ public static HttpClient createInstance() {\n         if (defaultProvider == null) {\n             throw new IllegalStateException(CANNOT_FIND_HTTP_CLIENT);\n         }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab444657ec38fda45db1bb980963476550f62bd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d3556f96a98be2bb433cd7ce8c1d96c3db6c7d6", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5d3556f96a98be2bb433cd7ce8c1d96c3db6c7d6", "committedDate": "2020-02-10T22:14:52Z", "message": "Remove tests that tested APIs that no longer exist"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "733b297505f81e5a99f3e4090bcc0c699e223a7a", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/733b297505f81e5a99f3e4090bcc0c699e223a7a", "committedDate": "2020-02-10T22:16:05Z", "message": "Merge branch 'netty-buffer-copy' of https://github.com/srnagar/azure-sdk-for-java into netty-buffer-copy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a151038b9dc2c7327114f6b8251b8a30736af972", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a151038b9dc2c7327114f6b8251b8a30736af972", "committedDate": "2020-02-10T22:57:46Z", "message": "Fix version tags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a60a0df57b97ab0595aa0199baac59a7c8d786", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a1a60a0df57b97ab0595aa0199baac59a7c8d786", "committedDate": "2020-02-10T23:14:45Z", "message": "Fix version tags"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MzQ2NDI4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-356346428", "createdAt": "2020-02-10T23:47:13Z", "commit": {"oid": "a1a60a0df57b97ab0595aa0199baac59a7c8d786"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMzo0NzoxM1rOFn5tXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMzo0NzoxM1rOFn5tXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM4NDI4Ng==", "bodyText": "This change and the version of core above are not the correct changes. Dependencies built outside of an area should only ever use the dependency version of a library. If the current version is needed then there should be an unreleased tag and that should exist there until that version is released. This would apply to all of the changes below where dependency was changed to current.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r377384286", "createdAt": "2020-02-10T23:47:13Z", "author": {"login": "JimSuplizio"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/pom.xml", "diffHunk": "@@ -36,12 +36,12 @@\n     <dependency>\n       <groupId>com.azure</groupId>\n       <artifactId>azure-core</artifactId>\n-      <version>1.3.0-beta.1</version> <!-- {x-version-update;unreleased_com.azure:azure-core;dependency} -->\n+      <version>1.3.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core;current} -->\n     </dependency>\n     <dependency>\n       <groupId>com.azure</groupId>\n       <artifactId>azure-core-http-netty</artifactId>\n-      <version>1.2.0</version> <!-- {x-version-update;com.azure:azure-core-http-netty;dependency} -->\n+      <version>1.3.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-http-netty;current} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a60a0df57b97ab0595aa0199baac59a7c8d786"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a56d119336b8c3677fda35b717f349de533f8a18", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a56d119336b8c3677fda35b717f349de533f8a18", "committedDate": "2020-02-11T00:41:26Z", "message": "Update version tags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dde7065bb62780dfaa2b6b1b4a8ae57f0dfb4415", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/dde7065bb62780dfaa2b6b1b4a8ae57f0dfb4415", "committedDate": "2020-02-11T01:48:09Z", "message": "Update deep copy impl"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2Mzg0Njgy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-356384682", "createdAt": "2020-02-11T01:59:49Z", "commit": {"oid": "dde7065bb62780dfaa2b6b1b4a8ae57f0dfb4415"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMTo1OTo0OVrOFn7uiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMjowMDo0N1rOFn7vUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxNzM1Mg==", "bodyText": "Why not use StepVerifier here to expect next rather than blockLast()?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r377417352", "createdAt": "2020-02-11T01:59:49Z", "author": {"login": "conniey"}, "path": "sdk/core/azure-core-http-netty/src/test/java/com/azure/core/http/netty/ReactorNettyClientTests.java", "diffHunk": "@@ -281,6 +289,56 @@ public void testConcurrentRequests() {\n         Assertions.fail(\"Method needs to be reimplemented\");\n     }\n \n+    /**\n+     * Tests that deep copying the buffers returned by Netty will make the stream returned to the customer resilient to\n+     * Netty reclaiming them once the 'onNext' operator chain has completed.\n+     */\n+    @Test\n+    public void deepCopyBufferConfiguredInBuilder() {\n+        HttpClient client = new NettyAsyncHttpClientBuilder().disableBufferCopy(false).build();\n+\n+        HttpResponse response = client.send(new HttpRequest(HttpMethod.GET, url(server, LONG_BODY_PATH))).block();\n+        assertNotNull(response);\n+        assertEquals(200, response.getStatusCode());\n+\n+        DelayWriteStream delayWriteStream = new DelayWriteStream();\n+        response.getBody().doOnNext(delayWriteStream::write).blockLast();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dde7065bb62780dfaa2b6b1b4a8ae57f0dfb4415"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxNzU1NA==", "bodyText": "StepVerifier.create(response.getBody())\n.assertNext(body -> {\n     // deserialize and assert\n})\n.expectComplete()\n.verify();", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#discussion_r377417554", "createdAt": "2020-02-11T02:00:47Z", "author": {"login": "conniey"}, "path": "sdk/core/azure-core-http-netty/src/test/java/com/azure/core/http/netty/ReactorNettyClientTests.java", "diffHunk": "@@ -281,6 +289,56 @@ public void testConcurrentRequests() {\n         Assertions.fail(\"Method needs to be reimplemented\");\n     }\n \n+    /**\n+     * Tests that deep copying the buffers returned by Netty will make the stream returned to the customer resilient to\n+     * Netty reclaiming them once the 'onNext' operator chain has completed.\n+     */\n+    @Test\n+    public void deepCopyBufferConfiguredInBuilder() {\n+        HttpClient client = new NettyAsyncHttpClientBuilder().disableBufferCopy(false).build();\n+\n+        HttpResponse response = client.send(new HttpRequest(HttpMethod.GET, url(server, LONG_BODY_PATH))).block();\n+        assertNotNull(response);\n+        assertEquals(200, response.getStatusCode());\n+\n+        DelayWriteStream delayWriteStream = new DelayWriteStream();\n+        response.getBody().doOnNext(delayWriteStream::write).blockLast();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxNzM1Mg=="}, "originalCommit": {"oid": "dde7065bb62780dfaa2b6b1b4a8ae57f0dfb4415"}, "originalPosition": 115}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2Mzk4MDI0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8055#pullrequestreview-356398024", "createdAt": "2020-02-11T03:05:01Z", "commit": {"oid": "dde7065bb62780dfaa2b6b1b4a8ae57f0dfb4415"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2381, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}