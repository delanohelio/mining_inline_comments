{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDg1NzAx", "number": 17173, "title": "T2 ServiceBus - Add byte array constructor", "bodyText": "Add byte array constructor byte[]", "createdAt": "2020-11-04T16:08:19Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173", "merged": true, "mergeCommit": {"oid": "c1a8768c7f157c23a6740d330893d0f9dbb1e8b7"}, "closed": true, "closedAt": "2020-11-04T19:55:53Z", "author": {"login": "hemanttanwar"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZQDD7AH2gAyNTE1NDg1NzAxOjc4ZWZjOGE4MDIxNjA3MDIwM2VjM2E3ZDgzMzdiMDUxYzhiMTY0Mzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZTSfUAFqTUyMzY4NzgzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "78efc8a80216070203ec3a7d8337b051c8b16438", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/78efc8a80216070203ec3a7d8337b051c8b16438", "committedDate": "2020-11-04T16:07:10Z", "message": "added byte array constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a0bcfaa843cc66fdebe28f0072096a9700cf04a", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9a0bcfaa843cc66fdebe28f0072096a9700cf04a", "committedDate": "2020-11-04T16:19:13Z", "message": "added byte array constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4c70e7804461adc4d4cd2ecbcdcb84f9ec06fc6", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c4c70e7804461adc4d4cd2ecbcdcb84f9ec06fc6", "committedDate": "2020-11-04T16:23:44Z", "message": "added byte array constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cfa51be6bdd8524a30d2915b404bc215dd6ee3d", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1cfa51be6bdd8524a30d2915b404bc215dd6ee3d", "committedDate": "2020-11-04T16:27:41Z", "message": "added byte array constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa753807c6f092846a6f3058cb08e0b8b41e42fd", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fa753807c6f092846a6f3058cb08e0b8b41e42fd", "committedDate": "2020-11-04T17:01:44Z", "message": "Added unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNTg3ODk1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#pullrequestreview-523587895", "createdAt": "2020-11-04T17:35:34Z", "commit": {"oid": "fa753807c6f092846a6f3058cb08e0b8b41e42fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNzozNTozNFrOHtiq4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNzozNTozNFrOHtiq4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUxNjAwMg==", "bodyText": "Functionally this works. But BinaryData.fromBytes() copies the byte array. Then when you get the byte array back from BinaryData, it's copied again. This will happen to every message. So this might not be the most optimal way.\nIs it possible to use the body directly without the double copy?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#discussion_r517516002", "createdAt": "2020-11-04T17:35:34Z", "author": {"login": "YijunXieMS"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusMessage.java", "diffHunk": "@@ -57,6 +57,17 @@\n \n     private Context context;\n \n+    /**\n+     * Creates a {@link ServiceBusMessage} with given byte array body.\n+     *\n+     * @param body The content of the Service bus message.\n+     *\n+     * @throws NullPointerException if {@code body} is null.\n+     */\n+    public ServiceBusMessage(byte[] body) {\n+        this(BinaryData.fromBytes(Objects.requireNonNull(body, \"'body' cannot be null.\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa753807c6f092846a6f3058cb08e0b8b41e42fd"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjAyNjcx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#pullrequestreview-523602671", "createdAt": "2020-11-04T17:54:07Z", "commit": {"oid": "fa753807c6f092846a6f3058cb08e0b8b41e42fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjEwMTEz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#pullrequestreview-523610113", "createdAt": "2020-11-04T18:03:47Z", "commit": {"oid": "fa753807c6f092846a6f3058cb08e0b8b41e42fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxODowMzo0N1rOHtjt6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxODowMzo0N1rOHtjt6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUzMzE2MA==", "bodyText": "I don't see any test that uses this constructor and verifies contents.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#discussion_r517533160", "createdAt": "2020-11-04T18:03:47Z", "author": {"login": "conniey"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusMessage.java", "diffHunk": "@@ -57,6 +57,17 @@\n \n     private Context context;\n \n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa753807c6f092846a6f3058cb08e0b8b41e42fd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e33a13c3e6bcbf142466c9ae5a7d083aac4a795", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3e33a13c3e6bcbf142466c9ae5a7d083aac4a795", "committedDate": "2020-11-04T18:39:19Z", "message": "Added test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjQ2NzMw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#pullrequestreview-523646730", "createdAt": "2020-11-04T18:54:06Z", "commit": {"oid": "3e33a13c3e6bcbf142466c9ae5a7d083aac4a795"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxODo1NDowNlrOHtldug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxODo1NDowNlrOHtldug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU2MTc4Ng==", "bodyText": "Why do we need this constructor? This instance is always created by the SDK code. So, we can just use BinaryData. I think we should add getBodyAsBytes() for the user to get the byte[] in ServiceBusREceivedMessage.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#discussion_r517561786", "createdAt": "2020-11-04T18:54:06Z", "author": {"login": "srnagar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceivedMessage.java", "diffHunk": "@@ -52,9 +53,14 @@ public AmqpAnnotatedMessage getAmqpAnnotatedMessage() {\n     }\n \n     ServiceBusReceivedMessage(BinaryData body) {\n+        Objects.requireNonNull(body, \"'body' cannot be null.\");\n         amqpAnnotatedMessage = new AmqpAnnotatedMessage(new AmqpDataBody(Collections.singletonList(body.toBytes())));\n     }\n \n+    ServiceBusReceivedMessage(byte[] body) {\n+        this(BinaryData.fromBytes(Objects.requireNonNull(body, \"'body' cannot be null.\")));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e33a13c3e6bcbf142466c9ae5a7d083aac4a795"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjU1NDkz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#pullrequestreview-523655493", "createdAt": "2020-11-04T19:06:09Z", "commit": {"oid": "3e33a13c3e6bcbf142466c9ae5a7d083aac4a795"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceb2f871a333e8b6858e3071cbd0a5d5f18d1dc6", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ceb2f871a333e8b6858e3071cbd0a5d5f18d1dc6", "committedDate": "2020-11-04T19:15:01Z", "message": "Review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjgwMjU0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#pullrequestreview-523680254", "createdAt": "2020-11-04T19:42:30Z", "commit": {"oid": "ceb2f871a333e8b6858e3071cbd0a5d5f18d1dc6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTo0MjozMFrOHtnEnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTo0MjozMFrOHtnEnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU4ODEyNw==", "bodyText": "What happens if the AmqpBodyType is SEQUENCE or VALUE?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#discussion_r517588127", "createdAt": "2020-11-04T19:42:30Z", "author": {"login": "srnagar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceivedMessage.java", "diffHunk": "@@ -84,6 +86,15 @@ public BinaryData getBody() {\n         }\n     }\n \n+    /**\n+     * Gets the actual payload/data wrapped by the {@link ServiceBusReceivedMessage}.\n+     *\n+     * @return A byte array representing the data.\n+     */\n+    public byte[] getBodyAsBytes() {\n+        return getBody().toBytes();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ceb2f871a333e8b6858e3071cbd0a5d5f18d1dc6"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjg3ODM4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17173#pullrequestreview-523687838", "createdAt": "2020-11-04T19:53:44Z", "commit": {"oid": "ceb2f871a333e8b6858e3071cbd0a5d5f18d1dc6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 210, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}