{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNzkxODM3", "number": 17008, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxODoyNzowMFrOEz6anA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMjo1NToxMFrOEz-8NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODY5OTE2OnYy", "diffSide": "RIGHT", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusManagementSerializer.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxODoyNzowMFrOHrbYYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMzo0MTozMlrOHrjDGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5OTQyNQ==", "bodyText": "Rules might also have ns1 in some cases.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17008#discussion_r515299425", "createdAt": "2020-10-30T18:27:00Z", "author": {"login": "YijunXieMS"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusManagementSerializer.java", "diffHunk": "@@ -35,21 +39,39 @@\n     public String serialize(Object object, SerializerEncoding encoding) throws IOException {\n         final String contents = jacksonAdapter.serialize(object, encoding);\n \n+        final Class<?> clazz = object.getClass();\n+        if (!CreateQueueBody.class.equals(clazz) && !CreateRuleBody.class.equals(clazz)\n+            && !CreateSubscriptionBody.class.equals(clazz)) {\n+            return contents;\n+        }\n+\n         // This hack exists because the service requires a global namespace for the XML rather than allowing\n         // each XML element to be prefaced with an explicit namespace. For example:\n         // xmlns=\"foo\" works because \"foo\" is assigned the global namespace.\n         // xmlns:ns0=\"foo\", and then prefixing all elements with ns0:AuthorizationRule will break.\n-        if (object instanceof CreateQueueBody) {\n-            final Matcher matcher = NAMESPACE_PATTERN.matcher(contents);\n-            if (matcher.find()) {\n-                final String namespace = matcher.group(\"namespace\");\n-                return contents\n-                    .replaceAll(namespace + \":\", \"\")\n-                    .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n-            }\n+        final Matcher namespaceMatcher = NAMESPACE_PATTERN.matcher(contents);\n+        if (!namespaceMatcher.find()) {\n+            logger.info(\"Could not find {} in {}\", NAMESPACE_PATTERN.pattern(), contents);\n+            return contents;\n+        }\n+\n+        final String namespace = namespaceMatcher.group(\"namespace\");\n+        final String replaced = contents\n+            .replaceAll(namespace + \":\", \"\")\n+            .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n+\n+        if (!CreateRuleBody.class.equals(clazz)) {\n+            return replaced;\n         }\n \n-        return contents;\n+        // This hack is here because RuleFilter and RuleAction type=\"Foo\" should have a namespace like n0:type=\"Foo\".\n+        final Matcher filterType = FILTER_ACTION_PATTERN.matcher(replaced);\n+        if (filterType.find()) {\n+            return filterType.replaceAll(\"<$1 xmlns:ns0=\\\"http://www.w3.org/2001/XMLSchema-instance\\\" ns0:type=\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a821796da950bd0b521aa1f41483479dd32e76c"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMDczMw==", "bodyText": "Do you know when? I couldn't find an example.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17008#discussion_r515300733", "createdAt": "2020-10-30T18:29:36Z", "author": {"login": "conniey"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusManagementSerializer.java", "diffHunk": "@@ -35,21 +39,39 @@\n     public String serialize(Object object, SerializerEncoding encoding) throws IOException {\n         final String contents = jacksonAdapter.serialize(object, encoding);\n \n+        final Class<?> clazz = object.getClass();\n+        if (!CreateQueueBody.class.equals(clazz) && !CreateRuleBody.class.equals(clazz)\n+            && !CreateSubscriptionBody.class.equals(clazz)) {\n+            return contents;\n+        }\n+\n         // This hack exists because the service requires a global namespace for the XML rather than allowing\n         // each XML element to be prefaced with an explicit namespace. For example:\n         // xmlns=\"foo\" works because \"foo\" is assigned the global namespace.\n         // xmlns:ns0=\"foo\", and then prefixing all elements with ns0:AuthorizationRule will break.\n-        if (object instanceof CreateQueueBody) {\n-            final Matcher matcher = NAMESPACE_PATTERN.matcher(contents);\n-            if (matcher.find()) {\n-                final String namespace = matcher.group(\"namespace\");\n-                return contents\n-                    .replaceAll(namespace + \":\", \"\")\n-                    .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n-            }\n+        final Matcher namespaceMatcher = NAMESPACE_PATTERN.matcher(contents);\n+        if (!namespaceMatcher.find()) {\n+            logger.info(\"Could not find {} in {}\", NAMESPACE_PATTERN.pattern(), contents);\n+            return contents;\n+        }\n+\n+        final String namespace = namespaceMatcher.group(\"namespace\");\n+        final String replaced = contents\n+            .replaceAll(namespace + \":\", \"\")\n+            .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n+\n+        if (!CreateRuleBody.class.equals(clazz)) {\n+            return replaced;\n         }\n \n-        return contents;\n+        // This hack is here because RuleFilter and RuleAction type=\"Foo\" should have a namespace like n0:type=\"Foo\".\n+        final Matcher filterType = FILTER_ACTION_PATTERN.matcher(replaced);\n+        if (filterType.find()) {\n+            return filterType.replaceAll(\"<$1 xmlns:ns0=\\\"http://www.w3.org/2001/XMLSchema-instance\\\" ns0:type=\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5OTQyNQ=="}, "originalCommit": {"oid": "8a821796da950bd0b521aa1f41483479dd32e76c"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMzNzgzNw==", "bodyText": "This is a Python generated XML that has both ns0 and ns1. Disregard this comment if Java generates differently without ns1.\nIn the following file, \"ns0\" doesn't hurt. \"ns1\" hurts.\n<ns0:entry xmlns:ns0=\"http://www.w3.org/2005/Atom\" xmlns:ns1=\"http://schemas.microsoft.com/netservices/2010/10/servicebus/connect\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n\t<ns0:content type=\"application/xml\">\n\t\t<ns1:RuleDescription>\n\t\t\t<ns1:Filter xsi:type=\"SqlFilter\">\n\t\t\t\t<ns1:CompatibilityLevel>20</ns1:CompatibilityLevel>\n\t\t\t\t<ns1:RequiresPreprocessing>true</ns1:RequiresPreprocessing>\n\t\t\t</ns1:Filter>\n\t\t\t<ns1:Action xsi:type=\"EmptyRuleAction\"/>\n\t\t\t<ns1:Name>rule1</ns1:Name>\n\t\t</ns1:RuleDescription>\n\t</ns0:content>\n</ns0:entry>", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17008#discussion_r515337837", "createdAt": "2020-10-30T19:43:30Z", "author": {"login": "YijunXieMS"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusManagementSerializer.java", "diffHunk": "@@ -35,21 +39,39 @@\n     public String serialize(Object object, SerializerEncoding encoding) throws IOException {\n         final String contents = jacksonAdapter.serialize(object, encoding);\n \n+        final Class<?> clazz = object.getClass();\n+        if (!CreateQueueBody.class.equals(clazz) && !CreateRuleBody.class.equals(clazz)\n+            && !CreateSubscriptionBody.class.equals(clazz)) {\n+            return contents;\n+        }\n+\n         // This hack exists because the service requires a global namespace for the XML rather than allowing\n         // each XML element to be prefaced with an explicit namespace. For example:\n         // xmlns=\"foo\" works because \"foo\" is assigned the global namespace.\n         // xmlns:ns0=\"foo\", and then prefixing all elements with ns0:AuthorizationRule will break.\n-        if (object instanceof CreateQueueBody) {\n-            final Matcher matcher = NAMESPACE_PATTERN.matcher(contents);\n-            if (matcher.find()) {\n-                final String namespace = matcher.group(\"namespace\");\n-                return contents\n-                    .replaceAll(namespace + \":\", \"\")\n-                    .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n-            }\n+        final Matcher namespaceMatcher = NAMESPACE_PATTERN.matcher(contents);\n+        if (!namespaceMatcher.find()) {\n+            logger.info(\"Could not find {} in {}\", NAMESPACE_PATTERN.pattern(), contents);\n+            return contents;\n+        }\n+\n+        final String namespace = namespaceMatcher.group(\"namespace\");\n+        final String replaced = contents\n+            .replaceAll(namespace + \":\", \"\")\n+            .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n+\n+        if (!CreateRuleBody.class.equals(clazz)) {\n+            return replaced;\n         }\n \n-        return contents;\n+        // This hack is here because RuleFilter and RuleAction type=\"Foo\" should have a namespace like n0:type=\"Foo\".\n+        final Matcher filterType = FILTER_ACTION_PATTERN.matcher(replaced);\n+        if (filterType.find()) {\n+            return filterType.replaceAll(\"<$1 xmlns:ns0=\\\"http://www.w3.org/2001/XMLSchema-instance\\\" ns0:type=\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5OTQyNQ=="}, "originalCommit": {"oid": "8a821796da950bd0b521aa1f41483479dd32e76c"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxNDc3MA==", "bodyText": "Normally validity of XML can be verified at generation time, I am not sure if generator are doing  that.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17008#discussion_r515414770", "createdAt": "2020-10-30T22:51:42Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusManagementSerializer.java", "diffHunk": "@@ -35,21 +39,39 @@\n     public String serialize(Object object, SerializerEncoding encoding) throws IOException {\n         final String contents = jacksonAdapter.serialize(object, encoding);\n \n+        final Class<?> clazz = object.getClass();\n+        if (!CreateQueueBody.class.equals(clazz) && !CreateRuleBody.class.equals(clazz)\n+            && !CreateSubscriptionBody.class.equals(clazz)) {\n+            return contents;\n+        }\n+\n         // This hack exists because the service requires a global namespace for the XML rather than allowing\n         // each XML element to be prefaced with an explicit namespace. For example:\n         // xmlns=\"foo\" works because \"foo\" is assigned the global namespace.\n         // xmlns:ns0=\"foo\", and then prefixing all elements with ns0:AuthorizationRule will break.\n-        if (object instanceof CreateQueueBody) {\n-            final Matcher matcher = NAMESPACE_PATTERN.matcher(contents);\n-            if (matcher.find()) {\n-                final String namespace = matcher.group(\"namespace\");\n-                return contents\n-                    .replaceAll(namespace + \":\", \"\")\n-                    .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n-            }\n+        final Matcher namespaceMatcher = NAMESPACE_PATTERN.matcher(contents);\n+        if (!namespaceMatcher.find()) {\n+            logger.info(\"Could not find {} in {}\", NAMESPACE_PATTERN.pattern(), contents);\n+            return contents;\n+        }\n+\n+        final String namespace = namespaceMatcher.group(\"namespace\");\n+        final String replaced = contents\n+            .replaceAll(namespace + \":\", \"\")\n+            .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n+\n+        if (!CreateRuleBody.class.equals(clazz)) {\n+            return replaced;\n         }\n \n-        return contents;\n+        // This hack is here because RuleFilter and RuleAction type=\"Foo\" should have a namespace like n0:type=\"Foo\".\n+        final Matcher filterType = FILTER_ACTION_PATTERN.matcher(replaced);\n+        if (filterType.find()) {\n+            return filterType.replaceAll(\"<$1 xmlns:ns0=\\\"http://www.w3.org/2001/XMLSchema-instance\\\" ns0:type=\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5OTQyNQ=="}, "originalCommit": {"oid": "8a821796da950bd0b521aa1f41483479dd32e76c"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQyNTA0OQ==", "bodyText": "The XML generated by Jackson is valid. It's the service side that is fickle about what XML it likes to consume, that's why we're doing all these hacks.\nI verified that we aren't generating multiple namespaces. The reason for this is because we use a global xml namespace, so we don't need n0.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17008#discussion_r515425049", "createdAt": "2020-10-30T23:41:32Z", "author": {"login": "conniey"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusManagementSerializer.java", "diffHunk": "@@ -35,21 +39,39 @@\n     public String serialize(Object object, SerializerEncoding encoding) throws IOException {\n         final String contents = jacksonAdapter.serialize(object, encoding);\n \n+        final Class<?> clazz = object.getClass();\n+        if (!CreateQueueBody.class.equals(clazz) && !CreateRuleBody.class.equals(clazz)\n+            && !CreateSubscriptionBody.class.equals(clazz)) {\n+            return contents;\n+        }\n+\n         // This hack exists because the service requires a global namespace for the XML rather than allowing\n         // each XML element to be prefaced with an explicit namespace. For example:\n         // xmlns=\"foo\" works because \"foo\" is assigned the global namespace.\n         // xmlns:ns0=\"foo\", and then prefixing all elements with ns0:AuthorizationRule will break.\n-        if (object instanceof CreateQueueBody) {\n-            final Matcher matcher = NAMESPACE_PATTERN.matcher(contents);\n-            if (matcher.find()) {\n-                final String namespace = matcher.group(\"namespace\");\n-                return contents\n-                    .replaceAll(namespace + \":\", \"\")\n-                    .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n-            }\n+        final Matcher namespaceMatcher = NAMESPACE_PATTERN.matcher(contents);\n+        if (!namespaceMatcher.find()) {\n+            logger.info(\"Could not find {} in {}\", NAMESPACE_PATTERN.pattern(), contents);\n+            return contents;\n+        }\n+\n+        final String namespace = namespaceMatcher.group(\"namespace\");\n+        final String replaced = contents\n+            .replaceAll(namespace + \":\", \"\")\n+            .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n+\n+        if (!CreateRuleBody.class.equals(clazz)) {\n+            return replaced;\n         }\n \n-        return contents;\n+        // This hack is here because RuleFilter and RuleAction type=\"Foo\" should have a namespace like n0:type=\"Foo\".\n+        final Matcher filterType = FILTER_ACTION_PATTERN.matcher(replaced);\n+        if (filterType.find()) {\n+            return filterType.replaceAll(\"<$1 xmlns:ns0=\\\"http://www.w3.org/2001/XMLSchema-instance\\\" ns0:type=\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5OTQyNQ=="}, "originalCommit": {"oid": "8a821796da950bd0b521aa1f41483479dd32e76c"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyOTQ0MDUzOnYy", "diffSide": "RIGHT", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusManagementSerializer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMjo1NToxMFrOHrieBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMjo1NToxMFrOHrieBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxNTU1Nw==", "bodyText": "If we could not find namespace pattern , wouldn't this be a error or warning ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17008#discussion_r515415557", "createdAt": "2020-10-30T22:55:10Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusManagementSerializer.java", "diffHunk": "@@ -35,21 +39,39 @@\n     public String serialize(Object object, SerializerEncoding encoding) throws IOException {\n         final String contents = jacksonAdapter.serialize(object, encoding);\n \n+        final Class<?> clazz = object.getClass();\n+        if (!CreateQueueBody.class.equals(clazz) && !CreateRuleBody.class.equals(clazz)\n+            && !CreateSubscriptionBody.class.equals(clazz)) {\n+            return contents;\n+        }\n+\n         // This hack exists because the service requires a global namespace for the XML rather than allowing\n         // each XML element to be prefaced with an explicit namespace. For example:\n         // xmlns=\"foo\" works because \"foo\" is assigned the global namespace.\n         // xmlns:ns0=\"foo\", and then prefixing all elements with ns0:AuthorizationRule will break.\n-        if (object instanceof CreateQueueBody) {\n-            final Matcher matcher = NAMESPACE_PATTERN.matcher(contents);\n-            if (matcher.find()) {\n-                final String namespace = matcher.group(\"namespace\");\n-                return contents\n-                    .replaceAll(namespace + \":\", \"\")\n-                    .replace(\"xmlns:\" + namespace + \"=\", \"xmlns=\");\n-            }\n+        final Matcher namespaceMatcher = NAMESPACE_PATTERN.matcher(contents);\n+        if (!namespaceMatcher.find()) {\n+            logger.info(\"Could not find {} in {}\", NAMESPACE_PATTERN.pattern(), contents);\n+            return contents;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a821796da950bd0b521aa1f41483479dd32e76c"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3799, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}