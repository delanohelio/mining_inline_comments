{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNTY0ODEz", "number": 8031, "title": "Updates logger from using Log4j 1.x to 2.x", "bodyText": "Updates the test logger from using log4j 1.x to log4j 2.x\n\nLog4j 1.x went out of support in 2015 and the last release was in 2012.\n\n\nUpdates and consolidates logger configuration/use in benchmark and examples project.\nFor benchmarks, there are some configuration values that are passed in at runtime. I assumed they are system arguments that are passed: -Dazure.cosmos.logger.directory=C:\\logs -Dazure.cosmos.hostname=test.cosmosdb.com.  If they are environment variables, I can update the lookup to use env instead of sys.", "createdAt": "2020-02-07T19:29:12Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031", "merged": true, "mergeCommit": {"oid": "894784bcfd2f080e14c2e57c6d4ed5096b850a68"}, "closed": true, "closedAt": "2020-02-10T17:22:32Z", "author": {"login": "conniey"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcB7lNhgH2gAyMzcyNTY0ODEzOjMwODg4ZWJlMmYyYjU2MmIyNzEyMTkwNGUyOWZmZjZkY2Q1OTdjODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCa9PMgFqTM1NTU3MDM1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "30888ebe2f2b562b27121904e29fff6dcd597c81", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/30888ebe2f2b562b27121904e29fff6dcd597c81", "committedDate": "2020-02-07T09:05:03Z", "message": "Update dependency commons-beanutils."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9cae3af41dea754bb4b41a9753f84af87185fc7", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a9cae3af41dea754bb4b41a9753f84af87185fc7", "committedDate": "2020-02-07T09:05:03Z", "message": "Replace log4j 1.x with 2.x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2fe7427d943fa07ee16ee63338b6a70ae54478c", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d2fe7427d943fa07ee16ee63338b6a70ae54478c", "committedDate": "2020-02-07T09:05:03Z", "message": "Rename properties file to match log4j2 specs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d6f7e447aad081f0a91b96c274a12047347b989", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d6f7e447aad081f0a91b96c274a12047347b989", "committedDate": "2020-02-07T09:05:04Z", "message": "Update properties to matching Log4j2 ones."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1db433f43703b86c6a2171a4a2b99276bfb5fe47", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1db433f43703b86c6a2171a4a2b99276bfb5fe47", "committedDate": "2020-02-07T09:05:04Z", "message": "Update to use Log4j2 through SLF4J api."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dd65ef4d431f649fdf8d699dbad3231fad6754c", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7dd65ef4d431f649fdf8d699dbad3231fad6754c", "committedDate": "2020-02-07T09:05:04Z", "message": "Update LogLevel tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9282499d3503cc04f08e23dd0f3f85adbdd5140a", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9282499d3503cc04f08e23dd0f3f85adbdd5140a", "committedDate": "2020-02-07T09:05:05Z", "message": "(WIP)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6a18526df7aa4831b32e9abe63964f572d51bd8", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a6a18526df7aa4831b32e9abe63964f572d51bd8", "committedDate": "2020-02-07T09:05:05Z", "message": "Resetting context after each test run."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0065bbb3fa922bc6600629bf0293c8bd84afe8ff", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0065bbb3fa922bc6600629bf0293c8bd84afe8ff", "committedDate": "2020-02-07T09:05:05Z", "message": "Fix ProxyHostTest."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "761371e9d83b119bf01a2465bb6d9c3ed1ce48e2", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/761371e9d83b119bf01a2465bb6d9c3ed1ce48e2", "committedDate": "2020-02-07T09:05:06Z", "message": "Always reset logging configuration."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "292d3039f7d24083de21efc2f82b004b2ecfdffb", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/292d3039f7d24083de21efc2f82b004b2ecfdffb", "committedDate": "2020-02-07T18:54:50Z", "message": "Update to log4j2 properties."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bed4f419b3a104aaed322ec82bb7c812e882d5ae", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bed4f419b3a104aaed322ec82bb7c812e882d5ae", "committedDate": "2020-02-07T18:55:47Z", "message": "Move netty configuration back into properties file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "256900073b7bba8eb58f3afe3b749988a905bc42", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/256900073b7bba8eb58f3afe3b749988a905bc42", "committedDate": "2020-02-07T18:56:06Z", "message": "Remove usage of slf4j-log4j12"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d00720c0e56564e77f30151af447c7c94d215d3", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d00720c0e56564e77f30151af447c7c94d215d3", "committedDate": "2020-02-07T19:09:32Z", "message": "Add tests for expected log configuration."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83d1dd3b2bd8dba89207f5d4f22a91e08ccc800f", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/83d1dd3b2bd8dba89207f5d4f22a91e08ccc800f", "committedDate": "2020-02-07T19:10:39Z", "message": "Rename to log4j2.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "912178e345e7f5e382e94d9f65470b20c52a322d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/912178e345e7f5e382e94d9f65470b20c52a322d", "committedDate": "2020-02-07T19:20:04Z", "message": "Update to log4j 2 syntax."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2588ad7ae4f4a5fd7a9504bbe5f808f5b386a26", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e2588ad7ae4f4a5fd7a9504bbe5f808f5b386a26", "committedDate": "2020-02-07T19:20:17Z", "message": "Comment out FileAppender because it is not used."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a772131516a3dd2ddfd2106dcf0aafd4fc16afd7", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a772131516a3dd2ddfd2106dcf0aafd4fc16afd7", "committedDate": "2020-02-07T19:26:59Z", "message": "Remove common-beanutil udpate."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f934d7ac4419fcc924eceda7cf692b6047bc3361", "committedDate": "2020-02-07T19:28:41Z", "message": "Add group back."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDAyNjY0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#pullrequestreview-355402664", "createdAt": "2020-02-07T19:58:44Z", "commit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxOTo1OToxMlrOFnIo7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMDowMzoxN1rOFnIvjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MDMzMw==", "bodyText": "ditto", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376580333", "createdAt": "2020-02-07T19:59:12Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/microsoft-azure-cosmos/src/test/java/com/azure/data/cosmos/rx/LogLevelTest.java", "diffHunk": "@@ -197,16 +235,16 @@ public void createDocumentWithDebugLevelAtRoot() throws Exception {\n     /**\n      * This test will try to create document with netty wire ERROR logging and\n      * validate it.\n-     * \n+     *\n      * @throws Exception\n      */\n     @Test(groups = { \"simple\" }, timeOut = TIMEOUT)\n     public void createDocumentWithErrorClient() throws Exception {\n-        LogManager.getRootLogger().setLevel(Level.INFO);\n-        LogManager.getLogger(NETWORK_LOGGING_CATEGORY).setLevel(Level.ERROR);\n-        StringWriter consoleWriter = new StringWriter();\n-        WriterAppender appender = new WriterAppender(new PatternLayout(), consoleWriter);\n-        Logger.getLogger(NETWORK_LOGGING_CATEGORY).addAppender(appender);\n+        final StringWriter consoleWriter = new StringWriter();\n+\n+        addAppenderAndLogger(NETWORK_LOGGING_CATEGORY, Level.ERROR, APPENDER_NAME, consoleWriter);\n+        Logger logger = LoggerFactory.getLogger(NETWORK_LOGGING_CATEGORY);\n+        Assert.assertTrue(logger.isErrorEnabled());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361"}, "originalPosition": 206}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MTcyMg==", "bodyText": "We are using assertj for assertion, please use this instead:\nimport static org.assertj.core.api.Assertions.assertThat;\n\nassertThat(logger.isErrorEnabled()).isTrue()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376581722", "createdAt": "2020-02-07T20:02:31Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/microsoft-azure-cosmos-benchmark/src/test/java/com/azure/data/cosmos/benchmark/LoggerConfigurationTest.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package com.azure.data.cosmos.benchmark;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+public class LoggerConfigurationTest {\n+    /**\n+     * Netty logging is off. We expect error logging to be disabled.\n+     */\n+    @Test(groups = {\"unit\"})\n+    public void nettyIsDisabled() {\n+        final Logger logger = LoggerFactory.getLogger(\"io.netty\");\n+        final Logger logger2 = LoggerFactory.getLogger(\"io.netty.channel\");\n+\n+        Assert.assertFalse(logger.isErrorEnabled());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MTg4Mw==", "bodyText": "ditto\nWe are using assertj for assertion, please use this instead:\nimport static org.assertj.core.api.Assertions.assertThat;\n\nassertThat(logger.isErrorEnabled()).isFase()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376581883", "createdAt": "2020-02-07T20:02:56Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/microsoft-azure-cosmos-benchmark/src/test/java/com/azure/data/cosmos/benchmark/LoggerConfigurationTest.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package com.azure.data.cosmos.benchmark;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+public class LoggerConfigurationTest {\n+    /**\n+     * Netty logging is off. We expect error logging to be disabled.\n+     */\n+    @Test(groups = {\"unit\"})\n+    public void nettyIsDisabled() {\n+        final Logger logger = LoggerFactory.getLogger(\"io.netty\");\n+        final Logger logger2 = LoggerFactory.getLogger(\"io.netty.channel\");\n+\n+        Assert.assertFalse(logger.isErrorEnabled());\n+        Assert.assertFalse(logger2.isErrorEnabled());\n+    }\n+\n+    /**\n+     * Loggers in the cosmos package should inherit root configuration and log at info.\n+     */\n+    @Test(groups = {\"unit\"})\n+    public void defaultLoggersAtInfo() {\n+        final Logger logger = LoggerFactory.getLogger(\"com.azure.cosmos.internal.query.aggregation\");\n+        final Logger logger2 = LoggerFactory.getLogger(\"com.azure.cosmos\");\n+\n+        Assert.assertTrue(logger.isInfoEnabled());\n+        Assert.assertTrue(logger2.isInfoEnabled());\n+\n+        Assert.assertFalse(logger.isDebugEnabled());\n+        Assert.assertFalse(logger2.isDebugEnabled());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU4MjAzMA==", "bodyText": "here and everywhere else please,\nditto", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376582030", "createdAt": "2020-02-07T20:03:17Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/microsoft-azure-cosmos/src/test/java/com/azure/data/cosmos/rx/LogLevelTest.java", "diffHunk": "@@ -50,18 +60,30 @@ public void beforeClass() {\n         createdCollection = getSharedMultiPartitionCosmosContainer(client);\n     }\n \n+    @AfterMethod(groups = { \"simple\" })\n+    public void afterMethod() {\n+        resetLoggingConfiguration();\n+    }\n+\n+    @AfterClass(groups = { \"simple\" }, timeOut = SHUTDOWN_TIMEOUT)\n+    public void afterClass() {\n+        resetLoggingConfiguration();\n+    }\n+\n     /**\n      * This test will try to create document with netty wire DEBUG logging and\n      * validate it.\n-     * \n+     *\n      * @throws Exception\n      */\n     @Test(groups = { \"simple\" }, timeOut = TIMEOUT)\n     public void createDocumentWithDebugLevel() throws Exception {\n-        LogManager.getLogger(NETWORK_LOGGING_CATEGORY).setLevel(Level.DEBUG);\n-        StringWriter consoleWriter = new StringWriter();\n-        WriterAppender appender = new WriterAppender(new PatternLayout(), consoleWriter);\n-        LogManager.getLogger(NETWORK_LOGGING_CATEGORY).addAppender(appender);\n+        final StringWriter consoleWriter = new StringWriter();\n+\n+        addAppenderAndLogger(NETWORK_LOGGING_CATEGORY, Level.DEBUG, APPENDER_NAME, consoleWriter);\n+\n+        Logger logger = LoggerFactory.getLogger(NETWORK_LOGGING_CATEGORY);\n+        Assert.assertTrue(logger.isDebugEnabled());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f934d7ac4419fcc924eceda7cf692b6047bc3361"}, "originalPosition": 83}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0349e616cf71aaa03aed7b7ca539023ddc10d6c", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b0349e616cf71aaa03aed7b7ca539023ddc10d6c", "committedDate": "2020-02-07T20:13:37Z", "message": "Update to assertj assertions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDM1NzY0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#pullrequestreview-355435764", "createdAt": "2020-02-07T21:04:27Z", "commit": {"oid": "b0349e616cf71aaa03aed7b7ca539023ddc10d6c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMTowNDoyN1rOFnKQMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMTowNDoyN1rOFnKQMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwNjc2OA==", "bodyText": "Removing this makes me very, very happy...log4j:log4j:1.2.17 is 8 years old.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#discussion_r376606768", "createdAt": "2020-02-07T21:04:27Z", "author": {"login": "JimSuplizio"}, "path": "eng/versioning/external_dependencies.txt", "diffHunk": "@@ -66,7 +66,6 @@ io.opentelemetry:opentelemetry-api;0.2.0\n io.opentelemetry:opentelemetry-sdk;0.2.0\n io.projectreactor:reactor-test;3.3.0.RELEASE\n junit:junit;4.13-beta-3\n-log4j:log4j;1.2.17", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0349e616cf71aaa03aed7b7ca539023ddc10d6c"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTY0MTI2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#pullrequestreview-355564126", "createdAt": "2020-02-08T19:21:03Z", "commit": {"oid": "b0349e616cf71aaa03aed7b7ca539023ddc10d6c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTY1MjU4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#pullrequestreview-355565258", "createdAt": "2020-02-08T19:45:54Z", "commit": {"oid": "b0349e616cf71aaa03aed7b7ca539023ddc10d6c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTcwMzUz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8031#pullrequestreview-355570353", "createdAt": "2020-02-08T21:38:21Z", "commit": {"oid": "b0349e616cf71aaa03aed7b7ca539023ddc10d6c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2522, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}