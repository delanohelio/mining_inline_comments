{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0OTk5OTkw", "number": 18336, "title": "Add Test Coverage tab for Communication", "bodyText": "", "createdAt": "2020-12-23T19:44:18Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336", "merged": true, "mergeCommit": {"oid": "f0d25742dc71348668aca87c57eb3a1ad39e4e5a"}, "closed": true, "closedAt": "2021-01-04T18:23:42Z", "author": {"login": "minnieliu"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpEgxogH2gAyNTQ0OTk5OTkwOjM5NDZlNDE1YTNiMTg5NTVhY2YyNzhhMTdkZDdmNjEwNWE5NmNmOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABds9zVbgFqTU2MTM4MzM1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3946e415a3b18955acf278a17dd7f6105a96cf8b", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3946e415a3b18955acf278a17dd7f6105a96cf8b", "committedDate": "2020-12-23T19:43:33Z", "message": "Add Test Coverage tab for Communication"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MjIwODg4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#pullrequestreview-558220888", "createdAt": "2020-12-23T20:45:32Z", "commit": {"oid": "3946e415a3b18955acf278a17dd7f6105a96cf8b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo0NTozM1rOIK02bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo0ODo1N1rOIK1BBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyMjU3Mg==", "bodyText": "nit: Move this task to run immediately after the 'Run tests: $(DisplayName)' task is complete.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548222572", "createdAt": "2020-12-23T20:45:33Z", "author": {"login": "srnagar"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -159,10 +159,34 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - task: Maven@3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3946e415a3b18955acf278a17dd7f6105a96cf8b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyNTI4NA==", "bodyText": "Add this condition here as well - , eq('${{ parameters.ServiceDirectory }}', 'communication')", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548225284", "createdAt": "2020-12-23T20:48:57Z", "author": {"login": "srnagar"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -159,10 +159,34 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - task: Maven@3\n+        displayName: 'Generate aggregate code coverage report'\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'), eq('${{ parameters.ServiceDirectory }}', 'communication'))\n+        inputs:\n+          mavenPomFile: sdk/${{ parameters.ServiceDirectory }}/pom.xml\n+          options: -Pcoverage\n+          mavenOptions: '$(MemoryOptions) $(LoggingOptions)'\n+          javaHomeOption: 'JDKVersion'\n+          jdkVersionOption: $(JavaTestVersion)\n+          jdkArchitectureOption: 'x64'\n+          goals: jacoco:report-aggregate\n+          # we want to run this when TestFromSource isn't true\n+          condition: and(succeeded(), ne(variables['TestFromSource'],'true'))\n+\n       - task: PublishTestResults@2\n         condition: always()\n         inputs:\n           mergeTestResults: true\n           testRunTitle: 'Live tests for ${{ parameters.ServiceDirectory }} $(DisplayName)'\n           ${{ if ne(parameters.TestResultsFiles, '') }}:\n             testResultsFiles: ${{ parameters.TestResultsFiles }}\n+\n+      # Azure DevOps only seems to respect the last code coverage result published, so only do this for Windows + Java LTS.\n+      # Code coverage reporting is setup only for Track 2 modules.\n+      - task: PublishCodeCoverageResults@1\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3946e415a3b18955acf278a17dd7f6105a96cf8b"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a505201bd2b45f26eff3c8b726ef4d4c52cff9ba", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a505201bd2b45f26eff3c8b726ef4d4c52cff9ba", "committedDate": "2020-12-23T20:58:10Z", "message": "Address code review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c18d35b6baf9f087cd38fb2743d390dcc2c0f5d0", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c18d35b6baf9f087cd38fb2743d390dcc2c0f5d0", "committedDate": "2021-01-04T17:32:59Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into enableCoverageLivePipeline"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMzgzMzU0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#pullrequestreview-561383354", "createdAt": "2021-01-04T22:10:10Z", "commit": {"oid": "c18d35b6baf9f087cd38fb2743d390dcc2c0f5d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMjoxMDoxMFrOIOC8dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMjoxMDoxMFrOIOC8dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU5OTIyMQ==", "bodyText": "We should avoid hardcoding checks specific to one service in our common templates. Instead we should have an opt-in or opt-out that can be set in the ci.yml for a given service.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r551599221", "createdAt": "2021-01-04T22:10:10Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -149,6 +149,20 @@ jobs:\n           ${{ insert }}: ${{ parameters.TestStepMavenInputs }}\n         env: ${{ parameters.EnvVars }}\n \n+      - task: Maven@3\n+        displayName: 'Generate aggregate code coverage report'\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'), eq('${{ parameters.ServiceDirectory }}', 'communication'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c18d35b6baf9f087cd38fb2743d390dcc2c0f5d0"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1138, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}