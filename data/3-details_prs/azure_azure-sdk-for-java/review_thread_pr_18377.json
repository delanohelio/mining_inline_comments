{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2MDI5Mjg5", "number": 18377, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDoxOTozOFrOFJiczw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDo0Mzo1NVrOFJiytg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTQ1OTM1OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDoxOTozOFrOIL6hWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDoxOTozOFrOIL6hWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM2NDA1Nw==", "bodyText": "remove this unnecessary change.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549364057", "createdAt": "2020-12-28T14:19:38Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -41,6 +40,7 @@ The authorization flow for web application includes:\n * When on-demand resources are visited, associated clients will be loaded and trigger **authorization code flow** like the `azure` client.\n \n The authorization flow for resource server:\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTQ4MTkyOnYy", "diffSide": "LEFT", "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDoyOToxN1rOIL6t7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDoyOToxN1rOIL6t7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM2NzI3OQ==", "bodyText": "We should keep this empty line.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549367279", "createdAt": "2020-12-28T14:29:17Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -87,12 +87,12 @@ API permissions of a resource server that the application is going to acquire.\n * azure.activedirectory.authorization-clients.{client-name}.scopes.on-demand:    \n If the authorization flow of current resource server will be executed on demand. The default value is false.\n ### Web application\n-Based on Azure AD as a Web application, it uses OAuth2 authorization code flow to authentication, and authorizes resources based on the groups or roles claim in the access token. \n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTQ4NDAyOnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDozMDowNVrOIL6vGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDozMDowNVrOIL6vGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM2NzU3OQ==", "bodyText": "Are we forgetting to add the link?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549367579", "createdAt": "2020-12-28T14:30:05Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -169,8 +167,7 @@ public class AADOAuth2LoginConfigSample extends AADWebSecurityConfigurerAdapter\n ```\n \n ### Authenticate in frontend\n-\n-Please refer to [azure-active-directory-spring-boot-sample-with-filter](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-with-filter/README.md) for how to integrate Spring Security and Azure AD for authentication and authorization in a Single Page Application (SPA) scenario.\n+Please refer to [azure-active-directory-spring-boot-sample-with-filter] for how to integrate Spring Security and Azure AD for authentication and authorization in a Single Page Application (SPA) scenario.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTQ4OTc1OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDozMzowOVrOIL6ykg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDozMzowOVrOIL6ykg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM2ODQ2Ng==", "bodyText": "Please add a space between App Roles", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549368466", "createdAt": "2020-12-28T14:33:09Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -196,14 +193,9 @@ public class AADAuthenticationFilterConfigSample extends WebSecurityConfigurerAd\n * Role-based Authorization with annotation `@PreAuthorize(\"hasRole('GROUP_NAME')\")`\n * Role-based Authorization with method `isMemberOf()`\n \n-\n ### Authenticate stateless APIs using AAD app roles\n-This scenario fits best for stateless Spring backends exposing an API to SPAs ([OAuth 2.0 implicit grant flow](https://docs.microsoft.com/azure/active-directory/develop/v1-oauth2-implicit-grant-flow)) \n-or service-to-service access using the [client credentials grant flow](https://docs.microsoft.com/azure/active-directory/develop/v1-oauth2-client-creds-grant-flow).\n-\n-The stateless processing can be activated with the `azure.activedirectory.session-stateless` property. \n-The authorization is using the [AAD AppRole feature](https://docs.microsoft.com/azure/architecture/multitenant-identity/app-roles#roles-using-azure-ad-app-roles),\n-so instead of using the `groups` claim the token has a `roles` claim which contains roles [configured in your manifest](https://docs.microsoft.com/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps#examples). \n+This scenario fits best for stateless Spring backends exposing an API to SPAs ([OAuth 2.0 implicit grant flow]) or service-to-service access using the [client credentials grant flow].\n+The stateless processing can be activated with the `azure.activedirectory.session-stateless` property. The authorization is using the [AAD AppRole feature], so instead of using the `groups` claim the token has a `roles` claim which contains roles [configured in your manifest]. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTQ5NjMxOnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDozNTozOVrOIL62KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDozNTozOVrOIL62KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM2OTM4NA==", "bodyText": "Do we really need this section?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549369384", "createdAt": "2020-12-28T14:35:39Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -321,6 +310,98 @@ public class AADOAuth2ResourceServerSecurityConfig extends WebSecurityConfigurer\n }\n ```\n \n+#### The default comes with an AAD Access Token validator:\n+```java\n+@Bean\n+@ConditionalOnMissingBean(JwtDecoder.class)\n+public JwtDecoder jwtDecoder() {\n+     AADAuthorizationServerEndpoints identityEndpoints = new AADAuthorizationServerEndpoints(\n+     aadAuthenticationProperties.getBaseUri(), aadAuthenticationProperties.getTenantId());\n+     NimbusJwtDecoder nimbusJwtDecoder = NimbusJwtDecoder\n+     .withJwkSetUri(identityEndpoints.jwkSetEndpoint()).build();\n+     List<OAuth2TokenValidator<Jwt>> validators = createDefaultValidator();\n+     nimbusJwtDecoder.setJwtValidator(new DelegatingOAuth2TokenValidator<>(validators));\n+     return nimbusJwtDecoder;\n+}\n+\n+public List<OAuth2TokenValidator<Jwt>> createDefaultValidator() {\n+     List<OAuth2TokenValidator<Jwt>> validators = new ArrayList<>();\n+     List<String> validAudiences = new ArrayList<>();\n+     if (!StringUtils.isEmpty(aadAuthenticationProperties.getAppIdUri())) {\n+        validAudiences.add(aadAuthenticationProperties.getAppIdUri());\n+     }\n+     if (!StringUtils.isEmpty(aadAuthenticationProperties.getClientId())) {\n+        validAudiences.add(aadAuthenticationProperties.getClientId());\n+     }\n+     if (!validAudiences.isEmpty()) {\n+        validators.add(new AADJwtAudienceValidator(validAudiences));\n+     }\n+     validators.add(new AADJwtIssuerValidator());\n+     validators.add(new JwtTimestampValidator());\n+     return validators;\n+}\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 140}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTUwMzQyOnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDozODozM1rOIL66BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDozOToyN1rOIL67NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM3MDM3Mg==", "bodyText": "We should move this section along with obo one ahead of the Authenticate in frontend section since we're deprecating the filters.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549370372", "createdAt": "2020-12-28T14:38:33Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -283,8 +273,8 @@ azure:\n         scopes: {scope1}, {scope2}\n ``` \n \n-### Protect the Resource API through Resource Server\n-Please refer to [azure-spring-boot-sample-active-directory-spring-oauth2-resource-server][resource-server] for access resource api.\n+### Protect the resource APIs in webapi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM3MDQ5MQ==", "bodyText": "We should find a better word here, instead of webapi.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549370491", "createdAt": "2020-12-28T14:38:56Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -283,8 +273,8 @@ azure:\n         scopes: {scope1}, {scope2}\n ``` \n \n-### Protect the Resource API through Resource Server\n-Please refer to [azure-spring-boot-sample-active-directory-spring-oauth2-resource-server][resource-server] for access resource api.\n+### Protect the resource APIs in webapi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM3MDM3Mg=="}, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM3MDY3Nw==", "bodyText": "Or we could use resource server?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549370677", "createdAt": "2020-12-28T14:39:27Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -283,8 +273,8 @@ azure:\n         scopes: {scope1}, {scope2}\n ``` \n \n-### Protect the Resource API through Resource Server\n-Please refer to [azure-spring-boot-sample-active-directory-spring-oauth2-resource-server][resource-server] for access resource api.\n+### Protect the resource APIs in webapi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM3MDM3Mg=="}, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTUwNzAyOnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDo0MDoxNFrOIL68Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDo0MDoxNFrOIL68Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM3MDg5MA==", "bodyText": "change for access webapi to for access resource APIs", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549370890", "createdAt": "2020-12-28T14:40:14Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -283,8 +273,8 @@ azure:\n         scopes: {scope1}, {scope2}\n ``` \n \n-### Protect the Resource API through Resource Server\n-Please refer to [azure-spring-boot-sample-active-directory-spring-oauth2-resource-server][resource-server] for access resource api.\n+### Protect the resource APIs in webapi\n+Please refer to [azure-spring-boot-sample-active-directory-resource-server] for access webapi.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTUxNTQyOnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDo0Mzo1NlrOIL7AwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNDo0Mzo1NlrOIL7AwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM3MjA5Ng==", "bodyText": "Can we move this to the last one?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18377#discussion_r549372096", "createdAt": "2020-12-28T14:43:56Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/README.md", "diffHunk": "@@ -336,29 +417,39 @@ logging.level.org.springframework.web=DEBUG\n logging.level.org.hibernate=ERROR\n ```\n \n-For more information about setting logging in spring, please refer to the [official doc](https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-logging).\n- \n+For more information about setting logging in spring, please refer to the [official doc].\n \n ## Next steps\n The following section provides sample projects illustrating how to use the starter in different cases.\n ### More sample code\n-- [Azure Active Directory for Resource Server with Filter(Deprecated)](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-with-filter)\n-- [Azure Active Directory for Web Application](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-webapp)\n+- [Azure Active Directory for Resource Server with Filter(Deprecated)][azure-spring-boot-sample-active-directory-resource-server-with-filter]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e16068ecdfeb175631ade0d40b029d28b335acf1"}, "originalPosition": 218}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1747, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}