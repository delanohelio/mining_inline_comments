{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0Njk5ODY3", "number": 15801, "title": "Use 'tenant-id' instead of 'common' in ClientRegistration.", "bodyText": "Use 'tenant-id' instead of 'common' in ClientRegistration.", "createdAt": "2020-09-29T09:41:53Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15801", "merged": true, "mergeCommit": {"oid": "692e3640db07781c779fea3fceb7d95d183916a3"}, "closed": true, "closedAt": "2020-10-12T05:15:03Z", "author": {"login": "chenrujun"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNk8k-AH2gAyNDk0Njk5ODY3OjZmMzM0MmZkMGMwMTJkYzM3ODA1YzVjOTg5MzJkYzM4OTYyNTVkYTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdRs66RgFqTUwNjI5NjU1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f3342fd0c012dc37805c5c98932dc3896255da9", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6f3342fd0c012dc37805c5c98932dc3896255da9", "committedDate": "2020-09-29T09:41:00Z", "message": "Use 'tenant-id' instead of 'common' in ClientRegistration."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NTAwNjY2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15801#pullrequestreview-498500666", "createdAt": "2020-09-29T13:59:11Z", "commit": {"oid": "6f3342fd0c012dc37805c5c98932dc3896255da9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo1OToxMVrOHZupXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo1OToxMVrOHZupXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc0MDcwMg==", "bodyText": "Will multi-tenant application still function with this change?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15801#discussion_r496740702", "createdAt": "2020-09-29T13:59:11Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/microsoft/azure/spring/autoconfigure/aad/AADOAuth2AutoConfiguration.java", "diffHunk": "@@ -36,29 +42,69 @@\n @ConditionalOnResource(resources = \"classpath:aad.enable.config\")\n @ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)\n @ConditionalOnProperty(prefix = \"azure.activedirectory\", value = \"tenant-id\")\n-@PropertySource(value = \"classpath:aad-oauth2-common.properties\")\n @PropertySource(value = \"classpath:service-endpoints.properties\")\n @EnableConfigurationProperties({ AADAuthenticationProperties.class, ServiceEndpointsProperties.class })\n public class AADOAuth2AutoConfiguration {\n \n-    private final AADAuthenticationProperties aadAuthProps;\n-    private final ServiceEndpointsProperties serviceEndpointsProps;\n+    private final AADAuthenticationProperties aadAuthenticationProperties;\n+    private final ServiceEndpointsProperties serviceEndpointsProperties;\n \n     public AADOAuth2AutoConfiguration(AADAuthenticationProperties aadAuthProperties,\n-                                      ServiceEndpointsProperties serviceEndpointsProps) {\n-        this.aadAuthProps = aadAuthProperties;\n-        this.serviceEndpointsProps = serviceEndpointsProps;\n+                                      ServiceEndpointsProperties serviceEndpointsProperties) {\n+        this.aadAuthenticationProperties = aadAuthProperties;\n+        this.serviceEndpointsProperties = serviceEndpointsProperties;\n     }\n \n     @Bean\n     @ConditionalOnProperty(prefix = \"azure.activedirectory.user-group\", value = \"allowed-groups\")\n     public OAuth2UserService<OidcUserRequest, OidcUser> oidcUserService() {\n-        return new AADOAuth2UserService(aadAuthProps, serviceEndpointsProps);\n+        return new AADOAuth2UserService(aadAuthenticationProperties, serviceEndpointsProperties);\n+    }\n+\n+    @Bean\n+    public ClientRegistrationRepository clientRegistrationRepository() {\n+        return new InMemoryClientRegistrationRepository(azureClientRegistration());\n+    }\n+\n+    private ClientRegistration azureClientRegistration() {\n+        String tenantId = aadAuthenticationProperties.getTenantId().trim();\n+        Assert.hasText(tenantId, \"azure.activedirectory.tenant-id should have text.\");\n+        Assert.doesNotContain(tenantId, \" \", \"azure.activedirectory.tenant-id should not contain ' '.\");\n+        Assert.doesNotContain(tenantId, \"/\", \"azure.activedirectory.tenant-id should not contain '/'.\");\n+        return ClientRegistration.withRegistrationId(\"azure\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f3342fd0c012dc37805c5c98932dc3896255da9"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e63300385f4d3c552d94098cec987c793df33207", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e63300385f4d3c552d94098cec987c793df33207", "committedDate": "2020-10-09T02:34:41Z", "message": "1. Fix link error. 2. Use config item azure.activedirectory.xxx instead of spring.security."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b971c654bbe07979f86b6ea9d01f32ecc8d595e", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7b971c654bbe07979f86b6ea9d01f32ecc8d595e", "committedDate": "2020-10-09T02:38:13Z", "message": "Update document about multi tenant."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23863c789e85694ada406bfc3cac083c70702867", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/23863c789e85694ada406bfc3cac083c70702867", "committedDate": "2020-10-09T02:46:18Z", "message": "Update CHANGELOG.md."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee9a67ec20f4e33e1db092ca5606f6b9b3f9aed5", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ee9a67ec20f4e33e1db092ca5606f6b9b3f9aed5", "committedDate": "2020-10-09T06:12:14Z", "message": "Update client-id in README.md."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58b3706d1dd59f80481462020f7874de68958b7c", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/58b3706d1dd59f80481462020f7874de68958b7c", "committedDate": "2020-10-09T06:50:43Z", "message": "Add more log to debug."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6daea34fc7bd037304214cba8d8f4a07ba1f56c", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e6daea34fc7bd037304214cba8d8f4a07ba1f56c", "committedDate": "2020-10-09T07:50:30Z", "message": "Add more log to test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b528cb987b06509ccbad09a50bad73ad3f3b84cf", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b528cb987b06509ccbad09a50bad73ad3f3b84cf", "committedDate": "2020-10-09T08:02:15Z", "message": "Merge branch 'master' into use-tenant-id-instead-of-common-in-oauth-provider-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4f111b4b1a127436d60ea77e85b544ce6f0513d", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e4f111b4b1a127436d60ea77e85b544ce6f0513d", "committedDate": "2020-10-09T09:17:40Z", "message": "Add more log to debug."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b6fb3aa5dac22a07c3a8bb501de88d91e702c85", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0b6fb3aa5dac22a07c3a8bb501de88d91e702c85", "committedDate": "2020-10-10T05:10:55Z", "message": "Add DummpApp."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "909d47fd0357c8e1efda7ea8a44a7c9c5c83c933", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/909d47fd0357c8e1efda7ea8a44a7c9c5c83c933", "committedDate": "2020-10-10T05:52:17Z", "message": "Fix integration test failure caused by this commit:\nhttps://github.com/Azure/azure-sdk-for-java/commit/bc00201c632332421be48e4d40814a0b166885d4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68888e2d5b7b5fb8e08f98e07ad14ba9288762eb", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/68888e2d5b7b5fb8e08f98e07ad14ba9288762eb", "committedDate": "2020-10-10T05:55:34Z", "message": "Fix typo."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e88627bb45f9307b9ba189aeb53aa3670f312da3", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e88627bb45f9307b9ba189aeb53aa3670f312da3", "committedDate": "2020-10-10T06:51:45Z", "message": "Add configure item `azure.activedirectory.scope`, delete configure item like 'spring.security.xxx'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6f2303b87eb0ed12bd1e738843e9b02f62fcca2", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d6f2303b87eb0ed12bd1e738843e9b02f62fcca2", "committedDate": "2020-10-10T07:06:58Z", "message": "Fix the java doc of scope."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fb5c6e821448c0ae80cd0922e3cc8fd2c98ffb3", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6fb5c6e821448c0ae80cd0922e3cc8fd2c98ffb3", "committedDate": "2020-10-10T08:36:13Z", "message": "Fix integration test failure: azure-cosmos does not support reactor-netty:0.9.10 (included by spring-bot2.2.x)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "711ad188d81ec08dd4c0e354a3916f9a48281405", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/711ad188d81ec08dd4c0e354a3916f9a48281405", "committedDate": "2020-10-10T09:47:53Z", "message": "Use another way to fix version problem: move azure-identity to keyvault starter module."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27c71b1e17599b837bc019617bf47106b007749b", "author": {"user": {"login": "chenrujun", "name": "Rujun Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/27c71b1e17599b837bc019617bf47106b007749b", "committedDate": "2020-10-12T00:57:33Z", "message": "Add azure-identity in aad-starter and servicebus-starter."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2Mjk0MjM2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15801#pullrequestreview-506294236", "createdAt": "2020-10-12T05:05:49Z", "commit": {"oid": "27c71b1e17599b837bc019617bf47106b007749b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNTowNTo1MFrOHfvKnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNTowNjo0OVrOHfvLZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA0MDY2OQ==", "bodyText": "The azure-identity is not used by the aad-b2c starter?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15801#discussion_r503040669", "createdAt": "2020-10-12T05:05:50Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory-b2c/pom.xml", "diffHunk": "@@ -36,6 +36,11 @@\n       <artifactId>azure-spring-boot</artifactId>\n       <version>3.0.0-beta.1</version> <!-- {x-version-update;com.azure:azure-spring-boot;current} -->\n     </dependency>\n+    <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c71b1e17599b837bc019617bf47106b007749b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA0MDc2OA==", "bodyText": "The aad starter does not use this azure-identity?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15801#discussion_r503040768", "createdAt": "2020-10-12T05:06:21Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-active-directory/pom.xml", "diffHunk": "@@ -35,6 +35,11 @@\n       <artifactId>azure-spring-boot</artifactId>\n       <version>3.0.0-beta.1</version> <!-- {x-version-update;com.azure:azure-spring-boot;current} -->\n     </dependency>\n+    <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c71b1e17599b837bc019617bf47106b007749b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA0MDg2OA==", "bodyText": "Service bus jms has no dependency on this.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15801#discussion_r503040868", "createdAt": "2020-10-12T05:06:49Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-starter-servicebus-jms/pom.xml", "diffHunk": "@@ -25,6 +25,11 @@\n       <artifactId>azure-spring-boot</artifactId>\n       <version>3.0.0-beta.1</version> <!-- {x-version-update;com.azure:azure-spring-boot;current} -->\n     </dependency>\n+    <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c71b1e17599b837bc019617bf47106b007749b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2Mjk2NTUx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15801#pullrequestreview-506296551", "createdAt": "2020-10-12T05:14:07Z", "commit": {"oid": "27c71b1e17599b837bc019617bf47106b007749b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3082, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}