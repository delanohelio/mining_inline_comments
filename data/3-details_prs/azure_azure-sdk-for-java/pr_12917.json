{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NDI1NjQ1", "number": 12917, "title": "Added script logging enabled API to CosmosStoredProcedureRequestOptions", "bodyText": "Added script logging enabled API to CosmosStoredProcedureRequestOptions\nAdded new tests to check script logging both enabled and disabled.", "createdAt": "2020-07-08T18:57:04Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917", "merged": true, "mergeCommit": {"oid": "2f4f39fd4a79a1b92dac79e5b408b59adb8f4c11"}, "closed": true, "closedAt": "2020-07-08T21:58:41Z", "author": {"login": "kushagraThapar"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy_JIGgH2gAyNDQ2NDI1NjQ1OjcxN2U1NTFhMmEzYmM1M2ZhOTY2Njc3NjVlOTljNzM1ZDIwODYwMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczAZ7AAFqTQ0NTEwMDU2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "717e551a2a3bc53fa96667765e99c735d2086035", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/717e551a2a3bc53fa96667765e99c735d2086035", "committedDate": "2020-07-08T18:56:17Z", "message": "Added script logging enabled API to CosmosStoredProcedureRequestOptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDQ4Njg1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#pullrequestreview-445048685", "createdAt": "2020-07-08T19:01:41Z", "commit": {"oid": "717e551a2a3bc53fa96667765e99c735d2086035"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDQ4OTIw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#pullrequestreview-445048920", "createdAt": "2020-07-08T19:01:59Z", "commit": {"oid": "717e551a2a3bc53fa96667765e99c735d2086035"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDUxNjc5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#pullrequestreview-445051679", "createdAt": "2020-07-08T19:06:02Z", "commit": {"oid": "717e551a2a3bc53fa96667765e99c735d2086035"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxOTowNjowMlrOGu1jKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxOTowNjowMlrOGu1jKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc2NTAzMg==", "bodyText": "Nice.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#discussion_r451765032", "createdAt": "2020-07-08T19:06:02Z", "author": {"login": "kirankumarkolli"}, "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/CosmosSyncStoredProcTest.java", "diffHunk": "@@ -148,19 +150,59 @@ public void deleteStoredProcedure() throws Exception {\n     }\n     @Test(groups = {\"simple\"}, timeOut = TIMEOUT)\n     public void executeStoredProcedure() throws Exception {\n-        CosmosStoredProcedureProperties sproc = new CosmosStoredProcedureProperties(\n+        CosmosStoredProcedureProperties storedProcedure = new CosmosStoredProcedureProperties(\n             UUID.randomUUID().toString(),\n-            \"function() {var x = 10;}\"\n-        );\n-\n-        CosmosStoredProcedureResponse response = container.getScripts().createStoredProcedure(sproc);\n+            \"function() {\" +\n+                \"        var mytext = \\\"x\\\";\" +\n+                \"        var myval = 1;\" +\n+                \"        try {\" +\n+                \"            console.log(\\\"The value of %s is %s.\\\", mytext, myval);\" +\n+                \"            getContext().getResponse().setBody(\\\"Success!\\\");\" +\n+                \"        }\" +\n+                \"        catch(err) {\" +\n+                \"            getContext().getResponse().setBody(\\\"inline err: [\\\" + err.number + \\\"] \\\" + err);\" +\n+                \"        }\" +\n+                \"}\");\n+\n+        container.getScripts().createStoredProcedure(storedProcedure);\n         CosmosStoredProcedureRequestOptions options = new CosmosStoredProcedureRequestOptions();\n         options.setPartitionKey(PartitionKey.NONE);\n         CosmosStoredProcedureResponse executeResponse = container.getScripts()\n-                                                                 .getStoredProcedure(sproc.getId())\n+                                                                 .getStoredProcedure(storedProcedure.getId())\n                                                                  .execute(null, options);\n \n         assertThat(executeResponse.getActivityId()).isNotEmpty();\n+        assertThat(executeResponse.getScriptLog()).isNull();\n+    }\n+\n+    @Test(groups = \"simple\", timeOut = TIMEOUT)\n+    public void executeStoredProcedureWithScriptLoggingEnabled() throws Exception {\n+        // Create a stored procedure\n+        CosmosStoredProcedureProperties storedProcedure = new CosmosStoredProcedureProperties(\n+            UUID.randomUUID().toString(),\n+            \"function() {\" +\n+                \"        var mytext = \\\"x\\\";\" +\n+                \"        var myval = 1;\" +\n+                \"        try {\" +\n+                \"            console.log(\\\"The value of %s is %s.\\\", mytext, myval);\" +\n+                \"            getContext().getResponse().setBody(\\\"Success!\\\");\" +\n+                \"        }\" +\n+                \"        catch(err) {\" +\n+                \"            getContext().getResponse().setBody(\\\"inline err: [\\\" + err.number + \\\"] \\\" + err);\" +\n+                \"        }\" +\n+                \"}\");\n+\n+        container.getScripts().createStoredProcedure(storedProcedure);\n+        CosmosStoredProcedureRequestOptions options = new CosmosStoredProcedureRequestOptions();\n+        options.setScriptLoggingEnabled(true);\n+        options.setPartitionKey(PartitionKey.NONE);\n+\n+        CosmosStoredProcedureResponse executeResponse = container.getScripts()\n+                                                                 .getStoredProcedure(storedProcedure.getId())\n+                                                                 .execute(null, options);\n+\n+        String logResult = \"The value of x is 1.\";\n+        assertThat(URLDecoder.decode(executeResponse.getScriptLog(), StandardCharsets.UTF_8)).isEqualTo(logResult);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "717e551a2a3bc53fa96667765e99c735d2086035"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDUxNzMy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#pullrequestreview-445051732", "createdAt": "2020-07-08T19:06:07Z", "commit": {"oid": "717e551a2a3bc53fa96667765e99c735d2086035"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db467f69bd574ca118f38dc5830d43ffffaf2d64", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/db467f69bd574ca118f38dc5830d43ffffaf2d64", "committedDate": "2020-07-08T19:18:42Z", "message": "Fixed java 8 compilation issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc28a3389c94243758e75f332f155058f5ffe6bd", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bc28a3389c94243758e75f332f155058f5ffe6bd", "committedDate": "2020-07-08T20:06:48Z", "message": "Updated getScriptLog API to decode before returning the response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDk4MTg5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#pullrequestreview-445098189", "createdAt": "2020-07-08T20:17:59Z", "commit": {"oid": "bc28a3389c94243758e75f332f155058f5ffe6bd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDoxNzo1OVrOGu3w0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDoxNzo1OVrOGu3w0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgwMTI5OQ==", "bodyText": "NIT - add comment for default value", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#discussion_r451801299", "createdAt": "2020-07-08T20:17:59Z", "author": {"login": "FabianMeiswinkel"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/models/CosmosStoredProcedureRequestOptions.java", "diffHunk": "@@ -115,13 +116,36 @@ public CosmosStoredProcedureRequestOptions setSessionToken(String sessionToken)\n         return this;\n     }\n \n+    /**\n+     * Gets whether Javascript stored procedure logging is enabled for the current request in the Azure Cosmos DB database\n+     * service or not.\n+     *\n+     * @return true if Javascript stored procedure logging is enabled", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc28a3389c94243758e75f332f155058f5ffe6bd"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDk4OTkx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#pullrequestreview-445098991", "createdAt": "2020-07-08T20:19:20Z", "commit": {"oid": "bc28a3389c94243758e75f332f155058f5ffe6bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1f7260093c3370e8e9062ea585e828992fa4edd", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d1f7260093c3370e8e9062ea585e828992fa4edd", "committedDate": "2020-07-08T20:21:44Z", "message": "Added default value to java docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MTAwNTY4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#pullrequestreview-445100568", "createdAt": "2020-07-08T20:21:48Z", "commit": {"oid": "bc28a3389c94243758e75f332f155058f5ffe6bd"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDoyMjowMFrOGu34sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDoyNDoyMFrOGu39fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgwMzMxMw==", "bodyText": "Can we use StringUtils.isEmpty here ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#discussion_r451803313", "createdAt": "2020-07-08T20:22:00Z", "author": {"login": "simplynaveen20"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/Utils.java", "diffHunk": "@@ -94,6 +100,18 @@ public static String encodeBase64String(byte[] binaryData) {\n         return encodedString;\n     }\n \n+    public static String decodeAsUTF8String(String inputString) {\n+        if (inputString == null || inputString.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc28a3389c94243758e75f332f155058f5ffe6bd"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgwNDU0Mw==", "bodyText": "How about mentioning default value in documentation ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12917#discussion_r451804543", "createdAt": "2020-07-08T20:24:20Z", "author": {"login": "simplynaveen20"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/models/CosmosStoredProcedureRequestOptions.java", "diffHunk": "@@ -115,13 +116,36 @@ public CosmosStoredProcedureRequestOptions setSessionToken(String sessionToken)\n         return this;\n     }\n \n+    /**\n+     * Gets whether Javascript stored procedure logging is enabled for the current request in the Azure Cosmos DB database\n+     * service or not.\n+     *\n+     * @return true if Javascript stored procedure logging is enabled\n+     */\n+    public boolean isScriptLoggingEnabled() {\n+        return scriptLoggingEnabled;\n+    }\n+\n+    /**\n+     * Sets whether Javascript stored procedure logging is enabled for the current request in the Azure Cosmos DB database", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc28a3389c94243758e75f332f155058f5ffe6bd"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2611, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}