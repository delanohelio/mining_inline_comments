{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2Njc2NzY2", "number": 18392, "title": "Dump Heap on OOM and Retain Heap Dump", "bodyText": "This PR adds support for CI pipelines to dump heap on OutOfMemoryError and retain the hprof as a pipeline artifact. Additionally, this introduces a new pattern for configuring maven-surefire-plugin's argLine configuration.", "createdAt": "2020-12-29T23:58:11Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392", "merged": true, "mergeCommit": {"oid": "adea924d165d3a615e29a97b275f64e69e380fac"}, "closed": true, "closedAt": "2021-09-14T19:37:43Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdrDvJ8AH2gAyNTQ2Njc2NzY2OmI5YjE1OWQyZTVlNmU1ZDIxYjhlMGY2OTk3MDRmZjQ5NjMyYzE2NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABe-X6naAFqTc1NDM4OTE5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b9b159d2e5e6e5d21b8e0f699704ff49632c1649", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9b159d2e5e6e5d21b8e0f699704ff49632c1649", "committedDate": "2020-12-29T23:57:12Z", "message": "Attempt to add heap dump on OOM and retain it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d496ca3fcf165b8461e1ed7749f48c690fc93513", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d496ca3fcf165b8461e1ed7749f48c690fc93513", "committedDate": "2020-12-30T00:57:33Z", "message": "Add validation that a heap dump was created before attempting to publish it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d1e0e1bd13dba605ef271d9a19c86bbe39eb102", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3d1e0e1bd13dba605ef271d9a19c86bbe39eb102", "committedDate": "2020-12-30T01:05:13Z", "message": "Fix task condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2798a27e7e1a422d14f77bef2650ca2958a469b2", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2798a27e7e1a422d14f77bef2650ca2958a469b2", "committedDate": "2021-01-08T23:51:05Z", "message": "Merge branch 'master' into AzEng_RetainHeapDumpOnOoM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc128174dff2820c7e0b5cab8abba57a99520b77", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cc128174dff2820c7e0b5cab8abba57a99520b77", "committedDate": "2021-01-09T00:17:50Z", "message": "Prototype passing additional JVM arguments to the Surefire JVM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9eef02f1f6d13a6967ff41a83124fd231576791a", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9eef02f1f6d13a6967ff41a83124fd231576791a", "committedDate": "2021-01-09T00:30:42Z", "message": "Fix property name, add support for command-line settable Xmx value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dbe305eb8df62894b1dfc1fbb00a759ae061ffe", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2dbe305eb8df62894b1dfc1fbb00a759ae061ffe", "committedDate": "2021-01-11T19:31:20Z", "message": "Merge branch 'master' into AzEng_RetainHeapDumpOnOoM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65ee8186548cc748e5da33b646d19b3a8c898e35", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/65ee8186548cc748e5da33b646d19b3a8c898e35", "committedDate": "2021-01-11T20:53:48Z", "message": "Update Surefire version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "489708e445585789b49589b88865659634b1c663", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/489708e445585789b49589b88865659634b1c663", "committedDate": "2021-01-12T19:31:31Z", "message": "Merge branch 'master' into AzEng_RetainHeapDumpOnOoM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fe18c917d223bc1397512ee2a0fbdd1267f3e7c", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9fe18c917d223bc1397512ee2a0fbdd1267f3e7c", "committedDate": "2021-01-12T19:50:59Z", "message": "Update heap dump in pom configuration and yaml checks for it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbdd1330a45c4b5cffe63cd90d0cebf8bc633e78", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fbdd1330a45c4b5cffe63cd90d0cebf8bc633e78", "committedDate": "2021-01-12T21:59:38Z", "message": "Support retaining multiple heap dumps, changed heap dump path to a directory to allow multiple heap dumps to happen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbc950e8a0cb68d005565e705a91336b71a0f4a0", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bbc950e8a0cb68d005565e705a91336b71a0f4a0", "committedDate": "2021-01-12T22:06:47Z", "message": "Fix expression syntax"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8278051f51f5d39fce82d87cf21313a7d12ad91", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f8278051f51f5d39fce82d87cf21313a7d12ad91", "committedDate": "2021-01-12T22:18:14Z", "message": "Test other ways to track heap dump files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19944630ae4730acdcc76e8d93863ea11c341215", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/19944630ae4730acdcc76e8d93863ea11c341215", "committedDate": "2021-01-12T22:34:29Z", "message": "Add logging to troubleshoot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c944800e05b4463834c7fb0f8317c511377f707f", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c944800e05b4463834c7fb0f8317c511377f707f", "committedDate": "2021-01-12T22:59:51Z", "message": "Merge branch 'master' into AzEng_RetainHeapDumpOnOoM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ee5c90df49c98bf7adb708b558da8e16e263376", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ee5c90df49c98bf7adb708b558da8e16e263376", "committedDate": "2021-01-12T23:37:55Z", "message": "Use Maven to generate directory for heap dumps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06a2e90bf63a15cf7f600ed8b1ccd739e0665c73", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/06a2e90bf63a15cf7f600ed8b1ccd739e0665c73", "committedDate": "2021-03-29T17:56:59Z", "message": "Update heap dump path, remove CI attempt to retain heap dump for further investigation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4ac21685c99ff57a29e453cc28dff2aeda006ad", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d4ac21685c99ff57a29e453cc28dff2aeda006ad", "committedDate": "2021-04-05T16:29:43Z", "message": "Merge branch 'master' into AzEng_RetainHeapDumpOnOoM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "792747fd3fd3f94006394b60b29495cf68f0fab7", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/792747fd3fd3f94006394b60b29495cf68f0fab7", "committedDate": "2021-08-09T23:06:07Z", "message": "Merge in main"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7abba402682b458596dbd1ff54aa59f936810c5", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f7abba402682b458596dbd1ff54aa59f936810c5", "committedDate": "2021-08-09T23:48:59Z", "message": "Attempt to publish OOM hprofs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzQ1Njc2MDk5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#pullrequestreview-745676099", "createdAt": "2021-09-03T03:24:15Z", "commit": {"oid": "f7abba402682b458596dbd1ff54aa59f936810c5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzQ1NzM5NDU0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#pullrequestreview-745739454", "createdAt": "2021-09-03T06:16:35Z", "commit": {"oid": "f7abba402682b458596dbd1ff54aa59f936810c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wM1QwNjoxNjozNlrOKdHAFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wM1QwNjoxNjozNlrOKdHAFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTYxMjA1Mw==", "bodyText": "This seems wrong. Artifacts is the list of things built that should be published, not a list of destinations to publish to.\nIf the goal is to publish the .hprof as a pipeline artifact, retained in Azure DevOps, you should replace inputs with something like:\n  condition: eq(variables.FILEEXISTS, 'true')\n  inputs:\n    targetPath: $(Pipeline.Workspace)/sdk/${{ parameters.ServiceDirectory }}/${{ artifact.name }}/target/oom.hprof\n    artifactType: pipeline   #this line isn't necessary as pipeline is the default\n    artifactName: '${{ artifact.name }}.oom.hprof'\nwhere FILEEXISTS is set to true if the .hprof exists:\n- pwsh: Write-Output \"##vso[task.setVariable variable=FILEEXISTS]$((Test-Path $pathToHprof) ? \"true\" : \"false\")\"    \nIf the oom.hprof is a memory dump and we have reason to believe it may contain sensitive information, e.g. credentials, we should consider more secure destinations for the files, like blob storage.\nfilepath base artifact publishing appears to be targeting DevOps users with private, network connected agents with fileshare access, i.e.   \\\\someserver\\share\\", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r701612053", "createdAt": "2021-09-03T06:16:36Z", "author": {"login": "hallipr"}, "path": "eng/pipelines/templates/jobs/ci.tests.yml", "diffHunk": "@@ -163,6 +163,13 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - ${{ each artifact in parameters.Artifacts }}:\n+        - task: PublishPipelineArtifact@1\n+          inputs:\n+            targetPath: '$(Pipeline.Workspace)/sdk/${{ parameters.ServiceDirectory }}/${{ artifact.name }}/target/oom.hprof'\n+            artifactType: 'filepath'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7abba402682b458596dbd1ff54aa59f936810c5"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "382eb6ad5e05f5b3214b0dabbca6433cbfebc148", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/382eb6ad5e05f5b3214b0dabbca6433cbfebc148", "committedDate": "2021-09-13T17:08:07Z", "message": "Merge branch 'main' into AzEng_RetainHeapDumpOnOoM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5789adef92503d449b99719e30800ca1fb6c8754", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5789adef92503d449b99719e30800ca1fb6c8754", "committedDate": "2021-09-13T17:57:52Z", "message": "Change configuration structure to be centralized in parent POM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7677aafdd27fbd7af1267fc392f9524c418ffac4", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7677aafdd27fbd7af1267fc392f9524c418ffac4", "committedDate": "2021-09-13T19:05:59Z", "message": "Update all Core libraries to use new pattern, changed how OOM hprof is copied"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73587312cc96b5f0d24974b7af488106fd6a61f7", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/73587312cc96b5f0d24974b7af488106fd6a61f7", "committedDate": "2021-09-13T19:51:55Z", "message": "Fix missing '-' in command name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5734a26a188a77cf7bc180581e5b1a6b7ee6d62d", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5734a26a188a77cf7bc180581e5b1a6b7ee6d62d", "committedDate": "2021-09-13T21:10:01Z", "message": "Add logging of file copying"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00aedb62a3877059899e9469b2d52ef46bba87e8", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/00aedb62a3877059899e9469b2d52ef46bba87e8", "committedDate": "2021-09-13T21:11:14Z", "message": "Change file copying logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55f08792690d7bb607ed3c0f35676ab307f46f06", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/55f08792690d7bb607ed3c0f35676ab307f46f06", "committedDate": "2021-09-13T21:30:33Z", "message": "Publish retain hrpofs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0260a40c702fb9aeabc6d41d3ef13077ed7907d6", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0260a40c702fb9aeabc6d41d3ef13077ed7907d6", "committedDate": "2021-09-13T21:51:01Z", "message": "Zip hprofs before publishing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "275075e373b26a6427112b7b749c1a96f1d0798d", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/275075e373b26a6427112b7b749c1a96f1d0798d", "committedDate": "2021-09-13T22:10:54Z", "message": "Merge branch 'main' into AzEng_RetainHeapDumpOnOoM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f5cc8264755ec4796583df8bfd7b1b56617788a", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6f5cc8264755ec4796583df8bfd7b1b56617788a", "committedDate": "2021-09-13T22:35:46Z", "message": "Turn retention into a standalone step for re-use"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5d4eaafe7ae06c5f89ffc35101971584824b9964", "committedDate": "2021-09-13T22:47:18Z", "message": "Remove OOM tests as changes have been validated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzUzMzIzODg0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#pullrequestreview-753323884", "createdAt": "2021-09-13T22:55:29Z", "commit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xM1QyMjo1NToyOVrOKi_HsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xM1QyMjo1NToyOVrOKi_HsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NDM4NQ==", "bodyText": "How large are these files? Should we move them instead of copy?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707774385", "createdAt": "2021-09-13T22:55:29Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Copy-Item $fileFullName $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzUzMzI0MzI3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#pullrequestreview-753324327", "createdAt": "2021-09-13T22:56:27Z", "commit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xM1QyMjo1NjoyOFrOKi_JXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xM1QyMjo1NjoyOFrOKi_JXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzc3NDgxNA==", "bodyText": "In general creating a zip file make uploading less efficient as Devops already does compression on the server side and can optimize the chunks of these files better across all files uploaded instead of us.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707774814", "createdAt": "2021-09-13T22:56:28Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Copy-Item $fileFullName $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOACyxNM4s50Gi", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#pullrequestreview-753353122", "createdAt": "2021-09-14T00:01:15Z", "commit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQwMDowMToxNVrOKjA0qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQwMDowMjo0MVrOKjA5iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qMDSo", "bodyText": "We should standardize using 11 and above for these profiles to be consistent with all modules.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707802280", "createdAt": "2021-09-14T00:01:15Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-tracing-opentelemetry/pom.xml", "diffHunk": "@@ -126,20 +126,11 @@\n       <activation>\n         <jdk>[9,)</jdk>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 2}, {"id": "PRRC_kwDOACyxNM4qMDmJ", "bodyText": "Since this is not used anywhere, we can add this when required.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r707803529", "createdAt": "2021-09-14T00:02:41Z", "author": {"login": "srnagar"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -107,7 +106,35 @@\n     <jacoco.min.linecoverage>0.40</jacoco.min.linecoverage>\n     <jacoco.min.branchcoverage>0.30</jacoco.min.branchcoverage>\n     <jacoco.skip.coverage.check>false</jacoco.skip.coverage.check>\n+\n+    <!-- This property determines the relative path from a pom.xml to the eng/ folder. -->\n     <relative.path.to.eng.folder>../../..</relative.path.to.eng.folder>\n+\n+    <!-- This property determines the max heap size of the Surefire JVM. By default 3GB, or 3096MB, is used. -->\n+    <surefireXmx>3096m</surefireXmx>\n+\n+    <!-- This property configures the max heap size of the Surefire JVM. -->\n+    <surefireJvmXmx>-Xmx${surefireXmx}</surefireJvmXmx>\n+\n+    <!-- This property configures creating a heap dump if the Surefire JVM fails with an OutOfMemoryError. -->\n+    <heapDumpOnOom>\n+      -XX:+HeapDumpOnOutOfMemoryError\n+      -XX:HeapDumpPath=${packageOutputDirectory}${file.separator}${project.artifactId}-oom.hprof\n+    </heapDumpOnOom>\n+\n+    <!-- Reserved for general Surefire JVM arguments that affect all SDKs. -->\n+    <defaultSurefireArgLine>\n+      ${surefireJvmXmx}\n+      ${heapDumpOnOom}\n+    </defaultSurefireArgLine>\n+\n+    <!-- Reserved for SDK specific JVM arguments to export, open, or read modules in testing. -->\n+    <javaModulesSurefireArgLine>\n+    </javaModulesSurefireArgLine>\n+\n+    <!-- Reserved for either general or SDK specific JVM arguments that are optional. -->\n+    <additionalSurefireArgLine>\n+    </additionalSurefireArgLine>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d4eaafe7ae06c5f89ffc35101971584824b9964"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "749b4aa03280f9accbb0e810cc825e8d2c747ffc", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/749b4aa03280f9accbb0e810cc825e8d2c747ffc", "committedDate": "2021-09-14T01:34:36Z", "message": "Change Copy-Item to Move-Item"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6850e358d2fcfdc549484345e8a1cd0669f65388", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6850e358d2fcfdc549484345e8a1cd0669f65388", "committedDate": "2021-09-14T01:37:15Z", "message": "Fix merge conflict with upstream"}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOACyxNM4s9AYG", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#pullrequestreview-754189830", "createdAt": "2021-09-14T16:40:14Z", "commit": {"oid": "6850e358d2fcfdc549484345e8a1cd0669f65388"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNjo0MDoxNFrOKjoaXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNjo0MDoxNFrOKjoaXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qOhpd", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                condition: always()\n          \n          \n            \n                condition: succeededOrFailed()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708450909", "createdAt": "2021-09-14T16:40:14Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Move-Item -Path $fileFullName -Destination $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")\n+    displayName: 'Copy OOM hprofs'\n+    condition: always()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6850e358d2fcfdc549484345e8a1cd0669f65388"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOACyxNM4s9C0u", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#pullrequestreview-754199854", "createdAt": "2021-09-14T16:50:04Z", "commit": {"oid": "6850e358d2fcfdc549484345e8a1cd0669f65388"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNjo1MDowNVrOKjo4ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNjo1MDowNVrOKjo4ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qOjie", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                condition: always()\n          \n          \n            \n                condition: succeededOrFailed()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708458654", "createdAt": "2021-09-14T16:50:05Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName\n+        $fileName = $hprofFile.Name\n+        Move-Item -Path $fileFullName -Destination $(Build.ArtifactStagingDirectory)/oom-hprofs/$fileName -ErrorAction SilentlyContinue\n+      }\n+      [System.IO.Compression.ZipFile]::CreateFromDirectory(\"$(Build.ArtifactStagingDirectory)/oom-hprofs\",\"$(Build.ArtifactStagingDirectory)/oom-hprofs.zip\")\n+    displayName: 'Copy OOM hprofs'\n+    condition: always()\n+\n+  - publish: $(Build.ArtifactStagingDirectory)/oom-hprofs.zip\n+    displayName: 'Publish OOM hprofs'\n+    artifact: oom-hprofs-$(System.StageName)-$(System.JobName)-$(System.JobAttempt)\n+    condition: always()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6850e358d2fcfdc549484345e8a1cd0669f65388"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "415f3f70be8a0a961108209db195a01f13df8893", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/415f3f70be8a0a961108209db195a01f13df8893", "committedDate": "2021-09-14T16:58:01Z", "message": "Merge branch 'main' into AzEng_RetainHeapDumpOnOoM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44689fbb9d09a2ce47d5eec3d14a932081122fd5", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/44689fbb9d09a2ce47d5eec3d14a932081122fd5", "committedDate": "2021-09-14T16:59:24Z", "message": "Tweak to when the task runs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "036002bb2b81a394b1af1205ba1120d908fc07cb", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/036002bb2b81a394b1af1205ba1120d908fc07cb", "committedDate": "2021-09-14T17:29:21Z", "message": "Match heap OOM retention with test publishing"}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOACyxNM4s9M9M", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#pullrequestreview-754241356", "createdAt": "2021-09-14T17:34:02Z", "commit": {"oid": "036002bb2b81a394b1af1205ba1120d908fc07cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNzozNDowM1rOKjqyDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQxNzozNDowM1rOKjqyDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qOrIM", "bodyText": "looks like this full name isn't used.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708489740", "createdAt": "2021-09-14T17:34:03Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/retain-heap-dump-hprofs.yml", "diffHunk": "@@ -0,0 +1,17 @@\n+steps:\n+  - pwsh: |\n+      New-Item $(Build.ArtifactStagingDirectory)/oom-hprofs -ItemType directory\n+      foreach($hprofFile in (Get-ChildItem -Path . -Recurse -Filter *.hprof -File))\n+      {\n+        $fileFullName = $hprofFile.FullName", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "036002bb2b81a394b1af1205ba1120d908fc07cb"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOACyxNM4s9xDH", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#pullrequestreview-754389191", "createdAt": "2021-09-14T20:23:01Z", "commit": {"oid": "44689fbb9d09a2ce47d5eec3d14a932081122fd5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQyMDoyMzowMVrOKjxzNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNFQyMDoyMzowMVrOKjxzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOACyxNM4qPHM3", "bodyText": "can this collide with \n  \n    \n      azure-sdk-for-java/sdk/storage/azure-storage-blob/pom.xml\n    \n    \n        Lines 236 to 238\n      in\n      da6337e\n    \n    \n    \n    \n\n        \n          \n           <argLine> \n        \n\n        \n          \n             -Xmx6g \n        \n\n        \n          \n           </argLine> \n        \n    \n  \n\n\n?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18392#discussion_r708604727", "createdAt": "2021-09-14T20:23:01Z", "author": {"login": "kasobol-msft"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -107,7 +106,35 @@\n     <jacoco.min.linecoverage>0.40</jacoco.min.linecoverage>\n     <jacoco.min.branchcoverage>0.30</jacoco.min.branchcoverage>\n     <jacoco.skip.coverage.check>false</jacoco.skip.coverage.check>\n+\n+    <!-- This property determines the relative path from a pom.xml to the eng/ folder. -->\n     <relative.path.to.eng.folder>../../..</relative.path.to.eng.folder>\n+\n+    <!-- This property determines the max heap size of the Surefire JVM. By default 3GB, or 3096MB, is used. -->\n+    <surefireXmx>3096m</surefireXmx>\n+\n+    <!-- This property configures the max heap size of the Surefire JVM. -->\n+    <surefireJvmXmx>-Xmx${surefireXmx}</surefireJvmXmx>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44689fbb9d09a2ce47d5eec3d14a932081122fd5"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4219, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}