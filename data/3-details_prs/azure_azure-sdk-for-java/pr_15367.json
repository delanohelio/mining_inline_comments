{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NDkwMjQ0", "number": 15367, "title": "Remove all String variations API references in the code.", "bodyText": "", "createdAt": "2020-09-18T19:03:01Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15367", "merged": true, "mergeCommit": {"oid": "c0279ce761e37ff29bf902d504710de9aa5991f3"}, "closed": true, "closedAt": "2020-09-18T20:23:42Z", "author": {"login": "azabbasi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKKY4FAH2gAyNDg5NDkwMjQ0OjM1YmRmNzU1MzA4MDA1NTQzNmRmYjc5OTA5MGQ4Njk3OGViNzQwMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKLX1YAH2gAyNDg5NDkwMjQ0OjI4MDBiMzRlM2NhNWQ4MzIyMzc1MDhmMTQwOGViZTUzMjU4NjQ2ZjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "35bdf7553080055436dfb799090d86978eb74022", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/35bdf7553080055436dfb799090d86978eb74022", "committedDate": "2020-09-18T19:02:42Z", "message": "Remove all String variations API references in the code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6d1efdcaeb1f926c43e0c3d3abe4d12c8cd4fdb", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e6d1efdcaeb1f926c43e0c3d3abe4d12c8cd4fdb", "committedDate": "2020-09-18T19:05:38Z", "message": "rename castValue to castObject"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzMxOTUy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15367#pullrequestreview-491731952", "createdAt": "2020-09-18T19:34:24Z", "commit": {"oid": "e6d1efdcaeb1f926c43e0c3d3abe4d12c8cd4fdb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTozNDoyNFrOHUZi8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTozNDoyNFrOHUZi8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1MjExMg==", "bodyText": "nit: maybe say that the exception occurred while deserializing the response -> since technically the twin might have been created successfully, but the CL deserialization failed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15367#discussion_r491152112", "createdAt": "2020-09-18T19:34:24Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -157,10 +158,17 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .map(response -> {\n-                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+            .flatMap(response -> {\n+                T genericResponse = null;\n+                try {\n+                    genericResponse = DeserializationHelpers.castObject(mapper, response.getValue(), clazz);\n+                } catch (JsonProcessingException e) {\n+                    logger.error(\"JsonProcessingException occurred while creating digital twin: \", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6d1efdcaeb1f926c43e0c3d3abe4d12c8cd4fdb"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzMyNjgw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15367#pullrequestreview-491732680", "createdAt": "2020-09-18T19:35:44Z", "commit": {"oid": "e6d1efdcaeb1f926c43e0c3d3abe4d12c8cd4fdb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTozNTo0NFrOHUZlJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTozNTo0NFrOHUZlJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1MjY3OQ==", "bodyText": "here as elsewhere as well - the exception is during the deserialization, so maybe we should highlight that (it didn't occur during the REST operation).", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15367#discussion_r491152679", "createdAt": "2020-09-18T19:35:44Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -685,15 +711,22 @@ public DigitalTwinsServiceVersion getServiceVersion() {\n             .map(\n                 objectPagedResponse -> {\n                     List<T> list = objectPagedResponse.getValue().stream()\n-                        .map(object -> mapper.convertValue(object, clazz))\n+                        .map(object -> {\n+                            try {\n+                                return DeserializationHelpers.castObject(mapper, object, clazz);\n+                            } catch (JsonProcessingException e) {\n+                                logger.error(\"JsonProcessingException occurred while retrieving relationships: \", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6d1efdcaeb1f926c43e0c3d3abe4d12c8cd4fdb"}, "originalPosition": 118}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzM0NzA2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15367#pullrequestreview-491734706", "createdAt": "2020-09-18T19:39:32Z", "commit": {"oid": "e6d1efdcaeb1f926c43e0c3d3abe4d12c8cd4fdb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTozOTozM1rOHUZrRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTozOTozM1rOHUZrRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1NDI0NQ==", "bodyText": "nit: maybe say \"...perform the conversion.\", or \"...perform the deserialization.\". The term \"casting\" here might be misleading.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15367#discussion_r491154245", "createdAt": "2020-09-18T19:39:33Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/implementation/serializer/DeserializationHelpers.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.azure.digitaltwins.core.implementation.serializer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+public class DeserializationHelpers {\n+\n+    /**\n+     * Converts the payload object into a generic type.\n+     * There are two different paths we will have to take based on the type T\n+     * In case of a String, we need to write the value of the payload as a String\n+     * In case of any other type that the user decides to deserialize the payload, we will use mapper.convertValue to perform the casting.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6d1efdcaeb1f926c43e0c3d3abe4d12c8cd4fdb"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzM1MTky", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15367#pullrequestreview-491735192", "createdAt": "2020-09-18T19:40:28Z", "commit": {"oid": "e6d1efdcaeb1f926c43e0c3d3abe4d12c8cd4fdb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2800b34e3ca5d832237508f1408ebe53258646f6", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2800b34e3ca5d832237508f1408ebe53258646f6", "committedDate": "2020-09-18T20:11:28Z", "message": "Address comments."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3407, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}