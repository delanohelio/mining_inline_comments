{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1ODg2NzAz", "number": 12290, "title": "CI pipeline support for ctl image build ", "bodyText": "This will help in creating Azure DevOps pipeline for building docker image from the benchmark tool and upload it into Azure container registry.\nNote : Scope of this PR is exclusively making CI for current ctl docker image", "createdAt": "2020-06-17T14:23:03Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290", "merged": true, "mergeCommit": {"oid": "2d78201ad7481f53ef830070c956a5c6e7037803"}, "closed": true, "closedAt": "2020-06-19T00:46:08Z", "author": {"login": "simplynaveen20"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrjKU9gH2gAyNDM1ODg2NzAzOjUyNDU2MzAyYmNmODE0NzIzYmMyMjI0ZjAyMGI5NGFiZmFjNzAyMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcslhqEAH2gAyNDM1ODg2NzAzOjU1NDA5MmNiNmU2NTc0YTY0NjRmMDA3YjBlZTQ1YWI4ZDhhYmMxOWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52456302bcf814723bc2224f020b94abfac70200", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/52456302bcf814723bc2224f020b94abfac70200", "committedDate": "2020-06-15T16:22:47Z", "message": "Adding docker build image configuration for ctl run"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d7c270b35bf5fbba237e7359c5b755cfe658dfc", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9d7c270b35bf5fbba237e7359c5b755cfe658dfc", "committedDate": "2020-06-15T17:41:23Z", "message": "moving jar to ctl folder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef556519bc653958f8bc487cadf2d8e0ef88d1e7", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ef556519bc653958f8bc487cadf2d8e0ef88d1e7", "committedDate": "2020-06-15T18:49:00Z", "message": "changing config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c71695ef042519f68074b00e8d03d37b90d39b87", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c71695ef042519f68074b00e8d03d37b90d39b87", "committedDate": "2020-06-15T18:57:44Z", "message": "changing config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d4b84e7b2527c8adce15d3a9b64521465b99448", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9d4b84e7b2527c8adce15d3a9b64521465b99448", "committedDate": "2020-06-15T20:53:19Z", "message": "changing config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "951ac8f60a53389bb6718a1c88d621505cd5fefc", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/951ac8f60a53389bb6718a1c88d621505cd5fefc", "committedDate": "2020-06-15T21:00:45Z", "message": "changing config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56332fa11e71b82b1364f6b83e5ae2f906d6eab6", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/56332fa11e71b82b1364f6b83e5ae2f906d6eab6", "committedDate": "2020-06-16T21:30:25Z", "message": "testing for trigger and ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "490b067f177d7e178ac2e5b84271077485640d55", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/490b067f177d7e178ac2e5b84271077485640d55", "committedDate": "2020-06-16T21:37:50Z", "message": "testing for trigger and ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e850cf88c237707dd3765b01ce3cd0b4cf900742", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e850cf88c237707dd3765b01ce3cd0b4cf900742", "committedDate": "2020-06-16T21:42:25Z", "message": "testing for trigger and ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a6524d5acc35282e77bd6d359e097ea85c877a8", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4a6524d5acc35282e77bd6d359e097ea85c877a8", "committedDate": "2020-06-17T14:10:56Z", "message": "formating change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccbb5dec09839538480c649a9354b8f1ec4e52b8", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ccbb5dec09839538480c649a9354b8f1ec4e52b8", "committedDate": "2020-06-17T14:19:46Z", "message": "formating change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDk5ODM4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#pullrequestreview-432499838", "createdAt": "2020-06-17T15:06:47Z", "commit": {"oid": "ccbb5dec09839538480c649a9354b8f1ec4e52b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNTowNjo0OFrOGlKRNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNTowNjo0OFrOGlKRNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYxODc0Mw==", "bodyText": "Docket image nees to be build from benchamrk target folder right?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#discussion_r441618743", "createdAt": "2020-06-17T15:06:48Z", "author": {"login": "kirankumarkolli"}, "path": "sdk/cosmos/azure-cosmos-benchmark/ctl/Dockerfile", "diffHunk": "@@ -0,0 +1,7 @@\n+FROM ubuntu:18.04\n+RUN apt-get update && apt-get install -y openjdk-8-jdk net-tools vim\n+COPY ./run_benchmark.sh /usr/app/\n+COPY ./azure-cosmos-benchmark-jar-with-dependencies.jar /usr/app/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccbb5dec09839538480c649a9354b8f1ec4e52b8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTAxMjAx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#pullrequestreview-432501201", "createdAt": "2020-06-17T15:08:03Z", "commit": {"oid": "ccbb5dec09839538480c649a9354b8f1ec4e52b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNTowODowM1rOGlKVUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNTowODowM1rOGlKVUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYxOTc5NA==", "bodyText": "Can the docker publishing and consuming latest also be automated?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#discussion_r441619794", "createdAt": "2020-06-17T15:08:03Z", "author": {"login": "kirankumarkolli"}, "path": "sdk/cosmos/azure-cosmos-benchmark/ctl/Dockerfile", "diffHunk": "@@ -0,0 +1,7 @@\n+FROM ubuntu:18.04", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccbb5dec09839538480c649a9354b8f1ec4e52b8"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTY1ODU0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#pullrequestreview-432565854", "createdAt": "2020-06-17T16:21:41Z", "commit": {"oid": "ccbb5dec09839538480c649a9354b8f1ec4e52b8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjoyMTo0MVrOGlNXHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjoyMTo0MVrOGlNXHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2OTQwNw==", "bodyText": "Didn't we have an existing jar-with-dependencies plugin already ?\nWhy can't we use the existing one instead of creating another one here ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#discussion_r441669407", "createdAt": "2020-06-17T16:21:41Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos-benchmark/pom.xml", "diffHunk": "@@ -477,6 +477,25 @@ Licensed under the MIT License.\n                   </archive>\n                 </configuration>\n               </execution>\n+              <execution>\n+                <id>make-assembly-ctl</id>\n+                <phase>package</phase>\n+                <goals>\n+                  <goal>single</goal>\n+                </goals>\n+                <configuration>\n+                  <descriptorRefs>\n+                    <descriptorRef>jar-with-dependencies</descriptorRef>\n+                  </descriptorRefs>\n+                  <outputDirectory>${project.build.directory}/ctl</outputDirectory>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccbb5dec09839538480c649a9354b8f1ec4e52b8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjE0ODQ0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#pullrequestreview-432614844", "createdAt": "2020-06-17T17:21:53Z", "commit": {"oid": "ccbb5dec09839538480c649a9354b8f1ec4e52b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzoyMTo1M1rOGlPk9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzoyMTo1M1rOGlPk9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcwNTcxNg==", "bodyText": "please follow bash code style for naming variables\nhttps://google.github.io/styleguide/shellguide.html#s7-naming-conventions", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#discussion_r441705716", "createdAt": "2020-06-17T17:21:53Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/ctl/run_benchmark.sh", "diffHunk": "@@ -0,0 +1,74 @@\n+#!/bin/bash\n+\n+serviceEndpoint=$Endpoint", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccbb5dec09839538480c649a9354b8f1ec4e52b8"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "597cb2e03e15b494204919af94a2dd41419820fc", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/597cb2e03e15b494204919af94a2dd41419820fc", "committedDate": "2020-06-17T21:02:38Z", "message": "using sheel script naming convention for variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50c9d892bb84f622c0754770d951624157288527", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/50c9d892bb84f622c0754770d951624157288527", "committedDate": "2020-06-17T21:20:02Z", "message": "formatting names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTU3NzEx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#pullrequestreview-433557711", "createdAt": "2020-06-18T18:50:44Z", "commit": {"oid": "50c9d892bb84f622c0754770d951624157288527"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODo1MDo0NFrOGl7_8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxOTowMDo0MVrOGl8Vtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzMzUyMQ==", "bodyText": "any reason we are going with 2gb? the perf test I do are based on 8gb.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#discussion_r442433521", "createdAt": "2020-06-18T18:50:44Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/ctl/run_benchmark.sh", "diffHunk": "@@ -0,0 +1,74 @@\n+#!/bin/bash\n+\n+service_endpoint=$ctl_endpoint\n+master_key=$ctl_key\n+\n+if [ -z \"$ctl_operation\" ]\n+then\n+operation=ReadLatency\n+else\n+operation=$ctl_operation\n+fi\n+\n+if [ -z \"$ctl_concurrency\" ]\n+then\n+concurrency=50\n+else\n+concurrency=$ctl_concurrency\n+fi\n+\n+if [ -z \"$ctl_consistency_level\" ]\n+then\n+consistency_level=Eventual\n+else\n+consistency_level=$ctl_consistency_level\n+fi\n+\n+if [ -z \"$ctl_number_of_operations\" ]\n+then\n+number_of_operations=-1\n+else\n+number_of_operations=$ctl_number_of_operations\n+fi\n+\n+if [ -z \"$ctl_max_running_time_duration\" ]\n+then\n+max_running_time_duration=PT10H\n+else\n+max_running_time_duration=$ctl_max_running_time_duration\n+fi\n+\n+connection_mode=Direct\n+number_of_precreated_documents=1000\n+gateway_connection_poolsize=5\n+\n+protocol=Tcp\n+\n+col_name=\"testCol\"\n+db_name=\"testdb\"\n+\n+log_filename=\"/tmp/javactl.log\"\n+\n+echo \"log file name is $log_filename\"\n+\n+echo \"serviceEndpoint $service_endpoint, colNmae $col_name operation: $operation, consistencyLevel: $consistency_level, connectionMode: $connection_mode, protocol: $protocol, concurrency: $concurrency\" > $log_filename\n+start=`test \"x$1\" == x && date +%s`\n+jar_file=./azure-cosmos-benchmark-jar-with-dependencies.jar\n+\n+jvm_opt=\"\"\n+#jvm_opt='-Dazure.cosmos.rntbd.threadcount=16 -Dazure.cosmos.directTcp.defaultOptions={\"maxRequestsPerChannel\":10}'\n+additional_benchmark_options=\"\" \n+additional_benchmark_options=\"-documentDataFieldSize 10 -documentDataFieldCount 10\" \n+additional_benchmark_options=\"$additional_benchmark_options -maxConnectionPoolSize $gateway_connection_poolsize\"\n+\n+if [ -z \"$ctl_graphite_endpoint\" ]\n+then\n+java -Xmx2g -Xms2g  $jvm_opt -Dcosmos.directModeProtocol=$protocol -Dazure.cosmos.directModeProtocol=$protocol -jar \"$jar_file\" -serviceEndpoint \"$service_endpoint\" -masterKey \"$master_key\" -databaseId \"$db_name\"  -collectionId \"$col_name\" -consistencyLevel $consistency_level -concurrency $concurrency -numberOfOperations $number_of_operations -operation $operation -connectionMode $connection_mode -maxRunningTimeDuration $max_running_time_duration -numberOfPreCreatedDocuments $number_of_precreated_documents $additional_benchmark_options 2>&1 | tee -a \"$log_filename\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50c9d892bb84f622c0754770d951624157288527"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNDIwNg==", "bodyText": "any reason we are removing the log messages?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#discussion_r442434206", "createdAt": "2020-06-18T18:52:02Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/src/main/java/com/azure/cosmos/benchmark/AsyncBenchmark.java", "diffHunk": "@@ -84,9 +84,7 @@\n \n         try {\n             cosmosAsyncDatabase = cosmosClient.getDatabase(this.configuration.getDatabaseId());\n-            cosmosAsyncDatabase.read().doOnError(error ->\n-                logger.error(\"Database {} creation failed due to \", this.configuration.getDatabaseId(), error)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50c9d892bb84f622c0754770d951624157288527"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzOTA5NQ==", "bodyText": "general idea on setting number_of_precreated_documents is that we should ensure on each BE partition at least there is a few document to read from (this would be a factor of Collection Throughput, partition splitting etc).\nprobably 1000 is good enough but to be safe can we set this to something higher (10,000) maybe?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#discussion_r442439095", "createdAt": "2020-06-18T19:00:41Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/ctl/run_benchmark.sh", "diffHunk": "@@ -0,0 +1,74 @@\n+#!/bin/bash\n+\n+service_endpoint=$ctl_endpoint\n+master_key=$ctl_key\n+\n+if [ -z \"$ctl_operation\" ]\n+then\n+operation=ReadLatency\n+else\n+operation=$ctl_operation\n+fi\n+\n+if [ -z \"$ctl_concurrency\" ]\n+then\n+concurrency=50\n+else\n+concurrency=$ctl_concurrency\n+fi\n+\n+if [ -z \"$ctl_consistency_level\" ]\n+then\n+consistency_level=Eventual\n+else\n+consistency_level=$ctl_consistency_level\n+fi\n+\n+if [ -z \"$ctl_number_of_operations\" ]\n+then\n+number_of_operations=-1\n+else\n+number_of_operations=$ctl_number_of_operations\n+fi\n+\n+if [ -z \"$ctl_max_running_time_duration\" ]\n+then\n+max_running_time_duration=PT10H\n+else\n+max_running_time_duration=$ctl_max_running_time_duration\n+fi\n+\n+connection_mode=Direct\n+number_of_precreated_documents=1000", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50c9d892bb84f622c0754770d951624157288527"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTcxNzg2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#pullrequestreview-433571786", "createdAt": "2020-06-18T19:11:07Z", "commit": {"oid": "50c9d892bb84f622c0754770d951624157288527"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNjYwMDI0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12290#pullrequestreview-433660024", "createdAt": "2020-06-18T21:27:58Z", "commit": {"oid": "50c9d892bb84f622c0754770d951624157288527"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "554092cb6e6574a6464f007b0ee45ab8d8abc19f", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/554092cb6e6574a6464f007b0ee45ab8d8abc19f", "committedDate": "2020-06-18T21:42:00Z", "message": "resolving comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3069, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}