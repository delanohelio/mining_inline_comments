{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNzIzMDUx", "number": 10220, "title": "Fixing aggregate reports", "bodyText": "This PR aims to fix the aggregate reporting pipeline that broke after the POM restructuring. I think that after Alan fixed the pathing issues some of the other issues that I was having with this fell into place.\nI'm not quite done yet, as I need to verify that the pipeline is picking up all the right things and there might be some configuration that I put back in now that I understand better how things are hanging together.", "createdAt": "2020-04-15T12:14:29Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220", "merged": true, "mergeCommit": {"oid": "e7cffb8428c162a4b4e126a80fd6962e8ffec814"}, "closed": true, "closedAt": "2020-04-22T05:26:08Z", "author": {"login": "mitchdenny"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX7qy6gFqTM5Mzk4ODY5MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaAplWAH2gAyNDAzNzIzMDUxOmFhYzMyMzEzZDU4NjVlMmEzZWIwYTk0MTVmMWJjM2QwNzM0ZWIyNTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTg4Njkw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#pullrequestreview-393988690", "createdAt": "2020-04-15T17:33:00Z", "commit": {"oid": "e9ec62c14e29d23fe9a2baa588ceda2a45e41856"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzozMzowMVrOGGESxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzozNzoxN1rOGGEc3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAxNDk4Mw==", "bodyText": "We want to keep these exclusions.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#discussion_r409014983", "createdAt": "2020-04-15T17:33:01Z", "author": {"login": "srnagar"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -316,73 +316,31 @@\n         </executions>\n       </plugin>\n \n-      <!-- Performs test coverage analysis -->\n       <plugin>\n         <groupId>org.jacoco</groupId>\n         <artifactId>jacoco-maven-plugin</artifactId>\n         <version>0.8.5</version> <!-- {x-version-update;org.jacoco:jacoco-maven-plugin;external_dependency} -->\n         <executions>\n           <execution>\n-            <id>default-instrument</id>\n+            <id>prepare-agent</id>\n             <goals>\n-              <goal>instrument</goal>\n+              <goal>prepare-agent</goal>\n             </goals>\n           </execution>\n           <execution>\n-            <id>default-restore-instrumented-classes</id>\n+            <id>default-instrument</id>\n             <goals>\n-              <goal>restore-instrumented-classes</goal>\n+              <goal>instrument</goal>\n             </goals>\n           </execution>\n           <execution>\n-            <!-- This generates the unit test reports for individual modules.\n-              jacoco-test-coverage generates aggregate reports for all modules -->\n-            <id>post-unit-test</id>\n-            <goals>\n-              <goal>report</goal>\n-            </goals>\n-            <configuration>\n-              <!-- Sets the output directory for the code coverage report. -->\n-              <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>\n-              <excludes>\n-                <exclude>**/com/azure/cosmos/implementation/apachecommons/**/*</exclude>\n-                <exclude>**/com/azure/cosmos/implementation/guava25/**/*</exclude>\n-                <exclude>**/com/azure/cosmos/implementation/guava27/**/*</exclude>\n-              </excludes>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9ec62c14e29d23fe9a2baa588ceda2a45e41856"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAxNTUwNA==", "bodyText": "This is required to ensure we don't fall below coverage threshold. The PR should fail if the coverage is below this threshold.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#discussion_r409015504", "createdAt": "2020-04-15T17:33:53Z", "author": {"login": "srnagar"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -316,73 +316,31 @@\n         </executions>\n       </plugin>\n \n-      <!-- Performs test coverage analysis -->\n       <plugin>\n         <groupId>org.jacoco</groupId>\n         <artifactId>jacoco-maven-plugin</artifactId>\n         <version>0.8.5</version> <!-- {x-version-update;org.jacoco:jacoco-maven-plugin;external_dependency} -->\n         <executions>\n           <execution>\n-            <id>default-instrument</id>\n+            <id>prepare-agent</id>\n             <goals>\n-              <goal>instrument</goal>\n+              <goal>prepare-agent</goal>\n             </goals>\n           </execution>\n           <execution>\n-            <id>default-restore-instrumented-classes</id>\n+            <id>default-instrument</id>\n             <goals>\n-              <goal>restore-instrumented-classes</goal>\n+              <goal>instrument</goal>\n             </goals>\n           </execution>\n           <execution>\n-            <!-- This generates the unit test reports for individual modules.\n-              jacoco-test-coverage generates aggregate reports for all modules -->\n-            <id>post-unit-test</id>\n-            <goals>\n-              <goal>report</goal>\n-            </goals>\n-            <configuration>\n-              <!-- Sets the output directory for the code coverage report. -->\n-              <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>\n-              <excludes>\n-                <exclude>**/com/azure/cosmos/implementation/apachecommons/**/*</exclude>\n-                <exclude>**/com/azure/cosmos/implementation/guava25/**/*</exclude>\n-                <exclude>**/com/azure/cosmos/implementation/guava27/**/*</exclude>\n-              </excludes>\n-            </configuration>\n-          </execution>\n-          <execution>\n-            <id>check</id>\n+            <id>default-restore-instrumented-classes</id>\n             <goals>\n-              <goal>check</goal>\n+              <goal>restore-instrumented-classes</goal>\n             </goals>\n-            <configuration>\n-              <rules>\n-                <rule>\n-                  <element>BUNDLE</element>\n-                  <limits>\n-                    <limit>\n-                      <counter>LINE</counter>\n-                      <value>COVEREDRATIO</value>\n-                      <minimum>${jacoco.min.linecoverage}</minimum>\n-                    </limit>\n-                    <limit>\n-                      <counter>BRANCH</counter>\n-                      <value>COVEREDRATIO</value>\n-                      <minimum>${jacoco.min.branchcoverage}</minimum>\n-                    </limit>\n-                  </limits>\n-                </rule>\n-              </rules>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9ec62c14e29d23fe9a2baa588ceda2a45e41856"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAxNzU2NQ==", "bodyText": "This will require a corresponding update to index.html", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#discussion_r409017565", "createdAt": "2020-04-15T17:37:17Z", "author": {"login": "srnagar"}, "path": "eng/jacoco-test-coverage/pom.xml", "diffHunk": "@@ -188,14 +188,11 @@\n         <version>0.8.5</version> <!-- {x-version-update;org.jacoco:jacoco-maven-plugin;external_dependency} -->\n         <executions>\n           <execution>\n-            <phase>prepare-package</phase>\n+            <id>report-aggregate</id>\n+            <phase>verify</phase>\n             <goals>\n               <goal>report-aggregate</goal>\n             </goals>\n-            <configuration>\n-              <!-- Sets the output directory for the code coverage report. -->\n-              <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9ec62c14e29d23fe9a2baa588ceda2a45e41856"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NDMxMjcx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#pullrequestreview-396431271", "createdAt": "2020-04-20T13:02:54Z", "commit": {"oid": "4478b7d2baf0b60b3c52e0d13e68c0fea2603cf1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTk0MDY2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#pullrequestreview-396594066", "createdAt": "2020-04-20T16:01:21Z", "commit": {"oid": "4478b7d2baf0b60b3c52e0d13e68c0fea2603cf1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjowMToyMVrOGIb3HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjowMToyMVrOGIb3HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5ODI2OA==", "bodyText": "This is the dependency report that gets generated, but this won't generate using the new build structure.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#discussion_r411498268", "createdAt": "2020-04-20T16:01:21Z", "author": {"login": "alzimmermsft"}, "path": "eng/pipelines/aggregate-reports.yml", "diffHunk": "@@ -52,13 +50,16 @@ jobs:\n       displayName: Generate Interdependency Report Data\n \n     - pwsh: |\n-        copy -r target/staging $(Build.ArtifactStagingDirectory)\n-        copy target/dependency-whitelist.json (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy eng/code-quality-reports/src/main/resources/index.html $(Build.ArtifactStagingDirectory)\n-        copy output/pom.client.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy eng/common/InterdependencyGraph.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy eng/common/dependency-whitelist.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy data.js (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n+        Copy-Item eng/jacoco-test-coverage/target/staging $(Build.ArtifactStagingDirectory) -Recurse\n+        Copy-Item eng/jacoco-test-coverage/target/dependency-whitelist.json $(Build.ArtifactStagingDirectory)\\staging\n+        Copy-Item eng/code-quality-reports/src/main/resources/index.html $(Build.ArtifactStagingDirectory)\n+        \n+        # What is this?\n+        # copy output/pom.client.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4478b7d2baf0b60b3c52e0d13e68c0fea2603cf1"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "853b8572c501ee9078a28e2453b37eebe469f2e2", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/853b8572c501ee9078a28e2453b37eebe469f2e2", "committedDate": "2020-04-22T03:44:25Z", "message": "Fixing aggregate reports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57d650d2f5a7ffbc65e7a44798a58749b1f32a10", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/57d650d2f5a7ffbc65e7a44798a58749b1f32a10", "committedDate": "2020-04-22T03:44:25Z", "message": "Added version tags."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12854dce2044e32b4da98b0aa5471d9f397c22d9", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/12854dce2044e32b4da98b0aa5471d9f397c22d9", "committedDate": "2020-04-22T03:46:17Z", "message": "Restore previous configuration entries & tidy-up."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "688013ca26b61d168e7d254dc39fa3c2f6760271", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/688013ca26b61d168e7d254dc39fa3c2f6760271", "committedDate": "2020-04-22T03:47:43Z", "message": "Pulling files together from various locations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4743134ca0b6be7ba6621432c71c1c723eb99a94", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4743134ca0b6be7ba6621432c71c1c723eb99a94", "committedDate": "2020-04-22T03:47:43Z", "message": "Execute site and staging goals."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "941c69d77f4f9672992e8bf65ee82dc3ac1479ce", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/941c69d77f4f9672992e8bf65ee82dc3ac1479ce", "committedDate": "2020-04-22T03:47:44Z", "message": "Fix parameter name."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab71db7718a5ae0dca915e4c4f3e5bd33fd9a8bd", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ab71db7718a5ae0dca915e4c4f3e5bd33fd9a8bd", "committedDate": "2020-04-22T03:48:07Z", "message": "Missing period."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfd89c60a77455c0bd4cb27bd621431ca93c69dc", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/dfd89c60a77455c0bd4cb27bd621431ca93c69dc", "committedDate": "2020-04-22T03:48:07Z", "message": "Fix pathing issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce368c3e21be534cfa3729513179a07db4106e99", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ce368c3e21be534cfa3729513179a07db4106e99", "committedDate": "2020-04-22T03:48:57Z", "message": "Remove redundant HTML file."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4478b7d2baf0b60b3c52e0d13e68c0fea2603cf1", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4478b7d2baf0b60b3c52e0d13e68c0fea2603cf1", "committedDate": "2020-04-20T04:51:41Z", "message": "Fix pathing issue."}, "afterCommit": {"oid": "ce368c3e21be534cfa3729513179a07db4106e99", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ce368c3e21be534cfa3729513179a07db4106e99", "committedDate": "2020-04-22T03:48:57Z", "message": "Remove redundant HTML file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aac32313d5865e2a3eb0a9415f1bc3d0734eb253", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/aac32313d5865e2a3eb0a9415f1bc3d0734eb253", "committedDate": "2020-04-22T04:33:32Z", "message": "/facepalm"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 965, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}