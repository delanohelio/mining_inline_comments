{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2OTQ0Mjk3", "number": 12350, "title": "Mgmt: Appplatform", "bodyText": "", "createdAt": "2020-06-19T07:40:30Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350", "merged": true, "mergeCommit": {"oid": "0ba3641a16e9cb4c8c104b22193fc468168bdcb2"}, "closed": true, "closedAt": "2020-07-06T08:45:28Z", "author": {"login": "ChenTanyi"}, "timelineItems": {"totalCount": 47, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrrnuYAH2gAyNDM2OTQ0Mjk3OjE2OGI5ODNjMWY3NDJhYzAxYTA1NmU5NjJhYjM2ZGVjMmFhYjE1YmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyMb5xAH2gAyNDM2OTQ0Mjk3OmFhMjQzZTA0ZGUzNTZlZWZjNDM3ZjVmZjgyNWU3MGIwZjYyNTJiYWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "168b983c1f742ac01a056e962ab36dec2aab15be", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/168b983c1f742ac01a056e962ab36dec2aab15be", "committedDate": "2020-06-16T02:14:08Z", "message": "feat: add api specs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38b778af5728d5a29bfeae0d7bb68f948322ec3b", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/38b778af5728d5a29bfeae0d7bb68f948322ec3b", "committedDate": "2020-06-16T02:15:18Z", "message": "feat: generate app platform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72dc3ec5844676c032d2a9f5647d241036e3140c", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/72dc3ec5844676c032d2a9f5647d241036e3140c", "committedDate": "2020-06-16T02:15:23Z", "message": "add pom.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9feeb621a6e4b59004b6daeae428e0dac633a95", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e9feeb621a6e4b59004b6daeae428e0dac633a95", "committedDate": "2020-06-19T07:39:22Z", "message": "Add spring interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85169563f0cf46c128d7706ae5a889b7f3200668", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/85169563f0cf46c128d7706ae5a889b7f3200668", "committedDate": "2020-06-22T03:21:42Z", "message": "fix compile error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f512d218d60abd9f90064371dfd4226e665ba37", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5f512d218d60abd9f90064371dfd4226e665ba37", "committedDate": "2020-07-01T08:30:46Z", "message": "add implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "841202db7f00e254d9afee93043383690b06868f", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/841202db7f00e254d9afee93043383690b06868f", "committedDate": "2020-07-01T08:32:12Z", "message": "add piggymetrics source code for test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ea7e1dd399a34d3031efb79525f75601194a451", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0ea7e1dd399a34d3031efb79525f75601194a451", "committedDate": "2020-07-02T02:49:11Z", "message": "add unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bacdf9d28513b0fad96c33e13debf2a29b60d337", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bacdf9d28513b0fad96c33e13debf2a29b60d337", "committedDate": "2020-07-02T06:33:44Z", "message": "update test and some impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b11d293a6c1064411dc05be3195658d131705345", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b11d293a6c1064411dc05be3195658d131705345", "committedDate": "2020-07-02T06:57:15Z", "message": "Merge branch 'master' into appplatform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58f80c66966c41aa881ccb28f2b923a7694838be", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/58f80c66966c41aa881ccb28f2b923a7694838be", "committedDate": "2020-07-02T08:07:23Z", "message": "add spring service api in azure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d807eb46233396574ca622cf33fe2f178f4e990d", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d807eb46233396574ca622cf33fe2f178f4e990d", "committedDate": "2020-07-02T08:35:44Z", "message": "regen app platform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "caf76a921199ed014fdfa93102f104f158e7517a", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/caf76a921199ed014fdfa93102f104f158e7517a", "committedDate": "2020-07-02T08:37:43Z", "message": "fix compile error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d20e8e5eb5412d208a80930ae568cec8cc0e5145", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d20e8e5eb5412d208a80930ae568cec8cc0e5145", "committedDate": "2020-07-03T02:35:02Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d02ec9c9966ebbb06d92c46925a3a15011948baa", "committedDate": "2020-07-03T02:35:36Z", "message": "compress source code to temp file rather than memory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTM2NDgy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442136482", "createdAt": "2020-07-03T04:18:28Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDoxODoyOVrOGsjN8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDoxODoyOVrOGsjN8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2NzUzOQ==", "bodyText": "Why Mono? Normally you should create ShareFileAsyncClient, which is not async, and pass it to other methods. Async call of create(maxSize) appear not about the createShareFileAsyncClient method.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449367539", "createdAt": "2020-07-03T04:18:29Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/main/java/com/azure/resourcemanager/appplatform/implementation/SpringAppDeploymentImpl.java", "diffHunk": "@@ -0,0 +1,446 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform.implementation;\n+\n+import com.azure.resourcemanager.appplatform.AppPlatformManager;\n+import com.azure.resourcemanager.appplatform.fluent.inner.DeploymentResourceInner;\n+import com.azure.resourcemanager.appplatform.fluent.inner.LogFileUrlResponseInner;\n+import com.azure.resourcemanager.appplatform.models.DeploymentInstance;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceProperties;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceStatus;\n+import com.azure.resourcemanager.appplatform.models.DeploymentSettings;\n+import com.azure.resourcemanager.appplatform.models.ResourceUploadDefinition;\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.UserSourceInfo;\n+import com.azure.resourcemanager.appplatform.models.UserSourceType;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.implementation.ExternalChildResourceImpl;\n+import com.azure.resourcemanager.resources.fluentcore.model.Indexable;\n+import com.azure.storage.file.share.ShareFileAsyncClient;\n+import com.azure.storage.file.share.ShareFileClientBuilder;\n+import org.apache.commons.compress.archivers.tar.TarArchiveEntry;\n+import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;\n+import org.apache.commons.compress.utils.IOUtils;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.zip.GZIPOutputStream;\n+\n+public class SpringAppDeploymentImpl\n+    extends ExternalChildResourceImpl<SpringAppDeployment, DeploymentResourceInner, SpringAppImpl, SpringApp>\n+    implements SpringAppDeployment, SpringAppDeployment.Definition, SpringAppDeployment.Update {\n+    private static final int BLOCK_SIZE = 4 * 1024 * 1024; // 4MB\n+    private final SpringAppDeploymentsImpl client;\n+    private SpringAppDeployment originalDeployment;\n+\n+    SpringAppDeploymentImpl(String name, SpringAppImpl parent,\n+                            DeploymentResourceInner innerObject, SpringAppDeploymentsImpl client) {\n+        super(name, parent, innerObject);\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public String appName() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().appName();\n+    }\n+\n+    @Override\n+    public DeploymentSettings settings() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().deploymentSettings();\n+    }\n+\n+    @Override\n+    public DeploymentResourceStatus status() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().status();\n+    }\n+\n+    @Override\n+    public boolean isActive() {\n+        if (inner().properties() == null) {\n+            return false;\n+        }\n+        return inner().properties().active();\n+    }\n+\n+    @Override\n+    public OffsetDateTime createdTime() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().createdTime();\n+    }\n+\n+    @Override\n+    public List<DeploymentInstance> instances() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().instances();\n+    }\n+\n+    @Override\n+    public String getLogFileUrl() {\n+        return getLogFileUrlAsync().block();\n+    }\n+\n+    @Override\n+    public Mono<String> getLogFileUrlAsync() {\n+        return manager().inner().getDeployments().getLogFileUrlAsync(\n+            parent().parent().resourceGroupName(), parent().parent().name(), parent().name(), name()\n+        )\n+            .map(LogFileUrlResponseInner::url);\n+    }\n+\n+    private void ensureDeploySettings() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().deploymentSettings() == null) {\n+            inner().properties().withDeploymentSettings(new DeploymentSettings());\n+        }\n+    }\n+\n+    private void ensureSource() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().source() == null) {\n+            inner().properties().withSource(new UserSourceInfo());\n+        }\n+    }\n+\n+    private File compressSource(File sourceFolder) throws IOException {\n+        File compressFile = File.createTempFile(\"java_package\", \"tar.gz\");\n+        try (TarArchiveOutputStream tarArchiveOutputStream = new TarArchiveOutputStream(\n+                 new GZIPOutputStream(new FileOutputStream(compressFile)))) {\n+            tarArchiveOutputStream.setLongFileMode(TarArchiveOutputStream.LONGFILE_GNU);\n+\n+            for (Path sourceFile : Files.walk(sourceFolder.toPath()).collect(Collectors.toList())) {\n+                String relativePath = sourceFolder.toPath().relativize(sourceFile).toString();\n+                TarArchiveEntry entry = new TarArchiveEntry(sourceFile.toFile(), relativePath);\n+                if (sourceFile.toFile().isFile()) {\n+                    try (InputStream inputStream = new FileInputStream(sourceFile.toFile())) {\n+                        tarArchiveOutputStream.putArchiveEntry(entry);\n+                        IOUtils.copy(inputStream, tarArchiveOutputStream);\n+                        tarArchiveOutputStream.closeArchiveEntry();\n+                    }\n+                } else {\n+                    tarArchiveOutputStream.putArchiveEntry(entry);\n+                    tarArchiveOutputStream.closeArchiveEntry();\n+                }\n+            }\n+        }\n+        return compressFile;\n+    }\n+\n+    private Mono<ShareFileAsyncClient> createShareFileAsyncClient(ResourceUploadDefinition option, long maxSize) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 160}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTM4MTQ1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442138145", "createdAt": "2020-07-03T04:25:34Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDoyNTozNFrOGsjTdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDoyNTozNFrOGsjTdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2ODk0OQ==", "bodyText": "Same as above, it should be a Mono<Void> to signal completion.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449368949", "createdAt": "2020-07-03T04:25:34Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/main/java/com/azure/resourcemanager/appplatform/implementation/SpringAppDeploymentImpl.java", "diffHunk": "@@ -0,0 +1,446 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform.implementation;\n+\n+import com.azure.resourcemanager.appplatform.AppPlatformManager;\n+import com.azure.resourcemanager.appplatform.fluent.inner.DeploymentResourceInner;\n+import com.azure.resourcemanager.appplatform.fluent.inner.LogFileUrlResponseInner;\n+import com.azure.resourcemanager.appplatform.models.DeploymentInstance;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceProperties;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceStatus;\n+import com.azure.resourcemanager.appplatform.models.DeploymentSettings;\n+import com.azure.resourcemanager.appplatform.models.ResourceUploadDefinition;\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.UserSourceInfo;\n+import com.azure.resourcemanager.appplatform.models.UserSourceType;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.implementation.ExternalChildResourceImpl;\n+import com.azure.resourcemanager.resources.fluentcore.model.Indexable;\n+import com.azure.storage.file.share.ShareFileAsyncClient;\n+import com.azure.storage.file.share.ShareFileClientBuilder;\n+import org.apache.commons.compress.archivers.tar.TarArchiveEntry;\n+import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;\n+import org.apache.commons.compress.utils.IOUtils;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.zip.GZIPOutputStream;\n+\n+public class SpringAppDeploymentImpl\n+    extends ExternalChildResourceImpl<SpringAppDeployment, DeploymentResourceInner, SpringAppImpl, SpringApp>\n+    implements SpringAppDeployment, SpringAppDeployment.Definition, SpringAppDeployment.Update {\n+    private static final int BLOCK_SIZE = 4 * 1024 * 1024; // 4MB\n+    private final SpringAppDeploymentsImpl client;\n+    private SpringAppDeployment originalDeployment;\n+\n+    SpringAppDeploymentImpl(String name, SpringAppImpl parent,\n+                            DeploymentResourceInner innerObject, SpringAppDeploymentsImpl client) {\n+        super(name, parent, innerObject);\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public String appName() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().appName();\n+    }\n+\n+    @Override\n+    public DeploymentSettings settings() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().deploymentSettings();\n+    }\n+\n+    @Override\n+    public DeploymentResourceStatus status() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().status();\n+    }\n+\n+    @Override\n+    public boolean isActive() {\n+        if (inner().properties() == null) {\n+            return false;\n+        }\n+        return inner().properties().active();\n+    }\n+\n+    @Override\n+    public OffsetDateTime createdTime() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().createdTime();\n+    }\n+\n+    @Override\n+    public List<DeploymentInstance> instances() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().instances();\n+    }\n+\n+    @Override\n+    public String getLogFileUrl() {\n+        return getLogFileUrlAsync().block();\n+    }\n+\n+    @Override\n+    public Mono<String> getLogFileUrlAsync() {\n+        return manager().inner().getDeployments().getLogFileUrlAsync(\n+            parent().parent().resourceGroupName(), parent().parent().name(), parent().name(), name()\n+        )\n+            .map(LogFileUrlResponseInner::url);\n+    }\n+\n+    private void ensureDeploySettings() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().deploymentSettings() == null) {\n+            inner().properties().withDeploymentSettings(new DeploymentSettings());\n+        }\n+    }\n+\n+    private void ensureSource() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().source() == null) {\n+            inner().properties().withSource(new UserSourceInfo());\n+        }\n+    }\n+\n+    private File compressSource(File sourceFolder) throws IOException {\n+        File compressFile = File.createTempFile(\"java_package\", \"tar.gz\");\n+        try (TarArchiveOutputStream tarArchiveOutputStream = new TarArchiveOutputStream(\n+                 new GZIPOutputStream(new FileOutputStream(compressFile)))) {\n+            tarArchiveOutputStream.setLongFileMode(TarArchiveOutputStream.LONGFILE_GNU);\n+\n+            for (Path sourceFile : Files.walk(sourceFolder.toPath()).collect(Collectors.toList())) {\n+                String relativePath = sourceFolder.toPath().relativize(sourceFile).toString();\n+                TarArchiveEntry entry = new TarArchiveEntry(sourceFile.toFile(), relativePath);\n+                if (sourceFile.toFile().isFile()) {\n+                    try (InputStream inputStream = new FileInputStream(sourceFile.toFile())) {\n+                        tarArchiveOutputStream.putArchiveEntry(entry);\n+                        IOUtils.copy(inputStream, tarArchiveOutputStream);\n+                        tarArchiveOutputStream.closeArchiveEntry();\n+                    }\n+                } else {\n+                    tarArchiveOutputStream.putArchiveEntry(entry);\n+                    tarArchiveOutputStream.closeArchiveEntry();\n+                }\n+            }\n+        }\n+        return compressFile;\n+    }\n+\n+    private Mono<ShareFileAsyncClient> createShareFileAsyncClient(ResourceUploadDefinition option, long maxSize) {\n+        ShareFileAsyncClient shareFileAsyncClient = new ShareFileClientBuilder()\n+            .endpoint(option.uploadUrl())\n+            .httpClient(manager().httpPipeline().getHttpClient())\n+            .buildFileAsyncClient();\n+\n+        return shareFileAsyncClient.create(maxSize)\n+            .then(Mono.just(shareFileAsyncClient));\n+    }\n+\n+    private Mono<ShareFileAsyncClient> uploadToStorage(byte[] bytes, ResourceUploadDefinition option) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 170}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTM4NzYw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442138760", "createdAt": "2020-07-03T04:28:13Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDoyODoxM1rOGsjVow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDoyODoxM1rOGsjVow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2OTUwNw==", "bodyText": "Should we move the dependency to parent pom so the version control only happen there?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449369507", "createdAt": "2020-07-03T04:28:13Z", "author": {"login": "xseeseesee"}, "path": "sdk/appplatform/mgmt/pom.xml", "diffHunk": "@@ -0,0 +1,139 @@\n+<!--\n+ Copyright (c) Microsoft Corporation. All rights reserved.\n+ Licensed under the MIT License. See License.txt in the project root for\n+ license information.\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+      <groupId>com.azure.resourcemanager</groupId>\n+      <artifactId>azure-resourcemanager-parent</artifactId>\n+      <version>2.0.0-SNAPSHOT</version>\n+      <relativePath>../../management/pom.xml</relativePath>\n+    </parent>\n+\n+    <artifactId>azure-resourcemanager-appplatform</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Microsoft Azure SDK for App Platform Management</name>\n+    <description>This package contains Microsoft Azure App Platform Management SDK.</description>\n+    <url>https://github.com/Azure/azure-sdk-for-java</url>\n+\n+    <licenses>\n+      <license>\n+        <name>The MIT License (MIT)</name>\n+        <url>http://opensource.org/licenses/MIT</url>\n+        <distribution>repo</distribution>\n+      </license>\n+    </licenses>\n+\n+    <scm>\n+      <url>scm:git:https://github.com/Azure/azure-sdk-for-java</url>\n+      <connection>scm:git:git@github.com:Azure/azure-sdk-for-java.git</connection>\n+      <tag>HEAD</tag>\n+    </scm>\n+\n+    <properties>\n+      <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+      <legal><![CDATA[[INFO] Any downloads listed may be third party software.  Microsoft grants you no rights for third party software.]]></legal>\n+    </properties>\n+\n+    <developers>\n+      <developer>\n+        <id>microsoft</id>\n+        <name>Microsoft</name>\n+      </developer>\n+    </developers>\n+\n+    <dependencies>\n+      <dependency>\n+        <groupId>com.azure.resourcemanager</groupId>\n+        <artifactId>azure-resourcemanager-resources</artifactId>\n+        <version>2.0.0-SNAPSHOT</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>com.azure</groupId>\n+        <artifactId>azure-storage-file-share</artifactId>\n+        <version>12.5.0</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTM4OTAz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442138903", "createdAt": "2020-07-03T04:28:53Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDoyODo1M1rOGsjWIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDoyODo1M1rOGsjWIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2OTYzMw==", "bodyText": "Same as above azure-storage-file-share", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449369633", "createdAt": "2020-07-03T04:28:53Z", "author": {"login": "xseeseesee"}, "path": "sdk/appplatform/mgmt/pom.xml", "diffHunk": "@@ -0,0 +1,139 @@\n+<!--\n+ Copyright (c) Microsoft Corporation. All rights reserved.\n+ Licensed under the MIT License. See License.txt in the project root for\n+ license information.\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+      <groupId>com.azure.resourcemanager</groupId>\n+      <artifactId>azure-resourcemanager-parent</artifactId>\n+      <version>2.0.0-SNAPSHOT</version>\n+      <relativePath>../../management/pom.xml</relativePath>\n+    </parent>\n+\n+    <artifactId>azure-resourcemanager-appplatform</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Microsoft Azure SDK for App Platform Management</name>\n+    <description>This package contains Microsoft Azure App Platform Management SDK.</description>\n+    <url>https://github.com/Azure/azure-sdk-for-java</url>\n+\n+    <licenses>\n+      <license>\n+        <name>The MIT License (MIT)</name>\n+        <url>http://opensource.org/licenses/MIT</url>\n+        <distribution>repo</distribution>\n+      </license>\n+    </licenses>\n+\n+    <scm>\n+      <url>scm:git:https://github.com/Azure/azure-sdk-for-java</url>\n+      <connection>scm:git:git@github.com:Azure/azure-sdk-for-java.git</connection>\n+      <tag>HEAD</tag>\n+    </scm>\n+\n+    <properties>\n+      <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+      <legal><![CDATA[[INFO] Any downloads listed may be third party software.  Microsoft grants you no rights for third party software.]]></legal>\n+    </properties>\n+\n+    <developers>\n+      <developer>\n+        <id>microsoft</id>\n+        <name>Microsoft</name>\n+      </developer>\n+    </developers>\n+\n+    <dependencies>\n+      <dependency>\n+        <groupId>com.azure.resourcemanager</groupId>\n+        <artifactId>azure-resourcemanager-resources</artifactId>\n+        <version>2.0.0-SNAPSHOT</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>com.azure</groupId>\n+        <artifactId>azure-storage-file-share</artifactId>\n+        <version>12.5.0</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.apache.commons</groupId>\n+        <artifactId>commons-compress</artifactId>\n+        <version>1.20</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTQwODU3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442140857", "createdAt": "2020-07-03T04:37:21Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDozNzoyMVrOGsjc6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDozNzoyMVrOGsjc6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3MTM2OA==", "bodyText": "deployments would be a better name? Current you will have deploy().deleteByNameAsync which seems not clear.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449371368", "createdAt": "2020-07-03T04:37:21Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/main/java/com/azure/resourcemanager/appplatform/implementation/SpringAppImpl.java", "diffHunk": "@@ -0,0 +1,282 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform.implementation;\n+\n+import com.azure.resourcemanager.appplatform.AppPlatformManager;\n+import com.azure.resourcemanager.appplatform.fluent.inner.AppResourceInner;\n+import com.azure.resourcemanager.appplatform.models.AppResourceProperties;\n+import com.azure.resourcemanager.appplatform.models.ManagedIdentityProperties;\n+import com.azure.resourcemanager.appplatform.models.PersistentDisk;\n+import com.azure.resourcemanager.appplatform.models.ResourceUploadDefinition;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployments;\n+import com.azure.resourcemanager.appplatform.models.SpringService;\n+import com.azure.resourcemanager.appplatform.models.TemporaryDisk;\n+import com.azure.resourcemanager.appplatform.models.UserSourceType;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.implementation.ExternalChildResourceImpl;\n+import com.azure.resourcemanager.resources.fluentcore.model.Creatable;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.File;\n+import java.time.OffsetDateTime;\n+\n+public class SpringAppImpl\n+    extends ExternalChildResourceImpl<SpringApp, AppResourceInner, SpringServiceImpl, SpringService>\n+    implements SpringApp, SpringApp.Definition, SpringApp.Update {\n+    private Creatable<SpringAppDeployment> springAppDeploymentToCreate = null;\n+\n+    SpringAppImpl(String name, SpringServiceImpl parent, AppResourceInner innerObject) {\n+        super(name, parent, innerObject);\n+    }\n+\n+    @Override\n+    public boolean isPublic() {\n+        if (inner().properties() == null) {\n+            return false;\n+        }\n+        return inner().properties().publicProperty();\n+    }\n+\n+    @Override\n+    public boolean isHttpsOnly() {\n+        if (inner().properties() == null) {\n+            return false;\n+        }\n+        return inner().properties().httpsOnly();\n+    }\n+\n+    @Override\n+    public String url() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().url();\n+    }\n+\n+    @Override\n+    public TemporaryDisk temporaryDisk() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().temporaryDisk();\n+    }\n+\n+    @Override\n+    public PersistentDisk persistentDisk() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().persistentDisk();\n+    }\n+\n+    @Override\n+    public ManagedIdentityProperties identity() {\n+        return inner().identity();\n+    }\n+\n+    @Override\n+    public OffsetDateTime createdTime() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().createdTime();\n+    }\n+\n+    @Override\n+    public String activeDeployment() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().activeDeploymentName();\n+    }\n+\n+    @Override\n+    public SpringAppDeployments deploy() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTQxNTM4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442141538", "createdAt": "2020-07-03T04:40:11Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDo0MDoxMVrOGsjfIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDo0MDoxMVrOGsjfIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3MTkzNg==", "bodyText": "withActiveDeploymentSetting or withSettingFromActiveDeployment seems better?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449371936", "createdAt": "2020-07-03T04:40:11Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/main/java/com/azure/resourcemanager/appplatform/implementation/SpringAppDeploymentImpl.java", "diffHunk": "@@ -0,0 +1,446 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform.implementation;\n+\n+import com.azure.resourcemanager.appplatform.AppPlatformManager;\n+import com.azure.resourcemanager.appplatform.fluent.inner.DeploymentResourceInner;\n+import com.azure.resourcemanager.appplatform.fluent.inner.LogFileUrlResponseInner;\n+import com.azure.resourcemanager.appplatform.models.DeploymentInstance;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceProperties;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceStatus;\n+import com.azure.resourcemanager.appplatform.models.DeploymentSettings;\n+import com.azure.resourcemanager.appplatform.models.ResourceUploadDefinition;\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.UserSourceInfo;\n+import com.azure.resourcemanager.appplatform.models.UserSourceType;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.implementation.ExternalChildResourceImpl;\n+import com.azure.resourcemanager.resources.fluentcore.model.Indexable;\n+import com.azure.storage.file.share.ShareFileAsyncClient;\n+import com.azure.storage.file.share.ShareFileClientBuilder;\n+import org.apache.commons.compress.archivers.tar.TarArchiveEntry;\n+import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;\n+import org.apache.commons.compress.utils.IOUtils;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.zip.GZIPOutputStream;\n+\n+public class SpringAppDeploymentImpl\n+    extends ExternalChildResourceImpl<SpringAppDeployment, DeploymentResourceInner, SpringAppImpl, SpringApp>\n+    implements SpringAppDeployment, SpringAppDeployment.Definition, SpringAppDeployment.Update {\n+    private static final int BLOCK_SIZE = 4 * 1024 * 1024; // 4MB\n+    private final SpringAppDeploymentsImpl client;\n+    private SpringAppDeployment originalDeployment;\n+\n+    SpringAppDeploymentImpl(String name, SpringAppImpl parent,\n+                            DeploymentResourceInner innerObject, SpringAppDeploymentsImpl client) {\n+        super(name, parent, innerObject);\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public String appName() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().appName();\n+    }\n+\n+    @Override\n+    public DeploymentSettings settings() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().deploymentSettings();\n+    }\n+\n+    @Override\n+    public DeploymentResourceStatus status() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().status();\n+    }\n+\n+    @Override\n+    public boolean isActive() {\n+        if (inner().properties() == null) {\n+            return false;\n+        }\n+        return inner().properties().active();\n+    }\n+\n+    @Override\n+    public OffsetDateTime createdTime() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().createdTime();\n+    }\n+\n+    @Override\n+    public List<DeploymentInstance> instances() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().instances();\n+    }\n+\n+    @Override\n+    public String getLogFileUrl() {\n+        return getLogFileUrlAsync().block();\n+    }\n+\n+    @Override\n+    public Mono<String> getLogFileUrlAsync() {\n+        return manager().inner().getDeployments().getLogFileUrlAsync(\n+            parent().parent().resourceGroupName(), parent().parent().name(), parent().name(), name()\n+        )\n+            .map(LogFileUrlResponseInner::url);\n+    }\n+\n+    private void ensureDeploySettings() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().deploymentSettings() == null) {\n+            inner().properties().withDeploymentSettings(new DeploymentSettings());\n+        }\n+    }\n+\n+    private void ensureSource() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().source() == null) {\n+            inner().properties().withSource(new UserSourceInfo());\n+        }\n+    }\n+\n+    private File compressSource(File sourceFolder) throws IOException {\n+        File compressFile = File.createTempFile(\"java_package\", \"tar.gz\");\n+        try (TarArchiveOutputStream tarArchiveOutputStream = new TarArchiveOutputStream(\n+                 new GZIPOutputStream(new FileOutputStream(compressFile)))) {\n+            tarArchiveOutputStream.setLongFileMode(TarArchiveOutputStream.LONGFILE_GNU);\n+\n+            for (Path sourceFile : Files.walk(sourceFolder.toPath()).collect(Collectors.toList())) {\n+                String relativePath = sourceFolder.toPath().relativize(sourceFile).toString();\n+                TarArchiveEntry entry = new TarArchiveEntry(sourceFile.toFile(), relativePath);\n+                if (sourceFile.toFile().isFile()) {\n+                    try (InputStream inputStream = new FileInputStream(sourceFile.toFile())) {\n+                        tarArchiveOutputStream.putArchiveEntry(entry);\n+                        IOUtils.copy(inputStream, tarArchiveOutputStream);\n+                        tarArchiveOutputStream.closeArchiveEntry();\n+                    }\n+                } else {\n+                    tarArchiveOutputStream.putArchiveEntry(entry);\n+                    tarArchiveOutputStream.closeArchiveEntry();\n+                }\n+            }\n+        }\n+        return compressFile;\n+    }\n+\n+    private Mono<ShareFileAsyncClient> createShareFileAsyncClient(ResourceUploadDefinition option, long maxSize) {\n+        ShareFileAsyncClient shareFileAsyncClient = new ShareFileClientBuilder()\n+            .endpoint(option.uploadUrl())\n+            .httpClient(manager().httpPipeline().getHttpClient())\n+            .buildFileAsyncClient();\n+\n+        return shareFileAsyncClient.create(maxSize)\n+            .then(Mono.just(shareFileAsyncClient));\n+    }\n+\n+    private Mono<ShareFileAsyncClient> uploadToStorage(byte[] bytes, ResourceUploadDefinition option) {\n+        inner().properties().source().withRelativePath(option.relativePath());\n+        return createShareFileAsyncClient(option, bytes.length)\n+                .flatMap(shareFileAsyncClient -> {\n+                    List<Integer> blockList = new ArrayList<>();\n+                    for (int start = 0; start < bytes.length; start += BLOCK_SIZE) {\n+                        blockList.add(start);\n+                    }\n+                    return Flux.fromIterable(blockList)\n+                        .flatMap(start -> {\n+                            int length = Math.min(bytes.length - start, BLOCK_SIZE);\n+                            return shareFileAsyncClient.uploadWithResponse(\n+                                Flux.just(ByteBuffer.wrap(bytes, start, length)), length, (long) start);\n+                        })\n+                        .then(Mono.just(shareFileAsyncClient));\n+                });\n+    }\n+\n+    private Mono<ShareFileAsyncClient> uploadToStorage(File source, ResourceUploadDefinition option) {\n+        inner().properties().source().withRelativePath(option.relativePath());\n+        try {\n+            return createShareFileAsyncClient(option, source.length())\n+                .flatMap(shareFileAsyncClient -> shareFileAsyncClient.uploadFromFile(source.getAbsolutePath())\n+                    .then(Mono.just(shareFileAsyncClient)));\n+        } catch (Exception e) {\n+            return Mono.error(e);\n+        }\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withJarPath(File jar) {\n+        ensureSource();\n+        inner().properties().source().withType(UserSourceType.JAR);\n+        this.addDependency(\n+            context -> parent().getResourceUploadUrlAsync()\n+                .flatMap(option -> uploadToStorage(jar, option)\n+                    .then(context.voidMono()))\n+        );\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withJarFile(byte[] jar) {\n+        ensureSource();\n+        inner().properties().source().withType(UserSourceType.JAR);\n+        this.addDependency(\n+            context -> parent().getResourceUploadUrlAsync()\n+                .flatMap(option -> uploadToStorage(jar, option)\n+                    .then(context.voidMono()))\n+        );\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withSourceCodeFolder(File sourceCode) {\n+        ensureSource();\n+        inner().properties().source().withType(UserSourceType.SOURCE);\n+        this.addDependency(\n+            context -> parent().getResourceUploadUrlAsync()\n+                .flatMap(option -> {\n+                    try {\n+                        return uploadToStorage(compressSource(sourceCode), option);\n+                    } catch (Exception e) {\n+                        return Mono.error(e);\n+                    }\n+                })\n+                .then(context.voidMono())\n+        );\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withExistingSource(UserSourceType type, String relativePath) {\n+        ensureSource();\n+        inner().properties().source().withType(type);\n+        inner().properties().source().withRelativePath(relativePath);\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withSourceCodeTarGzFile(File sourceCodeTarGz) {\n+        ensureSource();\n+        inner().properties().source().withType(UserSourceType.SOURCE);\n+        this.addDependency(\n+            context -> parent().getResourceUploadUrlAsync()\n+                .flatMap(option -> uploadToStorage(sourceCodeTarGz, option)\n+                    .then(context.voidMono()))\n+        );\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withTargetModule(String moduleName) {\n+        ensureSource();\n+        inner().properties().source().withArtifactSelector(moduleName);\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withSingleModule() {\n+        ensureSource();\n+        inner().properties().source().withArtifactSelector(null);\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withCurrentActiveSetting() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 276}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fe73abff3df81ba6b3ba9ce8536ff17775b4f58", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0fe73abff3df81ba6b3ba9ce8536ff17775b4f58", "committedDate": "2020-07-03T04:41:58Z", "message": "rename app.deploy to app.deployments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTQxOTg2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442141986", "createdAt": "2020-07-03T04:42:06Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDo0MjowNlrOGsjgww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDo0MjowNlrOGsjgww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3MjM1NQ==", "bodyText": "Should (or not?) we provide byte[] as input?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449372355", "createdAt": "2020-07-03T04:42:06Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/main/java/com/azure/resourcemanager/appplatform/implementation/SpringAppDeploymentImpl.java", "diffHunk": "@@ -0,0 +1,446 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform.implementation;\n+\n+import com.azure.resourcemanager.appplatform.AppPlatformManager;\n+import com.azure.resourcemanager.appplatform.fluent.inner.DeploymentResourceInner;\n+import com.azure.resourcemanager.appplatform.fluent.inner.LogFileUrlResponseInner;\n+import com.azure.resourcemanager.appplatform.models.DeploymentInstance;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceProperties;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceStatus;\n+import com.azure.resourcemanager.appplatform.models.DeploymentSettings;\n+import com.azure.resourcemanager.appplatform.models.ResourceUploadDefinition;\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.UserSourceInfo;\n+import com.azure.resourcemanager.appplatform.models.UserSourceType;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.implementation.ExternalChildResourceImpl;\n+import com.azure.resourcemanager.resources.fluentcore.model.Indexable;\n+import com.azure.storage.file.share.ShareFileAsyncClient;\n+import com.azure.storage.file.share.ShareFileClientBuilder;\n+import org.apache.commons.compress.archivers.tar.TarArchiveEntry;\n+import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;\n+import org.apache.commons.compress.utils.IOUtils;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.zip.GZIPOutputStream;\n+\n+public class SpringAppDeploymentImpl\n+    extends ExternalChildResourceImpl<SpringAppDeployment, DeploymentResourceInner, SpringAppImpl, SpringApp>\n+    implements SpringAppDeployment, SpringAppDeployment.Definition, SpringAppDeployment.Update {\n+    private static final int BLOCK_SIZE = 4 * 1024 * 1024; // 4MB\n+    private final SpringAppDeploymentsImpl client;\n+    private SpringAppDeployment originalDeployment;\n+\n+    SpringAppDeploymentImpl(String name, SpringAppImpl parent,\n+                            DeploymentResourceInner innerObject, SpringAppDeploymentsImpl client) {\n+        super(name, parent, innerObject);\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public String appName() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().appName();\n+    }\n+\n+    @Override\n+    public DeploymentSettings settings() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().deploymentSettings();\n+    }\n+\n+    @Override\n+    public DeploymentResourceStatus status() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().status();\n+    }\n+\n+    @Override\n+    public boolean isActive() {\n+        if (inner().properties() == null) {\n+            return false;\n+        }\n+        return inner().properties().active();\n+    }\n+\n+    @Override\n+    public OffsetDateTime createdTime() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().createdTime();\n+    }\n+\n+    @Override\n+    public List<DeploymentInstance> instances() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().instances();\n+    }\n+\n+    @Override\n+    public String getLogFileUrl() {\n+        return getLogFileUrlAsync().block();\n+    }\n+\n+    @Override\n+    public Mono<String> getLogFileUrlAsync() {\n+        return manager().inner().getDeployments().getLogFileUrlAsync(\n+            parent().parent().resourceGroupName(), parent().parent().name(), parent().name(), name()\n+        )\n+            .map(LogFileUrlResponseInner::url);\n+    }\n+\n+    private void ensureDeploySettings() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().deploymentSettings() == null) {\n+            inner().properties().withDeploymentSettings(new DeploymentSettings());\n+        }\n+    }\n+\n+    private void ensureSource() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().source() == null) {\n+            inner().properties().withSource(new UserSourceInfo());\n+        }\n+    }\n+\n+    private File compressSource(File sourceFolder) throws IOException {\n+        File compressFile = File.createTempFile(\"java_package\", \"tar.gz\");\n+        try (TarArchiveOutputStream tarArchiveOutputStream = new TarArchiveOutputStream(\n+                 new GZIPOutputStream(new FileOutputStream(compressFile)))) {\n+            tarArchiveOutputStream.setLongFileMode(TarArchiveOutputStream.LONGFILE_GNU);\n+\n+            for (Path sourceFile : Files.walk(sourceFolder.toPath()).collect(Collectors.toList())) {\n+                String relativePath = sourceFolder.toPath().relativize(sourceFile).toString();\n+                TarArchiveEntry entry = new TarArchiveEntry(sourceFile.toFile(), relativePath);\n+                if (sourceFile.toFile().isFile()) {\n+                    try (InputStream inputStream = new FileInputStream(sourceFile.toFile())) {\n+                        tarArchiveOutputStream.putArchiveEntry(entry);\n+                        IOUtils.copy(inputStream, tarArchiveOutputStream);\n+                        tarArchiveOutputStream.closeArchiveEntry();\n+                    }\n+                } else {\n+                    tarArchiveOutputStream.putArchiveEntry(entry);\n+                    tarArchiveOutputStream.closeArchiveEntry();\n+                }\n+            }\n+        }\n+        return compressFile;\n+    }\n+\n+    private Mono<ShareFileAsyncClient> createShareFileAsyncClient(ResourceUploadDefinition option, long maxSize) {\n+        ShareFileAsyncClient shareFileAsyncClient = new ShareFileClientBuilder()\n+            .endpoint(option.uploadUrl())\n+            .httpClient(manager().httpPipeline().getHttpClient())\n+            .buildFileAsyncClient();\n+\n+        return shareFileAsyncClient.create(maxSize)\n+            .then(Mono.just(shareFileAsyncClient));\n+    }\n+\n+    private Mono<ShareFileAsyncClient> uploadToStorage(byte[] bytes, ResourceUploadDefinition option) {\n+        inner().properties().source().withRelativePath(option.relativePath());\n+        return createShareFileAsyncClient(option, bytes.length)\n+                .flatMap(shareFileAsyncClient -> {\n+                    List<Integer> blockList = new ArrayList<>();\n+                    for (int start = 0; start < bytes.length; start += BLOCK_SIZE) {\n+                        blockList.add(start);\n+                    }\n+                    return Flux.fromIterable(blockList)\n+                        .flatMap(start -> {\n+                            int length = Math.min(bytes.length - start, BLOCK_SIZE);\n+                            return shareFileAsyncClient.uploadWithResponse(\n+                                Flux.just(ByteBuffer.wrap(bytes, start, length)), length, (long) start);\n+                        })\n+                        .then(Mono.just(shareFileAsyncClient));\n+                });\n+    }\n+\n+    private Mono<ShareFileAsyncClient> uploadToStorage(File source, ResourceUploadDefinition option) {\n+        inner().properties().source().withRelativePath(option.relativePath());\n+        try {\n+            return createShareFileAsyncClient(option, source.length())\n+                .flatMap(shareFileAsyncClient -> shareFileAsyncClient.uploadFromFile(source.getAbsolutePath())\n+                    .then(Mono.just(shareFileAsyncClient)));\n+        } catch (Exception e) {\n+            return Mono.error(e);\n+        }\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withJarPath(File jar) {\n+        ensureSource();\n+        inner().properties().source().withType(UserSourceType.JAR);\n+        this.addDependency(\n+            context -> parent().getResourceUploadUrlAsync()\n+                .flatMap(option -> uploadToStorage(jar, option)\n+                    .then(context.voidMono()))\n+        );\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withJarFile(byte[] jar) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 212}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTQ0MDkw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442144090", "createdAt": "2020-07-03T04:51:04Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDo1MTowNFrOGsjoOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDo1MTowNFrOGsjoOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3NDI2Ng==", "bodyText": "Be clear on param, maybe better as sourceCodeFolder.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449374266", "createdAt": "2020-07-03T04:51:04Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/main/java/com/azure/resourcemanager/appplatform/implementation/SpringAppDeploymentImpl.java", "diffHunk": "@@ -0,0 +1,446 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform.implementation;\n+\n+import com.azure.resourcemanager.appplatform.AppPlatformManager;\n+import com.azure.resourcemanager.appplatform.fluent.inner.DeploymentResourceInner;\n+import com.azure.resourcemanager.appplatform.fluent.inner.LogFileUrlResponseInner;\n+import com.azure.resourcemanager.appplatform.models.DeploymentInstance;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceProperties;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceStatus;\n+import com.azure.resourcemanager.appplatform.models.DeploymentSettings;\n+import com.azure.resourcemanager.appplatform.models.ResourceUploadDefinition;\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.UserSourceInfo;\n+import com.azure.resourcemanager.appplatform.models.UserSourceType;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.implementation.ExternalChildResourceImpl;\n+import com.azure.resourcemanager.resources.fluentcore.model.Indexable;\n+import com.azure.storage.file.share.ShareFileAsyncClient;\n+import com.azure.storage.file.share.ShareFileClientBuilder;\n+import org.apache.commons.compress.archivers.tar.TarArchiveEntry;\n+import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;\n+import org.apache.commons.compress.utils.IOUtils;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.zip.GZIPOutputStream;\n+\n+public class SpringAppDeploymentImpl\n+    extends ExternalChildResourceImpl<SpringAppDeployment, DeploymentResourceInner, SpringAppImpl, SpringApp>\n+    implements SpringAppDeployment, SpringAppDeployment.Definition, SpringAppDeployment.Update {\n+    private static final int BLOCK_SIZE = 4 * 1024 * 1024; // 4MB\n+    private final SpringAppDeploymentsImpl client;\n+    private SpringAppDeployment originalDeployment;\n+\n+    SpringAppDeploymentImpl(String name, SpringAppImpl parent,\n+                            DeploymentResourceInner innerObject, SpringAppDeploymentsImpl client) {\n+        super(name, parent, innerObject);\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public String appName() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().appName();\n+    }\n+\n+    @Override\n+    public DeploymentSettings settings() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().deploymentSettings();\n+    }\n+\n+    @Override\n+    public DeploymentResourceStatus status() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().status();\n+    }\n+\n+    @Override\n+    public boolean isActive() {\n+        if (inner().properties() == null) {\n+            return false;\n+        }\n+        return inner().properties().active();\n+    }\n+\n+    @Override\n+    public OffsetDateTime createdTime() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().createdTime();\n+    }\n+\n+    @Override\n+    public List<DeploymentInstance> instances() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().instances();\n+    }\n+\n+    @Override\n+    public String getLogFileUrl() {\n+        return getLogFileUrlAsync().block();\n+    }\n+\n+    @Override\n+    public Mono<String> getLogFileUrlAsync() {\n+        return manager().inner().getDeployments().getLogFileUrlAsync(\n+            parent().parent().resourceGroupName(), parent().parent().name(), parent().name(), name()\n+        )\n+            .map(LogFileUrlResponseInner::url);\n+    }\n+\n+    private void ensureDeploySettings() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().deploymentSettings() == null) {\n+            inner().properties().withDeploymentSettings(new DeploymentSettings());\n+        }\n+    }\n+\n+    private void ensureSource() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().source() == null) {\n+            inner().properties().withSource(new UserSourceInfo());\n+        }\n+    }\n+\n+    private File compressSource(File sourceFolder) throws IOException {\n+        File compressFile = File.createTempFile(\"java_package\", \"tar.gz\");\n+        try (TarArchiveOutputStream tarArchiveOutputStream = new TarArchiveOutputStream(\n+                 new GZIPOutputStream(new FileOutputStream(compressFile)))) {\n+            tarArchiveOutputStream.setLongFileMode(TarArchiveOutputStream.LONGFILE_GNU);\n+\n+            for (Path sourceFile : Files.walk(sourceFolder.toPath()).collect(Collectors.toList())) {\n+                String relativePath = sourceFolder.toPath().relativize(sourceFile).toString();\n+                TarArchiveEntry entry = new TarArchiveEntry(sourceFile.toFile(), relativePath);\n+                if (sourceFile.toFile().isFile()) {\n+                    try (InputStream inputStream = new FileInputStream(sourceFile.toFile())) {\n+                        tarArchiveOutputStream.putArchiveEntry(entry);\n+                        IOUtils.copy(inputStream, tarArchiveOutputStream);\n+                        tarArchiveOutputStream.closeArchiveEntry();\n+                    }\n+                } else {\n+                    tarArchiveOutputStream.putArchiveEntry(entry);\n+                    tarArchiveOutputStream.closeArchiveEntry();\n+                }\n+            }\n+        }\n+        return compressFile;\n+    }\n+\n+    private Mono<ShareFileAsyncClient> createShareFileAsyncClient(ResourceUploadDefinition option, long maxSize) {\n+        ShareFileAsyncClient shareFileAsyncClient = new ShareFileClientBuilder()\n+            .endpoint(option.uploadUrl())\n+            .httpClient(manager().httpPipeline().getHttpClient())\n+            .buildFileAsyncClient();\n+\n+        return shareFileAsyncClient.create(maxSize)\n+            .then(Mono.just(shareFileAsyncClient));\n+    }\n+\n+    private Mono<ShareFileAsyncClient> uploadToStorage(byte[] bytes, ResourceUploadDefinition option) {\n+        inner().properties().source().withRelativePath(option.relativePath());\n+        return createShareFileAsyncClient(option, bytes.length)\n+                .flatMap(shareFileAsyncClient -> {\n+                    List<Integer> blockList = new ArrayList<>();\n+                    for (int start = 0; start < bytes.length; start += BLOCK_SIZE) {\n+                        blockList.add(start);\n+                    }\n+                    return Flux.fromIterable(blockList)\n+                        .flatMap(start -> {\n+                            int length = Math.min(bytes.length - start, BLOCK_SIZE);\n+                            return shareFileAsyncClient.uploadWithResponse(\n+                                Flux.just(ByteBuffer.wrap(bytes, start, length)), length, (long) start);\n+                        })\n+                        .then(Mono.just(shareFileAsyncClient));\n+                });\n+    }\n+\n+    private Mono<ShareFileAsyncClient> uploadToStorage(File source, ResourceUploadDefinition option) {\n+        inner().properties().source().withRelativePath(option.relativePath());\n+        try {\n+            return createShareFileAsyncClient(option, source.length())\n+                .flatMap(shareFileAsyncClient -> shareFileAsyncClient.uploadFromFile(source.getAbsolutePath())\n+                    .then(Mono.just(shareFileAsyncClient)));\n+        } catch (Exception e) {\n+            return Mono.error(e);\n+        }\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withJarPath(File jar) {\n+        ensureSource();\n+        inner().properties().source().withType(UserSourceType.JAR);\n+        this.addDependency(\n+            context -> parent().getResourceUploadUrlAsync()\n+                .flatMap(option -> uploadToStorage(jar, option)\n+                    .then(context.voidMono()))\n+        );\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withJarFile(byte[] jar) {\n+        ensureSource();\n+        inner().properties().source().withType(UserSourceType.JAR);\n+        this.addDependency(\n+            context -> parent().getResourceUploadUrlAsync()\n+                .flatMap(option -> uploadToStorage(jar, option)\n+                    .then(context.voidMono()))\n+        );\n+        return this;\n+    }\n+\n+    @Override\n+    public SpringAppDeploymentImpl withSourceCodeFolder(File sourceCode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 224}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTQ2NTI5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442146529", "createdAt": "2020-07-03T05:01:09Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNTowMTowOVrOGsjwPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNTowMTowOVrOGsjwPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3NjMxOQ==", "bodyText": "Check whether to use File.deleteOnExit ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449376319", "createdAt": "2020-07-03T05:01:09Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/main/java/com/azure/resourcemanager/appplatform/implementation/SpringAppDeploymentImpl.java", "diffHunk": "@@ -0,0 +1,446 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform.implementation;\n+\n+import com.azure.resourcemanager.appplatform.AppPlatformManager;\n+import com.azure.resourcemanager.appplatform.fluent.inner.DeploymentResourceInner;\n+import com.azure.resourcemanager.appplatform.fluent.inner.LogFileUrlResponseInner;\n+import com.azure.resourcemanager.appplatform.models.DeploymentInstance;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceProperties;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceStatus;\n+import com.azure.resourcemanager.appplatform.models.DeploymentSettings;\n+import com.azure.resourcemanager.appplatform.models.ResourceUploadDefinition;\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.UserSourceInfo;\n+import com.azure.resourcemanager.appplatform.models.UserSourceType;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.implementation.ExternalChildResourceImpl;\n+import com.azure.resourcemanager.resources.fluentcore.model.Indexable;\n+import com.azure.storage.file.share.ShareFileAsyncClient;\n+import com.azure.storage.file.share.ShareFileClientBuilder;\n+import org.apache.commons.compress.archivers.tar.TarArchiveEntry;\n+import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;\n+import org.apache.commons.compress.utils.IOUtils;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.zip.GZIPOutputStream;\n+\n+public class SpringAppDeploymentImpl\n+    extends ExternalChildResourceImpl<SpringAppDeployment, DeploymentResourceInner, SpringAppImpl, SpringApp>\n+    implements SpringAppDeployment, SpringAppDeployment.Definition, SpringAppDeployment.Update {\n+    private static final int BLOCK_SIZE = 4 * 1024 * 1024; // 4MB\n+    private final SpringAppDeploymentsImpl client;\n+    private SpringAppDeployment originalDeployment;\n+\n+    SpringAppDeploymentImpl(String name, SpringAppImpl parent,\n+                            DeploymentResourceInner innerObject, SpringAppDeploymentsImpl client) {\n+        super(name, parent, innerObject);\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public String appName() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().appName();\n+    }\n+\n+    @Override\n+    public DeploymentSettings settings() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().deploymentSettings();\n+    }\n+\n+    @Override\n+    public DeploymentResourceStatus status() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().status();\n+    }\n+\n+    @Override\n+    public boolean isActive() {\n+        if (inner().properties() == null) {\n+            return false;\n+        }\n+        return inner().properties().active();\n+    }\n+\n+    @Override\n+    public OffsetDateTime createdTime() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().createdTime();\n+    }\n+\n+    @Override\n+    public List<DeploymentInstance> instances() {\n+        if (inner().properties() == null) {\n+            return null;\n+        }\n+        return inner().properties().instances();\n+    }\n+\n+    @Override\n+    public String getLogFileUrl() {\n+        return getLogFileUrlAsync().block();\n+    }\n+\n+    @Override\n+    public Mono<String> getLogFileUrlAsync() {\n+        return manager().inner().getDeployments().getLogFileUrlAsync(\n+            parent().parent().resourceGroupName(), parent().parent().name(), parent().name(), name()\n+        )\n+            .map(LogFileUrlResponseInner::url);\n+    }\n+\n+    private void ensureDeploySettings() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().deploymentSettings() == null) {\n+            inner().properties().withDeploymentSettings(new DeploymentSettings());\n+        }\n+    }\n+\n+    private void ensureSource() {\n+        if (inner().properties() == null) {\n+            inner().withProperties(new DeploymentResourceProperties());\n+        }\n+        if (inner().properties().source() == null) {\n+            inner().properties().withSource(new UserSourceInfo());\n+        }\n+    }\n+\n+    private File compressSource(File sourceFolder) throws IOException {\n+        File compressFile = File.createTempFile(\"java_package\", \"tar.gz\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 137}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTQ3Mjkz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442147293", "createdAt": "2020-07-03T05:04:20Z", "commit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNTowNDoyMFrOGsjyuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNTowNDoyMFrOGsjyuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3Njk1Mw==", "bodyText": "If you only need the setting, it might be better to only cache the setting.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449376953", "createdAt": "2020-07-03T05:04:20Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/main/java/com/azure/resourcemanager/appplatform/implementation/SpringAppDeploymentImpl.java", "diffHunk": "@@ -0,0 +1,446 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform.implementation;\n+\n+import com.azure.resourcemanager.appplatform.AppPlatformManager;\n+import com.azure.resourcemanager.appplatform.fluent.inner.DeploymentResourceInner;\n+import com.azure.resourcemanager.appplatform.fluent.inner.LogFileUrlResponseInner;\n+import com.azure.resourcemanager.appplatform.models.DeploymentInstance;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceProperties;\n+import com.azure.resourcemanager.appplatform.models.DeploymentResourceStatus;\n+import com.azure.resourcemanager.appplatform.models.DeploymentSettings;\n+import com.azure.resourcemanager.appplatform.models.ResourceUploadDefinition;\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.UserSourceInfo;\n+import com.azure.resourcemanager.appplatform.models.UserSourceType;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.implementation.ExternalChildResourceImpl;\n+import com.azure.resourcemanager.resources.fluentcore.model.Indexable;\n+import com.azure.storage.file.share.ShareFileAsyncClient;\n+import com.azure.storage.file.share.ShareFileClientBuilder;\n+import org.apache.commons.compress.archivers.tar.TarArchiveEntry;\n+import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;\n+import org.apache.commons.compress.utils.IOUtils;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.zip.GZIPOutputStream;\n+\n+public class SpringAppDeploymentImpl\n+    extends ExternalChildResourceImpl<SpringAppDeployment, DeploymentResourceInner, SpringAppImpl, SpringApp>\n+    implements SpringAppDeployment, SpringAppDeployment.Definition, SpringAppDeployment.Update {\n+    private static final int BLOCK_SIZE = 4 * 1024 * 1024; // 4MB\n+    private final SpringAppDeploymentsImpl client;\n+    private SpringAppDeployment originalDeployment;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02ec9c9966ebbb06d92c46925a3a15011948baa"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdbf0e189f469ff3e2844dedbfc9d32bb737d060", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fdbf0e189f469ff3e2844dedbfc9d32bb737d060", "committedDate": "2020-07-03T05:23:47Z", "message": "seperate client creation and file creation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9dfa9c29c337ad1582ef5f6e946404f703afeba", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a9dfa9c29c337ad1582ef5f6e946404f703afeba", "committedDate": "2020-07-03T05:24:13Z", "message": "rename withCurrentActiveSetting to withSettingsFromActiveDeployment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5240c6ec975073a28f3a2854241ea418eb1c500f", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5240c6ec975073a28f3a2854241ea418eb1c500f", "committedDate": "2020-07-03T05:25:14Z", "message": "rename sourceCode param to sourceCodeFolder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c2dcbbda5b88b3f4778146513d51c60e6d616da", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8c2dcbbda5b88b3f4778146513d51c60e6d616da", "committedDate": "2020-07-03T05:35:08Z", "message": "remove deployment with byte[]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "748c0c840f6cf0b5f306622b5cb198ab8dba1507", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/748c0c840f6cf0b5f306622b5cb198ab8dba1507", "committedDate": "2020-07-03T05:39:37Z", "message": "align deployment update interface with definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6902850967ea69e09cb3ee5880973a8db448975d", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6902850967ea69e09cb3ee5880973a8db448975d", "committedDate": "2020-07-03T05:41:24Z", "message": "change deployment cache to settings cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3792a8d61af2ab635793902da9d365122b7bd5c6", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3792a8d61af2ab635793902da9d365122b7bd5c6", "committedDate": "2020-07-03T05:42:12Z", "message": "delete tmp file when exit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cc04b316e9e7de58c96e052a1ecd41558ea12d3", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5cc04b316e9e7de58c96e052a1ecd41558ea12d3", "committedDate": "2020-07-03T05:44:36Z", "message": "fix compile error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTYyOTA2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442162906", "createdAt": "2020-07-03T05:58:33Z", "commit": {"oid": "5cc04b316e9e7de58c96e052a1ecd41558ea12d3"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNTo1ODozNFrOGskl0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjoxMzo1NlrOGsk2Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5MDAzMw==", "bodyText": "Ideally this seems should be in another interface (seems not related to PublicEndpoint). Or maybe rename the interface name to something more generic?\nSimilar for update.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449390033", "createdAt": "2020-07-03T05:58:34Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/main/java/com/azure/resourcemanager/appplatform/models/SpringApp.java", "diffHunk": "@@ -0,0 +1,261 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform.models;\n+\n+import com.azure.core.annotation.Fluent;\n+import com.azure.core.implementation.annotation.Beta;\n+import com.azure.resourcemanager.appplatform.fluent.inner.AppResourceInner;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.ExternalChildResource;\n+import com.azure.resourcemanager.resources.fluentcore.model.Appliable;\n+import com.azure.resourcemanager.resources.fluentcore.model.Creatable;\n+import com.azure.resourcemanager.resources.fluentcore.model.HasInner;\n+import com.azure.resourcemanager.resources.fluentcore.model.Updatable;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.File;\n+import java.time.OffsetDateTime;\n+\n+/** An immutable client-side representation of an Azure Spring App. */\n+@Fluent\n+@Beta\n+public interface SpringApp\n+    extends ExternalChildResource<SpringApp, SpringService>,\n+        HasInner<AppResourceInner>,\n+        Updatable<SpringApp.Update> {\n+    /** @return whether the app exposes public endpoint */\n+    boolean isPublic();\n+\n+    /** @return whether only https is allowed for the app */\n+    boolean isHttpsOnly();\n+\n+    /** @return the url of the app */\n+    String url();\n+\n+    /** @return the temporary disk of the app */\n+    TemporaryDisk temporaryDisk();\n+\n+    /** @return the persistent disk of the app */\n+    PersistentDisk persistentDisk();\n+\n+    /** @return the identity property of the app */\n+    ManagedIdentityProperties identity();\n+\n+    /** @return the creation time of the app */\n+    OffsetDateTime createdTime();\n+\n+    /** @return the active deployment name */\n+    String activeDeployment();\n+\n+    /** @return the entry point of the spring app deployment */\n+    SpringAppDeployments deployments();\n+\n+    /** @return the blob url to upload deployment */\n+    Mono<ResourceUploadDefinition> getResourceUploadUrlAsync();\n+\n+    /** @return the blob url to upload deployment */\n+    ResourceUploadDefinition getResourceUploadUrl();\n+\n+    /** Container interface for all the definitions that need to be implemented. */\n+    interface Definition\n+        extends DefinitionStages.Blank { }\n+\n+    /** Grouping of all the spring app definition stages. */\n+    interface DefinitionStages {\n+        /** The first stage of the spring app definition. */\n+        interface Blank extends WithCreate { }\n+\n+        /** The stage of a spring app definition allowing to specify the public endpoint. */\n+        interface WithPublicEndpoint {\n+            /**\n+             * Enables the public endpoint for the spring app.\n+             * @return the next stage of spring app definition\n+             */\n+            WithCreate withPublicEndpoint();\n+\n+            /**\n+             * Specifies the custom domain for the spring app.\n+             * @param domain the domain name\n+             * @return the next stage of spring app definition\n+             */\n+            WithCreate withCustomDomain(String domain);\n+\n+            /**\n+             * Enables https only for the spring app.\n+             * @return the next stage of spring app definition\n+             */\n+            WithCreate withHttpsOnly();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cc04b316e9e7de58c96e052a1ecd41558ea12d3"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5MjM4MA==", "bodyText": "I think you need to close connection.getInputStream()\nMaybe close FileOutputStream as well.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449392380", "createdAt": "2020-07-03T06:07:21Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/test/java/com/azure/resourcemanager/appplatform/SpringCloudTest.java", "diffHunk": "@@ -0,0 +1,125 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform;\n+\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.SpringService;\n+import com.azure.resourcemanager.resources.fluentcore.arm.Region;\n+import com.azure.resourcemanager.resources.fluentcore.utils.SdkContext;\n+import org.apache.commons.compress.utils.IOUtils;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.net.HttpURLConnection;\n+import java.net.URL;\n+import java.net.URLConnection;\n+\n+public class SpringCloudTest extends AppPlatformTest {\n+\n+    SpringCloudTest() {\n+        super(RunCondition.LIVE_ONLY); // need storage data-plane and url check\n+    }\n+\n+    @Test\n+    public void canCRUDSpringAppWithDeployment() throws IOException {\n+        String serviceName = generateRandomResourceName(\"springsvc\", 15);\n+        String appName = \"gateway\";\n+        String deploymentName = generateRandomResourceName(\"deploy\", 15);\n+        String deploymentName1 = generateRandomResourceName(\"deploy\", 15);\n+\n+        SpringService service = appPlatformManager.springServices().define(serviceName)\n+            .withRegion(Region.US_EAST)\n+            .withNewResourceGroup(rgName)\n+            .withSku(\"B0\")\n+            .create();\n+\n+        Assertions.assertEquals(\"B0\", service.sku().name());\n+\n+        service.update()\n+            .withSku(\"S0\")\n+            .apply();\n+\n+        Assertions.assertEquals(\"S0\", service.sku().name());\n+\n+        service.update()\n+            .withGitUri(\"https://github.com/Azure-Samples/piggymetrics-config\")\n+            .apply();\n+        Assertions.assertEquals(\"https://github.com/Azure-Samples/piggymetrics-config\", service.serverProperties().configServer().gitProperty().uri());\n+\n+        File jarFile = new File(\"gateway.jar\");\n+        if (!jarFile.exists()) {\n+            URLConnection connection = new URL(\"https://github.com/weidongxu-microsoft/azure-sdk-for-java-management-tests/raw/master/spring-cloud/gateway.jar\").openConnection();\n+            connection.connect();\n+            IOUtils.copy(connection.getInputStream(), new FileOutputStream(jarFile));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cc04b316e9e7de58c96e052a1ecd41558ea12d3"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5MzQxMA==", "bodyText": "Need to close it somewhere.\nhttps://docs.oracle.com/javase/7/docs/api/java/net/HttpURLConnection.html#disconnect()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449393410", "createdAt": "2020-07-03T06:11:06Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/test/java/com/azure/resourcemanager/appplatform/SpringCloudTest.java", "diffHunk": "@@ -0,0 +1,125 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform;\n+\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.SpringService;\n+import com.azure.resourcemanager.resources.fluentcore.arm.Region;\n+import com.azure.resourcemanager.resources.fluentcore.utils.SdkContext;\n+import org.apache.commons.compress.utils.IOUtils;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.net.HttpURLConnection;\n+import java.net.URL;\n+import java.net.URLConnection;\n+\n+public class SpringCloudTest extends AppPlatformTest {\n+\n+    SpringCloudTest() {\n+        super(RunCondition.LIVE_ONLY); // need storage data-plane and url check\n+    }\n+\n+    @Test\n+    public void canCRUDSpringAppWithDeployment() throws IOException {\n+        String serviceName = generateRandomResourceName(\"springsvc\", 15);\n+        String appName = \"gateway\";\n+        String deploymentName = generateRandomResourceName(\"deploy\", 15);\n+        String deploymentName1 = generateRandomResourceName(\"deploy\", 15);\n+\n+        SpringService service = appPlatformManager.springServices().define(serviceName)\n+            .withRegion(Region.US_EAST)\n+            .withNewResourceGroup(rgName)\n+            .withSku(\"B0\")\n+            .create();\n+\n+        Assertions.assertEquals(\"B0\", service.sku().name());\n+\n+        service.update()\n+            .withSku(\"S0\")\n+            .apply();\n+\n+        Assertions.assertEquals(\"S0\", service.sku().name());\n+\n+        service.update()\n+            .withGitUri(\"https://github.com/Azure-Samples/piggymetrics-config\")\n+            .apply();\n+        Assertions.assertEquals(\"https://github.com/Azure-Samples/piggymetrics-config\", service.serverProperties().configServer().gitProperty().uri());\n+\n+        File jarFile = new File(\"gateway.jar\");\n+        if (!jarFile.exists()) {\n+            URLConnection connection = new URL(\"https://github.com/weidongxu-microsoft/azure-sdk-for-java-management-tests/raw/master/spring-cloud/gateway.jar\").openConnection();\n+            connection.connect();\n+            IOUtils.copy(connection.getInputStream(), new FileOutputStream(jarFile));\n+        }\n+\n+        SpringApp app = service.apps().define(appName)\n+            .withPublicEndpoint()\n+            .create();\n+\n+        Assertions.assertNotNull(app.url());\n+        Assertions.assertNotNull(app.activeDeployment());\n+\n+        Assertions.assertTrue(requestSuccess(app.url()));\n+\n+        app.update()\n+            .withoutDeployment(app.activeDeployment())\n+            .deployJar(deploymentName, jarFile)\n+            .apply();\n+\n+        Assertions.assertNotNull(app.url());\n+        Assertions.assertEquals(deploymentName, app.activeDeployment());\n+\n+        Assertions.assertTrue(requestSuccess(app.url()));\n+\n+        SpringAppDeployment deployment = app.deployments().getByName(app.activeDeployment());\n+        deployment.update()\n+            .withCpu(2)\n+            .withMemory(4)\n+            .withRuntime(RuntimeVersion.JAVA_11)\n+            .withInstance(2)\n+            .apply();\n+\n+        Assertions.assertEquals(2, deployment.settings().cpu());\n+        Assertions.assertEquals(4, deployment.settings().memoryInGB());\n+        Assertions.assertEquals(RuntimeVersion.JAVA_11, deployment.settings().runtimeVersion());\n+        Assertions.assertEquals(2, deployment.instances().size());\n+\n+        deployment = app.deployments().define(deploymentName1)\n+            .withSourceCodeFolder(new File(this.getClass().getResource(\"/piggymetrics\").getFile()))\n+            .withTargetModule(\"gateway\")\n+            .withSettingsFromActiveDeployment()\n+            .activate()\n+            .create();\n+        app.refresh();\n+\n+        Assertions.assertEquals(deploymentName1, app.activeDeployment());\n+        Assertions.assertEquals(2, deployment.settings().cpu());\n+        Assertions.assertNotNull(deployment.getLogFileUrl());\n+\n+        Assertions.assertTrue(requestSuccess(app.url()));\n+\n+        app.update()\n+            .withoutPublicEndpoint()\n+            .apply();\n+        Assertions.assertFalse(app.isPublic());\n+    }\n+\n+    private boolean requestSuccess(String url) throws IOException {\n+        for (int i = 0; i < 60; ++i) {\n+            HttpURLConnection connection = (HttpURLConnection) new URL(url).openConnection();\n+            connection.connect();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cc04b316e9e7de58c96e052a1ecd41558ea12d3"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5NDI0Ng==", "bodyText": "Is there a way to verify that this deployment is deleted?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#discussion_r449394246", "createdAt": "2020-07-03T06:13:56Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/appplatform/mgmt/src/test/java/com/azure/resourcemanager/appplatform/SpringCloudTest.java", "diffHunk": "@@ -0,0 +1,125 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appplatform;\n+\n+import com.azure.resourcemanager.appplatform.models.RuntimeVersion;\n+import com.azure.resourcemanager.appplatform.models.SpringApp;\n+import com.azure.resourcemanager.appplatform.models.SpringAppDeployment;\n+import com.azure.resourcemanager.appplatform.models.SpringService;\n+import com.azure.resourcemanager.resources.fluentcore.arm.Region;\n+import com.azure.resourcemanager.resources.fluentcore.utils.SdkContext;\n+import org.apache.commons.compress.utils.IOUtils;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.net.HttpURLConnection;\n+import java.net.URL;\n+import java.net.URLConnection;\n+\n+public class SpringCloudTest extends AppPlatformTest {\n+\n+    SpringCloudTest() {\n+        super(RunCondition.LIVE_ONLY); // need storage data-plane and url check\n+    }\n+\n+    @Test\n+    public void canCRUDSpringAppWithDeployment() throws IOException {\n+        String serviceName = generateRandomResourceName(\"springsvc\", 15);\n+        String appName = \"gateway\";\n+        String deploymentName = generateRandomResourceName(\"deploy\", 15);\n+        String deploymentName1 = generateRandomResourceName(\"deploy\", 15);\n+\n+        SpringService service = appPlatformManager.springServices().define(serviceName)\n+            .withRegion(Region.US_EAST)\n+            .withNewResourceGroup(rgName)\n+            .withSku(\"B0\")\n+            .create();\n+\n+        Assertions.assertEquals(\"B0\", service.sku().name());\n+\n+        service.update()\n+            .withSku(\"S0\")\n+            .apply();\n+\n+        Assertions.assertEquals(\"S0\", service.sku().name());\n+\n+        service.update()\n+            .withGitUri(\"https://github.com/Azure-Samples/piggymetrics-config\")\n+            .apply();\n+        Assertions.assertEquals(\"https://github.com/Azure-Samples/piggymetrics-config\", service.serverProperties().configServer().gitProperty().uri());\n+\n+        File jarFile = new File(\"gateway.jar\");\n+        if (!jarFile.exists()) {\n+            URLConnection connection = new URL(\"https://github.com/weidongxu-microsoft/azure-sdk-for-java-management-tests/raw/master/spring-cloud/gateway.jar\").openConnection();\n+            connection.connect();\n+            IOUtils.copy(connection.getInputStream(), new FileOutputStream(jarFile));\n+        }\n+\n+        SpringApp app = service.apps().define(appName)\n+            .withPublicEndpoint()\n+            .create();\n+\n+        Assertions.assertNotNull(app.url());\n+        Assertions.assertNotNull(app.activeDeployment());\n+\n+        Assertions.assertTrue(requestSuccess(app.url()));\n+\n+        app.update()\n+            .withoutDeployment(app.activeDeployment())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cc04b316e9e7de58c96e052a1ecd41558ea12d3"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTcwNDIz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442170423", "createdAt": "2020-07-03T06:19:40Z", "commit": {"oid": "5cc04b316e9e7de58c96e052a1ecd41558ea12d3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a5097840f4a4f74510fa6057301be2d986fd9c6", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1a5097840f4a4f74510fa6057301be2d986fd9c6", "committedDate": "2020-07-03T06:56:07Z", "message": "change WithPublicEndpoint to WithEndpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99348c290ebacff2bdad36dbe9963a402a7167f2", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/99348c290ebacff2bdad36dbe9963a402a7167f2", "committedDate": "2020-07-03T07:24:26Z", "message": "change sourceCode to sourceCodeFolder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5c6d72a720aa3ca21943859fd58da830da6d802", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c5c6d72a720aa3ca21943859fd58da830da6d802", "committedDate": "2020-07-03T07:43:24Z", "message": "close inputstream and disconnect url connection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ab3f390cca10e0e3f316fee9a80c3f5413c2e97", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7ab3f390cca10e0e3f316fee9a80c3f5413c2e97", "committedDate": "2020-07-03T07:44:43Z", "message": "check deployment removed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d2182875d83e145e993cccb2655c9f556a0cf3e", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4d2182875d83e145e993cccb2655c9f556a0cf3e", "committedDate": "2020-07-03T08:18:05Z", "message": "remove resource code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3178cad11017a009741f3e9ed3118da036b5d497", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3178cad11017a009741f3e9ed3118da036b5d497", "committedDate": "2020-07-03T09:20:34Z", "message": "decompress source code from github"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMjc3NjUy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442277652", "createdAt": "2020-07-03T09:25:08Z", "commit": {"oid": "3178cad11017a009741f3e9ed3118da036b5d497"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77668abc8e48e325e528b2e299a1f428ee2e15e9", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/77668abc8e48e325e528b2e299a1f428ee2e15e9", "committedDate": "2020-07-06T05:23:09Z", "message": "update gitignore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44411e15dd743852565f0692946e5a0bfca3e2d4", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/44411e15dd743852565f0692946e5a0bfca3e2d4", "committedDate": "2020-07-06T05:59:28Z", "message": "change activate in deployment to withActivation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyODE1MzIx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12350#pullrequestreview-442815321", "createdAt": "2020-07-06T06:55:40Z", "commit": {"oid": "44411e15dd743852565f0692946e5a0bfca3e2d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa243e04de356eefc437f5ff825e70b0f6252bad", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/aa243e04de356eefc437f5ff825e70b0f6252bad", "committedDate": "2020-07-06T07:51:38Z", "message": "fix compile error"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2989, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}