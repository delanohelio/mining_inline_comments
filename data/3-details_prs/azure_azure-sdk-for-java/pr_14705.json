{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3NDA1MDA1", "number": 14705, "title": "Update LockRenewalOperation API", "bodyText": "Moves LockRenewalOperation back into a package-private API.\nUpdates tests.\n\nFixes #14275", "createdAt": "2020-09-02T00:03:34Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14705", "merged": true, "mergeCommit": {"oid": "a50c4f09aeb0d578c9fa14223061ca51fa94cbab"}, "closed": true, "closedAt": "2020-09-04T15:26:27Z", "author": {"login": "conniey"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFWAeMgFqTQ4MjE0MjkzNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFgo99ABqjM3Mjg1MTQxODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMTQyOTM1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14705#pullrequestreview-482142935", "createdAt": "2020-09-03T19:33:33Z", "commit": {"oid": "59dd155bbc2839c91f92073d5c6f93488540b3e9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxOTozMzozM1rOHM0ujg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxOTozMzozM1rOHM0ujg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIwODg0Ng==", "bodyText": "Is this duration to cache should be configuration by user ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14705#discussion_r483208846", "createdAt": "2020-09-03T19:33:33Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/LockRenewalOperation.java", "diffHunk": "@@ -53,35 +53,63 @@\n      * Creates a new lock renewal operation.\n      *\n      * @param lockToken Lock or session id to renew.\n-     * @param lockedUntil The initial period the message or session is locked until.\n+     * @param tokenLockedUntil The initial period the message or session is locked until.\n      * @param maxLockRenewalDuration The maximum duration this lock should be renewed.\n      * @param isSession Whether the lock represents a session lock or message lock.\n      * @param renewalOperation The renewal operation to call.\n      */\n     LockRenewalOperation(String lockToken, Duration maxLockRenewalDuration, boolean isSession,\n-        Function<String, Mono<OffsetDateTime>> renewalOperation, OffsetDateTime lockedUntil) {\n+        Function<String, Mono<OffsetDateTime>> renewalOperation, OffsetDateTime tokenLockedUntil) {\n         this.lockToken = Objects.requireNonNull(lockToken, \"'lockToken' cannot be null.\");\n         this.renewalOperation = Objects.requireNonNull(renewalOperation, \"'renewalOperation' cannot be null.\");\n         this.isSession = isSession;\n \n-        Objects.requireNonNull(lockedUntil, \"'lockedUntil cannot be null.'\");\n+        Objects.requireNonNull(tokenLockedUntil, \"'lockedUntil cannot be null.'\");\n         Objects.requireNonNull(maxLockRenewalDuration, \"'maxLockRenewalDuration' cannot be null.\");\n \n         if (maxLockRenewalDuration.isNegative()) {\n-            throw logger.logThrowableAsError(new IllegalArgumentException(\n+            throw logger.logExceptionAsError(new IllegalArgumentException(\n                 \"'maxLockRenewalDuration' cannot be negative.\"));\n         }\n \n-        this.lockedUntil.set(lockedUntil);\n-        this.subscription = getRenewLockOperation(lockedUntil, maxLockRenewalDuration);\n+        this.lockedUntil.set(tokenLockedUntil);\n+\n+        final Flux<OffsetDateTime> renewLockOperation = getRenewLockOperation(tokenLockedUntil,\n+            maxLockRenewalDuration)\n+            .takeUntilOther(cancellationProcessor)\n+            .cache(Duration.ofMinutes(2));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59dd155bbc2839c91f92073d5c6f93488540b3e9"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e2de6d3cea79b4ef5ebaba7280d26a2e7324134", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8e2de6d3cea79b4ef5ebaba7280d26a2e7324134", "committedDate": "2020-09-04T08:01:32Z", "message": "Removing public from LockRenewalOperation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aad313f93b0b2c3997362d5d294b4a6f6c82b6a3", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/aad313f93b0b2c3997362d5d294b4a6f6c82b6a3", "committedDate": "2020-09-04T08:01:33Z", "message": "Update LockRenewalOperation to return a completion Mono."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d08cef73dfe5492f4a71f03e50f67ddcac056d39", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d08cef73dfe5492f4a71f03e50f67ddcac056d39", "committedDate": "2020-09-04T08:01:33Z", "message": "Updating lockrenewal operation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c83db7ed672bdfa3ffec7beecc458348d966446f", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c83db7ed672bdfa3ffec7beecc458348d966446f", "committedDate": "2020-09-04T08:02:42Z", "message": "Fixing tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffb219e0d2bb4aa0c153aea9bcf3a89663c394a8", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ffb219e0d2bb4aa0c153aea9bcf3a89663c394a8", "committedDate": "2020-09-04T08:02:44Z", "message": "Fix conflicting names in LockRenewalOperation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c6eabfb4898fc9e3d6912a1f31038f893f35a79", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0c6eabfb4898fc9e3d6912a1f31038f893f35a79", "committedDate": "2020-09-04T08:02:44Z", "message": "Fix test breaks in ServiceBusReceiverAsyncClientTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18467b455abd60b3a32338a0c8bc9711d7ee140e", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/18467b455abd60b3a32338a0c8bc9711d7ee140e", "committedDate": "2020-09-04T08:02:45Z", "message": "Caching response from Flux so it is not reinvoked."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9da915cf0a1ec3ee7f15b461f4e5e320d2bf93d8", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9da915cf0a1ec3ee7f15b461f4e5e320d2bf93d8", "committedDate": "2020-09-04T08:02:45Z", "message": "Removing unused variables in test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a246917179b9d2d35e6b891f1ff85c53429bd0bd", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a246917179b9d2d35e6b891f1ff85c53429bd0bd", "committedDate": "2020-09-04T08:02:45Z", "message": "Fixing tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95c2ebb98dd3111163acdf2d920d6a41ab7e9653", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/95c2ebb98dd3111163acdf2d920d6a41ab7e9653", "committedDate": "2020-09-04T08:03:56Z", "message": "Adding sync tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c7b888fc8bb038b0c8500118f4d1f4d8d8b5f04", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4c7b888fc8bb038b0c8500118f4d1f4d8d8b5f04", "committedDate": "2020-09-04T08:03:58Z", "message": "Adding javadoc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c164d8b9a378ac29986c6a3287af2a24fac141d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1c164d8b9a378ac29986c6a3287af2a24fac141d", "committedDate": "2020-09-04T08:03:58Z", "message": "Fix checkstyles."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be888bd0cf06b82da958464ec8a833e28be78cac", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/be888bd0cf06b82da958464ec8a833e28be78cac", "committedDate": "2020-09-04T08:03:59Z", "message": "Fix spotbugs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59dd155bbc2839c91f92073d5c6f93488540b3e9", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/59dd155bbc2839c91f92073d5c6f93488540b3e9", "committedDate": "2020-09-02T17:52:32Z", "message": "Fix spotbugs."}, "afterCommit": {"oid": "be888bd0cf06b82da958464ec8a833e28be78cac", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/be888bd0cf06b82da958464ec8a833e28be78cac", "committedDate": "2020-09-04T08:03:59Z", "message": "Fix spotbugs."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 43, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}