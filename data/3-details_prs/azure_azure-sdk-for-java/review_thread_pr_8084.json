{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMzAyODYx", "number": 8084, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDozMDo0N1rODemImg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMTowMTo0N1rODemsjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNDA4NjY2OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDozMDo0N1rOFn0h0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNzozMjo0NVrOFoSVuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5OTQxMQ==", "bodyText": "this will result in double serialization/deserialization. don't use Document here.\nplease use 'String content = toJsonString(typedDocument, mapper);' instead", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8084#discussion_r377299411", "createdAt": "2020-02-10T20:30:47Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "diffHunk": "@@ -1151,27 +1157,28 @@ void captureSessionToken(RxDocumentServiceRequest request, RxDocumentServiceResp\n             requestRetryPolicy = new PartitionKeyMismatchRetryPolicy(collectionCache, requestRetryPolicy, collectionLink, options);\n         }\n         DocumentClientRetryPolicy finalRequestRetryPolicy = requestRetryPolicy;\n-        if (document == null) {\n-            throw new IllegalArgumentException(\"document\");\n-        }\n-        if (StringUtils.isEmpty(documentLink)) {\n-            throw new IllegalArgumentException(\"documentLink\");\n-        }\n+        return ObservableHelper.inlineIfPossibleAsObs(() -> replaceDocumentInternal(documentLink, document, options, finalRequestRetryPolicy), requestRetryPolicy);\n+    }\n \n-        if (document == null) {\n-            throw new IllegalArgumentException(\"document\");\n-        }\n+    private Mono<ResourceResponse<Document>> replaceDocumentInternal(String documentLink, Object document,\n+                                                                     RequestOptions options, DocumentClientRetryPolicy retryPolicyInstance) {\n+        try {\n+            if (StringUtils.isEmpty(documentLink)) {\n+                throw new IllegalArgumentException(\"documentLink\");\n+            }\n \n-        Document typedDocument = documentFromObject(document, mapper);\n-        logger.debug(\"Replacing a Document. documentLink: [{}]\", documentLink);\n-        final String path = Utils.joinPath(documentLink, null);\n-        final Map<String, String> requestHeaders = getRequestHeaders(options);\n+            if (document == null) {\n+                throw new IllegalArgumentException(\"document\");\n+            }\n \n-        String content = toJsonString(typedDocument, mapper);\n+            Document typedDocument = documentFromObject(document, mapper);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2b5690edb85e18ef31d2d17c2b90080d79c7944"}, "originalPosition": 446}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc4NzgzMw==", "bodyText": "Discussed this offline, it was there before the retryContext pr, so keeping the same for now", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8084#discussion_r377787833", "createdAt": "2020-02-11T17:32:45Z", "author": {"login": "simplynaveen20"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "diffHunk": "@@ -1151,27 +1157,28 @@ void captureSessionToken(RxDocumentServiceRequest request, RxDocumentServiceResp\n             requestRetryPolicy = new PartitionKeyMismatchRetryPolicy(collectionCache, requestRetryPolicy, collectionLink, options);\n         }\n         DocumentClientRetryPolicy finalRequestRetryPolicy = requestRetryPolicy;\n-        if (document == null) {\n-            throw new IllegalArgumentException(\"document\");\n-        }\n-        if (StringUtils.isEmpty(documentLink)) {\n-            throw new IllegalArgumentException(\"documentLink\");\n-        }\n+        return ObservableHelper.inlineIfPossibleAsObs(() -> replaceDocumentInternal(documentLink, document, options, finalRequestRetryPolicy), requestRetryPolicy);\n+    }\n \n-        if (document == null) {\n-            throw new IllegalArgumentException(\"document\");\n-        }\n+    private Mono<ResourceResponse<Document>> replaceDocumentInternal(String documentLink, Object document,\n+                                                                     RequestOptions options, DocumentClientRetryPolicy retryPolicyInstance) {\n+        try {\n+            if (StringUtils.isEmpty(documentLink)) {\n+                throw new IllegalArgumentException(\"documentLink\");\n+            }\n \n-        Document typedDocument = documentFromObject(document, mapper);\n-        logger.debug(\"Replacing a Document. documentLink: [{}]\", documentLink);\n-        final String path = Utils.joinPath(documentLink, null);\n-        final Map<String, String> requestHeaders = getRequestHeaders(options);\n+            if (document == null) {\n+                throw new IllegalArgumentException(\"document\");\n+            }\n \n-        String content = toJsonString(typedDocument, mapper);\n+            Document typedDocument = documentFromObject(document, mapper);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5OTQxMQ=="}, "originalCommit": {"oid": "c2b5690edb85e18ef31d2d17c2b90080d79c7944"}, "originalPosition": 446}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNDE3ODcwOnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMTowMTo0N1rOFn1bSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMTozODowM1rOFn2e_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzMxNDEyMQ==", "bodyText": "We are not using Document here anymore as this will result in double serialization/desrializaiton.\nreplace with\nString content = toJsonString(typedDocument, mapper);", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8084#discussion_r377314121", "createdAt": "2020-02-10T21:01:47Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "diffHunk": "@@ -1151,27 +1157,28 @@ void captureSessionToken(RxDocumentServiceRequest request, RxDocumentServiceResp\n             requestRetryPolicy = new PartitionKeyMismatchRetryPolicy(collectionCache, requestRetryPolicy, collectionLink, options);\n         }\n         DocumentClientRetryPolicy finalRequestRetryPolicy = requestRetryPolicy;\n-        if (document == null) {\n-            throw new IllegalArgumentException(\"document\");\n-        }\n-        if (StringUtils.isEmpty(documentLink)) {\n-            throw new IllegalArgumentException(\"documentLink\");\n-        }\n+        return ObservableHelper.inlineIfPossibleAsObs(() -> replaceDocumentInternal(documentLink, document, options, finalRequestRetryPolicy), requestRetryPolicy);\n+    }\n \n-        if (document == null) {\n-            throw new IllegalArgumentException(\"document\");\n-        }\n+    private Mono<ResourceResponse<Document>> replaceDocumentInternal(String documentLink, Object document,\n+                                                                     RequestOptions options, DocumentClientRetryPolicy retryPolicyInstance) {\n+        try {\n+            if (StringUtils.isEmpty(documentLink)) {\n+                throw new IllegalArgumentException(\"documentLink\");\n+            }\n \n-        Document typedDocument = documentFromObject(document, mapper);\n-        logger.debug(\"Replacing a Document. documentLink: [{}]\", documentLink);\n-        final String path = Utils.joinPath(documentLink, null);\n-        final Map<String, String> requestHeaders = getRequestHeaders(options);\n+            if (document == null) {\n+                throw new IllegalArgumentException(\"document\");\n+            }\n \n-        String content = toJsonString(typedDocument, mapper);\n+            Document typedDocument = documentFromObject(document, mapper);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2b5690edb85e18ef31d2d17c2b90080d79c7944"}, "originalPosition": 446}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzMzMTQ1Mw==", "bodyText": "Discussed this offline, it was there before the retryContext pr, so keeping the same for now", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8084#discussion_r377331453", "createdAt": "2020-02-10T21:38:03Z", "author": {"login": "simplynaveen20"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "diffHunk": "@@ -1151,27 +1157,28 @@ void captureSessionToken(RxDocumentServiceRequest request, RxDocumentServiceResp\n             requestRetryPolicy = new PartitionKeyMismatchRetryPolicy(collectionCache, requestRetryPolicy, collectionLink, options);\n         }\n         DocumentClientRetryPolicy finalRequestRetryPolicy = requestRetryPolicy;\n-        if (document == null) {\n-            throw new IllegalArgumentException(\"document\");\n-        }\n-        if (StringUtils.isEmpty(documentLink)) {\n-            throw new IllegalArgumentException(\"documentLink\");\n-        }\n+        return ObservableHelper.inlineIfPossibleAsObs(() -> replaceDocumentInternal(documentLink, document, options, finalRequestRetryPolicy), requestRetryPolicy);\n+    }\n \n-        if (document == null) {\n-            throw new IllegalArgumentException(\"document\");\n-        }\n+    private Mono<ResourceResponse<Document>> replaceDocumentInternal(String documentLink, Object document,\n+                                                                     RequestOptions options, DocumentClientRetryPolicy retryPolicyInstance) {\n+        try {\n+            if (StringUtils.isEmpty(documentLink)) {\n+                throw new IllegalArgumentException(\"documentLink\");\n+            }\n \n-        Document typedDocument = documentFromObject(document, mapper);\n-        logger.debug(\"Replacing a Document. documentLink: [{}]\", documentLink);\n-        final String path = Utils.joinPath(documentLink, null);\n-        final Map<String, String> requestHeaders = getRequestHeaders(options);\n+            if (document == null) {\n+                throw new IllegalArgumentException(\"document\");\n+            }\n \n-        String content = toJsonString(typedDocument, mapper);\n+            Document typedDocument = documentFromObject(document, mapper);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzMxNDEyMQ=="}, "originalCommit": {"oid": "c2b5690edb85e18ef31d2d17c2b90080d79c7944"}, "originalPosition": 446}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3171, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}