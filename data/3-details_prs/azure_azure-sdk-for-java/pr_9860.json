{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4NDA5MjIy", "number": 9860, "title": "Fixes issues in auto-* operations", "bodyText": "Removes isAutoComplete, isAutoLockRenew, and maxAutoLockRenewDuration into ReceiveAsyncOptions\nAdds overload for receive(ReceiveAsyncOptions)\nFixes logic in maxAutoLockRenewDuration.\nChanges all UUID to Strings except for ManagementChannel to save multiple conversion operations.\n\nFixes #9795\nFixes #9785", "createdAt": "2020-04-03T22:13:04Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9860", "merged": true, "mergeCommit": {"oid": "f0f987b8365e59436bcac189f66b59395088d3c6"}, "closed": true, "closedAt": "2020-04-06T18:44:06Z", "author": {"login": "conniey"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUId4ngFqTM4NzYxMTI2MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVCnF2AH2gAyMzk4NDA5MjIyOjE1M2Q0OGYzM2VlOTNjZDYwMTAwMDNjZTNmOWM1YjJmMzRlMDUxOGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjExMjYw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9860#pullrequestreview-387611260", "createdAt": "2020-04-03T22:16:27Z", "commit": {"oid": "ed4312eaafaaeb0990cc3f064a0b36b781f73950"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMjoxNjoyN1rOGArSYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMjoxNjoyN1rOGArSYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MjQwMw==", "bodyText": "Package-private class renamed from ReceiveMessageOptions.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9860#discussion_r403362403", "createdAt": "2020-04-03T22:16:27Z", "author": {"login": "conniey"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ReceiverOptions.java", "diffHunk": "@@ -0,0 +1,37 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed4312eaafaaeb0990cc3f064a0b36b781f73950"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a484e71acaaa55a0257b697eca2bf80d372d1ff", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1a484e71acaaa55a0257b697eca2bf80d372d1ff", "committedDate": "2020-04-03T23:12:02Z", "message": "Remove build breaks."}, "afterCommit": {"oid": "623699f6aa34f37212109aee10c0d9a7d7a5d3c3", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/623699f6aa34f37212109aee10c0d9a7d7a5d3c3", "committedDate": "2020-04-04T18:41:33Z", "message": "Fix tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzMxMzE4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9860#pullrequestreview-387731318", "createdAt": "2020-04-04T20:16:44Z", "commit": {"oid": "623699f6aa34f37212109aee10c0d9a7d7a5d3c3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQyMDoxNjo0NFrOGA0bcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQyMDozODoyNVrOGA0jlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUxMjE3OA==", "bodyText": "May be explaining here that  To disable auto-renew, user have to set MaxAutoRenewDuration to zero. And default is true", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9860#discussion_r403512178", "createdAt": "2020-04-04T20:16:44Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClient.java", "diffHunk": "@@ -346,25 +353,44 @@ public String getEntityPath() {\n     }\n \n     /**\n-     * Receives a stream of {@link ServiceBusReceivedMessage messages} from the Service Bus entity.\n+     * Receives a stream of {@link ServiceBusReceivedMessage messages} from the Service Bus entity and completes them\n+     * when they are finished processing.\n      *\n      * @return A stream of messages from the Service Bus entity.\n      */\n     public Flux<ServiceBusReceivedMessage> receive() {\n+        return receive(defaultReceiveOptions);\n+    }\n+\n+    /**\n+     * Receives a stream of {@link ServiceBusReceivedMessage messages} from the Service Bus entity.\n+     *\n+     * @return A stream of messages from the Service Bus entity.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "623699f6aa34f37212109aee10c0d9a7d7a5d3c3"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUxNDI2Mg==", "bodyText": "One option could be calculate isAutoRenewLock here using maxAutoLockRenewal value and  remove this argument isAutoRenewLock being passed in. But  it is not must.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9860#discussion_r403514262", "createdAt": "2020-04-04T20:38:25Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusMessageProcessor.java", "diffHunk": "@@ -34,24 +42,26 @@\n     private final ClientLogger logger = new ClientLogger(ServiceBusMessageProcessor.class);\n     private final boolean isAutoComplete;\n     private final AmqpRetryOptions retryOptions;\n-    private final Function<ServiceBusReceivedMessage, Mono<Void>> completeFunction;\n-    private final Function<ServiceBusReceivedMessage, Mono<Void>> onAbandon;\n-    private final Function<ServiceBusReceivedMessage, Mono<Instant>> onRenewLock;\n+    private final AmqpErrorContext errorContext;\n+    private final Function<MessageLockToken, Mono<Void>> completeFunction;\n+    private final Function<MessageLockToken, Mono<Void>> onAbandon;\n+    private final Function<MessageLockToken, Mono<Instant>> onRenewLock;\n     private final Deque<ServiceBusReceivedMessage> messageQueue = new ConcurrentLinkedDeque<>();\n     private final boolean isAutoRenewLock;\n     private final Duration maxAutoLockRenewal;\n     private final MessageLockContainer messageLockContainer;\n \n     ServiceBusMessageProcessor(boolean isAutoComplete, boolean isAutoRenewLock, Duration maxAutoLockRenewal,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "623699f6aa34f37212109aee10c0d9a7d7a5d3c3"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzYyMTM1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9860#pullrequestreview-387762135", "createdAt": "2020-04-04T21:56:35Z", "commit": {"oid": "fa78b6847f8bcd043ff615dc7c87ad3ac71e8a0d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa78b6847f8bcd043ff615dc7c87ad3ac71e8a0d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fa78b6847f8bcd043ff615dc7c87ad3ac71e8a0d", "committedDate": "2020-04-04T21:40:29Z", "message": "Add documentation."}, "afterCommit": {"oid": "6459a3269b2902e0299b32dd76be5bbeaf4ecdd9", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6459a3269b2902e0299b32dd76be5bbeaf4ecdd9", "committedDate": "2020-04-04T22:05:16Z", "message": "Add documentation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODY5MDE2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9860#pullrequestreview-387869016", "createdAt": "2020-04-05T22:35:47Z", "commit": {"oid": "6459a3269b2902e0299b32dd76be5bbeaf4ecdd9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMjozNTo0OFrOGBD9WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMjozNTo0OFrOGBD9WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc2NjYxNg==", "bodyText": "While  you are changing this to String, you can look at receiveDeferredMessage , there is a problem where we are not calling addOrUpdate  in receiveDeferredMessage  in PEEK LOCK mode. Thus once we receive DeferredMessage, it can not be Completed or deadLetter because MessageLockContainer does not have an entry for this message lock.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9860#discussion_r403766616", "createdAt": "2020-04-05T22:35:48Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/MessageLockContainer.java", "diffHunk": "@@ -23,7 +23,7 @@\n      * @return The updated value in the container. If the expiration time in the container is larger than\n      *     {@code lockTokenExpiration}, then the current container value is used.\n      */\n-    public Instant addOrUpdate(UUID lockToken, Instant lockTokenExpiration) {\n+    public Instant addOrUpdate(String lockToken, Instant lockTokenExpiration) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6459a3269b2902e0299b32dd76be5bbeaf4ecdd9"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b61b5c2305a6b1df65833c734078d63b2d960dcb", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b61b5c2305a6b1df65833c734078d63b2d960dcb", "committedDate": "2020-04-06T16:47:46Z", "message": "Adding ReceiveAsyncOptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "775222b5a44d7521e3dbab462ba656f9d19dea49", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/775222b5a44d7521e3dbab462ba656f9d19dea49", "committedDate": "2020-04-06T16:47:47Z", "message": "Pulling in autocomplete and lock renewal."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "475b8f6e841618c6a5b7381867105c6289f4dc09", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/475b8f6e841618c6a5b7381867105c6289f4dc09", "committedDate": "2020-04-06T16:47:47Z", "message": "Extract isAutoComplete and maxAutoRenewDuration into class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29937165a4af539c0a7169631ad4b2854b2cb3e0", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/29937165a4af539c0a7169631ad4b2854b2cb3e0", "committedDate": "2020-04-06T16:47:48Z", "message": "Fix spacing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90bc08352ad47329ee15666624470c83d8aaacf4", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/90bc08352ad47329ee15666624470c83d8aaacf4", "committedDate": "2020-04-06T16:47:48Z", "message": "Remove build breaks."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a08ac9e9354601b1efa5c22a56a1863d2a89499f", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a08ac9e9354601b1efa5c22a56a1863d2a89499f", "committedDate": "2020-04-06T16:47:49Z", "message": "Change node to all String."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86a4bd52439ae48d0e0eb613a3c1625f83ea6273", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/86a4bd52439ae48d0e0eb613a3c1625f83ea6273", "committedDate": "2020-04-06T16:47:49Z", "message": "Fix tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f790134a9b76eb4d2f0100dc6a52cfeb46640134", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f790134a9b76eb4d2f0100dc6a52cfeb46640134", "committedDate": "2020-04-06T16:47:50Z", "message": "Add documentation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e476fc0fafa4472f2cbc6ecb31ac13eee1671751", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e476fc0fafa4472f2cbc6ecb31ac13eee1671751", "committedDate": "2020-04-06T16:47:50Z", "message": "Fixing tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "203b7147ddfd829d911970e83db580a717b803ad", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/203b7147ddfd829d911970e83db580a717b803ad", "committedDate": "2020-04-06T16:47:51Z", "message": "Fix checkstyles"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "501d812425acee8110d17a397eac2a81fe5935ab", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/501d812425acee8110d17a397eac2a81fe5935ab", "committedDate": "2020-04-06T16:12:17Z", "message": "Fix checkstyles"}, "afterCommit": {"oid": "203b7147ddfd829d911970e83db580a717b803ad", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/203b7147ddfd829d911970e83db580a717b803ad", "committedDate": "2020-04-06T16:47:51Z", "message": "Fix checkstyles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "153d48f33ee93cd6010003ce3f9c5b2f34e0518a", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/153d48f33ee93cd6010003ce3f9c5b2f34e0518a", "committedDate": "2020-04-06T18:01:00Z", "message": "Fix spotbugs."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1188, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}