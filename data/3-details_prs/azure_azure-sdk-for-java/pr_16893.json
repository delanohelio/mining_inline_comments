{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMDI0MDA3", "number": 16893, "title": "Fixed bug where BlobInputStream would not etag lock", "bodyText": "Resolves #16882", "createdAt": "2020-10-27T20:03:25Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16893", "merged": true, "mergeCommit": {"oid": "9708543b27432cf5487005144e6a7ddc1ddbc038"}, "closed": true, "closedAt": "2020-10-27T23:06:01Z", "author": {"login": "gapra-msft"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWunjIAH2gAyNTExMDI0MDA3OjNiOTE5MmY2MWZjN2MxNzg4Y2M0YTQ4ZTAyZjM4YmFmMzRmYjU2ZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWw7b-AFqTUxODIwNTYzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b9192f61fc7c1788cc4a48e02f38baf34fb56eb", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3b9192f61fc7c1788cc4a48e02f38baf34fb56eb", "committedDate": "2020-10-27T20:02:24Z", "message": "Fixed bug where BlobInputStream would not etag lock"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTIxOTYz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16893#pullrequestreview-518121963", "createdAt": "2020-10-27T20:38:19Z", "commit": {"oid": "3b9192f61fc7c1788cc4a48e02f38baf34fb56eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDozODoxOVrOHpP7RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMDozODoxOVrOHpP7RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAxNDU5Ng==", "bodyText": "I think we should also check that there aren't existing etag conditions. If they pass in an old etag that they want to target, and we just got a new one possibly after some updates, we might not be reading the version they requested.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16893#discussion_r513014596", "createdAt": "2020-10-27T20:38:19Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobClientBase.java", "diffHunk": "@@ -247,11 +247,18 @@ public final BlobInputStream openInputStream(BlobRange range, BlobRequestConditi\n      */\n     public BlobInputStream openInputStream(BlobInputStreamOptions options) {\n         options = options == null ? new BlobInputStreamOptions() : options;\n+\n+        BlobProperties properties = getProperties();\n+\n         BlobRange range = options.getRange() == null ? new BlobRange(0) : options.getRange();\n         int chunkSize = options.getBlockSize() == null ? 4 * Constants.MB : options.getBlockSize();\n \n+        BlobRequestConditions requestConditions = options.getRequestConditions() == null\n+            ? new BlobRequestConditions() : options.getRequestConditions();\n+        requestConditions.setIfMatch(properties.getETag());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b9192f61fc7c1788cc4a48e02f38baf34fb56eb"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d64d60f2f76fc16891f0365f34820ef3d8142a93", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d64d60f2f76fc16891f0365f34820ef3d8142a93", "committedDate": "2020-10-27T20:41:09Z", "message": "Only set if match if not already set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTMwMDM1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16893#pullrequestreview-518130035", "createdAt": "2020-10-27T20:49:54Z", "commit": {"oid": "d64d60f2f76fc16891f0365f34820ef3d8142a93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MjA1NjM0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16893#pullrequestreview-518205634", "createdAt": "2020-10-27T22:43:56Z", "commit": {"oid": "d64d60f2f76fc16891f0365f34820ef3d8142a93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1712, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}