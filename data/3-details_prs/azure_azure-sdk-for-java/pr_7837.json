{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4ODIxNjU3", "number": 7837, "title": "Ensure BufferedResponse type is not caching un-released buffer", "bodyText": "", "createdAt": "2020-01-29T23:44:37Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7837", "merged": true, "mergeCommit": {"oid": "5591650bf3c2f7b9a8296312e90c907ffb26b208"}, "closed": true, "closedAt": "2020-01-31T01:51:45Z", "author": {"login": "anuchandy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_JzofAH2gAyMzY4ODIxNjU3OjA1ZTRhYTM4ZjU3ZjgwYWJlMGZkM2M1YjU4YTk5NDBmNDZkN2FiYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_ihZ4gFqTM1MTE5NDY0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05e4aa38f57f80abe0fd3c5b58a9940f46d7aba5", "author": {"user": {"login": "anuchandy", "name": "Anu Thomas Chandy"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/05e4aa38f57f80abe0fd3c5b58a9940f46d7aba5", "committedDate": "2020-01-29T17:57:42Z", "message": "Making BufferedResponse to do deep caching (it was doing shallow caching)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "966d908aa203da5b2757507e592a36ba4c598f24", "author": {"user": {"login": "anuchandy", "name": "Anu Thomas Chandy"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/966d908aa203da5b2757507e592a36ba4c598f24", "committedDate": "2020-01-29T23:43:17Z", "message": "Make BufferedResponse really buffer and updating decoder to not to use BufferedResponse"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMDgyMDg5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7837#pullrequestreview-351082089", "createdAt": "2020-01-30T19:26:02Z", "commit": {"oid": "966d908aa203da5b2757507e592a36ba4c598f24"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMTUyMjgx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7837#pullrequestreview-351152281", "createdAt": "2020-01-30T21:25:14Z", "commit": {"oid": "966d908aa203da5b2757507e592a36ba4c598f24"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMToyNToxNFrOFj6agQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMToyNjozM1rOFj6c1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIwMTUzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .map(bytes -> ByteBuffer.wrap(bytes))\n          \n          \n            \n                        .map(ByteBuffer::wrap)", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7837#discussion_r373201537", "createdAt": "2020-01-30T21:25:14Z", "author": {"login": "JonathanGiles"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/implementation/http/BufferedHttpResponse.java", "diffHunk": "@@ -28,7 +28,10 @@\n     public BufferedHttpResponse(HttpResponse innerHttpResponse) {\n         super(innerHttpResponse.getRequest());\n         this.innerHttpResponse = innerHttpResponse;\n-        this.cachedBody = innerHttpResponse.getBody().cache();\n+        this.cachedBody = FluxUtil.collectBytesInByteBufferStream(innerHttpResponse.getBody())\n+            .map(bytes -> ByteBuffer.wrap(bytes))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "966d908aa203da5b2757507e592a36ba4c598f24"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIwMjEzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return cachedBody.next().map(byteBuffer -> byteBuffer.array());\n          \n          \n            \n                    return cachedBody.next().map(ByteBuffer::array);", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7837#discussion_r373202133", "createdAt": "2020-01-30T21:26:33Z", "author": {"login": "JonathanGiles"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/implementation/http/BufferedHttpResponse.java", "diffHunk": "@@ -53,7 +56,7 @@ public HttpHeaders getHeaders() {\n \n     @Override\n     public Mono<byte[]> getBodyAsByteArray() {\n-        return FluxUtil.collectBytesInByteBufferStream(cachedBody.map(ByteBuffer::duplicate));\n+        return cachedBody.next().map(byteBuffer -> byteBuffer.array());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "966d908aa203da5b2757507e592a36ba4c598f24"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f1fdc736e671d99510441558bdd21a1cf84c8de", "author": {"user": {"login": "anuchandy", "name": "Anu Thomas Chandy"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8f1fdc736e671d99510441558bdd21a1cf84c8de", "committedDate": "2020-01-30T22:31:08Z", "message": "Update sdk/core/azure-core/src/main/java/com/azure/core/implementation/http/BufferedHttpResponse.java\n\nCo-Authored-By: Jonathan Giles <jonathan@jonathangiles.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb1fcf6b337db406edd5232ebe50d963a1cad2a9", "author": {"user": {"login": "anuchandy", "name": "Anu Thomas Chandy"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cb1fcf6b337db406edd5232ebe50d963a1cad2a9", "committedDate": "2020-01-30T22:31:19Z", "message": "Update sdk/core/azure-core/src/main/java/com/azure/core/implementation/http/BufferedHttpResponse.java\n\nCo-Authored-By: Jonathan Giles <jonathan@jonathangiles.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMTk0NjQ0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7837#pullrequestreview-351194644", "createdAt": "2020-01-30T22:45:25Z", "commit": {"oid": "cb1fcf6b337db406edd5232ebe50d963a1cad2a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2541, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}