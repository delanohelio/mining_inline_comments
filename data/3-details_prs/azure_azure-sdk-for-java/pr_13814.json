{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNjE2NzY3", "number": 13814, "title": "added more logs to GlobalEndpointManager and ClientRetryPolicy", "bodyText": "added more logs to GlobalEndpointManager and ClientRetryPolicy\nthe intention is to find when retry on the other region happens.", "createdAt": "2020-08-05T20:09:40Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13814", "merged": true, "mergeCommit": {"oid": "c1221e06e2825860bb2b24fca2651b27f3ee7090"}, "closed": true, "closedAt": "2020-08-06T19:35:33Z", "author": {"login": "moderakh"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8A7kOAH2gAyNDYzNjE2NzY3OmU0MDRjMDQyZjRlNDU3MTNmMjJhMmExZWQ5YWZiZTk2ZWJmYWZjYzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8TvFnAH2gAyNDYzNjE2NzY3OmM1YTk3NDczMmFiZGM0NDJjNzgwM2E4NzMyMjhkZmU4OGYyMjliODc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e404c042f4e45713f22a2a1ed9afbe96ebfafcc3", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e404c042f4e45713f22a2a1ed9afbe96ebfafcc3", "committedDate": "2020-08-05T20:06:36Z", "message": "added more logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3", "committedDate": "2020-08-05T20:14:45Z", "message": "added log message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTkzOTM2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13814#pullrequestreview-461993936", "createdAt": "2020-08-05T20:19:52Z", "commit": {"oid": "54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDoxOTo1MlrOG8ZLIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDoxOTo1MlrOG8ZLIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4MDE5NA==", "bodyText": "If you send another iteration, can we please use variable itself in logger for canUseMultipleWriteLocations , instead of true and false", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13814#discussion_r465980194", "createdAt": "2020-08-05T20:19:52Z", "author": {"login": "simplynaveen20"}, "path": "sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/ClientRetryPolicy.java", "diffHunk": "@@ -127,17 +128,22 @@ private ShouldRetryResult shouldRetryOnSessionNotAvailable() {\n                 if (this.sessionTokenRetryCount > endpoints.size()) {\n                     // When use multiple write locations is true and the request has been tried\n                     // on all locations, then don't retry the request\n+\n+                    logger.warn(\"SessionNotAvailable: canUseMultipleWriteLocations = true, sessionTokenRetryCount = {}, retried all locations. retry exhausted!\", sessionTokenRetryCount);\n                     return ShouldRetryResult.noRetry();\n                 } else {\n+                    logger.info(\"SessionNotAvailable: canUseMultipleWriteLocations = true, sessionTokenRetryCount = {}, going to retry on next location\", sessionTokenRetryCount);\n                     this.retryContext = new RetryContext(this.sessionTokenRetryCount - 1, this.sessionTokenRetryCount > 1);\n                     return ShouldRetryResult.retryAfter(Duration.ZERO);\n                 }\n             } else {\n                 if (this.sessionTokenRetryCount > 1) {\n                     // When cannot use multiple write locations, then don't retry the request if\n                     // we have already tried this request on the write location\n+                    logger.warn(\"SessionNotAvailable: canUseMultipleWriteLocations = false, sessionTokenRetryCount = {}, no more retries\", sessionTokenRetryCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDAwNjY1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13814#pullrequestreview-462000665", "createdAt": "2020-08-05T20:30:12Z", "commit": {"oid": "54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDozMDoxMlrOG8ZgKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDozMDo0MVrOG8ZhNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4NTU3OQ==", "bodyText": "Since these are specifically for Walmart, why not use DEBUG and not warn, since warning logs will be difficult to diagnose, as they are a lot.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13814#discussion_r465985579", "createdAt": "2020-08-05T20:30:12Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/ClientRetryPolicy.java", "diffHunk": "@@ -116,8 +117,8 @@ public ClientRetryPolicy(GlobalEndpointManager globalEndpointManager,\n \n     private ShouldRetryResult shouldRetryOnSessionNotAvailable() {\n         this.sessionTokenRetryCount++;\n-\n         if (!this.enableEndpointDiscovery) {\n+            logger.warn(\"SessionNotAvailable: no retry due to enableEndpointDiscovery=false\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4NTY0Mg==", "bodyText": "Same here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13814#discussion_r465985642", "createdAt": "2020-08-05T20:30:18Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/ClientRetryPolicy.java", "diffHunk": "@@ -127,17 +128,22 @@ private ShouldRetryResult shouldRetryOnSessionNotAvailable() {\n                 if (this.sessionTokenRetryCount > endpoints.size()) {\n                     // When use multiple write locations is true and the request has been tried\n                     // on all locations, then don't retry the request\n+\n+                    logger.warn(\"SessionNotAvailable: canUseMultipleWriteLocations = true, sessionTokenRetryCount = {}, retried all locations. retry exhausted!\", sessionTokenRetryCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4NTcxOA==", "bodyText": "Good point @simplynaveen20", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13814#discussion_r465985718", "createdAt": "2020-08-05T20:30:28Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/ClientRetryPolicy.java", "diffHunk": "@@ -127,17 +128,22 @@ private ShouldRetryResult shouldRetryOnSessionNotAvailable() {\n                 if (this.sessionTokenRetryCount > endpoints.size()) {\n                     // When use multiple write locations is true and the request has been tried\n                     // on all locations, then don't retry the request\n+\n+                    logger.warn(\"SessionNotAvailable: canUseMultipleWriteLocations = true, sessionTokenRetryCount = {}, retried all locations. retry exhausted!\", sessionTokenRetryCount);\n                     return ShouldRetryResult.noRetry();\n                 } else {\n+                    logger.info(\"SessionNotAvailable: canUseMultipleWriteLocations = true, sessionTokenRetryCount = {}, going to retry on next location\", sessionTokenRetryCount);\n                     this.retryContext = new RetryContext(this.sessionTokenRetryCount - 1, this.sessionTokenRetryCount > 1);\n                     return ShouldRetryResult.retryAfter(Duration.ZERO);\n                 }\n             } else {\n                 if (this.sessionTokenRetryCount > 1) {\n                     // When cannot use multiple write locations, then don't retry the request if\n                     // we have already tried this request on the write location\n+                    logger.warn(\"SessionNotAvailable: canUseMultipleWriteLocations = false, sessionTokenRetryCount = {}, no more retries\", sessionTokenRetryCount);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4MDE5NA=="}, "originalCommit": {"oid": "54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4NTg0NA==", "bodyText": "Same here - let's use the variable", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13814#discussion_r465985844", "createdAt": "2020-08-05T20:30:41Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/ClientRetryPolicy.java", "diffHunk": "@@ -127,17 +128,22 @@ private ShouldRetryResult shouldRetryOnSessionNotAvailable() {\n                 if (this.sessionTokenRetryCount > endpoints.size()) {\n                     // When use multiple write locations is true and the request has been tried\n                     // on all locations, then don't retry the request\n+\n+                    logger.warn(\"SessionNotAvailable: canUseMultipleWriteLocations = true, sessionTokenRetryCount = {}, retried all locations. retry exhausted!\", sessionTokenRetryCount);\n                     return ShouldRetryResult.noRetry();\n                 } else {\n+                    logger.info(\"SessionNotAvailable: canUseMultipleWriteLocations = true, sessionTokenRetryCount = {}, going to retry on next location\", sessionTokenRetryCount);\n                     this.retryContext = new RetryContext(this.sessionTokenRetryCount - 1, this.sessionTokenRetryCount > 1);\n                     return ShouldRetryResult.retryAfter(Duration.ZERO);\n                 }\n             } else {\n                 if (this.sessionTokenRetryCount > 1) {\n                     // When cannot use multiple write locations, then don't retry the request if\n                     // we have already tried this request on the write location\n+                    logger.warn(\"SessionNotAvailable: canUseMultipleWriteLocations = false, sessionTokenRetryCount = {}, no more retries\", sessionTokenRetryCount);\n                     return ShouldRetryResult.noRetry();\n                 } else {\n+                    logger.info(\"SessionNotAvailable: canUseMultipleWriteLocations = false, sessionTokenRetryCount = {}, going to retry\", sessionTokenRetryCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDAyODUz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13814#pullrequestreview-462002853", "createdAt": "2020-08-05T20:33:30Z", "commit": {"oid": "54cf0fcc7f5a6e2dee806b7c0bc4fa0cc3dfeee3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d041df487e27ca7d2723157672de3652adcb7c", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/97d041df487e27ca7d2723157672de3652adcb7c", "committedDate": "2020-08-05T22:21:10Z", "message": "fixed test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aefd7cadca03ce08184746bc37928b2846f50928", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/aefd7cadca03ce08184746bc37928b2846f50928", "committedDate": "2020-08-06T05:17:25Z", "message": "Fixed one more test case with indexing policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7821603d66324832f19b31b6610220e6e136059e", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7821603d66324832f19b31b6610220e6e136059e", "committedDate": "2020-08-06T16:50:31Z", "message": "Missed the assertion in the test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5a974732abdc442c7803a873228dfe88f229b87", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c5a974732abdc442c7803a873228dfe88f229b87", "committedDate": "2020-08-06T18:01:10Z", "message": "fixed test lazy indexing"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 823, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}