{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MDExMTUw", "number": 7702, "title": "Improve performance of default logger", "bodyText": "This change is to improve the performance of the default logger which will be used in the absence of SLF4J binding. The changes include the following:\n\nRemoved AZURE_LOG_LEVEL environment variable loading for each logging attempt. Instead, the environment variable is loaded once through global configuration and will be used for the duration of the application. Any updates will require application restart which is in line with how SLF4J log bindings work.\nRemoved String.format() usage which is not very efficient\nhttps://redfin.engineering/java-string-concatenation-which-way-is-best-8f590a7d22a8\nhttps://stackoverflow.com/a/513705/311483\nRemoved cyclic dependency on DefaultLogger and Configuration\n\nPerformance numbers comparing SLF4J logger with logback binding, ClientLogger with logback binding and ClientLogger using DefaultLogger (when there's no SLF4J binding)\n\n\n\n\u00a0\nSLF4J with   logback binding     (ops/second)\nClientLogger   with logback binding     (ops/second)\nSLF4J with   Logback/ClientLogger with Logback\nClientLogger   without binding (using DefaultLogger)     (ops/second)\nSLF4J with   Logback/ClientLogger with DefaultLogger\n\n\n\n\nlogDebug_CheckLevel_DebugIsDisabled\n501866764\n354051250\n1.42\n557664530\n0.90\n\n\nlogDebug_DebugIsDisabled\n446112655\n415690208\n1.07\n708616204\n0.63\n\n\nlogInfo_CheckLevel_InfoIsEnabled\n5410\n5483\n0.99\n6382\n0.85\n\n\nlogInfo_InfoIsEnabled\n6469\n6796\n0.95\n6312\n1.02\n\n\nlogInfoWithArgs_InfoIsEnabled\n4655\n4608\n1.01\n5232\n0.89", "createdAt": "2020-01-24T20:51:40Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7702", "merged": true, "mergeCommit": {"oid": "7b4785de6f3ea935b0eea0ca51d12f769a59d0a4"}, "closed": true, "closedAt": "2020-01-30T20:18:06Z", "author": {"login": "srnagar"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8ozETAH2gAyMzY3MDExMTUwOjNhODExYTY5ZWI1MGFkNmQ2YzI5ZTY0ZTA2Nzc1MWE5ZTY2YjViZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_gY8fAFqTM1MTExMjkxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3a811a69eb50ad6d6c29e64e067751a9e66b5be5", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3a811a69eb50ad6d6c29e64e067751a9e66b5be5", "committedDate": "2020-01-21T22:22:22Z", "message": "Performance improvements to DefaultLogger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa2229ffb5ae37d4b62e0ad89d6f17bb294cab60", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fa2229ffb5ae37d4b62e0ad89d6f17bb294cab60", "committedDate": "2020-01-24T05:40:49Z", "message": "Logger performance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26b9a0e915541ca56bb8cc18dfb0d091cd474875", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/26b9a0e915541ca56bb8cc18dfb0d091cd474875", "committedDate": "2020-01-24T10:52:21Z", "message": "Remove unwanted code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af79c5a76aeefc3921c93dbb2de703ad39426672", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/af79c5a76aeefc3921c93dbb2de703ad39426672", "committedDate": "2020-01-24T11:21:33Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bffbbb1a101fbaea8a233c16af8e3678e352c408", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bffbbb1a101fbaea8a233c16af8e3678e352c408", "committedDate": "2020-01-24T11:31:06Z", "message": "Fix unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjQwMjg2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7702#pullrequestreview-348240286", "createdAt": "2020-01-24T21:40:04Z", "commit": {"oid": "bffbbb1a101fbaea8a233c16af8e3678e352c408"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NDE0NTYy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7702#pullrequestreview-348414562", "createdAt": "2020-01-27T00:37:12Z", "commit": {"oid": "bffbbb1a101fbaea8a233c16af8e3678e352c408"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwMDozNzoxMlrOFh2hKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwMDozNzoxMlrOFh2hKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA0MDU1Mw==", "bodyText": "configuredLogLevel is only ever set here in the constructor. I wonder if it is worth doing a micro-optimisation here to determine which log levels are valid and pre-compute the boolean conditions here, to simplify the isTraceEnabled, etc methods?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7702#discussion_r371040553", "createdAt": "2020-01-27T00:37:12Z", "author": {"login": "JonathanGiles"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/implementation/logging/DefaultLogger.java", "diffHunk": "@@ -45,11 +52,16 @@ public DefaultLogger(Class<?> clazz) {\n      * class name passes in.\n      */\n     public DefaultLogger(String className) {\n+        String classPath;\n         try {\n-            this.classPath = Class.forName(className).getCanonicalName();\n+            classPath = Class.forName(className).getCanonicalName();\n         } catch (ClassNotFoundException e) {\n-            this.classPath = className;\n+            classPath = className;\n         }\n+        this.classPath = classPath;\n+        this.configuredLogLevel =\n+            LogLevel.fromString(Configuration.getGlobalConfiguration().get(Configuration.PROPERTY_AZURE_LOG_LEVEL))\n+                .getLogLevel();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bffbbb1a101fbaea8a233c16af8e3678e352c408"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08d87e0d8a315ca37a49ee494ad60c1f207d1aaa", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/08d87e0d8a315ca37a49ee494ad60c1f207d1aaa", "committedDate": "2020-01-27T23:49:11Z", "message": "Pre-compute log level enabled check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMTEyOTE5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7702#pullrequestreview-351112919", "createdAt": "2020-01-30T20:16:22Z", "commit": {"oid": "08d87e0d8a315ca37a49ee494ad60c1f207d1aaa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 381, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}