{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MDk2NTU2", "number": 9123, "title": "Generalized azurite endpoints", "bodyText": "Resolves #7909\nI ended up doing this is the way I explicitly said I didn't want to because I think the other way I proposed in the issue would leave accountName as null on the clients, which isn't good behavior. If there are thoughts on a better way to detect this, I am open to them.", "createdAt": "2020-03-16T09:22:19Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123", "merged": true, "mergeCommit": {"oid": "ea086772379a6bdb993cabcfcad8e19c11ef1b36"}, "closed": true, "closedAt": "2020-03-18T19:24:52Z", "author": {"login": "rickle-msft"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOKnk3AH2gAyMzg5MDk2NTU2OjllMWI0Y2Q5NTQwZTc1YzE2YzM5NWJhZjAxYjc0MDk0ODM0ZWVlNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO8HnvgH2gAyMzg5MDk2NTU2OjI3ZWY2YmI3ZWVhZmQ0ZTM1OTc1OGU1MjQwOWUzMTNhODM2NmU3ZTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e1b4cd9540e75c16c395baf01b74094834eee55", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9e1b4cd9540e75c16c395baf01b74094834eee55", "committedDate": "2020-03-16T09:23:18Z", "message": "Generalized azurite endpoints"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0fa434c92444582ea970d37dcf631a347e825e1", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e0fa434c92444582ea970d37dcf631a347e825e1", "committedDate": "2020-03-16T09:20:02Z", "message": "Generalized azurite endpoints"}, "afterCommit": {"oid": "9e1b4cd9540e75c16c395baf01b74094834eee55", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9e1b4cd9540e75c16c395baf01b74094834eee55", "committedDate": "2020-03-16T09:23:18Z", "message": "Generalized azurite endpoints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzgyNDM5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#pullrequestreview-375382439", "createdAt": "2020-03-16T16:30:33Z", "commit": {"oid": "9e1b4cd9540e75c16c395baf01b74094834eee55"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjozMDozNFrOF28JzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjozMjo0MVrOF28PEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Mjk3Mg==", "bodyText": "Any reason /path is required?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#discussion_r393152972", "createdAt": "2020-03-16T16:30:34Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/implementation/util/ModelHelper.java", "diffHunk": "@@ -15,8 +18,18 @@\n  * RESERVED FOR INTERNAL USE.\n  */\n public class ModelHelper {\n-    public static final Pattern IP_V4_URL_PATTERN = Pattern\n-        .compile(\"(?:\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3})|(?:localhost)\");\n+\n+    /**\n+     * Determines whether or not the passed authority is IP style, that is it is of the format\n+     * \"&lt;host&gt;:&lt;port&gt;\".\n+     *\n+     * @param authority The authority of a URL.\n+     * @throws MalformedURLException If the authority is malformed.\n+     * @return Whether the authority is IP style.\n+     */\n+    public static boolean determineAuthorityIsIpStyle(String authority) throws MalformedURLException {\n+        return new URL(\"http://\" +  authority + \"/path\").getPort() != -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e1b4cd9540e75c16c395baf01b74094834eee55"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MzM3Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * \"&lt;host&gt;:&lt;port&gt;\".\n          \n          \n            \n                 * {@code \"<host><port>\"}.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#discussion_r393153377", "createdAt": "2020-03-16T16:31:09Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/implementation/util/ModelHelper.java", "diffHunk": "@@ -15,8 +18,18 @@\n  * RESERVED FOR INTERNAL USE.\n  */\n public class ModelHelper {\n-    public static final Pattern IP_V4_URL_PATTERN = Pattern\n-        .compile(\"(?:\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3})|(?:localhost)\");\n+\n+    /**\n+     * Determines whether or not the passed authority is IP style, that is it is of the format\n+     * \"&lt;host&gt;:&lt;port&gt;\".", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e1b4cd9540e75c16c395baf01b74094834eee55"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1NDMyMg==", "bodyText": "Does this issue affect Queues as well? I know it also supports IP-style URLs in Azurite.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#discussion_r393154322", "createdAt": "2020-03-16T16:32:41Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/BlobUrlParts.java", "diffHunk": "@@ -102,7 +103,12 @@ public String getHost() {\n      */\n     public BlobUrlParts setHost(String host) {\n         this.host = host;\n-        this.isIpUrl = ModelHelper.IP_V4_URL_PATTERN.matcher(host).find();\n+        try {\n+            this.isIpUrl = ModelHelper.determineAuthorityIsIpStyle(host);\n+        } catch (MalformedURLException e) {\n+            throw logger.logExceptionAsError(new IllegalStateException(\"Authority is malformed. Host: \"\n+                + host));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e1b4cd9540e75c16c395baf01b74094834eee55"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b236356178f4e08ffa3abc8da10ded4b0642ccf7", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b236356178f4e08ffa3abc8da10ded4b0642ccf7", "committedDate": "2020-03-17T21:00:17Z", "message": "Added changes to queue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c70092d84fa05cc68f6ca020fe6236408f4dfe8", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0c70092d84fa05cc68f6ca020fe6236408f4dfe8", "committedDate": "2020-03-17T18:37:31Z", "message": "Update sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/implementation/util/ModelHelper.java\n\nCo-Authored-By: Alan Zimmer <48699787+alzimmermsft@users.noreply.github.com>"}, "afterCommit": {"oid": "b236356178f4e08ffa3abc8da10ded4b0642ccf7", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b236356178f4e08ffa3abc8da10ded4b0642ccf7", "committedDate": "2020-03-17T21:00:17Z", "message": "Added changes to queue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDA0Nzc5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#pullrequestreview-376404779", "createdAt": "2020-03-17T21:05:19Z", "commit": {"oid": "b236356178f4e08ffa3abc8da10ded4b0642ccf7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c8359460e57b5630a2cdd3bfb28b91605221a55", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3c8359460e57b5630a2cdd3bfb28b91605221a55", "committedDate": "2020-03-17T21:41:44Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e71a00aee201839198eb27f459e72b0d31d9ee1", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1e71a00aee201839198eb27f459e72b0d31d9ee1", "committedDate": "2020-03-17T21:45:21Z", "message": "Merge remote-tracking branch 'upstream/master' into azuriteEndpoints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDcyNzEy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#pullrequestreview-376472712", "createdAt": "2020-03-17T23:29:44Z", "commit": {"oid": "1e71a00aee201839198eb27f459e72b0d31d9ee1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMzoyOTo0NFrOF3xlDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMzoyOTo0NFrOF3xlDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAyODMwMQ==", "bodyText": "Should this be illegal state or illegal argument? isnt the url technically something the user provided to us?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#discussion_r394028301", "createdAt": "2020-03-17T23:29:44Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/BlobUrlParts.java", "diffHunk": "@@ -338,10 +343,15 @@ public static BlobUrlParts parse(String url) {\n     public static BlobUrlParts parse(URL url) {\n         BlobUrlParts parts = new BlobUrlParts().setScheme(url.getProtocol());\n \n-        if (ModelHelper.IP_V4_URL_PATTERN.matcher(url.getHost()).find()) {\n-            parseIpUrl(url, parts);\n-        } else {\n-            parseNonIpUrl(url, parts);\n+        try {\n+            if (ModelHelper.determineAuthorityIsIpStyle(url.getAuthority())) {\n+                parseIpUrl(url, parts);\n+            } else {\n+                parseNonIpUrl(url, parts);\n+            }\n+        } catch (MalformedURLException e) {\n+            throw parts.logger.logExceptionAsError(new IllegalStateException(\"Authority is malformed. Host: \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e71a00aee201839198eb27f459e72b0d31d9ee1"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDcyOTgx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#pullrequestreview-376472981", "createdAt": "2020-03-17T23:30:30Z", "commit": {"oid": "1e71a00aee201839198eb27f459e72b0d31d9ee1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMzozMDozMFrOF3xl7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMzozMDozMFrOF3xl7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAyODUyNQ==", "bodyText": "nit. extra new lines", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#discussion_r394028525", "createdAt": "2020-03-17T23:30:30Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/BlobUrlParts.java", "diffHunk": "@@ -466,4 +476,6 @@ private static void parseNonIpUrl(URL url, BlobUrlParts parts) {\n \n         return retVals;\n     }\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e71a00aee201839198eb27f459e72b0d31d9ee1"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDczNjM0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#pullrequestreview-376473634", "createdAt": "2020-03-17T23:32:24Z", "commit": {"oid": "1e71a00aee201839198eb27f459e72b0d31d9ee1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMzozMjoyNVrOF3xoDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMzozMjoyNVrOF3xoDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAyOTA2OQ==", "bodyText": "Doesnt matter too much but the wording here is a little weird \"that is it is\", should there be a comma somewhere or something?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#discussion_r394029069", "createdAt": "2020-03-17T23:32:25Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/implementation/util/ModelHelper.java", "diffHunk": "@@ -7,16 +7,27 @@\n import com.azure.storage.blob.models.ParallelTransferOptions;\n import com.azure.storage.blob.specialized.BlockBlobAsyncClient;\n \n-import java.util.regex.Pattern;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n \n /**\n  * This class provides helper methods for common model patterns.\n  *\n  * RESERVED FOR INTERNAL USE.\n  */\n public class ModelHelper {\n-    public static final Pattern IP_V4_URL_PATTERN = Pattern\n-        .compile(\"(?:\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3})|(?:localhost)\");\n+\n+    /**\n+     * Determines whether or not the passed authority is IP style, that is it is of the format", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e71a00aee201839198eb27f459e72b0d31d9ee1"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDc0NTI3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9123#pullrequestreview-376474527", "createdAt": "2020-03-17T23:35:05Z", "commit": {"oid": "1e71a00aee201839198eb27f459e72b0d31d9ee1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27ef6bb7eeafd4e359758e52409e313a8366e7e3", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/27ef6bb7eeafd4e359758e52409e313a8366e7e3", "committedDate": "2020-03-18T19:03:39Z", "message": "PR feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 676, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}