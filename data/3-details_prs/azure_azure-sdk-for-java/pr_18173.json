{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwOTY0NzEw", "number": 18173, "title": "Add scopes for on-demand=true client", "bodyText": "Add scopes for on-demand=true client and login with azure client", "createdAt": "2020-12-16T07:45:19Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173", "merged": true, "mergeCommit": {"oid": "3102a84cba248036d0320991eb398232a0b4c3d4"}, "closed": true, "closedAt": "2020-12-18T02:43:01Z", "author": {"login": "zhichengliu12581"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmXfHxAH2gAyNTQwOTY0NzEwOjAyNGMxYmFmNjc1ZmFmZTljNzdjOTYyZTA3ZjM0YTI4YzRjMWU5MGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnOtIhgFqTU1NTEzMTQ5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "024c1baf675fafe9c77c962e07f34a28c4c1e90e", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/024c1baf675fafe9c77c962e07f34a28c4c1e90e", "committedDate": "2020-12-15T10:08:10Z", "message": "add scopes for default client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7df9a2b2cfd6679164d5fe1a06f7b9cba7147c6c", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7df9a2b2cfd6679164d5fe1a06f7b9cba7147c6c", "committedDate": "2020-12-16T07:28:20Z", "message": "distinguish webapp and webapi to enable login with azure client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc2734c6361202809a758672f93c1f8e56b88ff1", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/dc2734c6361202809a758672f93c1f8e56b88ff1", "committedDate": "2020-12-16T07:42:42Z", "message": "edit test and format code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNDQyNTIw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#pullrequestreview-553442520", "createdAt": "2020-12-16T08:13:06Z", "commit": {"oid": "dc2734c6361202809a758672f93c1f8e56b88ff1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODoxMzowNlrOIG42pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODoxNjowN1rOIG49ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA5Mzg2Mg==", "bodyText": "Delete booleam parameter, use different class for webapp and webapi.\nAADClientRegistrationRepository\nAADWebAppClientRegistrationRepository\nAADWebApiClientRegistrationRepository", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#discussion_r544093862", "createdAt": "2020-12-16T08:13:06Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapi/AzureActiveDirectoryResourceServerClientConfiguration.java", "diffHunk": "@@ -40,7 +40,8 @@ public AzureClientRegistrationRepository azureClientRegistrationRepository() {\n         return new AzureClientRegistrationRepository(\n             clientRegistrationInitialization.createDefaultClient(),\n             clientRegistrationInitialization.createAuthzClients(),\n-            aadAuthenticationProperties);\n+            aadAuthenticationProperties,\n+            false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc2734c6361202809a758672f93c1f8e56b88ff1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA5NDE3OQ==", "bodyText": "if (authz.isOnDemand()) {\n    if()...\n    if()...\n}", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#discussion_r544094179", "createdAt": "2020-12-16T08:13:44Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "diffHunk": "@@ -126,6 +127,13 @@ private void addAzureConfiguredScopes(Set<String> result) {\n \n     private ClientRegistration createClientBuilder(String id, AuthorizationProperties authz) {\n         ClientRegistration.Builder result = createClientBuilder(id);\n+        List<String> scopes = authz.getScopes();\n+        if (authz.isOnDemand() && !scopes.contains(\"openid\")) {\n+            scopes.add(\"openid\");\n+        }\n+        if (authz.isOnDemand() && !scopes.contains(\"profile\")) {\n+            scopes.add(\"profile\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc2734c6361202809a758672f93c1f8e56b88ff1"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA5NDQxMg==", "bodyText": "result.scope(scopes);", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#discussion_r544094412", "createdAt": "2020-12-16T08:14:12Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "diffHunk": "@@ -126,6 +127,13 @@ private void addAzureConfiguredScopes(Set<String> result) {\n \n     private ClientRegistration createClientBuilder(String id, AuthorizationProperties authz) {\n         ClientRegistration.Builder result = createClientBuilder(id);\n+        List<String> scopes = authz.getScopes();\n+        if (authz.isOnDemand() && !scopes.contains(\"openid\")) {\n+            scopes.add(\"openid\");\n+        }\n+        if (authz.isOnDemand() && !scopes.contains(\"profile\")) {\n+            scopes.add(\"profile\");\n+        }\n         result.scope(authz.getScopes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc2734c6361202809a758672f93c1f8e56b88ff1"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA5NDc0Nw==", "bodyText": "Add test for both configurations.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#discussion_r544094747", "createdAt": "2020-12-16T08:14:43Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/test/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfigurationTest.java", "diffHunk": "@@ -144,9 +144,8 @@ public void aadAwareClientRepository() {\n                 assertTrue(clientRepo.isAuthzClient(\"graph\"));\n \n                 List<ClientRegistration> clients = collectClients(clientRepo);\n-                assertEquals(2, clients.size());\n-                assertEquals(\"graph\", clients.get(0).getRegistrationId());\n-                assertEquals(\"azure\", clients.get(1).getRegistrationId());\n+                assertEquals(1, clients.size());\n+                assertEquals(\"azure\", clients.get(0).getRegistrationId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc2734c6361202809a758672f93c1f8e56b88ff1"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA5NTA0NQ==", "bodyText": "Rename this file to AADWebAppConfiguration", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#discussion_r544095045", "createdAt": "2020-12-16T08:15:18Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "diffHunk": "@@ -51,7 +51,8 @@ public AzureClientRegistrationRepository clientRegistrationRepository() {\n         return new AzureClientRegistrationRepository(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc2734c6361202809a758672f93c1f8e56b88ff1"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA5NTU4OQ==", "bodyText": "Rename this file to AADWebApiConfiguration", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#discussion_r544095589", "createdAt": "2020-12-16T08:16:07Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapi/AzureActiveDirectoryResourceServerClientConfiguration.java", "diffHunk": "@@ -40,7 +40,8 @@ public AzureClientRegistrationRepository azureClientRegistrationRepository() {\n         return new AzureClientRegistrationRepository(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc2734c6361202809a758672f93c1f8e56b88ff1"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e94307b576d930b64fce7d6d4e451a84685eec6d", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e94307b576d930b64fce7d6d4e451a84685eec6d", "committedDate": "2020-12-17T02:16:52Z", "message": "Merge branch 'add-scopes-for-default-client' of https://github.com/lzc-1997-abel/azure-sdk-for-java into add-scopes-for-default-client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0edf29b0fe774fe6649c4d1a497ef914aa9bfa8f", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0edf29b0fe774fe6649c4d1a497ef914aa9bfa8f", "committedDate": "2020-12-17T02:17:41Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into add-scopes-for-default-client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a2cf46f783daefe9bb183aa915f465b8684cb06", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4a2cf46f783daefe9bb183aa915f465b8684cb06", "committedDate": "2020-12-17T03:00:02Z", "message": "Add a common class client registration repository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e28ba1614dd7ba535a422ac00bcb79f52eb4a24", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7e28ba1614dd7ba535a422ac00bcb79f52eb4a24", "committedDate": "2020-12-17T03:03:48Z", "message": "add web api client registration repository and edit web app repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "227181d6a8dc83d0862d6147476b1ceb412cd206", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/227181d6a8dc83d0862d6147476b1ceb412cd206", "committedDate": "2020-12-17T03:43:41Z", "message": "add web api client registration repository and edit web app repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6fc2dbb379ec53ab42e9973be2caea669cd0ad6", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c6fc2dbb379ec53ab42e9973be2caea669cd0ad6", "committedDate": "2020-12-17T03:44:12Z", "message": "change AADClientRegistrationRepository to abstract"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2411440f5b5ae9acbf8b6a7008247cfb94b625f9", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2411440f5b5ae9acbf8b6a7008247cfb94b625f9", "committedDate": "2020-12-17T04:33:08Z", "message": "format code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Mjg4Mzc3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#pullrequestreview-554288377", "createdAt": "2020-12-17T05:24:14Z", "commit": {"oid": "2411440f5b5ae9acbf8b6a7008247cfb94b625f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNToyNDoxNFrOIHlO_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNToyNDoxNFrOIHlO_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgyMDk5MQ==", "bodyText": "This is not updated yet.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#discussion_r544820991", "createdAt": "2020-12-17T05:24:14Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AADWebAppConfiguration.java", "diffHunk": "@@ -161,6 +161,15 @@ private void addAzureConfiguredScopes(Set<String> result) {\n \n     private ClientRegistration createClientBuilder(String id, AuthorizationProperties authz) {\n         ClientRegistration.Builder result = createClientBuilder(id);\n+        List<String> scopes = authz.getScopes();\n+        if (authz.isOnDemand()) {\n+            if (!scopes.contains(\"openid\")) {\n+                scopes.add(\"openid\");\n+            }\n+            if (!scopes.contains(\"profile\")) {\n+                scopes.add(\"profile\");\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2411440f5b5ae9acbf8b6a7008247cfb94b625f9"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c587a29d5a48514ed2f80e2569d812fef80ebd45", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c587a29d5a48514ed2f80e2569d812fef80ebd45", "committedDate": "2020-12-17T05:31:04Z", "message": "remove omitable variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0b28fb2a0f7b0d3846813f50fddc22874a6ec75", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a0b28fb2a0f7b0d3846813f50fddc22874a6ec75", "committedDate": "2020-12-17T06:07:56Z", "message": "change the way to get scopes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb4bb1a67dcb32ca0c69917721f4a60b83c343c9", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cb4bb1a67dcb32ca0c69917721f4a60b83c343c9", "committedDate": "2020-12-18T01:46:17Z", "message": "merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc47d7d0f889a1140b12630e927f9cc8ab0864e4", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cc47d7d0f889a1140b12630e927f9cc8ab0864e4", "committedDate": "2020-12-18T01:55:57Z", "message": "merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0468555b3e599e6ed19b0f22b77139166d703982", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0468555b3e599e6ed19b0f22b77139166d703982", "committedDate": "2020-12-18T01:57:01Z", "message": "Merge remote-tracking branch 'origin/add-scopes-for-default-client' into add-scopes-for-default-client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6eb98e59971d2281e614debcf8ef7a3f72d81cf9", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6eb98e59971d2281e614debcf8ef7a3f72d81cf9", "committedDate": "2020-12-18T02:08:14Z", "message": "Recover the wrong merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MTMxNDky", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18173#pullrequestreview-555131492", "createdAt": "2020-12-18T02:28:15Z", "commit": {"oid": "6eb98e59971d2281e614debcf8ef7a3f72d81cf9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1269, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}