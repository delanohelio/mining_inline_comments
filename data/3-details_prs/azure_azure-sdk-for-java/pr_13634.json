{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4ODkzMjI0", "number": 13634, "title": "Encryption filling gaps", "bodyText": "Wires up encryption for upsert and replace\nAdded more tests for encryption/decryption\nFixed typo in javadoc of azure-cosmos", "createdAt": "2020-07-30T05:56:52Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13634", "merged": true, "mergeCommit": {"oid": "8ea6bb917bde69f51739fca564c8100dbe5b7cbf"}, "closed": true, "closedAt": "2020-07-30T07:12:21Z", "author": {"login": "moderakh"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc16H_AgH2gAyNDU4ODkzMjI0OjY5MWY4YjE2MmRkZTg0NDQwZGFmZDdkZDFjMjdlYjM5NzA5OWMzMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc55jzwAH2gAyNDU4ODkzMjI0OmIyM2Q1NTc3ZGU0MjA2Mzc3ZjA5MjRiMzJiN2U2OWU3NmYyMWZjMDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "691f8b162dde84440dafd7dd1c27eb397099c308", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/691f8b162dde84440dafd7dd1c27eb397099c308", "committedDate": "2020-07-17T20:47:17Z", "message": "minor cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eda32c50f77257ea46091b21a02819f253e9faf", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8eda32c50f77257ea46091b21a02819f253e9faf", "committedDate": "2020-07-17T22:12:12Z", "message": "minor cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff37289bdc52b165166b69d2ee91420294818f23", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ff37289bdc52b165166b69d2ee91420294818f23", "committedDate": "2020-07-17T23:02:00Z", "message": "encryptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77cf2ec44b4f5aa2c9f572af53485db248b22b71", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/77cf2ec44b4f5aa2c9f572af53485db248b22b71", "committedDate": "2020-07-17T23:05:10Z", "message": "static field name correction, fixed pre-condition check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d41cfff387576767afdf515af4587d323eca03e", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5d41cfff387576767afdf515af4587d323eca03e", "committedDate": "2020-07-20T16:38:44Z", "message": "Merge branch 'master' into users/moderakh/encryption-minor-cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51f3cdd0fa68f3d7c072e82951be3014935601ba", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/51f3cdd0fa68f3d7c072e82951be3014935601ba", "committedDate": "2020-07-20T17:14:58Z", "message": "Merge branch 'users/moderakh/encryption-minor-cleanup' into users/moderakh/20200717-encryption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfc13d2ff2513f21fd461c3a23691de556945c7a", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cfc13d2ff2513f21fd461c3a23691de556945c7a", "committedDate": "2020-07-23T17:42:40Z", "message": "move encryption hooks out of sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2caa15601ede91a5ad95708843eb96ecd48cb0eb", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2caa15601ede91a5ad95708843eb96ecd48cb0eb", "committedDate": "2020-07-23T17:54:28Z", "message": "Merge branch 'master' into users/moderakh/20200717-encryption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b4cd567147799e37418450ed00a2817ced1fdfe", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7b4cd567147799e37418450ed00a2817ced1fdfe", "committedDate": "2020-07-23T18:19:14Z", "message": "encryption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5e6f09d3634df5928ac322f9b6198cd73cbd7de", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e5e6f09d3634df5928ac322f9b6198cd73cbd7de", "committedDate": "2020-07-23T18:22:42Z", "message": "undid public api change to CosmosItemResponse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c17f86d6de14f46671de958b254b3b96d88272b", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5c17f86d6de14f46671de958b254b3b96d88272b", "committedDate": "2020-07-23T18:29:06Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b2e69796dbf9107018009f57ad33e76def18397", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6b2e69796dbf9107018009f57ad33e76def18397", "committedDate": "2020-07-23T18:39:03Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a6458d95e077faae9e7398237c9461ae57c925d", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0a6458d95e077faae9e7398237c9461ae57c925d", "committedDate": "2020-07-23T19:02:59Z", "message": "code review comments addressed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e9d20761317a111cb17ca10ffe1bba4b7c64b1e", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9e9d20761317a111cb17ca10ffe1bba4b7c64b1e", "committedDate": "2020-07-23T19:16:12Z", "message": "fixed compilation error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f262d5c0dc7059d832be76326dc91cd1ca7484f7", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f262d5c0dc7059d832be76326dc91cd1ca7484f7", "committedDate": "2020-07-23T20:02:10Z", "message": "minor code style cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a12d345d635a31d2e46c2e890257513ce4c1001f", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a12d345d635a31d2e46c2e890257513ce4c1001f", "committedDate": "2020-07-23T22:06:01Z", "message": "check style fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b79a5a8e6dc53abaed90535d10292cd9b99d3ac", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7b79a5a8e6dc53abaed90535d10292cd9b99d3ac", "committedDate": "2020-07-23T22:30:53Z", "message": "javadoc fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88e984e4e32d11b6560782be1d86bd130edf9245", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/88e984e4e32d11b6560782be1d86bd130edf9245", "committedDate": "2020-07-23T22:35:26Z", "message": "javadoc fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f7d590dc679c865eb081cc7c8b5acea50b94fec", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6f7d590dc679c865eb081cc7c8b5acea50b94fec", "committedDate": "2020-07-23T22:49:18Z", "message": "check-style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b7ec08f10f7cd791234c8436a511d2d93bc3e21", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1b7ec08f10f7cd791234c8436a511d2d93bc3e21", "committedDate": "2020-07-24T06:17:06Z", "message": "query basic support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5e67e1e2f69bc71950645c6299342e5af83502f", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c5e67e1e2f69bc71950645c6299342e5af83502f", "committedDate": "2020-07-24T06:19:35Z", "message": "Merge branch 'master' into users/moderakh/20200723-encryption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "290377d3f80c673d5a0719b526b20a936d770e8e", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/290377d3f80c673d5a0719b526b20a936d770e8e", "committedDate": "2020-07-24T22:45:36Z", "message": "encryption for query"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad1136cd0eebc082eef4ca453042e3e05d1d2b89", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ad1136cd0eebc082eef4ca453042e3e05d1d2b89", "committedDate": "2020-07-24T22:46:18Z", "message": "Merge branch 'master' into users/moderakh/20200723-encryption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e171f089fc84bcf2b7294dc2c32a6225d7623360", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e171f089fc84bcf2b7294dc2c32a6225d7623360", "committedDate": "2020-07-29T17:09:34Z", "message": "minor package move, cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9822e2c34844894d500cbcc8232469842a83451f", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9822e2c34844894d500cbcc8232469842a83451f", "committedDate": "2020-07-29T17:14:18Z", "message": "Merge branch 'master' into users/moderakh/20200723-encryption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdb6084b68ba37f607709a86a23375f7348f6ff5", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bdb6084b68ba37f607709a86a23375f7348f6ff5", "committedDate": "2020-07-29T18:49:20Z", "message": "code style fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c7dad4144b01582b7358cc3ae13cdf6ffc5dbfa", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9c7dad4144b01582b7358cc3ae13cdf6ffc5dbfa", "committedDate": "2020-07-29T19:55:07Z", "message": "fixed check style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c70b433b45b0b7f0b7b15e762f56698b6197d36", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5c70b433b45b0b7f0b7b15e762f56698b6197d36", "committedDate": "2020-07-30T00:13:15Z", "message": "upsert, delete, replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9e0e390e9c4a513164296475a07b7e46499a948", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9e0e390e9c4a513164296475a07b7e46499a948", "committedDate": "2020-07-30T00:45:19Z", "message": "replace, upsert test works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e92dd701b4fcd55545f31a03ddcdfb8e1a007e69", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e92dd701b4fcd55545f31a03ddcdfb8e1a007e69", "committedDate": "2020-07-30T05:53:43Z", "message": "more tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MDk2MTA3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13634#pullrequestreview-458096107", "createdAt": "2020-07-30T06:11:47Z", "commit": {"oid": "e92dd701b4fcd55545f31a03ddcdfb8e1a007e69"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjoxMTo0N1rOG5UcwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjoxNjowMVrOG5Uiiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1NzA1Nw==", "bodyText": "This publishOn will have no effect on the reactor chain, since subscribeOn will already switch the threads to Schedulers.elastic(). Take a look at this example at subscribeOn from this article: https://www.woolha.com/tutorials/project-reactor-publishon-vs-subscribeon-difference\nIf you were using different schedulers, then it would make sense to place both of them here.\nSo I guess simpler code will be something like this:\nreturn response\n .map(rsp -> {})\n .subscribeOn(Schedulers.elastic());", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13634#discussion_r462757057", "createdAt": "2020-07-30T06:11:47Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos-encryption/src/main/java/com/azure/cosmos/encryption/EncryptionCosmosAsyncContainer.java", "diffHunk": "@@ -69,6 +69,63 @@\n             );\n     }\n \n+    private Mono<CosmosItemResponse<byte[]>> replaceItemStream(byte[] payload,\n+                                                               String itemId,\n+                                                               PartitionKey partitionKey,\n+                                                               EncryptionItemRequestOptions encryptionItemRequestOptions) {\n+        Preconditions.checkNotNull(payload, \"payload can't be null\");\n+\n+        // TODO: add diagnostics\n+        assert encryptionItemRequestOptions != null && encryptionItemRequestOptions.getEncryptionOptions() != null;\n+        payload = EncryptionProcessor.encryptAsync(payload, encryptor,\n+            encryptionItemRequestOptions.getEncryptionOptions());\n+\n+        Mono<CosmosItemResponse<byte[]>> response = container.replaceItem(payload,\n+            itemId,\n+            partitionKey,\n+            encryptionItemRequestOptions);\n+\n+        return response\n+            .subscribeOn(Schedulers.elastic())\n+            .publishOn(Schedulers.elastic())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92dd701b4fcd55545f31a03ddcdfb8e1a007e69"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1ODM3Mg==", "bodyText": "We should have new line at the end of the file.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13634#discussion_r462758372", "createdAt": "2020-07-30T06:15:30Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos-encryption/src/main/java/com/azure/cosmos/encryption/EncryptionCosmosAsyncContainer.java", "diffHunk": "@@ -246,4 +400,4 @@ ItemDeserializer getItemDeserializer() {\n             return input;\n         }\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92dd701b4fcd55545f31a03ddcdfb8e1a007e69"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1ODQ5OA==", "bodyText": "Thanks for this correction.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13634#discussion_r462758498", "createdAt": "2020-07-30T06:15:52Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncContainer.java", "diffHunk": "@@ -587,7 +587,7 @@ public String getId() {\n      * Deletes an item.\n      * <p>\n      * After subscription the operation will be performed.\n-     * The {@link Mono} upon successful completion will contain a single Cosmos item response with the replaced item.\n+     * The {@link Mono} upon successful completion will contain a single Cosmos item response with the deleted item.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92dd701b4fcd55545f31a03ddcdfb8e1a007e69"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1ODUzOQ==", "bodyText": "Thanks!", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13634#discussion_r462758539", "createdAt": "2020-07-30T06:16:01Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncContainer.java", "diffHunk": "@@ -601,7 +601,7 @@ public String getId() {\n      * Deletes the item.\n      * <p>\n      * After subscription the operation will be performed.\n-     * The {@link Mono} upon successful completion will contain a single Cosmos item response with the replaced item.\n+     * The {@link Mono} upon successful completion will contain a single Cosmos item response with the deleted item.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e92dd701b4fcd55545f31a03ddcdfb8e1a007e69"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b23d5577de4206377f0924b32b7e69e76f21fc05", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b23d5577de4206377f0924b32b7e69e76f21fc05", "committedDate": "2020-07-30T06:23:28Z", "message": "addressed code review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1034, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}