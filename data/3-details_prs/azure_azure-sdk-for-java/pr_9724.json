{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NjEyODIy", "number": 9724, "title": "Modified BlobOutputStream to wait on a condition variable until transfer is complete instead of polling", "bodyText": "", "createdAt": "2020-03-31T21:25:54Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9724", "merged": true, "mergeCommit": {"oid": "62c624f2ccebdaf2d29a285bd26b60b8e3b76a0c"}, "closed": true, "closedAt": "2020-04-03T19:04:01Z", "author": {"login": "gapra-msft"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTJ64PAH2gAyMzk2NjEyODIyOjQwODNiYjJkZmM1NTI4YzhlZTMzZDk2ZWQxNmU1NjljMzY5MWM2ZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUEqZnAFqTM4NzQ2MjYyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4083bb2dfc5528c8ee33d96ed16e569c3691c6f6", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4083bb2dfc5528c8ee33d96ed16e569c3691c6f6", "committedDate": "2020-03-31T21:24:06Z", "message": "changed polling to waiting on condition variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "754e3a5a49cb59edb28010816f30e0632dbd5eb7", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/754e3a5a49cb59edb28010816f30e0632dbd5eb7", "committedDate": "2020-03-31T21:24:57Z", "message": "added changelog entry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTE2NzIz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9724#pullrequestreview-385116723", "createdAt": "2020-03-31T21:26:14Z", "commit": {"oid": "754e3a5a49cb59edb28010816f30e0632dbd5eb7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMToyNjoxNVrOF-o1rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMToyNjoxNVrOF-o1rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyNTEzMw==", "bodyText": "What am i supposed to do here?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9724#discussion_r401225133", "createdAt": "2020-03-31T21:26:15Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobOutputStream.java", "diffHunk": "@@ -183,14 +196,16 @@ void commit() {\n             sink.complete();\n \n             // Need to wait until the uploadTask completes\n+            lock.lock();\n             while (!complete) {\n                 try {\n-                    Thread.sleep(100L);\n+                    transferComplete.await();\n                 } catch (InterruptedException e) {\n-                    // Does this need to be caught by logger?\n-                    e.printStackTrace();\n+                    this.lastError = new IOException(e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e3a5a49cb59edb28010816f30e0632dbd5eb7"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1902a9f6c979f1bbfda3e4a1b5c4a62d9cfaa055", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1902a9f6c979f1bbfda3e4a1b5c4a62d9cfaa055", "committedDate": "2020-03-31T21:50:28Z", "message": "release lock on exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "872e2d190bdfb4d352d4841ab48a80a7e829cf30", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/872e2d190bdfb4d352d4841ab48a80a7e829cf30", "committedDate": "2020-03-31T22:21:29Z", "message": "removed unnecessary catch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1Nzc4NzIy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9724#pullrequestreview-385778722", "createdAt": "2020-04-01T17:01:50Z", "commit": {"oid": "872e2d190bdfb4d352d4841ab48a80a7e829cf30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNzowMTo1MVrOF_KF7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNzowMTo1MVrOF_KF7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc2OTk2Ng==", "bodyText": "Should I try catch the entire block on the lock and unlock if a generic exception is caught? Or do yall think CI is catching a false positive?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9724#discussion_r401769966", "createdAt": "2020-04-01T17:01:51Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/BlobOutputStream.java", "diffHunk": "@@ -174,7 +182,12 @@ private BlockBlobOutputStream(final BlobAsyncClient client,\n                     this.lastError = new IOException(e);\n                     return Mono.empty();\n                 })\n-                .doOnTerminate(() -> complete = true)\n+                .doOnTerminate(() -> {\n+                    lock.lock();\n+                    complete = true;\n+                    transferComplete.signal();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "872e2d190bdfb4d352d4841ab48a80a7e829cf30"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ca2a7b5536cf29f58093d25c2b4d34d234af997", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ca2a7b5536cf29f58093d25c2b4d34d234af997", "committedDate": "2020-04-01T17:46:28Z", "message": "added finally blocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce2ceec8564c467c69ac85c095f053c8eff8ff4b", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ce2ceec8564c467c69ac85c095f053c8eff8ff4b", "committedDate": "2020-04-01T18:26:25Z", "message": "added more stuff into finally"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1ODYzMTkz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9724#pullrequestreview-385863193", "createdAt": "2020-04-01T18:56:56Z", "commit": {"oid": "ce2ceec8564c467c69ac85c095f053c8eff8ff4b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "154243af972832c54ce7977c97740ff56cc819ba", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/154243af972832c54ce7977c97740ff56cc819ba", "committedDate": "2020-04-03T17:39:11Z", "message": "Merge branch 'master' into storage/blobOutputStreamPolling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NDYyNjIw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9724#pullrequestreview-387462620", "createdAt": "2020-04-03T17:50:30Z", "commit": {"oid": "154243af972832c54ce7977c97740ff56cc819ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1296, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}