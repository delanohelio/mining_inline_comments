{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyODc3MTAy", "number": 7426, "title": "Added client side checks for account set props", "bodyText": "Resolves #6627", "createdAt": "2020-01-14T22:54:13Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7426", "merged": true, "mergeCommit": {"oid": "b89d97ce958cabbfc3233b4f54eccdfea49e9fe3"}, "closed": true, "closedAt": "2020-01-15T21:03:08Z", "author": {"login": "gapra-msft"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6ZDVGAH2gAyMzYyODc3MTAyOmRlOTk3NGYwMzRjYTA4M2U0OTc5ODE0MGQwYjc3N2JhZWU1MzVhYzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6ryxvgH2gAyMzYyODc3MTAyOjc1NzM5ZjhjODA5MjRlNmY1ZjAyMmY3ODg4ZThmNGI4YjY5MmMwMGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de9974f034ca083e49798140d0b777baee535ac3", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/de9974f034ca083e49798140d0b777baee535ac3", "committedDate": "2020-01-14T22:53:48Z", "message": "Added checks for account set props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8940b340ad0b96369f45e23aeed0743b65461e90", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8940b340ad0b96369f45e23aeed0743b65461e90", "committedDate": "2020-01-14T23:26:04Z", "message": "Fixed checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d038f392ee606782c3caea6620de096716d809a7", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d038f392ee606782c3caea6620de096716d809a7", "committedDate": "2020-01-15T17:44:41Z", "message": "Added more checks and test recording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aef2bf8376b605c1b57dfd462a7dba9bc1210f92", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/aef2bf8376b605c1b57dfd462a7dba9bc1210f92", "committedDate": "2020-01-15T18:00:22Z", "message": "test Recordings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDI0NDI3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7426#pullrequestreview-343424427", "createdAt": "2020-01-15T18:20:29Z", "commit": {"oid": "aef2bf8376b605c1b57dfd462a7dba9bc1210f92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxODoyMDozMFrOFeB4bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxODoyMDozMFrOFeB4bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzAzMjQzMA==", "bodyText": "Can you leave a comment calling out that some properties are not set and the test validates that we fill them with null? Otherwise it'll be easy to forget what this test is for.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7426#discussion_r367032430", "createdAt": "2020-01-15T18:20:30Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/storage/blob/ServiceAPITest.groovy", "diffHunk": "@@ -270,6 +270,22 @@ class ServiceAPITest extends APISpec {\n         primaryBlobServiceClient.setPropertiesWithResponse(sentProperties, null, null).getStatusCode() == 202\n     }\n \n+    def \"Set props cors check\"() {\n+        setup:\n+        def serviceProperties = primaryBlobServiceClient.getProperties()\n+\n+        def rule = new BlobCorsRule()\n+        rule.setAllowedOrigins(\"microsoft.com\")\n+        rule.setMaxAgeInSeconds(60)\n+        rule.setAllowedMethods(\"GET\")\n+        rule.setAllowedHeaders(\"x-ms-version\")\n+\n+        serviceProperties.setCors(Collections.singletonList(rule))\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aef2bf8376b605c1b57dfd462a7dba9bc1210f92"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDI1MTgw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7426#pullrequestreview-343425180", "createdAt": "2020-01-15T18:21:42Z", "commit": {"oid": "aef2bf8376b605c1b57dfd462a7dba9bc1210f92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxODoyMTo0MlrOFeB6xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxODoyMTo0MlrOFeB6xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzAzMzAzMA==", "bodyText": "Can you leave a comment that mentions that the service requires these fields not be null so we change null to empty string?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7426#discussion_r367033030", "createdAt": "2020-01-15T18:21:42Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/BlobServiceAsyncClient.java", "diffHunk": "@@ -391,10 +395,89 @@ public String getAccountUrl() {\n     }\n \n     Mono<Response<Void>> setPropertiesWithResponse(BlobServiceProperties properties, Context context) {\n-        return this.azureBlobStorage.services().setPropertiesWithRestResponseAsync(properties, null, null, context)\n+        BlobServiceProperties finalProperties = null;\n+        if (properties != null) {\n+            finalProperties = new BlobServiceProperties();\n+\n+            // Logging\n+            finalProperties.setLogging(properties.getLogging());\n+            if (finalProperties.getLogging() != null) {\n+                StorageImplUtils.assertNotNull(\"Logging Version\", finalProperties.getLogging().getVersion());\n+                validateRetentionPolicy(finalProperties.getLogging().getRetentionPolicy(), \"Logging Retention Policy\");\n+            }\n+\n+            // Hour Metrics\n+            finalProperties.setHourMetrics(properties.getHourMetrics());\n+            if (finalProperties.getHourMetrics() != null) {\n+                StorageImplUtils.assertNotNull(\"HourMetrics Version\", finalProperties.getHourMetrics().getVersion());\n+                validateRetentionPolicy(finalProperties.getHourMetrics().getRetentionPolicy(), \"HourMetrics Retention \"\n+                    + \"Policy\");\n+                if (finalProperties.getHourMetrics().isEnabled()) {\n+                    StorageImplUtils.assertNotNull(\"HourMetrics IncludeApis\",\n+                        finalProperties.getHourMetrics().isIncludeApis());\n+                }\n+            }\n+\n+            // Minute Metrics\n+            finalProperties.setMinuteMetrics(properties.getMinuteMetrics());\n+            if (finalProperties.getMinuteMetrics() != null) {\n+                StorageImplUtils.assertNotNull(\"MinuteMetrics Version\",\n+                    finalProperties.getMinuteMetrics().getVersion());\n+                validateRetentionPolicy(finalProperties.getMinuteMetrics().getRetentionPolicy(), \"MinuteMetrics \"\n+                    + \"Retention Policy\");\n+                if (finalProperties.getMinuteMetrics().isEnabled()) {\n+                    StorageImplUtils.assertNotNull(\"MinuteMetrics IncludeApis\",\n+                        finalProperties.getHourMetrics().isIncludeApis());\n+                }\n+            }\n+\n+            // CORS\n+            if (properties.getCors() != null) {\n+                List<BlobCorsRule> corsRules = new ArrayList<>();\n+                for (BlobCorsRule rule : properties.getCors()) {\n+                    corsRules.add(validatedCorsRule(rule));\n+                }\n+                finalProperties.setCors(corsRules);\n+            }\n+\n+            // Default Service Version\n+            finalProperties.setDefaultServiceVersion(properties.getDefaultServiceVersion());\n+\n+            // Delete Retention Policy\n+            finalProperties.setDeleteRetentionPolicy(properties.getDeleteRetentionPolicy());\n+            validateRetentionPolicy(finalProperties.getDeleteRetentionPolicy(), \"DeleteRetentionPolicy Days\");\n+\n+            // Static Website\n+            finalProperties.setStaticWebsite(properties.getStaticWebsite());\n+\n+        }\n+\n+        return this.azureBlobStorage.services().setPropertiesWithRestResponseAsync(finalProperties, null, null, context)\n             .map(response -> new SimpleResponse<>(response, null));\n     }\n \n+    private BlobCorsRule validatedCorsRule(BlobCorsRule originalRule) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aef2bf8376b605c1b57dfd462a7dba9bc1210f92"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDI1Mjc3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7426#pullrequestreview-343425277", "createdAt": "2020-01-15T18:21:50Z", "commit": {"oid": "aef2bf8376b605c1b57dfd462a7dba9bc1210f92"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b4838185a1dcf3fc7283df89fb265e85f24bac6", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3b4838185a1dcf3fc7283df89fb265e85f24bac6", "committedDate": "2020-01-15T18:27:01Z", "message": "Added comments to test and private methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef5e21f49d72cf485cca2e69e62c3eb434ecd88c", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ef5e21f49d72cf485cca2e69e62c3eb434ecd88c", "committedDate": "2020-01-15T19:20:36Z", "message": "Merge branch 'master' into storage/accountSetProps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDcyNzMy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7426#pullrequestreview-343472732", "createdAt": "2020-01-15T19:41:08Z", "commit": {"oid": "ef5e21f49d72cf485cca2e69e62c3eb434ecd88c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75739f8c80924e6f5f022f7888e8f4b8b692c00e", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/75739f8c80924e6f5f022f7888e8f4b8b692c00e", "committedDate": "2020-01-15T20:43:55Z", "message": "Added javadoc and Changelog"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 525, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}