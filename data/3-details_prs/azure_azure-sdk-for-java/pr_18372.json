{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1OTYwOTcy", "number": 18372, "title": "Update README.md file in the resource-server-obo", "bodyText": "Update the resource-server-obo README.md file.", "createdAt": "2020-12-28T07:01:01Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372", "merged": true, "mergeCommit": {"oid": "ae0c6a16725734dd55bea64611c56516aebb48ce"}, "closed": true, "closedAt": "2020-12-29T11:14:28Z", "author": {"login": "ZhuXiaoBing-cn"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqgjN6gH2gAyNTQ1OTYwOTcyOmUyNGMyYWRhYTRjMjk3NDRhOGY1MThhNDYwZTQ0NGVjMTBhNjViYmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdq4U0ugFqTU1OTQ3NDU3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e24c2adaa4c29744a8f518a460e444ec10a65bbc", "author": {"user": {"login": "ZhuXiaoBing-cn", "name": "Xiaobing Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e24c2adaa4c29744a8f518a460e444ec10a65bbc", "committedDate": "2020-12-28T06:57:29Z", "message": "Update the resource sever obo README.md file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfe48f408cf378025e2505336b1e46b54624571d", "author": {"user": {"login": "ZhuXiaoBing-cn", "name": "Xiaobing Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cfe48f408cf378025e2505336b1e46b54624571d", "committedDate": "2020-12-28T07:06:09Z", "message": "Merge branch 'master' into update_obo_sample_readme\n\n# Conflicts:\n#\tsdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/src/main/resources/application.yaml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ba6c076633d22c26d981eac86e06a44399a9317", "author": {"user": {"login": "ZhuXiaoBing-cn", "name": "Xiaobing Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9ba6c076633d22c26d981eac86e06a44399a9317", "committedDate": "2020-12-28T07:07:25Z", "message": "Update the resource sever obo README.md file."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MzY2OTQ4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#pullrequestreview-559366948", "createdAt": "2020-12-29T03:32:23Z", "commit": {"oid": "9ba6c076633d22c26d981eac86e06a44399a9317"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzozMjoyNFrOIMGNhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzozOToxOFrOIMGRqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTU5MQ==", "bodyText": "Did we mention the Web API sample link somewhere above?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549555591", "createdAt": "2020-12-29T03:32:24Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md", "diffHunk": "@@ -48,68 +55,44 @@ We need to ensure that this [environment checklist][ready-to-run-checklist] is c\n </dependencies>\n ```\n \n-### Register your Web API\n-You can follow *azure-spring-boot-sample-active-directory-resource-server* sample to add `ResourceAccessGraph.read`, `ResourceAccessGraphCustomResources.read` scopes. \n-Convention current application id url is `api://sample-client-id`, ; the application id url of the sample *azure-spring-boot-sample-active-directory-resource-server* is `custom-client-id`.  \n-After adding as shown below:\n-\n-   ![API Permissions](resource/resource-server-obo-add-scope.png)\n-\n-### Add API permissions\n-The current Web API will access Graph API and Custom API. \n-\n-Sign in to the [Azure portal][azure-portal]. If you have access to multiple tenants, use the **Directory + subscription** filter  in the top menu to select the tenant containing your client app's registration.\n-\n-#### Add Graph API Permission\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).\n-\n-2. Select **API permissions** > **Add a permission** > **Microsoft APIs** > **Microsoft Graph** > **Delegated permissions**, select **User.Read**, select **Add permission** to complete the process.\n+### Configure your middle-tier Web API A\n+1. You can follow *Web API A* sample to add `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes. Convention current application id url is `api://xxxxx-xxxx-xxxxxx`.(**NOTE**: In the **Web API A** `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes should be added to the **Web APP**.)![API Permissions](docs/image-resource-server-obo-add-scope.png)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ba6c076633d22c26d981eac86e06a44399a9317"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTYyNA==", "bodyText": "Maybe Convention of current application id is better.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549555624", "createdAt": "2020-12-29T03:32:46Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md", "diffHunk": "@@ -48,68 +55,44 @@ We need to ensure that this [environment checklist][ready-to-run-checklist] is c\n </dependencies>\n ```\n \n-### Register your Web API\n-You can follow *azure-spring-boot-sample-active-directory-resource-server* sample to add `ResourceAccessGraph.read`, `ResourceAccessGraphCustomResources.read` scopes. \n-Convention current application id url is `api://sample-client-id`, ; the application id url of the sample *azure-spring-boot-sample-active-directory-resource-server* is `custom-client-id`.  \n-After adding as shown below:\n-\n-   ![API Permissions](resource/resource-server-obo-add-scope.png)\n-\n-### Add API permissions\n-The current Web API will access Graph API and Custom API. \n-\n-Sign in to the [Azure portal][azure-portal]. If you have access to multiple tenants, use the **Directory + subscription** filter  in the top menu to select the tenant containing your client app's registration.\n-\n-#### Add Graph API Permission\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).\n-\n-2. Select **API permissions** > **Add a permission** > **Microsoft APIs** > **Microsoft Graph** > **Delegated permissions**, select **User.Read**, select **Add permission** to complete the process.\n+### Configure your middle-tier Web API A\n+1. You can follow *Web API A* sample to add `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes. Convention current application id url is `api://xxxxx-xxxx-xxxxxx`.(**NOTE**: In the **Web API A** `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes should be added to the **Web APP**.)![API Permissions](docs/image-resource-server-obo-add-scope.png)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTU5MQ=="}, "originalCommit": {"oid": "9ba6c076633d22c26d981eac86e06a44399a9317"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTY5MQ==", "bodyText": "Why do we have a concept of Web APP here?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549555691", "createdAt": "2020-12-29T03:33:11Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md", "diffHunk": "@@ -48,68 +55,44 @@ We need to ensure that this [environment checklist][ready-to-run-checklist] is c\n </dependencies>\n ```\n \n-### Register your Web API\n-You can follow *azure-spring-boot-sample-active-directory-resource-server* sample to add `ResourceAccessGraph.read`, `ResourceAccessGraphCustomResources.read` scopes. \n-Convention current application id url is `api://sample-client-id`, ; the application id url of the sample *azure-spring-boot-sample-active-directory-resource-server* is `custom-client-id`.  \n-After adding as shown below:\n-\n-   ![API Permissions](resource/resource-server-obo-add-scope.png)\n-\n-### Add API permissions\n-The current Web API will access Graph API and Custom API. \n-\n-Sign in to the [Azure portal][azure-portal]. If you have access to multiple tenants, use the **Directory + subscription** filter  in the top menu to select the tenant containing your client app's registration.\n-\n-#### Add Graph API Permission\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).\n-\n-2. Select **API permissions** > **Add a permission** > **Microsoft APIs** > **Microsoft Graph** > **Delegated permissions**, select **User.Read**, select **Add permission** to complete the process.\n+### Configure your middle-tier Web API A\n+1. You can follow *Web API A* sample to add `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes. Convention current application id url is `api://xxxxx-xxxx-xxxxxx`.(**NOTE**: In the **Web API A** `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes should be added to the **Web APP**.)![API Permissions](docs/image-resource-server-obo-add-scope.png)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTU5MQ=="}, "originalCommit": {"oid": "9ba6c076633d22c26d981eac86e06a44399a9317"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTg1MA==", "bodyText": "We don't need the Graph API permissions now?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549555850", "createdAt": "2020-12-29T03:34:18Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md", "diffHunk": "@@ -48,68 +55,44 @@ We need to ensure that this [environment checklist][ready-to-run-checklist] is c\n </dependencies>\n ```\n \n-### Register your Web API\n-You can follow *azure-spring-boot-sample-active-directory-resource-server* sample to add `ResourceAccessGraph.read`, `ResourceAccessGraphCustomResources.read` scopes. \n-Convention current application id url is `api://sample-client-id`, ; the application id url of the sample *azure-spring-boot-sample-active-directory-resource-server* is `custom-client-id`.  \n-After adding as shown below:\n-\n-   ![API Permissions](resource/resource-server-obo-add-scope.png)\n-\n-### Add API permissions\n-The current Web API will access Graph API and Custom API. \n-\n-Sign in to the [Azure portal][azure-portal]. If you have access to multiple tenants, use the **Directory + subscription** filter  in the top menu to select the tenant containing your client app's registration.\n-\n-#### Add Graph API Permission\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ba6c076633d22c26d981eac86e06a44399a9317"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjAxMw==", "bodyText": "Maybe we could remove the Sample here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549556013", "createdAt": "2020-12-29T03:35:15Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md", "diffHunk": "@@ -48,68 +55,44 @@ We need to ensure that this [environment checklist][ready-to-run-checklist] is c\n </dependencies>\n ```\n \n-### Register your Web API\n-You can follow *azure-spring-boot-sample-active-directory-resource-server* sample to add `ResourceAccessGraph.read`, `ResourceAccessGraphCustomResources.read` scopes. \n-Convention current application id url is `api://sample-client-id`, ; the application id url of the sample *azure-spring-boot-sample-active-directory-resource-server* is `custom-client-id`.  \n-After adding as shown below:\n-\n-   ![API Permissions](resource/resource-server-obo-add-scope.png)\n-\n-### Add API permissions\n-The current Web API will access Graph API and Custom API. \n-\n-Sign in to the [Azure portal][azure-portal]. If you have access to multiple tenants, use the **Directory + subscription** filter  in the top menu to select the tenant containing your client app's registration.\n-\n-#### Add Graph API Permission\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).\n-\n-2. Select **API permissions** > **Add a permission** > **Microsoft APIs** > **Microsoft Graph** > **Delegated permissions**, select **User.Read**, select **Add permission** to complete the process.\n+### Configure your middle-tier Web API A\n+1. You can follow *Web API A* sample to add `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes. Convention current application id url is `api://xxxxx-xxxx-xxxxxx`.(**NOTE**: In the **Web API A** `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes should be added to the **Web APP**.)![API Permissions](docs/image-resource-server-obo-add-scope.png)\n+2. Select **API permissions** > **Add a permission** > **My APIs**, select *Web API B* application name. ![Select MyAPIs](docs/image-select-myapis.png)\n+3. **Delegated permissions** is selected by default\uff0c Select **File** > **File.Read** permission, select **Add permission** to complete the process.![Add Permissions](docs/image-add-permissions.png)\n+4. Add **Web API B** permissions to **Web API A** and grant admin consent.![API Permissions](docs/image-add-grant-admin-consent.png)\n \n-#### Add Custom API Permission\n-\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).\n-\n-2. Select **API permissions** > **Add a permission** > **My APIs**, select *azure-spring-boot-sample-active-directory-resource-server* application name.\n-\n-3. **Delegated permissions** is selected by default\uff0c Select **File** > **File.Read** permission, select **Add permission** to complete the process.\n-\n-### Grant consent for your tenant\n-Respectively grant admin consent to the Graph and Custom permissions. After adding as shown below:\n-   ![API Permissions](resource/resource-server-obo-add-permissions.png)\n+See [OAuth 2.0 On-Behalf-Of flow] for more information about OBO.\n \n ## Examples\n-\n-### Configure application.yaml\n-\n+### Configure application.yml\n ```yaml\n azure:\n   activedirectory:\n     resource-server:\n       obo:\n         enabled: true\n-    client-id: [resource-server-application-client-id]\n-    client-secret: [resource-server-application-client-secret]\n-    tenant-id: [tenant-id-registered-by-application]\n-    app-id-uri: api://sample-client-id\n+    client-id: <Web-API-A-client-id>\n+    client-secret: <Web-API-A-client-secret>\n+    tenant-id: <tenant-id-registered-by-application>\n+    app-id-uri: <Web-API-A-app-id-url>\n     authorization:\n       graph:\n         scopes:\n           - https://graph.microsoft.com/User.Read\n       custom:\n         scopes:\n-          - api://custom-client-id/File.read\n+          - <Web-API-B-app-id-url>/File.Read\n ```\n \n-### Run with Maven \n-\n+### Run with Maven\n ```shell\n cd azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo\n mvn spring-boot:run\n ```\n \n-### Access the Web API\n-First, you need to obtain an access token to access Sample API.\n-- API will Only call Graph resource. \n+### Access the Web API A\n+First, you need to obtain an access token to access Sample Web API A.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ba6c076633d22c26d981eac86e06a44399a9317"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjY1MA==", "bodyText": "Can we change this scope to Graph.Read?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549556650", "createdAt": "2020-12-29T03:39:18Z", "author": {"login": "saragluna"}, "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/src/main/java/com/azure/spring/sample/aad/controller/SampleController.java", "diffHunk": "@@ -41,7 +41,7 @@\n      * @return Response with graph data\n      */\n     @GetMapping(\"call-graph-only\")\n-    @PreAuthorize(\"hasAuthority('SCOPE_ResourceAccessGraph.read')\")\n+    @PreAuthorize(\"hasAuthority('SCOPE_ResourceAccessGraph.Read')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ba6c076633d22c26d981eac86e06a44399a9317"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26b13bc5a53d12990c1ae0669cf88d39aa8ea0e0", "author": {"user": {"login": "ZhuXiaoBing-cn", "name": "Xiaobing Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/26b13bc5a53d12990c1ae0669cf88d39aa8ea0e0", "committedDate": "2020-12-29T08:40:55Z", "message": "Update the resource-server-obo README.md file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d66306ec88173f285960c184c68eeac33d484ed3", "author": {"user": {"login": "ZhuXiaoBing-cn", "name": "Xiaobing Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d66306ec88173f285960c184c68eeac33d484ed3", "committedDate": "2020-12-29T08:46:35Z", "message": "Merge branch 'master' into update_obo_sample_readme\n\n# Conflicts:\n#\tsdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md\n#\tsdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/src/main/resources/application.yaml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b4d05e5d01cbd4cab840676d9b143b545d0b5ae", "author": {"user": {"login": "ZhuXiaoBing-cn", "name": "Xiaobing Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7b4d05e5d01cbd4cab840676d9b143b545d0b5ae", "committedDate": "2020-12-29T08:48:27Z", "message": "Update the resource-server-obo README.md file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faeb4d7edda0c81f3bb4102a497d772021e8c7c2", "author": {"user": {"login": "ZhuXiaoBing-cn", "name": "Xiaobing Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/faeb4d7edda0c81f3bb4102a497d772021e8c7c2", "committedDate": "2020-12-29T09:26:32Z", "message": "Update the resource-server-obo README.md file and modify part of the code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78753507fe544ebdd67e2f0736f0f1ea1993a5ce", "author": {"user": {"login": "saragluna", "name": "Xiaolu Dai"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/78753507fe544ebdd67e2f0736f0f1ea1993a5ce", "committedDate": "2020-12-29T10:22:08Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83244a7d61fcb5b9beeefdc31980e36c8c3234d5", "author": {"user": {"login": "saragluna", "name": "Xiaolu Dai"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/83244a7d61fcb5b9beeefdc31980e36c8c3234d5", "committedDate": "2020-12-29T10:33:01Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13364294262e99d89d6b238d266ea57a3fba0928", "author": {"user": {"login": "saragluna", "name": "Xiaolu Dai"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/13364294262e99d89d6b238d266ea57a3fba0928", "committedDate": "2020-12-29T10:35:25Z", "message": "Update SampleController.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8beca7589da7f2b2d809a20d88702ab5801904fe", "author": {"user": {"login": "saragluna", "name": "Xiaolu Dai"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8beca7589da7f2b2d809a20d88702ab5801904fe", "committedDate": "2020-12-29T10:37:58Z", "message": "Merge branch 'master' into update_obo_sample_readme"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDc0NTcy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#pullrequestreview-559474572", "createdAt": "2020-12-29T10:39:29Z", "commit": {"oid": "8beca7589da7f2b2d809a20d88702ab5801904fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4186, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}