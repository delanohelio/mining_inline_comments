{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNzE3OTk0", "number": 9413, "title": "Add AzureKeyCredential to Azure Core", "bodyText": "This PR adds AzureKeyCredential to Azure Core and updates Search and Text Analytics to use it. The credential replaces the service specific credential, therefore SearchApiKeyCredential and TextAnalyticsApiKeyCredential have been deleted.\nAdditionally, this PR moves TextAnalyticsApiKeyPipelinePolicy into the public API in the root package.\nFor reference this is the .NET PR (Azure/azure-sdk-for-net#10668) and the TS PR (Azure/azure-sdk-for-js#7927). @maririos and @willmtemple", "createdAt": "2020-03-24T01:07:51Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413", "merged": true, "mergeCommit": {"oid": "772e6f7a7e5f99fdaa9bfe7701c6d5bd2ebd88d3"}, "closed": true, "closedAt": "2020-03-25T21:57:32Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQoSA8gH2gAyMzkyNzE3OTk0OmU5ZmJhYWNkZjRlYmYwYjVkYWNiYTAxZjU4ZTNkOWM1ODM4ZDQwMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcROx7YAFqTM4MTU2NjA2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e9fbaacdf4ebf0b5dacba01f58e3d9c5838d4026", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e9fbaacdf4ebf0b5dacba01f58e3d9c5838d4026", "committedDate": "2020-03-24T01:04:45Z", "message": "Added AzureKeyCredential in Azure Core and updated Search and Text Analytics to use it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ea3d6920c12836f42f28f82992a359c23e43da9", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2ea3d6920c12836f42f28f82992a359c23e43da9", "committedDate": "2020-03-24T01:10:34Z", "message": "Update builders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b075127765a8ec35ac69f2b2f267bf6697b91da9", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b075127765a8ec35ac69f2b2f267bf6697b91da9", "committedDate": "2020-03-24T16:27:49Z", "message": "Update other locations using module specific key credential"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60695b742747409c47f441e0fd06c67ca4582fe0", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/60695b742747409c47f441e0fd06c67ca4582fe0", "committedDate": "2020-03-24T16:52:25Z", "message": "Merge branch 'master' into AzCore_AddApiKeyCredential"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40a3217fbe87a1a031723b5547316004aea41990", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/40a3217fbe87a1a031723b5547316004aea41990", "committedDate": "2020-03-24T16:57:58Z", "message": "Fixed doc typos and grammar, updated Text Analytics policy to throw when using HTTP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b121da47d09b25a8aaafb59094aed79c10b96cc9", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b121da47d09b25a8aaafb59094aed79c10b96cc9", "committedDate": "2020-03-24T17:24:01Z", "message": "Update fallback endpoint for playback to use HTTPS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjY4OTgx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#pullrequestreview-380668981", "createdAt": "2020-03-24T20:25:22Z", "commit": {"oid": "b121da47d09b25a8aaafb59094aed79c10b96cc9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDoyNToyMlrOF7BtGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDoyNToyMlrOF7BtGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQzODIzNA==", "bodyText": "Could we name this method update to be consistent across languages?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#discussion_r397438234", "createdAt": "2020-03-24T20:25:22Z", "author": {"login": "maririos"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/credential/AzureKeyCredential.java", "diffHunk": "@@ -0,0 +1,59 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.credential;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Objects;\n+\n+/**\n+ * Represents a credential that uses a key authenticate to an Azure Service.\n+ */\n+public class AzureKeyCredential {\n+    private final ClientLogger logger = new ClientLogger(AzureKeyCredential.class);\n+    private String key;\n+\n+    /**\n+     * Creates a credential that authorizes request with the given key.\n+     *\n+     * @param key The key used to authorize requests.\n+     * @throws NullPointerException If {@code key} is {@code null}.\n+     * @throws IllegalArgumentException If {@code key} is an empty string.\n+     */\n+    public AzureKeyCredential(String key) {\n+        Objects.requireNonNull(key);\n+        if (key.isEmpty()) {\n+            throw logger.logExceptionAsError(new IllegalArgumentException(\"'key' cannot be empty.\"));\n+        }\n+\n+        this.key = key;\n+    }\n+\n+    /**\n+     * Retrieves the key associated to this credential.\n+     *\n+     * @return The key being used to authorize requests.\n+     */\n+    public String getKey() {\n+        return key;\n+    }\n+\n+    /**\n+     * Rotates the key associated to this credential.\n+     *\n+     * @param key The new key to associated with this credential.\n+     * @return The updated {@code ApiKeyCredential} object.\n+     * @throws NullPointerException If {@code key} is {@code null}.\n+     * @throws IllegalArgumentException If {@code key} is an empty string.\n+     */\n+    public AzureKeyCredential updateKey(String key) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b121da47d09b25a8aaafb59094aed79c10b96cc9"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85172d9c990c3c4f3158cbf8406d5d57aec36b81", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/85172d9c990c3c4f3158cbf8406d5d57aec36b81", "committedDate": "2020-03-24T20:27:38Z", "message": "Merge branch 'master' into AzCore_AddApiKeyCredential"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "874666292403307f811e3a60ade7465b87b66ea7", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/874666292403307f811e3a60ade7465b87b66ea7", "committedDate": "2020-03-24T20:31:06Z", "message": "Renamed updateKey to update, added CHANGELOG notes for the change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjc5OTUx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#pullrequestreview-380679951", "createdAt": "2020-03-24T20:41:31Z", "commit": {"oid": "874666292403307f811e3a60ade7465b87b66ea7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDo0MTozMVrOF7CQhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDo0MTozMVrOF7CQhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0NzMwMw==", "bodyText": "Could the policies be private?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#discussion_r397447303", "createdAt": "2020-03-24T20:41:31Z", "author": {"login": "maririos"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/documents/SearchApiKeyPipelinePolicy.java", "diffHunk": "@@ -12,31 +13,37 @@\n import java.util.Objects;\n \n /**\n- * Policy that adds the Cognitive Search Service api-key into the request's Authorization header.\n+ * Pipeline policy that uses an {@link AzureKeyCredential} to set the {@code api-key} header which authorizes requests\n+ * sent to the Azure Search service.\n+ *\n+ * <p>\n+ * Requests sent with this pipeline policy are required to use {@code HTTPS}. If the request isn't using {@code HTTPS}\n+ * an exception will be thrown to prevent leaking the key.\n  */\n public final class SearchApiKeyPipelinePolicy implements HttpPipelinePolicy {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874666292403307f811e3a60ade7465b87b66ea7"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjgwNTgy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#pullrequestreview-380680582", "createdAt": "2020-03-24T20:42:25Z", "commit": {"oid": "874666292403307f811e3a60ade7465b87b66ea7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDo0MjoyNlrOF7CScQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDo0MjoyNlrOF7CScQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0Nzc5Mw==", "bodyText": "So this means that every client needs to implement it's own policy, is that correct?\nWondering if we could add a generic policy to Azure Core too", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#discussion_r397447793", "createdAt": "2020-03-24T20:42:26Z", "author": {"login": "maririos"}, "path": "sdk/search/azure-search/src/main/java/com/azure/search/documents/SearchApiKeyPipelinePolicy.java", "diffHunk": "@@ -12,31 +13,37 @@\n import java.util.Objects;\n \n /**\n- * Policy that adds the Cognitive Search Service api-key into the request's Authorization header.\n+ * Pipeline policy that uses an {@link AzureKeyCredential} to set the {@code api-key} header which authorizes requests\n+ * sent to the Azure Search service.\n+ *\n+ * <p>\n+ * Requests sent with this pipeline policy are required to use {@code HTTPS}. If the request isn't using {@code HTTPS}\n+ * an exception will be thrown to prevent leaking the key.\n  */\n public final class SearchApiKeyPipelinePolicy implements HttpPipelinePolicy {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874666292403307f811e3a60ade7465b87b66ea7"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzM4ODAy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#pullrequestreview-381338802", "createdAt": "2020-03-25T16:47:07Z", "commit": {"oid": "874666292403307f811e3a60ade7465b87b66ea7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjo0NzowN1rOF7kdyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjo0NzowN1rOF7kdyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAwNzc1Mg==", "bodyText": "Could you use one check of CoreUtil.isNullOrEmpty() here?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#discussion_r398007752", "createdAt": "2020-03-25T16:47:07Z", "author": {"login": "sima-zhu"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/credential/AzureKeyCredential.java", "diffHunk": "@@ -0,0 +1,59 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.credential;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Objects;\n+\n+/**\n+ * Represents a credential that uses a key authenticate to an Azure Service.\n+ */\n+public class AzureKeyCredential {\n+    private final ClientLogger logger = new ClientLogger(AzureKeyCredential.class);\n+    private String key;\n+\n+    /**\n+     * Creates a credential that authorizes request with the given key.\n+     *\n+     * @param key The key used to authorize requests.\n+     * @throws NullPointerException If {@code key} is {@code null}.\n+     * @throws IllegalArgumentException If {@code key} is an empty string.\n+     */\n+    public AzureKeyCredential(String key) {\n+        Objects.requireNonNull(key);\n+        if (key.isEmpty()) {\n+            throw logger.logExceptionAsError(new IllegalArgumentException(\"'key' cannot be empty.\"));\n+        }\n+\n+        this.key = key;\n+    }\n+\n+    /**\n+     * Retrieves the key associated to this credential.\n+     *\n+     * @return The key being used to authorize requests.\n+     */\n+    public String getKey() {\n+        return key;\n+    }\n+\n+    /**\n+     * Rotates the key associated to this credential.\n+     *\n+     * @param key The new key to associated with this credential.\n+     * @return The updated {@code ApiKeyCredential} object.\n+     * @throws NullPointerException If {@code key} is {@code null}.\n+     * @throws IllegalArgumentException If {@code key} is an empty string.\n+     */\n+    public AzureKeyCredential update(String key) {\n+        Objects.requireNonNull(key);\n+        if (key.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874666292403307f811e3a60ade7465b87b66ea7"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzUwMzE3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#pullrequestreview-381350317", "createdAt": "2020-03-25T16:59:46Z", "commit": {"oid": "874666292403307f811e3a60ade7465b87b66ea7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzYwMTE2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#pullrequestreview-381360116", "createdAt": "2020-03-25T17:10:37Z", "commit": {"oid": "874666292403307f811e3a60ade7465b87b66ea7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a94714177b2f781b64d56afbc920a0bd9dcbbd36", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a94714177b2f781b64d56afbc920a0bd9dcbbd36", "committedDate": "2020-03-25T17:56:47Z", "message": "Merged in master and resolved merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "083a98ded2779c22124a93c115a3eff717bc4791", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/083a98ded2779c22124a93c115a3eff717bc4791", "committedDate": "2020-03-25T17:58:38Z", "message": "Added exception message to key null checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "553b537b3cda2592a80a2e8f59207c7c9ed80a53", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/553b537b3cda2592a80a2e8f59207c7c9ed80a53", "committedDate": "2020-03-25T18:09:15Z", "message": "Merge branch 'master' into AzCore_AddApiKeyCredential"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fad1afadfe53b6aabc79cf6526fb9cc632564fa", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6fad1afadfe53b6aabc79cf6526fb9cc632564fa", "committedDate": "2020-03-25T18:11:36Z", "message": "Removed unused imports, update default endpoint to HTTPS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e3fa625f1ee9367ac36b8f3d853e24438321a97", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7e3fa625f1ee9367ac36b8f3d853e24438321a97", "committedDate": "2020-03-25T21:05:35Z", "message": "Merged in master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "422d0e386da293db94e1642fdacd1828a84d73cf", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/422d0e386da293db94e1642fdacd1828a84d73cf", "committedDate": "2020-03-25T21:26:12Z", "message": "Remove classes added back in merged from master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNTY2MDYy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9413#pullrequestreview-381566062", "createdAt": "2020-03-25T21:56:01Z", "commit": {"oid": "422d0e386da293db94e1642fdacd1828a84d73cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1500, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}