{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MjY5NjMz", "number": 14155, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoyMzozOVrOEZHbPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo1ODoxMlrOEZLzSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzcxNTE2OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ConsistencyPolicy.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoyMzozOVrOHBvyWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoyMzozOVrOHBvyWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5MzU2MQ==", "bodyText": "in the other places we don't call this \"cached\" to be consistency please rename to consistencyLevel\nplease see DocumentCollection as example.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14155#discussion_r471593561", "createdAt": "2020-08-17T16:23:39Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ConsistencyPolicy.java", "diffHunk": "@@ -129,4 +135,10 @@ public ConsistencyPolicy setMaxStalenessInterval(Duration maxStalenessInterval)\n         super.set(Constants.Properties.MAX_STALENESS_INTERVAL_IN_SECONDS, maxStalenessInterval.getSeconds());\n         return this;\n     }\n+\n+    /**\n+     * Assumption: all consistency mutations are through setDefaultConsistencyLevel only.\n+     * NOTE: If the underlying ObjectNode is mutated cache might be stale\n+     */\n+    private ConsistencyLevel cachedConsistencyLevel = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbf5e858119edff5aacf4a186fd529252cf1d7b3"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzcyNDkwOnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ConsistencyPolicy.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoyNjowOVrOHBv4TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoyNjowOVrOHBv4TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5NTA4NQ==", "bodyText": "please use the following instead:\nConsistencyLevel.fromServiceSerializedFormat(.)\nif the method is not accessible from this package use:\nBridgeInternal.fromServiceSerializedFormat()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14155#discussion_r471595085", "createdAt": "2020-08-17T16:26:09Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ConsistencyPolicy.java", "diffHunk": "@@ -52,16 +52,21 @@ public ConsistencyPolicy(String jsonString) {\n      */\n     public ConsistencyLevel getDefaultConsistencyLevel() {\n \n-        ConsistencyLevel result = ConsistencyPolicy.DEFAULT_DEFAULT_CONSISTENCY_LEVEL;\n-        String consistencyLevelString = super.getString(Constants.Properties.DEFAULT_CONSISTENCY_LEVEL);\n-        try {\n-            result = ConsistencyLevel\n-                         .valueOf(CaseFormat.UPPER_CAMEL.to(CaseFormat.UPPER_UNDERSCORE, consistencyLevelString));\n-        } catch (IllegalArgumentException e) {\n-            // ignore the exception and return the default\n-            this.getLogger().warn(\"Unknown consistency level {}, value ignored.\", consistencyLevelString);\n+        if (this.cachedConsistencyLevel == null) {\n+            ConsistencyLevel result = ConsistencyPolicy.DEFAULT_DEFAULT_CONSISTENCY_LEVEL;\n+            String consistencyLevelString = super.getString(Constants.Properties.DEFAULT_CONSISTENCY_LEVEL);\n+            try {\n+                result = ConsistencyLevel\n+                    .valueOf(CaseFormat.UPPER_CAMEL.to(CaseFormat.UPPER_UNDERSCORE, consistencyLevelString));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbf5e858119edff5aacf4a186fd529252cf1d7b3"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0ODQzMjA5OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ConsistencyPolicy.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo1ODoxMlrOHB3Ezw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo1ODo0M1rOHB3F6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcxMjk3NQ==", "bodyText": "you don't need ConsistencyLeve.valueOf() here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14155#discussion_r471712975", "createdAt": "2020-08-17T18:58:12Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ConsistencyPolicy.java", "diffHunk": "@@ -52,21 +53,21 @@ public ConsistencyPolicy(String jsonString) {\n      */\n     public ConsistencyLevel getDefaultConsistencyLevel() {\n \n-        if (this.cachedConsistencyLevel == null) {\n+        if (this.consistencyLevel == null) {\n             ConsistencyLevel result = ConsistencyPolicy.DEFAULT_DEFAULT_CONSISTENCY_LEVEL;\n             String consistencyLevelString = super.getString(Constants.Properties.DEFAULT_CONSISTENCY_LEVEL);\n             try {\n                 result = ConsistencyLevel\n-                    .valueOf(CaseFormat.UPPER_CAMEL.to(CaseFormat.UPPER_UNDERSCORE, consistencyLevelString));\n+                    .valueOf(BridgeInternal.fromServiceSerializedFormat(consistencyLevelString));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d742bf0231c616196b412d7b3cf954461637405b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcxMzI1Nw==", "bodyText": "please change to\nresult = BridgeInternal.fromServiceSerializedFormat(consistencyLevelString)", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14155#discussion_r471713257", "createdAt": "2020-08-17T18:58:43Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ConsistencyPolicy.java", "diffHunk": "@@ -52,21 +53,21 @@ public ConsistencyPolicy(String jsonString) {\n      */\n     public ConsistencyLevel getDefaultConsistencyLevel() {\n \n-        if (this.cachedConsistencyLevel == null) {\n+        if (this.consistencyLevel == null) {\n             ConsistencyLevel result = ConsistencyPolicy.DEFAULT_DEFAULT_CONSISTENCY_LEVEL;\n             String consistencyLevelString = super.getString(Constants.Properties.DEFAULT_CONSISTENCY_LEVEL);\n             try {\n                 result = ConsistencyLevel\n-                    .valueOf(CaseFormat.UPPER_CAMEL.to(CaseFormat.UPPER_UNDERSCORE, consistencyLevelString));\n+                    .valueOf(BridgeInternal.fromServiceSerializedFormat(consistencyLevelString));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcxMjk3NQ=="}, "originalCommit": {"oid": "d742bf0231c616196b412d7b3cf954461637405b"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1623, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}