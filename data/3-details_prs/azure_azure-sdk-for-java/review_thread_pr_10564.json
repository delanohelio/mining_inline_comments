{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5OTE1NzU5", "number": 10564, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjo0NTowNVrOD31ArQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDozOToyMlrOEOeywQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODY2Nzk3OnYy", "diffSide": "RIGHT", "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjo0NTowNVrOGOTtEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMDoxMTo1OFrOG0dl6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NjA4MQ==", "bodyText": "comment on the end can be deleted as it no longer applies.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r417656081", "createdAt": "2020-04-29T22:45:05Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI\n+          goals: 'deploy'\n+          options: '$(DefaultOptions) -DskipTests -Dinject-codesnippets -Dgenerate-overview -Dspotbugs.skip=true -Dcheckstyle.skip=true -Drevapi.skip=true -pl $(ProjectList) -am -DaltDeploymentRepository=id::default::file://$(Build.ArtifactStagingDirectory)' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NzQ2OA==", "bodyText": "Can we run deploy on just the main project so we can do something\nlike file://$(Build.ArtifactStagingDirectory)/$(ServiceDirectory)? Wouldn't that give us the easy segregation of the artifacts so we don't have to do any crazy filename matching in our release templates? Nor do we need to do extra copying.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r417657468", "createdAt": "2020-04-29T22:49:19Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI\n+          goals: 'deploy'\n+          options: '$(DefaultOptions) -DskipTests -Dinject-codesnippets -Dgenerate-overview -Dspotbugs.skip=true -Dcheckstyle.skip=true -Drevapi.skip=true -pl $(ProjectList) -am -DaltDeploymentRepository=id::default::file://$(Build.ArtifactStagingDirectory)' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NjA4MQ=="}, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE4NDQ0Mg==", "bodyText": "I don't think that would help unfortunately since all projects in scope of the reactor would get put into that directory anyway ... unless I am missing something. It is one of the downsides of the deploy goal approach which is that you need to cater for version numbers in the paths at some point down the line.\nI don't think we can avoid the crazy copying all together, its just a case of where we put it. If given a choice between laying out the artifacts to Maven standard repository layout or something we come up with ourselves, I'd prefer to go Maven standard...", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r419184442", "createdAt": "2020-05-04T01:13:46Z", "author": {"login": "mitchdenny"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI\n+          goals: 'deploy'\n+          options: '$(DefaultOptions) -DskipTests -Dinject-codesnippets -Dgenerate-overview -Dspotbugs.skip=true -Dcheckstyle.skip=true -Drevapi.skip=true -pl $(ProjectList) -am -DaltDeploymentRepository=id::default::file://$(Build.ArtifactStagingDirectory)' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NjA4MQ=="}, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU2MzcyNw==", "bodyText": "As long as the output deployment directory doesn't have any thing other then the assets that are going to be published (i.e. they don't contain dependencies and referenced stuff) then I don't think we have to worry about the version number in the directory. We can turn all the logic in our yml files to always take everything under the name of the artifact and eliminated the need for version wildcards and extra copying.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r419563727", "createdAt": "2020-05-04T16:27:39Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI\n+          goals: 'deploy'\n+          options: '$(DefaultOptions) -DskipTests -Dinject-codesnippets -Dgenerate-overview -Dspotbugs.skip=true -Dcheckstyle.skip=true -Drevapi.skip=true -pl $(ProjectList) -am -DaltDeploymentRepository=id::default::file://$(Build.ArtifactStagingDirectory)' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NjA4MQ=="}, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY2Mzk3OA==", "bodyText": "@mitchdenny did we give up on the idea of having each artifact set published to its own folder in the \"DevOps artifact\"?  We have been seeing too many issues with doing the copying in various release tasks and I'd much prefer we avoid those issues by having the exact set of artifacts for a given package under a folder with that package name. Even if we have to do this copying once in the build stage that will make our lives so much easier in the various release stages that need to be correctly configured to copy the correct files.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r457663978", "createdAt": "2020-07-20T20:11:58Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI\n+          goals: 'deploy'\n+          options: '$(DefaultOptions) -DskipTests -Dinject-codesnippets -Dgenerate-overview -Dspotbugs.skip=true -Dcheckstyle.skip=true -Drevapi.skip=true -pl $(ProjectList) -am -DaltDeploymentRepository=id::default::file://$(Build.ArtifactStagingDirectory)' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1NjA4MQ=="}, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODY4MTc5OnYy", "diffSide": "LEFT", "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjo1MToyN1rOGOT1Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwMToxMDo0OVrOGPw-EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1ODIwNg==", "bodyText": "We probably should also remove the packageOutputDirectory property and the ant copy step after we make this switch to deploy.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r417658206", "createdAt": "2020-04-29T22:51:27Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA1MzcxNg==", "bodyText": "@weshaggard do we really want to remove that? I know when I'm building locally I typically set the packageOutputDirectory on my command line, it's more of an ease of use thing.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r418053716", "createdAt": "2020-04-30T14:29:52Z", "author": {"login": "JimSuplizio"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1ODIwNg=="}, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg3Mjc4Nw==", "bodyText": "If we want deploy to the be the main goal for producing output then maybe we do want to remove it.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r418872787", "createdAt": "2020-05-02T03:54:40Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1ODIwNg=="}, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE4NDE0NQ==", "bodyText": "I know for me it was one of those things that confused me when I first started working with Maven in depth on these team. I assumed that it was something that Maven did automatically until I realized we had this bit of Ant magic in our parent POM.\nI'm all for magic if it is truly useful, but given Maven provides an OOB solution for spitting packages into a repository I'm not sure its that useful, and is possibly confusing.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r419184145", "createdAt": "2020-05-04T01:10:49Z", "author": {"login": "mitchdenny"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -113,8 +113,8 @@ jobs:\n         displayName: 'Build and Package'\n         inputs:\n           mavenPomFile: pom.xml\n-          goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1ODIwNg=="}, "originalCommit": {"oid": "17452b345aade7badef42193b7276b6bbaf5a6a5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjE2ODIzOnYy", "diffSide": "RIGHT", "path": "eng/pipelines/templates/steps/stage-artifacts.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDoyMTozNlrOGxpztg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDoyNToyNlrOGxp3tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcxODM5MA==", "bodyText": "we've hardcoded template here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r454718390", "createdAt": "2020-07-15T00:21:36Z", "author": {"login": "scbedd"}, "path": "eng/pipelines/templates/steps/stage-artifacts.yml", "diffHunk": "@@ -6,5 +6,10 @@ parameters:\n steps:\n   - pwsh: |\n       New-Item -Force -Type Directory -Name ${{parameters.TargetFolder}} -Path $(Pipeline.Workspace)\n-      Copy-Item $(Pipeline.Workspace)/${{parameters.SourceFolder}}/${{parameters.PackageName}}-[0-9]*.[0-9]*.[0-9]* $(Pipeline.Workspace)/${{parameters.TargetFolder}}\n-    displayName: Stage artifacts\n\\ No newline at end of file\n+      $items = Get-ChildItem -Recurse -Path $(Pipeline.Workspace)/${{parameters.SourceFolder}} \n+      Write-Host \"Found $($items.Count) total items in source folder\"\n+      $filteredItems = $items | Where-Object -FilterScript { $_.Name -like \"azure-sdk-template-[0-9]*.[0-9]*.[0-9]*-*\" }      ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eb3c4c2093e361f6615c22c7de7d51fff3308b6"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcxOTQxNQ==", "bodyText": "Probably {{ params.PackageName }} instead of azure-template right?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r454719415", "createdAt": "2020-07-15T00:25:26Z", "author": {"login": "scbedd"}, "path": "eng/pipelines/templates/steps/stage-artifacts.yml", "diffHunk": "@@ -6,5 +6,10 @@ parameters:\n steps:\n   - pwsh: |\n       New-Item -Force -Type Directory -Name ${{parameters.TargetFolder}} -Path $(Pipeline.Workspace)\n-      Copy-Item $(Pipeline.Workspace)/${{parameters.SourceFolder}}/${{parameters.PackageName}}-[0-9]*.[0-9]*.[0-9]* $(Pipeline.Workspace)/${{parameters.TargetFolder}}\n-    displayName: Stage artifacts\n\\ No newline at end of file\n+      $items = Get-ChildItem -Recurse -Path $(Pipeline.Workspace)/${{parameters.SourceFolder}} \n+      Write-Host \"Found $($items.Count) total items in source folder\"\n+      $filteredItems = $items | Where-Object -FilterScript { $_.Name -like \"azure-sdk-template-[0-9]*.[0-9]*.[0-9]*-*\" }      ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcxODM5MA=="}, "originalCommit": {"oid": "8eb3c4c2093e361f6615c22c7de7d51fff3308b6"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjIwMDMzOnYy", "diffSide": "RIGHT", "path": "eng/pipelines/templates/steps/stage-artifacts.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDozOToyMlrOGxqGAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDozOToyMlrOGxqGAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyMzA3NQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10564#discussion_r454723075", "createdAt": "2020-07-15T00:39:22Z", "author": {"login": "scbedd"}, "path": "eng/pipelines/templates/steps/stage-artifacts.yml", "diffHunk": "@@ -6,5 +6,10 @@ parameters:\n steps:\n   - pwsh: |\n       New-Item -Force -Type Directory -Name ${{parameters.TargetFolder}} -Path $(Pipeline.Workspace)\n-      Copy-Item $(Pipeline.Workspace)/${{parameters.SourceFolder}}/${{parameters.PackageName}}-[0-9]*.[0-9]*.[0-9]* $(Pipeline.Workspace)/${{parameters.TargetFolder}}\n-    displayName: Stage artifacts\n\\ No newline at end of file\n+      $items = Get-ChildItem -Recurse -Path $(Pipeline.Workspace)/${{parameters.SourceFolder}} \n+      Write-Host \"Found $($items.Count) total items in source folder\"\n+      $filteredItems = $items | Where-Object -FilterScript { $_.Name -like \"${{parameters.PackageName}}-[0-9]*.[0-9]*.[0-9]*-*\" }      ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d5128cdbf861dd02fe2526a51f1994d1267e475"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4507, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}