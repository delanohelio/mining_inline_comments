{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMDk3Mzg5", "number": 7313, "title": "Storage ARM Template for live tests", "bodyText": "Our goal is to create common Azure resources using ARM template for each module. And pipeline to manage common resources and drop them in end. This will save cost and remove unwanted resources after test is complete or stopped in between\nStorage will have one common arm template for Queue, File and Blob.\nThe pipeline will run ARM template and create common resources for example resource group, Accounts etc.\nThe pipeline will pass on names of these resources as ENV variable into test. For example PRIMARY_STORAGE_ACCOUNT_NAME\nIn the end pipeline will also delete these common resources which it created earlier and that will cause all the resources created to be removed.", "createdAt": "2020-01-09T18:29:37Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313", "merged": true, "mergeCommit": {"oid": "49ade3d31654a8c50bcf65ef10a4e1be9e0d77bc"}, "closed": true, "closedAt": "2020-01-09T21:46:42Z", "author": {"login": "hemanttanwar"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4uPUNgH2gAyMzYxMDk3Mzg5OjJkODNkYTg3NDc4NWEzOGYyNWFiYTVkZjRlOTg2MDBjYmU0YTNlYWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4x2PggFqTM0MDg2MDIyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d83da874785a38f25aba5df4e98600cbe4a3eab", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d83da874785a38f25aba5df4e98600cbe4a3eab", "committedDate": "2020-01-09T18:27:03Z", "message": "Added ARM template  for storage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzMyMTky", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#pullrequestreview-340732192", "createdAt": "2020-01-09T18:40:22Z", "commit": {"oid": "2d83da874785a38f25aba5df4e98600cbe4a3eab"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo0MDoyMlrOFb_qXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo0MToyNVrOFb_sJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5ODkxMA==", "bodyText": "Remove this as it will scope the Storage tests to a smaller matrix", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#discussion_r364898910", "createdAt": "2020-01-09T18:40:22Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/tests.yml", "diffHunk": "@@ -3,30 +3,36 @@ trigger: none\n jobs:\n   - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n     parameters:\n+      Matrix:\n+        Windows - Java 8:\n+            OSName: 'Windows'\n+            OSVmImage: 'windows-2019'\n+            JavaVersion: '1.8'\n+            DisplayName: 'Windows - Java 8'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d83da874785a38f25aba5df4e98600cbe4a3eab"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5OTEzNw==", "bodyText": "Remove this line, its adding an environment variable of TimeoutInMinutes which isn't needed", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#discussion_r364899137", "createdAt": "2020-01-09T18:40:50Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/tests.yml", "diffHunk": "@@ -3,30 +3,36 @@ trigger: none\n jobs:\n   - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n     parameters:\n+      Matrix:\n+        Windows - Java 8:\n+            OSName: 'Windows'\n+            OSVmImage: 'windows-2019'\n+            JavaVersion: '1.8'\n+            DisplayName: 'Windows - Java 8'\n       ServiceDirectory: storage\n+      TimeoutInMinutes: 240\n       EnvVars:\n         AZURE_TEST_MODE: LIVE\n         AZURE_TENANT_ID: $(aad-azure-sdk-test-tenant-id)\n         AZURE_CLIENT_ID: $(aad-azure-sdk-test-client-id)\n         AZURE_CLIENT_SECRET: $(aad-azure-sdk-test-client-secret)\n-        PRIMARY_STORAGE_ACCOUNT_NAME: $(java-storage-test-primary-account-name)\n-        PRIMARY_STORAGE_ACCOUNT_KEY: $(java-storage-test-primary-account-key)\n-        SECONDARY_STORAGE_ACCOUNT_NAME: $(java-storage-test-secondary-account-name)\n-        SECONDARY_STORAGE_ACCOUNT_KEY: $(java-storage-test-secondary-account-key)\n-        BLOB_STORAGE_ACCOUNT_NAME: $(java-storage-test-blob-account-name)\n-        BLOB_STORAGE_ACCOUNT_KEY: $(java-storage-test-blob-account-key)\n-        PREMIUM_STORAGE_ACCOUNT_NAME: $(java-storage-test-premium-account-name)\n-        PREMIUM_STORAGE_ACCOUNT_KEY: $(java-storage-test-premium-account-key)\n-        AZURE_STORAGE_ACCESS_KEY: $(java-storage-test-access-key)\n-        AZURE_STORAGE_FILE_ENDPOINT: $(java-storage-test-file-endpoint)\n-        AZURE_STORAGE_FILE_CONNECTION_STRING: $(java-storage-test-file-connection-string)\n-        AZURE_STORAGE_QUEUE_ENDPOINT: $(java-storage-test-queue-endpoint)\n-        AZURE_STORAGE_QUEUE_CONNECTION_STRING: $(java-storage-test-queue-connection-string)\n-        AZURE_STORAGE_BLOB_CONNECTION_STRING: $(java-storage-test-blob-connection-string)\n-        STORAGE_DATA_LAKE_ACCOUNT_NAME: $(java-storage-data-lake-account-name)\n-        STORAGE_DATA_LAKE_ACCOUNT_KEY: $(java-storage-data-lake-account-key)\n-        AZURE_STORAGE_FILE_ACCOUNT_NAME: $(java-storage-account-name)\n-        AZURE_STORAGE_FILE_ACCOUNT_KEY: $(java-storage-account-key)\n-        AZURE_STORAGE_QUEUE_ACCOUNT_NAME: $(java-storage-account-name)\n-        AZURE_STORAGE_QUEUE_ACCOUNT_KEY: $(java-storage-account-key)\n-      TimeoutInMinutes: 120\n+        PRIMARY_STORAGE_ACCOUNT_NAME: $(PRIMARY_STORAGE_ACCOUNT_NAME)\n+        PRIMARY_STORAGE_ACCOUNT_KEY: $(PRIMARY_STORAGE_ACCOUNT_KEY)\n+        SECONDARY_STORAGE_ACCOUNT_NAME: $(SECONDARY_STORAGE_ACCOUNT_NAME)\n+        SECONDARY_STORAGE_ACCOUNT_KEY: $(SECONDARY_STORAGE_ACCOUNT_KEY)\n+        BLOB_STORAGE_ACCOUNT_NAME: $(BLOB_STORAGE_ACCOUNT_NAME)\n+        BLOB_STORAGE_ACCOUNT_KEY: $(BLOB_STORAGE_ACCOUNT_KEY)\n+        PREMIUM_STORAGE_ACCOUNT_NAME: $(PREMIUM_STORAGE_ACCOUNT_NAME)\n+        PREMIUM_STORAGE_ACCOUNT_KEY: $(PREMIUM_STORAGE_ACCOUNT_KEY)\n+        AZURE_STORAGE_FILE_ENDPOINT: $(AZURE_STORAGE_FILE_ENDPOINT)\n+        AZURE_STORAGE_FILE_CONNECTION_STRING: $(AZURE_STORAGE_FILE_CONNECTION_STRING)\n+        AZURE_STORAGE_QUEUE_ENDPOINT: $(AZURE_STORAGE_QUEUE_ENDPOINT)\n+        AZURE_STORAGE_QUEUE_CONNECTION_STRING: $(AZURE_STORAGE_QUEUE_CONNECTION_STRING)\n+        AZURE_STORAGE_BLOB_CONNECTION_STRING: $(AZURE_STORAGE_BLOB_CONNECTION_STRING)\n+        STORAGE_DATA_LAKE_ACCOUNT_NAME: $(STORAGE_DATA_LAKE_ACCOUNT_NAME)\n+        STORAGE_DATA_LAKE_ACCOUNT_KEY: $(STORAGE_DATA_LAKE_ACCOUNT_KEY)\n+        AZURE_STORAGE_FILE_ACCOUNT_NAME: $(AZURE_STORAGE_FILE_ACCOUNT_NAME)\n+        AZURE_STORAGE_FILE_ACCOUNT_KEY: $(AZURE_STORAGE_FILE_ACCOUNT_KEY)\n+        AZURE_STORAGE_QUEUE_ACCOUNT_NAME: $(AZURE_STORAGE_FILE_ACCOUNT_NAME)\n+        AZURE_STORAGE_QUEUE_ACCOUNT_KEY: $(AZURE_STORAGE_QUEUE_ACCOUNT_KEY)\n+        TimeoutInMinutes: 120", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d83da874785a38f25aba5df4e98600cbe4a3eab"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5OTM2NQ==", "bodyText": "Let's use a 2 hour timeout since the complete test suite only takes about 60-75 minutes, anything longer and there is likely an issue in our tests.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#discussion_r364899365", "createdAt": "2020-01-09T18:41:25Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/tests.yml", "diffHunk": "@@ -3,30 +3,36 @@ trigger: none\n jobs:\n   - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n     parameters:\n+      Matrix:\n+        Windows - Java 8:\n+            OSName: 'Windows'\n+            OSVmImage: 'windows-2019'\n+            JavaVersion: '1.8'\n+            DisplayName: 'Windows - Java 8'\n       ServiceDirectory: storage\n+      TimeoutInMinutes: 240", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d83da874785a38f25aba5df4e98600cbe4a3eab"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae14f0589a71185153f6d057214f453afeef5199", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ae14f0589a71185153f6d057214f453afeef5199", "committedDate": "2020-01-09T18:48:50Z", "message": "Review  comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a2880c407be2ae4551c4eed76a17c58738dae23", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2a2880c407be2ae4551c4eed76a17c58738dae23", "committedDate": "2020-01-09T21:02:35Z", "message": "adding back remore  resources step."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwODEyNjI4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#pullrequestreview-340812628", "createdAt": "2020-01-09T21:03:57Z", "commit": {"oid": "2a2880c407be2ae4551c4eed76a17c58738dae23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwODYwMjI4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#pullrequestreview-340860228", "createdAt": "2020-01-09T22:39:16Z", "commit": {"oid": "2a2880c407be2ae4551c4eed76a17c58738dae23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMjozOToxNlrOFcFhkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMjozOToxNlrOFcFhkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk5NDk2MA==", "bodyText": "@danieljurek: Should this be condition: always() instead?  Or are these equivalent?  I assume the intent is to ensure cleanup is always run regardless of earlier failures.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#discussion_r364994960", "createdAt": "2020-01-09T22:39:16Z", "author": {"login": "mikeharder"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -69,6 +102,25 @@ jobs:\n           ${{ insert }}: ${{ parameters.TestStepMavenInputs }}\n         env: ${{ parameters.EnvVars }}\n \n+      - ${{ parameters.PostRunSteps }}\n+\n+      - pwsh: >-\n+          eng/Remove-TestResources.ps1\n+          -BaseName $(BaseName)\n+          -ServiceDirectory ${{ parameters.ServiceDirectory }}\n+          -TenantId $env:TENANT_ID\n+          -ProvisionerApplicationId $env:PROVISIONER_APPLICATION_ID\n+          -ProvisionerApplicationSecret $env:PROVISIONER_APPLICATION_SECRET\n+          -Force\n+          -Verbose\n+        env:\n+          TENANT_ID: $(aad-azure-sdk-test-tenant-id)\n+          PROVISIONER_APPLICATION_ID: $(provisioner-aad-id)\n+          PROVISIONER_APPLICATION_SECRET: $(provisioner-aad-secret)\n+        displayName: Remove Test Resources\n+        condition: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a2880c407be2ae4551c4eed76a17c58738dae23"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 605, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}