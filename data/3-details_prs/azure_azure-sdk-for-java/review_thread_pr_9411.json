{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjg1OTg4", "number": 9411, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTowNDowNFrODqpOcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxNjozMFrODqpVRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDQyMjI3OnYy", "diffSide": "RIGHT", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ReceiveMessageOptions.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTowNDowNFrOF6hGLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODoyMzo1OVrOF69jMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwMzk4Mg==", "bodyText": "ReceiveMessageOptions :  Should this be removed ? You have added these properties in  ServiceBusReceiverBuilder already.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#discussion_r396903982", "createdAt": "2020-03-24T05:04:04Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ReceiveMessageOptions.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM0OTM1MA==", "bodyText": "This is a package-private class. It's easier than passing around 6 parameters.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#discussion_r397349350", "createdAt": "2020-03-24T17:51:02Z", "author": {"login": "conniey"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ReceiveMessageOptions.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwMzk4Mg=="}, "originalCommit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM3MDE2MQ==", "bodyText": "Okay, Its fine. This package-private. No need to take it out.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#discussion_r397370161", "createdAt": "2020-03-24T18:23:59Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ReceiveMessageOptions.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwMzk4Mg=="}, "originalCommit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDQzMTA0OnYy", "diffSide": "RIGHT", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxMDo0MVrOF6hLnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxMDo0MVrOF6hLnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNTM3Mg==", "bodyText": "Should we use term producers ? This is eventhub term. How about senders", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#discussion_r396905372", "createdAt": "2020-03-24T05:10:41Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java", "diffHunk": "@@ -140,90 +148,77 @@ public ServiceBusClientBuilder proxyOptions(ProxyOptions proxyOptions) {\n     }\n \n     /**\n-     * Specify connection string and  queue name for connection to Queue.\n+     * Sets the retry options for Service Bus clients. If not specified, the default retry options are used.\n      *\n-     * @param connectionString to connect to service bus resource.\n-     * @param topicOrQueueName The name of the queue.\n-     *\n-     * @return The {@link ServiceBusClientBuilder}.\n-     */\n-    public ServiceBusClientBuilder connectionString(String connectionString, String topicOrQueueName) {\n-        this.serviceBusResourceName = topicOrQueueName;\n-        return connectionString(connectionString);\n-    }\n-\n-    /**\n-     * @param retryPolicy to recover from Connection.\n+     * @param retryOptions The retry options to use.\n      *\n-     * @return The {@link ServiceBusClientBuilder}.\n+     * @return The updated {@link ServiceBusClientBuilder} object.\n      */\n-    public ServiceBusClientBuilder retryPolicy(AmqpRetryPolicy retryPolicy) {\n+    public ServiceBusClientBuilder retryOptions(AmqpRetryOptions retryOptions) {\n+        this.retryOptions = retryOptions;\n         return this;\n     }\n \n     /**\n-     * This is valid for receiving messages only.\n+     * Sets the scheduler to use.\n      *\n-     * @param receiveMessageOptions for receiving.\n+     * @param scheduler Scheduler to be used.\n      *\n-     * @return The {@link ServiceBusClientBuilder}.\n+     * @return The updated {@link ServiceBusClientBuilder} object.\n      */\n-    public ServiceBusClientBuilder receiveMessageOptions(ReceiveMessageOptions receiveMessageOptions) {\n-        this.receiveMessageOptions = receiveMessageOptions;\n+    ServiceBusClientBuilder scheduler(Scheduler scheduler) {\n+        this.scheduler = scheduler;\n         return this;\n     }\n \n     /**\n-     * @param transportType to use.\n+     * Sets the transport type by which all the communication with Azure Service Bus occurs. Default value is {@link\n+     * AmqpTransportType#AMQP}.\n      *\n-     * @return The {@link ServiceBusClientBuilder}.\n+     * @param transportType The transport type to use.\n+     *\n+     * @return The updated {@link ServiceBusClientBuilder} object.\n      */\n     public ServiceBusClientBuilder transportType(AmqpTransportType transportType) {\n         this.transport = transportType;\n         return this;\n     }\n \n     /**\n-     * @param retryOptions to manage AMQP connection.\n+     * A new instance of {@link ServiceBusSenderClientBuilder} used to configure Service Bus message producers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "originalPosition": 198}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDQzOTcyOnYy", "diffSide": "RIGHT", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxNjozMFrOF6hQrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxNjozMFrOF6hQrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNjY2OQ==", "bodyText": "I thought of changing this in APIview\nrenewDuration->renewalDuration", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#discussion_r396906669", "createdAt": "2020-03-24T05:16:30Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java", "diffHunk": "@@ -338,4 +320,252 @@ private ProxyOptions getDefaultProxyConfiguration(Configuration configuration) {\n \n         return new ProxyOptions(authentication, proxy, username, password);\n     }\n+\n+    private static boolean isNullOrEmpty(String item) {\n+        return item == null || item.isEmpty();\n+    }\n+\n+    /**\n+     * Builder for creating {@link ServiceBusSenderClient} and {@link ServiceBusSenderAsyncClient} to publish messages\n+     * to Service Bus.\n+     */\n+    public final class ServiceBusSenderClientBuilder {\n+        private String queueOrTopicName;\n+\n+        private ServiceBusSenderClientBuilder() {\n+        }\n+\n+        /**\n+         * Sets the name of the Service Bus resource to publish messages to.\n+         *\n+         * @param queueOrTopicName Name of the Service Bus resource to publish messages to.\n+         *\n+         * @return The updated {@link ServiceBusSenderClientBuilder} builder.\n+         */\n+        public ServiceBusSenderClientBuilder entityName(String queueOrTopicName) {\n+            this.queueOrTopicName = queueOrTopicName;\n+            return this;\n+        }\n+\n+        /**\n+         * Creates an <b>asynchronous</b> {@link ServiceBusSenderAsyncClient client} for transmitting {@link\n+         * ServiceBusMessage} to a Service Bus queue or topic.\n+         *\n+         * @return A new {@link ServiceBusSenderAsyncClient} for transmitting to a Service queue or topic.\n+         */\n+        public ServiceBusSenderAsyncClient buildAsyncClient() {\n+            final ServiceBusConnectionProcessor connectionProcessor = getOrCreateConnectionProcessor(messageSerializer);\n+\n+            if (isNullOrEmpty(connectionStringEntityName) && isNullOrEmpty(queueOrTopicName)) {\n+                throw logger.logExceptionAsError(new IllegalStateException(\n+                    \"Cannot create sender without setting the entityName\"));\n+            }\n+            if (!isNullOrEmpty(connectionStringEntityName) && !isNullOrEmpty(queueOrTopicName)\n+                && !connectionStringEntityName.equals(queueOrTopicName)) {\n+                throw logger.logExceptionAsError(new IllegalStateException(String.format(\n+                    \"entityName '%s' from connection string does not match the queueOrTopicName '%s' set in sender.\",\n+                    connectionStringEntityName, queueOrTopicName)));\n+            }\n+\n+            final String entityName = queueOrTopicName != null ? queueOrTopicName : connectionStringEntityName;\n+\n+            return new ServiceBusSenderAsyncClient(entityName, connectionProcessor, retryOptions, tracerProvider,\n+                messageSerializer);\n+        }\n+\n+        /**\n+         * Creates a <b>synchronous</b> {@link ServiceBusSenderClient client} for transmitting {@link ServiceBusMessage}\n+         * to a Service Bus queue or topic.\n+         *\n+         * @return A new {@link ServiceBusSenderAsyncClient} for transmitting to a Service queue or topic.\n+         */\n+        public ServiceBusSenderClient buildClient() {\n+            return new ServiceBusSenderClient(buildAsyncClient());\n+        }\n+    }\n+\n+    /**\n+     * Builder for creating {@link ServiceBusReceiverClient} and {@link ServiceBusReceiverAsyncClient} to consume\n+     * messages from Service Bus.\n+     */\n+    public final class ServiceBusReceiverClientBuilder {\n+        // Using 0 pre-fetch count for both receive modes, to avoid message lock lost exceptions in application receiving\n+        // messages at a slow rate. Applications can set it to a higher value if they need better performance.\n+        private static final int DEFAULT_PREFETCH_COUNT = 1;\n+\n+        private boolean autoComplete;\n+        private Duration maxAutoLockRenewalDuration;\n+        private int prefetchCount = DEFAULT_PREFETCH_COUNT;\n+        private String queueName;\n+        private String subscriptionName;\n+        private String topicName;\n+        private ReceiveMode receiveMode = ReceiveMode.PEEK_LOCK;\n+\n+        private ServiceBusReceiverClientBuilder() {\n+        }\n+\n+        /**\n+         * Sets whether or not to automatically complete a received message after it has been processed.\n+         *\n+         * @param autoComplete {@code true} to automatically complete a received message after it has been\n+         *     processed; {@code false} otherwise.\n+         *\n+         * @return The modified {@link ServiceBusReceiverClientBuilder} object.\n+         */\n+        public ServiceBusReceiverClientBuilder isAutoComplete(boolean autoComplete) {\n+            this.autoComplete = autoComplete;\n+            return this;\n+        }\n+\n+        /**\n+         * Sets the maximum duration within which the lock will be renewed automatically. This value should be greater\n+         * than the longest message lock duration.\n+         *\n+         * @param renewDuration The maximum duration within which the lock will be renewed automatically.\n+         *\n+         * @return The modified {@link ServiceBusReceiverClientBuilder} object.\n+         */\n+        public ServiceBusReceiverClientBuilder maxAutoLockRenewalDuration(Duration renewDuration) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "originalPosition": 450}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2181, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}