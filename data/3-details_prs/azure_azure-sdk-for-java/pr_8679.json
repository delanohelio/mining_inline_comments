{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMTA0Mzk4", "number": 8679, "title": "Added Okhttp and ServiceVesion into client test framework", "bodyText": "The changes are made because we want to extend the ability of our test framework to test on Okhttp and serviceVersion and etc (may have more in future).\nThe change is currently made to AppConfig and KeyVault. Will run live tests for a while to learn the behavior.", "createdAt": "2020-03-03T18:22:43Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679", "merged": true, "mergeCommit": {"oid": "c07367d2b652690585cc8c28c986a6ce25991fbe"}, "closed": true, "closedAt": "2020-03-17T20:12:27Z", "author": {"login": "sima-zhu"}, "timelineItems": {"totalCount": 85, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKMB3AgH2gAyMzgzMTA0Mzk4Ojk0OWUwY2IzYzNlZjAzZWFmYjkxNWU1ZGMzNjI2ZDkxMjM5NjA1ZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOlUg7gFqTM3NjIwMjMxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "949e0cb3c3ef03eafb915e5dc3626d91239605f4", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/949e0cb3c3ef03eafb915e5dc3626d91239605f4", "committedDate": "2020-03-04T00:46:13Z", "message": "Initial checkin for adding okhttp"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "019f91181d7b51793374f29502eba2c53eca33ae", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/019f91181d7b51793374f29502eba2c53eca33ae", "committedDate": "2020-03-03T18:20:54Z", "message": "Added okhttp client for tests"}, "afterCommit": {"oid": "949e0cb3c3ef03eafb915e5dc3626d91239605f4", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/949e0cb3c3ef03eafb915e5dc3626d91239605f4", "committedDate": "2020-03-04T00:46:13Z", "message": "Initial checkin for adding okhttp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f8707e49f48b828780178a93d542c2f6206d48d", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4f8707e49f48b828780178a93d542c2f6206d48d", "committedDate": "2020-03-04T00:49:19Z", "message": "Fixed linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81369b78f67aabe4df8e5989d29722b0a41a05f0", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/81369b78f67aabe4df8e5989d29722b0a41a05f0", "committedDate": "2020-03-04T00:52:02Z", "message": "Make change on test scope"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54e59503a4f986a2b1299153aa63455353841488", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/54e59503a4f986a2b1299153aa63455353841488", "committedDate": "2020-03-04T19:00:08Z", "message": "make initial changes on okhttp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d67069c23dd635263bb6d29e04f382086b298cc", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6d67069c23dd635263bb6d29e04f382086b298cc", "committedDate": "2020-03-04T20:22:20Z", "message": "Parameterized HttpClient and ServiceVersion tests for AppConfiguration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f5da1b10becab02fc293c933a84347abce20321", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f5da1b10becab02fc293c933a84347abce20321", "committedDate": "2020-03-04T20:30:07Z", "message": "Add javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "041ad351047da313a83c6f475f4012b8fe02017d", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/041ad351047da313a83c6f475f4012b8fe02017d", "committedDate": "2020-03-04T21:15:22Z", "message": "Fix version tag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "343945cc0e7ea5f22ed7e7c79d53bfb1622c8a7f", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/343945cc0e7ea5f22ed7e7c79d53bfb1622c8a7f", "committedDate": "2020-03-04T21:19:21Z", "message": "Add opens to appconfig junit 5 module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45d17cf61100ab81f5c0eba5904745b8def334cd", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/45d17cf61100ab81f5c0eba5904745b8def334cd", "committedDate": "2020-03-04T21:50:06Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e69e64d37cff9b5225eef7f6b2f3e83815b0987c", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e69e64d37cff9b5225eef7f6b2f3e83815b0987c", "committedDate": "2020-03-04T22:07:34Z", "message": "remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3350c452c383d4a2cbb869c54fa2c396ccdb252", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c3350c452c383d4a2cbb869c54fa2c396ccdb252", "committedDate": "2020-03-04T23:52:04Z", "message": "Include okhttp in pom.service.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ab6ab61e1d0900b31067c765ddd6fead2718cbd", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3ab6ab61e1d0900b31067c765ddd6fead2718cbd", "committedDate": "2020-03-05T12:59:23Z", "message": "Make changes to appconfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e27144ead62a3ae148168d38de927a001fdab3ed", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e27144ead62a3ae148168d38de927a001fdab3ed", "committedDate": "2020-03-05T13:59:46Z", "message": "Fixed failed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5d6aebf56356904a824f709397b1aa3b06a48a3", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b5d6aebf56356904a824f709397b1aa3b06a48a3", "committedDate": "2020-03-05T16:47:55Z", "message": "Fixed linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05ae2990ab5251e409df628386b4e0069e030e50", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/05ae2990ab5251e409df628386b4e0069e030e50", "committedDate": "2020-03-05T18:18:52Z", "message": "Checkin certificate changes, and partial key changes for keyVaule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e2475928ecdda5741557f073170e126d8ded29d2", "committedDate": "2020-03-05T18:22:58Z", "message": "Fixed linting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODEzODg5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-369813889", "createdAt": "2020-03-05T18:33:24Z", "commit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODozMzoyNFrOFyfGMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODo0MToxOFrOFyfVug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4MjYwOA==", "bodyText": "This will add Azure Core as a dependency to all modules depending pom.xml, this dependency should be removed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388482608", "createdAt": "2020-03-05T18:33:24Z", "author": {"login": "alzimmermsft"}, "path": "pom.xml", "diffHunk": "@@ -6,7 +6,15 @@\n   <groupId>com.azure</groupId>\n   <artifactId>azure-sdk-all</artifactId>\n   <packaging>pom</packaging>\n-  <version>1.0.0</version> <!-- {x-version-update;com.azure:azure-sdk-all;current} -->\n+  <version>1.0.0</version>\n+    <dependencies>\n+        <dependency>\n+            <groupId>com.azure</groupId>\n+            <artifactId>azure-core</artifactId>\n+            <version>1.4.0-beta.2</version>\n+            <scope>compile</scope>\n+        </dependency>\n+    </dependencies> <!-- {x-version-update;com.azure:azure-sdk-all;current} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NDY0OA==", "bodyText": "Not a huge fan that every test will need to become parameterized to test each client, are there any ways to abstract this into Azure Core Test or does JUnit have the ability to parameterize an entire test run?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388484648", "createdAt": "2020-03-05T18:37:28Z", "author": {"login": "alzimmermsft"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/ConfigurationAsyncClientTest.java", "diffHunk": "@@ -91,17 +97,21 @@ public void addConfigurationSetting() {\n     /**\n      * Tests that we cannot add a configuration setting when the key is an empty string.\n      */\n-    @Test\n-    public void addConfigurationSettingEmptyKey() {\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void addConfigurationSettingEmptyKey(HttpClient httpClient, ConfigurationServiceVersion serviceVersion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NjU4Ng==", "bodyText": "I don't think we would want to add APIs into our production code to just handle testing.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388486586", "createdAt": "2020-03-05T18:41:18Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/implementation/http/HttpClientProviders.java", "diffHunk": "@@ -34,4 +36,19 @@ public static HttpClient createInstance() {\n         }\n         return defaultProvider.createInstance();\n     }\n+\n+    /**\n+     * Returns a list of all {@link HttpClient HttpClients} that are discovered in the classpath.\n+     *\n+     * @return A list of all {@link HttpClient HttpClients} discovered in the classpath.\n+     */\n+    public static List<HttpClient> getAllHttpClients() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODE2MzIw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-369816320", "createdAt": "2020-03-05T18:37:11Z", "commit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODozNzoxMVrOFyfNtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODo0MDo1OVrOFyfVHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NDUzMg==", "bodyText": "@sima-zhu I don't believe this is the correct place to have this dependency (which, btw, is declared incorrectly anyways, the version tag belongs on the version line). This is azure-sdk-all which includes client, data and management in its module list. This change needs to be more limited, possibly just in pom.client.xml", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388484532", "createdAt": "2020-03-05T18:37:11Z", "author": {"login": "JimSuplizio"}, "path": "pom.xml", "diffHunk": "@@ -6,7 +6,15 @@\n   <groupId>com.azure</groupId>\n   <artifactId>azure-sdk-all</artifactId>\n   <packaging>pom</packaging>\n-  <version>1.0.0</version> <!-- {x-version-update;com.azure:azure-sdk-all;current} -->\n+  <version>1.0.0</version>\n+    <dependencies>\n+        <dependency>\n+            <groupId>com.azure</groupId>\n+            <artifactId>azure-core</artifactId>\n+            <version>1.4.0-beta.2</version>\n+            <scope>compile</scope>\n+        </dependency>\n+    </dependencies> <!-- {x-version-update;com.azure:azure-sdk-all;current} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NjE3OQ==", "bodyText": "This tag is wrong, unreleased dependencies should only ever be dependency. The tag should be x-version-update;unreleased_com.azure:azure-core-test;dependency. As it is right now it'll definitely fail the analyze step's version scanner.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388486179", "createdAt": "2020-03-05T18:40:31Z", "author": {"login": "JimSuplizio"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/pom.xml", "diffHunk": "@@ -97,7 +97,14 @@\n     <dependency>\n       <groupId>com.azure</groupId>\n       <artifactId>azure-core-test</artifactId>\n-      <version>1.1.0</version> <!-- {x-version-update;com.azure:azure-core-test;dependency} -->\n+      <version>1.2.0-beta.1</version> <!-- {x-version-update;unrelease_com.azure:azure-core-test;current} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NjQyOA==", "bodyText": "Same comment as above, the tag is incorrect and should be x-version-update;unreleased_com.azure:azure-core-test;dependency", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388486428", "createdAt": "2020-03-05T18:40:59Z", "author": {"login": "JimSuplizio"}, "path": "sdk/keyvault/azure-security-keyvault-keys/pom.xml", "diffHunk": "@@ -95,7 +95,14 @@\n       <dependency>\n         <groupId>com.azure</groupId>\n         <artifactId>azure-core-test</artifactId>\n-        <version>1.1.0</version> <!-- {x-version-update;com.azure:azure-core-test;dependency} -->\n+        <version>1.2.0-beta.1</version> <!-- {x-version-update;unrelease_com.azure:azure-core-test;current} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ce1cc987ecbdf0d182b7cd0cb02bc5f3297641b", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7ce1cc987ecbdf0d182b7cd0cb02bc5f3297641b", "committedDate": "2020-03-05T19:00:24Z", "message": "Update pom.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "034cb7d6568fefb4f7a49a2147dc093804e55563", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/034cb7d6568fefb4f7a49a2147dc093804e55563", "committedDate": "2020-03-05T19:01:49Z", "message": "Update pom.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODE4NTAy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-369818502", "createdAt": "2020-03-05T18:40:37Z", "commit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODo0MDozN1rOFyfUVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxOTowMjoxOFrOFygDMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NjIyOQ==", "bodyText": "This change should be reverted.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388486229", "createdAt": "2020-03-05T18:40:37Z", "author": {"login": "srnagar"}, "path": "pom.xml", "diffHunk": "@@ -6,7 +6,15 @@\n   <groupId>com.azure</groupId>\n   <artifactId>azure-sdk-all</artifactId>\n   <packaging>pom</packaging>\n-  <version>1.0.0</version> <!-- {x-version-update;com.azure:azure-sdk-all;current} -->\n+  <version>1.0.0</version>\n+    <dependencies>\n+        <dependency>\n+            <groupId>com.azure</groupId>\n+            <artifactId>azure-core</artifactId>\n+            <version>1.4.0-beta.2</version>\n+            <scope>compile</scope>\n+        </dependency>\n+    </dependencies> <!-- {x-version-update;com.azure:azure-sdk-all;current} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NzE4NA==", "bodyText": "Instead of casting this to ConfigurationServiceVersion, the method can directly take in ConfigurationServiceVersion instead of ServiceVersion", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388487184", "createdAt": "2020-03-05T18:42:25Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/AadCredentialTest.java", "diffHunk": "@@ -42,20 +53,43 @@ public void setup() throws InvalidKeyException, NoSuchAlgorithmException {\n \n             String endpoint = new ConfigurationClientCredentials(connectionString).getBaseUri();\n             client = new ConfigurationClientBuilder()\n+                .httpClient(httpClient)\n                 .credential(tokenCredential)\n                 .endpoint(endpoint)\n                 .addPolicy(interceptorManager.getRecordPolicy()) // Record\n+                .serviceVersion(serviceVersion)\n                 .buildClient();\n         }\n     }\n \n-    @Test\n-    public void aadAuthenticationAzConfigClient() {\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void aadAuthenticationAzConfigClient(HttpClient httpClient, ServiceVersion serviceVersion) throws Exception {\n+        setup(httpClient, (ConfigurationServiceVersion) serviceVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MTAxMw==", "bodyText": "Should this include service version too?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388491013", "createdAt": "2020-03-05T18:49:47Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/ConfigurationClientBuilderTest.java", "diffHunk": "@@ -113,8 +123,9 @@ public void timeoutPolicy() {\n         assertThrows(RuntimeException.class, () -> client.setConfigurationSetting(key, null, value));\n     }\n \n-    @Test\n-    public void nullServiceVersion() {\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void nullServiceVersion(HttpClient httpClient) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MjA5NQ==", "bodyText": "If you are setting the pipeline, shouldn't the httpclient be setup along with the pipeline?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388492095", "createdAt": "2020-03-05T18:51:32Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/ConfigurationClientBuilderTest.java", "diffHunk": "@@ -157,13 +167,12 @@ public void defaultPipeline() {\n             .retryPolicy(new RetryPolicy())\n             .configuration(Configuration.getGlobalConfiguration())\n             .httpLogOptions(new HttpLogOptions().setLogLevel(HttpLogDetailLevel.BODY_AND_HEADERS))\n-            .pipeline(new HttpPipelineBuilder().build());\n+            .pipeline(new HttpPipelineBuilder().build())\n+            .httpClient(httpClient == null ? interceptorManager.getPlaybackClient() : httpClient)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5NTgxMQ==", "bodyText": "If you set the pipeline, setting the httpclient on the same builder will have no effect. Pipeline will take precedence.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388495811", "createdAt": "2020-03-05T18:58:05Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTest.java", "diffHunk": "@@ -6,44 +6,71 @@\n import com.azure.core.exception.HttpResponseException;\n import com.azure.core.exception.ResourceModifiedException;\n import com.azure.core.exception.ResourceNotFoundException;\n+import com.azure.core.http.HttpClient;\n import com.azure.core.http.rest.PagedIterable;\n import com.azure.core.util.polling.PollResponse;\n import com.azure.core.util.polling.SyncPoller;\n-import com.azure.security.keyvault.certificates.models.*;\n-import org.junit.jupiter.api.Test;\n \n+import com.azure.security.keyvault.certificates.models.CertificateContact;\n+import com.azure.security.keyvault.certificates.models.CertificateIssuer;\n+import com.azure.security.keyvault.certificates.models.CertificateOperation;\n+import com.azure.security.keyvault.certificates.models.CertificatePolicy;\n+import com.azure.security.keyvault.certificates.models.CertificateProperties;\n+import com.azure.security.keyvault.certificates.models.DeletedCertificate;\n+import com.azure.security.keyvault.certificates.models.IssuerProperties;\n+import com.azure.security.keyvault.certificates.models.KeyVaultCertificate;\n+import com.azure.security.keyvault.certificates.models.KeyVaultCertificateWithPolicy;\n+import com.azure.security.keyvault.certificates.models.MergeCertificateOptions;\n import java.io.IOException;\n import java.net.HttpURLConnection;\n import java.security.cert.CertificateException;\n import java.security.cert.X509Certificate;\n-import java.util.*;\n-\n-import static org.junit.jupiter.api.Assertions.*;\n-\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import static org.junit.jupiter.api.TestInstance.Lifecycle.PER_CLASS;\n+\n+@TestInstance(PER_CLASS)\n public class CertificateClientTest extends CertificateClientTestBase {\n+    private static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n     private CertificateClient client;\n \n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n-        if (interceptorManager.isPlaybackMode()) {\n-\n-            client = clientSetup(pipeline -> new CertificateClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        } else {\n-            client = clientSetup(pipeline -> new CertificateClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        }\n     }\n \n+    private void getCertificateClient(HttpClient httpClient,\n+        CertificateServiceVersion serviceVersion) {\n+\n+        client = clientSetup(pipeline -> new CertificateClientBuilder()\n+            .vaultUrl(getEndpoint())\n+            .pipeline(pipeline)\n+            .httpClient(httpClient == null ? interceptorManager.getPlaybackClient() : httpClient)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5Njk5MA==", "bodyText": "This can now be deleted.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388496990", "createdAt": "2020-03-05T18:59:56Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyAsyncClientTest.java", "diffHunk": "@@ -30,24 +36,31 @@\n     protected void beforeTest() {\n         beforeTestSetup();\n \n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildAsyncClient());\n-        } else {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .pipeline(pipeline)\n-                .vaultUrl(getEndpoint())\n-                .buildAsyncClient());\n-        }\n+        client = clientSetup(pipeline -> new KeyClientBuilder()\n+            .pipeline(pipeline)\n+            .vaultUrl(getEndpoint())\n+            .buildAsyncClient());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5NzQ2NA==", "bodyText": "Same as above. Pipeline and http client both should not be set.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388497464", "createdAt": "2020-03-05T19:00:51Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyAsyncClientTest.java", "diffHunk": "@@ -30,24 +36,31 @@\n     protected void beforeTest() {\n         beforeTestSetup();\n \n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildAsyncClient());\n-        } else {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .pipeline(pipeline)\n-                .vaultUrl(getEndpoint())\n-                .buildAsyncClient());\n-        }\n+        client = clientSetup(pipeline -> new KeyClientBuilder()\n+            .pipeline(pipeline)\n+            .vaultUrl(getEndpoint())\n+            .buildAsyncClient());\n+    }\n+\n+\n+    private void getKeyAsyncClient(HttpClient httpClient,\n+        KeyServiceVersion serviceVersion) {\n+\n+        client = clientSetup(pipeline -> new KeyClientBuilder()\n+            .vaultUrl(getEndpoint())\n+            .pipeline(pipeline)\n+            .httpClient(httpClient == null ? interceptorManager.getPlaybackClient() : httpClient)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5Nzc1MA==", "bodyText": "This can be deleted.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388497750", "createdAt": "2020-03-05T19:01:26Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyClientTest.java", "diffHunk": "@@ -17,54 +18,65 @@\n import java.util.ArrayList;\n import java.util.HashMap;\n import java.util.List;\n-import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n public class KeyClientTest extends KeyClientTestBase {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n \n     private KeyClient client;\n \n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n+        client = clientSetup(pipeline -> new KeyClientBuilder()\n+            .vaultUrl(getEndpoint())\n+            .pipeline(pipeline)\n+            .buildClient());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5Nzg1Ng==", "bodyText": "Move this to KeyClientTestBase", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388497856", "createdAt": "2020-03-05T19:01:37Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyClientTest.java", "diffHunk": "@@ -17,54 +18,65 @@\n import java.util.ArrayList;\n import java.util.HashMap;\n import java.util.List;\n-import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n public class KeyClientTest extends KeyClientTestBase {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5ODIyNQ==", "bodyText": "Set the httpclient in pipeline instead.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r388498225", "createdAt": "2020-03-05T19:02:18Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyClientTest.java", "diffHunk": "@@ -17,54 +18,65 @@\n import java.util.ArrayList;\n import java.util.HashMap;\n import java.util.List;\n-import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n public class KeyClientTest extends KeyClientTestBase {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n \n     private KeyClient client;\n \n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n+        client = clientSetup(pipeline -> new KeyClientBuilder()\n+            .vaultUrl(getEndpoint())\n+            .pipeline(pipeline)\n+            .buildClient());\n+    }\n \n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        } else {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        }\n+    private void getKeyClient(HttpClient httpClient,\n+        KeyServiceVersion serviceVersion) {\n+\n+        client = clientSetup(pipeline -> new KeyClientBuilder()\n+            .vaultUrl(getEndpoint())\n+            .pipeline(pipeline)\n+            .httpClient(httpClient == null ? interceptorManager.getPlaybackClient() : httpClient)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2475928ecdda5741557f073170e126d8ded29d2"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1783d5eb403cc7419765f057adbfd08d94978d0", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a1783d5eb403cc7419765f057adbfd08d94978d0", "committedDate": "2020-03-05T19:08:27Z", "message": "Update pom.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "396f69226a5e16b74e67abb871c7fd6b87a83172", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/396f69226a5e16b74e67abb871c7fd6b87a83172", "committedDate": "2020-03-05T19:08:55Z", "message": "Update pom.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceab1731bfac25110317463be4666b78d6f298fd", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ceab1731bfac25110317463be4666b78d6f298fd", "committedDate": "2020-03-08T00:09:52Z", "message": "Merge in master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODY1Nzkx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-370865791", "createdAt": "2020-03-08T23:11:11Z", "commit": {"oid": "396f69226a5e16b74e67abb871c7fd6b87a83172"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQyMzoxMToxMVrOFzYE8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQyMzoxMToxMVrOFzYE8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQxNjE3OQ==", "bodyText": "It's really critical that for a client library, you only have this method once. All test classes should reference a single version of this method.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r389416179", "createdAt": "2020-03-08T23:11:11Z", "author": {"login": "JonathanGiles"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/ConfigurationClientBuilderTest.java", "diffHunk": "@@ -184,4 +193,23 @@ private static URI getURI(String endpointFormat, String namespace, String domain\n                 \"Invalid namespace name: %s\", namespace), exception);\n         }\n     }\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    protected Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                for (ConfigurationServiceVersion serviceVersion : ConfigurationServiceVersion.values()) {\n+                    argumentsList.add(Arguments.of(httpClient, serviceVersion));\n+                }\n+            });\n+        return argumentsList.stream();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "396f69226a5e16b74e67abb871c7fd6b87a83172"}, "originalPosition": 120}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff1c071b3d87f9a4637a556ab3a665723716d915", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ff1c071b3d87f9a4637a556ab3a665723716d915", "committedDate": "2020-03-09T18:27:39Z", "message": "Keyvault"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0036776f1113d9b04ef776acffcc4654d2d82b7", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d0036776f1113d9b04ef776acffcc4654d2d82b7", "committedDate": "2020-03-09T19:04:33Z", "message": "Move to test helper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5e105fad2556193cac647108f6834af3008b4e2", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f5e105fad2556193cac647108f6834af3008b4e2", "committedDate": "2020-03-09T19:04:37Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into okhttp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5d346792667912ec973d1ed660db8c7990469e", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2e5d346792667912ec973d1ed660db8c7990469e", "committedDate": "2020-03-09T19:23:33Z", "message": "Merge branch 'master' into okhttp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cfc22de0c272647c47798a09b3d043bec1ebf30", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4cfc22de0c272647c47798a09b3d043bec1ebf30", "committedDate": "2020-03-09T20:47:45Z", "message": "Merge the changes from Keyvault"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dd9a54461e94bb839e5601b6521adfc89213fac", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6dd9a54461e94bb839e5601b6521adfc89213fac", "committedDate": "2020-03-09T21:02:36Z", "message": "Update version_client.txt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad5d7e12db3d23dc0fcc26f7594e792b1a29a9c9", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ad5d7e12db3d23dc0fcc26f7594e792b1a29a9c9", "committedDate": "2020-03-09T21:03:19Z", "message": "Update pom.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0261212832cce22be55bb8a6b5b96faef1120667", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0261212832cce22be55bb8a6b5b96faef1120667", "committedDate": "2020-03-09T21:03:58Z", "message": "Update DataSources.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a20fcd2df36a387a426a85411fad86275a94c88", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4a20fcd2df36a387a426a85411fad86275a94c88", "committedDate": "2020-03-09T21:20:29Z", "message": "Update the version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b6ef5ccf50fa67ee47b02337f56953b3a155a2d", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3b6ef5ccf50fa67ee47b02337f56953b3a155a2d", "committedDate": "2020-03-09T21:26:00Z", "message": "One more updates on version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "419a88a29fae75bf94e8a4f2b88b59706eec5625", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/419a88a29fae75bf94e8a4f2b88b59706eec5625", "committedDate": "2020-03-09T21:30:16Z", "message": "Make changes on test method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf1bd55786a62fc93ddd6c377153df2e52e9165c", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cf1bd55786a62fc93ddd6c377153df2e52e9165c", "committedDate": "2020-03-09T21:35:05Z", "message": "Make changes on junit 5 setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78ebf2556c775b0339c060ba63350d7ca74f3943", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/78ebf2556c775b0339c060ba63350d7ca74f3943", "committedDate": "2020-03-09T21:38:30Z", "message": "Depend on most recent release version for okhttp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0988cd4a27958aa863b1d0b0d2e022d7545c7f8e", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0988cd4a27958aa863b1d0b0d2e022d7545c7f8e", "committedDate": "2020-03-09T21:41:05Z", "message": "Added okhttp module in keyvault"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23f603150368c623cda98893fea024c669a638a1", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/23f603150368c623cda98893fea024c669a638a1", "committedDate": "2020-03-09T21:43:31Z", "message": "Removed unneccessary parts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d5f39b6e16bc443dec693945838dd0fbbe47163", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8d5f39b6e16bc443dec693945838dd0fbbe47163", "committedDate": "2020-03-09T21:49:29Z", "message": "Make changes on KeyVaultClient"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNTc5Nzk0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-371579794", "createdAt": "2020-03-09T22:50:54Z", "commit": {"oid": "8d5f39b6e16bc443dec693945838dd0fbbe47163"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMjo1MDo1NFrOFz79cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMjo1ODo1M1rOFz8HLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDAwNDA4Mw==", "bodyText": "The service version should be set on the builder otherwise it will always use the latest.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r390004083", "createdAt": "2020-03-09T22:50:54Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyClientTest.java", "diffHunk": "@@ -30,41 +34,43 @@\n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n+    }\n \n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        } else {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        }\n+    private void getKeyClient(HttpClient httpClient, KeyServiceVersion serviceVersion) {\n+        HttpPipeline httpPipeline = getHttpPipeline(httpClient, serviceVersion);\n+        client = new KeyClientBuilder()\n+            .vaultUrl(getEndpoint())\n+            .pipeline(httpPipeline)\n+            .buildClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d5f39b6e16bc443dec693945838dd0fbbe47163"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDAwNDE1NQ==", "bodyText": "The service version should be set on the builder otherwise it will always use the latest.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r390004155", "createdAt": "2020-03-09T22:51:06Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyAsyncClientTest.java", "diffHunk": "@@ -29,25 +33,24 @@\n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n+    }\n \n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildAsyncClient());\n-        } else {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .pipeline(pipeline)\n-                .vaultUrl(getEndpoint())\n-                .buildAsyncClient());\n-        }\n+\n+    private void getKeyAsyncClient(HttpClient httpClient, KeyServiceVersion serviceVersion) {\n+        HttpPipeline httpPipeline = getHttpPipeline(httpClient, serviceVersion);\n+        client = new KeyClientBuilder()\n+            .vaultUrl(getEndpoint())\n+            .pipeline(httpPipeline)\n+            .buildAsyncClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d5f39b6e16bc443dec693945838dd0fbbe47163"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDAwNDQ4Mg==", "bodyText": "All client builders are missing service version.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r390004482", "createdAt": "2020-03-09T22:52:15Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/cryptography/CryptographyClientTest.java", "diffHunk": "@@ -32,27 +35,20 @@\n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> {\n-                this.pipeline = pipeline;\n-                return new KeyClientBuilder()\n-                    .pipeline(pipeline)\n-                    .vaultUrl(getEndpoint())\n-                    .buildClient();\n-            });\n-        } else {\n-            client = clientSetup(pipeline -> {\n-                this.pipeline = pipeline;\n-                return new KeyClientBuilder()\n-                    .pipeline(pipeline)\n-                    .vaultUrl(getEndpoint())\n-                    .buildClient();\n-            });\n-        }\n     }\n \n-    @Test\n-    public void encryptDecryptRsa() throws Exception {\n+    private void initializeClient(HttpClient httpClient, CryptographyServiceVersion serviceVersion) {\n+        pipeline = getHttpPipeline(httpClient, serviceVersion);\n+        client = new KeyClientBuilder()\n+            .pipeline(pipeline)\n+            .vaultUrl(getEndpoint())\n+            .buildClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d5f39b6e16bc443dec693945838dd0fbbe47163"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDAwNjU3NA==", "bodyText": "Also, by default, PR builds should just run the tests with latest version and if environment variable to run tests for all versions is set, then we should do this.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r390006574", "createdAt": "2020-03-09T22:58:53Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTestBase.java", "diffHunk": "@@ -437,4 +433,23 @@ public void sleep(long millis) {\n             e.printStackTrace();\n         }\n     }\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                for (SecretServiceVersion serviceVersion : SecretServiceVersion.values()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d5f39b6e16bc443dec693945838dd0fbbe47163"}, "originalPosition": 245}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8df65df84ec9ffdcb2095b8cf974fc2eb3135d23", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8df65df84ec9ffdcb2095b8cf974fc2eb3135d23", "committedDate": "2020-03-09T23:19:47Z", "message": "Addressed feedback on service version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d06df74ffb3396e0fe44ce6652acd3a6cda4641", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d06df74ffb3396e0fe44ce6652acd3a6cda4641", "committedDate": "2020-03-09T23:59:36Z", "message": "Fixed failed tests and lingting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d14066902397f187d43cf4989bc77f587e4198c", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4d14066902397f187d43cf4989bc77f587e4198c", "committedDate": "2020-03-10T00:01:23Z", "message": "Fixed keyvault tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f68c958db24d512289d910bb5a355f5eaa7adcae", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f68c958db24d512289d910bb5a355f5eaa7adcae", "committedDate": "2020-03-10T21:46:32Z", "message": "Adding env variables for PR validations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b7f0d82a8713ba27dfbeb2ff8032a0bca9bb381", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2b7f0d82a8713ba27dfbeb2ff8032a0bca9bb381", "committedDate": "2020-03-10T22:07:28Z", "message": "Update pom file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a42bc25a7141fc4638e935995e76d70d633e1078", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a42bc25a7141fc4638e935995e76d70d633e1078", "committedDate": "2020-03-10T22:10:23Z", "message": "Updated version_client file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6998a68d1a145a6162c17548a799227eb66b5421", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6998a68d1a145a6162c17548a799227eb66b5421", "committedDate": "2020-03-10T22:32:31Z", "message": "Fixed failed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dd1b490e9e72069e7e730819aa6007383400f46", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9dd1b490e9e72069e7e730819aa6007383400f46", "committedDate": "2020-03-10T22:37:19Z", "message": "Remove static key work"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed6da083f766da7f1302022e4666aba34406036e", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ed6da083f766da7f1302022e4666aba34406036e", "committedDate": "2020-03-10T22:52:30Z", "message": "Fixed linting issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8a71d295fa5e3ddded2438d1f053e608dc15661", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a8a71d295fa5e3ddded2438d1f053e608dc15661", "committedDate": "2020-03-10T23:30:44Z", "message": "Make netty to be default clients"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cddf540d492db61f16102715917743fbabd4b7c", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3cddf540d492db61f16102715917743fbabd4b7c", "committedDate": "2020-03-10T23:54:50Z", "message": "Fixed linting issue in keyvault"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2081e8d982eb643b5becf3f1df8076dbfd26936", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b2081e8d982eb643b5becf3f1df8076dbfd26936", "committedDate": "2020-03-11T02:37:14Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into okhttp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53a062bb9f7d38f5be03a202ca4fac33ad68f084", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/53a062bb9f7d38f5be03a202ca4fac33ad68f084", "committedDate": "2020-03-11T03:03:19Z", "message": "merge from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b85a9c78c99162118c6d433f30fdce81ee30648", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4b85a9c78c99162118c6d433f30fdce81ee30648", "committedDate": "2020-03-11T03:27:52Z", "message": "Fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0bcee9af7db0ba0bf5257dc8832f346b704dbcf", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a0bcee9af7db0ba0bf5257dc8832f346b704dbcf", "committedDate": "2020-03-11T03:58:27Z", "message": "Added modules for tests accessibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc2648ba38b68a498becfeee3292e76662bce9c9", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/dc2648ba38b68a498becfeee3292e76662bce9c9", "committedDate": "2020-03-11T05:05:49Z", "message": "Make changes on module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59785d53195176803cc500d0d1d274c5fecf03dc", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/59785d53195176803cc500d0d1d274c5fecf03dc", "committedDate": "2020-03-11T05:36:32Z", "message": "Fixed the httpClient"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39809f82155be482369e80b5335cc6ee0180afe9", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/39809f82155be482369e80b5335cc6ee0180afe9", "committedDate": "2020-03-11T16:21:43Z", "message": "Fixed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5152902118872b5bf9c52bae22ec51978781f430", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5152902118872b5bf9c52bae22ec51978781f430", "committedDate": "2020-03-11T16:24:25Z", "message": "More changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92b4841dd520a2c45691ff2ee411eaba49a78f7b", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/92b4841dd520a2c45691ff2ee411eaba49a78f7b", "committedDate": "2020-03-11T16:30:48Z", "message": "Merge branch 'master' into okhttp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2efb7719bc8681e61c28abc97a11f31cd8e2f008", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2efb7719bc8681e61c28abc97a11f31cd8e2f008", "committedDate": "2020-03-12T04:04:02Z", "message": "Merge conflicts from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c4a6d4a9ae72959aecaad6b878d3e10e6a96e4d", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5c4a6d4a9ae72959aecaad6b878d3e10e6a96e4d", "committedDate": "2020-03-12T04:11:04Z", "message": "Merge from maste"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/73f2c3ae60ed7e6104db83773bf8de9de71e14f0", "committedDate": "2020-03-12T05:00:35Z", "message": "Added back necessary tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMjgwMDI1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-373280025", "createdAt": "2020-03-12T05:02:46Z", "commit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "state": "COMMENTED", "comments": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwNTowMjo0NlrOF1RUhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwNTo0OToxMlrOF1R84Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwMjYyOQ==", "bodyText": "Don't you need KV Keys too?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391402629", "createdAt": "2020-03-12T05:02:46Z", "author": {"login": "srnagar"}, "path": "pom.client.xml", "diffHunk": "@@ -958,7 +957,11 @@\n                 --add-opens com.azure.core/com.azure.core.http=ALL-UNNAMED\n                 --add-opens com.azure.core/com.azure.core.http.policy=ALL-UNNAMED\n                 --add-opens com.azure.core/com.azure.core.util=ALL-UNNAMED\n+                --add-opens com.azure.core/com.azure.core.implementation.http=ALL-UNNAMED\n                 --add-opens com.azure.ai.textanalytics/com.azure.ai.textanalytics=ALL-UNNAMED\n+                --add-opens com.azure.data.appconfiguration/com.azure.data.appconfiguration=ALL-UNNAMED\n+                --add-opens com.azure.security.keyvault.certificates/com.azure.security.keyvault.certificates=ALL-UNNAMED\n+                --add-opens com.azure.security.keyvault.secrets/com.azure.security.keyvault.secrets=ALL-UNNAMED", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwMjgzOQ==", "bodyText": "Now that the MethodSource is a static method, is this still required?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391402839", "createdAt": "2020-03-12T05:03:49Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/AadCredentialTest.java", "diffHunk": "@@ -3,29 +3,35 @@\n package com.azure.data.appconfiguration;\n \n import com.azure.core.credential.TokenCredential;\n+import com.azure.core.http.HttpClient;\n import com.azure.core.test.TestBase;\n import com.azure.core.util.Configuration;\n import com.azure.data.appconfiguration.implementation.ConfigurationClientCredentials;\n import com.azure.data.appconfiguration.models.ConfigurationSetting;\n import com.azure.identity.DefaultAzureCredentialBuilder;\n import org.junit.jupiter.api.Assertions;\n-import org.junit.jupiter.api.BeforeEach;\n-import org.junit.jupiter.api.Test;\n \n import java.security.InvalidKeyException;\n import java.security.NoSuchAlgorithmException;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import static com.azure.data.appconfiguration.TestHelper.DISPLAY_NAME_WITH_ARGUMENTS;\n+import static org.junit.jupiter.api.TestInstance.Lifecycle.PER_CLASS;\n \n /**\n  * Unit test for construct a configuration client by using AAD token credential.\n  */\n+@TestInstance(PER_CLASS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwMzQwNw==", "bodyText": "Is this still required?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391403407", "createdAt": "2020-03-12T05:06:24Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/ConfigurationClientBuilderTest.java", "diffHunk": "@@ -22,9 +22,15 @@\n import java.time.Duration;\n import java.util.Locale;\n import java.util.Objects;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n \n+import static com.azure.data.appconfiguration.TestHelper.DISPLAY_NAME_WITH_ARGUMENTS;\n import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.TestInstance.Lifecycle.PER_CLASS;\n \n+@TestInstance(PER_CLASS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNDQyNQ==", "bodyText": "Since this test is to use the default pipeline (i.e. whichever httpclient is selected by default along with all other policies), this test should only have service version as a parameter.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391404425", "createdAt": "2020-03-12T05:11:17Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/ConfigurationClientBuilderTest.java", "diffHunk": "@@ -127,22 +134,21 @@ public void nullServiceVersion() {\n             .connectionString(connectionString)\n             .retryPolicy(new RetryPolicy())\n             .httpLogOptions(new HttpLogOptions().setLogLevel(HttpLogDetailLevel.BODY_AND_HEADERS))\n-            .serviceVersion(null);\n+            .serviceVersion(null)\n+            .httpClient(httpClient == null ? interceptorManager.getPlaybackClient() : httpClient);\n \n-        if (interceptorManager.isPlaybackMode()) {\n-            clientBuilder.httpClient(interceptorManager.getPlaybackClient());\n-        } else {\n-            clientBuilder.httpClient(new NettyAsyncHttpClientBuilder().wiretap(true).build())\n-                .addPolicy(interceptorManager.getRecordPolicy());\n+        if (!interceptorManager.isPlaybackMode()) {\n+            clientBuilder.addPolicy(interceptorManager.getRecordPolicy());\n         }\n \n         ConfigurationSetting addedSetting = clientBuilder.buildClient().setConfigurationSetting(key, null, value);\n         Assertions.assertEquals(addedSetting.getKey(), key);\n         Assertions.assertEquals(addedSetting.getValue(), value);\n     }\n \n-    @Test\n-    public void defaultPipeline() {\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"com.azure.data.appconfiguration.TestHelper#getTestParameters\")\n+    public void defaultPipeline(HttpClient httpClient, ConfigurationServiceVersion serviceVersion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNDU4Mg==", "bodyText": "Check if this is still required.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391404582", "createdAt": "2020-03-12T05:11:55Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/ConfigurationClientTest.java", "diffHunk": "@@ -5,31 +5,37 @@\n import com.azure.core.exception.HttpResponseException;\n import com.azure.core.exception.ResourceExistsException;\n import com.azure.core.exception.ResourceNotFoundException;\n+import com.azure.core.http.HttpClient;\n import com.azure.core.http.HttpHeaders;\n-import com.azure.core.http.netty.NettyAsyncHttpClientBuilder;\n import com.azure.core.http.policy.AddHeadersFromContextPolicy;\n import com.azure.core.http.policy.HttpLogDetailLevel;\n import com.azure.core.http.policy.HttpLogOptions;\n import com.azure.core.http.policy.RetryPolicy;\n import com.azure.core.http.rest.PagedIterable;\n import com.azure.core.http.rest.Response;\n+import com.azure.core.test.TestMode;\n import com.azure.core.util.Context;\n import com.azure.core.util.logging.ClientLogger;\n import com.azure.data.appconfiguration.models.ConfigurationSetting;\n import com.azure.data.appconfiguration.models.SettingFields;\n import com.azure.data.appconfiguration.models.SettingSelector;\n import org.junit.jupiter.api.Assertions;\n import org.junit.jupiter.api.Disabled;\n-import org.junit.jupiter.api.Test;\n \n import java.net.HttpURLConnection;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.stream.Collectors;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n \n+import static com.azure.data.appconfiguration.TestHelper.DISPLAY_NAME_WITH_ARGUMENTS;\n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.TestInstance.Lifecycle.PER_CLASS;\n \n+@TestInstance(PER_CLASS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNDkwMQ==", "bodyText": "package-private instead of protected.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391404901", "createdAt": "2020-03-12T05:13:15Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/TestHelper.java", "diffHunk": "@@ -0,0 +1,41 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.data.appconfiguration;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.test.TestBase;\n+import com.azure.core.util.Configuration;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.params.provider.Arguments;\n+\n+class TestHelper extends TestBase {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    protected static Stream<Arguments> getTestParameters() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNTA3Nw==", "bodyText": "private instead of protected", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391405077", "createdAt": "2020-03-12T05:13:58Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/TestHelper.java", "diffHunk": "@@ -0,0 +1,41 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.data.appconfiguration;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.test.TestBase;\n+import com.azure.core.util.Configuration;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.params.provider.Arguments;\n+\n+class TestHelper extends TestBase {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    protected static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(ConfigurationServiceVersion.values()).filter(TestHelper::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    protected static boolean shouldServiceVersionBeTested(ConfigurationServiceVersion serviceVersion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNTY1Nw==", "bodyText": "This should check what was in the environment variable before returning true.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391405657", "createdAt": "2020-03-12T05:16:39Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/TestHelper.java", "diffHunk": "@@ -0,0 +1,41 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.data.appconfiguration;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.test.TestBase;\n+import com.azure.core.util.Configuration;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.params.provider.Arguments;\n+\n+class TestHelper extends TestBase {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    protected static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(ConfigurationServiceVersion.values()).filter(TestHelper::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    protected static boolean shouldServiceVersionBeTested(ConfigurationServiceVersion serviceVersion) {\n+        if (Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS) == null) {\n+            return ConfigurationServiceVersion.getLatest().equals(serviceVersion);\n+        }\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNjQ5NA==", "bodyText": "Replace this comment with what this method is doing. We are using Netty http client as default if env variable is not set. If it's set to ALL, all HttpClients in the classpath will be tested else the name of the HttpClient class should match env variable.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391406494", "createdAt": "2020-03-12T05:20:38Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-test/src/main/java/com/azure/core/test/TestBase.java", "diffHunk": "@@ -121,6 +131,37 @@ protected void beforeTest() {\n     protected void afterTest() {\n     }\n \n+    /**\n+     * Returns a list of {@link HttpClient HttpClients} that should be tested.\n+     * @return A list of {@link HttpClient HttpClients} to be tested.\n+     */\n+    protected static Stream<HttpClient> getHttpClients() {\n+        if (testMode == TestMode.PLAYBACK) {\n+            // Call to @MethodSource method happens @BeforeEach call, so the interceptorManager is\n+            // not yet initialized. So, playbackClient will not be available until later.\n+            return Stream.of(new HttpClient[]{null});\n+        }\n+        return HttpClientProviders.getAllHttpClients().stream().filter(TestBase::shouldClientBeTested);\n+    }\n+\n+    /**\n+     * Filter out the http clients needs to run in test framework\n+     * @param client Http client needs to check\n+     * @return Boolean indicates whether filters out the client or not.\n+     */\n+    protected static boolean shouldClientBeTested(HttpClient client) {\n+        // This is for when we decide to filter some http clients based on some criteria\n+        // to reduce the time take to run the tests.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNjYxNg==", "bodyText": "This should support a comma-separated list of HttpClient names.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391406616", "createdAt": "2020-03-12T05:21:11Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-test/src/main/java/com/azure/core/test/TestBase.java", "diffHunk": "@@ -121,6 +131,37 @@ protected void beforeTest() {\n     protected void afterTest() {\n     }\n \n+    /**\n+     * Returns a list of {@link HttpClient HttpClients} that should be tested.\n+     * @return A list of {@link HttpClient HttpClients} to be tested.\n+     */\n+    protected static Stream<HttpClient> getHttpClients() {\n+        if (testMode == TestMode.PLAYBACK) {\n+            // Call to @MethodSource method happens @BeforeEach call, so the interceptorManager is\n+            // not yet initialized. So, playbackClient will not be available until later.\n+            return Stream.of(new HttpClient[]{null});\n+        }\n+        return HttpClientProviders.getAllHttpClients().stream().filter(TestBase::shouldClientBeTested);\n+    }\n+\n+    /**\n+     * Filter out the http clients needs to run in test framework\n+     * @param client Http client needs to check\n+     * @return Boolean indicates whether filters out the client or not.\n+     */\n+    protected static boolean shouldClientBeTested(HttpClient client) {\n+        // This is for when we decide to filter some http clients based on some criteria\n+        // to reduce the time take to run the tests.\n+        String configuredHttpClientToTest = Configuration.getGlobalConfiguration().get(AZURE_TEST_HTTP_CLIENTS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNzY2OQ==", "bodyText": "Why's getCertificateClient() called twice?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391407669", "createdAt": "2020-03-12T05:26:01Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTest.java", "diffHunk": "@@ -6,44 +6,65 @@\n import com.azure.core.exception.HttpResponseException;\n import com.azure.core.exception.ResourceModifiedException;\n import com.azure.core.exception.ResourceNotFoundException;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpPipeline;\n import com.azure.core.http.rest.PagedIterable;\n import com.azure.core.util.polling.PollResponse;\n import com.azure.core.util.polling.SyncPoller;\n-import com.azure.security.keyvault.certificates.models.*;\n-import org.junit.jupiter.api.Test;\n \n+import com.azure.security.keyvault.certificates.models.CertificateContact;\n+import com.azure.security.keyvault.certificates.models.CertificateContentType;\n+import com.azure.security.keyvault.certificates.models.CertificateIssuer;\n+import com.azure.security.keyvault.certificates.models.CertificateOperation;\n+import com.azure.security.keyvault.certificates.models.CertificatePolicy;\n+import com.azure.security.keyvault.certificates.models.CertificateProperties;\n+import com.azure.security.keyvault.certificates.models.DeletedCertificate;\n+import com.azure.security.keyvault.certificates.models.IssuerProperties;\n+import com.azure.security.keyvault.certificates.models.KeyVaultCertificate;\n+import com.azure.security.keyvault.certificates.models.KeyVaultCertificateWithPolicy;\n+import com.azure.security.keyvault.certificates.models.MergeCertificateOptions;\n import java.io.IOException;\n import java.net.HttpURLConnection;\n import java.security.cert.CertificateException;\n import java.security.cert.X509Certificate;\n-import java.util.*;\n-\n-import static org.junit.jupiter.api.Assertions.*;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n \n public class CertificateClientTest extends CertificateClientTestBase {\n     private CertificateClient client;\n \n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n-        if (interceptorManager.isPlaybackMode()) {\n-\n-            client = clientSetup(pipeline -> new CertificateClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        } else {\n-            client = clientSetup(pipeline -> new CertificateClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        }\n     }\n \n+    private void getCertificateClient(HttpClient httpClient,\n+        CertificateServiceVersion serviceVersion) {\n+        HttpPipeline httpPipeline = getHttpPipeline(httpClient, serviceVersion);\n+        client = new CertificateClientBuilder()\n+            .vaultUrl(getEndpoint())\n+            .pipeline(httpPipeline)\n+            .serviceVersion(serviceVersion)\n+            .buildClient();\n+    }\n \n-    @Test\n-    public void createCertificate() {\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void createCertificate(HttpClient httpClient, CertificateServiceVersion serviceVersion) {\n+        getCertificateClient(httpClient, serviceVersion);\n         createCertificateRunner((policy) -> {\n+            getCertificateClient(httpClient, serviceVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNzk0NA==", "bodyText": "Since this is not returning anything, consider renaming this to createCertificateClient() or setCertificateClient()", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391407944", "createdAt": "2020-03-12T05:27:14Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTest.java", "diffHunk": "@@ -6,44 +6,65 @@\n import com.azure.core.exception.HttpResponseException;\n import com.azure.core.exception.ResourceModifiedException;\n import com.azure.core.exception.ResourceNotFoundException;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpPipeline;\n import com.azure.core.http.rest.PagedIterable;\n import com.azure.core.util.polling.PollResponse;\n import com.azure.core.util.polling.SyncPoller;\n-import com.azure.security.keyvault.certificates.models.*;\n-import org.junit.jupiter.api.Test;\n \n+import com.azure.security.keyvault.certificates.models.CertificateContact;\n+import com.azure.security.keyvault.certificates.models.CertificateContentType;\n+import com.azure.security.keyvault.certificates.models.CertificateIssuer;\n+import com.azure.security.keyvault.certificates.models.CertificateOperation;\n+import com.azure.security.keyvault.certificates.models.CertificatePolicy;\n+import com.azure.security.keyvault.certificates.models.CertificateProperties;\n+import com.azure.security.keyvault.certificates.models.DeletedCertificate;\n+import com.azure.security.keyvault.certificates.models.IssuerProperties;\n+import com.azure.security.keyvault.certificates.models.KeyVaultCertificate;\n+import com.azure.security.keyvault.certificates.models.KeyVaultCertificateWithPolicy;\n+import com.azure.security.keyvault.certificates.models.MergeCertificateOptions;\n import java.io.IOException;\n import java.net.HttpURLConnection;\n import java.security.cert.CertificateException;\n import java.security.cert.X509Certificate;\n-import java.util.*;\n-\n-import static org.junit.jupiter.api.Assertions.*;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n \n public class CertificateClientTest extends CertificateClientTestBase {\n     private CertificateClient client;\n \n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n-        if (interceptorManager.isPlaybackMode()) {\n-\n-            client = clientSetup(pipeline -> new CertificateClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        } else {\n-            client = clientSetup(pipeline -> new CertificateClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildClient());\n-        }\n     }\n \n+    private void getCertificateClient(HttpClient httpClient,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwODQ1MA==", "bodyText": "nit: delete this line", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391408450", "createdAt": "2020-03-12T05:29:38Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -64,7 +65,8 @@ protected String getTestName() {\n     void beforeTestSetup() {\n     }\n \n-    <T> T clientSetup(Function<HttpPipeline, T> clientBuilder) {\n+    HttpPipeline getHttpPipeline(HttpClient httpClient, CertificateServiceVersion serviceVersion) {\n+   // <T> T clientSetup(Function<HttpPipeline, T> clientBuilder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwODk3NQ==", "bodyText": "This should check the environment variable before returning true.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391408975", "createdAt": "2020-03-12T05:31:49Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -605,5 +592,31 @@ public void sleep(long millis) {\n             e.printStackTrace();\n         }\n     }\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(CertificateServiceVersion.values()).filter(\n+                    CertificateClientTestBase::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    static boolean shouldServiceVersionBeTested(CertificateServiceVersion serviceVersion) {\n+        if (Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS) == null) {\n+            return CertificateServiceVersion.getLatest().equals(serviceVersion);\n+        }\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 428}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwOTE4OQ==", "bodyText": "The file name was changed. Was this intended?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391409189", "createdAt": "2020-03-12T05:32:53Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -402,11 +396,11 @@ void importCertificateRunner(Consumer<ImportCertificateOptions> testRunner) {\n     }\n \n     @Test\n-    public abstract  void importPemCertificate() throws IOException;\n+    public abstract  void importPemCertificate(HttpClient httpClient, CertificateServiceVersion serviceVersion) throws IOException;\n \n     void importPemCertificateRunner(Consumer<ImportCertificateOptions> testRunner) throws IOException {\n \n-        byte[] certificateContent = readCertificate(\"pemCert.pem\");\n+        byte[] certificateContent = readCertificate(\"certificate.pem\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 365}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwOTgwNA==", "bodyText": "Why was this change required?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391409804", "createdAt": "2020-03-12T05:35:34Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -419,24 +413,17 @@ void importPemCertificateRunner(Consumer<ImportCertificateOptions> testRunner) t\n         testRunner.accept(importCertificateOptions);\n     }\n \n+    @Test\n+    public abstract  void mergeCertificateNotFound(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n+\n     private byte[] readCertificate(String certName) throws IOException {\n         String pemPath = getClass().getClassLoader().getResource(certName).getPath();\n-        String pemCert = \"\";\n-        BufferedReader br = new BufferedReader(new FileReader(pemPath));\n-        try {\n-            String line;\n-            while ((line = br.readLine()) != null) {\n-                pemCert += line + \"\\n\";\n-            }\n-        } finally {\n-            br.close();\n+        if (pemPath.contains(\":\")) {\n+            pemPath = pemPath.substring(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 388}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQxMDExOA==", "bodyText": "Since all other --add-opens are in pom.client.xml, it's better to move this there to keep them all in one place.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391410118", "createdAt": "2020-03-12T05:36:48Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/pom.xml", "diffHunk": "@@ -41,6 +41,11 @@\n         <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n         <configuration>\n           <rerunFailingTestsCount>3</rerunFailingTestsCount>\n+          <argLine>\n+            --add-exports com.azure.core/com.azure.core.implementation.http=ALL-UNNAMED\n+            --add-opens com.azure.security.keyvault.keys/com.azure.security.keyvault.keys.cryptography=ALL-UNNAMED\n+            --add-opens com.azure.security.keyvault.keys/com.azure.security.keyvault.keys=ALL-UNNAMED\n+          </argLine>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQxMDQ0Mw==", "bodyText": "Update name of the method.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391410443", "createdAt": "2020-03-12T05:38:18Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyAsyncClientTest.java", "diffHunk": "@@ -29,25 +33,25 @@\n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n+    }\n \n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .vaultUrl(getEndpoint())\n-                .pipeline(pipeline)\n-                .buildAsyncClient());\n-        } else {\n-            client = clientSetup(pipeline -> new KeyClientBuilder()\n-                .pipeline(pipeline)\n-                .vaultUrl(getEndpoint())\n-                .buildAsyncClient());\n-        }\n+\n+    private void getKeyAsyncClient(HttpClient httpClient, KeyServiceVersion serviceVersion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQxMDkzNA==", "bodyText": "This method is a duplicate of getTestParameters() method in KeyClientTestBase.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391410934", "createdAt": "2020-03-12T05:40:25Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyClientTest.java", "diffHunk": "@@ -426,4 +475,29 @@ private DeletedKey pollOnKeyPurge(String keyName) {\n         return null;\n     }\n \n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 342}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQxMjA5MA==", "bodyText": "Shouldn't the same pipeline be used for both KeyClient and CryptographyClient?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391412090", "createdAt": "2020-03-12T05:45:19Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/cryptography/CryptographyClientTest.java", "diffHunk": "@@ -32,35 +36,34 @@\n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> {\n-                this.pipeline = pipeline;\n-                return new KeyClientBuilder()\n-                    .pipeline(pipeline)\n-                    .vaultUrl(getEndpoint())\n-                    .buildClient();\n-            });\n-        } else {\n-            client = clientSetup(pipeline -> {\n-                this.pipeline = pipeline;\n-                return new KeyClientBuilder()\n-                    .pipeline(pipeline)\n-                    .vaultUrl(getEndpoint())\n-                    .buildClient();\n-            });\n-        }\n     }\n \n-    @Test\n-    public void encryptDecryptRsa() throws Exception {\n+    private void initializeKeyClient(HttpClient httpClient) {\n+        pipeline = getHttpPipeline(httpClient, KeyServiceVersion.getLatest());\n+        client = new KeyClientBuilder()\n+            .pipeline(pipeline)\n+            .vaultUrl(getEndpoint())\n+            .buildClient();\n+    }\n+\n+    private CryptographyClient initializeCryptographyClient(String keyId, HttpClient httpClient, CryptographyServiceVersion serviceVersion) {\n+        pipeline = getHttpPipeline(httpClient, serviceVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQxMjUyNw==", "bodyText": "KeyServiceVersion should also be parameterized", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391412527", "createdAt": "2020-03-12T05:47:11Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/cryptography/CryptographyClientTest.java", "diffHunk": "@@ -32,35 +36,34 @@\n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> {\n-                this.pipeline = pipeline;\n-                return new KeyClientBuilder()\n-                    .pipeline(pipeline)\n-                    .vaultUrl(getEndpoint())\n-                    .buildClient();\n-            });\n-        } else {\n-            client = clientSetup(pipeline -> {\n-                this.pipeline = pipeline;\n-                return new KeyClientBuilder()\n-                    .pipeline(pipeline)\n-                    .vaultUrl(getEndpoint())\n-                    .buildClient();\n-            });\n-        }\n     }\n \n-    @Test\n-    public void encryptDecryptRsa() throws Exception {\n+    private void initializeKeyClient(HttpClient httpClient) {\n+        pipeline = getHttpPipeline(httpClient, KeyServiceVersion.getLatest());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQxMjc1NA==", "bodyText": "Since this is cryptography client test, should this be CryptographServiceVersion?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391412754", "createdAt": "2020-03-12T05:48:13Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/cryptography/CryptographyClientTestBase.java", "diffHunk": "@@ -209,4 +202,23 @@ public void sleep(long millis) {\n             e.printStackTrace();\n         }\n     }\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    protected Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                for (KeyServiceVersion serviceVersion : KeyServiceVersion.values()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQxMjk2MQ==", "bodyText": "Should this also include service versions?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r391412961", "createdAt": "2020-03-12T05:49:12Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/cryptography/KeyEncryptionKeyClientTestBase.java", "diffHunk": "@@ -176,4 +159,21 @@ public void sleep(long millis) {\n             e.printStackTrace();\n         }\n     }\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    protected Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                argumentsList.add(Arguments.of(httpClient));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 108}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c62de619fdc1a7567c718a047ff188e78dea6f34", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c62de619fdc1a7567c718a047ff188e78dea6f34", "committedDate": "2020-03-12T16:51:21Z", "message": "Addressed comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09a30a3553ef30b5286c8986133f763facf4986b", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/09a30a3553ef30b5286c8986133f763facf4986b", "committedDate": "2020-03-12T17:15:11Z", "message": "Support comma separate env values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b4b9caac9f21638e496863cb14e3d476b37da37", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3b4b9caac9f21638e496863cb14e3d476b37da37", "committedDate": "2020-03-12T17:29:45Z", "message": "Fixed linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f118ab14b6dab51e05aa792e39e92a0a717ed87b", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f118ab14b6dab51e05aa792e39e92a0a717ed87b", "committedDate": "2020-03-12T19:54:56Z", "message": "More fix on linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7e1f21bca6e819a4412816d2ceb3336db1527615", "committedDate": "2020-03-13T05:25:57Z", "message": "Removed unused ones"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0Njk2MjI2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-374696226", "createdAt": "2020-03-14T04:10:04Z", "commit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "state": "COMMENTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwNDoxMDowNFrOF2XpIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwNDo0NzozN1rOF2XwpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NDc4NQ==", "bodyText": "Netty dependency should not be test scoped.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392554785", "createdAt": "2020-03-14T04:10:04Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/pom.xml", "diffHunk": "@@ -36,19 +36,26 @@\n     <dependency>\n       <groupId>com.azure</groupId>\n       <artifactId>azure-core</artifactId>\n-      <version>1.3.0</version> <!-- {x-version-update;com.azure:azure-core;dependency} -->\n+      <version>1.4.0-beta.1</version> <!-- {x-version-update;unreleased_com.azure:azure-core;dependency} -->\n     </dependency>\n     <dependency>\n       <groupId>com.azure</groupId>\n       <artifactId>azure-core-http-netty</artifactId>\n       <version>1.4.0</version> <!-- {x-version-update;com.azure:azure-core-http-netty;dependency} -->\n+      <scope>test</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NDgyNw==", "bodyText": "This method can now be private.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392554827", "createdAt": "2020-03-14T04:10:46Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/AadCredentialTest.java", "diffHunk": "@@ -24,8 +27,8 @@\n     static String connectionString;\n     static TokenCredential tokenCredential;\n \n-    @BeforeEach\n-    public void setup() throws InvalidKeyException, NoSuchAlgorithmException {\n+    public void setup(HttpClient httpClient, ConfigurationServiceVersion serviceVersion)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NTE5Nw==", "bodyText": "This should be comma-separated list of versions just like http client env variable and should support \"ALL\".", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392555197", "createdAt": "2020-03-14T04:17:40Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/TestHelper.java", "diffHunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.data.appconfiguration;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.test.TestBase;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.params.provider.Arguments;\n+\n+class TestHelper extends TestBase {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(ConfigurationServiceVersion.values()).filter(TestHelper::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    private static boolean shouldServiceVersionBeTested(ConfigurationServiceVersion serviceVersion) {\n+        String serviceVersionFromEnv = Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NTMwOQ==", "bodyText": "This is not required", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392555309", "createdAt": "2020-03-14T04:20:19Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-test/src/main/java/com/azure/core/test/TestBase.java", "diffHunk": "@@ -23,6 +28,12 @@\n public abstract class TestBase implements BeforeEachCallback {\n     // Environment variable name used to determine the TestMode.\n     private static final String AZURE_TEST_MODE = \"AZURE_TEST_MODE\";\n+    private static final String AZURE_TEST_HTTP_CLIENTS = \"AZURE_TEST_HTTP_CLIENTS\";\n+    protected static final String AZURE_TEST_HTTP_CLIENTS_VALUE_ALL = \"ALL\";\n+    protected static final String AZURE_TEST_HTTP_CLIENTS_VALUE_NETTY = \"NettyAsyncHttpClient\";\n+    protected static final String AZURE_TEST_HTTP_CLIENTS_VALUE_OKHTTP = \"OkHttpAsyncHttpClient\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NTU0Ng==", "bodyText": "protected and static are contradictory. Change this to public instead.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392555546", "createdAt": "2020-03-14T04:25:00Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-test/src/main/java/com/azure/core/test/TestBase.java", "diffHunk": "@@ -23,6 +28,12 @@\n public abstract class TestBase implements BeforeEachCallback {\n     // Environment variable name used to determine the TestMode.\n     private static final String AZURE_TEST_MODE = \"AZURE_TEST_MODE\";\n+    private static final String AZURE_TEST_HTTP_CLIENTS = \"AZURE_TEST_HTTP_CLIENTS\";\n+    protected static final String AZURE_TEST_HTTP_CLIENTS_VALUE_ALL = \"ALL\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NTU3MA==", "bodyText": "public static instead of protected static.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392555570", "createdAt": "2020-03-14T04:25:28Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-test/src/main/java/com/azure/core/test/TestBase.java", "diffHunk": "@@ -121,6 +132,50 @@ protected void beforeTest() {\n     protected void afterTest() {\n     }\n \n+    /**\n+     * Returns a list of {@link HttpClient HttpClients} that should be tested.\n+     * @return A list of {@link HttpClient HttpClients} to be tested.\n+     */\n+    protected static Stream<HttpClient> getHttpClients() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NTYyMA==", "bodyText": "Update the comment here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392555620", "createdAt": "2020-03-14T04:26:18Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-test/src/main/java/com/azure/core/test/TestBase.java", "diffHunk": "@@ -121,6 +131,37 @@ protected void beforeTest() {\n     protected void afterTest() {\n     }\n \n+    /**\n+     * Returns a list of {@link HttpClient HttpClients} that should be tested.\n+     * @return A list of {@link HttpClient HttpClients} to be tested.\n+     */\n+    protected static Stream<HttpClient> getHttpClients() {\n+        if (testMode == TestMode.PLAYBACK) {\n+            // Call to @MethodSource method happens @BeforeEach call, so the interceptorManager is\n+            // not yet initialized. So, playbackClient will not be available until later.\n+            return Stream.of(new HttpClient[]{null});\n+        }\n+        return HttpClientProviders.getAllHttpClients().stream().filter(TestBase::shouldClientBeTested);\n+    }\n+\n+    /**\n+     * Filter out the http clients needs to run in test framework\n+     * @param client Http client needs to check\n+     * @return Boolean indicates whether filters out the client or not.\n+     */\n+    protected static boolean shouldClientBeTested(HttpClient client) {\n+        // This is for when we decide to filter some http clients based on some criteria\n+        // to reduce the time take to run the tests.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwNjQ5NA=="}, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NjAwNA==", "bodyText": "This should be updated too.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392556004", "createdAt": "2020-03-14T04:32:56Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -605,5 +592,31 @@ public void sleep(long millis) {\n             e.printStackTrace();\n         }\n     }\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(CertificateServiceVersion.values()).filter(\n+                    CertificateClientTestBase::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    static boolean shouldServiceVersionBeTested(CertificateServiceVersion serviceVersion) {\n+        if (Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS) == null) {\n+            return CertificateServiceVersion.getLatest().equals(serviceVersion);\n+        }\n+        return true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQwODk3NQ=="}, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 428}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NjIwNQ==", "bodyText": "Check the env variable before returning true.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392556205", "createdAt": "2020-03-14T04:36:59Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/KeyClientTestBase.java", "diffHunk": "@@ -413,4 +404,30 @@ public void sleep(long millis) {\n             e.printStackTrace();\n         }\n     }\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(KeyServiceVersion.values()).filter(KeyClientTestBase::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    private static boolean shouldServiceVersionBeTested(KeyServiceVersion serviceVersion) {\n+        if (Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS) == null) {\n+            return KeyServiceVersion.getLatest().equals(serviceVersion);\n+        }\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 262}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NjM2NA==", "bodyText": "Before this change, the same pipeline was used for both.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392556364", "createdAt": "2020-03-14T04:40:39Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/cryptography/CryptographyClientTest.java", "diffHunk": "@@ -32,35 +36,34 @@\n     @Override\n     protected void beforeTest() {\n         beforeTestSetup();\n-        if (interceptorManager.isPlaybackMode()) {\n-            client = clientSetup(pipeline -> {\n-                this.pipeline = pipeline;\n-                return new KeyClientBuilder()\n-                    .pipeline(pipeline)\n-                    .vaultUrl(getEndpoint())\n-                    .buildClient();\n-            });\n-        } else {\n-            client = clientSetup(pipeline -> {\n-                this.pipeline = pipeline;\n-                return new KeyClientBuilder()\n-                    .pipeline(pipeline)\n-                    .vaultUrl(getEndpoint())\n-                    .buildClient();\n-            });\n-        }\n     }\n \n-    @Test\n-    public void encryptDecryptRsa() throws Exception {\n+    private void initializeKeyClient(HttpClient httpClient) {\n+        pipeline = getHttpPipeline(httpClient, KeyServiceVersion.getLatest());\n+        client = new KeyClientBuilder()\n+            .pipeline(pipeline)\n+            .vaultUrl(getEndpoint())\n+            .buildClient();\n+    }\n+\n+    private CryptographyClient initializeCryptographyClient(String keyId, HttpClient httpClient, CryptographyServiceVersion serviceVersion) {\n+        pipeline = getHttpPipeline(httpClient, serviceVersion);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQxMjA5MA=="}, "originalCommit": {"oid": "73f2c3ae60ed7e6104db83773bf8de9de71e14f0"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NjY2Ng==", "bodyText": "Check env variable before returning true.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392556666", "createdAt": "2020-03-14T04:46:34Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/cryptography/TestHelper.java", "diffHunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.security.keyvault.keys.cryptography;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.test.TestBase;\n+import com.azure.core.util.Configuration;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.params.provider.Arguments;\n+\n+public class TestHelper extends TestBase {\n+    public static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(CryptographyServiceVersion.values()).filter(TestHelper::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    private static boolean shouldServiceVersionBeTested(CryptographyServiceVersion serviceVersion) {\n+        if (Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS) == null) {\n+            return CryptographyServiceVersion.getLatest().equals(serviceVersion);\n+        }\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NjcwOA==", "bodyText": "Same here - check env variable before returning true.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r392556708", "createdAt": "2020-03-14T04:47:37Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTestBase.java", "diffHunk": "@@ -437,4 +430,30 @@ public void sleep(long millis) {\n             e.printStackTrace();\n         }\n     }\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(SecretServiceVersion.values()).filter(SecretClientTestBase::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    private static boolean shouldServiceVersionBeTested(SecretServiceVersion serviceVersion) {\n+        if (Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS) == null) {\n+            return SecretServiceVersion.getLatest().equals(serviceVersion);\n+        }\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 261}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b38e333006a671c6233c1ab837d2f136be01faa5", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b38e333006a671c6233c1ab837d2f136be01faa5", "committedDate": "2020-03-16T16:34:15Z", "message": "Address all comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49067af01be0fdf46df842c3b13c807b378e3d33", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/49067af01be0fdf46df842c3b13c807b378e3d33", "committedDate": "2020-03-16T17:17:07Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into okhttp"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDUyMzUx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-375452351", "createdAt": "2020-03-16T17:52:50Z", "commit": {"oid": "49067af01be0fdf46df842c3b13c807b378e3d33"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNzo1Mjo1MFrOF2_gpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNzo1ODozNVrOF2_twA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIwNzk3NQ==", "bodyText": "AZURE_TEST_SERVICE_VERSIONS - should the name of env var be specific to each service?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r393207975", "createdAt": "2020-03-16T17:52:50Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/TestHelper.java", "diffHunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.data.appconfiguration;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.test.TestBase;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.params.provider.Arguments;\n+\n+class TestHelper extends TestBase {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(ConfigurationServiceVersion.values()).filter(TestHelper::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    private static boolean shouldServiceVersionBeTested(ConfigurationServiceVersion serviceVersion) {\n+        String serviceVersionFromEnv = Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU1NTE5Nw=="}, "originalCommit": {"oid": "7e1f21bca6e819a4412816d2ceb3336db1527615"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIxMTMyOA==", "bodyText": "Don't need to extend from TestBase", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r393211328", "createdAt": "2020-03-16T17:58:35Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/test/java/com/azure/security/keyvault/keys/cryptography/TestHelper.java", "diffHunk": "@@ -0,0 +1,67 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.security.keyvault.keys.cryptography;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.test.TestBase;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.security.keyvault.keys.KeyServiceVersion;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.params.provider.Arguments;\n+\n+public class TestHelper extends TestBase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49067af01be0fdf46df842c3b13c807b378e3d33"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a6d943eb8a67fba83dcb8f048aa3a182ababdd1", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2a6d943eb8a67fba83dcb8f048aa3a182ababdd1", "committedDate": "2020-03-16T19:16:45Z", "message": "Rename all service version variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3efe1d448941a87a46e6474726d11ad5eefebc5", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a3efe1d448941a87a46e6474726d11ad5eefebc5", "committedDate": "2020-03-16T20:16:10Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTk1NDA0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-375595404", "createdAt": "2020-03-16T21:29:10Z", "commit": {"oid": "a3efe1d448941a87a46e6474726d11ad5eefebc5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMToyOToxMFrOF3GY1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMToyOToxMFrOF3GY1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMyMDY2MQ==", "bodyText": "@sima-zhu this is the reason you're seeing the analyze step fail. There are two unreleased_com.azure:azure-core;1.4.0-beta.1 entries, one on line 48 and the other on line 43. When a duplicate entry is encountered my script was doing a write-error which apparently caused the wrapper script to exit without flushing the buffer first so it was never seen. I'll be fixing my script so that doesn't happen again.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r393320661", "createdAt": "2020-03-16T21:29:10Z", "author": {"login": "JimSuplizio"}, "path": "eng/versioning/version_client.txt", "diffHunk": "@@ -44,6 +44,8 @@ com.azure:perf-test-core;1.0.0-beta.1;1.0.0-beta.1\n # note: The unreleased dependencies will not be manipulated with the automatic PR creation code.\n unreleased_com.azure:azure-core;1.4.0-beta.1\n unreleased_com.azure:azure-core-amqp;1.1.0-beta.1\n+unreleased_com.azure:azure-core-test;1.2.0-beta.1\n+unreleased_com.azure:azure-core;1.4.0-beta.1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3efe1d448941a87a46e6474726d11ad5eefebc5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b86b20cf00e170b24e46b2c027a58f00b2abda29", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b86b20cf00e170b24e46b2c027a58f00b2abda29", "committedDate": "2020-03-16T23:15:17Z", "message": "Changed incorrect json files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjQ2NjY4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-375646668", "createdAt": "2020-03-16T23:23:03Z", "commit": {"oid": "b86b20cf00e170b24e46b2c027a58f00b2abda29"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzoyMzowM1rOF3JF7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzoyOTo0NlrOF3JNKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NDk3Mw==", "bodyText": "Name the variable and value as AZURE_APPCONFIG_TEST_SERVICE_VERSIONS as we don't want it to be mistaken for some non-test related env variable.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static final String AZURE_TEST_SERVICE_VERSIONS = \"AZURE_APPCONFIG_SERVICE_VERSIONS\";\n          \n          \n            \n                private static final String AZURE_APPCONFIG_TEST_SERVICE_VERSIONS = \"AZURE_APPCONFIG_TEST_SERVICE_VERSIONS\";", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r393364973", "createdAt": "2020-03-16T23:23:03Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/TestHelper.java", "diffHunk": "@@ -0,0 +1,67 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.data.appconfiguration;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.params.provider.Arguments;\n+\n+import static com.azure.core.test.TestBase.getHttpClients;\n+\n+class TestHelper {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n+    private static final String AZURE_TEST_SERVICE_VERSIONS = \"AZURE_APPCONFIG_SERVICE_VERSIONS\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b86b20cf00e170b24e46b2c027a58f00b2abda29"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NTI1NA==", "bodyText": "This can be declared once in TestBase.java in core-test module as ALL can be common for all libraries.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r393365254", "createdAt": "2020-03-16T23:24:04Z", "author": {"login": "srnagar"}, "path": "sdk/appconfiguration/azure-data-appconfiguration/src/test/java/com/azure/data/appconfiguration/TestHelper.java", "diffHunk": "@@ -0,0 +1,67 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.data.appconfiguration;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+import org.junit.jupiter.params.provider.Arguments;\n+\n+import static com.azure.core.test.TestBase.getHttpClients;\n+\n+class TestHelper {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n+    private static final String AZURE_TEST_SERVICE_VERSIONS = \"AZURE_APPCONFIG_SERVICE_VERSIONS\";\n+    private static final String serviceVersionFromEnv = Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS);\n+    private static final String AZURE_TEST_SERVICE_VERSIONS_VALUE_ALL = \"ALL\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b86b20cf00e170b24e46b2c027a58f00b2abda29"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NjUzMg==", "bodyText": "This should be fetched just once instead of reading from env variables for all client-service version combinations. Same for all other clients.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r393366532", "createdAt": "2020-03-16T23:28:41Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -605,5 +601,53 @@ public void sleep(long millis) {\n             e.printStackTrace();\n         }\n     }\n+\n+    /**\n+     * Returns a stream of arguments that includes all combinations of eligible {@link HttpClient HttpClients} and\n+     * service versions that should be tested.\n+     *\n+     * @return A stream of HttpClient and service version combinations to test.\n+     */\n+    static Stream<Arguments> getTestParameters() {\n+        // when this issues is closed, the newer version of junit will have better support for\n+        // cartesian product of arguments - https://github.com/junit-team/junit5/issues/1427\n+        List<Arguments> argumentsList = new ArrayList<>();\n+        getHttpClients()\n+            .forEach(httpClient -> {\n+                Arrays.stream(CertificateServiceVersion.values()).filter(\n+                    CertificateClientTestBase::shouldServiceVersionBeTested)\n+                    .forEach(serviceVersion -> argumentsList.add(Arguments.of(httpClient, serviceVersion)));\n+            });\n+        return argumentsList.stream();\n+    }\n+\n+    /**\n+     * Returns whether the given service version match the rules of test framework.\n+     *\n+     * <ul>\n+     * <li>Using latest service version as default if no environment variable is set.</li>\n+     * <li>If it's set to ALL, all Service versions in {@link CertificateServiceVersion} will be tested.</li>\n+     * <li>Otherwise, Service version string should match env variable.</li>\n+     * </ul>\n+     *\n+     * Environment values currently supported are: \"ALL\", \"${version}\".\n+     * Use comma to separate http clients want to test.\n+     * e.g. {@code set AZURE_TEST_SERVICE_VERSIONS = V1_0, V2_0}\n+     *\n+     * @param serviceVersion ServiceVersion needs to check\n+     * @return Boolean indicates whether filters out the service version or not.\n+     */\n+    private static boolean shouldServiceVersionBeTested(CertificateServiceVersion serviceVersion) {\n+        String serviceVersionFromEnv = Configuration.getGlobalConfiguration().get(AZURE_TEST_SERVICE_VERSIONS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b86b20cf00e170b24e46b2c027a58f00b2abda29"}, "originalPosition": 436}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NjgyNA==", "bodyText": "Add TEST to the name of env variable so that it's not mistaken to be non-test related config. Same for all other service version env variables used in tests.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#discussion_r393366824", "createdAt": "2020-03-16T23:29:46Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -34,27 +34,31 @@\n import com.azure.security.keyvault.certificates.models.LifetimeAction;\n import com.azure.security.keyvault.certificates.models.CertificatePolicyAction;\n import com.azure.security.keyvault.certificates.models.WellKnownIssuerNames;\n+import java.io.BufferedReader;\n+import java.io.FileReader;\n+import java.util.stream.Stream;\n import org.junit.jupiter.api.Test;\n \n-import java.io.BufferedReader;\n import java.io.ByteArrayInputStream;\n-import java.io.FileReader;\n import java.io.IOException;\n import java.security.cert.CertificateException;\n import java.security.cert.CertificateFactory;\n import java.security.cert.X509Certificate;\n import java.util.*;\n import java.util.function.Consumer;\n-import java.util.function.Function;\n import java.util.function.BiConsumer;\n+import org.junit.jupiter.params.provider.Arguments;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.junit.jupiter.api.Assertions.fail;\n \n public abstract class CertificateClientTestBase extends TestBase {\n+    static final String DISPLAY_NAME_WITH_ARGUMENTS = \"{displayName} with [{arguments}]\";\n     private static final String SDK_NAME = \"client_name\";\n     private static final String SDK_VERSION = \"client_version\";\n+    private static final String AZURE_TEST_SERVICE_VERSIONS = \"AZURE_KEYVAULT_CERTIFICATE_SERVICE_VERSIONS\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b86b20cf00e170b24e46b2c027a58f00b2abda29"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "265d2921514f362342360cf9efa9b81ef401bc85", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/265d2921514f362342360cf9efa9b81ef401bc85", "committedDate": "2020-03-16T23:41:47Z", "message": "Fixed linting and address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c792a410afbf895d9eec0c45371ecc9afac1cb83", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c792a410afbf895d9eec0c45371ecc9afac1cb83", "committedDate": "2020-03-17T02:00:53Z", "message": "Fix linting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c1773adea02dabc976751db880b7e3492f740f2", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7c1773adea02dabc976751db880b7e3492f740f2", "committedDate": "2020-03-17T16:22:13Z", "message": "remove static"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MjAyMzE4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8679#pullrequestreview-376202318", "createdAt": "2020-03-17T16:29:55Z", "commit": {"oid": "7c1773adea02dabc976751db880b7e3492f740f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 977, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}