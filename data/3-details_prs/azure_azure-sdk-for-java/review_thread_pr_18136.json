{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5OTQyNzc3", "number": 18136, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowMzoxMFrOFFeZLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNTo0NzowNlrOFF_1qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjg1MTY1OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowMzoxMFrOIGAGUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowMzoxMFrOIGAGUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2Mzk4NQ==", "bodyText": "Make it to optional.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543163985", "createdAt": "2020-12-15T09:03:10Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/pom.xml", "diffHunk": "@@ -270,6 +270,11 @@\n       <artifactId>spring-core</artifactId>\n       <version>5.2.10.RELEASE</version> <!-- {x-version-update;org.springframework:spring-core;external_dependency} -->\n     </dependency>\n+    <dependency>\n+      <groupId>org.springframework</groupId>\n+      <artifactId>spring-webmvc</artifactId>\n+      <version>5.2.10.RELEASE</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a8ac067b61e3261de7cb86ce0f22e491542640c"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjg1MjU3OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowMzoyNFrOIGAG3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowMzoyNFrOIGAG3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2NDEyNA==", "bodyText": "Not jms", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543164124", "createdAt": "2020-12-15T09:03:24Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/pom.xml", "diffHunk": "@@ -296,6 +301,7 @@\n                 <include>org.springframework:spring-core:[5.2.10.RELEASE]</include> <!-- {x-include-update;org.springframework:spring-core;external_dependency} -->\n                 <include>org.springframework:spring-web:[5.2.10.RELEASE]</include> <!-- {x-include-update;org.springframework:spring-web;external_dependency} -->\n                 <include>org.springframework:spring-jms:[5.2.10.RELEASE]</include> <!-- {x-include-update;org.springframework:spring-jms;external_dependency} -->\n+                <include>org.springframework:spring-webmvc:[5.2.10.RELEASE]</include> <!-- {x-include-update;org.springframework:spring-jms;external_dependency} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a8ac067b61e3261de7cb86ce0f22e491542640c"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjg2MTI5OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureHandlerMethodArgumentResolver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowNToyNFrOIGAMEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowNToyNFrOIGAMEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2NTQ1Nw==", "bodyText": "So the only logic we added is the constructor?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543165457", "createdAt": "2020-12-15T09:05:24Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureHandlerMethodArgumentResolver.java", "diffHunk": "@@ -0,0 +1,141 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.spring.aad.webapp;\n+\n+import org.springframework.core.MethodParameter;\n+import org.springframework.core.annotation.AnnotatedElementUtils;\n+import org.springframework.lang.Nullable;\n+import org.springframework.security.authentication.AnonymousAuthenticationToken;\n+import org.springframework.security.core.Authentication;\n+import org.springframework.security.core.authority.AuthorityUtils;\n+import org.springframework.security.core.context.SecurityContextHolder;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizeRequest;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClientProviderBuilder;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClientProvider;\n+import org.springframework.security.oauth2.client.annotation.RegisteredOAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.client.authentication.OAuth2AuthenticationToken;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2AccessTokenResponseClient;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2ClientCredentialsGrantRequest;\n+import org.springframework.security.oauth2.client.registration.ClientRegistrationRepository;\n+import org.springframework.security.oauth2.client.web.DefaultOAuth2AuthorizedClientManager;\n+import org.springframework.security.oauth2.client.web.OAuth2AuthorizedClientRepository;\n+import org.springframework.util.Assert;\n+import org.springframework.util.StringUtils;\n+import org.springframework.web.bind.support.WebDataBinderFactory;\n+import org.springframework.web.context.request.NativeWebRequest;\n+import org.springframework.web.method.support.HandlerMethodArgumentResolver;\n+import org.springframework.web.method.support.ModelAndViewContainer;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+\n+/**\n+ * Azure handler method argument resolver to add custom OAuth2AuthorizedClientManager\n+ */\n+public final class AzureHandlerMethodArgumentResolver implements HandlerMethodArgumentResolver {\n+    private static final Authentication ANONYMOUS_AUTHENTICATION = new AnonymousAuthenticationToken(\n+        \"anonymous\", \"anonymousUser\", AuthorityUtils.createAuthorityList(\"ROLE_ANONYMOUS\"));\n+\n+    private final OAuth2AuthorizedClientManager authorizedClientManager;\n+\n+    private final boolean defaultAuthorizedClientManager;\n+\n+    public AzureHandlerMethodArgumentResolver(OAuth2AuthorizedClientManager authorizedClientManager) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a8ac067b61e3261de7cb86ce0f22e491542640c"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjg2NzkwOnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureWebMvcConfigurer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowNjo1OFrOIGAQKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowNjo1OFrOIGAQKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2NjUwNg==", "bodyText": "Do we need to make it as a bean?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543166506", "createdAt": "2020-12-15T09:06:58Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureWebMvcConfigurer.java", "diffHunk": "@@ -0,0 +1,66 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.spring.aad.webapp;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClientProvider;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClientProviderBuilder;\n+import org.springframework.security.oauth2.client.endpoint.DefaultRefreshTokenTokenResponseClient;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2AccessTokenResponseClient;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2RefreshTokenGrantRequest;\n+import org.springframework.security.oauth2.client.registration.ClientRegistrationRepository;\n+import org.springframework.security.oauth2.client.web.DefaultOAuth2AuthorizedClientManager;\n+import org.springframework.security.oauth2.client.web.OAuth2AuthorizedClientRepository;\n+import org.springframework.web.method.support.HandlerMethodArgumentResolver;\n+import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n+\n+import java.util.List;\n+\n+/**\n+ * Abstract configuration class, used to make RefreshTokenGrantRequestEntityConverter take effect.\n+ */\n+public abstract class AzureWebMvcConfigurer implements WebMvcConfigurer {\n+\n+    @Autowired\n+    private AzureClientRegistrationRepository clientRegistrations;\n+\n+    @Autowired\n+    ClientRegistrationRepository clientRegistrationRepository;\n+\n+    @Autowired\n+    OAuth2AuthorizedClientRepository authorizedClientRepository;\n+\n+    public OAuth2AuthorizedClientManager authorizedClientManager(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a8ac067b61e3261de7cb86ce0f22e491542640c"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMjg3NjA5OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/RefreshTokenGrantRequestEntityConverter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowODo0NVrOIGAVBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTowODo0NVrOIGAVBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2Nzc0OQ==", "bodyText": "Can we use AzureActiveDirectoryConfiguration.AZURE_CLIENT_REGISTRATION_ID.equals(...)?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543167749", "createdAt": "2020-12-15T09:08:45Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/RefreshTokenGrantRequestEntityConverter.java", "diffHunk": "@@ -0,0 +1,46 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.spring.aad.webapp;\n+\n+import org.springframework.http.HttpEntity;\n+import org.springframework.http.RequestEntity;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2RefreshTokenGrantRequest;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2RefreshTokenGrantRequestEntityConverter;\n+import org.springframework.security.oauth2.client.registration.ClientRegistration;\n+import org.springframework.util.MultiValueMap;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Used to set \"scope\" parameter when use \"refresh_token\" to get \"access_token\".\n+ */\n+public class RefreshTokenGrantRequestEntityConverter extends OAuth2RefreshTokenGrantRequestEntityConverter {\n+\n+    private final List<ClientRegistration> otherClients;\n+\n+    public RefreshTokenGrantRequestEntityConverter(List<ClientRegistration> otherClients) {\n+        this.otherClients = otherClients;\n+    }\n+\n+    @SuppressWarnings(\"unchecked\")\n+    public RequestEntity<?> convert(OAuth2RefreshTokenGrantRequest refreshTokenGrantRequest) {\n+        RequestEntity<?> result = super.convert(refreshTokenGrantRequest);\n+        if (isRequestForDefaultClient(refreshTokenGrantRequest)) {\n+            Optional.ofNullable(result)\n+                .map(HttpEntity::getBody)\n+                .map(b -> (MultiValueMap<String, String>) b)\n+                .ifPresent(body -> body.add(\"scope\", scopeValue(refreshTokenGrantRequest)));\n+        }\n+        return result;\n+    }\n+\n+    private boolean isRequestForDefaultClient(OAuth2RefreshTokenGrantRequest request) {\n+        return otherClients.contains(request.getClientRegistration());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a8ac067b61e3261de7cb86ce0f22e491542640c"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjk5OTExOnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyMDowN1rOIGl6lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyMDowN1rOIGl6lQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc4MzU3Mw==", "bodyText": "It's not sample, this code will take effect. I prefer the following description:\nTemp solution to make RefreshTokenGrantRequestEntityConverter take effect.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543783573", "createdAt": "2020-12-16T00:20:07Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "diffHunk": "@@ -172,4 +206,21 @@ protected void configure(HttpSecurity http) throws Exception {\n                 .oidcUserService(oidcUserService);\n         }\n     }\n+\n+    /**\n+     * Sample configuration to make RefreshTokenGrantRequestEntityConverter take effect.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf41c79c703bf09c245f3f938e51316270da9938"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNzAwMjY5OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyMTozM1rOIGl8jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyMTozM1rOIGl8jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc4NDA3OA==", "bodyText": "Use one space instead of two after *.\nNo space after issues.\nIt will be issue instead of issues.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543784078", "createdAt": "2020-12-16T00:21:33Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "diffHunk": "@@ -172,4 +206,21 @@ protected void configure(HttpSecurity http) throws Exception {\n                 .oidcUserService(oidcUserService);\n         }\n     }\n+\n+    /**\n+     * Sample configuration to make RefreshTokenGrantRequestEntityConverter take effect.\n+     * TODO: spring-security can't inject OAuth2AuthorizedClientManager to OAuth2AuthorizedClientArgumentResolver\n+     *  Future versions may support this , this may be a better solution\n+     *  issues : https://github.com/spring-projects/spring-security/issues/8700", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf41c79c703bf09c245f3f938e51316270da9938"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNzAwNTQxOnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyMjoyM1rOIGl98A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyMjoyM1rOIGl98A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc4NDQzMg==", "bodyText": "TODO: remove this logic after spring-security can inject OAuth2AuthorizedClientManager to OAuth2AuthorizedClientArgumentResolver", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543784432", "createdAt": "2020-12-16T00:22:23Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "diffHunk": "@@ -172,4 +206,21 @@ protected void configure(HttpSecurity http) throws Exception {\n                 .oidcUserService(oidcUserService);\n         }\n     }\n+\n+    /**\n+     * Sample configuration to make RefreshTokenGrantRequestEntityConverter take effect.\n+     * TODO: spring-security can't inject OAuth2AuthorizedClientManager to OAuth2AuthorizedClientArgumentResolver", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf41c79c703bf09c245f3f938e51316270da9938"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNzAxNDU2OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureWebMvcConfigurer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyNTozOFrOIGmCpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyNTozOFrOIGmCpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc4NTYzNg==", "bodyText": "What is this method used for?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543785636", "createdAt": "2020-12-16T00:25:38Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureWebMvcConfigurer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.spring.aad.webapp;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager;\n+import org.springframework.security.oauth2.client.endpoint.DefaultRefreshTokenTokenResponseClient;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2AccessTokenResponseClient;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2RefreshTokenGrantRequest;\n+import org.springframework.security.oauth2.client.web.method.annotation.OAuth2AuthorizedClientArgumentResolver;\n+import org.springframework.web.method.support.HandlerMethodArgumentResolver;\n+import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n+\n+import java.util.List;\n+\n+/**\n+ * Abstract configuration class, used to make RefreshTokenGrantRequestEntityConverter take effect.\n+ */\n+public abstract class AzureWebMvcConfigurer implements WebMvcConfigurer {\n+\n+    @Autowired\n+    OAuth2AuthorizedClientManager oAuth2AuthorizedClientManager;\n+\n+    public OAuth2AccessTokenResponseClient<OAuth2RefreshTokenGrantRequest> oAuth2AccessTokenResponseClient() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf41c79c703bf09c245f3f938e51316270da9938"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNzAyMTM2OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureWebMvcConfigurer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyODowM1rOIGmGXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyODowM1rOIGmGXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc4NjU5MA==", "bodyText": "Can we delete AzureWebMvcConfigurer and let DefaultAzureWebMvcContext implements WebMvcConfigurer?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543786590", "createdAt": "2020-12-16T00:28:03Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureWebMvcConfigurer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.spring.aad.webapp;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager;\n+import org.springframework.security.oauth2.client.endpoint.DefaultRefreshTokenTokenResponseClient;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2AccessTokenResponseClient;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2RefreshTokenGrantRequest;\n+import org.springframework.security.oauth2.client.web.method.annotation.OAuth2AuthorizedClientArgumentResolver;\n+import org.springframework.web.method.support.HandlerMethodArgumentResolver;\n+import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n+\n+import java.util.List;\n+\n+/**\n+ * Abstract configuration class, used to make RefreshTokenGrantRequestEntityConverter take effect.\n+ */\n+public abstract class AzureWebMvcConfigurer implements WebMvcConfigurer {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf41c79c703bf09c245f3f938e51316270da9938"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNzAyNDg4OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/RefreshTokenGrantRequestEntityConverter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyOToyMVrOIGmIYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDoyOToyMVrOIGmIYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc4NzEwNA==", "bodyText": "I prefer AzureOauth2RefreshTokenGrantRequestEntityConverter.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543787104", "createdAt": "2020-12-16T00:29:21Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/RefreshTokenGrantRequestEntityConverter.java", "diffHunk": "@@ -0,0 +1,32 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.spring.aad.webapp;\n+\n+import org.springframework.http.HttpEntity;\n+import org.springframework.http.RequestEntity;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2RefreshTokenGrantRequest;\n+import org.springframework.security.oauth2.client.endpoint.OAuth2RefreshTokenGrantRequestEntityConverter;\n+import org.springframework.util.MultiValueMap;\n+\n+import java.util.Optional;\n+\n+/**\n+ * Used to set \"scope\" parameter when use \"refresh_token\" to get \"access_token\".\n+ */\n+public class RefreshTokenGrantRequestEntityConverter extends OAuth2RefreshTokenGrantRequestEntityConverter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf41c79c703bf09c245f3f938e51316270da9938"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNzAzMzQ5OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDozMjoxNVrOIGmM8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDozMjoxNVrOIGmM8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc4ODI3NA==", "bodyText": "Move this to AzureActiveDirectoryConfiguration", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543788274", "createdAt": "2020-12-16T00:32:15Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureActiveDirectoryConfiguration.java", "diffHunk": "@@ -58,6 +67,31 @@ public OAuth2AuthorizedClientRepository authorizedClientRepository(AzureClientRe\n         return new AzureAuthorizedClientRepository(repo);\n     }\n \n+    @Bean\n+    @ConditionalOnProperty(prefix = \"azure.activedirectory.user-group\", value = \"allowed-groups\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf41c79c703bf09c245f3f938e51316270da9938"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxODMzMTI4OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot/pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNTo0NzowNlrOIGyjsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNTo0NzowNlrOIGyjsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzk5MDcwNg==", "bodyText": "We need add this dependency in azure-spring-boot-starter-active-directory. (without optional).", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18136#discussion_r543990706", "createdAt": "2020-12-16T05:47:06Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot/pom.xml", "diffHunk": "@@ -270,6 +270,12 @@\n       <artifactId>spring-core</artifactId>\n       <version>5.2.10.RELEASE</version> <!-- {x-version-update;org.springframework:spring-core;external_dependency} -->\n     </dependency>\n+    <dependency>\n+      <groupId>org.springframework</groupId>\n+      <artifactId>spring-webmvc</artifactId>\n+      <version>5.2.10.RELEASE</version> <!-- {x-version-update;org.springframework:spring-webmvc;external_dependency} -->\n+      <optional>true</optional>\n+    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59338bbf5304d724d07d3db8340803b7aa1129d6"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2575, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}