{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NzQwNDU5", "number": 9686, "title": "Adding support for auto create and auto delete test container", "bodyText": "This PR will create the test db and test container mentioned in the run parameters for all the workload if they doesn't exist.\nAlso It will delete the container at the end of the test.", "createdAt": "2020-03-30T15:51:37Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9686", "merged": true, "mergeCommit": {"oid": "e0b8bb33495a14c026ef2f2feac8bf5d488c3825"}, "closed": true, "closedAt": "2020-04-02T15:42:29Z", "author": {"login": "simplynaveen20"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSwe15gH2gAyMzk1NzQwNDU5OjZjYTIwNzBhOWUwMzZlOWU0ODYwNjg3YzU3OWFiZGM1ODA5YzM4NGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTuN2KAFqTM4NjU1MzI2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ca2070a9e036e9e4860687c579abdc5809c384c", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6ca2070a9e036e9e4860687c579abdc5809c384c", "committedDate": "2020-03-30T15:45:51Z", "message": "adding support for createIfNotExist for db and container , aslo deleting container at the last"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MDA2MjQ4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9686#pullrequestreview-384006248", "createdAt": "2020-03-30T16:04:30Z", "commit": {"oid": "6ca2070a9e036e9e4860687c579abdc5809c384c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNjowNDozMFrOF9xDag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNjoxMDo1NVrOF9xVLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMxMTE0Ng==", "bodyText": "this is the default partition-key if the collection does not exist. But if the collection exist the partition-key path could be different and that's ok. right?\nSo could you please change the naming to DEFAULT_PARTITION_KEY_PATH", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9686#discussion_r400311146", "createdAt": "2020-03-30T16:04:30Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/src/main/java/com/azure/cosmos/benchmark/Configuration.java", "diffHunk": "@@ -32,6 +32,7 @@\n \n class Configuration {\n \n+    final static String PARTITION_KEY = \"/pk\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ca2070a9e036e9e4860687c579abdc5809c384c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMxNTY5Mw==", "bodyText": "In our testing subscriptions we can't create a collection with 1M throughput upfront. The workaround we have is to create a collection with 100K throughput and then scale up. Now with this auto deleting collection it means we have to do this manual process everytime.\nwe don't want to always delete the collection. We should have a config option called autoCollectionCreateEnabled when present we should attempt to\n\ncreate collection if not exist\ndelete the collection\n\nwhen autoCollectionCreateEnabled=false we shouldn't attempt to create or delete the collection, and if the collection doesn't exist we should fail.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9686#discussion_r400315693", "createdAt": "2020-03-30T16:10:55Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/src/main/java/com/azure/cosmos/benchmark/AsyncBenchmark.java", "diffHunk": "@@ -130,6 +134,8 @@ protected void init() {\n     }\n \n     void shutdown() {\n+        cosmosAsyncContainer.delete().block();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ca2070a9e036e9e4860687c579abdc5809c384c"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MDU4NDMy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9686#pullrequestreview-384058432", "createdAt": "2020-03-30T17:06:21Z", "commit": {"oid": "6ca2070a9e036e9e4860687c579abdc5809c384c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNzowNjoyMVrOF9zmVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNzowNjoyMVrOF9zmVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM1Mjg1Mw==", "bodyText": "if the application deletes it should create too.\nwhen a user runs an application, the user expects to either 1.  application handles the collection creation/deletion 2. the user provides the collection and the app doesn't create nor deletes.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9686#discussion_r400352853", "createdAt": "2020-03-30T17:06:21Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/src/main/java/com/azure/cosmos/benchmark/AsynReadWithMultipleClients.java", "diffHunk": "@@ -227,33 +212,29 @@ private void createClients() {\n                         .connectionReuseAcrossClientsEnabled(true)\n                         .buildAsyncClient();\n                     List<PojoizedJson> docsToRead = new ArrayList<>();\n-                    if (!configuration.isDeleteCollections()) {\n-                        CosmosAsyncDatabase cosmosAsyncDatabase = asyncClient.createDatabaseIfNotExists(this.configuration.getDatabaseId()).block().getDatabase();\n-                        CosmosAsyncContainer cosmosAsyncContainer =\n-                            cosmosAsyncDatabase.createContainerIfNotExists(configuration.getCollectionId(), PARTITION_KEY, configuration.getThroughput()).block().getContainer();\n-                        String partitionKey = cosmosAsyncContainer.read().block().getProperties().getPartitionKeyDefinition()\n-                            .getPaths().iterator().next().split(\"/\")[1];\n-                        String dataFieldValue = RandomStringUtils.randomAlphabetic(this.configuration.getDocumentDataFieldSize());\n-                        ArrayList<Flux<PojoizedJson>> createDocumentObservables = new ArrayList<>();\n-\n-                        for (int i = 0; i < this.configuration.getNumberOfPreCreatedDocuments(); i++) {\n-                            String uuid = UUID.randomUUID().toString();\n-                            com.azure.cosmos.benchmark.PojoizedJson newDoc = generateDocument(uuid, dataFieldValue, partitionKey);\n-\n-                            Flux<PojoizedJson> obs = cosmosAsyncContainer.createItem(newDoc).map(resp -> {\n-                                    com.azure.cosmos.benchmark.PojoizedJson x =\n-                                        resp.getItem();\n-                                    return x;\n-                                }\n-                            ).flux();\n-                            createDocumentObservables.add(obs);\n-                        }\n-                        docsToRead = Flux.merge(Flux.fromIterable(createDocumentObservables), 100).collectList().block();\n-\n-                        logger.info(\"Client have been initialized with data created for host {}\", hostAndKey[0]);\n-                    } else {\n-                        logger.info(\"Client have been initialized with host {}\", hostAndKey[0]);\n+                    CosmosAsyncDatabase cosmosAsyncDatabase = asyncClient.createDatabaseIfNotExists(this.configuration.getDatabaseId()).block().getDatabase();\n+                    CosmosAsyncContainer cosmosAsyncContainer =\n+                        cosmosAsyncDatabase.createContainerIfNotExists(configuration.getCollectionId(), Configuration.PARTITION_KEY, configuration.getThroughput()).block().getContainer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ca2070a9e036e9e4860687c579abdc5809c384c"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb08736630e05d428e7a2d612b71a0cff8db711f", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fb08736630e05d428e7a2d612b71a0cff8db711f", "committedDate": "2020-03-31T17:14:45Z", "message": "deleting resources if created"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37c55d66984cd44d728e542197b89b4856709244", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/37c55d66984cd44d728e542197b89b4856709244", "committedDate": "2020-03-31T17:19:53Z", "message": "string constant text change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NTUzMjY4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9686#pullrequestreview-386553268", "createdAt": "2020-04-02T15:41:24Z", "commit": {"oid": "37c55d66984cd44d728e542197b89b4856709244"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1432, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}