{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyNDY5ODk2", "number": 16241, "title": "Avoiding ctl workload failure on some write failures", "bodyText": "During initialization CTL try to create 10000 pre populated documents for read operation , even a single failure stop the whole ctl.\nThis PR will not failed the CTL  but print it in log how much success vs failure.\nAlso moving throughput from container level to Database level , so as to support split orchestration on CTL.", "createdAt": "2020-10-13T15:29:54Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16241", "merged": true, "mergeCommit": {"oid": "6095021cde3d52238f8a939ed1f7b473fb1128b7"}, "closed": true, "closedAt": "2020-10-13T19:06:26Z", "author": {"login": "simplynaveen20"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSKRyUgH2gAyNTAyNDY5ODk2OmNjZDQ5ZWE3ZWMzODAxNGIyZWQ4Y2RiZjE1YjQ5MDlkYjBjMmE1ZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSMA-iAFqTUwNzY3MzIxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ccd49ea7ec38014b2ed8cdbf15b4909db0c2a5e8", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ccd49ea7ec38014b2ed8cdbf15b4909db0c2a5e8", "committedDate": "2020-10-13T15:26:21Z", "message": "Avoiding ctl workload failure on some write failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NTc1NjQy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16241#pullrequestreview-507575642", "createdAt": "2020-10-13T15:39:41Z", "commit": {"oid": "ccd49ea7ec38014b2ed8cdbf15b4909db0c2a5e8"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNTozOTo0MVrOHgtLZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNTo0NzoyNlrOHgth_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA1NjY3OA==", "bodyText": "please don't do concat in the logger\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                logger.error(\"Error during pre populating item \"+throwable.getMessage());\n          \n          \n            \n                                logger.error(\"Error during pre populating item\", throwable);", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16241#discussion_r504056678", "createdAt": "2020-10-13T15:39:41Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/src/main/java/com/azure/cosmos/benchmark/ctl/AsyncCtlWorkload.java", "diffHunk": "@@ -276,13 +279,23 @@ private void createPrePopulatedDocs(int numberOfPreCreatedDocuments) {\n                     PojoizedJson x =\n                         resp.getItem();\n                     return x;\n+                }).onErrorResume(throwable -> {\n+                    failureCount.incrementAndGet();\n+                    logger.error(\"Error during pre populating item \"+throwable.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccd49ea7ec38014b2ed8cdbf15b4909db0c2a5e8"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA2MjQ2Mg==", "bodyText": "please fix the code style.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            successCount.get()-failureCount.get(), container.getId());\n          \n          \n            \n                            successCount.get() - failureCount.get(), container.getId());", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16241#discussion_r504062462", "createdAt": "2020-10-13T15:47:26Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-benchmark/src/main/java/com/azure/cosmos/benchmark/ctl/AsyncCtlWorkload.java", "diffHunk": "@@ -276,13 +279,23 @@ private void createPrePopulatedDocs(int numberOfPreCreatedDocuments) {\n                     PojoizedJson x =\n                         resp.getItem();\n                     return x;\n+                }).onErrorResume(throwable -> {\n+                    failureCount.incrementAndGet();\n+                    logger.error(\"Error during pre populating item \"+throwable.getMessage());\n+                    return Mono.empty();\n+                }).doOnSuccess(pojoizedJson -> {\n+                    successCount.incrementAndGet();\n                 }).flux();\n                 createDocumentObservables.add(obs);\n             }\n             docsToRead.put(container.getId(),\n                 Flux.merge(Flux.fromIterable(createDocumentObservables), 100).collectList().block());\n             logger.info(\"Finished pre-populating {} documents for container {}\",\n-                numberOfPreCreatedDocuments, container.getId());\n+                successCount.get()-failureCount.get(), container.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccd49ea7ec38014b2ed8cdbf15b4909db0c2a5e8"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a05b17b340fa6dd27fa8e93fe4fec7d4fabc89d", "author": {"user": {"login": "simplynaveen20", "name": "Naveen Singh"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3a05b17b340fa6dd27fa8e93fe4fec7d4fabc89d", "committedDate": "2020-10-13T16:35:10Z", "message": "Fixing formatting comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjQ4MzU2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16241#pullrequestreview-507648356", "createdAt": "2020-10-13T16:55:56Z", "commit": {"oid": "3a05b17b340fa6dd27fa8e93fe4fec7d4fabc89d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjo1NTo1NlrOHgwqvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjo1NTo1NlrOHgwqvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDExMzg1Mg==", "bodyText": "We are not throwing error in case of pre-populating failures, is this intentional ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16241#discussion_r504113852", "createdAt": "2020-10-13T16:55:56Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos-benchmark/src/main/java/com/azure/cosmos/benchmark/ctl/AsyncCtlWorkload.java", "diffHunk": "@@ -276,13 +279,23 @@ private void createPrePopulatedDocs(int numberOfPreCreatedDocuments) {\n                     PojoizedJson x =\n                         resp.getItem();\n                     return x;\n+                }).onErrorResume(throwable -> {\n+                    failureCount.incrementAndGet();\n+                    logger.error(\"Error during pre populating item \", throwable.getMessage());\n+                    return Mono.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a05b17b340fa6dd27fa8e93fe4fec7d4fabc89d"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjcyODkw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16241#pullrequestreview-507672890", "createdAt": "2020-10-13T17:27:21Z", "commit": {"oid": "3a05b17b340fa6dd27fa8e93fe4fec7d4fabc89d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzoyNzoyMVrOHgx1FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzoyNzoyMVrOHgx1FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzMjg4NQ==", "bodyText": "logging this as warning instead? Doesn't do any harm, correct?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16241#discussion_r504132885", "createdAt": "2020-10-13T17:27:21Z", "author": {"login": "FabianMeiswinkel"}, "path": "sdk/cosmos/azure-cosmos-benchmark/src/main/java/com/azure/cosmos/benchmark/ctl/AsyncCtlWorkload.java", "diffHunk": "@@ -276,13 +279,23 @@ private void createPrePopulatedDocs(int numberOfPreCreatedDocuments) {\n                     PojoizedJson x =\n                         resp.getItem();\n                     return x;\n+                }).onErrorResume(throwable -> {\n+                    failureCount.incrementAndGet();\n+                    logger.error(\"Error during pre populating item \", throwable.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a05b17b340fa6dd27fa8e93fe4fec7d4fabc89d"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjczMjE5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16241#pullrequestreview-507673219", "createdAt": "2020-10-13T17:27:48Z", "commit": {"oid": "3a05b17b340fa6dd27fa8e93fe4fec7d4fabc89d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2029, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}