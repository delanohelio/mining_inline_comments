{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwOTg4NzI1", "number": 14865, "title": "Fixes management support for AuthorizationRules", "bodyText": "AuthorizationRules were not currently supported.\n\nAdds SharedAccessAuthorizationRule\nUpdates AuthorizationRule to an interface like .NET\nFixes serialization bug where the service only understands the global namespace, otherwise, it fails with a bad request.", "createdAt": "2020-09-07T02:31:20Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14865", "merged": true, "mergeCommit": {"oid": "cd8b4a161e2e5550cecb29aec2b8530587b91059"}, "closed": true, "closedAt": "2020-09-09T22:20:08Z", "author": {"login": "conniey"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFqcEuAH2gAyNDgwOTg4NzI1OjFmNGZiZjZiNzNkMGQ2ZjBlZjhiM2IwYzZjNDc4YzAwMjllMTYwNTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHSTiOAFqTQ4NTM3MzczMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f4fbf6b73d0d6f0ef8b3b0c6c478c0029e16059", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f4fbf6b73d0d6f0ef8b3b0c6c478c0029e16059", "committedDate": "2020-09-04T19:33:32Z", "message": "Expose AuthorizationRules on Queue and Topic options."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ba29c461cca3881c349b11f1eefbe92080c26b8", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4ba29c461cca3881c349b11f1eefbe92080c26b8", "committedDate": "2020-09-06T18:21:24Z", "message": "Rename AuthorizationRule -> AuthorizationRuleImpl. Add an implementation of SharedAccessAuthorizationRule."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e6d7c9443ac9ef2f995f3d1065cb8ded69be009", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8e6d7c9443ac9ef2f995f3d1065cb8ded69be009", "committedDate": "2020-09-06T19:57:33Z", "message": "Adding CreateQueueEntry with rules."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceaf1579371e63151e0acbb95734634dac3e8ea4", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ceaf1579371e63151e0acbb95734634dac3e8ea4", "committedDate": "2020-09-07T00:22:51Z", "message": "Add deserialization test for CreateQueueEntry."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cf1203028109a2714d226a7098d379bf51ce6ff", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2cf1203028109a2714d226a7098d379bf51ce6ff", "committedDate": "2020-09-07T01:37:37Z", "message": "Fixing namespaces on autogenerated code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0539c71b1afd9c214c1c8cea5d7a0d324392d40f", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0539c71b1afd9c214c1c8cea5d7a0d324392d40f", "committedDate": "2020-09-07T01:37:50Z", "message": "Setting implementation type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88f4b992a47075ca5d29ea63d70f44f0db99e418", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/88f4b992a47075ca5d29ea63d70f44f0db99e418", "committedDate": "2020-09-07T01:38:20Z", "message": "Fixing serialization and replacing global namespace."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4479ff8be5d0c09623900780a5b954322274a488", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4479ff8be5d0c09623900780a5b954322274a488", "committedDate": "2020-09-07T01:38:39Z", "message": "Adding integration test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08726161a18cfb9e40598f9e12a7408776d522a6", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/08726161a18cfb9e40598f9e12a7408776d522a6", "committedDate": "2020-09-07T01:39:01Z", "message": "Updating CreateQueueEntry."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "447f4c3e130ef7204f3e5d1f966ac594cb9e14e7", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/447f4c3e130ef7204f3e5d1f966ac594cb9e14e7", "committedDate": "2020-09-07T01:46:19Z", "message": "Fix assumption based on if it is playback."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0e686ee06f4748ce6b3c8a0b1697bb8e5837049", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c0e686ee06f4748ce6b3c8a0b1697bb8e5837049", "committedDate": "2020-09-07T01:49:27Z", "message": "Fix checkstyles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MzczNzMz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14865#pullrequestreview-485373733", "createdAt": "2020-09-09T20:20:30Z", "commit": {"oid": "c0e686ee06f4748ce6b3c8a0b1697bb8e5837049"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMDoyMDozMFrOHPY5BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMDozMjowOVrOHPZQpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg5ODUwMA==", "bodyText": "Should there be else when it is not instance of CreateQueueBody, should we log it ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14865#discussion_r485898500", "createdAt": "2020-09-09T20:20:30Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/implementation/ServiceBusManagementSerializer.java", "diffHunk": "@@ -21,15 +22,34 @@\n  */\n public class ServiceBusManagementSerializer implements SerializerAdapter {\n     private static final String MINIMUM_DATETIME_FORMATTED = \">0001-01-01T00:00:00Z</\";\n-    private static final Pattern MINIMUM_DATETIME_PATTERN = Pattern.compile(\"\\\\>0001\\\\-01\\\\-01T00:00:00\\\\<\\\\/\",\n+    private static final Pattern MINIMUM_DATETIME_PATTERN = Pattern.compile(\">0001-01-01T00:00:00</\",\n+        Pattern.MULTILINE);\n+    private static final Pattern NAMESPACE_PATTERN = Pattern.compile(\n+        \"xmlns:(?<namespace>\\\\w+)=\\\"http://schemas\\\\.microsoft\\\\.com/netservices/2010/10/servicebus/connect\\\"\",\n         Pattern.MULTILINE);\n \n     private final JacksonAdapter jacksonAdapter = new JacksonAdapter();\n     private final ClientLogger logger = new ClientLogger(ServiceBusManagementSerializer.class);\n \n     @Override\n     public String serialize(Object object, SerializerEncoding encoding) throws IOException {\n-        return jacksonAdapter.serialize(object, encoding);\n+        final String contents = jacksonAdapter.serialize(object, encoding);\n+\n+        // This hack exists because the service requires a global namespace for the XML rather than allowing\n+        // each XML element to be prefaced with an explicit namespace. For example:\n+        // xmlns=\"foo\" works because \"foo\" is assigned the global namespace.\n+        // xmlns:ns0=\"foo\", and then prefixing all elements with ns0:AuthorizationRule will break.\n+        if (object instanceof CreateQueueBody) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0e686ee06f4748ce6b3c8a0b1697bb8e5837049"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkwNDU1MA==", "bodyText": "Are we supposed to add these keys here ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14865#discussion_r485904550", "createdAt": "2020-09-09T20:32:09Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/test/resources/xml/CreateQueueEntry.xml", "diffHunk": "@@ -0,0 +1,27 @@\n+<entry xmlns=\"http://www.w3.org/2005/Atom\">\n+  <content type=\"application/xml\">\n+    <QueueDescription xmlns=\"http://schemas.microsoft.com/netservices/2010/10/servicebus/connect\">\n+      <LockDuration>PT10M</LockDuration>\n+      <MaxSizeInMegabytes>1028</MaxSizeInMegabytes>\n+      <RequiresDuplicateDetection>false</RequiresDuplicateDetection>\n+      <RequiresSession>true</RequiresSession>\n+      <DeadLetteringOnMessageExpiration>false</DeadLetteringOnMessageExpiration>\n+      <MaxDeliveryCount>5</MaxDeliveryCount>\n+      <EnableBatchedOperations>true</EnableBatchedOperations>\n+      <AuthorizationRules>\n+        <AuthorizationRule xmlns:ns0=\"http://www.w3.org/2001/XMLSchema-instance\" ns0:type=\"SharedAccessAuthorizationRule\">\n+          <ClaimType>SharedAccessKey</ClaimType>\n+          <ClaimValue>None</ClaimValue>\n+          <Rights>\n+            <AccessRights>Send</AccessRights>\n+          </Rights>\n+          <KeyName>test-name</KeyName>\n+          <PrimaryKey>/4jWkzKBFwO0VemXmUYtBnXJ3Me+saF8hQPE5HzJ/hg=</PrimaryKey>\n+          <SecondaryKey>NsNSEwj//k4ShF7wHsRHj54HsjnyWvyjmfCd3tfXR2Y=</SecondaryKey>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0e686ee06f4748ce6b3c8a0b1697bb8e5837049"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3639, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}