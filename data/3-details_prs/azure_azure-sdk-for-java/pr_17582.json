{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwODg3MDE3", "number": 17582, "title": "Add HttpClientOptions", "bodyText": "Fixes #10449\nThis PR introduces HttpClientOptions into azure-core. The purpose of this class is to allow for general configuration of HttpClients constructed using HttpClientProvider. The options offered aren't a complete replacement of those allowed in each individual HttpClient builder class but a generalization of all common configurations available in out HttpClient builders.", "createdAt": "2020-11-13T22:43:40Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17582", "merged": true, "mergeCommit": {"oid": "3c0a7cca554c6cf04ba9e294e051fe7bf15cdb48"}, "closed": true, "closedAt": "2021-01-13T21:37:19Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcPE_4gH2gAyNTIwODg3MDE3OjdlMDEzNTI4NGFmOWFlNzQ0OWNiZTYxNTQ4ODEzOGQxNGQ5MzdmMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdv1Mn9AH2gAyNTIwODg3MDE3OjFiZjZiY2I1NDZjOTI0ODYwZTJmMGVkNDg3MmUyZmQxNTI5NjhiYzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7e0135284af9ae7449cbe615488138d14d937f26", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7e0135284af9ae7449cbe615488138d14d937f26", "committedDate": "2020-11-13T22:41:09Z", "message": "Add HttpClientOptions to allow general configuration of HttpClients when using an HttpClientProvider to create an instance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDY2Mjg1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17582#pullrequestreview-530466285", "createdAt": "2020-11-13T22:52:08Z", "commit": {"oid": "7e0135284af9ae7449cbe615488138d14d937f26"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMjo1MjowOFrOHzCFHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMjo1MjowOFrOHzCFHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3MzUwMQ==", "bodyText": "If I understand correctly ClientOptions::responseTimeout is not applicable for OkHttp right?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17582#discussion_r523273501", "createdAt": "2020-11-13T22:52:08Z", "author": {"login": "anuchandy"}, "path": "sdk/core/azure-core-http-okhttp/src/main/java/com/azure/core/http/okhttp/implementation/OkHttpClientProvider.java", "diffHunk": "@@ -13,4 +14,18 @@\n     public HttpClient createInstance() {\n         return new OkHttpAsyncHttpClientBuilder().build();\n     }\n+\n+    @Override\n+    public HttpClient createInstance(HttpClientOptions clientOptions) {\n+        OkHttpAsyncHttpClientBuilder builder = new OkHttpAsyncHttpClientBuilder();\n+\n+        if (clientOptions != null) {\n+            builder = builder.proxy(clientOptions.getProxyOptions())\n+                .configuration(clientOptions.getConfiguration())\n+                .writeTimeout(clientOptions.getWriteTimeout())\n+                .readTimeout(clientOptions.getReadTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e0135284af9ae7449cbe615488138d14d937f26"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNzIwODAx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17582#pullrequestreview-531720801", "createdAt": "2020-11-16T20:29:29Z", "commit": {"oid": "7e0135284af9ae7449cbe615488138d14d937f26"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMDoyOToyOVrOH0QKJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMDoyOToyOVrOH0QKJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU1Mjc0MQ==", "bodyText": "Do we need a new type here? We already have ClientOptions which also is used for configuring client-specific settings.  There are pros and cons to using ClientOptions vs creating new HttpClientOptions.\nUsing ClientOptions:\nPros:\n\nClientOptions is already GA'd and is wired on to many client builders. So, adding a new configuration to ClientOptions will require no further changes to client builders in terms of API.\nUser has to learn about just one ClientOptions type\n\nCons:\n\nClientOptions is used for both AMQP and HTTP clients. So, some of the configurations in HTTP client options may not apply for AMQP services\n\nUsing HttpClientOptions:\nPros:\n\nContains only configurations applicable to HTTP-based services\n\nCons:\n\nRequires updating client builders of all services to add a new option to set HttpClientOptions\nUsers will see two setters: clientOptions(ClientOptions clientOptions) and httpClientOptions(HttpClientOptions httpClientOptions)", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17582#discussion_r524552741", "createdAt": "2020-11-16T20:29:29Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/http/HttpClientOptions.java", "diffHunk": "@@ -0,0 +1,161 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.http;\n+\n+import com.azure.core.util.Configuration;\n+\n+import java.time.Duration;\n+\n+/**\n+ * General configuration options for {@link HttpClient HttpClients}.TableEntity\n+ */\n+public class HttpClientOptions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e0135284af9ae7449cbe615488138d14d937f26"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa45fdf9dda2faf1fa8de17db8329196a3df8156", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/aa45fdf9dda2faf1fa8de17db8329196a3df8156", "committedDate": "2021-01-13T17:47:44Z", "message": "Merge branch 'master' into AzCore_HttpClientOptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2af3e4cd45cdaab7d8a00063d0c720916cdd3b81", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2af3e4cd45cdaab7d8a00063d0c720916cdd3b81", "committedDate": "2021-01-13T19:14:14Z", "message": "Update HttpClientOptions to extend ClientOptions, passing ClientOptions to more locations, documentation updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d5e97032b26aee3ef119a1a66997a130597c685", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1d5e97032b26aee3ef119a1a66997a130597c685", "committedDate": "2021-01-13T19:33:38Z", "message": "Fix merge conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NTU1MDE4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17582#pullrequestreview-567555018", "createdAt": "2021-01-13T19:35:13Z", "commit": {"oid": "1d5e97032b26aee3ef119a1a66997a130597c685"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxOTozNToxNFrOIS_G2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxOTozOTozNFrOIS_QOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Njc3OTIyNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return The update HttpClientOptions object.\n          \n          \n            \n                 * @return The updated HttpClientOptions object.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17582#discussion_r556779227", "createdAt": "2021-01-13T19:35:14Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/HttpClientOptions.java", "diffHunk": "@@ -0,0 +1,176 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.ProxyOptions;\n+\n+import java.time.Duration;\n+\n+/**\n+ * General configuration options for {@link HttpClient HttpClients}.\n+ */\n+public class HttpClientOptions extends ClientOptions {\n+    private static final Duration MINIMUM_TIMEOUT = Duration.ofMillis(1);\n+    private static final Duration DEFAULT_TIMEOUT = Duration.ofSeconds(60);\n+    private static final Duration NO_TIMEOUT = Duration.ZERO;\n+\n+    private ProxyOptions proxyOptions;\n+    private Configuration configuration;\n+    private Duration writeTimeout;\n+    private Duration responseTimeout;\n+    private Duration readTimeout;\n+\n+    @Override\n+    public HttpClientOptions setApplicationId(String applicationId) {\n+        super.setApplicationId(applicationId);\n+\n+        return this;\n+    }\n+\n+    @Override\n+    public HttpClientOptions setHeaders(Iterable<Header> headers) {\n+        super.setHeaders(headers);\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the {@link ProxyOptions proxy options} that the {@link HttpClient} will use.\n+     *\n+     * @param proxyOptions The proxy options to use.\n+     * @return The update HttpClientOptions object.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d5e97032b26aee3ef119a1a66997a130597c685"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Njc4MTQxNA==", "bodyText": "How about moving the codesnippets into a package like com.azure.core.docs.*? This will keep the samples clean for the user to find runnable code samples.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17582#discussion_r556781414", "createdAt": "2021-01-13T19:39:09Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core/src/samples/java/com/azure/core/http/HttpPipelineBuilderJavaDocCodeSnippets.java", "diffHunk": "@@ -0,0 +1,26 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.http;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d5e97032b26aee3ef119a1a66997a130597c685"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Njc4MTYyNQ==", "bodyText": "Make this final.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17582#discussion_r556781625", "createdAt": "2021-01-13T19:39:34Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/HttpClientOptions.java", "diffHunk": "@@ -0,0 +1,176 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.ProxyOptions;\n+\n+import java.time.Duration;\n+\n+/**\n+ * General configuration options for {@link HttpClient HttpClients}.\n+ */\n+public class HttpClientOptions extends ClientOptions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d5e97032b26aee3ef119a1a66997a130597c685"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bf6bcb546c924860e2f0ed4872e2fd152968bc1", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1bf6bcb546c924860e2f0ed4872e2fd152968bc1", "committedDate": "2021-01-13T19:50:26Z", "message": "Changes based on review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1731, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}