{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNzE5MTAw", "number": 16326, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDoxNjozMVrOEtuuFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDoyNDowMlrOEtuzpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2Mzg2ODM3OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDoxNjozMVrOHhsZGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODoxNTo1N1rOHiUT4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA5MjM3Nw==", "bodyText": "NIT line break after &&", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#discussion_r505092377", "createdAt": "2020-10-15T00:16:31Z", "author": {"login": "FabianMeiswinkel"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "diffHunk": "@@ -3566,7 +3567,8 @@ private RxStoreModel getStoreProxy(RxDocumentServiceRequest request) {\n         } else {\n             if ((request.getOperationType() == OperationType.Query || request.getOperationType() == OperationType.SqlQuery) &&\n                     Utils.isCollectionChild(request.getResourceType())) {\n-                if (request.getPartitionKeyRangeIdentity() == null) {\n+                // Go to gateway only if there is no partition key range or partition key set. This should be very rare\n+                if (request.getPartitionKeyRangeIdentity() == null && request.getHeaders().get(HttpConstants.HttpHeaders.PARTITION_KEY) == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc0NjQwMA==", "bodyText": "done", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#discussion_r505746400", "createdAt": "2020-10-15T18:15:57Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/RxDocumentClientImpl.java", "diffHunk": "@@ -3566,7 +3567,8 @@ private RxStoreModel getStoreProxy(RxDocumentServiceRequest request) {\n         } else {\n             if ((request.getOperationType() == OperationType.Query || request.getOperationType() == OperationType.SqlQuery) &&\n                     Utils.isCollectionChild(request.getResourceType())) {\n-                if (request.getPartitionKeyRangeIdentity() == null) {\n+                // Go to gateway only if there is no partition key range or partition key set. This should be very rare\n+                if (request.getPartitionKeyRangeIdentity() == null && request.getHeaders().get(HttpConstants.HttpHeaders.PARTITION_KEY) == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA5MjM3Nw=="}, "originalCommit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2Mzg4MjYwOnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/query/DocumentProducer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDoyNDowMlrOHhshUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDo0ODowMFrOHhs61g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA5NDQ4Mw==", "bodyText": "Just to double-check my understanding is correct - instead of changing the place where we were Parsing the Double you decided to normalize the locale here because for all other content where we parse floating point numbers the content is created by our backend and we own the locale/formatting, correct?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#discussion_r505094483", "createdAt": "2020-10-15T00:24:02Z", "author": {"login": "FabianMeiswinkel"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/query/DocumentProducer.java", "diffHunk": "@@ -65,7 +66,10 @@\n         void populatePartitionedQueryMetrics() {\n             String queryMetricsDelimitedString = pageResult.getResponseHeaders().get(HttpConstants.HttpHeaders.QUERY_METRICS);\n             if (!StringUtils.isEmpty(queryMetricsDelimitedString)) {\n-                queryMetricsDelimitedString += String.format(\";%s=%.2f\", QueryMetricsConstants.RequestCharge, pageResult.getRequestCharge());\n+                queryMetricsDelimitedString += String.format(Locale.ROOT,\n+                                                             \";%s=%.2f\",\n+                                                             QueryMetricsConstants.RequestCharge,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEwMTAxNA==", "bodyText": "Thats correct Fabian", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16326#discussion_r505101014", "createdAt": "2020-10-15T00:48:00Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/query/DocumentProducer.java", "diffHunk": "@@ -65,7 +66,10 @@\n         void populatePartitionedQueryMetrics() {\n             String queryMetricsDelimitedString = pageResult.getResponseHeaders().get(HttpConstants.HttpHeaders.QUERY_METRICS);\n             if (!StringUtils.isEmpty(queryMetricsDelimitedString)) {\n-                queryMetricsDelimitedString += String.format(\";%s=%.2f\", QueryMetricsConstants.RequestCharge, pageResult.getRequestCharge());\n+                queryMetricsDelimitedString += String.format(Locale.ROOT,\n+                                                             \";%s=%.2f\",\n+                                                             QueryMetricsConstants.RequestCharge,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA5NDQ4Mw=="}, "originalCommit": {"oid": "5111ce5fc01fd1a9d448f6759d4cf27915da46cd"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4133, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}