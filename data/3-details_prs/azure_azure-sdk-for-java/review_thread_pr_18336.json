{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0OTk5OTkw", "number": 18336, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo0NTozM1rOFIvCwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMjoxMDoxMFrOFLEWtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NzAzNjgwOnYy", "diffSide": "RIGHT", "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo0NTozM1rOIK02bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMToxMzoyOVrOIK2GPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyMjU3Mg==", "bodyText": "nit: Move this task to run immediately after the 'Run tests: $(DisplayName)' task is complete.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548222572", "createdAt": "2020-12-23T20:45:33Z", "author": {"login": "srnagar"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -159,10 +159,34 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - task: Maven@3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3946e415a3b18955acf278a17dd7f6105a96cf8b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI0MzAwNg==", "bodyText": "Done, thanks Srikanta", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548243006", "createdAt": "2020-12-23T21:13:29Z", "author": {"login": "minnieliu"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -159,10 +159,34 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - task: Maven@3", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyMjU3Mg=="}, "originalCommit": {"oid": "3946e415a3b18955acf278a17dd7f6105a96cf8b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NzA1MzAyOnYy", "diffSide": "RIGHT", "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo0ODo1N1rOIK1BBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMToxMzo0MlrOIK2Gxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyNTI4NA==", "bodyText": "Add this condition here as well - , eq('${{ parameters.ServiceDirectory }}', 'communication')", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548225284", "createdAt": "2020-12-23T20:48:57Z", "author": {"login": "srnagar"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -159,10 +159,34 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - task: Maven@3\n+        displayName: 'Generate aggregate code coverage report'\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'), eq('${{ parameters.ServiceDirectory }}', 'communication'))\n+        inputs:\n+          mavenPomFile: sdk/${{ parameters.ServiceDirectory }}/pom.xml\n+          options: -Pcoverage\n+          mavenOptions: '$(MemoryOptions) $(LoggingOptions)'\n+          javaHomeOption: 'JDKVersion'\n+          jdkVersionOption: $(JavaTestVersion)\n+          jdkArchitectureOption: 'x64'\n+          goals: jacoco:report-aggregate\n+          # we want to run this when TestFromSource isn't true\n+          condition: and(succeeded(), ne(variables['TestFromSource'],'true'))\n+\n       - task: PublishTestResults@2\n         condition: always()\n         inputs:\n           mergeTestResults: true\n           testRunTitle: 'Live tests for ${{ parameters.ServiceDirectory }} $(DisplayName)'\n           ${{ if ne(parameters.TestResultsFiles, '') }}:\n             testResultsFiles: ${{ parameters.TestResultsFiles }}\n+\n+      # Azure DevOps only seems to respect the last code coverage result published, so only do this for Windows + Java LTS.\n+      # Code coverage reporting is setup only for Track 2 modules.\n+      - task: PublishCodeCoverageResults@1\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3946e415a3b18955acf278a17dd7f6105a96cf8b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI0MzE0Mw==", "bodyText": "Done, thanks Srikanta", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548243143", "createdAt": "2020-12-23T21:13:42Z", "author": {"login": "minnieliu"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -159,10 +159,34 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - task: Maven@3\n+        displayName: 'Generate aggregate code coverage report'\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'), eq('${{ parameters.ServiceDirectory }}', 'communication'))\n+        inputs:\n+          mavenPomFile: sdk/${{ parameters.ServiceDirectory }}/pom.xml\n+          options: -Pcoverage\n+          mavenOptions: '$(MemoryOptions) $(LoggingOptions)'\n+          javaHomeOption: 'JDKVersion'\n+          jdkVersionOption: $(JavaTestVersion)\n+          jdkArchitectureOption: 'x64'\n+          goals: jacoco:report-aggregate\n+          # we want to run this when TestFromSource isn't true\n+          condition: and(succeeded(), ne(variables['TestFromSource'],'true'))\n+\n       - task: PublishTestResults@2\n         condition: always()\n         inputs:\n           mergeTestResults: true\n           testRunTitle: 'Live tests for ${{ parameters.ServiceDirectory }} $(DisplayName)'\n           ${{ if ne(parameters.TestResultsFiles, '') }}:\n             testResultsFiles: ${{ parameters.TestResultsFiles }}\n+\n+      # Azure DevOps only seems to respect the last code coverage result published, so only do this for Windows + Java LTS.\n+      # Code coverage reporting is setup only for Track 2 modules.\n+      - task: PublishCodeCoverageResults@1\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyNTI4NA=="}, "originalCommit": {"oid": "3946e415a3b18955acf278a17dd7f6105a96cf8b"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3MTUwMDA2OnYy", "diffSide": "RIGHT", "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMjoxMDoxMFrOIOC8dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMjoxMDoxMFrOIOC8dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU5OTIyMQ==", "bodyText": "We should avoid hardcoding checks specific to one service in our common templates. Instead we should have an opt-in or opt-out that can be set in the ci.yml for a given service.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r551599221", "createdAt": "2021-01-04T22:10:10Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -149,6 +149,20 @@ jobs:\n           ${{ insert }}: ${{ parameters.TestStepMavenInputs }}\n         env: ${{ parameters.EnvVars }}\n \n+      - task: Maven@3\n+        displayName: 'Generate aggregate code coverage report'\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'), eq('${{ parameters.ServiceDirectory }}', 'communication'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c18d35b6baf9f087cd38fb2743d390dcc2c0f5d0"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2510, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}