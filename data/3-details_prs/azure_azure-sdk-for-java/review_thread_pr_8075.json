{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyOTgzNjM4", "number": 8075, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzo1NToyMFrODejM1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMzoyODo1OFrODepMrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzYwNTk4OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos-examples/src/main/java/com/azure/cosmos/examples/ChangeFeed/SampleChangeFeedProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzo1NToyMFrOFnvy1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDowNzozMVrOFnz3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyMTg0Ng==", "bodyText": "can we use slf4j for logger? instead of printStackTrace", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377221846", "createdAt": "2020-02-10T17:55:20Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos-examples/src/main/java/com/azure/cosmos/examples/ChangeFeed/SampleChangeFeedProcessor.java", "diffHunk": "@@ -88,11 +95,16 @@ public static ChangeFeedProcessor getChangeFeedProcessor(String hostName, Cosmos\n             .setHostName(hostName)\n             .setFeedContainer(feedContainer)\n             .setLeaseContainer(leaseContainer)\n-            .setHandleChanges(docs -> {\n+            .setHandleChanges((List<JsonNode> docs) -> {\n                 System.out.println(\"--->setHandleChanges() START\");\n \n-                for (CosmosItemProperties document : docs) {\n-                    System.out.println(\"---->DOCUMENT RECEIVED: \" + document.toJson(SerializationFormattingPolicy.INDENTED));\n+                for (JsonNode document : docs) {\n+                    try {\n+                        System.out.println(\"---->DOCUMENT RECEIVED: \" + OBJECT_MAPPER.writerWithDefaultPrettyPrinter()\n+                                                                            .writeValueAsString(document));\n+                    } catch (JsonProcessingException e) {\n+                        e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI4ODQ5Ng==", "bodyText": "Done", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377288496", "createdAt": "2020-02-10T20:07:31Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos-examples/src/main/java/com/azure/cosmos/examples/ChangeFeed/SampleChangeFeedProcessor.java", "diffHunk": "@@ -88,11 +95,16 @@ public static ChangeFeedProcessor getChangeFeedProcessor(String hostName, Cosmos\n             .setHostName(hostName)\n             .setFeedContainer(feedContainer)\n             .setLeaseContainer(leaseContainer)\n-            .setHandleChanges(docs -> {\n+            .setHandleChanges((List<JsonNode> docs) -> {\n                 System.out.println(\"--->setHandleChanges() START\");\n \n-                for (CosmosItemProperties document : docs) {\n-                    System.out.println(\"---->DOCUMENT RECEIVED: \" + document.toJson(SerializationFormattingPolicy.INDENTED));\n+                for (JsonNode document : docs) {\n+                    try {\n+                        System.out.println(\"---->DOCUMENT RECEIVED: \" + OBJECT_MAPPER.writerWithDefaultPrettyPrinter()\n+                                                                            .writeValueAsString(document));\n+                    } catch (JsonProcessingException e) {\n+                        e.printStackTrace();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyMTg0Ng=="}, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzYwOTYzOnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncContainer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzo1NjozNVrOFnv1Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDoxMzo1MVrOFn0Crw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyMjQ0Mw==", "bodyText": "For query we are still doing double deserialization. am I right?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377222443", "createdAt": "2020-02-10T17:56:35Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncContainer.java", "diffHunk": "@@ -351,13 +349,18 @@ public String getId() {\n             setContinuationTokenAndMaxItemCount(pagedFluxOptions, feedOptions);\n             return getDatabase().getDocClientWrapper().queryDocuments(CosmosAsyncContainer.this.getLink(), sqlQuerySpec, feedOptions)\n                                             .map(response ->\n-                                                BridgeInternal.createFeedResponseWithQueryMetrics((\n-                                                    CosmosItemProperties.getTypedResultsFromV2Results((List<Document>)(Object)response.getResults(), klass)),\n-                                                    response.getResponseHeaders(),\n-                                                    response.queryMetrics()));\n+                                                     prepareFeedResponse(response, klass));\n         });\n     }\n \n+    private <T> FeedResponse<T> prepareFeedResponse(FeedResponse<Document> response, Class<T> klass){\n+        return BridgeInternal.createFeedResponseWithQueryMetrics(\n+            (response.getResults().stream().map(document -> document.toObject(klass))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5MTQzOQ==", "bodyText": "So what happens here is we donot convert it to json again, we parse the existing propertyBag into the userobject. For JsonNode/ObjectNode we just cast the propertybag", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377291439", "createdAt": "2020-02-10T20:13:51Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncContainer.java", "diffHunk": "@@ -351,13 +349,18 @@ public String getId() {\n             setContinuationTokenAndMaxItemCount(pagedFluxOptions, feedOptions);\n             return getDatabase().getDocClientWrapper().queryDocuments(CosmosAsyncContainer.this.getLink(), sqlQuerySpec, feedOptions)\n                                             .map(response ->\n-                                                BridgeInternal.createFeedResponseWithQueryMetrics((\n-                                                    CosmosItemProperties.getTypedResultsFromV2Results((List<Document>)(Object)response.getResults(), klass)),\n-                                                    response.getResponseHeaders(),\n-                                                    response.queryMetrics()));\n+                                                     prepareFeedResponse(response, klass));\n         });\n     }\n \n+    private <T> FeedResponse<T> prepareFeedResponse(FeedResponse<Document> response, Class<T> klass){\n+        return BridgeInternal.createFeedResponseWithQueryMetrics(\n+            (response.getResults().stream().map(document -> document.toObject(klass))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyMjQ0Mw=="}, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzYxNDQ4OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncItemResponse.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzo1ODoxMVrOFnv4cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDoxNDozMFrOFn0D0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyMzI4Mg==", "bodyText": "why are we adding these new methods?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377223282", "createdAt": "2020-02-10T17:58:11Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncItemResponse.java", "diffHunk": "@@ -51,21 +57,99 @@ public T getResource(){\n      */\n     public CosmosItemProperties getProperties() {\n         ensureCosmosItemPropertiesInitialized();\n-        return super.getProperties();\n+        return props;\n     }\n \n     private void ensureCosmosItemPropertiesInitialized() {\n-        if (super.getProperties() == null) {\n-            synchronized (this) {\n-                if (super.getProperties() == null) {\n-                    if (StringUtils.isEmpty(responseBodyString)){\n-                        super.setProperties(null);\n-                    } else {\n-                        CosmosItemProperties props = new CosmosItemProperties(responseBodyString);\n-                        super.setProperties(props);\n-                    }\n-                }\n+        synchronized (this) {\n+            if (StringUtils.isEmpty(responseBodyString)) {\n+                props = null;\n+            } else {\n+                props = new CosmosItemProperties(responseBodyString);\n             }\n+\n         }\n     }\n+\n+    /**\n+     * Gets the maximum size limit for this entity (in megabytes (MB) for server resources and in count for master\n+     * resources).\n+     *\n+     * @return the max resource quota.\n+     */\n+    public String getMaxResourceQuota() {\n+        return resourceResponse.getMaxResourceQuota();\n+    }\n+\n+    /**\n+     * Gets the current size of this entity (in megabytes (MB) for server resources and in count for master resources)\n+     *\n+     * @return the current resource quota usage.\n+     */\n+    public String getCurrentResourceQuotaUsage() {\n+        return resourceResponse.getCurrentResourceQuotaUsage();\n+    }\n+\n+    /**\n+     * Gets the Activity ID for the request.\n+     *\n+     * @return the activity getId.\n+     */\n+    public String getActivityId() {\n+        return resourceResponse.getActivityId();\n+    }\n+\n+    /**\n+     * Gets the number of index paths (terms) generated by the operation.\n+     *\n+     * @return the request charge.\n+     */\n+    public double getRequestCharge() {\n+        return resourceResponse.getRequestCharge();\n+    }\n+\n+    /**\n+     * Gets the HTTP status code associated with the response.\n+     *\n+     * @return the status code.\n+     */\n+    public int getStatusCode() {\n+        return resourceResponse.getStatusCode();\n+    }\n+\n+    /**\n+     * Gets the token used for managing client's consistency requirements.\n+     *\n+     * @return the session token.\n+     */\n+    public String getSessionToken() {\n+        return resourceResponse.getSessionToken();\n+    }\n+\n+    /**\n+     * Gets the headers associated with the response.\n+     *\n+     * @return the response headers.\n+     */\n+    public Map<String, String> getResponseHeaders() {\n+        return resourceResponse.getResponseHeaders();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5MTczMA==", "bodyText": "Because Cosmos*ItemResponse no longer extendes CosmosResponse. So we have to provide all these methods direclty", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377291730", "createdAt": "2020-02-10T20:14:30Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncItemResponse.java", "diffHunk": "@@ -51,21 +57,99 @@ public T getResource(){\n      */\n     public CosmosItemProperties getProperties() {\n         ensureCosmosItemPropertiesInitialized();\n-        return super.getProperties();\n+        return props;\n     }\n \n     private void ensureCosmosItemPropertiesInitialized() {\n-        if (super.getProperties() == null) {\n-            synchronized (this) {\n-                if (super.getProperties() == null) {\n-                    if (StringUtils.isEmpty(responseBodyString)){\n-                        super.setProperties(null);\n-                    } else {\n-                        CosmosItemProperties props = new CosmosItemProperties(responseBodyString);\n-                        super.setProperties(props);\n-                    }\n-                }\n+        synchronized (this) {\n+            if (StringUtils.isEmpty(responseBodyString)) {\n+                props = null;\n+            } else {\n+                props = new CosmosItemProperties(responseBodyString);\n             }\n+\n         }\n     }\n+\n+    /**\n+     * Gets the maximum size limit for this entity (in megabytes (MB) for server resources and in count for master\n+     * resources).\n+     *\n+     * @return the max resource quota.\n+     */\n+    public String getMaxResourceQuota() {\n+        return resourceResponse.getMaxResourceQuota();\n+    }\n+\n+    /**\n+     * Gets the current size of this entity (in megabytes (MB) for server resources and in count for master resources)\n+     *\n+     * @return the current resource quota usage.\n+     */\n+    public String getCurrentResourceQuotaUsage() {\n+        return resourceResponse.getCurrentResourceQuotaUsage();\n+    }\n+\n+    /**\n+     * Gets the Activity ID for the request.\n+     *\n+     * @return the activity getId.\n+     */\n+    public String getActivityId() {\n+        return resourceResponse.getActivityId();\n+    }\n+\n+    /**\n+     * Gets the number of index paths (terms) generated by the operation.\n+     *\n+     * @return the request charge.\n+     */\n+    public double getRequestCharge() {\n+        return resourceResponse.getRequestCharge();\n+    }\n+\n+    /**\n+     * Gets the HTTP status code associated with the response.\n+     *\n+     * @return the status code.\n+     */\n+    public int getStatusCode() {\n+        return resourceResponse.getStatusCode();\n+    }\n+\n+    /**\n+     * Gets the token used for managing client's consistency requirements.\n+     *\n+     * @return the session token.\n+     */\n+    public String getSessionToken() {\n+        return resourceResponse.getSessionToken();\n+    }\n+\n+    /**\n+     * Gets the headers associated with the response.\n+     *\n+     * @return the response headers.\n+     */\n+    public Map<String, String> getResponseHeaders() {\n+        return resourceResponse.getResponseHeaders();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyMzI4Mg=="}, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzYxNjI3OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosItemResponse.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzo1ODo0OVrOFnv5ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDoxNDozNVrOFn0D9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyMzU4Mg==", "bodyText": "same, why are we adding these new methods?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377223582", "createdAt": "2020-02-10T17:58:49Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosItemResponse.java", "diffHunk": "@@ -25,4 +29,86 @@ public CosmosItemProperties getProperties() {\n         return responseWrapper.getProperties();\n     }\n \n+    /**\n+     * Gets the maximum size limit for this entity (in megabytes (MB) for server resources and in count for master\n+     * resources).\n+     *\n+     * @return the max resource quota.\n+     */\n+    public String getMaxResourceQuota() {\n+        return responseWrapper.getMaxResourceQuota();\n+    }\n+\n+    /**\n+     * Gets the current size of this entity (in megabytes (MB) for server resources and in count for master resources)\n+     *\n+     * @return the current resource quota usage.\n+     */\n+    public String getCurrentResourceQuotaUsage() {\n+        return responseWrapper.getCurrentResourceQuotaUsage();\n+    }\n+\n+    /**\n+     * Gets the Activity ID for the request.\n+     *\n+     * @return the activity getId.\n+     */\n+    public String getActivityId() {\n+        return responseWrapper.getActivityId();\n+    }\n+\n+    /**\n+     * Gets the number of index paths (terms) generated by the operation.\n+     *\n+     * @return the request charge.\n+     */\n+    public double getRequestCharge() {\n+        return responseWrapper.getRequestCharge();\n+    }\n+\n+    /**\n+     * Gets the HTTP status code associated with the response.\n+     *\n+     * @return the status code.\n+     */\n+    public int getStatusCode() {\n+        return responseWrapper.getStatusCode();\n+    }\n+\n+    /**\n+     * Gets the token used for managing client's consistency requirements.\n+     *\n+     * @return the session token.\n+     */\n+    public String getSessionToken() {\n+        return responseWrapper.getSessionToken();\n+    }\n+\n+    /**\n+     * Gets the headers associated with the response.\n+     *\n+     * @return the response headers.\n+     */\n+    public Map<String, String> getResponseHeaders() {\n+        return responseWrapper.getResponseHeaders();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5MTc2NQ==", "bodyText": "Because Cosmos*ItemResponse no longer extendes CosmosResponse. So we have to provide all these methods direclty", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377291765", "createdAt": "2020-02-10T20:14:35Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosItemResponse.java", "diffHunk": "@@ -25,4 +29,86 @@ public CosmosItemProperties getProperties() {\n         return responseWrapper.getProperties();\n     }\n \n+    /**\n+     * Gets the maximum size limit for this entity (in megabytes (MB) for server resources and in count for master\n+     * resources).\n+     *\n+     * @return the max resource quota.\n+     */\n+    public String getMaxResourceQuota() {\n+        return responseWrapper.getMaxResourceQuota();\n+    }\n+\n+    /**\n+     * Gets the current size of this entity (in megabytes (MB) for server resources and in count for master resources)\n+     *\n+     * @return the current resource quota usage.\n+     */\n+    public String getCurrentResourceQuotaUsage() {\n+        return responseWrapper.getCurrentResourceQuotaUsage();\n+    }\n+\n+    /**\n+     * Gets the Activity ID for the request.\n+     *\n+     * @return the activity getId.\n+     */\n+    public String getActivityId() {\n+        return responseWrapper.getActivityId();\n+    }\n+\n+    /**\n+     * Gets the number of index paths (terms) generated by the operation.\n+     *\n+     * @return the request charge.\n+     */\n+    public double getRequestCharge() {\n+        return responseWrapper.getRequestCharge();\n+    }\n+\n+    /**\n+     * Gets the HTTP status code associated with the response.\n+     *\n+     * @return the status code.\n+     */\n+    public int getStatusCode() {\n+        return responseWrapper.getStatusCode();\n+    }\n+\n+    /**\n+     * Gets the token used for managing client's consistency requirements.\n+     *\n+     * @return the session token.\n+     */\n+    public String getSessionToken() {\n+        return responseWrapper.getSessionToken();\n+    }\n+\n+    /**\n+     * Gets the headers associated with the response.\n+     *\n+     * @return the response headers.\n+     */\n+    public Map<String, String> getResponseHeaders() {\n+        return responseWrapper.getResponseHeaders();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyMzU4Mg=="}, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzYyOTMwOnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/changefeed/implementation/ChangeFeedContextClientImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxODowMjo1OFrOFnwB2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDoxNToyNlrOFn0FbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyNTY4OQ==", "bodyText": "does document.toObject(JsonNode.class) return a reference to internal propertybag or does it copy data?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377225689", "createdAt": "2020-02-10T18:02:58Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/changefeed/implementation/ChangeFeedContextClientImpl.java", "diffHunk": "@@ -82,15 +84,16 @@ public ChangeFeedContextClientImpl(CosmosAsyncContainer cosmosContainer, Schedul\n     }\n \n     @Override\n-    public Flux<FeedResponse<CosmosItemProperties>> createDocumentChangeFeedQuery(CosmosAsyncContainer collectionLink, ChangeFeedOptions feedOptions) {\n+    public Flux<FeedResponse<JsonNode>> createDocumentChangeFeedQuery(CosmosAsyncContainer collectionLink,\n+                                                                      ChangeFeedOptions feedOptions) {\n         AsyncDocumentClient clientWrapper =\n             CosmosBridgeInternal.getAsyncDocumentClient(collectionLink.getDatabase());\n-        Flux<FeedResponse<CosmosItemProperties>> feedResponseFlux =\n+        Flux<FeedResponse<JsonNode>> feedResponseFlux =\n             clientWrapper.queryDocumentChangeFeed(BridgeInternal.extractContainerSelfLink(collectionLink), feedOptions)\n                                                                     .map(response -> {\n-                                                                        List<CosmosItemProperties> results = response.getResults()\n+                                                                        List<JsonNode> results = response.getResults()\n                                                                                                                      .stream()\n-                                                                                                                     .map(document -> new CosmosItemProperties(document.toJson()))\n+                                                                                                                     .map(document -> document.toObject(JsonNode.class))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5MjE0MQ==", "bodyText": "It returns a reference and doesnt copy data", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377292141", "createdAt": "2020-02-10T20:15:26Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/changefeed/implementation/ChangeFeedContextClientImpl.java", "diffHunk": "@@ -82,15 +84,16 @@ public ChangeFeedContextClientImpl(CosmosAsyncContainer cosmosContainer, Schedul\n     }\n \n     @Override\n-    public Flux<FeedResponse<CosmosItemProperties>> createDocumentChangeFeedQuery(CosmosAsyncContainer collectionLink, ChangeFeedOptions feedOptions) {\n+    public Flux<FeedResponse<JsonNode>> createDocumentChangeFeedQuery(CosmosAsyncContainer collectionLink,\n+                                                                      ChangeFeedOptions feedOptions) {\n         AsyncDocumentClient clientWrapper =\n             CosmosBridgeInternal.getAsyncDocumentClient(collectionLink.getDatabase());\n-        Flux<FeedResponse<CosmosItemProperties>> feedResponseFlux =\n+        Flux<FeedResponse<JsonNode>> feedResponseFlux =\n             clientWrapper.queryDocumentChangeFeed(BridgeInternal.extractContainerSelfLink(collectionLink), feedOptions)\n                                                                     .map(response -> {\n-                                                                        List<CosmosItemProperties> results = response.getResults()\n+                                                                        List<JsonNode> results = response.getResults()\n                                                                                                                      .stream()\n-                                                                                                                     .map(document -> new CosmosItemProperties(document.toJson()))\n+                                                                                                                     .map(document -> document.toObject(JsonNode.class))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyNTY4OQ=="}, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzYzMzY4OnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/rx/ChangeFeedProcessorTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxODowNDozMlrOFnwEtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDoxNTozNlrOFn0Fww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyNjQyMA==", "bodyText": "jdk.nashorn.internal.ir.ObjectNode is this the correct ObjectNode type? shouldn't this be jackson?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377226420", "createdAt": "2020-02-10T18:04:32Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/rx/ChangeFeedProcessorTest.java", "diffHunk": "@@ -12,15 +12,20 @@\n import com.azure.cosmos.CosmosClientBuilder;\n import com.azure.cosmos.CosmosContainerProperties;\n import com.azure.cosmos.CosmosContainerRequestOptions;\n-import com.azure.cosmos.CosmosItemProperties;\n+import com.azure.cosmos.implementation.CosmosItemProperties;\n import com.azure.cosmos.CosmosItemRequestOptions;\n import com.azure.cosmos.FeedOptions;\n import com.azure.cosmos.PartitionKey;\n import com.azure.cosmos.SerializationFormattingPolicy;\n import com.azure.cosmos.SqlParameter;\n import com.azure.cosmos.SqlParameterList;\n import com.azure.cosmos.SqlQuerySpec;\n+import com.azure.cosmos.implementation.Utils;\n import com.azure.cosmos.implementation.changefeed.ServiceItemLease;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import jdk.nashorn.internal.ir.ObjectNode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5MjIyNw==", "bodyText": "Unused imports, removed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377292227", "createdAt": "2020-02-10T20:15:36Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/rx/ChangeFeedProcessorTest.java", "diffHunk": "@@ -12,15 +12,20 @@\n import com.azure.cosmos.CosmosClientBuilder;\n import com.azure.cosmos.CosmosContainerProperties;\n import com.azure.cosmos.CosmosContainerRequestOptions;\n-import com.azure.cosmos.CosmosItemProperties;\n+import com.azure.cosmos.implementation.CosmosItemProperties;\n import com.azure.cosmos.CosmosItemRequestOptions;\n import com.azure.cosmos.FeedOptions;\n import com.azure.cosmos.PartitionKey;\n import com.azure.cosmos.SerializationFormattingPolicy;\n import com.azure.cosmos.SqlParameter;\n import com.azure.cosmos.SqlParameterList;\n import com.azure.cosmos.SqlQuerySpec;\n+import com.azure.cosmos.implementation.Utils;\n import com.azure.cosmos.implementation.changefeed.ServiceItemLease;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import jdk.nashorn.internal.ir.ObjectNode;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIyNjQyMA=="}, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNDM5MjIxOnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncItemResponse.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMjoxMzowN1rOFn3gJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMjoxMzowN1rOFn3gJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM0ODEzMg==", "bodyText": "This is already available in cosmosResponseDiagnostics exposed above. duplicate ways of getting the same thing", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377348132", "createdAt": "2020-02-10T22:13:07Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncItemResponse.java", "diffHunk": "@@ -51,21 +57,99 @@ public T getResource(){\n      */\n     public CosmosItemProperties getProperties() {\n         ensureCosmosItemPropertiesInitialized();\n-        return super.getProperties();\n+        return props;\n     }\n \n     private void ensureCosmosItemPropertiesInitialized() {\n-        if (super.getProperties() == null) {\n-            synchronized (this) {\n-                if (super.getProperties() == null) {\n-                    if (StringUtils.isEmpty(responseBodyString)){\n-                        super.setProperties(null);\n-                    } else {\n-                        CosmosItemProperties props = new CosmosItemProperties(responseBodyString);\n-                        super.setProperties(props);\n-                    }\n-                }\n+        synchronized (this) {\n+            if (StringUtils.isEmpty(responseBodyString)) {\n+                props = null;\n+            } else {\n+                props = new CosmosItemProperties(responseBodyString);\n             }\n+\n         }\n     }\n+\n+    /**\n+     * Gets the maximum size limit for this entity (in megabytes (MB) for server resources and in count for master\n+     * resources).\n+     *\n+     * @return the max resource quota.\n+     */\n+    public String getMaxResourceQuota() {\n+        return resourceResponse.getMaxResourceQuota();\n+    }\n+\n+    /**\n+     * Gets the current size of this entity (in megabytes (MB) for server resources and in count for master resources)\n+     *\n+     * @return the current resource quota usage.\n+     */\n+    public String getCurrentResourceQuotaUsage() {\n+        return resourceResponse.getCurrentResourceQuotaUsage();\n+    }\n+\n+    /**\n+     * Gets the Activity ID for the request.\n+     *\n+     * @return the activity getId.\n+     */\n+    public String getActivityId() {\n+        return resourceResponse.getActivityId();\n+    }\n+\n+    /**\n+     * Gets the number of index paths (terms) generated by the operation.\n+     *\n+     * @return the request charge.\n+     */\n+    public double getRequestCharge() {\n+        return resourceResponse.getRequestCharge();\n+    }\n+\n+    /**\n+     * Gets the HTTP status code associated with the response.\n+     *\n+     * @return the status code.\n+     */\n+    public int getStatusCode() {\n+        return resourceResponse.getStatusCode();\n+    }\n+\n+    /**\n+     * Gets the token used for managing client's consistency requirements.\n+     *\n+     * @return the session token.\n+     */\n+    public String getSessionToken() {\n+        return resourceResponse.getSessionToken();\n+    }\n+\n+    /**\n+     * Gets the headers associated with the response.\n+     *\n+     * @return the response headers.\n+     */\n+    public Map<String, String> getResponseHeaders() {\n+        return resourceResponse.getResponseHeaders();\n+    }\n+\n+    /**\n+     * Gets the diagnostics information for the current request to Azure Cosmos DB service.\n+     *\n+     * @return diagnostics information for the current request to Azure Cosmos DB service.\n+     */\n+    public CosmosResponseDiagnostics getCosmosResponseDiagnostics() {\n+        return resourceResponse.getCosmosResponseDiagnostics();\n+    }\n+\n+    /**\n+     * Gets the end-to-end request latency for the current request to Azure Cosmos DB service.\n+     *\n+     * @return end-to-end request latency for the current request to Azure Cosmos DB service.\n+     */\n+    public Duration getRequestLatency() {\n+        return resourceResponse.getRequestLatency();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fc5c3efaa0397ceceb7b62fa58c70b6505e896a"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNDU4ODYzOnYy", "diffSide": "RIGHT", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncItemResponse.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMzoyODo1OFrOFn5WxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNDoyOTozNVrOFoheHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM3ODUwMQ==", "bodyText": "This should not be public", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r377378501", "createdAt": "2020-02-10T23:28:58Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncItemResponse.java", "diffHunk": "@@ -51,21 +57,99 @@ public T getResource(){\n      */\n     public CosmosItemProperties getProperties() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa2eaed3e03496409312eaf5b7d8118687c1f67f"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNTc0Mg==", "bodyText": "Done", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8075#discussion_r378035742", "createdAt": "2020-02-12T04:29:35Z", "author": {"login": "mbhaskar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncItemResponse.java", "diffHunk": "@@ -51,21 +57,99 @@ public T getResource(){\n      */\n     public CosmosItemProperties getProperties() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM3ODUwMQ=="}, "originalCommit": {"oid": "fa2eaed3e03496409312eaf5b7d8118687c1f67f"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3167, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}