{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1MTY3OTY0", "number": 11583, "title": "Fixed bug in file share source url encoding", "bodyText": "Resolves #11183", "createdAt": "2020-05-29T15:20:41Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583", "merged": true, "mergeCommit": {"oid": "0cc605e4940784a2d0e6bee2295c6878e3ad73db"}, "closed": true, "closedAt": "2020-06-03T21:48:38Z", "author": {"login": "gapra-msft"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmD68TAH2gAyNDI1MTY3OTY0OjhiMTA5ZTVkNjE3YTI2MDFmNTg5MmMwOTdlODI1MDAxMTI3ODg1OGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnFm2GgFqTQyMjEyNzY2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8b109e5d617a2601f5892c097e8250011278858a", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8b109e5d617a2601f5892c097e8250011278858a", "committedDate": "2020-05-29T15:09:18Z", "message": "Fixed bug in source url encoding"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMDY2NzM5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#pullrequestreview-421066739", "createdAt": "2020-05-29T15:37:53Z", "commit": {"oid": "8b109e5d617a2601f5892c097e8250011278858a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNTozNzo1M1rOGch7Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNTozNzo1M1rOGch7Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU2OTE3NA==", "bodyText": "Does anyone have a better idea on a name for this method?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#discussion_r432569174", "createdAt": "2020-05-29T15:37:53Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-common/src/main/java/com/azure/storage/common/Utility.java", "diffHunk": "@@ -154,6 +155,24 @@ private static String encode(final String stringToEncode) {\n         }\n     }\n \n+    /**\n+     * Performs a safe encoding of a url string, only encoding the path.\n+     *\n+     * @param url The url to encode.\n+     * @return The encoded url.\n+     */\n+    public static String encodeUrlPath(String url) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b109e5d617a2601f5892c097e8250011278858a"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTY4NDAz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#pullrequestreview-421168403", "createdAt": "2020-05-29T17:55:48Z", "commit": {"oid": "8b109e5d617a2601f5892c097e8250011278858a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTkxNDQy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#pullrequestreview-421191442", "createdAt": "2020-05-29T18:29:29Z", "commit": {"oid": "8b109e5d617a2601f5892c097e8250011278858a"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxODoyOToyOVrOGcnsvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxODo0MTozOFrOGcoDNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2Mzc0Mg==", "bodyText": "Let's not do * imports. https://intellij-support.jetbrains.com/hc/en-us/community/posts/206203659-Turn-off-Wildcard-imports-", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#discussion_r432663742", "createdAt": "2020-05-29T18:29:29Z", "author": {"login": "kasobol-msft"}, "path": "sdk/storage/azure-storage-file-share/src/test/java/com/azure/storage/file/share/FileAPITests.groovy", "diffHunk": "@@ -9,14 +9,7 @@ import com.azure.core.util.Context\n import com.azure.core.util.polling.SyncPoller\n import com.azure.storage.common.StorageSharedKeyCredential\n import com.azure.storage.common.implementation.Constants\n-import com.azure.storage.file.share.models.NtfsFileAttributes\n-import com.azure.storage.file.share.models.PermissionCopyModeType\n-import com.azure.storage.file.share.models.ShareErrorCode\n-import com.azure.storage.file.share.models.ShareFileCopyInfo\n-import com.azure.storage.file.share.models.ShareFileHttpHeaders\n-import com.azure.storage.file.share.models.ShareFileRange\n-import com.azure.storage.file.share.models.ShareSnapshotInfo\n-import com.azure.storage.file.share.models.ShareStorageException\n+import com.azure.storage.file.share.models.*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b109e5d617a2601f5892c097e8250011278858a"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2Njg4Ng==", "bodyText": "can we have more / in the path ? if yes then should we encode them?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#discussion_r432666886", "createdAt": "2020-05-29T18:36:03Z", "author": {"login": "kasobol-msft"}, "path": "sdk/storage/azure-storage-common/src/main/java/com/azure/storage/common/Utility.java", "diffHunk": "@@ -154,6 +155,24 @@ private static String encode(final String stringToEncode) {\n         }\n     }\n \n+    /**\n+     * Performs a safe encoding of a url string, only encoding the path.\n+     *\n+     * @param url The url to encode.\n+     * @return The encoded url.\n+     */\n+    public static String encodeUrlPath(String url) {\n+        /* Deconstruct the URL and reconstruct it making sure the path is encoded. */\n+        UrlBuilder builder = UrlBuilder.parse(url);\n+        String path = builder.getPath();\n+        if (path.startsWith(\"/\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b109e5d617a2601f5892c097e8250011278858a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2ODI3MQ==", "bodyText": "do we have to decode it first ? Wouldn't already encoded chars be left alone during encoding?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#discussion_r432668271", "createdAt": "2020-05-29T18:38:57Z", "author": {"login": "kasobol-msft"}, "path": "sdk/storage/azure-storage-common/src/main/java/com/azure/storage/common/Utility.java", "diffHunk": "@@ -154,6 +155,24 @@ private static String encode(final String stringToEncode) {\n         }\n     }\n \n+    /**\n+     * Performs a safe encoding of a url string, only encoding the path.\n+     *\n+     * @param url The url to encode.\n+     * @return The encoded url.\n+     */\n+    public static String encodeUrlPath(String url) {\n+        /* Deconstruct the URL and reconstruct it making sure the path is encoded. */\n+        UrlBuilder builder = UrlBuilder.parse(url);\n+        String path = builder.getPath();\n+        if (path.startsWith(\"/\")) {\n+            path = path.substring(1);\n+        }\n+        path = Utility.urlEncode(Utility.urlDecode(path));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b109e5d617a2601f5892c097e8250011278858a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2OTQ5NA==", "bodyText": "if copy source is passed as a parameter then shouldn't we just encode the whole thing ? I'm wondering why just path.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#discussion_r432669494", "createdAt": "2020-05-29T18:41:38Z", "author": {"login": "kasobol-msft"}, "path": "sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/ShareFileAsyncClient.java", "diffHunk": "@@ -427,11 +428,13 @@ private boolean checkDoesNotExistStatusCode(Throwable t) {\n             .setIgnoreReadOnly(ignoreReadOnly)\n             .setSetArchiveAttribute(setArchiveAttribute);\n \n+        final String copySource = Utility.encodeUrlPath(sourceUrl);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b109e5d617a2601f5892c097e8250011278858a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "791401718e3d7dce0dae744f8b6effc2670d60da", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/791401718e3d7dce0dae744f8b6effc2670d60da", "committedDate": "2020-05-29T19:15:58Z", "message": "Added back imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxOTk5NzE3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#pullrequestreview-421999717", "createdAt": "2020-06-01T16:32:49Z", "commit": {"oid": "791401718e3d7dce0dae744f8b6effc2670d60da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMDAyNDIy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#pullrequestreview-422002422", "createdAt": "2020-06-01T16:36:41Z", "commit": {"oid": "791401718e3d7dce0dae744f8b6effc2670d60da"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNjozNjo0MVrOGdRu8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNjozNjo0MVrOGdRu8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM1MjQzNQ==", "bodyText": "Can you specify the apis this affected", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#discussion_r433352435", "createdAt": "2020-06-01T16:36:41Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-file-share/CHANGELOG.md", "diffHunk": "@@ -1,6 +1,7 @@\n # Release History\n \n ## 12.5.0-beta.1 (Unreleased)\n+- Fixed bug in ShareFileAsyncClient where sourceUrl was getting encoded. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791401718e3d7dce0dae744f8b6effc2670d60da"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b26dae0e71d1fa7960d956a7634a203acb51c066", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b26dae0e71d1fa7960d956a7634a203acb51c066", "committedDate": "2020-06-01T16:50:53Z", "message": "Updated based off Rick's comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "162b865d7c4fadfb5678450e8e2bd4e07629c40a", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/162b865d7c4fadfb5678450e8e2bd4e07629c40a", "committedDate": "2020-06-01T16:52:09Z", "message": "Changelog fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMTI3NjYx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11583#pullrequestreview-422127661", "createdAt": "2020-06-01T19:41:06Z", "commit": {"oid": "162b865d7c4fadfb5678450e8e2bd4e07629c40a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3863, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}