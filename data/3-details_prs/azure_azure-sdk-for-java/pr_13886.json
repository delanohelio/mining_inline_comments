{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0ODUyNDY1", "number": 13886, "title": "Updated Autocomplete Tests to Share Index", "bodyText": "Fixes #11145\nThis PR updates the autocomplete tests to share a single index instance as they are read only tests and won't modify the data in the index.", "createdAt": "2020-08-07T22:08:54Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13886", "merged": true, "mergeCommit": {"oid": "4a1f51e0a401e03a8cc0449b547b6ff4fb01dfdb"}, "closed": true, "closedAt": "2020-08-08T00:31:27Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8rgczAH2gAyNDY0ODUyNDY1OjYzOGQxOGQxOWVlNWI2NzEwZDQ0ZDQ2YjFiYzI2YzM3MzM5MWIwNmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8tlAMgFqTQ2MzY5NDk2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "638d18d19ee5b6710d44d46b1bc26c373391b06e", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/638d18d19ee5b6710d44d46b1bc26c373391b06e", "committedDate": "2020-08-07T21:42:54Z", "message": "Updated autocomplete tests to share a single index instance as they are read only tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f3a0a5c6592e98419e047ad26f32d03fb2702ab", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8f3a0a5c6592e98419e047ad26f32d03fb2702ab", "committedDate": "2020-08-07T22:08:45Z", "message": "Update session records"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNjc3NDQz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13886#pullrequestreview-463677443", "createdAt": "2020-08-07T22:50:43Z", "commit": {"oid": "8f3a0a5c6592e98419e047ad26f32d03fb2702ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjo1MDo0M1rOG9q05g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMjo1MDo0M1rOG9q05g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMxNzk5MA==", "bodyText": "Why can't we change the name directly in hotel json file but to modify here after serialization?\nThere are two other test classes which have the similar structure, SuggestSyncTests and SearchSyncTest.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13886#discussion_r467317990", "createdAt": "2020-08-07T22:50:43Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/AutocompleteSyncTests.java", "diffHunk": "@@ -23,20 +41,59 @@\n \n public class AutocompleteSyncTests extends SearchTestBase {\n     private static final String HOTELS_DATA_JSON = \"HotelsDataArray.json\";\n+    private static final String INDEX_NAME = \"azsearch-autocomplete-shared-instance\";\n \n+    private static SearchIndexClient searchIndexClient;\n     private SearchClient client;\n \n-    @Override\n-    protected void beforeTest() {\n-        super.beforeTest();\n \n-        client = getSearchClientBuilder(createHotelIndex()).buildClient();\n-        uploadDocumentsJson(client, HOTELS_DATA_JSON);\n+\n+    @BeforeAll\n+    public static void setupClass() {\n+        TestBase.setupClass();\n+\n+        if (TEST_MODE == TestMode.PLAYBACK) {\n+            return;\n+        }\n+\n+        Reader indexData = new InputStreamReader(Objects.requireNonNull(AutocompleteSyncTests.class\n+            .getClassLoader()\n+            .getResourceAsStream(HOTELS_TESTS_INDEX_DATA_JSON)));\n+\n+        try {\n+            SearchIndex index = new ObjectMapper().readValue(indexData, SearchIndex.class);\n+\n+            Field searchIndexName = index.getClass().getDeclaredField(\"name\");\n+            AccessController.doPrivileged((PrivilegedAction<Object>) () -> {\n+                searchIndexName.setAccessible(true);\n+                return null;\n+            });\n+\n+            searchIndexName.set(index, INDEX_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f3a0a5c6592e98419e047ad26f32d03fb2702ab"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNjc4NDAw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13886#pullrequestreview-463678400", "createdAt": "2020-08-07T22:54:10Z", "commit": {"oid": "8f3a0a5c6592e98419e047ad26f32d03fb2702ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7b31dab225b95116b6c356e659415fe41b0e396", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c7b31dab225b95116b6c356e659415fe41b0e396", "committedDate": "2020-08-07T22:57:55Z", "message": "Merge branch 'master' into AzSearch_AutocompleteTestsShareIndex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75608a280fb3f008114fcc179c7e5a23bd434cf6", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/75608a280fb3f008114fcc179c7e5a23bd434cf6", "committedDate": "2020-08-08T00:00:14Z", "message": "Updated Search and Suggest tests to use a shared index when possible"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNjk0OTYz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13886#pullrequestreview-463694963", "createdAt": "2020-08-08T00:07:41Z", "commit": {"oid": "75608a280fb3f008114fcc179c7e5a23bd434cf6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 871, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}