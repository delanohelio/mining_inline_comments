{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NTk3MjE0", "number": 17175, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMzo1Mzo1N1rOE1cK3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMzo1NDo1OVrOE1cL4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NDcxNTE3OnYy", "diffSide": "RIGHT", "path": "eng/pipelines/docindex.yml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMzo1Mzo1N1rOHtt6QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwMDowODo1OVrOHtuMKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDE2MA==", "bodyText": "We should consider copying all of eng directory incase we get extra dependencies or other tools we use from our normal repos.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517700160", "createdAt": "2020-11-04T23:53:57Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/docindex.yml", "diffHunk": "@@ -34,16 +35,39 @@ jobs:\n           versionSpec: '3.6'\n       - template: /eng/common/pipelines/templates/steps/mashup-doc-index.yml\n         parameters:\n-          SourceDirectory: $(Build.SourcesDirectory)        \n-      - task: CopyFiles@2\n-        displayName: Copy HTML to Artifacts Directory\n-        inputs:\n-          sourceFolder: $(Build.SourcesDirectory)/docfx_project/\n-          content: '**\\*'\n-          targetFolder: $(Build.ArtifactStagingDirectory)/docfx_project\n-          overWrite: true\n+          SourceDirectory: $(Build.ArtifactStagingDirectory)\n+      - pwsh: |\n+          Copy-Item -Path $(Build.SourcesDirectory)/eng/common/scripts/git-branch-push.ps1 -Destination ./ -Recurse -Force", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd200d0cf10f9e53b212e7768482c0f76781d73a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDc4OQ==", "bodyText": "Do you mean we add a eng/common folder to gh-pages branch?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517700789", "createdAt": "2020-11-04T23:55:52Z", "author": {"login": "sima-zhu"}, "path": "eng/pipelines/docindex.yml", "diffHunk": "@@ -34,16 +35,39 @@ jobs:\n           versionSpec: '3.6'\n       - template: /eng/common/pipelines/templates/steps/mashup-doc-index.yml\n         parameters:\n-          SourceDirectory: $(Build.SourcesDirectory)        \n-      - task: CopyFiles@2\n-        displayName: Copy HTML to Artifacts Directory\n-        inputs:\n-          sourceFolder: $(Build.SourcesDirectory)/docfx_project/\n-          content: '**\\*'\n-          targetFolder: $(Build.ArtifactStagingDirectory)/docfx_project\n-          overWrite: true\n+          SourceDirectory: $(Build.ArtifactStagingDirectory)\n+      - pwsh: |\n+          Copy-Item -Path $(Build.SourcesDirectory)/eng/common/scripts/git-branch-push.ps1 -Destination ./ -Recurse -Force", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDE2MA=="}, "originalCommit": {"oid": "fd200d0cf10f9e53b212e7768482c0f76781d73a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwNDc0Ng==", "bodyText": "I originally thought eng/common but things like the Language-Settings.ps1 script lives under eng/scripts and so I want to be sure if we start including that in our ps scripts we don't break this. That is why I suggest copying all of the eng directory.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517704746", "createdAt": "2020-11-05T00:08:59Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/docindex.yml", "diffHunk": "@@ -34,16 +35,39 @@ jobs:\n           versionSpec: '3.6'\n       - template: /eng/common/pipelines/templates/steps/mashup-doc-index.yml\n         parameters:\n-          SourceDirectory: $(Build.SourcesDirectory)        \n-      - task: CopyFiles@2\n-        displayName: Copy HTML to Artifacts Directory\n-        inputs:\n-          sourceFolder: $(Build.SourcesDirectory)/docfx_project/\n-          content: '**\\*'\n-          targetFolder: $(Build.ArtifactStagingDirectory)/docfx_project\n-          overWrite: true\n+          SourceDirectory: $(Build.ArtifactStagingDirectory)\n+      - pwsh: |\n+          Copy-Item -Path $(Build.SourcesDirectory)/eng/common/scripts/git-branch-push.ps1 -Destination ./ -Recurse -Force", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDE2MA=="}, "originalCommit": {"oid": "fd200d0cf10f9e53b212e7768482c0f76781d73a"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NDcxNzc5OnYy", "diffSide": "RIGHT", "path": "eng/pipelines/docindex.yml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMzo1NDo1OVrOHtt7uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMTo0Njo1M1rOHuX8bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDUzNg==", "bodyText": "We shouldn't need this explicit add.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517700536", "createdAt": "2020-11-04T23:54:59Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/docindex.yml", "diffHunk": "@@ -34,16 +35,39 @@ jobs:\n           versionSpec: '3.6'\n       - template: /eng/common/pipelines/templates/steps/mashup-doc-index.yml\n         parameters:\n-          SourceDirectory: $(Build.SourcesDirectory)        \n-      - task: CopyFiles@2\n-        displayName: Copy HTML to Artifacts Directory\n-        inputs:\n-          sourceFolder: $(Build.SourcesDirectory)/docfx_project/\n-          content: '**\\*'\n-          targetFolder: $(Build.ArtifactStagingDirectory)/docfx_project\n-          overWrite: true\n+          SourceDirectory: $(Build.ArtifactStagingDirectory)\n+      - pwsh: |\n+          Copy-Item -Path $(Build.SourcesDirectory)/eng/common/scripts/git-branch-push.ps1 -Destination ./ -Recurse -Force\n+          echo \"##vso[task.setvariable variable=gitPushScriptPath]$(Build.BinariesDirectory)/git-branch-push.ps1\"\n+        workingDirectory: $(Build.BinariesDirectory)\n+        displayName: Move Git Push scripts to Tool Directory  \n+\n       - task: PublishPipelineArtifact@0\n         condition: succeeded()\n         inputs:\n           artifactName: \"Doc.Index\"\n-          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n\\ No newline at end of file\n+          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n+          \n+      - pwsh: |\n+          git checkout -b gh-pages-local --track origin/gh-pages-root\n+        workingDirectory: $(Build.SourcesDirectory)\n+        displayName: Git pull GH pages branch\n+\n+      - pwsh: |\n+          Copy-Item -Path $(Build.ArtifactStagingDirectory)/docfx_project/_site/* -Destination ./ -Recurse -Force\n+          git add -A", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd200d0cf10f9e53b212e7768482c0f76781d73a"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMTA3NQ==", "bodyText": "All files copied to the gh-pages-local branch are untracked from git. git-branch-push will create a new branch which inherit gh-pages-local which did not include the new changes.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517701075", "createdAt": "2020-11-04T23:56:50Z", "author": {"login": "sima-zhu"}, "path": "eng/pipelines/docindex.yml", "diffHunk": "@@ -34,16 +35,39 @@ jobs:\n           versionSpec: '3.6'\n       - template: /eng/common/pipelines/templates/steps/mashup-doc-index.yml\n         parameters:\n-          SourceDirectory: $(Build.SourcesDirectory)        \n-      - task: CopyFiles@2\n-        displayName: Copy HTML to Artifacts Directory\n-        inputs:\n-          sourceFolder: $(Build.SourcesDirectory)/docfx_project/\n-          content: '**\\*'\n-          targetFolder: $(Build.ArtifactStagingDirectory)/docfx_project\n-          overWrite: true\n+          SourceDirectory: $(Build.ArtifactStagingDirectory)\n+      - pwsh: |\n+          Copy-Item -Path $(Build.SourcesDirectory)/eng/common/scripts/git-branch-push.ps1 -Destination ./ -Recurse -Force\n+          echo \"##vso[task.setvariable variable=gitPushScriptPath]$(Build.BinariesDirectory)/git-branch-push.ps1\"\n+        workingDirectory: $(Build.BinariesDirectory)\n+        displayName: Move Git Push scripts to Tool Directory  \n+\n       - task: PublishPipelineArtifact@0\n         condition: succeeded()\n         inputs:\n           artifactName: \"Doc.Index\"\n-          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n\\ No newline at end of file\n+          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n+          \n+      - pwsh: |\n+          git checkout -b gh-pages-local --track origin/gh-pages-root\n+        workingDirectory: $(Build.SourcesDirectory)\n+        displayName: Git pull GH pages branch\n+\n+      - pwsh: |\n+          Copy-Item -Path $(Build.ArtifactStagingDirectory)/docfx_project/_site/* -Destination ./ -Recurse -Force\n+          git add -A", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDUzNg=="}, "originalCommit": {"oid": "fd200d0cf10f9e53b212e7768482c0f76781d73a"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwNTYzMw==", "bodyText": "Yes but when we do the commit we pass in the \"-am\" option with the \"-a\" part means include all changes.  Is that not picking up new files? If it is not the doing the \"git add -A\"", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517705633", "createdAt": "2020-11-05T00:11:38Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/docindex.yml", "diffHunk": "@@ -34,16 +35,39 @@ jobs:\n           versionSpec: '3.6'\n       - template: /eng/common/pipelines/templates/steps/mashup-doc-index.yml\n         parameters:\n-          SourceDirectory: $(Build.SourcesDirectory)        \n-      - task: CopyFiles@2\n-        displayName: Copy HTML to Artifacts Directory\n-        inputs:\n-          sourceFolder: $(Build.SourcesDirectory)/docfx_project/\n-          content: '**\\*'\n-          targetFolder: $(Build.ArtifactStagingDirectory)/docfx_project\n-          overWrite: true\n+          SourceDirectory: $(Build.ArtifactStagingDirectory)\n+      - pwsh: |\n+          Copy-Item -Path $(Build.SourcesDirectory)/eng/common/scripts/git-branch-push.ps1 -Destination ./ -Recurse -Force\n+          echo \"##vso[task.setvariable variable=gitPushScriptPath]$(Build.BinariesDirectory)/git-branch-push.ps1\"\n+        workingDirectory: $(Build.BinariesDirectory)\n+        displayName: Move Git Push scripts to Tool Directory  \n+\n       - task: PublishPipelineArtifact@0\n         condition: succeeded()\n         inputs:\n           artifactName: \"Doc.Index\"\n-          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n\\ No newline at end of file\n+          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n+          \n+      - pwsh: |\n+          git checkout -b gh-pages-local --track origin/gh-pages-root\n+        workingDirectory: $(Build.SourcesDirectory)\n+        displayName: Git pull GH pages branch\n+\n+      - pwsh: |\n+          Copy-Item -Path $(Build.ArtifactStagingDirectory)/docfx_project/_site/* -Destination ./ -Recurse -Force\n+          git add -A", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDUzNg=="}, "originalCommit": {"oid": "fd200d0cf10f9e53b212e7768482c0f76781d73a"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM4ODg0NA==", "bodyText": "They are not the same branch. git-branch-push is on gh-pages which inherited from gh-page-local I am creating. However, the changes are untracked in gh-pages-local if no git add -A", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r518388844", "createdAt": "2020-11-05T21:46:53Z", "author": {"login": "sima-zhu"}, "path": "eng/pipelines/docindex.yml", "diffHunk": "@@ -34,16 +35,39 @@ jobs:\n           versionSpec: '3.6'\n       - template: /eng/common/pipelines/templates/steps/mashup-doc-index.yml\n         parameters:\n-          SourceDirectory: $(Build.SourcesDirectory)        \n-      - task: CopyFiles@2\n-        displayName: Copy HTML to Artifacts Directory\n-        inputs:\n-          sourceFolder: $(Build.SourcesDirectory)/docfx_project/\n-          content: '**\\*'\n-          targetFolder: $(Build.ArtifactStagingDirectory)/docfx_project\n-          overWrite: true\n+          SourceDirectory: $(Build.ArtifactStagingDirectory)\n+      - pwsh: |\n+          Copy-Item -Path $(Build.SourcesDirectory)/eng/common/scripts/git-branch-push.ps1 -Destination ./ -Recurse -Force\n+          echo \"##vso[task.setvariable variable=gitPushScriptPath]$(Build.BinariesDirectory)/git-branch-push.ps1\"\n+        workingDirectory: $(Build.BinariesDirectory)\n+        displayName: Move Git Push scripts to Tool Directory  \n+\n       - task: PublishPipelineArtifact@0\n         condition: succeeded()\n         inputs:\n           artifactName: \"Doc.Index\"\n-          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n\\ No newline at end of file\n+          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n+          \n+      - pwsh: |\n+          git checkout -b gh-pages-local --track origin/gh-pages-root\n+        workingDirectory: $(Build.SourcesDirectory)\n+        displayName: Git pull GH pages branch\n+\n+      - pwsh: |\n+          Copy-Item -Path $(Build.ArtifactStagingDirectory)/docfx_project/_site/* -Destination ./ -Recurse -Force\n+          git add -A", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDUzNg=="}, "originalCommit": {"oid": "fd200d0cf10f9e53b212e7768482c0f76781d73a"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2997, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}