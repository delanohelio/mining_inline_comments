{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxODY0MDU2", "number": 16204, "title": "RntbdBugFix", "bodyText": "This was detected in PR #14697.\nWriterIndex and readerIndex should be same when the method is called, but the more correct value to use is writerIndex.", "createdAt": "2020-10-12T22:56:27Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16204", "merged": true, "mergeCommit": {"oid": "edb9229de7995c4ec43edbfcc1bfd4d1c921b421"}, "closed": true, "closedAt": "2020-10-13T17:56:06Z", "author": {"login": "xinlian12"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR8FwEAH2gAyNTAxODY0MDU2OmQ5NTBiMzYzZWExMGI1ZjZmZjc0MmIxYjMyOWRjNmM4YWNlMmViNmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR8tUSgFqTUwNjk3NzQzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d950b363ea10b5f6ff742b1b329dc6c8ace2eb6f", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d950b363ea10b5f6ff742b1b329dc6c8ace2eb6f", "committedDate": "2020-10-12T22:54:32Z", "message": "Rntbd bug fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTY1MTY4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16204#pullrequestreview-506965168", "createdAt": "2020-10-12T22:58:03Z", "commit": {"oid": "d950b363ea10b5f6ff742b1b329dc6c8ace2eb6f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMjo1ODowM1rOHgPyDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMjo1ODowM1rOHgPyDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU3NTA1NA==", "bodyText": "could you please explain the scenario which this bug shows itself?\nwhy do we need this?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16204#discussion_r503575054", "createdAt": "2020-10-12T22:58:03Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdRequest.java", "diffHunk": "@@ -78,13 +79,16 @@ public static RntbdRequest decode(final ByteBuf in) {\n     void encode(final ByteBuf out) {\n \n         final int expectedLength = RntbdRequestFrame.LENGTH + this.headers.computeLength();\n-        final int start = out.readerIndex();\n+        final int start = out.writerIndex();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d950b363ea10b5f6ff742b1b329dc6c8ace2eb6f"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTY3MDk3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16204#pullrequestreview-506967097", "createdAt": "2020-10-12T23:04:03Z", "commit": {"oid": "d950b363ea10b5f6ff742b1b329dc6c8ace2eb6f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMzowNDowM1rOHgP4_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMzowNDowM1rOHgP4_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU3NjgzMQ==", "bodyText": "out.writerIndex() - start instead of out.writerIndex() - expectedLength", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16204#discussion_r503576831", "createdAt": "2020-10-12T23:04:03Z", "author": {"login": "FabianMeiswinkel"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdRequest.java", "diffHunk": "@@ -78,13 +79,16 @@ public static RntbdRequest decode(final ByteBuf in) {\n     void encode(final ByteBuf out) {\n \n         final int expectedLength = RntbdRequestFrame.LENGTH + this.headers.computeLength();\n-        final int start = out.readerIndex();\n+        final int start = out.writerIndex();\n \n         out.writeIntLE(expectedLength);\n         this.frame.encode(out);\n         this.headers.encode(out);\n \n-        assert out.writerIndex() - start == expectedLength;\n+        checkState(out.writerIndex() - start == expectedLength,\n+            \"encoding error: {\\\"expectedLength\\\": %s, \\\"observedLength\\\": %s}\",\n+            expectedLength,\n+            out.writerIndex() - expectedLength);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d950b363ea10b5f6ff742b1b329dc6c8ace2eb6f"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e006a9b4277bb4aaac39dca0d0a0db8fb1fe25e", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7e006a9b4277bb4aaac39dca0d0a0db8fb1fe25e", "committedDate": "2020-10-12T23:07:03Z", "message": "resolve comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTc2NzQ1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16204#pullrequestreview-506976745", "createdAt": "2020-10-12T23:35:24Z", "commit": {"oid": "7e006a9b4277bb4aaac39dca0d0a0db8fb1fe25e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTc3NDM0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16204#pullrequestreview-506977434", "createdAt": "2020-10-12T23:37:45Z", "commit": {"oid": "7e006a9b4277bb4aaac39dca0d0a0db8fb1fe25e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2124, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}