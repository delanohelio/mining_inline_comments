{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0OTEzOTA3", "number": 14527, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMzo1MTowNFrOEddulQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMjo1ODoyOFrOEd6Niw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MzMxMjIxOnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMzo1MTowNFrOHIoljw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMjozMTo0NVrOHJWEiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxNTYzMQ==", "bodyText": "We want to convert the item emitted by addWithResponseAsync(digitalTwinId, digitalTwin, context) into json string representation, and return it in a Mono; or return a Mono.error if the serialization fails.\nSo we need to use the Mono.flatMap API: https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html#flatMap-java.util.function.Function-", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r478815631", "createdAt": "2020-08-28T03:51:04Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13dd72c5278af22b16abef4b449d5bb4542c6acd"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxNjYyOQ==", "bodyText": "flatMap(Function<? super T,? extends Mono<? extends R>> transformer)\nTransform the item emitted by this Mono asynchronously, returning the value emitted by another Mono (possibly changing the value type).", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r478816629", "createdAt": "2020-08-28T03:55:18Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxNTYzMQ=="}, "originalCommit": {"oid": "13dd72c5278af22b16abef4b449d5bb4542c6acd"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2MDg0MA==", "bodyText": "Thank you for explanation.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r479560840", "createdAt": "2020-08-28T22:31:45Z", "author": {"login": "bikamani"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxNTYzMQ=="}, "originalCommit": {"oid": "13dd72c5278af22b16abef4b449d5bb4542c6acd"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MzMxNTAzOnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMzo1Mjo1OFrOHIonUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMzo1NTozOFrOHIopyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxNjA4MA==", "bodyText": "Here we simply convert the object returned into <T>. There is no checked exception thrown, so nothing needs to be transformed into Mono.error.\nSo we can use the Mono.Map API: https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html#map-java.util.function.Function-", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r478816080", "createdAt": "2020-08-28T03:52:58Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13dd72c5278af22b16abef4b449d5bb4542c6acd"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxNjcxNA==", "bodyText": "map(Function<? super T,? extends R> mapper)\nTransform the item emitted by this Mono by applying a synchronous function to it.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r478816714", "createdAt": "2020-08-28T03:55:38Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxNjA4MA=="}, "originalCommit": {"oid": "13dd72c5278af22b16abef4b449d5bb4542c6acd"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzU4MjA1OnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/samples/java/com/azure/digitaltwins/core/AsyncSample.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxOTo1NTo1NVrOHJSyaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjo1NDozM1rOHKAu7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwNzA0OA==", "bodyText": "when we get to the samples code, we will need to read this from the disk.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r479507048", "createdAt": "2020-08-28T19:55:55Z", "author": {"login": "azabbasi"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/samples/java/com/azure/digitaltwins/core/AsyncSample.java", "diffHunk": "@@ -118,5 +120,39 @@ public static void main(String[] args) throws InterruptedException, JsonProcessi\n         boolean created = createTwinsSemaphore.tryAcquire(2, 20, TimeUnit.SECONDS);\n         System.out.println(\"Source twins created: \" + created);\n \n+        String targetTwin1_Id = \"targetTwin_1_\" + random.nextInt();\n+        String targetTwin_1 = \"{\\\"$metadata\\\": {\\\"$model\\\": \\\"dtmi:samples:HVAC;1\\\"}, \\\"Efficiency\\\": 10, \\\"TargetTemperature\\\": 10, \\\"TargetHumidity\\\": 10}\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI1OTgyMQ==", "bodyText": "Yes, that's correct.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r480259821", "createdAt": "2020-08-31T16:54:33Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/samples/java/com/azure/digitaltwins/core/AsyncSample.java", "diffHunk": "@@ -118,5 +120,39 @@ public static void main(String[] args) throws InterruptedException, JsonProcessi\n         boolean created = createTwinsSemaphore.tryAcquire(2, 20, TimeUnit.SECONDS);\n         System.out.println(\"Source twins created: \" + created);\n \n+        String targetTwin1_Id = \"targetTwin_1_\" + random.nextInt();\n+        String targetTwin_1 = \"{\\\"$metadata\\\": {\\\"$model\\\": \\\"dtmi:samples:HVAC;1\\\"}, \\\"Efficiency\\\": 10, \\\"TargetTemperature\\\": 10, \\\"TargetHumidity\\\": 10}\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwNzA0OA=="}, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzYxMTMyOnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMDowNzoxMlrOHJTEJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjo1NDo1OVrOHKAwgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxMTU5MQ==", "bodyText": "it's not really returning a response", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r479511591", "createdAt": "2020-08-28T20:07:12Z", "author": {"login": "azabbasi"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> createRelationship(String digitalTwinId, String relationshipId, String relationship, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n-            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    T genericResponse = mapper.convertValue(response.getValue(), klazz);\n+            .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n                     DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders));\n-                });\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n     }\n \n     /**\n      * Creates a relationship on a digital twin.\n      *\n      * @param digitalTwinId The Id of the source digital twin.\n      * @param relationshipId The Id of the relationship to be created.\n-     * @param relationship The application/json relationship to be created.\n-     * @return A REST response containing the application/json relationship created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return The relationship created.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n-        return withContext(context -> createRelationshipWithResponse(digitalTwinId, relationshipId, relationship, context));\n+    public <T> Mono<T> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context))\n+            .map(DigitalTwinsResponse::getValue);\n     }\n \n-    Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship, Context context) {\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return A REST response containing the relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public <T> Mono<DigitalTwinsResponse<T>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context));\n+    }\n+\n+    <T> Mono<DigitalTwinsResponse<T>> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        return Mono.just(new SimpleResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @return The application/json relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> getRelationship(String digitalTwinId, String relationshipId) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @return A REST response containing the application/json relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> getRelationshipWithResponse(String digitalTwinId, String relationshipId) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> getRelationship(String digitalTwinId, String relationshipId, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .getRelationshipByIdWithResponseAsync(digitalTwinId, relationshipId, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.justOrEmpty(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return The relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public <T> Mono<T> getRelationship(String digitalTwinId, String relationshipId, Class<T> clazz) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, clazz, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return A REST response containing the relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public <T> Mono<DigitalTwinsResponse<T>> getRelationshipWithResponse(String digitalTwinId, String relationshipId, Class<T> clazz) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, clazz, context));\n+    }\n+\n+    <T> Mono<DigitalTwinsResponse<T>> getRelationship(String digitalTwinId, String relationshipId, Class<T> clazz, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .getRelationshipByIdWithResponseAsync(digitalTwinId, relationshipId, context)\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Updates the properties of a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be updated.\n+     * @param relationshipUpdateOperations The application/json-patch+json operations to be performed on the specified digital twin's relationship.\n+     * @return An empty response.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 274}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI2MDIyNw==", "bodyText": "True, updated it to \"returns an Empty Mono\"", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r480260227", "createdAt": "2020-08-31T16:54:59Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> createRelationship(String digitalTwinId, String relationshipId, String relationship, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n-            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    T genericResponse = mapper.convertValue(response.getValue(), klazz);\n+            .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n                     DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders));\n-                });\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n     }\n \n     /**\n      * Creates a relationship on a digital twin.\n      *\n      * @param digitalTwinId The Id of the source digital twin.\n      * @param relationshipId The Id of the relationship to be created.\n-     * @param relationship The application/json relationship to be created.\n-     * @return A REST response containing the application/json relationship created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return The relationship created.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n-        return withContext(context -> createRelationshipWithResponse(digitalTwinId, relationshipId, relationship, context));\n+    public <T> Mono<T> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context))\n+            .map(DigitalTwinsResponse::getValue);\n     }\n \n-    Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship, Context context) {\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return A REST response containing the relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public <T> Mono<DigitalTwinsResponse<T>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context));\n+    }\n+\n+    <T> Mono<DigitalTwinsResponse<T>> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        return Mono.just(new SimpleResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @return The application/json relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> getRelationship(String digitalTwinId, String relationshipId) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @return A REST response containing the application/json relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> getRelationshipWithResponse(String digitalTwinId, String relationshipId) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> getRelationship(String digitalTwinId, String relationshipId, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .getRelationshipByIdWithResponseAsync(digitalTwinId, relationshipId, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.justOrEmpty(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return The relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public <T> Mono<T> getRelationship(String digitalTwinId, String relationshipId, Class<T> clazz) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, clazz, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return A REST response containing the relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public <T> Mono<DigitalTwinsResponse<T>> getRelationshipWithResponse(String digitalTwinId, String relationshipId, Class<T> clazz) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, clazz, context));\n+    }\n+\n+    <T> Mono<DigitalTwinsResponse<T>> getRelationship(String digitalTwinId, String relationshipId, Class<T> clazz, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .getRelationshipByIdWithResponseAsync(digitalTwinId, relationshipId, context)\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Updates the properties of a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be updated.\n+     * @param relationshipUpdateOperations The application/json-patch+json operations to be performed on the specified digital twin's relationship.\n+     * @return An empty response.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxMTU5MQ=="}, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 274}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzkzMTc3OnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/API design.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMjoyOToyMVrOHJWCEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMjoyOToyMVrOHJWCEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2MDIxMQ==", "bodyText": "\ud83c\udd92", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r479560211", "createdAt": "2020-08-28T22:29:21Z", "author": {"login": "bikamani"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/API design.md", "diffHunk": "@@ -306,23 +306,23 @@ These APIs are invoked via DigitalTwinsAsyncClient.\n      * @param digitalTwinId The Id of the source digital twin.\n      * @param relationshipId The Id of the relationship to be created.\n      * @param relationship The relationship to be created.\n-     * @param modelClass The model class to convert the relationship to.\n+     * @param clazz The model class to convert the relationship to.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5Nzk0NDA3OnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMjozNjo0M1rOHJWJKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjo1NTo0MVrOHKAydg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2MjAyNA==", "bodyText": "Did we decide Rest or Http? If not yet, I'd go with Http similar to dotnet.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r479562024", "createdAt": "2020-08-28T22:36:43Z", "author": {"login": "bikamani"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI2MDcyNg==", "bodyText": "Sure, I'll use Http.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r480260726", "createdAt": "2020-08-31T16:55:41Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2MjAyNA=="}, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5Nzk0NTYwOnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMjozNzo0OFrOHJWKAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjo1Nzo0NlrOHKA3Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2MjI0Mw==", "bodyText": "should we also log here?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r479562243", "createdAt": "2020-08-28T22:37:48Z", "author": {"login": "bikamani"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI2MTk1NA==", "bodyText": "Sure, I added a log statement around these Mono.error returning code paths.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r480261954", "createdAt": "2020-08-31T16:57:46Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2MjI0Mw=="}, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5Nzk0OTIxOnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMjozOTo1N1rOHJWMEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjo1ODozMFrOHKA47A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2Mjc2OQ==", "bodyText": "Is this also required?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r479562769", "createdAt": "2020-08-28T22:39:57Z", "author": {"login": "bikamani"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> createRelationship(String digitalTwinId, String relationshipId, String relationship, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n-            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    T genericResponse = mapper.convertValue(response.getValue(), klazz);\n+            .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n                     DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders));\n-                });\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n     }\n \n     /**\n      * Creates a relationship on a digital twin.\n      *\n      * @param digitalTwinId The Id of the source digital twin.\n      * @param relationshipId The Id of the relationship to be created.\n-     * @param relationship The application/json relationship to be created.\n-     * @return A REST response containing the application/json relationship created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI2MjM4MA==", "bodyText": "Yes, the javadoc generator reports an error otherwise.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r480262380", "createdAt": "2020-08-31T16:58:30Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> createRelationship(String digitalTwinId, String relationshipId, String relationship, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n-            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    T genericResponse = mapper.convertValue(response.getValue(), klazz);\n+            .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n                     DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders));\n-                });\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n     }\n \n     /**\n      * Creates a relationship on a digital twin.\n      *\n      * @param digitalTwinId The Id of the source digital twin.\n      * @param relationshipId The Id of the relationship to be created.\n-     * @param relationship The application/json relationship to be created.\n-     * @return A REST response containing the application/json relationship created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2Mjc2OQ=="}, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5Nzk1NDE5OnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMjo0Mjo1OFrOHJWO6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNzowNTo0N1rOHKBIEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2MzQ5Nw==", "bodyText": "How does this work?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r479563497", "createdAt": "2020-08-28T22:42:58Z", "author": {"login": "bikamani"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> createRelationship(String digitalTwinId, String relationshipId, String relationship, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n-            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    T genericResponse = mapper.convertValue(response.getValue(), klazz);\n+            .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n                     DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders));\n-                });\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n     }\n \n     /**\n      * Creates a relationship on a digital twin.\n      *\n      * @param digitalTwinId The Id of the source digital twin.\n      * @param relationshipId The Id of the relationship to be created.\n-     * @param relationship The application/json relationship to be created.\n-     * @return A REST response containing the application/json relationship created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return The relationship created.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n-        return withContext(context -> createRelationshipWithResponse(digitalTwinId, relationshipId, relationship, context));\n+    public <T> Mono<T> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context))\n+            .map(DigitalTwinsResponse::getValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI2NjI1OA==", "bodyText": "This is called a method reference; it is useful when you want to use a lambda expression to call an existing method.\nEg. this map operation actually does the following:\n.map(new Function<DigitalTwinsResponse<String>, String>() {\n        @Override\n        public String apply(DigitalTwinsResponse<String> stringDigitalTwinsResponse) {\n            return stringDigitalTwinsResponse.getValue();\n        }\n    });\nSince all we do in this anonymous class is call DigitalTwinsResponse.getValue(), we can replace it by a method reference.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r480266258", "createdAt": "2020-08-31T17:05:47Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> createRelationship(String digitalTwinId, String relationshipId, String relationship, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n-            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    T genericResponse = mapper.convertValue(response.getValue(), klazz);\n+            .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n                     DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders));\n-                });\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n     }\n \n     /**\n      * Creates a relationship on a digital twin.\n      *\n      * @param digitalTwinId The Id of the source digital twin.\n      * @param relationshipId The Id of the relationship to be created.\n-     * @param relationship The application/json relationship to be created.\n-     * @return A REST response containing the application/json relationship created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return The relationship created.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n-        return withContext(context -> createRelationshipWithResponse(digitalTwinId, relationshipId, relationship, context));\n+    public <T> Mono<T> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context))\n+            .map(DigitalTwinsResponse::getValue);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2MzQ5Nw=="}, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5Nzk3ODk5OnYy", "diffSide": "RIGHT", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMjo1ODoyOFrOHJWc_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODowMTo0M1rOHKC7ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2NzEwMQ==", "bodyText": "why justOrEmpty?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r479567101", "createdAt": "2020-08-28T22:58:28Z", "author": {"login": "bikamani"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> createRelationship(String digitalTwinId, String relationshipId, String relationship, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n-            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    T genericResponse = mapper.convertValue(response.getValue(), klazz);\n+            .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n                     DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders));\n-                });\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n     }\n \n     /**\n      * Creates a relationship on a digital twin.\n      *\n      * @param digitalTwinId The Id of the source digital twin.\n      * @param relationshipId The Id of the relationship to be created.\n-     * @param relationship The application/json relationship to be created.\n-     * @return A REST response containing the application/json relationship created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return The relationship created.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n-        return withContext(context -> createRelationshipWithResponse(digitalTwinId, relationshipId, relationship, context));\n+    public <T> Mono<T> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context))\n+            .map(DigitalTwinsResponse::getValue);\n     }\n \n-    Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship, Context context) {\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return A REST response containing the relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public <T> Mono<DigitalTwinsResponse<T>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context));\n+    }\n+\n+    <T> Mono<DigitalTwinsResponse<T>> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        return Mono.just(new SimpleResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @return The application/json relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> getRelationship(String digitalTwinId, String relationshipId) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @return A REST response containing the application/json relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> getRelationshipWithResponse(String digitalTwinId, String relationshipId) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> getRelationship(String digitalTwinId, String relationshipId, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .getRelationshipByIdWithResponseAsync(digitalTwinId, relationshipId, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.justOrEmpty(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 221}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI5NTc4Ng==", "bodyText": "REturns the mono containing the item, or an empty mono, if no item is retrieved.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14527#discussion_r480295786", "createdAt": "2020-08-31T18:01:43Z", "author": {"login": "abhipsaMisra"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsAsyncClient.java", "diffHunk": "@@ -92,67 +94,282 @@ public HttpPipeline getHttpPipeline() {\n         return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, context));\n     }\n \n+    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n+    }\n+\n     // TODO: This is a temporary implementation for sample purposes. This should be spruced up/replaced once this API is actually designed.\n     // Input is Object and output is Response<T>.\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz) {\n-        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, klazz, context));\n+    public <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz) {\n+        return withContext(context -> createDigitalTwinWithResponse(digitalTwinId, digitalTwin, clazz, context));\n     }\n \n-    Mono<DigitalTwinsResponse<String>> createDigitalTwinWithResponse(String digitalTwinId, String digitalTwin, Context context) {\n+    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                        return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n-    }\n-\n-    <T> Mono<DigitalTwinsResponse<T>> createDigitalTwinWithResponse(String digitalTwinId, Object digitalTwin, Class<T> klazz, Context context) {\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return The application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> createRelationship(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The application/json relationship to be created.\n+     * @return A REST response containing the application/json relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> createRelationship(String digitalTwinId, String relationshipId, String relationship, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n-            .addWithResponseAsync(digitalTwinId, digitalTwin, context)\n-            .flatMap(\n-                response -> {\n-                    T genericResponse = mapper.convertValue(response.getValue(), klazz);\n+            .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n                     DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n-                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders));\n-                });\n+                    return Mono.just(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));\n+                } catch (JsonProcessingException e) {\n+                    return Mono.error(e);\n+                }\n+            });\n     }\n \n     /**\n      * Creates a relationship on a digital twin.\n      *\n      * @param digitalTwinId The Id of the source digital twin.\n      * @param relationshipId The Id of the relationship to be created.\n-     * @param relationship The application/json relationship to be created.\n-     * @return A REST response containing the application/json relationship created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return The relationship created.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n-    public Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship) {\n-        return withContext(context -> createRelationshipWithResponse(digitalTwinId, relationshipId, relationship, context));\n+    public <T> Mono<T> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context))\n+            .map(DigitalTwinsResponse::getValue);\n     }\n \n-    Mono<Response<String>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, String relationship, Context context) {\n+    /**\n+     * Creates a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to be created.\n+     * @param relationship The relationship to be created.\n+     * @param clazz The model class to convert the relationship to.\n+     * @param <T> The generic type to convert the relationship to.\n+     * @return A REST response containing the relationship created.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public <T> Mono<DigitalTwinsResponse<T>> createRelationshipWithResponse(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz) {\n+        return withContext(context -> createRelationship(digitalTwinId, relationshipId, relationship, clazz, context));\n+    }\n+\n+    <T> Mono<DigitalTwinsResponse<T>> createRelationship(String digitalTwinId, String relationshipId, Object relationship, Class<T> clazz, Context context) {\n         return protocolLayer\n             .getDigitalTwins()\n             .addRelationshipWithResponseAsync(digitalTwinId, relationshipId, relationship, context)\n-            .flatMap(\n-                response -> {\n-                    try {\n-                        String jsonResponse = mapper.writeValueAsString(response.getValue());\n-                        return Mono.just(new SimpleResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse));\n-                    } catch (JsonProcessingException e) {\n-                        return Mono.error(e);\n-                    }\n-                });\n+            .map(response -> {\n+                T genericResponse = mapper.convertValue(response.getValue(), clazz);\n+                DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                return new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), genericResponse, twinHeaders);\n+            });\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @return The application/json relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<String> getRelationship(String digitalTwinId, String relationshipId) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, context))\n+            .map(DigitalTwinsResponse::getValue);\n+    }\n+\n+    /**\n+     * Gets a relationship on a digital twin.\n+     *\n+     * @param digitalTwinId The Id of the source digital twin.\n+     * @param relationshipId The Id of the relationship to retrieve.\n+     * @return A REST response containing the application/json relationship corresponding to the provided relationshipId.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<DigitalTwinsResponse<String>> getRelationshipWithResponse(String digitalTwinId, String relationshipId) {\n+        return withContext(context -> getRelationship(digitalTwinId, relationshipId, context));\n+    }\n+\n+    Mono<DigitalTwinsResponse<String>> getRelationship(String digitalTwinId, String relationshipId, Context context) {\n+        return protocolLayer\n+            .getDigitalTwins()\n+            .getRelationshipByIdWithResponseAsync(digitalTwinId, relationshipId, context)\n+            .flatMap(response -> {\n+                try {\n+                    String jsonResponse = mapper.writeValueAsString(response.getValue());\n+                    DigitalTwinsResponseHeaders twinHeaders = mapper.convertValue(response.getDeserializedHeaders(), DigitalTwinsResponseHeaders.class);\n+                    return Mono.justOrEmpty(new DigitalTwinsResponse<>(response.getRequest(), response.getStatusCode(), response.getHeaders(), jsonResponse, twinHeaders));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU2NzEwMQ=="}, "originalCommit": {"oid": "912565496d1744420fc6c8de1453034569161656"}, "originalPosition": 221}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1426, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}