{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NDg2NDk0", "number": 16696, "title": "Add clientOptions to digital twins builder", "bodyText": "also rename BasicDigitalTwin's getDigitalTwinEtag() to be just getEtag()", "createdAt": "2020-10-22T18:41:54Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696", "merged": true, "mergeCommit": {"oid": "69101823764188bdf33f10bc12bf33a054de2eaa"}, "closed": true, "closedAt": "2020-10-22T20:14:35Z", "author": {"login": "timtay-microsoft"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVGdyugH2gAyNTA4NDg2NDk0OjRjYThhNzE5MTRjNjc0NWUxZjFiMzI5Nzc5ZDE1MmI0YzdlZjcyZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVGrEVgFqTUxNTAyNzcyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ca8a71914c6745e1f1b329779d152b4c7ef72e3", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4ca8a71914c6745e1f1b329779d152b4c7ef72e3", "committedDate": "2020-10-22T18:41:37Z", "message": "Add clientOptions to digital twins builder\n\nalso rename BasicDigitalTwin's getDigitalTwinEtag() to be just getEtag()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDIwOTk3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#pullrequestreview-515020997", "createdAt": "2020-10-22T18:47:13Z", "commit": {"oid": "4ca8a71914c6745e1f1b329779d152b4c7ef72e3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDIxNDEy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#pullrequestreview-515021412", "createdAt": "2020-10-22T18:47:44Z", "commit": {"oid": "4ca8a71914c6745e1f1b329779d152b4c7ef72e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODo0Nzo0NVrOHmvQUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODo0Nzo0NVrOHmvQUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM4MjE2Mw==", "bodyText": "Enumerate all imports instead of using *", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#discussion_r510382163", "createdAt": "2020-10-22T18:47:45Z", "author": {"login": "srnagar"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsClientBuilder.java", "diffHunk": "@@ -5,10 +5,9 @@\n \n import com.azure.core.annotation.ServiceClientBuilder;\n import com.azure.core.credential.TokenCredential;\n-import com.azure.core.http.HttpClient;\n-import com.azure.core.http.HttpPipeline;\n-import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ca8a71914c6745e1f1b329779d152b4c7ef72e3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f72f51104f6646139f85117f96535b7ffd176ac2", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f72f51104f6646139f85117f96535b7ffd176ac2", "committedDate": "2020-10-22T18:50:10Z", "message": "fixup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDIzNTk4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#pullrequestreview-515023598", "createdAt": "2020-10-22T18:50:39Z", "commit": {"oid": "f72f51104f6646139f85117f96535b7ffd176ac2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDI1OTYw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#pullrequestreview-515025960", "createdAt": "2020-10-22T18:53:45Z", "commit": {"oid": "f72f51104f6646139f85117f96535b7ffd176ac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODo1Mzo0NVrOHmvdjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODo1Mzo0NVrOHmvdjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM4NTU1MQ==", "bodyText": "How do we feel about formatting ternary operations like we do in .NET?\nString applicationId = clientOptions == null\n    ? httpLogOptions.getApplicationId()\n    : clientOptions.GetApplicationId();", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#discussion_r510385551", "createdAt": "2020-10-22T18:53:45Z", "author": {"login": "drwill-ms"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsClientBuilder.java", "diffHunk": "@@ -76,17 +88,26 @@ public DigitalTwinsClientBuilder()\n         httpLogOptions = new HttpLogOptions();\n     }\n \n-    private static HttpPipeline buildPipeline(TokenCredential tokenCredential, String endpoint,\n-                                              HttpLogOptions httpLogOptions, HttpClient httpClient,\n-                                              List<HttpPipelinePolicy> additionalPolicies, RetryPolicy retryPolicy,\n-                                              Configuration configuration, Map<String, String> properties) {\n+    private static HttpPipeline buildPipeline(TokenCredential tokenCredential,\n+                                              String endpoint,\n+                                              HttpLogOptions httpLogOptions,\n+                                              ClientOptions clientOptions,\n+                                              HttpClient httpClient,\n+                                              List<HttpPipelinePolicy> additionalPolicies,\n+                                              RetryPolicy retryPolicy,\n+                                              Configuration configuration,\n+                                              Map<String, String> properties) {\n         // Closest to API goes first, closest to wire goes last.\n         List<HttpPipelinePolicy> policies = new ArrayList<>();\n \n         String clientName = properties.getOrDefault(SDK_NAME, \"UnknownName\");\n         String clientVersion = properties.getOrDefault(SDK_VERSION, \"UnknownVersion\");\n \n-        policies.add(new UserAgentPolicy(httpLogOptions.getApplicationId(), clientName, clientVersion, configuration));\n+        // Give precedence to applicationId configured in clientOptions over the one configured in httpLogOptions.\n+        // Azure.Core deprecated setting the applicationId in httpLogOptions.\n+        String applicationId =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72f51104f6646139f85117f96535b7ffd176ac2"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDI2NjUx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#pullrequestreview-515026651", "createdAt": "2020-10-22T18:54:40Z", "commit": {"oid": "f72f51104f6646139f85117f96535b7ffd176ac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODo1NDo0MFrOHmvfvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODo1NDo0MFrOHmvfvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM4NjExMA==", "bodyText": "Does Java have null coalesce? Like String applicationId = clientOptions?.getApplicationId ?? httpLogOptions.getApplicationId;", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#discussion_r510386110", "createdAt": "2020-10-22T18:54:40Z", "author": {"login": "drwill-ms"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsClientBuilder.java", "diffHunk": "@@ -76,17 +88,26 @@ public DigitalTwinsClientBuilder()\n         httpLogOptions = new HttpLogOptions();\n     }\n \n-    private static HttpPipeline buildPipeline(TokenCredential tokenCredential, String endpoint,\n-                                              HttpLogOptions httpLogOptions, HttpClient httpClient,\n-                                              List<HttpPipelinePolicy> additionalPolicies, RetryPolicy retryPolicy,\n-                                              Configuration configuration, Map<String, String> properties) {\n+    private static HttpPipeline buildPipeline(TokenCredential tokenCredential,\n+                                              String endpoint,\n+                                              HttpLogOptions httpLogOptions,\n+                                              ClientOptions clientOptions,\n+                                              HttpClient httpClient,\n+                                              List<HttpPipelinePolicy> additionalPolicies,\n+                                              RetryPolicy retryPolicy,\n+                                              Configuration configuration,\n+                                              Map<String, String> properties) {\n         // Closest to API goes first, closest to wire goes last.\n         List<HttpPipelinePolicy> policies = new ArrayList<>();\n \n         String clientName = properties.getOrDefault(SDK_NAME, \"UnknownName\");\n         String clientVersion = properties.getOrDefault(SDK_VERSION, \"UnknownVersion\");\n \n-        policies.add(new UserAgentPolicy(httpLogOptions.getApplicationId(), clientName, clientVersion, configuration));\n+        // Give precedence to applicationId configured in clientOptions over the one configured in httpLogOptions.\n+        // Azure.Core deprecated setting the applicationId in httpLogOptions.\n+        String applicationId =\n+            clientOptions == null ? httpLogOptions.getApplicationId() : clientOptions.getApplicationId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72f51104f6646139f85117f96535b7ffd176ac2"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDI3NDQ2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#pullrequestreview-515027446", "createdAt": "2020-10-22T18:55:43Z", "commit": {"oid": "f72f51104f6646139f85117f96535b7ffd176ac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODo1NTo0M1rOHmviQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODo1NTo0M1rOHmviQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM4Njc1Mg==", "bodyText": "Does it matter in Java (for memory optimization) to initialize a list with a known size ahead of time, and could you get that from clientOptions.getHeaders()?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#discussion_r510386752", "createdAt": "2020-10-22T18:55:43Z", "author": {"login": "drwill-ms"}, "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsClientBuilder.java", "diffHunk": "@@ -106,6 +127,14 @@ private static HttpPipeline buildPipeline(TokenCredential tokenCredential, Strin\n \n         policies.addAll(additionalPolicies);\n \n+        // If client options has headers configured, add a policy for each\n+        if (clientOptions != null) {\n+            List<HttpHeader> httpHeaderList = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72f51104f6646139f85117f96535b7ffd176ac2"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a447434aa92e7f2c3e9a31655236b2d046d4346", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3a447434aa92e7f2c3e9a31655236b2d046d4346", "committedDate": "2020-10-22T18:55:47Z", "message": "fixup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDI3NzI2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16696#pullrequestreview-515027726", "createdAt": "2020-10-22T18:56:07Z", "commit": {"oid": "f72f51104f6646139f85117f96535b7ffd176ac2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1756, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}