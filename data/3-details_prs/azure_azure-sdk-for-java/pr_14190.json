{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MDAxMzg0", "number": 14190, "title": "Automatic Document Indexing Batches", "bodyText": "Fixes #13880\nThis PR adds the ability to have automatic batching via the SearchIndexBatchingClients. The batching client is constructed using two parameters to determine handling for automatically sending batches. First is a batching scheduler which tracks the window of time between two documents being inserted into the batch, if this value isn't set the client won't use automatic batch sending. Second is a batch size trigger, once the number of documents in the batch reaches or exceed the limit the batch will be sent only if automatic batch sending is enabled. Additionally, the batch client will leverage a new interface of DocumentPersister which will persist documents in the batch queue and succeeded or failed documents, this functionality is optional and is meant to offer a consistent store outside of memory for the client. The batch client will maintain three active queues of the pending documents to be index, documents that have completed indexing, and documents that have failed indexing with a non-retryable status code. If a batch is sent that exceeds the size limit of the Search service the batch will be split into two smaller batches and sent again, this process will repeat until a batch size of one and then at that time the operation will fail as the single document is too large for the service to accept.", "createdAt": "2020-08-17T18:31:33Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14190", "merged": true, "mergeCommit": {"oid": "51bb27a7ab7e608330063a32dfed2f773a70dfab"}, "closed": true, "closedAt": "2020-09-03T00:56:59Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-nufiAH2gAyNDY5MDAxMzg0OjE3OWNlNjM5YTgzNWRkNjNlNTQwYzRjMWYzODJmODMxNDgwZjRkZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFCPOnAFqTQ4MTI4NDYzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "179ce639a835dd63e540c4c1f382f831480f4dd6", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/179ce639a835dd63e540c4c1f382f831480f4dd6", "committedDate": "2020-08-13T22:26:28Z", "message": "APIs for advanced batching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84f7d82c087b6b5ddb64bc0baf28ee133d2eed1c", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/84f7d82c087b6b5ddb64bc0baf28ee133d2eed1c", "committedDate": "2020-08-13T23:11:31Z", "message": "Merge branch 'master' into AzSearch_AdvancedBatching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af8afa3713a6f6de027574574af41c86921d8c64", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/af8afa3713a6f6de027574574af41c86921d8c64", "committedDate": "2020-08-14T01:03:58Z", "message": "Additional implementation changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d417648b0427899141f0ca5f37d14b5cb7da2586", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d417648b0427899141f0ca5f37d14b5cb7da2586", "committedDate": "2020-08-14T18:08:01Z", "message": "Merge branch 'master' into AzSearch_AdvancedBatching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b053928c89f53816536573a641ed96bbda4f6c97", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b053928c89f53816536573a641ed96bbda4f6c97", "committedDate": "2020-08-14T23:09:30Z", "message": "More implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8637b6272a9d79d26fd1483efdb76ba79de74e1c", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8637b6272a9d79d26fd1483efdb76ba79de74e1c", "committedDate": "2020-08-17T16:38:07Z", "message": "Merge branch 'master' into AzSearch_AdvancedBatching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6587593d3dfbb222bfc3027b089183876c070c65", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6587593d3dfbb222bfc3027b089183876c070c65", "committedDate": "2020-08-17T18:22:36Z", "message": "Fixed using incorrect default value for throw on any error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb7341300cc0f81ca26547a5cac5b6a21a99ce3a", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fb7341300cc0f81ca26547a5cac5b6a21a99ce3a", "committedDate": "2020-08-20T22:53:15Z", "message": "Merge branch 'master' into AzSearch_AdvancedBatching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ffde7071d56b0e5424156341117065f6c0ad8bd", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9ffde7071d56b0e5424156341117065f6c0ad8bd", "committedDate": "2020-08-21T17:42:43Z", "message": "Renamed DocumentPersister to IndexingHooks and changed method names, updated client builder and factory methods to take a new autoFlush flag and to use Duration instead of Integer for flushWindow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d8ea8ca1a7a1a3257c2ad03319be9e316ee702a", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5d8ea8ca1a7a1a3257c2ad03319be9e316ee702a", "committedDate": "2020-08-21T20:48:57Z", "message": "Merge branch 'master' into AzSearch_AdvancedBatching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d797a62511c65489c230f3f3ee252b23f63112e", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5d797a62511c65489c230f3f3ee252b23f63112e", "committedDate": "2020-08-21T22:25:06Z", "message": "Add conext and timeout to synchronous methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b012621c6998610518b8d1248e9d334d56f1f487", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b012621c6998610518b8d1248e9d334d56f1f487", "committedDate": "2020-08-27T22:39:10Z", "message": "Merge branch 'master' into AzSearch_AdvancedBatching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0409e942b349be0049e63f3d63a62eba4c3e390d", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0409e942b349be0049e63f3d63a62eba4c3e390d", "committedDate": "2020-08-27T23:30:52Z", "message": "Add try count tracking to determine when an action should give up indexing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e513c0534f3b007e85181329e962ab591726b206", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e513c0534f3b007e85181329e962ab591726b206", "committedDate": "2020-08-28T21:51:51Z", "message": "Add unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4Nzc4MjA3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14190#pullrequestreview-478778207", "createdAt": "2020-08-31T16:51:25Z", "commit": {"oid": "e513c0534f3b007e85181329e962ab591726b206"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjo1MToyNVrOHKAmJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjo1MToyNVrOHKAmJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI1NzU3NA==", "bodyText": "https://blog.joda.org/2012/11/javadoc-coding-standards.html#:~:text=Do%20not%20use%20%40code%20for,and%20adds%20no%20real%20value.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14190#discussion_r480257574", "createdAt": "2020-08-31T16:51:25Z", "author": {"login": "mssfang"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchAsyncClient.java", "diffHunk": "@@ -164,6 +166,41 @@ public String getEndpoint() {\n         return this.endpoint;\n     }\n \n+    /**\n+     * Creates a {@link SearchIndexBatchingAsyncClient} used to index documents for the Search index associated with\n+     * this {@link SearchAsyncClient}.\n+     * <p>\n+     * This will use the default configuration values for {@link SearchIndexBatchingAsyncClient}, see {@link\n+     * SearchIndexBatchingClientBuilder} for more information.\n+     *\n+     * @return A {@link SearchIndexBatchingAsyncClient} used to index documents for the Search index associated with\n+     * this {@link SearchAsyncClient}.\n+     */\n+    public SearchIndexBatchingAsyncClient getIndexDocumentBatchingAsyncClient() {\n+        return getIndexDocumentBatchingAsyncClient(null, null, null, null);\n+    }\n+\n+    /**\n+     * Creates a {@link SearchIndexBatchingAsyncClient} used to index documents for the Search index associated with\n+     * this {@link SearchAsyncClient}.\n+     *\n+     * @param autoFlush Flag determining whether the batching client will automatically flush its document batch. If\n+     * {@code null} is passed this will be set to {@code true}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e513c0534f3b007e85181329e962ab591726b206"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "504b9346a4ae3c71aacf51ca2d9ab03e701b2288", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/504b9346a4ae3c71aacf51ca2d9ab03e701b2288", "committedDate": "2020-08-31T17:34:22Z", "message": "Merge branch 'master' into AzSearch_AdvancedBatching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63b1ca8311f560e39c82130731dba3dae4a19266", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/63b1ca8311f560e39c82130731dba3dae4a19266", "committedDate": "2020-08-31T17:54:35Z", "message": "Changes @code null|true|false to null|true|false"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50db44e2873c53c134b35e8aad6e40bf052043ab", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/50db44e2873c53c134b35e8aad6e40bf052043ab", "committedDate": "2020-08-31T18:01:03Z", "message": "Merge branch 'master' into AzSearch_AdvancedBatching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24c16780198ea347cb7707ae4a58412658f466ba", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/24c16780198ea347cb7707ae4a58412658f466ba", "committedDate": "2020-08-31T20:04:21Z", "message": "Remove @code tags for null|true|false"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2953834bc1c8a6eeeca5fa6eccb29b0f091bb93e", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2953834bc1c8a6eeeca5fa6eccb29b0f091bb93e", "committedDate": "2020-09-02T19:23:40Z", "message": "Merge in master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24dd6f309bcdcd304a6ef11420cab46788a80463", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/24dd6f309bcdcd304a6ef11420cab46788a80463", "committedDate": "2020-09-02T19:41:54Z", "message": "Fix test code merge conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMjg0NjM4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14190#pullrequestreview-481284638", "createdAt": "2020-09-02T20:43:18Z", "commit": {"oid": "24dd6f309bcdcd304a6ef11420cab46788a80463"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 426, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}