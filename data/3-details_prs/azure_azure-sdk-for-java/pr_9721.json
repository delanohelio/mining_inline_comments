{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NTg4NTg1", "number": 9721, "title": "Updated EncryptedClientBuilder", "bodyText": "Customers can now specify a key/keyResolver after they specify a pipeline/client on the builder.\nThe builder will now throw if a pipeline/client was already configured for decryption as the encryption info may conflict.", "createdAt": "2020-03-31T20:40:48Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9721", "merged": true, "mergeCommit": {"oid": "84199df75250585bc608bf49d754550391f85fe9"}, "closed": true, "closedAt": "2020-04-03T22:54:17Z", "author": {"login": "rickle-msft"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTJUOmgH2gAyMzk2NTg4NTg1OjlhODgzOGI1ZjFhZmUxN2E4ZmU5ODM3ZGNkMmJmNjBiMmUzM2Q3ZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUH9F_AH2gAyMzk2NTg4NTg1OjdhZWNiZDcxYmVhYWNlMGE0OWFhZTI3NDM0NmEzMWIyZTAxMjk5MWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed", "committedDate": "2020-03-31T20:41:53Z", "message": "Updated EncryptedClientBuilder"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12d043ef0826af1547f6639d092b8d72d9b7d5a7", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/12d043ef0826af1547f6639d092b8d72d9b7d5a7", "committedDate": "2020-03-31T20:36:44Z", "message": "Updated EncryptedClientBuilder"}, "afterCommit": {"oid": "9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed", "committedDate": "2020-03-31T20:41:53Z", "message": "Updated EncryptedClientBuilder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDkxMTcy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9721#pullrequestreview-385091172", "createdAt": "2020-03-31T20:45:48Z", "commit": {"oid": "9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMDo0NTo0OFrOF-nkHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMDo0NTo0OFrOF-nkHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIwNDI1Mg==", "bodyText": "not particularly picky about this: but since we're now throwing on finding the decryption policy, could we just throw an exception in the for loop when we encounter it? That way we dont need to loop over all the rest of the policies if the first policy was a decryption policy?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9721#discussion_r401204252", "createdAt": "2020-03-31T20:45:48Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob-cryptography/src/main/java/com/azure/storage/blob/specialized/cryptography/EncryptedBlobClientBuilder.java", "diffHunk": "@@ -155,8 +156,28 @@ public EncryptedBlobAsyncClient buildEncryptedBlobAsyncClient() {\n     }\n \n     private HttpPipeline getHttpPipeline() {\n+        // Prefer the pipeline set by the customer.\n         if (httpPipeline != null) {\n-            return  httpPipeline;\n+            List<HttpPipelinePolicy> policies = new ArrayList<>();\n+            // Check that BlobDecryptionPolicy not already present while copying them over to a new policy list.\n+            boolean decryptionPolicyPresent = false;\n+            for (int i = 0; i < httpPipeline.getPolicyCount(); i++) {\n+                HttpPipelinePolicy currPolicy = httpPipeline.getPolicy(i);\n+                decryptionPolicyPresent |= currPolicy instanceof BlobDecryptionPolicy;\n+                policies.add(currPolicy);\n+            }\n+            // If a decryption policy is not already present, add it to the front.\n+            if (!decryptionPolicyPresent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDkxOTU5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9721#pullrequestreview-385091959", "createdAt": "2020-03-31T20:47:01Z", "commit": {"oid": "9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMDo0NzowMlrOF-nmiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMDo0NzowMlrOF-nmiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIwNDg3Mw==", "bodyText": "typo: configured for configured for", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9721#discussion_r401204873", "createdAt": "2020-03-31T20:47:02Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob-cryptography/src/main/java/com/azure/storage/blob/specialized/cryptography/EncryptedBlobClientBuilder.java", "diffHunk": "@@ -473,42 +493,20 @@ public EncryptedBlobClientBuilder retryOptions(RequestRetryOptions retryOptions)\n \n     /**\n      * Sets the {@link HttpPipeline} to use for the service client, and adds a decryption policy if one is not present.\n-     *\n+     * Note that the underlying pipeline should not already be configured for configured for encryption/decryption.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDkyNTIy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9721#pullrequestreview-385092522", "createdAt": "2020-03-31T20:47:53Z", "commit": {"oid": "9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTAxNjgy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9721#pullrequestreview-385101682", "createdAt": "2020-03-31T21:01:26Z", "commit": {"oid": "9a8838b5f1afe17a8fe9837dcd2bf60b2e33d7ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "331acd6ef2f987973132035a0f1adc6bfcf559d6", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/331acd6ef2f987973132035a0f1adc6bfcf559d6", "committedDate": "2020-04-03T21:31:52Z", "message": "Fixed CI failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aecbd71beaace0a49aae274346a31b2e012991b", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7aecbd71beaace0a49aae274346a31b2e012991b", "committedDate": "2020-04-03T21:40:38Z", "message": "Merge branch 'master' into encryptedClientUpdate"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1283, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}