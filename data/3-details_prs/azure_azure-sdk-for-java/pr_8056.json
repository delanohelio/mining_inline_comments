{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyODA2MjA5", "number": 8056, "title": "improves logic to avoid deserializing PartitionKeyInternal from json header in AddressResolver", "bodyText": "current behaviour:\nthe user passed PartitionKey (which has PartitionKeyInternal) is serialized to json and put into DSR header, and later AddressResolver deserializes the header to get PartitionKeyInternal to use for routing logic.\nthis PR:\nDSR will contain the PartitionKeyInternal, so AddressResolver can rely on DSR.partitionKeyInternal and avoid deserializing partitionKeyInternal from header.\nsome optimization in escapeNonAscii to avoid creating StringBuilder if the String is all ASCII", "createdAt": "2020-02-09T08:55:52Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8056", "merged": true, "mergeCommit": {"oid": "d6c3daa3c4be29b59e0b23cea747e807dd99e850"}, "closed": true, "closedAt": "2020-02-10T05:47:24Z", "author": {"login": "moderakh"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCkmtwAH2gAyMzcyODA2MjA5Ojc3MmMzYzgxN2E0ZjY5NzFiMWY2NmIzZmFmZjExNzhiZDgzZTUyOTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCxuTJgH2gAyMzcyODA2MjA5OjE1ODgyMjUyY2RhYzNiMjUzZTk5ZjBhZmM4YzhkNTNhY2YyZGUyNWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "772c3c817a4f6971b1f66b3faff1178bd83e5299", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/772c3c817a4f6971b1f66b3faff1178bd83e5299", "committedDate": "2020-02-09T08:52:48Z", "message": "improves logic to avoid deserializing parition-key-internal after serialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b35494f589220af75faee12a0c4a5ab3284dc1c", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9b35494f589220af75faee12a0c4a5ab3284dc1c", "committedDate": "2020-02-09T09:07:53Z", "message": "fixed test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTk5NjU2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8056#pullrequestreview-355599656", "createdAt": "2020-02-09T11:15:56Z", "commit": {"oid": "9b35494f589220af75faee12a0c4a5ab3284dc1c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMToxNTo1NlrOFnUg6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMToxNTo1NlrOFnUg6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc3NDg5MA==", "bodyText": "What \"foot\" represents ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8056#discussion_r376774890", "createdAt": "2020-02-09T11:15:56Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/AddressResolverTest.java", "diffHunk": "@@ -211,7 +213,9 @@ private void TestCacheRefreshWhileRouteByPartitionKey(\n \n         request.forceNameCacheRefresh = forceNameCacheRefresh;\n         request.forcePartitionKeyRangeRefresh = forceRoutingMapRefresh;\n-        request.getHeaders().put(HttpConstants.HttpHeaders.PARTITION_KEY, new PartitionKey(\"foo\").toString());\n+        PartitionKey pk = new PartitionKey(\"foot\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b35494f589220af75faee12a0c4a5ab3284dc1c"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be17b2f567829ef31c4970be88eaf6256d8662d4", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/be17b2f567829ef31c4970be88eaf6256d8662d4", "committedDate": "2020-02-09T16:34:52Z", "message": "test pk value chnage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjI3MTk4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8056#pullrequestreview-355627198", "createdAt": "2020-02-09T19:20:18Z", "commit": {"oid": "be17b2f567829ef31c4970be88eaf6256d8662d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baad861cf899dc91f68545a0ed6477fa7a073cd7", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/baad861cf899dc91f68545a0ed6477fa7a073cd7", "committedDate": "2020-02-10T00:06:21Z", "message": "set PartitionKeyInternal in DSR everywhere\n\n* set partitionKeyInternal in all places PartitionKey Header is set in DSR\n* added a safe guard in AddressResolver to deserialize PartitionKeyHeader if PartitionKeyInternal\n  is not present in DSR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15882252cdac3b253e99f0afc8c8d53acf2de25e", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/15882252cdac3b253e99f0afc8c8d53acf2de25e", "committedDate": "2020-02-10T00:09:51Z", "message": "minor safe guard for optimization"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2385, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}