{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNjE2NDE3", "number": 16977, "title": "Close client and check for link id when link is stolen", "bodyText": "This PR closes the EventHubAsyncClient after fetching the list of partitions successfully as the client would have opened the connection and wouldn't need to use it after the first call to get the partitions. So, this PR will eagerly close the connection instead of the service closing the connection after idle timeout.\nAlso, the AmqpReceiveLinkProcessor checks the link name to pass on the error when a link is stolen. If the current link is different from the link that was stolen, then downstream doesn't need to be informed of this error.\nFixes #14976", "createdAt": "2020-10-29T22:58:11Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16977", "merged": true, "mergeCommit": {"oid": "07a953cb9b421d18c992538e673a5cac9deb2148"}, "closed": true, "closedAt": "2020-10-30T07:40:18Z", "author": {"login": "srnagar"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXaPsZAH2gAyNTEyNjE2NDE3OjBlNzMzMDJiNzNhZWI2MzkyNjBkNGRmMzU5MmEzMWNlNjA2YmYyNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXhAP_AFqTUyMDQwODY5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e73302b73aeb639260d4df3592a31ce606bf278", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0e73302b73aeb639260d4df3592a31ce606bf278", "committedDate": "2020-10-29T22:52:10Z", "message": "Close client and check for link id when link is stolen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a73212d0a7e0ae3d7b4ebb85b56ec4715ebd7bc", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1a73212d0a7e0ae3d7b4ebb85b56ec4715ebd7bc", "committedDate": "2020-10-29T23:29:48Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNDA3NDkx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16977#pullrequestreview-520407491", "createdAt": "2020-10-30T06:41:14Z", "commit": {"oid": "1a73212d0a7e0ae3d7b4ebb85b56ec4715ebd7bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNjo0MToxNFrOHrC5ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNjo0MToxNFrOHrC5ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg5ODMzOQ==", "bodyText": "In what case a link name is the same as a tracking id?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16977#discussion_r514898339", "createdAt": "2020-10-30T06:41:14Z", "author": {"login": "YijunXieMS"}, "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/implementation/AmqpReceiveLinkProcessor.java", "diffHunk": "@@ -166,6 +169,21 @@ public void onNext(AmqpReceiveLink next) {\n                         }\n                     },\n                     error -> {\n+                        if (error instanceof AmqpException) {\n+                            AmqpException amqpException = (AmqpException) error;\n+                            if (amqpException.getErrorCondition() == AmqpErrorCondition.LINK_STOLEN\n+                                && amqpException.getContext() != null\n+                                && amqpException.getContext() instanceof LinkErrorContext) {\n+                                LinkErrorContext errorContext = (LinkErrorContext) amqpException.getContext();\n+                                if (currentLink != null\n+                                    && !currentLink.getLinkName().equals(errorContext.getTrackingId())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a73212d0a7e0ae3d7b4ebb85b56ec4715ebd7bc"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNDA3NTY2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16977#pullrequestreview-520407566", "createdAt": "2020-10-30T06:41:26Z", "commit": {"oid": "1a73212d0a7e0ae3d7b4ebb85b56ec4715ebd7bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNDA4Njk1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16977#pullrequestreview-520408695", "createdAt": "2020-10-30T06:44:38Z", "commit": {"oid": "1a73212d0a7e0ae3d7b4ebb85b56ec4715ebd7bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1582, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}