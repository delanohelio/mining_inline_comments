{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzMjc1NTUx", "number": 7476, "title": "Fix Upload From File Tests", "bodyText": "This PR is a follow-up to #7403.\nRemoved the use of FluxUtil.writeFile to write the blob download to disk based on the root cause found in PR 7403.", "createdAt": "2020-01-15T18:26:52Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7476", "merged": true, "mergeCommit": {"oid": "ee1925d55283153f871ff778d1389bfec2f18a7c"}, "closed": true, "closedAt": "2020-01-15T19:40:16Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6pzOqAH2gAyMzYzMjc1NTUxOjZmN2M2ZTFiMjlmMjkxOGMxZDliYjRmYzBjODViNjNmNzZjYTc3YzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6qrmFAFqTM0MzQ2Mjg4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f7c6e1b29f2918c1d9bb4fc0c85b63f76ca77c6", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6f7c6e1b29f2918c1d9bb4fc0c85b63f76ca77c6", "committedDate": "2020-01-15T18:24:36Z", "message": "Fixed upload from file using FluxUtil.write in a manner where the underlying ByteBuffer may be reclaimed before written"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDYyODg3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7476#pullrequestreview-343462887", "createdAt": "2020-01-15T19:25:02Z", "commit": {"oid": "6f7c6e1b29f2918c1d9bb4fc0c85b63f76ca77c6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxOToyNTowM1rOFeDs2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxOToyNTowM1rOFeDs2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA2MjIzMg==", "bodyText": "This can be simplified by using try-with-resources pattern:\nnew FileOutputStream(outFile).with { outStream ->\n      outStream.write(FluxUtil.collectBytesInByteBufferStream(blobAsyncClient.download()).block());\n}", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7476#discussion_r367062232", "createdAt": "2020-01-15T19:25:03Z", "author": {"login": "srnagar"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/storage/blob/specialized/BlockBlobAPITest.groovy", "diffHunk": "@@ -651,19 +648,20 @@ class BlockBlobAPITest extends APISpec {\n             .verifyComplete()\n \n         then:\n-        def outFile = file.getPath().toString() + \"result\"\n-        def outChannel = AsynchronousFileChannel.open(Paths.get(outFile), StandardOpenOption.CREATE,\n-            StandardOpenOption.WRITE)\n-        StepVerifier.create(FluxUtil.writeFile(blobAsyncClient.download(), outChannel)).verifyComplete()\n-        outChannel.close()\n+        def outFile = new File(file.getPath().toString() + \"result\")\n+        outFile.createNewFile()\n \n-        compareFiles(file, new File(outFile), 0, fileSize)\n+        def outStream = new FileOutputStream(outFile)\n+        outStream.write(FluxUtil.collectBytesInByteBufferStream(blobAsyncClient.download()).block())\n+        outStream.close()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f7c6e1b29f2918c1d9bb4fc0c85b63f76ca77c6"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 536, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}