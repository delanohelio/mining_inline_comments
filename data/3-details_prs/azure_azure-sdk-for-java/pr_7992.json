{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNjQzMTA0", "number": 7992, "title": "Versioning packages in dev feed", "bodyText": "To enable scenarios which involve installing packages that have dependencies on unreleased packages, we need to do a few things:\nGiven package A that the user wants to install from the dev feed which depends on unreleased package B:\n\nSet package A's dependency version to a version range to depend on B at [1.2.3-beta.1.dev.<date>.,]\nSet B's package version in the local build to a \"zero version\" (e.g. 1.2.3-beta.1.dev.<date>.0), this version will never be published to the dev feed but it will be resolvable by the build of package A in the event that the pipeline that builds B has not yet run and published B to the dev feed\n\nWe accomplish this by:\n\nSetting the dev version for the packages released in the build in the same way that we do today\nUpdate the dependency version of unreleased packages to the range\nSet all other current package versions (and dependency versions where appropriate) to the zero-version\n\nAmong other things this enables the smoke tests to execute properly.", "createdAt": "2020-02-05T23:54:41Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7992", "merged": true, "mergeCommit": {"oid": "f52cf9be73fef46c6bbc21b1293ac97432c4ddac"}, "closed": true, "closedAt": "2020-02-06T19:04:12Z", "author": {"login": "danieljurek"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBZ8DxAH2gAyMzcxNjQzMTA0OmUyNTMyOTQ1NzY2NGVjOTk5MjI5N2MyYjY5ODhlOWE5ZWNhYWE5NzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCDe14AFqTM1NTM0MzYwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e25329457664ec9992297c2b6988e9a9ecaaa971", "author": {"user": {"login": "danieljurek", "name": "Daniel Jurek"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e25329457664ec9992297c2b6988e9a9ecaaa971", "committedDate": "2020-02-05T17:53:14Z", "message": "add --set-dev-zero-version and support for setting unreleased dependency version ranges in set_versions.py"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eaaa534c64c2384ab83b3e02aa5b8df3681b573", "author": {"user": {"login": "danieljurek", "name": "Daniel Jurek"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7eaaa534c64c2384ab83b3e02aa5b8df3681b573", "committedDate": "2020-02-05T23:22:01Z", "message": "add --set-dev-zero-version to archetype-sdk-client.yml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NjI3NzU1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7992#pullrequestreview-354627755", "createdAt": "2020-02-06T17:16:08Z", "commit": {"oid": "7eaaa534c64c2384ab83b3e02aa5b8df3681b573"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzoxNjowOFrOFmjYYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzoxNjowOFrOFmjYYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk2OTg5MQ==", "bodyText": "The shortened argument should be double dash and should also be the acronym for the argument, like the other arguments.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7992#discussion_r375969891", "createdAt": "2020-02-06T17:16:08Z", "author": {"login": "JimSuplizio"}, "path": "eng/versioning/set_versions.py", "diffHunk": "@@ -262,6 +337,7 @@ def main():\n     optional.add_argument('--prep-source-testing', '--pst', action='store_true', help='prep the version file for source testing')\n     optional.add_argument('--increment-version', '--iv', action='store_true', help='increment the version for a given group/artifact')\n     optional.add_argument('--verify-version', '--vv', action='store_true', help='verify the version for a given group/artifact')\n+    optional.add_argument('--set-dev-zero-version', '-z', action='store_true', help='Set a zero dev build version for packages that do not already have dev versions set (should be run after setting dev versions for other packages)')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eaaa534c64c2384ab83b3e02aa5b8df3681b573"}, "originalPosition": 137}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22dd1e03f264c4a602b70bb651682694b6af85e5", "author": {"user": {"login": "danieljurek", "name": "Daniel Jurek"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/22dd1e03f264c4a602b70bb651682694b6af85e5", "committedDate": "2020-02-06T17:21:52Z", "message": "follow the other conventions in set_versions.py"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0Njk2NzY1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7992#pullrequestreview-354696765", "createdAt": "2020-02-06T19:03:41Z", "commit": {"oid": "22dd1e03f264c4a602b70bb651682694b6af85e5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MzQzNjA0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7992#pullrequestreview-355343604", "createdAt": "2020-02-07T18:17:19Z", "commit": {"oid": "22dd1e03f264c4a602b70bb651682694b6af85e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODoxNzoxOVrOFnF0tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODoxNzoxOVrOFnF0tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUzNDE5OA==", "bodyText": "Any reason we did this as a separate step as opposed to as part of the set dev version call?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7992#discussion_r376534198", "createdAt": "2020-02-07T18:17:19Z", "author": {"login": "weshaggard"}, "path": "eng/versioning/set_versions.py", "diffHunk": "@@ -51,12 +51,76 @@\n version_regex_named = re.compile(version_regex_str_with_names_anchored)\n prerelease_regex_named = re.compile(prerelease_version_regex_with_name)\n \n+# Update packages (excluding unreleased dependencies and packages which already\n+# have a dev version set) to use a \"zero dev version\" (e.g. dev.20201225.0).\n+# This ensures that packages built in pipelines who have unreleased dependencies\n+# that are built in other pipelines can successfully fall back to a source build\n+# of the unreleased dependency package in the monorepo if the unreleased\n+# dependency has not been published to the dev feed yet. This makes it so\n+# nightly pipelines do not have to coordinate to publish packages to the dev\n+# feed in dependency order.\n+# This function assumes that the version file has already been updated with dev", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22dd1e03f264c4a602b70bb651682694b6af85e5"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2502, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}