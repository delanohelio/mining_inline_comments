{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNzY4OTM5", "number": 10735, "title": "Add JUnit Based Test Parallelization", "bodyText": "This PR updates the version of JUnit 5 being used and adds a profile which runs JUnit 5 tests in parallel. The parallelization configuration in the client parent POM is full parallelization, in some places where this isn't safe an override configuration has been added to either make it class level parallelization or no parallelization.\nThe parallelization profile is only being triggered during playback test runs as they have a higher degree of concurrency safety as all resources are localized to a single test. A new flag parallel-test-playback has been added which will trigger tests to run concurrently, when running from source this could be activated when running against the live service. Long term the goal would be having all testing running concurrently to better leverage resources but for now it will be limited to playback only.\nNotable improvements due to this change:\n\nKeyVault runs reduced by ~40-50%, 12-16 minutes to 6-9 minutes.\nForm Recognizer runs reduced by ~30-40%, 8-11 minutes to 5-8 minutes.\n\nNOTE: Tests using JUnit 4, Spock, or TestNG won't be affected by this change as this uses JUnit 5 configuration variables.", "createdAt": "2020-05-05T21:44:58Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735", "merged": true, "mergeCommit": {"oid": "de422c6a036d92438d7fb7e883c9dd0bf2358a00"}, "closed": true, "closedAt": "2020-05-13T17:42:52Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcebLR3AH2gAyNDEzNzY4OTM5Ojg4YWVlYWFiZjNjZTAxZTdhY2NkNTMzZTA0MjQ5ODc1MDZiNzQyYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg7_DsAH2gAyNDEzNzY4OTM5OjQ1NGFhZTRjMTVlNzBjY2NmOTc3N2IyMWNhMGI1Nzk5MTE1MWEzNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "88aeeaabf3ce01e7accd533e0424987506b742a4", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/88aeeaabf3ce01e7accd533e0424987506b742a4", "committedDate": "2020-05-05T21:43:34Z", "message": "Update JUnit version and add flags for parallelization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MTg5NDc4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#pullrequestreview-406189478", "createdAt": "2020-05-05T22:07:42Z", "commit": {"oid": "88aeeaabf3ce01e7accd533e0424987506b742a4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f17dc14a91836e935df4ecfacf2ed8ae5210e13b", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f17dc14a91836e935df4ecfacf2ed8ae5210e13b", "committedDate": "2020-05-05T22:38:51Z", "message": "Update other external JUnit versions, fixed azure-core-test issue, added flag in test run"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "569a9fd906c6b88bee188a6d341aed231cd042ac", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/569a9fd906c6b88bee188a6d341aed231cd042ac", "committedDate": "2020-05-05T23:22:08Z", "message": "Update parallelization to be full parallel, updated modules without thread safe tests to use non-parallel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9e7445feb8985d511a9b93eae9de785199b8eae", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c9e7445feb8985d511a9b93eae9de785199b8eae", "committedDate": "2020-05-05T23:41:09Z", "message": "Guard azure-core-test add exports to Java 11+"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjI4OTA5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#pullrequestreview-406228909", "createdAt": "2020-05-05T23:45:31Z", "commit": {"oid": "c9e7445feb8985d511a9b93eae9de785199b8eae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjM1NDQx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#pullrequestreview-406235441", "createdAt": "2020-05-06T00:04:49Z", "commit": {"oid": "c9e7445feb8985d511a9b93eae9de785199b8eae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjM3NTk1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#pullrequestreview-406237595", "createdAt": "2020-05-06T00:11:57Z", "commit": {"oid": "c9e7445feb8985d511a9b93eae9de785199b8eae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66e108e6279a5e99be39bca89f9c363d8eeaf332", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/66e108e6279a5e99be39bca89f9c363d8eeaf332", "committedDate": "2020-05-06T01:01:54Z", "message": "Disable test parallelization in Search, updated JUnit parameter passing to use new XML node"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjUyOTUx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#pullrequestreview-406252951", "createdAt": "2020-05-06T01:10:05Z", "commit": {"oid": "66e108e6279a5e99be39bca89f9c363d8eeaf332"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMToxMDowNlrOGRA_xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMToxMDowNlrOGRA_xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5NTMwMg==", "bodyText": "Does it affect live tests? Why search is disabled?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420495302", "createdAt": "2020-05-06T01:10:06Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search-documents/pom.xml", "diffHunk": "@@ -149,5 +149,28 @@\n         </plugins>\n       </build>\n     </profile>\n+\n+    <profile>\n+      <id>parallel-test-playback</id>\n+      <activation>\n+        <property>\n+          <name>parallel-test-playback</name>\n+        </property>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-surefire-plugin</artifactId>\n+            <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n+            <configuration>\n+              <systemPropertyVariables>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66e108e6279a5e99be39bca89f9c363d8eeaf332"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjU0MjM5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#pullrequestreview-406254239", "createdAt": "2020-05-06T01:15:41Z", "commit": {"oid": "66e108e6279a5e99be39bca89f9c363d8eeaf332"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMToxNTo0MlrOGRBE4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMToxNjo1NVrOGRBGLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5NjYxMQ==", "bodyText": "If you are going to disable parallel execution, please include a comment about why this was deemed necessary.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420496611", "createdAt": "2020-05-06T01:15:42Z", "author": {"login": "JonathanGiles"}, "path": "sdk/eventhubs/azure-messaging-eventhubs/pom.xml", "diffHunk": "@@ -89,4 +89,29 @@\n       <scope>test</scope>\n     </dependency>\n   </dependencies>\n+\n+  <profiles>\n+    <profile>\n+      <id>parallel-test-playback</id>\n+      <activation>\n+        <property>\n+          <name>parallel-test-playback</name>\n+        </property>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-surefire-plugin</artifactId>\n+            <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n+            <configuration>\n+              <systemPropertyVariables>\n+                <junit.jupiter.execution.parallel.enabled>false</junit.jupiter.execution.parallel.enabled>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66e108e6279a5e99be39bca89f9c363d8eeaf332"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5Njg4Mw==", "bodyText": "Same here", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420496883", "createdAt": "2020-05-06T01:16:43Z", "author": {"login": "JonathanGiles"}, "path": "sdk/search/azure-search-documents/pom.xml", "diffHunk": "@@ -149,5 +149,28 @@\n         </plugins>\n       </build>\n     </profile>\n+\n+    <profile>\n+      <id>parallel-test-playback</id>\n+      <activation>\n+        <property>\n+          <name>parallel-test-playback</name>\n+        </property>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-surefire-plugin</artifactId>\n+            <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n+            <configuration>\n+              <systemPropertyVariables>\n+                <junit.jupiter.execution.parallel.enabled>false</junit.jupiter.execution.parallel.enabled>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66e108e6279a5e99be39bca89f9c363d8eeaf332"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5Njk0Mw==", "bodyText": "And here...", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420496943", "createdAt": "2020-05-06T01:16:55Z", "author": {"login": "JonathanGiles"}, "path": "sdk/servicebus/azure-messaging-servicebus/pom.xml", "diffHunk": "@@ -88,4 +88,28 @@\n     </dependency>\n   </dependencies>\n \n+  <profiles>\n+    <profile>\n+      <id>parallel-test-playback</id>\n+      <activation>\n+        <property>\n+          <name>parallel-test-playback</name>\n+        </property>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-surefire-plugin</artifactId>\n+            <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n+            <configuration>\n+              <systemPropertyVariables>\n+                <junit.jupiter.execution.parallel.enabled>false</junit.jupiter.execution.parallel.enabled>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66e108e6279a5e99be39bca89f9c363d8eeaf332"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NjM1OTUw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#pullrequestreview-406635950", "createdAt": "2020-05-06T13:54:09Z", "commit": {"oid": "66e108e6279a5e99be39bca89f9c363d8eeaf332"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33fbd853eb81ce5a56dff1a0cb825ffe07f5b61e", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/33fbd853eb81ce5a56dff1a0cb825ffe07f5b61e", "committedDate": "2020-05-06T16:25:05Z", "message": "Add explanations for disabled parallel test runs in certain modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba86088396c160dbe91fbec5009999ef86994b16", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ba86088396c160dbe91fbec5009999ef86994b16", "committedDate": "2020-05-11T20:13:36Z", "message": "Merge branch 'master' into AzTest_ParallelPlayback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f380ee90e65759b1dd39cb25d9cc4ba9d6314b84", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f380ee90e65759b1dd39cb25d9cc4ba9d6314b84", "committedDate": "2020-05-11T20:31:41Z", "message": "Update new version numbers since last commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f892e83e6e3f0ed45e94449df88dae36c74452c0", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f892e83e6e3f0ed45e94449df88dae36c74452c0", "committedDate": "2020-05-11T21:31:57Z", "message": "Add resource locks for tests mutating System.out"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f87418aaccb526de8078eccd90f726039032b7e5", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f87418aaccb526de8078eccd90f726039032b7e5", "committedDate": "2020-05-11T22:46:34Z", "message": "Merge branch 'master' into AzTest_ParallelPlayback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c65d3db6bfade3f0a7fe39c9a0f1243091db30c", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6c65d3db6bfade3f0a7fe39c9a0f1243091db30c", "committedDate": "2020-05-11T22:47:53Z", "message": "Remove invalid import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NTk0OTg5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#pullrequestreview-409594989", "createdAt": "2020-05-11T23:16:26Z", "commit": {"oid": "6c65d3db6bfade3f0a7fe39c9a0f1243091db30c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMzoxNjoyNlrOGTwnRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMzoxNjoyNlrOGTwnRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM3MjYxNA==", "bodyText": "This was the invalid import, re-order on save happened.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r423372614", "createdAt": "2020-05-11T23:16:26Z", "author": {"login": "alzimmermsft"}, "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/rx/TestSuiteBase.java", "diffHunk": "@@ -3,36 +3,43 @@\n package com.azure.cosmos.rx;\n \n import com.azure.cosmos.BridgeInternal;\n-import com.azure.cosmos.implementation.Resource;\n-import com.azure.cosmos.models.CompositePath;\n-import com.azure.cosmos.models.CompositePathSortOrder;\n import com.azure.cosmos.ConnectionMode;\n import com.azure.cosmos.ConnectionPolicy;\n import com.azure.cosmos.ConsistencyLevel;\n import com.azure.cosmos.CosmosAsyncClient;\n import com.azure.cosmos.CosmosAsyncClientTest;\n import com.azure.cosmos.CosmosAsyncContainer;\n import com.azure.cosmos.CosmosAsyncDatabase;\n-import com.azure.cosmos.models.CosmosAsyncDatabaseResponse;\n-import com.azure.cosmos.models.CosmosAsyncItemResponse;\n import com.azure.cosmos.CosmosAsyncUser;\n import com.azure.cosmos.CosmosBridgeInternal;\n import com.azure.cosmos.CosmosClient;\n import com.azure.cosmos.CosmosClientBuilder;\n import com.azure.cosmos.CosmosClientException;\n-import com.azure.cosmos.models.CosmosContainerProperties;\n-import com.azure.cosmos.models.CosmosContainerRequestOptions;\n-import com.azure.cosmos.models.JsonSerializable;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c65d3db6bfade3f0a7fe39c9a0f1243091db30c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "454aae4c15e70cccf9777b21ca0b57991151a341", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/454aae4c15e70cccf9777b21ca0b57991151a341", "committedDate": "2020-05-13T17:04:56Z", "message": "Merged in master"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4562, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}