{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NjQ1MDY0", "number": 12961, "title": "Partner release pipeline ", "bodyText": "This PR introduces a new partner release pipeline for Maven packages (can handle both regular Java packages, and Android packages). It required a few refinements to templates and scripts. At the moment this PR has publishing disabled to allow for risk free testing (but staging is still performed).\nWould like to get a review to highlight any concerns before I keep moving forward.", "createdAt": "2020-07-09T06:23:55Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961", "merged": true, "mergeCommit": {"oid": "72292a0101cf93bf64e9cad9bdda85ee74ca9ddd"}, "closed": true, "closedAt": "2020-07-23T02:47:51Z", "author": {"login": "mitchdenny"}, "timelineItems": {"totalCount": 36, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyyy71gH2gAyNDQ2NjQ1MDY0OjU0MGZlOTgyZjVkYzFjZWFkM2EwOTU0ZTk1OWY5NGMzZTJmNmU2YmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3mQxrAH2gAyNDQ2NjQ1MDY0OjQ4ZmU1OTFkMDUwY2U4MmI4MmJmMjAzZmZlMmUxMDY0NjA2MjcwNjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "540fe982f5dc1cead3a0954e959f94c3e2f6e6ba", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/540fe982f5dc1cead3a0954e959f94c3e2f6e6ba", "committedDate": "2020-07-08T04:33:11Z", "message": "Empty pipeline definition for partner release pipeline."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fd727d57a7ce89e9145dba8a6566f484b15c417", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8fd727d57a7ce89e9145dba8a6566f484b15c417", "committedDate": "2020-07-08T05:18:46Z", "message": "Seeing if code signing works."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81b951a3175848240e52e2211112589a8f513a87", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/81b951a3175848240e52e2211112589a8f513a87", "committedDate": "2020-07-08T05:21:41Z", "message": "Tweak path."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6d9f8f1d53ae088c4332132a338ee5c4b34d961", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f6d9f8f1d53ae088c4332132a338ee5c4b34d961", "committedDate": "2020-07-08T05:24:27Z", "message": "Tweak to absolute path."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fccba7c34142b8d327b4734b64cd559a7f158c35", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fccba7c34142b8d327b4734b64cd559a7f158c35", "committedDate": "2020-07-08T06:11:19Z", "message": "Setting up for test run."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba044dc1597fefb1464a7e19ea9b70b172bfeacc", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ba044dc1597fefb1464a7e19ea9b70b172bfeacc", "committedDate": "2020-07-08T06:18:40Z", "message": "Removing hardcoded default that breaks filter logic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5587170453d45778915ba7821215ff6071362c99", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5587170453d45778915ba7821215ff6071362c99", "committedDate": "2020-07-08T06:25:14Z", "message": "Add partner to list of options."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "152853f84b9017ebd02434094195b865781ecea4", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/152853f84b9017ebd02434094195b865781ecea4", "committedDate": "2020-07-08T06:44:18Z", "message": "Fix issue with using collection versus item in collection."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cf203dae783f0a276cb57e9689bf54bb2a66de9", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5cf203dae783f0a276cb57e9689bf54bb2a66de9", "committedDate": "2020-07-08T07:02:04Z", "message": "Added TODO comment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f9415066ed0c64ba7f89a296d84102cd2901113", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f9415066ed0c64ba7f89a296d84102cd2901113", "committedDate": "2020-07-09T02:30:06Z", "message": "Try stage parameters."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c396878b11b718afcaa3c049c1691797e0d3b04", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7c396878b11b718afcaa3c049c1691797e0d3b04", "committedDate": "2020-07-09T03:24:06Z", "message": "Add quotes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87b1d74f9a27558d9e7fdcbf482a9317643de701", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/87b1d74f9a27558d9e7fdcbf482a9317643de701", "committedDate": "2020-07-09T03:32:19Z", "message": "Fix quotes.:"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "911ca0d6dc99d5b6d666a22463b5085309696b8d", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/911ca0d6dc99d5b6d666a22463b5085309696b8d", "committedDate": "2020-07-09T05:21:00Z", "message": "Add output for stage only value, add upload."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62af8df4ff99159863114540336d1236a3c5dc4f", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/62af8df4ff99159863114540336d1236a3c5dc4f", "committedDate": "2020-07-09T05:52:31Z", "message": "Try adding timeline records for better visibility."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a81076414c3018241c29fe2b16e62532c05bc569", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a81076414c3018241c29fe2b16e62532c05bc569", "committedDate": "2020-07-09T06:04:46Z", "message": "Remove log detail."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "committedDate": "2020-07-09T06:21:59Z", "message": "Throw when no packages to publish.:"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzIwMTcx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-445320171", "createdAt": "2020-07-09T06:25:05Z", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyNTowNVrOGvDSMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyNTowNVrOGvDSMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MDA2Nw==", "bodyText": "These can be empty.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451990067", "createdAt": "2020-07-09T06:25:05Z", "author": {"login": "mitchdenny"}, "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -1,10 +1,11 @@\n parameters:\n   ArtifactDirectory: not-specified\n   RepositoryUrl: not-specified\n-  GroupID: not-specified\n-  ArtifactID: not-specified\n+  GroupID:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzIwNzIw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-445320720", "createdAt": "2020-07-09T06:26:18Z", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyNjoxOFrOGvDUDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyNjoxOFrOGvDUDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MDU0MA==", "bodyText": "Plumbed through a StageOnly property which effectively replaces ShouldPublish and AutoPromote from the old release pipelines. Now StageOnly simply controls whether we release the package.\nThought: Should we consider adding a separate job for the actual publish script which requires approval?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451990540", "createdAt": "2020-07-09T06:26:18Z", "author": {"login": "mitchdenny"}, "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -1,10 +1,11 @@\n parameters:\n   ArtifactDirectory: not-specified\n   RepositoryUrl: not-specified\n-  GroupID: not-specified\n-  ArtifactID: not-specified\n+  GroupID:\n+  ArtifactID:\n   BuildToolsPath: $(Pipeline.Workspace)/azure-sdk-build-tools\n   JavaRepoRoot: $(Pipeline.Workspace)/azure-sdk-for-java\n+  StageOnly: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzIxMzYw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-445321360", "createdAt": "2020-07-09T06:27:48Z", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyNzo0OFrOGvDWMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyNzo0OFrOGvDWMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTA4OQ==", "bodyText": "Not sure about this. When used in our unified pipelines we pass along ArtifactId and GroupId filters, but that isn't necessarily in the partner release pipeline because we publish whatever is in the directory. This means that there are two quite distinct invocations of the template.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451991089", "createdAt": "2020-07-09T06:27:48Z", "author": {"login": "mitchdenny"}, "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -74,3 +75,19 @@ steps:\n           -RepositoryPassword $(azuresdk-sonatype-password)\n           -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe\n           -InformationAction Continue\n+\n+  - ${{if eq(parameters.Target, 'MavenCentralPartner')}}:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzIxNTA4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-445321508", "createdAt": "2020-07-09T06:28:08Z", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyODowOFrOGvDWqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyODowOFrOGvDWqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTIxMA==", "bodyText": "Making it so that no packages == an error.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451991210", "createdAt": "2020-07-09T06:28:08Z", "author": {"login": "mitchdenny"}, "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -187,13 +187,18 @@ Write-Information \"Repository Password is: [redacted]\"\n Write-Information \"GPG Executable Path is: $GPGExecutablePath\"\n Write-Information \"Group ID Filter is: $GroupIDFilter\"\n Write-Information \"Artifact ID Filter is: $ArtifactIDFilter\"\n+Write-Information \"Stage Only is: $StageOnly\"\n \n Write-Information \"Getting filtered package details.\"\n $packageDetails = Get-FilteredMavenPackageDetails -ArtifactDirectory $ArtifactDirectory -GroupIDFilter $GroupIDFilter -ArtifactIDFilter $ArtifactIDFilter\n \n Write-Host \"Found $($packageDetails.Length) packages to publish:\"\n $packageDetails | % { Write-Host $_.FullyQualifiedName }\n \n+if ($packageDetails.Length -eq 0) {\n+  throw \"Aborting, no packages to publish.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzIxOTY2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-445321966", "createdAt": "2020-07-09T06:29:09Z", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyOTowOVrOGvDYCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyOTowOVrOGvDYCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTU2MA==", "bodyText": "This bug always existed, but we didn't catch it because PowerShell coerces a single element array into the same thing as an instance of the array element. Several moments of head scratching occurred when I first saw this bug in action.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451991560", "createdAt": "2020-07-09T06:29:09Z", "author": {"login": "mitchdenny"}, "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -293,7 +298,7 @@ foreach ($packageDetail in $packageDetails) {\n     mvn org.sonatype.plugins:nexus-staging-maven-plugin:deploy-staged-repository \"--batch-mode\" \"-DnexusUrl=https://oss.sonatype.org\" \"$repositoryDirectoryOption\" \"$stagingProfileIdOption\" \"$stagingDescriptionOption\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n \n     Write-Information \"Reading staging properties.\"\n-    $stagedRepositoryProperties = ConvertFrom-StringData (Get-Content \"$localRepositoryDirectory\\$($packageDetails.SonaTypeProfileID).properties\" -Raw)\n+    $stagedRepositoryProperties = ConvertFrom-StringData (Get-Content \"$localRepositoryDirectory\\$($packageDetail.SonaTypeProfileID).properties\" -Raw)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzIyMTI4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-445322128", "createdAt": "2020-07-09T06:29:32Z", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyOTozMlrOGvDYhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyOTozMlrOGvDYhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTY4Ng==", "bodyText": "This will be commented back in once we are 100% happy with everything.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451991686", "createdAt": "2020-07-09T06:29:32Z", "author": {"login": "mitchdenny"}, "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -307,11 +312,12 @@ foreach ($packageDetail in $packageDetails) {\n     else {\n       Write-Information \"Releasing staging repostiory $stagedRepositoryId\"\n       Write-Information \"mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release `\"-DstagingRepositoryId=$stagedRepositoryId`\" `\"-DnexusUrl=https://oss.sonatype.org`\" `\"-DrepositoryId=target-repo`\" `\"-DserverId=target-repo`\" `\"-Drepo.username=$RepositoryUsername`\" `\"-Drepo.password=`\"`\"$RepositoryPassword`\"`\"`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n-      mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release \"-DstagingRepositoryId=$stagedRepositoryId\" \"-DnexusUrl=https://oss.sonatype.org\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n+      # TODO: Remove when tested has been completed end-to-end. This final step simply\n+      #       closes the staging repo and makes it visible in Maven Central.\n+      #mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release \"-DstagingRepositoryId=$stagedRepositoryId\" \"-DnexusUrl=https://oss.sonatype.org\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMDAzMzg0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-452003384", "createdAt": "2020-07-20T22:30:07Z", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjozMDowN1rOG0hfWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjozMDowN1rOG0hfWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNzgzMg==", "bodyText": "Lets use windows-2019 here. I'd like us to be in control of when we move the image forward so we can at least test it.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457727832", "createdAt": "2020-07-20T22:30:07Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/partner-release.yml", "diffHunk": "@@ -0,0 +1,46 @@\n+trigger: none\n+pr: none\n+\n+resources:\n+  repositories:\n+    - repository: azure-sdk-build-tools\n+      type: git\n+      name: internal/azure-sdk-build-tools\n+      ref: refs/tags/azure-sdk-build-tools_20200618.4\n+\n+variables:\n+  BuildToolScripts: $(Pipeline.Workspace)/azure-sdk-build-tools/scripts\n+  Artifacts: $(Pipeline.Workspace)/artifacts\n+\n+pool:\n+  vmImage: 'windows-latest'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMDA1Mzkw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-452005390", "createdAt": "2020-07-20T22:35:00Z", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjozNTowMFrOG0hmfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjozNTowMFrOG0hmfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyOTY2Mw==", "bodyText": "Why is the parse needed?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457729663", "createdAt": "2020-07-20T22:35:00Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -74,3 +75,19 @@ steps:\n           -RepositoryPassword $(azuresdk-sonatype-password)\n           -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe\n           -InformationAction Continue\n+\n+  - ${{if eq(parameters.Target, 'MavenCentralPartner')}}:\n+    - task: PowerShell@2\n+      displayName: 'Publish to Maven Central'\n+      inputs:\n+        pwsh: true\n+        workingDirectory: $(Agent.BuildDirectory)\n+        filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1\n+        arguments: >\n+          -ArtifactDirectory ${{ parameters.ArtifactDirectory }}\n+          -RepositoryUrl https://oss.sonatype.org/service/local/staging/deploy/maven2/\n+          -RepositoryUsername azuresdk\n+          -RepositoryPassword $(azuresdk-sonatype-password)\n+          -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe\n+          -InformationAction Continue\n+          -StageOnly:$([bool]::Parse('$(StageOnly)'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMDEwOTg4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-452010988", "createdAt": "2020-07-20T22:48:26Z", "commit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjo0ODoyNlrOG0h5ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjo0ODoyNlrOG0h5ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzczNDU1OA==", "bodyText": "What about snapshot support? I know a number of partners rely on publishing those.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457734558", "createdAt": "2020-07-20T22:48:26Z", "author": {"login": "weshaggard"}, "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -187,13 +187,18 @@ Write-Information \"Repository Password is: [redacted]\"\n Write-Information \"GPG Executable Path is: $GPGExecutablePath\"\n Write-Information \"Group ID Filter is: $GroupIDFilter\"\n Write-Information \"Artifact ID Filter is: $ArtifactIDFilter\"\n+Write-Information \"Stage Only is: $StageOnly\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a607700df600a51ad388278e9ac401771759d553", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a607700df600a51ad388278e9ac401771759d553", "committedDate": "2020-07-21T00:19:02Z", "message": "Pin windows version for pipeline."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b753a7d30d6ea611803e881766ba05af06911202", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b753a7d30d6ea611803e881766ba05af06911202", "committedDate": "2020-07-21T00:20:15Z", "message": "Simplify StageOnly expression."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e851794791d1ff0d17a8ad5312227ffa77ce46dd", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e851794791d1ff0d17a8ad5312227ffa77ce46dd", "committedDate": "2020-07-21T00:36:27Z", "message": "Switch invocation based on template parameters."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "213d1393a06168e17447d53266fc82e35f2a78dc", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/213d1393a06168e17447d53266fc82e35f2a78dc", "committedDate": "2020-07-21T00:49:48Z", "message": "Switch to ne(...,...) expression."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODkyNDE1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-452892415", "createdAt": "2020-07-21T23:15:17Z", "commit": {"oid": "213d1393a06168e17447d53266fc82e35f2a78dc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoxNToxN1rOG1NFsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoxNToxN1rOG1NFsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MjE2Mw==", "bodyText": "As best I can tell no harm comes if you pass empty values for these into your script so why not just always call these? It also won't hurt to always pass StageOnly parameter. Unless I missed something I think all the other arguments are the same.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r458442163", "createdAt": "2020-07-21T23:15:17Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -59,18 +60,40 @@ steps:\n           -InformationAction Continue\n \n   - ${{if eq(parameters.Target, 'MavenCentral')}}:\n-    - task: PowerShell@2\n-      displayName: 'Publish to Maven Central'\n-      inputs:\n-        pwsh: true\n-        workingDirectory: $(Agent.BuildDirectory)\n-        filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1\n-        arguments: >\n-          -ArtifactDirectory ${{ parameters.ArtifactDirectory }}\n-          -GroupIDFilter ${{ parameters.GroupID }}\n-          -ArtifactIDFilter ${{ parameters.ArtifactID }}\n-          -RepositoryUrl https://oss.sonatype.org/service/local/staging/deploy/maven2/\n-          -RepositoryUsername azuresdk\n-          -RepositoryPassword $(azuresdk-sonatype-password)\n-          -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe\n-          -InformationAction Continue\n+\n+    # Invoke this way if we are publishing a specific artifact (usually used from\n+    # within universal pipelines).\n+    - ${{if and(ne(parameters.GroupID, ''),ne(parameters.ArtifactID, ''))}}:\n+      - task: PowerShell@2\n+        displayName: 'Publish to Maven Central'\n+        inputs:\n+          pwsh: true\n+          workingDirectory: $(Agent.BuildDirectory)\n+          filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1\n+          arguments: >\n+            -ArtifactDirectory ${{ parameters.ArtifactDirectory }}\n+            -GroupIDFilter ${{ parameters.GroupID }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "213d1393a06168e17447d53266fc82e35f2a78dc"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c99fece044b4a87ef62317f2e509a66e942b9b73", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c99fece044b4a87ef62317f2e509a66e942b9b73", "committedDate": "2020-07-21T23:39:02Z", "message": "Collapse invocations further."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b062472c0ee7e5dc47420114d3c4072f6eaad10b", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b062472c0ee7e5dc47420114d3c4072f6eaad10b", "committedDate": "2020-07-21T23:49:56Z", "message": "Allow null values."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTA1MjU0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-452905254", "createdAt": "2020-07-21T23:52:27Z", "commit": {"oid": "b062472c0ee7e5dc47420114d3c4072f6eaad10b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzo1MjoyN1rOG1Nzbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzo1MjoyN1rOG1Nzbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ1Mzg3MQ==", "bodyText": "You may need to put quotes around  -GroupIDFilter \"${{ parameters.GroupID }}\" in order for PS to accept the empty string.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r458453871", "createdAt": "2020-07-21T23:52:27Z", "author": {"login": "weshaggard"}, "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -73,4 +74,5 @@ steps:\n           -RepositoryUsername azuresdk", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b062472c0ee7e5dc47420114d3c4072f6eaad10b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9418e7c4062957ed38c5d2e9483faadb46c366a", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9418e7c4062957ed38c5d2e9483faadb46c366a", "committedDate": "2020-07-22T00:04:35Z", "message": "Pass in empty string."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDI4Mjc5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#pullrequestreview-453428279", "createdAt": "2020-07-22T15:24:15Z", "commit": {"oid": "b9418e7c4062957ed38c5d2e9483faadb46c366a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48fe591d050ce82b82bf203ffe2e106460627061", "author": {"user": {"login": "mitchdenny", "name": "Mitch Denny"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/48fe591d050ce82b82bf203ffe2e106460627061", "committedDate": "2020-07-23T02:46:38Z", "message": "Uncomment the rc-release goal. Phasers are no longer set to stun."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2630, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}