{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2OTkwNTY1", "number": 17279, "title": "Fixed resource address in CosmosException. ", "bodyText": "Fixed resourceAddress in CosmosException\nAdded new API to expose regions contacted on CosmosDiagnostics\nTODO: @simplynaveen20 has a fix for regionsContacted API in ClientTelemetry PR, once that is in, it will fill up the regionsContacted for Gateway mode as well. Skipped that fix in this PR to avoid future conflicts\n\nSample resourceAddress and regionsContacted diagnostics:\nResourceAddress sample DIRECT mode:\nException is : NotFoundException{userAgent=azsdk-java-cosmos/4.9.0-beta.1 MacOSX/10.15.7 JRE/11.0.6, error={\"Errors\":[\"Resource Not Found. Learn more: https://aka.ms/cosmosdb-tsg-not-found\"]}, resourceAddress='rntbd://cdb-ms-prod-westus2-fd31.documents.azure.com:14353/apps/e1145062-6507-492f-845f-f448225c36f6/services/55789df2-d46c-4435-9bc8-1d2ff3266202/partitions/8dedad13-a762-4b1d-b782-a38817f67371/replicas/132491704112230548s/, statusCode=404, message=[\"Resource Not Found. Learn more: https://aka.ms/cosmosdb-tsg-not-found\"], ...\nResourceAddress sample GATEWAY mode:\nresourceAddress='https://paged-flux-test-account-westus2.documents.azure.com:443/dbs/RxJava.SDKTest.SharedDatabase_20201110T150115_uRJ/colls/dbcd0b24-c2e4-41ed-b01e-2a0534ff3461/docs/cac7dadd-0f6f-4d7a-9490-c9494bf20019, statusCode=404, message=Entity with the specified id does not exist in the system. More info: https://aka.ms/cosmosdb-tsg-not-found, ...\nRegionsContacted sample:\n2020-11-06 13:32:32,013       [TestNG-method=directDiagnostics-1] INFO  TestSuiteBase - Regions contacted: [https://paged-flux-test-account-westus2.documents.azure.com:443/]\n\nCloses #17279\nCloses #16819", "createdAt": "2020-11-06T21:34:12Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17279", "merged": true, "mergeCommit": {"oid": "7def12024805c602f3bca575a73ae7a2ebcbd134"}, "closed": true, "closedAt": "2020-11-17T17:33:15Z", "author": {"login": "kushagraThapar"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ91d0gH2gAyNTE2OTkwNTY1OjBkMjI0MTE3YTQ5YTlmZjJkNjBiMDUyZjA4M2Q1ZGMxN2ZiYjJkN2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdblyuagH2gAyNTE2OTkwNTY1OjkzODEwNjI1MjY3ZDQ4OTllNmVkNmVlODdkMGU2OWExYmEyNzQ3OTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d224117a49a9ff2d60b052f083d5dc17fbb2d7f", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d224117a49a9ff2d60b052f083d5dc17fbb2d7f", "committedDate": "2020-11-06T21:27:57Z", "message": "Fixed resource address in CosmosException. Added new API to expose regions contacted on CosmosDiagnostics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NzIxMjE2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17279#pullrequestreview-526721216", "createdAt": "2020-11-09T22:55:44Z", "commit": {"oid": "0d224117a49a9ff2d60b052f083d5dc17fbb2d7f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMjo1NTo0NFrOHwE5ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMjo1NTo0NFrOHwE5ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE3MzkyNA==", "bodyText": "why we remove requestUri?\nAnd I think currently we are mixing using resourceAddress and requestUri:\nfor example in RxGatewayStoreModel, we are passing resourceId to resourceAddress of CosmosException\nBut in RntbdRequestManager, we are passing physical address to resourceAddress of CosmosException", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17279#discussion_r520173924", "createdAt": "2020-11-09T22:55:44Z", "author": {"login": "xinlian12"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosException.java", "diffHunk": "@@ -284,7 +284,7 @@ CosmosException setDiagnostics(CosmosDiagnostics cosmosDiagnostics) {\n     @Override\n     public String toString() {\n         return getClass().getSimpleName() + \"{\" + \"userAgent=\" + USER_AGENT + \", error=\" + cosmosError + \", resourceAddress='\"\n-                   + resourceAddress  +  \"', requestUri='\" + (requestUri != null ? requestUri.getURIAsString() : null) +  \"', statusCode=\" + statusCode + \", message=\" + getMessage()\n+                   + resourceAddress  +  \", statusCode=\" + statusCode + \", message=\" + getMessage()\n                    + \", causeInfo=\" + causeInfo() + \", responseHeaders=\" + responseHeaders + \", requestHeaders=\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d224117a49a9ff2d60b052f083d5dc17fbb2d7f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjY1MjE4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17279#pullrequestreview-527665218", "createdAt": "2020-11-10T22:38:49Z", "commit": {"oid": "0d224117a49a9ff2d60b052f083d5dc17fbb2d7f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjY3OTYw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17279#pullrequestreview-527667960", "createdAt": "2020-11-10T22:43:49Z", "commit": {"oid": "0d224117a49a9ff2d60b052f083d5dc17fbb2d7f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjo0Mzo1MFrOHwyhsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjo0Mzo1MFrOHwyhsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkyMTUyMg==", "bodyText": "what about the direct mode? isn't that set in the direct mode? @kushagraThapar  could you please check.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17279#discussion_r520921522", "createdAt": "2020-11-10T22:43:50Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosException.java", "diffHunk": "@@ -284,7 +284,7 @@ CosmosException setDiagnostics(CosmosDiagnostics cosmosDiagnostics) {\n     @Override\n     public String toString() {\n         return getClass().getSimpleName() + \"{\" + \"userAgent=\" + USER_AGENT + \", error=\" + cosmosError + \", resourceAddress='\"\n-                   + resourceAddress  +  \"', requestUri='\" + (requestUri != null ? requestUri.getURIAsString() : null) +  \"', statusCode=\" + statusCode + \", message=\" + getMessage()\n+                   + resourceAddress  +  \", statusCode=\" + statusCode + \", message=\" + getMessage()\n                    + \", causeInfo=\" + causeInfo() + \", responseHeaders=\" + responseHeaders + \", requestHeaders=\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE3MzkyNA=="}, "originalCommit": {"oid": "0d224117a49a9ff2d60b052f083d5dc17fbb2d7f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23ea640141e109e6b2430dfe154169c2aa453a9c", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/23ea640141e109e6b2430dfe154169c2aa453a9c", "committedDate": "2020-11-10T23:07:25Z", "message": "Fixed resource address in GATEWAY mode to have full physical address"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjkwMTA5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17279#pullrequestreview-527690109", "createdAt": "2020-11-10T23:28:48Z", "commit": {"oid": "23ea640141e109e6b2430dfe154169c2aa453a9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "caf53fb36894e41eaf4e2cf76b90b7185a834e60", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/caf53fb36894e41eaf4e2cf76b90b7185a834e60", "committedDate": "2020-11-11T00:23:56Z", "message": "Setting physical resource address in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93810625267d4899e6ed6ee87d0e69a1ba274791", "author": {"user": {"login": "kushagraThapar", "name": "Kushagra Thapar"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/93810625267d4899e6ed6ee87d0e69a1ba274791", "committedDate": "2020-11-11T22:35:05Z", "message": "Merge branch 'master' into fix_resource_address_diagnostics_string"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 140, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}