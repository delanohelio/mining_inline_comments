{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2ODE0MDc5", "number": 8975, "title": "Replace HttpBin Usage with WireMock", "bodyText": "Fixes #8096\nThis PR ports RestProxyTests from using the HttpBin service to using mocked responses via WireMock. This change reduces the likelihood that a test is flaky due to HttpBin service issues or flaky networking as this isn't the purpose of the tests.\nAlso fixes #3255 by removing RestProxyStressTests and MockServer which allows for the Jetty dependencies to be removed from Azure Core's testing scope.", "createdAt": "2020-03-11T17:06:39Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8975", "merged": true, "mergeCommit": {"oid": "db18f6b33c2a3f7d1a057575cc8835419b146eee"}, "closed": true, "closedAt": "2020-03-13T22:37:10Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK1M2qAH2gAyMzg2ODE0MDc5OjMwNGExNTk4YWJkYThiNWZmNjU1MmE4MTJmZGU4OTU5MjcwMmMzZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNX4BHAFqTM3NDE0ODQwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "304a1598abda8b5ff6552a812fde89592702c3e5", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/304a1598abda8b5ff6552a812fde89592702c3e5", "committedDate": "2020-03-06T00:44:20Z", "message": "Cleanup RestProxyTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16ef0d1209452c6310efdcc1800d942d5af60b65", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/16ef0d1209452c6310efdcc1800d942d5af60b65", "committedDate": "2020-03-07T00:25:22Z", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "278b2d98599ae1aa20b22ea94b34dd5a670f69b3", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/278b2d98599ae1aa20b22ea94b34dd5a670f69b3", "committedDate": "2020-03-10T17:47:03Z", "message": "Prototype of WireMock server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1b8d75150c41709540785fa13f569be8aabc944", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c1b8d75150c41709540785fa13f569be8aabc944", "committedDate": "2020-03-10T20:06:24Z", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d336cd6949198378eab4654bb03df67352be0e5", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d336cd6949198378eab4654bb03df67352be0e5", "committedDate": "2020-03-10T22:34:11Z", "message": "Prototype with ResponseDefinitionTransformer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "599fda57fad60c7c29f21019f7326aad247699d1", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/599fda57fad60c7c29f21019f7326aad247699d1", "committedDate": "2020-03-10T22:45:01Z", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85c9e7be1fd6643d9f43866d626a89be457b15f5", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/85c9e7be1fd6643d9f43866d626a89be457b15f5", "committedDate": "2020-03-11T01:48:40Z", "message": "Stubbed and fixed most HttpBin tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "003556dd76bdc356638b45fce7d7a0260189edb5", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/003556dd76bdc356638b45fce7d7a0260189edb5", "committedDate": "2020-03-11T16:52:29Z", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f0dc93bdf4e928087e4db477bcfe84f0fa00f6b", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8f0dc93bdf4e928087e4db477bcfe84f0fa00f6b", "committedDate": "2020-03-11T18:01:44Z", "message": "Removed RestProxyStressTests, MockServer, and Jetty dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d1c2fb343eb4c27876c9f39c82f024007ba9326", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d1c2fb343eb4c27876c9f39c82f024007ba9326", "committedDate": "2020-03-11T20:58:11Z", "message": "Fixing additional tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8292a893e478ce289f2d9b54fb4bbedb63dea297", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8292a893e478ce289f2d9b54fb4bbedb63dea297", "committedDate": "2020-03-11T21:59:21Z", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bc56ab8a7c87dd73c0d12a7de34bb08665ca8b9", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2bc56ab8a7c87dd73c0d12a7de34bb08665ca8b9", "committedDate": "2020-03-11T22:04:40Z", "message": "Change server startup and shutdown guards"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c942cff0646a2587e099eb81f48735e9cd878210", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c942cff0646a2587e099eb81f48735e9cd878210", "committedDate": "2020-03-11T23:04:10Z", "message": "Disambiguate test from WireMock stub"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1762ff5bd1a522e97448b69bcc842fdf4da793cf", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1762ff5bd1a522e97448b69bcc842fdf4da793cf", "committedDate": "2020-03-11T23:42:05Z", "message": "Additional test fixes for Linux"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "826424305a0f4608de1e4298f2fea14191720288", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/826424305a0f4608de1e4298f2fea14191720288", "committedDate": "2020-03-12T00:10:01Z", "message": "Additional mocking changes in attempt to resolve Linux deadlocking issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d70236f7dc078ab61735ecfbc5cc079e6e061ad", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3d70236f7dc078ab61735ecfbc5cc079e6e061ad", "committedDate": "2020-03-12T16:28:35Z", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c8709462f0d6a0409d1418c71d7f5e572812cb1", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4c8709462f0d6a0409d1418c71d7f5e572812cb1", "committedDate": "2020-03-12T17:43:32Z", "message": "Use WireMock dynamic port, cleaned up transformer code, added API to get port to RestProxyTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f28bc783078a23883682725f55d983a7009ffa9", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f28bc783078a23883682725f55d983a7009ffa9", "committedDate": "2020-03-12T18:53:55Z", "message": "Fixed mock RestProxyTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0974c13b1a386a780872e2a7e702a3a7b920cbd", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a0974c13b1a386a780872e2a7e702a3a7b920cbd", "committedDate": "2020-03-12T22:45:11Z", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0872aa16eeda3cab3651482ac3a972252bdaecc7", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0872aa16eeda3cab3651482ac3a972252bdaecc7", "committedDate": "2020-03-12T22:46:42Z", "message": "Fixed issue where Linux would deadlock on a test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MTQ4NDAz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8975#pullrequestreview-374148403", "createdAt": "2020-03-13T09:19:28Z", "commit": {"oid": "0872aa16eeda3cab3651482ac3a972252bdaecc7"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoxMjowN1rOF2U2LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoxMzoyMFrOF2U3gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwODk3Mw==", "bodyText": "If you have the test-jar, do you need the one without the test-jar too?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8975#discussion_r392508973", "createdAt": "2020-03-13T22:12:07Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-http-netty/pom.xml", "diffHunk": "@@ -116,7 +116,14 @@\n     <dependency>\n       <groupId>com.azure</groupId>\n       <artifactId>azure-core-test</artifactId>\n-      <version>1.2.0-beta.1</version>  <!-- {x-version-update;com.azure:azure-core-test;current} -->\n+      <version>1.2.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-test;current} -->\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.azure</groupId>\n+      <artifactId>azure-core-test</artifactId>\n+      <version>1.2.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-test;current} -->\n+      <type>test-jar</type>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0872aa16eeda3cab3651482ac3a972252bdaecc7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwOTMxNQ==", "bodyText": "This is the same code in RestProxyWithHttpProxyNettyTests. Can you check if this can be de-duplicated?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8975#discussion_r392509315", "createdAt": "2020-03-13T22:13:20Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-http-netty/src/test/java/com/azure/core/http/netty/implementation/RestProxyWithNettyTests.java", "diffHunk": "@@ -4,12 +4,36 @@\n package com.azure.core.http.netty.implementation;\n \n import com.azure.core.http.HttpClient;\n+import com.azure.core.http.netty.NettyAsyncHttpClientBuilder;\n+import com.azure.core.test.RestProxyTestsWireMockServer;\n import com.azure.core.test.implementation.RestProxyTests;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n \n public class RestProxyWithNettyTests extends RestProxyTests {\n+    private static WireMockServer server;\n+\n+    @BeforeAll\n+    public static void getWireMockServer() {\n+        server = RestProxyTestsWireMockServer.getRestProxyTestsServer();\n+        server.start();\n+    }\n+\n+    @AfterAll\n+    public static void shutdownWireMockServer() {\n+        if (server != null) {\n+            server.shutdown();\n+        }\n+    }\n+\n+    @Override\n+    protected int getWireMockPort() {\n+        return server.port();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0872aa16eeda3cab3651482ac3a972252bdaecc7"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 751, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}