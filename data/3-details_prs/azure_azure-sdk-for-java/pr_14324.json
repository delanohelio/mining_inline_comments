{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMzI0MjUx", "number": 14324, "title": "[TA] remove throwing the empty id exception manually", "bodyText": "fixes: #10962\nRemove raising HttpResponseException when there is an error document id value = Empty string.\nAnd bring back the tooManyDocument tests.", "createdAt": "2020-08-21T01:33:51Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324", "merged": true, "mergeCommit": {"oid": "45d03898e3fb81f3dd9dc3f94848ecef07209b5e"}, "closed": true, "closedAt": "2020-08-26T18:32:22Z", "author": {"login": "mssfang"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdA6ltVgH2gAyNDcxMzI0MjUxOjNmOTM5YjYzMDJlN2NiNWRlZGY5MWQ5NzA4MmMwNzJkMTk4NDQzODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdChBuTAH2gAyNDcxMzI0MjUxOmZkZjAyNWI4NDkyY2Q2YzBhMDhmZGQzNjZkMzJiYjdmZTY4NGQwNmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3f939b6302e7cb5dedf91d97082c072d19844385", "author": {"user": {"login": "mssfang", "name": "Shawn Fang"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f939b6302e7cb5dedf91d97082c072d19844385", "committedDate": "2020-08-21T01:32:55Z", "message": "remove throwing the empty id exception manually"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "084125a950cdcc18637ef7aa6aedfe60cd5f46ef", "author": {"user": {"login": "mssfang", "name": "Shawn Fang"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/084125a950cdcc18637ef7aa6aedfe60cd5f46ef", "committedDate": "2020-08-21T01:39:43Z", "message": "remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428", "author": {"user": {"login": "mssfang", "name": "Shawn Fang"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428", "committedDate": "2020-08-21T17:59:55Z", "message": "add tests for the changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNjkzNDM3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#pullrequestreview-472693437", "createdAt": "2020-08-21T18:13:55Z", "commit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxODoxMzo1NVrOHE2uHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxODoxMzo1NVrOHE2uHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDg1Mjg5Mg==", "bodyText": "this fix is not related to empty id but it is a quick fix for make sure the async and sync tests are verifying the same thing. Previously they are verifying the error.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#discussion_r474852892", "createdAt": "2020-08-21T18:13:55Z", "author": {"login": "mssfang"}, "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClientTest.java", "diffHunk": "@@ -268,21 +287,32 @@ public void recognizeEntitiesDuplicateIdInput(HttpClient httpClient, TextAnalyti\n                 .verifyErrorSatisfies(ex -> assertEquals(HttpResponseException.class, ex.getClass())));\n     }\n \n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"com.azure.ai.textanalytics.TestUtils#getTestParameters\")\n+    public void recognizeEntitiesEmptyIdInput(HttpClient httpClient, TextAnalyticsServiceVersion serviceVersion) {\n+        client = getTextAnalyticsAsyncClient(httpClient, serviceVersion);\n+        textAnalyticsInputEmptyIdRunner(inputs ->\n+            StepVerifier.create(client.recognizeEntitiesBatchWithResponse(inputs, null))\n+                .verifyErrorSatisfies(ex -> {\n+                    HttpResponseException httpResponseException = (HttpResponseException) ex;\n+                    assertEquals(400, httpResponseException.getResponse().getStatusCode());\n+                    TextAnalyticsError textAnalyticsError = (TextAnalyticsError) httpResponseException.getValue();\n+                    // TODO: TextAnalyticsError has null values for all properties,\n+                    //       https://github.com/Azure/azure-sdk-for-java/issues/13960\n+                    // assertEquals(INVALID_DOCUMENT, textAnalyticsError.getErrorCode());\n+                }));\n+    }\n+\n     @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n     @MethodSource(\"com.azure.ai.textanalytics.TestUtils#getTestParameters\")\n     public void recognizeEntitiesBatchInputSingleError(HttpClient httpClient, TextAnalyticsServiceVersion serviceVersion) {\n         client = getTextAnalyticsAsyncClient(httpClient, serviceVersion);\n         recognizeBatchCategorizedEntitySingleErrorRunner((inputs) ->\n             StepVerifier.create(client.recognizeEntitiesBatchWithResponse(inputs, null))\n-                .assertNext(resultCollection -> {\n-                    resultCollection.getValue().forEach(result -> {\n-                        assertTrue(result.isError());\n-                        final TextAnalyticsError error = result.getError();\n-                        TextAnalyticsErrorCode errorCode = error.getErrorCode();\n-                        assertTrue(TextAnalyticsErrorCode.fromString(\"invalidDocument\").equals(errorCode));\n-                        assertTrue(\"Document text is empty.\".equals(error.getMessage()));\n-                    });\n-                }).verifyComplete());\n+                .assertNext(resultCollection -> resultCollection.getValue().forEach(recognizeEntitiesResult -> {\n+                    Exception exception = assertThrows(TextAnalyticsException.class, recognizeEntitiesResult::getEntities);\n+                    assertEquals(String.format(BATCH_ERROR_EXCEPTION_MESSAGE, \"RecognizeEntitiesResult\"), exception.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428"}, "originalPosition": 86}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNjkzNzY0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#pullrequestreview-472693764", "createdAt": "2020-08-21T18:14:28Z", "commit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxODoxNDoyOVrOHE2vFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxODoxNDoyOVrOHE2vFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDg1MzE0Mg==", "bodyText": "same reason as https://github.com/Azure/azure-sdk-for-java/pull/14324/files#r474852892", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#discussion_r474853142", "createdAt": "2020-08-21T18:14:29Z", "author": {"login": "mssfang"}, "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClientTest.java", "diffHunk": "@@ -376,21 +406,32 @@ public void recognizePiiEntitiesDuplicateIdInput(HttpClient httpClient, TextAnal\n                 .verifyErrorSatisfies(ex -> assertEquals(HttpResponseException.class, ex.getClass())));\n     }\n \n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"com.azure.ai.textanalytics.TestUtils#getTestParameters\")\n+    public void recognizePiiEntitiesEmptyIdInput(HttpClient httpClient, TextAnalyticsServiceVersion serviceVersion) {\n+        client = getTextAnalyticsAsyncClient(httpClient, serviceVersion);\n+        textAnalyticsInputEmptyIdRunner(inputs ->\n+            StepVerifier.create(client.recognizePiiEntitiesBatchWithResponse(inputs, null))\n+                .verifyErrorSatisfies(ex -> {\n+                    HttpResponseException httpResponseException = (HttpResponseException) ex;\n+                    assertEquals(400, httpResponseException.getResponse().getStatusCode());\n+                    TextAnalyticsError textAnalyticsError = (TextAnalyticsError) httpResponseException.getValue();\n+                    // TODO: TextAnalyticsError has null values for all properties,\n+                    //       https://github.com/Azure/azure-sdk-for-java/issues/13960\n+                    // assertEquals(INVALID_DOCUMENT, textAnalyticsError.getErrorCode());\n+                }));\n+    }\n+\n     @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n     @MethodSource(\"com.azure.ai.textanalytics.TestUtils#getTestParameters\")\n     public void recognizePiiEntitiesBatchInputSingleError(HttpClient httpClient, TextAnalyticsServiceVersion serviceVersion) {\n         client = getTextAnalyticsAsyncClient(httpClient, serviceVersion);\n         recognizeBatchPiiEntitySingleErrorRunner((inputs) ->\n             StepVerifier.create(client.recognizePiiEntitiesBatchWithResponse(inputs, null))\n-                .assertNext(resultCollection -> {\n-                    resultCollection.getValue().forEach(result -> {\n-                        assertTrue(result.isError());\n-                        final TextAnalyticsError error = result.getError();\n-                        TextAnalyticsErrorCode errorCode = error.getErrorCode();\n-                        assertTrue(TextAnalyticsErrorCode.fromString(\"invalidDocument\").equals(errorCode));\n-                        assertTrue(\"Document text is empty.\".equals(error.getMessage()));\n-                    });\n-                }).verifyComplete());\n+                .assertNext(resultCollection -> resultCollection.getValue().forEach(recognizePiiEntitiesResult -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428"}, "originalPosition": 126}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyODQ5OTY1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#pullrequestreview-472849965", "createdAt": "2020-08-21T22:28:42Z", "commit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyODUwNDc2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#pullrequestreview-472850476", "createdAt": "2020-08-21T22:30:21Z", "commit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQyMjozMDoyMVrOHE_ejA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQyMjozMDoyMVrOHE_ejA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk5NjM2NA==", "bodyText": "Seems like form here we are getting non-null values. What exactly is missing?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#discussion_r474996364", "createdAt": "2020-08-21T22:30:21Z", "author": {"login": "samvaity"}, "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClientTest.java", "diffHunk": "@@ -198,6 +198,25 @@ public void detectLanguageDuplicateIdInput(HttpClient httpClient, TextAnalyticsS\n                 .verifyErrorSatisfies(ex -> assertEquals(HttpResponseException.class, ex.getClass())));\n     }\n \n+    /**\n+     * Verifies that an invalid document exception is returned for input documents with an empty ID.\n+     */\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"com.azure.ai.textanalytics.TestUtils#getTestParameters\")\n+    public void detectLanguageEmptyIdInput(HttpClient httpClient, TextAnalyticsServiceVersion serviceVersion) {\n+        client = getTextAnalyticsAsyncClient(httpClient, serviceVersion);\n+        detectLanguageInputEmptyIdRunner(inputs ->\n+            StepVerifier.create(client.detectLanguageBatchWithResponse(inputs, null))\n+                .verifyErrorSatisfies(ex -> {\n+                    HttpResponseException httpResponseException = (HttpResponseException) ex;\n+                    assertEquals(400, httpResponseException.getResponse().getStatusCode());\n+                    TextAnalyticsError textAnalyticsError = (TextAnalyticsError) httpResponseException.getValue();\n+                    // TODO: TextAnalyticsError has null values for all properties,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNjEyNjg0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#pullrequestreview-473612684", "createdAt": "2020-08-24T15:28:35Z", "commit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNToyODozNVrOHFqcDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNToyODozNVrOHFqcDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcwMDIzOA==", "bodyText": "I'm not seeing tests for the error that gets thrown when too many documents are being passed (might just not have found the tests). I have tests for every endpoint except detect_language and they're all called test_too_many_documents. Here's an example of one. Even though we're no longer throwing a special error ourselves in this case, I think it's still good to have a test for it", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#discussion_r475700238", "createdAt": "2020-08-24T15:28:35Z", "author": {"login": "iscai-msft"}, "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TextAnalyticsClientTestBase.java", "diffHunk": "@@ -98,6 +102,12 @@\n     @Test\n     abstract void recognizeEntitiesForFaultyText(HttpClient httpClient, TextAnalyticsServiceVersion serviceVersion);\n \n+    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d86c8c083ff2c8e42e4a00d2d3bd48e3354e1428"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64bb30b01cef0c1cd394a06fd0d6a96334998a81", "author": {"user": {"login": "mssfang", "name": "Shawn Fang"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/64bb30b01cef0c1cd394a06fd0d6a96334998a81", "committedDate": "2020-08-25T04:42:25Z", "message": "add tooManydocumentTests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NjAzNDM3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#pullrequestreview-474603437", "createdAt": "2020-08-25T15:34:09Z", "commit": {"oid": "64bb30b01cef0c1cd394a06fd0d6a96334998a81"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNTozNDowOVrOHGd2pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNTozNToxM1rOHGd5oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU0MjYzMA==", "bodyText": "nit: i'd remove this commented out code, you can't really reach too many documents with detect_language, since if you go over, you will actually run into a batch size overload error instead", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#discussion_r476542630", "createdAt": "2020-08-25T15:34:09Z", "author": {"login": "iscai-msft"}, "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClientTest.java", "diffHunk": "@@ -243,6 +243,25 @@ public void detectLanguageNoneCountryHint(HttpClient httpClient, TextAnalyticsSe\n                 .verifyComplete());\n     }\n \n+//    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64bb30b01cef0c1cd394a06fd0d6a96334998a81"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU0MzM5Mg==", "bodyText": "just to clarify, you're going to start asserting the error code and message once you regenerate with the swagger fix?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14324#discussion_r476543392", "createdAt": "2020-08-25T15:35:13Z", "author": {"login": "iscai-msft"}, "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClientTest.java", "diffHunk": "@@ -365,6 +384,22 @@ public void recognizeEntitiesForListWithOptions(HttpClient httpClient, TextAnaly\n                 .verifyComplete());\n     }\n \n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"com.azure.ai.textanalytics.TestUtils#getTestParameters\")\n+    public void recognizeEntitiesBatchTooManyDocuments(HttpClient httpClient, TextAnalyticsServiceVersion serviceVersion) {\n+        client = getTextAnalyticsAsyncClient(httpClient, serviceVersion);\n+        tooManyDocumentsRunner(inputs ->\n+            StepVerifier.create(client.recognizeEntitiesBatch(inputs, null, null))\n+                .verifyErrorSatisfies(ex -> {\n+                    HttpResponseException httpResponseException = (HttpResponseException) ex;\n+                    assertEquals(400, httpResponseException.getResponse().getStatusCode());\n+                    TextAnalyticsError textAnalyticsError = (TextAnalyticsError) httpResponseException.getValue();\n+                    // TODO: TextAnalyticsError has null values for all properties,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64bb30b01cef0c1cd394a06fd0d6a96334998a81"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdf025b8492cd6c0a08fdd366d32bb7fe684d06b", "author": {"user": {"login": "mssfang", "name": "Shawn Fang"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fdf025b8492cd6c0a08fdd366d32bb7fe684d06b", "committedDate": "2020-08-26T00:53:50Z", "message": "remove detect language and add tests to TestBase class"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 326, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}