{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMjc5NjMx", "number": 13751, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNjo1MDozOFrOEUrj2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNjo1MDo1N1rOEUrkQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwMTIwNjY0OnYy", "diffSide": "RIGHT", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/PartitionBasedLoadBalancer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNjo1MDozOFrOG7BAvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNjo1MDozOFrOG7BAvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUzNTc0Mw==", "bodyText": "Do we need to collect this into a list if we're doing anything on the output?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13751#discussion_r464535743", "createdAt": "2020-08-03T16:50:38Z", "author": {"login": "conniey"}, "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/PartitionBasedLoadBalancer.java", "diffHunk": "@@ -278,6 +258,24 @@ void loadBalance() {\n         });\n     }\n \n+    private void renewOwnership(Map<String, PartitionOwnership> partitionOwnershipMap) {\n+        // renew ownership of already owned partitions\n+        checkpointStore.claimOwnership(partitionPumpManager.getPartitionPumps().keySet()\n+            .stream()\n+            .filter(\n+                partitionId -> partitionOwnershipMap.containsKey(partitionId) && partitionOwnershipMap.get(partitionId)\n+                    .equals(this.ownerId))\n+            .map(partitionId -> createPartitionOwnershipRequest(partitionOwnershipMap, partitionId))\n+            .collect(Collectors.toList()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72e9c88cfa924f3a7b7e725bb6bda1206265843"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwMTIwNzcwOnYy", "diffSide": "RIGHT", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/PartitionBasedLoadBalancer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNjo1MDo1N1rOG7BBZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNjo1MDo1N1rOG7BBZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUzNTkwOA==", "bodyText": "Is it possible to have a test for this? \ud83e\udd14", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13751#discussion_r464535908", "createdAt": "2020-08-03T16:50:57Z", "author": {"login": "conniey"}, "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/PartitionBasedLoadBalancer.java", "diffHunk": "@@ -218,35 +218,15 @@ void loadBalance() {\n                 // If the partitions are evenly distributed among all active event processors, no change required.\n                 logger.info(\"Load is balanced with this event processor owning {} partitions\",\n                     ownerPartitionMap.get(ownerId).size());\n-                // renew ownership of already owned partitions\n-                checkpointStore.claimOwnership(partitionPumpManager.getPartitionPumps().keySet()\n-                    .stream()\n-                    .map(partitionId -> createPartitionOwnershipRequest(partitionOwnershipMap, partitionId))\n-                    .collect(Collectors.toList()))\n-                    .subscribe(ignored -> { },\n-                        ex -> {\n-                            logger.error(\"Error renewing partition ownership\", ex);\n-                            isLoadBalancerRunning.set(false);\n-                        },\n-                        () -> isLoadBalancerRunning.set(false));\n+                renewOwnership(partitionOwnershipMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72e9c88cfa924f3a7b7e725bb6bda1206265843"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4724, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}