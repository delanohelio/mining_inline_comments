{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMzUyMjIy", "number": 7337, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMDo0MToxM1rODYor0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMToyODowM1rODY-ZRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MTU4OTkzOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/EnvironmentCredential.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMDo0MToxM1rOFem6XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMDo0MToxM1rOFem6XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYzOTEzMg==", "bodyText": "Seems like we should introduce a method something like envContains(params string var) that returns true if the env contains all of the 'var's.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r367639132", "createdAt": "2020-01-16T20:41:13Z", "author": {"login": "jongio"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/EnvironmentCredential.java", "diffHunk": "@@ -50,6 +50,22 @@\n                     configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),\n                     configuration.get(Configuration.PROPERTY_AZURE_CLIENT_SECRET),\n                     identityClientOptions);\n+            } else if (configuration.contains(Configuration.PROPERTY_AZURE_CLIENT_ID)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3649a83f9b9b37aa539e8f77dabd9a87e53eb4ef"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NDgyNzk4OnYy", "diffSide": "RIGHT", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Configuration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTozNjo0MVrOFfF4FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQwNzoyMjoxOVrOFfNhqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0NjQ1Mg==", "bodyText": "I'm not explicitly against this change but I do question how often it will be used outside of the context of EnvironmentCredential. Any chance this could be made into a local private method in the interim and if it is needed in additional locations in the future it gets added here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368146452", "createdAt": "2020-01-17T21:36:41Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Configuration.java", "diffHunk": "@@ -275,6 +280,21 @@ public boolean contains(String name) {\n         return configurations.containsKey(name);\n     }\n \n+    /**\n+     * Determines if multiple configurations all exist.\n+     *\n+     * @param names Names of the configuration.\n+     * @return True if configurations all exist, otherwise false.\n+     */\n+    public boolean containsAll(String... names){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3MTc4NQ==", "bodyText": "Removed from Configuratoin, now a private method in EnvironmentCredential.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368271785", "createdAt": "2020-01-19T07:22:19Z", "author": {"login": "cxznmhdcxz"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Configuration.java", "diffHunk": "@@ -275,6 +280,21 @@ public boolean contains(String name) {\n         return configurations.containsKey(name);\n     }\n \n+    /**\n+     * Determines if multiple configurations all exist.\n+     *\n+     * @param names Names of the configuration.\n+     * @return True if configurations all exist, otherwise false.\n+     */\n+    public boolean containsAll(String... names){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0NjQ1Mg=="}, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NDgzMTI5OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/EnvironmentCredential.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTozODoxNlrOFfF6Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQwMzowMzowOVrOFfM7Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0Njk3NA==", "bodyText": "Is this not explicitly needed by UsernamePasswordCredential? Otherwise the validation check is missing this.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368146974", "createdAt": "2020-01-17T21:38:16Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/EnvironmentCredential.java", "diffHunk": "@@ -42,14 +42,30 @@\n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n         return Mono.fromSupplier(() -> {\n-            if (configuration.contains(Configuration.PROPERTY_AZURE_CLIENT_ID)\n-                && configuration.contains(Configuration.PROPERTY_AZURE_CLIENT_SECRET)\n-                && configuration.contains(Configuration.PROPERTY_AZURE_TENANT_ID)) {\n+            if (configuration.containsAll(Configuration.PROPERTY_AZURE_TENANT_ID,\n+                    Configuration.PROPERTY_AZURE_CLIENT_ID,\n+                    Configuration.PROPERTY_AZURE_CLIENT_SECRET)) {\n                 // TODO: support other clouds\n                 return new ClientSecretCredential(configuration.get(Configuration.PROPERTY_AZURE_TENANT_ID),\n                     configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),\n                     configuration.get(Configuration.PROPERTY_AZURE_CLIENT_SECRET),\n                     identityClientOptions);\n+            } else if (configuration.containsAll(Configuration.PROPERTY_AZURE_CLIENT_ID,\n+                    Configuration.PROPERTY_AZURE_TENANT_ID,\n+                    Configuration.PROPERTY_AZURE_CLIENT_CERTIFICATE_PATH)) {\n+                return new ClientCertificateCredential(configuration.get(Configuration.PROPERTY_AZURE_TENANT_ID),\n+                    configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),\n+                    configuration.get(Configuration.PROPERTY_AZURE_CLIENT_CERTIFICATE_PATH),\n+                    null,\n+                    identityClientOptions);\n+            } else if (configuration.containsAll(Configuration.PROPERTY_AZURE_USERNAME,\n+                    Configuration.PROPERTY_AZURE_CLIENT_ID,\n+                    Configuration.PROPERTY_AZURE_PASSWORD)) {\n+                return new UsernamePasswordCredential(configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),\n+                    configuration.get(Configuration.PROPERTY_AZURE_TENANT_ID),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI2MTg5MQ==", "bodyText": "No it's not, but supply it anyway (null if not set, or a tenant id if set).", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368261891", "createdAt": "2020-01-19T03:03:09Z", "author": {"login": "cxznmhdcxz"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/EnvironmentCredential.java", "diffHunk": "@@ -42,14 +42,30 @@\n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n         return Mono.fromSupplier(() -> {\n-            if (configuration.contains(Configuration.PROPERTY_AZURE_CLIENT_ID)\n-                && configuration.contains(Configuration.PROPERTY_AZURE_CLIENT_SECRET)\n-                && configuration.contains(Configuration.PROPERTY_AZURE_TENANT_ID)) {\n+            if (configuration.containsAll(Configuration.PROPERTY_AZURE_TENANT_ID,\n+                    Configuration.PROPERTY_AZURE_CLIENT_ID,\n+                    Configuration.PROPERTY_AZURE_CLIENT_SECRET)) {\n                 // TODO: support other clouds\n                 return new ClientSecretCredential(configuration.get(Configuration.PROPERTY_AZURE_TENANT_ID),\n                     configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),\n                     configuration.get(Configuration.PROPERTY_AZURE_CLIENT_SECRET),\n                     identityClientOptions);\n+            } else if (configuration.containsAll(Configuration.PROPERTY_AZURE_CLIENT_ID,\n+                    Configuration.PROPERTY_AZURE_TENANT_ID,\n+                    Configuration.PROPERTY_AZURE_CLIENT_CERTIFICATE_PATH)) {\n+                return new ClientCertificateCredential(configuration.get(Configuration.PROPERTY_AZURE_TENANT_ID),\n+                    configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),\n+                    configuration.get(Configuration.PROPERTY_AZURE_CLIENT_CERTIFICATE_PATH),\n+                    null,\n+                    identityClientOptions);\n+            } else if (configuration.containsAll(Configuration.PROPERTY_AZURE_USERNAME,\n+                    Configuration.PROPERTY_AZURE_CLIENT_ID,\n+                    Configuration.PROPERTY_AZURE_PASSWORD)) {\n+                return new UsernamePasswordCredential(configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),\n+                    configuration.get(Configuration.PROPERTY_AZURE_TENANT_ID),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0Njk3NA=="}, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NDgzNDY2OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/EnvironmentCredential.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTozOTo1NVrOFfF8Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTozOTo1NVrOFfF8Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0NzQ5NA==", "bodyText": "Thoughts on changing the containsAll method to getAll? There are already some race condition chances going on with validating existence then retrieval, if we retrieval all into local instances we could reduce the number of timing issues happening.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368147494", "createdAt": "2020-01-17T21:39:55Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/EnvironmentCredential.java", "diffHunk": "@@ -42,14 +42,30 @@\n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n         return Mono.fromSupplier(() -> {\n-            if (configuration.contains(Configuration.PROPERTY_AZURE_CLIENT_ID)\n-                && configuration.contains(Configuration.PROPERTY_AZURE_CLIENT_SECRET)\n-                && configuration.contains(Configuration.PROPERTY_AZURE_TENANT_ID)) {\n+            if (configuration.containsAll(Configuration.PROPERTY_AZURE_TENANT_ID,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NDgzNjU4OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/EnvironmentCredential.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTo0MDo1NFrOFfF9ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTo0MDo1NFrOFfF9ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0NzgxMg==", "bodyText": "Could we retrieve the commonly needed configuration and check those first? Seems like we could make an initial check that PROPERTY_AZURE_CLIENT_ID is set and if not just early out.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368147812", "createdAt": "2020-01-17T21:40:54Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/EnvironmentCredential.java", "diffHunk": "@@ -42,14 +42,30 @@\n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n         return Mono.fromSupplier(() -> {\n-            if (configuration.contains(Configuration.PROPERTY_AZURE_CLIENT_ID)\n-                && configuration.contains(Configuration.PROPERTY_AZURE_CLIENT_SECRET)\n-                && configuration.contains(Configuration.PROPERTY_AZURE_TENANT_ID)) {\n+            if (configuration.containsAll(Configuration.PROPERTY_AZURE_TENANT_ID,\n+                    Configuration.PROPERTY_AZURE_CLIENT_ID,\n+                    Configuration.PROPERTY_AZURE_CLIENT_SECRET)) {\n                 // TODO: support other clouds\n                 return new ClientSecretCredential(configuration.get(Configuration.PROPERTY_AZURE_TENANT_ID),\n                     configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),\n                     configuration.get(Configuration.PROPERTY_AZURE_CLIENT_SECRET),\n                     identityClientOptions);\n+            } else if (configuration.containsAll(Configuration.PROPERTY_AZURE_CLIENT_ID,\n+                    Configuration.PROPERTY_AZURE_TENANT_ID,\n+                    Configuration.PROPERTY_AZURE_CLIENT_CERTIFICATE_PATH)) {\n+                return new ClientCertificateCredential(configuration.get(Configuration.PROPERTY_AZURE_TENANT_ID),\n+                    configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),\n+                    configuration.get(Configuration.PROPERTY_AZURE_CLIENT_CERTIFICATE_PATH),\n+                    null,\n+                    identityClientOptions);\n+            } else if (configuration.containsAll(Configuration.PROPERTY_AZURE_USERNAME,\n+                    Configuration.PROPERTY_AZURE_CLIENT_ID,\n+                    Configuration.PROPERTY_AZURE_PASSWORD)) {\n+                return new UsernamePasswordCredential(configuration.get(Configuration.PROPERTY_AZURE_CLIENT_ID),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NDg0MDQzOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/EnvironmentCredentialTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTo0Mjo0OVrOFfF_0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTo0Mjo0OVrOFfF_0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0ODQzMw==", "bodyText": "Could remove the local instance since Configuration uses the fluent pattern for put.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368148433", "createdAt": "2020-01-17T21:42:49Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/EnvironmentCredentialTests.java", "diffHunk": "@@ -36,4 +36,46 @@ public void testCreateEnvironmentCredential() {\n             .expectNextMatches(token -> \"token\".equals(token.getToken()))\n             .verifyComplete();\n     }\n+\n+    @Test\n+    public void testCreateEnvironmentClientCertificateCredential() {\n+        Configuration configuration = Configuration.getGlobalConfiguration();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NDg0MDc1OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/EnvironmentCredentialTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTo0Mjo1OVrOFfGABQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTo0Mjo1OVrOFfGABQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0ODQ4NQ==", "bodyText": "Same as the previous comment", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368148485", "createdAt": "2020-01-17T21:42:59Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/EnvironmentCredentialTests.java", "diffHunk": "@@ -36,4 +36,46 @@ public void testCreateEnvironmentCredential() {\n             .expectNextMatches(token -> \"token\".equals(token.getToken()))\n             .verifyComplete();\n     }\n+\n+    @Test\n+    public void testCreateEnvironmentClientCertificateCredential() {\n+        Configuration configuration = Configuration.getGlobalConfiguration();\n+        configuration.put(Configuration.PROPERTY_AZURE_CLIENT_ID, \"foo\");\n+        configuration.put(Configuration.PROPERTY_AZURE_CLIENT_CERTIFICATE_PATH, \"bar\");\n+        configuration.put(Configuration.PROPERTY_AZURE_TENANT_ID, \"baz\");\n+\n+        EnvironmentCredential credential = new EnvironmentCredentialBuilder().build();\n+\n+        // authentication will fail client-id=foo, but should be able to create ClientSecretCredential\n+        StepVerifier.create(credential.getToken(new TokenRequestContext().addScopes(\"qux/.default\"))\n+            .doOnSuccess(s -> fail())\n+            .onErrorResume(t -> {\n+                String message = t.getMessage();\n+                Assert.assertFalse(message != null && message.contains(\"Cannot create any credentials with the current environment variables\"));\n+                return Mono.just(new AccessToken(\"token\", OffsetDateTime.MAX));\n+            }))\n+            .expectNextMatches(token -> \"token\".equals(token.getToken()))\n+            .verifyComplete();\n+    }\n+\n+    @Test\n+    public void testCreateEnvironmentUserPasswordCredential() {\n+        Configuration configuration = Configuration.getGlobalConfiguration();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTE0NjY0OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/EnvironmentCredentialTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMToyNzozNVrOFfI5FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMToyNzozNVrOFfI5FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5NTg2MQ==", "bodyText": "NIT: I think this comment should say \"ClientCertificateCredential\" instead of \"ClientSecretCredential\"", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368195861", "createdAt": "2020-01-18T01:27:35Z", "author": {"login": "ellismg"}, "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/EnvironmentCredentialTests.java", "diffHunk": "@@ -36,4 +36,46 @@ public void testCreateEnvironmentCredential() {\n             .expectNextMatches(token -> \"token\".equals(token.getToken()))\n             .verifyComplete();\n     }\n+\n+    @Test\n+    public void testCreateEnvironmentClientCertificateCredential() {\n+        Configuration configuration = Configuration.getGlobalConfiguration();\n+        configuration.put(Configuration.PROPERTY_AZURE_CLIENT_ID, \"foo\");\n+        configuration.put(Configuration.PROPERTY_AZURE_CLIENT_CERTIFICATE_PATH, \"bar\");\n+        configuration.put(Configuration.PROPERTY_AZURE_TENANT_ID, \"baz\");\n+\n+        EnvironmentCredential credential = new EnvironmentCredentialBuilder().build();\n+\n+        // authentication will fail client-id=foo, but should be able to create ClientSecretCredential", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTE0Njk0OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/EnvironmentCredentialTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMToyODowM1rOFfI5QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMToyODowM1rOFfI5QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5NTkwNA==", "bodyText": "NIT: Similar feedback as above, I think this should be UsernamePasswordCredential in the comment.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7337#discussion_r368195904", "createdAt": "2020-01-18T01:28:03Z", "author": {"login": "ellismg"}, "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/EnvironmentCredentialTests.java", "diffHunk": "@@ -36,4 +36,46 @@ public void testCreateEnvironmentCredential() {\n             .expectNextMatches(token -> \"token\".equals(token.getToken()))\n             .verifyComplete();\n     }\n+\n+    @Test\n+    public void testCreateEnvironmentClientCertificateCredential() {\n+        Configuration configuration = Configuration.getGlobalConfiguration();\n+        configuration.put(Configuration.PROPERTY_AZURE_CLIENT_ID, \"foo\");\n+        configuration.put(Configuration.PROPERTY_AZURE_CLIENT_CERTIFICATE_PATH, \"bar\");\n+        configuration.put(Configuration.PROPERTY_AZURE_TENANT_ID, \"baz\");\n+\n+        EnvironmentCredential credential = new EnvironmentCredentialBuilder().build();\n+\n+        // authentication will fail client-id=foo, but should be able to create ClientSecretCredential\n+        StepVerifier.create(credential.getToken(new TokenRequestContext().addScopes(\"qux/.default\"))\n+            .doOnSuccess(s -> fail())\n+            .onErrorResume(t -> {\n+                String message = t.getMessage();\n+                Assert.assertFalse(message != null && message.contains(\"Cannot create any credentials with the current environment variables\"));\n+                return Mono.just(new AccessToken(\"token\", OffsetDateTime.MAX));\n+            }))\n+            .expectNextMatches(token -> \"token\".equals(token.getToken()))\n+            .verifyComplete();\n+    }\n+\n+    @Test\n+    public void testCreateEnvironmentUserPasswordCredential() {\n+        Configuration configuration = Configuration.getGlobalConfiguration();\n+        configuration.put(Configuration.PROPERTY_AZURE_CLIENT_ID, \"foo\");\n+        configuration.put(Configuration.PROPERTY_AZURE_USERNAME, \"bar\");\n+        configuration.put(Configuration.PROPERTY_AZURE_PASSWORD, \"baz\");\n+\n+        EnvironmentCredential credential = new EnvironmentCredentialBuilder().build();\n+\n+        // authentication will fail client-id=foo, but should be able to create ClientSecretCredential", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "404d0f745c1c31508c0b0e6f9f912f123bda2ee2"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 555, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}