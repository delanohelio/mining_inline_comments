{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NzAxMjg3", "number": 13944, "title": "add @GeneratedValue annotation that can be used to autogenerate Id value on insert", "bodyText": "this is a port of this PR from the old repo...\nmicrosoft/spring-data-cosmosdb#481\nOne thing to point out about this, given the discussion from the old PR, is that this is an entirely optional feature and changes no existing behavior. It simply adds an @GeneratedValue annotation that users may use to auto generate values for string type id fields and is consistent with the functionality in spring-data-mongo", "createdAt": "2020-08-10T20:00:24Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944", "merged": true, "mergeCommit": {"oid": "375bc97f2c008b741fb211a1f5eb66503ba9610a"}, "closed": true, "closedAt": "2020-08-11T22:14:11Z", "author": {"login": "Blackbaud-EricSlater"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9no6jgH2gAyNDY1NzAxMjg3OmUwYmJiNGI1OGJjNjZlMmYxN2Q0MzllODQwN2Q1NWZlMWUxNTEzOTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc99matAH2gAyNDY1NzAxMjg3OmJhZGM5MTNjYjBmZTJlZDI4NDE0MWRhOWU5OWUwNDYwYWExOWM1NTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e0bbb4b58bc66e2f17d439e8407d55fe1e151392", "author": {"user": {"login": "Blackbaud-EricSlater", "name": "Eric Slater"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e0bbb4b58bc66e2f17d439e8407d55fe1e151392", "committedDate": "2020-08-10T19:46:27Z", "message": "add @GeneratedValue annotation that can be used to autogenerate Id value on insert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc3a8bcd7c5987c6149492aa04e50192cc6add27", "author": {"user": {"login": "Blackbaud-EricSlater", "name": "Eric Slater"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/dc3a8bcd7c5987c6149492aa04e50192cc6add27", "committedDate": "2020-08-10T19:52:08Z", "message": "minor cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d6e8210392ad6cac3872f775b70b70f69cb0ca5", "author": {"user": {"login": "Blackbaud-EricSlater", "name": "Eric Slater"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d6e8210392ad6cac3872f775b70b70f69cb0ca5", "committedDate": "2020-08-10T19:57:55Z", "message": "fix checkstyle issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6aab6aae818d363e840d3ec00231bddafd0fc292", "author": {"user": {"login": "Blackbaud-EricSlater", "name": "Eric Slater"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6aab6aae818d363e840d3ec00231bddafd0fc292", "committedDate": "2020-08-10T21:14:34Z", "message": "fix style issues in integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NjkyMjk0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944#pullrequestreview-464692294", "createdAt": "2020-08-11T01:36:57Z", "commit": {"oid": "6aab6aae818d363e840d3ec00231bddafd0fc292"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTozNjo1N1rOG-lW7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTozNjo1N1rOG-lW7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3Njk3Mw==", "bodyText": "I remember we had an issue with UUID generation in activityId causing long pauses due to lack of real randomness entropy.\nDo other spring plugin use auto generated UUID? I wonder if we should use fast uuid generation for this (similar to activityId in the SDK)", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944#discussion_r468276973", "createdAt": "2020-08-11T01:36:57Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-spring-data-cosmos-core/src/main/java/com/azure/spring/data/cosmos/core/CosmosTemplate.java", "diffHunk": "@@ -189,6 +193,14 @@ public void setApplicationContext(ApplicationContext applicationContext) throws\n         return toDomainObject(domainType, response.getItem());\n     }\n \n+    @SuppressWarnings(\"unchecked\")\n+    private <T> void generateIdIfNullAndAutoGenerationEnabled(T originalItem, Class<?> type) {\n+        CosmosEntityInformation<?, ?> entityInfo = CosmosEntityInformation.getInstance(type);\n+        if (entityInfo.shouldGenerateId() && ReflectionUtils.getField(entityInfo.getIdField(), originalItem) == null) {\n+            ReflectionUtils.setField(entityInfo.getIdField(), originalItem, UUID.randomUUID().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6aab6aae818d363e840d3ec00231bddafd0fc292"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzM5NTU1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944#pullrequestreview-464739555", "createdAt": "2020-08-11T04:26:59Z", "commit": {"oid": "6aab6aae818d363e840d3ec00231bddafd0fc292"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzM5ODMx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944#pullrequestreview-464739831", "createdAt": "2020-08-11T04:28:07Z", "commit": {"oid": "6aab6aae818d363e840d3ec00231bddafd0fc292"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwNDoyODowN1rOG-n8RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwNDoyODowN1rOG-n8RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMxOTMwMA==", "bodyText": "what happens if a field of non String type is annotated with @ GeneratedValue do we support that? or do we error out?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944#discussion_r468319300", "createdAt": "2020-08-11T04:28:07Z", "author": {"login": "moderakh"}, "path": "sdk/cosmos/azure-spring-data-cosmos-test/src/test/java/com/azure/spring/data/cosmos/domain/GenIdEntity.java", "diffHunk": "@@ -0,0 +1,70 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.spring.data.cosmos.domain;\n+\n+import com.azure.spring.data.cosmos.core.mapping.GeneratedValue;\n+import org.springframework.data.annotation.Id;\n+\n+import java.util.Objects;\n+\n+public class GenIdEntity {\n+\n+    @Id\n+    @GeneratedValue", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6aab6aae818d363e840d3ec00231bddafd0fc292"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzcyODQ4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944#pullrequestreview-464772848", "createdAt": "2020-08-11T06:09:26Z", "commit": {"oid": "6aab6aae818d363e840d3ec00231bddafd0fc292"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f01e14b29239fa4e416f43ae3aae90279a51892", "author": {"user": {"login": "Blackbaud-EricSlater", "name": "Eric Slater"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f01e14b29239fa4e416f43ae3aae90279a51892", "committedDate": "2020-08-11T16:42:08Z", "message": "update README with feature description"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MjUzNzM1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944#pullrequestreview-465253735", "createdAt": "2020-08-11T16:54:00Z", "commit": {"oid": "3f01e14b29239fa4e416f43ae3aae90279a51892"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNjo1NDowMFrOG_Avvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNjo1NDowMFrOG_Avvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcyNTY5NA==", "bodyText": "Please add Microsoft headers to this file.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944#discussion_r468725694", "createdAt": "2020-08-11T16:54:00Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-spring-data-cosmos-core/src/samples/java/com/azure/cosmos/GeneratedIdEntity.java", "diffHunk": "@@ -0,0 +1,12 @@\n+package com.azure.cosmos;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f01e14b29239fa4e416f43ae3aae90279a51892"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8acb3d31fe653b27b7a058e8f0638a9643ce623", "author": {"user": {"login": "Blackbaud-EricSlater", "name": "Eric Slater"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b8acb3d31fe653b27b7a058e8f0638a9643ce623", "committedDate": "2020-08-11T17:06:05Z", "message": "add missing copyright header"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MjYzNTE4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13944#pullrequestreview-465263518", "createdAt": "2020-08-11T17:06:50Z", "commit": {"oid": "b8acb3d31fe653b27b7a058e8f0638a9643ce623"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df77eb3fcc3f6227b4b66f076295be83ddb98cab", "author": {"user": {"login": "Blackbaud-EricSlater", "name": "Eric Slater"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/df77eb3fcc3f6227b4b66f076295be83ddb98cab", "committedDate": "2020-08-11T19:47:53Z", "message": "fix line nums in readme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "badc913cb0fe2ed284141da9e99e0460aa19c558", "author": {"user": {"login": "Blackbaud-EricSlater", "name": "Eric Slater"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/badc913cb0fe2ed284141da9e99e0460aa19c558", "committedDate": "2020-08-11T21:21:38Z", "message": "fix checkstyle issues"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 524, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}