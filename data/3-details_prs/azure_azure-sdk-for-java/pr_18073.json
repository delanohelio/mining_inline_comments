{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MTAwMTE3", "number": 18073, "title": "Create auto apireview", "bodyText": "Create API review automatically when API diff is found", "createdAt": "2020-12-10T17:21:25Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18073", "merged": true, "mergeCommit": {"oid": "c2537571a9b567ada0d17fa8149eadefa94b1d5f"}, "closed": true, "closedAt": "2020-12-12T00:17:42Z", "author": {"login": "praveenkuttappan"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdklhAhgH2gAyNTM2MTAwMTE3OjE5OGRlMmZiMmFmYjE2YjIyNWM3YzkyMjU5ZmFlNWI5ZTUwMWIzOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlN_64gH2gAyNTM2MTAwMTE3OjhlYzczNWE1MTEzNTRjNjZhOTE3Nzg1NTYxMjFjOWU1MzFkZmJhN2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "198de2fb2afb16b225c7c92259fae5b9e501b390", "author": {"user": {"login": "praveenkuttappan", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/198de2fb2afb16b225c7c92259fae5b9e501b390", "committedDate": "2020-12-09T21:21:03Z", "message": "Create API review automatically"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ae1ab11a8036c236060c74c02f4df27086381df", "author": {"user": {"login": "praveenkuttappan", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0ae1ab11a8036c236060c74c02f4df27086381df", "committedDate": "2020-12-10T17:10:17Z", "message": "Test with copied common files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dafac4a22c51d941b71fccfb24571b13769b67a", "author": {"user": {"login": "praveenkuttappan", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7dafac4a22c51d941b71fccfb24571b13769b67a", "committedDate": "2020-12-11T08:26:04Z", "message": "Update based on .Net testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e04e4e6661628766d6854be1663a70dff1d62f3", "author": {"user": {"login": "praveenkuttappan", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0e04e4e6661628766d6854be1663a70dff1d62f3", "committedDate": "2020-12-11T08:28:02Z", "message": "Update based on .Net testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a78108de1e2a60122156da68a757c7b490d760b5", "author": {"user": {"login": "praveenkuttappan", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a78108de1e2a60122156da68a757c7b490d760b5", "committedDate": "2020-12-11T08:52:25Z", "message": "Fix package finding script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69715e8dcf1aace055fce98d412419df01e809a3", "author": {"user": {"login": "praveenkuttappan", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/69715e8dcf1aace055fce98d412419df01e809a3", "committedDate": "2020-12-11T09:00:26Z", "message": "Fix PS script error in API create"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24227b0f20f5e6949d010b0b655be3eb3bbee80e", "author": {"user": {"login": "praveenkuttappan", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/24227b0f20f5e6949d010b0b655be3eb3bbee80e", "committedDate": "2020-12-11T09:16:23Z", "message": "More debugging changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6821888e617b7f432d0b8be9ae6b9356a539c11b", "author": {"user": {"login": "praveenkuttappan", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6821888e617b7f432d0b8be9ae6b9356a539c11b", "committedDate": "2020-12-11T09:38:33Z", "message": "More debugging changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNTQyMzQ2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18073#pullrequestreview-550542346", "createdAt": "2020-12-11T20:08:16Z", "commit": {"oid": "6821888e617b7f432d0b8be9ae6b9356a539c11b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMDowODoxNlrOIEKQug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMDowODoxNlrOIEKQug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIzMzMzOA==", "bodyText": "It is generally bad form to force exit from a helper function. Instead you should return $null and handle at the calling site and exit if that is the entry point script.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18073#discussion_r541233338", "createdAt": "2020-12-11T20:08:16Z", "author": {"login": "weshaggard"}, "path": "eng/scripts/Language-Settings.ps1", "diffHunk": "@@ -216,3 +216,29 @@ function Update-java-CIConfig($pkgs, $ciRepo, $locationInDocRepo, $monikerId=$nu\n \n   Set-Content -Path $pkgJsonLoc -Value $jsonContent\n }\n+\n+\n+# function is used to filter packages to submit to API view tool\n+function Find-java-Artifacts-For-Apireview($artifactDir, $pkgName = \"\")\n+{\n+  Write-Host \"Checking for source jar in artifact path $($artifactDir)\"\n+  # Find all source jar files in given artifact directory\n+  $files = Get-ChildItem \"${artifactDir}\" | Where-Object -FilterScript {$_.Name.EndsWith(\"sources.jar\")}\n+  if (!$files)\n+  {\n+    Write-Host \"$($artifactDir) does not have any package\"\n+    exit(1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6821888e617b7f432d0b8be9ae6b9356a539c11b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNTQ0NDA2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18073#pullrequestreview-550544406", "createdAt": "2020-12-11T20:11:46Z", "commit": {"oid": "6821888e617b7f432d0b8be9ae6b9356a539c11b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMDoxMTo0NlrOIEKd0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMDoxMTo0NlrOIEKd0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIzNjY4OA==", "bodyText": "When you move this to common you should also move the name of this function to common.ps1, see https://github.com/Azure/azure-sdk-tools/blob/master/eng/common/scripts/common.ps1#L33.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18073#discussion_r541236688", "createdAt": "2020-12-11T20:11:46Z", "author": {"login": "weshaggard"}, "path": "eng/scripts/Create-APIReview.ps1", "diffHunk": "@@ -0,0 +1,103 @@\n+[CmdletBinding()]\n+Param (\n+  [Parameter(Mandatory=$True)]\n+  [string] $ArtifactPath,\n+  [Parameter(Mandatory=$True)]\n+  [string] $APIViewUri,\n+  [Parameter(Mandatory=$True)]\n+  [string] $APIKey,\n+  [Parameter(Mandatory=$True)]\n+  [string] $APILabel,\n+  [string] $PackageName = \"\"\n+)\n+\n+\n+# Submit API review request and return status whether current revision is approved or pending or failed to create review\n+function Submit-APIReview($packagename, $filePath, $uri, $apiKey, $apiLabel)\n+{\n+    $multipartContent = [System.Net.Http.MultipartFormDataContent]::new()\n+    $FileStream = [System.IO.FileStream]::new($filePath, [System.IO.FileMode]::Open)\n+    $fileHeader = [System.Net.Http.Headers.ContentDispositionHeaderValue]::new(\"form-data\")\n+    $fileHeader.Name = \"file\"\n+    $fileHeader.FileName = $packagename\n+    $fileContent = [System.Net.Http.StreamContent]::new($FileStream)\n+    $fileContent.Headers.ContentDisposition = $fileHeader\n+    $fileContent.Headers.ContentType = [System.Net.Http.Headers.MediaTypeHeaderValue]::Parse(\"application/octet-stream\")\n+    $multipartContent.Add($fileContent)\n+\n+\n+    $stringHeader = [System.Net.Http.Headers.ContentDispositionHeaderValue]::new(\"form-data\")\n+    $stringHeader.Name = \"label\"\n+    $StringContent = [System.Net.Http.StringContent]::new($apiLabel)\n+    $StringContent.Headers.ContentDisposition = $stringHeader\n+    $multipartContent.Add($stringContent)\n+\n+    $headers = @{\n+        \"ApiKey\" = $apiKey;\n+        \"content-type\" = \"multipart/form-data\"\n+    }\n+\n+    try\n+    {\n+        $Response = Invoke-WebRequest -Method 'POST' -Uri $uri -Body $multipartContent -Headers $headers\n+        $StatusCode = $Response.StatusCode\n+    }\n+    catch\n+    {\n+        $StatusCode = $_.Exception.Response.StatusCode\n+    }\n+\n+    return $StatusCode\n+}\n+\n+\n+. (Join-Path $PSScriptRoot Language-Settings.ps1)\n+$packages = @{}\n+if (Test-Path \"Function:Find-java-Artifacts-For-Apireview\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6821888e617b7f432d0b8be9ae6b9356a539c11b"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNTQ0ODE2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18073#pullrequestreview-550544816", "createdAt": "2020-12-11T20:12:29Z", "commit": {"oid": "6821888e617b7f432d0b8be9ae6b9356a539c11b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMDoxMjozMFrOIEKgwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMDoxMjozMFrOIEKgwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIzNzQ0MQ==", "bodyText": "This will want to include common.ps1 once you move to eng/common.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18073#discussion_r541237441", "createdAt": "2020-12-11T20:12:30Z", "author": {"login": "weshaggard"}, "path": "eng/scripts/Create-APIReview.ps1", "diffHunk": "@@ -0,0 +1,103 @@\n+[CmdletBinding()]\n+Param (\n+  [Parameter(Mandatory=$True)]\n+  [string] $ArtifactPath,\n+  [Parameter(Mandatory=$True)]\n+  [string] $APIViewUri,\n+  [Parameter(Mandatory=$True)]\n+  [string] $APIKey,\n+  [Parameter(Mandatory=$True)]\n+  [string] $APILabel,\n+  [string] $PackageName = \"\"\n+)\n+\n+\n+# Submit API review request and return status whether current revision is approved or pending or failed to create review\n+function Submit-APIReview($packagename, $filePath, $uri, $apiKey, $apiLabel)\n+{\n+    $multipartContent = [System.Net.Http.MultipartFormDataContent]::new()\n+    $FileStream = [System.IO.FileStream]::new($filePath, [System.IO.FileMode]::Open)\n+    $fileHeader = [System.Net.Http.Headers.ContentDispositionHeaderValue]::new(\"form-data\")\n+    $fileHeader.Name = \"file\"\n+    $fileHeader.FileName = $packagename\n+    $fileContent = [System.Net.Http.StreamContent]::new($FileStream)\n+    $fileContent.Headers.ContentDisposition = $fileHeader\n+    $fileContent.Headers.ContentType = [System.Net.Http.Headers.MediaTypeHeaderValue]::Parse(\"application/octet-stream\")\n+    $multipartContent.Add($fileContent)\n+\n+\n+    $stringHeader = [System.Net.Http.Headers.ContentDispositionHeaderValue]::new(\"form-data\")\n+    $stringHeader.Name = \"label\"\n+    $StringContent = [System.Net.Http.StringContent]::new($apiLabel)\n+    $StringContent.Headers.ContentDisposition = $stringHeader\n+    $multipartContent.Add($stringContent)\n+\n+    $headers = @{\n+        \"ApiKey\" = $apiKey;\n+        \"content-type\" = \"multipart/form-data\"\n+    }\n+\n+    try\n+    {\n+        $Response = Invoke-WebRequest -Method 'POST' -Uri $uri -Body $multipartContent -Headers $headers\n+        $StatusCode = $Response.StatusCode\n+    }\n+    catch\n+    {\n+        $StatusCode = $_.Exception.Response.StatusCode\n+    }\n+\n+    return $StatusCode\n+}\n+\n+\n+. (Join-Path $PSScriptRoot Language-Settings.ps1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6821888e617b7f432d0b8be9ae6b9356a539c11b"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNTQ3Mzg0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18073#pullrequestreview-550547384", "createdAt": "2020-12-11T20:16:36Z", "commit": {"oid": "6821888e617b7f432d0b8be9ae6b9356a539c11b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ec735a511354c66a91778556121c9e531dfba7f", "author": {"user": {"login": "praveenkuttappan", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8ec735a511354c66a91778556121c9e531dfba7f", "committedDate": "2020-12-11T20:31:01Z", "message": "Additional fix as per review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1180, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}