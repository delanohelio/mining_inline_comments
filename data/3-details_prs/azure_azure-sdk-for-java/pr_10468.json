{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MTk3Nzkw", "number": 10468, "title": "Addressing leak in KeyVaultCredentailPolicy.", "bodyText": "Related issues:\n#7934\n#6096\nThe HttpResponse::close in azure-core needs to be revisited to see whether similar logic is needed there as well, due to the bigger scope we require more time to understand why current disposal of connection is not sufficient. Tracking issue on core #10467", "createdAt": "2020-04-23T21:06:35Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10468", "merged": true, "mergeCommit": {"oid": "68700843a80e45fc323b4d4dc91b80c27cafb438"}, "closed": true, "closedAt": "2020-04-24T00:41:10Z", "author": {"login": "anuchandy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcajptggFqTM5OTQ4NTQwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcak3SWgBqjMyNjcxNzM5Njg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NDg1NDA0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10468#pullrequestreview-399485404", "createdAt": "2020-04-23T21:20:17Z", "commit": {"oid": "5ed702a781bddca0d9ac7b1f7416bd7e18f8319f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMToyMDoxN1rOGK8nkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMToyMDoxN1rOGK8nkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEzMjExMw==", "bodyText": "Should this throwable be logged as warning?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10468#discussion_r414132113", "createdAt": "2020-04-23T21:20:17Z", "author": {"login": "srnagar"}, "path": "sdk/keyvault/azure-security-keyvault-secrets/src/main/java/com/azure/security/keyvault/secrets/implementation/KeyVaultCredentialPolicy.java", "diffHunk": "@@ -52,8 +52,20 @@ public KeyVaultCredentialPolicy(TokenCredential credential) {\n             return Mono.error(new RuntimeException(\"Token credentials require a URL using the HTTPS protocol scheme\"));\n         }\n         return next.clone().process()\n-            // Ignore body\n-            .doOnNext(HttpResponse::close)\n+            .doOnNext(httpResponse -> {\n+                // KV follows challenge based auth. Currently every service\n+                // call hit the endpoint for challenge and then resend the\n+                // request with token. The challenge response body is not\n+                // consumed, not draining/closing the body will result in leak.\n+                // Ref: https://github.com/Azure/azure-sdk-for-java/issues/7934\n+                try {\n+                    httpResponse.getBody().subscribe().dispose();\n+                } catch (Throwable ignored) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ed702a781bddca0d9ac7b1f7416bd7e18f8319f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NDg3ODQ1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10468#pullrequestreview-399487845", "createdAt": "2020-04-23T21:24:19Z", "commit": {"oid": "5ed702a781bddca0d9ac7b1f7416bd7e18f8319f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac0538f345a5d7aec6bd3e6cdf2d1fbf5aba8ef0", "author": {"user": {"login": "anuchandy", "name": "Anu Thomas Chandy"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ac0538f345a5d7aec6bd3e6cdf2d1fbf5aba8ef0", "committedDate": "2020-04-23T22:44:47Z", "message": "Addressing leak in KeyVaultCredentailPolicy."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ed702a781bddca0d9ac7b1f7416bd7e18f8319f", "author": {"user": {"login": "anuchandy", "name": "Anu Thomas Chandy"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ed702a781bddca0d9ac7b1f7416bd7e18f8319f", "committedDate": "2020-04-23T21:04:58Z", "message": "Addressing leak in KeyVaultCredentailPolicy."}, "afterCommit": {"oid": "ac0538f345a5d7aec6bd3e6cdf2d1fbf5aba8ef0", "author": {"user": {"login": "anuchandy", "name": "Anu Thomas Chandy"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ac0538f345a5d7aec6bd3e6cdf2d1fbf5aba8ef0", "committedDate": "2020-04-23T22:44:47Z", "message": "Addressing leak in KeyVaultCredentailPolicy."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4817, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}