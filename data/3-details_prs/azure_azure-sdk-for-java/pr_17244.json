{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NDM3NjUw", "number": 17244, "title": "Add Additional Search Batching Configurations", "bodyText": "This PR adds new configurations for Search document batching:\n\ninitialBatchActionCount: The number of documents required in the batch to trigger automatic flushing.\nmaxRetries: The number of times a document will be able to retry before being \"dead lettered\".\nretryDelay: A back-off duration for requests when the service is throttling.\nmaxRetryDelay: The maximum back-off duration for requests when the service is throttling.", "createdAt": "2020-11-06T01:32:20Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244", "merged": true, "mergeCommit": {"oid": "9d1ab226d451d3a28a9553f9e4ee9d9bb5ebd1d8"}, "closed": true, "closedAt": "2020-11-06T23:26:31Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZssSGAH2gAyNTE2NDM3NjUwOmNiODUzMzY5ZWMwMDRiYzYxY2Y5OWY1YjIwMmY1NGFkOGYzMTU2OWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ_czGgFqTUyNTU1MjA0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb853369ec004bc61cf99f5b202f54ad8f31569c", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cb853369ec004bc61cf99f5b202f54ad8f31569c", "committedDate": "2020-11-06T01:29:32Z", "message": "Expose initial batch action count and max retries configurations, add retry and max retry delay configurations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MzYzMjA1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525363205", "createdAt": "2020-11-06T17:40:54Z", "commit": {"oid": "cb853369ec004bc61cf99f5b202f54ad8f31569c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzo0MDo1NVrOHu3bGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzo0MDo1NVrOHu3bGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkwNDYwMw==", "bodyText": "I hide BatchSize in Python for this release. Do we want to expose InitialBatchActionCount to users?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#discussion_r518904603", "createdAt": "2020-11-06T17:40:55Z", "author": {"login": "xiangyan99"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingBufferedSender.java", "diffHunk": "@@ -32,12 +32,14 @@\n     }\n \n     /**\n-     * Gets the batch size.\n+     * Gets the number of documents required in a batch for it to be flushed.\n+     * <p>\n+     * This configuration is only taken into account if auto flushing is enabled.\n      *\n-     * @return The batch size.\n+     * @return The number of documents required before a flush is triggered.\n      */\n-    public int getBatchSize() {\n-        return client.getBatchSize();\n+    public int getInitialBatchActionCount() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb853369ec004bc61cf99f5b202f54ad8f31569c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MzY0NDY1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525364465", "createdAt": "2020-11-06T17:42:42Z", "commit": {"oid": "cb853369ec004bc61cf99f5b202f54ad8f31569c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzo0Mjo0MlrOHu3ekw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzo0Mjo0MlrOHu3ekw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkwNTQ5MQ==", "bodyText": "Maybe we'd better use property name batchActionCount?\nInitialBatchActionCount is only its initial value, we may change the value when we tune it dynamically.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#discussion_r518905491", "createdAt": "2020-11-06T17:42:42Z", "author": {"login": "xiangyan99"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingBufferedSenderOptions.java", "diffHunk": "@@ -21,16 +21,20 @@\n  */\n public final class SearchIndexingBufferedSenderOptions<T> {\n     private static final boolean DEFAULT_AUTO_FLUSH = true;\n-    private static final int DEFAULT_BATCH_SIZE = 500;\n+    private static final int DEFAULT_INITIAL_BATCH_ACTION_COUNT = 512;\n     private static final Duration DEFAULT_FLUSH_WINDOW = Duration.ofSeconds(60);\n-    private static final int DEFAULT_DOCUMENT_TRY_LIMIT = 3;\n+    private static final int DEFAULT_MAX_RETRIES = 3;\n+    private static final Duration DEFAULT_RETRY_DELAY = Duration.ofMillis(800);\n+    private static final Duration DEFAULT_MAX_RETRY_DELAY = Duration.ofMinutes(1);\n \n     private final ClientLogger logger = new ClientLogger(SearchIndexingBufferedSenderOptions.class);\n \n     private Boolean autoFlush;\n     private Duration autoFlushWindow;\n-    private Integer batchSize;\n-    private Integer documentTryLimit;\n+    private Integer initialBatchActionCount;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb853369ec004bc61cf99f5b202f54ad8f31569c"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b260868dc80afad452e52ca423e88cd0a1ffe32", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1b260868dc80afad452e52ca423e88cd0a1ffe32", "committedDate": "2020-11-06T17:47:53Z", "message": "Merge branch 'master' into AzSearch_AddAdditionalBatchOptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3b1329894f9744653bd3d3d2a81965ee254cc762", "committedDate": "2020-11-06T18:38:43Z", "message": "Hide getInitialBatchActionCount from public API, renamed internal properties, and updated correlation logic of document operation response to request document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NDIyODE4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525422818", "createdAt": "2020-11-06T19:11:26Z", "commit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOToxMToyN1rOHu6Q9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOToxMToyN1rOHu6Q9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk1MTE1OA==", "bodyText": "Do we need to hide it here as well?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#discussion_r518951158", "createdAt": "2020-11-06T19:11:27Z", "author": {"login": "xiangyan99"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingBufferedSenderOptions.java", "diffHunk": "@@ -123,38 +127,96 @@ public Duration getAutoFlushWindow() {\n      *\n      * @return The number of documents required before a flush is triggered.\n      */\n-    int getBatchSize() {\n-        return (batchSize == null) ? DEFAULT_BATCH_SIZE : batchSize;\n+    public int getInitialBatchActionCount() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "originalPosition": 102}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NDIzNjE4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525423618", "createdAt": "2020-11-06T19:12:51Z", "commit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTM4MDI2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525538026", "createdAt": "2020-11-06T22:39:29Z", "commit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjozOToyOVrOHu_s0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjozOToyOVrOHu_s0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA0MDIxMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param maxRetries The number of times a document will attempt indexing before it is considered failed.\n          \n          \n            \n                 * @param maxRetries The number of times a document will retry indexing before it is considered failed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#discussion_r519040211", "createdAt": "2020-11-06T22:39:29Z", "author": {"login": "mssfang"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingBufferedSenderOptions.java", "diffHunk": "@@ -123,38 +127,96 @@ public Duration getAutoFlushWindow() {\n      *\n      * @return The number of documents required before a flush is triggered.\n      */\n-    int getBatchSize() {\n-        return (batchSize == null) ? DEFAULT_BATCH_SIZE : batchSize;\n+    public int getInitialBatchActionCount() {\n+        return (initialBatchActionCount == null) ? DEFAULT_INITIAL_BATCH_ACTION_COUNT : initialBatchActionCount;\n     }\n \n     /**\n-     * The number of times a document will attempt indexing before it is considered failed.\n+     * Sets the number of times a document will retry indexing before it is considered failed.\n      * <p>\n      * Documents are only retried on retryable status codes.\n      * <p>\n      * Default value is {@code 3}.\n      *\n-     * @param documentTryLimit The number of times a document will attempt indexing before it is considered failed.\n+     * @param maxRetries The number of times a document will attempt indexing before it is considered failed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "originalPosition": 115}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTM5MTU5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525539159", "createdAt": "2020-11-06T22:42:19Z", "commit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjo0MjoxOVrOHu_w3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjo0MjoxOVrOHu_w3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA0MTI0NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Gets the initial duration that requests will be delay when the service is throttling.\n          \n          \n            \n                 * Gets the initial duration that requests will be delayed when the service is throttling.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#discussion_r519041245", "createdAt": "2020-11-06T22:42:19Z", "author": {"login": "mssfang"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingBufferedSenderOptions.java", "diffHunk": "@@ -123,38 +127,96 @@ public Duration getAutoFlushWindow() {\n      *\n      * @return The number of documents required before a flush is triggered.\n      */\n-    int getBatchSize() {\n-        return (batchSize == null) ? DEFAULT_BATCH_SIZE : batchSize;\n+    public int getInitialBatchActionCount() {\n+        return (initialBatchActionCount == null) ? DEFAULT_INITIAL_BATCH_ACTION_COUNT : initialBatchActionCount;\n     }\n \n     /**\n-     * The number of times a document will attempt indexing before it is considered failed.\n+     * Sets the number of times a document will retry indexing before it is considered failed.\n      * <p>\n      * Documents are only retried on retryable status codes.\n      * <p>\n      * Default value is {@code 3}.\n      *\n-     * @param documentTryLimit The number of times a document will attempt indexing before it is considered failed.\n+     * @param maxRetries The number of times a document will attempt indexing before it is considered failed.\n      * @return The updated SearchIndexingBufferedSenderOptions object.\n      * @throws IllegalArgumentException If {@code documentTryLimit} is less than one.\n      */\n-    SearchIndexingBufferedSenderOptions<T> setDocumentTryLimit(Integer documentTryLimit) {\n-        if (documentTryLimit != null && documentTryLimit < 1) {\n+    public SearchIndexingBufferedSenderOptions<T> setMaxRetries(Integer maxRetries) {\n+        if (maxRetries != null && maxRetries < 1) {\n             throw logger.logExceptionAsError(\n-                new IllegalArgumentException(\"'documentTryLimit' cannot be less than one.\"));\n+                new IllegalArgumentException(\"'maxRetries' cannot be less than one.\"));\n         }\n \n-        this.documentTryLimit = documentTryLimit;\n+        this.maxRetries = maxRetries;\n         return this;\n     }\n \n     /**\n-     * Gets the number of times a document will attempt indexing before it is considered failed.\n+     * Gets the number of times a document will retry indexing before it is considered failed.\n      *\n      * @return The number of times a document will attempt indexing.\n      */\n-    int getDocumentTryLimit() {\n-        return (documentTryLimit == null) ? DEFAULT_DOCUMENT_TRY_LIMIT : documentTryLimit;\n+    public int getMaxRetries() {\n+        return (maxRetries == null) ? DEFAULT_MAX_RETRIES : maxRetries;\n+    }\n+\n+    /**\n+     * Sets the initial duration that requests will be delayed when the service is throttling.\n+     * <p>\n+     * Default value is {@code Duration.ofMillis(800)}.\n+     *\n+     * @param retryDelay The initial duration requests will delay when the service is throttling.\n+     * @return The updated SearchIndexingBufferedSenderOptions object.\n+     * @throws IllegalArgumentException If {@code retryDelay.isNegative()} or {@code retryDelay.isZero()} is true.\n+     */\n+    public SearchIndexingBufferedSenderOptions<T> setRetryDelay(Duration retryDelay) {\n+        if (retryDelay != null && (retryDelay.isNegative() || retryDelay.isZero())) {\n+            throw logger.logExceptionAsError(new IllegalArgumentException(\"'retryDelay' cannot be negative or zero.\"));\n+        }\n+\n+        this.retryDelay = retryDelay;\n+        return this;\n+    }\n+\n+    /**\n+     * Gets the initial duration that requests will be delay when the service is throttling.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "originalPosition": 164}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTM5MzI3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525539327", "createdAt": "2020-11-06T22:42:45Z", "commit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjo0Mjo0NlrOHu_xiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjo0Mjo0NlrOHu_xiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA0MTQxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Sets the maximum duration that requests will be delay when the service is throttling.\n          \n          \n            \n                 * Sets the maximum duration that requests will be delayed when the service is throttling.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#discussion_r519041419", "createdAt": "2020-11-06T22:42:46Z", "author": {"login": "mssfang"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingBufferedSenderOptions.java", "diffHunk": "@@ -123,38 +127,96 @@ public Duration getAutoFlushWindow() {\n      *\n      * @return The number of documents required before a flush is triggered.\n      */\n-    int getBatchSize() {\n-        return (batchSize == null) ? DEFAULT_BATCH_SIZE : batchSize;\n+    public int getInitialBatchActionCount() {\n+        return (initialBatchActionCount == null) ? DEFAULT_INITIAL_BATCH_ACTION_COUNT : initialBatchActionCount;\n     }\n \n     /**\n-     * The number of times a document will attempt indexing before it is considered failed.\n+     * Sets the number of times a document will retry indexing before it is considered failed.\n      * <p>\n      * Documents are only retried on retryable status codes.\n      * <p>\n      * Default value is {@code 3}.\n      *\n-     * @param documentTryLimit The number of times a document will attempt indexing before it is considered failed.\n+     * @param maxRetries The number of times a document will attempt indexing before it is considered failed.\n      * @return The updated SearchIndexingBufferedSenderOptions object.\n      * @throws IllegalArgumentException If {@code documentTryLimit} is less than one.\n      */\n-    SearchIndexingBufferedSenderOptions<T> setDocumentTryLimit(Integer documentTryLimit) {\n-        if (documentTryLimit != null && documentTryLimit < 1) {\n+    public SearchIndexingBufferedSenderOptions<T> setMaxRetries(Integer maxRetries) {\n+        if (maxRetries != null && maxRetries < 1) {\n             throw logger.logExceptionAsError(\n-                new IllegalArgumentException(\"'documentTryLimit' cannot be less than one.\"));\n+                new IllegalArgumentException(\"'maxRetries' cannot be less than one.\"));\n         }\n \n-        this.documentTryLimit = documentTryLimit;\n+        this.maxRetries = maxRetries;\n         return this;\n     }\n \n     /**\n-     * Gets the number of times a document will attempt indexing before it is considered failed.\n+     * Gets the number of times a document will retry indexing before it is considered failed.\n      *\n      * @return The number of times a document will attempt indexing.\n      */\n-    int getDocumentTryLimit() {\n-        return (documentTryLimit == null) ? DEFAULT_DOCUMENT_TRY_LIMIT : documentTryLimit;\n+    public int getMaxRetries() {\n+        return (maxRetries == null) ? DEFAULT_MAX_RETRIES : maxRetries;\n+    }\n+\n+    /**\n+     * Sets the initial duration that requests will be delayed when the service is throttling.\n+     * <p>\n+     * Default value is {@code Duration.ofMillis(800)}.\n+     *\n+     * @param retryDelay The initial duration requests will delay when the service is throttling.\n+     * @return The updated SearchIndexingBufferedSenderOptions object.\n+     * @throws IllegalArgumentException If {@code retryDelay.isNegative()} or {@code retryDelay.isZero()} is true.\n+     */\n+    public SearchIndexingBufferedSenderOptions<T> setRetryDelay(Duration retryDelay) {\n+        if (retryDelay != null && (retryDelay.isNegative() || retryDelay.isZero())) {\n+            throw logger.logExceptionAsError(new IllegalArgumentException(\"'retryDelay' cannot be negative or zero.\"));\n+        }\n+\n+        this.retryDelay = retryDelay;\n+        return this;\n+    }\n+\n+    /**\n+     * Gets the initial duration that requests will be delay when the service is throttling.\n+     *\n+     * @return The initial duration requests will delay when the service is throttling.\n+     */\n+    public Duration getRetryDelay() {\n+        return (retryDelay == null) ? DEFAULT_RETRY_DELAY : retryDelay;\n+    }\n+\n+    /**\n+     * Sets the maximum duration that requests will be delay when the service is throttling.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "originalPosition": 173}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b221bb48f4629d1091b5b977c395daa67b144ccc", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b221bb48f4629d1091b5b977c395daa67b144ccc", "committedDate": "2020-11-06T22:44:43Z", "message": "Update sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingBufferedSenderOptions.java\n\nCo-authored-by: Shawn Fang <45607042+mssfang@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a23fbf8a6c56872152eacb25ece685c04af35bd2", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a23fbf8a6c56872152eacb25ece685c04af35bd2", "committedDate": "2020-11-06T22:44:54Z", "message": "Update sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingBufferedSenderOptions.java\n\nCo-authored-by: Shawn Fang <45607042+mssfang@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83279d98fffa0ff0d803f9c20d95b6c794717135", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/83279d98fffa0ff0d803f9c20d95b6c794717135", "committedDate": "2020-11-06T22:45:04Z", "message": "Update sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingBufferedSenderOptions.java\n\nCo-authored-by: Shawn Fang <45607042+mssfang@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTQyNzA3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525542707", "createdAt": "2020-11-06T22:51:41Z", "commit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjo1MTo0MVrOHu_8pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjo1MTo0MVrOHu_8pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA0NDI2MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (exception.getResponse().getStatusCode() == HttpURLConnection.HTTP_ENTITY_TOO_LARGE) {\n          \n          \n            \n                            if (statusCode == HttpURLConnection.HTTP_ENTITY_TOO_LARGE) {", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#discussion_r519044261", "createdAt": "2020-11-06T22:51:41Z", "author": {"login": "mssfang"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingPublisher.java", "diffHunk": "@@ -159,20 +176,23 @@ int getBatchSize() {\n         List<com.azure.search.documents.implementation.models.IndexAction> actions, int actionsOffset,\n         Context context) {\n         return client.indexDocumentsWithResponse(actions, true, context)\n+            .delaySubscription(currentRetryDelay)\n             .flatMapMany(response -> Flux.just(\n-                new IndexBatchResponse(response.getValue().getResults(), actionsOffset, actions.size(), false)))\n+                new IndexBatchResponse(response.getStatusCode(), response.getValue().getResults(), actionsOffset,\n+                    actions.size(), false)))\n             .onErrorResume(IndexBatchException.class, exception -> Flux\n-                .just(new IndexBatchResponse(exception.getIndexingResults(), actionsOffset, actions.size(), true)))\n+                .just(new IndexBatchResponse(207, exception.getIndexingResults(), actionsOffset, actions.size(), true)))\n             .onErrorResume(HttpResponseException.class, exception -> {\n                 /*\n                  * If we received an error response where the payload was too large split it into two smaller payloads\n                  * and attempt to index again. If the number of index actions was one raise the error as we cannot split\n                  * that any further.\n                  */\n+                int statusCode = exception.getResponse().getStatusCode();\n                 if (exception.getResponse().getStatusCode() == HttpURLConnection.HTTP_ENTITY_TOO_LARGE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "originalPosition": 111}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4da41f93e11c04ae9049d7e68fde4c263fcfef38", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4da41f93e11c04ae9049d7e68fde4c263fcfef38", "committedDate": "2020-11-06T22:56:28Z", "message": "Update sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingPublisher.java\n\nCo-authored-by: Shawn Fang <45607042+mssfang@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTQ3NTU5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525547559", "createdAt": "2020-11-06T23:06:16Z", "commit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMzowNjoxN1rOHvAM6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMzowNjoxN1rOHvAM6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA0ODQyNg==", "bodyText": "does the order of action matters?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#discussion_r519048426", "createdAt": "2020-11-06T23:06:17Z", "author": {"login": "mssfang"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchIndexingPublisher.java", "diffHunk": "@@ -182,48 +202,70 @@ int getBatchSize() {\n                     );\n                 }\n \n-                return Flux.just(new IndexBatchResponse(null, actionsOffset, actions.size(), true));\n+                return Flux.just(new IndexBatchResponse(statusCode, null, actionsOffset, actions.size(), true));\n             });\n     }\n \n     private void handleResponse(List<TryTrackingIndexAction<T>> actions, IndexBatchResponse batchResponse) {\n         /*\n          * Batch has been split until it had one document in it and it returned a 413 response.\n          */\n-        if (batchResponse.getResults() == null && batchResponse.getCount() == 1) {\n+        if (batchResponse.getStatusCode() == HttpURLConnection.HTTP_ENTITY_TOO_LARGE && batchResponse.getCount() == 1) {\n             IndexAction<T> action = actions.get(batchResponse.getOffset()).getAction();\n             onActionErrorBiConsumer.accept(action,\n                 new RuntimeException(\"Document is too large to be indexed and won't be tried again.\"));\n             return;\n         }\n \n+        List<TryTrackingIndexAction<T>> actionsToRetry = new ArrayList<>();\n+        boolean has503 = batchResponse.getStatusCode() == HttpURLConnection.HTTP_UNAVAILABLE;\n         if (batchResponse.getResults() == null) {\n-            return;\n-        }\n+            /*\n+             * Null results indicates that the entire request failed. Retry all documents.\n+             */\n+            int offset = batchResponse.getOffset();\n+            actionsToRetry.addAll(actions.subList(offset, offset + batchResponse.getCount()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b1329894f9744653bd3d3d2a81965ee254cc762"}, "originalPosition": 149}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTUyMDQw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17244#pullrequestreview-525552040", "createdAt": "2020-11-06T23:20:49Z", "commit": {"oid": "4da41f93e11c04ae9049d7e68fde4c263fcfef38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 298, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}