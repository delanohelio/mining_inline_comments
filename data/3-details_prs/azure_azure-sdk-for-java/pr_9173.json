{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMDk0MzI1", "number": 9173, "title": "Fixing SB tests and message properties. Adds create batch.", "bodyText": "Fixing ServiceBusReceivedMessage.expiresAt method to be calculated.\nFixes #9166\nFixes #8769", "createdAt": "2020-03-17T21:47:12Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9173", "merged": true, "mergeCommit": {"oid": "ac19330606d6b8277e64f4eca3e6a1369353741b"}, "closed": true, "closedAt": "2020-03-20T16:54:50Z", "author": {"login": "conniey"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO70n7ABqjMxNDI3MjQxMTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPjV3_gH2gAyMzkwMDk0MzI1OjhmZjQ2OWJjNDM5NDgzMWRkZjhlNTg1ZWE5ODZjOWEzNGE1NDI1OWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32b9adc9f0a6a3999e18d138168e1c3d77056d85", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/32b9adc9f0a6a3999e18d138168e1c3d77056d85", "committedDate": "2020-03-18T18:38:58Z", "message": "Adding tests."}, "afterCommit": {"oid": "7e5aa06f5a0d3152d2a50121e86ee11ec2b1fecf", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7e5aa06f5a0d3152d2a50121e86ee11ec2b1fecf", "committedDate": "2020-03-18T18:42:38Z", "message": "Adding tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTg5NDk5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9173#pullrequestreview-378189499", "createdAt": "2020-03-20T01:12:38Z", "commit": {"oid": "a939d2481f305ab67eb72abea04c378a7f5c111a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMToxMjozOVrOF5FSnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMToxMjozOVrOF5FSnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM5OTgzNg==", "bodyText": "Should we use the term event or  message for Service bus?\ncreatesMessageBatchWithSize", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9173#discussion_r395399836", "createdAt": "2020-03-20T01:12:39Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/test/java/com/azure/messaging/servicebus/ServiceBusSenderAsyncClientTest.java", "diffHunk": "@@ -125,6 +124,108 @@ void teardown() {\n         messagesCaptor = null;\n     }\n \n+    /**\n+     * Verifies that the correct Service Bus properties are set.\n+     */\n+    @Test\n+    void verifyProperties() {\n+        Assertions.assertEquals(ENTITY_NAME, sender.getEntityName());\n+        Assertions.assertEquals(NAMESPACE, sender.getFullyQualifiedNamespace());\n+    }\n+\n+    /**\n+     * Verifies that an exception is thrown when we create a batch with null options.\n+     */\n+    @Test\n+    void createBatchNull() {\n+        Assertions.assertThrows(NullPointerException.class, () -> sender.createBatch(null));\n+    }\n+\n+    /**\n+     * Verifies that the default batch is the same size as the message link.\n+     */\n+    @Test\n+    void createBatchDefault() {\n+        // Arrange\n+        when(connection.createSendLink(eq(ENTITY_NAME), eq(ENTITY_NAME), any(AmqpRetryOptions.class)))\n+            .thenReturn(Mono.just(sendLink));\n+        when(sendLink.getLinkSize()).thenReturn(Mono.just(MAX_MESSAGE_LENGTH_BYTES));\n+\n+        // Act & Assert\n+        StepVerifier.create(sender.createBatch())\n+            .assertNext(batch -> {\n+                Assertions.assertEquals(MAX_MESSAGE_LENGTH_BYTES, batch.getMaxSizeInBytes());\n+                Assertions.assertEquals(0, batch.getCount());\n+            })\n+            .verifyComplete();\n+    }\n+\n+    /**\n+     * Verifies we cannot create a batch if the options size is larger than the link.\n+     */\n+    @Test\n+    void createBatchWhenSizeTooBig() {\n+        // Arrange\n+        int maxLinkSize = 1024;\n+        int batchSize = maxLinkSize + 10;\n+\n+        final AmqpSendLink link = mock(AmqpSendLink.class);\n+        when(link.getLinkSize()).thenReturn(Mono.just(maxLinkSize));\n+\n+        when(connection.createSendLink(eq(ENTITY_NAME), eq(ENTITY_NAME), eq(retryOptions)))\n+            .thenReturn(Mono.just(link));\n+\n+        // This event is 1024 bytes when serialized.\n+        final CreateBatchOptions options = new CreateBatchOptions().setMaximumSizeInBytes(batchSize);\n+\n+        // Act & Assert\n+        StepVerifier.create(sender.createBatch(options))\n+            .expectError(IllegalArgumentException.class)\n+            .verify();\n+    }\n+\n+    /**\n+     * Verifies that the producer can create a batch with a given {@link CreateBatchOptions#getMaximumSizeInBytes()}.\n+     */\n+    @Test\n+    void createsEventDataBatchWithSize() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a939d2481f305ab67eb72abea04c378a7f5c111a"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTkxMjM1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9173#pullrequestreview-378191235", "createdAt": "2020-03-20T01:20:14Z", "commit": {"oid": "a939d2481f305ab67eb72abea04c378a7f5c111a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f537dac63a7cade0768d071dac10fdbe0f6b19eb", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f537dac63a7cade0768d071dac10fdbe0f6b19eb", "committedDate": "2020-03-20T14:00:50Z", "message": "Splitting sinks."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5ab9d97e872306ea266b53495ba262b3bc0c7bc", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c5ab9d97e872306ea266b53495ba262b3bc0c7bc", "committedDate": "2020-03-20T14:00:50Z", "message": "Fixing calculated time."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58410b7413de14c0dcb9e37507d7c6b8b4b5cdd9", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/58410b7413de14c0dcb9e37507d7c6b8b4b5cdd9", "committedDate": "2020-03-20T14:00:50Z", "message": "Fix tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b5f5b77e00c72e87d96d942d37558268ddd2a50", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5b5f5b77e00c72e87d96d942d37558268ddd2a50", "committedDate": "2020-03-20T14:00:51Z", "message": "Fix documentation on interface."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f869ed4fdefad485df91595dea8f54ffb9c8c0b", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f869ed4fdefad485df91595dea8f54ffb9c8c0b", "committedDate": "2020-03-20T14:00:51Z", "message": "Fixing spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a97bcd11401dfe919661b598522b834c7422489d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a97bcd11401dfe919661b598522b834c7422489d", "committedDate": "2020-03-20T14:00:52Z", "message": "Adding test for deadletter with properties."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "155359343f8be4d537551d506c9e909a2eae89b0", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/155359343f8be4d537551d506c9e909a2eae89b0", "committedDate": "2020-03-20T14:00:52Z", "message": "Exposing a way to create Message Batches."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6a5e02ff224eaf4d2723494ba03d505b7d18273", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e6a5e02ff224eaf4d2723494ba03d505b7d18273", "committedDate": "2020-03-20T14:00:52Z", "message": "Adding tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d4e17e14520282948968da93a109a1e45a3dab6", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d4e17e14520282948968da93a109a1e45a3dab6", "committedDate": "2020-03-20T14:00:52Z", "message": "Enabling tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bbc86e283bd54e83536e856efae8f63d3c4741a", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9bbc86e283bd54e83536e856efae8f63d3c4741a", "committedDate": "2020-03-20T14:00:53Z", "message": "Adding await."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b134f60f5c3faae0c6725c7461f8d5fff3fe8c52", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b134f60f5c3faae0c6725c7461f8d5fff3fe8c52", "committedDate": "2020-03-20T14:00:53Z", "message": "Fix checkstyles."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0725c2a6d81eb7485a871e1e8b326482c614efd3", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0725c2a6d81eb7485a871e1e8b326482c614efd3", "committedDate": "2020-03-20T14:00:53Z", "message": "Adding scheduler."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a939d2481f305ab67eb72abea04c378a7f5c111a", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a939d2481f305ab67eb72abea04c378a7f5c111a", "committedDate": "2020-03-18T19:12:24Z", "message": "Adding scheduler."}, "afterCommit": {"oid": "c90158958d792d8c13448c059429ca40f93b4d43", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c90158958d792d8c13448c059429ca40f93b4d43", "committedDate": "2020-03-20T16:09:41Z", "message": "Using Flux.usingWhen()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c90158958d792d8c13448c059429ca40f93b4d43", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c90158958d792d8c13448c059429ca40f93b4d43", "committedDate": "2020-03-20T16:09:41Z", "message": "Using Flux.usingWhen()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7eee27652745cb9e19c5466a5a37b1ba9691a53", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d7eee27652745cb9e19c5466a5a37b1ba9691a53", "committedDate": "2020-03-20T16:11:44Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36143976fb5bbf33bae0f19ec6fb9238413392c1", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/36143976fb5bbf33bae0f19ec6fb9238413392c1", "committedDate": "2020-03-20T16:24:40Z", "message": "Removing unused constants."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c08ccd976a9947a5dc2072f7864f0b05bf6ca7a3", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c08ccd976a9947a5dc2072f7864f0b05bf6ca7a3", "committedDate": "2020-03-20T16:31:47Z", "message": "Adding test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0b847cc07d520357cd7a8f2f39ef45139755165", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d0b847cc07d520357cd7a8f2f39ef45139755165", "committedDate": "2020-03-20T16:41:38Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ff469bc4394831ddf8e585ea986c9a34a54259d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8ff469bc4394831ddf8e585ea986c9a34a54259d", "committedDate": "2020-03-20T16:45:31Z", "message": "Reducing delay"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 709, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}