{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NzI2MzEy", "number": 10495, "title": "Sync Sender Client :  Adding Schedule and cancel schedule", "bodyText": "Adding Feature in Sync Sender Client\n\nSchedule  a message\nCancel scheduled message", "createdAt": "2020-04-24T19:28:39Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10495", "merged": true, "mergeCommit": {"oid": "0f8854973049a369bfaf555df73536042079b4aa"}, "closed": true, "closedAt": "2020-04-24T22:58:21Z", "author": {"login": "hemanttanwar"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca2odpgH2gAyNDA4NzI2MzEyOmU4YWYzYjU5NTNiYjg5MDE1MTQxNmU3YjFhZGM1MGYzZjlkNDZiNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca5GVKgH2gAyNDA4NzI2MzEyOjM1NzFjMzc3OGZjMzJmZThlZjllOWFjM2RiYzFkMmRhOGQzZGMwNTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e8af3b5953bb890151416e7b1adc50f3f9d46b61", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e8af3b5953bb890151416e7b1adc50f3f9d46b61", "committedDate": "2020-04-24T19:27:11Z", "message": "Adding schedule and scncel schedule in sync sender"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3179e87b29fc9e78a6622fc3bb4d1fa061cd8ef2", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3179e87b29fc9e78a6622fc3bb4d1fa061cd8ef2", "committedDate": "2020-04-24T19:30:14Z", "message": "Adding some test details"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjIxMzEy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10495#pullrequestreview-400221312", "createdAt": "2020-04-24T19:38:55Z", "commit": {"oid": "3179e87b29fc9e78a6622fc3bb4d1fa061cd8ef2"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxOTozODo1NlrOGLmdSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxOTo0MDo0MVrOGLmgxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxNzYwOQ==", "bodyText": "Queue or topic?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10495#discussion_r414817609", "createdAt": "2020-04-24T19:38:56Z", "author": {"login": "conniey"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusSenderClient.java", "diffHunk": "@@ -70,6 +72,32 @@ public void send(ServiceBusMessage message) {\n         asyncClient.send(message).block(tryTimeout);\n     }\n \n+    /**\n+     * Sends a scheduled message to the Azure Service Bus entity this sender is connected to. A scheduled message is\n+     * enqueued and made available to receivers only at the scheduled enqueue time.\n+     *\n+     * @param message Message to be sent to the Service Bus Queue.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3179e87b29fc9e78a6622fc3bb4d1fa061cd8ef2"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxNzgyNQ==", "bodyText": "service bus -> Service Bus", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10495#discussion_r414817825", "createdAt": "2020-04-24T19:39:22Z", "author": {"login": "conniey"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusSenderClient.java", "diffHunk": "@@ -70,6 +72,32 @@ public void send(ServiceBusMessage message) {\n         asyncClient.send(message).block(tryTimeout);\n     }\n \n+    /**\n+     * Sends a scheduled message to the Azure Service Bus entity this sender is connected to. A scheduled message is\n+     * enqueued and made available to receivers only at the scheduled enqueue time.\n+     *\n+     * @param message Message to be sent to the Service Bus Queue.\n+     * @param scheduledEnqueueTime Instant at which the message should appear in the Service Bus queue or topic.\n+     *\n+     * @return The sequence number of the scheduled message which can be used to cancel the scheduling of the message.\n+     *\n+     * @throws NullPointerException if {@code message} or {@code scheduledEnqueueTime} is {@code null}.\n+     */\n+    public long scheduleMessage(ServiceBusMessage message, Instant scheduledEnqueueTime) {\n+        return asyncClient.scheduleMessage(message, scheduledEnqueueTime).block(tryTimeout);\n+    }\n+\n+    /**\n+     * Cancels the enqueuing of an already scheduled message, if it was not already enqueued.\n+     *\n+     * @param sequenceNumber of the scheduled message to cancel.\n+     *\n+     * @return The {@link Mono} that finishes this operation on service bus resource.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3179e87b29fc9e78a6622fc3bb4d1fa061cd8ef2"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODE4MA==", "bodyText": "The sequence number can be 0 if it is in the beginning of stream.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10495#discussion_r414818180", "createdAt": "2020-04-24T19:40:02Z", "author": {"login": "conniey"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/test/java/com/azure/messaging/servicebus/ServiceBusSenderClientIntegrationTest.java", "diffHunk": "@@ -104,6 +106,50 @@ void nonSessionMessageBatch(MessagingEntityType entityType) {\n         }\n     }\n \n+    /**\n+     * Verifies that we can schedule a message to a non-session entity.\n+     */\n+    @MethodSource(\"receiverTypesProvider\")\n+    @ParameterizedTest\n+    void nonSessionScheduleMessage(MessagingEntityType entityType) {\n+        // Arrange\n+        setSenderAndReceiver(entityType);\n+\n+        final Instant scheduledEnqueueTime = Instant.now().plusSeconds(10);\n+        final String messageId = UUID.randomUUID().toString();\n+        final String contents = \"Some-contents\";\n+        final ServiceBusMessage message = TestUtils.getServiceBusMessage(contents, messageId);\n+\n+        // Act\n+        long sequenceNumber = sender.scheduleMessage(message, scheduledEnqueueTime);\n+\n+        // Assert\n+        Assertions.assertTrue(sequenceNumber > 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3179e87b29fc9e78a6622fc3bb4d1fa061cd8ef2"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODUwMA==", "bodyText": "If this succeeds, you'll want to decrement messages pending.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10495#discussion_r414818500", "createdAt": "2020-04-24T19:40:41Z", "author": {"login": "conniey"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/test/java/com/azure/messaging/servicebus/ServiceBusSenderClientIntegrationTest.java", "diffHunk": "@@ -104,6 +106,50 @@ void nonSessionMessageBatch(MessagingEntityType entityType) {\n         }\n     }\n \n+    /**\n+     * Verifies that we can schedule a message to a non-session entity.\n+     */\n+    @MethodSource(\"receiverTypesProvider\")\n+    @ParameterizedTest\n+    void nonSessionScheduleMessage(MessagingEntityType entityType) {\n+        // Arrange\n+        setSenderAndReceiver(entityType);\n+\n+        final Instant scheduledEnqueueTime = Instant.now().plusSeconds(10);\n+        final String messageId = UUID.randomUUID().toString();\n+        final String contents = \"Some-contents\";\n+        final ServiceBusMessage message = TestUtils.getServiceBusMessage(contents, messageId);\n+\n+        // Act\n+        long sequenceNumber = sender.scheduleMessage(message, scheduledEnqueueTime);\n+\n+        // Assert\n+        Assertions.assertTrue(sequenceNumber > 0);\n+\n+        messagesPending.incrementAndGet();\n+    }\n+\n+    /**\n+     * Verifies that we can cancel a scheduled a message to a non-session entity.\n+     */\n+    @MethodSource(\"receiverTypesProvider\")\n+    @ParameterizedTest\n+    void nonSessionCancelScheduleMessage(MessagingEntityType entityType) {\n+        // Arrange\n+        setSenderAndReceiver(entityType);\n+\n+        final Instant scheduledEnqueueTime = Instant.now().plusSeconds(20);\n+        final String messageId = UUID.randomUUID().toString();\n+        final String contents = \"Some-contents\";\n+        final ServiceBusMessage message = TestUtils.getServiceBusMessage(contents, messageId);\n+\n+        // Assert & Act\n+        long sequenceNumber = sender.scheduleMessage(message, scheduledEnqueueTime);\n+        Assertions.assertTrue(sequenceNumber > 0);\n+\n+        sender.cancelScheduledMessage(sequenceNumber);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3179e87b29fc9e78a6622fc3bb4d1fa061cd8ef2"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab9be343b2d6cbe1ab6ceefcd8be1d74f7cb90b5", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ab9be343b2d6cbe1ab6ceefcd8be1d74f7cb90b5", "committedDate": "2020-04-24T20:30:44Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3571c3778fc32fe8ef9e9ac3dbc1d2da8d3dc059", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3571c3778fc32fe8ef9e9ac3dbc1d2da8d3dc059", "committedDate": "2020-04-24T22:19:37Z", "message": "Review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4585, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}