{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5ODkxNTI3", "number": 11300, "title": "Add multi tenant end-to-end tests", "bodyText": "", "createdAt": "2020-05-19T05:44:47Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300", "merged": true, "mergeCommit": {"oid": "559420b49b73d3c64e4542e9840e471aa70916a7"}, "closed": true, "closedAt": "2020-07-29T21:16:43Z", "author": {"login": "jianghaolu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcewWMtAH2gAyNDE5ODkxNTI3OmFlODBmY2YzZmQ1ZTU4NjIxMjkxOWFlNTNmYWVjNzVlMDdiYmUzNGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5zEEVAFqTQ1Nzk1MDk3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ae80fcf3fd5e586212919ae53faec75e07bbe34d", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ae80fcf3fd5e586212919ae53faec75e07bbe34d", "committedDate": "2020-05-06T22:23:30Z", "message": "Add two simple multi tenant samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39bded1e251a8e38dff25eeeac5cf60d2a121be7", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/39bded1e251a8e38dff25eeeac5cf60d2a121be7", "committedDate": "2020-05-19T05:43:48Z", "message": "Add multi tenant end-to-end tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MDMxNDcy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#pullrequestreview-457031472", "createdAt": "2020-07-28T21:32:08Z", "commit": {"oid": "39bded1e251a8e38dff25eeeac5cf60d2a121be7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMTozMjowOVrOG4fqiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMTozMjowOVrOG4fqiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg5MjIzMg==", "bodyText": "so, your instructions cover to disable 2FA for the username ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#discussion_r461892232", "createdAt": "2020-07-28T21:32:09Z", "author": {"login": "g2vinay"}, "path": "sdk/e2e/src/main/java/com/azure/endtoend/identity/MultiTenantTest.java", "diffHunk": "@@ -0,0 +1,164 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.endtoend.identity;\n+\n+import com.azure.core.credential.AccessToken;\n+import com.azure.core.credential.TokenRequestContext;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.ClientSecretCredential;\n+import com.azure.identity.ClientSecretCredentialBuilder;\n+import com.azure.identity.UsernamePasswordCredential;\n+import com.azure.identity.UsernamePasswordCredentialBuilder;\n+import com.microsoft.azure.AzureEnvironment;\n+import com.microsoft.azure.credentials.AzureTokenCredentials;\n+import com.microsoft.azure.management.graphrbac.ActiveDirectoryUser;\n+import com.microsoft.azure.management.graphrbac.implementation.GraphRbacManager;\n+\n+import java.io.IOException;\n+import java.util.Locale;\n+\n+/**\n+ * Runs Identity tests across multiple tests.\n+ */\n+class MultiTenantTest {\n+    private static final String AZURE_MULTI_TENANT_TEST_MODE = \"AZURE_MULTI_TENANT_TEST_MODE\";\n+    private static final String AZURE_USER_NAME = \"AZURE_USER_NAME\";\n+    private static final String AZURE_USER_PASSWORD = \"AZURE_USER_PASSWORD\";\n+    private static final String AZURE_CLIENT_ID = \"AZURE_CLIENT_ID\";\n+    private static final String AZURE_CLIENT_SECRET = \"AZURE_CLIENT_SECRET\";\n+    private static final String AZURE_TENANT_ID = \"AZURE_TENANT_ID\";\n+    private static final Configuration CONFIGURATION = Configuration.getGlobalConfiguration().clone();\n+    private final ClientLogger logger = new ClientLogger(MultiTenantTest.class);\n+\n+    /**\n+     * Runs the multi tenant identity tests\n+     * @throws IllegalStateException if AZURE_MULTI_TENANT_TEST_MODE is not set to \"user\" or \"sp\"\n+     */\n+    void run() throws IllegalStateException {\n+        if (CoreUtils.isNullOrEmpty(CONFIGURATION.get(AZURE_MULTI_TENANT_TEST_MODE))) {\n+            throw logger.logExceptionAsError(new IllegalStateException(\"Test mode is not set. Set environment \"\n+                                                + \"variable AZURE_MULTI_TENANT_TEST_MODE to user or sp\"));\n+        }\n+\n+        String mode = CONFIGURATION.get(AZURE_MULTI_TENANT_TEST_MODE).toLowerCase(Locale.ENGLISH);\n+        switch (mode) {\n+            case \"user\":\n+                testUserPasswordCanAccessGraph();\n+                break;\n+            case \"sp\":\n+                testServicePrincipalCanAccessGraph();\n+                break;\n+            default:\n+                throw logger.logExceptionAsError(\n+                    new IllegalStateException(\"Invalid Test mode is configured AZURE_MULTI_TENANT_TEST_MODE. \"\n+                                                    + \"Possible values are user or sp.\"));\n+        }\n+    }\n+\n+    private void testUserPasswordCanAccessGraph() {\n+        assertConfigPresence(AZURE_CLIENT_ID,\n+            \"testUserPasswordCanAccessGraph - AZURE_CLIENT_ID not configured in the environment.\");\n+        assertConfigPresence(AZURE_TENANT_ID,\n+            \"testUserPasswordCanAccessGraph - AZURE_TENANT_ID not configured in the environment.\");\n+        assertConfigPresence(AZURE_USER_NAME,\n+            \"testUserPasswordCanAccessGraph - AZURE_USER_NAME not configured in the environment.\");\n+        assertConfigPresence(AZURE_USER_PASSWORD,\n+            \"testUserPasswordCanAccessGraph - AZURE_USER_PASSWORD not configured in the environment.\");\n+        String clientId = CONFIGURATION.get(AZURE_CLIENT_ID);\n+        String tenantId = CONFIGURATION.get(AZURE_TENANT_ID);\n+        String username = CONFIGURATION.get(AZURE_USER_NAME);\n+        String password = CONFIGURATION.get(AZURE_USER_PASSWORD);\n+\n+        UsernamePasswordCredential credential = new UsernamePasswordCredentialBuilder()\n+            .clientId(clientId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39bded1e251a8e38dff25eeeac5cf60d2a121be7"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MDM0NDU0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#pullrequestreview-457034454", "createdAt": "2020-07-28T21:33:29Z", "commit": {"oid": "39bded1e251a8e38dff25eeeac5cf60d2a121be7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "435e649bc985fbb492c158276a56b9b151e2b64c", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/435e649bc985fbb492c158276a56b9b151e2b64c", "committedDate": "2020-07-28T21:41:21Z", "message": "Merge branch 'master' of github.com:Azure/azure-sdk-for-java into mtsample"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTUwOTcw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#pullrequestreview-457950970", "createdAt": "2020-07-29T22:49:22Z", "commit": {"oid": "435e649bc985fbb492c158276a56b9b151e2b64c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjo0OToyMlrOG5M8sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjo0OToyMlrOG5M8sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYzNDE2MA==", "bodyText": "You need to add a version tag here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11300#discussion_r462634160", "createdAt": "2020-07-29T22:49:22Z", "author": {"login": "weshaggard"}, "path": "sdk/e2e/pom.xml", "diffHunk": "@@ -55,6 +55,11 @@\n       <artifactId>slf4j-api</artifactId>\n       <version>1.7.28</version> <!-- {x-version-update;org.slf4j:slf4j-api;external_dependency} -->\n     </dependency>\n+    <dependency>\n+      <groupId>com.microsoft.azure</groupId>\n+      <artifactId>azure-mgmt-graph-rbac</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "435e649bc985fbb492c158276a56b9b151e2b64c"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4124, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}