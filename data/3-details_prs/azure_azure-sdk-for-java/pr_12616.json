{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNTk5MDEx", "number": 12616, "title": "Add token refresh options to simple token cache (azure-core) #12403", "bodyText": "Moved from #12403", "createdAt": "2020-06-29T19:14:29Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616", "merged": true, "mergeCommit": {"oid": "193213081aad7b38fabfd410d6131051ad16eae8"}, "closed": true, "closedAt": "2020-07-06T17:36:52Z", "author": {"login": "jianghaolu"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct5EmKgH2gAyNDQxNTk5MDExOjY0OTU5M2Y4ZjNkMmM5YmU0YjIyMzU4MDU4NDRmNWZiMjIwYzI3NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxPOc-AH2gAyNDQxNTk5MDExOmM0MjY3Y2M3YzBlZDY0OTQwZmQyZGM4YmJhNzRmMjYzNzgyZTRmOWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "649593f8f3d2c9be4b2235805844f5fb220c275e", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/649593f8f3d2c9be4b2235805844f5fb220c275e", "committedDate": "2020-06-22T23:02:17Z", "message": "Add token refresh options to simple token cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fc55084414d29b6fcc79904990cc4f7e2c67b53", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8fc55084414d29b6fcc79904990cc4f7e2c67b53", "committedDate": "2020-06-22T23:18:59Z", "message": "Fix amqp test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eff3c1e0ae0768dcec305a2d521cfad5bb7b175", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4eff3c1e0ae0768dcec305a2d521cfad5bb7b175", "committedDate": "2020-06-24T21:23:16Z", "message": "Address Alan & CI's feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "400396b13b3cabd07e793a8523ebd3948a09bedd", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/400396b13b3cabd07e793a8523ebd3948a09bedd", "committedDate": "2020-06-24T21:35:53Z", "message": "migrate more from identity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75987f774628315038b7f9522830b0e966e4b4c4", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/75987f774628315038b7f9522830b0e966e4b4c4", "committedDate": "2020-06-25T06:32:45Z", "message": "Merge branch 'master' into simpletokencache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "886cac316a4e3bd40ded52e8a8857893c81ae658", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/886cac316a4e3bd40ded52e8a8857893c81ae658", "committedDate": "2020-06-25T07:06:26Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f234570a7995112920a53decd0ca878ecd4f5d17", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f234570a7995112920a53decd0ca878ecd4f5d17", "committedDate": "2020-06-25T07:07:12Z", "message": "Merge branch 'simpletokencache' of github.com:jianghaolu/azure-sdk-for-java into simpletokencache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b6eec05de35a23e3ee91bfdecf569048045ea74", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4b6eec05de35a23e3ee91bfdecf569048045ea74", "committedDate": "2020-06-26T06:56:07Z", "message": "Fit and finish"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDMwOTAw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616#pullrequestreview-439430900", "createdAt": "2020-06-29T19:18:47Z", "commit": {"oid": "4b6eec05de35a23e3ee91bfdecf569048045ea74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxOToxODo0N1rOGqevfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxOToxODo0N1rOGqevfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE5NzA1NQ==", "bodyText": "Since this is on the TokenRefreshOptions should we remove the \"TokenRefresh\" from these property accessors? In this case getRetryTimeout", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616#discussion_r447197055", "createdAt": "2020-06-29T19:18:47Z", "author": {"login": "schaabs"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/credential/TokenRefreshOptions.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.credential;\n+\n+import java.time.Duration;\n+\n+/**\n+ * The options to configure the token refresh behavior.\n+ */\n+public class TokenRefreshOptions {\n+    private static final Duration DEFAULT_REFRESH_RETRY_TIMEOUT = Duration.ofSeconds(30);\n+    private static final Duration DEFAULT_REFRESH_OFFSET = Duration.ofMinutes(2);\n+\n+    private Duration tokenRefreshRetryTimeout = DEFAULT_REFRESH_RETRY_TIMEOUT;\n+    private Duration tokenRefreshOffset = DEFAULT_REFRESH_OFFSET;\n+\n+    /**\n+     * Returns a Duration value representing the amount of time to wait before retrying a token refresh. This is to\n+     * prevent sending too many requests to the authentication service.\n+     *\n+     * @return the duration value representing the amount of time to wait before retrying a token refresh\n+     */\n+    public Duration getTokenRefreshRetryTimeout() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b6eec05de35a23e3ee91bfdecf569048045ea74"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDMyMzM0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616#pullrequestreview-439432334", "createdAt": "2020-06-29T19:20:53Z", "commit": {"oid": "4b6eec05de35a23e3ee91bfdecf569048045ea74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxOToyMDo1NFrOGqe0EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxOToyMDo1NFrOGqe0EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE5ODIyNQ==", "bodyText": "same as above, could this be just setOffset?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616#discussion_r447198225", "createdAt": "2020-06-29T19:20:54Z", "author": {"login": "schaabs"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/credential/TokenRefreshOptions.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.credential;\n+\n+import java.time.Duration;\n+\n+/**\n+ * The options to configure the token refresh behavior.\n+ */\n+public class TokenRefreshOptions {\n+    private static final Duration DEFAULT_REFRESH_RETRY_TIMEOUT = Duration.ofSeconds(30);\n+    private static final Duration DEFAULT_REFRESH_OFFSET = Duration.ofMinutes(2);\n+\n+    private Duration tokenRefreshRetryTimeout = DEFAULT_REFRESH_RETRY_TIMEOUT;\n+    private Duration tokenRefreshOffset = DEFAULT_REFRESH_OFFSET;\n+\n+    /**\n+     * Returns a Duration value representing the amount of time to wait before retrying a token refresh. This is to\n+     * prevent sending too many requests to the authentication service.\n+     *\n+     * @return the duration value representing the amount of time to wait before retrying a token refresh\n+     */\n+    public Duration getTokenRefreshRetryTimeout() {\n+        return tokenRefreshRetryTimeout;\n+    }\n+\n+    /**\n+     * Specifies a Duration value representing the amount of time to wait before retrying a token refresh. This is to\n+     * prevent sending too many requests to the authentication service.\n+     *\n+     * @param tokenRefreshRetryTimeout the amount of time to wait before retrying a token refresh\n+     * @return the updated TokenRefreshOptions object\n+     */\n+    public TokenRefreshOptions setTokenRefreshRetryTimeout(Duration tokenRefreshRetryTimeout) {\n+        this.tokenRefreshRetryTimeout = tokenRefreshRetryTimeout;\n+        return this;\n+    }\n+\n+    /**\n+     * Returns a Duration value representing the amount of time to subtract from the token expiry time, whereupon\n+     * attempts will be made to refresh the token. By default this will occur two minutes prior to the expiry of the\n+     * token.\n+     *\n+     * @return the duration value representing the amount of time to subtract from the token expiry time\n+     */\n+    public Duration getTokenRefreshOffset() {\n+        return tokenRefreshOffset;\n+    }\n+\n+    /**\n+     * Specifies the Duration value representing the amount of time to subtract from the token expiry time, whereupon\n+     * attempts will be made to refresh the token. By default this will occur two minutes prior to the expiry of the\n+     * token.\n+     *\n+     * @param tokenRefreshOffset the duration representing the amount of time to subtract from the token expiry time\n+     * @return the updated TokenRefreshOptions object\n+     */\n+    public TokenRefreshOptions setTokenRefreshOffset(Duration tokenRefreshOffset) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b6eec05de35a23e3ee91bfdecf569048045ea74"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDM3NDU3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616#pullrequestreview-439437457", "createdAt": "2020-06-29T19:28:57Z", "commit": {"oid": "4b6eec05de35a23e3ee91bfdecf569048045ea74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxOToyODo1N1rOGqfE3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxOToyODo1N1rOGqfE3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIwMjUyNg==", "bodyText": "I think it's could be problematic to have setters for these properties. If TokenRefreshOptions is mutable TokenCredential implementations will have to copy this object to avoid mutations in behavior.  Is it possible to only take these arguments on construction? or would we need to add a builder to make this class immutable?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616#discussion_r447202526", "createdAt": "2020-06-29T19:28:57Z", "author": {"login": "schaabs"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/credential/TokenRefreshOptions.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.credential;\n+\n+import java.time.Duration;\n+\n+/**\n+ * The options to configure the token refresh behavior.\n+ */\n+public class TokenRefreshOptions {\n+    private static final Duration DEFAULT_REFRESH_RETRY_TIMEOUT = Duration.ofSeconds(30);\n+    private static final Duration DEFAULT_REFRESH_OFFSET = Duration.ofMinutes(2);\n+\n+    private Duration tokenRefreshRetryTimeout = DEFAULT_REFRESH_RETRY_TIMEOUT;\n+    private Duration tokenRefreshOffset = DEFAULT_REFRESH_OFFSET;\n+\n+    /**\n+     * Returns a Duration value representing the amount of time to wait before retrying a token refresh. This is to\n+     * prevent sending too many requests to the authentication service.\n+     *\n+     * @return the duration value representing the amount of time to wait before retrying a token refresh\n+     */\n+    public Duration getTokenRefreshRetryTimeout() {\n+        return tokenRefreshRetryTimeout;\n+    }\n+\n+    /**\n+     * Specifies a Duration value representing the amount of time to wait before retrying a token refresh. This is to\n+     * prevent sending too many requests to the authentication service.\n+     *\n+     * @param tokenRefreshRetryTimeout the amount of time to wait before retrying a token refresh\n+     * @return the updated TokenRefreshOptions object\n+     */\n+    public TokenRefreshOptions setTokenRefreshRetryTimeout(Duration tokenRefreshRetryTimeout) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b6eec05de35a23e3ee91bfdecf569048045ea74"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbb443845186be2d969ddb2a0592a909066f453b", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cbb443845186be2d969ddb2a0592a909066f453b", "committedDate": "2020-06-29T21:28:21Z", "message": "Simply properties in TokenRefreshOptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTI0NTM0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616#pullrequestreview-439524534", "createdAt": "2020-06-29T21:48:38Z", "commit": {"oid": "cbb443845186be2d969ddb2a0592a909066f453b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTo0ODozOFrOGqjbbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTo0ODozOFrOGqjbbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MzgzOQ==", "bodyText": "I worry that this property is very complex  to use. TokenCredentialOptions already have retry options, and this adds another level of complexity to that. If we make it configurable users might have to understand the interrelated nature of this and the retry options. Perhaps we could defer allowing this to be configurable? If not I don't think that RetryTimeout really describes what this property is used for.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616#discussion_r447273839", "createdAt": "2020-06-29T21:48:38Z", "author": {"login": "schaabs"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/credential/TokenRefreshOptions.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.credential;\n+\n+import java.time.Duration;\n+\n+/**\n+ * The options to configure the token refresh behavior.\n+ */\n+public class TokenRefreshOptions {\n+    private static final Duration DEFAULT_RETRY_TIMEOUT = Duration.ofSeconds(30);\n+    private static final Duration DEFAULT_OFFSET = Duration.ofMinutes(2);\n+\n+    private Duration retryTimeout = DEFAULT_RETRY_TIMEOUT;\n+    private Duration offset = DEFAULT_OFFSET;\n+\n+    /**\n+     * Returns a Duration value representing the amount of time to wait before retrying a token refresh. This is to\n+     * prevent sending too many requests to the authentication service.\n+     *\n+     * @return the duration value representing the amount of time to wait before retrying a token refresh\n+     */\n+    public Duration getRetryTimeout() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbb443845186be2d969ddb2a0592a909066f453b"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a8592d75e6375917f99a22eb04b59799f096812", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8a8592d75e6375917f99a22eb04b59799f096812", "committedDate": "2020-07-01T20:38:07Z", "message": "Merge branch 'release/azurecore-1.6.0-beta.1' of github.com:Azure/azure-sdk-for-java into simpletokencache"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0282f87d850143d93f65c2da853fc6bd4c90c939", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0282f87d850143d93f65c2da853fc6bd4c90c939", "committedDate": "2020-07-01T19:31:27Z", "message": "Merge branch 'master' of github.com:Azure/azure-sdk-for-java into simpletokencache"}, "afterCommit": {"oid": "8a8592d75e6375917f99a22eb04b59799f096812", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8a8592d75e6375917f99a22eb04b59799f096812", "committedDate": "2020-07-01T20:38:07Z", "message": "Merge branch 'release/azurecore-1.6.0-beta.1' of github.com:Azure/azure-sdk-for-java into simpletokencache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee3b143212cccdf27aa83c43a715152e097c33db", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ee3b143212cccdf27aa83c43a715152e097c33db", "committedDate": "2020-07-02T22:49:08Z", "message": "Remove tokenRefreshTimeout and add more javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6b688e16dc53827478abf5a373400c8dcbd4213", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f6b688e16dc53827478abf5a373400c8dcbd4213", "committedDate": "2020-07-02T23:17:13Z", "message": "Remove token refresh offset setter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40354ae19567b38d24d48c5b664b4eee4e420474", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/40354ae19567b38d24d48c5b664b4eee4e420474", "committedDate": "2020-07-02T23:36:45Z", "message": "update tests with non-configurable token refresh timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "219e0c07bc3c716638475646fca372d5c6020a07", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/219e0c07bc3c716638475646fca372d5c6020a07", "committedDate": "2020-07-02T23:52:54Z", "message": "Fix javadocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDc1ODQw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12616#pullrequestreview-442075840", "createdAt": "2020-07-02T23:53:32Z", "commit": {"oid": "40354ae19567b38d24d48c5b664b4eee4e420474"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4267cc7c0ed64940fd2dc8bba74f263782e4f9b", "author": {"user": {"login": "jianghaolu", "name": "Jianghao Lu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c4267cc7c0ed64940fd2dc8bba74f263782e4f9b", "committedDate": "2020-07-03T08:32:44Z", "message": "improve token cache test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2844, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}