{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNjIxOTE2", "number": 11417, "title": "feat: update pom after generation", "bodyText": "", "createdAt": "2020-05-25T08:38:57Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11417", "merged": true, "mergeCommit": {"oid": "1ab26e7a79c037cf0fd25d6c60da84ccc8f4f37a"}, "closed": true, "closedAt": "2020-05-25T09:59:40Z", "author": {"login": "ChenTanyi"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckr7fNgH2gAyNDIyNjIxOTE2OmFiNjRkNWIwNzM4MDM2NzQwYmEwMmIyMmNhYmJkMTkyMGMxMmNiOTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABckshSKAFqTQxNzU3ODEzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab64d5b0738036740ba02b22cabbd1920c12cb93", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ab64d5b0738036740ba02b22cabbd1920c12cb93", "committedDate": "2020-05-25T08:38:15Z", "message": "feat: update pom after generation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NTU1MjE5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11417#pullrequestreview-417555219", "createdAt": "2020-05-25T08:42:56Z", "commit": {"oid": "ab64d5b0738036740ba02b22cabbd1920c12cb93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e82765efe66d6a8b46320659cb9922ed5cdf7d88", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e82765efe66d6a8b46320659cb9922ed5cdf7d88", "committedDate": "2020-05-25T09:06:07Z", "message": "fix: write back to pom"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NTc4MTMz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11417#pullrequestreview-417578133", "createdAt": "2020-05-25T09:19:31Z", "commit": {"oid": "e82765efe66d6a8b46320659cb9922ed5cdf7d88"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwOToxOTozMVrOGZ6seQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwOToxOTozMVrOGZ6seQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgyOTI0MQ==", "bodyText": "For safe replacement, it might be required to append at line 251 with\npomContent = pomContent.replace('<relativePath>../../pom.management.xml</relativePath>', '<relativePath>../../parents/azure-arm-parent/pom.xml</relativePath>');", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11417#discussion_r429829241", "createdAt": "2020-05-25T09:19:31Z", "author": {"login": "xseeseesee"}, "path": "eng/mgmt/gulpfile.js", "diffHunk": "@@ -202,6 +205,54 @@ var deleteFolderRecursive = function(folder) {\n     }\n };\n \n+var changePom = function(project) {\n+    var modules = []\n+\n+    project = project.split('/')[0]\n+    var projectRoot = path.join(sdkRoot, 'sdk', project);\n+    var projectPom = path.join(projectRoot, mgmtPomFilename);\n+\n+    // search modules\n+    fs.readdirSync(projectRoot).forEach(function(folder, index) {\n+        if (fs.lstatSync(path.join(projectRoot, folder)).isDirectory()) {\n+            if (folder.startsWith('mgmt-')) {\n+                modules.push(folder);\n+            }\n+        }\n+    })\n+\n+    pomHeader = \n+`<!-- Copyright (c) Microsoft Corporation. All rights reserved.\n+     Licensed under the MIT License. -->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">`;\n+     pomVersion = '<version>1.0.0</version>  <!-- Need not change for every release-->'\n+\n+    // add all modules to pom\n+    if(fs.existsSync(projectPom)) {\n+        var xmlContent = fs.readFileSync(projectPom, {encoding: 'utf-8'});\n+        var xml = xmlparser.parse(xmlContent);\n+        xml.project.modules.module = modules;\n+        xmlContent = new xmlparser.j2xParser({format: true, indentBy: \"  \"}).parse(xml);\n+        xmlContent = xmlContent.replace('<project>', pomHeader);\n+        xmlContent = xmlContent.replace('<version>1.0.0</version>', pomVersion);\n+\n+        fs.writeFileSync(projectPom, xmlContent, {encoding: 'utf-8'})\n+    }\n+    \n+    // change all module pom.xml\n+    modules.forEach(function(mod, index) {\n+        var modulePom = path.join(projectRoot, mod, 'pom.xml');\n+        if (fs.existsSync(modulePom)) {\n+            var pomContent = fs.readFileSync(modulePom, {encoding: 'utf-8'});\n+            pomContent = pomContent.replace('<version>1.1.0</version>', '<version>1.3.0</version>');\n+            pomContent = pomContent.replace('<relativePath>../../../pom.management.xml</relativePath>', '<relativePath>../../parents/azure-arm-parent/pom.xml</relativePath>');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e82765efe66d6a8b46320659cb9922ed5cdf7d88"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4038, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}