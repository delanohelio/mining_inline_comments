{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3MDk1MTQ3", "number": 9022, "title": "Simplify azure-identity  error messaging", "bodyText": "issue#8629\nThis update simplifies error messages of azure-identity. Below are some examples of how error messages are changed.\nDefaultAzureCredential when no credentials are available\nWithout this update\n// error message\nException in thread \"main\" java.lang.RuntimeException: Tried EnvironmentCredential, \nManagedIdentityCredential, SharedTokenCacheCredential but failed to acquire a token for any of \nthem. Please verify the environment for either of them and see more details in the\ncauses below.\n......\n......\nCaused by: java.lang.RuntimeException: No accounts were discovered in the shared token cache. \nTo fix, authenticate through tooling\nsupporting azure developer sign on.\n......\n......\nCaused by: java.net.SocketTimeoutException: connect timed out\n......\n......\nCaused by: com.azure.core.exception.ClientAuthenticationException: Cannot create any \ncredentials with the current environment variables\n......\n......\n\nWith this update\n// error message\nException in thread \"main\" java.lang.RuntimeException: DefaultAzureCredential failed to retrieve a \ntoken from the included credentials.( EnvironmentCredential authentication unavailable. \nEnvironment variables are not fully configured. ManagedIdentityCredential authentication \nunavailable. No managed identity endpoint found. SharedTokenCacheCredential authentication \nunavailable. No accounts were discovered in the shared token cache. )\n......\n......\n\nDefaultAzureCredential when authentication failed\nWithout this update\n// error message\nException in thread \"main\" java.lang.RuntimeException: Tried EnvironmentCredential, \nManagedIdentityCredential, SharedTokenCacheCredential but failed to acquire a token for any of \nthem. Please verify the environment for either of them and see more details in the\ncauses below.\n......\n......\nCaused by: java.lang.RuntimeException: No accounts were discovered in the shared token cache. \nTo fix, authenticate through tooling\nsupporting azure developer sign on.\n......\n......\nCaused by: com.microsoft.aad.msal4j.MsalServiceException: AADSTS90002: Tenant '72f988bf-86f1- \n41af-91ab-2d7cd011db4a' not found. This may happen if there are no active subscriptions for the \ntenant. Check to make sure you have the correct tenant ID. Check with your subscription \nadministrator.\nTrace ID: 9fff688c-5fa0-457e-b73b-e06b8146d700\nCorrelation ID: 10dada0d-2385-4096-9fcf-34db99709c54\nTimestamp: 2020-03-12 08:57:25Z\n......\n......\nCaused by: java.net.SocketTimeoutException: connect timed out\n......\n......\n\nWith this update\n// error message\nException in thread \"main\" java.lang.RuntimeException: DefaultAzureCredential authentication failed. ---> EnvironmentCredential authentication failed.\n......\n......\nCaused by: com.microsoft.aad.msal4j.MsalServiceException: AADSTS90002: Tenant '72f988bf- \n86f1-41af-91ab-2d7cd011db4a' not found. This may happen if there are no active subscriptions \nfor the tenant. Check to make sure you have the correct tenant ID. Check with your subscription \nadministrator.\nTrace ID: 9fff688c-5fa0-457e-b73b-e06b8146d700\nCorrelation ID: 10dada0d-2385-4096-9fcf-34db99709c54\nTimestamp: 2020-03-12 08:57:25Z", "createdAt": "2020-03-12T08:00:50Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022", "merged": true, "mergeCommit": {"oid": "cfb7f4cd80c9f292149f84b4349e245c176921fc"}, "closed": true, "closedAt": "2020-06-22T17:48:10Z", "author": {"login": "Luyunmt"}, "timelineItems": {"totalCount": 73, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8I4zOAH2gAyMzg3MDk1MTQ3OmY2YjE3YTk4NTQ0OTdhOWFlODI5NTA5ZDk3YTg3NWI0NDU2NjhkNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrboymgH2gAyMzg3MDk1MTQ3OjkxYTIyNDMxYzc3NmRhZmFkY2JmYWY0OWFjMTRiMjEwNWNmZWNhYzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f6b17a9854497a9ae829509d97a875b445668d50", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f6b17a9854497a9ae829509d97a875b445668d50", "committedDate": "2020-01-20T09:11:40Z", "message": "add support for AuthFileCredential"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddf0754a5ac99a1ba579af27d44efb16743197f4", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ddf0754a5ac99a1ba579af27d44efb16743197f4", "committedDate": "2020-01-20T09:18:54Z", "message": "change comments in AuthFileCredentialBuilder.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bec2c22b4a9f078896b3ffbd27d931d76021f595", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bec2c22b4a9f078896b3ffbd27d931d76021f595", "committedDate": "2020-01-22T08:29:04Z", "message": "change exception,add test and move method ensurecredential"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9235377fd82f6e1240243d037f1aafe65cf9c43", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e9235377fd82f6e1240243d037f1aafe65cf9c43", "committedDate": "2020-01-22T10:23:58Z", "message": "change extends and change exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74799df9e74cb772caa232b073f72ddd1f7c782f", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/74799df9e74cb772caa232b073f72ddd1f7c782f", "committedDate": "2020-02-04T02:51:13Z", "message": "remove method ensurecredential"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7bb92aea0240f55cc8dcdab9271993d3a3a05c1", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f7bb92aea0240f55cc8dcdab9271993d3a3a05c1", "committedDate": "2020-02-05T03:03:03Z", "message": "move ensurecredential to gettoken"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0a7bcdbd8e06e8036cfcc9bd0218f66de4f58e7", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b0a7bcdbd8e06e8036cfcc9bd0218f66de4f58e7", "committedDate": "2020-02-28T09:37:25Z", "message": "add synchronize and update code format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fedf1d582cba96819ec492a1d87ccca28e82703", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6fedf1d582cba96819ec492a1d87ccca28e82703", "committedDate": "2020-03-02T08:12:22Z", "message": "change test and field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "210fa4324e8666f806d0e89f6e575cdd297c3c7c", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/210fa4324e8666f806d0e89f6e575cdd297c3c7c", "committedDate": "2020-03-03T08:15:57Z", "message": "add String constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "691f64d92ba8e16a9b7b4db309de84fc5706c69c", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/691f64d92ba8e16a9b7b4db309de84fc5706c69c", "committedDate": "2020-03-12T07:37:58Z", "message": "change defaultazurecredential error exception message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5242e18046602bc8b61e87099c664eb9795424d0", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5242e18046602bc8b61e87099c664eb9795424d0", "committedDate": "2020-03-12T07:44:36Z", "message": "change defaultazurecredential error exception message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a664c2db5846cc2452425ddb6372a2392ee38faf", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a664c2db5846cc2452425ddb6372a2392ee38faf", "committedDate": "2020-03-12T07:50:59Z", "message": "change defaultazurecredential error exception message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "241e9153f9a5e286562f92e384eea8322559eb15", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/241e9153f9a5e286562f92e384eea8322559eb15", "committedDate": "2020-03-12T09:10:23Z", "message": "change defaultazurecredential error exception message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56786ea96df01bb03e61c67d31071ebe28fd35f4", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/56786ea96df01bb03e61c67d31071ebe28fd35f4", "committedDate": "2020-03-12T09:50:45Z", "message": "change defaultazurecredential error exception message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTA2NjUx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-373906651", "createdAt": "2020-03-12T21:18:22Z", "commit": {"oid": "56786ea96df01bb03e61c67d31071ebe28fd35f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMToxODoyMlrOF1vnMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMToxODoyMlrOF1vnMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5ODkyOA==", "bodyText": "Can we use package private for now instead?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r391898928", "createdAt": "2020-03-12T21:18:22Z", "author": {"login": "jianghaolu"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -23,7 +23,7 @@\n  */\n @Immutable\n public class ChainedTokenCredential implements TokenCredential {\n-    private final Deque<TokenCredential> credentials;\n+    protected final Deque<TokenCredential> credentials;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56786ea96df01bb03e61c67d31071ebe28fd35f4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTA3MTMz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-373907133", "createdAt": "2020-03-12T21:19:16Z", "commit": {"oid": "56786ea96df01bb03e61c67d31071ebe28fd35f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMToxOToxNlrOF1vpAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMToxOToxNlrOF1vpAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5OTM5Mw==", "bodyText": "We have changed this to run in serial: https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java#L46", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r391899393", "createdAt": "2020-03-12T21:19:16Z", "author": {"login": "jianghaolu"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredential.java", "diffHunk": "@@ -39,4 +45,28 @@\n             new SharedTokenCacheCredential(null, \"04b07795-8ddb-461a-bbee-02f9e1bf7b46\",\n                 identityClientOptions))));\n     }\n+\n+    @Override\n+    public Mono<AccessToken> getToken(TokenRequestContext request) {\n+        final AtomicReference<Throwable> cause = new AtomicReference<>();\n+        StringBuilder errorMsg = new StringBuilder();\n+        return Flux.fromIterable(credentials).flatMap(p -> p.getToken(request).onErrorResume(t -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56786ea96df01bb03e61c67d31071ebe28fd35f4"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca526d16566d116abce9ddcda32818afc84fd4b7", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ca526d16566d116abce9ddcda32818afc84fd4b7", "committedDate": "2020-03-13T08:00:50Z", "message": "update according to conversation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "902f88afa826bbe6b2d411e70955fccc96f493bc", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/902f88afa826bbe6b2d411e70955fccc96f493bc", "committedDate": "2020-03-16T07:27:15Z", "message": "update defaultazurecredential and resolve conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "136d17083512cff63ce2e1ddc470610875ee452d", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/136d17083512cff63ce2e1ddc470610875ee452d", "committedDate": "2020-03-16T07:47:33Z", "message": "update sharedtokencachecredential error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2feb543c4e5cd7c59229deef4844d35fb459cdf", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f2feb543c4e5cd7c59229deef4844d35fb459cdf", "committedDate": "2020-03-16T08:13:31Z", "message": "update sharedtokencachecredential error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef8e3f3acb9b8237da16eb22627c41cadf7af360", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ef8e3f3acb9b8237da16eb22627c41cadf7af360", "committedDate": "2020-03-16T10:17:21Z", "message": "update sharedtokencachecredential error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9d8c84f850268f96c8d8af0c9f9cae0bb991ba8", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f9d8c84f850268f96c8d8af0c9f9cae0bb991ba8", "committedDate": "2020-03-16T10:19:38Z", "message": "update sharedtokencachecredential error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1700871995a92cfff16094d977cb49e3bad26af", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f1700871995a92cfff16094d977cb49e3bad26af", "committedDate": "2020-03-18T01:36:42Z", "message": "change chainedtokencredential gettoken"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "753e885d8d49aa14143e475c45c6e9bdee8ca666", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/753e885d8d49aa14143e475c45c6e9bdee8ca666", "committedDate": "2020-03-18T01:43:56Z", "message": "change manageidentitycredential"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTEyMjE5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-377112219", "createdAt": "2020-03-18T18:03:20Z", "commit": {"oid": "753e885d8d49aa14143e475c45c6e9bdee8ca666"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowMzoyMFrOF4Q58Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowMzoyMFrOF4Q58Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MTU1Mw==", "bodyText": "This is removing the instructions for the user as to how they'll resolve/fix the issue. We should keep those instructions so users are updated about how to resolve the issue.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r394541553", "createdAt": "2020-03-18T18:03:20Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/SharedTokenCacheCredential.java", "diffHunk": "@@ -86,22 +85,18 @@\n \n                 if (accounts.size() == 0) {\n                     if (username == null) {\n-                        return Mono.error(new RuntimeException(\"No accounts were discovered in the shared token cache.\"\n-                            + \" To fix, authenticate through tooling supporting azure developer sign on.\"));\n+                        return Mono.error(new RuntimeException(\"SharedTokenCacheCredential authentication unavailable. No accounts were discovered in the cache.\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753e885d8d49aa14143e475c45c6e9bdee8ca666"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTE2ODIy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-377116822", "createdAt": "2020-03-18T18:09:32Z", "commit": {"oid": "753e885d8d49aa14143e475c45c6e9bdee8ca666"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowOTozMlrOF4RICg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODoxMzoxOFrOF4RQwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0NTE2Mg==", "bodyText": "Same here, we should keep the instructions for the user as to how they'll resolve/fix the issue.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r394545162", "createdAt": "2020-03-18T18:09:32Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/SharedTokenCacheCredential.java", "diffHunk": "@@ -86,22 +85,18 @@\n \n                 if (accounts.size() == 0) {\n                     if (username == null) {\n-                        return Mono.error(new RuntimeException(\"No accounts were discovered in the shared token cache.\"\n-                            + \" To fix, authenticate through tooling supporting azure developer sign on.\"));\n+                        return Mono.error(new RuntimeException(\"SharedTokenCacheCredential authentication unavailable. No accounts were discovered in the cache.\"));\n                     } else {\n-                        return Mono.error(new RuntimeException(String.format(\"User account '%s' was not found in the \"\n-                            + \"shared token cache. Discovered Accounts: [ '%s' ]\", username, accounts.values().stream()\n-                            .map(IAccount::username).collect(Collectors.joining(\", \")))));\n+                        return Mono.error(new RuntimeException(String.format(\"SharedTokenCacheCredential authentication unavailable. No account \"\n+                            + \"matching the specified %s was found in the cache.\", username)));\n                     }\n                 } else if (accounts.size() > 1) {\n                     if (username == null) {\n-                        return Mono.error(new RuntimeException(\"Multiple accounts were discovered in the shared token \"\n-                            + \"cache. To fix, set the AZURE_USERNAME environment variable to the preferred username, \"\n-                            + \"or specify it when constructing SharedTokenCacheCredential.\"));\n+                        return Mono.error(new RuntimeException(\"SharedTokenCacheCredential authentication unavailable. \"\n+                            + \"Multiple accounts were found in the cache. Use username and tenant id to disambiguate.\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753e885d8d49aa14143e475c45c6e9bdee8ca666"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0NTUzNA==", "bodyText": "Same here, we should keep the update the user why the error is thrown and the feature is not supported.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r394545534", "createdAt": "2020-03-18T18:10:15Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/SharedTokenCacheCredential.java", "diffHunk": "@@ -86,22 +85,18 @@\n \n                 if (accounts.size() == 0) {\n                     if (username == null) {\n-                        return Mono.error(new RuntimeException(\"No accounts were discovered in the shared token cache.\"\n-                            + \" To fix, authenticate through tooling supporting azure developer sign on.\"));\n+                        return Mono.error(new RuntimeException(\"SharedTokenCacheCredential authentication unavailable. No accounts were discovered in the cache.\"));\n                     } else {\n-                        return Mono.error(new RuntimeException(String.format(\"User account '%s' was not found in the \"\n-                            + \"shared token cache. Discovered Accounts: [ '%s' ]\", username, accounts.values().stream()\n-                            .map(IAccount::username).collect(Collectors.joining(\", \")))));\n+                        return Mono.error(new RuntimeException(String.format(\"SharedTokenCacheCredential authentication unavailable. No account \"\n+                            + \"matching the specified %s was found in the cache.\", username)));\n                     }\n                 } else if (accounts.size() > 1) {\n                     if (username == null) {\n-                        return Mono.error(new RuntimeException(\"Multiple accounts were discovered in the shared token \"\n-                            + \"cache. To fix, set the AZURE_USERNAME environment variable to the preferred username, \"\n-                            + \"or specify it when constructing SharedTokenCacheCredential.\"));\n+                        return Mono.error(new RuntimeException(\"SharedTokenCacheCredential authentication unavailable. \"\n+                            + \"Multiple accounts were found in the cache. Use username and tenant id to disambiguate.\"));\n                     } else {\n-                        return Mono.error(new RuntimeException(\"Multiple entries for the user account \" + username\n-                            + \" were found in the shared token cache. This is not currently supported by the\"\n-                            + \" SharedTokenCacheCredential.\"));\n+                        return Mono.error(new RuntimeException(String.format(\"SharedTokenCacheCredential authentication unavailable. Multiple accounts matching the specified \"\n+                            + \" %s were found in the cache.\", username)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753e885d8d49aa14143e475c45c6e9bdee8ca666"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0NjU1OA==", "bodyText": "code indentation needs to be fixed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r394546558", "createdAt": "2020-03-18T18:11:56Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -35,19 +35,15 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        AtomicReference<Throwable> cause = new AtomicReference<>();\n-        return Flux.fromIterable(credentials)\n-            .flatMap(p -> p.getToken(request).onErrorResume(t -> {\n-                if (cause.get() != null) {\n-                    t.initCause(cause.get());\n-                }\n-                cause.set(t);\n-                return Mono.empty();\n-            }))\n+        final StringBuilder errorMsg = new StringBuilder();\n+        return Flux.fromIterable(credentials).flatMap(p -> p.getToken(request).onErrorResume(t -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753e885d8d49aa14143e475c45c6e9bdee8ca666"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0NzM5NA==", "bodyText": "This error message is not properly formatted, spacing issues will show up before 'authentication failed' text.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r394547394", "createdAt": "2020-03-18T18:13:18Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -35,19 +35,15 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        AtomicReference<Throwable> cause = new AtomicReference<>();\n-        return Flux.fromIterable(credentials)\n-            .flatMap(p -> p.getToken(request).onErrorResume(t -> {\n-                if (cause.get() != null) {\n-                    t.initCause(cause.get());\n-                }\n-                cause.set(t);\n-                return Mono.empty();\n-            }))\n+        final StringBuilder errorMsg = new StringBuilder();\n+        return Flux.fromIterable(credentials).flatMap(p -> p.getToken(request).onErrorResume(t -> {\n+            if (t.getMessage() != null && !t.getMessage().contains(\"authentication unavailable\")) {\n+                throw new RuntimeException(UnavailableError+p.getClass().getSimpleName()+\"authentication failed.\",t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753e885d8d49aa14143e475c45c6e9bdee8ca666"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6962edc063cb7aa7f836346ed9c1fd3f0ca9b50c", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6962edc063cb7aa7f836346ed9c1fd3f0ca9b50c", "committedDate": "2020-03-19T02:40:25Z", "message": "update code indentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDQ1NjA0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-386045604", "createdAt": "2020-04-02T00:57:34Z", "commit": {"oid": "6962edc063cb7aa7f836346ed9c1fd3f0ca9b50c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDU4Mjcy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-386058272", "createdAt": "2020-04-02T01:42:57Z", "commit": {"oid": "6962edc063cb7aa7f836346ed9c1fd3f0ca9b50c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19d0ededf1d6793437a7df4005a40ed504e65e10", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/19d0ededf1d6793437a7df4005a40ed504e65e10", "committedDate": "2020-04-02T07:36:14Z", "message": "Merge branch 'master' into DefaultCredentialErrorMsg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e48b05326d00c1718439eb0b8a815f7c5b6a39e0", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e48b05326d00c1718439eb0b8a815f7c5b6a39e0", "committedDate": "2020-04-23T06:24:51Z", "message": "change defaultazurecredential test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04b01eb5999e29c66eb7f80f97ac143cafde2660", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/04b01eb5999e29c66eb7f80f97ac143cafde2660", "committedDate": "2020-04-23T06:39:50Z", "message": "resolve conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f8af7d48c55c24c6605df98e17fb9786defb825", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9f8af7d48c55c24c6605df98e17fb9786defb825", "committedDate": "2020-04-26T07:24:16Z", "message": "change chainedtokencredential and defaultazurecredential test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61703b9c1947e57b04bed040158d51ba84044ee4", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/61703b9c1947e57b04bed040158d51ba84044ee4", "committedDate": "2020-04-26T07:38:43Z", "message": "change defaultazurecredential test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e021876d8f849fa6930d4d23cf33a815bc963702", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e021876d8f849fa6930d4d23cf33a815bc963702", "committedDate": "2020-04-26T07:50:12Z", "message": "Merge branch 'master' into DefaultCredentialErrorMsg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b3eaa0102a30285f774b940bf8505f12b4886fe", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9b3eaa0102a30285f774b940bf8505f12b4886fe", "committedDate": "2020-04-26T08:43:50Z", "message": "change azure cli credential test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b97ca494c4ef4dcb7af66993be279845e2d40bc7", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b97ca494c4ef4dcb7af66993be279845e2d40bc7", "committedDate": "2020-04-26T08:48:45Z", "message": "Merge branch 'DefaultCredentialErrorMsg' of https://github.com/Luyunmt/azure-sdk-for-java into DefaultCredentialErrorMsg\n:wq"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6700256199728f0fbe2ac34f922f1a28d6425e78", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6700256199728f0fbe2ac34f922f1a28d6425e78", "committedDate": "2020-04-26T09:52:41Z", "message": "change azure cli credential test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9831a0190956eb1caba57c2ebbe86f5671f71012", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9831a0190956eb1caba57c2ebbe86f5671f71012", "committedDate": "2020-04-26T09:59:08Z", "message": "change azure cli credential test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d967e965b06783b3e4229b2a9226340b1c50074d", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d967e965b06783b3e4229b2a9226340b1c50074d", "committedDate": "2020-04-27T01:58:52Z", "message": "resolve error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff126b02840c1da3d2f1a3142d408cc8eeb28527", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ff126b02840c1da3d2f1a3142d408cc8eeb28527", "committedDate": "2020-04-27T02:35:06Z", "message": "resolve error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd2509be0cbcc9dc60624f15e54b0311a543fbbc", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/dd2509be0cbcc9dc60624f15e54b0311a543fbbc", "committedDate": "2020-04-27T06:02:37Z", "message": "resolve error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6b25f41ea333a41910ae1af960e71654f2a9f368", "committedDate": "2020-04-27T06:09:57Z", "message": "resolve error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMjE3MzM5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-401217339", "createdAt": "2020-04-27T18:28:46Z", "commit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzExMzUw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-402311350", "createdAt": "2020-04-29T01:03:55Z", "commit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowMzo1NVrOGNsgAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowMzo1NVrOGNsgAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxMzc2Mw==", "bodyText": "This should extend ClientAuthenticationException.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r417013763", "createdAt": "2020-04-29T01:03:55Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/CredentialUnavailableException.java", "diffHunk": "@@ -5,21 +5,20 @@\n \n import com.azure.core.credential.AccessToken;\n import com.azure.core.credential.TokenCredential;\n-import com.azure.core.exception.ClientAuthenticationException;\n \n /**\n  * The exception thrown when a {@link TokenCredential} did not attempt to authenticate and retrieve {@link AccessToken},\n  * as its prerequisite information or state was not available.\n  */\n-public class CredentialUnavailableException extends ClientAuthenticationException {\n+public class CredentialUnavailableException extends RuntimeException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzExMzY4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-402311368", "createdAt": "2020-04-29T01:03:59Z", "commit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowMzo1OVrOGNsgHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowMzo1OVrOGNsgHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxMzc4OQ==", "bodyText": "What will 'throw' achieve here ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r417013789", "createdAt": "2020-04-29T01:03:59Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -36,29 +38,20 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n+        StringBuilder message = new StringBuilder();\n         return Flux.fromIterable(credentials)\n-                   .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                   .flatMap(p -> p.getToken(request).onErrorResume(Exception.class, t -> {\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {\n+                           throw logger.logExceptionAsError(new CredentialUnavailableException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzExMzg0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-402311384", "createdAt": "2020-04-29T01:04:02Z", "commit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowNDowMlrOGNsgKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowNDowMlrOGNsgKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxMzgwMg==", "bodyText": "This logic is not correct, we only want to catch CredentialUnavailableException here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r417013802", "createdAt": "2020-04-29T01:04:02Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -36,29 +38,20 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n+        StringBuilder message = new StringBuilder();\n         return Flux.fromIterable(credentials)\n-                   .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                   .flatMap(p -> p.getToken(request).onErrorResume(Exception.class, t -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzExNDEy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-402311412", "createdAt": "2020-04-29T01:04:10Z", "commit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowNDoxMVrOGNsgRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowNDoxMVrOGNsgRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxMzgyOQ==", "bodyText": "This should throw ClientAuth Exception.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r417013829", "createdAt": "2020-04-29T01:04:11Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -219,10 +218,10 @@\n                         throw logger.logExceptionAsError(\n                             new CredentialUnavailableException(\"Please run 'az login' to set up account\"));\n                     }\n-                    throw logger.logExceptionAsError(new ClientAuthenticationException(redactedOutput, null));\n+                    throw logger.logExceptionAsError(new CredentialUnavailableException(redactedOutput));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzExNDE3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-402311417", "createdAt": "2020-04-29T01:04:12Z", "commit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowNDoxMlrOGNsgSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMTowNDoxMlrOGNsgSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxMzgzMw==", "bodyText": "This should throw Client Auth Exception.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r417013833", "createdAt": "2020-04-29T01:04:12Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -219,10 +218,10 @@\n                         throw logger.logExceptionAsError(\n                             new CredentialUnavailableException(\"Please run 'az login' to set up account\"));\n                     }\n-                    throw logger.logExceptionAsError(new ClientAuthenticationException(redactedOutput, null));\n+                    throw logger.logExceptionAsError(new CredentialUnavailableException(redactedOutput));\n                 } else {\n                     throw logger.logExceptionAsError(\n-                        new ClientAuthenticationException(\"Failed to invoke Azure CLI \", null));\n+                        new CredentialUnavailableException(\"Failed to invoke Azure CLI \"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzE1NTM0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-402315534", "createdAt": "2020-04-29T01:21:21Z", "commit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMToyMToyMVrOGNswBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMToyMToyMVrOGNswBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxNzg2Mg==", "bodyText": "We seem to be double logging the exception here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r417017862", "createdAt": "2020-04-29T01:21:21Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -36,29 +38,20 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n+        StringBuilder message = new StringBuilder();\n         return Flux.fromIterable(credentials)\n-                   .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                   .flatMap(p -> p.getToken(request).onErrorResume(Exception.class, t -> {\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {\n+                           throw logger.logExceptionAsError(new CredentialUnavailableException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzE1OTMy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-402315932", "createdAt": "2020-04-29T01:23:02Z", "commit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMToyMzowMlrOGNsxjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwMToyMzowMlrOGNsxjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxODI1NA==", "bodyText": "A single large message will be unfriendly to read.\nAre we doing this across all languages ?\nBetter to keep the individual exceptions and their stack trace separate", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r417018254", "createdAt": "2020-04-29T01:23:02Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -36,29 +38,20 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n+        StringBuilder message = new StringBuilder();\n         return Flux.fromIterable(credentials)\n-                   .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                   .flatMap(p -> p.getToken(request).onErrorResume(Exception.class, t -> {\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {\n+                           throw logger.logExceptionAsError(new CredentialUnavailableException(\n+                                   unavailableError + p.getClass().getSimpleName() + \" authentication failed.\",\n+                                   t));\n+                       }\n+                       message.append(t.getMessage()).append(\" \"); ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "607d2b7a46f2932c71eee6a7cdb47a6402e05534", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/607d2b7a46f2932c71eee6a7cdb47a6402e05534", "committedDate": "2020-06-02T01:28:51Z", "message": "Merge branch 'master' into DefaultCredentialErrorMsg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b5c1295b974941deffa3e4704fdeee757d684e2", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5b5c1295b974941deffa3e4704fdeee757d684e2", "committedDate": "2020-06-02T08:16:16Z", "message": "change error messga"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0559340d6bdaac30a13c9a6e3c821b3925277e43", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0559340d6bdaac30a13c9a6e3c821b3925277e43", "committedDate": "2020-06-02T08:23:59Z", "message": "remove smoketest change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38009fd35dea903e40b687e2e0d3f84fe2eb57f6", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/38009fd35dea903e40b687e2e0d3f84fe2eb57f6", "committedDate": "2020-06-02T08:26:03Z", "message": "remove smoketest change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyODIxNDYz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-422821463", "createdAt": "2020-06-02T15:51:23Z", "commit": {"oid": "38009fd35dea903e40b687e2e0d3f84fe2eb57f6"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTo1MToyM1rOGd4Rig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTo1NzoxOFrOGd4pIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk4Mzg4Mg==", "bodyText": "I believe onErrorMap would be the more appropriate operator to use here since this appear to be more of a mapping operation than resuming (since it just triggers the error stream again).", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r433983882", "createdAt": "2020-06-02T15:51:23Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/AzureCliCredential.java", "diffHunk": "@@ -32,6 +32,8 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        return identityClient.authenticateWithAzureCli(request);\n+        return identityClient.authenticateWithAzureCli(request)\n+                .onErrorResume(t -> Mono.error(new CredentialUnavailableException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38009fd35dea903e40b687e2e0d3f84fe2eb57f6"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk4NjIyMA==", "bodyText": "This should use Reactor's Mono.error instead. Having a throw statement within a reactive stream will cause consumers to need to both catch using try/catch in the code block and add in a Reactor error operator such as onError.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r433986220", "createdAt": "2020-06-02T15:53:40Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -36,29 +38,20 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n+        StringBuilder message = new StringBuilder();\n         return Flux.fromIterable(credentials)\n                    .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {\n+                           throw logger.logExceptionAsError(new CredentialUnavailableException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38009fd35dea903e40b687e2e0d3f84fe2eb57f6"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk4ODEzMg==", "bodyText": "This code confuses me a bit, first we resume the error, potentially throwing or resuming with empty, then if it is the latter of empty we return an error. Could this be streamlined at all in the earlier code to bypass this operator? Such as using onErrorMap above.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r433988132", "createdAt": "2020-06-02T15:55:32Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -36,29 +38,20 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n+        StringBuilder message = new StringBuilder();\n         return Flux.fromIterable(credentials)\n                    .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {\n+                           throw logger.logExceptionAsError(new CredentialUnavailableException(\n+                                   unavailableError + p.getClass().getSimpleName() + \" authentication failed.\",\n+                                   t));\n+                       }\n+                       message.append(t.getMessage()).append(\" \"); \n                        return Mono.empty();\n                    }), 1)\n                    .next()\n                    .switchIfEmpty(Mono.defer(() -> {\n-\n-                       StringBuilder message = new StringBuilder(\"Tried \"\n-                             + credentials.stream().map(c -> c.getClass().getSimpleName())\n-                                   .collect(Collectors.joining(\", \"))\n-                             + \" but failed to acquire a token for any of them. Please verify the\"\n-                             + \" environment for the credentials\"\n-                             + \" and see more details in the causes below.\");\n-\n-                       // Chain Exceptions.\n-                       CredentialUnavailableException last = exceptions.get(exceptions.size() - 1);\n-                       for (int z = exceptions.size() - 2; z >= 0; z--) {\n-                           CredentialUnavailableException current = exceptions.get(z);\n-                           last = new CredentialUnavailableException(current.getMessage(), last);\n-                       }\n-                       return Mono.error(new CredentialUnavailableException(message.toString(), last));\n+                       return Mono.error(new CredentialUnavailableException(message.toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38009fd35dea903e40b687e2e0d3f84fe2eb57f6"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk4OTA5NA==", "bodyText": "onErrorMap?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r433989094", "createdAt": "2020-06-02T15:56:29Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -822,7 +822,8 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n             }\n \n             return true;\n-        });\n+        }).onErrorResume(t -> Mono.error(new CredentialUnavailableException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38009fd35dea903e40b687e2e0d3f84fe2eb57f6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk4OTkyMQ==", "bodyText": "Does the actual error message have an additional space? Could we clean that up if so.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .expectErrorMatches(e -> e instanceof CredentialUnavailableException && e.getMessage().contains(\"Azure  not Login\"))\n          \n          \n            \n                        .expectErrorMatches(e -> e instanceof CredentialUnavailableException && e.getMessage().contains(\"Azure not Login\"))", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r433989921", "createdAt": "2020-06-02T15:57:18Z", "author": {"login": "alzimmermsft"}, "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/AzureCliCredentialTest.java", "diffHunk": "@@ -77,7 +77,7 @@ public void azureCliCredentialAzNotLogInException() throws Exception {\n         // test\n         AzureCliCredential credential = new AzureCliCredentialBuilder().build();\n         StepVerifier.create(credential.getToken(request))\n-            .expectErrorMatches(e -> e instanceof Exception && \"Azure  not Login\".equals(e.getMessage()))\n+            .expectErrorMatches(e -> e instanceof CredentialUnavailableException && e.getMessage().contains(\"Azure  not Login\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38009fd35dea903e40b687e2e0d3f84fe2eb57f6"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bc8f78b4c08e51a3f19d45275c46b9ba7a5fa79", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0bc8f78b4c08e51a3f19d45275c46b9ba7a5fa79", "committedDate": "2020-06-03T07:24:12Z", "message": "change code according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e282c818792b0e125427916dba8c4ee73b511c3b", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e282c818792b0e125427916dba8c4ee73b511c3b", "committedDate": "2020-06-03T07:28:07Z", "message": "change code according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31b32fb8b4d59f4c1ea140ea72c9c0f837268c50", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/31b32fb8b4d59f4c1ea140ea72c9c0f837268c50", "committedDate": "2020-06-03T07:34:44Z", "message": "change code according to comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjkyNzQ1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-423292745", "createdAt": "2020-06-03T07:37:15Z", "commit": {"oid": "e282c818792b0e125427916dba8c4ee73b511c3b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNzozNzoxNVrOGePs_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNzozOToyOVrOGePxoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2Nzc0MA==", "bodyText": "This onErrorMap should be removed.\nWe don't want to map any exception to CredentialUnavailableException.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r434367740", "createdAt": "2020-06-03T07:37:15Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/AzureCliCredential.java", "diffHunk": "@@ -32,6 +32,8 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        return identityClient.authenticateWithAzureCli(request);\n+        return identityClient.authenticateWithAzureCli(request)\n+                .onErrorMap(t -> new CredentialUnavailableException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e282c818792b0e125427916dba8c4ee73b511c3b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2ODEyOQ==", "bodyText": "This if statement logic is redundant now.\ncan be removed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r434368129", "createdAt": "2020-06-03T07:37:56Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -36,29 +38,20 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n+        StringBuilder message = new StringBuilder();\n         return Flux.fromIterable(credentials)\n                    .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e282c818792b0e125427916dba8c4ee73b511c3b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2ODcyMQ==", "bodyText": "We need to retain the stack traces from individual exception and chain them.\nJava devs use the stack trace to analyze / debug issues.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r434368721", "createdAt": "2020-06-03T07:39:03Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -36,29 +38,20 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n+        StringBuilder message = new StringBuilder();\n         return Flux.fromIterable(credentials)\n-                   .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                   .flatMap(p -> p.getToken(request).onErrorResume(Exception.class, t -> {\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {\n+                           throw logger.logExceptionAsError(new CredentialUnavailableException(\n+                                   unavailableError + p.getClass().getSimpleName() + \" authentication failed.\",\n+                                   t));\n+                       }\n+                       message.append(t.getMessage()).append(\" \"); ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxODI1NA=="}, "originalCommit": {"oid": "6b25f41ea333a41910ae1af960e71654f2a9f368"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2ODkyOQ==", "bodyText": "We need to retain the stack traces from individual exception and chain them.\nJava devs use the stack trace to analyze / debug issues.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r434368929", "createdAt": "2020-06-03T07:39:29Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -36,29 +38,20 @@\n \n     @Override\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n-        List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n+        StringBuilder message = new StringBuilder();\n         return Flux.fromIterable(credentials)\n                    .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {\n+                        return Mono.error(logger.logExceptionAsError(new CredentialUnavailableException(\n+                                   unavailableError + p.getClass().getSimpleName() + \" authentication failed.\",\n+                                   t)));\n+                       }\n+                       message.append(t.getMessage()).append(\" \"); \n                        return Mono.empty();\n                    }), 1)\n                    .next()\n                    .switchIfEmpty(Mono.defer(() -> {\n-\n-                       StringBuilder message = new StringBuilder(\"Tried \"\n-                             + credentials.stream().map(c -> c.getClass().getSimpleName())\n-                                   .collect(Collectors.joining(\", \"))\n-                             + \" but failed to acquire a token for any of them. Please verify the\"\n-                             + \" environment for the credentials\"\n-                             + \" and see more details in the causes below.\");\n-\n-                       // Chain Exceptions.\n-                       CredentialUnavailableException last = exceptions.get(exceptions.size() - 1);\n-                       for (int z = exceptions.size() - 2; z >= 0; z--) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e282c818792b0e125427916dba8c4ee73b511c3b"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ef65e8c0276055b40216fbe01a0d899b308bd72", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6ef65e8c0276055b40216fbe01a0d899b308bd72", "committedDate": "2020-06-03T08:35:32Z", "message": "change code according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73d67984bbf9b1f1972a285335773cdf97f101ce", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/73d67984bbf9b1f1972a285335773cdf97f101ce", "committedDate": "2020-06-03T08:44:43Z", "message": "change code according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e1d10b7d6a0cb7b5b009ebe810ca06c8bde5ae9", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2e1d10b7d6a0cb7b5b009ebe810ca06c8bde5ae9", "committedDate": "2020-06-03T08:47:42Z", "message": "change code according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bab62540cc288dc638295bdb5b45485fb6d3f17", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2bab62540cc288dc638295bdb5b45485fb6d3f17", "committedDate": "2020-06-03T09:06:23Z", "message": "change code according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac15f1a60685941fa56ffb9f25c163f2e6269df1", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ac15f1a60685941fa56ffb9f25c163f2e6269df1", "committedDate": "2020-06-03T09:48:47Z", "message": "change code according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac8295bf774dec5959a0692f356f60eb36336a1e", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ac8295bf774dec5959a0692f356f60eb36336a1e", "committedDate": "2020-06-04T01:04:18Z", "message": "change code according to comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0OTk0MTA0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-424994104", "createdAt": "2020-06-05T04:51:27Z", "commit": {"oid": "ac8295bf774dec5959a0692f356f60eb36336a1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNDo1MToyN1rOGfgUoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNDo1MToyN1rOGfgUoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY4ODYwOQ==", "bodyText": "WHat does the error message with stack trace look like now ?\nCan you post the sample output here ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r435688609", "createdAt": "2020-06-05T04:51:27Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -39,26 +40,24 @@\n         List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n         return Flux.fromIterable(credentials)\n                    .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {\n+                           return Mono.error(new CredentialUnavailableException(\n+                                   unavailableError + p.getClass().getSimpleName() + \" authentication failed.\",\n+                                   t));\n+                       }\n                        exceptions.add(t);\n                        return Mono.empty();\n                    }), 1)\n                    .next()\n                    .switchIfEmpty(Mono.defer(() -> {\n-\n-                       StringBuilder message = new StringBuilder(\"Tried \"\n-                             + credentials.stream().map(c -> c.getClass().getSimpleName())\n-                                   .collect(Collectors.joining(\", \"))\n-                             + \" but failed to acquire a token for any of them. Please verify the\"\n-                             + \" environment for the credentials\"\n-                             + \" and see more details in the causes below.\");\n-\n                        // Chain Exceptions.\n                        CredentialUnavailableException last = exceptions.get(exceptions.size() - 1);\n                        for (int z = exceptions.size() - 2; z >= 0; z--) {\n                            CredentialUnavailableException current = exceptions.get(z);\n-                           last = new CredentialUnavailableException(current.getMessage(), last);\n+                           last = new CredentialUnavailableException(current.getMessage() + \" \" + last.getMessage(),\n+                                last.getCause());\n                        }\n-                       return Mono.error(new CredentialUnavailableException(message.toString(), last));\n+                       return Mono.error(last);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac8295bf774dec5959a0692f356f60eb36336a1e"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5911c67a9839892c375abed8b4f0d17ed34c1adf", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5911c67a9839892c375abed8b4f0d17ed34c1adf", "committedDate": "2020-06-08T02:47:25Z", "message": "change in chainedtokencredential"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5Mzg0NjI4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#pullrequestreview-429384628", "createdAt": "2020-06-12T00:16:47Z", "commit": {"oid": "5911c67a9839892c375abed8b4f0d17ed34c1adf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDoxNjo0N1rOGizAnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDoxNjo0N1rOGizAnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE0MDUwOQ==", "bodyText": "Why are we wrapping a non Credential Unavailable Exception into a Credential Unavailable Exception ?\nIt should be thrown as it is, to indicate a genuine exception even though credential is available to be used.\nThe distinction will help to debug customer issues too in future.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9022#discussion_r439140509", "createdAt": "2020-06-12T00:16:47Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/ChainedTokenCredential.java", "diffHunk": "@@ -38,27 +39,26 @@\n     public Mono<AccessToken> getToken(TokenRequestContext request) {\n         List<CredentialUnavailableException> exceptions = new ArrayList<>(4);\n         return Flux.fromIterable(credentials)\n-                   .flatMap(p -> p.getToken(request).onErrorResume(CredentialUnavailableException.class, t -> {\n-                       exceptions.add(t);\n+                   .flatMap(p -> p.getToken(request).onErrorResume(Exception.class, t -> {\n+                       if (!t.getClass().getSimpleName().equals(\"CredentialUnavailableException\")) {\n+                           return Mono.error(new CredentialUnavailableException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5911c67a9839892c375abed8b4f0d17ed34c1adf"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f389bb0c56209fb47edf8bc89cf7043ed3e16809", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f389bb0c56209fb47edf8bc89cf7043ed3e16809", "committedDate": "2020-06-15T06:57:14Z", "message": "change according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90445bea2d64a17ae594d7b37acb0289cd5d241f", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/90445bea2d64a17ae594d7b37acb0289cd5d241f", "committedDate": "2020-06-15T06:59:42Z", "message": "Merge branch 'master' into DefaultCredentialErrorMsg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83e1c442191a1b55366cf7876595deaa08202024", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/83e1c442191a1b55366cf7876595deaa08202024", "committedDate": "2020-06-15T07:35:18Z", "message": "remove test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91a22431c776dafadcbfaf49ac14b2105cfecac1", "author": {"user": {"login": "Luyunmt", "name": "Yun Lu (MSFT)"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/91a22431c776dafadcbfaf49ac14b2105cfecac1", "committedDate": "2020-06-15T07:36:49Z", "message": "Merge branch 'DefaultCredentialErrorMsg' of https://github.com/Luyunmt/azure-sdk-for-java into DefaultCredentialErrorMsg"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 785, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}