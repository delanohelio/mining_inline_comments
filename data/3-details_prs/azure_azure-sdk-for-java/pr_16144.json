{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwOTQxMzAz", "number": 16144, "title": "mgmt make authenticate with http pipeline private access", "bodyText": "Make authenticate(HttpPipeline, AzureProfile) private access\nAdd new public method withHttpPipeline(HttpPipeline) inside AzureConfigurableImpl, which would be inaccessible via the interface AzureConfigurable exposed to end user.\n\nThe scenario as below:\n*service*Manager.Configurable configurable = *service*Manager.configure();\n((AzureConfigurableImpl) configurable).withHttpPipeline(httpPipeline);\nmanagerInstance = configurable.authenticate(null, profile).withDefaultSubscription();\n\n\nFor test, add generic method buildManager() to help code clean", "createdAt": "2020-10-10T09:00:21Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144", "merged": true, "mergeCommit": {"oid": "8b823f7b90958e6f000282dc5ee6b6e083cee494"}, "closed": true, "closedAt": "2020-10-15T02:37:14Z", "author": {"login": "xseeseesee"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRG4KDgH2gAyNTAwOTQxMzAzOmE2Y2FjNjkwYTQwOGMyMDAwOWQxYTFhMDcxZDJmN2RmMWU3YWMxNWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSGATZAH2gAyNTAwOTQxMzAzOjI3ZjRhMmI4Mjg4Nzc0ODAxMzliYjQ2ODk5ODYzODE3Y2FmYzA0MTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a6cac690a408c20009d1a1a071d2f7df1e7ac15a", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a6cac690a408c20009d1a1a071d2f7df1e7ac15a", "committedDate": "2020-10-10T08:54:43Z", "message": "mgmt make authenticate with http pipeline private access"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDgxNjcy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#pullrequestreview-506081672", "createdAt": "2020-10-10T09:08:51Z", "commit": {"oid": "a6cac690a408c20009d1a1a071d2f7df1e7ac15a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwOTowODo1MVrOHfegRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwOToxMzowMFrOHfeiPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc2NzY4NA==", "bodyText": "An alternative might be export com.azure.resourcemanager.resources.fluentcore.arm.models.implementation to azure-resourcemanager-test in module-info as well.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#discussion_r502767684", "createdAt": "2020-10-10T09:08:51Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/resourcemanager/azure-resourcemanager-test/src/main/java/com/azure/resourcemanager/test/ResourceManagerTestBase.java", "diffHunk": "@@ -319,6 +321,28 @@ private void setAccessible(final Field field) {\n         });\n     }\n \n+    /**\n+     * Sets http pipeline for internal use.\n+     *\n+     * @param httpPipeline the http pipeline\n+     * @param azureConfigurable the azure configurable instance\n+     * @param impl the class type of azure configurable implementation\n+     * @param <AzureConfigurable> the type of azure configurable\n+     * @param <AzureConfigurableImpl> the type of azure configurable implementation\n+     * @return the azure configurable instance after setting internal http pipeline\n+     * @throws RuntimeException when field cannot be found or set.\n+     */\n+    protected <AzureConfigurable, AzureConfigurableImpl> AzureConfigurable setInternalHttpPipeline(HttpPipeline httpPipeline, AzureConfigurable azureConfigurable, Class<AzureConfigurableImpl> impl) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6cac690a408c20009d1a1a071d2f7df1e7ac15a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc2ODE0Mw==", "bodyText": "Do we need protected, or private would do?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#discussion_r502768143", "createdAt": "2020-10-10T09:12:29Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/arm/Manager.java", "diffHunk": "@@ -56,6 +58,10 @@ protected final void withResourceManager(ResourceManager resourceManager) {\n         this.resourceManager = resourceManager;\n     }\n \n+    protected void withInternalHttpPipeline(AzureConfigurable<?> azureConfigurable, HttpPipeline httpPipeline) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6cac690a408c20009d1a1a071d2f7df1e7ac15a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc2ODE5MQ==", "bodyText": "nit, maybe preconfiguredHttpPipeline would be a better name.\nNot important at this stage.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#discussion_r502768191", "createdAt": "2020-10-10T09:13:00Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/arm/implementation/AzureConfigurableImpl.java", "diffHunk": "@@ -36,6 +36,7 @@\n     private RetryPolicy retryPolicy;\n     private Configuration configuration;\n     private List<TokenCredential> tokens;\n+    private HttpPipeline internalHttpPipeline;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6cac690a408c20009d1a1a071d2f7df1e7ac15a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDgxNTgw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#pullrequestreview-506081580", "createdAt": "2020-10-10T09:07:07Z", "commit": {"oid": "a6cac690a408c20009d1a1a071d2f7df1e7ac15a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwOTowNzowN1rOHfefyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwOToxNzo0N1rOHfejwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc2NzU2Mg==", "bodyText": "i think httpPipeline is enough", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#discussion_r502767562", "createdAt": "2020-10-10T09:07:07Z", "author": {"login": "yungezz"}, "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/arm/implementation/AzureConfigurableImpl.java", "diffHunk": "@@ -36,6 +36,7 @@\n     private RetryPolicy retryPolicy;\n     private Configuration configuration;\n     private List<TokenCredential> tokens;\n+    private HttpPipeline internalHttpPipeline;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6cac690a408c20009d1a1a071d2f7df1e7ac15a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc2ODU3Nw==", "bodyText": "is there way to make this part of code resuable?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#discussion_r502768577", "createdAt": "2020-10-10T09:17:47Z", "author": {"login": "yungezz"}, "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/arm/Manager.java", "diffHunk": "@@ -25,8 +26,9 @@\n     protected Manager(HttpPipeline httpPipeline, AzureProfile profile, InnerT innerManagementClient) {\n         this.httpPipeline = httpPipeline;\n         if (httpPipeline != null) {\n-            this.resourceManager = ResourceManager.authenticate(httpPipeline, profile)\n-                .withDefaultSubscription();\n+            ResourceManager.Configurable resourceConfigurable = ResourceManager.configure();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6cac690a408c20009d1a1a071d2f7df1e7ac15a"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "821287be67f7f6179f43920a0217a5fc8c42838a", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/821287be67f7f6179f43920a0217a5fc8c42838a", "committedDate": "2020-10-12T06:46:34Z", "message": "reformat pass http pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9d05ac4711168662776f83c05dc312bbc2d68aa", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e9d05ac4711168662776f83c05dc312bbc2d68aa", "committedDate": "2020-10-12T06:53:35Z", "message": "apply changes in storage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b76a3ce72adb209b71e4ffc8e9c1d84322131b6", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5b76a3ce72adb209b71e4ffc8e9c1d84322131b6", "committedDate": "2020-10-12T11:02:06Z", "message": "apply changes for each service manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d8a41d43214e5563a47895a7b3657d7de96330f", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9d8a41d43214e5563a47895a7b3657d7de96330f", "committedDate": "2020-10-12T11:02:51Z", "message": "update azure resource manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94c72029f6f3be61f20c0e5abec718d27f5b35a6", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/94c72029f6f3be61f20c0e5abec718d27f5b35a6", "committedDate": "2020-10-12T11:03:24Z", "message": "update samples"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDM4NTEx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#pullrequestreview-507038511", "createdAt": "2020-10-13T03:08:18Z", "commit": {"oid": "94c72029f6f3be61f20c0e5abec718d27f5b35a6"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMzowODoxOFrOHgT0Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMzoxMzowOVrOHgT4bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY0MTA5OA==", "bodyText": "nit, java should be able to use (NoSuchMethodException | IllegalAccessException | InstantiationException | InvocationTargetException  ex)", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#discussion_r503641098", "createdAt": "2020-10-13T03:08:18Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/resourcemanager/azure-resourcemanager-test/src/main/java/com/azure/resourcemanager/test/ResourceManagerTestBase.java", "diffHunk": "@@ -319,6 +321,36 @@ private void setAccessible(final Field field) {\n         });\n     }\n \n+    /**\n+     * Builds the manager with provided http pipeline and profile in general manner.\n+     *\n+     * @param manager the class of the manager\n+     * @param httpPipeline the http pipeline\n+     * @param profile the azure profile\n+     * @param <T> the type of the manager\n+     * @return the manager instance\n+     * @throws RuntimeException when field cannot be found or set.\n+     */\n+    protected <T> T buildManager(Class<T> manager, HttpPipeline httpPipeline, AzureProfile profile) {\n+        try {\n+            Constructor<T> constructor = manager.getDeclaredConstructor(httpPipeline.getClass(), profile.getClass());\n+            AccessController.doPrivileged((PrivilegedAction<Object>) () -> {\n+                constructor.setAccessible(true);\n+                return null;\n+            });\n+            return constructor.newInstance(httpPipeline, profile);\n+\n+        } catch (NoSuchMethodException ex) {\n+            throw logger.logExceptionAsError(new RuntimeException(ex));\n+        } catch (IllegalAccessException ex) {\n+            throw logger.logExceptionAsError(new RuntimeException(ex));\n+        } catch (InstantiationException ex) {\n+            throw logger.logExceptionAsError(new RuntimeException(ex));\n+        } catch (InvocationTargetException ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c72029f6f3be61f20c0e5abec718d27f5b35a6"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY0MjAwMw==", "bodyText": "If this changed, we might able to delete a few overload in TestUtilities about random rg name and random guid.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#discussion_r503642003", "createdAt": "2020-10-13T03:12:02Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/resourcemanager/azure-resourcemanager-samples/src/test/java/com/azure/resourcemanager/samples/GraphRbacTests.java", "diffHunk": "@@ -34,7 +34,7 @@ public void testManageUsersGroupsAndRoles() {\n             return;\n         }\n \n-        Assertions.assertTrue(ManageUsersGroupsAndRoles.runSample(authenticated, profile));\n+        Assertions.assertTrue(ManageUsersGroupsAndRoles.runSample(azureResourceManager, profile));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c72029f6f3be61f20c0e5abec718d27f5b35a6"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY0MjIyMA==", "bodyText": "Could use some comment here to describe the necessity of the (a bit strange) code.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#discussion_r503642220", "createdAt": "2020-10-13T03:13:09Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/arm/implementation/AzureConfigurableImpl.java", "diffHunk": "@@ -125,7 +126,15 @@ public T withConfiguration(Configuration configuration) {\n         return (T) this;\n     }\n \n+    public void withHttpPipeline(HttpPipeline httpPipeline) {\n+        Objects.requireNonNull(httpPipeline);\n+        this.httpPipeline = httpPipeline;\n+    }\n+\n     protected HttpPipeline buildHttpPipeline(TokenCredential credential, AzureProfile profile) {\n+        if (this.httpPipeline != null) {\n+            return httpPipeline;\n+        }\n         Objects.requireNonNull(credential);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c72029f6f3be61f20c0e5abec718d27f5b35a6"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7169d710576e88c41c06f9cca11445e3833391d", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a7169d710576e88c41c06f9cca11445e3833391d", "committedDate": "2020-10-13T05:27:14Z", "message": "update pom based on the changes of tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f888b89287f401360e4066f9bf15205fda6e19e1", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f888b89287f401360e4066f9bf15205fda6e19e1", "committedDate": "2020-10-13T05:29:46Z", "message": "remove unused sample utils method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a8c3f3224d7c212f9a096e8a5a7a91c9a2f020c", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9a8c3f3224d7c212f9a096e8a5a7a91c9a2f020c", "committedDate": "2020-10-13T06:38:44Z", "message": "update test for jacoco coverage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MTMwODI5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#pullrequestreview-507130829", "createdAt": "2020-10-13T07:14:03Z", "commit": {"oid": "9a8c3f3224d7c212f9a096e8a5a7a91c9a2f020c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ef99cf93aa04b3627662dfaaa1a5d3ab5d90e9d", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8ef99cf93aa04b3627662dfaaa1a5d3ab5d90e9d", "committedDate": "2020-10-13T07:46:26Z", "message": "Merge branch 'master' into hide-auth-pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fdbb1b2c7688cdc47d2276f0f74a19c74d1d33e", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7fdbb1b2c7688cdc47d2276f0f74a19c74d1d33e", "committedDate": "2020-10-13T08:15:09Z", "message": "fix compile errors on latest code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MTkwNTI2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#pullrequestreview-507190526", "createdAt": "2020-10-13T08:28:23Z", "commit": {"oid": "8ef99cf93aa04b3627662dfaaa1a5d3ab5d90e9d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwODoyODoyM1rOHgbSpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwODoyODoyM1rOHgbSpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc2MzYyMA==", "bodyText": "This will be part of the public API. Do we need this method to hide the authenticate method that uses the pipeline?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16144#discussion_r503763620", "createdAt": "2020-10-13T08:28:23Z", "author": {"login": "srnagar"}, "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/arm/Manager.java", "diffHunk": "@@ -56,6 +58,11 @@ protected final void withResourceManager(ResourceManager resourceManager) {\n         this.resourceManager = resourceManager;\n     }\n \n+    protected <T extends AzureConfigurable<?>> T withHttpPipeline(HttpPipeline httpPipeline, T azureConfigurable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef99cf93aa04b3627662dfaaa1a5d3ab5d90e9d"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c65c49fde850e75629332a95fbf32e3d0f9beab", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9c65c49fde850e75629332a95fbf32e3d0f9beab", "committedDate": "2020-10-13T09:24:49Z", "message": "remove withHttpPipeline from Manager.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27f4a2b828877480139bb46899863817cafc0417", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/27f4a2b828877480139bb46899863817cafc0417", "committedDate": "2020-10-13T10:27:38Z", "message": "update pom and fix checkstyle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2100, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}