{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNzIzMDUx", "number": 10220, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzozMzowMVrODyLGgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjowMToyMVrODzzWBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTM3MjgwOnYy", "diffSide": "LEFT", "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzozMzowMVrOGGESxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzozMzowMVrOGGESxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAxNDk4Mw==", "bodyText": "We want to keep these exclusions.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#discussion_r409014983", "createdAt": "2020-04-15T17:33:01Z", "author": {"login": "srnagar"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -316,73 +316,31 @@\n         </executions>\n       </plugin>\n \n-      <!-- Performs test coverage analysis -->\n       <plugin>\n         <groupId>org.jacoco</groupId>\n         <artifactId>jacoco-maven-plugin</artifactId>\n         <version>0.8.5</version> <!-- {x-version-update;org.jacoco:jacoco-maven-plugin;external_dependency} -->\n         <executions>\n           <execution>\n-            <id>default-instrument</id>\n+            <id>prepare-agent</id>\n             <goals>\n-              <goal>instrument</goal>\n+              <goal>prepare-agent</goal>\n             </goals>\n           </execution>\n           <execution>\n-            <id>default-restore-instrumented-classes</id>\n+            <id>default-instrument</id>\n             <goals>\n-              <goal>restore-instrumented-classes</goal>\n+              <goal>instrument</goal>\n             </goals>\n           </execution>\n           <execution>\n-            <!-- This generates the unit test reports for individual modules.\n-              jacoco-test-coverage generates aggregate reports for all modules -->\n-            <id>post-unit-test</id>\n-            <goals>\n-              <goal>report</goal>\n-            </goals>\n-            <configuration>\n-              <!-- Sets the output directory for the code coverage report. -->\n-              <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>\n-              <excludes>\n-                <exclude>**/com/azure/cosmos/implementation/apachecommons/**/*</exclude>\n-                <exclude>**/com/azure/cosmos/implementation/guava25/**/*</exclude>\n-                <exclude>**/com/azure/cosmos/implementation/guava27/**/*</exclude>\n-              </excludes>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9ec62c14e29d23fe9a2baa588ceda2a45e41856"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTM3NjExOnYy", "diffSide": "LEFT", "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzozMzo1M1rOGGEU0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzozMzo1M1rOGGEU0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAxNTUwNA==", "bodyText": "This is required to ensure we don't fall below coverage threshold. The PR should fail if the coverage is below this threshold.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#discussion_r409015504", "createdAt": "2020-04-15T17:33:53Z", "author": {"login": "srnagar"}, "path": "sdk/parents/azure-client-sdk-parent/pom.xml", "diffHunk": "@@ -316,73 +316,31 @@\n         </executions>\n       </plugin>\n \n-      <!-- Performs test coverage analysis -->\n       <plugin>\n         <groupId>org.jacoco</groupId>\n         <artifactId>jacoco-maven-plugin</artifactId>\n         <version>0.8.5</version> <!-- {x-version-update;org.jacoco:jacoco-maven-plugin;external_dependency} -->\n         <executions>\n           <execution>\n-            <id>default-instrument</id>\n+            <id>prepare-agent</id>\n             <goals>\n-              <goal>instrument</goal>\n+              <goal>prepare-agent</goal>\n             </goals>\n           </execution>\n           <execution>\n-            <id>default-restore-instrumented-classes</id>\n+            <id>default-instrument</id>\n             <goals>\n-              <goal>restore-instrumented-classes</goal>\n+              <goal>instrument</goal>\n             </goals>\n           </execution>\n           <execution>\n-            <!-- This generates the unit test reports for individual modules.\n-              jacoco-test-coverage generates aggregate reports for all modules -->\n-            <id>post-unit-test</id>\n-            <goals>\n-              <goal>report</goal>\n-            </goals>\n-            <configuration>\n-              <!-- Sets the output directory for the code coverage report. -->\n-              <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>\n-              <excludes>\n-                <exclude>**/com/azure/cosmos/implementation/apachecommons/**/*</exclude>\n-                <exclude>**/com/azure/cosmos/implementation/guava25/**/*</exclude>\n-                <exclude>**/com/azure/cosmos/implementation/guava27/**/*</exclude>\n-              </excludes>\n-            </configuration>\n-          </execution>\n-          <execution>\n-            <id>check</id>\n+            <id>default-restore-instrumented-classes</id>\n             <goals>\n-              <goal>check</goal>\n+              <goal>restore-instrumented-classes</goal>\n             </goals>\n-            <configuration>\n-              <rules>\n-                <rule>\n-                  <element>BUNDLE</element>\n-                  <limits>\n-                    <limit>\n-                      <counter>LINE</counter>\n-                      <value>COVEREDRATIO</value>\n-                      <minimum>${jacoco.min.linecoverage}</minimum>\n-                    </limit>\n-                    <limit>\n-                      <counter>BRANCH</counter>\n-                      <value>COVEREDRATIO</value>\n-                      <minimum>${jacoco.min.branchcoverage}</minimum>\n-                    </limit>\n-                  </limits>\n-                </rule>\n-              </rules>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9ec62c14e29d23fe9a2baa588ceda2a45e41856"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTM4OTAwOnYy", "diffSide": "LEFT", "path": "eng/jacoco-test-coverage/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzozNzoxN1rOGGEc3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzozNzoxN1rOGGEc3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAxNzU2NQ==", "bodyText": "This will require a corresponding update to index.html", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#discussion_r409017565", "createdAt": "2020-04-15T17:37:17Z", "author": {"login": "srnagar"}, "path": "eng/jacoco-test-coverage/pom.xml", "diffHunk": "@@ -188,14 +188,11 @@\n         <version>0.8.5</version> <!-- {x-version-update;org.jacoco:jacoco-maven-plugin;external_dependency} -->\n         <executions>\n           <execution>\n-            <phase>prepare-package</phase>\n+            <id>report-aggregate</id>\n+            <phase>verify</phase>\n             <goals>\n               <goal>report-aggregate</goal>\n             </goals>\n-            <configuration>\n-              <!-- Sets the output directory for the code coverage report. -->\n-              <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9ec62c14e29d23fe9a2baa588ceda2a45e41856"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NjQ1MTg5OnYy", "diffSide": "RIGHT", "path": "eng/pipelines/aggregate-reports.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjowMToyMVrOGIb3HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMzoyNjo1OFrOGIwxIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5ODI2OA==", "bodyText": "This is the dependency report that gets generated, but this won't generate using the new build structure.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#discussion_r411498268", "createdAt": "2020-04-20T16:01:21Z", "author": {"login": "alzimmermsft"}, "path": "eng/pipelines/aggregate-reports.yml", "diffHunk": "@@ -52,13 +50,16 @@ jobs:\n       displayName: Generate Interdependency Report Data\n \n     - pwsh: |\n-        copy -r target/staging $(Build.ArtifactStagingDirectory)\n-        copy target/dependency-whitelist.json (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy eng/code-quality-reports/src/main/resources/index.html $(Build.ArtifactStagingDirectory)\n-        copy output/pom.client.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy eng/common/InterdependencyGraph.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy eng/common/dependency-whitelist.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy data.js (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n+        Copy-Item eng/jacoco-test-coverage/target/staging $(Build.ArtifactStagingDirectory) -Recurse\n+        Copy-Item eng/jacoco-test-coverage/target/dependency-whitelist.json $(Build.ArtifactStagingDirectory)\\staging\n+        Copy-Item eng/code-quality-reports/src/main/resources/index.html $(Build.ArtifactStagingDirectory)\n+        \n+        # What is this?\n+        # copy output/pom.client.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4478b7d2baf0b60b3c52e0d13e68c0fea2603cf1"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg0MDgwMg==", "bodyText": "OK so how do we work around this one? Do we need to move the dependency checker logic into jacoco-test-coverage?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10220#discussion_r411840802", "createdAt": "2020-04-21T03:26:58Z", "author": {"login": "mitchdenny"}, "path": "eng/pipelines/aggregate-reports.yml", "diffHunk": "@@ -52,13 +50,16 @@ jobs:\n       displayName: Generate Interdependency Report Data\n \n     - pwsh: |\n-        copy -r target/staging $(Build.ArtifactStagingDirectory)\n-        copy target/dependency-whitelist.json (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy eng/code-quality-reports/src/main/resources/index.html $(Build.ArtifactStagingDirectory)\n-        copy output/pom.client.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy eng/common/InterdependencyGraph.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy eng/common/dependency-whitelist.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n-        copy data.js (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")\n+        Copy-Item eng/jacoco-test-coverage/target/staging $(Build.ArtifactStagingDirectory) -Recurse\n+        Copy-Item eng/jacoco-test-coverage/target/dependency-whitelist.json $(Build.ArtifactStagingDirectory)\\staging\n+        Copy-Item eng/code-quality-reports/src/main/resources/index.html $(Build.ArtifactStagingDirectory)\n+        \n+        # What is this?\n+        # copy output/pom.client.html (Join-Path $(Build.ArtifactStagingDirectory) \"staging\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5ODI2OA=="}, "originalCommit": {"oid": "4478b7d2baf0b60b3c52e0d13e68c0fea2603cf1"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1788, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}