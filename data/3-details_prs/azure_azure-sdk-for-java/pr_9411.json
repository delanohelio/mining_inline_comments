{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjg1OTg4", "number": 9411, "title": "Updates ServiceBusClientBuilder to match API changes", "bodyText": "Updates service bus builder to match new API changes\n\nAdds ServiceBusReceiverClientBuilder and ServiceBusSenderClientBuilder\n\n\nReceiveMessageOptions is no longer a public class.\nAdds synchronous classes\nCleans up samples.\nRemoves overlapping samples.\nFixes build issues.\n\nAPI View: https://apiview.dev/Assemblies/Review/6af850ed7eb04843a6897afbe13cdd28\nFixes #9401", "createdAt": "2020-03-23T23:08:23Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411", "merged": true, "mergeCommit": {"oid": "643d881a2c85c5a9925ab843d3fb852bd8e09c13"}, "closed": true, "closedAt": "2020-03-25T02:33:06Z", "author": {"login": "conniey"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQr8nmAFqTM4MDAwMTg4NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ936WgBqjMxNjIyMTMzNzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDAxODg1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#pullrequestreview-380001885", "createdAt": "2020-03-24T05:04:04Z", "commit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTowNDowNFrOF6hGLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxNjozMFrOF6hQrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwMzk4Mg==", "bodyText": "ReceiveMessageOptions :  Should this be removed ? You have added these properties in  ServiceBusReceiverBuilder already.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#discussion_r396903982", "createdAt": "2020-03-24T05:04:04Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ReceiveMessageOptions.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNTM3Mg==", "bodyText": "Should we use term producers ? This is eventhub term. How about senders", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#discussion_r396905372", "createdAt": "2020-03-24T05:10:41Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java", "diffHunk": "@@ -140,90 +148,77 @@ public ServiceBusClientBuilder proxyOptions(ProxyOptions proxyOptions) {\n     }\n \n     /**\n-     * Specify connection string and  queue name for connection to Queue.\n+     * Sets the retry options for Service Bus clients. If not specified, the default retry options are used.\n      *\n-     * @param connectionString to connect to service bus resource.\n-     * @param topicOrQueueName The name of the queue.\n-     *\n-     * @return The {@link ServiceBusClientBuilder}.\n-     */\n-    public ServiceBusClientBuilder connectionString(String connectionString, String topicOrQueueName) {\n-        this.serviceBusResourceName = topicOrQueueName;\n-        return connectionString(connectionString);\n-    }\n-\n-    /**\n-     * @param retryPolicy to recover from Connection.\n+     * @param retryOptions The retry options to use.\n      *\n-     * @return The {@link ServiceBusClientBuilder}.\n+     * @return The updated {@link ServiceBusClientBuilder} object.\n      */\n-    public ServiceBusClientBuilder retryPolicy(AmqpRetryPolicy retryPolicy) {\n+    public ServiceBusClientBuilder retryOptions(AmqpRetryOptions retryOptions) {\n+        this.retryOptions = retryOptions;\n         return this;\n     }\n \n     /**\n-     * This is valid for receiving messages only.\n+     * Sets the scheduler to use.\n      *\n-     * @param receiveMessageOptions for receiving.\n+     * @param scheduler Scheduler to be used.\n      *\n-     * @return The {@link ServiceBusClientBuilder}.\n+     * @return The updated {@link ServiceBusClientBuilder} object.\n      */\n-    public ServiceBusClientBuilder receiveMessageOptions(ReceiveMessageOptions receiveMessageOptions) {\n-        this.receiveMessageOptions = receiveMessageOptions;\n+    ServiceBusClientBuilder scheduler(Scheduler scheduler) {\n+        this.scheduler = scheduler;\n         return this;\n     }\n \n     /**\n-     * @param transportType to use.\n+     * Sets the transport type by which all the communication with Azure Service Bus occurs. Default value is {@link\n+     * AmqpTransportType#AMQP}.\n      *\n-     * @return The {@link ServiceBusClientBuilder}.\n+     * @param transportType The transport type to use.\n+     *\n+     * @return The updated {@link ServiceBusClientBuilder} object.\n      */\n     public ServiceBusClientBuilder transportType(AmqpTransportType transportType) {\n         this.transport = transportType;\n         return this;\n     }\n \n     /**\n-     * @param retryOptions to manage AMQP connection.\n+     * A new instance of {@link ServiceBusSenderClientBuilder} used to configure Service Bus message producers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "originalPosition": 198}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNjY2OQ==", "bodyText": "I thought of changing this in APIview\nrenewDuration->renewalDuration", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#discussion_r396906669", "createdAt": "2020-03-24T05:16:30Z", "author": {"login": "hemanttanwar"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java", "diffHunk": "@@ -338,4 +320,252 @@ private ProxyOptions getDefaultProxyConfiguration(Configuration configuration) {\n \n         return new ProxyOptions(authentication, proxy, username, password);\n     }\n+\n+    private static boolean isNullOrEmpty(String item) {\n+        return item == null || item.isEmpty();\n+    }\n+\n+    /**\n+     * Builder for creating {@link ServiceBusSenderClient} and {@link ServiceBusSenderAsyncClient} to publish messages\n+     * to Service Bus.\n+     */\n+    public final class ServiceBusSenderClientBuilder {\n+        private String queueOrTopicName;\n+\n+        private ServiceBusSenderClientBuilder() {\n+        }\n+\n+        /**\n+         * Sets the name of the Service Bus resource to publish messages to.\n+         *\n+         * @param queueOrTopicName Name of the Service Bus resource to publish messages to.\n+         *\n+         * @return The updated {@link ServiceBusSenderClientBuilder} builder.\n+         */\n+        public ServiceBusSenderClientBuilder entityName(String queueOrTopicName) {\n+            this.queueOrTopicName = queueOrTopicName;\n+            return this;\n+        }\n+\n+        /**\n+         * Creates an <b>asynchronous</b> {@link ServiceBusSenderAsyncClient client} for transmitting {@link\n+         * ServiceBusMessage} to a Service Bus queue or topic.\n+         *\n+         * @return A new {@link ServiceBusSenderAsyncClient} for transmitting to a Service queue or topic.\n+         */\n+        public ServiceBusSenderAsyncClient buildAsyncClient() {\n+            final ServiceBusConnectionProcessor connectionProcessor = getOrCreateConnectionProcessor(messageSerializer);\n+\n+            if (isNullOrEmpty(connectionStringEntityName) && isNullOrEmpty(queueOrTopicName)) {\n+                throw logger.logExceptionAsError(new IllegalStateException(\n+                    \"Cannot create sender without setting the entityName\"));\n+            }\n+            if (!isNullOrEmpty(connectionStringEntityName) && !isNullOrEmpty(queueOrTopicName)\n+                && !connectionStringEntityName.equals(queueOrTopicName)) {\n+                throw logger.logExceptionAsError(new IllegalStateException(String.format(\n+                    \"entityName '%s' from connection string does not match the queueOrTopicName '%s' set in sender.\",\n+                    connectionStringEntityName, queueOrTopicName)));\n+            }\n+\n+            final String entityName = queueOrTopicName != null ? queueOrTopicName : connectionStringEntityName;\n+\n+            return new ServiceBusSenderAsyncClient(entityName, connectionProcessor, retryOptions, tracerProvider,\n+                messageSerializer);\n+        }\n+\n+        /**\n+         * Creates a <b>synchronous</b> {@link ServiceBusSenderClient client} for transmitting {@link ServiceBusMessage}\n+         * to a Service Bus queue or topic.\n+         *\n+         * @return A new {@link ServiceBusSenderAsyncClient} for transmitting to a Service queue or topic.\n+         */\n+        public ServiceBusSenderClient buildClient() {\n+            return new ServiceBusSenderClient(buildAsyncClient());\n+        }\n+    }\n+\n+    /**\n+     * Builder for creating {@link ServiceBusReceiverClient} and {@link ServiceBusReceiverAsyncClient} to consume\n+     * messages from Service Bus.\n+     */\n+    public final class ServiceBusReceiverClientBuilder {\n+        // Using 0 pre-fetch count for both receive modes, to avoid message lock lost exceptions in application receiving\n+        // messages at a slow rate. Applications can set it to a higher value if they need better performance.\n+        private static final int DEFAULT_PREFETCH_COUNT = 1;\n+\n+        private boolean autoComplete;\n+        private Duration maxAutoLockRenewalDuration;\n+        private int prefetchCount = DEFAULT_PREFETCH_COUNT;\n+        private String queueName;\n+        private String subscriptionName;\n+        private String topicName;\n+        private ReceiveMode receiveMode = ReceiveMode.PEEK_LOCK;\n+\n+        private ServiceBusReceiverClientBuilder() {\n+        }\n+\n+        /**\n+         * Sets whether or not to automatically complete a received message after it has been processed.\n+         *\n+         * @param autoComplete {@code true} to automatically complete a received message after it has been\n+         *     processed; {@code false} otherwise.\n+         *\n+         * @return The modified {@link ServiceBusReceiverClientBuilder} object.\n+         */\n+        public ServiceBusReceiverClientBuilder isAutoComplete(boolean autoComplete) {\n+            this.autoComplete = autoComplete;\n+            return this;\n+        }\n+\n+        /**\n+         * Sets the maximum duration within which the lock will be renewed automatically. This value should be greater\n+         * than the longest message lock duration.\n+         *\n+         * @param renewDuration The maximum duration within which the lock will be renewed automatically.\n+         *\n+         * @return The modified {@link ServiceBusReceiverClientBuilder} object.\n+         */\n+        public ServiceBusReceiverClientBuilder maxAutoLockRenewalDuration(Duration renewDuration) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "originalPosition": 450}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjA4MzIw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9411#pullrequestreview-380608320", "createdAt": "2020-03-24T18:55:53Z", "commit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f27bbcbe23000b218e5b03d15b38ea20a981c33c", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f27bbcbe23000b218e5b03d15b38ea20a981c33c", "committedDate": "2020-03-24T22:42:31Z", "message": "Updating client builder."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d6929ed9890efb7ead9373ce5a9c86e49228ccb", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8d6929ed9890efb7ead9373ce5a9c86e49228ccb", "committedDate": "2020-03-24T22:42:32Z", "message": "Fixing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6c577a4aef8042e80c1b2c9d80c54d6344a3d9f", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d6c577a4aef8042e80c1b2c9d80c54d6344a3d9f", "committedDate": "2020-03-24T22:42:33Z", "message": "Adding documentation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5c84a075aa6ab4c1cbb8de7b54339c6819781b2", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b5c84a075aa6ab4c1cbb8de7b54339c6819781b2", "committedDate": "2020-03-24T22:42:33Z", "message": "Fixing samples."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cef1a11a1ac1a7329f4f64adaf0b17f444f306ab", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cef1a11a1ac1a7329f4f64adaf0b17f444f306ab", "committedDate": "2020-03-24T22:42:33Z", "message": "Fix README samples."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e9938641b0fb375517ad355ff2099763b2e04d2", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8e9938641b0fb375517ad355ff2099763b2e04d2", "committedDate": "2020-03-24T22:42:34Z", "message": "Add queue name."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24e38998fe65734e98428fa9f853a50a45bd6690", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/24e38998fe65734e98428fa9f853a50a45bd6690", "committedDate": "2020-03-24T22:42:34Z", "message": "Fixing bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d49f9b011258418310e46157d4cf257008cb33c0", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d49f9b011258418310e46157d4cf257008cb33c0", "committedDate": "2020-03-24T22:42:35Z", "message": "Fix checkstyles."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0755024e7d2f725e76e67f4d8739fd6f6666c4e8", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0755024e7d2f725e76e67f4d8739fd6f6666c4e8", "committedDate": "2020-03-24T22:42:35Z", "message": "Fixing suppressions."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7e376e21caf269cec2d70ec6759ad4cfb35a188", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c7e376e21caf269cec2d70ec6759ad4cfb35a188", "committedDate": "2020-03-23T23:40:20Z", "message": "Fixing bug"}, "afterCommit": {"oid": "b258162d231dbb79ceb23af6689a66adfd09a22d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b258162d231dbb79ceb23af6689a66adfd09a22d", "committedDate": "2020-03-24T23:01:35Z", "message": "Fix build breaks."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9ce5bb0c7e617d737e54d94a5c8a6c7250a0367", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9ce5bb0c7e617d737e54d94a5c8a6c7250a0367", "committedDate": "2020-03-24T23:03:22Z", "message": "Fix build breaks."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b258162d231dbb79ceb23af6689a66adfd09a22d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b258162d231dbb79ceb23af6689a66adfd09a22d", "committedDate": "2020-03-24T23:01:35Z", "message": "Fix build breaks."}, "afterCommit": {"oid": "b9ce5bb0c7e617d737e54d94a5c8a6c7250a0367", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9ce5bb0c7e617d737e54d94a5c8a6c7250a0367", "committedDate": "2020-03-24T23:03:22Z", "message": "Fix build breaks."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1e71403ecc83b66fefda6b64571cfb9200eae67", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b1e71403ecc83b66fefda6b64571cfb9200eae67", "committedDate": "2020-03-24T23:06:31Z", "message": "Fixing tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95a13eafa50b4759c9375b041c925e41b20b28a1", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/95a13eafa50b4759c9375b041c925e41b20b28a1", "committedDate": "2020-03-25T01:09:52Z", "message": "Updating language."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2bbbc2f3993bb98e515303da3d44983da30165", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ac2bbbc2f3993bb98e515303da3d44983da30165", "committedDate": "2020-03-25T01:13:58Z", "message": "Fix checkstyle issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8b664d8a00ff404cdcfcc43441cd92a62fe8a3d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f8b664d8a00ff404cdcfcc43441cd92a62fe8a3d", "committedDate": "2020-03-25T01:33:39Z", "message": "Fix snippets."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ba80d15b09807637c5bfe5c546896910219fb1d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7ba80d15b09807637c5bfe5c546896910219fb1d", "committedDate": "2020-03-25T02:13:57Z", "message": "Fix checkstyle."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed1cb3f90df650972e454d9d73fb74c4977aae47", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ed1cb3f90df650972e454d9d73fb74c4977aae47", "committedDate": "2020-03-25T01:52:07Z", "message": "Fix checkstyle."}, "afterCommit": {"oid": "7ba80d15b09807637c5bfe5c546896910219fb1d", "author": {"user": {"login": "conniey", "name": "Connie Yau"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7ba80d15b09807637c5bfe5c546896910219fb1d", "committedDate": "2020-03-25T02:13:57Z", "message": "Fix checkstyle."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1496, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}