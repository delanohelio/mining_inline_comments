{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0ODQ4Mjkx", "number": 11546, "title": "Fixed exceptions thrown for KeyVault's KeyClient.listPropertiesOfKeyVersions()", "bodyText": "Fixed keyClient.listPropertiesOfKeyVersions() to throw a ResourceNotFoundException when a given key cannot be found. Also fixed the @throws section of its Javadoc.\nBased on discussion in this issue.", "createdAt": "2020-05-29T02:26:40Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11546", "merged": true, "mergeCommit": {"oid": "a01c9e62e279618a3921bf60fb88351a0c6f5e96"}, "closed": true, "closedAt": "2020-06-05T23:29:39Z", "author": {"login": "vcolin7"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcl48fRAH2gAyNDI0ODQ4MjkxOjFkMWUxOWFhOGZmN2ViMzE2NjFlZTk3MTU2ZTQyMjQ2MmRjYjY2MTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoaJbcgFqTQyNTY1NjY0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1d1e19aa8ff7eb31661ee97156e422462dcb6612", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1d1e19aa8ff7eb31661ee97156e422462dcb6612", "committedDate": "2020-05-29T02:22:02Z", "message": "Fixed keyClient.listPropertiesOfKeyVersions() to throw a ResourceNotFoundException when a given key cannot be found. Also fixed the @throws section of its Javadoc."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjc2NzUx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11546#pullrequestreview-421276751", "createdAt": "2020-05-29T20:46:13Z", "commit": {"oid": "1d1e19aa8ff7eb31661ee97156e422462dcb6612"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQyMDo0NjoxM1rOGcrj2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQyMDo0NjoxM1rOGcrj2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcyNzAwMg==", "bodyText": "Resource Not Found exception is used to indicate 404 response from the service.\nif service doesn't throw 404, we should not alter it here as that will result in SDK overriding service behavior and will need to do it manually everywhere in an endless cycle.\nrather change the javadocs to reflect the actual behavior and follow up with the service if this behaviour feels inconsistent or is a bug.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11546#discussion_r432727002", "createdAt": "2020-05-29T20:46:13Z", "author": {"login": "g2vinay"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/KeyAsyncClient.java", "diffHunk": "@@ -1228,8 +1228,14 @@ public String getVaultUrl() {\n             return service.getKeyVersions(vaultUrl, name, DEFAULT_MAX_PAGE_RESULTS, apiVersion, ACCEPT_LANGUAGE,\n                 CONTENT_TYPE_HEADER_VALUE, context.addData(AZ_TRACING_NAMESPACE_KEY, KEYVAULT_TRACING_NAMESPACE_VALUE))\n                 .doOnRequest(ignored -> logger.info(\"Listing key versions - {}\", name))\n-                .doOnSuccess(response -> logger.info(\"Listed key versions - {}\", name))\n-                .doOnError(error -> logger.warning(String.format(\"Failed to list key versions - {}\", name), error));\n+                .doOnSuccess(response -> {\n+                    if (response.getValue().size() == 0) {\n+                        throw new ResourceNotFoundException(String.format(\"Key with name: %s not found\", name), null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1e19aa8ff7eb31661ee97156e422462dcb6612"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4a2d859b90556ae176c98f7e643ae6a57494f9d", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d4a2d859b90556ae176c98f7e643ae6a57494f9d", "committedDate": "2020-05-31T20:19:48Z", "message": "Reverted changes on KeyAsyncClient. Changed KeyService's getKeyVersions() to return a ResourceNotFoundException when the service returns a response with status code 404. Changed KeyClient's javadoc to reflect this change."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDA3NzI2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11546#pullrequestreview-423007726", "createdAt": "2020-06-02T19:50:20Z", "commit": {"oid": "d4a2d859b90556ae176c98f7e643ae6a57494f9d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo1MDoyMFrOGeBogQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo1MDoyMFrOGeBogQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzNzIxNw==", "bodyText": "This doesn't abide guidelines: https://azure.github.io/azure-sdk/general_implementation.html#error-handling\n\nThe server error is not exposed, which is reuqired.\nWe shouldn't create derived types when the user has mitigation, like they can check for 404 themselves, which is what we do in other languages.\n\nI think the documentation should be fixed instead of wrapping the service exception (which you're not currently doing anyway) in another one.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11546#discussion_r434137217", "createdAt": "2020-06-02T19:50:20Z", "author": {"login": "heaths"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/KeyService.java", "diffHunk": "@@ -115,6 +115,7 @@\n \n     @Get(\"keys/{key-name}/versions\")\n     @ExpectedResponses({200})\n+    @UnexpectedResponseExceptionType(code = {404}, value = ResourceNotFoundException.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4a2d859b90556ae176c98f7e643ae6a57494f9d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDE4MDg0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11546#pullrequestreview-424018084", "createdAt": "2020-06-04T00:11:10Z", "commit": {"oid": "d4a2d859b90556ae176c98f7e643ae6a57494f9d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDI2NDY2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11546#pullrequestreview-424026466", "createdAt": "2020-06-04T00:39:09Z", "commit": {"oid": "d4a2d859b90556ae176c98f7e643ae6a57494f9d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMDozOTowOVrOGeyBYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMDozOTowOVrOGeyBYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkzMDAxOA==", "bodyText": "we need to update KeyAsyncClient doc too.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11546#discussion_r434930018", "createdAt": "2020-06-04T00:39:09Z", "author": {"login": "g2vinay"}, "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/KeyClient.java", "diffHunk": "@@ -757,8 +757,7 @@ public KeyVaultKey restoreKeyBackup(byte[] backup) {\n      * @param name The name of the key.\n      * @return {@link PagedIterable} of {@link KeyProperties key} of all the versions of the specified key in the vault. List\n      *     is empty if key with {@code name} does not exist in key vault.\n-     * @throws ResourceNotFoundException when a key with {@code name} doesn't exist in the key vault.\n-     * @throws HttpResponseException when a key with {@code name} is empty string.\n+     * @throws ResourceNotFoundException when a given key {@code name} is null or an empty string.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4a2d859b90556ae176c98f7e643ae6a57494f9d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "598e2f1b31809f2393ada361a03c9c80fd1e1b78", "author": {"user": {"login": "vcolin7", "name": null}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/598e2f1b31809f2393ada361a03c9c80fd1e1b78", "committedDate": "2020-06-04T04:01:39Z", "message": "Updated the @throws section on KeyAsyncClient.listPropertiesOfKeyVersions' Javadoc."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjU2NjQ1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11546#pullrequestreview-425656645", "createdAt": "2020-06-05T22:10:53Z", "commit": {"oid": "598e2f1b31809f2393ada361a03c9c80fd1e1b78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4006, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}