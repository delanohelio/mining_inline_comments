{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1Mzg0NTM0", "number": 13427, "title": "Storage/set tier version snapshot", "bodyText": "", "createdAt": "2020-07-22T22:21:41Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13427", "merged": true, "mergeCommit": {"oid": "7d12ed3a7571949734d300163b8537a40634e418"}, "closed": true, "closedAt": "2020-07-27T17:15:57Z", "author": {"login": "gapra-msft"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3gwitAH2gAyNDU1Mzg0NTM0OjhmYjMzNWE5NGNhZGRhYzI0YTJkZTExN2FiN2IyNzMxOTU3MTY2NGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5D8qAAFqTQ1NTkxNjMwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8fb335a94caddac24a2de117ab7b27319571664e", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8fb335a94caddac24a2de117ab7b27319571664e", "committedDate": "2020-07-22T20:21:54Z", "message": "Added code to support versioning and snapshot for set access tier"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62880d82540f1d0de71eadb30ff7445e41bb4379", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/62880d82540f1d0de71eadb30ff7445e41bb4379", "committedDate": "2020-07-22T21:15:37Z", "message": "Do not break existing delete code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ff9f9c64204e3bc784e7557f993d268830c60ca", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7ff9f9c64204e3bc784e7557f993d268830c60ca", "committedDate": "2020-07-22T22:10:51Z", "message": "Do not break existing delete code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b84413cafefaebd0c9aed64692c5edda239ee88c", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b84413cafefaebd0c9aed64692c5edda239ee88c", "committedDate": "2020-07-22T22:21:16Z", "message": "Added test records"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f6eda2bff16b869fe68d79d3a1e1d865b6a628a", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4f6eda2bff16b869fe68d79d3a1e1d865b6a628a", "committedDate": "2020-07-22T22:24:23Z", "message": "Added sample"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a65280a0a84e9dd66532914aa4a9df3a4798f74", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5a65280a0a84e9dd66532914aa4a9df3a4798f74", "committedDate": "2020-07-22T22:45:26Z", "message": "Added more records"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a63630730cde0118fb8dc0e2bc00fdfedfb1e5b8", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a63630730cde0118fb8dc0e2bc00fdfedfb1e5b8", "committedDate": "2020-07-22T23:11:10Z", "message": "Added changelog support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b63adc17d47aef4402d4fb014880a8e41ad5827b", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b63adc17d47aef4402d4fb014880a8e41ad5827b", "committedDate": "2020-07-22T23:36:49Z", "message": "Fixed ANalyze step issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNzY2MTc1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13427#pullrequestreview-453766175", "createdAt": "2020-07-23T00:12:21Z", "commit": {"oid": "b63adc17d47aef4402d4fb014880a8e41ad5827b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMDoxMjoyMVrOG14bmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMDoxNTowMlrOG14eiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE1MjI4Mw==", "bodyText": "Given this is internal would it be better to splay out the BlobBatchSetBlobAccessTierOptions parameters so we don't need to instantiate short lived objects in the other overloads.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13427#discussion_r459152283", "createdAt": "2020-07-23T00:12:21Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/azure-storage-blob-batch/src/main/java/com/azure/storage/blob/batch/BlobBatch.java", "diffHunk": "@@ -250,13 +254,33 @@\n      * @throws UnsupportedOperationException If this batch has already added an operation of another type.\n      */\n     public Response<Void> setBlobAccessTier(String blobUrl, AccessTier accessTier, String leaseId) {\n-        return setBlobAccessTierHelper(getUrlPath(blobUrl), accessTier, leaseId);\n+        return setBlobAccessTier(new BlobBatchSetBlobAccessTierOptions(blobUrl, accessTier).setLeaseId(leaseId));\n     }\n \n-    private Response<Void> setBlobAccessTierHelper(String urlPath, AccessTier accessTier, String leaseId) {\n+    /**\n+     * Adds a set tier operation to the batch.\n+     *\n+     * <p><strong>Code sample</strong></p>\n+     *\n+     * {@codesnippet com.azure.storage.blob.batch.BlobBatch.setBlobAccessTier#BlobBatchSetBlobAccessTierOptions}\n+     *\n+     * @param options {@link BlobBatchSetBlobAccessTierOptions}\n+     * @return a {@link Response} that will be used to associate this operation to the response when the batch is\n+     * submitted.\n+     * @throws UnsupportedOperationException If this batch has already added an operation of another type.\n+     */\n+    public Response<Void> setBlobAccessTier(BlobBatchSetBlobAccessTierOptions options) {\n+        return setBlobAccessTierHelper(options);\n+    }\n+\n+    private Response<Void> setBlobAccessTierHelper(BlobBatchSetBlobAccessTierOptions options) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63adc17d47aef4402d4fb014880a8e41ad5827b"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE1Mjk1MA==", "bodyText": "Do we want to eagerly promote this in public API given it's only use is in Blob Batch?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13427#discussion_r459152950", "createdAt": "2020-07-23T00:14:49Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/azure-storage-common/src/main/java/com/azure/storage/common/Utility.java", "diffHunk": "@@ -280,4 +280,21 @@ public static OffsetDateTime parseDate(String dateString) {\n                 });\n         });\n     }\n+\n+    /**\n+     * Appends a query parameter to a url.\n+     *\n+     * @param url The url.\n+     * @param key The query key.\n+     * @param value The query value.\n+     * @return The updated url.\n+     */\n+    public static String appendQueryParameter(String url, String key, String value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63adc17d47aef4402d4fb014880a8e41ad5827b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE1MzAzNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - Added appendQueryParam method to support adding version and snapshot support to BlobBatch setTier.\n          \n          \n            \n            - Added appendQueryParameter method to support adding version and snapshot support to BlobBatch setTier.\n          \n      \n    \n    \n  \n\nIf we retain the new helper function.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13427#discussion_r459153035", "createdAt": "2020-07-23T00:15:02Z", "author": {"login": "alzimmermsft"}, "path": "sdk/storage/azure-storage-common/CHANGELOG.md", "diffHunk": "@@ -3,6 +3,7 @@\n ## 12.8.0-beta.2 (Unreleased)\n - Added support for setting tags and filterTags operations on SAS by adding to AccountSASPermissions.\n - Fixed bug where FluxInputStream would throw when a ByteBuffer of length 0 was encountered.\n+- Added appendQueryParam method to support adding version and snapshot support to BlobBatch setTier.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63adc17d47aef4402d4fb014880a8e41ad5827b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1067cbc3a7599541fa78cfbc51aefccd8ae473a5", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1067cbc3a7599541fa78cfbc51aefccd8ae473a5", "committedDate": "2020-07-23T16:36:30Z", "message": "Addressed comments from PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06beb1021963f796543224e19e17ae80a0920d03", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/06beb1021963f796543224e19e17ae80a0920d03", "committedDate": "2020-07-23T18:07:39Z", "message": "Removed import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8199cb36d2a16419ca8255cc1abfd5afc0a4f08a", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8199cb36d2a16419ca8255cc1abfd5afc0a4f08a", "committedDate": "2020-07-23T22:59:23Z", "message": "Merge branch 'master' into storage/setTierVersionSnapshot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0OTI2MDU1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13427#pullrequestreview-454926055", "createdAt": "2020-07-24T14:20:02Z", "commit": {"oid": "8199cb36d2a16419ca8255cc1abfd5afc0a4f08a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNDoyMDowMlrOG2xOGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNDoyMDowMlrOG2xOGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4MjcxMg==", "bodyText": "I think maybe like getBlobIdentifier might be more appropriate since it's not just the path?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13427#discussion_r460082712", "createdAt": "2020-07-24T14:20:02Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-blob-batch/src/main/java/com/azure/storage/blob/batch/options/BlobBatchSetBlobAccessTierOptions.java", "diffHunk": "@@ -0,0 +1,182 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.storage.blob.batch.options;\n+\n+import com.azure.core.annotation.Fluent;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.storage.blob.BlobUrlParts;\n+import com.azure.storage.blob.models.AccessTier;\n+import com.azure.storage.blob.models.RehydratePriority;\n+import com.azure.storage.common.Utility;\n+import com.azure.storage.common.implementation.StorageImplUtils;\n+\n+/**\n+ * Extended options that may be passed when batch setting tier for blobs.\n+ */\n+@Fluent\n+public class BlobBatchSetBlobAccessTierOptions {\n+\n+    private final ClientLogger logger = new ClientLogger(BlobBatchSetBlobAccessTierOptions.class);\n+\n+    private final BlobUrlParts blobUrlParts;\n+    private final AccessTier tier;\n+    private RehydratePriority priority;\n+    private String leaseId;\n+    private String tagsConditions;\n+\n+    /**\n+     * @param blobUrl Url of the blob to set access tier. Blob names must be encoded to UTF-8.\n+     * @param tier {@link AccessTier} to set on each blob.\n+     */\n+    public BlobBatchSetBlobAccessTierOptions(String blobUrl, AccessTier tier) {\n+        StorageImplUtils.assertNotNull(\"blobUrl\", blobUrl);\n+        StorageImplUtils.assertNotNull(\"tier\", tier);\n+        this.blobUrlParts = BlobUrlParts.parse(blobUrl);\n+        this.tier = tier;\n+    }\n+\n+    /**\n+     * @param containerName Name of the container to set access tier.\n+     * @param blobName Name of the blob to set access tier. Blob names must be encoded to UTF-8.\n+     * @param tier {@link AccessTier} to set on each blob.\n+     */\n+    public BlobBatchSetBlobAccessTierOptions(String containerName, String blobName, AccessTier tier) {\n+        StorageImplUtils.assertNotNull(\"containerName\", containerName);\n+        StorageImplUtils.assertNotNull(\"blobName\", blobName);\n+        StorageImplUtils.assertNotNull(\"tier\", tier);\n+        this.blobUrlParts = BlobUrlParts.parse(\"https://account.blob.core.windows.net\")\n+            .setContainerName(containerName)\n+            .setBlobName(blobName);\n+        this.tier = tier;\n+    }\n+\n+    /**\n+     * @return Url of the blob to set its access tier.\n+     */\n+    public String getBlobUrl() {\n+        return blobUrlParts.toUrl().toString();\n+    }\n+\n+    /**\n+     * @return Container of the blob to set its access tier.\n+     */\n+    public String getBlobContainerName() {\n+        return blobUrlParts.getBlobContainerName();\n+    }\n+\n+    /**\n+     * @return Name of the blob to set its access tier.\n+     */\n+    public String getBlobName() {\n+        return blobUrlParts.getBlobName();\n+    }\n+\n+    /**\n+     * @return Path of the blob to set its access tier.\n+     */\n+    public String getBlobPath() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8199cb36d2a16419ca8255cc1abfd5afc0a4f08a"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0OTMxODQ3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13427#pullrequestreview-454931847", "createdAt": "2020-07-24T14:26:52Z", "commit": {"oid": "8199cb36d2a16419ca8255cc1abfd5afc0a4f08a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07a5b735432cca6582109ad97a771650a5648996", "author": {"user": null}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/07a5b735432cca6582109ad97a771650a5648996", "committedDate": "2020-07-27T15:53:28Z", "message": "Changed name to identifier"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTE2MzA3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13427#pullrequestreview-455916307", "createdAt": "2020-07-27T15:55:44Z", "commit": {"oid": "07a5b735432cca6582109ad97a771650a5648996"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1080, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}