{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyOTI0Njc4", "number": 8064, "title": "disable session capturing by default for non-session modes", "bodyText": "SessionContainer session capturing is expensive (impact 5%-10% perf from earlier measurement), however it is enabled in non-session mode (including eventual mode).\nThe only use case for capturing session tokens in non-session mode is\n\ncapturing session token from one client and moving it to another client\nsetting the captured session token from elsewhere for a one specific request (while being in non-session mode)\n\nThese use case is extremely rare. we haven't seen such usage. However, in the presence of session capturing everyone will be paying 5-10% perf degradation.\nThis PR, disables session capturing for non-session mode by default, and introduces a config flag to enable it for non-session mode, just in case if anyone needs the old behaviour.", "createdAt": "2020-02-10T03:43:58Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8064", "merged": true, "mergeCommit": {"oid": "349b13293a2212c613484a74d34bee302e23b03b"}, "closed": true, "closedAt": "2020-02-11T03:02:38Z", "author": {"login": "moderakh"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC0jMTAH2gAyMzcyOTI0Njc4OjNlYTY4MWJiYjdmOWYyMmM0YzcyMDNiNDY2ZmRmMmNkNDQ3NzQyZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDD8TLAH2gAyMzcyOTI0Njc4OjYxNThlZmJlZTRjYWU4ZmQ5ODIxOGE2ZDBhODFmYzA5OGRiMWU5YWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ea681bbb7f9f22c4c7203b466fdf2cd447742d2", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3ea681bbb7f9f22c4c7203b466fdf2cd447742d2", "committedDate": "2020-02-10T03:27:26Z", "message": "disable session capturing by default for non-session modes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d784372e050b12a9f5975f602605d05eabeb7715", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d784372e050b12a9f5975f602605d05eabeb7715", "committedDate": "2020-02-10T03:51:41Z", "message": "cleanup comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a906c033f71e3cfbc8d154c030449de78ad1420", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2a906c033f71e3cfbc8d154c030449de78ad1420", "committedDate": "2020-02-10T16:09:58Z", "message": "Merge branch 'feature/cosmos/v4' into users/moderakh/session-capturing-disable-for-non-session-mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22d92fdedf98056ab4d1ff951b844ac25d045215", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/22d92fdedf98056ab4d1ff951b844ac25d045215", "committedDate": "2020-02-10T18:15:31Z", "message": "fixed test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MjM1Njcz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8064#pullrequestreview-356235673", "createdAt": "2020-02-10T20:22:14Z", "commit": {"oid": "22d92fdedf98056ab4d1ff951b844ac25d045215"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDoyMjoxNVrOFn0SFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMDoyMjoxNVrOFn0SFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI5NTM4MQ==", "bodyText": "We should mention default value of this parameter here.\nIt is false by default, and that is the intention, right ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8064#discussion_r377295381", "createdAt": "2020-02-10T20:22:15Z", "author": {"login": "kushagraThapar"}, "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosClientBuilder.java", "diffHunk": "@@ -36,10 +36,31 @@\n     private List<Permission> permissions;\n     private TokenResolver tokenResolver;\n     private CosmosKeyCredential cosmosKeyCredential;\n+    private boolean sessionCapturingOverride;\n \n     public CosmosClientBuilder() {\n     }\n \n+    /**\n+     * Session capturing is enabled by default for {@link ConsistencyLevel#SESSION}.\n+     * For other consistency levels, it is not needed, unless if you need occasionally send requests with Session\n+     * Consistency while the client is not configured in session.\n+     *\n+     * enabling Session capturing for Session mode has no effect.\n+     * @param sessionCapturingOverride the session capturing override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22d92fdedf98056ab4d1ff951b844ac25d045215"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da3343d391ebe97bf28e6d80ff581ecf2fa8a3b7", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/da3343d391ebe97bf28e6d80ff581ecf2fa8a3b7", "committedDate": "2020-02-10T21:21:18Z", "message": "Merge branch 'feature/cosmos/v4' into users/moderakh/session-capturing-disable-for-non-session-mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6158efbee4cae8fd98218a6d0a81fc098db1e9ac", "author": {"user": {"login": "moderakh", "name": "Mohammad Derakhshani"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6158efbee4cae8fd98218a6d0a81fc098db1e9ac", "committedDate": "2020-02-10T21:23:26Z", "message": "addressed review comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2392, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}