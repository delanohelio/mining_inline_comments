{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNjQ3NDA5", "number": 9330, "title": "Inject Code Snippets Pre-Build", "bodyText": "Getting this out there so we can put it where it actually makes sense.", "createdAt": "2020-03-20T17:11:48Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330", "merged": true, "mergeCommit": {"oid": "ec6f0940ba2bb0561cac7282d152bc88b6e00f9f"}, "closed": true, "closedAt": "2020-04-02T17:15:54Z", "author": {"login": "scbedd"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIr-G9AH2gAyMzkxNjQ3NDA5OmQyYTA5MDI5ZTU2OTU3OWM5NTIyNjM1OTk5MWEyMmZhZTM0MDJmNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcThLMMAFqTM4NjAzNzQ2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d2a09029e569579c95226359991a22fae3402f47", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d2a09029e569579c95226359991a22fae3402f47", "committedDate": "2020-02-28T08:51:14Z", "message": "lotsa progress on the script. am grabbing the snippets successfully and populating dictionaries of lines."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5461ce09ad79d3789b1fc73f81210e45ab994f7c", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5461ce09ad79d3789b1fc73f81210e45ab994f7c", "committedDate": "2020-02-29T01:37:17Z", "message": "more progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02cc973385d7d9818c6bf4fc820bfaca1b890c7f", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/02cc973385d7d9818c6bf4fc820bfaca1b890c7f", "committedDate": "2020-03-12T02:43:28Z", "message": "starting with something"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e119f5b45b116f02161900f1e5d0f1828f683eb", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5e119f5b45b116f02161900f1e5d0f1828f683eb", "committedDate": "2020-03-12T02:43:31Z", "message": "Merge branch 'feature/inject-code-snippets' of https://github.com/scbedd/azure-sdk-for-java into feature/inject-code-snippets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c5a3c764faec895f2bda450759bd341c857a20d", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6c5a3c764faec895f2bda450759bd341c857a20d", "committedDate": "2020-03-12T04:19:31Z", "message": "inject_codesnippets properly replacing with leading comment as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d5ff0eed7b15a2b64e961fc5ad342ac138eef94", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6d5ff0eed7b15a2b64e961fc5ad342ac138eef94", "committedDate": "2020-03-12T04:26:20Z", "message": "script ready to rock and roll. time to test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f2d218c3e838f7db53cc656113ef71b68207746", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6f2d218c3e838f7db53cc656113ef71b68207746", "committedDate": "2020-03-12T04:30:28Z", "message": "getting the codesnippet jar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f452dc7a7042172e418fc9249359c53fbee4267", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7f452dc7a7042172e418fc9249359c53fbee4267", "committedDate": "2020-03-13T01:30:06Z", "message": "escape the characters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fabd67eb40a5da61774f1c5660c41dd32b64999", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2fabd67eb40a5da61774f1c5660c41dd32b64999", "committedDate": "2020-03-13T02:09:05Z", "message": "saving progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "029b1d8a6c7e4c8eec15deccdfd75f2f58e85590", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/029b1d8a6c7e4c8eec15deccdfd75f2f58e85590", "committedDate": "2020-03-13T02:12:30Z", "message": "merging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de94a3bffc2e2e98f62866011801e55850c7b72c", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/de94a3bffc2e2e98f62866011801e55850c7b72c", "committedDate": "2020-03-13T02:39:56Z", "message": "handle encoding differently"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f34778124a29ca4c1092337625e51853731ce062", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f34778124a29ca4c1092337625e51853731ce062", "committedDate": "2020-03-14T03:38:44Z", "message": "add more characters to the escape map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1cfca6a066e2c1f51ab666959bd309dd9d0006c", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d1cfca6a066e2c1f51ab666959bd309dd9d0006c", "committedDate": "2020-03-14T03:55:34Z", "message": "more commenting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fede5848eb28e8ff0feef41003b49a0ff6ece6f3", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fede5848eb28e8ff0feef41003b49a0ff6ece6f3", "committedDate": "2020-03-14T04:17:28Z", "message": "replace other things"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "860d689e6de366ee05d7f4de4ca38f5990f6a267", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/860d689e6de366ee05d7f4de4ca38f5990f6a267", "committedDate": "2020-03-16T19:47:09Z", "message": "update rparent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec0fcae6a213cd041c7b134bc8113f0161c0ed92", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ec0fcae6a213cd041c7b134bc8113f0161c0ed92", "committedDate": "2020-03-16T19:59:11Z", "message": "try utf8-escaped characters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "397c079a42fa30c1bb139bc57a1441852ebc0231", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/397c079a42fa30c1bb139bc57a1441852ebc0231", "committedDate": "2020-03-16T22:09:41Z", "message": "apostrophe only utf8 escaped"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bf7436d33b748c58c6135896bbb80225e0a62d0", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9bf7436d33b748c58c6135896bbb80225e0a62d0", "committedDate": "2020-03-19T23:32:21Z", "message": "replace the @ sign with a literal @"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e9bca816ffa4098aee5308db0eaef9f6074ccf7", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1e9bca816ffa4098aee5308db0eaef9f6074ccf7", "committedDate": "2020-03-19T23:43:23Z", "message": "merge master updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f85444b9b81dd06c16edbf1dd340830931dc0e55", "committedDate": "2020-03-20T17:09:44Z", "message": "cleaned up. submitting PR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODA1Njgw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#pullrequestreview-378805680", "createdAt": "2020-03-20T20:54:05Z", "commit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMDo1NDowNVrOF5i6JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMTowMTozOFrOF5jFnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4NTA5Mg==", "bodyText": "The codesnippet tooling Java uses should throw an exception during Javadoc generation if there are duplicate snippets.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#discussion_r395885092", "createdAt": "2020-03-20T20:54:05Z", "author": {"login": "alzimmermsft"}, "path": "eng/scripts/inject_codesnippets.py", "diffHunk": "@@ -0,0 +1,139 @@\n+import os\n+import glob\n+import re\n+import json\n+from xml.sax.saxutils import escape, unescape\n+\n+# run this from the root of the repository\n+root = os.path.abspath(os.path.join(os.path.dirname(__file__), \"..\", \"..\"))\n+\n+SNIPPET_BEGIN = r\"\\s*\\/\\/\\s*BEGIN\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"\n+SNIPPET_END = r\"\\s*\\/\\/\\s*END\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"\n+SNIPPET_CALL = r\"(?P<leadingspace>.*)\\{\\@codesnippet(?P<snippetid>.*)\\}\"\n+\n+EXCLUSION_ARRAY = [\"JavadocCodeSnippetCheck.java\"]\n+\n+HTML_ESCAPE_TABLE = {\n+    \"&\": \"&amp;\",\n+    '\"': \"&quot;\",\n+    \">\": \"&gt;\",\n+    \"<\": \"&lt;\",\n+    \"@\": \"{@literal @}\",\n+    \"{\": \"&#123;\",\n+    \"}\": \"&#125;\",\n+    \"(\": \"&#40;\",\n+    \")\": \"&#41;\",\n+    \"/\": \"&#47;\",\n+    \"\\\\\": \"&#92;\",\n+}\n+\n+\n+class SnippetDict:\n+    def __init__(self, start_dict={}):\n+        self.snippet_dict = start_dict\n+\n+    def __nonzero__(self):\n+        return self.snippet_dict\n+\n+    def __str__(self):\n+        return json.dumps(self.snippet_dict)\n+\n+    def begin_snippet(self, key):\n+        if key not in self.snippet_dict:\n+            self.snippet_dict[key] = []\n+        else:\n+            raise \"Duplicate snippet begin.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4NTM1NQ==", "bodyText": "Do these regexes match what the codesnippet tool is using?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#discussion_r395885355", "createdAt": "2020-03-20T20:54:46Z", "author": {"login": "alzimmermsft"}, "path": "eng/scripts/inject_codesnippets.py", "diffHunk": "@@ -0,0 +1,139 @@\n+import os\n+import glob\n+import re\n+import json\n+from xml.sax.saxutils import escape, unescape\n+\n+# run this from the root of the repository\n+root = os.path.abspath(os.path.join(os.path.dirname(__file__), \"..\", \"..\"))\n+\n+SNIPPET_BEGIN = r\"\\s*\\/\\/\\s*BEGIN\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"\n+SNIPPET_END = r\"\\s*\\/\\/\\s*END\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4ODAzMQ==", "bodyText": "Right now the only directories that can contain snippets are in src/samples/java/* if we want to tighten where we are looking for snippets.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#discussion_r395888031", "createdAt": "2020-03-20T21:01:38Z", "author": {"login": "alzimmermsft"}, "path": "eng/scripts/inject_codesnippets.py", "diffHunk": "@@ -0,0 +1,139 @@\n+import os\n+import glob\n+import re\n+import json\n+from xml.sax.saxutils import escape, unescape\n+\n+# run this from the root of the repository\n+root = os.path.abspath(os.path.join(os.path.dirname(__file__), \"..\", \"..\"))\n+\n+SNIPPET_BEGIN = r\"\\s*\\/\\/\\s*BEGIN\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"\n+SNIPPET_END = r\"\\s*\\/\\/\\s*END\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"\n+SNIPPET_CALL = r\"(?P<leadingspace>.*)\\{\\@codesnippet(?P<snippetid>.*)\\}\"\n+\n+EXCLUSION_ARRAY = [\"JavadocCodeSnippetCheck.java\"]\n+\n+HTML_ESCAPE_TABLE = {\n+    \"&\": \"&amp;\",\n+    '\"': \"&quot;\",\n+    \">\": \"&gt;\",\n+    \"<\": \"&lt;\",\n+    \"@\": \"{@literal @}\",\n+    \"{\": \"&#123;\",\n+    \"}\": \"&#125;\",\n+    \"(\": \"&#40;\",\n+    \")\": \"&#41;\",\n+    \"/\": \"&#47;\",\n+    \"\\\\\": \"&#92;\",\n+}\n+\n+\n+class SnippetDict:\n+    def __init__(self, start_dict={}):\n+        self.snippet_dict = start_dict\n+\n+    def __nonzero__(self):\n+        return self.snippet_dict\n+\n+    def __str__(self):\n+        return json.dumps(self.snippet_dict)\n+\n+    def begin_snippet(self, key):\n+        if key not in self.snippet_dict:\n+            self.snippet_dict[key] = []\n+        else:\n+            raise \"Duplicate snippet begin.\"\n+\n+    def process_line(self, line):\n+        self.snippet_dict = {k: v + [line] for k, v in self.snippet_dict.items()}\n+\n+    def finalize_snippet(self, key):\n+        return self.snippet_dict.pop(key)\n+\n+\n+def get_snippets_from_file(file):\n+    finished_snippets = {}\n+    running_dict = SnippetDict()\n+\n+    with open(file, \"r\", encoding=\"utf-8\") as source:\n+        print(file)\n+        for line in source.readlines():\n+\n+            begin = re.match(SNIPPET_BEGIN, line)\n+            end = re.match(SNIPPET_END, line)\n+\n+            if begin:\n+                id_beginning = begin.groupdict()[\"id\"]\n+                running_dict.begin_snippet(id_beginning)\n+            elif end:\n+                id_ending = end.groupdict()[\"id\"]\n+                ending = running_dict.finalize_snippet(id_ending)\n+                finished_snippets[id_ending] = ending\n+            elif running_dict:\n+                running_dict.process_line(line)\n+\n+    return finished_snippets\n+\n+\n+def check_exclusion(file_name, exclusion_array):\n+    if not os.path.isdir(file_name):\n+        name = os.path.basename(file_name)\n+\n+        return name in exclusion_array\n+\n+\n+if __name__ == \"__main__\":\n+\n+    # walk the codebase, find all java files\n+    all_files = glob.glob(\"**/*.java\", recursive=True)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODE3Nzc0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#pullrequestreview-378817774", "createdAt": "2020-03-20T21:18:38Z", "commit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMToxODozOFrOF5jeZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMTozODoxOFrOF5j50Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5NDM3Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            SNIPPET_BEGIN = r\"\\s*\\/\\/\\s*BEGIN\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"\n          \n          \n            \n            SNIPPET_BEGIN = r\"\\s*\\/\\/\\s*BEGIN\\:\\s+(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#discussion_r395894372", "createdAt": "2020-03-20T21:18:38Z", "author": {"login": "srnagar"}, "path": "eng/scripts/inject_codesnippets.py", "diffHunk": "@@ -0,0 +1,139 @@\n+import os\n+import glob\n+import re\n+import json\n+from xml.sax.saxutils import escape, unescape\n+\n+# run this from the root of the repository\n+root = os.path.abspath(os.path.join(os.path.dirname(__file__), \"..\", \"..\"))\n+\n+SNIPPET_BEGIN = r\"\\s*\\/\\/\\s*BEGIN\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5NDQ1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            SNIPPET_END = r\"\\s*\\/\\/\\s*END\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"\n          \n          \n            \n            SNIPPET_END = r\"\\s*\\/\\/\\s*END\\:\\s+(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#discussion_r395894450", "createdAt": "2020-03-20T21:18:50Z", "author": {"login": "srnagar"}, "path": "eng/scripts/inject_codesnippets.py", "diffHunk": "@@ -0,0 +1,139 @@\n+import os\n+import glob\n+import re\n+import json\n+from xml.sax.saxutils import escape, unescape\n+\n+# run this from the root of the repository\n+root = os.path.abspath(os.path.join(os.path.dirname(__file__), \"..\", \"..\"))\n+\n+SNIPPET_BEGIN = r\"\\s*\\/\\/\\s*BEGIN\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"\n+SNIPPET_END = r\"\\s*\\/\\/\\s*END\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwMTM5Mw==", "bodyText": "The space after BEGIN: and END: tags is mandatory.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#discussion_r395901393", "createdAt": "2020-03-20T21:38:18Z", "author": {"login": "srnagar"}, "path": "eng/scripts/inject_codesnippets.py", "diffHunk": "@@ -0,0 +1,139 @@\n+import os\n+import glob\n+import re\n+import json\n+from xml.sax.saxutils import escape, unescape\n+\n+# run this from the root of the repository\n+root = os.path.abspath(os.path.join(os.path.dirname(__file__), \"..\", \"..\"))\n+\n+SNIPPET_BEGIN = r\"\\s*\\/\\/\\s*BEGIN\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"\n+SNIPPET_END = r\"\\s*\\/\\/\\s*END\\:\\s*(?P<id>[a-zA-Z0-9\\.\\#\\-\\_]*)\\s*\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4NTM1NQ=="}, "originalCommit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzExNjEz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#pullrequestreview-379711613", "createdAt": "2020-03-23T18:32:55Z", "commit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMjo1NlrOF6S3ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMjo1NlrOF6S3ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MDgyMA==", "bodyText": "/CC @weshaggard @mitchdenny\nIt's not clear to me if this is the correct place to be calling this or if this should be similar to what I'd done for the generate overview. This does differ from the replace relatively links as that is used across all the language and this is specific to Java. If it used the same approach as the generate overview stuff then it could be tested locally as part of the build with a flag instead of running a script across the entire repo and then building a given library (or submitting a PR and having to download artifacts). The code snippets for a given library are always going to be under that library's directory in the repo (typically under the /samples subdirectory) so processing as part of the library build would effectively work the same way. The changes would minimal and he could follow the same pattern which would be to declare a profile in pom.client.xml and then pass in that flag inside archetype-sdk-client.yml. It would also mean that the python script would have to change to take a single directory as an argument.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#discussion_r396670820", "createdAt": "2020-03-23T18:32:56Z", "author": {"login": "JimSuplizio"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -102,6 +102,11 @@ jobs:\n           BuildSHA: $(Build.SourceVersion)\n           RepoId: 'Azure/azure-sdk-for-java'\n \n+      - script: |\n+          python ./eng/scripts/inject_codesnippets.py\n+        displayName: 'Replace @codesnippet with embedded pre element'\n+        workingDirectory: $(Build.SourcesDirectory)\n+        ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f85444b9b81dd06c16edbf1dd340830931dc0e55"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c2d6c629aa844481e252dd5c585f9b4d7605feb", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7c2d6c629aa844481e252dd5c585f9b4d7605feb", "committedDate": "2020-03-23T23:10:13Z", "message": "cut over to new methodology"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9567cf56a1d306d1a13162577b20df74a8ddbfe", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f9567cf56a1d306d1a13162577b20df74a8ddbfe", "committedDate": "2020-03-23T23:11:00Z", "message": "remove a plugin that was unnnecessary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6af3d7f26a67bccba910ed54faebba6731a70da4", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6af3d7f26a67bccba910ed54faebba6731a70da4", "committedDate": "2020-03-23T23:12:02Z", "message": "adjustment to comment spacing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16c86581dccf9ce28a4f51ca0849e558d42642e1", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/16c86581dccf9ce28a4f51ca0849e558d42642e1", "committedDate": "2020-03-23T23:12:26Z", "message": "take advantage of new packaging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODk2ODUx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#pullrequestreview-379896851", "createdAt": "2020-03-23T23:17:45Z", "commit": {"oid": "16c86581dccf9ce28a4f51ca0849e558d42642e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMzoxNzo0NVrOF6bmrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMzoxNzo0NVrOF6bmrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgxMzk5Ng==", "bodyText": "Oh whoops I already did this once. Fixing.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#discussion_r396813996", "createdAt": "2020-03-23T23:17:45Z", "author": {"login": "scbedd"}, "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -111,7 +111,7 @@ jobs:\n         inputs:\n           mavenPomFile: pom.xml\n           goals: 'package'\n-          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dgenerate-overview -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI\n+          options: '$(DefaultOptions) \"-DpackageOutputDirectory=$(Build.ArtifactStagingDirectory)\" -DskipTests -Dinject-codesnippets -Dgenerate-overview -Dinject-codesnippets -pl $(ProjectList) -am' # We include template-module so we ensure it always builds in CI", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16c86581dccf9ce28a4f51ca0849e558d42642e1"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e52d9eedc6bdfc786827e872dfe93551c4a134d", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2e52d9eedc6bdfc786827e872dfe93551c4a134d", "committedDate": "2020-03-23T23:18:09Z", "message": "remove duplicate argument"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a81b960d99cf2e5818c8266f3057041ed02e9f5", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2a81b960d99cf2e5818c8266f3057041ed02e9f5", "committedDate": "2020-03-23T23:31:46Z", "message": "fixing the misnamed py file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f54877a14151cd36e3cb1d4fd73d75749e32a0fa", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f54877a14151cd36e3cb1d4fd73d75749e32a0fa", "committedDate": "2020-03-23T23:45:50Z", "message": "fix for the script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d04edfaf8d4090e35a361e7f6c79dc141c94c990", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d04edfaf8d4090e35a361e7f6c79dc141c94c990", "committedDate": "2020-03-23T23:50:12Z", "message": "update regexes pr srikanta's feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5OTExOTAx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#pullrequestreview-379911901", "createdAt": "2020-03-23T23:54:09Z", "commit": {"oid": "d04edfaf8d4090e35a361e7f6c79dc141c94c990"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNDU3NDM5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#pullrequestreview-380457439", "createdAt": "2020-03-24T16:00:58Z", "commit": {"oid": "d04edfaf8d4090e35a361e7f6c79dc141c94c990"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNjowMDo1OFrOF63Xjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNjowMDo1OFrOF63Xjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI2ODg3OA==", "bodyText": "I'm not a big fan of calling python from maven but we already do it and you made it opt-in so I'll live with it.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#discussion_r397268878", "createdAt": "2020-03-24T16:00:58Z", "author": {"login": "weshaggard"}, "path": "pom.client.xml", "diffHunk": "@@ -1073,6 +1073,50 @@\n       </build>\n     </profile>\n \n+    <!-- Skip codesnippet injection unless -Dinject-codesnippets is passed as an argument.\n+      This is specifically done to prevent requiring python as a pre-requisite since\n+      this is only needed by the build system. This is also necessary due to limitations in consumption\n+      from docs side. \n+       -->\n+    <profile>\n+      <id>replace-codesnippet-references</id>\n+      <activation>\n+        <property>\n+          <name>inject-codesnippets</name>\n+        </property>\n+        <file>\n+          <exists>../../../eng/pipelines/scripts/inject_codesnippets.py</exists>\n+        </file>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.codehaus.mojo</groupId>\n+            <artifactId>exec-maven-plugin</artifactId>\n+            <version>1.2.1</version> <!-- {x-version-update;org.codehaus.mojo:exec-maven-plugin;external_dependency} -->\n+            <executions>\n+              <execution>\n+                <id>replace-codesnippet-references</id>\n+                <phase>prepare-package</phase>\n+                <goals>\n+                  <goal>exec</goal>\n+                </goals>\n+              </execution>\n+            </executions>\n+            <configuration>\n+              <executable>python</executable>\n+              <workingDirectory>${project.basedir}</workingDirectory>\n+              <arguments>\n+                <argument>../../../eng/pipelines/scripts/inject_codesnippets.py</argument>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d04edfaf8d4090e35a361e7f6c79dc141c94c990"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNDU5NDkx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#pullrequestreview-380459491", "createdAt": "2020-03-24T16:03:03Z", "commit": {"oid": "d04edfaf8d4090e35a361e7f6c79dc141c94c990"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3fbd887fcb2b1cb2f81f033cbb032b830d45c7b", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f3fbd887fcb2b1cb2f81f033cbb032b830d45c7b", "committedDate": "2020-03-31T19:53:16Z", "message": "handle bad snippet end gracefully. adjust how we pick up the snippets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9a3431ed39a6930448bfdfaff5b6c5bf6cf6b6e", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f9a3431ed39a6930448bfdfaff5b6c5bf6cf6b6e", "committedDate": "2020-03-31T20:39:14Z", "message": "properly indent the code samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ca37b58a411bf305623ebfbfe555a6c6bb1417d", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0ca37b58a411bf305623ebfbfe555a6c6bb1417d", "committedDate": "2020-03-31T20:58:22Z", "message": "remove quiet failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1cad5084910f297e86aa43f58c776b54e919d58", "author": {"user": {"login": "scbedd", "name": "Scott Beddall"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a1cad5084910f297e86aa43f58c776b54e919d58", "committedDate": "2020-04-01T22:15:17Z", "message": "Merge branch 'master' into feature/inject-code-snippets"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDM3NDY3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9330#pullrequestreview-386037467", "createdAt": "2020-04-02T00:29:44Z", "commit": {"oid": "a1cad5084910f297e86aa43f58c776b54e919d58"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 640, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}