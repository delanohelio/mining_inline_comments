{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMzEzOTgy", "number": 8638, "title": "Distributed tracing for EventHubs: add enqueueTime to Process span links ", "bodyText": "This PR adds enqueuedTime attribute on each link when processing messages: unix epoch time with milliseconds precision representing when the message was enqueued (x-opt-enqueued-time system property).\nRef : #7726", "createdAt": "2020-03-02T10:52:57Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8638", "merged": true, "mergeCommit": {"oid": "cde4fb49f3a4804e554511350b9e27815a7cf703"}, "closed": true, "closedAt": "2020-03-05T09:22:54Z", "author": {"login": "samvaity"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJtHIVgH2gAyMzgyMzEzOTgyOmEwZjRjM2FmNjExNzcyNzU5ZDdjNzgyOWEwZjk2MTBlNWY2YjcxYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKc3HWAH2gAyMzgyMzEzOTgyOjYyZGFlMzg1YTRjYzEzYmZhN2YxMWMyNmE5NTgxNTIzOGYwMDQyYjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a0f4c3af611772759d7c7829a0f9610e5f6b71c6", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a0f4c3af611772759d7c7829a0f9610e5f6b71c6", "committedDate": "2020-03-02T12:44:55Z", "message": "udpate for eph enqueue time message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ae0491148a49e8e8c829248faf63fc7645d2dc3", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4ae0491148a49e8e8c829248faf63fc7645d2dc3", "committedDate": "2020-03-02T10:50:32Z", "message": "udpate for eph enqueue time message"}, "afterCommit": {"oid": "a0f4c3af611772759d7c7829a0f9610e5f6b71c6", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a0f4c3af611772759d7c7829a0f9610e5f6b71c6", "committedDate": "2020-03-02T12:44:55Z", "message": "udpate for eph enqueue time message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MjQ4ODA0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8638#pullrequestreview-368248804", "createdAt": "2020-03-03T19:10:33Z", "commit": {"oid": "a0f4c3af611772759d7c7829a0f9610e5f6b71c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOToxMDozM1rOFxS3-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOToxMDozM1rOFxS3-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIzMzc4Ng==", "bodyText": "Did you mean to change it from eventData2 -> eventData1? The same event data returns two different sequence values?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8638#discussion_r387233786", "createdAt": "2020-03-03T19:10:33Z", "author": {"login": "conniey"}, "path": "sdk/eventhubs/azure-messaging-eventhubs/src/test/java/com/azure/messaging/eventhubs/EventProcessorClientTest.java", "diffHunk": "@@ -200,9 +202,10 @@ public void testProcessSpans() throws Exception {\n             .createConsumer(anyString(), anyInt()))\n             .thenReturn(consumer1);\n         when(eventData1.getSequenceNumber()).thenReturn(1L);\n-        when(eventData2.getSequenceNumber()).thenReturn(2L);\n+        when(eventData1.getSequenceNumber()).thenReturn(2L);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0f4c3af611772759d7c7829a0f9610e5f6b71c6"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MjQ5MDQ1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8638#pullrequestreview-368249045", "createdAt": "2020-03-03T19:10:54Z", "commit": {"oid": "a0f4c3af611772759d7c7829a0f9610e5f6b71c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ecab65f0649b26332287a8e3c0b84bc2f117b61", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7ecab65f0649b26332287a8e3c0b84bc2f117b61", "committedDate": "2020-03-03T20:28:01Z", "message": "update tracing changelog and review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MDE5MTc2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8638#pullrequestreview-369019176", "createdAt": "2020-03-04T18:30:13Z", "commit": {"oid": "7ecab65f0649b26332287a8e3c0b84bc2f117b61"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxODozMDoxM1rOFx4rsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxODozODoxNFrOFx48qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MzIzMw==", "bodyText": "Same constant is declared in OpenTelemetryTracer too. Can this defined in just one place?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8638#discussion_r387853233", "createdAt": "2020-03-04T18:30:13Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/tracing/Tracer.java", "diffHunk": "@@ -62,6 +62,11 @@\n      */\n     String SPAN_BUILDER_KEY = \"builder\";\n \n+    /**\n+     * Key for {@link Context} which indicates the the time of the last enqueued message in the partition's stream.\n+     */\n+    String MESSAGE_ENQUEUED_TIME = \"x-opt-enqueued-time\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ecab65f0649b26332287a8e3c0b84bc2f117b61"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1NzU3Ng==", "bodyText": "Should we convert time to Instant type? On the span, would a string formatted datetime make it easier than a long?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8638#discussion_r387857576", "createdAt": "2020-03-04T18:38:14Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core-tracing-opentelemetry/src/main/java/com/azure/core/tracing/opentelemetry/OpenTelemetryTracer.java", "diffHunk": "@@ -256,28 +260,32 @@ private static Context setContextData(Span span) {\n      */\n     private void addSpanRequestAttributes(Span span, Context context, String spanName) {\n         Objects.requireNonNull(span, \"'span' cannot be null.\");\n-        span.setAttribute(\n-            MESSAGE_BUS_DESTINATION,\n-            AttributeValue.stringAttributeValue(getOrDefault(context, ENTITY_PATH_KEY, \"\", String.class)));\n-        span.setAttribute(\n-            PEER_ENDPOINT,\n-            AttributeValue.stringAttributeValue(getOrDefault(context, HOST_NAME_KEY, \"\", String.class)));\n-        span.setAttribute(\n-            AZ_NAMESPACE_KEY,\n-            AttributeValue.stringAttributeValue(getOrDefault(context, AZ_TRACING_NAMESPACE_KEY, \"\", String.class)));\n+        String entityPath = getOrDefault(context, ENTITY_PATH_KEY, null, String.class);\n+        if (entityPath != null) {\n+            span.setAttribute(MESSAGE_BUS_DESTINATION, AttributeValue.stringAttributeValue(entityPath));\n+        }\n+        String hostName = getOrDefault(context, HOST_NAME_KEY, null, String.class);\n+        if (hostName != null) {\n+            span.setAttribute(PEER_ENDPOINT, AttributeValue.stringAttributeValue(hostName));\n+        }\n+        Long messageEnqueuedTime = getOrDefault(context, MESSAGE_ENQUEUED_TIME, null, Long.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ecab65f0649b26332287a8e3c0b84bc2f117b61"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62dae385a4cc13bfa7f11c26a95815238f0042b2", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/62dae385a4cc13bfa7f11c26a95815238f0042b2", "committedDate": "2020-03-04T20:22:52Z", "message": "update review comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 961, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}