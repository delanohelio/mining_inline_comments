{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MjczNDk0", "number": 15826, "title": "mgmt, keyvault refactor, avoid GET when list keys/secrets", "bodyText": "Separate List and Get. List only lists common part, key and secret value will be retrieved by a separate GET request.\n\nAdded enabled method in Secret.\nUpdated getAttributes, getTags, isManaged to attributes, tags, managed in Key.\nUpdated list method in Keys and Secrets. It will no longer retrieve key and secret value. Key can be retrieved via getJsonWebKey. Secret value can be retrieved via getValue.", "createdAt": "2020-09-30T06:03:42Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15826", "merged": true, "mergeCommit": {"oid": "1ab48287ff7f49080f13ff0f9b10bc5aeab0edf2"}, "closed": true, "closedAt": "2020-10-09T07:49:40Z", "author": {"login": "weidongxu-microsoft"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN2DxvgH2gAyNDk1MjczNDk0OmQ5ZjgxNzA2NTYxOTBmYjg3ZmQxMjQ0ZDMwNmRkMTRjMDIwNWY3NmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQwzCmgFqTUwNTQxNDQ0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d9f8170656190fb87fd1244d306dd14c0205f76e", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d9f8170656190fb87fd1244d306dd14c0205f76e", "committedDate": "2020-09-30T05:37:15Z", "message": "avoid GET when list keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abbabf6002347e710e3cf914eb6ee6560fd0267d", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/abbabf6002347e710e3cf914eb6ee6560fd0267d", "committedDate": "2020-09-30T05:51:11Z", "message": "avoid GET when list secrets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f65041eb834e8aa131da21fee0d63789ee954aa", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7f65041eb834e8aa131da21fee0d63789ee954aa", "committedDate": "2020-09-30T05:55:36Z", "message": "nit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7f9c6059bd24ce81b5fe795a0f2bc63c337e973", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b7f9c6059bd24ce81b5fe795a0f2bc63c337e973", "committedDate": "2020-09-30T05:57:56Z", "message": "bug fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84f807543467b052f320fe7eb1fe852683f16501", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/84f807543467b052f320fe7eb1fe852683f16501", "committedDate": "2020-09-30T06:02:55Z", "message": "bug fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c3f04be03497a0a15ab1446f628f75030d0ab26", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0c3f04be03497a0a15ab1446f628f75030d0ab26", "committedDate": "2020-09-30T06:12:06Z", "message": "minor improvement and changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4f8c7638e1786817165be93df44be455ef7674a", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a4f8c7638e1786817165be93df44be455ef7674a", "committedDate": "2020-09-30T06:41:01Z", "message": "fix spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4abe34fdd6df15b07eee9d82a3119b67ff28fd33", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4abe34fdd6df15b07eee9d82a3119b67ff28fd33", "committedDate": "2020-09-30T06:54:18Z", "message": "minor update on changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ddcaf46a4227c5106a771f22f297a1aef3db545", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0ddcaf46a4227c5106a771f22f297a1aef3db545", "committedDate": "2020-09-30T07:00:28Z", "message": "refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a04eca0403a016d7f6c9a46a292448c430108633", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a04eca0403a016d7f6c9a46a292448c430108633", "committedDate": "2020-09-30T07:04:08Z", "message": "update changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MjI1MDcy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15826#pullrequestreview-499225072", "createdAt": "2020-09-30T09:01:23Z", "commit": {"oid": "a04eca0403a016d7f6c9a46a292448c430108633"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowMToyM1rOHaUGNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowMToyM1rOHaUGNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1NDI5NQ==", "bodyText": "@xccc-msft\nNow that I've removed the per-item GET request, and added the enabled method, I believe I can let customer handle this case.\nCustomer should be able to check enabled method return, and then decide whether to do a getValue or not.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15826#discussion_r497354295", "createdAt": "2020-09-30T09:01:23Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/resourcemanager/azure-resourcemanager-keyvault/src/main/java/com/azure/resourcemanager/keyvault/implementation/SecretImpl.java", "diffHunk": "@@ -76,24 +98,20 @@ public boolean managed() {\n         return vault\n             .secretClient()\n             .listPropertiesOfSecretVersions(name())\n-            .flatMap(p -> {\n-                if (p.isEnabled()) {\n-                    return vault.secretClient().getSecret(p.getName(), p.getVersion());\n-                } else {\n-                    return Mono.just(new KeyVaultSecret(p.getName(), null).setProperties(p));\n-                }\n-            })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a04eca0403a016d7f6c9a46a292448c430108633"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35e85a12b1f83dbc7a6ba1c91235b1416f48a44b", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/35e85a12b1f83dbc7a6ba1c91235b1416f48a44b", "committedDate": "2020-10-09T02:25:31Z", "message": "Merge branch 'master' into mgmt_keyvault-refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7a1187f4b75224003762621c4b453c300ca6d41", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f7a1187f4b75224003762621c4b453c300ca6d41", "committedDate": "2020-10-09T05:24:35Z", "message": "add version parameter to getSecret"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MzcxMDky", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15826#pullrequestreview-505371092", "createdAt": "2020-10-09T05:25:40Z", "commit": {"oid": "f7a1187f4b75224003762621c4b453c300ca6d41"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNToyNTo0MFrOHe7ncQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNToyNTo0MFrOHe7ncQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjE5NjA4MQ==", "bodyText": "Get the version param fixed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15826#discussion_r502196081", "createdAt": "2020-10-09T05:25:40Z", "author": {"login": "weidongxu-microsoft"}, "path": "sdk/resourcemanager/azure-resourcemanager-keyvault/src/main/java/com/azure/resourcemanager/keyvault/implementation/SecretImpl.java", "diffHunk": "@@ -76,24 +98,20 @@ public boolean managed() {\n         return vault\n             .secretClient()\n             .listPropertiesOfSecretVersions(name())\n-            .flatMap(p -> {\n-                if (p.isEnabled()) {\n-                    return vault.secretClient().getSecret(p.getName(), p.getVersion());\n-                } else {\n-                    return Mono.just(new KeyVaultSecret(p.getName(), null).setProperties(p));\n-                }\n-            })\n             .map(this::wrapModel);\n     }\n \n     @Override\n-    protected Mono<KeyVaultSecret> getInnerAsync() {\n-        return vault.secretClient().getSecret(name(), null);\n+    protected Mono<SecretProperties> getInnerAsync() {\n+        return vault.secretClient().getSecret(name(), innerModel().getVersion()).map(secret -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7a1187f4b75224003762621c4b453c300ca6d41"}, "originalPosition": 105}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MzcxMzMz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15826#pullrequestreview-505371333", "createdAt": "2020-10-09T05:26:29Z", "commit": {"oid": "f7a1187f4b75224003762621c4b453c300ca6d41"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "206b52aa9bfb94fd47fce382df4542f3c31cb5a9", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/206b52aa9bfb94fd47fce382df4542f3c31cb5a9", "committedDate": "2020-10-09T05:39:28Z", "message": "set value to null if secret is disabled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NDE0NDQ3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15826#pullrequestreview-505414447", "createdAt": "2020-10-09T07:11:13Z", "commit": {"oid": "206b52aa9bfb94fd47fce382df4542f3c31cb5a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3116, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}