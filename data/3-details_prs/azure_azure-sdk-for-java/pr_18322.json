{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0NTA4NjM3", "number": 18322, "title": "Add test: accessTokenScopesIT", "bodyText": "carry on pr #18269", "createdAt": "2020-12-23T02:42:12Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18322", "merged": true, "mergeCommit": {"oid": "9ec1f54241b23679413ccf60bd962e74fc15c9b5"}, "closed": true, "closedAt": "2020-12-23T08:14:21Z", "author": {"login": "zhichengliu12581"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnPCREAH2gAyNTQ0NTA4NjM3Ojc2NzIzMzc5NTc4YjIxNzQ4YzhmNDAwZDcwNzcxMmE0OTU0ODFhODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdo5-jPgFqTU1NzY4NzIyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "76723379578b21748c8f400d707712a495481a87", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/76723379578b21748c8f400d707712a495481a87", "committedDate": "2020-12-18T02:51:20Z", "message": "add unit test for AzureOauth2RefreshTokenGrantRequestEntityConverter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d11fd95bb88be1a4d50df3bc223e71c818bdea9", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7d11fd95bb88be1a4d50df3bc223e71c818bdea9", "committedDate": "2020-12-18T02:53:12Z", "message": "add distinction to refreshtoken converter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a6738890e88d3441fffb7d432043d530ad42957", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9a6738890e88d3441fffb7d432043d530ad42957", "committedDate": "2020-12-18T02:53:42Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into add-unit-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f3cdc19e00328439d0868179ae6415a0ae813f8", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7f3cdc19e00328439d0868179ae6415a0ae813f8", "committedDate": "2020-12-18T08:43:49Z", "message": "add unit test for AzureOauth2RefreshTokenGrantRequestEntityConverterTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8af1ac15b4694a5d1a0f1b0e5d5a5c0c2ffd1de7", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8af1ac15b4694a5d1a0f1b0e5d5a5c0c2ffd1de7", "committedDate": "2020-12-18T08:44:50Z", "message": "add integration test for RefreshTokenConverter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "671b41302524b0586aed6ac384118372b9c48ffe", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/671b41302524b0586aed6ac384118372b9c48ffe", "committedDate": "2020-12-18T08:49:47Z", "message": "add ConditionalOnResource for AADWebAppConfiguration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b436508f5eed7adc1620752c147672e1130cab3", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8b436508f5eed7adc1620752c147672e1130cab3", "committedDate": "2020-12-18T10:05:13Z", "message": "use multi tenant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1cca0675b638d7b0c597dc1fb2b9eede735370d", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e1cca0675b638d7b0c597dc1fb2b9eede735370d", "committedDate": "2020-12-18T10:14:59Z", "message": "format code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6bcb175a1690769fcf76bb8e5cfe83cde123b73", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f6bcb175a1690769fcf76bb8e5cfe83cde123b73", "committedDate": "2020-12-21T03:16:52Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into add-unit-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74b7e212682a0dcde901c84e2e2045de44a7d31a", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/74b7e212682a0dcde901c84e2e2045de44a7d31a", "committedDate": "2020-12-21T08:17:26Z", "message": "change function and properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5179ff03ae9088167a1c0b58544c1a526c62be39", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5179ff03ae9088167a1c0b58544c1a526c62be39", "committedDate": "2020-12-21T08:18:46Z", "message": "reuse codes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08c59c2a0012be916cf82a20be61f4490dba04eb", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/08c59c2a0012be916cf82a20be61f4490dba04eb", "committedDate": "2020-12-22T02:18:46Z", "message": "edit test config to enable refreshTokenConverter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20d5d033d6481f15618c1f237a285c2cf05044d0", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/20d5d033d6481f15618c1f237a285c2cf05044d0", "committedDate": "2020-12-22T02:44:21Z", "message": "Merge branch 'master' into add-unit-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efa9f795f8ae04395fa9882db6a99aeae5749f2d", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/efa9f795f8ae04395fa9882db6a99aeae5749f2d", "committedDate": "2020-12-22T03:24:00Z", "message": "edit default configure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c765cc57b503b3922736425d7ceeab4ddd5cb82", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3c765cc57b503b3922736425d7ceeab4ddd5cb82", "committedDate": "2020-12-22T06:26:14Z", "message": "merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc73f259102564faccad5e9e2070f85cd4c88552", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bc73f259102564faccad5e9e2070f85cd4c88552", "committedDate": "2020-12-22T07:03:26Z", "message": "remove refreshTokenConverter and test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a44207e47c63534726a3536988cd3b0ec1787eab", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a44207e47c63534726a3536988cd3b0ec1787eab", "committedDate": "2020-12-22T09:30:55Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into add-unit-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c613ceff3de32f12fc0a882249c5afb49e98d56", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0c613ceff3de32f12fc0a882249c5afb49e98d56", "committedDate": "2020-12-23T01:29:42Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into add-unit-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74a5aab36c6ce71b8176a484bf77c42d425f4cf8", "author": {"user": {"login": "zhichengliu12581", "name": "liuzhicheng"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/74a5aab36c6ce71b8176a484bf77c42d425f4cf8", "committedDate": "2020-12-23T02:39:17Z", "message": "carry on pr #18269"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjgzODM5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18322#pullrequestreview-557683839", "createdAt": "2020-12-23T07:18:24Z", "commit": {"oid": "74a5aab36c6ce71b8176a484bf77c42d425f4cf8"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzoxODoyNVrOIKXpWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzoyNDoxOVrOIKX6sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc0NDA4OQ==", "bodyText": "Hi, @lzc-1997-abel , please create another PR to set multiple scopes for graph and office. For both test and sample(with readme).", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18322#discussion_r547744089", "createdAt": "2020-12-23T07:18:25Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/converter/RefreshTokenScopesIT.java", "diffHunk": "@@ -0,0 +1,88 @@\n+\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.converter;\n+\n+import com.azure.test.oauth.SeleniumTestUtils;\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.client.annotation.RegisteredOAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.core.OAuth2AccessToken;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.*;\n+\n+public class RefreshTokenScopesIT {\n+\n+    @Test\n+    public void testRefreshTokenConverter() {\n+        try (AppRunner app = new AppRunner(DumbApp.class)) {\n+            SeleniumTestUtils.addProperty(app);\n+            app.property(\"azure.activedirectory.authorization.office.scopes\", \"https://manage.office.com/ActivityFeed.Read\");\n+            app.property(\"azure.activedirectory.authorization.graph.scopes\", \"https://graph.microsoft.com/User.Read\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74a5aab36c6ce71b8176a484bf77c42d425f4cf8"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc0NTcxMg==", "bodyText": "Why office and graph should contain profile scope? I remember openid and profile only needed for on-demand client.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18322#discussion_r547745712", "createdAt": "2020-12-23T07:20:32Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/converter/RefreshTokenScopesIT.java", "diffHunk": "@@ -0,0 +1,88 @@\n+\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.converter;\n+\n+import com.azure.test.oauth.SeleniumTestUtils;\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.client.annotation.RegisteredOAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.core.OAuth2AccessToken;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.*;\n+\n+public class RefreshTokenScopesIT {\n+\n+    @Test\n+    public void testRefreshTokenConverter() {\n+        try (AppRunner app = new AppRunner(DumbApp.class)) {\n+            SeleniumTestUtils.addProperty(app);\n+            app.property(\"azure.activedirectory.authorization.office.scopes\", \"https://manage.office.com/ActivityFeed.Read\");\n+            app.property(\"azure.activedirectory.authorization.graph.scopes\", \"https://graph.microsoft.com/User.Read\");\n+            List<String> endPoints = new ArrayList<>();\n+            endPoints.add(\"api/office\");\n+            endPoints.add(\"api/azure\");\n+            endPoints.add(\"api/graph\");\n+            endPoints.add(\"api/arm\");\n+            Map<String, String> result = SeleniumTestUtils.get(app, endPoints);\n+\n+            Assert.assertFalse(result.get(\"api/office\").contains(\"profile\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74a5aab36c6ce71b8176a484bf77c42d425f4cf8"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc0NjI3Nw==", "bodyText": "accessTokenScopes/office is easier to understand. Same to other endpoints.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18322#discussion_r547746277", "createdAt": "2020-12-23T07:21:27Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/converter/RefreshTokenScopesIT.java", "diffHunk": "@@ -0,0 +1,88 @@\n+\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.converter;\n+\n+import com.azure.test.oauth.SeleniumTestUtils;\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.client.annotation.RegisteredOAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.core.OAuth2AccessToken;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.*;\n+\n+public class RefreshTokenScopesIT {\n+\n+    @Test\n+    public void testRefreshTokenConverter() {\n+        try (AppRunner app = new AppRunner(DumbApp.class)) {\n+            SeleniumTestUtils.addProperty(app);\n+            app.property(\"azure.activedirectory.authorization.office.scopes\", \"https://manage.office.com/ActivityFeed.Read\");\n+            app.property(\"azure.activedirectory.authorization.graph.scopes\", \"https://graph.microsoft.com/User.Read\");\n+            List<String> endPoints = new ArrayList<>();\n+            endPoints.add(\"api/office\");\n+            endPoints.add(\"api/azure\");\n+            endPoints.add(\"api/graph\");\n+            endPoints.add(\"api/arm\");\n+            Map<String, String> result = SeleniumTestUtils.get(app, endPoints);\n+\n+            Assert.assertFalse(result.get(\"api/office\").contains(\"profile\"));\n+            Assert.assertTrue(result.get(\"api/office\").contains(\"https://manage.office.com/ActivityFeed.Read\"));\n+\n+            Assert.assertTrue(result.get(\"api/azure\").contains(\"profile\"));\n+            Assert.assertTrue(result.get(\"api/azure\").contains(\"https://graph.microsoft.com/User.Read\"));\n+\n+            Assert.assertTrue(result.get(\"api/graph\").contains(\"profile\"));\n+            Assert.assertTrue(result.get(\"api/graph\").contains(\"https://graph.microsoft.com/User.Read\"));\n+\n+            Assert.assertNotEquals(\"error\", result.get(\"api/arm\"));\n+        }\n+    }\n+\n+    @EnableGlobalMethodSecurity(securedEnabled = true, prePostEnabled = true)\n+    @SpringBootApplication\n+    @RestController\n+    public static class DumbApp {\n+\n+        @GetMapping(value = \"api/office\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74a5aab36c6ce71b8176a484bf77c42d425f4cf8"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc0ODUzMA==", "bodyText": "Can we put endPoints.get(0) into for loop?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18322#discussion_r547748530", "createdAt": "2020-12-23T07:24:19Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/oauth/SeleniumTestUtils.java", "diffHunk": "@@ -77,12 +79,12 @@\n             Thread.sleep(10000);\n             driver.findElement(By.cssSelector(\"input[type='submit']\")).click();\n             Thread.sleep(10000);\n-            result.add(driver.findElement(By.tagName(\"body\")).getText());\n+            result.put(endPoints.get(0) , driver.findElement(By.tagName(\"body\")).getText());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74a5aab36c6ce71b8176a484bf77c42d425f4cf8"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3Njg3MjIx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18322#pullrequestreview-557687221", "createdAt": "2020-12-23T07:27:06Z", "commit": {"oid": "74a5aab36c6ce71b8176a484bf77c42d425f4cf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzoyNzowNlrOIKYC2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzoyNzowNlrOIKYC2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc1MDYxNg==", "bodyText": "accessTokenScopesIT", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18322#discussion_r547750616", "createdAt": "2020-12-23T07:27:06Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/converter/RefreshTokenScopesIT.java", "diffHunk": "@@ -0,0 +1,88 @@\n+\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.test.aad.converter;\n+\n+import com.azure.test.oauth.SeleniumTestUtils;\n+import com.azure.test.utils.AppRunner;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\n+import org.springframework.security.oauth2.client.OAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.client.annotation.RegisteredOAuth2AuthorizedClient;\n+import org.springframework.security.oauth2.core.OAuth2AccessToken;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import java.util.*;\n+\n+public class RefreshTokenScopesIT {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74a5aab36c6ce71b8176a484bf77c42d425f4cf8"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1128, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}