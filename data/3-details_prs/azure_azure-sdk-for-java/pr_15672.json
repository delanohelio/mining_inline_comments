{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyOTQ3NTcz", "number": 15672, "title": "mgmt, add util method for merging PagedFlux", "bodyText": "Usually used to supply list by listByResourceGroup.", "createdAt": "2020-09-25T09:23:42Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15672", "merged": true, "mergeCommit": {"oid": "d70a8b6192b11e7d7145db1d1655ecb9a1ef7cca"}, "closed": true, "closedAt": "2020-09-27T03:42:56Z", "author": {"login": "weidongxu-microsoft"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMNwMcAH2gAyNDkyOTQ3NTczOjQyOWMxMjQ2NWI4MjUzYzFjNWMxMDE3ODdiNmUyZmZiYWNhZTExNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdM2NfSAH2gAyNDkyOTQ3NTczOjk4NDZiZmMxNjU2MTY0NWZlNTkxZTZlNzQwMjQwNzc5YzgwNTE3MzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "429c12465b8253c1c5c101787b6e2ffbacae1148", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/429c12465b8253c1c5c101787b6e2ffbacae1148", "committedDate": "2020-09-25T04:05:44Z", "message": "regen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "137401cc074b3c4aa3b2d602720bc7af31ae1380", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/137401cc074b3c4aa3b2d602720bc7af31ae1380", "committedDate": "2020-09-25T04:10:38Z", "message": "manual fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de1fb2a779ab42ed67358cfd1f375a232ce71c5f", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/de1fb2a779ab42ed67358cfd1f375a232ce71c5f", "committedDate": "2020-09-25T04:22:08Z", "message": "batch replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3f0d8b4ee9c2734b4b9ff0d2f4eb9bbb9bcf097", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f3f0d8b4ee9c2734b4b9ff0d2f4eb9bbb9bcf097", "committedDate": "2020-09-25T04:22:50Z", "message": "regen privatedns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb6382dfaec632686b292c3b36b616c486c65e9e", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cb6382dfaec632686b292c3b36b616c486c65e9e", "committedDate": "2020-09-25T05:03:36Z", "message": "manual fix after client interface change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbf7ead1905e10e5289b8de4d23c76d5665cb214", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bbf7ead1905e10e5289b8de4d23c76d5665cb214", "committedDate": "2020-09-25T05:14:40Z", "message": "regen sql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef56853af9f0b83f5ddfb63035bac450e949f8c7", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ef56853af9f0b83f5ddfb63035bac450e949f8c7", "committedDate": "2020-09-25T05:44:40Z", "message": "fix sql files not commited"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e02652f889d2894dc907a80aeb5b95294a6aa612", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e02652f889d2894dc907a80aeb5b95294a6aa612", "committedDate": "2020-09-25T05:46:59Z", "message": "set azure-core-management version to dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea6a11de4ec27e9e2ecbcb583f8680314fe37617", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ea6a11de4ec27e9e2ecbcb583f8680314fe37617", "committedDate": "2020-09-25T06:00:40Z", "message": "Merge branch 'mgmt_reset-core-mgmt-version-to-dependency' into mgmt_regen-all"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0e6ceac99c06c725c870cd153b42311352f0f54", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a0e6ceac99c06c725c870cd153b42311352f0f54", "committedDate": "2020-09-25T06:13:29Z", "message": "record"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6aa8e8f01891826682aa4182bda0711013de613c", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6aa8e8f01891826682aa4182bda0711013de613c", "committedDate": "2020-09-25T06:19:51Z", "message": "update script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99ac8de0c3ce7f4d42a8f6abf667af1dda8beddf", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/99ac8de0c3ce7f4d42a8f6abf667af1dda8beddf", "committedDate": "2020-09-25T06:24:44Z", "message": "exclude generated code from jacoco coverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbacab6c461de5793711f02164020f6704490590", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cbacab6c461de5793711f02164020f6704490590", "committedDate": "2020-09-25T07:38:35Z", "message": "record"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e25ae6e9ca1c8632630d6cbb612ec9226a6c531f", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e25ae6e9ca1c8632630d6cbb612ec9226a6c531f", "committedDate": "2020-09-25T08:20:28Z", "message": "add mergePagedFlux"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34baeeb72f36e5604d7b6d79018d512653e20eee", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/34baeeb72f36e5604d7b6d79018d512653e20eee", "committedDate": "2020-09-25T09:21:59Z", "message": "javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b436ca2552cc61879041a261f8b349c5dff6e22", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4b436ca2552cc61879041a261f8b349c5dff6e22", "committedDate": "2020-09-25T12:48:26Z", "message": "Merge branch 'master' into mgmt_regen-all"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e12e0bdac71441819ccd28172fabbbf9451c8a6", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5e12e0bdac71441819ccd28172fabbbf9451c8a6", "committedDate": "2020-09-25T13:01:18Z", "message": "update suppression, as autorest generated class is moved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a8f88bdd5efe237c54cde0cfc6be6abbb888bf3", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9a8f88bdd5efe237c54cde0cfc6be6abbb888bf3", "committedDate": "2020-09-25T13:01:56Z", "message": "Merge branch 'mgmt_regen-all' into mgmt_merge-paged-flux"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c110b72ded5dab43bf0390529688d50213e25d0", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9c110b72ded5dab43bf0390529688d50213e25d0", "committedDate": "2020-09-25T14:47:47Z", "message": "Merge branch 'master' into mgmt_merge-paged-flux"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c1fd29f713c94380dd4299360f8b465058bd8d0", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5c1fd29f713c94380dd4299360f8b465058bd8d0", "committedDate": "2020-09-27T02:13:30Z", "message": "update javadoc for PagedConverter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c72bc8ac1e9f18c5a10ea73316fc19385547a6c9", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c72bc8ac1e9f18c5a10ea73316fc19385547a6c9", "committedDate": "2020-09-27T02:21:22Z", "message": "add test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd66878451de97c3629ca14a9bf19ca2d967acef", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/cd66878451de97c3629ca14a9bf19ca2d967acef", "committedDate": "2020-09-27T02:29:04Z", "message": "Merge branch 'master' into mgmt_merge-paged-flux"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea23c21ba2a2cf3b3837a3101d31a8e9d65dc658", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ea23c21ba2a2cf3b3837a3101d31a8e9d65dc658", "committedDate": "2020-09-27T02:34:59Z", "message": "nit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10a0800270a02f3e52fbf71e14f9098ef62a66dc", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/10a0800270a02f3e52fbf71e14f9098ef62a66dc", "committedDate": "2020-09-27T02:56:01Z", "message": "fix test, miss verify"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDQ1NzM3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15672#pullrequestreview-497045737", "createdAt": "2020-09-27T02:56:16Z", "commit": {"oid": "ea23c21ba2a2cf3b3837a3101d31a8e9d65dc658"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDQ0Njc2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15672#pullrequestreview-497044676", "createdAt": "2020-09-27T02:33:06Z", "commit": {"oid": "c72bc8ac1e9f18c5a10ea73316fc19385547a6c9"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMjozMzowNlrOHYkCgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMjozNDoyM1rOHYkC4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxODMzOA==", "bodyText": "If use concatMap, is it better to change function name to concatMapPage?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15672#discussion_r495518338", "createdAt": "2020-09-27T02:33:06Z", "author": {"login": "ChenTanyi"}, "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/utils/PagedConverter.java", "diffHunk": "@@ -28,36 +29,58 @@ private PagedConverter() {\n     /**\n      * Applies flatMap transform to elements of PagedFlux.\n      *\n-     * @param <T> input type of pagedFlux\n-     * @param <S> return type of pagedFlux\n-     * @param pagedFlux input\n-     * @param mapper the flatMap transform of element T to Publisher of S.\n-     * @return the PagedFlux.\n+     * @param pagedFlux the input of PagedFlux.\n+     * @param transformer the flatMap transform of element T to Publisher of S.\n+     * @param <T> input type of PagedFlux.\n+     * @param <S> return type of PagedFlux.\n+     * @return the PagedFlux with elements in PagedResponse transformed.\n      */\n     public static <T, S> PagedFlux<S> flatMapPage(PagedFlux<T> pagedFlux,\n-            Function<? super T, ? extends Publisher<? extends S>> mapper) {\n+            Function<? super T, ? extends Publisher<? extends S>> transformer) {\n         Supplier<PageRetriever<String, PagedResponse<S>>> provider = () -> (continuationToken, pageSize) -> {\n             Flux<PagedResponse<T>> flux = (continuationToken == null)\n                     ? pagedFlux.byPage()\n                     : pagedFlux.byPage(continuationToken);\n-            return flux.flatMap(PagedConverter.flatMapPagedResponse(mapper));\n+            return flux.concatMap(PagedConverter.flatMapPagedResponse(transformer));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c72bc8ac1e9f18c5a10ea73316fc19385547a6c9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxODM1Ng==", "bodyText": "Same as above", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15672#discussion_r495518356", "createdAt": "2020-09-27T02:33:24Z", "author": {"login": "ChenTanyi"}, "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/utils/PagedConverter.java", "diffHunk": "@@ -28,36 +29,58 @@ private PagedConverter() {\n     /**\n      * Applies flatMap transform to elements of PagedFlux.\n      *\n-     * @param <T> input type of pagedFlux\n-     * @param <S> return type of pagedFlux\n-     * @param pagedFlux input\n-     * @param mapper the flatMap transform of element T to Publisher of S.\n-     * @return the PagedFlux.\n+     * @param pagedFlux the input of PagedFlux.\n+     * @param transformer the flatMap transform of element T to Publisher of S.\n+     * @param <T> input type of PagedFlux.\n+     * @param <S> return type of PagedFlux.\n+     * @return the PagedFlux with elements in PagedResponse transformed.\n      */\n     public static <T, S> PagedFlux<S> flatMapPage(PagedFlux<T> pagedFlux,\n-            Function<? super T, ? extends Publisher<? extends S>> mapper) {\n+            Function<? super T, ? extends Publisher<? extends S>> transformer) {\n         Supplier<PageRetriever<String, PagedResponse<S>>> provider = () -> (continuationToken, pageSize) -> {\n             Flux<PagedResponse<T>> flux = (continuationToken == null)\n                     ? pagedFlux.byPage()\n                     : pagedFlux.byPage(continuationToken);\n-            return flux.flatMap(PagedConverter.flatMapPagedResponse(mapper));\n+            return flux.concatMap(PagedConverter.flatMapPagedResponse(transformer));\n+        };\n+        return PagedFlux.create(provider);\n+    }\n+\n+    /**\n+     * Merge PagedFlux in PagedFlux to a single PagedFlux.\n+     *\n+     * @param pagedFlux the input of PagedFlux.\n+     * @param transformer the transform of element T to PagedFlux of S.\n+     * @param <T> input type of PagedFlux.\n+     * @param <S> return type of PagedFlux.\n+     * @return the merged PagedFlux.\n+     */\n+    public static <T, S> PagedFlux<S> mergePagedFlux(PagedFlux<T> pagedFlux,\n+            Function<? super T, PagedFlux<S>> transformer) {\n+        // one possible issue is that when inner PagedFlux ends, that PagedResponse will have continuationToken == null\n+\n+        Supplier<PageRetriever<String, PagedResponse<S>>> provider = () -> (continuationToken, pageSize) -> {\n+            Flux<PagedResponse<T>> flux = (continuationToken == null)\n+                ? pagedFlux.byPage()\n+                : pagedFlux.byPage(continuationToken);\n+            return flux.concatMap(PagedConverter.mergePagedFluxPagedResponse(transformer));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c72bc8ac1e9f18c5a10ea73316fc19385547a6c9"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUxODQzMg==", "bodyText": "I think transformer is not better than mapper. Flux has a function transform is different to flatMap", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15672#discussion_r495518432", "createdAt": "2020-09-27T02:34:23Z", "author": {"login": "ChenTanyi"}, "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/utils/PagedConverter.java", "diffHunk": "@@ -28,36 +29,58 @@ private PagedConverter() {\n     /**\n      * Applies flatMap transform to elements of PagedFlux.\n      *\n-     * @param <T> input type of pagedFlux\n-     * @param <S> return type of pagedFlux\n-     * @param pagedFlux input\n-     * @param mapper the flatMap transform of element T to Publisher of S.\n-     * @return the PagedFlux.\n+     * @param pagedFlux the input of PagedFlux.\n+     * @param transformer the flatMap transform of element T to Publisher of S.\n+     * @param <T> input type of PagedFlux.\n+     * @param <S> return type of PagedFlux.\n+     * @return the PagedFlux with elements in PagedResponse transformed.\n      */\n     public static <T, S> PagedFlux<S> flatMapPage(PagedFlux<T> pagedFlux,\n-            Function<? super T, ? extends Publisher<? extends S>> mapper) {\n+            Function<? super T, ? extends Publisher<? extends S>> transformer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c72bc8ac1e9f18c5a10ea73316fc19385547a6c9"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9846bfc16561645fe591e6e740240779c8051730", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9846bfc16561645fe591e6e740240779c8051730", "committedDate": "2020-09-27T03:13:56Z", "message": "rename parameter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3323, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}