{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NjcwMDAw", "number": 17179, "title": "[Monitor Exporter] Replace instrumentationKey with connectionString in builder", "bodyText": "This PR replaces the instrumentationKey() builder method with connectionString() as that's the preferred input to create the exporter instance.\nThis PR also hides the endpoint method on the builder and instead uses the connection string to set the endpoint.\nFixes #16705", "createdAt": "2020-11-04T22:16:28Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17179", "merged": true, "mergeCommit": {"oid": "d0fbe8d2d00a6e2759b659ee380c4b7a71ed597a"}, "closed": true, "closedAt": "2020-11-10T21:51:05Z", "author": {"login": "srnagar"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZVSqcAH2gAyNTE1NjcwMDAwOjcyOGE5ZjNmYWIwOTllYjgwOTA5OTM0MzY5NjBhM2Q0NjdlYjY2NzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbQEqjAFqTUyNzYxMzg2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "728a9f3fab099eb8090993436960a3d467eb6671", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/728a9f3fab099eb8090993436960a3d467eb6671", "committedDate": "2020-11-04T22:13:44Z", "message": "Replace instrumentationKey with connectionString in builder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26a314378335b5806c3e5bc7b011f38a1b74c31a", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/26a314378335b5806c3e5bc7b011f38a1b74c31a", "committedDate": "2020-11-04T22:58:50Z", "message": "Add unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da7a50bd45bb57f6c22e0510b0d427ca3132511b", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/da7a50bd45bb57f6c22e0510b0d427ca3132511b", "committedDate": "2020-11-05T00:09:18Z", "message": "Fix module access for unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4495d71df2c0b6b263c26d8ce31c7626c03fa5ea", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4495d71df2c0b6b263c26d8ce31c7626c03fa5ea", "committedDate": "2020-11-05T00:28:34Z", "message": "Add copyright"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjgzNTA1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17179#pullrequestreview-524683505", "createdAt": "2020-11-05T21:23:38Z", "commit": {"oid": "4495d71df2c0b6b263c26d8ce31c7626c03fa5ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMToyMzozOFrOHuXNaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMToyMzozOFrOHuXNaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM3NjgwOA==", "bodyText": "I think ideally we would also extract IngestionEndpoint from the connection string and not expose endpoint() directly", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17179#discussion_r518376808", "createdAt": "2020-11-05T21:23:38Z", "author": {"login": "trask"}, "path": "sdk/monitor/microsoft-opentelemetry-exporter-azuremonitor/src/main/java/com/microsoft/opentelemetry/exporter/azuremonitor/AzureMonitorExporterBuilder.java", "diffHunk": "@@ -134,15 +136,31 @@ public AzureMonitorExporterBuilder configuration(Configuration configuration) {\n     }\n \n     /**\n-     * Sets the instrumentation key to use for exporting telemetry events to Azure Monitor.\n-     * @param instrumentationKey The instrumentation key of the Azure Monitor resource.\n+     * The connection string to use for exporting telemetry events to Azure Monitor.\n+     * @param connectionString The connection string for the Azure Monitor resource.\n      * @return The updated {@link AzureMonitorExporterBuilder} object.\n+     * @throws NullPointerException If the connection string is {@code null}.\n+     * @throws IllegalArgumentException If the connection string is invalid.\n      */\n-    public AzureMonitorExporterBuilder instrumentationKey(String instrumentationKey) {\n-        this.instrumentationKey = instrumentationKey;\n+    public AzureMonitorExporterBuilder connectionString(String connectionString) {\n+        this.instrumentationKey = extractInstrumentationKey(connectionString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4495d71df2c0b6b263c26d8ce31c7626c03fa5ea"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f502d2e2c5ae5e8569b8939ce9603ef74d737eb4", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f502d2e2c5ae5e8569b8939ce9603ef74d737eb4", "committedDate": "2020-11-10T00:45:27Z", "message": "Use ingestion endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2ODIzNDM0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17179#pullrequestreview-526823434", "createdAt": "2020-11-10T03:19:46Z", "commit": {"oid": "f502d2e2c5ae5e8569b8939ce9603ef74d737eb4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMzoxOTo0N1rOHwKNaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMzozNDoxMlrOHwKcTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI2MDk2OA==", "bodyText": "maybe extract once into Map<String, String> once and pull values from there? not a big deal tho", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17179#discussion_r520260968", "createdAt": "2020-11-10T03:19:47Z", "author": {"login": "trask"}, "path": "sdk/monitor/microsoft-opentelemetry-exporter-azuremonitor/src/main/java/com/microsoft/opentelemetry/exporter/azuremonitor/AzureMonitorExporterBuilder.java", "diffHunk": "@@ -143,22 +143,23 @@ public AzureMonitorExporterBuilder configuration(Configuration configuration) {\n      * @throws IllegalArgumentException If the connection string is invalid.\n      */\n     public AzureMonitorExporterBuilder connectionString(String connectionString) {\n-        this.instrumentationKey = extractInstrumentationKey(connectionString);\n+        this.instrumentationKey = extractValueFromConnectionString(connectionString, \"InstrumentationKey\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f502d2e2c5ae5e8569b8939ce9603ef74d737eb4"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI2NDc4Mw==", "bodyText": "if the IngestionEndpoint key is absent, ideally should default to https://dc.services.visualstudio.com", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17179#discussion_r520264783", "createdAt": "2020-11-10T03:34:12Z", "author": {"login": "trask"}, "path": "sdk/monitor/microsoft-opentelemetry-exporter-azuremonitor/src/main/java/com/microsoft/opentelemetry/exporter/azuremonitor/AzureMonitorExporterBuilder.java", "diffHunk": "@@ -134,15 +136,32 @@ public AzureMonitorExporterBuilder configuration(Configuration configuration) {\n     }\n \n     /**\n-     * Sets the instrumentation key to use for exporting telemetry events to Azure Monitor.\n-     * @param instrumentationKey The instrumentation key of the Azure Monitor resource.\n+     * The connection string to use for exporting telemetry events to Azure Monitor.\n+     * @param connectionString The connection string for the Azure Monitor resource.\n      * @return The updated {@link AzureMonitorExporterBuilder} object.\n+     * @throws NullPointerException If the connection string is {@code null}.\n+     * @throws IllegalArgumentException If the connection string is invalid.\n      */\n-    public AzureMonitorExporterBuilder instrumentationKey(String instrumentationKey) {\n-        this.instrumentationKey = instrumentationKey;\n+    public AzureMonitorExporterBuilder connectionString(String connectionString) {\n+        this.instrumentationKey = extractValueFromConnectionString(connectionString, \"InstrumentationKey\");\n+        this.endpoint(extractValueFromConnectionString(connectionString, \"IngestionEndpoint\"));\n         return this;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f502d2e2c5ae5e8569b8939ce9603ef74d737eb4"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ec178dae71de851e1d40cd27b7ffc1f7e11d934", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4ec178dae71de851e1d40cd27b7ffc1f7e11d934", "committedDate": "2020-11-10T04:30:01Z", "message": "Default endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16e499753e617f9ecc62548a310124380b5ed5a9", "author": {"user": {"login": "srnagar", "name": "Srikanta"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/16e499753e617f9ecc62548a310124380b5ed5a9", "committedDate": "2020-11-10T19:32:28Z", "message": "Update changelog and readme to prepare for release"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTQ1NTc2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17179#pullrequestreview-527545576", "createdAt": "2020-11-10T19:38:29Z", "commit": {"oid": "16e499753e617f9ecc62548a310124380b5ed5a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTkxOTIw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17179#pullrequestreview-527591920", "createdAt": "2020-11-10T20:44:08Z", "commit": {"oid": "16e499753e617f9ecc62548a310124380b5ed5a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjEzODY3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17179#pullrequestreview-527613867", "createdAt": "2020-11-10T21:16:46Z", "commit": {"oid": "16e499753e617f9ecc62548a310124380b5ed5a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 225, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}