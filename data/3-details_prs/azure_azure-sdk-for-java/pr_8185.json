{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MDQyNjk4", "number": 8185, "title": "Maintain Before and After Retry Polices Separately in HttpPolicyProviders", "bodyText": "Fixes #8163\nRe-writes HttpPolicyProviders to maintain the BeforeRetryPolicyProviders and AfterRetryPolicyProviders as separate entities instead of combining them into a single Map.", "createdAt": "2020-02-13T19:16:39Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8185", "merged": true, "mergeCommit": {"oid": "450295b15f54920b341ea3498dc6803cc6559e8e"}, "closed": true, "closedAt": "2020-02-14T18:06:29Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcD_5SjgH2gAyMzc1MDQyNjk4OmFiYzllOGJmZjM0ZjZkMTAzM2ViMjNiOGY3ZTFhMDdlOGVjZGZjZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEE9doAFqTM1ODY1ODAwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "abc9e8bff34f6d1033eb23b8f7e1a07e8ecdfcfe", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/abc9e8bff34f6d1033eb23b8f7e1a07e8ecdfcfe", "committedDate": "2020-02-13T19:14:27Z", "message": "Update HttpPolicyProvider to maintain separate iterables for before and after policy providers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46174577d6c48af0a2dcc7de3a02c1ffc31b1c02", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/46174577d6c48af0a2dcc7de3a02c1ffc31b1c02", "committedDate": "2020-02-13T20:44:37Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7cbc22a3f0622c85144d245e56c250cbd229f61", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d7cbc22a3f0622c85144d245e56c250cbd229f61", "committedDate": "2020-02-13T20:45:11Z", "message": "Merge branch 'master' into AzCore_UpdatePolicyProviders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "282bbd4e3e549d43861279d56bc0b8c6732b3081", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/282bbd4e3e549d43861279d56bc0b8c6732b3081", "committedDate": "2020-02-14T00:12:15Z", "message": "Merge branch 'master' into AzCore_UpdatePolicyProviders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a24296d5278c04c581298a78b8002264e31a01f", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3a24296d5278c04c581298a78b8002264e31a01f", "committedDate": "2020-02-14T00:31:32Z", "message": "Remove tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "123c95c05f9780ddb593330388e7c93562bfaceb", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/123c95c05f9780ddb593330388e7c93562bfaceb", "committedDate": "2020-02-14T00:32:50Z", "message": "Remove inadvertent change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NjU3NzMz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8185#pullrequestreview-358657733", "createdAt": "2020-02-14T01:07:42Z", "commit": {"oid": "123c95c05f9780ddb593330388e7c93562bfaceb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMTowNzo0MlrOFpo0pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMTowNzo0MlrOFpo0pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIwNDc3Mw==", "bodyText": "Log and throw the exception. Also, this should have been caught in checkstyle.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8185#discussion_r379204773", "createdAt": "2020-02-14T01:07:42Z", "author": {"login": "srnagar"}, "path": "sdk/core/azure-core/src/main/java/com/azure/core/http/policy/HttpPolicyProviders.java", "diffHunk": "@@ -36,32 +39,18 @@ public static void addBeforeRetryPolicies(List<HttpPipelinePolicy> policies) {\n      * @param policies Policy list to append the policies.\n      */\n     public static void addAfterRetryPolicies(List<HttpPipelinePolicy> policies) {\n-        addRetryPolicies(policies, () -> getPolicyProviders(false, AfterRetryPolicyProvider.class));\n+        addPolices(policies, AFTER_PROVIDER);\n     }\n \n-    private static void addRetryPolicies(List<HttpPipelinePolicy> policies,\n-        Supplier<Iterator<? extends HttpPolicyProvider>> policySupplier) {\n-        Iterator<? extends HttpPolicyProvider> it = policySupplier.get();\n-        while (it.hasNext()) {\n-            HttpPolicyProvider policyProvider = it.next();\n-            HttpPipelinePolicy policy = policyProvider.create();\n+    private static void addPolices(List<HttpPipelinePolicy> policies,\n+        Iterable<? extends HttpPolicyProvider> providers) {\n+        for (HttpPolicyProvider provider : providers) {\n+            HttpPipelinePolicy policy = provider.create();\n             if (policy == null) {\n-                throw new NullPointerException(\"HttpPipelinePolicy created with \" + policyProvider.getClass()\n-                    + \" resulted in a null policy\");\n+                throw new NullPointerException(String.format(INVALID_POLICY, provider.getClass()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "123c95c05f9780ddb593330388e7c93562bfaceb"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NjU4MDA5", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8185#pullrequestreview-358658009", "createdAt": "2020-02-14T01:08:32Z", "commit": {"oid": "123c95c05f9780ddb593330388e7c93562bfaceb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2304, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}