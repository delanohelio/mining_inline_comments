{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0ODAwMDYy", "number": 13885, "title": "Add Default Log Options to Search Client Builders", "bodyText": "Fixes #8686\nThis PR adds default log options to the Azure Cognitive Search client builders. The default log options add Azure Search specific headers and query parameters that are safe to log. In addition to adding default log options pipeline construction for client builders was centralized as all three used the same code.", "createdAt": "2020-08-07T20:21:12Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13885", "merged": true, "mergeCommit": {"oid": "a105ce581be4445da24a46515e702adacfe7a099"}, "closed": true, "closedAt": "2020-08-07T22:09:18Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8qSfigH2gAyNDY0ODAwMDYyOjY3ZDEwNmI5YjBmYTFmYTU5YmVlZTU2YTY2MDE1MGY1YmRkOGUzZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8rZR0AFqTQ2MzY1MjYxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "67d106b9b0fa1fa59beee56a660150f5bdd8e3e3", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/67d106b9b0fa1fa59beee56a660150f5bdd8e3e3", "committedDate": "2020-08-07T20:17:45Z", "message": "Add default log options to builders and move builder pipeline creation into a common method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTk3NTM4", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13885#pullrequestreview-463597538", "createdAt": "2020-08-07T20:38:53Z", "commit": {"oid": "67d106b9b0fa1fa59beee56a660150f5bdd8e3e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDozODo1M1rOG9nLXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDozODo1M1rOG9nLXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1ODIwNA==", "bodyText": "What's the reason of using Supplier here? The list has been loaded anyway which execute the class.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13885#discussion_r467258204", "createdAt": "2020-08-07T20:38:53Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/util/Utility.java", "diffHunk": "@@ -3,19 +3,51 @@\n \n package com.azure.search.documents.implementation.util;\n \n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersFromContextPolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n import com.azure.core.util.serializer.JacksonAdapter;\n import com.azure.core.util.serializer.SerializerAdapter;\n import com.azure.core.util.serializer.TypeReference;\n import com.azure.search.documents.implementation.serializer.SerializationUtil;\n import com.fasterxml.jackson.databind.ObjectMapper;\n \n+import java.util.ArrayList;\n+import java.util.List;\n import java.util.Map;\n \n public final class Utility {\n     // Type reference that used across many places. Have one copy here to minimize the memory.\n     public static final TypeReference<Map<String, Object>> MAP_STRING_OBJECT_TYPE_REFERENCE =\n         new TypeReference<Map<String, Object>>() { };\n \n+    private static final HttpLogOptions DEFAULT_LOG_OPTIONS = Constants.DEFAULT_LOG_OPTIONS_SUPPLIER.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67d106b9b0fa1fa59beee56a660150f5bdd8e3e3"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNjAwMTQz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13885#pullrequestreview-463600143", "createdAt": "2020-08-07T20:44:03Z", "commit": {"oid": "67d106b9b0fa1fa59beee56a660150f5bdd8e3e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo0NDowM1rOG9nS2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDo0NDowM1rOG9nS2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2MDEyMw==", "bodyText": "Whether to allow this seems not settle yet. Can we hide it first?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13885#discussion_r467260123", "createdAt": "2020-08-07T20:44:03Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/util/Constants.java", "diffHunk": "@@ -3,10 +3,43 @@\n \n package com.azure.search.documents.implementation.util;\n \n+import com.azure.core.http.policy.HttpLogOptions;\n+\n+import java.util.function.Supplier;\n+\n public class Constants {\n     public static final String ENUM_INTERNAL_ERROR_MSG = \"The enum does not exist in internally used model %s.\";\n     public static final String ENUM_EXTERNAL_ERROR_MSG = \"The enum does not exist in externally used model %s.\";\n \n     public static final String ABSTRACT_INTERNAL_ERROR_MSG = \"The subclass does not exist in internal used model %s.\";\n     public static final String ABSTRACT_EXTERNAL_ERROR_MSG = \"The subclass does not exist in external used model %s.\";\n+\n+    public static final Supplier<HttpLogOptions> DEFAULT_LOG_OPTIONS_SUPPLIER = () -> {\n+        HttpLogOptions logOptions = new HttpLogOptions();\n+\n+        logOptions.addAllowedHeaderName(\"Access-Control-Allow-Credentials\");\n+        logOptions.addAllowedHeaderName(\"Access-Control-Allow-Headers\");\n+        logOptions.addAllowedHeaderName(\"Access-Control-Allow-Methods\");\n+        logOptions.addAllowedHeaderName(\"Access-Control-Allow-Origin\");\n+        logOptions.addAllowedHeaderName(\"Access-Control-Expose-Headers\");\n+        logOptions.addAllowedHeaderName(\"Access-Control-Max-Age\");\n+        logOptions.addAllowedHeaderName(\"Access-Control-Request-Headers\");\n+        logOptions.addAllowedHeaderName(\"Access-Control-Request-Method\");\n+        logOptions.addAllowedHeaderName(\"client-request-id\");\n+        logOptions.addAllowedHeaderName(\"elapsed-time\");\n+        logOptions.addAllowedHeaderName(\"Location\");\n+        logOptions.addAllowedHeaderName(\"OData-MaxVersion\");\n+        logOptions.addAllowedHeaderName(\"OData-Version\");\n+        logOptions.addAllowedHeaderName(\"Origin\");\n+        logOptions.addAllowedHeaderName(\"Prefer\");\n+        logOptions.addAllowedHeaderName(\"request-id\");\n+        logOptions.addAllowedHeaderName(\"return-client-request-id\");\n+        logOptions.addAllowedHeaderName(\"throttle-reason\");\n+\n+        logOptions.addAllowedQueryParamName(\"api-version\");\n+        logOptions.addAllowedQueryParamName(\"allowIndexDowntime\");\n+        logOptions.addAllowedQueryParamName(\"$select\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67d106b9b0fa1fa59beee56a660150f5bdd8e3e3"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c7a474402018aa6a4753f101b7041c13d354bed", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8c7a474402018aa6a4753f101b7041c13d354bed", "committedDate": "2020-08-07T21:02:08Z", "message": "Remove select from the allowed query parameters list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNjUyNjE1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13885#pullrequestreview-463652615", "createdAt": "2020-08-07T21:35:04Z", "commit": {"oid": "8c7a474402018aa6a4753f101b7041c13d354bed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 867, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}