{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0NjY5Nzc2", "number": 18332, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMDowMjowNVrOFIy7LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMDowNTo1OFrOFIy9SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NzY3Mjc2OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-webapp/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMDowMjowNVrOIK7H7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMDowMjowNVrOIK7H7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMyNTM1Ng==", "bodyText": "Mistake here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18332#discussion_r548325356", "createdAt": "2020-12-24T00:02:05Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-webapp/README.md", "diffHunk": "@@ -19,16 +19,16 @@ Follow the guide [here](https://docs.microsoft.com/azure/active-directory/develo\n - Ensure **Access tokens** and **ID tokens** are selected.\n - To use on-demand authorization of certain resource, you need to add redirect URIs of `http://localhost:8080/login/oauth2/code/{registration-id}`. In this sample, set redirect URIs with `http://localhost:8080/login/oauth2/code/arm`.\n ### Configure necessary API permissions\n-The sample retrieves user's group memberships using Microsoft graph API which requires the registered app to have `Directory.AccessAsUser.All` permission under `Delegated Permissions` of `Microsoft Graph`, which can allow an application to access the directory as the signed-in user. Also, to display the function of calling multiple resources, this sample will acquire `ActivityFeed.Read` permission under `Office 365 Management APIs` resource. You need AAD admin privilege to be able to grant the permission in API ACCESS -> Required permission. You can follow the below steps:\t\n+The sample retrieves user's group memberships using Microsoft graph API which requires the registered app to have `Directory.AccessAsUser.All`, `User.Read` permission under `Delegated Permissions` of `Microsoft Graph`, which can allow an application to access the directory as the signed-in user. Also, to display the function of calling multiple resources, this sample will acquire `ActivityFeed.Read`, `ActivityFeed.ReadDlp`, `ServiceHealth.Read` permission under `Office 365 Management APIs` resource. You need AAD admin privilege to be able to grant the permission in API ACCESS -> Required permission. You can follow the below steps:\t\n \n * In the list of pages for the app, select **API permissions**\t\n    - Click the **Add a permission** button\t\n    - Ensure that the **Microsoft APIs** tab is selected\t\n    - In the *Commonly used Microsoft APIs* section, click on **Microsoft Graph**\t\n-   - In the **Delegated permissions** section, ensure that the right permissions are checked: **Directory.AccessAsUser.All**\t\n+   - In the **Delegated permissions** section, ensure that the right permissions are checked: **Directory.AccessAsUser.All**, **ActivityFeed.ReadDlp**, **ServiceHealth.Read**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f51d0c69491ca72833c7028eee9fd03dcb3b71d"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NzY3NTU2OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-webapp/src/main/resources/application.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMDowNDoxOFrOIK7JdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMDowNDoxOFrOIK7JdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMyNTc0OQ==", "bodyText": "Please set according to this image:", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18332#discussion_r548325749", "createdAt": "2020-12-24T00:04:18Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-webapp/src/main/resources/application.yml", "diffHunk": "@@ -5,9 +5,14 @@ azure:\n         on-demand: true\n         scopes: https://management.core.windows.net/user_impersonation\n       graph:\n-        scopes: https://graph.microsoft.com/Calendars.Read\n+        scopes:\n+            - https://graph.microsoft.com/Calendars.Read", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f51d0c69491ca72833c7028eee9fd03dcb3b71d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NzY3ODE3OnYy", "diffSide": "RIGHT", "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/converter/AccessTokenScopesIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMDowNTo1OFrOIK7KwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMToxNzowMFrOIK8Adg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMyNjA4MA==", "bodyText": "So azure's scope is always same to graph's?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18332#discussion_r548326080", "createdAt": "2020-12-24T00:05:58Z", "author": {"login": "chenrujun"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/converter/AccessTokenScopesIT.java", "diffHunk": "@@ -18,29 +18,33 @@\n \n import java.util.*;\n \n-public class RefreshTokenScopesIT {\n+public class AccessTokenScopesIT {\n \n     @Test\n     public void testRefreshTokenConverter() {\n         try (AppRunner app = new AppRunner(DumbApp.class)) {\n             SeleniumTestUtils.addProperty(app);\n-            app.property(\"azure.activedirectory.authorization.office.scopes\", \"https://manage.office.com/ActivityFeed.Read\");\n-            app.property(\"azure.activedirectory.authorization.graph.scopes\", \"https://graph.microsoft.com/User.Read\");\n+            app.property(\"azure.activedirectory.authorization.office.scopes\", \"https://manage.office.com/ActivityFeed.Read , https://manage.office.com/ActivityFeed.ReadDlp , https://manage.office.com/ServiceHealth.Read\");\n+            app.property(\"azure.activedirectory.authorization.graph.scopes\", \"https://graph.microsoft.com/User.Read , https://graph.microsoft.com/AccessReview.Read.All\");\n             List<String> endPoints = new ArrayList<>();\n-            endPoints.add(\"api/office\");\n-            endPoints.add(\"api/azure\");\n-            endPoints.add(\"api/graph\");\n-            endPoints.add(\"api/arm\");\n+            endPoints.add(\"accessTokenScopes/office\");\n+            endPoints.add(\"accessTokenScopes/azure\");\n+            endPoints.add(\"accessTokenScopes/graph\");\n+            endPoints.add(\"accessTokenScopes/arm\");\n             Map<String, String> result = SeleniumTestUtils.get(app, endPoints);\n \n-            Assert.assertFalse(result.get(\"api/office\").contains(\"profile\"));\n-            Assert.assertTrue(result.get(\"api/office\").contains(\"https://manage.office.com/ActivityFeed.Read\"));\n+            Assert.assertFalse(result.get(\"accessTokenScopes/office\").contains(\"profile\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/office\").contains(\"https://manage.office.com/ActivityFeed.Read\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/office\").contains(\"https://manage.office.com/ActivityFeed.ReadDlp\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/office\").contains(\"https://manage.office.com/ServiceHealth.Read\"));\n \n-            Assert.assertTrue(result.get(\"api/azure\").contains(\"profile\"));\n-            Assert.assertTrue(result.get(\"api/azure\").contains(\"https://graph.microsoft.com/User.Read\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/azure\").contains(\"profile\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/azure\").contains(\"https://graph.microsoft.com/AccessReview.Read.All\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/azure\").contains(\"https://graph.microsoft.com/User.Read\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f51d0c69491ca72833c7028eee9fd03dcb3b71d"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMzOTgzMA==", "bodyText": "The scopes of each client of the same resource is the same", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18332#discussion_r548339830", "createdAt": "2020-12-24T01:17:00Z", "author": {"login": "zhichengliu12581"}, "path": "sdk/spring/azure-spring-boot-test-aad/src/test/java/com/azure/test/aad/converter/AccessTokenScopesIT.java", "diffHunk": "@@ -18,29 +18,33 @@\n \n import java.util.*;\n \n-public class RefreshTokenScopesIT {\n+public class AccessTokenScopesIT {\n \n     @Test\n     public void testRefreshTokenConverter() {\n         try (AppRunner app = new AppRunner(DumbApp.class)) {\n             SeleniumTestUtils.addProperty(app);\n-            app.property(\"azure.activedirectory.authorization.office.scopes\", \"https://manage.office.com/ActivityFeed.Read\");\n-            app.property(\"azure.activedirectory.authorization.graph.scopes\", \"https://graph.microsoft.com/User.Read\");\n+            app.property(\"azure.activedirectory.authorization.office.scopes\", \"https://manage.office.com/ActivityFeed.Read , https://manage.office.com/ActivityFeed.ReadDlp , https://manage.office.com/ServiceHealth.Read\");\n+            app.property(\"azure.activedirectory.authorization.graph.scopes\", \"https://graph.microsoft.com/User.Read , https://graph.microsoft.com/AccessReview.Read.All\");\n             List<String> endPoints = new ArrayList<>();\n-            endPoints.add(\"api/office\");\n-            endPoints.add(\"api/azure\");\n-            endPoints.add(\"api/graph\");\n-            endPoints.add(\"api/arm\");\n+            endPoints.add(\"accessTokenScopes/office\");\n+            endPoints.add(\"accessTokenScopes/azure\");\n+            endPoints.add(\"accessTokenScopes/graph\");\n+            endPoints.add(\"accessTokenScopes/arm\");\n             Map<String, String> result = SeleniumTestUtils.get(app, endPoints);\n \n-            Assert.assertFalse(result.get(\"api/office\").contains(\"profile\"));\n-            Assert.assertTrue(result.get(\"api/office\").contains(\"https://manage.office.com/ActivityFeed.Read\"));\n+            Assert.assertFalse(result.get(\"accessTokenScopes/office\").contains(\"profile\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/office\").contains(\"https://manage.office.com/ActivityFeed.Read\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/office\").contains(\"https://manage.office.com/ActivityFeed.ReadDlp\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/office\").contains(\"https://manage.office.com/ServiceHealth.Read\"));\n \n-            Assert.assertTrue(result.get(\"api/azure\").contains(\"profile\"));\n-            Assert.assertTrue(result.get(\"api/azure\").contains(\"https://graph.microsoft.com/User.Read\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/azure\").contains(\"profile\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/azure\").contains(\"https://graph.microsoft.com/AccessReview.Read.All\"));\n+            Assert.assertTrue(result.get(\"accessTokenScopes/azure\").contains(\"https://graph.microsoft.com/User.Read\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMyNjA4MA=="}, "originalCommit": {"oid": "7f51d0c69491ca72833c7028eee9fd03dcb3b71d"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2504, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}