{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NTY0ODQ3", "number": 8774, "title": "Reliable download fix", "bodyText": "", "createdAt": "2020-03-06T00:15:17Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8774", "merged": true, "mergeCommit": {"oid": "72c0d5d3d1369adb47347c6acc6a5fe9e8a3c5f7"}, "closed": true, "closedAt": "2020-03-06T18:44:39Z", "author": {"login": "rickle-msft"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKfW-ygH2gAyMzg0NTY0ODQ3OjYzMThiOTkyY2NlYzFiYzgyNTVmMGJjNGQ4OGQyMjNjZjMxZjU5ODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLEoYzgFqTM3MDU0MzY5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6318b992ccec1bc8255f0bc4d88d223cf31f5981", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6318b992ccec1bc8255f0bc4d88d223cf31f5981", "committedDate": "2020-03-04T23:17:29Z", "message": "Fixed a bug in reliable download and added support for timeout exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c20b9474f188c99153e1aec702e28e23d94a666", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3c20b9474f188c99153e1aec702e28e23d94a666", "committedDate": "2020-03-05T23:50:24Z", "message": "Added timeouts to reliable download stream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3601af0145328f41dfb93e458b3cdf03beda1287", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/3601af0145328f41dfb93e458b3cdf03beda1287", "committedDate": "2020-03-06T00:14:57Z", "message": "Minor updates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDExMTc3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8774#pullrequestreview-370011177", "createdAt": "2020-03-06T00:41:25Z", "commit": {"oid": "3601af0145328f41dfb93e458b3cdf03beda1287"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf6928a58b7789403545cbea21c0aee5211e9abe", "author": {"user": {"login": "rickle-msft", "name": "Rick Ley"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bf6928a58b7789403545cbea21c0aee5211e9abe", "committedDate": "2020-03-06T00:45:45Z", "message": "Checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDk4MDAz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8774#pullrequestreview-370098003", "createdAt": "2020-03-06T06:02:17Z", "commit": {"oid": "bf6928a58b7789403545cbea21c0aee5211e9abe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNjowMjoxN1rOFyt-Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNjowMjoxN1rOFyt-Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNjM1MQ==", "bodyText": "So the retryCount is global for the Download not per read() invocation?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8774#discussion_r388726351", "createdAt": "2020-03-06T06:02:17Z", "author": {"login": "anuchandy"}, "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/specialized/ReliableDownload.java", "diffHunk": "@@ -67,15 +70,16 @@ BlobDownloadHeaders getDeserializedHeaders() {\n         add 1 before calling into tryContinueFlux, we set the initial value to -1.\n          */\n         Flux<ByteBuffer> value = (options.getMaxRetryRequests() == 0)\n-            ? rawResponse.getValue()\n+            ? rawResponse.getValue().timeout(TIMEOUT_VALUE)\n             : applyReliableDownload(rawResponse.getValue(), -1, options);\n \n         return value.switchIfEmpty(Flux.just(ByteBuffer.wrap(new byte[0])));\n     }\n \n     private Flux<ByteBuffer> tryContinueFlux(Throwable t, int retryCount, DownloadRetryOptions options) {\n-        // If all the errors are exhausted, return this error to the user.\n-        if (retryCount > options.getMaxRetryRequests() || !(t instanceof IOException)) {\n+        // If all the errors are exhausted or the error is not retryable, return this error to the user.\n+        if (retryCount >= options.getMaxRetryRequests()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf6928a58b7789403545cbea21c0aee5211e9abe"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNTQzNjkx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8774#pullrequestreview-370543691", "createdAt": "2020-03-06T18:42:59Z", "commit": {"oid": "bf6928a58b7789403545cbea21c0aee5211e9abe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 912, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}