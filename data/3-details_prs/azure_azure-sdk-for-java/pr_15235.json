{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NjEwMjUz", "number": 15235, "title": "Fix send span to encapsulate multiple retries and use shared context", "bodyText": "Currently, the send and message spans were not using the shared context of parent span so resulting in individual spans on the UI.\nAlso, fixes single send span for multiple retry attempts.", "createdAt": "2020-09-15T22:19:46Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15235", "merged": true, "mergeCommit": {"oid": "6e4755c357df8ddab9fba4c957e3a9ea293cb55a"}, "closed": true, "closedAt": "2020-10-08T23:09:51Z", "author": {"login": "samvaity"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJPjT_AFqTQ4OTE1MTY2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQWsGLAH2gAyNDg3NjEwMjUzOmMzZGI1YmFkNjYxN2U1NTNlYzFkYjBmYmVhNzI5YmM1OWNlYTNjODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTUxNjYz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15235#pullrequestreview-489151663", "createdAt": "2020-09-15T22:29:41Z", "commit": {"oid": "6b363cb22e33d5645fb7dac2eae7fae5d2f03a18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjoyOTo0MlrOHSYGAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjoyOTo0MlrOHSYGAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAzMTE3MA==", "bodyText": "Do we have a ClientConstants in SB to put this?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15235#discussion_r489031170", "createdAt": "2020-09-15T22:29:42Z", "author": {"login": "samvaity"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusSenderAsyncClient.java", "diffHunk": "@@ -74,6 +75,9 @@\n      */\n     static final int MAX_MESSAGE_LENGTH_BYTES = 256 * 1024;\n     private static final String TRANSACTION_LINK_NAME = \"coordinator\";\n+    // Please see <a href=https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/azure-services-resource-providers>here</a>\n+    // for more information on Azure resource provider namespaces.\n+    private static final String AZ_TRACING_NAMESPACE_VALUE = \"Microsoft.ServiceBus\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b363cb22e33d5645fb7dac2eae7fae5d2f03a18"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTUyNDI1", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15235#pullrequestreview-489152425", "createdAt": "2020-09-15T22:31:28Z", "commit": {"oid": "6b363cb22e33d5645fb7dac2eae7fae5d2f03a18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjozMToyOFrOHSYLXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjozMToyOFrOHSYLXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAzMjU0Mg==", "bodyText": "For the entityPath and hostName values, do we want to update the ServiceBusSenderAsyncClient or we should be able to retrieve it some other way?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15235#discussion_r489032542", "createdAt": "2020-09-15T22:31:28Z", "author": {"login": "samvaity"}, "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusSenderAsyncClient.java", "diffHunk": "@@ -495,17 +499,19 @@ public void close() {\n             messages.add(message);\n         }\n \n-        final Context finalSharedContext = sharedContext != null ? sharedContext : Context.NONE;\n+        if (isTracingEnabled) {\n+            final Context finalSharedContext = sharedContext == null\n+                ? Context.NONE\n+                : sharedContext\n+                    .addData(ENTITY_PATH_KEY, \"entityPath\")\n+                    .addData(HOST_NAME_KEY, \"hostName\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b363cb22e33d5645fb7dac2eae7fae5d2f03a18"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b363cb22e33d5645fb7dac2eae7fae5d2f03a18", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6b363cb22e33d5645fb7dac2eae7fae5d2f03a18", "committedDate": "2020-09-15T22:16:28Z", "message": "Fix send span multiple send attempts"}, "afterCommit": {"oid": "f99589d2244e83a698936edd89a52ab66fa42e3e", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f99589d2244e83a698936edd89a52ab66fa42e3e", "committedDate": "2020-09-15T22:34:59Z", "message": "Fix send span multiple send attempts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d173f6c333f79fb14bea1b3ff5ee89b110294c33", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d173f6c333f79fb14bea1b3ff5ee89b110294c33", "committedDate": "2020-09-22T08:03:25Z", "message": "update service name and add tests"}, "afterCommit": {"oid": "a972ab41cdc3c8ff974392eaa6610d36b56e2853", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a972ab41cdc3c8ff974392eaa6610d36b56e2853", "committedDate": "2020-09-22T08:05:42Z", "message": "update service name and add tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a972ab41cdc3c8ff974392eaa6610d36b56e2853", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a972ab41cdc3c8ff974392eaa6610d36b56e2853", "committedDate": "2020-09-22T08:05:42Z", "message": "update service name and add tests"}, "afterCommit": {"oid": "c5e34691a8bb3e184c972f4515f956a05b05f66f", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c5e34691a8bb3e184c972f4515f956a05b05f66f", "committedDate": "2020-09-22T20:46:25Z", "message": "update service name and add tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8223b9455b04c0611e145c7fdacc17609d655aa0", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8223b9455b04c0611e145c7fdacc17609d655aa0", "committedDate": "2020-09-23T00:05:20Z", "message": "add eventhub changes"}, "afterCommit": {"oid": "fbf62d9e7adda63db373c39d3437e5101cf53cc0", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fbf62d9e7adda63db373c39d3437e5101cf53cc0", "committedDate": "2020-09-23T01:19:39Z", "message": "add eventhub changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTU2ODA2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15235#pullrequestreview-496556806", "createdAt": "2020-09-25T16:06:36Z", "commit": {"oid": "fbf62d9e7adda63db373c39d3437e5101cf53cc0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjowNjozNlrOHYJ0TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjowNjozNlrOHYJ0TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4ODcxNg==", "bodyText": "Does this break Event Hubs?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15235#discussion_r495088716", "createdAt": "2020-09-25T16:06:36Z", "author": {"login": "conniey"}, "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/implementation/TracerProvider.java", "diffHunk": "@@ -33,17 +33,18 @@ public boolean isEnabled() {\n      * new span will be added as a child, otherwise the span will be created and added to the context and any downstream\n      * start calls will use the created span as the parent.\n      *\n+     * @param serviceBaseName the service name to be appended to the span name.\n      * @param context Additional metadata that is passed through the call stack.\n      * @param processKind the invoking process type.\n      * @return An updated context object.\n      */\n-    public Context startSpan(Context context, ProcessKind processKind) {\n+    public Context startSpan(String serviceBaseName, Context context, ProcessKind processKind) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbf62d9e7adda63db373c39d3437e5101cf53cc0"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNDI1OTE3", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15235#pullrequestreview-503425917", "createdAt": "2020-10-06T23:23:37Z", "commit": {"oid": "fbf62d9e7adda63db373c39d3437e5101cf53cc0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9f36e8bcc565ab3869744ee19a1962e2249e173", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/a9f36e8bcc565ab3869744ee19a1962e2249e173", "committedDate": "2020-10-08T00:37:41Z", "message": "Fix send span multiple send attempts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0768e043480cafffdec2b81d1996a49a5b3a4917", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0768e043480cafffdec2b81d1996a49a5b3a4917", "committedDate": "2020-10-08T00:42:15Z", "message": "update service name and add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b56f25d51300b79dd304940a13cbfd0ff20e892", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/8b56f25d51300b79dd304940a13cbfd0ff20e892", "committedDate": "2020-10-08T00:43:31Z", "message": "remove duplicate dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb69eadf39dd06207b1a38dd5d8cdb09dda47be8", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bb69eadf39dd06207b1a38dd5d8cdb09dda47be8", "committedDate": "2020-10-08T00:43:51Z", "message": "add eventhub changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbf62d9e7adda63db373c39d3437e5101cf53cc0", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fbf62d9e7adda63db373c39d3437e5101cf53cc0", "committedDate": "2020-09-23T01:19:39Z", "message": "add eventhub changes"}, "afterCommit": {"oid": "bb69eadf39dd06207b1a38dd5d8cdb09dda47be8", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/bb69eadf39dd06207b1a38dd5d8cdb09dda47be8", "committedDate": "2020-10-08T00:43:51Z", "message": "add eventhub changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3db5bad6617e553ec1db0fbea729bc59cea3c84", "author": {"user": {"login": "samvaity", "name": "Sameeksha Vaity"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c3db5bad6617e553ec1db0fbea729bc59cea3c84", "committedDate": "2020-10-08T00:46:06Z", "message": "rebase conflict"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3342, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}