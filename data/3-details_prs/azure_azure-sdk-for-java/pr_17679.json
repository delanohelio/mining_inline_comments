{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNzMwMjM0", "number": 17679, "title": "Mgmt-Lite: add automation script", "bodyText": "Add script for SDK automation for java and Fluent Lite generation yml for azure devops.", "createdAt": "2020-11-19T07:11:29Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679", "merged": true, "mergeCommit": {"oid": "5f6d50b6d145d4571d2a9767f79e3e2e01f3fe26"}, "closed": true, "closedAt": "2020-11-23T05:58:58Z", "author": {"login": "ChenTanyi"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdd9W1DgH2gAyNTIzNzMwMjM0OmFkNjQzNmM1ZDE3ODMxMWQ1YjNmY2QxNTdmZjMyNmU0NmQ0ZDFhZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfMj-1gFqTUzNjE2MDU2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ad6436c5d178311d5b3fcd157ff326e46d4d1afa", "committedDate": "2020-11-19T07:10:11Z", "message": "add automation script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0OTgxNzg2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#pullrequestreview-534981786", "createdAt": "2020-11-20T00:14:09Z", "commit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNDowOVrOH23Kxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNDowOVrOH23Kxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI4OTAzMA==", "bodyText": "This looks a little off. Why would you need maven in the key twice?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#discussion_r527289030", "createdAt": "2020-11-20T00:14:09Z", "author": {"login": "weshaggard"}, "path": "eng/mgmt/automation/generation.yml", "diffHunk": "@@ -0,0 +1,61 @@\n+trigger: none\n+\n+pr: none\n+\n+pool:\n+  vmImage: 'ubuntu-18.04'\n+\n+variables:\n+  MAVEN_CACHE_FOLDER: $(Pipeline.Workspace)/.m2/repository\n+  MAVEN_OPTS: '-Dmaven.repo.local=$(MAVEN_CACHE_FOLDER)'\n+  NodeVersion: '14.x'\n+\n+steps:\n+- task: Cache@2\n+  inputs:\n+    key: 'maven | \"$(Agent.OS)\" | **/pom.xml'\n+    restoreKeys: |\n+      maven | \"$(Agent.OS)\"\n+      maven", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0OTgxOTEx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#pullrequestreview-534981911", "createdAt": "2020-11-20T00:14:28Z", "commit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNDoyOVrOH23L8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNDoyOVrOH23L8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI4OTMzMQ==", "bodyText": "Is the maven cache that interesting for this pipeline?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#discussion_r527289331", "createdAt": "2020-11-20T00:14:29Z", "author": {"login": "weshaggard"}, "path": "eng/mgmt/automation/generation.yml", "diffHunk": "@@ -0,0 +1,61 @@\n+trigger: none\n+\n+pr: none\n+\n+pool:\n+  vmImage: 'ubuntu-18.04'\n+\n+variables:\n+  MAVEN_CACHE_FOLDER: $(Pipeline.Workspace)/.m2/repository\n+  MAVEN_OPTS: '-Dmaven.repo.local=$(MAVEN_CACHE_FOLDER)'\n+  NodeVersion: '14.x'\n+\n+steps:\n+- task: Cache@2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0OTgyMjg0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#pullrequestreview-534982284", "createdAt": "2020-11-20T00:15:28Z", "commit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNToyOFrOH23PbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNToyOFrOH23PbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI5MDIyMA==", "bodyText": "I recommend not setting these globally and only doing it as part of the commit command. See https://github.com/Azure/azure-sdk-tools/blob/master/eng/common/scripts/git-branch-push.ps1#L79 as an example.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#discussion_r527290220", "createdAt": "2020-11-20T00:15:28Z", "author": {"login": "weshaggard"}, "path": "eng/mgmt/automation/generation.yml", "diffHunk": "@@ -0,0 +1,61 @@\n+trigger: none\n+\n+pr: none\n+\n+pool:\n+  vmImage: 'ubuntu-18.04'\n+\n+variables:\n+  MAVEN_CACHE_FOLDER: $(Pipeline.Workspace)/.m2/repository\n+  MAVEN_OPTS: '-Dmaven.repo.local=$(MAVEN_CACHE_FOLDER)'\n+  NodeVersion: '14.x'\n+\n+steps:\n+- task: Cache@2\n+  inputs:\n+    key: 'maven | \"$(Agent.OS)\" | **/pom.xml'\n+    restoreKeys: |\n+      maven | \"$(Agent.OS)\"\n+      maven\n+    path: $(MAVEN_CACHE_FOLDER)\n+  displayName: Cache Maven local repo\n+\n+- bash: |\n+    git config --global user.name \"Azure-Fluent\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0OTgyNTE0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#pullrequestreview-534982514", "createdAt": "2020-11-20T00:16:01Z", "commit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNjowMlrOH23ROg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNjowMlrOH23ROg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI5MDY4Mg==", "bodyText": "When do you expect someone to call this pipeline over just using the sdk automation?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#discussion_r527290682", "createdAt": "2020-11-20T00:16:02Z", "author": {"login": "weshaggard"}, "path": "eng/mgmt/automation/generation.yml", "diffHunk": "@@ -0,0 +1,61 @@\n+trigger: none", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0OTgyOTc0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#pullrequestreview-534982974", "createdAt": "2020-11-20T00:17:05Z", "commit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNzowNlrOH23Utw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoxNzowNlrOH23Utw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI5MTU3NQ==", "bodyText": "I don't think this is necessary to set this in env var given you are passing it as part of the URL.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#discussion_r527291575", "createdAt": "2020-11-20T00:17:06Z", "author": {"login": "weshaggard"}, "path": "eng/mgmt/automation/generation.yml", "diffHunk": "@@ -0,0 +1,61 @@\n+trigger: none\n+\n+pr: none\n+\n+pool:\n+  vmImage: 'ubuntu-18.04'\n+\n+variables:\n+  MAVEN_CACHE_FOLDER: $(Pipeline.Workspace)/.m2/repository\n+  MAVEN_OPTS: '-Dmaven.repo.local=$(MAVEN_CACHE_FOLDER)'\n+  NodeVersion: '14.x'\n+\n+steps:\n+- task: Cache@2\n+  inputs:\n+    key: 'maven | \"$(Agent.OS)\" | **/pom.xml'\n+    restoreKeys: |\n+      maven | \"$(Agent.OS)\"\n+      maven\n+    path: $(MAVEN_CACHE_FOLDER)\n+  displayName: Cache Maven local repo\n+\n+- bash: |\n+    git config --global user.name \"Azure-Fluent\"\n+    git config --global user.email \"azfluent@microsoft.com\"\n+  displayName: Base Config\n+\n+- bash: |\n+    sudo apt-get install -y --upgrade python3-pip python3-setuptools\n+    pip3 install --upgrade wheel\n+    pip3 install --upgrade PyYAML\n+  displayName: Update python\n+\n+- task: NodeTool@0\n+  displayName: 'Install Node.js $(NodeVersion)'\n+  inputs:\n+    versionSpec: '$(NodeVersion)'\n+\n+- bash: |\n+    npm install -g autorest\n+    npm install\n+  displayName: 'Install autorest'\n+\n+- bash: |\n+    export PATH=$JAVA_HOME_11_X64/bin:$PATH\n+    java -version\n+    ./eng/mgmt/automation/generate.py --readme \"$(README)\" --tag \"$(TAG)\" --service \"$(SERVICE)\" --version \"$(VERSION)\" --auto-commit-generated-code\n+  displayName: Generation and Compile\n+\n+- bash: |\n+    export MESSAGE=\"[Automation] Generate Fluent Lite from $(README)#$(TAG)\"\n+    export BRANCH=\"Fluent-lite-generation-$(Build.BuildId)\"\n+    git add -A\n+    git commit -m \"[Automation] Update other files outside generation folder\"\n+    git log -2\n+    git push https://$(GITHUB_TOKEN)@github.com/azure-fluent/azure-sdk-for-java HEAD:refs/heads/$BRANCH -f\n+    python3 eng/mgmt/pull-request.py chentanyi azure-sdk-for-java \"$MESSAGE\" \"azure-fluent:$BRANCH\"\n+  displayName: Create pull request\n+  env:\n+    GITHUB_TOKEN: $(GITHUB_TOKEN)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0OTg0Mjcw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#pullrequestreview-534984270", "createdAt": "2020-11-20T00:20:36Z", "commit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoyMDozNlrOH23gyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMDoyMDozNlrOH23gyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI5NDY2Ng==", "bodyText": "orthogonal but it would be good for use to use the shared code to submit pull requests, see https://github.com/Azure/azure-sdk-for-java/blob/master/eng/common/pipelines/templates/steps/create-pull-request.yml.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#discussion_r527294666", "createdAt": "2020-11-20T00:20:36Z", "author": {"login": "weshaggard"}, "path": "eng/mgmt/automation/generation.yml", "diffHunk": "@@ -0,0 +1,61 @@\n+trigger: none\n+\n+pr: none\n+\n+pool:\n+  vmImage: 'ubuntu-18.04'\n+\n+variables:\n+  MAVEN_CACHE_FOLDER: $(Pipeline.Workspace)/.m2/repository\n+  MAVEN_OPTS: '-Dmaven.repo.local=$(MAVEN_CACHE_FOLDER)'\n+  NodeVersion: '14.x'\n+\n+steps:\n+- task: Cache@2\n+  inputs:\n+    key: 'maven | \"$(Agent.OS)\" | **/pom.xml'\n+    restoreKeys: |\n+      maven | \"$(Agent.OS)\"\n+      maven\n+    path: $(MAVEN_CACHE_FOLDER)\n+  displayName: Cache Maven local repo\n+\n+- bash: |\n+    git config --global user.name \"Azure-Fluent\"\n+    git config --global user.email \"azfluent@microsoft.com\"\n+  displayName: Base Config\n+\n+- bash: |\n+    sudo apt-get install -y --upgrade python3-pip python3-setuptools\n+    pip3 install --upgrade wheel\n+    pip3 install --upgrade PyYAML\n+  displayName: Update python\n+\n+- task: NodeTool@0\n+  displayName: 'Install Node.js $(NodeVersion)'\n+  inputs:\n+    versionSpec: '$(NodeVersion)'\n+\n+- bash: |\n+    npm install -g autorest\n+    npm install\n+  displayName: 'Install autorest'\n+\n+- bash: |\n+    export PATH=$JAVA_HOME_11_X64/bin:$PATH\n+    java -version\n+    ./eng/mgmt/automation/generate.py --readme \"$(README)\" --tag \"$(TAG)\" --service \"$(SERVICE)\" --version \"$(VERSION)\" --auto-commit-generated-code\n+  displayName: Generation and Compile\n+\n+- bash: |\n+    export MESSAGE=\"[Automation] Generate Fluent Lite from $(README)#$(TAG)\"\n+    export BRANCH=\"Fluent-lite-generation-$(Build.BuildId)\"\n+    git add -A\n+    git commit -m \"[Automation] Update other files outside generation folder\"\n+    git log -2\n+    git push https://$(GITHUB_TOKEN)@github.com/azure-fluent/azure-sdk-for-java HEAD:refs/heads/$BRANCH -f\n+    python3 eng/mgmt/pull-request.py chentanyi azure-sdk-for-java \"$MESSAGE\" \"azure-fluent:$BRANCH\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad6436c5d178311d5b3fcd157ff326e46d4d1afa"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccb6efcd2af88d6ad7f9aaa13b12ffd21ef9381a", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ccb6efcd2af88d6ad7f9aaa13b12ffd21ef9381a", "committedDate": "2020-11-20T07:55:24Z", "message": "update script and yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fffc2052bd749f9bcc5e8bd38831234f2b3416a6", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fffc2052bd749f9bcc5e8bd38831234f2b3416a6", "committedDate": "2020-11-23T02:43:16Z", "message": "not compile and cache in generation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92cc0306005d0db6a55a4e3343ecd39fe6c6adbe", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/92cc0306005d0db6a55a4e3343ecd39fe6c6adbe", "committedDate": "2020-11-23T03:07:44Z", "message": "auto commit external change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MTYwNTY2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17679#pullrequestreview-536160566", "createdAt": "2020-11-23T03:27:03Z", "commit": {"oid": "ccb6efcd2af88d6ad7f9aaa13b12ffd21ef9381a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1594, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}