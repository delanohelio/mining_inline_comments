{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MTg2NTU2", "number": 10368, "reviewThreads": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNzoyMzoxNFrOD1Y16g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOToyMDo0MFrOD4LLsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MzA4MTM4OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNzoyMzoxNFrOGKzhdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNzoyMzoxNFrOGKzhdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4MzA5NQ==", "bodyText": "add x version, and update external dep file.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r413983095", "createdAt": "2020-04-23T17:23:14Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/pom.xml", "diffHunk": "@@ -93,6 +93,12 @@\n       <version>2.8.5</version> <!-- {x-version-update;com.google.code.gson:gson;external_dependency} -->\n       <scope>test</scope>\n     </dependency>\n+\n+    <dependency>\n+      <groupId>com.microsoft.azure</groupId>\n+      <artifactId>msal4j-persistence-extension</artifactId>\n+      <version>0.1</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef3a2e7aa996dd9568b388d5b8728127a69b19e"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODI5MDYyOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredential.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzo0NDozNFrOGLiecg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzo1OTowMlrOGMwbrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1MjM3MA==", "bodyText": "This type shouldn't be public. For now we are adding these credential types to the DefaultAzureCredential authentication flow but not exposing the credential types directly.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414752370", "createdAt": "2020-04-24T17:44:34Z", "author": {"login": "schaabs"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredential.java", "diffHunk": "@@ -0,0 +1,56 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity;\n+\n+import com.azure.core.credential.AccessToken;\n+import com.azure.core.credential.TokenCredential;\n+import com.azure.core.credential.TokenRequestContext;\n+import com.azure.identity.implementation.IdentityClient;\n+import com.azure.identity.implementation.IdentityClientBuilder;\n+import com.azure.identity.implementation.IdentityClientOptions;\n+import com.azure.identity.implementation.MsalToken;\n+import reactor.core.publisher.Mono;\n+\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+/**\n+ * Enables authentication to Azure Active Directory using data from Visual Studio Code\n+ */\n+public class VisualStudioCodeCredential implements TokenCredential {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAyOTYxMg==", "bodyText": "Yeah, made it private.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416029612", "createdAt": "2020-04-27T17:59:02Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredential.java", "diffHunk": "@@ -0,0 +1,56 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity;\n+\n+import com.azure.core.credential.AccessToken;\n+import com.azure.core.credential.TokenCredential;\n+import com.azure.core.credential.TokenRequestContext;\n+import com.azure.identity.implementation.IdentityClient;\n+import com.azure.identity.implementation.IdentityClientBuilder;\n+import com.azure.identity.implementation.IdentityClientOptions;\n+import com.azure.identity.implementation.MsalToken;\n+import reactor.core.publisher.Mono;\n+\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+/**\n+ * Enables authentication to Azure Active Directory using data from Visual Studio Code\n+ */\n+public class VisualStudioCodeCredential implements TokenCredential {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1MjM3MA=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODI5NTA1OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredentialBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzo0NTo0OFrOGLihMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzo1OToxMlrOGMwcPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1MzA3NQ==", "bodyText": "Remove this builder type.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414753075", "createdAt": "2020-04-24T17:45:48Z", "author": {"login": "schaabs"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredentialBuilder.java", "diffHunk": "@@ -0,0 +1,35 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity;\n+\n+/**\n+ * Fluent credential builder for instantiating a {@link VisualStudioCodeCredential}.\n+ *\n+ * @see VisualStudioCodeCredential\n+ */\n+public class VisualStudioCodeCredentialBuilder extends CredentialBuilderBase<DefaultAzureCredentialBuilder> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAyOTc1OQ==", "bodyText": "removed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416029759", "createdAt": "2020-04-27T17:59:12Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredentialBuilder.java", "diffHunk": "@@ -0,0 +1,35 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity;\n+\n+/**\n+ * Fluent credential builder for instantiating a {@link VisualStudioCodeCredential}.\n+ *\n+ * @see VisualStudioCodeCredential\n+ */\n+public class VisualStudioCodeCredentialBuilder extends CredentialBuilderBase<DefaultAzureCredentialBuilder> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1MzA3NQ=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODMxMTcwOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzo0OTo0NFrOGLiqxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjowNDoyM1rOGOSulg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1NTUyNA==", "bodyText": "The authority has to be configurable why is this hard-coded to public cloud? Also I think it should append EITHER '/organizations/' OR tenantId. At least that's what we do in other languages. Have you confirmed that /orginizations/ actually works?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414755524", "createdAt": "2020-04-24T17:49:44Z", "author": {"login": "schaabs"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +434,85 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = KnownAuthorityHosts.AZURE_CLOUD.replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1ODkxNQ==", "bodyText": "To be more precise here the authority should be determined by the azure.cloud vscode setting, and the tenantId should use whatever was passed in through code, or if not specified default to the vscode setting.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414758915", "createdAt": "2020-04-24T17:55:26Z", "author": {"login": "schaabs"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +434,85 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = KnownAuthorityHosts.AZURE_CLOUD.replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1NTUyNA=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAzMDE0Mw==", "bodyText": "Yep, added the logic to support multiple clouds in both VScode + IntelliJ creds.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416030143", "createdAt": "2020-04-27T17:59:49Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +434,85 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = KnownAuthorityHosts.AZURE_CLOUD.replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1NTUyNA=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY0MDA4Ng==", "bodyText": "/organizations/ + tenantid\nworks well.\ntenantId is either user passed or \"common\"\nShould I follow Either strategy ? to align with other languages ?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417640086", "createdAt": "2020-04-29T22:04:23Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +434,85 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = KnownAuthorityHosts.AZURE_CLOUD.replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1NTUyNA=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODMxOTI2OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzo1MTozOFrOGLivPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxODowMDoxMFrOGMwesQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1NjY3MA==", "bodyText": "In .NET we don't handle the case where the authorization code is stored, only the case where the stored value is a refresh token. We should align this.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414756670", "createdAt": "2020-04-24T17:51:38Z", "author": {"login": "schaabs"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +434,85 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = KnownAuthorityHosts.AZURE_CLOUD.replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;\n+        PublicClientApplication.Builder publicClientApplicationBuilder = PublicClientApplication.builder(clientId);\n+        if (httpPipelineAdapter != null) {\n+            publicClientApplicationBuilder.httpClient(httpPipelineAdapter);\n+        } else if (options.getProxyOptions() != null) {\n+            publicClientApplicationBuilder.proxy(proxyOptionsToJavaNetProxy(options.getProxyOptions()));\n+        }\n+\n+        try {\n+            ObjectMapper mapper = new ObjectMapper();\n+            JsonNode parsedCredentials = mapper.readTree(credential);\n+            String redirectUri = parsedCredentials.get(\"redirectionUrl\").asText();\n+            String authorizationCode = parsedCredentials.get(\"code\").asText();\n+\n+            AuthorizationCodeParameters authorizationCodeParameters = AuthorizationCodeParameters\n+                .builder(authorizationCode, new URI(redirectUri))\n+                .scopes(new HashSet<>(request.getScopes()))\n+                .build();\n+\n+            PublicClientApplication application = publicClientApplicationBuilder.authority(authority).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAzMDM4NQ==", "bodyText": "removed", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416030385", "createdAt": "2020-04-27T18:00:10Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +434,85 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = KnownAuthorityHosts.AZURE_CLOUD.replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;\n+        PublicClientApplication.Builder publicClientApplicationBuilder = PublicClientApplication.builder(clientId);\n+        if (httpPipelineAdapter != null) {\n+            publicClientApplicationBuilder.httpClient(httpPipelineAdapter);\n+        } else if (options.getProxyOptions() != null) {\n+            publicClientApplicationBuilder.proxy(proxyOptionsToJavaNetProxy(options.getProxyOptions()));\n+        }\n+\n+        try {\n+            ObjectMapper mapper = new ObjectMapper();\n+            JsonNode parsedCredentials = mapper.readTree(credential);\n+            String redirectUri = parsedCredentials.get(\"redirectionUrl\").asText();\n+            String authorizationCode = parsedCredentials.get(\"code\").asText();\n+\n+            AuthorizationCodeParameters authorizationCodeParameters = AuthorizationCodeParameters\n+                .builder(authorizationCode, new URI(redirectUri))\n+                .scopes(new HashSet<>(request.getScopes()))\n+                .build();\n+\n+            PublicClientApplication application = publicClientApplicationBuilder.authority(authority).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1NjY3MA=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODQxNTU5OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/WindowsCredentialApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoxNTozOVrOGLjnjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjoxMTo1MVrOGOGXqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MTA4Nw==", "bodyText": "Why are classnames uppercase?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414771087", "createdAt": "2020-04-24T18:15:39Z", "author": {"login": "srnagar"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/WindowsCredentialApi.java", "diffHunk": "@@ -0,0 +1,294 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.sun.jna.Pointer;\n+import com.sun.jna.Memory;\n+import com.sun.jna.LastErrorException;\n+import com.sun.jna.Structure;\n+import com.sun.jna.platform.win32.WinBase;\n+import com.sun.jna.win32.StdCallLibrary;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * This class exposes functions from credential manager on Windows platform\n+ * via JNA.\n+ */\n+public interface WindowsCredentialApi extends StdCallLibrary {\n+\n+    /**\n+     * Type of Credential\n+     */\n+    int CRED_TYPE_GENERIC = 1;\n+\n+    /**\n+     * Credential attributes\n+     *\n+     * typedef struct _CREDENTIAL_ATTRIBUTE {\n+     *   LPTSTR Keyword;\n+     *   DWORD  Flags;\n+     *   DWORD  ValueSize;\n+     *   LPBYTE Value;\n+     * } CREDENTIAL_ATTRIBUTE, *PCREDENTIAL_ATTRIBUTE;\n+     *\n+     */\n+    class CREDENTIAL_ATTRIBUTE extends Structure {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQzNzYwOA==", "bodyText": "These classes map to native C code via Jna.\nThis is a general best practice when using Native classes to distinguish them.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417437608", "createdAt": "2020-04-29T16:11:51Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/WindowsCredentialApi.java", "diffHunk": "@@ -0,0 +1,294 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.sun.jna.Pointer;\n+import com.sun.jna.Memory;\n+import com.sun.jna.LastErrorException;\n+import com.sun.jna.Structure;\n+import com.sun.jna.platform.win32.WinBase;\n+import com.sun.jna.win32.StdCallLibrary;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * This class exposes functions from credential manager on Windows platform\n+ * via JNA.\n+ */\n+public interface WindowsCredentialApi extends StdCallLibrary {\n+\n+    /**\n+     * Type of Credential\n+     */\n+    int CRED_TYPE_GENERIC = 1;\n+\n+    /**\n+     * Credential attributes\n+     *\n+     * typedef struct _CREDENTIAL_ATTRIBUTE {\n+     *   LPTSTR Keyword;\n+     *   DWORD  Flags;\n+     *   DWORD  ValueSize;\n+     *   LPBYTE Value;\n+     * } CREDENTIAL_ATTRIBUTE, *PCREDENTIAL_ATTRIBUTE;\n+     *\n+     */\n+    class CREDENTIAL_ATTRIBUTE extends Structure {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MTA4Nw=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODQxNzQ1OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/WindowsCredentialApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoxNjowNlrOGLjonw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjoxMTo0NlrOGOGXdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MTM1OQ==", "bodyText": "Same here - class names should use Pascal case.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414771359", "createdAt": "2020-04-24T18:16:06Z", "author": {"login": "srnagar"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/WindowsCredentialApi.java", "diffHunk": "@@ -0,0 +1,294 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.sun.jna.Pointer;\n+import com.sun.jna.Memory;\n+import com.sun.jna.LastErrorException;\n+import com.sun.jna.Structure;\n+import com.sun.jna.platform.win32.WinBase;\n+import com.sun.jna.win32.StdCallLibrary;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * This class exposes functions from credential manager on Windows platform\n+ * via JNA.\n+ */\n+public interface WindowsCredentialApi extends StdCallLibrary {\n+\n+    /**\n+     * Type of Credential\n+     */\n+    int CRED_TYPE_GENERIC = 1;\n+\n+    /**\n+     * Credential attributes\n+     *\n+     * typedef struct _CREDENTIAL_ATTRIBUTE {\n+     *   LPTSTR Keyword;\n+     *   DWORD  Flags;\n+     *   DWORD  ValueSize;\n+     *   LPBYTE Value;\n+     * } CREDENTIAL_ATTRIBUTE, *PCREDENTIAL_ATTRIBUTE;\n+     *\n+     */\n+    class CREDENTIAL_ATTRIBUTE extends Structure {\n+\n+        public static class ByReference extends CREDENTIAL_ATTRIBUTE implements Structure.ByReference { }\n+\n+        @Override\n+        protected List<String> getFieldOrder() {\n+            return Arrays.asList(\"Keyword\",\n+                    \"Flags\",\n+                    \"ValueSize\",\n+                    \"Value\");\n+        }\n+\n+        /**\n+         *    Name of the application-specific attribute. Names should be of the form \"CompanyName_Name\".\n+         *    This member cannot be longer than CRED_MAX_STRING_LENGTH (256) characters.\n+         */\n+        public String Keyword;\n+\n+        /**\n+         *   Identifies characteristics of the credential attribute. This member is reserved and should be originally\n+         *   initialized as zero and not otherwise altered to permit future enhancement.\n+         */\n+        public int Flags;\n+\n+        /**\n+         *   Length of Value in bytes. This member cannot be larger than CRED_MAX_VALUE_SIZE (256).\n+         */\n+        public int ValueSize;\n+\n+        /**\n+         *   Data associated with the attribute. By convention, if Value is a text string, then Value should not\n+         *   include the trailing zero character and should be in UNICODE.\n+         *\n+         *   Credentials are expected to be portable. The application should take care to ensure that the data in\n+         *   value is portable. It is the responsibility of the application to define the byte-endian and alignment\n+         *   of the data in Value.\n+         */\n+        public Pointer Value;\n+    }\n+\n+\n+    /**\n+     * The CREDENTIAL structure contains an individual credential\n+     *\n+     * typedef struct _CREDENTIAL {\n+     *   DWORD                 Flags;\n+     *   DWORD                 Type;\n+     *   LPTSTR                TargetName;\n+     *   LPTSTR                Comment;\n+     *   FILETIME              LastWritten;\n+     *   DWORD                 CredentialBlobSize;\n+     *   LPBYTE                CredentialBlob;\n+     *   DWORD                 Persist;\n+     *   DWORD                 AttributeCount;\n+     *   PCREDENTIAL_ATTRIBUTE Attributes;\n+     *   LPTSTR                TargetAlias;\n+     *   LPTSTR                UserName;\n+     * } CREDENTIAL, *PCREDENTIAL;\n+     */\n+    class CREDENTIAL extends Structure {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQzNzU1Nw==", "bodyText": "Maps to native C structs.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417437557", "createdAt": "2020-04-29T16:11:46Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/WindowsCredentialApi.java", "diffHunk": "@@ -0,0 +1,294 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.sun.jna.Pointer;\n+import com.sun.jna.Memory;\n+import com.sun.jna.LastErrorException;\n+import com.sun.jna.Structure;\n+import com.sun.jna.platform.win32.WinBase;\n+import com.sun.jna.win32.StdCallLibrary;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * This class exposes functions from credential manager on Windows platform\n+ * via JNA.\n+ */\n+public interface WindowsCredentialApi extends StdCallLibrary {\n+\n+    /**\n+     * Type of Credential\n+     */\n+    int CRED_TYPE_GENERIC = 1;\n+\n+    /**\n+     * Credential attributes\n+     *\n+     * typedef struct _CREDENTIAL_ATTRIBUTE {\n+     *   LPTSTR Keyword;\n+     *   DWORD  Flags;\n+     *   DWORD  ValueSize;\n+     *   LPBYTE Value;\n+     * } CREDENTIAL_ATTRIBUTE, *PCREDENTIAL_ATTRIBUTE;\n+     *\n+     */\n+    class CREDENTIAL_ATTRIBUTE extends Structure {\n+\n+        public static class ByReference extends CREDENTIAL_ATTRIBUTE implements Structure.ByReference { }\n+\n+        @Override\n+        protected List<String> getFieldOrder() {\n+            return Arrays.asList(\"Keyword\",\n+                    \"Flags\",\n+                    \"ValueSize\",\n+                    \"Value\");\n+        }\n+\n+        /**\n+         *    Name of the application-specific attribute. Names should be of the form \"CompanyName_Name\".\n+         *    This member cannot be longer than CRED_MAX_STRING_LENGTH (256) characters.\n+         */\n+        public String Keyword;\n+\n+        /**\n+         *   Identifies characteristics of the credential attribute. This member is reserved and should be originally\n+         *   initialized as zero and not otherwise altered to permit future enhancement.\n+         */\n+        public int Flags;\n+\n+        /**\n+         *   Length of Value in bytes. This member cannot be larger than CRED_MAX_VALUE_SIZE (256).\n+         */\n+        public int ValueSize;\n+\n+        /**\n+         *   Data associated with the attribute. By convention, if Value is a text string, then Value should not\n+         *   include the trailing zero character and should be in UNICODE.\n+         *\n+         *   Credentials are expected to be portable. The application should take care to ensure that the data in\n+         *   value is portable. It is the responsibility of the application to define the byte-endian and alignment\n+         *   of the data in Value.\n+         */\n+        public Pointer Value;\n+    }\n+\n+\n+    /**\n+     * The CREDENTIAL structure contains an individual credential\n+     *\n+     * typedef struct _CREDENTIAL {\n+     *   DWORD                 Flags;\n+     *   DWORD                 Type;\n+     *   LPTSTR                TargetName;\n+     *   LPTSTR                Comment;\n+     *   FILETIME              LastWritten;\n+     *   DWORD                 CredentialBlobSize;\n+     *   LPBYTE                CredentialBlob;\n+     *   DWORD                 Persist;\n+     *   DWORD                 AttributeCount;\n+     *   PCREDENTIAL_ATTRIBUTE Attributes;\n+     *   LPTSTR                TargetAlias;\n+     *   LPTSTR                UserName;\n+     * } CREDENTIAL, *PCREDENTIAL;\n+     */\n+    class CREDENTIAL extends Structure {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MTM1OQ=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODQxOTU2OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/WindowsCredentialApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoxNjozNlrOGLjpyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjoxMTo0M1rOGOGXRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MTY1Ng==", "bodyText": "variable names should start from lower case.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414771656", "createdAt": "2020-04-24T18:16:36Z", "author": {"login": "srnagar"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/WindowsCredentialApi.java", "diffHunk": "@@ -0,0 +1,294 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.sun.jna.Pointer;\n+import com.sun.jna.Memory;\n+import com.sun.jna.LastErrorException;\n+import com.sun.jna.Structure;\n+import com.sun.jna.platform.win32.WinBase;\n+import com.sun.jna.win32.StdCallLibrary;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * This class exposes functions from credential manager on Windows platform\n+ * via JNA.\n+ */\n+public interface WindowsCredentialApi extends StdCallLibrary {\n+\n+    /**\n+     * Type of Credential\n+     */\n+    int CRED_TYPE_GENERIC = 1;\n+\n+    /**\n+     * Credential attributes\n+     *\n+     * typedef struct _CREDENTIAL_ATTRIBUTE {\n+     *   LPTSTR Keyword;\n+     *   DWORD  Flags;\n+     *   DWORD  ValueSize;\n+     *   LPBYTE Value;\n+     * } CREDENTIAL_ATTRIBUTE, *PCREDENTIAL_ATTRIBUTE;\n+     *\n+     */\n+    class CREDENTIAL_ATTRIBUTE extends Structure {\n+\n+        public static class ByReference extends CREDENTIAL_ATTRIBUTE implements Structure.ByReference { }\n+\n+        @Override\n+        protected List<String> getFieldOrder() {\n+            return Arrays.asList(\"Keyword\",\n+                    \"Flags\",\n+                    \"ValueSize\",\n+                    \"Value\");\n+        }\n+\n+        /**\n+         *    Name of the application-specific attribute. Names should be of the form \"CompanyName_Name\".\n+         *    This member cannot be longer than CRED_MAX_STRING_LENGTH (256) characters.\n+         */\n+        public String Keyword;\n+\n+        /**\n+         *   Identifies characteristics of the credential attribute. This member is reserved and should be originally\n+         *   initialized as zero and not otherwise altered to permit future enhancement.\n+         */\n+        public int Flags;\n+\n+        /**\n+         *   Length of Value in bytes. This member cannot be larger than CRED_MAX_VALUE_SIZE (256).\n+         */\n+        public int ValueSize;\n+\n+        /**\n+         *   Data associated with the attribute. By convention, if Value is a text string, then Value should not\n+         *   include the trailing zero character and should be in UNICODE.\n+         *\n+         *   Credentials are expected to be portable. The application should take care to ensure that the data in\n+         *   value is portable. It is the responsibility of the application to define the byte-endian and alignment\n+         *   of the data in Value.\n+         */\n+        public Pointer Value;\n+    }\n+\n+\n+    /**\n+     * The CREDENTIAL structure contains an individual credential\n+     *\n+     * typedef struct _CREDENTIAL {\n+     *   DWORD                 Flags;\n+     *   DWORD                 Type;\n+     *   LPTSTR                TargetName;\n+     *   LPTSTR                Comment;\n+     *   FILETIME              LastWritten;\n+     *   DWORD                 CredentialBlobSize;\n+     *   LPBYTE                CredentialBlob;\n+     *   DWORD                 Persist;\n+     *   DWORD                 AttributeCount;\n+     *   PCREDENTIAL_ATTRIBUTE Attributes;\n+     *   LPTSTR                TargetAlias;\n+     *   LPTSTR                UserName;\n+     * } CREDENTIAL, *PCREDENTIAL;\n+     */\n+    class CREDENTIAL extends Structure {\n+\n+        @Override\n+        protected List<String> getFieldOrder() {\n+            return Arrays.asList(\"Flags\",\n+                    \"Type\",\n+                    \"TargetName\",\n+                    \"Comment\",\n+                    \"LastWritten\",\n+                    \"CredentialBlobSize\",\n+                    \"CredentialBlob\",\n+                    \"Persist\",\n+                    \"AttributeCount\",\n+                    \"Attributes\",\n+                    \"TargetAlias\",\n+                    \"UserName\");\n+        }\n+\n+        public CREDENTIAL() {\n+            super();\n+        }\n+\n+        public CREDENTIAL(final int size) {\n+            super(new Memory(size));\n+        }\n+\n+        public CREDENTIAL(Pointer memory) {\n+            super(memory);\n+            read();\n+        }\n+\n+        /**\n+         *   A bit member that identifies characteristics of the credential. Undefined bits should be initialized\n+         *   as zero and not otherwise altered to permit future enhancement.\n+         *\n+         *   See MSDN doc for all possible flags\n+         */\n+        public int Flags;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQzNzUxMQ==", "bodyText": "maps to native C structs fields.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417437511", "createdAt": "2020-04-29T16:11:43Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/WindowsCredentialApi.java", "diffHunk": "@@ -0,0 +1,294 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.sun.jna.Pointer;\n+import com.sun.jna.Memory;\n+import com.sun.jna.LastErrorException;\n+import com.sun.jna.Structure;\n+import com.sun.jna.platform.win32.WinBase;\n+import com.sun.jna.win32.StdCallLibrary;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * This class exposes functions from credential manager on Windows platform\n+ * via JNA.\n+ */\n+public interface WindowsCredentialApi extends StdCallLibrary {\n+\n+    /**\n+     * Type of Credential\n+     */\n+    int CRED_TYPE_GENERIC = 1;\n+\n+    /**\n+     * Credential attributes\n+     *\n+     * typedef struct _CREDENTIAL_ATTRIBUTE {\n+     *   LPTSTR Keyword;\n+     *   DWORD  Flags;\n+     *   DWORD  ValueSize;\n+     *   LPBYTE Value;\n+     * } CREDENTIAL_ATTRIBUTE, *PCREDENTIAL_ATTRIBUTE;\n+     *\n+     */\n+    class CREDENTIAL_ATTRIBUTE extends Structure {\n+\n+        public static class ByReference extends CREDENTIAL_ATTRIBUTE implements Structure.ByReference { }\n+\n+        @Override\n+        protected List<String> getFieldOrder() {\n+            return Arrays.asList(\"Keyword\",\n+                    \"Flags\",\n+                    \"ValueSize\",\n+                    \"Value\");\n+        }\n+\n+        /**\n+         *    Name of the application-specific attribute. Names should be of the form \"CompanyName_Name\".\n+         *    This member cannot be longer than CRED_MAX_STRING_LENGTH (256) characters.\n+         */\n+        public String Keyword;\n+\n+        /**\n+         *   Identifies characteristics of the credential attribute. This member is reserved and should be originally\n+         *   initialized as zero and not otherwise altered to permit future enhancement.\n+         */\n+        public int Flags;\n+\n+        /**\n+         *   Length of Value in bytes. This member cannot be larger than CRED_MAX_VALUE_SIZE (256).\n+         */\n+        public int ValueSize;\n+\n+        /**\n+         *   Data associated with the attribute. By convention, if Value is a text string, then Value should not\n+         *   include the trailing zero character and should be in UNICODE.\n+         *\n+         *   Credentials are expected to be portable. The application should take care to ensure that the data in\n+         *   value is portable. It is the responsibility of the application to define the byte-endian and alignment\n+         *   of the data in Value.\n+         */\n+        public Pointer Value;\n+    }\n+\n+\n+    /**\n+     * The CREDENTIAL structure contains an individual credential\n+     *\n+     * typedef struct _CREDENTIAL {\n+     *   DWORD                 Flags;\n+     *   DWORD                 Type;\n+     *   LPTSTR                TargetName;\n+     *   LPTSTR                Comment;\n+     *   FILETIME              LastWritten;\n+     *   DWORD                 CredentialBlobSize;\n+     *   LPBYTE                CredentialBlob;\n+     *   DWORD                 Persist;\n+     *   DWORD                 AttributeCount;\n+     *   PCREDENTIAL_ATTRIBUTE Attributes;\n+     *   LPTSTR                TargetAlias;\n+     *   LPTSTR                UserName;\n+     * } CREDENTIAL, *PCREDENTIAL;\n+     */\n+    class CREDENTIAL extends Structure {\n+\n+        @Override\n+        protected List<String> getFieldOrder() {\n+            return Arrays.asList(\"Flags\",\n+                    \"Type\",\n+                    \"TargetName\",\n+                    \"Comment\",\n+                    \"LastWritten\",\n+                    \"CredentialBlobSize\",\n+                    \"CredentialBlob\",\n+                    \"Persist\",\n+                    \"AttributeCount\",\n+                    \"Attributes\",\n+                    \"TargetAlias\",\n+                    \"UserName\");\n+        }\n+\n+        public CREDENTIAL() {\n+            super();\n+        }\n+\n+        public CREDENTIAL(final int size) {\n+            super(new Memory(size));\n+        }\n+\n+        public CREDENTIAL(Pointer memory) {\n+            super(memory);\n+            read();\n+        }\n+\n+        /**\n+         *   A bit member that identifies characteristics of the credential. Undefined bits should be initialized\n+         *   as zero and not otherwise altered to permit future enhancement.\n+         *\n+         *   See MSDN doc for all possible flags\n+         */\n+        public int Flags;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MTY1Ng=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 135}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODQ0MjYxOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredentialBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoyMjozMlrOGLj3ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoyMjozMlrOGLj3ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NTE0Ng==", "bodyText": "I guess this whole builder class will be removed as suggested by @schaabs but if it's not removed then this annotation should be removed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414775146", "createdAt": "2020-04-24T18:22:32Z", "author": {"login": "srnagar"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredentialBuilder.java", "diffHunk": "@@ -0,0 +1,35 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity;\n+\n+/**\n+ * Fluent credential builder for instantiating a {@link VisualStudioCodeCredential}.\n+ *\n+ * @see VisualStudioCodeCredential\n+ */\n+public class VisualStudioCodeCredentialBuilder extends CredentialBuilderBase<DefaultAzureCredentialBuilder> {\n+\n+    private String tenantId;\n+\n+    /**\n+     * Sets the tenant ID of the application.\n+     *\n+     * @param tenantId the tenant ID of the application.\n+     * @return An updated instance of this builder with the tenant id set as specified.\n+     */\n+    @SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODU3NDA2OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredential.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODo1NjoyNlrOGLlD6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjoxMjozN1rOGOGZ0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc5NDczMQ==", "bodyText": "Is it helpful to log the error as a warning? if understand correctly we assume the error is going to be an auth error, maybe log helps to debug if it ever fails due to some other reason.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414794731", "createdAt": "2020-04-24T18:56:26Z", "author": {"login": "anuchandy"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredential.java", "diffHunk": "@@ -0,0 +1,56 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity;\n+\n+import com.azure.core.credential.AccessToken;\n+import com.azure.core.credential.TokenCredential;\n+import com.azure.core.credential.TokenRequestContext;\n+import com.azure.identity.implementation.IdentityClient;\n+import com.azure.identity.implementation.IdentityClientBuilder;\n+import com.azure.identity.implementation.IdentityClientOptions;\n+import com.azure.identity.implementation.MsalToken;\n+import reactor.core.publisher.Mono;\n+\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+/**\n+ * Enables authentication to Azure Active Directory using data from Visual Studio Code\n+ */\n+public class VisualStudioCodeCredential implements TokenCredential {\n+    private final IdentityClient identityClient;\n+    private final AtomicReference<MsalToken> cachedToken;\n+\n+    /**\n+     * Creates a public class VisualStudioCodeCredential implements TokenCredential with the given tenant and\n+     * identity client options.\n+     *\n+     * @param tenantId the tenant ID of the application\n+     * @param identityClientOptions the options for configuring the identity client\n+     */\n+    VisualStudioCodeCredential(String tenantId, IdentityClientOptions identityClientOptions) {\n+        identityClient = new IdentityClientBuilder()\n+                             .clientId(\"aebc6443-996d-45c2-90f0-388ff96faa56\")\n+                             .tenantId(tenantId)\n+                             .identityClientOptions(identityClientOptions)\n+                             .build();\n+        this.cachedToken = new AtomicReference<>();\n+    }\n+\n+    @Override\n+    public Mono<AccessToken> getToken(TokenRequestContext request) {\n+        return Mono.defer(() -> {\n+            if (cachedToken.get() != null) {\n+                return identityClient.authenticateWithUserRefreshToken(request, cachedToken.get())\n+                           .onErrorResume(t -> Mono.empty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQzODE2MQ==", "bodyText": "This will be possibly covered, when adding Identity wide logging.\nThere are other credentials which might need this warning log too.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417438161", "createdAt": "2020-04-29T16:12:37Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/VisualStudioCodeCredential.java", "diffHunk": "@@ -0,0 +1,56 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity;\n+\n+import com.azure.core.credential.AccessToken;\n+import com.azure.core.credential.TokenCredential;\n+import com.azure.core.credential.TokenRequestContext;\n+import com.azure.identity.implementation.IdentityClient;\n+import com.azure.identity.implementation.IdentityClientBuilder;\n+import com.azure.identity.implementation.IdentityClientOptions;\n+import com.azure.identity.implementation.MsalToken;\n+import reactor.core.publisher.Mono;\n+\n+import java.util.concurrent.atomic.AtomicReference;\n+\n+/**\n+ * Enables authentication to Azure Active Directory using data from Visual Studio Code\n+ */\n+public class VisualStudioCodeCredential implements TokenCredential {\n+    private final IdentityClient identityClient;\n+    private final AtomicReference<MsalToken> cachedToken;\n+\n+    /**\n+     * Creates a public class VisualStudioCodeCredential implements TokenCredential with the given tenant and\n+     * identity client options.\n+     *\n+     * @param tenantId the tenant ID of the application\n+     * @param identityClientOptions the options for configuring the identity client\n+     */\n+    VisualStudioCodeCredential(String tenantId, IdentityClientOptions identityClientOptions) {\n+        identityClient = new IdentityClientBuilder()\n+                             .clientId(\"aebc6443-996d-45c2-90f0-388ff96faa56\")\n+                             .tenantId(tenantId)\n+                             .identityClientOptions(identityClientOptions)\n+                             .build();\n+        this.cachedToken = new AtomicReference<>();\n+    }\n+\n+    @Override\n+    public Mono<AccessToken> getToken(TokenRequestContext request) {\n+        return Mono.defer(() -> {\n+            if (cachedToken.get() != null) {\n+                return identityClient.authenticateWithUserRefreshToken(request, cachedToken.get())\n+                           .onErrorResume(t -> Mono.empty());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc5NDczMQ=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3ODY5MjcyOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxOToyOTo0MVrOGLmJuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxODo0NDoyNFrOGMyUUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxMjYwMA==", "bodyText": "just curious, some questions:\n\nif there are two ways to acquire token (firstPath:authCode, secondPath:refreshToken) then is it by design to try the second path only if we fail to parse the local configuration?\nIf it is not always guaranteed to have authCode in the config, does it makes sense to try the second path?\nIs it make sense to try out the second path if there is an async error in the first path?\n\nMono<MsalToken> mono1 = tokenByAuthCode();\nMono<MsalToken> mono2 = tokenByRefreshToken();\nmono1.onErrorResume(t -> mono2);", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r414812600", "createdAt": "2020-04-24T19:29:41Z", "author": {"login": "anuchandy"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +434,85 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = KnownAuthorityHosts.AZURE_CLOUD.replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;\n+        PublicClientApplication.Builder publicClientApplicationBuilder = PublicClientApplication.builder(clientId);\n+        if (httpPipelineAdapter != null) {\n+            publicClientApplicationBuilder.httpClient(httpPipelineAdapter);\n+        } else if (options.getProxyOptions() != null) {\n+            publicClientApplicationBuilder.proxy(proxyOptionsToJavaNetProxy(options.getProxyOptions()));\n+        }\n+\n+        try {\n+            ObjectMapper mapper = new ObjectMapper();\n+            JsonNode parsedCredentials = mapper.readTree(credential);\n+            String redirectUri = parsedCredentials.get(\"redirectionUrl\").asText();\n+            String authorizationCode = parsedCredentials.get(\"code\").asText();\n+\n+            AuthorizationCodeParameters authorizationCodeParameters = AuthorizationCodeParameters\n+                .builder(authorizationCode, new URI(redirectUri))\n+                .scopes(new HashSet<>(request.getScopes()))\n+                .build();\n+\n+            PublicClientApplication application = publicClientApplicationBuilder.authority(authority).build();\n+\n+            return Mono.fromFuture(() -> application.acquireToken(\n+                authorizationCodeParameters))\n+                .map(ar -> new MsalToken(ar, options));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA2MDQ5Nw==", "bodyText": "WE don't need to support auth code, that logic is removed now.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416060497", "createdAt": "2020-04-27T18:44:24Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +434,85 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = KnownAuthorityHosts.AZURE_CLOUD.replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;\n+        PublicClientApplication.Builder publicClientApplicationBuilder = PublicClientApplication.builder(clientId);\n+        if (httpPipelineAdapter != null) {\n+            publicClientApplicationBuilder.httpClient(httpPipelineAdapter);\n+        } else if (options.getProxyOptions() != null) {\n+            publicClientApplicationBuilder.proxy(proxyOptionsToJavaNetProxy(options.getProxyOptions()));\n+        }\n+\n+        try {\n+            ObjectMapper mapper = new ObjectMapper();\n+            JsonNode parsedCredentials = mapper.readTree(credential);\n+            String redirectUri = parsedCredentials.get(\"redirectionUrl\").asText();\n+            String authorizationCode = parsedCredentials.get(\"code\").asText();\n+\n+            AuthorizationCodeParameters authorizationCodeParameters = AuthorizationCodeParameters\n+                .builder(authorizationCode, new URI(redirectUri))\n+                .scopes(new HashSet<>(request.getScopes()))\n+                .build();\n+\n+            PublicClientApplication application = publicClientApplicationBuilder.authority(authority).build();\n+\n+            return Mono.fromFuture(() -> application.acquireToken(\n+                authorizationCodeParameters))\n+                .map(ar -> new MsalToken(ar, options));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxMjYwMA=="}, "originalCommit": {"oid": "9ce71e04e4faf658e2c1ec950720c1988403d4d3"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4OTAyNDg4OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTozNjo1MlrOGM4yew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjowMzowMFrOGOSr2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE2NjUyMw==", "bodyText": "Need more text here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416166523", "createdAt": "2020-04-27T21:36:52Z", "author": {"login": "JonathanGiles"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "diffHunk": "@@ -20,9 +20,24 @@\n     private boolean excludeManagedIdentityCredential;\n     private boolean excludeSharedTokenCacheCredential;\n     private boolean excludeAzureCliCredential;\n+    private boolean excludeVsCodeCredential;\n+    private String tenantId;\n     private final ClientLogger logger = new ClientLogger(DefaultAzureCredentialBuilder.class);\n \n \n+    /**\n+     * Sets the tenant ID of the application.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzOTM4Ng==", "bodyText": "updated", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417639386", "createdAt": "2020-04-29T22:03:00Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "diffHunk": "@@ -20,9 +20,24 @@\n     private boolean excludeManagedIdentityCredential;\n     private boolean excludeSharedTokenCacheCredential;\n     private boolean excludeAzureCliCredential;\n+    private boolean excludeVsCodeCredential;\n+    private String tenantId;\n     private final ClientLogger logger = new ClientLogger(DefaultAzureCredentialBuilder.class);\n \n \n+    /**\n+     * Sets the tenant ID of the application.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE2NjUyMw=="}, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4OTAyNjExOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTozNzoxMFrOGM4zLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjowMjoxMFrOGOSqfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE2NjcwMQ==", "bodyText": "Why suppress warnings?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416166701", "createdAt": "2020-04-27T21:37:10Z", "author": {"login": "JonathanGiles"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "diffHunk": "@@ -20,9 +20,24 @@\n     private boolean excludeManagedIdentityCredential;\n     private boolean excludeSharedTokenCacheCredential;\n     private boolean excludeAzureCliCredential;\n+    private boolean excludeVsCodeCredential;\n+    private String tenantId;\n     private final ClientLogger logger = new ClientLogger(DefaultAzureCredentialBuilder.class);\n \n \n+    /**\n+     * Sets the tenant ID of the application.\n+     *\n+     * @param tenantId the tenant ID of the application.\n+     * @return An updated instance of this builder with the tenant id set as specified.\n+     */\n+    @SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzOTAzOQ==", "bodyText": "This is removed.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417639039", "createdAt": "2020-04-29T22:02:10Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "diffHunk": "@@ -20,9 +20,24 @@\n     private boolean excludeManagedIdentityCredential;\n     private boolean excludeSharedTokenCacheCredential;\n     private boolean excludeAzureCliCredential;\n+    private boolean excludeVsCodeCredential;\n+    private String tenantId;\n     private final ClientLogger logger = new ClientLogger(DefaultAzureCredentialBuilder.class);\n \n \n+    /**\n+     * Sets the tenant ID of the application.\n+     *\n+     * @param tenantId the tenant ID of the application.\n+     * @return An updated instance of this builder with the tenant id set as specified.\n+     */\n+    @SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE2NjcwMQ=="}, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4OTAyNzk2OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTozNzozNlrOGM40Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjowMjozNlrOGOSrNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE2Njk2Nw==", "bodyText": "Should this just be 'excludeVSCodeCredential()`?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416166967", "createdAt": "2020-04-27T21:37:36Z", "author": {"login": "JonathanGiles"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "diffHunk": "@@ -79,6 +94,16 @@ public DefaultAzureCredentialBuilder excludeAzureCliCredential() {\n         return this;\n     }\n \n+    /**\n+     * Excludes the {@link VisualStudioCodeCredential} from the {@link DefaultAzureCredential} authentication flow.\n+     *\n+     * @return An updated instance of this builder with the Visual Studio Code credential exclusion set as specified.\n+     */\n+    public DefaultAzureCredentialBuilder excludeVisualStudioCodeCredential() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzOTIyMg==", "bodyText": "Yeah that's more identifiable as a user.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417639222", "createdAt": "2020-04-29T22:02:36Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "diffHunk": "@@ -79,6 +94,16 @@ public DefaultAzureCredentialBuilder excludeAzureCliCredential() {\n         return this;\n     }\n \n+    /**\n+     * Excludes the {@link VisualStudioCodeCredential} from the {@link DefaultAzureCredential} authentication flow.\n+     *\n+     * @return An updated instance of this builder with the Visual Studio Code credential exclusion set as specified.\n+     */\n+    public DefaultAzureCredentialBuilder excludeVisualStudioCodeCredential() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE2Njk2Nw=="}, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4OTA2NTM2OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTo0Nzo0MVrOGM5Jmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjowMjo0NFrOGOSrbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE3MjQ0Mg==", "bodyText": "Handle the situation better where a different OS is being used.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416172442", "createdAt": "2020-04-27T21:47:41Z", "author": {"login": "JonathanGiles"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.CredentialUnavailableException;\n+import com.azure.identity.KnownAuthorityHosts;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.aad.msal4jextensions.persistence.mac.KeyChainAccessor;\n+import com.sun.jna.Platform;\n+\n+import java.io.File;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Paths;\n+\n+/**\n+ * This class allows access to Visual Studio Code cached credential data.\n+ */\n+public class VisualStudioCacheAccessor {\n+    private final ClientLogger logger = new ClientLogger(VisualStudioCacheAccessor.class);\n+\n+    /**\n+     * Creates an instance of {@link VisualStudioCacheAccessor}\n+     */\n+    public VisualStudioCacheAccessor() { }\n+\n+    /**\n+     * Get the user configured settings of Visual Studio code.\n+     * @return the {@link JsonNode} holding the settings as properties.\n+     */\n+    public JsonNode getUserSettings() {\n+        JsonNode output = null;\n+        String homeDir = System.getProperty(\"user.home\");\n+        String settingsPath = \"\";\n+        ObjectMapper mapper = new ObjectMapper();\n+        try {\n+            if (Platform.isWindows()) {\n+                settingsPath = Paths.get(System.getenv(\"APPDATA\"), \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            } else if (Platform.isMac()) {\n+                settingsPath = Paths.get(homeDir, \"Library\",\n+                        \"Application Support\", \"Code\", \"User\", \"settings.json\").toString();\n+            } else if (Platform.isLinux()) {\n+                settingsPath = Paths.get(homeDir, \".config\", \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYzOTI3Nw==", "bodyText": "handled.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417639277", "createdAt": "2020-04-29T22:02:44Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.CredentialUnavailableException;\n+import com.azure.identity.KnownAuthorityHosts;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.aad.msal4jextensions.persistence.mac.KeyChainAccessor;\n+import com.sun.jna.Platform;\n+\n+import java.io.File;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Paths;\n+\n+/**\n+ * This class allows access to Visual Studio Code cached credential data.\n+ */\n+public class VisualStudioCacheAccessor {\n+    private final ClientLogger logger = new ClientLogger(VisualStudioCacheAccessor.class);\n+\n+    /**\n+     * Creates an instance of {@link VisualStudioCacheAccessor}\n+     */\n+    public VisualStudioCacheAccessor() { }\n+\n+    /**\n+     * Get the user configured settings of Visual Studio code.\n+     * @return the {@link JsonNode} holding the settings as properties.\n+     */\n+    public JsonNode getUserSettings() {\n+        JsonNode output = null;\n+        String homeDir = System.getProperty(\"user.home\");\n+        String settingsPath = \"\";\n+        ObjectMapper mapper = new ObjectMapper();\n+        try {\n+            if (Platform.isWindows()) {\n+                settingsPath = Paths.get(System.getenv(\"APPDATA\"), \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            } else if (Platform.isMac()) {\n+                settingsPath = Paths.get(homeDir, \"Library\",\n+                        \"Application Support\", \"Code\", \"User\", \"settings.json\").toString();\n+            } else if (Platform.isLinux()) {\n+                settingsPath = Paths.get(homeDir, \".config\", \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE3MjQ0Mg=="}, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4OTA3NzEwOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTo1MTowMFrOGM5QXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTo1MTowMFrOGM5QXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE3NDE3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                                       + \" Credential authentication.\"));\n          \n          \n            \n                                                                       + \" credential authentication.\"));", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416174174", "createdAt": "2020-04-27T21:51:00Z", "author": {"login": "JonathanGiles"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.CredentialUnavailableException;\n+import com.azure.identity.KnownAuthorityHosts;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.aad.msal4jextensions.persistence.mac.KeyChainAccessor;\n+import com.sun.jna.Platform;\n+\n+import java.io.File;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Paths;\n+\n+/**\n+ * This class allows access to Visual Studio Code cached credential data.\n+ */\n+public class VisualStudioCacheAccessor {\n+    private final ClientLogger logger = new ClientLogger(VisualStudioCacheAccessor.class);\n+\n+    /**\n+     * Creates an instance of {@link VisualStudioCacheAccessor}\n+     */\n+    public VisualStudioCacheAccessor() { }\n+\n+    /**\n+     * Get the user configured settings of Visual Studio code.\n+     * @return the {@link JsonNode} holding the settings as properties.\n+     */\n+    public JsonNode getUserSettings() {\n+        JsonNode output = null;\n+        String homeDir = System.getProperty(\"user.home\");\n+        String settingsPath = \"\";\n+        ObjectMapper mapper = new ObjectMapper();\n+        try {\n+            if (Platform.isWindows()) {\n+                settingsPath = Paths.get(System.getenv(\"APPDATA\"), \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            } else if (Platform.isMac()) {\n+                settingsPath = Paths.get(homeDir, \"Library\",\n+                        \"Application Support\", \"Code\", \"User\", \"settings.json\").toString();\n+            } else if (Platform.isLinux()) {\n+                settingsPath = Paths.get(homeDir, \".config\", \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            }\n+            File settingsFile = new File(settingsPath);\n+            output = mapper.readTree(settingsFile);\n+        } catch (Exception e) {\n+            return output;\n+        }\n+        return output;\n+    }\n+\n+    /**\n+     * Get the credential for the specified service and account name.\n+     *\n+     * @param serviceName the name of the service to lookup.\n+     * @param accountName the account of the service to lookup.\n+     * @return the credential.\n+     */\n+    public String getCredentials(String serviceName, String accountName) {\n+        String credential;\n+        if (Platform.isWindows()) {\n+            WindowsCredentialAccessor winCredAccessor =\n+                    new WindowsCredentialAccessor(serviceName, accountName);\n+            credential = winCredAccessor.read();\n+        } else if (Platform.isMac()) {\n+            KeyChainAccessor keyChainAccessor = new KeyChainAccessor(null,\n+                    serviceName, accountName);\n+\n+            byte[] readCreds = keyChainAccessor.read();\n+            credential = new String(readCreds, StandardCharsets.UTF_8);\n+        } else if (Platform.isLinux()) {\n+\n+            LinuxKeyRingAccessor keyRingAccessor = new LinuxKeyRingAccessor(\n+                    \"org.freedesktop.Secret.Generic\", \"service\",\n+                    serviceName, \"account\", accountName);\n+\n+            byte[] readCreds = keyRingAccessor.read();\n+            credential = new String(readCreds, StandardCharsets.UTF_8);\n+        } else {\n+            throw logger.logExceptionAsError(\n+                new CredentialUnavailableException(\"Platform could not be determined for VsCode\"\n+                                                           + \" Credential authentication.\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4OTA3NzUyOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTo1MTowOFrOGM5Qlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMTo1MTowOFrOGM5Qlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE3NDIzMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            new CredentialUnavailableException(\"Platform could not be determined for VsCode\"\n          \n          \n            \n                            new CredentialUnavailableException(\"Platform could not be determined for VS Code\"", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r416174231", "createdAt": "2020-04-27T21:51:08Z", "author": {"login": "JonathanGiles"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "diffHunk": "@@ -0,0 +1,128 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.CredentialUnavailableException;\n+import com.azure.identity.KnownAuthorityHosts;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.aad.msal4jextensions.persistence.mac.KeyChainAccessor;\n+import com.sun.jna.Platform;\n+\n+import java.io.File;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Paths;\n+\n+/**\n+ * This class allows access to Visual Studio Code cached credential data.\n+ */\n+public class VisualStudioCacheAccessor {\n+    private final ClientLogger logger = new ClientLogger(VisualStudioCacheAccessor.class);\n+\n+    /**\n+     * Creates an instance of {@link VisualStudioCacheAccessor}\n+     */\n+    public VisualStudioCacheAccessor() { }\n+\n+    /**\n+     * Get the user configured settings of Visual Studio code.\n+     * @return the {@link JsonNode} holding the settings as properties.\n+     */\n+    public JsonNode getUserSettings() {\n+        JsonNode output = null;\n+        String homeDir = System.getProperty(\"user.home\");\n+        String settingsPath = \"\";\n+        ObjectMapper mapper = new ObjectMapper();\n+        try {\n+            if (Platform.isWindows()) {\n+                settingsPath = Paths.get(System.getenv(\"APPDATA\"), \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            } else if (Platform.isMac()) {\n+                settingsPath = Paths.get(homeDir, \"Library\",\n+                        \"Application Support\", \"Code\", \"User\", \"settings.json\").toString();\n+            } else if (Platform.isLinux()) {\n+                settingsPath = Paths.get(homeDir, \".config\", \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            }\n+            File settingsFile = new File(settingsPath);\n+            output = mapper.readTree(settingsFile);\n+        } catch (Exception e) {\n+            return output;\n+        }\n+        return output;\n+    }\n+\n+    /**\n+     * Get the credential for the specified service and account name.\n+     *\n+     * @param serviceName the name of the service to lookup.\n+     * @param accountName the account of the service to lookup.\n+     * @return the credential.\n+     */\n+    public String getCredentials(String serviceName, String accountName) {\n+        String credential;\n+        if (Platform.isWindows()) {\n+            WindowsCredentialAccessor winCredAccessor =\n+                    new WindowsCredentialAccessor(serviceName, accountName);\n+            credential = winCredAccessor.read();\n+        } else if (Platform.isMac()) {\n+            KeyChainAccessor keyChainAccessor = new KeyChainAccessor(null,\n+                    serviceName, accountName);\n+\n+            byte[] readCreds = keyChainAccessor.read();\n+            credential = new String(readCreds, StandardCharsets.UTF_8);\n+        } else if (Platform.isLinux()) {\n+\n+            LinuxKeyRingAccessor keyRingAccessor = new LinuxKeyRingAccessor(\n+                    \"org.freedesktop.Secret.Generic\", \"service\",\n+                    serviceName, \"account\", accountName);\n+\n+            byte[] readCreds = keyRingAccessor.read();\n+            credential = new String(readCreds, StandardCharsets.UTF_8);\n+        } else {\n+            throw logger.logExceptionAsError(\n+                new CredentialUnavailableException(\"Platform could not be determined for VsCode\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba31cf17352e3cb305f2e8ca3d33bdb77b811e4"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODYyOTg5OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjozMDoxNFrOGOTW1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzozNzoxNFrOGOzieA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1MDM4OA==", "bodyText": "If you create a public client application every time we request a token there won't be any caching and each call to this method will result in a call to AAD.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417650388", "createdAt": "2020-04-29T22:30:14Z", "author": {"login": "schaabs"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +431,62 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = accessor.getAzureAuthHost(cloud).replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;\n+        PublicClientApplication.Builder publicClientApplicationBuilder = PublicClientApplication.builder(clientId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5e5b2adaa5d91fa3ff9f9182c1c70f370bdca87"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE3NzY1Ng==", "bodyText": "Updated", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r418177656", "createdAt": "2020-04-30T17:37:14Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +431,62 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = accessor.getAzureAuthHost(cloud).replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;\n+        PublicClientApplication.Builder publicClientApplicationBuilder = PublicClientApplication.builder(clientId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1MDM4OA=="}, "originalCommit": {"oid": "c5e5b2adaa5d91fa3ff9f9182c1c70f370bdca87"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODY1MzA3OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjozOToxNVrOGOTkeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxODowNjoyM1rOGO0l1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1Mzg4Mg==", "bodyText": "The value in the vscode settings azure.cloud azure.tenant need to be overridden if the user specified a different AuthorityHost or TenantId when constructing the credential. This doesn't appear to allow for that as it seems to prefer the value in the settings file.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417653882", "createdAt": "2020-04-29T22:39:15Z", "author": {"login": "schaabs"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +431,62 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = accessor.getAzureAuthHost(cloud).replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5e5b2adaa5d91fa3ff9f9182c1c70f370bdca87"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE3OTUzOA==", "bodyText": "We may need to add this logic in .NET too:  (I maybe wrong, can you double check in .NET below)\nhttps://github.com/Azure/azure-sdk-for-net/blob/a2e2de0ac6aa695182aeda7c44964d6c05935ed6/sdk/identity/Azure.Identity/src/VisualStudioCodeCredential.cs#L117", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r418179538", "createdAt": "2020-04-30T17:40:33Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +431,62 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = accessor.getAzureAuthHost(cloud).replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1Mzg4Mg=="}, "originalCommit": {"oid": "c5e5b2adaa5d91fa3ff9f9182c1c70f370bdca87"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE5NDkwMA==", "bodyText": "Added the logic to give priority to user-specified tenant id.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r418194900", "createdAt": "2020-04-30T18:06:23Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +431,62 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = accessor.getAzureAuthHost(cloud).replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1Mzg4Mg=="}, "originalCommit": {"oid": "c5e5b2adaa5d91fa3ff9f9182c1c70f370bdca87"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODk2NzM1OnYy", "diffSide": "RIGHT", "path": "eng/code-quality-reports/src/main/resources/checkstyle/checkstyle-suppressions.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMToxNjozNFrOGOWgqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzo0ODowN1rOGOz6_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwMjA1OA==", "bodyText": "Comment on why this suppression is necessary please.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417702058", "createdAt": "2020-04-30T01:16:34Z", "author": {"login": "JonathanGiles"}, "path": "eng/code-quality-reports/src/main/resources/checkstyle/checkstyle-suppressions.xml", "diffHunk": "@@ -257,6 +257,9 @@\n   <suppress checks=\"com.azure.tools.checkstyle.checks.GoodLoggingCheck\"\n             files=\"com.azure.endtoend.identity.WebJobsIdentityTest.java\"/>\n \n+  <suppress checks=\"MethodName|MemberName|VisibilityModifier|TypeName\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5e5b2adaa5d91fa3ff9f9182c1c70f370bdca87"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MzkzNA==", "bodyText": "updated", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r418183934", "createdAt": "2020-04-30T17:48:07Z", "author": {"login": "g2vinay"}, "path": "eng/code-quality-reports/src/main/resources/checkstyle/checkstyle-suppressions.xml", "diffHunk": "@@ -257,6 +257,9 @@\n   <suppress checks=\"com.azure.tools.checkstyle.checks.GoodLoggingCheck\"\n             files=\"com.azure.endtoend.identity.WebJobsIdentityTest.java\"/>\n \n+  <suppress checks=\"MethodName|MemberName|VisibilityModifier|TypeName\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwMjA1OA=="}, "originalCommit": {"oid": "c5e5b2adaa5d91fa3ff9f9182c1c70f370bdca87"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODk3NDA5OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMToyMDo1OVrOGOWk6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMToyMDo1OVrOGOWk6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwMzE0NA==", "bodyText": "Why did you choose to wrap the MalformedURLException in an IllegalStateException?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r417703144", "createdAt": "2020-04-30T01:20:59Z", "author": {"login": "JonathanGiles"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -429,6 +431,62 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n         }).map(ar -> new MsalToken(ar, options));\n     }\n \n+    /**\n+     * Asynchronously acquire a token from Active Directory with a device code challenge. Active Directory will provide\n+     * a device code for login and the user must meet the challenge by authenticating in a browser on the current or a\n+     * different device.\n+     *\n+     * @param request the details of the token request\n+     * @return a Publisher that emits an AccessToken when the device challenge is met, or an exception if the device\n+     *     code expires\n+     */\n+    public Mono<MsalToken> authenticateWithVsCodeCredential(TokenRequestContext request) {\n+\n+        VisualStudioCacheAccessor accessor = new VisualStudioCacheAccessor();\n+\n+        JsonNode userSettings = accessor.getUserSettings();\n+\n+        String tenant = tenantId;\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\")) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        String credential = accessor.getCredentials(\"VS Code Azure\", cloud);\n+\n+        String authority = accessor.getAzureAuthHost(cloud).replaceAll(\"/+$\", \"\")\n+            + \"/organizations/\" + tenant;\n+        PublicClientApplication.Builder publicClientApplicationBuilder = PublicClientApplication.builder(clientId);\n+        if (httpPipelineAdapter != null) {\n+            publicClientApplicationBuilder.httpClient(httpPipelineAdapter);\n+        } else if (options.getProxyOptions() != null) {\n+            publicClientApplicationBuilder.proxy(proxyOptionsToJavaNetProxy(options.getProxyOptions()));\n+        }\n+\n+        try {\n+            PublicClientApplication clientApplication =  publicClientApplicationBuilder\n+                                                             .authority(authority)\n+                                                             .build();\n+\n+            RefreshTokenParameters parameters = RefreshTokenParameters\n+                                                    .builder(new HashSet<>(request.getScopes()), credential)\n+                                                    .build();\n+\n+            return Mono.defer(() -> Mono.fromFuture(clientApplication.acquireToken(parameters))\n+                                        .map(ar -> new MsalToken(ar, options)));\n+\n+        } catch (MalformedURLException e) {\n+            return Mono.error(logger.logExceptionAsError(new IllegalStateException(e)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5e5b2adaa5d91fa3ff9f9182c1c70f370bdca87"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMjI4OTkyOnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOToxNzoxMlrOGO28zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMTozMzo1MFrOGPvtNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzMzU1MQ==", "bodyText": "This code can be replaced by return str.matches(\"^[-_.a-zA-Z0-9]+$\")", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r418233551", "createdAt": "2020-04-30T19:17:12Z", "author": {"login": "srnagar"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "diffHunk": "@@ -0,0 +1,185 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.CredentialUnavailableException;\n+import com.azure.identity.KnownAuthorityHosts;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.aad.msal4jextensions.persistence.mac.KeyChainAccessor;\n+import com.sun.jna.Platform;\n+\n+import java.io.File;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * This class allows access to Visual Studio Code cached credential data.\n+ */\n+public class VisualStudioCacheAccessor {\n+    private static final String PLATFORM_NOT_SUPPORTED_ERROR = \"Platform could not be determined for VS Code\"\n+                                               + \" credential authentication.\";\n+    private final ClientLogger logger = new ClientLogger(VisualStudioCacheAccessor.class);\n+\n+    /**\n+     * Creates an instance of {@link VisualStudioCacheAccessor}\n+     */\n+    public VisualStudioCacheAccessor() { }\n+\n+\n+    private JsonNode getUserSettings() {\n+        JsonNode output = null;\n+        String homeDir = System.getProperty(\"user.home\");\n+        String settingsPath = \"\";\n+        ObjectMapper mapper = new ObjectMapper();\n+        try {\n+            if (Platform.isWindows()) {\n+                settingsPath = Paths.get(System.getenv(\"APPDATA\"), \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            } else if (Platform.isMac()) {\n+                settingsPath = Paths.get(homeDir, \"Library\",\n+                        \"Application Support\", \"Code\", \"User\", \"settings.json\").toString();\n+            } else if (Platform.isLinux()) {\n+                settingsPath = Paths.get(homeDir, \".config\", \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            }  else {\n+                throw logger.logExceptionAsError(\n+                        new CredentialUnavailableException(PLATFORM_NOT_SUPPORTED_ERROR));\n+            }\n+            File settingsFile = new File(settingsPath);\n+            output = mapper.readTree(settingsFile);\n+        } catch (Exception e) {\n+            return null;\n+        }\n+        return output;\n+    }\n+\n+    /**\n+     * Get the user configured settings of Visual Studio code.\n+     *\n+     * @param tenantId the user specified tenant id.\n+     * @return a Map containing Vs Code user settings\n+     */\n+    public Map<String, String> getUserSettingsDetails(String tenantId) {\n+        JsonNode userSettings = getUserSettings();\n+        Map<String, String> details = new HashMap<>();\n+\n+        String tenant = tenantId;\n+\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\") && CoreUtils.isNullOrEmpty(tenant)) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        details.put(\"tenant\", tenant);\n+        details.put(\"cloud\", cloud);\n+        return details;\n+    }\n+\n+\n+\n+    /**\n+     * Get the credential for the specified service and account name.\n+     *\n+     * @param serviceName the name of the service to lookup.\n+     * @param accountName the account of the service to lookup.\n+     * @return the credential.\n+     */\n+    public String getCredentials(String serviceName, String accountName) {\n+        String credential;\n+\n+        if (Platform.isWindows()) {\n+\n+            try {\n+                WindowsCredentialAccessor winCredAccessor =\n+                        new WindowsCredentialAccessor(serviceName, accountName);\n+                credential = winCredAccessor.read();\n+            } catch (RuntimeException e) {\n+                throw logger.logExceptionAsError(new CredentialUnavailableException(\n+                        \"Failed to read Vs Code credentials from Windows Credential API.\", e));\n+            }\n+\n+        } else if (Platform.isMac()) {\n+\n+            try {\n+                KeyChainAccessor keyChainAccessor = new KeyChainAccessor(null,\n+                        serviceName, accountName);\n+\n+                byte[] readCreds = keyChainAccessor.read();\n+                credential = new String(readCreds, StandardCharsets.UTF_8);\n+            } catch (RuntimeException e) {\n+                throw logger.logExceptionAsError(new CredentialUnavailableException(\n+                        \"Failed to read Vs Code credentials from Mac Native Key Chain.\", e));\n+            }\n+\n+        } else if (Platform.isLinux()) {\n+\n+            try {\n+                LinuxKeyRingAccessor keyRingAccessor = new LinuxKeyRingAccessor(\n+                        \"org.freedesktop.Secret.Generic\", \"service\",\n+                        serviceName, \"account\", accountName);\n+\n+                byte[] readCreds = keyRingAccessor.read();\n+                credential = new String(readCreds, StandardCharsets.UTF_8);\n+            } catch (RuntimeException e) {\n+                throw logger.logExceptionAsError(new CredentialUnavailableException(\n+                        \"Failed to read Vs Code credentials from Linux Key Ring.\", e));\n+            }\n+\n+        } else {\n+            throw logger.logExceptionAsError(\n+                new CredentialUnavailableException(PLATFORM_NOT_SUPPORTED_ERROR));\n+        }\n+\n+        if (CoreUtils.isNullOrEmpty(credential) || !isRefreshTokenString(credential)) {\n+            throw logger.logExceptionAsError(\n+                    new CredentialUnavailableException(\"Please authenticate via Azure Tools plugin in VS Code IDE.\"));\n+        }\n+        return credential;\n+    }\n+\n+    private boolean isRefreshTokenString(String str) {\n+        for (int i = 0; i < str.length(); i++) {\n+            char ch = str.charAt(i);\n+            if ((ch < '0' || ch > '9') && (ch < 'A' || ch > 'Z') && (ch < 'a' || ch > 'z')\n+                        && ch != '_' && ch != '-' && ch != '.') {\n+                return false;\n+            }\n+        }\n+        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c23e0418f2051fe85427ffc56f359e297321d938"}, "originalPosition": 161}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MzQ0NA==", "bodyText": "String.matches() way of matching regex to String has a good perf cost.\nString matches forces the input regex to always first get compiled via a Pattern.compile() and doing it on every call comes with a perf cost.\nThere is an alternative to String.matches and retain the perf, updated with that logic.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r419163444", "createdAt": "2020-05-03T21:33:50Z", "author": {"login": "g2vinay"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "diffHunk": "@@ -0,0 +1,185 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.CredentialUnavailableException;\n+import com.azure.identity.KnownAuthorityHosts;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.aad.msal4jextensions.persistence.mac.KeyChainAccessor;\n+import com.sun.jna.Platform;\n+\n+import java.io.File;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * This class allows access to Visual Studio Code cached credential data.\n+ */\n+public class VisualStudioCacheAccessor {\n+    private static final String PLATFORM_NOT_SUPPORTED_ERROR = \"Platform could not be determined for VS Code\"\n+                                               + \" credential authentication.\";\n+    private final ClientLogger logger = new ClientLogger(VisualStudioCacheAccessor.class);\n+\n+    /**\n+     * Creates an instance of {@link VisualStudioCacheAccessor}\n+     */\n+    public VisualStudioCacheAccessor() { }\n+\n+\n+    private JsonNode getUserSettings() {\n+        JsonNode output = null;\n+        String homeDir = System.getProperty(\"user.home\");\n+        String settingsPath = \"\";\n+        ObjectMapper mapper = new ObjectMapper();\n+        try {\n+            if (Platform.isWindows()) {\n+                settingsPath = Paths.get(System.getenv(\"APPDATA\"), \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            } else if (Platform.isMac()) {\n+                settingsPath = Paths.get(homeDir, \"Library\",\n+                        \"Application Support\", \"Code\", \"User\", \"settings.json\").toString();\n+            } else if (Platform.isLinux()) {\n+                settingsPath = Paths.get(homeDir, \".config\", \"Code\", \"User\", \"settings.json\")\n+                        .toString();\n+            }  else {\n+                throw logger.logExceptionAsError(\n+                        new CredentialUnavailableException(PLATFORM_NOT_SUPPORTED_ERROR));\n+            }\n+            File settingsFile = new File(settingsPath);\n+            output = mapper.readTree(settingsFile);\n+        } catch (Exception e) {\n+            return null;\n+        }\n+        return output;\n+    }\n+\n+    /**\n+     * Get the user configured settings of Visual Studio code.\n+     *\n+     * @param tenantId the user specified tenant id.\n+     * @return a Map containing Vs Code user settings\n+     */\n+    public Map<String, String> getUserSettingsDetails(String tenantId) {\n+        JsonNode userSettings = getUserSettings();\n+        Map<String, String> details = new HashMap<>();\n+\n+        String tenant = tenantId;\n+\n+        String cloud = \"Azure\";\n+\n+        if (!userSettings.isNull()) {\n+            if (userSettings.has(\"azure.tenant\") && CoreUtils.isNullOrEmpty(tenant)) {\n+                tenant = userSettings.get(\"azure.tenant\").asText();\n+            }\n+\n+            if (userSettings.has(\"azure.cloud\")) {\n+                cloud = userSettings.get(\"azure.cloud\").asText();\n+            }\n+        }\n+\n+        details.put(\"tenant\", tenant);\n+        details.put(\"cloud\", cloud);\n+        return details;\n+    }\n+\n+\n+\n+    /**\n+     * Get the credential for the specified service and account name.\n+     *\n+     * @param serviceName the name of the service to lookup.\n+     * @param accountName the account of the service to lookup.\n+     * @return the credential.\n+     */\n+    public String getCredentials(String serviceName, String accountName) {\n+        String credential;\n+\n+        if (Platform.isWindows()) {\n+\n+            try {\n+                WindowsCredentialAccessor winCredAccessor =\n+                        new WindowsCredentialAccessor(serviceName, accountName);\n+                credential = winCredAccessor.read();\n+            } catch (RuntimeException e) {\n+                throw logger.logExceptionAsError(new CredentialUnavailableException(\n+                        \"Failed to read Vs Code credentials from Windows Credential API.\", e));\n+            }\n+\n+        } else if (Platform.isMac()) {\n+\n+            try {\n+                KeyChainAccessor keyChainAccessor = new KeyChainAccessor(null,\n+                        serviceName, accountName);\n+\n+                byte[] readCreds = keyChainAccessor.read();\n+                credential = new String(readCreds, StandardCharsets.UTF_8);\n+            } catch (RuntimeException e) {\n+                throw logger.logExceptionAsError(new CredentialUnavailableException(\n+                        \"Failed to read Vs Code credentials from Mac Native Key Chain.\", e));\n+            }\n+\n+        } else if (Platform.isLinux()) {\n+\n+            try {\n+                LinuxKeyRingAccessor keyRingAccessor = new LinuxKeyRingAccessor(\n+                        \"org.freedesktop.Secret.Generic\", \"service\",\n+                        serviceName, \"account\", accountName);\n+\n+                byte[] readCreds = keyRingAccessor.read();\n+                credential = new String(readCreds, StandardCharsets.UTF_8);\n+            } catch (RuntimeException e) {\n+                throw logger.logExceptionAsError(new CredentialUnavailableException(\n+                        \"Failed to read Vs Code credentials from Linux Key Ring.\", e));\n+            }\n+\n+        } else {\n+            throw logger.logExceptionAsError(\n+                new CredentialUnavailableException(PLATFORM_NOT_SUPPORTED_ERROR));\n+        }\n+\n+        if (CoreUtils.isNullOrEmpty(credential) || !isRefreshTokenString(credential)) {\n+            throw logger.logExceptionAsError(\n+                    new CredentialUnavailableException(\"Please authenticate via Azure Tools plugin in VS Code IDE.\"));\n+        }\n+        return credential;\n+    }\n+\n+    private boolean isRefreshTokenString(String str) {\n+        for (int i = 0; i < str.length(); i++) {\n+            char ch = str.charAt(i);\n+            if ((ch < '0' || ch > '9') && (ch < 'A' || ch > 'Z') && (ch < 'a' || ch > 'z')\n+                        && ch != '_' && ch != '-' && ch != '.') {\n+                return false;\n+            }\n+        }\n+        return true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzMzU1MQ=="}, "originalCommit": {"oid": "c23e0418f2051fe85427ffc56f359e297321d938"}, "originalPosition": 161}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMjMwMDY2OnYy", "diffSide": "RIGHT", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOToyMDo0MFrOGO3Dpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOToyMDo0MFrOGO3Dpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzNTMwMw==", "bodyText": "This ctor is not necessary.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10368#discussion_r418235303", "createdAt": "2020-04-30T19:20:40Z", "author": {"login": "srnagar"}, "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/VisualStudioCacheAccessor.java", "diffHunk": "@@ -0,0 +1,185 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.identity.implementation;\n+\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.identity.CredentialUnavailableException;\n+import com.azure.identity.KnownAuthorityHosts;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.aad.msal4jextensions.persistence.mac.KeyChainAccessor;\n+import com.sun.jna.Platform;\n+\n+import java.io.File;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * This class allows access to Visual Studio Code cached credential data.\n+ */\n+public class VisualStudioCacheAccessor {\n+    private static final String PLATFORM_NOT_SUPPORTED_ERROR = \"Platform could not be determined for VS Code\"\n+                                               + \" credential authentication.\";\n+    private final ClientLogger logger = new ClientLogger(VisualStudioCacheAccessor.class);\n+\n+    /**\n+     * Creates an instance of {@link VisualStudioCacheAccessor}\n+     */\n+    public VisualStudioCacheAccessor() { }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c23e0418f2051fe85427ffc56f359e297321d938"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4540, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}