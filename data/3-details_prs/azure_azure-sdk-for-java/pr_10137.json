{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzU0ODYx", "number": 10137, "title": "Fixed the failure of search nightly CI build", "bodyText": "https://dev.azure.com/azure-sdk/internal/_build/results?buildId=354178&view=logs&j=3d7a0212-45d0-5080-1981-6d6ef159b344&t=14d7dc25-187c-516a-cf22-fdfcecf8f884\nSteps on retry on search account creation:\n\nCreate service account.\nPing the service, and run test if succeeds, or ping the service again if fails. There is an 10 sec interval between every service ping which retry 3 times.\nIf service ping still fail, then retry on search creation again. If succeeds, then run test. If fails on already exist exception, silent on exception, continue on running tests.\nIf the creation API retry more than 3 times, then fail the test with message.\n\nStatistics:\n\nUsually, it will succeed on first creation.\nIn worst case, it will use 90 sec before test start.", "createdAt": "2020-04-13T17:40:58Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137", "merged": true, "mergeCommit": {"oid": "e9e7749eac6a92390553d3db0cc6c20c7db5d3a1"}, "closed": true, "closedAt": "2020-04-14T18:40:30Z", "author": {"login": "sima-zhu"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXSiPhAH2gAyNDAyNzU0ODYxOjMzMWQ2OTY1ODk4OTk4OWFiYzM4NzY2MDM5ODE0NTcwZjJlNTJkYTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXnYl9AFqTM5MzE2NzAwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "331d69658989989abc38766039814570f2e52da8", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/331d69658989989abc38766039814570f2e52da8", "committedDate": "2020-04-13T17:42:02Z", "message": "Fixed the failure of aggregate report"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "024207d59b389ab830f60a06a07d33fcbc59bacf", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/024207d59b389ab830f60a06a07d33fcbc59bacf", "committedDate": "2020-04-13T17:40:19Z", "message": "Fixed the failure of aggregate report"}, "afterCommit": {"oid": "331d69658989989abc38766039814570f2e52da8", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/331d69658989989abc38766039814570f2e52da8", "committedDate": "2020-04-13T17:42:02Z", "message": "Fixed the failure of aggregate report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzEzMTYz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#pullrequestreview-392313163", "createdAt": "2020-04-13T17:51:25Z", "commit": {"oid": "331d69658989989abc38766039814570f2e52da8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNzo1MToyNlrOGEu8Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNzo1MToyNlrOGEu8Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYxNjYwNw==", "bodyText": "Would rather not eagerly move to an unreleased version of Azure Core, is this being done to make testing the build from source issue more easily?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#discussion_r407616607", "createdAt": "2020-04-13T17:51:26Z", "author": {"login": "alzimmermsft"}, "path": "sdk/search/azure-search-documents/pom.xml", "diffHunk": "@@ -29,7 +29,7 @@\n     <dependency>\n       <groupId>com.azure</groupId>\n       <artifactId>azure-core</artifactId>\n-      <version>1.4.0</version> <!-- {x-version-update;com.azure:azure-core;dependency} -->\n+      <version>1.5.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core;dependency} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "331d69658989989abc38766039814570f2e52da8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzUwNjAz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#pullrequestreview-392350603", "createdAt": "2020-04-13T18:47:26Z", "commit": {"oid": "331d69658989989abc38766039814570f2e52da8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODo0NzoyNlrOGEw1lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODo0NzoyNlrOGEw1lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY0NzYzNg==", "bodyText": "You'll want to move this into the getBodyAsString overload without parameters, nothing I've found in Azure Core leverages the Charset overload.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#discussion_r407647636", "createdAt": "2020-04-13T18:47:26Z", "author": {"login": "alzimmermsft"}, "path": "sdk/core/azure-core-test/src/main/java/com/azure/core/test/http/MockHttpResponse.java", "diffHunk": "@@ -182,7 +182,7 @@ public HttpHeaders getHeaders() {\n \n         return bodyBytes == null\n                 ? Mono.empty()\n-                : Mono.just(new String(bodyBytes, charset));\n+                : Mono.just(CoreUtils.bomAwareToString(bodyBytes, getHeaderValue(\"Content-Type\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "331d69658989989abc38766039814570f2e52da8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32ace2dcbde31204c592ba836dd8150f184561f3", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/32ace2dcbde31204c592ba836dd8150f184561f3", "committedDate": "2020-04-13T18:53:54Z", "message": "Addressed feeback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNDA1NTk2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#pullrequestreview-392405596", "createdAt": "2020-04-13T20:13:05Z", "commit": {"oid": "32ace2dcbde31204c592ba836dd8150f184561f3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMDoxMzowNVrOGEznBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMDoxNDowOFrOGEzpDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY5MzA2MQ==", "bodyText": "Shouldn't the version tag also be updated when we switch to unreleased dependency?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#discussion_r407693061", "createdAt": "2020-04-13T20:13:05Z", "author": {"login": "srnagar"}, "path": "sdk/search/azure-search-documents/pom.xml", "diffHunk": "@@ -29,7 +29,7 @@\n     <dependency>\n       <groupId>com.azure</groupId>\n       <artifactId>azure-core</artifactId>\n-      <version>1.4.0</version> <!-- {x-version-update;com.azure:azure-core;dependency} -->\n+      <version>1.5.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core;dependency} -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32ace2dcbde31204c592ba836dd8150f184561f3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY5MzU4MQ==", "bodyText": "If create succeeded, then you can break out of the do-while loop.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#discussion_r407693581", "createdAt": "2020-04-13T20:14:08Z", "author": {"login": "srnagar"}, "path": "sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/test/environment/setup/AzureSearchResources.java", "diffHunk": "@@ -114,13 +115,21 @@ public void createService(TestResourceNamer testResourceNamer) {\n         System.out.println(\"Creating Azure Cognitive Search service: \" + searchServiceName);\n         int recreateCount = 0;\n         do {\n-            searchService = azure.searchServices()\n-                .define(searchServiceName)\n-                .withRegion(location)\n-                .withExistingResourceGroup(resourceGroup)\n-                .withFreeSku()\n-                .create();\n-            recreateCount += 1;\n+            try {\n+                searchService = azure.searchServices()\n+                    .define(searchServiceName)\n+                    .withRegion(location)\n+                    .withExistingResourceGroup(resourceGroup)\n+                    .withFreeSku()\n+                    .create();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32ace2dcbde31204c592ba836dd8150f184561f3"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58e4429cca100b73ea96688652c634365170f232", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/58e4429cca100b73ea96688652c634365170f232", "committedDate": "2020-04-13T21:02:08Z", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into ci_build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89a7efda6a5f3a1ea5000ccebe8925c4fa5cb01f", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/89a7efda6a5f3a1ea5000ccebe8925c4fa5cb01f", "committedDate": "2020-04-13T21:10:04Z", "message": "More changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b823970e7f52b9a136e18aef8f401daf3272773c", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b823970e7f52b9a136e18aef8f401daf3272773c", "committedDate": "2020-04-13T21:31:15Z", "message": "Reverted back as the test has passed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "088bda79ac5c28330943b301409ddc70b15b6e7c", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/088bda79ac5c28330943b301409ddc70b15b6e7c", "committedDate": "2020-04-14T16:47:45Z", "message": "Rewrite the logic"}, "afterCommit": {"oid": "b823970e7f52b9a136e18aef8f401daf3272773c", "author": {"user": {"login": "sima-zhu", "name": "Sima Zhu"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b823970e7f52b9a136e18aef8f401daf3272773c", "committedDate": "2020-04-13T21:31:15Z", "message": "Reverted back as the test has passed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTYxMzgx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#pullrequestreview-393161381", "createdAt": "2020-04-14T17:51:57Z", "commit": {"oid": "b823970e7f52b9a136e18aef8f401daf3272773c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTY3MDAy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#pullrequestreview-393167002", "createdAt": "2020-04-14T17:59:23Z", "commit": {"oid": "b823970e7f52b9a136e18aef8f401daf3272773c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1OToyNFrOGFaf7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1OToyNFrOGFaf7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzMDIyMw==", "bodyText": "We should add some delay between each retry instead of retrying with no delay.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10137#discussion_r408330223", "createdAt": "2020-04-14T17:59:24Z", "author": {"login": "srnagar"}, "path": "sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/test/environment/setup/AzureSearchResources.java", "diffHunk": "@@ -114,13 +115,21 @@ public void createService(TestResourceNamer testResourceNamer) {\n         System.out.println(\"Creating Azure Cognitive Search service: \" + searchServiceName);\n         int recreateCount = 0;\n         do {\n-            searchService = azure.searchServices()\n-                .define(searchServiceName)\n-                .withRegion(location)\n-                .withExistingResourceGroup(resourceGroup)\n-                .withFreeSku()\n-                .create();\n-            recreateCount += 1;\n+            try {\n+                searchService = azure.searchServices()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b823970e7f52b9a136e18aef8f401daf3272773c"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1052, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}