{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2ODEwMzQ1", "number": 17797, "title": "[Communication] - Identity - Auth with managed identity", "bodyText": "", "createdAt": "2020-11-24T21:57:21Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797", "merged": true, "mergeCommit": {"oid": "6e3b4ecd60dbe352971d3456d83d544273c3c24a"}, "closed": true, "closedAt": "2020-12-08T20:53:41Z", "author": {"login": "jbeauregardb"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfxGoqgBqjQwMzQ5OTU2MjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkQESCABqjQwODY1OTUzMzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ac5eaa7b50696d97f3b3b505922c5365bded31f", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4ac5eaa7b50696d97f3b3b505922c5365bded31f", "committedDate": "2020-11-24T21:55:51Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "fd9c7b75dc82612f914c13471d9bc00e09e8bcce", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fd9c7b75dc82612f914c13471d9bc00e09e8bcce", "committedDate": "2020-11-24T22:01:07Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd9c7b75dc82612f914c13471d9bc00e09e8bcce", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fd9c7b75dc82612f914c13471d9bc00e09e8bcce", "committedDate": "2020-11-24T22:01:07Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "992a4434934dbf64698208b674b2da9c1f521f65", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/992a4434934dbf64698208b674b2da9c1f521f65", "committedDate": "2020-11-24T22:04:41Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "992a4434934dbf64698208b674b2da9c1f521f65", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/992a4434934dbf64698208b674b2da9c1f521f65", "committedDate": "2020-11-24T22:04:41Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "9c7f6bf92f694375ef90326520fdb97c00a5d645", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9c7f6bf92f694375ef90326520fdb97c00a5d645", "committedDate": "2020-11-24T22:18:16Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "342331590ec63e63b18633cfb65a74015ae6a35b", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/342331590ec63e63b18633cfb65a74015ae6a35b", "committedDate": "2020-12-04T18:06:03Z", "message": "Using AzureKeyCredential in Identity SDK"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "902035be34e828171e4fa3faae68a694d846ae9f", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/902035be34e828171e4fa3faae68a694d846ae9f", "committedDate": "2020-12-04T18:06:03Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e894b4308afc95ba49403b8b866cbda8e32f4d2f", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e894b4308afc95ba49403b8b866cbda8e32f4d2f", "committedDate": "2020-12-04T18:06:04Z", "message": "Removed AzureKeyCredential"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95672cff50318bc0176d0badd7bbefd7e4d43f6b", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/95672cff50318bc0176d0badd7bbefd7e4d43f6b", "committedDate": "2020-12-04T18:06:05Z", "message": "Added tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7181c71af612b36c8ef6bc9eabcdd2d6f7d2201c", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7181c71af612b36c8ef6bc9eabcdd2d6f7d2201c", "committedDate": "2020-12-04T18:01:22Z", "message": "Merge branch 'acsAzureKeyCredential' of https://github.com/jbeauregardb/azure-sdk-for-java into acsAzureKeyCredential"}, "afterCommit": {"oid": "d2388a15749060828c94ceb87a3732f8acb4ad10", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d2388a15749060828c94ceb87a3732f8acb4ad10", "committedDate": "2020-12-04T18:11:57Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2388a15749060828c94ceb87a3732f8acb4ad10", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/d2388a15749060828c94ceb87a3732f8acb4ad10", "committedDate": "2020-12-04T18:11:57Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "5a1155e6ecdbd5c3d78bb271e06cb13208f5db4f", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5a1155e6ecdbd5c3d78bb271e06cb13208f5db4f", "committedDate": "2020-12-04T18:23:50Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a1155e6ecdbd5c3d78bb271e06cb13208f5db4f", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5a1155e6ecdbd5c3d78bb271e06cb13208f5db4f", "committedDate": "2020-12-04T18:23:50Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "76d70471cf70e302a2cde0347663fd1320ee58ed", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/76d70471cf70e302a2cde0347663fd1320ee58ed", "committedDate": "2020-12-04T18:35:43Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76d70471cf70e302a2cde0347663fd1320ee58ed", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/76d70471cf70e302a2cde0347663fd1320ee58ed", "committedDate": "2020-12-04T18:35:43Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "7f88d1dc2c5fe8e9fc0a9ac509ff84c765dc5c24", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7f88d1dc2c5fe8e9fc0a9ac509ff84c765dc5c24", "committedDate": "2020-12-04T18:49:55Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MjE5MDcz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#pullrequestreview-545219073", "createdAt": "2020-12-04T18:58:36Z", "commit": {"oid": "7f88d1dc2c5fe8e9fc0a9ac509ff84c765dc5c24"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxODo1ODozNlrOH_d4sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxODo1ODozNlrOH_d4sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMxMTk4NQ==", "bodyText": "Client libraries should not have a dependency on the azure-identity library. Is this needed by the library or should it be a test dependency?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#discussion_r536311985", "createdAt": "2020-12-04T18:58:36Z", "author": {"login": "schaabs"}, "path": "sdk/communication/azure-communication-administration/pom.xml", "diffHunk": "@@ -59,6 +59,11 @@\n       <artifactId>azure-core</artifactId>\n       <version>1.11.0</version> <!-- {x-version-update;com.azure:azure-core;dependency} -->\n     </dependency>\n+    <dependency>\n+      <groupId>com.azure</groupId>\n+      <artifactId>azure-identity</artifactId>\n+      <version>1.2.0</version> <!-- {x-version-update;com.azure:azure-identity;dependency} -->    \n+    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f88d1dc2c5fe8e9fc0a9ac509ff84c765dc5c24"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f88d1dc2c5fe8e9fc0a9ac509ff84c765dc5c24", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/7f88d1dc2c5fe8e9fc0a9ac509ff84c765dc5c24", "committedDate": "2020-12-04T18:49:55Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "ad193492f391986996f5616f961fb3d6fc7c6b98", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ad193492f391986996f5616f961fb3d6fc7c6b98", "committedDate": "2020-12-04T19:02:48Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad193492f391986996f5616f961fb3d6fc7c6b98", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/ad193492f391986996f5616f961fb3d6fc7c6b98", "committedDate": "2020-12-04T19:02:48Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "9405c8a6f6004555ea6b43ef34cac501a8d701cc", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9405c8a6f6004555ea6b43ef34cac501a8d701cc", "committedDate": "2020-12-04T19:05:04Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9405c8a6f6004555ea6b43ef34cac501a8d701cc", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/9405c8a6f6004555ea6b43ef34cac501a8d701cc", "committedDate": "2020-12-04T19:05:04Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "98176b5198592883ab1ecb5fd6cd17a047bf0567", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/98176b5198592883ab1ecb5fd6cd17a047bf0567", "committedDate": "2020-12-04T19:06:35Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "437e67f7d3896fa61c8501f79e21e70149d8eced", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/437e67f7d3896fa61c8501f79e21e70149d8eced", "committedDate": "2020-12-04T19:33:13Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98176b5198592883ab1ecb5fd6cd17a047bf0567", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/98176b5198592883ab1ecb5fd6cd17a047bf0567", "committedDate": "2020-12-04T19:06:35Z", "message": "Using DefaultAzureCredential for managed identity"}, "afterCommit": {"oid": "437e67f7d3896fa61c8501f79e21e70149d8eced", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/437e67f7d3896fa61c8501f79e21e70149d8eced", "committedDate": "2020-12-04T19:33:13Z", "message": "Using DefaultAzureCredential for managed identity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe8cf286f867858a62c23876f527e407492e7475", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fe8cf286f867858a62c23876f527e407492e7475", "committedDate": "2020-12-04T20:10:44Z", "message": "Added FakeCredential for playback tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzUxNzQ0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#pullrequestreview-545351744", "createdAt": "2020-12-04T22:56:46Z", "commit": {"oid": "fe8cf286f867858a62c23876f527e407492e7475"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMjo1Njo0N1rOH_lP5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMzowMjozM1rOH_lYZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQzMjYxMw==", "bodyText": "Do you need the create the authPolicy variable? Can we just return directly?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#discussion_r536432613", "createdAt": "2020-12-04T22:56:47Z", "author": {"login": "minnieliu"}, "path": "sdk/communication/azure-communication-administration/src/main/java/com/azure/communication/administration/CommunicationIdentityClientBuilder.java", "diffHunk": "@@ -203,6 +216,20 @@ private CommunicationIdentityClientImpl createServiceImpl() {\n         return clientBuilder.buildClient();\n     }\n \n+    private HttpPipelinePolicy createHttpPipelineAuthPolicy() {\n+        HttpPipelinePolicy authPolicy;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe8cf286f867858a62c23876f527e407492e7475"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQzNDc5MA==", "bodyText": "Can we make sure that the Id is redacted?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#discussion_r536434790", "createdAt": "2020-12-04T23:02:33Z", "author": {"login": "minnieliu"}, "path": "sdk/communication/azure-communication-administration/src/test/resources/session-records/createAsyncIdentityClientUsingManagedIdentity.json", "diffHunk": "@@ -0,0 +1,25 @@\n+{\n+    \"networkCallRecords\" : [ {\n+      \"Method\" : \"POST\",\n+      \"Uri\" : \"https://REDACTED.communication.azure.com/identities?api-version=2020-07-20-preview2\",\n+      \"Headers\" : {\n+        \"User-Agent\" : \"azsdk-java-azure-communication-administration/1.0.0-beta.4 (11.0.8; Windows 10; 10.0)\"\n+      },\n+      \"Response\" : {\n+        \"Transfer-Encoding\" : \"chunked\",\n+        \"Strict-Transport-Security\" : \"max-age=2592000\",\n+        \"api-supported-versions\" : \"2020-01-15-preview3, 2020-07-20-preview1, 2020-07-20-preview2\",\n+        \"X-Processing-Time\" : \"894ms\",\n+        \"MS-CV\" : \"ibeQW1NtqEWkUrrghlaQHg.0\",\n+        \"retry-after\" : \"0\",\n+        \"X-Azure-Ref\" : \"0KmzJXwAAAADyBVf0Du24TofZ8x38MV62TEFYRURHRTEyMjEAOWZjN2I1MTktYThjYy00Zjg5LTkzNWUtYzkxNDhhZTA5ZTgx\",\n+        \"StatusCode\" : \"200\",\n+        \"Body\" : \"{\\\"id\\\":\\\"8:acs:bff431b2-eb28-43ab-b2fc-546ea8974212_00000006-cab0-2e34-8337-3b3a0d0000b7\\\"}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe8cf286f867858a62c23876f527e407492e7475"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NDQzNjEz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#pullrequestreview-546443613", "createdAt": "2020-12-07T18:58:07Z", "commit": {"oid": "22130b4e3b71ac5d1ac44677f8d42ef775e4823f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODo1ODowN1rOIA1t1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxOTowNjowM1rOIA2BjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc1MDk5Nw==", "bodyText": "nit: remove extra blank line.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#discussion_r537750997", "createdAt": "2020-12-07T18:58:07Z", "author": {"login": "srnagar"}, "path": "sdk/communication/azure-communication-administration/src/main/java/com/azure/communication/administration/CommunicationIdentityClientBuilder.java", "diffHunk": "@@ -68,6 +73,19 @@ public CommunicationIdentityClientBuilder pipeline(HttpPipeline pipeline) {\n         return this;\n     }\n \n+    /**\n+     * Sets the {@link TokenCredential} used to authenticate HTTP requests.\n+     *\n+     * @param tokenCredential {@link TokenCredential} used to authenticate HTTP requests.\n+     * @return The updated {@link CommunicationIdentityClientBuilder} object.\n+     * @throws NullPointerException If {@code tokenCredential} is null.\n+     */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22130b4e3b71ac5d1ac44677f8d42ef775e4823f"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc1NTA2NA==", "bodyText": "If both are set, do we want to throw or prioritize tokenCredential?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#discussion_r537755064", "createdAt": "2020-12-07T19:04:31Z", "author": {"login": "srnagar"}, "path": "sdk/communication/azure-communication-administration/src/main/java/com/azure/communication/administration/CommunicationIdentityClientBuilder.java", "diffHunk": "@@ -203,6 +216,18 @@ private CommunicationIdentityClientImpl createServiceImpl() {\n         return clientBuilder.buildClient();\n     }\n \n+    private HttpPipelinePolicy createHttpPipelineAuthPolicy() {\n+        if (this.tokenCredential != null) { \n+            return new BearerTokenAuthenticationPolicy(\n+                this.tokenCredential, \"https://communication.azure.com//.default\");          \n+        } else if (this.credential != null) {\n+            return new HmacAuthenticationPolicy(this.credential);            \n+        } else {\n+            throw logger.logExceptionAsError(\n+                new IllegalArgumentException(\"Missing credential information while building a client.\"));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22130b4e3b71ac5d1ac44677f8d42ef775e4823f"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc1NjA0NQ==", "bodyText": "nit: else should be in the previous line along with }", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#discussion_r537756045", "createdAt": "2020-12-07T19:06:03Z", "author": {"login": "srnagar"}, "path": "sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityClientTestBase.java", "diffHunk": "@@ -30,6 +36,26 @@ protected CommunicationIdentityClientBuilder getCommunicationIdentityClient(Http\n         builder.endpoint(ENDPOINT)\n             .accessKey(ACCESSKEY)\n             .httpClient(httpClient == null ? interceptorManager.getPlaybackClient() : httpClient);\n+       \n+        if (getTestMode() == TestMode.RECORD) {\n+            builder.addPolicy(interceptorManager.getRecordPolicy());\n+        }\n+\n+        return builder;\n+    }\n+\n+    protected CommunicationIdentityClientBuilder getCommunicationIdentityClientBuilderUsingManagedIdentity(HttpClient httpClient) {\n+        CommunicationIdentityClientBuilder builder = new CommunicationIdentityClientBuilder();\n+        builder\n+            .endpoint(ENDPOINT)\n+            .httpClient(httpClient == null ? interceptorManager.getPlaybackClient() : httpClient);\n+        \n+        if (getTestMode() == TestMode.PLAYBACK) {\n+            builder.credential(new FakeCredentials());\n+        }\n+        else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22130b4e3b71ac5d1ac44677f8d42ef775e4823f"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4a6c2d535cab9cf935775566daebd26aa5aa766", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e4a6c2d535cab9cf935775566daebd26aa5aa766", "committedDate": "2020-12-07T21:53:45Z", "message": "Addressed comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22130b4e3b71ac5d1ac44677f8d42ef775e4823f", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/22130b4e3b71ac5d1ac44677f8d42ef775e4823f", "committedDate": "2020-12-07T17:47:32Z", "message": "Addressed comments"}, "afterCommit": {"oid": "e4a6c2d535cab9cf935775566daebd26aa5aa766", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e4a6c2d535cab9cf935775566daebd26aa5aa766", "committedDate": "2020-12-07T21:53:45Z", "message": "Addressed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDEzNTE2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#pullrequestreview-547413516", "createdAt": "2020-12-08T16:36:28Z", "commit": {"oid": "b123c31a487c1cc6b40f07ed827a458856162bf6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjozNjoyOFrOIBoGJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjozNjoyOFrOIBoGJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU3NjQyMw==", "bodyText": "Instead of implementing a FakeCredential you can just use the AzureKeyCredential and delete your class.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        builder.credential(new FakeCredentials());\n          \n          \n            \n                        builder.credential(new AzureKeyCredential(\"invalid key\"));", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#discussion_r538576423", "createdAt": "2020-12-08T16:36:28Z", "author": {"login": "DominikMe"}, "path": "sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityClientTestBase.java", "diffHunk": "@@ -30,6 +36,25 @@ protected CommunicationIdentityClientBuilder getCommunicationIdentityClient(Http\n         builder.endpoint(ENDPOINT)\n             .accessKey(ACCESSKEY)\n             .httpClient(httpClient == null ? interceptorManager.getPlaybackClient() : httpClient);\n+       \n+        if (getTestMode() == TestMode.RECORD) {\n+            builder.addPolicy(interceptorManager.getRecordPolicy());\n+        }\n+\n+        return builder;\n+    }\n+\n+    protected CommunicationIdentityClientBuilder getCommunicationIdentityClientBuilderUsingManagedIdentity(HttpClient httpClient) {\n+        CommunicationIdentityClientBuilder builder = new CommunicationIdentityClientBuilder();\n+        builder\n+            .endpoint(ENDPOINT)\n+            .httpClient(httpClient == null ? interceptorManager.getPlaybackClient() : httpClient);\n+        \n+        if (getTestMode() == TestMode.PLAYBACK) {\n+            builder.credential(new FakeCredentials());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b123c31a487c1cc6b40f07ed827a458856162bf6"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b123c31a487c1cc6b40f07ed827a458856162bf6", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/b123c31a487c1cc6b40f07ed827a458856162bf6", "committedDate": "2020-12-08T16:14:24Z", "message": "Changed credential policy priority"}, "afterCommit": {"oid": "371d485dc984a7f51783babc64e6c2b8cbe37e4e", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/371d485dc984a7f51783babc64e6c2b8cbe37e4e", "committedDate": "2020-12-08T17:28:08Z", "message": "Changed credential policy priority"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDc0MTY2", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#pullrequestreview-547474166", "createdAt": "2020-12-08T17:41:45Z", "commit": {"oid": "371d485dc984a7f51783babc64e6c2b8cbe37e4e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDc0NTU0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#pullrequestreview-547474554", "createdAt": "2020-12-08T17:42:16Z", "commit": {"oid": "371d485dc984a7f51783babc64e6c2b8cbe37e4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NTE5Mjg0", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#pullrequestreview-547519284", "createdAt": "2020-12-08T18:38:25Z", "commit": {"oid": "371d485dc984a7f51783babc64e6c2b8cbe37e4e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODozODoyNlrOIBwHsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODozOToxOFrOIBwLGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODcwNzg4OA==", "bodyText": "We should not change the value of accessKeyCredential the user has already set. This will silently set the value to null and the user will not know about it - logs are not always noticed. I would rather do the validation at the very end when build*Client is called. Check if both are set and then throw an exception.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#discussion_r538707888", "createdAt": "2020-12-08T18:38:26Z", "author": {"login": "srnagar"}, "path": "sdk/communication/azure-communication-administration/src/main/java/com/azure/communication/administration/CommunicationIdentityClientBuilder.java", "diffHunk": "@@ -68,6 +73,22 @@ public CommunicationIdentityClientBuilder pipeline(HttpPipeline pipeline) {\n         return this;\n     }\n \n+    /**\n+     * Sets the {@link TokenCredential} used to authenticate HTTP requests.\n+     *\n+     * @param tokenCredential {@link TokenCredential} used to authenticate HTTP requests.\n+     * @return The updated {@link CommunicationIdentityClientBuilder} object.\n+     * @throws NullPointerException If {@code tokenCredential} is null.\n+     */\n+    public CommunicationIdentityClientBuilder credential(TokenCredential tokenCredential) {\n+        this.tokenCredential = Objects.requireNonNull(tokenCredential, \"'tokenCredential' cannot be null.\");\n+        if (accessKeyCredential != null) {\n+            logger.info(\"'accessKey' is being replaced with 'credential', only one authorization method can be used.\");\n+            this.accessKeyCredential = null;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "371d485dc984a7f51783babc64e6c2b8cbe37e4e"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODcwODc2Mw==", "bodyText": "This is good! Since we have this check here, we don't need to do any validation in the setter methods above.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17797#discussion_r538708763", "createdAt": "2020-12-08T18:39:18Z", "author": {"login": "srnagar"}, "path": "sdk/communication/azure-communication-administration/src/main/java/com/azure/communication/administration/CommunicationIdentityClientBuilder.java", "diffHunk": "@@ -203,6 +223,22 @@ private CommunicationIdentityClientImpl createServiceImpl() {\n         return clientBuilder.buildClient();\n     }\n \n+    private HttpPipelinePolicy createHttpPipelineAuthPolicy() {\n+        if (this.tokenCredential != null && this.accessKeyCredential != null) {\n+            throw logger.logExceptionAsError(\n+                new IllegalArgumentException(\"Both 'credential' and 'accessKey' are set. Just one may be used.\"));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "371d485dc984a7f51783babc64e6c2b8cbe37e4e"}, "originalPosition": 94}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "598a40d465000fcab215ef5b1a9301978b31a5e2", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/598a40d465000fcab215ef5b1a9301978b31a5e2", "committedDate": "2020-12-08T19:08:47Z", "message": "Changed credential policy priority"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "371d485dc984a7f51783babc64e6c2b8cbe37e4e", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/371d485dc984a7f51783babc64e6c2b8cbe37e4e", "committedDate": "2020-12-08T17:28:08Z", "message": "Changed credential policy priority"}, "afterCommit": {"oid": "598a40d465000fcab215ef5b1a9301978b31a5e2", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/598a40d465000fcab215ef5b1a9301978b31a5e2", "committedDate": "2020-12-08T19:08:47Z", "message": "Changed credential policy priority"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6225e3a6576da1cbeaaea0cd57eb339d67f97886", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6225e3a6576da1cbeaaea0cd57eb339d67f97886", "committedDate": "2020-12-08T20:21:27Z", "message": "Added sync test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc569a77c10b65fa29e587251f97a8e64d44c33b", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fc569a77c10b65fa29e587251f97a8e64d44c33b", "committedDate": "2020-12-08T19:28:55Z", "message": "Added sync test"}, "afterCommit": {"oid": "6225e3a6576da1cbeaaea0cd57eb339d67f97886", "author": {"user": {"login": "jbeauregardb", "name": "Jorge Beauregard"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/6225e3a6576da1cbeaaea0cd57eb339d67f97886", "committedDate": "2020-12-08T20:21:27Z", "message": "Added sync test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1490, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}