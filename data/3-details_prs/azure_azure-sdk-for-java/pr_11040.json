{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MzYwOTI5", "number": 11040, "title": "Migrate Search Live Testing to Use a Single Service Instance", "bodyText": "This PR updates the Search service tests to use a single service instance for the entire test run instead of create a new service per tests.", "createdAt": "2020-05-11T21:33:40Z", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040", "merged": true, "mergeCommit": {"oid": "267f2127fffa8e81f77cfb9c9a7047e6307350c4"}, "closed": true, "closedAt": "2020-05-13T03:51:12Z", "author": {"login": "alzimmermsft"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfCnayAH2gAyNDE2MzYwOTI5OmMzYjBmZTBhZmUzZTkxZTc1MTU0Y2IzYjU1NTgzZjVmMjk2OWVhNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgtjdVgH2gAyNDE2MzYwOTI5OjU2NDY5ODhkMzk3YjE3ZDRiMTQ4MzJkMmMwODI2ZWMxOTk2N2Q2MTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c3b0fe0afe3e91e75154cb3b55583f5f2969ea46", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/c3b0fe0afe3e91e75154cb3b55583f5f2969ea46", "committedDate": "2020-05-07T19:40:36Z", "message": "Update Search tests to use single resource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "766e780a85b0854b559f8ca2ea8a2ca47a626a44", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/766e780a85b0854b559f8ca2ea8a2ca47a626a44", "committedDate": "2020-05-07T21:40:53Z", "message": "Update some test code, add container creation to template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67e702cb1f3d249d380c02ce3c8cc889dd7dcb37", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/67e702cb1f3d249d380c02ce3c8cc889dd7dcb37", "committedDate": "2020-05-07T21:47:53Z", "message": "Merge branch 'master' into AzSearch_UseSingleSearchServiceInTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f53ede972c27e08be9051d4a299f3063d46da486", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f53ede972c27e08be9051d4a299f3063d46da486", "committedDate": "2020-05-08T17:33:44Z", "message": "Updated some tests to cleanup after their run"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "076f028f578e1d1e4759c90747a6d40cf80ca44a", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/076f028f578e1d1e4759c90747a6d40cf80ca44a", "committedDate": "2020-05-08T20:14:38Z", "message": "Update more tests to track and delete resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5d84ca2bd3e7d498c04eefef9a18cd414b0a668", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/f5d84ca2bd3e7d498c04eefef9a18cd414b0a668", "committedDate": "2020-05-08T21:41:23Z", "message": "More unit test updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "702149bdfeba11ba40a4500f5ebc15cb8dc5e36c", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/702149bdfeba11ba40a4500f5ebc15cb8dc5e36c", "committedDate": "2020-05-08T22:55:44Z", "message": "Moving some testing code, fixed deletion of wrong resource type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "559def2633486f13a732d5f41f4c199742ed1687", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/559def2633486f13a732d5f41f4c199742ed1687", "committedDate": "2020-05-08T23:09:19Z", "message": "Merge branch 'master' into AzSearch_UseSingleSearchServiceInTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62a917810b6a5995a4a66dac162841efd2c68dc5", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/62a917810b6a5995a4a66dac162841efd2c68dc5", "committedDate": "2020-05-09T01:57:23Z", "message": "Fixing failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17a1dc02edde4fad8982aa938f431d9ee37fb6d3", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/17a1dc02edde4fad8982aa938f431d9ee37fb6d3", "committedDate": "2020-05-11T16:14:45Z", "message": "Merge branch 'master' into AzSearch_UseSingleSearchServiceInTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa0e637fe01c92b15e42334c8f0fd4b9d31b44fe", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/fa0e637fe01c92b15e42334c8f0fd4b9d31b44fe", "committedDate": "2020-05-11T19:03:13Z", "message": "Finish updating tests and re-recording playback records"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93099997cc02ac17155338f82fe761bfbc4768f6", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/93099997cc02ac17155338f82fe761bfbc4768f6", "committedDate": "2020-05-11T20:15:34Z", "message": "Merge branch 'master' into AzSearch_UseSingleSearchServiceInTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b3d058521612d7fe2b573b27bd0ea22b99e37c3", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/2b3d058521612d7fe2b573b27bd0ea22b99e37c3", "committedDate": "2020-05-11T20:24:25Z", "message": "Fix linting issue, re-record a few failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b261e6db3f78371be66495406cdf192b673a551", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4b261e6db3f78371be66495406cdf192b673a551", "committedDate": "2020-05-11T20:50:00Z", "message": "Update a few tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b498c01e1b5bfe615007f04d775929ddcda889e", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4b498c01e1b5bfe615007f04d775929ddcda889e", "committedDate": "2020-05-12T16:15:09Z", "message": "Merge branch 'master' into AzSearch_UsingSingleSearchServiceInTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1862fd0fec9d8c535f13feede3e65fad4506fa3c", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/1862fd0fec9d8c535f13feede3e65fad4506fa3c", "committedDate": "2020-05-12T16:27:20Z", "message": "Add missing ')'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4896ea6ba69c7441a9c120fb2e50497cfd3241cd", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/4896ea6ba69c7441a9c120fb2e50497cfd3241cd", "committedDate": "2020-05-12T16:34:45Z", "message": "Fix variable name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91110973e06fbab1996ac6d96e416cb9ff631544", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/91110973e06fbab1996ac6d96e416cb9ff631544", "committedDate": "2020-05-12T18:56:02Z", "message": "Fix deployment template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21c892dac221dfbcec97c170c11bca344f516e65", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/21c892dac221dfbcec97c170c11bca344f516e65", "committedDate": "2020-05-12T19:11:55Z", "message": "Set parallel job limit to 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzkwMjUw", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#pullrequestreview-410390250", "createdAt": "2020-05-12T20:18:26Z", "commit": {"oid": "21c892dac221dfbcec97c170c11bca344f516e65"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDoxODoyNlrOGUXZnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDoxODoyNlrOGUXZnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAwODA5Mg==", "bodyText": "There is an ongoing effort to change these to NOT preface with \"AZURE_\", and just \"SEARCH_...\". If that is too big a change, though, probably don't worry about it here.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#discussion_r424008092", "createdAt": "2020-05-12T20:18:26Z", "author": {"login": "heaths"}, "path": "sdk/search/test-resources.json", "diffHunk": "@@ -1,8 +1,111 @@\n {\n-    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n-    \"contentVersion\": \"1.0.0.0\",\n-    \"parameters\": {},\n-    \"variables\": {},\n-    \"resources\": [],\n-    \"outputs\": {}\n+  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n+  \"contentVersion\": \"1.0.0.0\",\n+  \"parameters\": {\n+      \"baseName\": {\n+          \"type\": \"string\",\n+          \"defaultValue\": \"[resourceGroup().name]\",\n+          \"metadata\": {\n+              \"description\": \"The base resource name.\"\n+          }\n+      },\n+      \"location\": {\n+          \"type\": \"string\",\n+          \"defaultValue\": \"[resourceGroup().location]\",\n+          \"metadata\": {\n+              \"description\": \"The location of the resource. By default, this is the same as the resource group.\"\n+          }\n+      },\n+      \"searchSku\": {\n+          \"type\": \"string\",\n+          \"defaultValue\": \"basic\",\n+          \"allowedValues\": [\n+              \"free\",\n+              \"basic\",\n+              \"standard\"\n+          ],\n+          \"metadata\": {\n+              \"description\": \"The Search service SKU to create.\"\n+          }\n+      }\n+  },\n+  \"variables\": {\n+      \"searchServiceName\": \"[concat('azs-java-', parameters('baseName'))]\",\n+      \"searchApiVersion\": \"2020-03-13\",\n+      \"storageAccountName\": \"[concat('azsstg', parameters('baseName'))]\",\n+      \"storageContainerName\": \"[concat('azscontainer', parameters('baseName'))]\",\n+      \"storageApiVersion\": \"2019-06-01\"\n+  },\n+  \"resources\": [\n+      {\n+          \"name\": \"[variables('searchServiceName')]\",\n+          \"type\": \"Microsoft.Search/searchServices\",\n+          \"apiVersion\": \"[variables('searchApiVersion')]\",\n+          \"location\": \"[parameters('location')]\",\n+          \"sku\": {\n+              \"name\": \"[parameters('searchSku')]\"\n+          },\n+          \"properties\": {\n+              \"replicaCount\": 1,\n+              \"partitionCount\": 1,\n+              \"hostingMode\": \"default\",\n+              \"publicNetworkAccess\": \"Enabled\",\n+              \"networkRuleSet\": {\n+                  \"ipRules\": []\n+              }\n+          }\n+      },\n+      {\n+          \"name\": \"[variables('storageAccountName')]\",\n+          \"type\": \"Microsoft.Storage/storageAccounts\",\n+          \"apiVersion\": \"[variables('storageApiVersion')]\",\n+          \"location\": \"[parameters('location')]\",\n+          \"properties\": {\n+              \"accessTier\": \"Hot\",\n+              \"supportsHttpsTrafficOnly\": true\n+          },\n+          \"sku\": {\n+              \"name\": \"Standard_LRS\",\n+              \"tier\": \"Standard\"\n+          },\n+          \"kind\": \"StorageV2\",\n+          \"resources\": [\n+            {\n+              \"type\": \"blobServices/containers\",\n+              \"name\": \"[concat('default/', variables('storageContainerName'))]\",\n+              \"apiVersion\": \"[variables('storageApiVersion')]\",\n+              \"properties\": {},\n+              \"dependsOn\": [\n+                \"[variables('storageAccountName')]\"\n+              ]\n+            }\n+          ]\n+      }\n+  ],\n+  \"outputs\": {\n+      \"AZURE_SEARCH_SERVICE_ENDPOINT\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c892dac221dfbcec97c170c11bca344f516e65"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzk1OTIy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#pullrequestreview-410395922", "createdAt": "2020-05-12T20:27:00Z", "commit": {"oid": "21c892dac221dfbcec97c170c11bca344f516e65"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDoyNzowMFrOGUXrTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDoyNzo0M1rOGUXs1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAxMjYyMA==", "bodyText": "Guidance from the Engineering team is not include hardcoded endpoint suffixes but keep them configurable esp for storage since they do not resolve correctly in Azure public clouds.\nMore info - #10380 (comment)", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#discussion_r424012620", "createdAt": "2020-05-12T20:27:00Z", "author": {"login": "samvaity"}, "path": "sdk/search/test-resources.json", "diffHunk": "@@ -1,8 +1,111 @@\n {\n-    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n-    \"contentVersion\": \"1.0.0.0\",\n-    \"parameters\": {},\n-    \"variables\": {},\n-    \"resources\": [],\n-    \"outputs\": {}\n+  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n+  \"contentVersion\": \"1.0.0.0\",\n+  \"parameters\": {\n+      \"baseName\": {\n+          \"type\": \"string\",\n+          \"defaultValue\": \"[resourceGroup().name]\",\n+          \"metadata\": {\n+              \"description\": \"The base resource name.\"\n+          }\n+      },\n+      \"location\": {\n+          \"type\": \"string\",\n+          \"defaultValue\": \"[resourceGroup().location]\",\n+          \"metadata\": {\n+              \"description\": \"The location of the resource. By default, this is the same as the resource group.\"\n+          }\n+      },\n+      \"searchSku\": {\n+          \"type\": \"string\",\n+          \"defaultValue\": \"basic\",\n+          \"allowedValues\": [\n+              \"free\",\n+              \"basic\",\n+              \"standard\"\n+          ],\n+          \"metadata\": {\n+              \"description\": \"The Search service SKU to create.\"\n+          }\n+      }\n+  },\n+  \"variables\": {\n+      \"searchServiceName\": \"[concat('azs-java-', parameters('baseName'))]\",\n+      \"searchApiVersion\": \"2020-03-13\",\n+      \"storageAccountName\": \"[concat('azsstg', parameters('baseName'))]\",\n+      \"storageContainerName\": \"[concat('azscontainer', parameters('baseName'))]\",\n+      \"storageApiVersion\": \"2019-06-01\"\n+  },\n+  \"resources\": [\n+      {\n+          \"name\": \"[variables('searchServiceName')]\",\n+          \"type\": \"Microsoft.Search/searchServices\",\n+          \"apiVersion\": \"[variables('searchApiVersion')]\",\n+          \"location\": \"[parameters('location')]\",\n+          \"sku\": {\n+              \"name\": \"[parameters('searchSku')]\"\n+          },\n+          \"properties\": {\n+              \"replicaCount\": 1,\n+              \"partitionCount\": 1,\n+              \"hostingMode\": \"default\",\n+              \"publicNetworkAccess\": \"Enabled\",\n+              \"networkRuleSet\": {\n+                  \"ipRules\": []\n+              }\n+          }\n+      },\n+      {\n+          \"name\": \"[variables('storageAccountName')]\",\n+          \"type\": \"Microsoft.Storage/storageAccounts\",\n+          \"apiVersion\": \"[variables('storageApiVersion')]\",\n+          \"location\": \"[parameters('location')]\",\n+          \"properties\": {\n+              \"accessTier\": \"Hot\",\n+              \"supportsHttpsTrafficOnly\": true\n+          },\n+          \"sku\": {\n+              \"name\": \"Standard_LRS\",\n+              \"tier\": \"Standard\"\n+          },\n+          \"kind\": \"StorageV2\",\n+          \"resources\": [\n+            {\n+              \"type\": \"blobServices/containers\",\n+              \"name\": \"[concat('default/', variables('storageContainerName'))]\",\n+              \"apiVersion\": \"[variables('storageApiVersion')]\",\n+              \"properties\": {},\n+              \"dependsOn\": [\n+                \"[variables('storageAccountName')]\"\n+              ]\n+            }\n+          ]\n+      }\n+  ],\n+  \"outputs\": {\n+      \"AZURE_SEARCH_SERVICE_ENDPOINT\": {\n+          \"type\": \"string\",\n+          \"value\": \"[concat('https://', variables('searchServiceName'), '.search.windows.net')]\"\n+      },\n+      \"AZURE_SEARCH_SERVICE_API_KEY\": {\n+          \"type\": \"string\",\n+          \"value\": \"[listAdminKeys(variables('searchServiceName'), variables('searchApiVersion')).primaryKey]\"\n+      },\n+      \"AZURE_SEARCH_QUERY_API_KEY\": {\n+          \"type\": \"string\",\n+          \"value\": \"[listQueryKeys(variables('searchServiceName'), variables('searchApiVersion')).value[0].key]\"\n+      },\n+      \"AZURE_SEARCH_STORAGE_NAME\": {\n+          \"type\": \"string\",\n+          \"value\": \"[variables('storageAccountName')]\"\n+      },\n+      \"AZURE_SEARCH_STORAGE_CONNECTION_STRING\": {\n+        \"type\": \"string\",\n+        \"value\": \"[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageAccountName'), ';AccountKey=', listKeys(variables('storageAccountName'), variables('storageApiVersion')).keys[0].value, ';EndpointSuffix=core.windows.net')]\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c892dac221dfbcec97c170c11bca344f516e65"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAxMzAxMw==", "bodyText": "Can these variables be deleted now that we have the test-resources.json file?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#discussion_r424013013", "createdAt": "2020-05-12T20:27:43Z", "author": {"login": "samvaity"}, "path": "sdk/search/tests.yml", "diffHunk": "@@ -5,6 +5,7 @@ jobs:\n     parameters:\n       ServiceDirectory: search\n       Timeout: 120\n+      MaxParallel: 2\n       EnvVars:\n         AZURE_TEST_MODE: LIVE\n         AZURE_TENANT_ID: $(aad-azure-sdk-test-tenant-id)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c892dac221dfbcec97c170c11bca344f516e65"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62e0385aaae72df57a4636e1a675e0e397bbb723", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/62e0385aaae72df57a4636e1a675e0e397bbb723", "committedDate": "2020-05-12T21:21:34Z", "message": "Merge branch 'master' into AzSearch_UsingSingleSearchServiceInTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db1b82af137cf126c17bb5f3c767c544cceb112e", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/db1b82af137cf126c17bb5f3c767c544cceb112e", "committedDate": "2020-05-12T21:30:24Z", "message": "Updates based on reviews"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDQxOTAy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#pullrequestreview-410441902", "createdAt": "2020-05-12T21:39:01Z", "commit": {"oid": "db1b82af137cf126c17bb5f3c767c544cceb112e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMTozOTowMVrOGUZ5hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMTozOTowMVrOGUZ5hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA0OTAyOA==", "bodyText": "storage end point \ud83e\udd14", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#discussion_r424049028", "createdAt": "2020-05-12T21:39:01Z", "author": {"login": "samvaity"}, "path": "sdk/search/test-resources.json", "diffHunk": "@@ -1,8 +1,121 @@\n {\n-    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n-    \"contentVersion\": \"1.0.0.0\",\n-    \"parameters\": {},\n-    \"variables\": {},\n-    \"resources\": [],\n-    \"outputs\": {}\n+  \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n+  \"contentVersion\": \"1.0.0.0\",\n+  \"parameters\": {\n+    \"baseName\": {\n+      \"type\": \"string\",\n+      \"defaultValue\": \"[resourceGroup().name]\",\n+      \"metadata\": {\n+        \"description\": \"The base resource name.\"\n+      }\n+    },\n+    \"searchEndpointSuffix\": {\n+      \"type\": \"string\",\n+      \"defaultValue\": \"search.windows.net\",\n+      \"metadata\": {\n+        \"description\": \"The Search service endpoint suffix.\"\n+      }\n+    },\n+    \"storageEndpointSuffix\": {\n+      \"type\": \"string\",\n+      \"defaultValue\": \"search.windows.net\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db1b82af137cf126c17bb5f3c767c544cceb112e"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDQxNDUy", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#pullrequestreview-410441452", "createdAt": "2020-05-12T21:38:15Z", "commit": {"oid": "db1b82af137cf126c17bb5f3c767c544cceb112e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMTozODoxNlrOGUZ4Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMTo0MDozOFrOGUZ8lQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA0ODY3OA==", "bodyText": "Is it better to clean up the indexesToCleanup after test or re-initiate before run?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#discussion_r424048678", "createdAt": "2020-05-12T21:38:16Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/CustomAnalyzerSyncTests.java", "diffHunk": "@@ -79,33 +82,32 @@\n import java.util.List;\n import java.util.concurrent.atomic.AtomicInteger;\n import java.util.stream.Collectors;\n-import org.junit.jupiter.api.Assertions;\n-import org.junit.jupiter.api.Test;\n \n+import static com.azure.search.documents.TestHelpers.assertHttpResponseException;\n import static com.azure.search.documents.TestHelpers.assertObjectEquals;\n+import static com.azure.search.documents.TestHelpers.generateRequestOptions;\n+import static com.azure.search.documents.TestHelpers.waitForIndexing;\n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n \n-public class CustomAnalyzerSyncTests extends SearchServiceTestBase {\n+public class CustomAnalyzerSyncTests extends SearchTestBase {\n     private static final String NAME_PREFIX = \"azsmnet\";\n+    private static final Collection<CharFilterName> CHAR_FILTER_NAMES = new ArrayList<>(CharFilterName.values());\n \n     private SearchServiceClient searchServiceClient;\n-    private static Collection<CharFilterName> charFilterNames;\n-\n-    static {\n-        getAllCharFilterName();\n-    }\n+    private final List<String> indexesToCleanup = new ArrayList<>();\n \n     @Override\n     protected void beforeTest() {\n         super.beforeTest();\n         searchServiceClient = getSearchServiceClientBuilder().buildClient();\n     }\n \n-    private static void getAllCharFilterName() {\n-        charFilterNames = new ArrayList<>();\n-        for (CharFilterName name : CharFilterName.values()) {\n-            charFilterNames.add(name);\n+    @Override\n+    protected void afterTest() {\n+        super.afterTest();\n+        for (String index : indexesToCleanup) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db1b82af137cf126c17bb5f3c767c544cceb112e"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA0OTU1Mg==", "bodyText": "Same here.\nI have concern which the list has more sources than expected and throw no resource error.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#discussion_r424049552", "createdAt": "2020-05-12T21:40:05Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/DataSourceSyncTests.java", "diffHunk": "@@ -6,65 +6,57 @@\n import com.azure.core.exception.HttpResponseException;\n import com.azure.core.http.rest.Response;\n import com.azure.core.util.Context;\n+import com.azure.core.util.CoreUtils;\n import com.azure.search.documents.models.DataContainer;\n import com.azure.search.documents.models.DataDeletionDetectionPolicy;\n import com.azure.search.documents.models.DataSource;\n import com.azure.search.documents.models.DataSourceCredentials;\n import com.azure.search.documents.models.DataSourceType;\n import com.azure.search.documents.models.HighWaterMarkChangeDetectionPolicy;\n import com.azure.search.documents.models.RequestOptions;\n+import com.azure.search.documents.models.SearchErrorException;\n import com.azure.search.documents.models.SoftDeleteColumnDeletionDetectionPolicy;\n import com.azure.search.documents.models.SqlIntegratedChangeTrackingPolicy;\n-import com.azure.search.documents.test.AccessConditionTests;\n-import com.azure.search.documents.test.AccessOptions;\n-import io.netty.handler.codec.http.HttpResponseStatus;\n import org.junit.jupiter.api.Test;\n \n import java.net.HttpURLConnection;\n+import java.util.ArrayList;\n import java.util.Iterator;\n-import java.util.function.BiConsumer;\n-import java.util.function.BiFunction;\n-import java.util.function.Function;\n-import java.util.function.Supplier;\n+import java.util.List;\n \n+import static com.azure.search.documents.TestHelpers.BLOB_DATASOURCE_TEST_NAME;\n+import static com.azure.search.documents.TestHelpers.assertHttpResponseException;\n+import static com.azure.search.documents.TestHelpers.generateRequestOptions;\n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertNotEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.fail;\n \n-public class DataSourceSyncTests extends SearchServiceTestBase {\n+public class DataSourceSyncTests extends SearchTestBase {\n     private static final String FAKE_DESCRIPTION = \"Some data source\";\n     private static final String FAKE_STORAGE_CONNECTION_STRING =\n         \"DefaultEndpointsProtocol=https;AccountName=NotaRealAccount;AccountKey=fake;\";\n     private static final String FAKE_COSMOS_CONNECTION_STRING =\n         \"AccountEndpoint=https://NotaRealAccount.documents.azure.com;AccountKey=fake;Database=someFakeDatabase\";\n \n+    private final List<String> dataSourcesToDelete = new ArrayList<>();\n     private SearchServiceClient client;\n \n-    // commonly used lambda definitions\n-    private BiFunction<DataSource, AccessOptions, DataSource> createOrUpdateDataSourceFunc =\n-        (DataSource ds, AccessOptions ac) ->\n-            createOrUpdateDataSource(ds, ac.getOnlyIfUnchanged(), ac.getRequestOptions());\n-\n-    private Supplier<DataSource> newDataSourceFunc = () -> createTestBlobDataSource(null);\n-\n-    private Function<DataSource, DataSource> mutateDataSourceFunc = (DataSource ds) -> \n-        ds.setDescription(\"somethingnew\");\n-\n-    private BiConsumer<DataSource, AccessOptions> deleteDataSourceFunc = (DataSource dataSource, AccessOptions ac) ->\n-        client.deleteDataSourceWithResponse(dataSource,\n-            ac.getOnlyIfUnchanged(), ac.getRequestOptions(), Context.NONE);\n-\n     @Override\n     protected void beforeTest() {\n         super.beforeTest();\n         client = getSearchServiceClientBuilder().buildClient();\n     }\n \n-    private DataSource createOrUpdateDataSource(DataSource datasource, Boolean onlyIfUnchanged,\n-        RequestOptions requestOptions) {\n-        return client.createOrUpdateDataSourceWithResponse(datasource, onlyIfUnchanged, requestOptions, Context.NONE)\n-            .getValue();\n+    @Override\n+    protected void afterTest() {\n+        super.afterTest();\n+        for (String dataSource : dataSourcesToDelete) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db1b82af137cf126c17bb5f3c767c544cceb112e"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA0OTgxMw==", "bodyText": "Indentation.", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#discussion_r424049813", "createdAt": "2020-05-12T21:40:38Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/DataSourceSyncTests.java", "diffHunk": "@@ -112,7 +106,8 @@ public void deleteDataSourceIsIdempotent() {\n         DataSource dataSource = createTestBlobDataSource(null);\n \n         // Try to delete before the data source exists, expect a NOT FOUND return status code\n-        Response<Void> result = client.deleteDataSourceWithResponse(dataSource, false, generateRequestOptions(), Context.NONE);\n+        Response<Void> result = client.deleteDataSourceWithResponse(dataSource, false, generateRequestOptions(),\n+            Context.NONE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db1b82af137cf126c17bb5f3c767c544cceb112e"}, "originalPosition": 115}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDUyMjEz", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#pullrequestreview-410452213", "createdAt": "2020-05-12T21:57:31Z", "commit": {"oid": "db1b82af137cf126c17bb5f3c767c544cceb112e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMTo1NzozMVrOGUabUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMTo1NzozMVrOGUabUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA1NzY4MQ==", "bodyText": "What's the reason of having maximum of 2?", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#discussion_r424057681", "createdAt": "2020-05-12T21:57:31Z", "author": {"login": "sima-zhu"}, "path": "sdk/search/tests.yml", "diffHunk": "@@ -5,12 +5,9 @@ jobs:\n     parameters:\n       ServiceDirectory: search\n       Timeout: 120\n+      MaxParallel: 2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db1b82af137cf126c17bb5f3c767c544cceb112e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd63e804dd3e96e25b9c198a22207f1f4e13c633", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/dd63e804dd3e96e25b9c198a22207f1f4e13c633", "committedDate": "2020-05-12T22:17:23Z", "message": "Fix default Storage suffix, make azure-test-watcher a test dependency as it should be"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d3ac3dd029d8e34d24f0b43de7a6bb63a901dd2", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d3ac3dd029d8e34d24f0b43de7a6bb63a901dd2", "committedDate": "2020-05-12T22:19:20Z", "message": "Add missing '.' in Search service endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDkxMzAx", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11040#pullrequestreview-410491301", "createdAt": "2020-05-12T23:27:31Z", "commit": {"oid": "0d3ac3dd029d8e34d24f0b43de7a6bb63a901dd2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8a3f9924c2c250328c1027696e5c00862524ce6", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/e8a3f9924c2c250328c1027696e5c00862524ce6", "committedDate": "2020-05-13T00:15:19Z", "message": "Use Free SKU instead of Basic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5646988d397b17d4b14832d2c0826ec19967d613", "author": {"user": {"login": "alzimmermsft", "name": "Alan Zimmer"}}, "url": "https://github.com/Azure/azure-sdk-for-java/commit/5646988d397b17d4b14832d2c0826ec19967d613", "committedDate": "2020-05-13T00:16:07Z", "message": "Update session record"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4357, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}