{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzODgyMTQ1", "number": 128, "title": "feat: add num_sessions_in_pool metric", "bodyText": "Thank you for opening a Pull Request! Before submitting your PR, there are a few things you can do to make sure it goes smoothly:\n\n Make sure to open an issue as a bug/issue before writing your code!  That way we can discuss the change, evaluate designs, and agree on the general idea\n Ensure the tests and linter pass\n Code coverage does not decrease (if any source code was changed)\n Appropriate docs were updated (if necessary)\n\nUpdates #53, this is based on the last discussion in the thread: #53 (comment)\nThis is how it looks in Stackdriver UI:\n\nBreaking Note:\nThe cloud.google.com/java/spanner/in_use_sessions metric has been deprecated since v1.55.2, use cloud.google.com/java/spanner/num_sessions_in_pool instead.", "createdAt": "2020-03-25T23:44:44Z", "url": "https://github.com/googleapis/java-spanner/pull/128", "merged": true, "mergeCommit": {"oid": "3a7a8ad79f1de3371d32a1298406990cb7bbf5be"}, "closed": true, "closedAt": "2020-06-11T03:34:56Z", "author": {"login": "mayurkale22"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRTy7UgFqTM4MTY4MjgxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcn400JABqjM0MDU0NDIzNzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNjgyODEz", "url": "https://github.com/googleapis/java-spanner/pull/128#pullrequestreview-381682813", "createdAt": "2020-03-26T03:39:48Z", "commit": {"oid": "4afe128245100fa8c77a92772b242a2da5653175"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMzozOTo0OFrOF72Uow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMzozOTo0OFrOF72Uow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMwMDMyMw==", "bodyText": "I'm worried for anyone relying on this metric already in their monitoring? What is the process for deprecating metrics in OpenCensus? Is there some monitoring to figure out if someone is exporting it?", "url": "https://github.com/googleapis/java-spanner/pull/128#discussion_r398300323", "createdAt": "2020-03-26T03:39:48Z", "author": {"login": "skuruppu"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/MetricRegistryConstants.java", "diffHunk": "@@ -46,20 +55,20 @@\n   // The Metric name and description\n   static final String MAX_IN_USE_SESSIONS = \"cloud.google.com/java/spanner/max_in_use_sessions\";\n   static final String MAX_ALLOWED_SESSIONS = \"cloud.google.com/java/spanner/max_allowed_sessions\";\n-  static final String IN_USE_SESSIONS = \"cloud.google.com/java/spanner/in_use_sessions\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4afe128245100fa8c77a92772b242a2da5653175"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMzMyOTE5", "url": "https://github.com/googleapis/java-spanner/pull/128#pullrequestreview-382332919", "createdAt": "2020-03-26T19:11:08Z", "commit": {"oid": "4afe128245100fa8c77a92772b242a2da5653175"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4afe128245100fa8c77a92772b242a2da5653175", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/4afe128245100fa8c77a92772b242a2da5653175", "committedDate": "2020-03-25T18:33:58Z", "message": "add num_sessions_in_pool metric"}, "afterCommit": {"oid": "9df0fea2ca5e844752a3b2059e1ab4e927349043", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/9df0fea2ca5e844752a3b2059e1ab4e927349043", "committedDate": "2020-03-26T22:50:57Z", "message": "feat: add num_sessions_in_pool metric"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9df0fea2ca5e844752a3b2059e1ab4e927349043", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/9df0fea2ca5e844752a3b2059e1ab4e927349043", "committedDate": "2020-03-26T22:50:57Z", "message": "feat: add num_sessions_in_pool metric"}, "afterCommit": {"oid": "48e8ec96deccd5658b70f4a92b279f5b02e98e50", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/48e8ec96deccd5658b70f4a92b279f5b02e98e50", "committedDate": "2020-03-26T23:02:20Z", "message": "feat: add num_sessions_in_pool metric"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDk4ODc0", "url": "https://github.com/googleapis/java-spanner/pull/128#pullrequestreview-382498874", "createdAt": "2020-03-26T23:57:46Z", "commit": {"oid": "4afe128245100fa8c77a92772b242a2da5653175"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzo1OTozN1rOF8erKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDowMjozMlrOF8eutA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2MTQ0OA==", "bodyText": "write session is num_write_prepared_session while read doesn't have 'prepared' word in it. Is that deliberate?\nis consistency in naming important? If so then num_sessions_being_prepared should be renamed to num_being_prepared_session", "url": "https://github.com/googleapis/java-spanner/pull/128#discussion_r398961448", "createdAt": "2020-03-26T23:59:37Z", "author": {"login": "rghetia"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/MetricRegistryConstants.java", "diffHunk": "@@ -30,12 +30,21 @@\n       LabelKey.create(\"instance_id\", \"Name of the instance\");\n   private static final LabelKey LIBRARY_VERSION =\n       LabelKey.create(\"library_version\", \"Library version\");\n+  private static final LabelKey SESSION_TYPE = LabelKey.create(\"Type\", \"Type of the Sessions\");\n \n   /** The label value is used to represent missing value. */\n   private static final LabelValue UNSET_LABEL = LabelValue.create(null);\n \n+  static final LabelValue NUM_IN_USE_SESSIONS = LabelValue.create(\"num_in_use_sessions\");\n+  static final LabelValue NUM_SESSIONS_BEING_PREPARED =\n+      LabelValue.create(\"num_sessions_being_prepared\");\n+  static final LabelValue NUM_READ_SESSIONS = LabelValue.create(\"num_read_sessions\");\n+  static final LabelValue NUM_WRITE_SESSIONS = LabelValue.create(\"num_write_prepared_sessions\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48e8ec96deccd5658b70f4a92b279f5b02e98e50"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2MjM1Ng==", "bodyText": "No test for new Gauges?", "url": "https://github.com/googleapis/java-spanner/pull/128#discussion_r398962356", "createdAt": "2020-03-27T00:02:32Z", "author": {"login": "rghetia"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/SessionPoolTest.java", "diffHunk": "@@ -1638,7 +1637,6 @@ public Void call() {\n         .containsEntry(MetricRegistryConstants.NUM_ACQUIRED_SESSIONS, 3L);\n     assertThat(record.getMetrics())\n         .containsEntry(MetricRegistryConstants.NUM_RELEASED_SESSIONS, 3L);\n-    assertThat(record.getMetrics()).containsEntry(MetricRegistryConstants.IN_USE_SESSIONS, 0L);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48e8ec96deccd5658b70f4a92b279f5b02e98e50"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48e8ec96deccd5658b70f4a92b279f5b02e98e50", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/48e8ec96deccd5658b70f4a92b279f5b02e98e50", "committedDate": "2020-03-26T23:02:20Z", "message": "feat: add num_sessions_in_pool metric"}, "afterCommit": {"oid": "c72e4d80af2eabbeaad678d82c8c039c427821ad", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/c72e4d80af2eabbeaad678d82c8c039c427821ad", "committedDate": "2020-05-26T19:42:09Z", "message": "feat: add num_sessions_in_pool metric"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTQ3NzAx", "url": "https://github.com/googleapis/java-spanner/pull/128#pullrequestreview-421147701", "createdAt": "2020-05-29T17:25:04Z", "commit": {"oid": "b5af7578f17f0cf9f5bb085423a9d63194582bc1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf3981bbdf04db756eb8aa4e47505d44a456be19", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/cf3981bbdf04db756eb8aa4e47505d44a456be19", "committedDate": "2020-06-04T07:20:18Z", "message": "feat: add num_sessions_in_pool metric"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5ac645b9268a0d66fa4dc9188bea6ccee6cdf2c", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/b5ac645b9268a0d66fa4dc9188bea6ccee6cdf2c", "committedDate": "2020-06-04T07:20:18Z", "message": "add tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5af7578f17f0cf9f5bb085423a9d63194582bc1", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/b5af7578f17f0cf9f5bb085423a9d63194582bc1", "committedDate": "2020-05-27T07:11:44Z", "message": "add tests"}, "afterCommit": {"oid": "b5ac645b9268a0d66fa4dc9188bea6ccee6cdf2c", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/b5ac645b9268a0d66fa4dc9188bea6ccee6cdf2c", "committedDate": "2020-06-04T07:20:18Z", "message": "add tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 882, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}