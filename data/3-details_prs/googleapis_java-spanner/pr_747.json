{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5OTQzNDI0", "number": 747, "title": "feat: include User agent", "bodyText": "Configure the UserAgent in addition to x-goog-api-client. This will be needed for DirectPath.", "createdAt": "2020-12-15T03:14:19Z", "url": "https://github.com/googleapis/java-spanner/pull/747", "merged": true, "mergeCommit": {"oid": "fc63bc3f1bd9cdd83156cc63548b544188de6592"}, "closed": true, "closedAt": "2020-12-15T21:46:35Z", "author": {"login": "mohanli-ml"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh-kQTgH2gAyNTM5OTQzNDI0OjNkNTQ5ZWQzYTE0NzI4YWJhNDNhMWRmM2E2MjkyMmMxYjUyYmNlNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmheCZAFqTU1MjkzMjY1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3d549ed3a14728aba43a1df3a62922c1b52bce61", "author": {"user": {"login": "mohanli-ml", "name": "Mohan Li"}}, "url": "https://github.com/googleapis/java-spanner/commit/3d549ed3a14728aba43a1df3a62922c1b52bce61", "committedDate": "2020-12-01T18:50:27Z", "message": "chore: add DirectPath fallback integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a356675cce4ea69c503bf01523f9e49581f4971", "author": {"user": {"login": "mohanli-ml", "name": "Mohan Li"}}, "url": "https://github.com/googleapis/java-spanner/commit/7a356675cce4ea69c503bf01523f9e49581f4971", "committedDate": "2020-12-03T01:15:06Z", "message": "Merge branch 'dp-branch'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9851996a54d4d25f23496c22baeef58b6fb798c9", "author": {"user": {"login": "mohanli-ml", "name": "Mohan Li"}}, "url": "https://github.com/googleapis/java-spanner/commit/9851996a54d4d25f23496c22baeef58b6fb798c9", "committedDate": "2020-12-15T02:50:05Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMDc0Mzky", "url": "https://github.com/googleapis/java-spanner/pull/747#pullrequestreview-552074392", "createdAt": "2020-12-15T03:16:28Z", "commit": {"oid": "a6d4e7cd35491e39de40ab5790ceee85606ce615"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzoxNjoyOVrOIF28hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzoxNjoyOVrOIF28ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAxNDAyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          options.getSpannerStubSettings().toBuilder()\n          \n          \n            \n                              .setTransportChannelProvider(channelProvider)\n          \n          \n            \n                          options\n          \n          \n            \n                              .getSpannerStubSettings()\n          \n          \n            \n                              .toBuilder()\n          \n          \n            \n                      options\n          \n          \n            \n                          .getSpannerStubSettings()\n          \n          \n            \n                          .executeSqlSettings()\n          \n          \n            \n                          .getRetrySettings()\n          \n          \n            \n                          .toBuilder()", "url": "https://github.com/googleapis/java-spanner/pull/747#discussion_r543014020", "createdAt": "2020-12-15T03:16:29Z", "author": {"login": "yoshi-code-bot"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -367,19 +381,13 @@ public GapicSpannerRpc(final SpannerOptions options) {\n     try {\n       this.spannerStub =\n           GrpcSpannerStub.create(\n-              options\n-                  .getSpannerStubSettings()\n-                  .toBuilder()\n+              options.getSpannerStubSettings().toBuilder()\n                   .setTransportChannelProvider(channelProvider)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6d4e7cd35491e39de40ab5790ceee85606ce615"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAxNDAyMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          options.getInstanceAdminStubSettings().toBuilder()\n          \n          \n            \n                              .setTransportChannelProvider(channelProvider)\n          \n          \n            \n                          options\n          \n          \n            \n                              .getInstanceAdminStubSettings()\n          \n          \n            \n                              .toBuilder()\n          \n          \n            \n                      options\n          \n          \n            \n                          .getDatabaseAdminStubSettings()\n          \n          \n            \n                          .toBuilder()", "url": "https://github.com/googleapis/java-spanner/pull/747#discussion_r543014023", "createdAt": "2020-12-15T03:16:29Z", "author": {"login": "yoshi-code-bot"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -412,18 +420,14 @@ public GapicSpannerRpc(final SpannerOptions options) {\n \n       this.instanceAdminStub =\n           GrpcInstanceAdminStub.create(\n-              options\n-                  .getInstanceAdminStubSettings()\n-                  .toBuilder()\n+              options.getInstanceAdminStubSettings().toBuilder()\n                   .setTransportChannelProvider(channelProvider)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6d4e7cd35491e39de40ab5790ceee85606ce615"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAxNDAyNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        options.getInstanceAdminStubSettings().toBuilder()\n          \n          \n            \n                        options\n          \n          \n            \n                            .getInstanceAdminStubSettings()\n          \n          \n            \n                            .toBuilder()", "url": "https://github.com/googleapis/java-spanner/pull/747#discussion_r543014026", "createdAt": "2020-12-15T03:16:29Z", "author": {"login": "yoshi-code-bot"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -458,9 +462,7 @@ private static void checkEmulatorConnection(\n       // Do a quick check to see if the emulator is actually running.\n       try {\n         InstanceAdminStubSettings.Builder testEmulatorSettings =\n-            options\n-                .getInstanceAdminStubSettings()\n-                .toBuilder()\n+            options.getInstanceAdminStubSettings().toBuilder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6d4e7cd35491e39de40ab5790ceee85606ce615"}, "originalPosition": 80}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6d4e7cd35491e39de40ab5790ceee85606ce615", "author": {"user": {"login": "mohanli-ml", "name": "Mohan Li"}}, "url": "https://github.com/googleapis/java-spanner/commit/a6d4e7cd35491e39de40ab5790ceee85606ce615", "committedDate": "2020-12-15T03:12:33Z", "message": "feat: include User agent"}, "afterCommit": {"oid": "6a41e9af7cd7689a661cbb08038f17dc93e0d6af", "author": {"user": {"login": "mohanli-ml", "name": "Mohan Li"}}, "url": "https://github.com/googleapis/java-spanner/commit/6a41e9af7cd7689a661cbb08038f17dc93e0d6af", "committedDate": "2020-12-15T03:43:46Z", "message": "feat: include User agent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMDk1MDIy", "url": "https://github.com/googleapis/java-spanner/pull/747#pullrequestreview-552095022", "createdAt": "2020-12-15T04:22:07Z", "commit": {"oid": "6a41e9af7cd7689a661cbb08038f17dc93e0d6af"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNDoyMjowN1rOIF4POw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNDoyMjowN1rOIF4POw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzNTE5NQ==", "bodyText": "We are overriding the header provider here, instead of adding to it. We have to manually construct a new provider that will encapsulate the existing one the the new one:\nprivate static final String USER_AGENT_KEY = \"user-agent\";\nprivate static final String CLIENT_LIBRARY_LANGUAGE = \"spanner-java\";\n\nMap<String, String> headersWithUserAgent = ImmutableMap.<String, String>builder()\n    .put(USER_AGENT_KEY, CLIENT_LIBRARY_LANGUAGE + \"/\" + GaxProperties.getLibraryVersion(GapicSpannerRpc.class)))\n    .putAll(mergedHeaderProvider.getHeaders())\n    .build();\nfinal HeaderProvider headerProviderWithUserAgent = FixedHeaderProvider.create(headersWithUserAgent);\n\n...\n.setHeaderProvider(headerProviderWithUserAgent);", "url": "https://github.com/googleapis/java-spanner/pull/747#discussion_r543035195", "createdAt": "2020-12-15T04:22:07Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -338,7 +339,20 @@ public GapicSpannerRpc(final SpannerOptions options) {\n                             options.getInterceptorProvider(),\n                             SpannerInterceptorProvider.createDefault()))\n                     .withEncoding(compressorName))\n-            .setHeaderProvider(mergedHeaderProvider);\n+            .setHeaderProvider(mergedHeaderProvider)\n+\n+            // Inject client library version to `user-agent`\n+            .setHeaderProvider(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a41e9af7cd7689a661cbb08038f17dc93e0d6af"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a075cff6bbb93a85b8823119058ce5f25b8b188d", "author": {"user": {"login": "mohanli-ml", "name": "Mohan Li"}}, "url": "https://github.com/googleapis/java-spanner/commit/a075cff6bbb93a85b8823119058ce5f25b8b188d", "committedDate": "2020-12-15T05:42:16Z", "message": "feat: include User agent"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a41e9af7cd7689a661cbb08038f17dc93e0d6af", "author": {"user": {"login": "mohanli-ml", "name": "Mohan Li"}}, "url": "https://github.com/googleapis/java-spanner/commit/6a41e9af7cd7689a661cbb08038f17dc93e0d6af", "committedDate": "2020-12-15T03:43:46Z", "message": "feat: include User agent"}, "afterCommit": {"oid": "a075cff6bbb93a85b8823119058ce5f25b8b188d", "author": {"user": {"login": "mohanli-ml", "name": "Mohan Li"}}, "url": "https://github.com/googleapis/java-spanner/commit/a075cff6bbb93a85b8823119058ce5f25b8b188d", "committedDate": "2020-12-15T05:42:16Z", "message": "feat: include User agent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyOTMyNjUy", "url": "https://github.com/googleapis/java-spanner/pull/747#pullrequestreview-552932652", "createdAt": "2020-12-15T21:46:02Z", "commit": {"oid": "a075cff6bbb93a85b8823119058ce5f25b8b188d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 946, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}