{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5OTQzNDI0", "number": 747, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzoxNjoyOFrOFFX3xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNDoyMjowN1rOFFY1JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMTc4MzA5OnYy", "diffSide": "RIGHT", "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzoxNjoyOVrOIF28hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzoxNjoyOVrOIF28hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAxNDAyMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          options.getSpannerStubSettings().toBuilder()\n          \n          \n            \n                              .setTransportChannelProvider(channelProvider)\n          \n          \n            \n                          options\n          \n          \n            \n                              .getSpannerStubSettings()\n          \n          \n            \n                              .toBuilder()\n          \n          \n            \n                      options\n          \n          \n            \n                          .getSpannerStubSettings()\n          \n          \n            \n                          .executeSqlSettings()\n          \n          \n            \n                          .getRetrySettings()\n          \n          \n            \n                          .toBuilder()", "url": "https://github.com/googleapis/java-spanner/pull/747#discussion_r543014020", "createdAt": "2020-12-15T03:16:29Z", "author": {"login": "yoshi-code-bot"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -367,19 +381,13 @@ public GapicSpannerRpc(final SpannerOptions options) {\n     try {\n       this.spannerStub =\n           GrpcSpannerStub.create(\n-              options\n-                  .getSpannerStubSettings()\n-                  .toBuilder()\n+              options.getSpannerStubSettings().toBuilder()\n                   .setTransportChannelProvider(channelProvider)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6d4e7cd35491e39de40ab5790ceee85606ce615"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMTc4MzEzOnYy", "diffSide": "RIGHT", "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzoxNjoyOVrOIF28hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzoxNjoyOVrOIF28hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAxNDAyMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          options.getInstanceAdminStubSettings().toBuilder()\n          \n          \n            \n                              .setTransportChannelProvider(channelProvider)\n          \n          \n            \n                          options\n          \n          \n            \n                              .getInstanceAdminStubSettings()\n          \n          \n            \n                              .toBuilder()\n          \n          \n            \n                      options\n          \n          \n            \n                          .getDatabaseAdminStubSettings()\n          \n          \n            \n                          .toBuilder()", "url": "https://github.com/googleapis/java-spanner/pull/747#discussion_r543014023", "createdAt": "2020-12-15T03:16:29Z", "author": {"login": "yoshi-code-bot"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -412,18 +420,14 @@ public GapicSpannerRpc(final SpannerOptions options) {\n \n       this.instanceAdminStub =\n           GrpcInstanceAdminStub.create(\n-              options\n-                  .getInstanceAdminStubSettings()\n-                  .toBuilder()\n+              options.getInstanceAdminStubSettings().toBuilder()\n                   .setTransportChannelProvider(channelProvider)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6d4e7cd35491e39de40ab5790ceee85606ce615"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMTc4MzE1OnYy", "diffSide": "RIGHT", "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzoxNjoyOVrOIF28ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzoxNjoyOVrOIF28ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAxNDAyNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        options.getInstanceAdminStubSettings().toBuilder()\n          \n          \n            \n                        options\n          \n          \n            \n                            .getInstanceAdminStubSettings()\n          \n          \n            \n                            .toBuilder()", "url": "https://github.com/googleapis/java-spanner/pull/747#discussion_r543014026", "createdAt": "2020-12-15T03:16:29Z", "author": {"login": "yoshi-code-bot"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -458,9 +462,7 @@ private static void checkEmulatorConnection(\n       // Do a quick check to see if the emulator is actually running.\n       try {\n         InstanceAdminStubSettings.Builder testEmulatorSettings =\n-            options\n-                .getInstanceAdminStubSettings()\n-                .toBuilder()\n+            options.getInstanceAdminStubSettings().toBuilder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6d4e7cd35491e39de40ab5790ceee85606ce615"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMTk0MDIwOnYy", "diffSide": "RIGHT", "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNDoyMjowN1rOIF4POw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNTo0Mjo1N1rOIF55MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzNTE5NQ==", "bodyText": "We are overriding the header provider here, instead of adding to it. We have to manually construct a new provider that will encapsulate the existing one the the new one:\nprivate static final String USER_AGENT_KEY = \"user-agent\";\nprivate static final String CLIENT_LIBRARY_LANGUAGE = \"spanner-java\";\n\nMap<String, String> headersWithUserAgent = ImmutableMap.<String, String>builder()\n    .put(USER_AGENT_KEY, CLIENT_LIBRARY_LANGUAGE + \"/\" + GaxProperties.getLibraryVersion(GapicSpannerRpc.class)))\n    .putAll(mergedHeaderProvider.getHeaders())\n    .build();\nfinal HeaderProvider headerProviderWithUserAgent = FixedHeaderProvider.create(headersWithUserAgent);\n\n...\n.setHeaderProvider(headerProviderWithUserAgent);", "url": "https://github.com/googleapis/java-spanner/pull/747#discussion_r543035195", "createdAt": "2020-12-15T04:22:07Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -338,7 +339,20 @@ public GapicSpannerRpc(final SpannerOptions options) {\n                             options.getInterceptorProvider(),\n                             SpannerInterceptorProvider.createDefault()))\n                     .withEncoding(compressorName))\n-            .setHeaderProvider(mergedHeaderProvider);\n+            .setHeaderProvider(mergedHeaderProvider)\n+\n+            // Inject client library version to `user-agent`\n+            .setHeaderProvider(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a41e9af7cd7689a661cbb08038f17dc93e0d6af"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA2MjMyMQ==", "bodyText": "Fixed. Thanks!", "url": "https://github.com/googleapis/java-spanner/pull/747#discussion_r543062321", "createdAt": "2020-12-15T05:42:57Z", "author": {"login": "mohanli-ml"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -338,7 +339,20 @@ public GapicSpannerRpc(final SpannerOptions options) {\n                             options.getInterceptorProvider(),\n                             SpannerInterceptorProvider.createDefault()))\n                     .withEncoding(compressorName))\n-            .setHeaderProvider(mergedHeaderProvider);\n+            .setHeaderProvider(mergedHeaderProvider)\n+\n+            // Inject client library version to `user-agent`\n+            .setHeaderProvider(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzNTE5NQ=="}, "originalCommit": {"oid": "6a41e9af7cd7689a661cbb08038f17dc93e0d6af"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3283, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}