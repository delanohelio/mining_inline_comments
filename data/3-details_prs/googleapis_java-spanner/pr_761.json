{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzMjI3NTMw", "number": 761, "title": "fix: grpc-alts is used not only in tests", "bodyText": "This reverts commit c8ef46f.\nWithout having grpc-alts in runtime / compile scope I get the following error when running the client library:\nException in thread \"main\" java.lang.NoClassDefFoundError: io/grpc/alts/ComputeEngineChannelBuilder\n\tat com.google.cloud.spanner.v1.stub.SpannerStubSettings.defaultGrpcTransportProviderBuilder(SpannerStubSettings.java:304)\n\tat com.google.cloud.spanner.v1.stub.SpannerStubSettings.defaultTransportChannelProvider(SpannerStubSettings.java:309)\n\tat com.google.cloud.spanner.v1.stub.SpannerStubSettings$Builder.createDefault(SpannerStubSettings.java:531)\n\tat com.google.cloud.spanner.v1.stub.SpannerStubSettings$Builder.access$100(SpannerStubSettings.java:356)\n\tat com.google.cloud.spanner.v1.stub.SpannerStubSettings.newBuilder(SpannerStubSettings.java:322)\n\tat com.google.cloud.spanner.SpannerOptions$Builder.<init>(SpannerOptions.java:628)\n\tat com.google.cloud.spanner.SpannerOptions$Builder.<init>(SpannerOptions.java:605)\n\tat com.google.cloud.spanner.SpannerOptions.newBuilder(SpannerOptions.java:1020)\n\tat com.google.cloud.spanner.Main.main(Main.java:33)\nCaused by: java.lang.ClassNotFoundException: io.grpc.alts.ComputeEngineChannelBuilder\n\tat java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:583)\n\tat java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)\n\tat java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:521)\n\t... 9 more", "createdAt": "2020-12-21T05:20:08Z", "url": "https://github.com/googleapis/java-spanner/pull/761", "merged": true, "mergeCommit": {"oid": "72d93d5aa9a301c64c9d572d10211882a359e414"}, "closed": true, "closedAt": "2021-01-05T22:34:32Z", "author": {"login": "thiagotnunes"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoO5LkAH2gAyNTQzMjI3NTMwOmFiMDM3MzY3YmJlYTE2NDIyZjZhZDVkNGFjNzgzYTE3ZWJmMTQwMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtGkyDAFqTU2MTU5MTQyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab037367bbea16422f6ad5d4ac783a17ebf14038", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/ab037367bbea16422f6ad5d4ac783a17ebf14038", "committedDate": "2020-12-21T05:15:20Z", "message": "fix: grpc-alts is used not only in tests\n\nThis reverts commit c8ef46f2637b58cc71d023764cdc11a7414d855f."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MTczMDMz", "url": "https://github.com/googleapis/java-spanner/pull/761#pullrequestreview-556173033", "createdAt": "2020-12-21T07:20:52Z", "commit": {"oid": "ab037367bbea16422f6ad5d4ac783a17ebf14038"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNzoyMDo1MlrOIJOgQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNzoyMDo1MlrOIJOgQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU0NTczMA==", "bodyText": "grpc-alts is already a compile time dependency as it is a transitive dependency of gax-grpc. This degrades it to a runtime dependency. Is there a reason that we need to downgrade it here, and that we can't just let it be a compile time dependency?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  <scope>runtime</scope>\n          \n      \n    \n    \n  \n\nThis is the dependency tree completely without the grpc-alts dependency declaration:\n[INFO] Scanning for projects...\n[INFO] Inspecting build with total of 1 modules...\n[INFO] Installing Nexus Staging features:\n[INFO]   ... total of 1 executions of maven-deploy-plugin replaced with nexus-staging-maven-plugin\n[INFO] \n[INFO] ---------------< com.google.cloud:google-cloud-spanner >----------------\n[INFO] Building Google Cloud Spanner 3.1.4-SNAPSHOT\n[INFO] --------------------------------[ jar ]---------------------------------\n[INFO] \n[INFO] --- maven-dependency-plugin:3.1.2:tree (default-cli) @ google-cloud-spanner ---\n[INFO] com.google.cloud:google-cloud-spanner:jar:3.1.4-SNAPSHOT\n[INFO] +- io.grpc:grpc-api:jar:1.34.1:compile\n[INFO] |  +- com.google.errorprone:error_prone_annotations:jar:2.4.0:compile\n[INFO] |  \\- org.codehaus.mojo:animal-sniffer-annotations:jar:1.19:runtime\n[INFO] +- io.grpc:grpc-auth:jar:1.34.1:compile\n[INFO] +- io.grpc:grpc-context:jar:1.34.1:compile\n[INFO] +- io.grpc:grpc-core:jar:1.34.1:compile\n[INFO] |  +- com.google.android:annotations:jar:4.1.1.4:runtime\n[INFO] |  \\- io.perfmark:perfmark-api:jar:0.19.0:runtime\n[INFO] +- io.grpc:grpc-netty-shaded:jar:1.34.1:compile\n[INFO] +- io.grpc:grpc-protobuf:jar:1.34.1:compile\n[INFO] |  \\- io.grpc:grpc-protobuf-lite:jar:1.34.1:compile\n[INFO] +- io.grpc:grpc-stub:jar:1.34.1:compile\n[INFO] +- com.google.api:api-common:jar:1.10.1:compile\n[INFO] |  \\- com.google.auto.value:auto-value-annotations:jar:1.7.4:compile\n[INFO] +- com.google.protobuf:protobuf-java:jar:3.14.0:compile\n[INFO] +- com.google.protobuf:protobuf-java-util:jar:3.14.0:compile\n[INFO] +- com.google.api.grpc:proto-google-common-protos:jar:2.0.1:compile\n[INFO] +- com.google.api.grpc:grpc-google-common-protos:jar:2.0.1:compile\n[INFO] |  +- com.google.guava:failureaccess:jar:1.0.1:compile\n[INFO] |  +- com.google.guava:listenablefuture:jar:9999.0-empty-to-avoid-conflict-with-guava:compile\n[INFO] |  +- org.checkerframework:checker-compat-qual:jar:2.5.5:compile\n[INFO] |  \\- com.google.j2objc:j2objc-annotations:jar:1.3:compile\n[INFO] +- com.google.api.grpc:proto-google-iam-v1:jar:1.0.5:compile\n[INFO] +- com.google.cloud:google-cloud-core:jar:1.94.0:compile\n[INFO] |  \\- com.google.http-client:google-http-client-jackson2:jar:1.38.0:compile\n[INFO] |     \\- com.fasterxml.jackson.core:jackson-core:jar:2.12.0:compile\n[INFO] +- com.google.cloud:google-cloud-core-grpc:jar:1.94.0:compile\n[INFO] +- io.opencensus:opencensus-api:jar:0.24.0:compile\n[INFO] +- io.opencensus:opencensus-contrib-grpc-util:jar:0.24.0:compile\n[INFO] +- com.google.auth:google-auth-library-oauth2-http:jar:0.22.2:compile\n[INFO] +- com.google.http-client:google-http-client:jar:1.38.0:compile\n[INFO] |  +- org.apache.httpcomponents:httpclient:jar:4.5.13:compile\n[INFO] |  |  +- commons-logging:commons-logging:jar:1.2:compile\n[INFO] |  |  \\- commons-codec:commons-codec:jar:1.11:compile\n[INFO] |  +- org.apache.httpcomponents:httpcore:jar:4.4.13:compile\n[INFO] |  \\- io.opencensus:opencensus-contrib-http-util:jar:0.24.0:compile\n[INFO] +- com.google.api.grpc:proto-google-cloud-spanner-admin-instance-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:proto-google-cloud-spanner-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:proto-google-cloud-spanner-admin-database-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:grpc-google-cloud-spanner-admin-instance-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:grpc-google-cloud-spanner-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:grpc-google-cloud-spanner-admin-database-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.guava:guava:jar:30.1-android:compile\n[INFO] +- com.google.api:gax:jar:1.60.1:compile\n[INFO] +- com.google.api:gax-grpc:jar:1.60.1:compile\n[INFO] |  \\- io.grpc:grpc-alts:jar:1.34.1:compile\n[INFO] |     +- io.grpc:grpc-grpclb:jar:1.34.1:compile\n[INFO] |     +- org.apache.commons:commons-lang3:jar:3.5:compile\n[INFO] |     \\- org.conscrypt:conscrypt-openjdk-uber:jar:2.5.1:compile\n[INFO] +- org.threeten:threetenbp:jar:1.5.0:compile\n[INFO] +- com.google.code.findbugs:jsr305:jar:3.0.2:compile\n[INFO] +- com.google.code.gson:gson:jar:2.8.6:compile\n[INFO] +- com.google.auth:google-auth-library-credentials:jar:0.22.2:compile\n[INFO] +- junit:junit:jar:4.13.1:test\n[INFO] |  \\- org.hamcrest:hamcrest-core:jar:1.3:test\n[INFO] +- com.google.api:gax-grpc:jar:testlib:1.60.1:test\n[INFO] +- com.google.truth:truth:jar:1.1:test\n[INFO] |  +- org.checkerframework:checker-qual:jar:3.7.0:test\n[INFO] |  \\- org.ow2.asm:asm:jar:9.0:test\n[INFO] +- org.mockito:mockito-all:jar:1.10.19:test\n[INFO] +- org.json:json:jar:20201115:test\n[INFO] +- com.google.guava:guava-testlib:jar:30.1-android:test\n[INFO] +- org.hamcrest:hamcrest:jar:2.2:test\n[INFO] +- org.openjdk.jmh:jmh-core:jar:1.27:test\n[INFO] |  +- net.sf.jopt-simple:jopt-simple:jar:4.6:test\n[INFO] |  \\- org.apache.commons:commons-math3:jar:3.2:test\n[INFO] +- org.openjdk.jmh:jmh-generator-annprocess:jar:1.27:test\n[INFO] \\- javax.annotation:javax.annotation-api:jar:1.3.2:compile\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 2.470 s\n[INFO] Finished at: 2020-12-21T08:17:23+01:00\n[INFO] ------------------------------------------------------------------------", "url": "https://github.com/googleapis/java-spanner/pull/761#discussion_r546545730", "createdAt": "2020-12-21T07:20:52Z", "author": {"login": "olavloite"}, "path": "google-cloud-spanner/pom.xml", "diffHunk": "@@ -142,6 +142,16 @@\n       <groupId>io.grpc</groupId>\n       <artifactId>grpc-protobuf</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>io.grpc</groupId>\n+      <artifactId>grpc-alts</artifactId>\n+      <scope>runtime</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab037367bbea16422f6ad5d4ac783a17ebf14038"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3d816ffabde7a01fb495498ae500497765bbeff", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/e3d816ffabde7a01fb495498ae500497765bbeff", "committedDate": "2020-12-22T22:59:41Z", "message": "fix: adds grpc-alts as compile time dependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NzI2MDgx", "url": "https://github.com/googleapis/java-spanner/pull/761#pullrequestreview-557726081", "createdAt": "2020-12-23T08:51:36Z", "commit": {"oid": "e3d816ffabde7a01fb495498ae500497765bbeff"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "874ec0ccb26fc8ed76dc1db9474c2a0f644be061", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/874ec0ccb26fc8ed76dc1db9474c2a0f644be061", "committedDate": "2021-01-04T23:05:26Z", "message": "fix: removes duplicate dependency\n\nRemoves duplicate grpc-alts dependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNTkxNDI1", "url": "https://github.com/googleapis/java-spanner/pull/761#pullrequestreview-561591425", "createdAt": "2021-01-05T08:23:26Z", "commit": {"oid": "874ec0ccb26fc8ed76dc1db9474c2a0f644be061"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 948, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}