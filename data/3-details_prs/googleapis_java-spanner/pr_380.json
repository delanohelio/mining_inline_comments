{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2NTM3MzE2", "number": 380, "title": "fix: enables emulator tests", "bodyText": "Enables emulator for integration tests that were previously being skipped. The emulator now provides the features for theses tests to run with it.\nThe tests that are now enabled to use the emulator are:\n\nITAsyncAPITest\nITClosedSessionTest\nITCommitTimestampTest", "createdAt": "2020-08-12T06:01:14Z", "url": "https://github.com/googleapis/java-spanner/pull/380", "merged": true, "mergeCommit": {"oid": "f61c6d0d332f15826499996a292acc7cbab267a7"}, "closed": true, "closedAt": "2020-08-13T01:22:10Z", "author": {"login": "thiagotnunes"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-FGs_AH2gAyNDY2NTM3MzE2OmU2ZTQ0MjRjZmIyMTQwZTkxOTE4NDJlMzY1MzE2MWE4MTY2OGY4NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-MFnhgFqTQ2NTk1ODA5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e6e4424cfb2140e9191842e3653161a81668f85d", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/e6e4424cfb2140e9191842e3653161a81668f85d", "committedDate": "2020-08-12T06:06:14Z", "message": "fix: enables emulator tests\n\nEnables emulator for integration tests that were previously being\nskipped. The emulator now provides the features for theses tests to run\nwith it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff377ce6c5aef90307bc6704745e30d136c166c5", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/ff377ce6c5aef90307bc6704745e30d136c166c5", "committedDate": "2020-08-12T05:56:54Z", "message": "fix: enables emulator tests\n\nEnables emulator for integration tests that were previously being\nskipped. The emulator now provides the features for theses tests to run\nwith it."}, "afterCommit": {"oid": "e6e4424cfb2140e9191842e3653161a81668f85d", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/e6e4424cfb2140e9191842e3653161a81668f85d", "committedDate": "2020-08-12T06:06:14Z", "message": "fix: enables emulator tests\n\nEnables emulator for integration tests that were previously being\nskipped. The emulator now provides the features for theses tests to run\nwith it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NjExOTA4", "url": "https://github.com/googleapis/java-spanner/pull/380#pullrequestreview-465611908", "createdAt": "2020-08-12T06:01:51Z", "commit": {"oid": "ff377ce6c5aef90307bc6704745e30d136c166c5"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNjowMjo1NFrOG_S65w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNjowNzoxMVrOG_TA1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyMzQ2Mw==", "bodyText": "This needed to be updated so that the tests run properly with the emulator. This enables a new spanner instance to be created when running with the emulator.", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469023463", "createdAt": "2020-08-12T06:02:54Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/IntegrationTestEnv.java", "diffHunk": "@@ -79,7 +80,7 @@ protected void before() throws Throwable {\n     SpannerOptions options = config.spannerOptions();\n     String instanceProperty = System.getProperty(TEST_INSTANCE_PROPERTY, \"\");\n     InstanceId instanceId;\n-    if (!instanceProperty.isEmpty()) {\n+    if (!instanceProperty.isEmpty() && !isUsingEmulator()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff377ce6c5aef90307bc6704745e30d136c166c5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyMzU4NA==", "bodyText": "Enables this test to use the emulator.", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469023584", "createdAt": "2020-08-12T06:03:21Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITAsyncAPITest.java", "diffHunk": "@@ -279,9 +278,6 @@ public void columnNotFound() throws Exception {\n \n   @Test\n   public void asyncRunnerFireAndForgetInvalidUpdate() throws Exception {\n-    assumeFalse(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff377ce6c5aef90307bc6704745e30d136c166c5"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyMzYzMg==", "bodyText": "Enables this test to use the emulator.", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469023632", "createdAt": "2020-08-12T06:03:28Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITClosedSessionTest.java", "diffHunk": "@@ -61,10 +60,6 @@\n \n   @BeforeClass\n   public static void setUpDatabase() {\n-    // TODO: Enable when the emulator returns ResourceInfo for Session not found errors.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff377ce6c5aef90307bc6704745e30d136c166c5"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyMzgzOQ==", "bodyText": "Enables this test to use the emulator.", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469023839", "createdAt": "2020-08-12T06:04:08Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITCommitTimestampTest.java", "diffHunk": "@@ -336,8 +336,6 @@ public void interleavedTableHierarchy1() {\n   // allowed if child tables are not allow_commmit_timestamp=true\n   @Test\n   public void interleavedTableHierarchy2() {\n-    // TODO: Remove the following line once the emulator is as strict as Cloud Spanner.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff377ce6c5aef90307bc6704745e30d136c166c5"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyNDk4MA==", "bodyText": "Enables this test to use the emulator.", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469024980", "createdAt": "2020-08-12T06:07:11Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITCommitTimestampTest.java", "diffHunk": "@@ -325,19 +324,14 @@ public void interleavedTableHierarchy1() {\n                   .build()));\n       fail(\"missing expected exception\");\n     } catch (SpannerException e) {\n-      // TODO: Remove when the emulator returns the same error code as Cloud Spanner.\n-      if (!env.getTestHelper().isEmulator()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6e4424cfb2140e9191842e3653161a81668f85d"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49921046645696f44a7c13b20866ea7d74157608", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/49921046645696f44a7c13b20866ea7d74157608", "committedDate": "2020-08-12T06:14:35Z", "message": "fix: formatting\n\nFixes formatting of code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75197c65e64c33a8b1361755aa88170b7ead3e5d", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/75197c65e64c33a8b1361755aa88170b7ead3e5d", "committedDate": "2020-08-12T06:21:34Z", "message": "fix: deprecates method for emulator check\n\nDeprecates method to check for the emulator and uses the new\nSpannerEmulatorHelper class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11dc86f2f3c472dcccd2da00e7bb19b453be0069", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/11dc86f2f3c472dcccd2da00e7bb19b453be0069", "committedDate": "2020-08-12T06:27:48Z", "message": "refactor: renames class\n\nRenames helper class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NjI3NzQ5", "url": "https://github.com/googleapis/java-spanner/pull/380#pullrequestreview-465627749", "createdAt": "2020-08-12T06:38:04Z", "commit": {"oid": "11dc86f2f3c472dcccd2da00e7bb19b453be0069"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNjozODowNFrOG_TtYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNjozODowNFrOG_TtYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAzNjM4Ng==", "bodyText": "Refactors: deprecate this method and use the newly created method.", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469036386", "createdAt": "2020-08-12T06:38:04Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/testing/RemoteSpannerHelper.java", "diffHunk": "@@ -58,8 +57,15 @@ public SpannerOptions getOptions() {\n     return options;\n   }\n \n+  /**\n+   * Checks whether the emulator is being used.\n+   *\n+   * @deprecated use {@link EmulatorSpannerHelper#isUsingEmulator()} instead.\n+   * @return true if the emulator is being used. Returns false otherwise.\n+   */\n+  @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11dc86f2f3c472dcccd2da00e7bb19b453be0069"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1OTU4MDk5", "url": "https://github.com/googleapis/java-spanner/pull/380#pullrequestreview-465958099", "createdAt": "2020-08-12T14:14:23Z", "commit": {"oid": "11dc86f2f3c472dcccd2da00e7bb19b453be0069"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 813, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}