{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MjIxNjE3", "number": 75, "title": "Fix: multiple calls to end of span", "bodyText": "Fixes #71", "createdAt": "2020-02-14T05:39:29Z", "url": "https://github.com/googleapis/java-spanner/pull/75", "merged": true, "mergeCommit": {"oid": "3f32f51d70ceacbea02439c0f48ad057b10fb570"}, "closed": true, "closedAt": "2020-02-25T23:15:51Z", "author": {"login": "mayurkale22"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEI197AFqTM1ODcyMTcxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGnHLdAH2gAyMzc1MjIxNjE3OmE1YzVkMDFhZGIwMzZiNWFjNjEyNTA2ZTAzNmFmOTc3YTc5MDdlMTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NzIxNzE5", "url": "https://github.com/googleapis/java-spanner/pull/75#pullrequestreview-358721719", "createdAt": "2020-02-14T05:39:57Z", "commit": {"oid": "478251f868ba8c668326648b4a1f14e11b6e6881"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwNTozOTo1N1rOFpsF8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwNTozOTo1N1rOFpsF8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI1ODM1Mw==", "bodyText": "tracer.getCurrentSpan() is called outside of scope, which means endSpanWithFailure will execute on either READ_WRITE_TRANSACTION or READ_ONLY_TRANSACTION span instead of WAIT_FOR_SESSION span.", "url": "https://github.com/googleapis/java-spanner/pull/75#discussion_r379258353", "createdAt": "2020-02-14T05:39:57Z", "author": {"login": "mayurkale22"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/SessionPool.java", "diffHunk": "@@ -892,7 +892,7 @@ private PooledSession take() throws SpannerException {\n             return s.session;\n           }\n         } catch (Exception e) {\n-          TraceUtil.endSpanWithFailure(tracer.getCurrentSpan(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "478251f868ba8c668326648b4a1f14e11b6e6881"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MTA5MzQ0", "url": "https://github.com/googleapis/java-spanner/pull/75#pullrequestreview-359109344", "createdAt": "2020-02-14T17:41:37Z", "commit": {"oid": "478251f868ba8c668326648b4a1f14e11b6e6881"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNzo0MTozN1rOFp-etQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNzo0MTozN1rOFp-etQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU1OTYwNQ==", "bodyText": "is endSpanWithFailure used anywhere now? If not then please remove it.", "url": "https://github.com/googleapis/java-spanner/pull/75#discussion_r379559605", "createdAt": "2020-02-14T17:41:37Z", "author": {"login": "rghetia"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/TraceUtil.java", "diffHunk": "@@ -54,6 +54,16 @@\n         \"Status\", AttributeValue.stringAttributeValue(e.getErrorCode().toString()));\n   }\n \n+  static void setWithFailure(Span span, Throwable e) {\n+    if (e instanceof SpannerException) {\n+      span.setStatus(\n+          StatusConverter.fromGrpcStatus(((SpannerException) e).getErrorCode().getGrpcStatus())\n+              .withDescription(e.getMessage()));\n+    } else {\n+      span.setStatus(Status.INTERNAL.withDescription(e.getMessage()));\n+    }\n+  }\n+\n   static void endSpanWithFailure(Span span, Throwable e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "478251f868ba8c668326648b4a1f14e11b6e6881"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNzY1Njg2", "url": "https://github.com/googleapis/java-spanner/pull/75#pullrequestreview-360765686", "createdAt": "2020-02-19T00:17:38Z", "commit": {"oid": "10d5ffcfb27641bdb36b6a731a43960084a20d4b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0627b8767b0e2c6b731a0b741abeda5933af7af", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/c0627b8767b0e2c6b731a0b741abeda5933af7af", "committedDate": "2020-02-20T20:46:08Z", "message": "attempt to fix tests"}, "afterCommit": {"oid": "30ab679d3217de6d9a98eb0a25d3009f891c81ca", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/30ab679d3217de6d9a98eb0a25d3009f891c81ca", "committedDate": "2020-02-20T22:52:11Z", "message": "attempt to fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30ab679d3217de6d9a98eb0a25d3009f891c81ca", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/30ab679d3217de6d9a98eb0a25d3009f891c81ca", "committedDate": "2020-02-20T22:52:11Z", "message": "attempt to fix tests"}, "afterCommit": {"oid": "55f9dcb9bfb9385fdc512c411b68cdecccb8b79b", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/55f9dcb9bfb9385fdc512c411b68cdecccb8b79b", "committedDate": "2020-02-20T22:54:40Z", "message": "attempt to fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55f9dcb9bfb9385fdc512c411b68cdecccb8b79b", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/55f9dcb9bfb9385fdc512c411b68cdecccb8b79b", "committedDate": "2020-02-20T22:54:40Z", "message": "attempt to fix tests"}, "afterCommit": {"oid": "02563ec904f38cd74b265ca8981b80d5b543d5f7", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/02563ec904f38cd74b265ca8981b80d5b543d5f7", "committedDate": "2020-02-21T00:21:14Z", "message": "attempt to fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02563ec904f38cd74b265ca8981b80d5b543d5f7", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/02563ec904f38cd74b265ca8981b80d5b543d5f7", "committedDate": "2020-02-21T00:21:14Z", "message": "attempt to fix tests"}, "afterCommit": {"oid": "c0689bd4ecce3dcb6b2397b6dc802b3339372c83", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/c0689bd4ecce3dcb6b2397b6dc802b3339372c83", "committedDate": "2020-02-21T00:44:57Z", "message": "attempt to fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODg2NzEw", "url": "https://github.com/googleapis/java-spanner/pull/75#pullrequestreview-362886710", "createdAt": "2020-02-21T20:08:13Z", "commit": {"oid": "c0689bd4ecce3dcb6b2397b6dc802b3339372c83"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feb6157e65376998f97c3fc3210ec1a21b99d2c6", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/feb6157e65376998f97c3fc3210ec1a21b99d2c6", "committedDate": "2020-02-21T21:58:44Z", "message": "fix: multiple span.end calling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a96f099d68bcaff50d594ca224bdfe663a57fd6a", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/a96f099d68bcaff50d594ca224bdfe663a57fd6a", "committedDate": "2020-02-21T21:58:44Z", "message": "fix: multiple span.end calling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a6376d8dac18a14c9b6903f36adf0ee968044bc", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/1a6376d8dac18a14c9b6903f36adf0ee968044bc", "committedDate": "2020-02-21T21:58:44Z", "message": "fix: multiple span.end calling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d5561b31b63cc02856183f98288667ac2fe0da6", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/3d5561b31b63cc02856183f98288667ac2fe0da6", "committedDate": "2020-02-21T21:58:44Z", "message": "integrate test framework for span"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5042cae19d985a0de9d397e1f83e77c60640d106", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/5042cae19d985a0de9d397e1f83e77c60640d106", "committedDate": "2020-02-21T21:58:44Z", "message": "add stream=null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6082a6dd399f104f24a0d6ae10f5a70a831508b5", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/6082a6dd399f104f24a0d6ae10f5a70a831508b5", "committedDate": "2020-02-21T21:58:44Z", "message": "fix: execute tracer tests in separate execution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbe356e96e799c5ba03534c958edf2f0a7403f48", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/dbe356e96e799c5ba03534c958edf2f0a7403f48", "committedDate": "2020-02-21T21:58:44Z", "message": "format: format pom"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bcaee80ce91f1ae285d53359fac6e03c06ceede", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/1bcaee80ce91f1ae285d53359fac6e03c06ceede", "committedDate": "2020-02-21T21:58:44Z", "message": "attempt to fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0689bd4ecce3dcb6b2397b6dc802b3339372c83", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/c0689bd4ecce3dcb6b2397b6dc802b3339372c83", "committedDate": "2020-02-21T00:44:57Z", "message": "attempt to fix tests"}, "afterCommit": {"oid": "1bcaee80ce91f1ae285d53359fac6e03c06ceede", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/1bcaee80ce91f1ae285d53359fac6e03c06ceede", "committedDate": "2020-02-21T21:58:44Z", "message": "attempt to fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5c5d01adb036b5ac612506e036af977a7907e18", "author": {"user": {"login": "mayurkale22", "name": "Mayur Kale"}}, "url": "https://github.com/googleapis/java-spanner/commit/a5c5d01adb036b5ac612506e036af977a7907e18", "committedDate": "2020-02-21T22:03:46Z", "message": "add com.google.errorprone:error_prone_annotations to ignoredDependencies"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 864, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}