{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3Mzc3MjM2", "number": 203, "title": "fix: Partitioned DML timeout was not always respected", "bodyText": "Setting a timeout value for Partitioned DML would not be respected if the timeout value was higher than the timeout value set for the ExecuteSql RPC on the SpannerStub. Lower timeout values would be respected.\nFixes #199", "createdAt": "2020-05-13T13:52:09Z", "url": "https://github.com/googleapis/java-spanner/pull/203", "merged": true, "mergeCommit": {"oid": "13cb37e55ddfd1ff4ec22b1dcdc20c4832eee444"}, "closed": true, "closedAt": "2020-05-14T06:45:05Z", "author": {"login": "olavloite"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchGV0rgFqTQxMTQ2ODA0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchHXIXgBqjMzMzUwMTY5Mjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNDY4MDQ3", "url": "https://github.com/googleapis/java-spanner/pull/203#pullrequestreview-411468047", "createdAt": "2020-05-14T05:08:50Z", "commit": {"oid": "2ceb59164d6f4ee1740a37e61741bd6a5a5d8004"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNTowODo1MFrOGVMOvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNTowODo1MFrOGVMOvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDg3MzY2MA==", "bodyText": "Are PDML requests not meant to be retried? I'm just curious why the initial and max timeouts are the same.", "url": "https://github.com/googleapis/java-spanner/pull/203#discussion_r424873660", "createdAt": "2020-05-14T05:08:50Z", "author": {"login": "skuruppu"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/spi/v1/GapicSpannerRpc.java", "diffHunk": "@@ -326,6 +330,22 @@ public GapicSpannerRpc(final SpannerOptions options) {\n                   .setCredentialsProvider(credentialsProvider)\n                   .setStreamWatchdogProvider(watchdogProvider)\n                   .build());\n+      SpannerStubSettings.Builder pdmlSettings = options.getSpannerStubSettings().toBuilder();\n+      pdmlSettings\n+          .setTransportChannelProvider(channelProvider)\n+          .setCredentialsProvider(credentialsProvider)\n+          .setStreamWatchdogProvider(watchdogProvider)\n+          .executeSqlSettings()\n+          .setRetrySettings(\n+              options\n+                  .getSpannerStubSettings()\n+                  .executeSqlSettings()\n+                  .getRetrySettings()\n+                  .toBuilder()\n+                  .setInitialRpcTimeout(options.getPartitionedDmlTimeout())\n+                  .setMaxRpcTimeout(options.getPartitionedDmlTimeout())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ceb59164d6f4ee1740a37e61741bd6a5a5d8004"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNDY4MTI0", "url": "https://github.com/googleapis/java-spanner/pull/203#pullrequestreview-411468124", "createdAt": "2020-05-14T05:09:09Z", "commit": {"oid": "2ceb59164d6f4ee1740a37e61741bd6a5a5d8004"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bcbf5ed69f0ed736a910ce4f9476e6b790b469e", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/1bcbf5ed69f0ed736a910ce4f9476e6b790b469e", "committedDate": "2020-05-14T06:20:00Z", "message": "fix: Partitioned DML timeout was not always respected\n\nSetting a timeout value for Partitioned DML would not be respected if the timeout\nvalue was higher than the timeout value set for the ExecuteSql RPC on the SpannerStub.\nLower timeout values would be respected.\n\nFixes #199"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afbb2c4dbd667a2dd74f63f4babf1c8904475a6c", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/afbb2c4dbd667a2dd74f63f4babf1c8904475a6c", "committedDate": "2020-05-14T06:20:00Z", "message": "fix: add ignored changes + InternalApi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aac7cf76218f75f6f55ef18426438b9a8d9ba6d4", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/aac7cf76218f75f6f55ef18426438b9a8d9ba6d4", "committedDate": "2020-05-14T06:20:00Z", "message": "tests: add test for retry on UNAVAILABLE"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ceb59164d6f4ee1740a37e61741bd6a5a5d8004", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/2ceb59164d6f4ee1740a37e61741bd6a5a5d8004", "committedDate": "2020-05-13T15:33:15Z", "message": "fix: add ignored changes + InternalApi"}, "afterCommit": {"oid": "aac7cf76218f75f6f55ef18426438b9a8d9ba6d4", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/aac7cf76218f75f6f55ef18426438b9a8d9ba6d4", "committedDate": "2020-05-14T06:20:00Z", "message": "tests: add test for retry on UNAVAILABLE"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 839, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}