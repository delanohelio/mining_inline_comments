{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwNzE1OTY1", "number": 623, "title": "feat: add support for tagging to Connection API", "bodyText": "Adds support for tagging in the Connection API. This is needed to support tagging in the JDBC driver.\nThis is a binary breaking change, as it adds 4 methods to the Connection interface. That interface is marked as @InternalApi and warns that it may make breaking changes without prior notice.", "createdAt": "2020-11-13T17:20:08Z", "url": "https://github.com/googleapis/java-spanner/pull/623", "merged": true, "mergeCommit": {"oid": "5722372b7869828e372dec06e80e5b0e7280af61"}, "closed": true, "closedAt": "2021-07-05T08:45:59Z", "author": {"login": "olavloite"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcKg5jAFqTUzMDI2MDU3OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABenWqumgH2gAyNTIwNzE1OTY1OmRmMGIxMWQ1MjI5OTg4ZWMyNWU2MWIzNzdhOWY4ZWYyYTdkYmE5MDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjYwNTc5", "url": "https://github.com/googleapis/java-spanner/pull/623#pullrequestreview-530260579", "createdAt": "2020-11-13T17:22:06Z", "commit": {"oid": "6fcbdd022d9bf610a437f237814e4147cf1106db"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODcxODI3", "url": "https://github.com/googleapis/java-spanner/pull/623#pullrequestreview-530871827", "createdAt": "2020-11-16T01:55:17Z", "commit": {"oid": "6fcbdd022d9bf610a437f237814e4147cf1106db"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTo1NToxN1rOHzlsEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTo1NjowN1rOHzlsqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg1NjkxMw==", "bodyText": "How will this behave if the user never set a transaction tag?", "url": "https://github.com/googleapis/java-spanner/pull/623#discussion_r523856913", "createdAt": "2020-11-16T01:55:17Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/connection/ConnectionImpl.java", "diffHunk": "@@ -959,6 +1034,7 @@ private UnitOfWork createNewUnitOfWork() {\n               .setReadOnlyStaleness(readOnlyStaleness)\n               .setStatementTimeout(statementTimeout)\n               .withStatementExecutor(statementExecutor)\n+              .setTransactionTag(transactionTag)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fcbdd022d9bf610a437f237814e4147cf1106db"}, "originalPosition": 167}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg1NzA2NQ==", "bodyText": "Out of curiosity, could we prevent the calling of this for a COMMIT? The user should not be able to do a statement tag in that case.", "url": "https://github.com/googleapis/java-spanner/pull/623#discussion_r523857065", "createdAt": "2020-11-16T01:56:07Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/connection/ConnectionImpl.java", "diffHunk": "@@ -476,6 +482,42 @@ public void setTransactionMode(TransactionMode transactionMode) {\n     this.unitOfWorkType = UnitOfWorkType.of(transactionMode);\n   }\n \n+  @Override\n+  public String getTransactionTag() {\n+    ConnectionPreconditions.checkState(!isClosed(), CLOSED_ERROR_MSG);\n+    ConnectionPreconditions.checkState(!isDdlBatchActive(), \"This connection is in a DDL batch\");\n+    return transactionTag;\n+  }\n+\n+  @Override\n+  public void setTransactionTag(String tag) {\n+    ConnectionPreconditions.checkState(!isClosed(), CLOSED_ERROR_MSG);\n+    ConnectionPreconditions.checkState(\n+        !isBatchActive(), \"Cannot set transaction tag while in a batch\");\n+    ConnectionPreconditions.checkState(isInTransaction(), \"This connection has no transaction\");\n+    ConnectionPreconditions.checkState(\n+        !isTransactionStarted(),\n+        \"The transaction tag cannot be set after the transaction has started\");\n+\n+    this.transactionBeginMarked = true;\n+    this.transactionTag = tag;\n+  }\n+\n+  @Override\n+  public String getStatementTag() {\n+    ConnectionPreconditions.checkState(!isClosed(), CLOSED_ERROR_MSG);\n+    ConnectionPreconditions.checkState(!isDdlBatchActive(), \"This connection is in a DDL batch\");\n+    return statementTag;\n+  }\n+\n+  @Override\n+  public void setStatementTag(String tag) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fcbdd022d9bf610a437f237814e4147cf1106db"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODU4Mzg5", "url": "https://github.com/googleapis/java-spanner/pull/623#pullrequestreview-531858389", "createdAt": "2020-11-16T22:53:00Z", "commit": {"oid": "3ab89ea5737494f27fee3dd9d14e654e5983c49c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a87dfdf0a66936504c50a8fd239891b8c544ab3a", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/a87dfdf0a66936504c50a8fd239891b8c544ab3a", "committedDate": "2021-04-13T15:34:22Z", "message": "feat: add support for tagging in Connection API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c1416442b526fafa0481240fd0e21570f4772f8", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/6c1416442b526fafa0481240fd0e21570f4772f8", "committedDate": "2021-04-13T15:34:24Z", "message": "fix: disallow statement tags for commit/rollback/run"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "510fdb3a40deb15ab7cbff30d763ddde0fa47223", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/510fdb3a40deb15ab7cbff30d763ddde0fa47223", "committedDate": "2021-04-13T16:18:03Z", "message": "chore: cleanup after rebase"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ab89ea5737494f27fee3dd9d14e654e5983c49c", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/3ab89ea5737494f27fee3dd9d14e654e5983c49c", "committedDate": "2020-11-16T13:11:52Z", "message": "fix: disallow statement tags for commit/rollback/run"}, "afterCommit": {"oid": "510fdb3a40deb15ab7cbff30d763ddde0fa47223", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/510fdb3a40deb15ab7cbff30d763ddde0fa47223", "committedDate": "2021-04-13T16:18:03Z", "message": "chore: cleanup after rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9f9ca872339187140a7e06917f6694f6ccc7b86", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/d9f9ca872339187140a7e06917f6694f6ccc7b86", "committedDate": "2021-04-13T18:16:20Z", "message": "test: add generated tests + cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a6c635e5f154ca66051fcffd128ad8013af479d", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/2a6c635e5f154ca66051fcffd128ad8013af479d", "committedDate": "2021-04-13T18:20:46Z", "message": "build: add new methods to clirr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0868a050d07e261f4b1a21575b53834071f0f4c7", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/0868a050d07e261f4b1a21575b53834071f0f4c7", "committedDate": "2021-04-14T08:47:30Z", "message": "fix: add default implementations for new methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df0b11d5229988ec25e61b377a9f8ef2a7dba900", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/df0b11d5229988ec25e61b377a9f8ef2a7dba900", "committedDate": "2021-07-05T07:56:01Z", "message": "Merge branch 'master' into connection-api-tagging"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 997, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}