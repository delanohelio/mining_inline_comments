{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNDk0MDc5", "number": 505, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDo0Mzo0NVrOEsFDXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDo0Mzo0NVrOEsFDXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NjU1NTgzOnYy", "diffSide": "RIGHT", "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/AsyncTransactionManagerImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDo0Mzo0NVrOHfMx8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODoxMDo0N1rOHgzXHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ3NzI5Nw==", "bodyText": "Can there be a version of close() that propagates the ApiFutrue from rollbackAsync() back to the caller? Otherwise the application could shut down (or, in my case, the test terminate) before the rollback happens.", "url": "https://github.com/googleapis/java-spanner/pull/505#discussion_r502477297", "createdAt": "2020-10-09T14:43:45Z", "author": {"login": "elefeint"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/AsyncTransactionManagerImpl.java", "diffHunk": "@@ -54,6 +54,9 @@ public void setSpan(Span span) {\n \n   @Override\n   public void close() {\n+    if (txnState == TransactionState.STARTED) {\n+      rollbackAsync();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d79c460bf0d12b272e6ec6db5d55d394918a7beb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE1Nzk4MQ==", "bodyText": "I've added a closeAsync() method to the AsyncTransactionManager interface that returns an ApiFuture that is done when everything has been rolled back and released. PTAL.", "url": "https://github.com/googleapis/java-spanner/pull/505#discussion_r504157981", "createdAt": "2020-10-13T18:10:47Z", "author": {"login": "olavloite"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/AsyncTransactionManagerImpl.java", "diffHunk": "@@ -54,6 +54,9 @@ public void setSpan(Span span) {\n \n   @Override\n   public void close() {\n+    if (txnState == TransactionState.STARTED) {\n+      rollbackAsync();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ3NzI5Nw=="}, "originalCommit": {"oid": "d79c460bf0d12b272e6ec6db5d55d394918a7beb"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3343, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}