{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MzQxOTc5", "number": 524, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMzozMzozOVrOEvipig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMzozMzozOVrOEvipig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4Mjg2MjE4OnYy", "diffSide": "RIGHT", "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/IntegrationTestEnv.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMzozMzo0MFrOHklQvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMjo0ODowNFrOHlT3tA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyMTI3OA==", "bodyText": "This is to fix the flakiness on the internal runs of these integration tests.\nI do wonder if this timeout is even necessary. @olavloite do you know if these long-running operation settings are respected by the OperationFuture?\nhttps://github.com/googleapis/googleapis/blob/master/google/spanner/admin/instance/v1/spanner_admin_instance_gapic.yaml#L23-L27", "url": "https://github.com/googleapis/java-spanner/pull/524#discussion_r508121278", "createdAt": "2020-10-19T23:33:40Z", "author": {"login": "skuruppu"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/IntegrationTestEnv.java", "diffHunk": "@@ -126,7 +126,7 @@ private void initializeInstance(InstanceId instanceId) {\n         instanceAdminClient.createInstance(instance);\n     Instance createdInstance;\n     try {\n-      createdInstance = op.get(30000L, TimeUnit.MILLISECONDS);\n+      createdInstance = op.get(3600000L, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3fe89f2fb2e1d85b776cc157f8e8d162a905708"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE0MzM5NQ==", "bodyText": "Won't we have to wait 1 hour if the test hang for some reason (or do you think this should not happen)? Maybe a few minutes could be enough?", "url": "https://github.com/googleapis/java-spanner/pull/524#discussion_r508143395", "createdAt": "2020-10-20T00:48:25Z", "author": {"login": "thiagotnunes"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/IntegrationTestEnv.java", "diffHunk": "@@ -126,7 +126,7 @@ private void initializeInstance(InstanceId instanceId) {\n         instanceAdminClient.createInstance(instance);\n     Instance createdInstance;\n     try {\n-      createdInstance = op.get(30000L, TimeUnit.MILLISECONDS);\n+      createdInstance = op.get(3600000L, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyMTI3OA=="}, "originalCommit": {"oid": "e3fe89f2fb2e1d85b776cc157f8e8d162a905708"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE0Nzk2Ng==", "bodyText": "Yeah I agree, there may be other test timeouts that get triggered if we make it so long. I will check with the team on what they think is an appropriate value.", "url": "https://github.com/googleapis/java-spanner/pull/524#discussion_r508147966", "createdAt": "2020-10-20T01:04:46Z", "author": {"login": "skuruppu"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/IntegrationTestEnv.java", "diffHunk": "@@ -126,7 +126,7 @@ private void initializeInstance(InstanceId instanceId) {\n         instanceAdminClient.createInstance(instance);\n     Instance createdInstance;\n     try {\n-      createdInstance = op.get(30000L, TimeUnit.MILLISECONDS);\n+      createdInstance = op.get(3600000L, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyMTI3OA=="}, "originalCommit": {"oid": "e3fe89f2fb2e1d85b776cc157f8e8d162a905708"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM5MDY2NQ==", "bodyText": "I do wonder if this timeout is even necessary. @olavloite do you know if these long-running operation settings are respected by the OperationFuture?\n\nYes, as far as I can remember they are. The total timeout in the config is however 24 hours, so it will take a very long time before it actually times out with the default settings.", "url": "https://github.com/googleapis/java-spanner/pull/524#discussion_r508390665", "createdAt": "2020-10-20T10:33:05Z", "author": {"login": "olavloite"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/IntegrationTestEnv.java", "diffHunk": "@@ -126,7 +126,7 @@ private void initializeInstance(InstanceId instanceId) {\n         instanceAdminClient.createInstance(instance);\n     Instance createdInstance;\n     try {\n-      createdInstance = op.get(30000L, TimeUnit.MILLISECONDS);\n+      createdInstance = op.get(3600000L, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyMTI3OA=="}, "originalCommit": {"oid": "e3fe89f2fb2e1d85b776cc157f8e8d162a905708"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg4NDkxNg==", "bodyText": "Yup, I think it is set here:\n\n  \n    \n      java-spanner/google-cloud-spanner/src/main/java/com/google/cloud/spanner/admin/instance/v1/stub/InstanceAdminStubSettings.java\n    \n    \n        Lines 626 to 636\n      in\n      60dd9fb\n    \n    \n    \n    \n\n        \n          \n           .setPollingAlgorithm( \n        \n\n        \n          \n               OperationTimedPollAlgorithm.create( \n        \n\n        \n          \n                   RetrySettings.newBuilder() \n        \n\n        \n          \n                       .setInitialRetryDelay(Duration.ofMillis(20000L)) \n        \n\n        \n          \n                       .setRetryDelayMultiplier(1.5) \n        \n\n        \n          \n                       .setMaxRetryDelay(Duration.ofMillis(45000L)) \n        \n\n        \n          \n                       .setInitialRpcTimeout(Duration.ZERO) // ignored \n        \n\n        \n          \n                       .setRpcTimeoutMultiplier(1.0) // ignored \n        \n\n        \n          \n                       .setMaxRpcTimeout(Duration.ZERO) // ignored \n        \n\n        \n          \n                       .setTotalTimeout(Duration.ofMillis(86400000L)) \n        \n\n        \n          \n                       .build())); \n        \n    \n  \n\n\nSo I will remove this timeout altogether :)\nI think this makes sense given that's how we do op.get() in tests for backups and databases. We use the default settings from the config.", "url": "https://github.com/googleapis/java-spanner/pull/524#discussion_r508884916", "createdAt": "2020-10-20T22:48:04Z", "author": {"login": "skuruppu"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/IntegrationTestEnv.java", "diffHunk": "@@ -126,7 +126,7 @@ private void initializeInstance(InstanceId instanceId) {\n         instanceAdminClient.createInstance(instance);\n     Instance createdInstance;\n     try {\n-      createdInstance = op.get(30000L, TimeUnit.MILLISECONDS);\n+      createdInstance = op.get(3600000L, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyMTI3OA=="}, "originalCommit": {"oid": "e3fe89f2fb2e1d85b776cc157f8e8d162a905708"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3294, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}