{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MTY2MTUz", "number": 665, "title": "feat: add support for instance processing units", "bodyText": "", "createdAt": "2020-11-19T19:00:51Z", "url": "https://github.com/googleapis/java-spanner/pull/665", "merged": true, "mergeCommit": {"oid": "9c1c8e90b0e02e26ea3c16def49bb7e07c2b04b1"}, "closed": true, "closedAt": "2021-06-21T01:22:18Z", "author": {"login": "olavloite"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfK_A7AFqTUzNjE0MjQyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABeh8HVKAFqTY4NzMzODk2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MTQyNDI5", "url": "https://github.com/googleapis/java-spanner/pull/665#pullrequestreview-536142429", "createdAt": "2020-11-23T01:36:46Z", "commit": {"oid": "2334339444030c3d40b33195384f1255a24d4893"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MDkzMDE1", "url": "https://github.com/googleapis/java-spanner/pull/665#pullrequestreview-538093015", "createdAt": "2020-11-25T01:34:20Z", "commit": {"oid": "2334339444030c3d40b33195384f1255a24d4893"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTczMzQ1NDMw", "url": "https://github.com/googleapis/java-spanner/pull/665#pullrequestreview-573345430", "createdAt": "2021-01-21T13:50:42Z", "commit": {"oid": "e241e257f2624893a18b252b73d5844c54a3fd1f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxMzo1MDo0M1rOIX3V5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxMzo1MDo0M1rOIX3V5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTg5NDg4Nw==", "bodyText": "This change might break customers and probably should have a major version bump.", "url": "https://github.com/googleapis/java-spanner/pull/665#discussion_r561894887", "createdAt": "2021-01-21T13:50:43Z", "author": {"login": "elharo"}, "path": "google-cloud-spanner/clirr-ignored-differences.xml", "diffHunk": "@@ -406,4 +406,10 @@\n     <className>com/google/cloud/spanner/AbstractLazyInitializer</className>\n     <method>java.lang.Object initialize()</method>\n   </difference>\n+  \n+  <difference>\n+    <differenceType>7013</differenceType>\n+    <className>com/google/cloud/spanner/InstanceInfo$Builder</className>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e241e257f2624893a18b252b73d5844c54a3fd1f"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6269b7b227a11076604e924aff3c7a300142698b", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/6269b7b227a11076604e924aff3c7a300142698b", "committedDate": "2021-02-08T13:57:13Z", "message": "chore: fix formatting"}, "afterCommit": {"oid": "674643592939187b0541c1f9c76a475ef74e4d3e", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/674643592939187b0541c1f9c76a475ef74e4d3e", "committedDate": "2021-05-06T04:52:23Z", "message": "chore: fix formatting"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "674643592939187b0541c1f9c76a475ef74e4d3e", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/674643592939187b0541c1f9c76a475ef74e4d3e", "committedDate": "2021-05-06T04:52:23Z", "message": "chore: fix formatting"}, "afterCommit": {"oid": "6269b7b227a11076604e924aff3c7a300142698b", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/6269b7b227a11076604e924aff3c7a300142698b", "committedDate": "2021-02-08T13:57:13Z", "message": "chore: fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be69e3665de110b5791423861b33c4787bb36ae9", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/be69e3665de110b5791423861b33c4787bb36ae9", "committedDate": "2021-05-06T06:13:18Z", "message": "feat: add support for instance processing units"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52555eac3d74b02eb229bccd994179f23a43daa6", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/52555eac3d74b02eb229bccd994179f23a43daa6", "committedDate": "2021-05-06T06:13:18Z", "message": "docs: add sample for instance processing units"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74707480aca872592fa97c5c55121aaaa243db4b", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/74707480aca872592fa97c5c55121aaaa243db4b", "committedDate": "2021-05-06T06:13:18Z", "message": "fix: remove commented code + use junit asserts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8e64c8c14f98d1a0234aa4f04c08dfdb746c3fe", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/a8e64c8c14f98d1a0234aa4f04c08dfdb746c3fe", "committedDate": "2021-05-06T06:13:18Z", "message": "fix: remove Spanner snapshot reference"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98b5f58a488f5cb0741839e0e948689ada160596", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/98b5f58a488f5cb0741839e0e948689ada160596", "committedDate": "2021-05-06T06:13:18Z", "message": "test: add tests for InstanceInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c9e26e4bab532d06667f1b0591833218ee5fad7", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/0c9e26e4bab532d06667f1b0591833218ee5fad7", "committedDate": "2021-05-06T06:13:18Z", "message": "cleanup: fix formatting + tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4e4c390ecdb08a65219ccdb44e07eaaa22dc485", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/b4e4c390ecdb08a65219ccdb44e07eaaa22dc485", "committedDate": "2021-05-06T06:13:18Z", "message": "chore: fix formatting"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6269b7b227a11076604e924aff3c7a300142698b", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/6269b7b227a11076604e924aff3c7a300142698b", "committedDate": "2021-02-08T13:57:13Z", "message": "chore: fix formatting"}, "afterCommit": {"oid": "b4e4c390ecdb08a65219ccdb44e07eaaa22dc485", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/b4e4c390ecdb08a65219ccdb44e07eaaa22dc485", "committedDate": "2021-05-06T06:13:18Z", "message": "chore: fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c11c844a389a29c2ccca4de43a17b762606db2c5", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/c11c844a389a29c2ccca4de43a17b762606db2c5", "committedDate": "2021-05-06T06:23:13Z", "message": "Merge branch 'master' of github.com:googleapis/java-spanner into processing-units"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5569ef7b2f2b92240f01f47064337623cbc03fb", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/f5569ef7b2f2b92240f01f47064337623cbc03fb", "committedDate": "2021-05-06T06:17:05Z", "message": "chore:regen"}, "afterCommit": {"oid": "187c33c336872631f057f6810983830539afee14", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/187c33c336872631f057f6810983830539afee14", "committedDate": "2021-05-06T06:25:04Z", "message": "chore:regen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a3f44b5ce66c1af3fa15d6a3fb61e4f16d22fca", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/4a3f44b5ce66c1af3fa15d6a3fb61e4f16d22fca", "committedDate": "2021-06-15T23:49:03Z", "message": "test: fixes instanceinfo test\n\nDue to master merge the compilation was failing. Fixes the builder\nconstruction here."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ecd9f65ce5e510d0112fc4be33f92de919bf66f", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/1ecd9f65ce5e510d0112fc4be33f92de919bf66f", "committedDate": "2021-06-15T23:49:14Z", "message": "Merge branch 'master' of github.com:googleapis/java-spanner into processing-units"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "657f210a71dac6fcfba9b8badb88614dbd2eff23", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/657f210a71dac6fcfba9b8badb88614dbd2eff23", "committedDate": "2021-06-15T23:50:33Z", "message": "refactor: adds default impl for processing units\n\nAdds default implementation for the InstanceInfo set processing units in\norder to avoid a breaking change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc178921927d28ceb54ba49f195752c44ce45f82", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/dc178921927d28ceb54ba49f195752c44ce45f82", "committedDate": "2021-06-15T23:52:01Z", "message": "samples: remove LCI samples for now\n\nRemoves the LCI samples for now, because they won't compile. We will\nre-add them once the main implementation is released."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b164d504aa846ece23703dc62a9a96a266bdf615", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/b164d504aa846ece23703dc62a9a96a266bdf615", "committedDate": "2021-05-06T06:35:41Z", "message": "test: fixes instanceinfo test\n\nDue to master merge the compilation was failing. Fixes the builder\nconstruction here."}, "afterCommit": {"oid": "dc178921927d28ceb54ba49f195752c44ce45f82", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/dc178921927d28ceb54ba49f195752c44ce45f82", "committedDate": "2021-06-15T23:52:01Z", "message": "samples: remove LCI samples for now\n\nRemoves the LCI samples for now, because they won't compile. We will\nre-add them once the main implementation is released."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njg1MDEzNDc1", "url": "https://github.com/googleapis/java-spanner/pull/665#pullrequestreview-685013475", "createdAt": "2021-06-16T10:49:36Z", "commit": {"oid": "dc178921927d28ceb54ba49f195752c44ce45f82"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xNlQxMDo0OTozNlrOJuV97Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xNlQxMDo1MjowNlrOJuWETw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MjU3NDE4OQ==", "bodyText": "This field is superfluous and adds an unnecessary indirection. Inline it. In general, do not use named constants for user visible strings.", "url": "https://github.com/googleapis/java-spanner/pull/665#discussion_r652574189", "createdAt": "2021-06-16T10:49:36Z", "author": {"login": "elharo"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/InstanceAdminClientImpl.java", "diffHunk": "@@ -47,6 +47,8 @@ protected Policy fromPb(com.google.iam.v1.Policy policyPb) {\n     }\n   }\n \n+  static final String NOT_BOTH_NODE_COUNT_AND_PROCESSING_UNITS =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc178921927d28ceb54ba49f195752c44ce45f82"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MjU3NDY5MA==", "bodyText": "Must or can? If must, then \"Exactly one of\"", "url": "https://github.com/googleapis/java-spanner/pull/665#discussion_r652574690", "createdAt": "2021-06-16T10:50:27Z", "author": {"login": "elharo"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/InstanceInfo.java", "diffHunk": "@@ -68,8 +77,22 @@ static FieldMask toFieldMask(InstanceField... fields) {\n \n     public abstract Builder setDisplayName(String displayName);\n \n+    /**\n+     * Sets the number of nodes for the instance. Only one of processing units or node count must be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc178921927d28ceb54ba49f195752c44ce45f82"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MjU3NDc4Ng==", "bodyText": "ditto", "url": "https://github.com/googleapis/java-spanner/pull/665#discussion_r652574786", "createdAt": "2021-06-16T10:50:36Z", "author": {"login": "elharo"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/InstanceInfo.java", "diffHunk": "@@ -68,8 +77,22 @@ static FieldMask toFieldMask(InstanceField... fields) {\n \n     public abstract Builder setDisplayName(String displayName);\n \n+    /**\n+     * Sets the number of nodes for the instance. Only one of processing units or node count must be\n+     * set when creating a new instance.\n+     */\n     public abstract Builder setNodeCount(int nodeCount);\n \n+    /**\n+     * Sets the number of processing units for the instance. Only one of processing units or node", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc178921927d28ceb54ba49f195752c44ce45f82"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MjU3NTE3Ng==", "bodyText": "i.e. --> \"That is\" per google tech writing style guide", "url": "https://github.com/googleapis/java-spanner/pull/665#discussion_r652575176", "createdAt": "2021-06-16T10:51:12Z", "author": {"login": "elharo"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/InstanceInfo.java", "diffHunk": "@@ -68,8 +77,22 @@ static FieldMask toFieldMask(InstanceField... fields) {\n \n     public abstract Builder setDisplayName(String displayName);\n \n+    /**\n+     * Sets the number of nodes for the instance. Only one of processing units or node count must be\n+     * set when creating a new instance.\n+     */\n     public abstract Builder setNodeCount(int nodeCount);\n \n+    /**\n+     * Sets the number of processing units for the instance. Only one of processing units or node\n+     * count must be set when creating a new instance. Processing units must be between 1 and 999\n+     * (inclusive) when creating a new instance with node count = 0. Processing units from 1000 and\n+     * up must always be a multiple of 1000 (i.e. equal to an integer number of nodes).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc178921927d28ceb54ba49f195752c44ce45f82"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MjU3NTgyMw==", "bodyText": "in tests compare against the expected literal value, not a constant from the model code, so the test catches mistakes in constant definitions.", "url": "https://github.com/googleapis/java-spanner/pull/665#discussion_r652575823", "createdAt": "2021-06-16T10:52:06Z", "author": {"login": "elharo"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/InstanceAdminClientImplTest.java", "diffHunk": "@@ -128,9 +144,49 @@ public void createInstance() throws Exception {\n   }\n \n   @Test\n-  public void getInstance() {\n+  public void testCreateInstanceWithProcessingUnits() throws Exception {\n+    OperationFuture<com.google.spanner.admin.instance.v1.Instance, CreateInstanceMetadata>\n+        rawOperationFuture =\n+            OperationFutureUtil.immediateOperationFuture(\n+                \"createInstance\",\n+                getInstanceProtoWithProcessingUnits(),\n+                CreateInstanceMetadata.getDefaultInstance());\n+    when(rpc.createInstance(\n+            \"projects/\" + PROJECT_ID, INSTANCE_ID, getInstanceProtoWithProcessingUnits()))\n+        .thenReturn(rawOperationFuture);\n+    OperationFuture<Instance, CreateInstanceMetadata> operation =\n+        client.createInstance(\n+            InstanceInfo.newBuilder(InstanceId.of(PROJECT_ID, INSTANCE_ID))\n+                .setInstanceConfigId(InstanceConfigId.of(PROJECT_ID, CONFIG_ID))\n+                .setProcessingUnits(10)\n+                .build());\n+    assertTrue(operation.isDone());\n+    assertEquals(INSTANCE_NAME, operation.get().getId().getName());\n+  }\n+\n+  @Test\n+  public void testCreateInstanceWithBothNodeCountAndProcessingUnits() throws Exception {\n+    try {\n+      client.createInstance(\n+          InstanceInfo.newBuilder(InstanceId.of(PROJECT_ID, INSTANCE_ID))\n+              .setInstanceConfigId(InstanceConfigId.of(PROJECT_ID, CONFIG_ID))\n+              .setNodeCount(1)\n+              .setProcessingUnits(100)\n+              .build());\n+      fail(\"missing expected exception\");\n+    } catch (IllegalArgumentException e) {\n+      assertTrue(\n+          e.getMessage()\n+              .contains(InstanceAdminClientImpl.NOT_BOTH_NODE_COUNT_AND_PROCESSING_UNITS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc178921927d28ceb54ba49f195752c44ce45f82"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c462aeffcf3b1b171f6d03b7eb7c7a3bd2828d2", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/5c462aeffcf3b1b171f6d03b7eb7c7a3bd2828d2", "committedDate": "2021-06-18T01:10:03Z", "message": "fix: addresses PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njg3MzM4OTY4", "url": "https://github.com/googleapis/java-spanner/pull/665#pullrequestreview-687338968", "createdAt": "2021-06-18T12:10:12Z", "commit": {"oid": "5c462aeffcf3b1b171f6d03b7eb7c7a3bd2828d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 915, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}