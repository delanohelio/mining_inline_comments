{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4OTM3MDk4", "number": 184, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMDozNDowOFrOD3IZZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMDozNDowOFrOD3IZZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5MTM1ODQ1OnYy", "diffSide": "RIGHT", "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITBackupTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMDozNDowOFrOGNNozQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMDozNDowOFrOGNNozQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjUwODEwOQ==", "bodyText": "If for any reason in the future, the cancelling still doesn't work, your other option may be to just call delete on those backups. AFAIK, backups in the process of being created can be deleted.", "url": "https://github.com/googleapis/java-spanner/pull/184#discussion_r416508109", "createdAt": "2020-04-28T10:34:08Z", "author": {"login": "skuruppu"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITBackupTest.java", "diffHunk": "@@ -93,6 +100,40 @@ public void setUp() throws Exception {\n     instanceAdminClient = testHelper.getClient().getInstanceAdminClient();\n     instance = instanceAdminClient.getInstance(testHelper.getInstanceId().getInstance());\n     logger.info(\"Finished setup\");\n+\n+    // Cancel any backup operation that has been started by this integration test if it has been\n+    // running for at least 6 hours.\n+    logger.info(\"Cancelling long-running test backup operations\");\n+    Pattern pattern = Pattern.compile(\".*/backups/testbck_\\\\d{6}_\\\\d{4}_bck\\\\d/operations/.*\");\n+    try {\n+      for (Operation operation :\n+          dbAdminClient.listBackupOperations(instance.getId().getInstance()).iterateAll()) {\n+        Matcher matcher = pattern.matcher(operation.getName());\n+        if (matcher.matches()) {\n+          if (!operation.getDone()) {\n+            Timestamp currentTime = Timestamp.now();\n+            Timestamp startTime =\n+                Timestamp.fromProto(\n+                    operation\n+                        .getMetadata()\n+                        .unpack(CreateBackupMetadata.class)\n+                        .getProgress()\n+                        .getStartTime());\n+            long diffSeconds = currentTime.getSeconds() - startTime.getSeconds();\n+            if (TimeUnit.HOURS.convert(diffSeconds, TimeUnit.SECONDS) >= 6L) {\n+              logger.warning(\n+                  String.format(\n+                      \"Cancelling test backup operation %s that was started at %s\",\n+                      operation.getName(), startTime.toString()));\n+              dbAdminClient.cancelOperation(operation.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c26d86cf71091a5a208bdb20b7f48716de78776f"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3176, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}