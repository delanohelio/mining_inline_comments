{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNTAwNDMw", "number": 452, "title": "feat!: Point In Time Recovery (PITR)", "bodyText": "Implements the PITR-lite support.\nWith this functionality users will be able to set the retention period for their databases (through the version_retention_period database field). Other than that, user should be able to specify the timestamp for a consistent copy of a database through the version_time field when creating a backup.", "createdAt": "2020-09-23T04:03:02Z", "url": "https://github.com/googleapis/java-spanner/pull/452", "merged": true, "mergeCommit": {"oid": "ab14a5ec2dc2b7e2141305b5326f436eb6eee76f"}, "closed": true, "closedAt": "2021-02-17T04:32:34Z", "author": {"login": "thiagotnunes"}, "timelineItems": {"totalCount": 42, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNwwskgBqjM4MjIwNTA4NzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd64bwxgH2gAyNDkxNTAwNDMwOmU3NTJhMzk4OTU2MGVkYmE3OTM0OGI5Mjc5MjNhMDUwMWVlNjk2NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d683f26126f5827e1e490c068ebfca27b8fafe0d", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/d683f26126f5827e1e490c068ebfca27b8fafe0d", "committedDate": "2020-09-24T01:21:53Z", "message": "fix: ignores pitr backup tests\n\nThis feature is not yet finished in the backend. We should re-enable\nonce this is completed."}, "afterCommit": {"oid": "c146253bbb286e0a049e59220f3ac253f6377aac", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/c146253bbb286e0a049e59220f3ac253f6377aac", "committedDate": "2020-09-29T23:20:40Z", "message": "fix: disables pitr-lite tests in emulator\n\nThe feature is not supported in the emulator currently."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMDY1ODky", "url": "https://github.com/googleapis/java-spanner/pull/452#pullrequestreview-500065892", "createdAt": "2020-10-01T07:15:35Z", "commit": {"oid": "e6abbab71ff4273cf0e6322c2f052dc6bedf1cfb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNzoxNTozNVrOHa9YHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNzoxNjo1NVrOHa9a-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAzMDYyMg==", "bodyText": "This query will list the OPTION_VALUE of all databases on the test instance. If this test is executed against an existing instance with multiple databases having a version_retention_period, it could fail.", "url": "https://github.com/googleapis/java-spanner/pull/452#discussion_r498030622", "createdAt": "2020-10-01T07:15:35Z", "author": {"login": "olavloite"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITPitrUpdateDatabaseTest.java", "diffHunk": "@@ -0,0 +1,195 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.spanner.it;\n+\n+import static com.google.cloud.spanner.testing.EmulatorSpannerHelper.isUsingEmulator;\n+import static com.google.common.truth.Truth.assertThat;\n+import static org.junit.Assert.fail;\n+import static org.junit.Assume.assumeFalse;\n+\n+import com.google.api.gax.paging.Page;\n+import com.google.cloud.spanner.Database;\n+import com.google.cloud.spanner.DatabaseAdminClient;\n+import com.google.cloud.spanner.DatabaseClient;\n+import com.google.cloud.spanner.DatabaseId;\n+import com.google.cloud.spanner.ErrorCode;\n+import com.google.cloud.spanner.IntegrationTestEnv;\n+import com.google.cloud.spanner.ParallelIntegrationTest;\n+import com.google.cloud.spanner.ResultSet;\n+import com.google.cloud.spanner.SpannerException;\n+import com.google.cloud.spanner.Statement;\n+import com.google.cloud.spanner.testing.RemoteSpannerHelper;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.ClassRule;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.JUnit4;\n+import org.threeten.bp.Duration;\n+\n+@Category(ParallelIntegrationTest.class)\n+@RunWith(JUnit4.class)\n+public class ITPitrUpdateDatabaseTest {\n+\n+  private static final Duration OPERATION_TIMEOUT = Duration.ofMinutes(2);\n+  private static final String VERSION_RETENTION_PERIOD = \"7d\";\n+\n+  @ClassRule public static IntegrationTestEnv env = new IntegrationTestEnv();\n+  private static DatabaseAdminClient dbAdminClient;\n+  private static DatabaseClient dbClient;\n+  private static String instanceId;\n+  private static String databaseId;\n+\n+  @BeforeClass\n+  public static void setUp() throws Exception {\n+    assumeFalse(\"PITR-lite features are not supported by the emulator\", isUsingEmulator());\n+\n+    final RemoteSpannerHelper testHelper = env.getTestHelper();\n+    final String projectId = testHelper.getOptions().getProjectId();\n+    instanceId = testHelper.getInstanceId().getInstance();\n+    databaseId = testHelper.getUniqueDatabaseId();\n+    dbAdminClient = testHelper.getClient().getDatabaseAdminClient();\n+\n+    createDatabase(dbAdminClient, instanceId, databaseId, Collections.<String>emptyList());\n+    updateVersionRetentionPeriod(dbAdminClient, instanceId, databaseId, VERSION_RETENTION_PERIOD);\n+\n+    dbClient =\n+        testHelper.getClient().getDatabaseClient(DatabaseId.of(projectId, instanceId, databaseId));\n+  }\n+\n+  @AfterClass\n+  public static void tearDown() {\n+    if (!isUsingEmulator()) {\n+      dbAdminClient.dropDatabase(instanceId, databaseId);\n+    }\n+  }\n+\n+  @Test\n+  public void returnsTheVersionRetentionPeriodSetThroughGetDatabase() {\n+    final Database database = dbAdminClient.getDatabase(instanceId, databaseId);\n+\n+    assertThat(database.getVersionRetentionPeriod()).isEqualTo(VERSION_RETENTION_PERIOD);\n+    assertThat(database.getEarliestVersionTime()).isNotNull();\n+  }\n+\n+  @Test\n+  public void returnsTheVersionRetentionPeriodSetThroughListDatabases() {\n+    final Page<Database> page = dbAdminClient.listDatabases(instanceId);\n+\n+    for (Database database : page.iterateAll()) {\n+      if (!database.getId().getDatabase().equals(databaseId)) {\n+        continue;\n+      }\n+      assertThat(database.getVersionRetentionPeriod()).isEqualTo(VERSION_RETENTION_PERIOD);\n+      assertThat(database.getEarliestVersionTime()).isNotNull();\n+    }\n+  }\n+\n+  @Test\n+  public void returnsTheVersionRetentionPeriodSetThroughGetDatabaseDdl() {\n+    final List<String> ddls = dbAdminClient.getDatabaseDdl(instanceId, databaseId);\n+\n+    boolean hasVersionRetentionPeriodStatement = false;\n+    for (String ddl : ddls) {\n+      hasVersionRetentionPeriodStatement =\n+          ddl.contains(\"version_retention_period = '\" + VERSION_RETENTION_PERIOD + \"'\");\n+      if (hasVersionRetentionPeriodStatement) {\n+        break;\n+      }\n+    }\n+    assertThat(hasVersionRetentionPeriodStatement).isTrue();\n+  }\n+\n+  @Test\n+  public void returnsTheVersionRetentionPeriodSetThroughInformationSchema() {\n+    final ResultSet rs =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6abbab71ff4273cf0e6322c2f052dc6bedf1cfb"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAzMTM1NA==", "bodyText": "nit: The ResultSet is created using a single-use read context and it is fully consumed, so it will be closed, but I would say that it is good practice to always close the ResultSet when you are done with it.", "url": "https://github.com/googleapis/java-spanner/pull/452#discussion_r498031354", "createdAt": "2020-10-01T07:16:55Z", "author": {"login": "olavloite"}, "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITPitrUpdateDatabaseTest.java", "diffHunk": "@@ -0,0 +1,195 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.spanner.it;\n+\n+import static com.google.cloud.spanner.testing.EmulatorSpannerHelper.isUsingEmulator;\n+import static com.google.common.truth.Truth.assertThat;\n+import static org.junit.Assert.fail;\n+import static org.junit.Assume.assumeFalse;\n+\n+import com.google.api.gax.paging.Page;\n+import com.google.cloud.spanner.Database;\n+import com.google.cloud.spanner.DatabaseAdminClient;\n+import com.google.cloud.spanner.DatabaseClient;\n+import com.google.cloud.spanner.DatabaseId;\n+import com.google.cloud.spanner.ErrorCode;\n+import com.google.cloud.spanner.IntegrationTestEnv;\n+import com.google.cloud.spanner.ParallelIntegrationTest;\n+import com.google.cloud.spanner.ResultSet;\n+import com.google.cloud.spanner.SpannerException;\n+import com.google.cloud.spanner.Statement;\n+import com.google.cloud.spanner.testing.RemoteSpannerHelper;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.ClassRule;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.JUnit4;\n+import org.threeten.bp.Duration;\n+\n+@Category(ParallelIntegrationTest.class)\n+@RunWith(JUnit4.class)\n+public class ITPitrUpdateDatabaseTest {\n+\n+  private static final Duration OPERATION_TIMEOUT = Duration.ofMinutes(2);\n+  private static final String VERSION_RETENTION_PERIOD = \"7d\";\n+\n+  @ClassRule public static IntegrationTestEnv env = new IntegrationTestEnv();\n+  private static DatabaseAdminClient dbAdminClient;\n+  private static DatabaseClient dbClient;\n+  private static String instanceId;\n+  private static String databaseId;\n+\n+  @BeforeClass\n+  public static void setUp() throws Exception {\n+    assumeFalse(\"PITR-lite features are not supported by the emulator\", isUsingEmulator());\n+\n+    final RemoteSpannerHelper testHelper = env.getTestHelper();\n+    final String projectId = testHelper.getOptions().getProjectId();\n+    instanceId = testHelper.getInstanceId().getInstance();\n+    databaseId = testHelper.getUniqueDatabaseId();\n+    dbAdminClient = testHelper.getClient().getDatabaseAdminClient();\n+\n+    createDatabase(dbAdminClient, instanceId, databaseId, Collections.<String>emptyList());\n+    updateVersionRetentionPeriod(dbAdminClient, instanceId, databaseId, VERSION_RETENTION_PERIOD);\n+\n+    dbClient =\n+        testHelper.getClient().getDatabaseClient(DatabaseId.of(projectId, instanceId, databaseId));\n+  }\n+\n+  @AfterClass\n+  public static void tearDown() {\n+    if (!isUsingEmulator()) {\n+      dbAdminClient.dropDatabase(instanceId, databaseId);\n+    }\n+  }\n+\n+  @Test\n+  public void returnsTheVersionRetentionPeriodSetThroughGetDatabase() {\n+    final Database database = dbAdminClient.getDatabase(instanceId, databaseId);\n+\n+    assertThat(database.getVersionRetentionPeriod()).isEqualTo(VERSION_RETENTION_PERIOD);\n+    assertThat(database.getEarliestVersionTime()).isNotNull();\n+  }\n+\n+  @Test\n+  public void returnsTheVersionRetentionPeriodSetThroughListDatabases() {\n+    final Page<Database> page = dbAdminClient.listDatabases(instanceId);\n+\n+    for (Database database : page.iterateAll()) {\n+      if (!database.getId().getDatabase().equals(databaseId)) {\n+        continue;\n+      }\n+      assertThat(database.getVersionRetentionPeriod()).isEqualTo(VERSION_RETENTION_PERIOD);\n+      assertThat(database.getEarliestVersionTime()).isNotNull();\n+    }\n+  }\n+\n+  @Test\n+  public void returnsTheVersionRetentionPeriodSetThroughGetDatabaseDdl() {\n+    final List<String> ddls = dbAdminClient.getDatabaseDdl(instanceId, databaseId);\n+\n+    boolean hasVersionRetentionPeriodStatement = false;\n+    for (String ddl : ddls) {\n+      hasVersionRetentionPeriodStatement =\n+          ddl.contains(\"version_retention_period = '\" + VERSION_RETENTION_PERIOD + \"'\");\n+      if (hasVersionRetentionPeriodStatement) {\n+        break;\n+      }\n+    }\n+    assertThat(hasVersionRetentionPeriodStatement).isTrue();\n+  }\n+\n+  @Test\n+  public void returnsTheVersionRetentionPeriodSetThroughInformationSchema() {\n+    final ResultSet rs =\n+        dbClient\n+            .singleUse()\n+            .executeQuery(\n+                Statement.of(\n+                    \"SELECT OPTION_VALUE AS version_retention_period \"\n+                        + \"FROM INFORMATION_SCHEMA.DATABASE_OPTIONS \"\n+                        + \"WHERE SCHEMA_NAME = '' AND OPTION_NAME = 'version_retention_period'\"));\n+\n+    String versionRetentionPeriod = null;\n+    while (rs.next()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6abbab71ff4273cf0e6322c2f052dc6bedf1cfb"}, "originalPosition": 133}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMDMzNzQ5", "url": "https://github.com/googleapis/java-spanner/pull/452#pullrequestreview-501033749", "createdAt": "2020-10-02T10:45:48Z", "commit": {"oid": "0528b8cf7a8dff51a4b3f3053d20475a9810f6c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0528b8cf7a8dff51a4b3f3053d20475a9810f6c1", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/0528b8cf7a8dff51a4b3f3053d20475a9810f6c1", "committedDate": "2020-10-01T23:09:18Z", "message": "fix: closes result set in test\n\nAddresses PR comment."}, "afterCommit": {"oid": "335528757cefeb5bfb6ea44ae87c1fbed34c7851", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/335528757cefeb5bfb6ea44ae87c1fbed34c7851", "committedDate": "2020-10-13T02:59:08Z", "message": "fix: closes result set in test\n\nAddresses PR comment."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "335528757cefeb5bfb6ea44ae87c1fbed34c7851", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/335528757cefeb5bfb6ea44ae87c1fbed34c7851", "committedDate": "2020-10-13T02:59:08Z", "message": "fix: closes result set in test\n\nAddresses PR comment."}, "afterCommit": {"oid": "7c098099085637469343e21bb7bb8eb477340a13", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/googleapis/java-spanner/commit/7c098099085637469343e21bb7bb8eb477340a13", "committedDate": "2020-11-12T02:06:59Z", "message": "tests: remove IT and add unit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d70fc28773cce3e54508e031d196d5f23392f27f", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/d70fc28773cce3e54508e031d196d5f23392f27f", "committedDate": "2020-11-12T22:26:29Z", "message": "fix: does not set encryption info if null\n\nDoes not set encryption info in the request if it is null"}, "afterCommit": {"oid": "a296742c5e11ff2f8142453f1a967ef584b761c1", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/a296742c5e11ff2f8142453f1a967ef584b761c1", "committedDate": "2020-11-12T02:05:28Z", "message": "fix: updates DatabaseInfo equals/hashcode\n\nTo compare version retention period and earliest version time."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODU3MTkz", "url": "https://github.com/googleapis/java-spanner/pull/452#pullrequestreview-531857193", "createdAt": "2020-11-16T22:52:24Z", "commit": {"oid": "a296742c5e11ff2f8142453f1a967ef584b761c1"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bdcdfde8092817fc136fb54e7f73347e269fc21", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/6bdcdfde8092817fc136fb54e7f73347e269fc21", "committedDate": "2020-11-16T23:13:23Z", "message": "fix: formatting\n\nFixes formatting of the DatabaseInfo"}, "afterCommit": {"oid": "2a1921397780e1a9cc3e824e14c17528edc69b7b", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/2a1921397780e1a9cc3e824e14c17528edc69b7b", "committedDate": "2020-11-24T06:59:00Z", "message": "fix: formatting\n\nFixes formatting of the DatabaseInfo"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a1921397780e1a9cc3e824e14c17528edc69b7b", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/2a1921397780e1a9cc3e824e14c17528edc69b7b", "committedDate": "2020-11-24T06:59:00Z", "message": "fix: formatting\n\nFixes formatting of the DatabaseInfo"}, "afterCommit": {"oid": "b39676f42716a90b8f3f18ceb97e3271d55314b3", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/b39676f42716a90b8f3f18ceb97e3271d55314b3", "committedDate": "2020-11-24T07:12:45Z", "message": "feature: adds test for throttled pitr field\n\nAdds test to check for the throttled field in the update database ddl\nmetadata."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MzE3Njkx", "url": "https://github.com/googleapis/java-spanner/pull/452#pullrequestreview-538317691", "createdAt": "2020-11-25T09:45:08Z", "commit": {"oid": "b39676f42716a90b8f3f18ceb97e3271d55314b3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwOTo0NTowOVrOH5rDwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwOTo0NTowOVrOH5rDwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDIzNjM1Mw==", "bodyText": "nit: Could we have a more elaborate comment on this method? And also for getEarliestVersionTime. I don't think everyone will understand what these fields mean.", "url": "https://github.com/googleapis/java-spanner/pull/452#discussion_r530236353", "createdAt": "2020-11-25T09:45:09Z", "author": {"login": "olavloite"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/DatabaseInfo.java", "diffHunk": "@@ -129,6 +155,16 @@ public Timestamp getCreateTime() {\n     return createTime;\n   }\n \n+  /** Returns the version retention period of the database. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b39676f42716a90b8f3f18ceb97e3271d55314b3"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5OTc3MTY1", "url": "https://github.com/googleapis/java-spanner/pull/452#pullrequestreview-539977165", "createdAt": "2020-11-27T13:23:58Z", "commit": {"oid": "4422dd98b970667bbf63032e791f44e1c55636c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4422dd98b970667bbf63032e791f44e1c55636c5", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/4422dd98b970667bbf63032e791f44e1c55636c5", "committedDate": "2020-11-26T01:41:50Z", "message": "fix: explain further the pitr-lite params in docs\n\nAdds more explanations to the purpose of the added params for pitr-lite:\nversion_retention_period and earliest_version_time."}, "afterCommit": {"oid": "7f8d6dc87174e2c2643e86d9ef13ee44b5e729e8", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/7f8d6dc87174e2c2643e86d9ef13ee44b5e729e8", "committedDate": "2021-01-11T02:02:23Z", "message": "fix: explain further the pitr-lite params in docs\n\nAdds more explanations to the purpose of the added params for pitr-lite:\nversion_retention_period and earliest_version_time."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f8d6dc87174e2c2643e86d9ef13ee44b5e729e8", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/7f8d6dc87174e2c2643e86d9ef13ee44b5e729e8", "committedDate": "2021-01-11T02:02:23Z", "message": "fix: explain further the pitr-lite params in docs\n\nAdds more explanations to the purpose of the added params for pitr-lite:\nversion_retention_period and earliest_version_time."}, "afterCommit": {"oid": "6ff6c92698af7d832ba214729ea22c2d69b33329", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/6ff6c92698af7d832ba214729ea22c2d69b33329", "committedDate": "2021-01-12T06:10:44Z", "message": "fix: explain further the pitr-lite params in docs\n\nAdds more explanations to the purpose of the added params for pitr-lite:\nversion_retention_period and earliest_version_time."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ff6c92698af7d832ba214729ea22c2d69b33329", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/6ff6c92698af7d832ba214729ea22c2d69b33329", "committedDate": "2021-01-12T06:10:44Z", "message": "fix: explain further the pitr-lite params in docs\n\nAdds more explanations to the purpose of the added params for pitr-lite:\nversion_retention_period and earliest_version_time."}, "afterCommit": {"oid": "68145900824e2157f326ec294fe7c4487263c554", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/68145900824e2157f326ec294fe7c4487263c554", "committedDate": "2021-01-12T23:37:20Z", "message": "fix: explain further the pitr-lite params in docs\n\nAdds more explanations to the purpose of the added params for pitr-lite:\nversion_retention_period and earliest_version_time."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5147a8d90f21ec576d1caf1db7bdccf8969711da", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/5147a8d90f21ec576d1caf1db7bdccf8969711da", "committedDate": "2021-01-12T23:39:34Z", "message": "feat: adds version time to backups\n\nAdds PITR-lite version time to backups. This should make it possible to\nspecify the consistent time for copying the database."}, "afterCommit": {"oid": "366daae419d3210e93ab59ceb89e6960c1ecd1ef", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/366daae419d3210e93ab59ceb89e6960c1ecd1ef", "committedDate": "2021-01-12T23:43:55Z", "message": "feat: adds version time to backups\n\nAdds PITR-lite version time to backups. This should make it possible to\nspecify the consistent time for copying the database."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "366daae419d3210e93ab59ceb89e6960c1ecd1ef", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/366daae419d3210e93ab59ceb89e6960c1ecd1ef", "committedDate": "2021-01-12T23:43:55Z", "message": "feat: adds version time to backups\n\nAdds PITR-lite version time to backups. This should make it possible to\nspecify the consistent time for copying the database."}, "afterCommit": {"oid": "62c9e1f823586f9512b425b8c858df8077607724", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/62c9e1f823586f9512b425b8c858df8077607724", "committedDate": "2021-01-12T23:48:44Z", "message": "feat: adds version time to backups\n\nAdds PITR-lite version time to backups. This should make it possible to\nspecify the consistent time for copying the database."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MDI3MTUz", "url": "https://github.com/googleapis/java-spanner/pull/452#pullrequestreview-568027153", "createdAt": "2021-01-14T08:56:37Z", "commit": {"oid": "6e7b616ced2de136773246e76f95a2687db27611"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQwODo1NjozN1rOITaqwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQwODo1Nzo1N1rOITawaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzIzMDc4NQ==", "bodyText": "nit: Should we consider naming this variable databaseVersionTime to make it clearer that this relates to the version of the database that is being / has been backed up?", "url": "https://github.com/googleapis/java-spanner/pull/452#discussion_r557230785", "createdAt": "2021-01-14T08:56:37Z", "author": {"login": "olavloite"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/BackupInfo.java", "diffHunk": "@@ -55,6 +67,7 @@\n     protected final BackupId id;\n     private State state = State.UNSPECIFIED;\n     private Timestamp expireTime;\n+    private Timestamp versionTime;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7b616ced2de136773246e76f95a2687db27611"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzIzMjIzMg==", "bodyText": "nit: Wouldn't it be better to make the builder accept null values instead of having to wrap these calls in if-statements every time it is set?", "url": "https://github.com/googleapis/java-spanner/pull/452#discussion_r557232232", "createdAt": "2021-01-14T08:57:57Z", "author": {"login": "olavloite"}, "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/Database.java", "diffHunk": "@@ -118,8 +118,17 @@ public boolean exists() {\n     Preconditions.checkArgument(\n         backup.getInstanceId().equals(getId().getInstanceId()),\n         \"The instance of the backup must be equal to the instance of this database.\");\n-    return dbClient.createBackup(\n-        instance(), backup.getId().getBackup(), database(), backup.getExpireTime());\n+\n+    final BackupInfo.Builder backupBuilder =\n+        dbClient\n+            .newBackupBuilder(backup.getId())\n+            .setDatabase(getId())\n+            .setExpireTime(backup.getExpireTime());\n+    if (backup.getVersionTime() != null) {\n+      backupBuilder.setVersionTime(backup.getVersionTime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7b616ced2de136773246e76f95a2687db27611"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b2fe0f2ed5c38f6627763044a50099903b181ba", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/8b2fe0f2ed5c38f6627763044a50099903b181ba", "committedDate": "2021-01-15T01:37:35Z", "message": "chore: refactors / addresses pr comments"}, "afterCommit": {"oid": "d6a45d0b2eef72ff461c575215aa95b85191f945", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/d6a45d0b2eef72ff461c575215aa95b85191f945", "committedDate": "2021-01-28T00:43:18Z", "message": "chore: refactors / addresses pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26999121179ff7599d0ecccdd826a4d09bfeefbf", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/26999121179ff7599d0ecccdd826a4d09bfeefbf", "committedDate": "2021-02-01T01:21:36Z", "message": "feat: exposes new pitr-lite database fields\n\nExposes earliest version time and version retention period fields in the\ndatabase class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad219b7b8369629796df9ac3c6fa929fccfd1ae8", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/ad219b7b8369629796df9ac3c6fa929fccfd1ae8", "committedDate": "2021-02-01T01:21:36Z", "message": "feat: adds it tests for updating version retention\n\nAdds integration tests for updating the version retention period."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e53653823bbf55176b8eb1ece0cf8537fabf386c", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/e53653823bbf55176b8eb1ece0cf8537fabf386c", "committedDate": "2021-02-01T01:21:36Z", "message": "feat: adds new create database tests for pitr\n\nAdds create database tests for PITR and refactors the integration test\nclass."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2da2ac3de36b5e3e85bfb6bb224937dc2406afb8", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/2da2ac3de36b5e3e85bfb6bb224937dc2406afb8", "committedDate": "2021-02-01T01:21:36Z", "message": "chore: refactors tests\n\nSeparates PITR database tests into 2 files for clarity."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7968a9f79bece961a647e493a30bdc20f308df58", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/7968a9f79bece961a647e493a30bdc20f308df58", "committedDate": "2021-02-01T01:21:36Z", "message": "fix: disables pitr-lite tests in emulator\n\nThe feature is not supported in the emulator currently."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3764028832eca107a43807cffb2bcd0abe764b30", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/3764028832eca107a43807cffb2bcd0abe764b30", "committedDate": "2021-02-01T01:21:36Z", "message": "fix: closes result set in test\n\nAddresses PR comment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3abb93bdee2f4a4af1eaeeea716a2cfaff54933", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/f3abb93bdee2f4a4af1eaeeea716a2cfaff54933", "committedDate": "2021-02-01T01:21:36Z", "message": "fix: updates DatabaseInfo equals/hashcode\n\nTo compare version retention period and earliest version time."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "594d9fd863c5aea3798e968ec9ad066e6d5bfb30", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/594d9fd863c5aea3798e968ec9ad066e6d5bfb30", "committedDate": "2021-02-01T01:21:36Z", "message": "fix: formatting\n\nFixes formatting of the DatabaseInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60a084e26b3b03f9d71da033d8ad8678c5259b8e", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/60a084e26b3b03f9d71da033d8ad8678c5259b8e", "committedDate": "2021-02-01T01:21:36Z", "message": "feature: adds test for throttled pitr field\n\nAdds test to check for the throttled field in the update database ddl\nmetadata."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3208de98945381430a43873f14c1d8a4b1abdb99", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/3208de98945381430a43873f14c1d8a4b1abdb99", "committedDate": "2021-02-01T01:21:36Z", "message": "fix: explain further the pitr-lite params in docs\n\nAdds more explanations to the purpose of the added params for pitr-lite:\nversion_retention_period and earliest_version_time."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72e01d7fa8001847c8ae5e335607721adcb0e100", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/72e01d7fa8001847c8ae5e335607721adcb0e100", "committedDate": "2021-02-01T01:21:37Z", "message": "feat: adds version time to backups\n\nAdds PITR-lite version time to backups. This should make it possible to\nspecify the consistent time for copying the database."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e139666621a9bfc92a7f04c54a9e048a9a29d4d2", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/e139666621a9bfc92a7f04c54a9e048a9a29d4d2", "committedDate": "2021-02-01T01:21:37Z", "message": "test: adds integration tests for pitr backups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b489b8c4d20359de67a03a026efed3b7d2f7c85c", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/b489b8c4d20359de67a03a026efed3b7d2f7c85c", "committedDate": "2021-02-01T01:21:37Z", "message": "test: adds tests for pitr restore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc7fb5079cc14b0fed86a20e8f99cff619cd85ba", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/bc7fb5079cc14b0fed86a20e8f99cff619cd85ba", "committedDate": "2021-02-01T01:21:37Z", "message": "test: fixes integration test for pitr restore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c34fc32fff9ddba94c1cb3ffce501b513065aaa", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/8c34fc32fff9ddba94c1cb3ffce501b513065aaa", "committedDate": "2021-02-01T01:21:37Z", "message": "test: fixes backup unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9faa574aca6819815b239cfc62a747d0c5115829", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/9faa574aca6819815b239cfc62a747d0c5115829", "committedDate": "2021-02-01T01:21:37Z", "message": "test: fixes npe on pitr backup test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fbb0b2b31812540dfa1360abb68710b71dabb2c", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/5fbb0b2b31812540dfa1360abb68710b71dabb2c", "committedDate": "2021-02-01T01:21:37Z", "message": "chore: fixes clirr errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa2f11ec75c2dcbc7ec00c5dc2f274dfd8f54197", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/aa2f11ec75c2dcbc7ec00c5dc2f274dfd8f54197", "committedDate": "2021-02-01T01:21:37Z", "message": "chore: refactors / addresses pr comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6a45d0b2eef72ff461c575215aa95b85191f945", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/d6a45d0b2eef72ff461c575215aa95b85191f945", "committedDate": "2021-01-28T00:43:18Z", "message": "chore: refactors / addresses pr comments"}, "afterCommit": {"oid": "aa2f11ec75c2dcbc7ec00c5dc2f274dfd8f54197", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/aa2f11ec75c2dcbc7ec00c5dc2f274dfd8f54197", "committedDate": "2021-02-01T01:21:37Z", "message": "chore: refactors / addresses pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66f4b296ce7ff17f4de0b1fc64016b451323da51", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/66f4b296ce7ff17f4de0b1fc64016b451323da51", "committedDate": "2021-02-04T04:34:05Z", "message": "test: fixes the it pitr sad cases tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4d795ec0fc17ef788cdfb77b66cf9476ecd567b", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/d4d795ec0fc17ef788cdfb77b66cf9476ecd567b", "committedDate": "2021-02-04T06:32:11Z", "message": "test: fixes pitr backup and restore tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da00ad6ecf27246bbf0bf225edcfa770c72dc4a1", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/da00ad6ecf27246bbf0bf225edcfa770c72dc4a1", "committedDate": "2021-02-17T00:51:13Z", "message": "test: skips pitr backup and restore tests\n\nThis is because the backend for these features is not ready yet."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e05f73aa1220c2813e6bb49e208d7f3591a0d9f", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/2e05f73aa1220c2813e6bb49e208d7f3591a0d9f", "committedDate": "2021-02-17T03:48:40Z", "message": "Merge branch 'master' of github.com:thiagotnunes/java-spanner into pitr-lite"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e752a3989560edba79348b927923a0501ee69670", "author": {"user": {"login": "thiagotnunes", "name": "Thiago Nunes"}}, "url": "https://github.com/googleapis/java-spanner/commit/e752a3989560edba79348b927923a0501ee69670", "committedDate": "2021-02-17T03:49:51Z", "message": "Merge branch 'master' of github.com:thiagotnunes/java-spanner into pitr-lite"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1013, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}