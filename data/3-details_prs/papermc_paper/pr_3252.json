{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwNDI0NzQ2", "number": 3252, "title": "Allow delegation to vanilla chunk gen (implements #3250)", "bodyText": "This PR adds a createVanillaChunkData (next to the createChunkData) method, that allows you to generate a chunk by vanilla chunk gen.\nThis allows you to create stuff like this, a chunk gen that creates a vanilla world in a plus shape with a bedrock world border\n\nhttps://github.com/MiniDigger/worldgentest/blob/master/src/main/java/me/minidigger/worldgentest/PlusGenerator.kt", "createdAt": "2020-04-29T00:17:19Z", "url": "https://github.com/PaperMC/Paper/pull/3252", "merged": true, "mergeCommit": {"oid": "40ace3f7b767dbd96ba6a7614c55aa7da48ffce4"}, "closed": true, "closedAt": "2020-07-05T03:46:05Z", "author": {"login": "MiniDigger"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccik3WAFqTQwMzE0MjYzNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcx0UUtABqjM1MTMwMDAwMTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMTQyNjM0", "url": "https://github.com/PaperMC/Paper/pull/3252#pullrequestreview-403142634", "createdAt": "2020-04-30T01:12:59Z", "commit": {"oid": "977c7644c7e956baec7e35a70d195583744a1bd1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMToxMzowMFrOGOWdEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMToxMzowMFrOGOWdEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwMTEzOA==", "bodyText": "is there anything here making this unsafe for async usage? If so, i think we should resolve that.\nWorldGenerators are now supposed to be parallel capable, so let's not regress that.", "url": "https://github.com/PaperMC/Paper/pull/3252#discussion_r417701138", "createdAt": "2020-04-30T01:13:00Z", "author": {"login": "aikar"}, "path": "Spigot-Server-Patches/0496-Allow-delegation-to-vanilla-chunk-gen.patch", "diffHunk": "@@ -0,0 +1,71 @@\n+From 9a92b34331e5f08498239aa29b6bba768fdba252 Mon Sep 17 00:00:00 2001\n+From: MiniDigger <admin@minidigger.me>\n+Date: Wed, 29 Apr 2020 02:10:32 +0200\n+Subject: [PATCH] Allow delegation to vanilla chunk gen\n+\n+\n+diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java\n+index f49193d9d..c7e41c7e3 100644\n+--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java\n++++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java\n+@@ -1857,6 +1857,31 @@ public final class CraftServer implements Server {\n+         return new CraftChunkData(world);\n+     }\n+ \n++    // Paper start\n++    @Override\n++    public ChunkGenerator.ChunkData createVanillaChunkData(World world, int x, int z) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c7644c7e956baec7e35a70d195583744a1bd1"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTAwNTc1", "url": "https://github.com/PaperMC/Paper/pull/3252#pullrequestreview-403900575", "createdAt": "2020-04-30T21:46:56Z", "commit": {"oid": "977c7644c7e956baec7e35a70d195583744a1bd1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMTo0Njo1N1rOGO7e6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMTo0Njo1N1rOGO7e6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODMwNzgxNg==", "bodyText": "these doCarving calls need to be removed, thats by spigots generator.shouldGenerateCaves() already", "url": "https://github.com/PaperMC/Paper/pull/3252#discussion_r418307816", "createdAt": "2020-04-30T21:46:57Z", "author": {"login": "MiniDigger"}, "path": "Spigot-Server-Patches/0496-Allow-delegation-to-vanilla-chunk-gen.patch", "diffHunk": "@@ -0,0 +1,71 @@\n+From 9a92b34331e5f08498239aa29b6bba768fdba252 Mon Sep 17 00:00:00 2001\n+From: MiniDigger <admin@minidigger.me>\n+Date: Wed, 29 Apr 2020 02:10:32 +0200\n+Subject: [PATCH] Allow delegation to vanilla chunk gen\n+\n+\n+diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java\n+index f49193d9d..c7e41c7e3 100644\n+--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java\n++++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java\n+@@ -1857,6 +1857,31 @@ public final class CraftServer implements Server {\n+         return new CraftChunkData(world);\n+     }\n+ \n++    // Paper start\n++    @Override\n++    public ChunkGenerator.ChunkData createVanillaChunkData(World world, int x, int z) {\n++        // get empty object\n++        CraftChunkData data = (CraftChunkData) createChunkData(world);\n++        // do bunch of vanilla shit\n++        net.minecraft.server.WorldServer nmsWorld = ((CraftWorld) world).getHandle();\n++        net.minecraft.server.ProtoChunk protoChunk = new net.minecraft.server.ProtoChunk(new net.minecraft.server.ChunkCoordIntPair(x, z), net.minecraft.server.ChunkConverter.a); // TODO obfhelper\n++        List<net.minecraft.server.IChunkAccess> list = new ArrayList<>();\n++        list.add(protoChunk);\n++        net.minecraft.server.RegionLimitedWorldAccess genRegion = new net.minecraft.server.RegionLimitedWorldAccess(nmsWorld, list);\n++        // call vanilla generator, one feature after another. Order here is important!\n++        net.minecraft.server.ChunkGenerator<?> chunkGenerator = ((CraftWorld) world).getHandle().worldProvider.getChunkGenerator();\n++        chunkGenerator.createBiomes(protoChunk);\n++        chunkGenerator.buildNoise(genRegion, protoChunk);\n++        chunkGenerator.buildBase(genRegion, protoChunk);\n++        chunkGenerator.doCarving(genRegion.d(), protoChunk,  net.minecraft.server.WorldGenStage.Features.AIR);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c7644c7e956baec7e35a70d195583744a1bd1"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "977c7644c7e956baec7e35a70d195583744a1bd1", "author": {"user": {"login": "MiniDigger", "name": "MiniDigger | Martin"}}, "url": "https://github.com/PaperMC/Paper/commit/977c7644c7e956baec7e35a70d195583744a1bd1", "committedDate": "2020-04-29T00:12:51Z", "message": "Allow delegation to vanilla chunk gen"}, "afterCommit": {"oid": "86f3d12586f1ec31b86865d7531b8a4dd852fe90", "author": {"user": {"login": "MiniDigger", "name": "MiniDigger | Martin"}}, "url": "https://github.com/PaperMC/Paper/commit/86f3d12586f1ec31b86865d7531b8a4dd852fe90", "committedDate": "2020-05-11T19:14:10Z", "message": "Allow delegation to vanilla chunk gen"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTY4OTMz", "url": "https://github.com/PaperMC/Paper/pull/3252#pullrequestreview-430168933", "createdAt": "2020-06-13T21:19:49Z", "commit": {"oid": "86f3d12586f1ec31b86865d7531b8a4dd852fe90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QyMToxOTo0OVrOGjZckQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QyMToxOTo0OVrOGjZckQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc3MDI1Nw==", "bodyText": "Should this go in 0003-MC-Dev-fixes.patch? I haven't contributed to Paper in a while - I forget the right procedure \ud83d\ude06", "url": "https://github.com/PaperMC/Paper/pull/3252#discussion_r439770257", "createdAt": "2020-06-13T21:19:49Z", "author": {"login": "Techcable"}, "path": "Spigot-Server-Patches/0521-Allow-delegation-to-vanilla-chunk-gen.patch", "diffHunk": "@@ -0,0 +1,88 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: MiniDigger <admin@minidigger.me>\n+Date: Wed, 29 Apr 2020 02:10:32 +0200\n+Subject: [PATCH] Allow delegation to vanilla chunk gen\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/ChunkConverter.java b/src/main/java/net/minecraft/server/ChunkConverter.java\n+index 8dd940fd94e4d129d1b8e20a91310028477bbd9b..24c64e5f487ef8ccd508071feb88712216c7b66d 100644\n+--- a/src/main/java/net/minecraft/server/ChunkConverter.java\n++++ b/src/main/java/net/minecraft/server/ChunkConverter.java\n+@@ -17,7 +17,7 @@ import org.apache.logging.log4j.Logger;\n+ public class ChunkConverter {\n+ \n+     private static final Logger LOGGER = LogManager.getLogger();\n+-    public static final ChunkConverter a = new ChunkConverter();\n++    public static final ChunkConverter a = new ChunkConverter(); public static ChunkConverter getEmptyConverter() { return a; } // Paper - obfhelper\n+     private static final EnumDirection8[] c = EnumDirection8.values();\n+     private final EnumSet<EnumDirection8> d;\n+     private final int[][] e;\n+@@ -343,7 +343,7 @@ public class ChunkConverter {\n+                         if ((Integer) iblockdata.get(BlockProperties.ah) >= j) {\n+                             generatoraccess.setTypeAndData(blockposition, (IBlockData) iblockdata.set(BlockProperties.ah, j), 18);\n+                             if (i != 7) {\n+-                                EnumDirection[] aenumdirection = null.f;\n++                                EnumDirection[] aenumdirection = f; // Paper - decomp fix", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86f3d12586f1ec31b86865d7531b8a4dd852fe90"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40ace3f7b767dbd96ba6a7614c55aa7da48ffce4", "author": {"user": {"login": "MiniDigger", "name": "MiniDigger | Martin"}}, "url": "https://github.com/PaperMC/Paper/commit/40ace3f7b767dbd96ba6a7614c55aa7da48ffce4", "committedDate": "2020-07-05T03:45:11Z", "message": "Allow delegation to vanilla chunk gen"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86f3d12586f1ec31b86865d7531b8a4dd852fe90", "author": {"user": {"login": "MiniDigger", "name": "MiniDigger | Martin"}}, "url": "https://github.com/PaperMC/Paper/commit/86f3d12586f1ec31b86865d7531b8a4dd852fe90", "committedDate": "2020-05-11T19:14:10Z", "message": "Allow delegation to vanilla chunk gen"}, "afterCommit": {"oid": "40ace3f7b767dbd96ba6a7614c55aa7da48ffce4", "author": {"user": {"login": "MiniDigger", "name": "MiniDigger | Martin"}}, "url": "https://github.com/PaperMC/Paper/commit/40ace3f7b767dbd96ba6a7614c55aa7da48ffce4", "committedDate": "2020-07-05T03:45:11Z", "message": "Allow delegation to vanilla chunk gen"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1296, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}