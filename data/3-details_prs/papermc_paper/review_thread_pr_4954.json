{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2NDg0ODgy", "number": 4954, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMzoyNzo0OFrOFJxdDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQxNjo1MzoxN1rOFKVDJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NzkxNzU2OnYy", "diffSide": "RIGHT", "path": "Spigot-Server-Patches/0625-Optimized-tick-ready-check.patch", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMzoyNzo0OFrOIMPSrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMzoyNzo0OFrOIMPSrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcwNDM2NA==", "bodyText": "Drop this", "url": "https://github.com/PaperMC/Paper/pull/4954#discussion_r549704364", "createdAt": "2020-12-29T13:27:48Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0625-Optimized-tick-ready-check.patch", "diffHunk": "@@ -0,0 +1,21 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: lukas <lukasalt98@gmail.com>\n+Date: Sun, 27 Dec 2020 17:19:51 +0100\n+Subject: [PATCH] Optimized tick ready check\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java\n+index 9ed21f434c5fb019b74dfe9ee0b802ccc5c07fd8..631a01c6f65c29cf20a3dfcdca29d4de9c8cce92 100644\n+--- a/src/main/java/net/minecraft/server/World.java\n++++ b/src/main/java/net/minecraft/server/World.java\n+@@ -792,8 +792,8 @@ public abstract class World implements GeneratorAccess, AutoCloseable {\n+ \n+             if (!tileentity.isRemoved() && tileentity.hasWorld()) {\n+                 BlockPosition blockposition = tileentity.getPosition();\n+-\n+-                if (this.getChunkProvider().a(blockposition) && this.getWorldBorder().a(blockposition)) {\n++                ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0144e62fc6b946c23b30ff2cabe4031de75a748"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NzkxODk5OnYy", "diffSide": "RIGHT", "path": "Spigot-Server-Patches/0625-Optimized-tick-ready-check.patch", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMzoyODoyM1rOIMPTfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMzo1MDoxMlrOIMPvJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcwNDU3Mg==", "bodyText": "Add a comment of what exactly you did (i.e. inlined the getChunkProvider().a(BlockPosition) call).", "url": "https://github.com/PaperMC/Paper/pull/4954#discussion_r549704572", "createdAt": "2020-12-29T13:28:23Z", "author": {"login": "Proximyst"}, "path": "Spigot-Server-Patches/0625-Optimized-tick-ready-check.patch", "diffHunk": "@@ -0,0 +1,21 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: lukas <lukasalt98@gmail.com>\n+Date: Sun, 27 Dec 2020 17:19:51 +0100\n+Subject: [PATCH] Optimized tick ready check\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java\n+index 9ed21f434c5fb019b74dfe9ee0b802ccc5c07fd8..631a01c6f65c29cf20a3dfcdca29d4de9c8cce92 100644\n+--- a/src/main/java/net/minecraft/server/World.java\n++++ b/src/main/java/net/minecraft/server/World.java\n+@@ -792,8 +792,8 @@ public abstract class World implements GeneratorAccess, AutoCloseable {\n+ \n+             if (!tileentity.isRemoved() && tileentity.hasWorld()) {\n+                 BlockPosition blockposition = tileentity.getPosition();\n+-\n+-                if (this.getChunkProvider().a(blockposition) && this.getWorldBorder().a(blockposition)) {\n++                \n++                Chunk chunk; PlayerChunk playerChunk; if ((chunk = tileentity.getCurrentChunk()) != null && (playerChunk = chunk.playerChunk) != null && playerChunk.isTickingReady() && this.getWorldBorder().a(blockposition)) { // Paper - optimized tick ready check", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0144e62fc6b946c23b30ff2cabe4031de75a748"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcxMTY1NQ==", "bodyText": "Alright, I've added a comment", "url": "https://github.com/PaperMC/Paper/pull/4954#discussion_r549711655", "createdAt": "2020-12-29T13:50:12Z", "author": {"login": "lukalt"}, "path": "Spigot-Server-Patches/0625-Optimized-tick-ready-check.patch", "diffHunk": "@@ -0,0 +1,21 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: lukas <lukasalt98@gmail.com>\n+Date: Sun, 27 Dec 2020 17:19:51 +0100\n+Subject: [PATCH] Optimized tick ready check\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java\n+index 9ed21f434c5fb019b74dfe9ee0b802ccc5c07fd8..631a01c6f65c29cf20a3dfcdca29d4de9c8cce92 100644\n+--- a/src/main/java/net/minecraft/server/World.java\n++++ b/src/main/java/net/minecraft/server/World.java\n+@@ -792,8 +792,8 @@ public abstract class World implements GeneratorAccess, AutoCloseable {\n+ \n+             if (!tileentity.isRemoved() && tileentity.hasWorld()) {\n+                 BlockPosition blockposition = tileentity.getPosition();\n+-\n+-                if (this.getChunkProvider().a(blockposition) && this.getWorldBorder().a(blockposition)) {\n++                \n++                Chunk chunk; PlayerChunk playerChunk; if ((chunk = tileentity.getCurrentChunk()) != null && (playerChunk = chunk.playerChunk) != null && playerChunk.isTickingReady() && this.getWorldBorder().a(blockposition)) { // Paper - optimized tick ready check", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcwNDU3Mg=="}, "originalCommit": {"oid": "d0144e62fc6b946c23b30ff2cabe4031de75a748"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2Mzc0OTUxOnYy", "diffSide": "RIGHT", "path": "Spigot-Server-Patches/0625-Optimized-tick-ready-check.patch", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQxNjo1MzoxN1rOINDIvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQxNjo1MzoxN1rOINDIvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDU1Mzc4OA==", "bodyText": "nitpick, these are two lines now, so two comments please :P\ncan fix that while merging tho", "url": "https://github.com/PaperMC/Paper/pull/4954#discussion_r550553788", "createdAt": "2020-12-31T16:53:17Z", "author": {"login": "MiniDigger"}, "path": "Spigot-Server-Patches/0625-Optimized-tick-ready-check.patch", "diffHunk": "@@ -0,0 +1,52 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: lukas <lukasalt98@gmail.com>\n+Date: Sun, 27 Dec 2020 17:19:51 +0100\n+Subject: [PATCH] Optimized tick ready check\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java\n+index 9ed21f434c5fb019b74dfe9ee0b802ccc5c07fd8..8e4f646625b0a7904ccc4f1c091ba3c6458e3aad 100644\n+--- a/src/main/java/net/minecraft/server/World.java\n++++ b/src/main/java/net/minecraft/server/World.java\n+@@ -792,14 +792,13 @@ public abstract class World implements GeneratorAccess, AutoCloseable {\n+\n+             if (!tileentity.isRemoved() && tileentity.hasWorld()) {\n+                 BlockPosition blockposition = tileentity.getPosition();\n+-\n+-                if (this.getChunkProvider().a(blockposition) && this.getWorldBorder().a(blockposition)) {\n++                Chunk chunk; PlayerChunk playerChunk; if ((chunk = tileentity.getCurrentChunk()) != null && (playerChunk = chunk.playerChunk) != null && playerChunk.isTickingReady() && this.getWorldBorder().isInBounds(blockposition)) { // Paper - optimized tick ready check by inlining ChunkProviderServer.a(BlockPosition). Chunk lookup is no longer required and we can use the PlayerChunk directly available through the tile entity\n+                     try {\n+                         gameprofilerfiller.a(() -> {\n+                             return String.valueOf(TileEntityTypes.a(tileentity.getTileType()));\n+                         });\n+                         tileentity.tickTimer.startTiming(); // Spigot\n+-                        if (tileentity.getTileType().isValidBlock(this.getType(blockposition).getBlock())) {\n++                        if (tileentity.getTileType().isValidBlock(chunk.getType(blockposition).getBlock())) { // Paper - reuse the chunk from above, do not look it up again\n+                             ((ITickable) tileentity).tick();\n+                         } else {\n+                             tileentity.w();\n+@@ -833,9 +832,11 @@ public abstract class World implements GeneratorAccess, AutoCloseable {\n+                 this.tileEntityListTick.remove(tileTickPosition--);\n+                 // Spigot end\n+                 //this.tileEntityList.remove(tileentity); // Paper - remove unused list\n+-                if (this.isLoaded(tileentity.getPosition())) {\n+-                    this.getChunkAtWorldCoords(tileentity.getPosition()).removeTileEntity(tileentity.getPosition());\n++                // Paper - prevent double chunk lookups\n++                Chunk chunk; if ((chunk = this.getChunkIfLoaded(tileentity.getPosition())) != null) { // inlined contents of this.isLoaded(BlockPosition). Reuse the returned chunk instead of looking it up again\n++                    chunk.removeTileEntity(tileentity.getPosition());\n+                 }\n++                // Paper end\n+             }\n+         }\n+\n+@@ -854,8 +855,8 @@ public abstract class World implements GeneratorAccess, AutoCloseable {\n+                     }\n+                     // CraftBukkit end */\n+\n+-                    if (this.isLoaded(tileentity1.getPosition())) {\n+-                        Chunk chunk = this.getChunkAtWorldCoords(tileentity1.getPosition());\n++                    Chunk chunk; if ((chunk = this.getChunkIfLoaded(tileentity1.getPosition())) != null) {  // inlined contents of this.isLoaded(BlockPosition). Reuse the returned chunk instead of looking it up again", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c0e6c4ba1676a74d6f1618443b631134d8c2980"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1693, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}